<application>
  <component name="VimSettings">
    <state version="4" enabled="true" />
    <globalmarks />
    <filemarks>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/Decoration.cs" timestamp="1498573346394">
        <mark key="'" line="71" column="19" />
        <mark key="[" line="26" column="41" />
        <mark key="]" line="26" column="41" />
        <mark key="^" line="26" column="41" />
        <mark key="." line="26" column="41" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/DataService/ShapeData.cs" timestamp="1498570609670">
        <mark key="'" line="50" column="4" />
        <mark key="[" line="9" column="40" />
        <mark key="]" line="11" column="23" />
        <mark key="." line="11" column="23" />
        <mark key="^" line="11" column="23" />
      </file>
      <file name="$USER_HOME$/Projects/mocha-given/index.d.ts" timestamp="1490284104781">
        <mark key="'" line="1" column="0" />
        <mark key="[" line="11" column="0" />
        <mark key="]" line="11" column="0" />
        <mark key="." line="11" column="0" />
        <mark key="^" line="1" column="11" />
      </file>
      <file name="/a.dummy" timestamp="1498741252881">
        <mark key="[" line="0" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/phpold/kuze_utils.php" timestamp="1497784331390">
        <mark key="'" line="59" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/CameraMovement.cs" timestamp="1497450852828">
        <mark key="'" line="193" column="4" />
      </file>
      <file name="$USER_HOME$/Projects/Guy Prives/Automator/server/api/updater/updater.helpers.ts" timestamp="1492791203674">
        <mark key="'" line="25" column="36" />
        <mark key="[" line="33" column="48" />
        <mark key="]" line="34" column="24" />
        <mark key="." line="34" column="24" />
        <mark key="^" line="34" column="24" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/UI/ExitToast.cs" timestamp="1497532567374">
        <mark key="'" line="40" column="0" />
        <mark key="[" line="2" column="0" />
        <mark key="]" line="2" column="0" />
        <mark key="." line="2" column="0" />
        <mark key="^" line="10" column="9" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/UI/GameEditor/ShareGardenButton.cs" timestamp="1498649510899">
        <mark key="'" line="24" column="51" />
        <mark key="[" line="29" column="0" />
        <mark key="]" line="29" column="36" />
        <mark key="." line="29" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/PieceGenerator.cs" timestamp="1498668509814">
        <mark key="'" line="0" column="0" />
        <mark key="[" line="43" column="0" />
        <mark key="]" line="43" column="0" />
        <mark key="." line="43" column="0" />
        <mark key="^" line="78" column="66" />
      </file>
      <file name="$APPLICATION_CONFIG_DIR$/scratches/scratch.json" timestamp="1492339698148">
        <mark key="'" line="21" column="0" />
        <mark key="[" line="2" column="14" />
        <mark key="]" line="2" column="13" />
        <mark key="." line="2" column="13" />
        <mark key="^" line="2" column="13" />
      </file>
      <file name="$APPLICATION_CONFIG_DIR$/scratches/scratch_3.json" timestamp="1492678325641">
        <mark key="'" line="4983" column="0" />
        <mark key="[" line="0" column="0" />
        <mark key="]" line="0" column="48708" />
        <mark key="^" line="0" column="48708" />
        <mark key="." line="0" column="48708" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/UI/GameEditor/SaveButton.cs" timestamp="1498572998507">
        <mark key="'" line="74" column="42" />
        <mark key="[" line="74" column="42" />
        <mark key="]" line="74" column="50" />
        <mark key="." line="74" column="50" />
        <mark key="^" line="74" column="50" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/PuzzlePiece.cs" timestamp="1497973981788">
        <mark key="'" line="70" column="42" />
        <mark key="[" line="199" column="8" />
        <mark key="]" line="199" column="42" />
        <mark key="." line="199" column="42" />
        <mark key="^" line="199" column="42" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/public/js/angular/kuze_business_utils-v11.js" timestamp="1498391567633">
        <mark key="'" line="833" column="9" />
        <mark key="[" line="642" column="22" />
        <mark key="]" line="642" column="22" />
        <mark key="^" line="642" column="22" />
        <mark key="." line="642" column="22" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/angular/business_modal_client_payment.php" timestamp="1498395729099">
        <mark key="'" line="113" column="37" />
        <mark key="[" line="168" column="7" />
        <mark key="]" line="168" column="43" />
        <mark key="." line="168" column="43" />
        <mark key="^" line="168" column="43" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/public/js/angular/kuze_enduser_app.js" timestamp="1498045366621">
        <mark key="'" line="1187" column="20" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/db_scripts/2017_06_21_Business_invoices.sql" timestamp="1498744268397">
        <mark key="[" line="5" column="16" />
        <mark key="]" line="5" column="16" />
        <mark key="." line="5" column="16" />
        <mark key="^" line="6" column="30" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/api/invoices.php" timestamp="1498725747370">
        <mark key="'" line="95" column="4" />
        <mark key="[" line="7" column="6" />
        <mark key="]" line="7" column="6" />
        <mark key="." line="7" column="6" />
        <mark key="^" line="115" column="43" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/kuze_general_business_utils.php" timestamp="1498052689298">
        <mark key="'" line="129" column="24" />
        <mark key="[" line="129" column="30" />
        <mark key="]" line="129" column="30" />
        <mark key="." line="129" column="30" />
        <mark key="^" line="129" column="30" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/AndroidGalleryImageSaver.cs" timestamp="1497519923388">
        <mark key="'" line="31" column="0" />
        <mark key="[" line="15" column="0" />
        <mark key="]" line="15" column="0" />
        <mark key="^" line="15" column="16" />
        <mark key="." line="15" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/kuze_db.php" timestamp="1498728881689">
        <mark key="'" line="111" column="13" />
      </file>
      <file name="$USER_HOME$/Projects/Guy Prives/Automator/server/package.json" timestamp="1492003154014">
        <mark key="'" line="6" column="19" />
        <mark key="[" line="37" column="19" />
        <mark key="]" line="37" column="24" />
        <mark key="." line="37" column="24" />
        <mark key="^" line="37" column="24" />
      </file>
      <file name="$USER_HOME$/Projects/mocha-given/package.json" timestamp="1490283218372">
        <mark key="'" line="10" column="18" />
        <mark key="[" line="10" column="14" />
        <mark key="]" line="10" column="18" />
        <mark key="^" line="10" column="18" />
        <mark key="." line="10" column="18" />
      </file>
      <file name="$USER_HOME$/Projects/luftzig.com/front/src/Styling.elm" timestamp="1497700286779">
        <mark key="'" line="39" column="31" />
        <mark key="[" line="39" column="47" />
        <mark key="]" line="39" column="47" />
        <mark key="." line="39" column="47" />
        <mark key="^" line="39" column="47" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/angular/business_event_card.php" timestamp="1498032963100">
        <mark key="'" line="112" column="17" />
        <mark key="[" line="112" column="157" />
        <mark key="]" line="112" column="178" />
      </file>
      <file name="$USER_HOME$/Projects/luftzig.com/front/elm-stuff/packages/rtfeldman/elm-css/8.1.0/src/Css.elm" timestamp="1497694656695">
        <mark key="'" line="4371" column="8" />
      </file>
      <file name="$USER_HOME$/Projects/luftzig.com/front/src/View.elm" timestamp="1497799291882">
        <mark key="'" line="94" column="10" />
        <mark key="[" line="2" column="7" />
        <mark key="]" line="2" column="15" />
        <mark key="." line="2" column="15" />
        <mark key="^" line="2" column="15" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/StreamingAssets/stages.json" timestamp="1498668761069">
        <mark key="'" line="49" column="28" />
        <mark key="[" line="49" column="0" />
        <mark key="]" line="49" column="56" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/kuze_const.php" timestamp="1498044815249">
        <mark key="'" line="79" column="0" />
        <mark key="[" line="37" column="31" />
        <mark key="]" line="37" column="34" />
        <mark key="." line="37" column="34" />
        <mark key="^" line="37" column="34" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/public/js/angular/config-js.php" timestamp="1498387204283">
        <mark key="[" line="266" column="0" />
        <mark key="]" line="266" column="4" />
        <mark key="." line="266" column="4" />
        <mark key="^" line="111" column="0" />
      </file>
      <file name="vim_settings.xml" timestamp="1498470093079">
        <mark key="[" line="0" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/site.conf" timestamp="1497783226999">
        <mark key="'" line="0" column="0" />
        <mark key="[" line="0" column="0" />
        <mark key="]" line="39" column="0" />
        <mark key="." line="8" column="4" />
        <mark key="^" line="8" column="4" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" timestamp="1499153793615">
        <mark key="[" line="3" column="0" />
        <mark key="]" line="3" column="0" />
        <mark key="." line="3" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/angular/business_config.php" timestamp="1498044504233">
        <mark key="'" line="84" column="40" />
        <mark key="[" line="31" column="0" />
        <mark key="]" line="31" column="0" />
        <mark key="." line="31" column="0" />
        <mark key="^" line="109" column="210" />
      </file>
      <file name="$APPLICATION_CONFIG_DIR$/scratches/scratch_5.json" timestamp="1492685289704">
        <mark key="'" line="7" column="18" />
        <mark key="[" line="0" column="0" />
        <mark key="]" line="0" column="9003" />
        <mark key="^" line="0" column="9003" />
        <mark key="." line="0" column="9003" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/invoice/create-acc.php" timestamp="1498738780092">
        <mark key="[" line="10" column="0" />
        <mark key="]" line="26" column="48" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/PieceHex.cs" timestamp="1497973650339">
        <mark key="'" line="29" column="12" />
        <mark key="[" line="23" column="0" />
        <mark key="]" line="23" column="0" />
        <mark key="." line="23" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/luftzig.com/front/src/Main.elm" timestamp="1497695316614">
        <mark key="'" line="11" column="17" />
        <mark key="[" line="24" column="8" />
        <mark key="]" line="24" column="23" />
        <mark key="." line="24" column="23" />
        <mark key="^" line="24" column="23" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" timestamp="1499153782082">
        <mark key="'" line="0" column="0" />
        <mark key="[" line="0" column="0" />
        <mark key="]" line="5861" column="0" />
        <mark key="." line="1925" column="48" />
        <mark key="^" line="1925" column="48" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/ImmortalManager.cs" timestamp="1498141711502">
        <mark key="'" line="123" column="73" />
        <mark key="[" line="127" column="67" />
        <mark key="]" line="127" column="70" />
        <mark key="^" line="127" column="70" />
        <mark key="." line="127" column="70" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/DataService/DataService.cs" timestamp="1498473617414">
        <mark key="'" line="16" column="24" />
        <mark key="[" line="38" column="54" />
        <mark key="]" line="38" column="54" />
        <mark key="^" line="38" column="56" />
        <mark key="." line="38" column="54" />
      </file>
      <file name="$USER_HOME$/Projects/the_bar_node/server/test/greeter-spec.ts" timestamp="1490284305782">
        <mark key="'" line="4" column="40" />
        <mark key="[" line="14" column="22" />
        <mark key="]" line="14" column="22" />
        <mark key="." line="14" column="22" />
        <mark key="^" line="12" column="37" />
      </file>
      <file name="$USER_HOME$/Projects/Guy Prives/Automator/server/api/updater/updater.model.ts" timestamp="1492787491819">
        <mark key="'" line="19" column="105" />
        <mark key="[" line="19" column="105" />
        <mark key="]" line="19" column="105" />
        <mark key="^" line="19" column="105" />
        <mark key="." line="19" column="105" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/DataService/StageData.cs" timestamp="1498123623435">
        <mark key="'" line="9" column="14" />
      </file>
      <file name="$APPLICATION_CONFIG_DIR$/scratches/scratch_6.json" timestamp="1492685876216">
        <mark key="'" line="452" column="0" />
        <mark key="[" line="517" column="35" />
        <mark key="]" line="517" column="33" />
        <mark key="^" line="517" column="33" />
        <mark key="." line="517" column="33" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/GardenScreenshot.cs" timestamp="1498662602044">
        <mark key="'" line="132" column="52" />
        <mark key="[" line="131" column="27" />
        <mark key="]" line="132" column="52" />
        <mark key="." line="132" column="52" />
        <mark key="^" line="132" column="52" />
      </file>
      <file name="$APPLICATION_CONFIG_DIR$/scratches/scratch_1.js" timestamp="1498387185354">
        <mark key="'" line="0" column="0" />
        <mark key="[" line="38" column="0" />
        <mark key="]" line="195" column="1" />
        <mark key="^" line="195" column="1" />
        <mark key="." line="167" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/invoice/create-doc.php" timestamp="1498744316602">
        <mark key="'" line="147" column="0" />
        <mark key="[" line="64" column="0" />
        <mark key="]" line="133" column="1" />
        <mark key="." line="101" column="23" />
        <mark key="^" line="101" column="23" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/invoice/config.inc.php" timestamp="1498723747756">
        <mark key="[" line="3" column="0" />
        <mark key="]" line="8" column="18" />
      </file>
      <file name="$USER_HOME$/Projects/Guy Prives/Automator/server/api/appreciate-client/appreciate-client.ts" timestamp="1492789578918">
        <mark key="'" line="82" column="20" />
        <mark key="[" line="65" column="41" />
        <mark key="]" line="65" column="51" />
        <mark key="^" line="65" column="51" />
        <mark key="." line="65" column="51" />
      </file>
      <file name="$USER_HOME$/Projects/Guy Prives/Automator/server/api/appreciate-client/patch-request-converter.ts" timestamp="1492680861043">
        <mark key="'" line="64" column="0" />
        <mark key="[" line="65" column="25" />
        <mark key="]" line="65" column="31" />
        <mark key="^" line="65" column="31" />
        <mark key="." line="65" column="31" />
      </file>
      <file name="/dummy.sql" timestamp="1498743616409">
        <mark key="[" line="0" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/UI/GameEditor/LoadButton.cs" timestamp="1498489326900">
        <mark key="'" line="0" column="0" />
        <mark key="[" line="7" column="0" />
        <mark key="]" line="7" column="0" />
        <mark key="^" line="37" column="52" />
        <mark key="." line="7" column="0" />
      </file>
      <file name="$APPLICATION_CONFIG_DIR$/consoles/db/6e25fe0b-98f3-46a4-9336-01e7aed49277/console.sql" timestamp="1498743593854">
        <mark key="[" line="0" column="63" />
        <mark key="]" line="0" column="81" />
        <mark key="." line="0" column="81" />
        <mark key="^" line="0" column="81" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/Borders.cs" timestamp="1497869872208">
        <mark key="'" line="0" column="0" />
        <mark key="[" line="27" column="0" />
        <mark key="]" line="27" column="0" />
        <mark key="^" line="14" column="49" />
        <mark key="." line="27" column="0" />
      </file>
      <file name="/Dummy.txt" timestamp="1498748537892">
        <mark key="[" line="0" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/luftzig.com/front/src/Sections/CodeSection.elm" timestamp="1497799548443">
        <mark key="'" line="39" column="20" />
        <mark key="[" line="22" column="21" />
        <mark key="]" line="22" column="20" />
        <mark key="." line="22" column="20" />
        <mark key="^" line="22" column="20" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" timestamp="1498746722575">
        <mark key="'" line="9" column="26" />
        <mark key="[" line="9" column="26" />
        <mark key="]" line="9" column="57" />
        <mark key="^" line="8" column="23" />
        <mark key="." line="8" column="23" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/DragAndDrop.cs" timestamp="1497973668942">
        <mark key="'" line="34" column="14" />
        <mark key="[" line="47" column="0" />
        <mark key="]" line="54" column="4" />
        <mark key="." line="19" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/kuze_login.php" timestamp="1497776244958">
        <mark key="'" line="43" column="8" />
      </file>
      <file name="$APPLICATION_CONFIG_DIR$/scratches/scratch_1.json" timestamp="1492339311193">
        <mark key="'" line="2669" column="0" />
        <mark key="[" line="0" column="0" />
        <mark key="]" line="2669" column="0" />
        <mark key="^" line="0" column="31135" />
        <mark key="." line="0" column="31135" />
      </file>
    </filemarks>
    <jumps>
      <jump line="260" column="28" filename="$USER_HOME$/Projects/zengarden/Assets/StreamingAssets/stages.json" />
      <jump line="74" column="42" filename="$USER_HOME$/Projects/zengarden/Assets/Scripts/UI/GameEditor/SaveButton.cs" />
      <jump line="80" column="36" filename="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/PieceGenerator.cs" />
      <jump line="160" column="25" filename="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/PieceGenerator.cs" />
      <jump line="42" column="62" filename="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/PieceGenerator.cs" />
      <jump line="24" column="51" filename="$USER_HOME$/Projects/zengarden/Assets/Scripts/UI/GameEditor/ShareGardenButton.cs" />
      <jump line="179" column="48" filename="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/GardenScreenshot.cs" />
      <jump line="185" column="37" filename="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/GardenScreenshot.cs" />
      <jump line="72" column="26" filename="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/GardenScreenshot.cs" />
      <jump line="175" column="8" filename="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/GardenScreenshot.cs" />
      <jump line="1" column="0" filename="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/GardenScreenshot.cs" />
      <jump line="177" column="8" filename="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/GardenScreenshot.cs" />
      <jump line="0" column="0" filename="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/GardenScreenshot.cs" />
      <jump line="89" column="4" filename="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/GardenScreenshot.cs" />
      <jump line="30" column="8" filename="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/GardenScreenshot.cs" />
      <jump line="103" column="0" filename="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/GardenScreenshot.cs" />
      <jump line="161" column="8" filename="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/GardenScreenshot.cs" />
      <jump line="119" column="8" filename="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/GardenScreenshot.cs" />
      <jump line="132" column="52" filename="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/GardenScreenshot.cs" />
      <jump line="54" column="62" filename="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/PieceGenerator.cs" />
      <jump line="44" column="50" filename="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/PieceGenerator.cs" />
      <jump line="0" column="0" filename="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/PieceGenerator.cs" />
      <jump line="568" column="20" filename="$USER_HOME$/Projects/zengarden/Assets/StreamingAssets/stages.json" />
      <jump line="56" column="38" filename="$USER_HOME$/Projects/zengarden/Assets/StreamingAssets/stages.json" />
      <jump line="3303" column="38" filename="$USER_HOME$/Projects/zengarden/Assets/StreamingAssets/stages.json" />
      <jump line="3296" column="38" filename="$USER_HOME$/Projects/zengarden/Assets/StreamingAssets/stages.json" />
      <jump line="3281" column="38" filename="$USER_HOME$/Projects/zengarden/Assets/StreamingAssets/stages.json" />
      <jump line="3274" column="38" filename="$USER_HOME$/Projects/zengarden/Assets/StreamingAssets/stages.json" />
      <jump line="3259" column="38" filename="$USER_HOME$/Projects/zengarden/Assets/StreamingAssets/stages.json" />
      <jump line="0" column="0" filename="$USER_HOME$/Projects/zengarden/Assets/StreamingAssets/stages.json" />
      <jump line="49" column="28" filename="$USER_HOME$/Projects/zengarden/Assets/StreamingAssets/stages.json" />
      <jump line="145" column="23" filename="$USER_HOME$/Projects/kuze/php/invoice/create-doc.php" />
      <jump line="16" column="0" filename="$USER_HOME$/Projects/kuze/php/invoice/create-doc.php" />
      <jump line="68" column="0" filename="$USER_HOME$/Projects/kuze/php/invoice/create-doc.php" />
      <jump line="0" column="0" filename="$USER_HOME$/Projects/kuze/php/invoice/create-doc.php" />
      <jump line="76" column="4" filename="$USER_HOME$/Projects/kuze/php/invoice/create-doc.php" />
      <jump line="3" column="25" filename="$USER_HOME$/Projects/kuze/php/api/invoices.php" />
      <jump line="6" column="0" filename="$USER_HOME$/Projects/kuze/php/invoice/create-doc.php" />
      <jump line="64" column="0" filename="$USER_HOME$/Projects/kuze/php/invoice/create-doc.php" />
      <jump line="91" column="4" filename="$USER_HOME$/Projects/kuze/php/api/invoices.php" />
      <jump line="40" column="0" filename="$USER_HOME$/Projects/kuze/php/invoice/create-doc2.php" />
      <jump line="88" column="4" filename="$USER_HOME$/Projects/kuze/php/invoice/create-doc2.php" />
      <jump line="10" column="0" filename="$USER_HOME$/Projects/kuze/php/invoice/create-doc2.php" />
      <jump line="2903" column="32" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="2904" column="38" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="2913" column="47" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="2916" column="66" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="292" column="74" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="16" column="36" filename="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" />
      <jump line="522" column="22" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="154" column="32" filename="$USER_HOME$/Projects/kuze/php/kuze_db.php" />
      <jump line="111" column="13" filename="$USER_HOME$/Projects/kuze/php/kuze_db.php" />
      <jump line="18" column="32" filename="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" />
      <jump line="19" column="29" filename="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" />
      <jump line="0" column="0" filename="$APPLICATION_CONFIG_DIR$/consoles/db/6e25fe0b-98f3-46a4-9336-01e7aed49277/console.sql" />
      <jump line="107" column="6" filename="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" />
      <jump line="0" column="0" filename="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" />
      <jump line="101" column="5" filename="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" />
      <jump line="7" column="0" filename="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" />
      <jump line="59" column="8" filename="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" />
      <jump line="2914" column="29" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="2915" column="45" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="2923" column="13" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="2925" column="2" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="100" column="46" filename="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" />
      <jump line="1951" column="27" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="126" column="21" filename="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" />
      <jump line="22" column="0" filename="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" />
      <jump line="1963" column="36" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="2929" column="29" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="111" column="37" filename="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" />
      <jump line="147" column="0" filename="$USER_HOME$/Projects/kuze/php/invoice/create-doc.php" />
      <jump line="371" column="25" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="381" column="34" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="383" column="30" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="391" column="35" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="393" column="25" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="395" column="24" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="402" column="43" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="404" column="34" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="406" column="33" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="413" column="34" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="433" column="32" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="437" column="8" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="439" column="32" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="445" column="8" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="450" column="32" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="459" column="12" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="460" column="36" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="465" column="10" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="466" column="34" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="470" column="10" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="471" column="34" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="21" column="51" filename="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" />
      <jump line="149" column="40" filename="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" />
      <jump line="137" column="0" filename="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" />
      <jump line="8" column="24" filename="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" />
      <jump line="9" column="26" filename="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" />
      <jump line="5570" column="21" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="0" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
    </jumps>
    <registers>
      <register name="&quot;" type="2">
        <text encoding="base64">PD9waHAgaW5jbHVkZSAnYnVzaW5lc3MtYXBwLXYxMS5qcycKPz4K</text>
      </register>
      <register name="-" type="4">
        <text>/receipt</text>
      </register>
      <register name="/" type="4">
        <text>\cUser</text>
      </register>
      <register name="0" type="2">
        <text encoding="base64">Ly8gdjExIC0gMjMgbWFyY2ggMjAxNwovL0RlZmluZSBhbiBhbmd1bGFyIG1vZHVsZSBmb3Igb3VyIGFwcAoKdmFyIGt1emVJc0NhbGVuZGFyRHJhZ2dibGU7Cmt1emVJc0NhbGVuZGFyRHJhZ2dibGUgPSB0cnVlOwoKLy8gYW5ndWxhciBtb2R1bGVzCi8vJGFuZ3VsYXJNb2R1bGVzPVsnbmdSb3V0ZScsJ3VpLmJvb3RzdHJhcCcsJ3VpLmdyaWQnXTsKJGFuZ3VsYXJNb2R1bGVzID0gWyduZ1JvdXRlJywgJ3VpLmJvb3RzdHJhcCcsICd1aS5ncmlkJywgJ2J1aWxkZXInLCAnYnVpbGRlci5jb21wb25lbnRzJywgJ3ZhbGlkYXRvci5ydWxlcycsICd1aS5jYWxlbmRhcicsICdjaGVja2xpc3QtbW9kZWwnLCAndWkuYm9vdHN0cmFwLmRhdGV0aW1lcGlja2VyJywgJ2FuZ3Vjb21wbGV0ZS1hbHQnLCAnbXVsdGlwbGVTZWxlY3QnLCdhbmd1bGFySW5saW5lRWRpdCcsJ3RleHRBbmd1bGFyJywnbmdDc3YnXTsKCnZhciBkYXlOYW1lcyA9IFsn16jXkNep15XXnycsICfXqdeg15knLCAn16nXnNeZ16nXmScsICfXqNeR15nXoteZJywgJ9eX157Xmdep15knLCAn16nXmdep15knLCAn16nXkdeqJ107CnZhciBtb250aE5hbWVzID0gWyLXmdeg15XXkNeoIiwgItek15HXqNeV15DXqCIsICLXnteo16UiLCAi15DXpNeo15nXnCIsICLXnteQ15kiLCAi15nXldeg15kiLAogICAgIteZ15XXnNeZIiwgIteQ15XXkteV16HXmCIsICLXodek15jXnteR16giLCAi15DXlden15jXldeR16giLCAi16DXldeR157XkdeoIiwgIteT16bXnteR16giCl07Cgp2YXIgbG9naW5OZXh0U2NyZWVuPSIiOwoKKGZ1bmN0aW9uKCl7RGF0ZS5zaG9ydE1vbnRocz1bIkphbiIsIkZlYiIsIk1hciIsIkFwciIsIk1heSIsIkp1biIsIkp1bCIsIkF1ZyIsIlNlcCIsIk9jdCIsIk5vdiIsIkRlYyJdLERhdGUubG9uZ01vbnRocz1bIkphbnVhcnkiLCJGZWJydWFyeSIsIk1hcmNoIiwiQXByaWwiLCJNYXkiLCJKdW5lIiwiSnVseSIsIkF1Z3VzdCIsIlNlcHRlbWJlciIsIk9jdG9iZXIiLCJOb3ZlbWJlciIsIkRlY2VtYmVyIl0sRGF0ZS5zaG9ydERheXM9WyJTdW4iLCJNb24iLCJUdWUiLCJXZWQiLCJUaHUiLCJGcmkiLCJTYXQiXSxEYXRlLmxvbmdEYXlzPVsiU3VuZGF5IiwiTW9uZGF5IiwiVHVlc2RheSIsIldlZG5lc2RheSIsIlRodXJzZGF5IiwiRnJpZGF5IiwiU2F0dXJkYXkiXTt2YXIgdD17ZDpmdW5jdGlvbigpe3JldHVybih0aGlzLmdldERhdGUoKTwxMD8iMCI6IiIpK3RoaXMuZ2V0RGF0ZSgpfSxEOmZ1bmN0aW9uKCl7cmV0dXJuIERhdGUuc2hvcnREYXlzW3RoaXMuZ2V0RGF5KCldfSxqOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZ2V0RGF0ZSgpfSxsOmZ1bmN0aW9uKCl7cmV0dXJuIERhdGUubG9uZ0RheXNbdGhpcy5nZXREYXkoKV19LE46ZnVuY3Rpb24oKXtyZXR1cm4gMD09dGhpcy5nZXREYXkoKT83OnRoaXMuZ2V0RGF5KCl9LFM6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5nZXREYXRlKCklMTA9PTEmJjExIT10aGlzLmdldERhdGUoKT8ic3QiOnRoaXMuZ2V0RGF0ZSgpJTEwPT0yJiYxMiE9dGhpcy5nZXREYXRlKCk/Im5kIjp0aGlzLmdldERhdGUoKSUxMD09MyYmMTMhPXRoaXMuZ2V0RGF0ZSgpPyJyZCI6InRoIn0sdzpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldERheSgpfSx6OmZ1bmN0aW9uKCl7dmFyIHQ9bmV3IERhdGUodGhpcy5nZXRGdWxsWWVhcigpLDAsMSk7cmV0dXJuIE1hdGguY2VpbCgodGhpcy10KS84NjRlNSl9LFc6ZnVuY3Rpb24oKXt2YXIgdD1uZXcgRGF0ZSh0aGlzLnZhbHVlT2YoKSksZT0odGhpcy5nZXREYXkoKSs2KSU3O3Quc2V0RGF0ZSh0LmdldERhdGUoKS1lKzMpO3ZhciBuPXQudmFsdWVPZigpO3JldHVybiB0LnNldE1vbnRoKDAsMSksNCE9PXQuZ2V0RGF5KCkmJnQuc2V0TW9udGgoMCwxKyg0LXQuZ2V0RGF5KCkrNyklNyksMStNYXRoLmNlaWwoKG4tdCkvNjA0OGU1KX0sRjpmdW5jdGlvbigpe3JldHVybiBEYXRlLmxvbmdNb250aHNbdGhpcy5nZXRNb250aCgpXX0sbTpmdW5jdGlvbigpe3JldHVybih0aGlzLmdldE1vbnRoKCk8OT8iMCI6IiIpKyh0aGlzLmdldE1vbnRoKCkrMSl9LE06ZnVuY3Rpb24oKXtyZXR1cm4gRGF0ZS5zaG9ydE1vbnRoc1t0aGlzLmdldE1vbnRoKCldfSxuOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZ2V0TW9udGgoKSsxfSx0OmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5nZXRGdWxsWWVhcigpLGU9dGhpcy5nZXRNb250aCgpKzE7cmV0dXJuIDEyPT09ZSYmKHQ9dCsrLGU9MCksbmV3IERhdGUodCxlLDApLmdldERhdGUoKX0sTDpmdW5jdGlvbigpe3ZhciB0PXRoaXMuZ2V0RnVsbFllYXIoKTtyZXR1cm4gdCU0MDA9PTB8fHQlMTAwIT0wJiZ0JTQ9PTB9LG86ZnVuY3Rpb24oKXt2YXIgdD1uZXcgRGF0ZSh0aGlzLnZhbHVlT2YoKSk7cmV0dXJuIHQuc2V0RGF0ZSh0LmdldERhdGUoKS0odGhpcy5nZXREYXkoKSs2KSU3KzMpLHQuZ2V0RnVsbFllYXIoKX0sWTpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldEZ1bGxZZWFyKCl9LHk6ZnVuY3Rpb24oKXtyZXR1cm4oIiIrdGhpcy5nZXRGdWxsWWVhcigpKS5zdWJzdHIoMil9LGE6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5nZXRIb3VycygpPDEyPyJhbSI6InBtIn0sQTpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldEhvdXJzKCk8MTI/IkFNIjoiUE0ifSxCOmZ1bmN0aW9uKCl7cmV0dXJuIE1hdGguZmxvb3IoMWUzKigodGhpcy5nZXRVVENIb3VycygpKzEpJTI0K3RoaXMuZ2V0VVRDTWludXRlcygpLzYwK3RoaXMuZ2V0VVRDU2Vjb25kcygpLzM2MDApLzI0KX0sZzpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldEhvdXJzKCklMTJ8fDEyfSxHOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZ2V0SG91cnMoKX0saDpmdW5jdGlvbigpe3JldHVybigodGhpcy5nZXRIb3VycygpJTEyfHwxMik8MTA/IjAiOiIiKSsodGhpcy5nZXRIb3VycygpJTEyfHwxMil9LEg6ZnVuY3Rpb24oKXtyZXR1cm4odGhpcy5nZXRIb3VycygpPDEwPyIwIjoiIikrdGhpcy5nZXRIb3VycygpfSxpOmZ1bmN0aW9uKCl7cmV0dXJuKHRoaXMuZ2V0TWludXRlcygpPDEwPyIwIjoiIikrdGhpcy5nZXRNaW51dGVzKCl9LHM6ZnVuY3Rpb24oKXtyZXR1cm4odGhpcy5nZXRTZWNvbmRzKCk8MTA/IjAiOiIiKSt0aGlzLmdldFNlY29uZHMoKX0sdTpmdW5jdGlvbigpe3ZhciB0PXRoaXMuZ2V0TWlsbGlzZWNvbmRzKCk7cmV0dXJuKDEwPnQ/IjAwIjoxMDA+dD8iMCI6IiIpK3R9LGU6ZnVuY3Rpb24oKXtyZXR1cm4vXCgoLiopXCkvLmV4ZWMoKG5ldyBEYXRlKS50b1N0cmluZygpKVsxXX0sSTpmdW5jdGlvbigpe2Zvcih2YXIgdD1udWxsLGU9MDsxMj5lOysrZSl7dmFyIG49bmV3IERhdGUodGhpcy5nZXRGdWxsWWVhcigpLGUsMSksaT1uLmdldFRpbWV6b25lT2Zmc2V0KCk7aWYobnVsbD09PXQpdD1pO2Vsc2V7aWYodD5pKXt0PWk7YnJlYWt9aWYoaT50KWJyZWFrfX1yZXR1cm4gdGhpcy5nZXRUaW1lem9uZU9mZnNldCgpPT10fDB9LE86ZnVuY3Rpb24oKXtyZXR1cm4oLXRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKTwwPyItIjoiKyIpKyhNYXRoLmFicyh0aGlzLmdldFRpbWV6b25lT2Zmc2V0KCkvNjApPDEwPyIwIjoiIikrTWF0aC5mbG9vcihNYXRoLmFicyh0aGlzLmdldFRpbWV6b25lT2Zmc2V0KCkvNjApKSsoMD09TWF0aC5hYnModGhpcy5nZXRUaW1lem9uZU9mZnNldCgpJTYwKT8iMDAiOihNYXRoLmFicyh0aGlzLmdldFRpbWV6b25lT2Zmc2V0KCklNjApPDEwPyIwIjoiIikrTWF0aC5hYnModGhpcy5nZXRUaW1lem9uZU9mZnNldCgpJTYwKSl9LFA6ZnVuY3Rpb24oKXtyZXR1cm4oLXRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKTwwPyItIjoiKyIpKyhNYXRoLmFicyh0aGlzLmdldFRpbWV6b25lT2Zmc2V0KCkvNjApPDEwPyIwIjoiIikrTWF0aC5mbG9vcihNYXRoLmFicyh0aGlzLmdldFRpbWV6b25lT2Zmc2V0KCkvNjApKSsiOiIrKDA9PU1hdGguYWJzKHRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKSU2MCk/IjAwIjooTWF0aC5hYnModGhpcy5nZXRUaW1lem9uZU9mZnNldCgpJTYwKTwxMD8iMCI6IiIpK01hdGguYWJzKHRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKSU2MCkpfSxUOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMudG9UaW1lU3RyaW5nKCkucmVwbGFjZSgvXi4rIFwoPyhbXlwpXSspXCk/JC8sIiQxIil9LFo6ZnVuY3Rpb24oKXtyZXR1cm4gNjAqLXRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKX0sYzpmdW5jdGlvbigpe3JldHVybiB0aGlzLmZvcm1hdCgiWS1tLWRcXFRIOmk6c1AiKX0scjpmdW5jdGlvbigpe3JldHVybiB0aGlzLnRvU3RyaW5nKCl9LFU6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5nZXRUaW1lKCkvMWUzfX07RGF0ZS5wcm90b3R5cGUuZm9ybWF0PWZ1bmN0aW9uKGUpe3ZhciBuPXRoaXM7cmV0dXJuIGUucmVwbGFjZSgvKFxcPykoLikvZyxmdW5jdGlvbihlLGkscil7cmV0dXJuIiI9PT1pJiZ0W3JdP3Rbcl0uY2FsbChuKTpyfSl9fSkuY2FsbCh0aGlzKTsKCmZ1bmN0aW9uIGdvdG9DbGllbnRQYWdlKGJ1c2luZXNzX3VzZXJfaWQpCnsKICB3aW5kb3cubG9jYXRpb24uaHJlZj0nLyMvYnVzaW5lc3NfY2xpZW50cy8nICsgYnVzaW5lc3NfdXNlcl9pZDsKfQpmdW5jdGlvbiBnb3RvSW5zdHJ1Y3RvclBhZ2UoYnVzaW5lc3NfdXNlcl9pZCkKewogIHdpbmRvdy5sb2NhdGlvbi5ocmVmPScvIy9idXNpbmVzc19pbnN0cnVjdG9ycy8nICsgYnVzaW5lc3NfdXNlcl9pZDsKfQoKZnVuY3Rpb24gZ290b0V2ZW50UGFnZSh0aGVldmVudCkKewogIGxvZ0RlYnVnKCJnb3RvRXZlbnRQYWdlICIrdGhlZXZlbnQpOwogIGlmICh0aGVldmVudC5pc19jbGFzcz09MSkKICB7CiAgICB3aW5kb3cubG9jYXRpb24uaHJlZj0nLyMvZXZlbnRfY2xhc3MvJyArIHRoZWV2ZW50LmV2ZW50X2lkOwogIH0KICBlbHNlCiAgewogICAgd2luZG93LmxvY2F0aW9uLmhyZWY9Jy8jL2V2ZW50LycgKyB0aGVldmVudC5ldmVudF9pZDsKICB9Cn0KCmZ1bmN0aW9uIGdvdG9Mb2NhdGlvblBhZ2UobG9jYXRpb25faWQpCnsKICBsb2dEZWJ1ZygiZ290b0xvY2F0aW9uUGFnZSAiK2xvY2F0aW9uX2lkKTsKICB3aW5kb3cubG9jYXRpb24uaHJlZj0nLyMvYnVzaW5lc3NfbG9jYXRpb25zLycgKyBsb2NhdGlvbl9pZDsKCn0KCmZ1bmN0aW9uIGdvdG9DbGllbnRFZGl0UGFnZSh1c2VyX2lkKQp7CiAgd2luZG93LmxvY2F0aW9uLmhyZWY9Jy8jL2J1c2luZXNzX2NsaWVudHMvJyArIHVzZXJfaWQgKyAnL2VkaXQnOwp9CgpmdW5jdGlvbiBnb3RvQmFjaygpCnsKICB3aW5kb3cuaGlzdG9yeS5iYWNrKCk7Cn0KCmZ1bmN0aW9uIHNob3dFdmVudFBvcHVwKHNlbGVjdGVkRXZlbnQsICR1aWJNb2RhbCkKewogIC8vIHRoaXMgZnVuY3Rpb24gdXNlZCB0byBicmluZyBhIHBvcHVwCiAgLy8gbm93IGl0IGdvZXMgdG8gdGhlIGV2ZW50IHBhZ2UKICBnb3RvRXZlbnRQYWdlKHNlbGVjdGVkRXZlbnQpOwoKICAvLyBpZiAoc2VsZWN0ZWRFdmVudC5pc19yZXBlYXRpbmcgPT0gMSkgewogIC8vICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAvLyAgICAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgLy8gICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9jbGFzc19zaW5nbGUucGhwJywKICAvLyAgICAgICAgIGNvbnRyb2xsZXI6ICdldmVudFJlY3VycmluZ0RldGFpbHNCdXNpbmVzc0NhbGVuZGFyTW9kYWxDb250cm9sbGVyJywKICAvLyAgICAgICAgIC8vIHNpemU6IHNpemUsCiAgLy8gICAgICAgICByZXNvbHZlOiB7CiAgLy8gICAgICAgICAgICAgc2VsZWN0ZWRFdmVudDogZnVuY3Rpb24oKSB7CiAgLy8gICAgICAgICAgICAgICAgIHJldHVybiBzZWxlY3RlZEV2ZW50OwogIC8vICAgICAgICAgICAgIH0KICAvLyAgICAgICAgIH0KICAvLyAgICAgfSk7CiAgLy8gfSBlbHNlIHsKICAvLyAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgLy8gICAgICAgICBhbmltYXRpb246IGZhbHNlLAogIC8vICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfZXZlbnRfc2luZ2xlLnBocCcsCiAgLy8gICAgICAgICBjb250cm9sbGVyOiAnZXZlbnREZXRhaWxzQnVzaW5lc3NDYWxlbmRhck1vZGFsQ29udHJvbGxlcicsCiAgLy8gICAgICAgICAvLyBzaXplOiBzaXplLAogIC8vICAgICAgICAgcmVzb2x2ZTogewogIC8vICAgICAgICAgICAgIHNlbGVjdGVkRXZlbnQ6IGZ1bmN0aW9uKCkgewogIC8vICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZWN0ZWRFdmVudDsKICAvLyAgICAgICAgICAgICB9CiAgLy8gICAgICAgICB9CiAgLy8gICAgIH0pOwogIC8vIH0KfQpmdW5jdGlvbiB1cGRhdGVHbG9iYWxMYW5ndWFnZSgkc2NvcGUsICRuZXdsYW5nKSB7CgogICAgLy8JdmFyIGdMYW5nPWdMYW5nQmFzZVtnTGFuZ0N1cnJdOwogICAgJGdMYW5nID0gZ0xhbmdCYXNlWyRuZXdsYW5nXTsKICAgIC8vIGxvZ0RlYnVnKCJnTGFuZ0Jhc2VbJG5ld2xhbmddWyd0aXRsZTEnXT0iICsgZ0xhbmdCYXNlWyRuZXdsYW5nXVsndGl0bGUxJ10pOwogICAgLy8gbG9nRGVidWcoImxhbmd1Z2FnZToiICsgJGdMYW5nWydsYW5ndWFnZSddKTsKICAgIC8vCWxvZ0RlYnVnKCJsYW5ndWdhZ2UgZGlyOiAiKyRnTGFuZ1snZGlyJ10pOwogICAgLy8JbG9nRGVidWcoImNoYW5naW5nIGxhbmd1YWdlIHRvICIrJG5ld2xhbmcpCiAgICAkc2NvcGUuc3BDbGFzcyA9ICRnTGFuZ1snY2xhc3MnXTsKICAgIC8vCWxvZ0RlYnVnKCJpcyBhcnJheT8gIithbmd1bGFyLmlzQXJyYXkoJGdMYW5nKSk7CiAgICAvLwlsb2dEZWJ1ZygiJGdMYW5nWydkaXInXT0iKyRnTGFuZ1snZGlyJ10pOwogICAgLy8JbG9nRGVidWcoIiRnTGFuZ1sndGl0bGUxJ109IiskZ0xhbmdbJ3RpdGxlMSddKTsKICAgICRzY29wZS5sYW5nZmlsZSA9ICRnTGFuZzsKICAgIC8vIGxvZ0RlYnVnKCJpcyBhcnJheT8gIiArIGFuZ3VsYXIuaXNBcnJheSgkc2NvcGUubGFuZ2ZpbGUpKTsKICAgIC8vIGxvZ0RlYnVnKCIkc2NvcGUubGFuZ2ZpbGU9IiArICRzY29wZS5sYW5nZmlsZSk7CiAgICAvLyBsb2dEZWJ1ZygiJHNjb3BlLmxhbmdmaWxlWyd0aXRsZTEnXT0iICsgJHNjb3BlLmxhbmdmaWxlWyd0aXRsZTEnXSk7CgogICAgJHNjb3BlLnRlc3RuZXd2YXIgPSAkc2NvcGUubGFuZ2ZpbGVbJ3RpdGxlMSddOwogICAgLy8JJHNjb3BlLm1lc3NhZ2U9JHNjb3BlLmxhbmdmaWxlWyd0aXRsZTEnXTsKfQoKZnVuY3Rpb24gZ2V0UmFuZG9tQ29sb3IoKSB7CiAgICB2YXIgbGV0dGVycyA9ICcwMTIzNDU2Nzg5QUJDREVGJy5zcGxpdCgnJyk7CiAgICB2YXIgY29sb3IgPSAnIyc7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IDY7IGkrKykgewogICAgICAgIGNvbG9yICs9IGxldHRlcnNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTYpXTsKICAgIH0KICAgIHJldHVybiBjb2xvcjsKfQoKZnVuY3Rpb24gZ2V0UmFuZG9tSW50KG1pbiwgbWF4KSB7CiAgICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKG1heCAtIG1pbiArIDEpKSArIG1pbjsKfQoKZnVuY3Rpb24gY2FsY190ZW1wX2xpbWl0X2lkKCkgewogICAgdmFyIGQgPSBuZXcgRGF0ZSgpOwogICAgdmFyIHJhbmRvbWxpbWl0ID0gZC5nZXRUaW1lKCk7CiAgICBsb2dEZWJ1ZygiY2FsY190ZW1wX2xpbWl0X2lkPSIgKyByYW5kb21saW1pdCk7CiAgICByZXR1cm4gcmFuZG9tbGltaXQ7Cn0KCnZhciAkZ0xvZ0xldmVsID0gJ2RlYnVnJzsKCi8vIHN0YXJ0aW5nCmxvZ0RlYnVnKCJtYWluICRnTG9nTGV2ZWw9IiArICRnTG9nTGV2ZWwpOwpsb2dEZWJ1ZygiaW5pdGlhbGl6ZSBhbmd1bGFyIik7CmxvZ0RlYnVnKCJpbml0aWFsaXppbmcgbW9kdWxlcyAiICsgJGFuZ3VsYXJNb2R1bGVzKTsKCnZhciBrdXplQXBwID0gYW5ndWxhci5tb2R1bGUoJ2t1emVBcHAnLCAkYW5ndWxhck1vZHVsZXMpCgovLyRyb290U2NvcGUuc3BDbGFzcyA9ICdyaWdodCc7Cmt1emVSdW4gPSBmdW5jdGlvbigpIHsKCn0Ka3V6ZUFwcC5ydW4oWwogICAgJyRidWlsZGVyJywKICAgIGZ1bmN0aW9uKCRidWlsZGVyKSB7CiAgICAgICAgLy8gbG9nRGVidWcoImluc2lkZSBrdXplQXBwLnJ1biIpOwogICAgICAgICRidWlsZGVyLnJlZ2lzdGVyQ29tcG9uZW50KCdzYW1wbGVJbnB1dCcsIHsKICAgICAgICAgICAgZ3JvdXA6ICdmcm9tIGh0bWwnLAogICAgICAgICAgICBsYWJlbDogJ1NhbXBsZScsCiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnRnJvbSBodG1sIHRlbXBsYXRlJywKICAgICAgICAgICAgcGxhY2Vob2xkZXI6ICdwbGFjZWhvbGRlcicsCiAgICAgICAgICAgIHJlcXVpcmVkOiBmYWxzZSwKICAgICAgICAgICAgdmFsaWRhdGlvbk9wdGlvbnM6IFt7CiAgICAgICAgICAgICAgICBsYWJlbDogJ25vbmUnLAogICAgICAgICAgICAgICAgcnVsZTogJy8uKi8nCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgIGxhYmVsOiAnbnVtYmVyJywKICAgICAgICAgICAgICAgIHJ1bGU6ICdbbnVtYmVyXScKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgbGFiZWw6ICdlbWFpbCcsCiAgICAgICAgICAgICAgICBydWxlOiAnW2VtYWlsXScKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgbGFiZWw6ICd1cmwnLAogICAgICAgICAgICAgICAgcnVsZTogJ1t1cmxdJwogICAgICAgICAgICB9XSwKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYW5ndWxhci1mb3JtLWJ1aWxkZXIvZXhhbXBsZS90ZW1wbGF0ZS5odG1sJywKICAgICAgICAgICAgcG9wb3ZlclRlbXBsYXRlVXJsOiAnL2FuZ3VsYXItZm9ybS1idWlsZGVyL2V4YW1wbGUvcG9wb3ZlclRlbXBsYXRlLmh0bWwnCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuICRidWlsZGVyLnJlZ2lzdGVyQ29tcG9uZW50KCduYW1lJywgewogICAgICAgICAgICBncm91cDogJ0RlZmF1bHQnLAogICAgICAgICAgICBsYWJlbDogJ05hbWUnLAogICAgICAgICAgICByZXF1aXJlZDogZmFsc2UsCiAgICAgICAgICAgIGFycmF5VG9UZXh0OiB0cnVlLAogICAgICAgICAgICB0ZW1wbGF0ZTogIjxkaXYgY2xhc3M9XCJmb3JtLWdyb3VwXCI+XG4gICAgPGxhYmVsIGZvcj1cInt7Zm9ybU5hbWUraW5kZXh9fVwiIGNsYXNzPVwiY29sLW1kLTQgY29udHJvbC1sYWJlbFwiIG5nLWNsYXNzPVwieydmYi1yZXF1aXJlZCc6cmVxdWlyZWR9XCI+e3tsYWJlbH19PC9sYWJlbD5cbiAgICA8ZGl2IGNsYXNzPVwiY29sLW1kLThcIj5cbiAgICAgICAgPGlucHV0IHR5cGU9J2hpZGRlbicgbmctbW9kZWw9XCJpbnB1dFRleHRcIiB2YWxpZGF0b3ItcmVxdWlyZWQ9XCJ7e3JlcXVpcmVkfX1cIiB2YWxpZGF0b3ItZ3JvdXA9XCJ7e2Zvcm1OYW1lfX1cIi8+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJjb2wtc20tNlwiIHN0eWxlPVwicGFkZGluZy1sZWZ0OiAwO1wiPlxuICAgICAgICAgICAgPGlucHV0IHR5cGU9XCJ0ZXh0XCJcbiAgICAgICAgICAgICAgICBuZy1tb2RlbD1cImlucHV0QXJyYXlbMF1cIlxuICAgICAgICAgICAgICAgIGNsYXNzPVwiZm9ybS1jb250cm9sXCIgaWQ9XCJ7e2Zvcm1OYW1lK2luZGV4fX0tMFwiLz5cbiAgICAgICAgICAgIDxwIGNsYXNzPSdoZWxwLWJsb2NrJz5GaXJzdCBuYW1lPC9wPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImNvbC1zbS02XCIgc3R5bGU9XCJwYWRkaW5nLWxlZnQ6IDA7XCI+XG4gICAgICAgICAgICA8aW5wdXQgdHlwZT1cInRleHRcIlxuICAgICAgICAgICAgICAgIG5nLW1vZGVsPVwiaW5wdXRBcnJheVsxXVwiXG4gICAgICAgICAgICAgICAgY2xhc3M9XCJmb3JtLWNvbnRyb2xcIiBpZD1cInt7Zm9ybU5hbWUraW5kZXh9fS0xXCIvPlxuICAgICAgICAgICAgPHAgY2xhc3M9J2hlbHAtYmxvY2snPkxhc3QgbmFtZTwvcD5cbiAgICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG48L2Rpdj4iLAogICAgICAgICAgICBwb3BvdmVyVGVtcGxhdGU6ICI8Zm9ybT5cbiAgICA8ZGl2IGNsYXNzPVwiZm9ybS1ncm91cFwiPlxuICAgICAgICA8bGFiZWwgY2xhc3M9J2NvbnRyb2wtbGFiZWwnPkxhYmVsPC9sYWJlbD5cbiAgICAgICAgPGlucHV0IHR5cGU9J3RleHQnIG5nLW1vZGVsPVwibGFiZWxcIiB2YWxpZGF0b3I9XCJbcmVxdWlyZWRdXCIgY2xhc3M9J2Zvcm0tY29udHJvbCcvPlxuICAgIDwvZGl2PlxuICAgIDxkaXYgY2xhc3M9XCJjaGVja2JveFwiPlxuICAgICAgICA8bGFiZWw+XG4gICAgICAgICAgICA8aW5wdXQgdHlwZT0nY2hlY2tib3gnIG5nLW1vZGVsPVwicmVxdWlyZWRcIiAvPlxuICAgICAgICAgICAgUmVxdWlyZWRcbiAgICAgICAgPC9sYWJlbD5cbiAgICA8L2Rpdj5cblxuICAgIDxoci8+XG4gICAgPGRpdiBjbGFzcz0nZm9ybS1ncm91cCc+XG4gICAgICAgIDxpbnB1dCB0eXBlPSdzdWJtaXQnIG5nLWNsaWNrPVwicG9wb3Zlci5zYXZlKCRldmVudClcIiBjbGFzcz0nYnRuIGJ0bi1wcmltYXJ5JyB2YWx1ZT0nU2F2ZScvPlxuICAgICAgICA8aW5wdXQgdHlwZT0nYnV0dG9uJyBuZy1jbGljaz1cInBvcG92ZXIuY2FuY2VsKCRldmVudClcIiBjbGFzcz0nYnRuIGJ0bi1kZWZhdWx0JyB2YWx1ZT0nQ2FuY2VsJy8+XG4gICAgICAgIDxpbnB1dCB0eXBlPSdidXR0b24nIG5nLWNsaWNrPVwicG9wb3Zlci5yZW1vdmUoJGV2ZW50KVwiIGNsYXNzPSdidG4gYnRuLWRhbmdlcicgdmFsdWU9J0RlbGV0ZScvPlxuICAgIDwvZGl2PlxuPC9mb3JtPiIKICAgICAgICB9KTsKICAgIH0KXSkKCi8vIERFTEVURUQgLSB4ZWRpdGFibGUgc3R1ZmYKLy8ga3V6ZUFwcC5ydW4oZnVuY3Rpb24oZWRpdGFibGVPcHRpb25zLCBlZGl0YWJsZVRoZW1lcykgewovLyAgICAgbG9nRGVidWcoImluaXRpYWxpemluZyB4ZWRpdGFibGUgZWRpdGFibGVPcHRpb25zIik7Ci8vICAgICBlZGl0YWJsZU9wdGlvbnMudGhlbWUgPSAnYnMzJzsgLy8gYm9vdHN0cmFwMyB0aGVtZS4gQ2FuIGJlIGFsc28gJ2JzMicsICdkZWZhdWx0JwovLyAgICAgLy8gZWRpdGFibGVPcHRpb25zLmRlZmF1bHRzLm1vZGUgPSAnaW5saW5lJzsKLy8gICAgIGxvZ0RlYnVnKGVkaXRhYmxlT3B0aW9ucyk7Ci8vICAgICAvLyBlZGl0YWJsZU9wdGlvbnMubW9kZSA9ICdpbmxpbmUnOwovLyAgICAgZWRpdGFibGVUaGVtZXMuYnMzLmlucHV0Q2xhc3MgPSAnaW5wdXQtc20nOwovLyAgICAgZWRpdGFibGVUaGVtZXMuYnMzLmJ1dHRvbnNDbGFzcyA9ICdidG4tc20nOwovLyB9KTsKCi8vIGFmdGVyIGZvcm1zCi8vRGVmaW5lIFJvdXRpbmcgZm9yIGFwcAovL1VyaSAvQWRkTmV3T3JkZXIgLT4gdGVtcGxhdGUgYWRkX29yZGVyLmh0bWwgYW5kIENvbnRyb2xsZXIgQ2xpZW50c0FkZENvbnRyb2xsZXIKLy9VcmkgL1Nob3dPcmRlcnMgLT4gdGVtcGxhdGUgc2hvd19vcmRlcnMuaHRtbCBhbmQgQ29udHJvbGxlciBDbGllbnRzQWRkQ29udHJvbGxlcgprdXplQXBwLmNvbmZpZyhbJyRyb3V0ZVByb3ZpZGVyJywKICAgIGZ1bmN0aW9uKCRyb3V0ZVByb3ZpZGVyKSB7CiAgICAgICAgLy8gbG9nRGVidWcoJHJvdXRlUHJvdmlkZXIpOwogICAgICAgICRyb3V0ZVByb3ZpZGVyLgogICAgICAgIC8vIHdoZW4oJy9jbGllbnRjYXJkJywgewogICAgICAgIC8vICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19jbGllbnRfY2FyZC5odG1sJywKICAgICAgICAvLyAgICAgY29udHJvbGxlcjogJ2NsaWVudENhcmRDb250cm9sbGVyJwogICAgICAgIC8vIH0pLgogICAgICAgIHdoZW4oJy9jb250YWN0JywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdjb250YWN0LnBocCcsCiAgICAgICAgICAgIC8vIGNvbnRyb2xsZXI6ICdlbmRVc2VySG9tZUNvbnRyb2xsZXInCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdjb250YWN0Q29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvZXZlbnRfdHlwZXMnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2V2ZW50X3R5cGVzLmh0bWwnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnRXZlbnRUeXBlc0NvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2V2ZW50X3R5cGVzL2FkZCcsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfZXZlbnRfdHlwZV9hZGQucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0V2ZW50VHlwZU5ld0NvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2V2ZW50X3R5cGVzLzpldmVudF90eXBlX2lkJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19ldmVudF90eXBlX2FkZC5waHAnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnRXZlbnRUeXBlVXBkYXRlQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvaG91cnNfb2Zfd29yaycsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfaG91cnNfb2Zfd29yay5odG1sJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0hvdXJzT2ZXb3JrQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvYnVzaW5lc3NfY2FsZW5kYXInLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2NhbGVuZGFyLmh0bWwnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnQnVzaW5lc3NDYWxlbmRhckNvbnRyb2xsZXInLAogICAgICAgICAgICByZWxvYWRPblNlYXJjaDogZmFsc2UKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvYW5ndWxhci1mb3JtLWJ1aWxkZXInLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2FuZ3VsYXItZm9ybS1idWlsZGVyL2luZGV4Lmh0bWwnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnRGVtb0NvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2J1c2luZXNzX2NsaWVudHMvYWRkJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19jbGllbnRzX2FkZC5odG1sJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0NsaWVudHNBZGRDb250cm9sbGVyJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9idXNpbmVzc19jbGllbnRzJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19jbGllbnRzLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdDbGllbnRzU2hvd0NvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2J1c2luZXNzX2NsaWVudHMvOmJ1c2luZXNzX3VzZXJfaWQnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2NsaWVudF9jYXJkLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdDbGllbnRzU2hvdzFDb250cm9sbGVyJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9idXNpbmVzc19yZXBvcnRzJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19yZXBvcnRzLmh0bWwnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnQnVzaW5lc3NSZXBvcnRzQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvYnVzaW5lc3NfaW5zdHJ1Y3RvcnMnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2luc3RydWN0b3JzLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdJbnN0cnVjdG9yc1Nob3dDb250cm9sbGVyJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9idXNpbmVzc19pbnN0cnVjdG9ycy9hZGQnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2NsaWVudHNfYWRkLmh0bWwnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnSW5zdHJ1Y3RvcnNBZGRDb250cm9sbGVyJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9idXNpbmVzc19sb2NhdGlvbnMnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2xvY2F0aW9ucy5waHAnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnYnVzaW5lc3NfbG9jYXRpb25zJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9idXNpbmVzc19sb2NhdGlvbnMvYWRkJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19sb2NhdGlvbnNfYWRkLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdidXNpbmVzc19sb2NhdGlvbnNfYWRkJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9idXNpbmVzc19sb2NhdGlvbnMvOmxvY2F0aW9uX2lkJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19sb2NhdGlvbnNfYWRkLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdidXNpbmVzc19sb2NhdGlvbnNfdXBkYXRlJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9idXNpbmVzc19pbnN0cnVjdG9ycy86YnVzaW5lc3NfdXNlcl9pZCcsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfaW5zdHJ1Y3Rvcl9jYXJkLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdJbnN0cnVjdG9yU2hvdzFDb250cm9sbGVyJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9ldmVudC86ZXZlbnRfaWQnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2V2ZW50X2NhcmQucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0V2ZW50UGFnZUNvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2V2ZW50X2NsYXNzLzpldmVudF9pZCcsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfZXZlbnRfY2xhc3NfY2FyZC5odG1sJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0V2ZW50Q2xhc3NQYWdlQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvcGFja2FnZXMnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX3BhY2thZ2VzX3Nob3cucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ1BhY2thZ2VzQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvcGFja2FnZXMvYWRkJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19wYWNrYWdlc19jcmVhdGUucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ2J1c2luZXNzX3BhY2thZ2VzX2FkZF9jbnRsJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9wYWNrYWdlcy86cGFja2FnZV9pZCcsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfcGFja2FnZXNfY3JlYXRlLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdidXNpbmVzc19wYWNrYWdlc191cGRhdGVfY250bCcKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvYnVzaW5lc3NfY29uZmlnJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19jb25maWcucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0NvbmZpZ0J1c2luZXNzQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvdXNlcl9jb25maWcnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ3VzZXJfY29uZmlnLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdDb25maWdVc2VyQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvYnVzaW5lc3NfZG9jcycsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfZG9jcy5odG1sJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0J1c2luZXNzRG9jc0NvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignLycsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnaG9tZS5waHAnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnSG9tZUNvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgb3RoZXJ3aXNlKHsKICAgICAgICAgICAgLy8gICAgcmVkaXJlY3RUbzogJy8nCiAgICAgICAgfSk7CiAgICB9Cl0pOwoKa3V6ZUFwcC5mYWN0b3J5KCdzaGFyZWREYXRhJywgZnVuY3Rpb24oKSB7CiAgICB2YXIgc2VsZWN0ZWRFbmRVc2VyID0gbnVsbDsKCiAgICByZXR1cm4gewogICAgICAgIGdldFNlbGVjdGVkRW5kVXNlcjogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIC8vWW91IGNvdWxkIGFsc28gcmV0dXJuIHNwZWNpZmljIGF0dHJpYnV0ZSBvZiB0aGUgZm9ybSBkYXRhIGluc3RlYWQKICAgICAgICAgICAgLy9vZiB0aGUgZW50aXJlIGRhdGEKICAgICAgICAgICAgcmV0dXJuIHNlbGVjdGVkRW5kVXNlcjsKICAgICAgICB9LAogICAgICAgIHNldFNlbGVjdGVkRW5kVXNlcjogZnVuY3Rpb24obmV3U2VsZWN0ZWRFbmRVc2VyKSB7CiAgICAgICAgICAgIC8vWW91IGNvdWxkIGFsc28gc2V0IHNwZWNpZmljIGF0dHJpYnV0ZSBvZiB0aGUgZm9ybSBkYXRhIGluc3RlYWQKICAgICAgICAgICAgc2VsZWN0ZWRFbmRVc2VyID0gbmV3U2VsZWN0ZWRFbmRVc2VyOwogICAgICAgIH0sCiAgICB9Owp9KTsKCmt1emVBcHAuZGlyZWN0aXZlKCdjb252ZXJ0VG9OdW1iZXInLCBmdW5jdGlvbigpIHsKICByZXR1cm4gewogICAgcmVxdWlyZTogJ25nTW9kZWwnLAogICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGVsZW1lbnQsIGF0dHJzLCBuZ01vZGVsKSB7CiAgICAgIG5nTW9kZWwuJHBhcnNlcnMucHVzaChmdW5jdGlvbih2YWwpIHsKICAgICAgICByZXR1cm4gdmFsICE9IG51bGwgPyBwYXJzZUludCh2YWwsIDEwKSA6IG51bGw7CiAgICAgIH0pOwogICAgICBuZ01vZGVsLiRmb3JtYXR0ZXJzLnB1c2goZnVuY3Rpb24odmFsKSB7CiAgICAgICAgcmV0dXJuIHZhbCAhPSBudWxsID8gJycgKyB2YWwgOiBudWxsOwogICAgICB9KTsKICAgIH0KICB9Owp9KTsKCmt1emVBcHAuZGlyZWN0aXZlKCdlbGFzdGljJywgWwogICAgJyR0aW1lb3V0JywKICAgIGZ1bmN0aW9uKCR0aW1lb3V0KSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJywKICAgICAgICAgICAgbGluazogZnVuY3Rpb24oJHNjb3BlLCBlbGVtZW50KSB7CiAgICAgICAgICAgICAgICAkc2NvcGUuaW5pdGlhbEhlaWdodCA9ICRzY29wZS5pbml0aWFsSGVpZ2h0IHx8IGVsZW1lbnRbMF0uc3R5bGUuaGVpZ2h0OwogICAgICAgICAgICAgICAgdmFyIHJlc2l6ZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIGVsZW1lbnRbMF0uc3R5bGUuaGVpZ2h0ID0gJHNjb3BlLmluaXRpYWxIZWlnaHQ7CiAgICAgICAgICAgICAgICAgICAgZWxlbWVudFswXS5zdHlsZS5oZWlnaHQgPSAiIiArIGVsZW1lbnRbMF0uc2Nyb2xsSGVpZ2h0ICsgInB4IjsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBlbGVtZW50Lm9uKCJpbnB1dCBjaGFuZ2UiLCByZXNpemUpOwogICAgICAgICAgICAgICAgLy8gZWxlbWVudC5vbigiaW5wdXQgY2hhbmdlIiwgcmVzaXplKTsKICAgICAgICAgICAgICAgICR0aW1lb3V0KHJlc2l6ZSwgMCk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgfQpdKTsKCmt1emVBcHAuc2VydmljZSgnc2hhcmVkUHJvcGVydGllcycsIGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgc2VsZWN0ZWRfdXNlciA9IG51bGw7CiAgICAgICAgdmFyIGNhbGVuZGFyX2RhdGUgPSBudWxsOwogICAgICAgIHZhciBldmVudF9yZXNjaGVkdWxlID0gbnVsbDsKICAgICAgICB2YXIgc2VsZWN0ZWRfaW5zdHJ1Y3RvciA9IDA7CiAgICAgICAgdmFyIGV2ZW50X3R5cGVfZm9yX3N1Z2dlc3Rpb25zID0gbnVsbDsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBnZXRfc2VsZWN0ZWRfaW5zdHJ1Y3RvcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGVjdGVkX2luc3RydWN0b3I7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNldF9zZWxlY3RlZF9pbnN0cnVjdG9yOiBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgICAgICAgICAgc2VsZWN0ZWRfaW5zdHJ1Y3RvciA9IHZhbHVlOwogICAgICAgICAgICB9LAogICAgICAgICAgICBnZXRfc2VsZWN0ZWRfdXNlcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGVjdGVkX3VzZXI7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNldF9zZWxlY3RlZF91c2VyOiBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgICAgICAgICAgc2VsZWN0ZWRfdXNlciA9IHZhbHVlOwogICAgICAgICAgICB9LAogICAgICAgICAgICBzZXRfZXZlbnRfcmVzY2hlZHVsZTogZnVuY3Rpb24odmFsdWUpIHsKICAgICAgICAgICAgICAgIGV2ZW50X3Jlc2NoZWR1bGUgPSB2YWx1ZTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZ2V0X2V2ZW50X3Jlc2NoZWR1bGU6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBldmVudF9yZXNjaGVkdWxlOwogICAgICAgICAgICB9LAogICAgICAgICAgICBnZXRfY2FsZW5kYXJfZGF0ZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGNhbGVuZGFyX2RhdGU7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNldF9jYWxlbmRhcl9kYXRlOiBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgICAgICAgICAgY2FsZW5kYXJfZGF0ZSA9IHZhbHVlOwogICAgICAgICAgICB9LAogICAgICAgICAgICBnZXRfZXZlbnRfdHlwZV9mb3Jfc3VnZ2VzdGlvbnM6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBldmVudF90eXBlX2Zvcl9zdWdnZXN0aW9uczsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2V0X2V2ZW50X3R5cGVfZm9yX3N1Z2dlc3Rpb25zOiBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgICAgICAgICAgLy8gbG9nRGVidWcoInNldF9ldmVudF90eXBlX2Zvcl9zdWdnZXN0aW9ucz0iK3ZhbHVlKTsKICAgICAgICAgICAgICAgIGV2ZW50X3R5cGVfZm9yX3N1Z2dlc3Rpb25zID0gdmFsdWU7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ21lbnVDb250cm9sbGVyJywgWyckc2NvcGUnLCAnJGxvY2F0aW9uJywgZnVuY3Rpb24oJHNjb3BlLCAkbG9jYXRpb24pIHsKICAgIHJldHVybiB0cnVlOwogICAgbG9nRGVidWcoIiRzY29wZS5pc0N1cnJlbnRQYXRoPSIgKyAkc2NvcGUuaXNDdXJyZW50UGF0aCk7CiAgICAkc2NvcGUuaXNDdXJyZW50UGF0aCA9IGZ1bmN0aW9uKHBhdGgpIHsKICAgICAgICByZXR1cm4gJGxvY2F0aW9uLnBhdGgoKSA9PSBwYXRoOwogICAgfTsKfV0pOwoKCgprdXplQXBwLmNvbnRyb2xsZXIoJ0J1c2luZXNzUmVwb3J0c0NvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkbG9jYXRpb24sJHJvdXRlUGFyYW1zKQp7CgogIGxvZ0RlYnVnKCJjb250cm9sbGVyOiBCdXNpbmVzc1JlcG9ydHNDb250cm9sbGVyIik7CgogICRzY29wZS5vcmRlckJ5RmllbGQgPSAnc3RhcnRfZXBvY2gnOwogICRzY29wZS5yZXZlcnNlU29ydD10cnVlOwogICRzY29wZS5ldmVudE1vZGVsPXRydWU7CgogIGdldEJ1c2luZXNzTG9jYXRpb25zKCRodHRwLCRzY29wZSwnYnVzaW5lc3NfbG9jYXRpb25zJyk7CiAgZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzKCRodHRwLCRzY29wZSwnZXZlbnRfdHlwZXMnKTsKICBnZXRBbGxJbnN0cnVjdG9ycygkaHR0cCwkc2NvcGUsJ2luc3RydWN0b3JzJyk7CiAgZ2V0QWxsQ2xpZW50c0FuZEFyY2hpdmUoJGh0dHAsJHNjb3BlLCdjbGllbnRzJyk7CiAgJHNjb3BlLnN0YXR1c2VzID0gWyB7InN0YXR1c19pZCI6IjAiLCJzdGF0dXNfbmFtZSI6Itek16rXldeXIn0sIHsic3RhdHVzX2lkIjoiMSIsInN0YXR1c19uYW1lIjoi16HXkteV16gifV07CiAgJHNjb3BlLmNhbmNlbGxhdGlvbnMgPSBbIHsiaXNfY2FuY2VsZWQiOiIwIiwiY2FuY2VsbGF0aW9uX25hbWUiOiLXnNeQINeR15XXmNecIn0seyJpc19jYW5jZWxlZCI6IjEiLCJjYW5jZWxsYXRpb25fbmFtZSI6IteR15XXmNecIn1dOwogICRzY29wZS5tb250aHMgPSBbIHsibW9udGgiOiIxIn0seyJtb250aCI6IjIifSx7Im1vbnRoIjoiMyJ9LHsibW9udGgiOiI0In0seyJtb250aCI6IjUifSx7Im1vbnRoIjoiNiJ9LHsibW9udGgiOiI3In0seyJtb250aCI6IjgifSx7Im1vbnRoIjoiOSJ9LHsibW9udGgiOiIxMCJ9LHsibW9udGgiOiIxMSJ9LHsibW9udGgiOiIxMiJ9XTsKICAkc2NvcGUueWVhcnMgPSBbIHsieWVhciI6IjIwMTYifSx7InllYXIiOiIyMDE3In1dOwogICRzY29wZS5wZXJpb2RzID0gWwogICAgICB7InBlcmlvZF9uYW1lIjoi15TXmdeh15jXldeo15kiLCAicGVyaW9kX3NpZ24iOiItMSJ9LAogICAgICB7InBlcmlvZF9uYW1lIjoi15TXmdeV150iLCAicGVyaW9kX3NpZ24iOiIwIn0sCiAgICAgIHsicGVyaW9kX25hbWUiOiLXoteq15nXk9eZIiwgInBlcmlvZF9zaWduIjoiMSJ9LAogICAgXQoKICAkc2NvcGUuY3N2X2NvbHVtbnNfb3JkZXIgPSBbJ2V2ZW50X3R5cGVfbmFtZScsICdzdGFydF90aW1lJywgJ2V2ZW50X3VzZXJfY2xpZW50cycsICdpbnN0cnVjdG9yX25hbWUnLCAnaXNfY2FuY2VsZWQnLCAnaXNfY29tcGxldGVkJywgJ2FjdHVhbF9wcmljZScsICdwYXJ0aWNpcGF0ZWQnXTsKICAkc2NvcGUuY3N2X2NvbHVtbnNfaGVhZGVyID0gWyfXodeV15Ig157XpNeS16knLCAn16rXkNeo15nXmiDXldep16LXlCcsICfXntep16rXqtek15nXnScsICfXnteT16jXmdeaJywn157XkdeV15jXnCcsICfXodeS15XXqCcsICfXnteX15nXqCcsICfXntep16rXqtek15nXnSddOwoKCgogICRzY29wZS5nb3RvQ2xpZW50UGFnZT0gZnVuY3Rpb24gKGJ1c2luZXNzVXNlcmlkKSB7CiAgICBnb3RvQ2xpZW50UGFnZShidXNpbmVzc1VzZXJpZCk7CiAgfQoKICBmdW5jdGlvbiBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSh4LHZhbHVlKXsKICAgIGlmICggeCAhPSB1bmRlZmluZWQgKXsKICAgICAgdmFyIHgxID0gbmV3IEFycmF5KCk7CiAgICAgIGZvciAoaSA9IDA7IGkgPCB4Lmxlbmd0aDsgaSsrKXsKICAgICAgICB4MVtpXSA9IHhbaV1bdmFsdWVdOwogICAgICB9CiAgICAgIHgxID0geDEuam9pbigpOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgcmV0dXJuIHgxOwogIH0KCiAgJHNjb3BlLnJlcG9ydF9pc19sb2FkaW5nID0gZmFsc2U7CgogICRzY29wZS5ldmVudHNSZXBvcnQgPSBmdW5jdGlvbigpewogICAgbG9nRGVidWcoImV2ZW50c1JlcG9ydCIpOwoKICAgICRzY29wZS5zaG93QWdnID0gKCRzY29wZS5ldmVudFR5cGVNb2RlbCkgfHwKICAgICAoJHNjb3BlLmluc3RydWN0b3JNb2RlbCkgfHwgKCRzY29wZS5tb250aE1vZGVsKSB8fCAoJHNjb3BlLmNsaWVudHNNb2RlbCkgfHwgKCRzY29wZS55ZWFyTW9kZWwpIDsKCiAgICBldmVudF90eXBlX2lkX2ZpbHRlciA9IGxpc3RfdG9fc3RyaW5nX2J5X3ZhbHVlKCRzY29wZS5zZWxlY3RlZEV2ZW50VHlwZUZpbHRlciwgImV2ZW50X3R5cGVfaWQiICk7CiAgICBpbnN0cnVjdG9yX2lkX2ZpbHRlciA9IGxpc3RfdG9fc3RyaW5nX2J5X3ZhbHVlKCRzY29wZS5zZWxlY3RlZEluc3RydWN0b3JGaWx0ZXIsICJidXNpbmVzc191c2VyX2lkIiApOwogICAgbW9udGhfZmlsdGVyID0gbGlzdF90b19zdHJpbmdfYnlfdmFsdWUoJHNjb3BlLnNlbGVjdGVkTW9udGhGaWx0ZXIsICJtb250aCIgKTsKICAgIGNsaWVudF9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuc2VsZWN0ZWRDbGllbnRGaWx0ZXIsICJidXNpbmVzc191c2VyX2lkIiApOwogICAgeWVhcl9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuc2VsZWN0ZWRZZWFyRmlsdGVyLCAieWVhciIgKTsKICAgIHN0YXR1c19maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuc2VsZWN0ZWRTdGF0dXNGaWx0ZXIsICJzdGF0dXNfaWQiICk7CiAgICBpc19jYW5jZWxlZF9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuc2VsZWN0ZWRJc19jYW5jZWxlZEZpbHRlciwgImlzX2NhbmNlbGVkIiApOwogICAgcGVyaW9kX2ZpbHRlciA9IGxpc3RfdG9fc3RyaW5nX2J5X3ZhbHVlKCRzY29wZS5zZWxlY3RlZFBlcmlvZEZpbHRlciwgInBlcmlvZF9zaWduIiApOwoKICAgICRzY29wZS5ldmVudFJlcG9ydENvbmZpZyA9IHt9OwoKICAgICRzY29wZS5ldmVudFJlcG9ydENvbmZpZy5maWx0ZXJzID0gewogICAgICBldmVudF90eXBlX2lkOiBldmVudF90eXBlX2lkX2ZpbHRlciwKICAgICAgaW5zdHJ1Y3Rvcl9pZDogaW5zdHJ1Y3Rvcl9pZF9maWx0ZXIsCiAgICAgIG1vbnRoOiBtb250aF9maWx0ZXIsCiAgICAgIHllYXI6IHllYXJfZmlsdGVyLAogICAgICBjbGllbnQ6IGNsaWVudF9maWx0ZXIsCiAgICAgIHN0YXR1czogc3RhdHVzX2ZpbHRlciwKICAgICAgcGVyaW9kOiBwZXJpb2RfZmlsdGVyLAogICAgICBpc19jYW5jZWxlZDogaXNfY2FuY2VsZWRfZmlsdGVyCiAgICB9OwoKICAgICRzY29wZS5ldmVudFJlcG9ydENvbmZpZy5hZ2dyZWdhdGlvbnMgPSB7CiAgICAgIGV2ZW50X3R5cGVfaWQ6ICRzY29wZS5ldmVudFR5cGVNb2RlbCwKICAgICAgaW5zdHJ1Y3Rvcl9pZDogJHNjb3BlLmluc3RydWN0b3JNb2RlbCwKICAgICAgbW9udGg6ICRzY29wZS5tb250aE1vZGVsLAogICAgICB5ZWFyOiAkc2NvcGUueWVhck1vZGVsLAogICAgICBjbGllbnQ6ICRzY29wZS5jbGllbnRNb2RlbCwKICAgIH07CgogICAgaWYgKCAkc2NvcGUuc2hvd0FnZyApIHsKICAgICAgZ2V0RXZlbnRzUmVwb3J0KCRodHRwLCRzY29wZSwgZ2V0RXZlbnRzUmVwb3J0QWdncmVnYXRlZF9zdWNjZXNzKTsKICAgICAgJHNjb3BlLnJlcG9ydF9pc19sb2FkaW5nID0gdHJ1ZTsKICAgIH0gZWxzZSB7CiAgICAgIGdldEV2ZW50c1JlcG9ydCgkaHR0cCwkc2NvcGUsIGdldEV2ZW50c1JlcG9ydExpc3Rfc3VjY2Vzcyk7CiAgICAgICRzY29wZS5yZXBvcnRfaXNfbG9hZGluZyA9IHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0RXZlbnRzUmVwb3J0TGlzdF9zdWNjZXNzKHJlc3BvbnNlKXsKICAgICAgJHNjb3BlLkV2ZW50UmVwb3J0TGlzdCA9IHJlc3BvbnNlLmpzb247CiAgICAgICRzY29wZS5kb3dubG9hZF9yZXBvcnQgPSAkc2NvcGVbICdFdmVudFJlcG9ydExpc3QnIF07CiAgICAgICRzY29wZS5yZXBvcnRfaXNfbG9hZGluZyA9IGZhbHNlOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldEV2ZW50c1JlcG9ydEFnZ3JlZ2F0ZWRfc3VjY2VzcyhyZXNwb25zZSl7CiAgICAgICRzY29wZS5FdmVudFJlcG9ydEFnZ3JlZ2F0ZWQgPSByZXNwb25zZS5qc29uOwogICAgICAkc2NvcGUuZG93bmxvYWRfcmVwb3J0ID0gJHNjb3BlWyAnRXZlbnRSZXBvcnRBZ2dyZWdhdGVkJyBdOwogICAgICAkc2NvcGUucmVwb3J0X2lzX2xvYWRpbmcgPSBmYWxzZTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRDbGllbnRzUmVwb3J0TGlzdF9zdWNjZXNzKHJlc3BvbnNlKXsKICAgICAgJHNjb3BlLkNsaWVudHNSZXBvcnRMaXN0ID0gcmVzcG9uc2UuanNvbjsKICAgICAgY29uc29sZS5sb2coIi0tLS0tLS0tLS0tLSIpCiAgICAgIGNvbnNvbGUubG9nKCRzY29wZS5DbGllbnRzUmVwb3J0TGlzdCkKICAgICAgY29uc29sZS5sb2coIi0tLS0tLS0tLS0tLSIpCiAgICAgICRzY29wZS5yZXBvcnRfaXNfbG9hZGluZyA9IGZhbHNlOwogICAgfQoKCiAgfQoKICAkc2NvcGUuY2xpZW50c1JlcG9ydCA9IGZ1bmN0aW9uKCl7CiAgICBsb2dEZWJ1ZygiY2xpZW50c1JlcG9ydCIpOwoKICAgIGNsaWVudF9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuc2VsZWN0ZWRDbGllbnRGaWx0ZXIsICJjbGllbnQiICk7CgogICAgJHNjb3BlLmV2ZW50UmVwb3J0Q29uZmlnID0ge307CgogICAgJHNjb3BlLmV2ZW50UmVwb3J0Q29uZmlnLmZpbHRlcnMgPSB7CiAgICAgIGNsaWVudDogY2xpZW50X2ZpbHRlciwKICAgIH07CgogICAgJHNjb3BlLmV2ZW50UmVwb3J0Q29uZmlnLmFnZ3JlZ2F0aW9ucyA9IHsKICAgIH07CgogICAgZ2V0Q2xpZW50c1JlcG9ydCgkaHR0cCwkc2NvcGUsIGdldENsaWVudHNSZXBvcnRfc3VjY2Vzcyk7CiAgICAkc2NvcGUucmVwb3J0X2lzX2xvYWRpbmcgPSB0cnVlOwogICAgZnVuY3Rpb24gZ2V0Q2xpZW50c1JlcG9ydF9zdWNjZXNzKHJlc3BvbnNlKXsKICAgICAgJHNjb3BlLmNsaWVudFJlcG9ydCA9IHJlc3BvbnNlLmpzb247CiAgICAgICRzY29wZS5kb3dubG9hZF9yZXBvcnQgPSAkc2NvcGVbICdjbGllbnRSZXBvcnQnIF07CiAgICAgICRzY29wZS5yZXBvcnRfaXNfbG9hZGluZyA9IGZhbHNlOwogICAgfQogIH0KCiAgJHNjb3BlLmVkaXRFdmVudD0gZnVuY3Rpb24gKHRoZWV2ZW50KQogIHsKICAgIGdvdG9FdmVudFBhZ2UodGhlZXZlbnQpOwogIH0KCiAgJHNjb3BlLmV2ZW50c1JlcG9ydCgpOwogICRzY29wZS5zZWxlY3RlZFJlcG9ydD0iZXZlbnRzIjsKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2J1c2luZXNzX3BhY2thZ2VzX3VwZGF0ZV9jbnRsJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uLCRyb3V0ZVBhcmFtcykKewogICRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIgPSB7fTsgLy8gdGhlc2UgYXJlIHRoZSBjb21wbGV0ZSBkZXRhaWxzIGZvciB0aGUgbmV3IGV2ZW50IC8vCiAgJHNjb3BlLnBhY2thZ2VfaXNfdXBkYXRlID0gdHJ1ZTsKICAkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLnBhY2thZ2VfbGltaXRfdHlwZT0xOwoKICAvLyBnZXR0dGluZyB0aGUgcGFja2FnZSBhbmQgaXRzIGV2ZW50IHR5cGVzCiAgZ2V0QnVzaW5lc3NQYWNrYWdlKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMucGFja2FnZV9pZCwnZm9ybUFkZFBhY2thZ2VBbmd1bGFyJyxmdW5jdGlvbihyZXNwb25zZSkKICB7CiAgICAkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLmlzX3VwZGF0ZSA9IHRydWU7CiAgICAkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLm9yaWdFdmVudFR5cGVzPWFuZ3VsYXIuY29weSgkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLnNlbGVjdGVkRXZlbnRUeXBlcyk7CiAgICAkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLnBhY2thZ2VfbGltaXRfdHlwZT0xOwogICAgLy8gdGhlbiBnZXR0aW5nIGFsbCB0aGUgZXZlbnQgdHlwZXMKICAgIGdldEV2ZW50VHlwZXNOb0FkbWluKCRodHRwLCRzY29wZSwncmVsYXRlZEV2ZW50VHlwZXMnLGdldEV2ZW50VHlwZXNOb0FkbWluX3N1Y2Nlc3MpOwogICAgZnVuY3Rpb24gZ2V0RXZlbnRUeXBlc05vQWRtaW5fc3VjY2VzcygpCiAgICB7CiAgICAgIC8vIHRoZW4gcmVtb3ZpbmcgZXhpc3RpbmcgZXZlbnQgdHlwZXMgb2YgcGFja2FnZSBmcm9tIGxpc3QKICAgICAgLy8gY29uc29sZS5sb2coJHNjb3BlLnJlbGF0ZWRFdmVudFR5cGVzWzBdKTsKICAgICAgLy8gY29uc29sZS5sb2coJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5zZWxlY3RlZEV2ZW50VHlwZXNbMF0pOwogICAgICBmb3IodmFyIGkgPSAwOyBpIDwgJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5zZWxlY3RlZEV2ZW50VHlwZXMubGVuZ3RoOyBpKyspCiAgICAgIHsKICAgICAgICAvLyBjb3B5aW5nIHRoZSBhY3R1YWwgb2JqZWN0IG9mICRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuc2VsZWN0ZWRFdmVudFR5cGVzW2ldCiAgICAgICAgZm9yKHZhciBqID0gMDsgaiA8ICRzY29wZS5yZWxhdGVkRXZlbnRUeXBlcy5sZW5ndGg7IGorKykKICAgICAgICB7CiAgICAgICAgICBpZiAoJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5zZWxlY3RlZEV2ZW50VHlwZXNbaV0uZXZlbnRfdHlwZV9pZD09JHNjb3BlLnJlbGF0ZWRFdmVudFR5cGVzW2pdLmV2ZW50X3R5cGVfaWQpCiAgICAgICAgICB7CiAgICAgICAgICAgICRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuc2VsZWN0ZWRFdmVudFR5cGVzW2ldPWFuZ3VsYXIuY29weSgkc2NvcGUucmVsYXRlZEV2ZW50VHlwZXNbal0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogIH0pOwogICRzY29wZS5nb3RvQmFjayA9IGdvdG9CYWNrOwogICRzY29wZS5jcmVhdGVQYWNrYWdlID0gZnVuY3Rpb24oKQogIHsKICAgIGNvbnNvbGUubG9nKCJ1cGRhdGVQYWNrYWdlRGV0YWlscyIpOwogICAgdXBkYXRlUGFja2FnZURldGFpbHMoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5wYWNrYWdlX2lkLCRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIsc3VjY2Vzc19jYWxsYmFjaywgZmFpbHVyZV9jYWxsYmFjayk7CiAgICBmdW5jdGlvbiBzdWNjZXNzX2NhbGxiYWNrKCkKICAgIHsKICAgICAgZ290b0JhY2soKTsKICAgIH0KICAgIGZ1bmN0aW9uIGZhaWx1cmVfY2FsbGJhY2soKQogICAgewogICAgICBnb3RvQmFjaygpOwogICAgfQogIH07Cn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdidXNpbmVzc19wYWNrYWdlc19hZGRfY250bCcsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikgewogICAgbG9nRGVidWcoJ2J1c2luZXNzX3BhY2thZ2VzX2FkZF9jbnRsJyk7CiAgICAkc2NvcGUucGFja2FnZV9pc191cGRhdGUgPSBmYWxzZTsKICAgICRzY29wZS5nb3RvQmFjayA9IGdvdG9CYWNrOwogICAgJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhciA9IHt9OwogICAgJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5ldmVudHNfY291bnRlciA9IDE7CiAgICAkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLmV2ZW50c19wZXJfd2VlayA9IDE7CiAgICAkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLnBhY2thZ2VfZHVyYXRpb25fbW9udGhzID0gMzsKICAgICRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIucGFja2FnZV9saW1pdF90eXBlPTE7CiAgICBnZXRFdmVudFR5cGVzTm9BZG1pbigkaHR0cCwkc2NvcGUsJ3JlbGF0ZWRFdmVudFR5cGVzJyk7CgogICAgJHNjb3BlLmNyZWF0ZVBhY2thZ2UgPSBmdW5jdGlvbigpCiAgICB7CiAgICAgIGNyZWF0ZVBhY2thZ2UoJGh0dHAsJHNjb3BlLCRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIsY3JlYXRlUGFja2FnZV9zdWNjZXNzLCBjcmVhdGVQYWNrYWdlX2ZhaWx1cmUpOwogICAgICBmdW5jdGlvbiBjcmVhdGVQYWNrYWdlX3N1Y2Nlc3MoKQogICAgICB7CiAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9wYWNrYWdlcycpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGNyZWF0ZVBhY2thZ2VfZmFpbHVyZSgpCiAgICAgIHsKICAgICAgICAvLyBsb2dFcnJvcigiZXJyb3IgIiArIGRhdGEubWVzc2FnZSk7CiAgICAgICAgLy8gJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5hamF4X2Vycm9yID0gZGF0YS5tZXNzYWdlOwogICAgICB9CiAgICB9Cn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdidXNpbmVzc19sb2NhdGlvbnMnLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkbG9jYXRpb24pIHsKICAgIGxvZ0RlYnVnKCdidXNpbmVzc19sb2NhdGlvbnMgY29udHJvbGxlcicpOwogICAgZ2V0QnVzaW5lc3NMb2NhdGlvbnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19sb2NhdGlvbnMnKTsKICAgICRzY29wZS5hZGROZXdMb2NhdGlvbiA9IGZ1bmN0aW9uICgpCiAgICB7CiAgICAgICRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfbG9jYXRpb25zL2FkZCcpOwogICAgfQogICAgJHNjb3BlLmdvdG9Mb2NhdGlvblBhZ2UgPSBmdW5jdGlvbihsb2NhdGlvbl9pZCkKICAgIHsKICAgICAgZ290b0xvY2F0aW9uUGFnZShsb2NhdGlvbl9pZCk7CiAgICB9Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignQnVzaW5lc3NEb2NzQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikgewogICAgbG9nRGVidWcoJ0J1c2luZXNzRG9jc0NvbnRyb2xsZXInKTsKfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdidXNpbmVzc19sb2NhdGlvbnNfdXBkYXRlJywgZnVuY3Rpb24oJHNjb3BlLCAkcm91dGVQYXJhbXMsICRodHRwLCAkbG9jYXRpb24pIHsKICAgIGxvZ0RlYnVnKCdidXNpbmVzc19sb2NhdGlvbnNfdXBkYXRlIGNvbnRyb2xsZXInKTsKICAgICRzY29wZS5pc191cGRhdGU9dHJ1ZTsKICAgIC8vIGdldEJ1c2luZXNzTG9jYXRpb25zKCRodHRwLCRzY29wZSwnYnVzaW5lc3NfbG9jYXRpb25zJyk7CiAgICBnZXRCdXNpbmVzc0xvY2F0aW9uKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMubG9jYXRpb25faWQsJ2N1cnJfbG9jYXRpb24nLGdldEJ1c2luZXNzTG9jYXRpb25fc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBnZXRCdXNpbmVzc0xvY2F0aW9uX3N1Y2Nlc3MoKQogICAgewogICAgICAkc2NvcGUuZm9ybUFkZExvY2F0aW9uQW5ndWxhcj0kc2NvcGUuY3Vycl9sb2NhdGlvblswXTsKICAgIH0KCgogICAgJHNjb3BlLmFkZExvY2F0aW9uID0gZnVuY3Rpb24oKQogICAgewogICAgICAvLyBpbiB0aGlzIGNhc2UgLSB1cGRhdGUgbG9jYXRpb24KICAgICAgdGhlZGF0YSA9ICRzY29wZS5mb3JtQWRkTG9jYXRpb25Bbmd1bGFyOwoKICAgICAgZnVuY3Rpb24gYWRkTG9jYXRpb25fc3VjY2VzcygpCiAgICAgIHsKICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2xvY2F0aW9ucycpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGFkZExvY2F0aW9uX2ZhaWx1cmUoKQogICAgICB7CiAgICAgICAgJHNjb3BlLmZvcm1BZGRMb2NhdGlvbkFuZ3VsYXIuYWpheF9lcnJvciA9IHJlc3BvbnNlLm1lc3NhZ2U7CiAgICAgIH0KICAgICAgdXBkYXRlTG9jYXRpb24oJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5sb2NhdGlvbl9pZCwgdGhlZGF0YSxhZGRMb2NhdGlvbl9zdWNjZXNzLGFkZExvY2F0aW9uX2ZhaWx1cmUpOwogICAgfQp9KTsKCmt1emVBcHAuY29udHJvbGxlcignYnVzaW5lc3NfbG9jYXRpb25zX2FkZCcsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikgewogICAgbG9nRGVidWcoJ2J1c2luZXNzX2xvY2F0aW9uc19hZGQgY29udHJvbGxlcicpOwogICAgZ2V0QnVzaW5lc3NMb2NhdGlvbnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19sb2NhdGlvbnMnKTsKICAgICRzY29wZS5pc191cGRhdGU9ZmFsc2U7CgogICAgJHNjb3BlLmFkZExvY2F0aW9uID0gZnVuY3Rpb24oKQogICAgewogICAgICB0aGVkYXRhID0gJHNjb3BlLmZvcm1BZGRMb2NhdGlvbkFuZ3VsYXI7CgogICAgICBmdW5jdGlvbiBhZGRMb2NhdGlvbl9zdWNjZXNzKCkKICAgICAgewogICAgICAgICRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfbG9jYXRpb25zJyk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gYWRkTG9jYXRpb25fZmFpbHVyZSgpCiAgICAgIHsKICAgICAgICAkc2NvcGUuZm9ybUFkZExvY2F0aW9uQW5ndWxhci5hamF4X2Vycm9yID0gcmVzcG9uc2UubWVzc2FnZTsKICAgICAgfQogICAgICBhZGRMb2NhdGlvbigkaHR0cCwkc2NvcGUsdGhlZGF0YSxhZGRMb2NhdGlvbl9zdWNjZXNzLGFkZExvY2F0aW9uX2ZhaWx1cmUpOwogICAgfQp9KTsKCmt1emVBcHAuY29udHJvbGxlcignSW5zdHJ1Y3RvcnNBZGRDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uKSB7CiAgICBsb2dEZWJ1ZygnSW5zdHJ1Y3RvcnNBZGRDb250cm9sbGVyJyk7CiAgICAkc2NvcGUuaXNJbnN0cnVjdG9yPXRydWU7CiAgICAkc2NvcGUudXNlcnR5cGU9Imluc3RydWN0b3IiOwogICAgJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyID0ge307CiAgICAkc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIuaXNfdXBkYXRlPWZhbHNlOwogICAgJHNjb3BlLmFkZENsaWVudCA9IGZ1bmN0aW9uKCkgLy8gYWRkIGluc3RydWN0b3IsIHVzaW5nIHRoZSBzYW1lIGZ1bmN0aW9uIG5hbWUgYXMgd2UgdXNlIHRoZSBzYW1lIHNjcmVlbgogICAgewogICAgICB0aGVkYXRhID0gJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyOwoKICAgICAgZnVuY3Rpb24gYWRkSW5zdHJ1Y3Rvcl9zdWNjZXNzKCkKICAgICAgewogICAgICAgICRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfaW5zdHJ1Y3RvcnMnKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBhZGRDbGllbnRfZmFpbHVyZSgpCiAgICAgIHsKICAgICAgICAkc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIuYWpheF9lcnJvciA9IHJlc3BvbnNlLm1lc3NhZ2U7CiAgICAgIH0KICAgICAgYWRkSW5zdHJ1Y3RvcigkaHR0cCwkc2NvcGUsdGhlZGF0YSxhZGRJbnN0cnVjdG9yX3N1Y2Nlc3MpOwogICAgfQp9KTsKa3V6ZUFwcC5jb250cm9sbGVyKCdDbGllbnRzQWRkQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICR0aW1lb3V0LCAkbG9jYXRpb24sIHNoYXJlZFByb3BlcnRpZXMpIHsKICAgIGxvZ0RlYnVnKCdDbGllbnRzQWRkQ29udHJvbGxlciAtIFRoaXMgaXMgQWRkIG5ldyBjbGllbnQgc2NyZWVuJyk7CiAgICAkc2NvcGUuaXNJbnN0cnVjdG9yPWZhbHNlOwoKICAgICRzY29wZS51c2VydHlwZT0iZW5kdXNlciI7CiAgICAkc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIgPSB7fTsKICAgICRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5pc191cGRhdGU9ZmFsc2U7CiAgICAkc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIuZGlzYWJsZV9waG9uZV9lZGl0aW5nPWZhbHNlOwoKICAgIGlmICgoJHNjb3BlLmZpbHRlci5WYWx1ZSAhPSAiIikgJiYgKHR5cGVvZiAkc2NvcGUuZmlsdGVyLlZhbHVlICE9ICd1bmRlZmluZWQnKSkgewogICAgICAgIGxvZ0RlYnVnKCJjbGllbnRzIGZpbHRlciBpcyBub3QgZW1wdHkiKTsKICAgICAgICB2YXIgZmlsdGVyID0gU3RyaW5nKCRzY29wZS5maWx0ZXIuVmFsdWUpOwogICAgICAgIGlmIChmaWx0ZXIuaW5kZXhPZigiICIpID4gMCkgewogICAgICAgICAgICAkc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIuZmlyc3RfbmFtZSA9IGZpbHRlci5zdWJzdHIoMCwgZmlsdGVyLmluZGV4T2YoIiAiKSk7CiAgICAgICAgICAgICRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5sYXN0X25hbWUgPSBmaWx0ZXIuc3Vic3RyKDEgKyBmaWx0ZXIuaW5kZXhPZigiICIpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIuZmlyc3RfbmFtZSA9IGZpbHRlcjsKICAgICAgICAgICAgJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyLmxhc3RfbmFtZSA9ICIiOwogICAgICAgIH0KICAgICAgICAkc2NvcGUuZmlsdGVyLlZhbHVlID0gIiI7CiAgICAgICAgJHNjb3BlLmZpbHRlci5idXR0b25WYWx1ZSA9ICIiOwogICAgfSBlbHNlIHsKICAgIH0KCiAgICAkc2NvcGUuZ290b0JhY2sgPSBmdW5jdGlvbigpCiAgICB7CiAgICAgICRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfY2xpZW50cycpOwogICAgfQoKICAgICRzY29wZS5hZGRDbGllbnQgPSBmdW5jdGlvbigpCiAgICB7CiAgICAgIHRoZWRhdGEgPSAkc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXI7CgogICAgICBmdW5jdGlvbiBhZGRDbGllbnRfc3VjY2Vzcyh1c2VyX2lkKQogICAgICB7CiAgICAgICAgaWYgKCRzY29wZS5zYXZlX2FuZF9zY2hlZHVsZSkKICAgICAgICB7CiAgICAgICAgICAvLyAkbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2NsaWVudHMvJyt1c2VyX2lkLmpzb24pOwogICAgICAgICAgbG9nRGVidWcoIk5FVyB1c2VyIHVzZXJfaWQ9Iit1c2VyX2lkLmpzb24pOwoKICAgICAgICAgIHVzZXJfaW5mbz0gewogICAgICAgICAgICAgIGJ1c2luZXNzX3VzZXJfaWQ6IHVzZXJfaWQuanNvbiwKICAgICAgICAgICAgICBidXNlcl9maXJzdF9uYW1lOiAkc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIuYnVzZXJfZmlyc3RfbmFtZSwKICAgICAgICAgICAgICBidXNlcl9sYXN0X25hbWU6ICRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5idXNlcl9sYXN0X25hbWUKICAgICAgICAgIH07CgogICAgICAgICAgc2hhcmVkUHJvcGVydGllcy5zZXRfc2VsZWN0ZWRfdXNlcih1c2VyX2luZm8pOwogICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jYWxlbmRhcicpOwoKICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfY2xpZW50cy8nKTsKICAgICAgICB9CiAgICAgICAgY29uc29sZS5sb2coIm5ldyB1c2VyIGlkID0gIit1c2VyX2lkLmpzb24pOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGFkZENsaWVudF9mYWlsdXJlKHJlc3BvbnNlKQogICAgICB7CiAgICAgICAgJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyLmFqYXhfZXJyb3IgPSByZXNwb25zZS5tZXNzYWdlOwogICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkKICAgICAgICB7CiAgICAgICAgICAkc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIuYWpheF9lcnJvcj1udWxsOwogICAgICAgIH0sIDI1MDApOwogICAgICB9CiAgICAgIGFkZENsaWVudCgkaHR0cCwkc2NvcGUsdGhlZGF0YSxhZGRDbGllbnRfc3VjY2VzcywgYWRkQ2xpZW50X2ZhaWx1cmUsZmFsc2UpOwogICAgfQp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ1BhY2thZ2VzQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikgewogICAgbG9nRGVidWcoJ1BhY2thZ2VzQ29udHJvbGxlcicpOwogICAgZ2V0QnVzaW5lc3NQYWNrYWdlcygkaHR0cCwkc2NvcGUsJ3BhY2thZ2VzJyk7CgogICAgJHNjb3BlLnNob3dQYWNrYWdlID0gZnVuY3Rpb24gKHRoZXBhY2thZ2UpCiAgICB7CiAgICAgICRsb2NhdGlvbi5wYXRoKCcvcGFja2FnZXMvJyt0aGVwYWNrYWdlLnBhY2thZ2VfaWQpOwogICAgfQp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ0luc3RydWN0b3JzU2hvd0NvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkbG9jYXRpb24pIHsKICAgIGxvZ0RlYnVnKCdJbnN0cnVjdG9yc1Nob3dDb250cm9sbGVyJyk7CiAgICAkc2NvcGUub3JkZXJCeUZpZWxkID0gJ2J1c2VyX3N0YXJ0X2RhdGUnOwogICAgJHNjb3BlLnJldmVyc2VTb3J0PXRydWU7CgogICAgZ2V0QWxsSW5zdHJ1Y3RvcnMoJGh0dHAsJHNjb3BlLCdhbGxDbGllbnRzJyxnZXRBbGxJbnN0cnVjdG9yc19zdWNjZXNzKTsKICAgIGZ1bmN0aW9uIGdldEFsbEluc3RydWN0b3JzX3N1Y2Nlc3MoKQogICAgewogICAgICAkc2NvcGUuc2hvd0NsaWVudHNHcmlkT3B0aW9ucy5kYXRhPSRzY29wZS5hbGxDbGllbnRzOwogICAgfQoKICAgICRzY29wZS5nb3RvSW5zdHJ1Y3RvclBhZ2U9IGZ1bmN0aW9uIChidXNpbmVzc191c2VyX2lkKQogICAgewogICAgICBnb3RvSW5zdHJ1Y3RvclBhZ2UoYnVzaW5lc3NfdXNlcl9pZCk7CiAgICB9CgogICAgJHNjb3BlLmNsaWVudE5hbWVGaWx0ZXI9IiI7CiAgICAkc2NvcGUuaW5wdXRGaWx0ZXIgPSBmdW5jdGlvbiAoaXRlbSkKICAgIHsKICAgICAgLy8gY29uc29sZS5sb2coaXRlbS5idXNlcl9waG9uZV9udW1iZXIpOwogICAgICByZXR1cm4gZmlsdGVyX2ZpcnN0bGFzdF9uYW1lKGl0ZW0uYnVzZXJfZmlyc3RfbmFtZSxpdGVtLmJ1c2VyX2xhc3RfbmFtZSxpdGVtLmJ1c2VyX3Bob25lX251bWJlciwkc2NvcGUuY2xpZW50TmFtZUZpbHRlcik7CiAgICB9Owp9KTsKCmt1emVBcHAuY29udHJvbGxlcignQ2xpZW50c1Nob3dDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkdWliTW9kYWwsICRodHRwLCAkbG9jYXRpb24pIHsKICAgIGxvZ0RlYnVnKCdDbGllbnRzU2hvd0NvbnRyb2xsZXInKTsKICAgICRzY29wZS5vcmRlckJ5RmllbGQgPSAnYnVzZXJfc3RhcnRfZGF0ZSc7CiAgICAkc2NvcGUucmV2ZXJzZVNvcnQ9dHJ1ZTsKCiAgICBnZXRBbGxDbGllbnRzKCRodHRwLCRzY29wZSwnYWxsQ2xpZW50cycsZ2V0Q2xpZW50X3N1Y2Nlc3MpOwogICAgZnVuY3Rpb24gZ2V0Q2xpZW50X3N1Y2Nlc3MoKQogICAgewogICAgICAkc2NvcGUuc2hvd0NsaWVudHNHcmlkT3B0aW9ucy5kYXRhPSRzY29wZS5hbGxDbGllbnRzOwogICAgfQoKICAgICRzY29wZS5nb3RvQ2xpZW50UGFnZT0gZnVuY3Rpb24gKGJ1c2luZXNzVXNlcmlkKQogICAgewogICAgICBnb3RvQ2xpZW50UGFnZShidXNpbmVzc1VzZXJpZCk7CiAgICB9CgogICAgLy8gZmlsdGVyIGFyY2hpdmVkIGNsaWVudHMKICAgICRzY29wZS5zaG93QXJjaGl2ZWRDaGVja2JveD1mYWxzZTsKICAgICRzY29wZS5zaG93QXJjaGl2ZWQgPSBmdW5jdGlvbiAoZWNsaWVudCkKICAgIHsKICAgICAgaWYgKGVjbGllbnQuaXNfYWN0aXZlPT0wKQogICAgICB7CiAgICAgICAgbG9nRGVidWcoZWNsaWVudCk7CiAgICAgICAgaWYgKCRzY29wZS5zaG93QXJjaGl2ZWRDaGVja2JveCkKICAgICAgICB7CiAgICAgICAgICByZXR1cm4gZWNsaWVudDsKICAgICAgICB9CiAgICAgIH0KICAgICAgZWxzZSB7CiAgICAgICAgcmV0dXJuIGVjbGllbnQ7CiAgICAgIH0KICAgIH07CgogICAgJHNjb3BlLmNsaWVudE5hbWVGaWx0ZXI9IiI7CiAgICAkc2NvcGUuaW5wdXRGaWx0ZXIgPSBmdW5jdGlvbiAoaXRlbSkKICAgIHsKICAgICAgY29uc29sZS5sb2coImNsaWVudE5hbWVGaWx0ZXIiKTsKICAgICAgcmV0dXJuIGZpbHRlcl9maXJzdGxhc3RfbmFtZShpdGVtLmJ1c2VyX2ZpcnN0X25hbWUsaXRlbS5idXNlcl9sYXN0X25hbWUsaXRlbS5idXNlcl9waG9uZV9udW1iZXIsJHNjb3BlLmNsaWVudE5hbWVGaWx0ZXIpOwogICAgfTsKCiAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcz1bXTsKICAgIC8vICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzID0gWwogICAgLy8gICB7ImZpZWxkX2lkIjowLCJmaWVsZF9uYW1lIjoi16rXkNeo15nXmiDXnNeZ15PXlCIsImZpZWxkX2RhdGF0eXBlIjoiREFURSIsImlzX21hbmRhdG9yeSI6MCwgImZyb21kYiI6IGZhbHNlLCAiZGJfaWRfdG9maXgiOiAwLCAiaXNfYWN0aXZlIjogMSwgIm1vZGlmaWVkIjogZmFsc2V9LAogICAgLy8gICB7ImZpZWxkX2lkIjowLCJmaWVsZF9uYW1lIjoi15TXoteo15XXqiIsImZpZWxkX2RhdGF0eXBlIjoiVEVYVF9BUkVBIiwiaXNfbWFuZGF0b3J5IjowLCAiZnJvbWRiIjogZmFsc2UsICJkYl9pZF90b2ZpeCI6IDAsICJpc19hY3RpdmUiOiAxLCAibW9kaWZpZWQiOiBmYWxzZX0KICAgIC8vIF07CgogICAgZnVuY3Rpb24gZ2V0Q2xpZW50c0V4dHJhRmllbGRzX3N1Y2Nlc3MoKQogICAgewogICAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyA9ICRzY29wZS5leHRyYUZpZWxkczsKICAgIH0KICAgIGdldENsaWVudHNFeHRyYUZpZWxkcygkaHR0cCwkc2NvcGUsJ2V4dHJhRmllbGRzJyxnZXRDbGllbnRzRXh0cmFGaWVsZHNfc3VjY2Vzcyk7CgogICAgJHNjb3BlLmV2ZW50VHlwZUV4dHJhRmllbGRzUG9wID0gZnVuY3Rpb24oZXZlbnRUeXBlUHJvcGVydGllcykgewogICAgICAgIGxvZ0RlYnVnKCJldmVudCBjcmVhdGUgbW9kYWwiKTsKCiAgICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgICAgICAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2NsaWVudF9leHRyYV9maWVsZHMucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ2V2ZW50VHlwZUV4dHJhRmllbGRzTW9kYWxDb250cm9sbGVyJywKICAgICAgICAgICAgc2l6ZTogJ2wnLAogICAgICAgICAgICByZXNvbHZlOiB7CiAgICAgICAgICAgICAgICBldmVudFR5cGVQcm9wZXJ0aWVzOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXZlbnRUeXBlUHJvcGVydGllczsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBtb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHNlbGVjdGVkSXRlbSkgewogICAgICAgICAgICBsb2dEZWJ1ZyhzZWxlY3RlZEl0ZW0pOwogICAgICAgICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzID0gc2VsZWN0ZWRJdGVtOwogICAgICAgIH0sIGZ1bmN0aW9uKCkgewogICAgICAgICAgICBsb2dEZWJ1ZygnTW9kYWwgZGlzbWlzc2VkIGF0OiAnICsgbmV3IERhdGUoKSk7CiAgICAgICAgfSk7CiAgICB9Owp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ3NjaGVkdWxlckNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkcm91dGVQYXJhbXMpIHsKICAgIGV2ZW50X3R5cGVfaWQ9JHJvdXRlUGFyYW1zLmV2ZW50X3R5cGVfaWQ7CgogICAgJHNjb3BlLnN1Z2dlc3Rpb25EYXRlID0gW107CiAgICAkc2NvcGUuc3VnZ2VzdGlvbkRhdGUuZGF0ZSA9IG5ldyBEYXRlKCk7CiAgICAkc2NvcGUuc3VnZ2VzdGlvbkRhdGUub3B0aW9ucyA9IHsKICAgICAgICAgICAgLy8gbWluRGF0ZTogbmV3IERhdGUoKSwKICAgICAgICAgICAgLy8gc2hvd1dlZWtzOiB0cnVlLAogICAgICAgICAgICBtaW5WaWV3OidkYXknLAogICAgICAgICAgICBzdGFydFZpZXc6ICdkYXknCgogICAgICAgICAgfTsKICAgIHZhciB0aGV0aW1lID0gbmV3IERhdGUoKTsKICAgICRzY29wZS5maWx0ZXJBbGxEYXlzQ2hlY2tib3g9dHJ1ZTsKICAgICRzY29wZS5maWx0ZXJEYXlJdGVtcyA9IHsKCiAgICAgICfXqNeQ16nXldefJzogdHJ1ZSwKICAgICAgJ9ep16DXmSc6IHRydWUsCiAgICAgICfXqdec15nXqdeZJzogdHJ1ZSwKICAgICAgJ9eo15HXmdei15knOiB0cnVlLAogICAgICAn15fXnteZ16nXmSc6IHRydWUsCiAgICAgICfXqdeZ16nXmSc6IHRydWUsCiAgICAgICfXqdeR16onOiB0cnVlCiAgICB9OwoKICAgICRzY29wZS5vblRpbWVTZXQgPSBmdW5jdGlvbiAobmV3RGF0ZSwgb2xkRGF0ZSkgewogICAgICAgIGxvZ0RlYnVnKCJuZXcgZGF0ZSAiK25ld0RhdGUuZ2V0VGltZSgpICsgIiBvbGQgZGF0ZSAiK29sZERhdGUuZ2V0VGltZSgpKTsKICAgICAgICBkaWZmPW5ld0RhdGUuZ2V0VGltZSgpLW9sZERhdGUuZ2V0VGltZSgpOwogICAgICAgIC8vIGlmIG5ldyBkYXRlIGlzIGluIGEgZGlmZmVyZW50IHdlZWsKICAgICAgICAvLyB3ZSByZWZldGNoIHN1Z2dlc3Rpb25zIGZvciB0aGUgY3VycmVudCB3ZWVrCiAgICAgICAgdmFyIG5ld0RhdGVXID0gbmV3IERhdGUobmV3RGF0ZSk7CiAgICAgICAgdmFyIG9sZERhdGVXID0gbmV3IERhdGUob2xkRGF0ZSk7CiAgICAgICAgLy8gYWxlcnQobmV3RGF0ZVcuZm9ybWF0KCdXJykpOwogICAgICAgIC8vIGFsZXJ0KG9sZERhdGVXLmZvcm1hdCgnVycpKTsKICAgICAgICBpZiAobmV3RGF0ZVcuZm9ybWF0KCdXJykhPW9sZERhdGVXLmZvcm1hdCgnVycpKQogICAgICAgIHsKICAgICAgICAgIGxvZ0RlYnVnKCJkaWZmIGlzIGEgd2VlayBvciBtb3JlLCByZWZldGNoaW5nIHN1Z2dlc3Rpb25zIik7CiAgICAgICAgICAkaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3QvIitldmVudF90eXBlX2lkKyIvIituZXdEYXRlLmdldEZ1bGxZZWFyKCkrIi8iKyhuZXdEYXRlLmdldE1vbnRoKCkrMSkrIi8iK25ld0RhdGUuZ2V0RGF0ZSgpKyIvIituZXdEYXRlLmdldEhvdXJzKCkgKyAiLyIgKyBuZXdEYXRlLmdldE1pbnV0ZXMoKSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkgewogICAgICAgICAgICAgIC8vCSAgICAkc2NvcGUubXlEYXRhID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgICAgICAvLwkJbG9nRGVidWcoImdyaWRvcHRpb25zPSIrJHNjb3BlLmdyaWRPcHRpb25zKTsKICAgICAgICAgICAgICAkc2NvcGUuZXZlbnRzU3VnZ2VzdGVkID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgIH0pOwoKICAgICAgICB9CiAgICB9CgogICAgJHNjb3BlLm9wdGlvbnMgPSB7CiAgICAgICBjdXN0b21DbGFzczogZ2V0RGF5Q2xhc3MsCiAgICAgICBtaW5EYXRlOiBuZXcgRGF0ZSgpLAogICAgICAgc2hvd1dlZWtzOiB0cnVlCiAgICAgfTsKICAgICAkc2NvcGUuZHQgPSBuZXcgRGF0ZSgpOwoKCiAgICAgZnVuY3Rpb24gZ2V0RGF5Q2xhc3MoZGF0YSkgewogICAgICAgICByZXR1cm4gJyc7CiAgICAgICB9CgogICAgJHNjb3BlLmRheXNJdGVtcyA9IFsKICAgICAge25hbWU6J9eo15DXqdeV158nfSwKICAgICAge25hbWU6J9ep16DXmSd9LAogICAgICB7bmFtZTon16nXnNeZ16nXmSd9LAogICAgICB7bmFtZTon16jXkdeZ16LXmSd9LAogICAgICB7bmFtZTon15fXnteZ16nXmSd9LAogICAgICB7bmFtZTon16nXmdep15knfSwKICAgICAge25hbWU6J9ep15HXqid9CiAgICBdOwoKICAgICRzY29wZS5maWx0ZXJBbGxEYXlJdGVtc1NldCA9IGZ1bmN0aW9uICgpCiAgICB7CiAgICAgICRzY29wZS5maWx0ZXJEYXlJdGVtc1sn16jXkNep15XXnyddPSRzY29wZS5maWx0ZXJBbGxEYXlzQ2hlY2tib3g7CiAgICAgICRzY29wZS5maWx0ZXJEYXlJdGVtc1sn16nXoNeZJ109JHNjb3BlLmZpbHRlckFsbERheXNDaGVja2JveDsKICAgICAgJHNjb3BlLmZpbHRlckRheUl0ZW1zWyfXqdec15nXqdeZJ109JHNjb3BlLmZpbHRlckFsbERheXNDaGVja2JveDsKICAgICAgJHNjb3BlLmZpbHRlckRheUl0ZW1zWyfXqNeR15nXoteZJ109JHNjb3BlLmZpbHRlckFsbERheXNDaGVja2JveDsKICAgICAgJHNjb3BlLmZpbHRlckRheUl0ZW1zWyfXl9ee15nXqdeZJ109JHNjb3BlLmZpbHRlckFsbERheXNDaGVja2JveDsKICAgICAgJHNjb3BlLmZpbHRlckRheUl0ZW1zWyfXqdeZ16nXmSddPSRzY29wZS5maWx0ZXJBbGxEYXlzQ2hlY2tib3g7CiAgICAgICRzY29wZS5maWx0ZXJEYXlJdGVtc1sn16nXkdeqJ109JHNjb3BlLmZpbHRlckFsbERheXNDaGVja2JveDsKICAgIH0KCiAgICAkc2NvcGUuc3VnZ2VzdEZpbHRlckRheXMgPSBmdW5jdGlvbiAoZXN1Z2dlc3QpCiAgICB7CiAgICAgIC8vIGxvZ0RlYnVnKGVzdWdnZXN0KTsKICAgICAgaWYgKCgkc2NvcGUuZmlsdGVyRGF5SXRlbXNbZXN1Z2dlc3Quc3RhcnRfZm9ybWF0X2Rvd10pICYgKCgkc2NvcGUuc3VnZ2VzdGlvbkRhdGUuZGF0ZS5nZXRUaW1lKCkvMTAwMCk8ZXN1Z2dlc3Quc3RhcnRfZXBvY2gpKQogICAgICB7CiAgICAgICAgcmV0dXJuIGVzdWdnZXN0OwogICAgICB9CiAgICB9OwoKICAgIGxvZ0RlYnVnKCdzY2hlZHVsZXJDb250cm9sbGVyIGZvciBldmVudCB0eXBlIGlkICcrZXZlbnRfdHlwZV9pZCsiICIrdGhldGltZS5nZXRIb3VycygpICsgIjoiICsgdGhldGltZS5nZXRNaW51dGVzKCkgKyAiOiIgKyB0aGV0aW1lLmdldFNlY29uZHMoKSk7CiAgICAkaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3QvIitldmVudF90eXBlX2lkKyIvIit0aGV0aW1lLmdldEZ1bGxZZWFyKCkrIi8iKyh0aGV0aW1lLmdldE1vbnRoKCkrMSkrIi8iK3RoZXRpbWUuZ2V0RGF0ZSgpKyIvIit0aGV0aW1lLmdldEhvdXJzKCkgKyAiLyIgKyB0aGV0aW1lLmdldE1pbnV0ZXMoKSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkgewogICAgICAgIC8vCSAgICAkc2NvcGUubXlEYXRhID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAvLwkJbG9nRGVidWcoImdyaWRvcHRpb25zPSIrJHNjb3BlLmdyaWRPcHRpb25zKTsKICAgICAgICAkc2NvcGUuZXZlbnRzU3VnZ2VzdGVkID0gcmVzcG9uc2UuZGF0YTsKICAgIH0pOwoKICAgICRodHRwLmdldCgkZ0FwaVVSTFByZWZpeCArICIvZW5kdXNlci9ldmVudF90eXBlcy8iK2V2ZW50X3R5cGVfaWQpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHsKICAgICAgICAvLwkgICAgJHNjb3BlLm15RGF0YSA9IHJlc3BvbnNlLmRhdGE7CiAgICAgICAgLy8JCWxvZ0RlYnVnKCJncmlkb3B0aW9ucz0iKyRzY29wZS5ncmlkT3B0aW9ucyk7CiAgICAgICAgJHNjb3BlLmV2ZW50VHlwZURldGFpbHMgPSByZXNwb25zZS5kYXRhOwogICAgfSk7Cn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdjb250YWN0Q29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHApIHsKICAgIGxvZ0RlYnVnKCdjb250YWN0Q29udHJvbGxlcicpOwp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ3BhY2thZ2VQYXltZW50QXNzb2NpYXRpb25Nb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRyb3V0ZVBhcmFtcywgJHJvb3RTY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRodHRwLCBmcGFja2FnZSwgYmFsYW5jZSwgYnVzaW5lc3NfdXNlcl9pZCwgdWlDYWxlbmRhckNvbmZpZykKewogIGxvZ0RlYnVnKCJwYWNrYWdlUGF5bWVudEFzc29jaWF0aW9uTW9kYWxDb250cm9sbGVyIik7CgogICRzY29wZS5mcGFja2FnZT1mcGFja2FnZTsKICAkc2NvcGUuYmFsYW5jZT1iYWxhbmNlOwogICRzY29wZS5wYWNrYWdlX3BheW1lbnRzPSRzY29wZS5mcGFja2FnZS5wYWNrYWdlX3BheW1lbnRzOwogICRzY29wZS5wcmV2aW91c19pc19hbGxfcGFpZD0kc2NvcGUuZnBhY2thZ2UuaXNfYWxsX3BhaWQ7CiAgJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQ9YnVzaW5lc3NfdXNlcl9pZDsKCiAgLy8gJ2NhbGN1bGF0aW5nJyBwcmV2aW91cyBzdGF0dXMgb2YgcGF5bWVudAogIGlmICgkc2NvcGUucGFja2FnZV9wYXltZW50cz4wKQogIHsKICAgIGlmICgkc2NvcGUucHJldmlvdXNfaXNfYWxsX3BhaWQ9PTEpCiAgICB7CiAgICAgICRzY29wZS5wcmV2aW91c19zdGF0dXM9ImlzX2FsbF9wYWlkIjsKICAgICAgJHNjb3BlLnBhY2thZ2Vfc3RhdHVzX2lkPS0xOwogICAgICAkc2NvcGUucHJldmlvdXNfcGFja2FnZV9zdGF0dXNfaWQ9LTE7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICRzY29wZS5wcmV2aW91c19zdGF0dXM9ImlzX3BhcnRseV9wYWlkIjsKICAgICAgJHNjb3BlLnBhY2thZ2Vfc3RhdHVzX2lkPS0xOwogICAgICAkc2NvcGUucHJldmlvdXNfcGFja2FnZV9zdGF0dXNfaWQ9LTE7CiAgICB9CiAgfQogIGVsc2UKICB7CiAgICAgICRzY29wZS5wcmV2aW91c19zdGF0dXM9Im5vdF9wYWlkIjsKICAgICAgJHNjb3BlLnBhY2thZ2Vfc3RhdHVzX2lkPTA7CiAgICAgICRzY29wZS5wcmV2aW91c19wYWNrYWdlX3N0YXR1c19pZD0wOwoKICB9CiAgbG9nRGVidWcoInByZXZpb3VzX3N0YXR1cz0iKyRzY29wZS5wcmV2aW91c19zdGF0dXMpOwoKICAkc2NvcGUuY2xvc2VNb2RhbCA9IGZ1bmN0aW9uKCkKICB7CiAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICB9OwogICRzY29wZS51cGRhdGVQYWNrYWdlUGF5bWVudCA9IGZ1bmN0aW9uKCkKICB7CiAgICAvLyBjb25zb2xlLmxvZygicHJldmlvdXNfcGFja2FnZV91c2VyX2lkPSIrJHNjb3BlLmZtZWV0aW5nLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZCk7CiAgICAvLyBjb25zb2xlLmxvZygicGFja2FnZV91c2VyX2lkPSIrJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZCk7CiAgICBsb2dEZWJ1ZygidXBkYXRlUGFja2FnZVBheW1lbnQiKQogICAgLy8gaWYgc2VsZWN0ZWQgcGFja2FnZSBpcyBsaWtlIHByZXZpb3VzIHBhY2thZ2UgLSBkbyBub3RoaW5nCiAgICBpZiAoKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3N0YXR1c19pZD09JHNjb3BlLnBhY2thZ2Vfc3RhdHVzX2lkKSkKICAgIHsKICAgICAgbG9nRGVidWcoInNlbGVjdGVkIG9wdGlvbiBpcyBsaWtlIHByZXZpb3VzIG9wdGlvbiAtIGRvIG5vdGhpbmciKTsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgfQoKICAgIC8vIHByZXZpb3VzIHBhY2thZ2Ugd2FzIHBhaWQvcGFydGx5LXBhaWQgLSBub3cgbm90aGluZ3MgaXMgc2VsZWN0ZWQKICAgIGVsc2UgaWYgKCgkc2NvcGUucHJldmlvdXNfcGFja2FnZV9zdGF0dXNfaWQ9PS0xKSAmJiAoJHNjb3BlLnBhY2thZ2Vfc3RhdHVzX2lkPT0wKSkKICAgIHsKICAgICAgbG9nRGVidWcoIndhcyBwYWlkL3BhcnRseSBwYWlkLCByZW1vdmluZyBwYXltZW50Iik7CiAgICAgIHJlbW92ZVBhY2thZ2VQYXltZW50KCRodHRwLCRzY29wZSwkc2NvcGUuZnBhY2thZ2UucGFja2FnZV91c2VyX2lkLCRzY29wZS5idXNpbmVzc191c2VyX2lkLHVwZGF0ZUV2ZW50UGFja2FnZV9zdWNjZXNzKTsKICAgIH0KICAgIC8vIHByZXZpb3VzIHBhY2thZ2Ugd2FzIHNlbGVjdGVkIC0gbm93IGEgZGlmZmVyZW50IHBhY2thZ2UgaXMgc2VsZWN0ZWQKICAgIGVsc2UgaWYgKCgkc2NvcGUucHJldmlvdXNfcGFja2FnZV9zdGF0dXNfaWQ9PTApICYmICgkc2NvcGUucGFja2FnZV9zdGF0dXNfaWQ9PS0xKSkKICAgIHsKICAgICAgbG9nRGVidWcoIndhcyBub3QgcGFpZCAtIG5vdyBwYXkgZnVsbHkvcGFydGlhbGx5Iik7CiAgICAgIHBheUZvclBhY2thZ2UoJGh0dHAsJHNjb3BlLCRzY29wZS5mcGFja2FnZS5wYWNrYWdlX3VzZXJfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwoKICAgICAgLy8gcmVhc3NpZ25FdmVudFBhY2thZ2VBc3NvY2lhdGlvbigkaHR0cCwkc2NvcGUsJHNjb3BlLmZtZWV0aW5nLmV2ZW50X2lkLCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MoKQogIHsKICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICAgIGxvZ0RlYnVnKCJicm9hZGNhc3RpbmcgY2xpZW50UGFnZVJlbG9hZERhdGEiKTsKICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKICB9Cgp9KTsKCmt1emVBcHAuY29udHJvbGxlcignZXZlbnRQYWNrYWdlQXNzb2NpYXRpb25Nb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRyb3V0ZVBhcmFtcywgJHJvb3RTY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRodHRwLCBmbWVldGluZywgYmFsYW5jZSwgYnVzaW5lc3NfdXNlcl9pZCwgdWlDYWxlbmRhckNvbmZpZykKewogICRzY29wZS5mbWVldGluZz1hbmd1bGFyLmNvcHkoZm1lZXRpbmcpOwogICRzY29wZS5iYWxhbmNlPWJhbGFuY2U7CiAgJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD0kc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkOwogICRzY29wZS5wcmV2aW91c19ldmVudF9wYXltZW50cz0kc2NvcGUuZm1lZXRpbmcuZXZlbnRfcGF5bWVudHM7CiAgJHNjb3BlLnByZXZpb3VzX2lzX2FsbF9wYWlkPSRzY29wZS5mbWVldGluZy5pc19hbGxfcGFpZDsKICAkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZD1idXNpbmVzc191c2VyX2lkOwoKICAvLyAnY2FsY3VsYXRpbmcnIHByZXZpb3VzIHN0YXR1cyBvZiBwYXltZW50CiAgaWYgKCRzY29wZS5wcmV2aW91c19ldmVudF9wYXltZW50cz4wKQogIHsKICAgIGlmICgkc2NvcGUucHJldmlvdXNfaXNfYWxsX3BhaWQ9PTEpCiAgICB7CiAgICAgICRzY29wZS5wcmV2aW91c19zdGF0dXM9ImlzX2FsbF9wYWlkIjsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgJHNjb3BlLnByZXZpb3VzX3N0YXR1cz0iaXNfcGFydGx5X3BhaWQiOwogICAgfQogIH0KICBlbHNlCiAgewogICAgICBpZiAoJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD4wKQogICAgICB7CiAgICAgICAgJHNjb3BlLnByZXZpb3VzX3N0YXR1cz0iaXNfcGFja2FnZV9wYWlkIjsKICAgICAgfQogICAgICBlbHNlCiAgICAgIHsKICAgICAgICAkc2NvcGUucHJldmlvdXNfc3RhdHVzPSJub3RfcGFpZCI7CiAgICAgIH0KICB9CiAgbG9nRGVidWcoInByZXZpb3VzX3N0YXR1cz0iKyRzY29wZS5wcmV2aW91c19zdGF0dXMpOwoKICBpZiAoKCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQ9PTApICYmICgkc2NvcGUuZm1lZXRpbmcuZXZlbnRfcGF5bWVudHM+MCkpCiAgewogICAgLy8gdGhpcyBpcyBhIGNhc2Ugd2hlcmUgcGF5bWVudCB3YXMgcGFydGx5IG9yIGZ1bGx5IG1hZGUgZnJvbSBiYWxhbmNlCiAgICAkc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkPS0xOwogICAgJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD0tMTsKICB9CgogIGxvZ0RlYnVnKCJldmVudFBhY2thZ2VBc3NvY2lhdGlvbk1vZGFsQ29udHJvbGxlciIpOwogIGdldFBhY2thZ2VzRm9yRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5idXNpbmVzc191c2VyX2lkLCRzY29wZS5mbWVldGluZy5ldmVudF9pZCwncmVsYXRlZFBhY2thZ2VzJyxnZXRQYWNrYWdlc0ZvckV2ZW50X3N1Y2Nlc3MpOyAvLyB3YXMgZ2V0QnVzaW5lc3NQYWNrYWdlCiAgZnVuY3Rpb24gZ2V0UGFja2FnZXNGb3JFdmVudF9zdWNjZXNzKCkKICB7CiAgfQoKICAkc2NvcGUuY2xvc2VNb2RhbCA9IGZ1bmN0aW9uKCkKICB7CiAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICB9OwogICRzY29wZS51cGRhdGVFdmVudFBhY2thZ2UgPSBmdW5jdGlvbigpCiAgewogICAgY29uc29sZS5sb2coInByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD0iKyRzY29wZS5mbWVldGluZy5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQpOwogICAgY29uc29sZS5sb2coInBhY2thZ2VfdXNlcl9pZD0iKyRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQpOwogICAgLy8gaWYgc2VsZWN0ZWQgcGFja2FnZSBpcyBsaWtlIHByZXZpb3VzIHBhY2thZ2UgLSBkbyBub3RoaW5nCiAgICBpZiAoKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ9PSRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQpKQogICAgewogICAgICBsb2dEZWJ1Zygic2VsZWN0ZWQgb3B0aW9uIGlzIGxpa2UgcHJldmlvdXMgb3B0aW9uIC0gZG8gbm90aGluZyIpOwogICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgICB9CiAgICAvLyBpZiBzZWxlY3RlZCBwYWNrYWdlIGlzIGxpa2UgcHJldmlvdXMgcGFja2FnZSAtIGRvIG5vdGhpbmcKICAgIGlmICgoJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD09JHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZCkgJiYgKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ+MCkpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJzZWxlY3RlZCBwYWNrYWdlIGlzIGxpa2UgcHJldmlvdXMgcGFja2FnZSAtIGRvIG5vdGhpbmciKTsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgfQogICAgLy8gcHJldmlvdXMgcGFja2FnZSB3YXMgc2VsZWN0IC0gbm93IG5vdGhpbmdzIGlzIHNlbGVjdGVkCiAgICBlbHNlIGlmICgoJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD4wKSAmJiAoJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZD09MCkpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJubyBwYWNrYWdlIHNlbGVjdGVkLCByZW1vdmUgcGFja2FnZS1ldmVudCBhc3NvY2lhdGlvbiIpOwogICAgICByZW1vdmVFdmVudFBhY2thZ2VBc3NvY2lhdGlvbigkaHR0cCwkc2NvcGUsJHNjb3BlLmZtZWV0aW5nLmV2ZW50X2lkLCRzY29wZS5idXNpbmVzc191c2VyX2lkLHVwZGF0ZUV2ZW50UGFja2FnZV9zdWNjZXNzKTsKICAgIH0KICAgIC8vIHByZXZpb3VzIHBhY2thZ2Ugd2FzIHNlbGVjdGVkIC0gbm93IGEgZGlmZmVyZW50IHBhY2thZ2UgaXMgc2VsZWN0ZWQKICAgIGVsc2UgaWYgKCgkc2NvcGUucHJldmlvdXNfcGFja2FnZV91c2VyX2lkPjApICYmICgkc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkPjApKQogICAgewogICAgICBsb2dEZWJ1ZygidXBkYXRpbmcgbmV3IHBhY2thZ2UgdG8gcGFja2FnZV91c2VyX2lkPSAiKyRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQpOwogICAgICByZWFzc2lnbkV2ZW50UGFja2FnZUFzc29jaWF0aW9uKCRodHRwLCRzY29wZSwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZCwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCx1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2Vzcyk7CiAgICB9CiAgICAvLyBwcmV2aW91cyBwYWNrYWdlIHdhcyBub25lIC0gbm93IGEgcGFja2FnZSBpcyBzZWxlY3RlZAogICAgZWxzZSBpZiAoKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ9PTApICYmICgkc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkPjApKQogICAgewogICAgICBsb2dEZWJ1ZygidXBkYXRpbmcgbmV3IHBhY2thZ2UgdG8gcGFja2FnZV91c2VyX2lkPSAiKyRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQpOwogICAgICByZWFzc2lnbkV2ZW50UGFja2FnZUFzc29jaWF0aW9uKCRodHRwLCRzY29wZSwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZCwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCx1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2Vzcyk7CiAgICB9CiAgICAvLyBwcmV2aW91cyBhc3NvY2lhdGlvbiB3YXMgcGFpZCBvciBoYWxmIHBhaWQgLSBub3cgaXRzIG5vbmUKICAgIGVsc2UgaWYgKCgkc2NvcGUucHJldmlvdXNfZXZlbnRfcGF5bWVudHM+MCkgJiYgKCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQ9PTApKQogICAgewogICAgICBsb2dEZWJ1ZygicmVtb3ZpbmcgcGF5bWVudCBmcm9tIGV2ZW50LCBwYWNrYWdlX3VzZXJfaWQ9ICIrJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZCk7CiAgICAgIHJlbW92ZUV2ZW50UGF5bWVudEFzc29jaWF0aW9uKCRodHRwLCRzY29wZSwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwoKICAgICAgLy8gcmVhc3NpZ25FdmVudFBhY2thZ2VBc3NvY2lhdGlvbigkaHR0cCwkc2NvcGUsJHNjb3BlLmZtZWV0aW5nLmV2ZW50X2lkLCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwogICAgICAvLyB0b2RvCiAgICB9CiAgICAvLyB3YXMgcGFja2FnZSBwYXltZW50IC0+IG5vdyBiYWxhbmNlIHBheW1lbnQKICAgIGVsc2UgaWYgKCgkc2NvcGUucHJldmlvdXNfcGFja2FnZV91c2VyX2lkPjApICYmICgkc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkPT0tMSkpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJtb3ZpbmcgcGF5bWVudCBmcm9tIHBhY2thZ2UgdG8gYmFsYW5jZSIpOwogICAgICBhZGRFdmVudFBheW1lbnRSZW1vdmVQYWNrYWdlKCRodHRwLCRzY29wZSwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwogICAgfQogICAgLy8gd2FzIGJhbGFuY2UgcGF5bWVudCAtPiBub3cgcGFja2FnZSBwYXltZW50CiAgICBlbHNlIGlmICgoJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD09LTEpICYmICgkc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkPjApKQogICAgewogICAgICBsb2dEZWJ1ZygibW92aW5nIHBheW1lbnQgZnJvbSBiYWxhbmNlIHRvIHBhY2thZ2UiKTsKICAgICAgYWRkRXZlbnRQYWNrYWdlUmVtb3ZlUGF5bWVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLmZtZWV0aW5nLmV2ZW50X2lkLCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwoKICAgIH0KICAgIC8vIHdhcyBub3QgcGFpZCBhdCBhbGwgLT4gbm93IGJhbGFuY2UgcGF5CiAgICBlbHNlIGlmICgoJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD09MCkgJiYgKCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQ9PS0xKSkKICAgIHsKICAgICAgbG9nRGVidWcoIm1vdmluZyBwYXltZW50IGZyb20gbm9uZSB0byBiYWxhbmNlIik7CiAgICAgIGFkZEV2ZW50UGF5bWVudEFzc29jaWF0aW9uKCRodHRwLCRzY29wZSwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MoKQogIHsKICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICAgIGxvZ0RlYnVnKCJicm9hZGNhc3RpbmcgY2xpZW50UGFnZVJlbG9hZERhdGEiKTsKICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKICB9Cgp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ2FyY2hpdmVfY2xpZW50X21vZGFsJywgZnVuY3Rpb24oJHNjb3BlLCAkbG9jYXRpb24sIGlzX2luc3RydWN0b3IsIGJ1c2luZXNzX3VzZXJfaWQsIGJ1c2VyX2ZpcnN0X25hbWUsIGJ1c2VyX2xhc3RfbmFtZSwgJHJvb3RTY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRodHRwLCB1aUNhbGVuZGFyQ29uZmlnKSB7CiAgJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQ9YnVzaW5lc3NfdXNlcl9pZDsKICAkc2NvcGUuYnVzZXJfZmlyc3RfbmFtZT1idXNlcl9maXJzdF9uYW1lOwogICRzY29wZS5idXNlcl9sYXN0X25hbWU9YnVzZXJfbGFzdF9uYW1lOwogICRzY29wZS5pc19pbnN0cnVjdG9yPWlzX2luc3RydWN0b3I7CgogIGxvZ0RlYnVnKCJhcmNoaXZlX2NsaWVudF9tb2RhbCBjb250cm9sbGVyIik7CgogICRzY29wZS5jbG9zZU1vZGFsID0gZnVuY3Rpb24oKSB7CiAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICB9OwoKICAkc2NvcGUuYXJjaGl2ZUNsaWVudCA9IGZ1bmN0aW9uKCkKICB7CiAgICBhcmNoaXZlQ2xpZW50KCRodHRwLCRzY29wZSwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCxhcmNoaXZlQ2xpZW50X3N1Y2Nlc3MpOwogICAgZnVuY3Rpb24gYXJjaGl2ZUNsaWVudF9zdWNjZXNzKCkKICAgIHsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgICBpZiAoJHNjb3BlLmlzX2luc3RydWN0b3IpCiAgICAgIHsKICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2luc3RydWN0b3JzJyk7CiAgICAgIH0KICAgICAgZWxzZSB7CiAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jbGllbnRzJyk7CiAgICAgIH0KICAgIH0KICB9Cgp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ3BheW1lbnlEZXRhaWxzTW9kYWxDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkcm91dGVQYXJhbXMsICRyb290U2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgZnBheW1lbnQsIHVpQ2FsZW5kYXJDb25maWcpIHsKICAkc2NvcGUuZnBheW1lbnQ9e307CiAgJHNjb3BlLmZwYXltZW50LnBheW1lbnRfZGF0ZT1mcGF5bWVudC5wYXltZW50X2RhdGU7CiAgJHNjb3BlLmZwYXltZW50LnBheW1lbnRfYW1vdW50PWZwYXltZW50LnBheW1lbnRfYW1vdW50OwogICRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2dlbmVyYXRlZD1mcGF5bWVudC5pbnZvaWNlX2dlbmVyYXRlZDsKICAkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9udW1iZXI9ZnBheW1lbnQuaW52b2ljZV9udW1iZXI7CiAgaWYgKGZwYXltZW50Lmludm9pY2VfZGF0ZT09bnVsbCkKICB7CiAgICAkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlX2Zvcm1hdD1uZXcgRGF0ZSgpOwogIH0KICBlbHNlCiAgewogICAgJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZV9mb3JtYXQ9ZnBheW1lbnQuaW52b2ljZV9kYXRlX2Zvcm1hdDsKICB9CiAgJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZT1mcGF5bWVudC5pbnZvaWNlX2RhdGU7CiAgJHNjb3BlLnNlbGVjdGVkUGF5bWVudE1ldGhvZD17CgkJbmFtZTogZnBheW1lbnQucGF5bWVudF9tZXRob2RfbmFtZV90eHQsCgkJbWV0aG9kOiBmcGF5bWVudC5wYXltZW50X21ldGhvZF9uYW1lCgl9OwogICRzY29wZS5pc1BheW1lbnRNZXRob2RTZWxlY3RlZD10cnVlOwoKICBsb2dEZWJ1Zygib2xkIGRhdGUgIiskc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlKTsKICBpZiAoJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZSE9bnVsbCkKICB7CiAgICAkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlX2Zvcm1hdCA9IG5ldyBEYXRlKCRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2RhdGUpOwogIH0KICAkc2NvcGUucGF5bWVudE1ldGhvZHMgPSBwYXltZW50TWV0aG9kczsKICAkc2NvcGUucGF5bWVudFR5cGVUaXRsZT1mcGF5bWVudC5wYXltZW50X21ldGhvZF9uYW1lX3R4dDsKICAkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9zb3VyY2U9IkVYVEVSTkFMIjsKCiAgbG9nRGVidWcoJHNjb3BlLnBheW1lbnRNZXRob2RzKTsKICBsb2dEZWJ1ZygicGF5bWVueURldGFpbHNNb2RhbENvbnRyb2xsZXIgZm9yIHBheW1lbnQgIitKU09OLnN0cmluZ2lmeShmcGF5bWVudCwgbnVsbCwgNCkpOwoKICAkc2NvcGUuc2VsZWN0UGF5bWVudE1ldGhvZCA9IGZ1bmN0aW9uKHBheW1lbnQpIHsKICAgICRzY29wZS5wYXltZW50VHlwZVRpdGxlPXBheW1lbnQubmFtZTsKICAgIGxvZ0RlYnVnKCJwYXltZW50PSIrcGF5bWVudCk7CgogICAgJHNjb3BlLnNlbGVjdGVkUGF5bWVudE1ldGhvZD1wYXltZW50OwogICAgJHNjb3BlLmlzUGF5bWVudE1ldGhvZFNlbGVjdGVkPXRydWU7CiAgfTsKCiAgJHNjb3BlLmNsb3NlTW9kYWwgPSBmdW5jdGlvbigpIHsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogIH07CgogICRzY29wZS51cGRhdGVQYXltZW50ID0gZnVuY3Rpb24oKQogIHsKICAgIC8vIGxvZ0RlYnVnKGN1cnJlbnRDbGllbnQpOwogICAgbG9nRGVidWcoInBheW1lbnQgbWV0aG9kIik7CiAgICBsb2dEZWJ1Zygkc2NvcGUuc2VsZWN0ZWRQYXltZW50TWV0aG9kKTsKICAgIGxvZ0RlYnVnKCIkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9nZW5lcmF0ZWQ9PCIrJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZ2VuZXJhdGVkKyI+LCAkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlX2Zvcm1hdD0iKyRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2RhdGVfZm9ybWF0KTsKICAgIGxvZ0RlYnVnKCIkc2NvcGUuc2VsZWN0ZWRQYXltZW50TWV0aG9kLm1ldGhvZD0iKyRzY29wZS5zZWxlY3RlZFBheW1lbnRNZXRob2QubWV0aG9kKTsKICAgIGlmICgoJHNjb3BlLmZwYXltZW50LnBheW1lbnRfYW1vdW50PT0wKSB8fCAoJHNjb3BlLmZwYXltZW50LnBheW1lbnRfYW1vdW50PT0nJykgfHwgKCRzY29wZS5mcGF5bWVudC5wYXltZW50X2Ftb3VudD09bnVsbCkpCiAgICB7CiAgICAgICRzY29wZS51c2VyRXJyb3I9IteQ16DXkCDXlNeW158g16HXm9eV150g15vXnNep15TXlSI7CiAgICAgIC8vIGFsZXJ0KCdzcycpOwogICAgfQogICAgZWxzZSBpZiAoISRzY29wZS5pc1BheW1lbnRNZXRob2RTZWxlY3RlZCkKICAgIHsKICAgICAgJHNjb3BlLnVzZXJFcnJvcj0i15DXoNeQINeR15fXqCDXkNee16bXoteZINeq16nXnNeV150iOwogICAgICAvLyBhbGVydCgnc3MnKTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgaWYgKCgkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9nZW5lcmF0ZWQhPTEpIHx8ICgkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlX2Zvcm1hdD09bnVsbCkpCiAgICAgIHsKICAgICAgICB2YXIgaW52b2ljZV9kYXRlX2Zvcm1hdCA9ICJudWxsIjsKICAgICAgfQogICAgICBlbHNlCiAgICAgIHsKICAgICAgICB2YXIgaW52b2ljZV9kYXRlX2Zvcm1hdCA9ICRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2RhdGVfZm9ybWF0LmdldERhdGUoKSAgKyAiLSIgKyAoJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZV9mb3JtYXQuZ2V0TW9udGgoKSsxKSArICItIiArICRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2RhdGVfZm9ybWF0LmdldEZ1bGxZZWFyKCk7CiAgICAgIH0KICAgICAgdGhlZGF0YT0gewogICAgICAgICAgYmFsYW5jZVRvUGF5OiAkc2NvcGUuZnBheW1lbnQucGF5bWVudF9hbW91bnQsCiAgICAgICAgICBwYXltZW50X21ldGhvZF9uYW1lOiAkc2NvcGUuc2VsZWN0ZWRQYXltZW50TWV0aG9kLm1ldGhvZCwKICAgICAgICAgIGludm9pY2VfbnVtYmVyOiAkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9udW1iZXIsCiAgICAgICAgICBpbnZvaWNlX2dlbmVyYXRlZDogJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZ2VuZXJhdGVkLAogICAgICAgICAgaW52b2ljZV9kYXRlOiBpbnZvaWNlX2RhdGVfZm9ybWF0LAogICAgICAgICAgaW52b2ljZV9zb3VyY2U6ICRzY29wZS5mcGF5bWVudC5pbnZvaWNlX3NvdXJjZQogICAgICB9OwogICAgICB1cGRhdGVQYXltZW50Rm9yQ2xpZW50KCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCxmcGF5bWVudC51c2VyX3BheW1lbnRfaWQsdGhlZGF0YSxjcmVhdGVQYXltZW50Rm9yQ2xpZW50X2NhbGxiYWNrLCBjcmVhdGVQYXltZW50Rm9yQ2xpZW50X2ZhaWx1cmUpOwogICAgICBmdW5jdGlvbiBjcmVhdGVQYXltZW50Rm9yQ2xpZW50X2NhbGxiYWNrKCkKICAgICAgewogICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICAgICAgICBsb2dEZWJ1ZygiYnJvYWRjYXN0aW5nIGNsaWVudFBhZ2VSZWxvYWREYXRhIik7CiAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGNyZWF0ZVBheW1lbnRGb3JDbGllbnRfZmFpbHVyZSgpCiAgICAgIHsKICAgICAgICBsb2dEZWJ1ZygiYnJvYWRjYXN0aW5nIGNsaWVudFBhZ2VSZWxvYWREYXRhIik7CiAgICAgICAgLy8gJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgICB9CiAgICB9CiB9Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignZXZlbnRUeXBlRXh0cmFGaWVsZHNNb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRyb290U2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgZXZlbnRUeXBlUHJvcGVydGllcywgdWlDYWxlbmRhckNvbmZpZykgewogICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzPWV2ZW50VHlwZVByb3BlcnRpZXM7CiAgbG9nRGVidWcoImV2ZW50VHlwZVByb3BlcnRpZXM9IitKU09OLnN0cmluZ2lmeShldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzLCBudWxsLCA0KSk7CiAgaWYgKGV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHM9PW51bGwpCiAgewogICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXNPcmlnPVtdOwogICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHM9W107CiAgfQogIGVsc2UgaWYgKGV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMubGVuZ3RoPjApCiAgewogICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXNPcmlnPShldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzKS5zbGljZSgwKTsKICB9CiAgZWxzZQogIHsKICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzT3JpZz1bXTsKICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzPVtdOwogIH0KICAkc2NvcGUub2tMaW1pdGF0aW9uTW9kYWwgPSBmdW5jdGlvbigpIHsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogIH07CgogICRzY29wZS5jYW5jZWwgPSBmdW5jdGlvbigpCiAgewogICAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcz0kc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllc09yaWc7CiAgICAgIGxvZ0RlYnVnKCJjbG9zZSIpOwogICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllc09yaWcpOwogIH0KICAkc2NvcGUuc2F2ZUFuZENsb3NlID0gZnVuY3Rpb24oKQogIHsKICAgIGxvZ0RlYnVnKCJzYXZlIGFuZCBjbG9zZSIpOwogICAgZnVuY3Rpb24gc2V0Q2xpZW50c0V4dHJhRmllbGRzX3N1Y2Nlc3MoKQogICAgewoKICAgIH0KICAgICRzY29wZS5DbGllbnRzRGV0YWlscz17fTsKICAgICRzY29wZS5DbGllbnRzRGV0YWlscy5leHRyYUZpZWxkcz0kc2NvcGUuZXh0cmFGaWVsZHM7CiAgICBzZXRDbGllbnRzRXh0cmFGaWVsZHMoJGh0dHAsJHNjb3BlLCRzY29wZS5DbGllbnRzRGV0YWlscyxzZXRDbGllbnRzRXh0cmFGaWVsZHNfc3VjY2Vzcyk7CiAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyk7CiAgfQoKICAkc2NvcGUuYWRkRXh0cmFGaWVsZHMgPSBmdW5jdGlvbigpCiAgewogICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyk7CiAgfQoKICAkc2NvcGUuZXh0cmFGaWVsZHMgPSBldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzOwogICRzY29wZS5maWVsZFR5cGVzID0gW3tmaWVsZF9kYXRhdHlwZTogIlRFWFRfQVJFQSIsIG5hbWU6J9eq15nXkdeqINeY16fXodeYJ30sIHtmaWVsZF9kYXRhdHlwZTogIk5VTUJFUiIsIG5hbWU6J9ee16HXpNeoJ30gLCB7ZmllbGRfZGF0YXR5cGU6ICJTVFJJTkciLCBuYW1lOifXmNen16HXmCDXp9em16gnfSAsIHtmaWVsZF9kYXRhdHlwZTogIkJPT0xFQU4iLCBuYW1lOifXqteZ15HXqiDXodeZ157XldefJ30gLCB7ZmllbGRfZGF0YXR5cGU6ICJEQVRFIiwgbmFtZTon16rXkNeo15nXmid9XTsKCiAgJHNjb3BlLmFkZE5ld0ZpZWxkID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgbmV3SXRlbU5vID0gJHNjb3BlLmV4dHJhRmllbGRzLmxlbmd0aCsxOwogICAgJHNjb3BlLmV4dHJhRmllbGRzLnB1c2goeyJmaWVsZF9kYXRhdHlwZSI6IlNUUklORyIsImlzX21hbmRhdG9yeSI6MCwgImZyb21kYiI6IGZhbHNlLCAiZmllbGRfaWQiOiAwLCAiaXNfYWN0aXZlIjogMSwgIm1vZGlmaWVkIjogMH0pOwoKICAgIGxvZ0RlYnVnKCJleHRyYSBmaWVsZHMgIiArIEpTT04uc3RyaW5naWZ5KCRzY29wZS5leHRyYUZpZWxkcywgbnVsbCwgMikpOwoKICB9OwoKICAkc2NvcGUucmVtb3ZlRmllbGQgPSBmdW5jdGlvbihjaG9pY2UpCiAgewogICAgLy8gcmVtb3ZpbmcgZmllbGQKICAgIC8vIGlmIGl0cyBub3Qgb3JpZ2luYXRlZCBmcm9tIGRhdGFiYXNlIC0gdGhlbiB3ZSBzaW1wbHkgZGVsZXRlIGl0IGZyb20gdGhlIGFycmF5CiAgICAvLyBvdGhlcndpc2Ugd2UgbWFyayBpdCBhcyBhY3RpdmU9ZmFsc2UKICAgIGxvZ0RlYnVnKGNob2ljZSk7CiAgICAvLyB2YXIgbGFzdEl0ZW0gPSAoY2hvaWNlLmlkKS0xOy8vJHNjb3BlLmNob2ljZXMubGVuZ3RoLTE7CiAgICAvLyAkc2NvcGUuY2hvaWNlcy5zcGxpY2UobGFzdEl0ZW0sMSk7CiAgICBmb3IodmFyIGkgPSAwOyBpIDwgJHNjb3BlLmV4dHJhRmllbGRzLmxlbmd0aDsgaSsrKQogICAgewogICAgICBpZiAoJHNjb3BlLmV4dHJhRmllbGRzW2ldID09IGNob2ljZSkKICAgICAgewogICAgICAgIGlmIChjaG9pY2UuZnJvbWRiPT1mYWxzZSkKICAgICAgICB7CiAgICAgICAgICAvLyBpZiBub3QgZnJvbSBkYiAtIHJlbW92aW5nIGl0IGZyb20gdGhlIGFycmF5IG9mIGV4dHJhLWZpZWxkcwogICAgICAgICAgJHNjb3BlLmV4dHJhRmllbGRzLnNwbGljZShpLCAxKTsKICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgIC8vIGlmIGZpZWxkIG9yaWdpbmF0ZWQgZnJvbSBkYiAtIHRoYW4gd2UgZG9udCByZW1vdmUgaXQgZnJvbSB0aGUgYXJyYXkKICAgICAgICAgIC8vIGFuZCBtYXJrIGl0IGFzIGFjdGl2ZT1mYWxzZSBzbyB0aGF0IGl0IGNhbiBiZSBoYW5kZWxlZCBvbiB0aGUgc2VydmVyCiAgICAgICAgICBjaG9pY2UuaXNfYWN0aXZlPTA7CiAgICAgICAgICBjaG9pY2UubW9kaWZpZWQ9dHJ1ZTsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICB9Owp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ2V2ZW50Q2xvc2VJZ25vcmVNYW5kYXRvcnlGaWVsZHNNb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRyb3V0ZVBhcmFtcywgJHJvb3RTY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRodHRwLCBjdXJyZW50RXZlbnQsIHVpQ2FsZW5kYXJDb25maWcpIHsKICAkc2NvcGUuY3VycmVudEV2ZW50PWN1cnJlbnRFdmVudDsKCiAgJHNjb3BlLm9rQ2FuY2VsID0gZnVuY3Rpb24oKSB7CiAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICB9OwoKICAkc2NvcGUuY2xvc2VFdmVudElnbm9yZU1hbmRhdG9yeUZpZWxkcyA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1ZygiaWdub3JlIG1hbmRhdG9yeSBleHRyYSBmaWVsZHMgYW5kIGNsb3NlIGV2ZW50Iik7CiAgICAkc2NvcGUuY3VycmVudEV2ZW50Lmlnbm9yZUV4dHJhRmllbGRzVmFsaWRhdGlvbj10cnVlOwogICAgY2xvc2VFdmVudCgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLCRzY29wZS5jdXJyZW50RXZlbnQsYWZ0ZXJDbG9zZUV2ZW50LGFmdGVyQ2xvc2VFdmVudCk7CiAgICBmdW5jdGlvbiBhZnRlckNsb3NlRXZlbnQoKQogICAgewogICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2V2ZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgfTsKICB9Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignZXZlbnRUeXBlQ2hhbmdlZFBvcHVwQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRsb2NhdGlvbiwgJHNjb3BlLCAkcm91dGVQYXJhbXMsICRyb290U2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgZXZlbnRUeXBlUHJvcGVydGllcywgdWlDYWxlbmRhckNvbmZpZykgewogICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzPWV2ZW50VHlwZVByb3BlcnRpZXM7CiAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMudXBkYXRlZF9mcm9tX2RhdGU9bmV3IERhdGUoKTsKICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy51cGRhdGVfZXhpc3RpbmdfZXZlbnRzPWZhbHNlOwoKICAkc2NvcGUuY2xvc2VNb2RhbCA9IGZ1bmN0aW9uKCkgewogICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgfTsKCiAgJHNjb3BlLnVwZGF0ZUV2ZW50VHlwZSA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1ZygidXBkYXRlIEV2ZW50IFR5cGUgIiArICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV2ZW50X3R5cGVfaWQpOwogICAgaWYgKCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF9yZWdpc3RyYXRpb25zPT0nJykKICAgIHsKICAgICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMubWF4X3JlZ2lzdHJhdGlvbnM9MDsKICAgIH0KICAgIHVwZGF0ZUV2ZW50VHlwZSgkaHR0cCwkc2NvcGUsJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXZlbnRfdHlwZV9pZCwkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcyx1cGRhdGVFdmVudFR5cGVfc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiB1cGRhdGVFdmVudFR5cGVfc3VjY2VzcygpCiAgICB7CiAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICAgICAgJGxvY2F0aW9uLnBhdGgoJy9ldmVudF90eXBlcycpOwogICAgfQogIH0KCn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignY2xhc3NEZWxldGVBbGxNb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRyb290U2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgY3VycmVudEV2ZW50LCB1aUNhbGVuZGFyQ29uZmlnKQp7CiAgbG9nRGVidWcoImNvbnRyb2xsZXI6IGNsYXNzRGVsZXRlQWxsTW9kYWxDb250cm9sbGVyIik7CiAgJHNjb3BlLmN1cnJlbnRFdmVudD1jdXJyZW50RXZlbnQ7CiAgJHNjb3BlLmNsb3NlTW9kYWwgPSBmdW5jdGlvbigpCiAgewogICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgfTsKCgogICRzY29wZS5kZWxldGVDbGFzc0V2ZW50U2luZ2xlPWZ1bmN0aW9uICgpIC8vIGRlbGV0ZSBvbmx5IG9uZS9jdXJyZW50IGNsYXNzIGV2ZWh0CiAgewogICAgY2FuY2VsQ2xhc3NFdmVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCxjYW5jZWxDbGFzc0V2ZW50X2NhbGxiYWNrLCBjYW5jZWxDbGFzc0V2ZW50X2NhbGxiYWNrKTsKICAgIGZ1bmN0aW9uIGNhbmNlbENsYXNzRXZlbnRfY2FsbGJhY2soKQogICAgewogICAgICBnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkKTsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ3JlbG9hZEV2ZW50Jyx7ZXZlbnRfaWQgOiAkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkfSk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCiAgICB9CiAgfQogICRzY29wZS5kZWxldGVDbGFzc0V2ZW50c0FsbD1mdW5jdGlvbiAoKSAvLyBkZWxldGUgYWxsIHJlcGVhdGluZyBldmVudHMKICB7CiAgICBjYW5jZWxDbGFzc1JlcGVhdGluZ0V2ZW50KCRodHRwLCRzY29wZSwwLCRzY29wZS5jdXJyZW50RXZlbnQucmVwZWF0X2V2ZW50X2lkLGNhbmNlbENsYXNzRXZlbnRfY2FsbGJhY2ssIGNhbmNlbENsYXNzRXZlbnRfY2FsbGJhY2spOwogICAgZnVuY3Rpb24gY2FuY2VsQ2xhc3NFdmVudF9jYWxsYmFjaygpCiAgICB7CiAgICAgIGdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQpOwogICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgncmVsb2FkRXZlbnQnLHtldmVudF9pZCA6ICRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWR9KTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKICAgIH0KICB9CiAgJHNjb3BlLmRlbGV0ZUNsYXNzRXZlbnRzQWxsU3RhcnRpbmdFdmVudElEPWZ1bmN0aW9uICgpIC8vIGRlbGV0ZSBhbGwgcmVwZWF0aW5nIGV2ZW50cyBzdGFydGluZyBldmVudF9pZAogIHsKICAgIGNhbmNlbENsYXNzUmVwZWF0aW5nRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQsJHNjb3BlLmN1cnJlbnRFdmVudC5yZXBlYXRfZXZlbnRfaWQsY2FuY2VsQ2xhc3NFdmVudF9jYWxsYmFjaywgY2FuY2VsQ2xhc3NFdmVudF9jYWxsYmFjayk7CiAgICBmdW5jdGlvbiBjYW5jZWxDbGFzc0V2ZW50X2NhbGxiYWNrKCkKICAgIHsKICAgICAgLy8gZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCk7CiAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdyZWxvYWRFdmVudCcse2V2ZW50X2lkIDogJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZH0pOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgfQogIH0KCn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignYnVzaW5lc3NfbW9kYWxfbGltaXRhdGlvbl9jcmVhdGUnLCBmdW5jdGlvbigkc2NvcGUsICRyb290U2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgc3RhcnQsZW5kLCBmaXhlZFNjaGVkdWxlLCB1aUNhbGVuZGFyQ29uZmlnKSB7CgogICRzY29wZS5maXhlZFNjaGVkdWxlPWZpeGVkU2NoZWR1bGU7CiAgJHNjb3BlLm9yaWdpbmFsX3N0YXJ0PXN0YXJ0OwogICRzY29wZS5vcmlnaW5hbF9lbmQ9ZW5kOwoKICAkc2NvcGUuc3RhcnQ9bmV3IG1vbWVudChzdGFydCkqMTAwMDsKICAkc2NvcGUuZW5kPW5ldyBtb21lbnQoZW5kKSoxMDAwOwogIGNvbnNvbGUubG9nKCdzdGFydD0nK3N0YXJ0KTsKICBjb25zb2xlLmxvZygnZW5kPScrZW5kKTsKCiAgZ2V0QnVzaW5lc3NMb2NhdGlvbnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19sb2NhdGlvbnMnLGdldEJ1c2luZXNzTG9jYXRpb25zX3N1Y2Nlc3MpOwogIGZ1bmN0aW9uIGdldEJ1c2luZXNzTG9jYXRpb25zX3N1Y2Nlc3MoKQogIHsKICAgICRzY29wZS5uZXdFdmVudERldGFpbHMubG9jYXRpb25faWQ9JHNjb3BlLmJ1c2luZXNzX2xvY2F0aW9uc1swXS5sb2NhdGlvbl9pZDsKICB9CgogIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc3RhcnQpOwogIHNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKGVuZCk7CiAgbG9nRGVidWcoInNlbGVjdGVkRGF0ZVN0YXJ0ID0gIitzZWxlY3RlZERhdGVTdGFydCk7CiAgdmFyIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZSgpICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKICB2YXIgc2VsZWN0ZWREYXRlRW5kID0gbmV3IERhdGUoc2VsZWN0ZWREYXRlRW5kLmdldFRpbWUoKSArIHNlbGVjdGVkRGF0ZUVuZC5nZXRUaW1lem9uZU9mZnNldCgpICogNjAwMDApOwoKICAvLyBsb2dEZWJ1ZygiZGF0ZT0iICsgc2VsZWN0ZWREYXRlU3RhcnQpOwogICRzY29wZS5zZWxlY3RlZEV2ZW50ID0gW107CiAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscyA9IFtdOwogICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRIb3VycygpOwogICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcyA9IChzZWxlY3RlZERhdGVTdGFydC5nZXRNaW51dGVzKCkgPCAxMCA/ICcwJyA6ICcnKSArIHNlbGVjdGVkRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRvdyA9IGRheU5hbWVzW3NlbGVjdGVkRGF0ZVN0YXJ0LmdldERheSgpXTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRhdGUgPSBzZWxlY3RlZERhdGVTdGFydDsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoID0gbW9udGhOYW1lc1tzZWxlY3RlZERhdGVTdGFydC5nZXRNb250aCgpXTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoMTEyID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TW9udGgoKSsxOwogICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aCA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldERhdGUoKTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXIgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRGdWxsWWVhcigpOwogICRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZV9pbnB1dF9mb3JtYXQ9IG5ldyBEYXRlKDE5NzAsIDAsIDEsICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMsICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcywgMCk7CgogICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzID0gc2VsZWN0ZWREYXRlRW5kLmdldEhvdXJzKCk7CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcyA9IChzZWxlY3RlZERhdGVFbmQuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBzZWxlY3RlZERhdGVFbmQuZ2V0TWludXRlcygpOwoKCiAgJHNjb3BlLmNhbmNlbCA9IGZ1bmN0aW9uKCkgewogICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgfTsKCiAgZ2V0QWxsSW5zdHJ1Y3RvcnMoJGh0dHAsJHNjb3BlLCdpbnN0cnVjdG9ycycsZ2V0QWxsSW5zdHJ1Y3RvcnNfc3VjY2Vzcyk7CiAgZnVuY3Rpb24gZ2V0QWxsSW5zdHJ1Y3RvcnNfc3VjY2VzcygpCiAgewogICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pbnN0cnVjdG9yX2lkPSRzY29wZS5pbnN0cnVjdG9yc1swXS5idXNpbmVzc191c2VyX2lkOwogIH0KICBnZXROb0NsYXNzRXZlbnRUeXBlc05vQWRtaW4oJGh0dHAsJHNjb3BlLCdyZWxhdGVkRXZlbnRUeXBlcycpOwoKICAkc2NvcGUuY3JlYXRlTmV3TGltaXRhdGlvbiA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1ZygiZnVuY3Rpb246IGNyZWF0ZU5ld0xpbWl0YXRpb24iKTsKICAgIGNhbGVuZGFyID0gJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnOwoKICAgIGlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudFR5cGVzLmxlbmd0aDwxKQogICAgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBpZiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnM8JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykKICAgIHsKICAgICAgYWxlcnQoIteW157XnyDXodeZ15XXnSDXnNek16DXmSDXltee158g15TXqteX15zXlCIpOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBpZiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnM9PSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMpCiAgICB7CiAgICAgIGlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzPD0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpCiAgICAgIHsKICAgICAgICBhbGVydCgi15bXntefINeh15nXldedINec16TXoNeZINeW157XnyDXlNeq15fXnNeUIik7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIGlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzPCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMrMTApKQogICAgICB7CiAgICAgICAgYWxlcnQoIteR15zXldenINen15jXnyDXni0xMCDXk9en15XXqiIpOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfQogICAgaWYgKCFrdXplSXNDYWxlbmRhckRyYWdnYmxlKSB7CiAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigndW5zZWxlY3QnKTsKICAgIH0KICAgIGxvZ0RlYnVnKCJzdGFydD0iICsgc3RhcnQpOwogICAgY2hlY2tEYXRlID0gbmV3IERhdGUoc3RhcnQpOwogICAgbG9nRGVidWcoImNoZWNrIGRhdGUgPSAiICsgY2hlY2tEYXRlKQogICAgbG9nRGVidWcoImVuZD0iICsgZW5kKTsKICAgIGVjb2xvcj0iIzAwYTY1YSI7CgogICAgaWYgKGNoZWNrRGF0ZS5nZXRGdWxsWWVhcigpID09IDE5NzApIHsKICAgICAgICBkYXlfbGltaXRfaWQgPSAtMTsKICAgIH0gZWxzZSB7CiAgICAgICAgZGF5X2xpbWl0X2lkID0gMTsKICAgIH0KCiAgICAvLyB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tdLmZ1bGxDYWxlbmRhcigncmVyZW5kZXJFdmVudHMnKTsKCiAgICB0ZW1wX2xpbWl0X2lkID0gY2FsY190ZW1wX2xpbWl0X2lkKCk7CgogICAgbG9nRGVidWcoJHNjb3BlLnNlbGVjdGVkRXZlbnRUeXBlc1swXSk7CiAgICBsb2dEZWJ1Zygkc2NvcGUuc2VsZWN0ZWRFdmVudFR5cGVzWzBdLmV2ZW50X3R5cGVfaWQpOwoKICAgIHN0YXJ0X3BhcmFtPXN0YXJ0OwogICAgZW5kX3BhcmFtPWVuZDsKICAgIHRpdGxlX3BhcmFtPScnOwogICAgbG9nRGVidWcoImFkZExpbWl0YXRpb25Ub0RhdGFiYXNlIHN0YXJ0PSIgKyBzdGFydF9wYXJhbSArICIsIGVuZD0iICsgIiwgdGl0bGU9IiArIHRpdGxlX3BhcmFtICk7CgogICAgdGhlZGF0YSA9IHsKICAgICAgICBzdGFydF9kYXRlOiAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWUsCiAgICAgICAgZW5kX2RhdGU6ICRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kX3RpbWUsCiAgICAgICAgY29sb3I6IGVjb2xvciwKICAgICAgICB0ZW1wX2xpbWl0X2lkOiB0ZW1wX2xpbWl0X2lkLAogICAgICAgIGVtcF9pZDogJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pbnN0cnVjdG9yX2lkLAogICAgICAgIGxvY2F0aW9uX2lkOiAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmxvY2F0aW9uX2lkLAogICAgICAgIGV2ZW50X3R5cGVfaWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50VHlwZXNbMF0uZXZlbnRfdHlwZV9pZCwKICAgICAgICBldmVudF90eXBlczogJHNjb3BlLnNlbGVjdGVkRXZlbnRUeXBlcywKICAgICAgICB0aXRsZTogdGl0bGVfcGFyYW0KICAgIH07CgogICAgaWYgKCRzY29wZS5maXhlZFNjaGVkdWxlKSAvLyBmaXhlZCBzY2hlZHVsZSB2cyBzcGVjaWZpYyB3ZWVkL2RheSBsaW1pdGF0aW9uCiAgICB7CiAgICAgIGNyZWF0ZUNhbGVuZGFyTGltaXRhdGlvbigkaHR0cCwkc2NvcGUsdGhlZGF0YSxsaW1pdGF0aW9uX3N1Y2Nlc3NfY2FsbGJhY2spOwogICAgfQogICAgZWxzZQogICAgewogICAgICBjcmVhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXkoJGh0dHAsJHNjb3BlLHRoZWRhdGEsbGltaXRhdGlvbl9zdWNjZXNzX2NhbGxiYWNrKTsKICAgIH0KICAgIGZ1bmN0aW9uIGxpbWl0YXRpb25fc3VjY2Vzc19jYWxsYmFjaygpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJzdWNjZXNzIik7CiAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuZGlzbWlzcygpOwogICAgfQoKICB9CgogICRzY29wZS5zdGFydE1pbnV0ZXMgPSBmdW5jdGlvbigpCiAgewogICAgbG9nRGVidWcoInN0YXJ0TWludXRlcyAiKygkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpKTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcz1taW51dGVzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpOwogICAgY2FsY3VsYXRlU3RhcnRUaW1lKCk7CiAgfQogICRzY29wZS5zdGFydEhvdXJzID0gZnVuY3Rpb24oKQogIHsKICAgIGxvZ0RlYnVnKCJzdGFydEhvdXJzICIraG91cnNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMpKTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnM9aG91cnNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMpOwogICAgY2FsY3VsYXRlU3RhcnRUaW1lKCk7CiAgfQogICRzY29wZS5lbmRNaW51dGVzID0gZnVuY3Rpb24oKQogIHsKICAgIGxvZ0RlYnVnKCJlbmRNaW51dGVzICIrKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpKTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXM9bWludXRlc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcyk7CiAgICBjYWxjdWxhdGVFbmRUaW1lKCk7CiAgfQogICRzY29wZS5lbmRIb3VycyA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1ZygiZW5kSG91cnMgIitob3Vyc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMpKTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzPWhvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vycyk7CiAgICBjYWxjdWxhdGVFbmRUaW1lKCk7CiAgfQoKCiAgZnVuY3Rpb24gY2FsY3VsYXRlU3RhcnRUaW1lKCkKICB7CiAgICBldmVudFllYXI9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyOwogICAgZXZlbnRNb250aD0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoMTEyOwogICAgZXZlbnREYXk9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXlvZm1vbnRoOwogICAgaWYgKHBhcnNlSW50KGV2ZW50TW9udGgpPDEwKQogICAgewogICAgICBldmVudE1vbnRoPSIwIitldmVudE1vbnRoOwogICAgfQogICAgaWYgKHBhcnNlSW50KGV2ZW50RGF5KTwxMCkKICAgIHsKICAgICAgZXZlbnREYXk9IjAiK2V2ZW50RGF5OwogICAgfQogICAgbG9nRGVidWcoIiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0eWVhcj0iK2V2ZW50WWVhcik7CiAgICBsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXlvZm1vbnRoPSIrZXZlbnRNb250aCk7CiAgICBsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aD0iK2V2ZW50RGF5KTsKICAgIG5ld19zdGFydD1tb21lbnQudXRjKGV2ZW50WWVhcisiLSIrZXZlbnRNb250aCsiLSIrZXZlbnREYXkrIlQwMDowMDowMCIpLmFkZCgoKHBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMpKjYwKStwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpKSwgJ21pbnV0ZXMnKTsKICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZT1uZXdfc3RhcnQ7CiAgICBsb2dEZWJ1ZygibmV3X3N0YXJ0PSIrbmV3X3N0YXJ0KTsKICB9CiAgZnVuY3Rpb24gY2FsY3VsYXRlRW5kVGltZSgpCiAgewogICAgZXZlbnRZZWFyPSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0eWVhcjsKICAgIGV2ZW50TW9udGg9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aDExMjsKICAgIGV2ZW50RGF5PSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aDsKICAgIGlmIChwYXJzZUludChldmVudE1vbnRoKTwxMCkKICAgIHsKICAgICAgZXZlbnRNb250aD0iMCIrZXZlbnRNb250aDsKICAgIH0KICAgIGlmIChwYXJzZUludChldmVudERheSk8MTApCiAgICB7CiAgICAgIGV2ZW50RGF5PSIwIitldmVudERheTsKICAgIH0KICAgIGxvZ0RlYnVnKCIkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXI9IitldmVudFllYXIpOwogICAgbG9nRGVidWcoIiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aD0iK2V2ZW50TW9udGgpOwogICAgbG9nRGVidWcoIiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bW9udGg9IitldmVudERheSk7CiAgICBuZXdfZW5kPW1vbWVudC51dGMoZXZlbnRZZWFyKyItIitldmVudE1vbnRoKyItIitldmVudERheSsiVDAwOjAwOjAwIikuYWRkKCgocGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMpKjYwKStwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzKSksICdtaW51dGVzJyk7CiAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZF90aW1lPW5ld19lbmQ7CiAgICBsb2dEZWJ1ZygibmV3X2VuZD0iK25ld19lbmQpOwogIH0KCiAgY2FsY3VsYXRlU3RhcnRUaW1lKCk7CiAgY2FsY3VsYXRlRW5kVGltZSgpOwoKICBmdW5jdGlvbiBtaW51dGVzQ2hhbmdlZCh0aGVtaW51dGVzKQogIHsKICAgIGxvZ0RlYnVnKCJ0aGVtaW51dGVzPSIrdGhlbWludXRlcyk7CiAgICBpZiAodHlwZW9mIHRoZW1pbnV0ZXM9PSJ1bmRlZmluZWQiKQogICAgewogICAgICByZXR1cm4gIjAwIjsKICAgIH0KICAgIHRoZW1pbnV0ZXM9cGFyc2VJbnQodGhlbWludXRlcyk7CiAgICBpZiAodGhlbWludXRlcz42MCkKICAgIHsKICAgICAgcmV0dXJuICIwMCI7CiAgICB9CiAgICBlbHNlIGlmICh0aGVtaW51dGVzPDApCiAgICB7CiAgICAgIHJldHVybiAiMDAiOwogICAgfQogICAgZWxzZSBpZiAodGhlbWludXRlcz09IiIpCiAgICB7CiAgICAgIHJldHVybiAiMDAiOwogICAgfQogICAgZWxzZSBpZiAodGhlbWludXRlczwxMCkKICAgIHsKICAgICAgcmV0dXJuICIwIit0aGVtaW51dGVzOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIHJldHVybiB0aGVtaW51dGVzOwogICAgfQogIH0KICBmdW5jdGlvbiBob3Vyc0NoYW5nZWQodGhlaG91cnMpCiAgewogICAgbG9nRGVidWcoInRoZWhvdXJzPSIrdGhlaG91cnMpOwogICAgaWYgKHR5cGVvZiB0aGVob3Vycz09InVuZGVmaW5lZCIpCiAgICB7CiAgICAgIHJldHVybiAiMCI7CiAgICB9CiAgICB0aGVob3Vycz1wYXJzZUludCh0aGVob3Vycyk7CiAgICBpZiAodGhlaG91cnM+MjQpCiAgICB7CiAgICAgIHJldHVybiAwOwogICAgfQogICAgZWxzZSBpZiAodGhlaG91cnM8MCkKICAgIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CiAgICBlbHNlIGlmICh0aGVob3Vycz09IiIpCiAgICB7CiAgICAgIHJldHVybiAiMCI7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgcmV0dXJuIHRoZWhvdXJzOwogICAgfQogIH0KfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2NsYXNzQ2xvc2VNb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRyb290U2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgZXZlbnRfaWQsIHVpQ2FsZW5kYXJDb25maWcpIHsKICBnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnc2VsZWN0ZWRFdmVudCcsZXZlbnRfaWQsYWZ0ZXJHZXRDbGllbnRTcGVjaWZpY0V2ZW50KTsKICBmdW5jdGlvbiBhZnRlckdldENsaWVudFNwZWNpZmljRXZlbnQoKQogIHsKICAgIGZvciAoaSA9IDA7IGkgPCAkc2NvcGUuc2VsZWN0ZWRFdmVudC5ldmVudFVzZXJzLmxlbmd0aDsgaSsrKQogICAgewogICAgICBpZiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRVc2Vyc1tpXS5zdGF0dXNfbmFtZSE9JGdVc2VyX3N0YXR1c19hYnNlbnRlZCkKICAgICAgewogICAgICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50VXNlcnNbaV0ucGFydGljaXBhdGVkPXRydWU7CiAgICAgIH0KICAgICAgaWYgKCRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50VXNlcnNbaV0uaXNfd2FpdGluZ19saXN0PT0xKQogICAgICB7CiAgICAgICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRVc2Vyc1tpXS5wYXJ0aWNpcGF0ZWQ9ZmFsc2U7CiAgICAgIH0KICAgIH0KICAgIGxvZ0RlYnVnKCRzY29wZS5zZWxlY3RlZEV2ZW50KTsKICB9CgogIC8vIGNsaWNrZWQgcm93IC0gY2hlY2svdW5jaGVjayB0aGUgY2hlY2tib3ggb2YgYSB1c2VyCiAgJHNjb3BlLnJvd0NsaWNrZWQgPSBmdW5jdGlvbihvYmopCiAgewogICAgbG9nRGVidWcoJ3JvdyBjbGlja2VkJyk7CiAgICBvYmoucGFydGljaXBhdGVkID0gIW9iai5wYXJ0aWNpcGF0ZWQ7CiAgfTsKCiAgJHNjb3BlLm9rTGltaXRhdGlvbk1vZGFsID0gZnVuY3Rpb24oKSB7CiAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICB9OwoKICAkc2NvcGUuY2xvc2VDbGFzcyA9IGZ1bmN0aW9uKCkKICB7CiAgICBjbG9zZUNsYXNzRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50X2lkLCRzY29wZS5zZWxlY3RlZEV2ZW50LGFmdGVyQ2xvc2VFdmVudCxhZnRlckNsb3NlRXZlbnQpOwogICAgZnVuY3Rpb24gYWZ0ZXJDbG9zZUV2ZW50KCkKICAgIHsKICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdyZWxvYWRFdmVudCcse2V2ZW50X2lkIDogJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRfaWR9KTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKICAgIH07CiAgfQp9KTsKCmt1emVBcHAuY29udHJvbGxlcignYnVzaW5lc3NDbGllbmRDYXJkUGF5bWVudCcsIGZ1bmN0aW9uKCRzY29wZSwgJHJvdXRlUGFyYW1zLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIGN1cnJlbnRDbGllbnQsIGlzcGx1cywgdWlDYWxlbmRhckNvbmZpZywgQnVzaW5lc3NDb25maWcpCnsKICAkc2NvcGUuaXNwbHVzPWlzcGx1czsKICBsb2dEZWJ1ZygnYnVzaW5lc3NDbGllbmRDYXJkUGF5bWVudCBpc3BsdXM9JyAraXNwbHVzKyIgY3VycmVudENsaWVudD0iKyBKU09OLnN0cmluZ2lmeShjdXJyZW50Q2xpZW50LCBudWxsLCAyKSk7CiAgJHNjb3BlLmt1emVJc0xvYWRpbmc9ZmFsc2U7CiAgbG9nRGVidWcoJ2N1cnJlbnRDbGllbnQucGF5bWVudF9iYWxhbmNlPScrY3VycmVudENsaWVudC5wYXltZW50X2JhbGFuY2UrIixjdXJyZW50Q2xpZW50LnVucGFpZF9iYWxhbmNlID0iK2N1cnJlbnRDbGllbnQudW5wYWlkX2JhbGFuY2UpOwogIHRoZWJhbGFuY2UgPSBjdXJyZW50Q2xpZW50LnBheW1lbnRfYmFsYW5jZS1jdXJyZW50Q2xpZW50LnVucGFpZF9iYWxhbmNlOwogIGxvZ0RlYnVnKCd0aGViYWxhbmNlPScrdGhlYmFsYW5jZSk7CiAgaWYgKHRoZWJhbGFuY2U8MCkKICB7CiAgICAkc2NvcGUuYmFsYW5jZVRvUGF5PU1hdGguYWJzKHRoZWJhbGFuY2UpOwogIH0KICBlbHNlCiAgewogICAgJHNjb3BlLmJhbGFuY2VUb1BheT0wOwogIH0KICAkc2NvcGUucGF5bWVudFR5cGVUaXRsZT0i15HXl9eoIjsKICAkc2NvcGUuY3VycmVudENsaWVudD1jdXJyZW50Q2xpZW50OwogIGxvZ0RlYnVnKCRzY29wZS5jdXJyZW50Q2xpZW50KTsKICAkc2NvcGUuYnVzaW5lc3NDb25maWcgPSBCdXNpbmVzc0NvbmZpZy5nZXQoKTsKICAkc2NvcGUuYnVzaW5lc3NDb25maWcudGhlbihmdW5jdGlvbiAoY29uZmlnKSB7CiAgICAkc2NvcGUuaW52b2ljZV9zb3VyY2VfaWQgPSBjb25maWcuaW52b2ljZV9zb3VyY2VfaWQ7CiAgICAkc2NvcGUuaGFzVmF0ID0gY29uZmlnLnZhdF9yYXRlID4gMDsKICB9KTsKCiAgJHNjb3BlLmNsb3NlTW9kYWwgPSBmdW5jdGlvbigpIHsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogIH07CgogICRzY29wZS5leHRlcm5hbF9pbnZvaWNlX2dlbmVyYXRlZD1mYWxzZTsKICAkc2NvcGUuaW52b2ljZV9kYXRlX2Zvcm1hdD1uZXcgRGF0ZSgpOwoKICBnZXROZXh0SW52b2ljZU51bWJlcigkaHR0cCwkc2NvcGUsJHNjb3BlLmN1cnJlbnRDbGllbnQuYnVzaW5lc3NfdXNlcl9pZCwnaW52b2ljZV9udW1iZXInKTsKCiAgJHNjb3BlLnBheW1lbnRNZXRob2RzID0gcGF5bWVudE1ldGhvZHM7CiAgJHNjb3BlLmNyZWRpdENhcmRUeXBlcyA9IGNyZWRpdENhcmRUeXBlczsKICAkc2NvcGUuY3JlZGl0VHJhbnNhY3Rpb25UeXBlcyA9IGNyZWRpdFRyYW5zYWN0aW9uVHlwZXM7CiAgJHNjb3BlLmJhbmtzID0gYmFua3M7CgogIC8vIGluZGljYXRpb24gd2hldGhlciBwYXltZW50IG1ldGhvZCB3YXMgc2VsZWN0ZWQKICAkc2NvcGUuaXNQYXltZW50TWV0aG9kU2VsZWN0ZWQ9ZmFsc2U7CiAgJHNjb3BlLnNlbGVjdFBheW1lbnRNZXRob2QgPSBmdW5jdGlvbihwYXltZW50KSB7CiAgICAkc2NvcGUucGF5bWVudFR5cGVUaXRsZT1wYXltZW50Lm5hbWU7CiAgICAkc2NvcGUuc2VsZWN0ZWRQYXltZW50TWV0aG9kPXBheW1lbnQ7CiAgICAkc2NvcGUuaXNQYXltZW50TWV0aG9kU2VsZWN0ZWQ9dHJ1ZTsKICB9OwoKICAkc2NvcGUudXBkYXRlQmFsYW5jZSA9IGZ1bmN0aW9uIHVwZGF0ZUJhbGFuY2UgKGlzU291cmNlV2l0aFZhdCkgewogICAgJHNjb3BlLmJ1c2luZXNzQ29uZmlnLnRoZW4oZnVuY3Rpb24gKGNvbmZpZykgewogICAgICBpZiAoaXNTb3VyY2VXaXRoVmF0KSB7CiAgICAgICAgJHNjb3BlLmJhbGFuY2VUb1BheU5vVmF0ID0gTnVtYmVyKCgkc2NvcGUuYmFsYW5jZVRvUGF5IC8gKDEgKyBjb25maWcudmF0X3JhdGUpKS50b0ZpeGVkKDIpKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAkc2NvcGUuYmFsYW5jZVRvUGF5ID0gTnVtYmVyKCgkc2NvcGUuYmFsYW5jZVRvUGF5Tm9WYXQgKiAoMSArIGNvbmZpZy52YXRfcmF0ZSkpLnRvRml4ZWQoMikpOwogICAgICB9CiAgICB9KQogIH07CgogICRzY29wZS5tYWtlUGF5bWVudCA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1ZyhjdXJyZW50Q2xpZW50KTsKICAgIGxvZ0RlYnVnKCJwYXltZW50IG1ldGhvZCIpOwogICAgbG9nRGVidWcoJHNjb3BlLnNlbGVjdGVkUGF5bWVudE1ldGhvZCk7CiAgICBsb2dEZWJ1ZygiJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZ2VuZXJhdGVkPTwiKyRzY29wZS5pbnZvaWNlX2dlbmVyYXRlZCsiPiIpOwoKICAgIGlmICgoJHNjb3BlLmJhbGFuY2VUb1BheT09MCkgfHwgKCRzY29wZS5iYWxhbmNlVG9QYXk9PScnKXx8ICgkc2NvcGUuYmFsYW5jZVRvUGF5PT1udWxsKSkKICAgIHsKICAgICAgJHNjb3BlLnVzZXJFcnJvcj0i15DXoNeQINeU15bXnyDXodeb15XXnSDXm9ec16nXlNeVIjsKICAgIH0KICAgIGVsc2UgaWYgKCEkc2NvcGUuaXNQYXltZW50TWV0aG9kU2VsZWN0ZWQpCiAgICB7CiAgICAgICRzY29wZS51c2VyRXJyb3I9IteQ16DXkCDXkdeX16gg15DXntem16LXmSDXqtep15zXldedIjsKICAgICAgLy8gYWxlcnQoJ3NzJyk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgIGlmICgoJHNjb3BlLmludm9pY2VfZ2VuZXJhdGVkIT0xKSB8fCAoJHNjb3BlLmludm9pY2VfZGF0ZV9mb3JtYXQ9PW51bGwpKQogICAgICB7CiAgICAgICAgdmFyIGludm9pY2VfZGF0ZV9mb3JtYXQgPSAibnVsbCI7CiAgICAgIH0KICAgICAgZWxzZQogICAgICB7CiAgICAgICAgdmFyIGludm9pY2VfZGF0ZV9mb3JtYXQgPSAkc2NvcGUuaW52b2ljZV9kYXRlX2Zvcm1hdC5nZXREYXRlKCkgICsgIi0iICsgKCRzY29wZS5pbnZvaWNlX2RhdGVfZm9ybWF0LmdldE1vbnRoKCkrMSkgKyAiLSIgKyAkc2NvcGUuaW52b2ljZV9kYXRlX2Zvcm1hdC5nZXRGdWxsWWVhcigpOwogICAgICB9CiAgICAgIGlmIChpc3BsdXMpCiAgICAgIHsKICAgICAgICB3aGF0VG9QYXk9JHNjb3BlLmJhbGFuY2VUb1BheTsKICAgICAgfQogICAgICBlbHNlIHsKICAgICAgICB3aGF0VG9QYXk9LSRzY29wZS5iYWxhbmNlVG9QYXk7CiAgICAgIH0KICAgICAgdGhlZGF0YT0gewogICAgICAgIGJhbGFuY2VUb1BheTogd2hhdFRvUGF5LAogICAgICAgIGJhbGFuY2VUb1BheU5vVmF0OiAkc2NvcGUuYmFsYW5jZVRvUGF5Tm9WYXQgKiAoaXNwbHVzID8gKzEgOiAtMSksCiAgICAgICAgcGF5bWVudF9tZXRob2RfbmFtZTogJHNjb3BlLnNlbGVjdGVkUGF5bWVudE1ldGhvZC5tZXRob2QsCiAgICAgICAgaW52b2ljZV9udW1iZXI6ICRzY29wZS5pbnZvaWNlX251bWJlciwKICAgICAgICBpbnZvaWNlX2dlbmVyYXRlZDogJHNjb3BlLmludm9pY2VfZ2VuZXJhdGVkLAogICAgICAgIGludm9pY2VfZGF0ZTogaW52b2ljZV9kYXRlX2Zvcm1hdCwKICAgICAgICBiYW5rX2NvbXBhbnlfY29kZTogJHNjb3BlLmJhbmtfY29tcGFueV9jb2RlLAogICAgICAgIGJhbmtfYnJhbmNoX251bWJlcjogJHNjb3BlLmJhbmtfYnJhbmNoX251bWJlciwKICAgICAgICBjaGVja19udW1iZXI6ICRzY29wZS5jaGVja19udW1iZXIsCiAgICAgICAgYWNjb3VudF9udW1iZXI6ICRzY29wZS5hY2NvdW50X251bWJlciwKICAgICAgICBjcmVkaXRfY2FyZF9udW1iZXI6ICRzY29wZS5jcmVkaXRfY2FyZF9udW1iZXIsCiAgICAgICAgY3JlZGl0X2NhcmRfdHlwZTogJHNjb3BlLmNyZWRpdF9jYXJkX3R5cGUsCiAgICAgICAgY3JlZGl0X2NhcmRfdHJhbnNhY3Rpb25fdHlwZTogJHNjb3BlLmNyZWRpdF9jYXJkX3RyYW5zYWN0aW9uX3R5cGUsCiAgICAgICAgaW52b2ljZV9jb21tZW50czogJHNjb3BlLmludm9pY2VfY29tbWVudHMKICAgICAgfTsKICAgICAgJHNjb3BlLmt1emVJc0xvYWRpbmc9dHJ1ZTsKICAgICAgY3JlYXRlUGF5bWVudEZvckNsaWVudCgkaHR0cCwkc2NvcGUsY3VycmVudENsaWVudC5idXNpbmVzc191c2VyX2lkLHRoZWRhdGEsY3JlYXRlUGF5bWVudEZvckNsaWVudF9zdWNjZXNzLCBjcmVhdGVQYXltZW50Rm9yQ2xpZW50X2ZhaWx1cmUpOwogICAgICBmdW5jdGlvbiBjcmVhdGVQYXltZW50Rm9yQ2xpZW50X3N1Y2Nlc3MoKQogICAgICB7CiAgICAgICAgJHNjb3BlLmt1emVJc0xvYWRpbmc9ZmFsc2U7CiAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgICAgIGxvZ0RlYnVnKCJicm9hZGNhc3RpbmcgY2xpZW50UGFnZVJlbG9hZERhdGEiKTsKICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NsaWVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCiAgICAgICAgbG9nRGVidWcoImJyb2FkY2FzdGluZyBldmVudFBhZ2VSZWxvYWREYXRhIik7CiAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdldmVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCiAgICAgICAgLy8gbG9nRGVidWcoImJyb2FkY2FzdGluZyByZWxvYWRFdmVudCIpOwogICAgICAgIC8vICRyb290U2NvcGUuJGJyb2FkY2FzdCgncmVsb2FkRXZlbnQnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKICAgICAgfQogICAgICBmdW5jdGlvbiBjcmVhdGVQYXltZW50Rm9yQ2xpZW50X2ZhaWx1cmUoKQogICAgICB7CiAgICAgICAgJHNjb3BlLmt1emVJc0xvYWRpbmc9ZmFsc2U7CiAgICAgIH0KICAgIH0KIH0KfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdldmVudERldGFpbHNCdXNpbmVzc0NhbGVuZGFyTW9kYWxDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIHNlbGVjdGVkRXZlbnQsIHVpQ2FsZW5kYXJDb25maWcpIHsKICAgIHZhciBkYXlOYW1lcyA9IFsn16jXkNep15XXnycsICfXqdeg15knLCAn16nXnNeZ16nXmScsICfXqNeR15nXoteZJywgJ9eX157Xmdep15knLCAn16nXmdep15knLCAn16nXkdeqJ107CgogICAgJHNjb3BlLmdvdG9DbGllbnRQYWdlPSBmdW5jdGlvbiAoYnVzaW5lc1VzZXJpZCkKICAgIHsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgICBnb3RvQ2xpZW50UGFnZShidXNpbmVzVXNlcmlkKTsKICAgIH0KICAgICRzY29wZS5lZGl0RXZlbnQ9IGZ1bmN0aW9uICh0aGVldmVudCkKICAgIHsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgICBnb3RvRXZlbnRQYWdlKHRoZWV2ZW50KTsKICAgIH0KCiAgICBsb2dEZWJ1Zygic2VsZWN0ZWQgRXZlbnQgaW5mbyA9IiArIEpTT04uc3RyaW5naWZ5KHNlbGVjdGVkRXZlbnQsIG51bGwsIDIpKTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50ID0gc2VsZWN0ZWRFdmVudDsKICAgIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc2VsZWN0ZWRFdmVudC5zdGFydCk7CiAgICB2YXIgc2VsZWN0ZWREYXRlU3RhcnQgPSBuZXcgRGF0ZShzZWxlY3RlZERhdGVTdGFydC5nZXRUaW1lKCkgKyBzZWxlY3RlZERhdGVTdGFydC5nZXRUaW1lem9uZU9mZnNldCgpICogNjAwMDApOwoKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRIb3VycygpOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzID0gKHNlbGVjdGVkRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKSA8IDEwID8gJzAnIDogJycpICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TWludXRlcygpOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkb3cgPSBkYXlOYW1lc1tzZWxlY3RlZERhdGVTdGFydC5nZXREYXkoKV07CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRhdGUgPSBzZWxlY3RlZERhdGVTdGFydDsKCiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydERheSA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldERhdGUoKTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0TW9udGggPSAxICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TW9udGgoKTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0TW9udGhUeHQgPSBtb250aE5hbWVzWyRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0TW9udGggLSAxXTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0WWVhciA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCk7CgogICAgc2VsZWN0ZWREYXRlRW5kID0gbmV3IERhdGUoc2VsZWN0ZWRFdmVudC5lbmQpOwogICAgdmFyIHNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKHNlbGVjdGVkRGF0ZUVuZC5nZXRUaW1lKCkgKyBzZWxlY3RlZERhdGVFbmQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKCiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycyA9IHNlbGVjdGVkRGF0ZUVuZC5nZXRIb3VycygpOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kZG93ID0gZGF5TmFtZXNbc2VsZWN0ZWREYXRlRW5kLmdldERheSgpXTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKSA8IDEwID8gJzAnIDogJycpICsgc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKTsKICAgICRzY29wZS5va0xpbWl0YXRpb25Nb2RhbCA9IGZ1bmN0aW9uKCkgewogICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICAgIH07CgogICAgJHNjb3BlLmRlbGV0ZUxpbWl0YXRpb25Nb2RhbCA9IGZ1bmN0aW9uKCkgewogICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoJ2RlbGV0ZScpOwogICAgICAgIGNhbGVuZGFyID0gJ2NhbGVuZGFyX2J1c2luZXNzJzsKCiAgICAgICAgJHNjb3BlLmRlbGV0ZUNhbGVuZGFyREJFdmVudChzZWxlY3RlZEV2ZW50LCBjYWxlbmRhcik7CiAgICB9OwogICAgJHNjb3BlLmRlbGV0ZUNhbGVuZGFySlNFdmVudCA9IGZ1bmN0aW9uKGNhbGVuZGFyLCBzZWxlY3RlZEV2ZW50aWQpIHsKCiAgICAgICAgbG9nRGVidWcoImNhbGVuZGFyX2hvdXJzX29mX3dvcmtfY29uZmlnPSIgKyB1aUNhbGVuZGFyQ29uZmlnKTsKICAgICAgICBsb2dEZWJ1ZygidWlDYWxlbmRhckNvbmZpZ1tjYWxlbmRhcl09IiArIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWydjYWxlbmRhcl9idXNpbmVzcyddKTsKICAgICAgICBsb2dEZWJ1ZygiZGVsZXRlIGpzIGV2ZW50ICIgKyBzZWxlY3RlZEV2ZW50aWQpOwogICAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlbW92ZUV2ZW50cycsIFtzZWxlY3RlZEV2ZW50aWRdKTsgLy8gZ28gdG8gZGF0ZSBpbiBjYWxlbmRhciBnb3RvCiAgICB9OwogICAgJHNjb3BlLmRlbGV0ZUNhbGVuZGFyREJFdmVudCA9IGZ1bmN0aW9uKHNlbGVjdGVkRXZlbnQsIGNhbGVuZGFyKSB7CiAgICAgICAgbG9nRGVidWcoImRlbGV0ZSBldmVudCAiICsgc2VsZWN0ZWRFdmVudC5pZCk7CiAgICAgICAgJGh0dHAoewogICAgICAgICAgICBtZXRob2Q6ICdQT1NUJywKICAgICAgICAgICAgdXJsOiAnL2FwaS9hZG1pbi9ldmVudHMvZGVsZXRlLycgKyBzZWxlY3RlZEV2ZW50LmlkLAogICAgICAgICAgICBkYXRhOiB7CiAgICAgICAgICAgICAgICB0ZW1wX2xpbWl0X2lkOiBzZWxlY3RlZEV2ZW50LnRlbXBfbGltaXRfaWQKICAgICAgICAgICAgfSwKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uO2NoYXJzZXQ9dXRmLTgnCiAgICAgICAgICAgIH0KICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHsKCiAgICAgICAgICAgIGxvZ0RlYnVnKGRhdGEpOwogICAgICAgICAgICBpZiAoIWRhdGEuc3VjY2VzcykgewogICAgICAgICAgICAgICAgbG9nRGVidWcoImRlbGV0ZSBsaW1pdF9pZCBlcnJvciArIiArIGRhdGEubWVzc2FnZSk7CiAgICAgICAgICAgICAgICAvLyBpZiBub3Qgc3VjY2Vzc2Z1bCwgYmluZCBlcnJvcnMgdG8gZXJyb3IgdmFyaWFibGVzCiAgICAgICAgICAgICAgICAvLwkJCSAgJHNjb3BlLmVycm9yTmFtZSA9IGRhdGEuZXJyb3JzLm5hbWU7CiAgICAgICAgICAgICAgICAvLwkJCSAgJHNjb3BlLmVycm9yU3VwZXJoZXJvID0gZGF0YS5lcnJvcnMuc3VwZXJoZXJvQWxpYXM7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBsb2dEZWJ1ZygiZGVsZXRlIGxpbWl0X2lkIHN1Y2Nlc3MiKTsKICAgICAgICAgICAgICAgIC8vIGlmIHN1Y2Nlc3NmdWwsIGJpbmQgc3VjY2VzcyBtZXNzYWdlIHRvIG1lc3NhZ2UKICAgICAgICAgICAgICAgIC8vCQkJICAkc2NvcGUubWVzc2FnZSA9IGRhdGEubWVzc2FnZTsKICAgICAgICAgICAgICAgICRzY29wZS5kZWxldGVDYWxlbmRhckpTRXZlbnQoY2FsZW5kYXIsIHNlbGVjdGVkRXZlbnQuaWQpOwoKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBsb2dEZWJ1ZygiYWZ0ZXIgcmVtb3ZlIGV2ZW50Iik7CiAgICB9Owp9KTsKCmt1emVBcHAuY29udHJvbGxlcignZXZlbnRSZWN1cnJpbmdEZXRhaWxzQnVzaW5lc3NDYWxlbmRhck1vZGFsQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRodHRwLCBzZWxlY3RlZEV2ZW50LCB1aUNhbGVuZGFyQ29uZmlnKSB7CiAgICB2YXIgZGF5TmFtZXMgPSBbJ9eo15DXqdeV158nLCAn16nXoNeZJywgJ9ep15zXmdep15knLCAn16jXkdeZ16LXmScsICfXl9ee15nXqdeZJywgJ9ep15nXqdeZJywgJ9ep15HXqiddOwoKICAgICRzY29wZS5nb3RvQ2xpZW50UGFnZT0gZnVuY3Rpb24gKGJ1c2luZXNzVXNlcmlkKQogICAgewogICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgICAgIGdvdG9DbGllbnRQYWdlKGJ1c2luZXNzVXNlcmlkKTsKICAgIH0KICAgICRzY29wZS5lZGl0RXZlbnQ9IGZ1bmN0aW9uICh0aGVldmVudCkKICAgIHsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgICBnb3RvRXZlbnRQYWdlKHRoZWV2ZW50KTsKICAgIH0KCgogICAgbG9nRGVidWcoInNlbGVjdGVkIFJlY3VycmluZyBFdmVudCBpbmZvID0iICsgSlNPTi5zdHJpbmdpZnkoc2VsZWN0ZWRFdmVudCwgbnVsbCwgMikpOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQgPSBzZWxlY3RlZEV2ZW50OwogICAgc2VsZWN0ZWREYXRlU3RhcnQgPSBuZXcgRGF0ZShzZWxlY3RlZEV2ZW50LnN0YXJ0KTsKICAgIHZhciBzZWxlY3RlZERhdGVTdGFydCA9IG5ldyBEYXRlKHNlbGVjdGVkRGF0ZVN0YXJ0LmdldFRpbWUoKSArIHNlbGVjdGVkRGF0ZVN0YXJ0LmdldFRpbWV6b25lT2Zmc2V0KCkgKiA2MDAwMCk7CgogICAgLy8gbG9nRGVidWcoInNlbGVjdGVkRXZlbnQuc3RhcnQ9IiArIHNlbGVjdGVkRXZlbnQuc3RhcnQpOwogICAgLy8gbG9nRGVidWcoImRhdGU9IiArIHNlbGVjdGVkRGF0ZVN0YXJ0KTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRIb3VycygpOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzID0gKHNlbGVjdGVkRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKSA8IDEwID8gJzAnIDogJycpICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TWludXRlcygpOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkb3cgPSBkYXlOYW1lc1tzZWxlY3RlZERhdGVTdGFydC5nZXREYXkoKV07CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRhdGUgPSBzZWxlY3RlZERhdGVTdGFydDsKCiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydERheSA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldERhdGUoKTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0TW9udGggPSAxICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TW9udGgoKTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0TW9udGhUeHQgPSBtb250aE5hbWVzWyRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0TW9udGggLSAxXTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0WWVhciA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCk7CgogICAgc2VsZWN0ZWREYXRlRW5kID0gbmV3IERhdGUoc2VsZWN0ZWRFdmVudC5lbmQpOwogICAgdmFyIHNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKHNlbGVjdGVkRGF0ZUVuZC5nZXRUaW1lKCkgKyBzZWxlY3RlZERhdGVFbmQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKCiAgICAvLyBsb2dEZWJ1Zygic2VsZWN0ZWRFdmVudC5lbmQ9IiArIHNlbGVjdGVkRXZlbnQuZW5kKTsKICAgIC8vIGxvZ0RlYnVnKCJkYXRlPSIgKyBzZWxlY3RlZERhdGVFbmQpOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMgPSBzZWxlY3RlZERhdGVFbmQuZ2V0SG91cnMoKTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGRvdyA9IGRheU5hbWVzW3NlbGVjdGVkRGF0ZUVuZC5nZXREYXkoKV07CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzID0gKHNlbGVjdGVkRGF0ZUVuZC5nZXRNaW51dGVzKCkgPCAxMCA/ICcwJyA6ICcnKSArIHNlbGVjdGVkRGF0ZUVuZC5nZXRNaW51dGVzKCk7CiAgICAkc2NvcGUub2tMaW1pdGF0aW9uTW9kYWwgPSBmdW5jdGlvbigpIHsKICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgICB9OwoKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2V2ZW50RGV0YWlsc0hvdXJzT2ZXb3JrTW9kYWxDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIHNlbGVjdGVkRXZlbnQsIGZpeGVkU2NoZWR1bGUsIHVpQ2FsZW5kYXJDb25maWcpIHsKICAgIHZhciBkYXlOYW1lcyA9IFsn16jXkNep15XXnycsICfXqdeg15knLCAn16nXnNeZ16nXmScsICfXqNeR15nXoteZJywgJ9eX157Xmdep15knLCAn16nXmdep15knLCAn16nXkdeqJ107CgogICAgLy8gbG9nRGVidWcoInNlbGVjdGVkIEV2ZW50ID0iICsgSlNPTi5zdHJpbmdpZnkoc2VsZWN0ZWRFdmVudCwgbnVsbCwgNCkpOwogICAgJHNjb3BlLmZpeGVkU2NoZWR1bGU9Zml4ZWRTY2hlZHVsZTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50ID0gc2VsZWN0ZWRFdmVudDsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50Lm9yaWdfZXZlbnRfdHlwZXMgPSBhbmd1bGFyLmNvcHkoc2VsZWN0ZWRFdmVudC5ldmVudF90eXBlcyk7CiAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzID0gW107CgogICAgZ2V0QnVzaW5lc3NMb2NhdGlvbnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19sb2NhdGlvbnMnKTsKCiAgICBsb2dEZWJ1ZygiaG91cnMgb2Ygd29yayBibG9jay9ldmVudCBjbGlja2VkICIrSlNPTi5zdHJpbmdpZnkoJHNjb3BlLnNlbGVjdGVkRXZlbnQpKTsKCiAgICBzZWxlY3RlZERhdGVTdGFydCA9IG5ldyBEYXRlKHNlbGVjdGVkRXZlbnQuc3RhcnQpOwogICAgdmFyIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZSgpICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKICAgIGdldEFsbEluc3RydWN0b3JzKCRodHRwLCRzY29wZSwnaW5zdHJ1Y3RvcnMnKTsKICAgIGdldE5vQ2xhc3NFdmVudFR5cGVzTm9BZG1pbigkaHR0cCwkc2NvcGUsJ3JlbGF0ZWRFdmVudFR5cGVzJyxnZXROb0NsYXNzRXZlbnRUeXBlc05vQWRtaW5fc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBnZXROb0NsYXNzRXZlbnRUeXBlc05vQWRtaW5fc3VjY2VzcygpCiAgICB7CiAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCAkc2NvcGUuc2VsZWN0ZWRFdmVudC5ldmVudF90eXBlcy5sZW5ndGg7IGkrKykKICAgICAgewogICAgICAgIC8vIGNvcHlpbmcgdGhlIGFjdHVhbCBvYmplY3Qgb2YgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRfdHlwZXNbaV0KICAgICAgICBmb3IodmFyIGogPSAwOyBqIDwgJHNjb3BlLnJlbGF0ZWRFdmVudFR5cGVzLmxlbmd0aDsgaisrKQogICAgICAgIHsKICAgICAgICAgIGlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5ldmVudF90eXBlc1tpXS5ldmVudF90eXBlX2lkPT0kc2NvcGUucmVsYXRlZEV2ZW50VHlwZXNbal0uZXZlbnRfdHlwZV9pZCkKICAgICAgICAgIHsKICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRfdHlwZXNbaV09YW5ndWxhci5jb3B5KCRzY29wZS5yZWxhdGVkRXZlbnRUeXBlc1tqXSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgLy8gbG9nRGVidWcoInNlbGVjdGVkRXZlbnQuc3RhcnQ9IiArIHNlbGVjdGVkRXZlbnQuc3RhcnQpOwogICAgLy8gbG9nRGVidWcoImRhdGU9IiArIHNlbGVjdGVkRGF0ZVN0YXJ0KTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRIb3VycygpOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzID0gKHNlbGVjdGVkRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKSA8IDEwID8gJzAnIDogJycpICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TWludXRlcygpOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkb3cgPSBkYXlOYW1lc1tzZWxlY3RlZERhdGVTdGFydC5nZXREYXkoKV07CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRhdGUgPSBzZWxlY3RlZERhdGVTdGFydDsKCiAgICBzZWxlY3RlZERhdGVFbmQgPSBuZXcgRGF0ZShzZWxlY3RlZEV2ZW50LmVuZCk7CiAgICB2YXIgc2VsZWN0ZWREYXRlRW5kID0gbmV3IERhdGUoc2VsZWN0ZWREYXRlRW5kLmdldFRpbWUoKSArIHNlbGVjdGVkRGF0ZUVuZC5nZXRUaW1lem9uZU9mZnNldCgpICogNjAwMDApOwoKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bW9udGggPSBtb250aE5hbWVzW3NlbGVjdGVkRGF0ZVN0YXJ0LmdldE1vbnRoKCldOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aDExMiA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldE1vbnRoKCkrMTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aCA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldERhdGUoKTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0eWVhciA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCk7CiAgICAvLyAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWVfaW5wdXRfZm9ybWF0PSBuZXcgRGF0ZSgxOTcwLCAwLCAxLCAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzLCAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMsIDApOwoKICAgIC8vIGxvZ0RlYnVnKCJzZWxlY3RlZEV2ZW50LmVuZD0iICsgc2VsZWN0ZWRFdmVudC5lbmQpOwogICAgLy8gbG9nRGVidWcoImRhdGU9IiArIHNlbGVjdGVkRGF0ZUVuZCk7CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycyA9IHNlbGVjdGVkRGF0ZUVuZC5nZXRIb3VycygpOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kZG93ID0gZGF5TmFtZXNbc2VsZWN0ZWREYXRlRW5kLmdldERheSgpXTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKSA8IDEwID8gJzAnIDogJycpICsgc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKTsKCgogICAgJHNjb3BlLm9rTGltaXRhdGlvbk1vZGFsID0gZnVuY3Rpb24oKSB7CiAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgfTsKCiAgICAkc2NvcGUudXBkYXRlTGltaXRhdGlvbk1vZGFsID0gZnVuY3Rpb24oKQogICAgewogICAgICBsb2dEZWJ1ZygiZnVuY3Rpb246IHVwZGF0ZUxpbWl0YXRpb25Nb2RhbCIpOwogICAgICBpZiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRfdHlwZXMubGVuZ3RoPDEpCiAgICAgIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgaWYgKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzPCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMpCiAgICAgIHsKICAgICAgICBhbGVydCgi15bXntefINeh15nXldedINec16TXoNeZINeW157XnyDXlNeq15fXnNeUIik7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIGlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vycz09JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykKICAgICAgewogICAgICAgIGlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzPD0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpCiAgICAgICAgewogICAgICAgICAgYWxlcnQoIteW157XnyDXodeZ15XXnSDXnNek16DXmSDXltee158g15TXqteX15zXlCIpOwogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlczwoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKzEwKSkKICAgICAgICB7CiAgICAgICAgICBhbGVydCgi15HXnNeV16cg16fXmNefINeeLTEwINeT16fXldeqIik7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICB9CgoKICAgICAgZnVuY3Rpb24gdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uX3N1Y2Nlc3MoKQogICAgICB7CiAgICAgICAgY2FsZW5kYXIgPSAnY2FsZW5kYXJfaG91cnNfb2Zfd29yayc7CiAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOyAvLyBnbyB0byBkYXRlIGluIGNhbGVuZGFyIGdvdG8KICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5kaXNtaXNzKCdkZWxldGUnKTsKICAgICAgfQoKICAgICAgaWYgKCRzY29wZS5maXhlZFNjaGVkdWxlKQogICAgICB7CiAgICAgICAgLy8gZml4ZWQgc2NoZWR1bGUgLSB1cGFkdGluZyBsaW1pdGF0aW9uIDE5NzAKICAgICAgICB0aGVkYXRhID0gewogICAgICAgICAgICBzdGFydF9kYXRlOiBuZXdfc3RhcnQsCiAgICAgICAgICAgIGVuZF9kYXRlOiBuZXdfZW5kLAogICAgICAgICAgICB0ZW1wX2xpbWl0X2lkOiBudWxsLAogICAgICAgICAgICBsaW1pdF9pZDogJHNjb3BlLnNlbGVjdGVkRXZlbnQubGltaXRfaWQsCiAgICAgICAgICAgIGV2ZW50X3R5cGVzOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5ldmVudF90eXBlcywKICAgICAgICAgICAgbG9jYXRpb25faWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmxvY2F0aW9uX2lkLAogICAgICAgICAgICBvcmlnX2V2ZW50X3R5cGVzOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5vcmlnX2V2ZW50X3R5cGVzLAogICAgICAgICAgICBlbXBfaWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmVtcF9pZAogICAgICAgIH07CiAgICAgICAgdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uKCRodHRwLCRzY29wZSx0aGVkYXRhLCRzY29wZS5zZWxlY3RlZEV2ZW50LmxpbWl0X2lkLCB1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25fc3VjY2Vzcyk7CiAgICAgIH0KICAgICAgZWxzZQogICAgICAvLyBub3QgZml4ZWQgc2NoZWR1bGUgLSBwZXJkYXkgYmxvY2sKICAgICAgewogICAgICAgIC8vLy8vLy8vLy8vCiAgICAgICAgaWYgKCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5saW1pdF9pZCAhPSBudWxsKSAmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5kYXlfbGltaXRfaWQgPT0gLTEpKSAvLyBldmVudCBsaW1pdGF0aW9uIGhhcyBsaW1pdF9pZCBzbyBpdHMgYW4gMTk3MCBldmVudAogICAgICAgIC8vIG5lZWQgdG8gYWRkIGEgbmV3IHBlcmRheSBsaW1pdGF0aW9uIHRoYXQgcG9pbnQgKGxpbWl0X2lkKSB0byB0aGUgb2xkIDE5NzAgZXZlbnQgdG8gcmVwbGFjdGUgaXQKICAgICAgICB7CiAgICAgICAgICAgIHRlbXBfbGltaXRfaWQgPSBjYWxjX3RlbXBfbGltaXRfaWQoKTsKICAgICAgICAgICAgLy8gdGhlZXZlbnQudGVtcF9saW1pdF9pZCA9IHRlbXBfbGltaXRfaWQ7CiAgICAgICAgICAgIC8vIHRoZWV2ZW50LmRheV9saW1pdF9pZCA9IHRlbXBfbGltaXRfaWQ7CiAgICAgICAgICAgIC8vIHRoZSBtb3ZlZCBldmVudCBpbiB0aGUgY2FsZW5kYXIgbm93IGhhcyBkYXlfbGltaXRfaWQgYW5kIHRlbXBfbGltaXRfaWQKICAgICAgICAgICAgLy8gaWYgaXRzIGxvYWRlZCBmcm9tIHRoZSBkYiwgaXQgd2lsbCBvbmx5IGhhdmUgZGF5X2xpbWl0X2lkIChhbmQgbm90IHRoZSB0ZW1wIG9uZSkKICAgICAgICAgICAgLy8gdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnXS5mdWxsQ2FsZW5kYXIoJ3VwZGF0ZUV2ZW50JywgdGhlZXZlbnQpOwogICAgICAgICAgICAvLyBjb25zb2xlLmxvZygiWFhYWFhYWFhYWFhYWCIpOwogICAgICAgICAgICB0aGVkYXRhID0gewogICAgICAgICAgICAgICAgc3RhcnRfZGF0ZTogbmV3X3N0YXJ0LAogICAgICAgICAgICAgICAgZW5kX2RhdGU6IG5ld19lbmQsCiAgICAgICAgICAgICAgICBjb2xvcjogJycsCiAgICAgICAgICAgICAgICB0ZW1wX2xpbWl0X2lkOiAwLAogICAgICAgICAgICAgICAgZXZlbnRfdHlwZV9pZDogJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRfdHlwZV9pZCwKICAgICAgICAgICAgICAgIGV2ZW50X3R5cGVzOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5ldmVudF90eXBlcywKICAgICAgICAgICAgICAgIGxpbWl0X2lkOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5pZCwKICAgICAgICAgICAgICAgIGxvY2F0aW9uX2lkOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5sb2NhdGlvbl9pZCwKICAgICAgICAgICAgICAgIGVtcF9pZDogJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW1wX2lkCiAgICAgICAgICAgICAgICAvLyB0aXRsZTogdGhlZXZlbnQudGl0bGUKICAgICAgICAgICAgfTsKICAgICAgICAgICAgY3JlYXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5KCRodHRwLCRzY29wZSx0aGVkYXRhLHVwZGF0ZUNhbGVuZGFyTGltaXRhdGlvbl9zdWNjZXNzKTsKCiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICB0aGVkYXRhPSB7CiAgICAgICAgICAgICAgc3RhcnRfZGF0ZTogbmV3X3N0YXJ0LAogICAgICAgICAgICAgIGVuZF9kYXRlOiBuZXdfZW5kLAogICAgICAgICAgICAgIHRlbXBfZGF5X2xpbWl0X2lkOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC50ZW1wX2xpbWl0X2lkLAogICAgICAgICAgICAgIG9yaWdfZXZlbnRfdHlwZXM6ICRzY29wZS5zZWxlY3RlZEV2ZW50Lm9yaWdfZXZlbnRfdHlwZXMsCiAgICAgICAgICAgICAgZXZlbnRfdHlwZXM6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50X3R5cGVzLAogICAgICAgICAgICAgIGxvY2F0aW9uX2lkOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5sb2NhdGlvbl9pZCwKICAgICAgICAgICAgICBkYXlfbGltaXRfaWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmRheV9saW1pdF9pZCwKICAgICAgICAgICAgICBlbXBfaWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmVtcF9pZAogICAgICAgICAgfTsKICAgICAgICAgIHVwZGF0ZUNhbGVuZGFyTGltaXRhdGlvblBlckRheSgkaHR0cCwkc2NvcGUsdGhlZGF0YSx1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25fc3VjY2Vzcyk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAkc2NvcGUuZGVsZXRlTGltaXRhdGlvbk1vZGFsID0gZnVuY3Rpb24oKSB7CiAgICAgICAgY2FsZW5kYXIgPSAnY2FsZW5kYXJfaG91cnNfb2Zfd29yayc7CgogICAgICAgIC8vIHJlbW92aW5nIGxpbWl0YXRpb24gZnJvbSBkYXRhYmFzZSwgaWYgdHJ1ZSAtIHJlbW92aW5nIGZyb20gZGlzcGxheSBhbHNvCiAgICAgICAgaWYgKCRzY29wZS5kZWxldGVDYWxlbmRhckRCTGltaXRhdGlvbkV2ZW50KHNlbGVjdGVkRXZlbnQpKQogICAgICAgIHsKICAgICAgICAgIC8vICRzY29wZS5kZWxldGVDYWxlbmRhckpTRXZlbnQoY2FsZW5kYXIsIHNlbGVjdGVkRXZlbnQuaWQpOwogICAgICAgIH0KICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5kaXNtaXNzKCdkZWxldGUnKTsKICAgIH07CiAgICAkc2NvcGUuZGVsZXRlQ2FsZW5kYXJKU0V2ZW50ID0gZnVuY3Rpb24oY2FsZW5kYXIsIHNlbGVjdGVkRXZlbnRpZCkgewoKICAgICAgICBsb2dEZWJ1ZygiY2FsZW5kYXJfaG91cnNfb2Zfd29ya19jb25maWc9IiArIHVpQ2FsZW5kYXJDb25maWcpOwogICAgICAgIGxvZ0RlYnVnKCJ1aUNhbGVuZGFyQ29uZmlnW2NhbGVuZGFyXT0iICsgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnXSk7CiAgICAgICAgbG9nRGVidWcoImRlbGV0ZSBqcyBldmVudCAiICsgc2VsZWN0ZWRFdmVudGlkKTsKICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZW1vdmVFdmVudHMnLCBbc2VsZWN0ZWRFdmVudGlkXSk7IC8vIGdvIHRvIGRhdGUgaW4gY2FsZW5kYXIgZ290bwogICAgfTsKICAgICRzY29wZS5kZWxldGVDYWxlbmRhckRCTGltaXRhdGlvbkV2ZW50ID0gZnVuY3Rpb24oc2VsZWN0ZWRFdmVudCkgewogICAgICAgIGNhbGVuZGFyID0gJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnOwogICAgICAgIC8vIHJldHVybiBmYWxzZTsKCiAgICAgICAgLy8gZGVsZXRpbmcgZXZlbnQgbGltaXRhdGlvbiAobm90IHBlciBkYXkpCiAgICAgICAgLy8gZWl0aGVyIGZyb20gMTk3MCAoaG91cnNfb2Zfd29yayBwYWdlKQogICAgICAgIC8vIG9yIGZyb20gdGhlaXIgaW5zdGFuY2UgaW4gdGhlIGN1cnJlbnQgd2VlaydzIGxpbWl0YXRpb24uCiAgICAgICAgLy8gZWl0aGVyIHdheSBkYXlfbGltaXRfaWQgaXMgLTEgZm9yIGxpbWl0YXRpb25zIGZyb20gMTk3MAogICAgICAgIGlmIChzZWxlY3RlZEV2ZW50LmRheV9saW1pdF9pZCA9PSAtMSkKICAgICAgICB7CiAgICAgICAgICAgIGxvZ0RlYnVnKCJyZW1vdmluZyBldmVudCBsaW1pdGF0aW9uLCBjaGVja2lnbiBpZiBpdHMgaW4gMTk3MCAodGhlIG9yaWdpbmFsKSBvciBhbiBpbnN0YW5jZSBpbiBwcmVzZW50Iik7CiAgICAgICAgICAgIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc2VsZWN0ZWRFdmVudC5zdGFydCk7CiAgICAgICAgICAgIC8vIGlmIGl0cyAxOTcwIHRoaXMgbWVhbnMgd2UncmUgaW4gdGhlIGhvdXJzX29mX3dvcmsgZ2VuZXJhbCBwYWdlCiAgICAgICAgICAgIC8vIHNvIHdlIHNpbXBseSBkZWxldGUgaXQKICAgICAgICAgICAgaWYgKHNlbGVjdGVkRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCkgPT0gMTk3MCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbG9nRGVidWcoInJlbW92aW5nIGV2ZW50IGxpbWl0YXRpb24gZnJvbSAxOTcwIik7CiAgICAgICAgICAgICAgICB0aGVkYXRhPSB7CiAgICAgICAgICAgICAgICAgICAgdGVtcF9saW1pdF9pZDogc2VsZWN0ZWRFdmVudC50ZW1wX2xpbWl0X2lkCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgZGVsZXRlQ2FsZW5kYXJMaW1pdGF0aW9uKCRodHRwLCRzY29wZSx0aGVkYXRhLHNlbGVjdGVkRXZlbnQubGltaXRfaWQsIGRlbGV0ZUNhbGVuZGFyTGltaXRhdGlvbl9zdWNjZXNzKTsKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGRlbGV0ZUNhbGVuZGFyTGltaXRhdGlvbl9zdWNjZXNzKCkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgJHNjb3BlLmRlbGV0ZUNhbGVuZGFySlNFdmVudChjYWxlbmRhciwgc2VsZWN0ZWRFdmVudC5pZCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAvLyByZW1vdmluZyBldmVudCBsaW1pdGF0aW9uIGZyb20gdGhlIGEgc3BlY2lmaWMgd2VlawogICAgICAgICAgICAgICAgLy8gdGhpcyBtZWFucyBhZGRpbmcgZXZlbnQgbGltaXRhdGlvbiBwZXIgZGF5IHdpdGggcmFuZ2UgZW5kPXN0YXJ0CiAgICAgICAgICAgICAgICAvLyBtYXliZSBCVUcgQlVHR1k/CiAgICAgICAgICAgICAgICBsb2dEZWJ1ZygieCByZW1vdmluZyBldmVudCBsaW1pdGF0aW9uIGZyb20gYSBzcGVjaWZpYyB3ZWVrLCB0aGlzIG1lYW5zIGFkZGluZyBldmVudCBsaW1pdGF0aW9uIHBlciBkYXkgd2l0aCByYW5nZSAwLTAiKTsKICAgICAgICAgICAgICAgIC8vIGxvZ0RlYnVnKEpTT04uc3RyaW5naWZ5KHNlbGVjdGVkRXZlbnQpKTsKCiAgICAgICAgICAgICAgICB0aGVkYXRhID0gewogICAgICAgICAgICAgICAgICAgIHN0YXJ0X2RhdGU6IHNlbGVjdGVkRXZlbnQuc3RhcnQsCiAgICAgICAgICAgICAgICAgICAgZW5kX2RhdGU6IHNlbGVjdGVkRXZlbnQuc3RhcnQsCiAgICAgICAgICAgICAgICAgICAgY29sb3I6ICIjMDAwMDAwIiwKICAgICAgICAgICAgICAgICAgICB0ZW1wX2xpbWl0X2lkOiAxLAogICAgICAgICAgICAgICAgICAgIGV2ZW50X3R5cGVfaWQ6IHNlbGVjdGVkRXZlbnQuZXZlbnRfdHlwZV9pZCwKICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbl9pZDogc2VsZWN0ZWRFdmVudC5sb2NhdGlvbl9pZCwKICAgICAgICAgICAgICAgICAgICBsaW1pdF9pZDogc2VsZWN0ZWRFdmVudC5saW1pdF9pZCwKICAgICAgICAgICAgICAgICAgICB0aXRsZTogc2VsZWN0ZWRFdmVudC50aXRsZQogICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICBjcmVhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXkoJGh0dHAsJHNjb3BlLHRoZWRhdGEsY3JlYXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5X3N1Y2Nlc3MpOwogICAgICAgICAgICAgICAgZnVuY3Rpb24gY3JlYXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5X3N1Y2Nlc3MoKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAkc2NvcGUuZGVsZXRlQ2FsZW5kYXJKU0V2ZW50KGNhbGVuZGFyLCBzZWxlY3RlZEV2ZW50LmlkKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlCiAgICAgICAgewogICAgICAgICAgICAvLyBkZWxldGluZyBhIHBlcmRheSBsaW1pdGF0aW9uLgogICAgICAgICAgICAvLyBpZiBpdCdzIGEgcGVyZGF5IHRoYXQgInJlcGxhY2VkIiBhIDE5NzAgb25lCiAgICAgICAgICAgIC8vIHRoZW4gd2UgY2Fubm90IGRlbGV0ZSBpdCAob3RoZXJ3aXNlIHRoZSBvcmlnaW5hbCAxOTcwIHdpbGwgcmVhcHBlYXIpCiAgICAgICAgICAgIC8vIHNvIHdlIHNldCBpdCB0byBzdGFydD1lbmQKICAgICAgICAgICAgLy8gdGhpcyBtYXliZSBhIEJVRyBhbmQgY2F1c2UgVFJPVUJMRSAvLyBUT0RPCiAgICAgICAgICAgIC8vIG90aGV3aXNlIHdlIGNhbiBkZWxldGUgaXQgLSB0aGUgcGVyZGF5IC0gYXMgaXRzIGEgbmV3IHBlcmRheSBhbmQgbm90ICJyZXBsYWNpbmciIGEgMTk3MCBvbmUKCiAgICAgICAgICAgIGlmIChzZWxlY3RlZEV2ZW50LmxpbWl0X2lkICE9IG51bGwpIC8vIHRoaXMgaXMgdGhlIHBlcmRheSB0aGF0IHJlcGxhY2VzIGEgMTk3MCBvbmUgLSB3ZSBzZXQgaXQgdG8gc3RhcnQ9ZW5kCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBsb2dEZWJ1ZygicmVtb3ZpbmcgZXZlbnQgbGltaXRhdGlvbiBwZXIgZGF5IHJlbGF0ZWQgdG8gMTk3MCAodXBkYXRpbmcgaXQgdG8gc3RhcnQ9ZW5kKSIpOwoKICAgICAgICAgICAgICB0aGVkYXRhPSB7CiAgICAgICAgICAgICAgICAgIHN0YXJ0X2RhdGU6IHNlbGVjdGVkRXZlbnQuc3RhcnQsCiAgICAgICAgICAgICAgICAgIGVuZF9kYXRlOiBzZWxlY3RlZEV2ZW50LnN0YXJ0LAogICAgICAgICAgICAgICAgICB0ZW1wX2RheV9saW1pdF9pZDogc2VsZWN0ZWRFdmVudC50ZW1wX2xpbWl0X2lkLAogICAgICAgICAgICAgICAgICBkYXlfbGltaXRfaWQ6IHNlbGVjdGVkRXZlbnQuZGF5X2xpbWl0X2lkCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICB1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXkoJGh0dHAsJHNjb3BlLHRoZWRhdGEsdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5X3N1Y2Nlcyk7CgogICAgICAgICAgICAgIGZ1bmN0aW9uIHVwZGF0ZUNhbGVuZGFyTGltaXRhdGlvblBlckRheV9zdWNjZXMoKQogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICRzY29wZS5kZWxldGVDYWxlbmRhckpTRXZlbnQoY2FsZW5kYXIsIHNlbGVjdGVkRXZlbnQuaWQpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlICAvLyB0aGlzIGlzIHRoZSBjYXNlIHdoZXJlIHRoZSBwZXJkYXkgZG9lc250IHJlcGxhY2UgYSAxOTcwIG9uZSwgd2UgY2FuIHNpbXBseSBkZWxldGUgaXQKICAgICAgICAgICAgewogICAgICAgICAgICAgIGxvZ0RlYnVnKCJyZW1vdmluZyBldmVudCBsaW1pdGF0aW9uIHBlciBkYXkgcmVsYXRlZCBub3QgcmVsYXRlZCB0byAxOTcwIChzbyB3ZSdyZSBkZWxldGluZyBpdCkiKTsKICAgICAgICAgICAgICB0aGVkYXRhID0gewogICAgICAgICAgICAgICAgICB0ZW1wX2xpbWl0X2lkOiBzZWxlY3RlZEV2ZW50LnRlbXBfbGltaXRfaWQKICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIGRlbGV0ZUNhbGVuZGFyTGltaXRhdGlvblBlckRheSgkaHR0cCwkc2NvcGUsdGhlZGF0YSxzZWxlY3RlZEV2ZW50LmRheV9saW1pdF9pZCwgZGVsZXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5X3N1Y2Nlc3MpOwogICAgICAgICAgICAgIGZ1bmN0aW9uIGRlbGV0ZUNhbGVuZGFyTGltaXRhdGlvblBlckRheV9zdWNjZXNzKCkKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAkc2NvcGUuZGVsZXRlQ2FsZW5kYXJKU0V2ZW50KGNhbGVuZGFyLCBzZWxlY3RlZEV2ZW50LmlkKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgbG9nRGVidWcoImFmdGVyIHJlbW92ZSBldmVudCIpOwoKICAgIH07CgoKICAgICRzY29wZS5zdGFydE1pbnV0ZXMgPSBmdW5jdGlvbigpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJzdGFydE1pbnV0ZXMgIisoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKSk7CiAgICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcz1taW51dGVzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpOwogICAgICBjYWxjdWxhdGVTdGFydFRpbWUoKTsKICAgIH0KICAgICRzY29wZS5zdGFydEhvdXJzID0gZnVuY3Rpb24oKQogICAgewogICAgICBsb2dEZWJ1Zygic3RhcnRIb3VycyAiK2hvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKSk7CiAgICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnM9aG91cnNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMpOwogICAgICBjYWxjdWxhdGVTdGFydFRpbWUoKTsKICAgIH0KICAgICRzY29wZS5lbmRNaW51dGVzID0gZnVuY3Rpb24oKQogICAgewogICAgICBsb2dEZWJ1ZygiZW5kTWludXRlcyAiKygkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzKSk7CiAgICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXM9bWludXRlc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcyk7CiAgICAgIGNhbGN1bGF0ZUVuZFRpbWUoKTsKICAgIH0KICAgICRzY29wZS5lbmRIb3VycyA9IGZ1bmN0aW9uKCkKICAgIHsKICAgICAgbG9nRGVidWcoImVuZEhvdXJzICIraG91cnNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzKSk7CiAgICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzPWhvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vycyk7CiAgICAgIGNhbGN1bGF0ZUVuZFRpbWUoKTsKICAgIH0KCgogICAgZnVuY3Rpb24gY2FsY3VsYXRlU3RhcnRUaW1lKCkKICAgIHsKICAgICAgZXZlbnRZZWFyPSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0eWVhcjsKICAgICAgZXZlbnRNb250aD0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoMTEyOwogICAgICBldmVudERheT0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRheW9mbW9udGg7CiAgICAgIGlmIChwYXJzZUludChldmVudE1vbnRoKTwxMCkKICAgICAgewogICAgICAgIGV2ZW50TW9udGg9IjAiK2V2ZW50TW9udGg7CiAgICAgIH0KICAgICAgaWYgKHBhcnNlSW50KGV2ZW50RGF5KTwxMCkKICAgICAgewogICAgICAgIGV2ZW50RGF5PSIwIitldmVudERheTsKICAgICAgfQoKICAgICAgbmV3X3N0YXJ0PW1vbWVudC51dGMoZXZlbnRZZWFyKyItIitldmVudE1vbnRoKyItIitldmVudERheSsiVDAwOjAwOjAwIikuYWRkKCgocGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykqNjApK3BhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcykpLCAnbWludXRlcycpOwogICAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWU9bmV3X3N0YXJ0OwogICAgICBsb2dEZWJ1ZygibmV3X3N0YXJ0PSIrbmV3X3N0YXJ0KTsKICAgIH0KICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZUVuZFRpbWUoKQogICAgewogICAgICBldmVudFllYXI9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyOwogICAgICBldmVudE1vbnRoPSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bW9udGgxMTI7CiAgICAgIGV2ZW50RGF5PSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aDsKICAgICAgaWYgKHBhcnNlSW50KGV2ZW50TW9udGgpPDEwKQogICAgICB7CiAgICAgICAgZXZlbnRNb250aD0iMCIrZXZlbnRNb250aDsKICAgICAgfQogICAgICBpZiAocGFyc2VJbnQoZXZlbnREYXkpPDEwKQogICAgICB7CiAgICAgICAgZXZlbnREYXk9IjAiK2V2ZW50RGF5OwogICAgICB9CgogICAgICBuZXdfZW5kPW1vbWVudC51dGMoZXZlbnRZZWFyKyItIitldmVudE1vbnRoKyItIitldmVudERheSsiVDAwOjAwOjAwIikuYWRkKCgocGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMpKjYwKStwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzKSksICdtaW51dGVzJyk7CiAgICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kX3RpbWU9bmV3X2VuZDsKICAgICAgbG9nRGVidWcoIm5ld19lbmQ9IituZXdfZW5kKTsKICAgIH0KCiAgICBjYWxjdWxhdGVTdGFydFRpbWUoKTsKICAgIGNhbGN1bGF0ZUVuZFRpbWUoKTsKCiAgICBmdW5jdGlvbiBtaW51dGVzQ2hhbmdlZCh0aGVtaW51dGVzKQogICAgewogICAgICBsb2dEZWJ1ZygidGhlbWludXRlcz0iK3RoZW1pbnV0ZXMpOwogICAgICBpZiAodHlwZW9mIHRoZW1pbnV0ZXM9PSJ1bmRlZmluZWQiKQogICAgICB7CiAgICAgICAgcmV0dXJuICIwMCI7CiAgICAgIH0KICAgICAgdGhlbWludXRlcz1wYXJzZUludCh0aGVtaW51dGVzKTsKICAgICAgaWYgKHRoZW1pbnV0ZXM+NjApCiAgICAgIHsKICAgICAgICByZXR1cm4gIjAwIjsKICAgICAgfQogICAgICBlbHNlIGlmICh0aGVtaW51dGVzPDApCiAgICAgIHsKICAgICAgICByZXR1cm4gIjAwIjsKICAgICAgfQogICAgICBlbHNlIGlmICh0aGVtaW51dGVzPT0iIikKICAgICAgewogICAgICAgIHJldHVybiAiMDAiOwogICAgICB9CiAgICAgIGVsc2UgaWYgKHRoZW1pbnV0ZXM8MTApCiAgICAgIHsKICAgICAgICByZXR1cm4gIjAiK3RoZW1pbnV0ZXM7CiAgICAgIH0KICAgICAgZWxzZQogICAgICB7CiAgICAgICAgICByZXR1cm4gdGhlbWludXRlczsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gaG91cnNDaGFuZ2VkKHRoZWhvdXJzKQogICAgewogICAgICBsb2dEZWJ1ZygidGhlaG91cnM9Iit0aGVob3Vycyk7CiAgICAgIGlmICh0eXBlb2YgdGhlaG91cnM9PSJ1bmRlZmluZWQiKQogICAgICB7CiAgICAgICAgcmV0dXJuICIwIjsKICAgICAgfQogICAgICB0aGVob3Vycz1wYXJzZUludCh0aGVob3Vycyk7CiAgICAgIGlmICh0aGVob3Vycz4yNCkKICAgICAgewogICAgICAgIHJldHVybiAwOwogICAgICB9CiAgICAgIGVsc2UgaWYgKHRoZWhvdXJzPDApCiAgICAgIHsKICAgICAgICByZXR1cm4gMDsKICAgICAgfQogICAgICBlbHNlIGlmICh0aGVob3Vycz09IiIpCiAgICAgIHsKICAgICAgICByZXR1cm4gIjAiOwogICAgICB9CiAgICAgIGVsc2UKICAgICAgewogICAgICAgICAgcmV0dXJuIHRoZWhvdXJzOwogICAgICB9CiAgICB9Cgp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ0V2ZW50VHlwZXNDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGNvbXBpbGUsIHVpQ2FsZW5kYXJDb25maWcsICR1aWJNb2RhbCwkbG9jYXRpb24pIHsKICAgIGxvZ0RlYnVnKCdFdmVudFR5cGVzIENvbnRyb2xsZXInKTsKCiAgICBnZXRBbGxCdXNpbmVzc0V2ZW50VHlwZXMoJGh0dHAsJHNjb3BlLCdldmVudF90eXBlcycpOwogICAgJHNjb3BlLnNob3dFdmVudFR5cGUgPSBmdW5jdGlvbiAodGhlRXZlbnQpCiAgICB7CiAgICAgICRsb2NhdGlvbi5wYXRoKCcvZXZlbnRfdHlwZXMvJyt0aGVFdmVudC5ldmVudF90eXBlX2lkKTsKICAgIH0KfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ0V2ZW50VHlwZU5ld0NvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkY29tcGlsZSwgdWlDYWxlbmRhckNvbmZpZywgJHVpYk1vZGFsLCAkbG9jYXRpb24pIHsKICAgIGxvZ0RlYnVnKCdFdmVudFR5cGVzIENvbnRyb2xsZXIgTmV3Jyk7CgogICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMgPSB7fTsgLy8gdGhlc2UgYXJlIHRoZSBjb21wbGV0ZSBkZXRhaWxzIGZvciB0aGUgbmV3IGV2ZW50IC8vCiAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5pc19jbGFzcyA9IDA7CiAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5ibG9ja0V4dHJhVGltZSA9IGZhbHNlOwogICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZHVyYXRpb25fYmVmb3JlX2V2ZW50ID0gMDsKICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmR1cmF0aW9uX2FmdGVyX2V2ZW50ID0gMDsKICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmluaGVyaXRfbWFpbl9ob3VycyA9IDE7CiAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5tYXhfd2FpdGluZ19saXN0ID0gMzsKICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmlzX3VwZGF0ZSA9IGZhbHNlOwogICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMubWF4X3BhcnRpY2lwYW50cyA9IDE7CiAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5tYXhfcmVnaXN0cmF0aW9ucz0xOwogICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuaXNfcHVibGljPTE7CiAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5pbnN0cnVjdG9yX2lkPTA7CgogICAgJHNjb3BlLmV2ZW50Q29sb3JTdHlsZSA9IHt9OwogICAgZGVmYXVsdENvbG9yID0gJzAwYTY1YSc7CiAgICAkc2NvcGUuZXZlbnRDb2xvclN0eWxlW2RlZmF1bHRDb2xvcl0gPSB7CiAgICAgICAgJ3RyYW5zZm9ybSc6ICdyb3RhdGUoMzBkZWcpJwogICAgfTsKICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV2ZW50Q29sb3IgPSAiIyIgKyBkZWZhdWx0Q29sb3I7CiAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyA9IFsKICAgICAgeyJmaWVsZF9uYW1lIjoi16HXmdeb15XXnSDXntek15LXqSIsImZpZWxkX2RhdGF0eXBlIjoiVEVYVF9BUkVBIiwiaXNfbWFuZGF0b3J5IjowLCAiZnJvbWRiIjogZmFsc2UsICJkYl9pZF90b2ZpeCI6IDAsICJpc19hY3RpdmUiOiAxLCAibW9kaWZpZWQiOiBmYWxzZX0sCiAgICAgIHsiZmllbGRfbmFtZSI6Itep15nXoteV16jXmSDXkdeZ16oiLCJmaWVsZF9kYXRhdHlwZSI6IlRFWFRfQVJFQSIsImlzX21hbmRhdG9yeSI6MCwgImZyb21kYiI6IGZhbHNlLCAiZGJfaWRfdG9maXgiOiAwLCAiaXNfYWN0aXZlIjogMSwgIm1vZGlmaWVkIjogZmFsc2V9CiAgICBdOwoKICAgIGdldEFsbEluc3RydWN0b3JzKCRodHRwLCRzY29wZSwnaW5zdHJ1Y3RvcnMnLGdldEFsbEluc3RydWN0b3JzX3N1Y2Nlc3MpOwogICAgZnVuY3Rpb24gZ2V0QWxsSW5zdHJ1Y3RvcnNfc3VjY2VzcygpCiAgICB7CiAgICAgIC8vICRzY29wZS5pbnN0cnVjdG9ycy51bnNoaWZ0KHtidXNpbmVzc191c2VyX2lkOjAsIGJ1c2VyX2ZpcnN0X25hbWU6IiIsIGJ1c2VyX2xhc3RfbmFtZToiIn0pOwogICAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5pbnN0cnVjdG9yX2lkPSRzY29wZS5pbnN0cnVjdG9yc1swXS5idXNpbmVzc191c2VyX2lkOwogICAgfQoKICAgICRzY29wZS5ldmVudFR5cGVFeHRyYUZpZWxkc1BvcCA9IGZ1bmN0aW9uKGV2ZW50VHlwZVByb3BlcnRpZXMpIHsKICAgICAgICBsb2dEZWJ1ZygiZXZlbnQgY3JlYXRlIG1vZGFsIik7CgogICAgICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewogICAgICAgICAgICBhbmltYXRpb246IGZhbHNlLAogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9ldmVudF90eXBlX2V4dHJhX2ZpZWxkcy5waHAnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnZXZlbnRUeXBlRXh0cmFGaWVsZHNNb2RhbENvbnRyb2xsZXInLAogICAgICAgICAgICBzaXplOiAnbCcsCiAgICAgICAgICAgIHJlc29sdmU6IHsKICAgICAgICAgICAgICAgIGV2ZW50VHlwZVByb3BlcnRpZXM6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBldmVudFR5cGVQcm9wZXJ0aWVzOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIG1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24oc2VsZWN0ZWRJdGVtKSB7CiAgICAgICAgICAgIGxvZ0RlYnVnKHNlbGVjdGVkSXRlbSk7CiAgICAgICAgICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMgPSBzZWxlY3RlZEl0ZW07CiAgICAgICAgfSwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGxvZ0RlYnVnKCdNb2RhbCBkaXNtaXNzZWQgYXQ6ICcgKyBuZXcgRGF0ZSgpKTsKICAgICAgICB9KTsKICAgIH07CgogICAgJHNjb3BlLmNoYW5nZUV2ZW50Q29sb3IgPSBmdW5jdGlvbihuZXdDb2xvcikgewogICAgICAgIGxvZ0RlYnVnKCJjaG9vc2luZyBjb2xvciAiICsgbmV3Q29sb3IpOwogICAgICAgICRzY29wZS5ldmVudENvbG9yID0gbmV3Q29sb3I7CiAgICAgICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXZlbnRDb2xvciA9ICIjIiArIG5ld0NvbG9yOwogICAgICAgICRzY29wZS5ldmVudENvbG9yU3R5bGUgPSB7CiAgICAgICAgICAgICdiYWNrZ3JvdW5kLWNvbG9yJzogIiMiICsgbmV3Q29sb3IKICAgICAgICB9OwogICAgICAgICRzY29wZS5ldmVudENvbG9yU3R5bGVbbmV3Q29sb3JdID0gewogICAgICAgICAgICAndHJhbnNmb3JtJzogJ3JvdGF0ZSgzMGRlZyknCiAgICAgICAgfTsKCiAgICB9CgogICAgJHNjb3BlLmFkZEV2ZW50VHlwZUNhbmNlbCA9IGZ1bmN0aW9uKCkgewogICAgICAgICRsb2NhdGlvbi5wYXRoKCcvZXZlbnRfdHlwZXMnKTsKICAgIH07CgogICAgJHNjb3BlLmFkZEV2ZW50VHlwZSA9IGZ1bmN0aW9uKCkgewogICAgICAgIGxvZ0RlYnVnKCJhZGQgRXZlbnQgVHlwZSIgKyAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcyArICJleHRyYSBmaWVsZHM9IiArJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMpOwogICAgICAgIGlmICgoJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMubWF4X3JlZ2lzdHJhdGlvbnM9PScnKSB8fCAoISRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF9yZWdpc3RyYXRpb25zKSkKICAgICAgICB7CiAgICAgICAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5tYXhfcmVnaXN0cmF0aW9ucz0wOwogICAgICAgIH0KICAgICAgICBhZGRFdmVudFR5cGUoJGh0dHAsJHNjb3BlLCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLGFkZEV2ZW50VHlwZV9zdWNjZXNzKTsKICAgICAgICBmdW5jdGlvbiBhZGRFdmVudFR5cGVfc3VjY2VzcygpCiAgICAgICAgewogICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9ldmVudF90eXBlcycpOwogICAgICAgIH0KICAgIH07Cn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdFdmVudFR5cGVVcGRhdGVDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGNvbXBpbGUsICRyb3V0ZVBhcmFtcywgdWlDYWxlbmRhckNvbmZpZywgJHVpYk1vZGFsLCAkbG9jYXRpb24pIHsKICAgIGV2ZW50X3R5cGVfaWQ9JHJvdXRlUGFyYW1zLmV2ZW50X3R5cGVfaWQ7CiAgICBsb2dEZWJ1ZygnRXZlbnRUeXBlcyBDb250cm9sbGVyIFVwZGF0ZSAnK2V2ZW50X3R5cGVfaWQpOwoKICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzID0ge307IC8vIHRoZXNlIGFyZSB0aGUgY29tcGxldGUgZGV0YWlscyBmb3IgdGhlIG5ldyBldmVudCAvLwogICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuaXNfdXBkYXRlID0gdHJ1ZTsKCiAgICAkc2NvcGUuZXZlbnRDb2xvclN0eWxlID0ge307CiAgICBnZXRBbGxJbnN0cnVjdG9ycygkaHR0cCwkc2NvcGUsJ2luc3RydWN0b3JzJyxnZXRBbGxJbnN0cnVjdG9yc19zdWNjZXNzKTsKICAgIGZ1bmN0aW9uIGdldEFsbEluc3RydWN0b3JzX3N1Y2Nlc3MoKQogICAgewogICAgICAkc2NvcGUuaW5zdHJ1Y3RvcnMudW5zaGlmdCh7YnVzaW5lc3NfdXNlcl9pZDpudWxsLCBidXNlcl9maXJzdF9uYW1lOiIiLCBidXNlcl9sYXN0X25hbWU6IiJ9KTsKICAgIH0KCiAgICBnZXRCdXNpbmVzc0V2ZW50VHlwZSgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmV2ZW50X3R5cGVfaWQsJ2V2ZW50VHlwZVByb3BlcnRpZXMnLGdldEJ1c2luZXNzRXZlbnRUeXBlX3N1Y2Nlc3MpOwoKICAgIGZ1bmN0aW9uIGdldEJ1c2luZXNzRXZlbnRUeXBlX3N1Y2Nlc3MoKQogICAgewogICAgICAgIGlmICgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5tYXhfcmVnaXN0cmF0aW9ucz09bnVsbCkKICAgICAgICB7CiAgICAgICAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5tYXhfcmVnaXN0cmF0aW9ucz0xOwogICAgICAgIH0KICAgICAgICBpZiAoKCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmR1cmF0aW9uX2JlZm9yZV9ldmVudD4wKSB8ICgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5kdXJhdGlvbl9hZnRlcl9ldmVudD4wKSkKICAgICAgICB7CiAgICAgICAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5ibG9ja0V4dHJhVGltZSA9IDE7CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5ibG9ja0V4dHJhVGltZSA9IDA7CiAgICAgICAgfQogICAgICAgIC8vICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmluaGVyaXRfbWFpbl9ob3VycyA9IHJlc3BvbnNlLmRhdGFbMF0uaW5oZXJpdF9tYWluX2hvdXJzOwogICAgICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmlzX3VwZGF0ZSA9IHRydWU7CiAgICAgICAgbG9nRGVidWcoIiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmNvbG9yPSIrJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuY29sb3IpOwogICAgICAgICRzY29wZS5ldmVudENvbG9yU3R5bGVbJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuY29sb3JdID0gewogICAgICAgICAgICAndHJhbnNmb3JtJzogJ3JvdGF0ZSgzMGRlZyknCiAgICAgICAgfTsKICAgICAgICAkc2NvcGUuY2hhbmdlRXZlbnRDb2xvcigoJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuY29sb3IpLnN1YnN0cigxKSk7CiAgICAgICAgbG9nRGVidWcoIiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmluc3RydWN0b3JfaWQ9Iiskc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5pbnN0cnVjdG9yX2lkKTsKICAgICAgICAvLyBzYXZpbmcgZXZlbnQgdHlwZSBkZXRhaWxzIGFzaWRlIHRvIGxhdGVyIGNoZWNrIGlmIGFueXRoaW5nIGNoYW5nZWQKICAgICAgICBsb2dEZWJ1ZygiZHVwbGljYXRpbmcgb2JqZWN0IG9mIGV2ZW50IHR5cGUgdG8gbGF0ZXIgY29tcGFyZSAiK3R5cGVvZiAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcyk7CiAgICAgICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXNEdXBsaWNhdGUgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzKSk7CiAgICAgICAgbG9nRGVidWcoIiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzRHVwbGljYXRlID0iKyRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzRHVwbGljYXRlLmV2ZW50X3R5cGVfbmFtZSk7CiAgICB9OwoKICAgIC8vIGV2ZW50IHR5cGUgY2hhbmdlZCBwb3B1cAogICAgJHNjb3BlLmV2ZW50VHlwZUNoYW5nZWRQb3B1cCA9IGZ1bmN0aW9uKGV2ZW50VHlwZVByb3BlcnRpZXMpIHsKICAgICAgICBsb2dEZWJ1ZygiZXZlbnQgY3JlYXRlIG1vZGFsIik7CgogICAgICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewogICAgICAgICAgICBhbmltYXRpb246IGZhbHNlLAogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9ldmVudF90eXBlX2NoYW5nZWQucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ2V2ZW50VHlwZUNoYW5nZWRQb3B1cENvbnRyb2xsZXInLAogICAgICAgICAgICBzaXplOiAnbCcsCiAgICAgICAgICAgIHJlc29sdmU6IHsKICAgICAgICAgICAgICAgIGV2ZW50VHlwZVByb3BlcnRpZXM6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllczsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBtb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHNlbGVjdGVkSXRlbSkKICAgICAgICB7CiAgICAgICAgICAgIGxvZ0RlYnVnKHNlbGVjdGVkSXRlbSk7CiAgICAgICAgICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMgPSBzZWxlY3RlZEl0ZW07CiAgICAgICAgfSwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGxvZ0RlYnVnKCdNb2RhbCBkaXNtaXNzZWQgYXQ6ICcgKyBuZXcgRGF0ZSgpKTsKICAgICAgICB9KTsKICAgIH07CgogICAgLy8gZXZlbnQgdHlwZSBleHRyYSBmaWVsZCBwb3B1cAogICAgJHNjb3BlLmV2ZW50VHlwZUV4dHJhRmllbGRzUG9wID0gZnVuY3Rpb24oZXZlbnRUeXBlUHJvcGVydGllcykgewogICAgICAgIGxvZ0RlYnVnKCJldmVudCBjcmVhdGUgbW9kYWwiKTsKCiAgICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgICAgICAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2V2ZW50X3R5cGVfZXh0cmFfZmllbGRzLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdldmVudFR5cGVFeHRyYUZpZWxkc01vZGFsQ29udHJvbGxlcicsCiAgICAgICAgICAgIHNpemU6ICdsJywKICAgICAgICAgICAgcmVzb2x2ZTogewogICAgICAgICAgICAgICAgZXZlbnRUeXBlUHJvcGVydGllczogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGV2ZW50VHlwZVByb3BlcnRpZXM7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgbW9kYWxJbnN0YW5jZS5yZXN1bHQudGhlbihmdW5jdGlvbihzZWxlY3RlZEl0ZW0pIHsKICAgICAgICAgICAgbG9nRGVidWcoc2VsZWN0ZWRJdGVtKTsKICAgICAgICAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyA9IHNlbGVjdGVkSXRlbTsKICAgICAgICB9LCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgbG9nRGVidWcoJ01vZGFsIGRpc21pc3NlZCBhdDogJyArIG5ldyBEYXRlKCkpOwogICAgICAgIH0pOwogICAgfTsKCgogICAgJHNjb3BlLmNoYW5nZUV2ZW50Q29sb3IgPSBmdW5jdGlvbihuZXdDb2xvcikgewogICAgICAgIGxvZ0RlYnVnKCJjaG9vc2luZyBjb2xvciAiICsgbmV3Q29sb3IpOwogICAgICAgICRzY29wZS5ldmVudENvbG9yID0gbmV3Q29sb3I7CiAgICAgICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXZlbnRDb2xvciA9ICIjIiArIG5ld0NvbG9yOwogICAgICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmNvbG9yID0gIiMiICsgbmV3Q29sb3I7CiAgICAgICAgJHNjb3BlLmV2ZW50Q29sb3JTdHlsZSA9IHsKICAgICAgICAgICAgJ2JhY2tncm91bmQtY29sb3InOiAiIyIgKyBuZXdDb2xvcgogICAgICAgIH07CiAgICAgICAgJHNjb3BlLmV2ZW50Q29sb3JTdHlsZVtuZXdDb2xvcl0gPSB7CiAgICAgICAgICAgICd0cmFuc2Zvcm0nOiAncm90YXRlKDMwZGVnKScKICAgICAgICB9OwoKICAgIH0KCiAgICAkc2NvcGUuYWRkRXZlbnRUeXBlQ2FuY2VsID0gZnVuY3Rpb24oKSB7CiAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9ldmVudF90eXBlcycpOwogICAgfTsKCiAgICAkc2NvcGUuYWRkRXZlbnRUeXBlID0gZnVuY3Rpb24oKSB7IC8vIHRoaXMgZnVuY3Rpb24gVVBEQVRFUyBldmVudCB0eXBlIChub3QgYWRkcykKICAgICAgLy8gY2hlY2tpbmcgaWYgYW55dGhpbmcgY2hhbmdlZCByZWFsbHkKICAgICAgLy8gYW5kIGFza2luZyBpZiB3ZSBzaG91bGQgdXBkYXRlIGFsbCBldmVudHMgZnJvbSBub3cgKG9yIG9ubHkgbmV3bHkgY3JlYXRlZCBldmVudHMpCiAgICAgIC8vIGNoZWNraW5nCiAgICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzRHVwbGljYXRlLmV4dHJhRmllbGRzPSRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzOwogICAgICBpZiAoYW5ndWxhci5lcXVhbHMoJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXNEdXBsaWNhdGUsJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMpKQogICAgICB7CiAgICAgICAgLy8gJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXNEdXBsaWNhdGUuZXh0cmFGaWVsZHMgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzKSk7CgogICAgICAgIGxvZ0RlYnVnKCJub3RoaW5nIGNoYW5nZWQgaW4gZXZlbnQgdHlwZSwgb3Igb25seSBleHRyYSBmaWVsZHMiKTsKICAgICAgICAkc2NvcGUudXBkYXRlRXZlbnRUeXBlKCk7CiAgICAgIH0KICAgICAgZWxzZQogICAgICB7CiAgICAgICAgbG9nRGVidWcoImV2ZW50IHR5cGUgY2hhbmdlZCIpOwogICAgICAgICRzY29wZS5ldmVudFR5cGVDaGFuZ2VkUG9wdXAoKTsKICAgICAgfQogICAgICAvLyAkc2NvcGUudXBkYXRlRXZlbnRUeXBlKCk7CiAgICB9CiAgICAkc2NvcGUudXBkYXRlRXZlbnRUeXBlID0gZnVuY3Rpb24oKQogICAgewogICAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy51cGRhdGVfZXhpc3RpbmdfZXZlbnRzPWZhbHNlOwoKICAgICAgbG9nRGVidWcoInVwZGF0ZSBFdmVudCBUeXBlICIgKyAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5ldmVudF90eXBlX2lkKTsKICAgICAgaWYgKCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF9yZWdpc3RyYXRpb25zPT0nJykKICAgICAgewogICAgICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF9yZWdpc3RyYXRpb25zPTA7CiAgICAgIH0KICAgICAgdXBkYXRlRXZlbnRUeXBlKCRodHRwLCRzY29wZSwkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5ldmVudF90eXBlX2lkLCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLHVwZGF0ZUV2ZW50VHlwZV9zdWNjZXNzKTsKICAgICAgZnVuY3Rpb24gdXBkYXRlRXZlbnRUeXBlX3N1Y2Nlc3MoKQogICAgICB7CiAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9ldmVudF90eXBlcycpOwogICAgICB9CiAgICB9Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignZXZlbnRDcmVhdGVNb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkcm9vdFNjb3BlLCBzaGFyZWRQcm9wZXJ0aWVzLCBldmVudF90eXBlX2lkLCBsb2NhdGlvbl9pZCwgZW1wX2lkLCAkaHR0cCwgc3RhcnREYXRlLCByZXNjaGVkdWxlX2V2ZW50LCB1aUNhbGVuZGFyQ29uZmlnKSB7CiAgICBzdGFydERhdGU9bmV3IG1vbWVudChzdGFydERhdGUpOwogICAgbG9nRGVidWcoImV2ZW50Q3JlYXRlTW9kYWxDb250cm9sbGVyLCBzdGFydERhdGU9IitzdGFydERhdGUrIiB0eXBlICIrdHlwZW9mIHN0YXJ0RGF0ZSk7CiAgICBsb2dEZWJ1ZygiZXZlbnRDcmVhdGVNb2RhbENvbnRyb2xsZXIsIHJlc2NoZWR1bGVfZXZlbnQ9IityZXNjaGVkdWxlX2V2ZW50KTsKCiAgICAkc2NvcGUuZXZlbnRUeXBlVGl0bGUgPSAi15HXl9eoINeh15XXkiDXntek15LXqSI7CiAgICAkc2NvcGUuc2hvd0V2ZW50VHlwZVNlbGVjdGVkID0gZmFsc2U7CiAgICAkc2NvcGUuc2hvd0V2ZW50Q2xpZW50U2VsZWN0ZWQgPSBmYWxzZTsKICAgICRzY29wZS5uZXdFdmVudERldGFpbHMgPSB7fTsgLy8gdGhlc2UgYXJlIHRoZSBjb21wbGV0ZSBkZXRhaWxzIGZvciB0aGUgbmV3IGV2ZW50IC8vCiAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnJlcGVhdFR5cGUgPSAiZm9yZXZlciI7CiAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnJlcGVhdEZpeGVkVGltZXMgPSAiNCI7CiAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLm1heF9wYXJ0aWNpcGFudHMgPSAxOwoKICAgIGxvZ0RlYnVnKCJYWFggPSAiK0pTT04uc3RyaW5naWZ5KHJlc2NoZWR1bGVfZXZlbnQpKTsKCiAgICAkc2NvcGUucmVzY2hlZHVsZV9ldmVudD1mYWxzZTsKICAgICRzY29wZS5yZXNjaGVkdWxlX2V2ZW50X2RldGFpbHM9cmVzY2hlZHVsZV9ldmVudDsKICAgIGlmICgkc2NvcGUucmVzY2hlZHVsZV9ldmVudF9kZXRhaWxzIT1udWxsKQogICAgewogICAgICBsb2dEZWJ1ZygicmVzY2hlZHVsZV9ldmVudF9kZXRhaWxzPSIrJHNjb3BlLnJlc2NoZWR1bGVfZXZlbnRfZGV0YWlscy5ldmVudF9pZCk7CiAgICAgIGxvZ0RlYnVnKEpTT04uc3RyaW5naWZ5KCRzY29wZS5yZXNjaGVkdWxlX2V2ZW50X2RldGFpbHMpKTsKICAgICAgJHNjb3BlLnJlc2NoZWR1bGVfZXZlbnQ9dHJ1ZTsKICAgICAgJHNjb3BlLmdpdmVuX2V2ZW50X3R5cGVfaWQgPSAkc2NvcGUucmVzY2hlZHVsZV9ldmVudF9kZXRhaWxzLmV2ZW50X3R5cGVfaWQ7CiAgICAgIC8vIHN0aWxsIHByZWZlcmluZyBlbXBfaWQgZnJvbSBzY2hlZHVsZXIgc3VnZ2VzdGlvbiBpcyBpdCB3YXMgc2VsZWN0ZWQKICAgICAgaWYgKGVtcF9pZCE9MCkKICAgICAgewogICAgICAgICRzY29wZS5naXZlbl9lbXBfaWQgPSBlbXBfaWQ7CiAgICAgIH0KICAgICAgZWxzZQogICAgICB7CiAgICAgICAgJHNjb3BlLmdpdmVuX2VtcF9pZCA9ICRzY29wZS5yZXNjaGVkdWxlX2V2ZW50X2RldGFpbHMuaW5zdHJ1Y3Rvcl9pZDsKICAgICAgfQogICAgICAvLyBzdGlsbCBwcmVmZXJpbmcgbG9jYXRpb25faWQgZnJvbSBzY2hlZHVsZXIgc3VnZ2VzdGlvbiBvdmVyIHRoZSBvcmlnaW5hbCBsb2NhdGlvbiBmcm9tIGV2ZW50CiAgICAgIGlmIChsb2NhdGlvbl9pZCE9MCkKICAgICAgewogICAgICAgICRzY29wZS5naXZlbl9sb2NhdGlvbl9pZCA9IGxvY2F0aW9uX2lkOwogICAgICB9CiAgICAgIGVsc2UKICAgICAgewogICAgICAgICRzY29wZS5naXZlbl9sb2NhdGlvbl9pZCA9ICRzY29wZS5yZXNjaGVkdWxlX2V2ZW50X2RldGFpbHMubG9jYXRpb25faWQ7CiAgICAgIH0KICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgJHNjb3BlLmdpdmVuX2V2ZW50X3R5cGVfaWQgPSBldmVudF90eXBlX2lkOwogICAgICAkc2NvcGUuZ2l2ZW5fbG9jYXRpb25faWQgPSBsb2NhdGlvbl9pZDsKICAgICAgJHNjb3BlLmdpdmVuX2VtcF9pZCA9IGVtcF9pZDsKICAgIH0KICAgIGlmICgkc2NvcGUuZ2l2ZW5fZXZlbnRfdHlwZV9pZD4wKQogICAgewogICAgICAkc2NvcGUucHJldmlvdXNseV9zZWxlY3RlZF9ldmVudF90eXBlPXRydWU7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICRzY29wZS5wcmV2aW91c2x5X3NlbGVjdGVkX2V2ZW50X3R5cGU9ZmFsc2U7CiAgICB9CiAgICBsb2dEZWJ1ZygiJHNjb3BlLmdpdmVuX2V2ZW50X3R5cGVfaWQ9Iiskc2NvcGUuZ2l2ZW5fZXZlbnRfdHlwZV9pZCk7CgogICAgc2VsZWN0ZWREYXRlU3RhcnQgPSBuZXcgRGF0ZShzdGFydERhdGUpOwogICAgbG9nRGVidWcoInNlbGVjdGVkRGF0ZVN0YXJ0ID0gIitzZWxlY3RlZERhdGVTdGFydCk7CiAgICB2YXIgc2VsZWN0ZWREYXRlU3RhcnQgPSBuZXcgRGF0ZShzZWxlY3RlZERhdGVTdGFydC5nZXRUaW1lKCkgKyBzZWxlY3RlZERhdGVTdGFydC5nZXRUaW1lem9uZU9mZnNldCgpICogNjAwMDApOwoKICAgIC8vIGxvZ0RlYnVnKCJkYXRlPSIgKyBzZWxlY3RlZERhdGVTdGFydCk7CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudCA9IFtdOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycyA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldEhvdXJzKCk7CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBzZWxlY3RlZERhdGVTdGFydC5nZXRNaW51dGVzKCk7CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRvdyA9IGRheU5hbWVzW3NlbGVjdGVkRGF0ZVN0YXJ0LmdldERheSgpXTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF0ZSA9IHNlbGVjdGVkRGF0ZVN0YXJ0OwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aCA9IG1vbnRoTmFtZXNbc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TW9udGgoKV07CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoMTEyID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TW9udGgoKSsxOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXlvZm1vbnRoID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RGF0ZSgpOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RnVsbFllYXIoKTsKICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZV9pbnB1dF9mb3JtYXQ9IG5ldyBEYXRlKDE5NzAsIDAsIDEsICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMsICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcywgMCk7CgogICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pbnN0cnVjdG9yX2lkID0gJHNjb3BlLmdpdmVuX2VtcF9pZDsKICAgICRzY29wZS5uZXdFdmVudERldGFpbHMubG9jYXRpb25faWQgPSAkc2NvcGUuZ2l2ZW5fbG9jYXRpb25faWQ7CgogICAgZ2V0QnVzaW5lc3NMb2NhdGlvbnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19sb2NhdGlvbnMnLGdldEJ1c2luZXNzTG9jYXRpb25zX2ZpbmlzaCk7CiAgICBmdW5jdGlvbiBnZXRCdXNpbmVzc0xvY2F0aW9uc19maW5pc2goKQogICAgewogICAgICBpZiAoJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5sb2NhdGlvbl9pZD09MCkKICAgICAgewogICAgICAgICRzY29wZS5uZXdFdmVudERldGFpbHMubG9jYXRpb25faWQ9JHNjb3BlLmJ1c2luZXNzX2xvY2F0aW9uc1swXS5sb2NhdGlvbl9pZDsKICAgICAgfQogICAgfQoKICAgIGNvbnNvbGUubG9nKCIkc2NvcGUubmV3RXZlbnREZXRhaWxzLmluc3RydWN0b3JfaWQ9Iiskc2NvcGUubmV3RXZlbnREZXRhaWxzLmluc3RydWN0b3JfaWQpOwogICAgLy8gaWYgY2xpZW50IHdhcyBwcmV2aW91c2x5IHNlbGVjdGVkCiAgICAkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcj1mYWxzZTsKICAgIGxvZ0RlYnVnKCJzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyPSIrc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcik7CiAgICBpZiAoc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpIT1udWxsKQogICAgewogICAgICAvLyBjb25zb2xlLmxvZygiZ290IHByZXZpb3VzIHNlbGVjdGVkIHVzZXIgIitzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfZmlyc3RfbmFtZSk7CiAgICAgICRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VybmFtZT1zaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfZmlyc3RfbmFtZSsiICIrc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2VyX2xhc3RfbmFtZTsKICAgICAgJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXI9dHJ1ZTsKCiAgICAgICRzY29wZS5zaG93RXZlbnRDbGllbnRTZWxlY3RlZCA9IHRydWU7CiAgICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kdXNlcl9pZCA9IHNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKS5idXNpbmVzc191c2VyX2lkOwogICAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZHVzZXJfZmlyc3RfbmFtZSA9IHNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKS5idXNlcl9maXJzdF9uYW1lOwogICAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZHVzZXJfbGFzdF9uYW1lID0gc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2VyX2xhc3RfbmFtZTsKICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5idXNpbmVzc191c2VyX2lkID0gc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2luZXNzX3VzZXJfaWQ7CgogICAgfQogICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5zdGFydF90aW1lID0gc3RhcnREYXRlOwogICAgbG9nRGVidWcoIiRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZTE9Iiskc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWUpOwogICAgJHNjb3BlLnN0YXJ0TWludXRlcyA9IGZ1bmN0aW9uKCkKICAgIHsKICAgICAgbG9nRGVidWcoInN0YXJ0TWludXRlcyAiKygkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpKTsKICAgICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzPW1pbnV0ZXNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcyk7CiAgICAgIGNhbGN1bGF0ZVN0YXJ0VGltZSgpOwogICAgICBjYWxjdWxhdGVFbmRUaW1lRHluYW1pYygpOwogICAgfQogICAgJHNjb3BlLnN0YXJ0SG91cnMgPSBmdW5jdGlvbigpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJzdGFydEhvdXJzICIraG91cnNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMpKTsKICAgICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3Vycz1ob3Vyc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3Vycyk7CiAgICAgIGNhbGN1bGF0ZVN0YXJ0VGltZSgpOwogICAgICBjYWxjdWxhdGVFbmRUaW1lRHluYW1pYygpOwogICAgfQoKICAgICRzY29wZS5lbmRNaW51dGVzID0gZnVuY3Rpb24oKQogICAgewogICAgICBsb2dEZWJ1ZygiZW5kTWludXRlcyAiKygkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzKSk7CiAgICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXM9bWludXRlc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcyk7CiAgICAgIGNhbGN1bGF0ZVN0YXJ0VGltZSgpOwogICAgICBjYWxjdWxhdGVFbmRUaW1lRHluYW1pYygpOwogICAgfQogICAgJHNjb3BlLmVuZEhvdXJzID0gZnVuY3Rpb24oKQogICAgewogICAgICBsb2dEZWJ1ZygiZW5kSG91cnMgIitob3Vyc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMpKTsKICAgICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnM9aG91cnNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzKTsKICAgICAgY2FsY3VsYXRlU3RhcnRUaW1lKCk7CiAgICAgIGNhbGN1bGF0ZUVuZFRpbWVEeW5hbWljKCk7CiAgICB9CgogICAgZnVuY3Rpb24gY2FsY3VsYXRlU3RhcnRUaW1lKCkKICAgIHsKICAgICAgZXZlbnRZZWFyPSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0eWVhcjsKICAgICAgZXZlbnRNb250aD0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoMTEyOwogICAgICBldmVudERheT0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRheW9mbW9udGg7CiAgICAgIGlmIChwYXJzZUludChldmVudE1vbnRoKTwxMCkKICAgICAgewogICAgICAgIGV2ZW50TW9udGg9IjAiK2V2ZW50TW9udGg7CiAgICAgIH0KICAgICAgaWYgKHBhcnNlSW50KGV2ZW50RGF5KTwxMCkKICAgICAgewogICAgICAgIGV2ZW50RGF5PSIwIitldmVudERheTsKICAgICAgfQogICAgICBsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyPSIrZXZlbnRZZWFyKTsKICAgICAgbG9nRGVidWcoIiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aD0iK2V2ZW50TW9udGgpOwogICAgICBsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aD0iK2V2ZW50RGF5KTsKICAgICAgbmV3X3N0YXJ0PW1vbWVudC51dGMoZXZlbnRZZWFyKyItIitldmVudE1vbnRoKyItIitldmVudERheSsiVDAwOjAwOjAwIikuYWRkKCgocGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykqNjApK3BhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcykpLCAnbWludXRlcycpOwogICAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWU9bmV3X3N0YXJ0OwogICAgICBsb2dEZWJ1ZygibmV3X3N0YXJ0PSIrbmV3X3N0YXJ0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG1pbnV0ZXNDaGFuZ2VkKHRoZW1pbnV0ZXMpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJ0aGVtaW51dGVzPSIrdGhlbWludXRlcyk7CiAgICAgIGlmICh0eXBlb2YgdGhlbWludXRlcz09InVuZGVmaW5lZCIpCiAgICAgIHsKICAgICAgICByZXR1cm4gIjAwIjsKICAgICAgfQogICAgICBpZiAoaXNOYU4odGhlbWludXRlcykpCiAgICAgIHsKICAgICAgICByZXR1cm4gIjAwIjsKICAgICAgfQogICAgICBpZiAodGhlbWludXRlcz09JycpCiAgICAgIHsKICAgICAgICByZXR1cm4gIjAwIjsKICAgICAgfQogICAgICB0aGVtaW51dGVzPXBhcnNlSW50KHRoZW1pbnV0ZXMpOwogICAgICBpZiAodGhlbWludXRlcz42MCkKICAgICAgewogICAgICAgIHJldHVybiAiMDAiOwogICAgICB9CiAgICAgIGVsc2UgaWYgKHRoZW1pbnV0ZXM8MCkKICAgICAgewogICAgICAgIHJldHVybiAiMDAiOwogICAgICB9CiAgICAgIGVsc2UgaWYgKHRoZW1pbnV0ZXM9PSIiKQogICAgICB7CiAgICAgICAgcmV0dXJuICIwMCI7CiAgICAgIH0KICAgICAgZWxzZSBpZiAodGhlbWludXRlczwxMCkKICAgICAgewogICAgICAgIHJldHVybiAiMCIrdGhlbWludXRlczsKICAgICAgfQogICAgICBlbHNlCiAgICAgIHsKICAgICAgICAgIHJldHVybiB0aGVtaW51dGVzOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBob3Vyc0NoYW5nZWQodGhlaG91cnMpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJ0aGVob3Vycz0iK3RoZWhvdXJzKTsKICAgICAgaWYgKHR5cGVvZiB0aGVob3Vycz09InVuZGVmaW5lZCIpCiAgICAgIHsKICAgICAgICByZXR1cm4gIjAiOwogICAgICB9CiAgICAgIGlmIChpc05hTih0aGVob3VycykpCiAgICAgIHsKICAgICAgICByZXR1cm4gIjAiOwogICAgICB9CiAgICAgIGlmICh0aGVob3Vycz09JycpCiAgICAgIHsKICAgICAgICByZXR1cm4gIjAiOwogICAgICB9CiAgICAgIHRoZWhvdXJzPXBhcnNlSW50KHRoZWhvdXJzKTsKICAgICAgaWYgKHRoZWhvdXJzPjI0KQogICAgICB7CiAgICAgICAgcmV0dXJuIDA7CiAgICAgIH0KICAgICAgZWxzZSBpZiAodGhlaG91cnM8MCkKICAgICAgewogICAgICAgIHJldHVybiAwOwogICAgICB9CiAgICAgIGVsc2UgaWYgKHRoZWhvdXJzPT0iIikKICAgICAgewogICAgICAgIHJldHVybiAiMCI7CiAgICAgIH0KICAgICAgZWxzZQogICAgICB7CiAgICAgICAgICByZXR1cm4gdGhlaG91cnM7CiAgICAgIH0KICAgIH0KICAgIGdldEFsbEluc3RydWN0b3JzKCRodHRwLCRzY29wZSwnaW5zdHJ1Y3RvcnMnLGdldEFsbEluc3RydWN0b3JzX3N1Y2Nlc3MpOwogICAgZnVuY3Rpb24gZ2V0QWxsSW5zdHJ1Y3RvcnNfc3VjY2VzcygpCiAgICB7CiAgICAgIC8vICRzY29wZS5pbnN0cnVjdG9ycy51bnNoaWZ0KHtidXNpbmVzc191c2VyX2lkOm51bGwsIGJ1c2VyX2ZpcnN0X25hbWU6IiIsIGJ1c2VyX2xhc3RfbmFtZToiIn0pOwogICAgICBpZiAoISRzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZD4wKQogICAgICB7CiAgICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pbnN0cnVjdG9yX2lkPSRzY29wZS5pbnN0cnVjdG9yc1swXS5idXNpbmVzc191c2VyX2lkOwogICAgICB9CiAgICB9CgogICAgJHNjb3BlLnNlbGVjdEV2ZW50VHlwZSA9IGZ1bmN0aW9uKCkgewogICAgICAgIC8vIHJlbW92aW5nIGV2ZW50IHR5cGUg15HXl9eoINeh15XXkiDXntek15LXqQogICAgICAgIGlmICgkc2NvcGUuZXZlbnRUeXBlT3B0aW9uc1swXS5ldmVudF90eXBlX2lkPT0wKQogICAgICAgIHsKICAgICAgICAgICRzY29wZS5ldmVudFR5cGVPcHRpb25zLnNwbGljZSgwLCAxKTsKICAgICAgICB9CiAgICAgICAgJHNjb3BlLmFqYXhfZXJyb3I9Jyc7CiAgICAgICAgY2hvaWNlPSRzY29wZS5zZWxlY3RFdmVudFR5cGVTZWxlY3RlZDsKICAgICAgICBsb2dEZWJ1Zygic2VsZWN0RXZlbnRUeXBlIik7CiAgICAgICAgbG9nRGVidWcoSlNPTi5zdHJpbmdpZnkoJHNjb3BlLnNlbGVjdEV2ZW50VHlwZVNlbGVjdGVkKSk7CiAgICAgICAgJHNjb3BlLmV2ZW50VHlwZVRpdGxlID0gY2hvaWNlLmV2ZW50X3R5cGVfbmFtZTsKICAgICAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmV2ZW50X3R5cGVfaWQgPSBjaG9pY2UuZXZlbnRfdHlwZV9pZDsKCiAgICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5ldmVudF9uYW1lID0gY2hvaWNlLmV2ZW50X3R5cGVfbmFtZTsKICAgICAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLm9yaWdpbmFsX2V2ZW50X25hbWUgPSBjaG9pY2UuZXZlbnRfdHlwZV9uYW1lOwogICAgICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuZXZlbnRfZGVzY3JpcHRpb24gPSBjaG9pY2UuZXZlbnRfdHlwZV9kZXNjcmlwdGlvbjsKICAgICAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmlzX2NsYXNzID0gY2hvaWNlLmlzX2NsYXNzOwogICAgICAgICRzY29wZS5uZXdFdmVudERldGFpbHMub3JpZ2luYWxfcHJpY2UgPSBjaG9pY2Uub3JpZ2luYWxfcHJpY2U7CiAgICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pc19nZW5lcmljX2V0eXBlID0gY2hvaWNlLmlzX2dlbmVyaWNfZXR5cGU7CiAgICAgICAgLy8gJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pbnN0cnVjdG9yX2lkID0gY2hvaWNlLmluc3RydWN0b3JfaWQ7CiAgICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5kdXJhdGlvbl9ldmVudCA9IGNob2ljZS5kdXJhdGlvbl9ldmVudDsKICAgICAgICAvLyBsb2dEZWJ1Zygic2NvcGUubmV3RXZlbnREZXRhaWxzLmlzX2NsYXNzPSIrJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pc19jbGFzcyk7CiAgICAgICAgLy8gbG9nRGVidWcoInNjb3BlLm5ld0V2ZW50RGV0YWlscy5pbnN0cnVjdG9yX2lkPSIrJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pbnN0cnVjdG9yX2lkKTsKICAgICAgICAvLyBsb2dEZWJ1Zygic3RhcnREYXRlPSIrc3RhcnREYXRlKTsKICAgICAgICAvLyAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWUgPSBzdGFydERhdGU7CiAgICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5ldmVudHR5cGUgPSBjaG9pY2U7CiAgICAgICAgY2FsY3VsYXRlRW5kVGltZSgpOwoKICAgICAgICAvLyAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWVfaW5wdXRfZm9ybWF0PSBuZXcgRGF0ZSgxOTcwLCAwLCAxLCAxNCwgNTcsIDApOwoKICAgICAgICBsb2dEZWJ1ZygibmV3RXZlbnQgc3RhcnQ9IiArICRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZSk7CiAgICAgICAgbG9nRGVidWcoIm5ld0V2ZW50IGVuZD0iICsgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmRfdGltZSk7CgogICAgICAgICRzY29wZS5zaG93RXZlbnRUeXBlU2VsZWN0ZWQgPSB0cnVlOwogICAgfQoKICAgIC8vIHRoaXMgZnVuY3Rpb24gY2FsY3VsYXRlcyBlbmQgdGltZSBhY2NvcmRpbmcgdG8gdGhlIGxlbmd0aCBvZiB0aGUgZXZlbnR0eXBlCiAgICBmdW5jdGlvbiBjYWxjdWxhdGVFbmRUaW1lKCkKICAgIHsKICAgICAgY29uc29sZS5sb2coIiRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZT0iKyRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZSk7CiAgICAgIGVuZCA9IG1vbWVudCgkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWUpLmFkZCgkc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50LCAnbWludXRlcycpOwogICAgICBzZWxlY3RlZERhdGVFbmQgPSBuZXcgRGF0ZShlbmQpOwogICAgICBzZWxlY3RlZERhdGVFbmQgPSBuZXcgRGF0ZShzZWxlY3RlZERhdGVFbmQuZ2V0VGltZSgpICsgc2VsZWN0ZWREYXRlRW5kLmdldFRpbWV6b25lT2Zmc2V0KCkgKiA2MDAwMCk7CiAgICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzID0gc2VsZWN0ZWREYXRlRW5kLmdldEhvdXJzKCk7CiAgICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGRvdyA9IGRheU5hbWVzW3NlbGVjdGVkRGF0ZUVuZC5nZXREYXkoKV07CiAgICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKSA8IDEwID8gJzAnIDogJycpICsgc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKTsKICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmRfdGltZSA9IGVuZDsKICAgICAgLy8gY2FsY3VsYXRpbmcgZHVyYXRpb24KICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5kdXJhdGlvbl9ldmVudD1wYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzKS1wYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpOwogICAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50PSRzY29wZS5uZXdFdmVudERldGFpbHMuZHVyYXRpb25fZXZlbnQrKHBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzKS1wYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKSkqNjA7CiAgICAgIGlmICgkc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50PDApCiAgICAgIHsKICAgICAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50PTA7CiAgICAgIH0KICAgIH0KCiAgICAvLyB0aGlzIGZ1bmN0aW9uIGNhbGN1bGF0ZXMgZW5kIHRpbWUgYWNjb3JkaW5nIHRvIHRoZSBpbnB1dCBmcm9tIG1vZGFsIHdpbmRvdwogICAgLy8gYW5kIG5vdCBhY2NvcmRpbmcgdG8gZXZlbnQgdHlwZSBsZW5ndGgKICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZUVuZFRpbWVEeW5hbWljKCkKICAgIHsKICAgICAgZXZlbnRZZWFyPSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0eWVhcjsKICAgICAgZXZlbnRNb250aD0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoMTEyOwogICAgICBldmVudERheT0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRheW9mbW9udGg7CiAgICAgIGlmIChwYXJzZUludChldmVudE1vbnRoKTwxMCkKICAgICAgewogICAgICAgIGV2ZW50TW9udGg9IjAiK2V2ZW50TW9udGg7CiAgICAgIH0KICAgICAgaWYgKHBhcnNlSW50KGV2ZW50RGF5KTwxMCkKICAgICAgewogICAgICAgIGV2ZW50RGF5PSIwIitldmVudERheTsKICAgICAgfQogICAgICBsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyPSIrZXZlbnRZZWFyKTsKICAgICAgbG9nRGVidWcoIiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aD0iK2V2ZW50TW9udGgpOwogICAgICBsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aD0iK2V2ZW50RGF5KTsKICAgICAgbmV3X2VuZD1tb21lbnQudXRjKGV2ZW50WWVhcisiLSIrZXZlbnRNb250aCsiLSIrZXZlbnREYXkrIlQwMDowMDowMCIpLmFkZCgoKHBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzKSo2MCkrcGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcykpLCAnbWludXRlcycpOwogICAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZF90aW1lPW5ld19lbmQ7CiAgICAgIGxvZ0RlYnVnKCJuZXdfZW5kPSIrbmV3X2VuZCk7CiAgICAgIC8vIGNhbGN1bGF0aW5nIGR1cmF0aW9uCiAgICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuZHVyYXRpb25fZXZlbnQ9cGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcyktcGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKTsKICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5kdXJhdGlvbl9ldmVudD0kc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50KyhwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycyktcGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykpKjYwOwogICAgICBpZiAoJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5kdXJhdGlvbl9ldmVudDwwKQogICAgICB7CiAgICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5kdXJhdGlvbl9ldmVudD0wOwogICAgICB9CiAgICB9CiAgICBnZXRBbGxCdXNpbmVzc0V2ZW50VHlwZXMoJGh0dHAsJHNjb3BlLCdldmVudFR5cGVPcHRpb25zJyxnZXRBbGxCdXNpbmVzc0V2ZW50VHlwZXNfc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBnZXRBbGxCdXNpbmVzc0V2ZW50VHlwZXNfc3VjY2VzcygpCiAgICB7CiAgICAgIC8vIGFmdGVyIGxvYWRpbmcgZXZlbnQgdHlwZXMsIGlmIHRoZSBnaXZlbiBldmVudCB0eXBlIGlzICE9IDAgd2UgInNlbGVjdCIgaXQKICAgICAgY29uc29sZS5sb2coImdldEFsbEJ1c2luZXNzRXZlbnRUeXBlc19zdWNjZXNzIik7CiAgICAgIGlmICgkc2NvcGUuZ2l2ZW5fZXZlbnRfdHlwZV9pZD4wKQogICAgICB7CiAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8ICRzY29wZS5ldmVudFR5cGVPcHRpb25zLmxlbmd0aDsgaSsrKQogICAgICAgIHsKICAgICAgICAgIGlmICgkc2NvcGUuZXZlbnRUeXBlT3B0aW9uc1tpXS5ldmVudF90eXBlX2lkPT0kc2NvcGUuZ2l2ZW5fZXZlbnRfdHlwZV9pZCkKICAgICAgICAgIHsKICAgICAgICAgICAgY29uc29sZS5sb2coImdpdmVuX2V2ZW50X3R5cGVfaWQgZm91bmQiKTsKICAgICAgICAgICAgLy8gJHNjb3BlLmNhbGN1bGF0ZVN0YXJ0VGltZSgpOwogICAgICAgICAgICAkc2NvcGUuc2VsZWN0RXZlbnRUeXBlU2VsZWN0ZWQ9JHNjb3BlLmV2ZW50VHlwZU9wdGlvbnNbaV07CiAgICAgICAgICAgIC8vICRzY29wZS5zZWxlY3RFdmVudFR5cGUoJHNjb3BlLmV2ZW50VHlwZU9wdGlvbnNbaV0pOwogICAgICAgICAgICAkc2NvcGUuc2VsZWN0RXZlbnRUeXBlKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGVsc2UgewogICAgICAgICRzY29wZS5ldmVudFR5cGVPcHRpb25zLnVuc2hpZnQoeyJldmVudF90eXBlX2lkIjowLCAiZXZlbnRfdHlwZV9uYW1lIjoi15HXl9eoINeh15XXkiDXntek15LXqSIsIGlzX3ZhY2F0aW9uOiAwfSk7CiAgICAgICAgJHNjb3BlLnNlbGVjdEV2ZW50VHlwZVNlbGVjdGVkPSRzY29wZS5ldmVudFR5cGVPcHRpb25zWzBdOwogICAgICB9CiAgICB9CiAgICBnZXRBbGxDbGllbnRzKCRodHRwLCRzY29wZSwnZXZlbnRUeXBlVXNlcnMnKTsKCiAgICAkc2NvcGUuZXZlbnRDbGllbnRTZWxlY3RlZCA9IGZ1bmN0aW9uKHNlbGVjdGVkKSB7CiAgICAgICAgaWYgKHNlbGVjdGVkKSB7CiAgICAgICAgICAgIC8vIGFsZXJ0KEpTT04uc3RyaW5naWZ5KCBzZWxlY3RlZCwgbnVsbCwgMiApKTsKICAgICAgICAgICAgbG9nRGVidWcoJ2NsaWVudCBzZWxlY3RlZCAnICsgc2VsZWN0ZWQub3JpZ2luYWxPYmplY3QuYnVzZXJfZmlyc3RfbmFtZSk7CiAgICAgICAgICAgICRzY29wZS5zaG93RXZlbnRDbGllbnRTZWxlY3RlZCA9IHRydWU7CiAgICAgICAgICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kdXNlcl9pZCA9IHNlbGVjdGVkLm9yaWdpbmFsT2JqZWN0LmJ1c2luZXNzX3VzZXJfaWQ7CiAgICAgICAgICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kdXNlcl9maXJzdF9uYW1lID0gc2VsZWN0ZWQub3JpZ2luYWxPYmplY3QuYnVzZXJfZmlyc3RfbmFtZTsKICAgICAgICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmR1c2VyX2xhc3RfbmFtZSA9IHNlbGVjdGVkLm9yaWdpbmFsT2JqZWN0LmJ1c2VyX2xhc3RfbmFtZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBsb2dEZWJ1Zygnbm90IHNlbGVjdGVkJyk7CiAgICAgICAgICAgIC8vICRzY29wZS5ldmVudENsaWVudERlU2VsZWN0ZWQoKTsKICAgICAgICB9CiAgICB9OwogICAgJHNjb3BlLmV2ZW50Q2xpZW50RGVTZWxlY3RlZCA9IGZ1bmN0aW9uKCkgewogICAgICAgICRzY29wZS5zaG93RXZlbnRDbGllbnRTZWxlY3RlZCA9IGZhbHNlOwogICAgICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kdXNlcl9pZCA9IG51bGw7CiAgICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmR1c2VyX2ZpcnN0X25hbWUgPSBudWxsOwogICAgICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kdXNlcl9sYXN0X25hbWUgPSBudWxsOwogICAgICAgICRzY29wZS5jbGVhckNsaWVudElucHV0KCdjbGllbnRfYW5ndWNvbXBsZXRlJyk7CiAgICB9CgogICAgJHNjb3BlLmNsZWFyQ2xpZW50SW5wdXQgPSBmdW5jdGlvbihpZCkgewogICAgICAgIGlmIChpZCkgewogICAgICAgICAgICAkc2NvcGUuJGJyb2FkY2FzdCgnYW5ndWNvbXBsZXRlLWFsdDpjbGVhcklucHV0JywgaWQpOwogICAgICAgIH0KICAgICAgICAvLyBlbHNlewogICAgICAgIC8vICAgJHNjb3BlLiRicm9hZGNhc3QoJ2FuZ3Vjb21wbGV0ZS1hbHQ6Y2xlYXJJbnB1dCcpOwogICAgICAgIC8vIH0KICAgIH0KCiAgICAkc2NvcGUuY2FuY2VsID0gZnVuY3Rpb24oKSB7CiAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgfTsKCiAgICAkc2NvcGUudXBkYXRlRXZlbnROYW1lQ2hlY2sgPSBmdW5jdGlvbihuZXdWYWx1ZSkKICAgIHsKICAgICAgbG9nRGVidWcoInVwZGF0ZUV2ZW50TmFtZT0iK25ld1ZhbHVlKTsKICAgICAgaWYgKG5ld1ZhbHVlPT0iIikKICAgICAgewogICAgICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuZXZlbnRfbmFtZSA9ICRzY29wZS5uZXdFdmVudERldGFpbHMub3JpZ2luYWxfZXZlbnRfbmFtZTsKICAgICAgfQogICAgfQogICAgLy8gcmVzY2hlZHVsZUV2ZW50CiAgICAkc2NvcGUucmVzY2hlZHVsZUV2ZW50ID0gZnVuY3Rpb24oKSB7CiAgICAgIGxvZ0RlYnVnKCJmdW5jdGlvbjogcmVzY2hlZHVsZUV2ZW50Iik7CgogICAgICAvLyBuZXdFdmVudEpTT05EZXRhaWxzID0gSlNPTi5zdHJpbmdpZnkoJHNjb3BlLm5ld0V2ZW50RGV0YWlscywgbnVsbCwgNCk7IC8vIChPcHRpb25hbCkgYmVhdXRpZnVsIGluZGVudGVkIG91dHB1dC4KICAgICAgbG9nRGVidWcoInJlc2NoZWR1bGVFdmVudCwgIiArIEpTT04uc3RyaW5naWZ5KCRzY29wZS5uZXdFdmVudERldGFpbHMsIG51bGwsIDQpKTsKICAgICAgLy8gaWYgKCRzY29wZS5uZXdFdmVudERldGFpbHMuZXZlbnRSZWN1cnJpbmcpIHsKICAgICAgLy8gICBjcmVhdGVSZWN1cnJpbmdFdmVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLm5ld0V2ZW50RGV0YWlscyxjcmVhdGVSZWN1cnJpbmdFdmVudF9zdWNjZXNzKTsKICAgICAgLy8gICBmdW5jdGlvbiBjcmVhdGVSZWN1cnJpbmdFdmVudF9zdWNjZXNzKCkKICAgICAgLy8gICB7CiAgICAgIC8vICAgICBjYWxlbmRhciA9ICJjYWxlbmRhcl9idXNpbmVzcyI7CiAgICAgIC8vICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZWZldGNoRXZlbnRzJyk7CiAgICAgIC8vICAgICAkdWliTW9kYWxJbnN0YW5jZS5kaXNtaXNzKCk7CiAgICAgIC8vICAgICAvLyBlcnJvciB3YXMKICAgICAgLy8gICAgIC8vIGxvZ0RlYnVnKCJlcnJvciAiICsgZGF0YS5NZXNzYWdlKTsKICAgICAgLy8gICAgIC8vICRzY29wZS5hamF4X2Vycm9yID0gZGF0YS5NZXNzYWdlOwogICAgICAvLyAgIH0KICAgICAgLy8gfQogICAgICAvLyBlbHNlCiAgICAgIHsKICAgICAgICAvLyBpZiBldmVudCBpcyBub3QgY2xhc3MsIGEgY2xpZW50IG11c3QgYmUgc2VsZWN0ZWQKICAgICAgICAvLyBpZiAoKCEkc2NvcGUuc2hvd0V2ZW50Q2xpZW50U2VsZWN0ZWQpICYmICghJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pc19jbGFzcykpCiAgICAgICAgLy8gewogICAgICAgIC8vICAgLy8gYWxlcnQoJ2NsaWVudCBtdXN0IGJlIHNlbGVjdGVkJyk7CiAgICAgICAgLy8gICAkc2NvcGUuYWpheF9lcnJvcj0i15DXoNeQINeU15XXodejINee16nXqteq16Mg15zXntek15LXqSI7CiAgICAgICAgLy8gICByZXR1cm47CiAgICAgICAgLy8gfQogICAgICAgIHJlc2NoZWR1bGVFdmVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLnJlc2NoZWR1bGVfZXZlbnRfZGV0YWlscy5ldmVudF9pZCwkc2NvcGUubmV3RXZlbnREZXRhaWxzLHJlc2NoZWR1bGVFdmVudF9zdWNjZXNzKTsKICAgICAgICBmdW5jdGlvbiByZXNjaGVkdWxlRXZlbnRfc3VjY2VzcygpCiAgICAgICAgewogICAgICAgICAgY2FsZW5kYXIgPSAiY2FsZW5kYXJfYnVzaW5lc3MiOwogICAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwogICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjYWxlbmRhckV2ZW50UmVzY2hlZHVsZURlc2VsZWN0Jyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCiAgICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5kaXNtaXNzKCdhZGRlZCcpOwogICAgICAgIH0KICAgICAgICAvLyBvbiBmYWlsdXJlIHdhcwogICAgICAgIC8vICRzY29wZS5hamF4X2Vycm9yID0gZGF0YS5NZXNzYWdlOwogICAgICB9CiAgICB9OwoKICAgICRzY29wZS5jcmVhdGVOZXdFdmVudCA9IGZ1bmN0aW9uKCkgewogICAgICAgIGxvZ0RlYnVnKCJjcmVhdGVOZXdFdmVudCBzdGFydF90aW1lPSIrIHR5cGVvZiAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWUpOwoKICAgICAgICBuZXdFdmVudEpTT05EZXRhaWxzID0gSlNPTi5zdHJpbmdpZnkoJHNjb3BlLm5ld0V2ZW50RGV0YWlscywgbnVsbCwgNCk7IC8vIChPcHRpb25hbCkgYmVhdXRpZnVsIGluZGVudGVkIG91dHB1dC4KICAgICAgICBsb2dEZWJ1ZygiY3JlYXRlTmV3RXZlbnQsICIgKyBuZXdFdmVudEpTT05EZXRhaWxzKTsKICAgICAgICBpZiAoJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5ldmVudFJlY3VycmluZykgewogICAgICAgICAgY3JlYXRlUmVjdXJyaW5nRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5uZXdFdmVudERldGFpbHMsY3JlYXRlUmVjdXJyaW5nRXZlbnRfc3VjY2Vzcyk7CiAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVSZWN1cnJpbmdFdmVudF9zdWNjZXNzKCkKICAgICAgICAgIHsKICAgICAgICAgICAgY2FsZW5kYXIgPSAiY2FsZW5kYXJfYnVzaW5lc3MiOwogICAgICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZWZldGNoRXZlbnRzJyk7CiAgICAgICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoKTsKICAgICAgICAgICAgLy8gZXJyb3Igd2FzCiAgICAgICAgICAgIC8vIGxvZ0RlYnVnKCJlcnJvciAiICsgZGF0YS5NZXNzYWdlKTsKICAgICAgICAgICAgLy8gJHNjb3BlLmFqYXhfZXJyb3IgPSBkYXRhLk1lc3NhZ2U7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAvLyBjaGVja2luZyBldmVudCB0aW1lIGxvZ2ljCiAgICAgICAgICBpZiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3Vycz4kc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycykKICAgICAgICAgIHsKICAgICAgICAgICAgJHNjb3BlLmFqYXhfZXJyb3I9IteW157XnyDXlNeU16rXl9ec15Qg16nXnCDXlNee16TXktepINeQ15fXqNeZINeW157XnyDXlNeh15nXldedINep15zXlSI7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIC8vIGNoZWNraW5nIGV2ZW50IHRpbWUgbG9naWMKICAgICAgICAgIGlmIChwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKT09cGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMpKQogICAgICAgICAgewogICAgICAgICAgICBpZiAocGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKT49cGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcykpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAkc2NvcGUuYWpheF9lcnJvcj0i15bXntefINeU15TXqteX15zXlCDXqdecINeU157XpNeS16kg15DXl9eo15kg15bXntefINeU16HXmdeV150g16nXnNeVIjsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbG9nRGVidWcoIiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcz0iKyRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcyk7CiAgICAgICAgICAgIGxvZ0RlYnVnKCIkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzPSIrJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcyk7CiAgICAgICAgICAgIGlmICgocGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKSs1KT49cGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcykpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAkc2NvcGUuYWpheF9lcnJvcj0i15DXldeo15og15TXntek15LXqSDXl9eZ15nXkSDXnNeU15nXldeqINec16TXl9eV16ogNSDXk9en15XXqiI7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICAvLyBpZiBldmVudCBpcyBub3QgY2xhc3MsIGEgY2xpZW50IG11c3QgYmUgc2VsZWN0ZWQKICAgICAgICAgIGlmICgoISRzY29wZS5zaG93RXZlbnRDbGllbnRTZWxlY3RlZCkgJiYgKCEkc2NvcGUubmV3RXZlbnREZXRhaWxzLmlzX2NsYXNzKSAmJiAoJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pc19nZW5lcmljX2V0eXBlPT0wKSkKICAgICAgICAgIHsKICAgICAgICAgICAgLy8gYWxlcnQoJ2NsaWVudCBtdXN0IGJlIHNlbGVjdGVkJyk7CiAgICAgICAgICAgICRzY29wZS5hamF4X2Vycm9yPSLXkNeg15Ag15TXldeh16Mg157Xqdeq16rXoyDXnNee16TXktepIjsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgaWYgKCRzY29wZS5zZWxlY3RFdmVudFR5cGVTZWxlY3RlZC5ldmVudF90eXBlX2lkPT0wKQogICAgICAgICAgewogICAgICAgICAgICAvLyBhbGVydCgnY2xpZW50IG11c3QgYmUgc2VsZWN0ZWQnKTsKICAgICAgICAgICAgJHNjb3BlLmFqYXhfZXJyb3I9IteQ16DXkCDXkdeX16gg16HXldeSINee16TXktepICI7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIGNyZWF0ZUV2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUubmV3RXZlbnREZXRhaWxzLGNyZWF0ZUV2ZW50X3N1Y2Nlc3MpOwogICAgICAgICAgZnVuY3Rpb24gY3JlYXRlRXZlbnRfc3VjY2VzcygpCiAgICAgICAgICB7CiAgICAgICAgICAgIGNhbGVuZGFyID0gImNhbGVuZGFyX2J1c2luZXNzIjsKICAgICAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwogICAgICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5kaXNtaXNzKCdhZGRlZCcpOwogICAgICAgICAgfQogICAgICAgICAgLy8gb24gZmFpbHVyZSB3YXMKICAgICAgICAgIC8vICRzY29wZS5hamF4X2Vycm9yID0gZGF0YS5NZXNzYWdlOwogICAgICAgIH0KICAgIH0KfSk7Ci8vLy8gZmZmZmZmZgprdXplQXBwLmNvbnRyb2xsZXIoJ0J1c2luZXNzQ2FsZW5kYXJDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgc2hhcmVkUHJvcGVydGllcywgJGNvbXBpbGUsICRsb2NhdGlvbiwgdWlDYWxlbmRhckNvbmZpZywgJHVpYk1vZGFsLCBzaGFyZWREYXRhKSB7CiAgICBpbml0aWFsRW5kVXNlciA9IHNoYXJlZERhdGEuZ2V0U2VsZWN0ZWRFbmRVc2VyKCk7CiAgICBsb2dEZWJ1ZygnQnVzaW5lc3NDYWxlbmRhciBDb250cm9sbGVyLCBzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCk9JyArIHNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKSk7CgogICAgZ2V0QnVzaW5lc3NMb2NhdGlvbnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19sb2NhdGlvbnMnKTsKCiAgICAkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcj1mYWxzZTsKCiAgICBpZiAoc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpIT1udWxsKQogICAgewogICAgICBjb25zb2xlLmxvZygiZ290IHByZXZpb3VzIHNlbGVjdGVkIHVzZXIgIitzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfZmlyc3RfbmFtZSk7CiAgICAgICRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VybmFtZT1zaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfZmlyc3RfbmFtZSsiICIrc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2VyX2xhc3RfbmFtZTsKICAgICAgJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJfaWQ9c2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2luZXNzX3VzZXJfaWQ7CiAgICAgIGxvZ0RlYnVnKCIkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcl9pZD0iKyRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyX2lkKTsKCiAgICAgICRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyPXRydWU7CiAgICB9CgogICAgLy8gY2hlY2tpbmcgaWYgY2FsZW5kYXIgc2hvdWxkIHN0YXJ0IHdpdGggYSBzcGVjaWZpYyBkYXRlIChmcm9tIHVybCBvciBmcm9tIHByZXZpb3VzbHkgc2VsZWN0ZWQgZGF0ZSkKICAgIGxvZ0RlYnVnKCIkbG9jYXRpb24uc2VhcmNoKCkuc3RhcnQ9IiArICRsb2NhdGlvbi5zZWFyY2goKS5zdGFydCk7CiAgICBpZiAodHlwZW9mICRsb2NhdGlvbi5zZWFyY2goKS5zdGFydCAhPSAndW5kZWZpbmVkJykKICAgIHsKICAgICAgY3VyckRlZmF1bHREYXRlID0gJGxvY2F0aW9uLnNlYXJjaCgpLnN0YXJ0OwogICAgfQogICAgZWxzZSBpZiAoc2hhcmVkUHJvcGVydGllcy5nZXRfY2FsZW5kYXJfZGF0ZSgpIT1udWxsKQogICAgewogICAgICBjb25zb2xlLmxvZygiZ290IHByZXZpb3VzIGRhdGUgICIrc2hhcmVkUHJvcGVydGllcy5nZXRfY2FsZW5kYXJfZGF0ZSgpKTsKICAgICAgY3VyckRlZmF1bHREYXRlID0gc2hhcmVkUHJvcGVydGllcy5nZXRfY2FsZW5kYXJfZGF0ZSgpOwogICAgfQogICAgZWxzZQogICAgewogICAgICBjdXJyRGVmYXVsdERhdGUgPSBuZXcgRGF0ZSgpOwogICAgfQogICAgZ2V0QWxsSW5zdHJ1Y3RvcnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19pbnN0cnVjdG9ycycsZ2V0QWxsSW5zdHJ1Y3RvcnNfZmluaXNoKTsKICAgIGZ1bmN0aW9uIGdldEFsbEluc3RydWN0b3JzX2ZpbmlzaCgpCiAgICB7CiAgICAgIC8vIGNvbnNvbGUubG9nKCRzY29wZS5idXNpbmVzc19pbnN0cnVjdG9ycyk7CiAgICAgICRzY29wZS5idXNpbmVzc19pbnN0cnVjdG9ycy51bnNoaWZ0KHsiYnVzZXJfZnVsbF9uYW1lIjoi15vXnCDXlNem15XXldeqIiwgImJ1c2VyX2ZpcnN0X25hbWUiOiLXm9eV15zXnSIsImJ1c2VyX2xhc3RfbmFtZSI6IiIsICJ1c2VyX2lkIjogMCwgImJ1c2luZXNzX3VzZXJfaWQiOiAwfSk7CgogICAgICAvLyBzZXR0aW5nIHNlbGVjdGVkIGdldF9zZWxlY3RlZF9pbnN0cnVjdG9yCiAgICAgICRzY29wZS5wcmV2aW91c19zZWxlY3RlZF9pbnN0cnVjdG9yPWZhbHNlOwogICAgICBpZiAoc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfaW5zdHJ1Y3RvcigpPj0wKQogICAgICB7CiAgICAgICAgLy8gY29uc29sZS5sb2coImdvdCBwcmV2aW91cyBzZWxlY3RlZCBpbnN0cnVjdG9yICIrc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfaW5zdHJ1Y3RvcigpKTsKICAgICAgICAkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfaW5zdHJ1Y3Rvcl9pZD1zaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF9pbnN0cnVjdG9yKCk7CiAgICAgICAgJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX2luc3RydWN0b3I9dHJ1ZTsKICAgICAgICAkc2NvcGUuc2VsZWN0ZWRfYnVzaW5lc3NfdXNlcl9pZD1zaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF9pbnN0cnVjdG9yKCk7CiAgICAgIH0KICAgIH0KICAgIGdldEFsbEJ1c2luZXNzRXZlbnRUeXBlc05vU3lzdGVtKCRodHRwLCRzY29wZSwnZXZlbnRfdHlwZXMnKTsKCiAgICAvLyBzZXR0aW5nIHNlbGVjdGVkIHVzZXIgaWQKICAgICRzY29wZS5wcmV2aW91c19ldmVudF9yZXNjaGVkdWxlPWZhbHNlOwogICAgJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGVfZXZlbnQ9bnVsbDsKCiAgICAkc2NvcGUuJG9uKCJjYWxlbmRhckV2ZW50UmVzY2hlZHVsZURlc2VsZWN0IixmdW5jdGlvbihlLGEpCiAgICB7CiAgICAgICRzY29wZS5jYWxlbmRhckV2ZW50UmVzY2hlZHVsZURlc2VsZWN0KCk7CiAgICB9KTsKCiAgICAvLyBkZXNlbGVjdGluZyBldmVudCBmcm9tIGJlaW5nIHJlc2NoZWR1bGVkCiAgICAkc2NvcGUuY2FsZW5kYXJFdmVudFJlc2NoZWR1bGVEZXNlbGVjdD1mdW5jdGlvbigpCiAgICB7CiAgICAgIHNoYXJlZFByb3BlcnRpZXMuc2V0X2V2ZW50X3Jlc2NoZWR1bGUobnVsbCk7CiAgICAgICRzY29wZS5wcmV2aW91c19ldmVudF9yZXNjaGVkdWxlPWZhbHNlOwogICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwogICAgfQogICAgLy8gZGVsZXRpbmcgY2xpZW50IHNlbGVjdGlvbiBpbiBjYWxlbmRhcgogICAgJHNjb3BlLmNhbGVuZGFyQ2xpZW50RGVzZWxlY3Q9ZnVuY3Rpb24oKSAvLyByZWxvYWQgY2xhc3MvZXZlbnQgc3VnZ2VzdGlvbnMKICAgIHsKICAgICAgJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXI9ZmFsc2U7CiAgICAgIHNoYXJlZFByb3BlcnRpZXMuc2V0X3NlbGVjdGVkX3VzZXIobnVsbCk7CiAgICAgICRzY29wZS5ldmVudFR5cGVTZWxlY3RlZCgpOwogICAgfQogICAgaWYgKGluaXRpYWxFbmRVc2VyICE9IG51bGwpIHsKICAgICAgICAkc2NvcGUuYnVzaW5lc3NDYWxlbmRhckluaXRpYWxOYW1lID0gdHJ1ZTsKICAgICAgICBzaGFyZWREYXRhLnNldFNlbGVjdGVkRW5kVXNlcihudWxsKTsKICAgICAgICAkc2NvcGUuYnVzaW5lc3NDYWxlbmRhckluaXRpYWxzID0gewogICAgICAgICAgICBuYW1lOiBpbml0aWFsRW5kVXNlci5maXJzdF9uYW1lICsgIiAiICsgaW5pdGlhbEVuZFVzZXIubGFzdF9uYW1lCiAgICAgICAgfTsKICAgIH0gZWxzZSB7CiAgICAgICAgJHNjb3BlLmJ1c2luZXNzQ2FsZW5kYXJJbml0aWFsTmFtZSA9IGZhbHNlOwogICAgfQogICAgLyogY29uZmlnIG9iamVjdCAqLwogICAgJHNjb3BlLmNhbGVuZGFyX25hbWUgPSAiY2FsZW5kYXJfYnVzaW5lc3MiOwogICAgJHNjb3BlLmNhbGVuZGFyID0gImNhbGVuZGFyX2J1c2luZXNzIjsKICAgIC8qIGV2ZW50IHNvdXJjZXMgYXJyYXkqLwogICAgJHNjb3BlLmJ1c2luZXNzQ2FsZW5kYXJFdmVudFNvdXJjZXMgPSBbewogICAgICAgIHVybDogJy9hcGkvYWRtaW4vZXZlbnRzL2dldHBvc3QnLAogICAgICAgIHR5cGU6ICdQT1NUJwogICAgfSwgewogICAgICAgIHVybDogJy9hcGkvYWRtaW4vY2FsZW5kYXIvbGltaXRhdGlvbnMvYmFja2dyb3VuZC9nZXRwb3N0JywKICAgICAgICB0eXBlOiAnUE9TVCcKICAgIC8vIH0sIHsKICAgIC8vICAgICB1cmw6ICcvYXBpL2FkbWluL3JlY3VycmluZy9nZXRwb3N0JywKICAgIC8vICAgICB0eXBlOiAnUE9TVCcKICAgIH1dOwoKICAgICRzY29wZS5nb3RvVG9kYXkgPSBmdW5jdGlvbigpIHsKICAgICAgICAkc2NvcGUuZ290b0RhdGUobmV3IERhdGUoKSk7CiAgICAgICAgdmlzaWJsZURhdGVTdGFydCA9IG5ldyBEYXRlKHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3Jykuc3RhcnQpOwogICAgICAgIGRhdGVUb0dvVG8gPSB2aXNpYmxlRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCkgKyAiLSIgKyAoJzAnICsgKHZpc2libGVEYXRlU3RhcnQuZ2V0TW9udGgoKSArIDEpKS5zbGljZSgtMikgKyAiLSIgKyAoJzAnICsgdmlzaWJsZURhdGVTdGFydC5nZXREYXRlKCkpLnNsaWNlKC0yKTsKICAgICAgICBzaGFyZWRQcm9wZXJ0aWVzLnNldF9jYWxlbmRhcl9kYXRlKGRhdGVUb0dvVG8pOwogICAgICAgICRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0PXZpc2libGVEYXRlU3RhcnQ7CiAgICAgICAgJGxvY2F0aW9uLnNlYXJjaCgnc3RhcnQnLGRhdGVUb0dvVG8pOwogICAgfQoKICAgICRzY29wZS5pbnN0cnVjdG9yU2VsZWN0ZWQ9ZnVuY3Rpb24odGhpc3RoaXMpCiAgICB7CiAgICAgIHVwZGF0ZVN1Z2dlc3Rpb25zKCk7CiAgICB9CiAgICAkc2NvcGUuZXZlbnRUeXBlU2VsZWN0ZWQ9ZnVuY3Rpb24odGhpc3RoaXMpCiAgICB7CiAgICAgIHVwZGF0ZVN1Z2dlc3Rpb25zKCk7CiAgICB9CiAgICBmdW5jdGlvbiB1cGRhdGVTdWdnZXN0aW9ucygpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJmdW5jdGlvbjogdXBkYXRlU3VnZ2VzdGlvbnMiKTsKICAgICAgc2hhcmVkUHJvcGVydGllcy5zZXRfZXZlbnRfdHlwZV9mb3Jfc3VnZ2VzdGlvbnMoJHNjb3BlLnNlbGVjdGVkX2V2ZW50X3R5cGVfaWQpOwogICAgICBzaGFyZWRQcm9wZXJ0aWVzLnNldF9zZWxlY3RlZF9pbnN0cnVjdG9yKCRzY29wZS5zZWxlY3RlZF9idXNpbmVzc191c2VyX2lkKTsKICAgICAgZm9yIChpPTA7aTwkc2NvcGUuZXZlbnRfdHlwZXMubGVuZ3RoO2krKykKICAgICAgewogICAgICAgIC8vIGNvbnNvbGUubG9nKCRzY29wZS5ldmVudF90eXBlc1tpXS5ldmVudF90eXBlX2lkKTsKICAgICAgICBpZiAoJHNjb3BlLnNlbGVjdGVkX2V2ZW50X3R5cGVfaWQ9PSRzY29wZS5ldmVudF90eXBlc1tpXS5ldmVudF90eXBlX2lkKQogICAgICAgIHsKICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJmb3VuZCBldmVudCB0eXBlIGlkIik7CiAgICAgICAgICBpZiAoJHNjb3BlLmV2ZW50X3R5cGVzW2ldLmlzX2NsYXNzKSAvLyBpcyBjbGFzcwogICAgICAgICAgewogICAgICAgICAgICBsb2dEZWJ1ZygiJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXI9Iiskc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcik7CiAgICAgICAgICAgIGlmICgkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcikKICAgICAgICAgICAgewogICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJpcyBjbGFzcyBzdWdnZXN0aW9uZCIpOwogICAgICAgICAgICAgICRodHRwLmdldCgkZ0FwaVVSTFByZWZpeCArICIvZW5kdXNlci9ldmVudHMvc3VnZ2VzdGNsYXNzLyIrJHNjb3BlLnNlbGVjdGVkX2V2ZW50X3R5cGVfaWQrIi8iKyRzY29wZS5zZWxlY3RlZF9idXNpbmVzc191c2VyX2lkKyIvIiskc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpKyIvIisoJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0TW9udGgoKSsxKSsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0RGF0ZSgpKyIvIiskc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXRIb3VycygpICsgIi8iICsgJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0TWludXRlcygpICsgIi8iICsgJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJfaWQpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRfZXZlbnRfdHlwZV9pZF9pc19jbGFzcz10cnVlOwogICAgICAgICAgICAgICAgICAkc2NvcGUuZXZlbnRzU3VnZ2VzdGVkID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBjb25zb2xlLmxvZygibm90IGlzIGNsYXNzIHN1Z2dlc3Rpb25kIik7CiAgICAgICAgICAgICAgJGh0dHAuZ2V0KCRnQXBpVVJMUHJlZml4ICsgIi9lbmR1c2VyL2V2ZW50cy9zdWdnZXN0Y2xhc3MvIiskc2NvcGUuc2VsZWN0ZWRfZXZlbnRfdHlwZV9pZCsiLyIrJHNjb3BlLnNlbGVjdGVkX2J1c2luZXNzX3VzZXJfaWQrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCkrIi8iKygkc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpKzEpKyIvIiskc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXREYXRlKCkrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldEhvdXJzKCkgKyAiLyIgKyAkc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXRNaW51dGVzKCkgKyAiLzAiKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKQogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkX2V2ZW50X3R5cGVfaWRfaXNfY2xhc3M9dHJ1ZTsKICAgICAgICAgICAgICAgICAgJHNjb3BlLmV2ZW50c1N1Z2dlc3RlZCA9IHJlc3BvbnNlLmRhdGE7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGVsc2UgLy8gaXMgbm90IGNsYXNzCiAgICAgICAgICB7CiAgICAgICAgICAgICRodHRwLmdldCgkZ0FwaVVSTFByZWZpeCArICIvZW5kdXNlci9ldmVudHMvc3VnZ2VzdC8iKyRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkKyIvIiskc2NvcGUuc2VsZWN0ZWRfYnVzaW5lc3NfdXNlcl9pZCsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSsiLyIrKCRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkrMSkrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0SG91cnMoKSArICIvIiArICRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkX2V2ZW50X3R5cGVfaWRfaXNfY2xhc3M9ZmFsc2U7CiAgICAgICAgICAgICAgICAkc2NvcGUuZXZlbnRzU3VnZ2VzdGVkID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgJHNjb3BlLmdvdG9OZXh0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlbW92ZUV2ZW50cycpOwogICAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCduZXh0Jyk7CiAgICAgICAgJHNjb3BlLnVwZGF0ZUNhbGVuZGFyQ2VudGVyVGl0bGUoKTsKICAgICAgICAvLyBhZGRpbmcgdGhlIGZvbGxvd2luZyB0byBtYWtlIHRoZSB1cmwKICAgICAgICAvLyBwb2ludCB0byB0aGUgcmlnaHQgd2VlaywgaWYgZ29pbmcgdG8gYSBkaWZmZXJlbnQgVVJMIGFuZCB0aGVuIGdvaW5nIGJhY2sKICAgICAgICB2aXNpYmxlRGF0ZVN0YXJ0ID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5zdGFydCk7CiAgICAgICAgZGF0ZVRvR29UbyA9IHZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSArICItIiArICgnMCcgKyAodmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpICsgMSkpLnNsaWNlKC0yKSArICItIiArICgnMCcgKyB2aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSkuc2xpY2UoLTIpOwogICAgICAgIHNoYXJlZFByb3BlcnRpZXMuc2V0X2NhbGVuZGFyX2RhdGUoZGF0ZVRvR29Ubyk7CiAgICAgICAgJHNjb3BlLnZpc2libGVEYXRlU3RhcnQ9dmlzaWJsZURhdGVTdGFydDsKICAgICAgICAkbG9jYXRpb24uc2VhcmNoKCdzdGFydCcsZGF0ZVRvR29Ubyk7CiAgICB9CiAgICAkc2NvcGUuZ290b1ByZXYgPSBmdW5jdGlvbigpIHsKICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVtb3ZlRXZlbnRzJyk7CiAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3ByZXYnKTsKICAgICAgICAkc2NvcGUudXBkYXRlQ2FsZW5kYXJDZW50ZXJUaXRsZSgpOwogICAgICAgIC8vIGFkZGluZyB0aGUgZm9sbG93aW5nIHRvIG1ha2UgdGhlIHVybAogICAgICAgIC8vIHBvaW50IHRvIHRoZSByaWdodCB3ZWVrLCBpZiBnb2luZyB0byBhIGRpZmZlcmVudCBVUkwgYW5kIHRoZW4gZ29pbmcgYmFjawogICAgICAgIHZpc2libGVEYXRlU3RhcnQgPSBuZXcgRGF0ZSh1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ2V0VmlldycpLnN0YXJ0KTsKICAgICAgICBkYXRlVG9Hb1RvID0gdmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpICsgIi0iICsgKCcwJyArICh2aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkgKyAxKSkuc2xpY2UoLTIpICsgIi0iICsgKCcwJyArIHZpc2libGVEYXRlU3RhcnQuZ2V0RGF0ZSgpKS5zbGljZSgtMik7CiAgICAgICAgc2hhcmVkUHJvcGVydGllcy5zZXRfY2FsZW5kYXJfZGF0ZShkYXRlVG9Hb1RvKTsKICAgICAgICAkc2NvcGUudmlzaWJsZURhdGVTdGFydD12aXNpYmxlRGF0ZVN0YXJ0OwogICAgICAgICRsb2NhdGlvbi5zZWFyY2goJ3N0YXJ0JyxkYXRlVG9Hb1RvKTsKCiAgICB9CiAgICAkc2NvcGUuZ290b0RhdGUgPSBmdW5jdGlvbihuZXdkYXRlKSB7CiAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dvdG9EYXRlJywgbmV3ZGF0ZSk7CiAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlbW92ZUV2ZW50cycpOwogICAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZWZldGNoRXZlbnRzJyk7CiAgICAgICAgJHNjb3BlLnVwZGF0ZUNhbGVuZGFyQ2VudGVyVGl0bGUoKTsKICAgIH0KCiAgICAkc2NvcGUuZWRpdEhvdXJzT2ZXb3JrID0gZnVuY3Rpb24oKSB7CiAgICAgICAgLy8gcGFyYW0gc2hvdWxkIGxvb2sgbGlrZSAiMjAxNi0wNy0wMSIKICAgICAgICB2aXNpYmxlRGF0ZVN0YXJ0ID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5zdGFydCk7CiAgICAgICAgZGF0ZVRvR29UbyA9IHZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSArICItIiArICgnMCcgKyAodmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpICsgMSkpLnNsaWNlKC0yKSArICItIiArICgnMCcgKyB2aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSkuc2xpY2UoLTIpOwogICAgICAgICRsb2NhdGlvbi5wYXRoKCcvaG91cnNfb2Zfd29yaycpLnNlYXJjaCh7CiAgICAgICAgICAgIHN0YXJ0OiBkYXRlVG9Hb1RvCiAgICAgICAgfSk7CiAgICB9OwoKICAgICRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKTsKCiAgICAgICAgdmlzaWJsZURhdGVTdGFydCA9IG5ldyBEYXRlKHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3Jykuc3RhcnQpOwogICAgICAgIHZpc2libGVEYXRlRW5kID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5lbmQpOwoKICAgICAgICAkc2NvcGUuY2FsZW5kYXJUaXRsZUNlbnRlciA9IHZpc2libGVEYXRlU3RhcnQuZ2V0RGF0ZSgpICsgIiAiICsgbW9udGhOYW1lc1t2aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCldICsKICAgICAgICAgICAgIiDigJQgIiArIHZpc2libGVEYXRlRW5kLmdldERhdGUoKSArICIgIiArIG1vbnRoTmFtZXNbdmlzaWJsZURhdGVFbmQuZ2V0TW9udGgoKV0gKwogICAgICAgICAgICAiICIgKyB2aXNpYmxlRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCk7CiAgICB9OwoKICAgICRzY29wZS5zaG93RXZlbnRQb3B1cCA9IGZ1bmN0aW9uKHNlbGVjdGVkRXZlbnQpIHsKICAgICAgICBzaG93RXZlbnRQb3B1cChzZWxlY3RlZEV2ZW50LCAkdWliTW9kYWwpCiAgICB9OwoKICAgICRzY29wZS5ldmVudENyZWF0ZU1vZGFsRnJvbVNjaGVkdWxlciA9IGZ1bmN0aW9uKGVzdWdnZXN0KQogICAgewogICAgICAvLyBpZiBjbGFzcyAtIGdvIHRvIGV2ZW50IGNsYXNzCiAgICAgIGNvbnNvbGUubG9nKGVzdWdnZXN0KTsKICAgICAgZm9yIChpPTA7aTwkc2NvcGUuZXZlbnRfdHlwZXMubGVuZ3RoO2krKykKICAgICAgewogICAgICAgIGlmIChlc3VnZ2VzdC5ldmVudF90eXBlX2lkPT0kc2NvcGUuZXZlbnRfdHlwZXNbaV0uZXZlbnRfdHlwZV9pZCkKICAgICAgICB7CiAgICAgICAgICBpZiAoJHNjb3BlLmV2ZW50X3R5cGVzW2ldLmlzX2NsYXNzKQogICAgICAgICAgewogICAgICAgICAgICBjb25zb2xlLmxvZygiaXMgY2xhc3MiKTsKICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWY9Jy8jL2V2ZW50X2NsYXNzLycgKyBlc3VnZ2VzdC5ldmVudF9pZDsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBsb2dEZWJ1ZyhKU09OLnN0cmluZ2lmeShlc3VnZ2VzdCkpOwogICAgICBsb2dEZWJ1Zyhlc3VnZ2VzdC5zdGFydF9lcG9jaCk7CiAgICAgIHN0YXJ0RGF0ZT1lc3VnZ2VzdC5zdGFydF9lcG9jaCoxMDAwOwoKICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgICAgICAgICBhbmltYXRpb246IGZhbHNlLAogICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfZXZlbnRfY3JlYXRlLnBocCcsCiAgICAgICAgICBjb250cm9sbGVyOiAnZXZlbnRDcmVhdGVNb2RhbENvbnRyb2xsZXInLAogICAgICAgICAgc2l6ZTogJ2wnLAogICAgICAgICAgcmVzb2x2ZTogewogICAgICAgICAgICAgIHN0YXJ0RGF0ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBzdGFydERhdGU7CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBldmVudF90eXBlX2lkOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuICRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkOwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgbG9jYXRpb25faWQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gZXN1Z2dlc3QubG9jYXRpb25faWQ7CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBlbXBfaWQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gZXN1Z2dlc3QuZW1wX2lkOwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgcmVzY2hlZHVsZV9ldmVudDogZnVuY3Rpb24oKQogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGlmICgkc2NvcGUucHJldmlvdXNfZXZlbnRfcmVzY2hlZHVsZSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuICRzY29wZS5wcmV2aW91c19ldmVudF9yZXNjaGVkdWxlX2V2ZW50OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CgogICAgICAgICAgfQogICAgICB9KTsKCiAgICB9CiAgICAkc2NvcGUuZXZlbnRDcmVhdGVNb2RhbCA9IGZ1bmN0aW9uKHN0YXJ0RGF0ZSwgc2l6ZSkgewogICAgICAgIGxvZ0RlYnVnKCJldmVudCBjcmVhdGUgbW9kYWwgc3RhcnREYXRlPSIrc3RhcnREYXRlKTsKCiAgICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgICAgICAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2V2ZW50X2NyZWF0ZS5waHAnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnZXZlbnRDcmVhdGVNb2RhbENvbnRyb2xsZXInLAogICAgICAgICAgICBzaXplOiBzaXplLAogICAgICAgICAgICByZXNvbHZlOiB7CiAgICAgICAgICAgICAgICBzdGFydERhdGU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBzdGFydERhdGU7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZXZlbnRfdHlwZV9pZDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbG9jYXRpb25faWQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGVtcF9pZDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcmVzY2hlZHVsZV9ldmVudDogZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGUpCiAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGVfZXZlbnQ7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICAgIH0gICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBtb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHNlbGVjdGVkSXRlbSkgewogICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWQgPSBzZWxlY3RlZEl0ZW07CiAgICAgICAgfSwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGxvZ0RlYnVnKCdNb2RhbCBkaXNtaXNzZWQgYXQ6ICcgKyBuZXcgRGF0ZSgpKTsKICAgICAgICB9KTsKICAgIH07CgogICAgLy8vCiAgICAkc2NvcGUudXBkYXRlRXZlbnREYXRhYmFzZSA9IGZ1bmN0aW9uKHN0YXJ0X3BhcmFtLCBlbmRfcGFyYW0sIGV2ZW50X2lkLCB0aGVldmVudCkKICAgIHsKCiAgICAgICAgbG9nRGVidWcoInVwZGF0ZUV2ZW50RGF0YWJhc2Ugc3RhcnQ9IiArIHN0YXJ0X3BhcmFtICsgIiwgZW5kPSIgKyBlbmRfcGFyYW0gKyAiLCBldmVudF9pZD0iICsgZXZlbnRfaWQpOwogICAgICAgIHRoZXVybCA9ICcvYXBpL2FkbWluL2V2ZW50cy9zZXQvJyArIGV2ZW50X2lkOwoKICAgICAgICAkaHR0cCh7CiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLAogICAgICAgICAgICB1cmw6IHRoZXVybCwKICAgICAgICAgICAgZGF0YTogewogICAgICAgICAgICAgICAgc3RhcnRfZGF0ZTogc3RhcnRfcGFyYW0sCiAgICAgICAgICAgICAgICBlbmRfZGF0ZTogZW5kX3BhcmFtLAogICAgICAgICAgICAgICAgZXZlbnRfaWQ6IGV2ZW50X2lkCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbjtjaGFyc2V0PXV0Zi04JwogICAgICAgICAgICB9CiAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7CgogICAgICAgICAgICBsb2dEZWJ1ZyhkYXRhKTsKICAgICAgICAgICAgaWYgKGRhdGEuRXJyb3IpIHsKICAgICAgICAgICAgICAgIGxvZ0RlYnVnKCJlcnJvciAiICsgZGF0YS5NZXNzYWdlKTsKICAgICAgICAgICAgICAgIGFsZXJ0KCdlcnJvcicpOwogICAgICAgICAgICAgICAgY2FsZW5kYXIgPSAiY2FsZW5kYXJfYnVzaW5lc3MiOwogICAgICAgICAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbG9nRGVidWcoInN1Y2Nlc3MiKTsKICAgICAgICAgICAgICAgIGNhbGVuZGFyID0gImNhbGVuZGFyX2J1c2luZXNzIjsKICAgICAgICAgICAgICAgIC8vIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKICAgICAgICAgICAgICAgIC8vICR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoJ2FkZGVkIGFuZCByZWZldGNoRXZlbnRzJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICB9OwogICAgLy8vCgogICAgJHNjb3BlLmNsYXNzRXZlbnRBZGRVc2VyID0gZnVuY3Rpb24oZXN1Z2dlc3QpCiAgICB7CiAgICAgIGNvbnNvbGUubG9nKCJjbGFzc0V2ZW50QWRkVXNlciBvciBSZW1vdmUiKTsKICAgICAgaWYgKChlc3VnZ2VzdC5pc19yZWdpc3RlcmVkPT0xKSB8ICgoZXN1Z2dlc3QuaXNfd2FpdGluZ2xpc3Q9PTEpICYmIChlc3VnZ2VzdC5pc19jYW5jZWxlZD09MCkpKQogICAgICB7CiAgICAgICAgY29uc29sZS5sb2coIm5lZWQgdG8gdW5yZWdpc3RlciIpOwogICAgICAgIHJlbW92ZUVuZFVzZXJGcm9tRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyX2lkLGVzdWdnZXN0LmV2ZW50X2lkLHJlbW92ZUVuZFVzZXJGcm9tRXZlbnRfY2FsbGJhY2ssIHJlbW92ZUVuZFVzZXJGcm9tRXZlbnRfY2FsbGJhY2spOwogICAgICAgIGZ1bmN0aW9uIHJlbW92ZUVuZFVzZXJGcm9tRXZlbnRfY2FsbGJhY2soKQogICAgICAgIHsKICAgICAgICAgICRzY29wZS5ldmVudFR5cGVTZWxlY3RlZCgpOwogICAgICAgICAgY2FsZW5kYXIgPSAiY2FsZW5kYXJfYnVzaW5lc3MiOwogICAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwoKICAgICAgICB9CiAgICAgIH0KICAgICAgZWxzZQogICAgICB7CiAgICAgICAgLy8gY29uc29sZS5sb2coZXN1Z2dlc3QuZXZlbnRfaWQpOwogICAgICAgIC8vIGNvbnNvbGUubG9nKCRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyX2lkKTsKICAgICAgICAvLyBpZiBzZWxlY3RlZCB1c2VyIC0gYWRkaW5nIGhpbS9oZXIgdG8gY2xhc3MKICAgICAgICBpZiAoJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXIpCiAgICAgICAgewogICAgICAgICAgYWRkRW5kVXNlclRvRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyX2lkLGVzdWdnZXN0LmV2ZW50X2lkLGFkZEVuZFVzZXJUb0V2ZW50X2NhbGxiYWNrLCBhZGRFbmRVc2VyVG9FdmVudF9jYWxsYmFjayk7CiAgICAgICAgICBmdW5jdGlvbiBhZGRFbmRVc2VyVG9FdmVudF9jYWxsYmFjaygpCiAgICAgICAgICB7CiAgICAgICAgICAgIGNhbGVuZGFyID0gImNhbGVuZGFyX2J1c2luZXNzIjsKICAgICAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwogICAgICAgICAgICAkc2NvcGUuZXZlbnRUeXBlU2VsZWN0ZWQoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZSAvLyBlbHNlIC0gZ29pbmcgdG8gY2xhc3MgcGFnZQogICAgICAgIHsKICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmPScvIy9ldmVudF9jbGFzcy8nICsgZXN1Z2dlc3QuZXZlbnRfaWQ7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAkc2NvcGUuY2FsZW5kYXJfYnVzaW5lc3NfY29uZmlnID0gewogICAgICAgIGNhbGVuZGFyOiB7CiAgICAgICAgICAgIGhlaWdodDogJ2F1dG8nLAogICAgICAgICAgICBlZGl0YWJsZTogdHJ1ZSwKICAgICAgICAgICAgLy8gaGVhZGVyOiB7CiAgICAgICAgICAgIC8vICAgICBsZWZ0OiAnJywKICAgICAgICAgICAgLy8gICAgIGNlbnRlcjogJycsCiAgICAgICAgICAgIC8vICAgICByaWdodDogJycKICAgICAgICAgICAgLy8gfSwKICAgICAgICAgICAgLy8gaGVhZGVyOiB7CiAgICAgICAgICAgIC8vICAgICBsZWZ0OiAndGl0bGUnLAogICAgICAgICAgICAvLyAgICAgY2VudGVyOiAnJywKICAgICAgICAgICAgLy8gICAgIHJpZ2h0OiAndG9kYXkgcHJldixuZXh0JwogICAgICAgICAgICAvLyB9LAogICAgICAgICAgICB0aXRsZUZvcm1hdDogewogICAgICAgICAgICAgICAgLy8gd2VlazogICJkIFtNTU1deyAnJiM4MjExOycgZCBNTU19IgogICAgICAgICAgICB9LAogICAgICAgICAgICAvLyB0aXRsZUZvcm1hdDogewogICAgICAgICAgICAvLyAgICAgbW9udGg6ICdNTU1NIHl5eXknLAogICAgICAgICAgICAvLyAgICAgd2VlazogIk1NTSBkWyB5eXl5XXsgJyYjODIxMjsnWyBNTU1dIGQgeXl5eX0iLAogICAgICAgICAgICAvLyAgICAgZGF5OiAnTU0vZGQnCiAgICAgICAgICAgIC8vIH0sCiAgICAgICAgICAgIGhlYWRlcjogJycsCiAgICAgICAgICAgIC8vIGRlZmF1bHRWaWV3OiAnYWdlbmRhV2VlaycsCiAgICAgICAgICAgIC8vIHZpZXdzOiB7CiAgICAgICAgICAgIC8vICAgICBkb250U2hvd0RhdGU6IHsKICAgICAgICAgICAgLy8gICAgICAgICB0eXBlOiAnYWdlbmRhV2VlaycsCiAgICAgICAgICAgIC8vICAgICAgICAgZHVyYXRpb246IHsKICAgICAgICAgICAgLy8gICAgICAgICAgICAgZGF5czogNwogICAgICAgICAgICAvLyAgICAgICAgIH0sCiAgICAgICAgICAgIC8vICAgICAgICAgdGl0bGU6ICdBcGVydHVyYScsCiAgICAgICAgICAgIC8vICAgICAgICAgY29sdW1uRm9ybWF0OiAnZGRkZCcgLy8gRm9ybWF0IHRoZSBkYXkgdG8gb25seSBzaG93IGxpa2UgJ01vbmRheScKICAgICAgICAgICAgLy8gICAgICAgICAgICAgLy8gaGlkZGVuRGF5czogWzAsIDZdIC8vIEhpZGUgU3VuZGF5IGFuZCBTYXR1cmRheT8KICAgICAgICAgICAgLy8gICAgIH0KICAgICAgICAgICAgLy8gfSwKICAgICAgICAgICAgLy8gc2xvdER1cmF0aW9uOiAnMDA6MTU6MDAnLAogICAgICAgICAgICBldmVudERyb3A6IGZ1bmN0aW9uKGV2ZW50LCBkYXlEZWx0YSwgbWludXRlRGVsdGEsIGFsbERheSwgcmV2ZXJ0RnVuYywgdWlDYWxlbmRhckNvbmZpZykgewogICAgICAgICAgICAgICAgbG9nRGVidWcoImV2ZW50IGRyb3AiICsgZXZlbnQudGl0bGUgKyAiKCIgKyBldmVudC5pZCArICIpIG1vdmVkICIgKyBtaW51dGVEZWx0YSArICIgbWludXRlcyIpOwogICAgICAgICAgICAgICAgbG9nRGVidWcoIm9sZCBzdGFydD0iICsgZXZlbnQuc3RhcnQgKyAiLCBvbGQgZW5kPSIgKyBldmVudC5lbmQpOwogICAgICAgICAgICAgICAgJHNjb3BlLnVwZGF0ZUV2ZW50RGF0YWJhc2UoZXZlbnQuc3RhcnQsIGV2ZW50LmVuZCwgZXZlbnQuaWQsIGV2ZW50KTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZXZlbnRSZXNpemU6IGZ1bmN0aW9uKGV2ZW50LCBkZWx0YSwgcmV2ZXJ0RnVuYykgewogICAgICAgICAgICAgIGxvZ0RlYnVnKCJldmVudCByZXNpemUiICsgZXZlbnQudGl0bGUgKyAiKCIgKyBldmVudC5pZCArICIpIG1vdmVkICIpOwogICAgICAgICAgICAgIGxvZ0RlYnVnKCJvbGQgc3RhcnQ9IiArIGV2ZW50LnN0YXJ0ICsgIiwgb2xkIGVuZD0iICsgZXZlbnQuZW5kKTsKICAgICAgICAgICAgICAkc2NvcGUudXBkYXRlRXZlbnREYXRhYmFzZShldmVudC5zdGFydCwgZXZlbnQuZW5kLCBldmVudC5pZCwgZXZlbnQpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBkZWZhdWx0VmlldzogJ2FnZW5kYVdlZWsnLAogICAgICAgICAgICBldmVudFN0YXJ0RWRpdGFibGU6ZmFsc2UsCiAgICAgICAgICAgIGV2ZW50RHVyYXRpb25FZGl0YWJsZTpmYWxzZSwKICAgICAgICAgICAgZGVmYXVsdERhdGU6IG1vbWVudChjdXJyRGVmYXVsdERhdGUpLAoKICAgICAgICAgICAgLy8gZGVmYXVsdFZpZXc6ICdkb250U2hvd0RhdGUnLAogICAgICAgICAgICBldmVudENsaWNrOiBmdW5jdGlvbihjYWxFdmVudCwganNFdmVudCwgdmlldykgewogICAgICAgICAgICAgICAgbG9nRGVidWcoImNhbGVuZGFyIGV2ZW50IGNsaWNrZWQgIiArIGNhbEV2ZW50LnRpdGxlICsgIigiICsgY2FsRXZlbnQuaWQgKyAiKSAiICsgY2FsRXZlbnQuc3RhcnQgKyAiICIgKyBjYWxFdmVudC5lbmQpOwogICAgICAgICAgICAgICAgLy8gbG9nRGVidWcoSlNPTi5zdHJpbmdpZnkoY2FsRXZlbnQpKTsKICAgICAgICAgICAgICAgIC8vIGlmIGl0J3MgYSBnZW5lcmljIGV2ZW50ICh2YWNhdGlvbiBldGMpCiAgICAgICAgICAgICAgICAvLyBzaG93IHBvcHVwIHdpdGggb3B0aW9uIHRvIGRlbGV0ZQogICAgICAgICAgICAgICAgaWYgKGNhbEV2ZW50LmlzX2dlbmVyaWNfZXR5cGU9PTEpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIC8vICRzY29wZS5zaG93R2VuZXJpY0V2ZW50KGNhbEV2ZW50KTsKICAgICAgICAgICAgICAgICAgJHNjb3BlLnNob3dFdmVudFBvcHVwKGNhbEV2ZW50KTsKCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICRzY29wZS5zaG93RXZlbnRQb3B1cChjYWxFdmVudCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBjaGFuZ2UgdGhlIGJvcmRlciBjb2xvciBqdXN0IGZvciBmdW4KICAgICAgICAgICAgICAgIC8vICQodGhpcykuY3NzKCdib3JkZXItY29sb3InLCAncmVkJyk7CgogICAgICAgICAgICB9LAogICAgICAgICAgICBkYXlDbGljazogZnVuY3Rpb24oZGF0ZSwganNFdmVudCwgdmlldykgewogICAgICAgICAgICAgICAgLy8gbG9nRGVidWcoIm5ldyBldmVudCBjcmVhdGlvbiBjbGlja2VkICIgKyBjYWxFdmVudC50aXRsZSArICIoIiArIGNhbEV2ZW50LmlkICsgIikgIiArIGNhbEV2ZW50LnN0YXJ0ICsgIiAiICsgY2FsRXZlbnQuZW5kKTsKICAgICAgICAgICAgICAgIC8vICAgICBzdGFydCA9IGRhdGU7CiAgICAgICAgICAgICAgICAvLyAgICAgZW5kID0gbW9tZW50KHN0YXJ0KS5hZGQoNDUsICdtaW51dGVzJyk7CiAgICAgICAgICAgICAgICBpZiAodmlldy5uYW1lID09PSAibW9udGgiKSB7CiAgICAgICAgICAgICAgICAgICAgY2FsZW5kYXIgPSAiY2FsZW5kYXJfYnVzaW5lc3MiOwogICAgICAgICAgICAgICAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2NoYW5nZVZpZXcnLCAiYWdlbmRhV2VlayIpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZXZlbnRDcmVhdGVNb2RhbChkYXRlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vIGNoYW5nZSB0aGUgYm9yZGVyIGNvbG9yIGp1c3QgZm9yIGZ1bgogICAgICAgICAgICAgICAgLy8gJCh0aGlzKS5jc3MoJ2JvcmRlci1jb2xvcicsICdyZWQnKTsKCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGV2ZW50UmVuZGVyOiBmdW5jdGlvbihldmVudCwgZWxlbWVudCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaWYgKCFldmVudC5ldmVudF9pZD4wKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAvLyBub3QgYSByZWFsIGV2ZW50IC0gcHJvYmFibHkgYmxvY2sgLyBiYWNrZ3JvdW5kCiAgICAgICAgICAgICAgICAgIC8vIGlnbm9yaW5nIGl0CiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vIGNoYW5naW5nIGxvb2sgYW5kIGZlZWwgb2YgZXZlbiB0aGF0IGlzIHRvIHJlc2NoZWR1bGUKICAgICAgICAgICAgICAgIGlmIChzaGFyZWRQcm9wZXJ0aWVzLmdldF9ldmVudF9yZXNjaGVkdWxlKCkhPW51bGwpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIGlmIChldmVudC5ldmVudF9pZD09c2hhcmVkUHJvcGVydGllcy5nZXRfZXZlbnRfcmVzY2hlZHVsZSgpLmV2ZW50X2lkKQogICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5jc3MoJ2JhY2tncm91bmQtY29sb3InLCAnI0E5QTlBOQknKTsKICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmNzcygnYm9yZGVyLWNvbG9yJywgJyNBOUE5QTkJJyk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoZXZlbnQuaXNfY2xhc3M9PTEpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIC8vIGlmIGNsYXNzIGFkZGluZyBudW1iZXIgb2YgcGFydGljaXBhbnRzCiAgICAgICAgICAgICAgICAgIGlmIChldmVudC5ub19vZl93YWl0aW5nX3VzZXJzPjApCiAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmZpbmQoJy5mYy10aXRsZScpLnByZXBlbmQoZXZlbnQubm9fb2ZfdXNlcnMrIi8iK2V2ZW50Lm1heF9wYXJ0aWNpcGFudHMrICIgKCIrZXZlbnQubm9fb2Zfd2FpdGluZ191c2VycysiKSIrIiAtICIpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZChldmVudC5ub19vZl91c2VycysiLyIrZXZlbnQubWF4X3BhcnRpY2lwYW50cysiIC0gIik7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgLy8gaWYgbm90IGNsYXNzIC0gd3JpdGluZyB0aGUgZW5kdXNlciBuYW1lCiAgICAgICAgICAgICAgICAgIGlmIChldmVudC5kdXJhdGlvbl9ldmVudCE9MCkgLy8gYWxzbyBpZiBub3QgaG91cnMgb2Ygd29yawogICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgLy8gZWxlbWVudC5maW5kKCcuZmMtdGl0bGUnKS5hcHBlbmQoIiAoIitldmVudC5ldmVudFVzZXJzWzBdLmJ1c2VyX2ZpcnN0X25hbWUrIiAiK2V2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfbGFzdF9uYW1lKyIpIik7CiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coZXZlbnQuZXZlbnRVc2Vycyk7CiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coZXZlbnQuZXZlbnRVc2Vycy5sZW5ndGgpOwogICAgICAgICAgICAgICAgICAgIGlmIChldmVudC5ldmVudFVzZXJzLmxlbmd0aD4wKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZCgiIitldmVudC5ldmVudFVzZXJzWzBdLmJ1c2VyX2ZpcnN0X25hbWUrIiAiK2V2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfbGFzdF9uYW1lKyIgKCIpOwogICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5maW5kKCcuZmMtdGl0bGUnKS5hcHBlbmQoIikiKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgLy8gbG9nRGVidWcoImhlcmU0Iik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoZXZlbnQuaXNfcmVwZWF0aW5nID09IDEpIHsKICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmZpbmQoIi5mYy10aXRsZSIpLmFwcGVuZCgiJm5ic3A7PGkgY2xhc3M9J2ZhIGZhLXJlcGVhdCc+PC9pPiZuYnNwOyIpOwogICAgICAgICAgICAgICAgICAgIC8vICBlbGVtZW50LmZpbmQoIi5mYy10aXRsZSIpLmFwcGVuZCgiJm5ic3A7PGltZyBzcmM9Jy9wdWJsaWMvaW1hZ2VzL3JlY3VycmluZy1pY29uLnBuZycgd2lkdGg9JzEwcHgnIGhlaWdodD0nMTBweCcvPiIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBtaW5UaW1lOiAkZ0NhbGVuZGFyRGlzcGxheU1pblRpbWUsCiAgICAgICAgICAgIG1heFRpbWU6ICRnQ2FsZW5kYXJEaXNwbGF5TWF4VGltZSwKICAgICAgICAgICAgc2VsZWN0YWJsZTogZmFsc2UsCiAgICAgICAgICAgIHNlbGVjdEhlbHBlcjogZmFsc2UsCiAgICAgICAgICAgIHRpbWV6b25lOiBmYWxzZSwKICAgICAgICAgICAgaXNSVEw6IHRydWUsCiAgICAgICAgICAgIGxhbmc6ICJoZSIsIC8vIGtrCiAgICAgICAgICAgIGFsbERheVNsb3Q6IGZhbHNlLAogICAgICAgICAgICBsb2FkaW5nOiBmdW5jdGlvbihib29sKSB7CiAgICAgICAgICAgICAgICBpZiAoYm9vbCkgewogICAgICAgICAgICAgICAgICAgIGxvZ0RlYnVnKCdsb2FkaW5nIGNhbGVuZGFyICcgKyAkc2NvcGUuY2FsZW5kYXIpOwogICAgICAgICAgICAgICAgICAgIC8vICQoJyNsb2FkaW5nJykuc2hvdygpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvLyAkKCcjbG9hZGluZycpLmhpZGUoKTsKICAgICAgICAgICAgICAgICAgICBsb2dEZWJ1ZygnZmluaXNoZWQgbG9hZGluZyBjYWxlbmRhciB4JyArICRzY29wZS5jYWxlbmRhcik7CiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnVwZGF0ZUNhbGVuZGFyQ2VudGVyVGl0bGUoKTsKICAgICAgICAgICAgICAgICAgICBsb2dEZWJ1ZygiYWZ0ZXIgY2FsZW5kYXIgbG9hZCB2aXNpYmxlRGF0ZVN0YXJ0PSIrdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5zdGFydCk7CiAgICAgICAgICAgICAgICAgICAgdmlzaWJsZURhdGVTdGFydCA9IG5ldyBEYXRlKHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3Jykuc3RhcnQpOwogICAgICAgICAgICAgICAgICAgIGRhdGVUb0dvVG8gPSB2aXNpYmxlRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCkgKyAiLSIgKyAoJzAnICsgKHZpc2libGVEYXRlU3RhcnQuZ2V0TW9udGgoKSArIDEpKS5zbGljZSgtMikgKyAiLSIgKyAoJzAnICsgdmlzaWJsZURhdGVTdGFydC5nZXREYXRlKCkpLnNsaWNlKC0yKTsKICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygiZGF0ZVRvR29UbyIrZGF0ZVRvR29Ubyk7CiAgICAgICAgICAgICAgICAgICAgLy8gJGh0dHAuZ2V0KCRnQXBpVVJMUHJlZml4ICsgIi9lbmR1c2VyL2V2ZW50cy9zdWdnZXN0LyIrdmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpKyIvIit0aGlzX3dlZWtfZnVsbF95ZWFyKyIvIit0aGlzX3dlZWtfbW9udGgrIi8iK3RoaXNfd2Vla19kYXlfb2ZfbW9udGgrIi8iKyB0aGlzX3dlZWtfaG91cnMrICIvIiArIHRoaXNfd2Vla19taW51dGVzKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKQogICAgICAgICAgICAgICAgICAgICRzY29wZS5ldmVudF90eXBlX2lkPSRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkOwogICAgICAgICAgICAgICAgICAgICRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0PXZpc2libGVEYXRlU3RhcnQ7CiAgICAgICAgICAgICAgICAgICAgLy8xMjEyMTIKICAgICAgICAgICAgICAgICAgICAvLyBpZiAoJHNjb3BlLnNlbGVjdGVkX2V2ZW50X3R5cGVfaWRfaXNfY2xhc3MpCiAgICAgICAgICAgICAgICAgICAgLy8gewogICAgICAgICAgICAgICAgICAgIC8vICAgJGh0dHAuZ2V0KCRnQXBpVVJMUHJlZml4ICsgIi9lbmR1c2VyL2V2ZW50cy9zdWdnZXN0Y2xhc3MvIiskc2NvcGUuZXZlbnRfdHlwZV9pZCsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSsiLyIrKCRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkrMSkrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0SG91cnMoKSArICIvIiArICRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKSsgIi8iICsgJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJfaWQpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpCiAgICAgICAgICAgICAgICAgICAgLy8gICB7CiAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgLy8JICAgICRzY29wZS5teURhdGEgPSByZXNwb25zZS5kYXRhOwogICAgICAgICAgICAgICAgICAgIC8vICAgICAgIC8vCQlsb2dEZWJ1ZygiZ3JpZG9wdGlvbnM9Iiskc2NvcGUuZ3JpZE9wdGlvbnMpOwogICAgICAgICAgICAgICAgICAgIC8vICAgICAgICRzY29wZS5ldmVudHNTdWdnZXN0ZWQgPSByZXNwb25zZS5kYXRhOwogICAgICAgICAgICAgICAgICAgIC8vICAgICAgIC8vICRzY29wZS5kYXRlVG9Hb1RvPWRhdGVUb0dvVG87CiAgICAgICAgICAgICAgICAgICAgLy8gICB9KTsKICAgICAgICAgICAgICAgICAgICAvLyB9CiAgICAgICAgICAgICAgICAgICAgLy8gZWxzZQogICAgICAgICAgICAgICAgICAgIC8vIHsKICAgICAgICAgICAgICAgICAgICAvLyAgICRodHRwLmdldCgkZ0FwaVVSTFByZWZpeCArICIvZW5kdXNlci9ldmVudHMvc3VnZ2VzdC8iKyRzY29wZS5ldmVudF90eXBlX2lkKyIvIiskc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpKyIvIisoJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0TW9udGgoKSsxKSsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0RGF0ZSgpKyIvIiskc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXRIb3VycygpICsgIi8iICsgJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0TWludXRlcygpKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKQogICAgICAgICAgICAgICAgICAgIC8vICAgewogICAgICAgICAgICAgICAgICAgIC8vICAgICAgIC8vCSAgICAkc2NvcGUubXlEYXRhID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAvLwkJbG9nRGVidWcoImdyaWRvcHRpb25zPSIrJHNjb3BlLmdyaWRPcHRpb25zKTsKICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAkc2NvcGUuZXZlbnRzU3VnZ2VzdGVkID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAvLyAkc2NvcGUuZGF0ZVRvR29Ubz1kYXRlVG9Hb1RvOwogICAgICAgICAgICAgICAgICAgIC8vICAgfSk7CiAgICAgICAgICAgICAgICAgICAgLy8gfQoKICAgICAgICAgICAgICAgICAgICAvLyBhZnRlciBjYWxlbmRhciBpcyBsb2FkZWQgLSBsb2FkaW5nIGV2ZW50IHR5cGVzIGFuZCBzdWdnZXN0aW9uIGZvciBxdWV1ZXMKICAgICAgICAgICAgICAgICAgICAvLyB3ZSBoYW5kbGUgdGhpbmdzIHJlbGF0ZWQgdG8gdGhlIGV2ZW50IHR5cGVzIG9ubHkgYWZ0ZXIgbG9hZGluZyB0aGVtIChhbmQgdGhlIGNhbGVuZGFyKQogICAgICAgICAgICAgICAgICAgIGdldEFsbEJ1c2luZXNzRXZlbnRUeXBlc05vU3lzdGVtKCRodHRwLCRzY29wZSwnZXZlbnRfdHlwZXMnLGdldEFsbEJ1c2luZXNzRXZlbnRUeXBlc05vU3lzdGVtX2NhbGxiYWNrKTsKCiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzTm9TeXN0ZW1fY2FsbGJhY2soKQogICAgICAgICAgICAgICAgICAgIHsgICAgLy8gY2hlY2tpbmcgaWYgY2FsZW5kYXIgc2hvdWxkIHN0YXJ0IHdpdGggYSBzcGVjaWZpYyBldmVudCB0eXBlIGZvciBzdWdnZXN0aW9ucwogICAgICAgICAgICAgICAgICAgICAgICAvLyBsb2dEZWJ1ZygiWCBzaGFyZWRQcm9wZXJ0aWVzLmdldF9ldmVudF90eXBlX2Zvcl9zdWdnZXN0aW9ucz0iK3NoYXJlZFByb3BlcnRpZXMuZ2V0X2V2ZW50X3R5cGVfZm9yX3N1Z2dlc3Rpb25zKCkpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2hhcmVkUHJvcGVydGllcy5nZXRfZXZlbnRfdHlwZV9mb3Jfc3VnZ2VzdGlvbnMoKSE9bnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkPXNoYXJlZFByb3BlcnRpZXMuZ2V0X2V2ZW50X3R5cGVfZm9yX3N1Z2dlc3Rpb25zKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmV2ZW50VHlwZVNlbGVjdGVkKCRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gZmlyc3QgY2hlY2tpbmcgaWYgdGhlcmUncyBhbiBldmVudCB0byByZXNjaGVkdWxlCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzaGFyZWRQcm9wZXJ0aWVzLmdldF9ldmVudF9yZXNjaGVkdWxlKCkhPW51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUucHJldmlvdXNfZXZlbnRfcmVzY2hlZHVsZT10cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5wcmV2aW91c19ldmVudF9yZXNjaGVkdWxlX2V2ZW50PXNoYXJlZFByb3BlcnRpZXMuZ2V0X2V2ZW50X3Jlc2NoZWR1bGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICBzaGFyZWRQcm9wZXJ0aWVzLnNldF9ldmVudF9yZXNjaGVkdWxlKG51bGwpOwogICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ0RlYnVnKCJnb3QgZXZlbnQgdG8gcmVzY2hlZHVsZSAiK0pTT04uc3RyaW5naWZ5KCRzY29wZS5wcmV2aW91c19ldmVudF9yZXNjaGVkdWxlX2V2ZW50KSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nRGVidWcoInJlc2NoZWR1bGUgZXZlbnRfdHlwZV9pZD0iKyRzY29wZS5wcmV2aW91c19ldmVudF9yZXNjaGVkdWxlX2V2ZW50LmV2ZW50X3R5cGVfaWQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkPSRzY29wZS5wcmV2aW91c19ldmVudF9yZXNjaGVkdWxlX2V2ZW50LmV2ZW50X3R5cGVfaWQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmV2ZW50VHlwZVNlbGVjdGVkKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gY2hlY2tpbmcgc2VsZWN0ZWQgdXNlciBvbmx5IGlmIHRoZXJlJ3Mgbm8gc2VsZWN0ZWQgZXZlbnQgdG8gbW92ZQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkhPW51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiZ290IHByZXZpb3VzIHNlbGVjdGVkIHVzZXIgIitzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfZmlyc3RfbmFtZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJuYW1lPXNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKS5idXNlcl9maXJzdF9uYW1lKyIgIitzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfbGFzdF9uYW1lOwogICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyX2lkPXNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKS5idXNpbmVzc191c2VyX2lkOwogICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ0RlYnVnKCIkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcl9pZD0iKyRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyX2lkKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXI9dHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIC8vIHNlbGVjdDogZnVuY3Rpb24oc3RhcnQsIGVuZCwgYWxsRGF5KSB7CiAgICAgICAgICAgIC8vICAgICAvLyB2YXIgdGl0bGUgPSBwcm9tcHQoJ0V2ZW50IFRpdGxlOicgKyAoc3RhcnQgKyAzNTI4MDAwMDApIC8gKDYwICogMTAwMCkgKyAiICIgKyBlbmQgKyAiICIgKyBhbGxEYXkpOwogICAgICAgICAgICAvLyAgICAgdGl0bGUgPSAi16nXoteV16og16TXoteZ15zXldeqIjsKICAgICAgICAgICAgLy8gICAgIGlmICh0aXRsZSkgewogICAgICAgICAgICAvLyAgICAgICAgIGxvZ0RlYnVnKCJjcmVhdGluZyBkZXZlbnQgc3RhcnQiKTsKICAgICAgICAgICAgLy8gICAgICAgICBsb2dEZWJ1Zygic3RhcnQ9IiArIHN0YXJ0KTsKICAgICAgICAgICAgLy8gICAgICAgICBjaGVja0RhdGUgPSBuZXcgRGF0ZShzdGFydCk7CiAgICAgICAgICAgIC8vICAgICAgICAgbG9nRGVidWcoImNoZWNrIGRhdGUgPSAiICsgY2hlY2tEYXRlKQogICAgICAgICAgICAvLyAgICAgICAgIGxvZ0RlYnVnKCJlbmQ9IiArIGVuZCk7CiAgICAgICAgICAgIC8vICAgICAgICAgZWNvbG9yID0gIiMiICsgJHNjb3BlLmV2ZW50Q29sb3I7IC8vZ2V0UmFuZG9tQ29sb3IoKTsKICAgICAgICAgICAgLy8KICAgICAgICAgICAgLy8KICAgICAgICAgICAgLy8gICAgICAgICAvLyB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tdLmZ1bGxDYWxlbmRhcigncmVyZW5kZXJFdmVudHMnKTsKICAgICAgICAgICAgLy8KICAgICAgICAgICAgLy8gICAgICAgICBjYWxlbmRhciA9ICRzY29wZS5jYWxlbmRhcl9uYW1lOwogICAgICAgICAgICAvLyAgICAgICAgIHRlbXBfbGltaXRfaWQgPSAkZ0NhbGVuZGFyVGVtcEVudklEMSAtIGdldFJhbmRvbUludCgxMCwgODApOwogICAgICAgICAgICAvLyAgICAgICAgIG5ld0V2ZW50ID0gewogICAgICAgICAgICAvLyAgICAgICAgICAgICBpZDogdGVtcF9saW1pdF9pZCwKICAgICAgICAgICAgLy8gICAgICAgICAgICAgdGl0bGU6IHRpdGxlLAogICAgICAgICAgICAvLyAgICAgICAgICAgICBzdGFydDogc3RhcnQsCiAgICAgICAgICAgIC8vICAgICAgICAgICAgIGNvbG9yOiBlY29sb3IsCiAgICAgICAgICAgIC8vICAgICAgICAgICAgIGVuZDogZW5kLAogICAgICAgICAgICAvLyAgICAgICAgICAgICBhbGxEYXk6IGZhbHNlLAogICAgICAgICAgICAvLyAgICAgICAgICAgICBjbGFzc05hbWU6IFsnb3BlblNlc2FtZSddCiAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICAvLyBjb2xvcjogcmVzb3VyY2UuZXZlbnRDb2xvcgogICAgICAgICAgICAvLyAgICAgICAgIH07CiAgICAgICAgICAgIC8vICAgICAgICAgY2FsZW5kYXIgPSAkc2NvcGUuY2FsZW5kYXJfbmFtZTsKICAgICAgICAgICAgLy8KICAgICAgICAgICAgLy8gICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZW5kZXJFdmVudCcsIG5ld0V2ZW50LCB0cnVlKTsKICAgICAgICAgICAgLy8gICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCd1bnNlbGVjdCcpOwogICAgICAgICAgICAvLwogICAgICAgICAgICAvLyAgICAgICAgIGxvZ0RlYnVnKCJjcmVhdGluZyBkZXZlbnQgZW5kIik7CiAgICAgICAgICAgIC8vICAgICAgICAgJHNjb3BlLmFkZEV2ZW50VG9EYXRhYmFzZShzdGFydCwgZW5kLCB0aXRsZSwgZWNvbG9yLCB0ZW1wX2xpbWl0X2lkKTsKICAgICAgICAgICAgLy8KICAgICAgICAgICAgLy8gICAgIH0KICAgICAgICAgICAgLy8gfQogICAgICAgIH0KICAgIH07Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignSG91cnNPZldvcmtDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGNvbXBpbGUsICRsb2NhdGlvbiwgdWlDYWxlbmRhckNvbmZpZywgJHVpYk1vZGFsKSB7CiAgICBsb2dEZWJ1ZygnSG91cnNPZldvcmsgQ29udHJvbGxlcicpOwoKICAgIGxvZ0RlYnVnKCIkbG9jYXRpb24uc2VhcmNoKCkuc3RhcnQ9IiArICRsb2NhdGlvbi5zZWFyY2goKS5zdGFydCk7CiAgICBpZiAodHlwZW9mICRsb2NhdGlvbi5zZWFyY2goKS5zdGFydCA9PSAndW5kZWZpbmVkJykgewogICAgICAgIGN1cnJEZWZhdWx0RGF0ZSA9ICRnSG91cjBkYXRlOwogICAgICAgICRzY29wZS5maXhlZFNjaGVkdWxlID0gdHJ1ZTsKICAgICAgICAkc2NvcGUuY2FsZW5kYXJUaXRsZUNlbnRlciA9ICLXqdei15XXqiDXpNei15nXnNeV16og16fXkdeV16LXldeqIjsKICAgICAgICBsb2dEZWJ1Zygi16nXoteV16og16TXoteZ15zXldeqINen15HXldei15XXqiIpOwogICAgICAgIGhvdXJzT2ZXb3JrRGVmYXVsdFZpZXc9J2RvbnRTaG93RGF0ZSc7CiAgICB9IGVsc2UgewogICAgICAgIGN1cnJEZWZhdWx0RGF0ZSA9ICRsb2NhdGlvbi5zZWFyY2goKS5zdGFydDsKICAgICAgICAkc2NvcGUuZml4ZWRTY2hlZHVsZSA9IGZhbHNlOwogICAgICAgIC8vICRzY29wZS5jYWxlbmRhclRpdGxlQ2VudGVyID0gItep16LXldeqINek16LXmdec15XXqiDXp9eR15XXoteV16oiOwogICAgICAgIGhvdXJzT2ZXb3JrRGVmYXVsdFZpZXc9J2FnZW5kYVdlZWsnOwogICAgfQoKCiAgICAkc2NvcGUudmlzaWJsZURhdGUgPSBbXTsKICAgICRzY29wZS5jYWxlbmRhciA9ICdjYWxlbmRhcl9ob3Vyc19vZl93b3JrJzsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50VHlwZSA9IFtdOwoKICAgIGdldEFsbEJ1c2luZXNzRXZlbnRUeXBlcygkaHR0cCwkc2NvcGUsJ2V2ZW50X3R5cGVzJyxnZXRBbGxCdXNpbmVzc0V2ZW50VHlwZXNfY2FsbGJhY2spOwoKICAgIGZ1bmN0aW9uIGdldEFsbEJ1c2luZXNzRXZlbnRUeXBlc19jYWxsYmFjaygpCiAgICB7CiAgICAgICRzY29wZS5zZWxlY3RFdmVudFR5cGUoJHNjb3BlLmV2ZW50X3R5cGVzWzBdKTsKICAgIH0KICAgICRzY29wZS5iYWNrVG9DYWxlbmRhciA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZpc2libGVEYXRlU3RhcnQgPSBuZXcgRGF0ZSh1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ2V0VmlldycpLnN0YXJ0KTsKICAgICAgICBkYXRlVG9Hb1RvID0gdmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpICsgIi0iICsgKCcwJyArICh2aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkgKyAxKSkuc2xpY2UoLTIpICsgIi0iICsgKCcwJyArIHZpc2libGVEYXRlU3RhcnQuZ2V0RGF0ZSgpKS5zbGljZSgtMik7CiAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jYWxlbmRhcicpLnNlYXJjaCh7CiAgICAgICAgICAgIHN0YXJ0OiBkYXRlVG9Hb1RvCiAgICAgICAgfSk7CiAgICB9CiAgICAkc2NvcGUuc2VsZWN0RXZlbnRUeXBlID0gZnVuY3Rpb24oZXZlbnRUeXBlKSB7CiAgICAgICAgJHNjb3BlLnNlbGVjdGVkRXZlbnRUeXBlID0gZXZlbnRUeXBlOwogICAgICAgIGxvZ0RlYnVnKCJzZWxlY3RlZCBFdmVudCBUeXBlID0gIiArICRzY29wZS5zZWxlY3RlZEV2ZW50VHlwZS5ldmVudF90eXBlX2lkICsgIiwgIiArICRzY29wZS5zZWxlY3RlZEV2ZW50VHlwZS5ldmVudF90eXBlX25hbWUpOwogICAgICAgIGt1emVJc0NhbGVuZGFyRHJhZ2dibGUgPSAkc2NvcGUuc2VsZWN0ZWRFdmVudFR5cGUuZGlmZl9yYW5nZTsKICAgIH07CgogICAgJHNjb3BlLmNoYW5nZUV2ZW50Q29sb3IgPSBmdW5jdGlvbihuZXdDb2xvcikgewogICAgICAgICRzY29wZS5ldmVudENvbG9yID0gbmV3Q29sb3I7CiAgICAgICAgYWxsbEV2ZW50c0FycmF5ID0gdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignY2xpZW50RXZlbnRzJyk7CiAgICAgICAgZm9yIChpIGluIGFsbGxFdmVudHNBcnJheSkgewogICAgICAgICAgICBhbGxsRXZlbnRzQXJyYXlbaV0uY29sb3IgPSAiIyIgKyBuZXdDb2xvcjsKICAgICAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigndXBkYXRlRXZlbnQnLCBhbGxsRXZlbnRzQXJyYXlbaV0pOwogICAgICAgIH0KICAgIH07CgogICAgJHNjb3BlLmV2ZW50Q2xpY2tNb2R1bGUgPSBmdW5jdGlvbihzZWxlY3RlZEV2ZW50LCBzaXplKSB7CiAgICAgICAgbG9nRGVidWcoInNlbGVjdGVkIEV2ZW50IHRpdGxlPSIgKyBzZWxlY3RlZEV2ZW50LnRpdGxlKTsKCgogICAgICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewogICAgICAgICAgICBhbmltYXRpb246IGZhbHNlLAogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9saW1pdGF0aW9uX2RldGFpbHMuaHRtbCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdldmVudERldGFpbHNIb3Vyc09mV29ya01vZGFsQ29udHJvbGxlcicsCiAgICAgICAgICAgIHNpemU6IHNpemUsCiAgICAgICAgICAgIHJlc29sdmU6IHsKICAgICAgICAgICAgICAgIHNlbGVjdGVkRXZlbnQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxlY3RlZEV2ZW50OwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGZpeGVkU2NoZWR1bGU6IGZ1bmN0aW9uICgpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuZml4ZWRTY2hlZHVsZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBtb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHNlbGVjdGVkSXRlbSkgewogICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWQgPSBzZWxlY3RlZEl0ZW07CiAgICAgICAgfSwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGxvZ0RlYnVnKCdNb2RhbCBkaXNtaXNzZWQgYXQ6ICcgKyBuZXcgRGF0ZSgpKTsKICAgICAgICB9KTsKICAgIH07CgoKICAgIHZhciBkYXRlID0gbmV3IERhdGUoKTsKICAgIHZhciBkID0gZGF0ZS5nZXREYXRlKCk7CiAgICB2YXIgbSA9IGRhdGUuZ2V0TW9udGgoKTsKICAgIHZhciB5ID0gZGF0ZS5nZXRGdWxsWWVhcigpOwoKCiAgICBmdW5jdGlvbiBnZXRUaW1lU3RhbXAobm93KSB7CiAgICAgICAgcmV0dXJuICgobm93LmdldE1vbnRoKCkgKyAxKSArICcvJyArIChub3cuZ2V0RGF0ZSgpKSArICcvJyArIG5vdy5nZXRGdWxsWWVhcigpICsgIiAiICsgbm93LmdldEhvdXJzKCkgKyAnOicgKyAoKG5vdy5nZXRNaW51dGVzKCkgPCAxMCkgPyAoIjAiICsgbm93LmdldE1pbnV0ZXMoKSkgOiAobm93LmdldE1pbnV0ZXMoKSkpICsgJzonICsgKChub3cuZ2V0U2Vjb25kcygpIDwgMTApID8gKCIwIiArIG5vdwogICAgICAgICAgICAuZ2V0U2Vjb25kcygpKSA6IChub3cuZ2V0U2Vjb25kcygpKSkpOwogICAgfQoKCiAgICAvKiBDaGFuZ2UgVmlldyAqLwogICAgJHNjb3BlLmNoYW5nZVZpZXcgPSBmdW5jdGlvbih2aWV3LCBjYWxlbmRhcikgewogICAgICAgIGxvZ0RlYnVnKCJjaGFuZ2UgdmlldyAiICsgdmlldyk7CiAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignY2hhbmdlVmlldycsIHZpZXcpOwogICAgfTsKICAgIC8qIENoYW5nZSBWaWV3ICovCgogICAgJHNjb3BlLnJlbmRlckNhbGVuZGVyID0gZnVuY3Rpb24oY2FsZW5kYXIpIHsKICAgICAgICAkdGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgaWYgKHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXSkgewogICAgICAgICAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVuZGVyJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH07CgogICAgJHNjb3BlLmNoYW5nZVNlbGVjdGFibGUgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAga3V6ZUlzQ2FsZW5kYXJEcmFnZ2JsZSA9ICFrdXplSXNDYWxlbmRhckRyYWdnYmxlOwogICAgICAgICAgICBjYWxlbmRhciA9ICdjYWxlbmRhcl9ob3Vyc19vZl93b3JrJzsKICAgICAgICAgICAgLy8gdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ2V0VmlldycpLmNhbGVuZGFyLm9wdGlvbnMuc2VsZWN0YWJsZSA9IGZhbHNlOwogICAgICAgICAgICB2aWV3ID0gdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignb3B0aW9uJywgJ3NlbGVjdGFibGUnLCBmYWxzZSk7CiAgICAgICAgICAgIC8vIHZpZXcuY2FsZW5kYXIub3B0aW9ucy5zZWxlY3RhYmxlID0gZmFsc2U7CiAgICAgICAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlbmRlcicpOwoKICAgICAgICB9CiAgICAgICAgLyogY29uZmlnIG9iamVjdCAqLwoKICAgICRzY29wZS5jYWxlbmRhcl9ob3Vyc19vZl93b3JrX2NvbmZpZyA9IHsKICAgICAgICBjYWxlbmRhcjogewogICAgICAgICAgICBoZWlnaHQ6ICdhdXRvJywKICAgICAgICAgICAgZWRpdGFibGU6IHRydWUsCiAgICAgICAgICAgIC8vIGhlYWRlcjogewogICAgICAgICAgICAvLyAgICAgbGVmdDogJycsCiAgICAgICAgICAgIC8vICAgICBjZW50ZXI6ICcnLAogICAgICAgICAgICAvLyAgICAgcmlnaHQ6ICcnCiAgICAgICAgICAgIC8vIH0sCiAgICAgICAgICAgIGhlYWRlcjogJycsCiAgICAgICAgICAgIC8vIGhlYWRlcjogewogICAgICAgICAgICAvLyAgICAgbGVmdDogJ3RpdGxlJywKICAgICAgICAgICAgLy8gICAgIGNlbnRlcjogJycsCiAgICAgICAgICAgIC8vICAgICByaWdodDogJ3RvZGF5IHByZXYsbmV4dCcKICAgICAgICAgICAgLy8gfSwKICAgICAgICAgICAgLy8gZGVmYXVsdFZpZXc6ICdhZ2VuZGFXZWVrJywKICAgICAgICAgICAgdmlld3M6IHsKICAgICAgICAgICAgICAgIGRvbnRTaG93RGF0ZTogewogICAgICAgICAgICAgICAgICAgIHR5cGU6ICdhZ2VuZGFXZWVrJywKICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogewogICAgICAgICAgICAgICAgICAgICAgICBkYXlzOiA3CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ0FwZXJ0dXJhJywKICAgICAgICAgICAgICAgICAgICBjb2x1bW5Gb3JtYXQ6ICdkZGRkJyAvLyBGb3JtYXQgdGhlIGRheSB0byBvbmx5IHNob3cgbGlrZSAnTW9uZGF5JwogICAgICAgICAgICAgICAgICAgICAgICAvLyBoaWRkZW5EYXlzOiBbMCwgNl0gLy8gSGlkZSBTdW5kYXkgYW5kIFNhdHVyZGF5PwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGRvU2hvd0RhdGU6IHsKICAgICAgICAgICAgICAgICAgICB0eXBlOiAnYWdlbmRhV2VlaycsCiAgICAgICAgICAgICAgICAgICAgZHVyYXRpb246IHsKICAgICAgICAgICAgICAgICAgICAgICAgZGF5czogNwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdBcGVydHVyYScsCgogICAgICAgICAgICAgICAgICAgICAgICAvLyBoaWRkZW5EYXlzOiBbMCwgNl0gLy8gSGlkZSBTdW5kYXkgYW5kIFNhdHVyZGF5PwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBldmVudERyb3A6IGZ1bmN0aW9uKGV2ZW50LCBkYXlEZWx0YSwgbWludXRlRGVsdGEsIGFsbERheSwgcmV2ZXJ0RnVuYywgdWlDYWxlbmRhckNvbmZpZykgewogICAgICAgICAgICAgICAgbG9nRGVidWcoImV2ZW50ZHJvcCIgKyBldmVudC50aXRsZSArICIoIiArIGV2ZW50LmlkICsgIikgbW92ZWQgIiArIG1pbnV0ZURlbHRhICsgIiBtaW51dGVzIik7CiAgICAgICAgICAgICAgICBsb2dEZWJ1Zygib2xkIHN0YXJ0PSIgKyBldmVudC5zdGFydCArICIsIG9sZCBlbmQ9IiArIGV2ZW50LmVuZCk7CiAgICAgICAgICAgICAgICAkc2NvcGUudXBkYXRlTGltaXRhdGlvbkRhdGFiYXNlKGV2ZW50LnN0YXJ0LCBldmVudC5lbmQsIGV2ZW50LmlkLCBldmVudC50ZW1wX2xpbWl0X2lkLCBldmVudCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGV2ZW50UmVzaXplOiBmdW5jdGlvbihldmVudCwgZGVsdGEsIHJldmVydEZ1bmMpIHsKICAgICAgICAgICAgICAgIGxvZ0RlYnVnKCJldmVudHJlc2l6ZSwgZXZlbnQuZW5kPSIgKyBldmVudC5lbmQpOwogICAgICAgICAgICAgICAgJHNjb3BlLnVwZGF0ZUxpbWl0YXRpb25EYXRhYmFzZShldmVudC5zdGFydCwgZXZlbnQuZW5kLCBldmVudC5pZCwgZXZlbnQudGVtcF9saW1pdF9pZCwgZXZlbnQpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBkZWZhdWx0VmlldzogaG91cnNPZldvcmtEZWZhdWx0VmlldywKICAgICAgICAgICAgZXZlbnRDbGljazogZnVuY3Rpb24oY2FsRXZlbnQsIGpzRXZlbnQsIHZpZXcpIHsKICAgICAgICAgICAgICAgIGxvZ0RlYnVnKCJldmVudCBjbGlja2VkICIgKyBjYWxFdmVudC50aXRsZSArICIoaWQ9IiArIGNhbEV2ZW50LmlkICsgIiwgZGF5X2xpbWl0X2lkPSIgKyBjYWxFdmVudC5kYXlfbGltaXRfaWQgKyAiLCB0ZW1wX2xpbWl0X2lkPSIgKyBjYWxFdmVudC50ZW1wX2xpbWl0X2lkICsgIiwgbGltaXRfaWQ9IiArIGNhbEV2ZW50LmxpbWl0X2lkICsgIikgc3RhcnQ9IiArIGNhbEV2ZW50LnN0YXJ0ICsgIiwgZW5kPSIgKyBjYWxFdmVudC5lbmQpOwogICAgICAgICAgICAgICAgJHNjb3BlLmV2ZW50Q2xpY2tNb2R1bGUoY2FsRXZlbnQpOwogICAgICAgICAgICAgICAgLy8gY2hhbmdlIHRoZSBib3JkZXIgY29sb3IganVzdCBmb3IgZnVuCiAgICAgICAgICAgICAgICAvLyAkKHRoaXMpLmNzcygnYm9yZGVyLWNvbG9yJywgJ3JlZCcpOwoKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZXZlbnRSZW5kZXI6IGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgY29uc29sZS5sb2coZXZlbnQpOwogICAgICAgICAgICAgIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZChldmVudC5sb2NhdGlvbl9uYW1lKyIgLyA8YnIvPiIpOwogICAgICAgICAgICAgIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZChldmVudC5pbnN0cnVjdG9yX25hbWUrIiAvIDxici8+Iik7CiAgICAgICAgICAgICAgLy8gZWxlbWVudC5maW5kKCcuZmMtdGl0bGUnKS5wcmVwZW5kKCIiK2V2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfZmlyc3RfbmFtZSsiICIrZXZlbnQuZXZlbnRVc2Vyc1swXS5idXNlcl9sYXN0X25hbWUrIiAoIik7CgogICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJyZW5kZXIgbGltaXRhdGlvbiAiK0pTT04uc3RyaW5naWZ5KGV2ZW50KSk7CiAgICAgICAgICAgICAgICAvLyBpZiAoZXZlbnQuaXNfY2xhc3M9PTEpCiAgICAgICAgICAgICAgICAvLyB7CiAgICAgICAgICAgICAgICAvLyAgIC8vIGlmIGNsYXNzIGFkZGluZyBudW1iZXIgb2YgcGFydGljaXBhbnRzCiAgICAgICAgICAgICAgICAvLyAgIGlmIChldmVudC5ub19vZl93YWl0aW5nX3VzZXJzPjApCiAgICAgICAgICAgICAgICAvLyAgIHsKICAgICAgICAgICAgICAgIC8vICAgICBlbGVtZW50LmZpbmQoJy5mYy10aXRsZScpLnByZXBlbmQoZXZlbnQubm9fb2ZfdXNlcnMrIi8iK2V2ZW50Lm1heF9wYXJ0aWNpcGFudHMrICIgKCIrZXZlbnQubm9fb2Zfd2FpdGluZ191c2VycysiKSIrIiAtICIpOwogICAgICAgICAgICAgICAgLy8gICB9CiAgICAgICAgICAgICAgICAvLyAgIGVsc2UKICAgICAgICAgICAgICAgIC8vICAgewogICAgICAgICAgICAgICAgLy8gICAgIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZChldmVudC5ub19vZl91c2VycysiLyIrZXZlbnQubWF4X3BhcnRpY2lwYW50cysiIC0gIik7CiAgICAgICAgICAgICAgICAvLyAgIH0KICAgICAgICAgICAgICAgIC8vIH0KICAgICAgICAgICAgICAgIC8vIGVsc2UKICAgICAgICAgICAgICAgIC8vIHsKICAgICAgICAgICAgICAgIC8vICAgLy8gaWYgbm90IGNsYXNzIC0gd3JpdGluZyB0aGUgZW5kdXNlciBuYW1lCiAgICAgICAgICAgICAgICAvLyAgIGlmIChldmVudC5kdXJhdGlvbl9ldmVudCE9MCkgLy8gYWxzbyBpZiBub3QgaG91cnMgb2Ygd29yawogICAgICAgICAgICAgICAgLy8gICB7CiAgICAgICAgICAgICAgICAvLyAgICAgLy8gZWxlbWVudC5maW5kKCcuZmMtdGl0bGUnKS5hcHBlbmQoIiAoIitldmVudC5ldmVudFVzZXJzWzBdLmJ1c2VyX2ZpcnN0X25hbWUrIiAiK2V2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfbGFzdF9uYW1lKyIpIik7CiAgICAgICAgICAgICAgICAvLyAgICAgZWxlbWVudC5maW5kKCcuZmMtdGl0bGUnKS5wcmVwZW5kKCIiK2V2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfZmlyc3RfbmFtZSsiICIrZXZlbnQuZXZlbnRVc2Vyc1swXS5idXNlcl9sYXN0X25hbWUrIiAoIik7CiAgICAgICAgICAgICAgICAvLyAgICAgZWxlbWVudC5maW5kKCcuZmMtdGl0bGUnKS5hcHBlbmQoIikiKTsKICAgICAgICAgICAgICAgIC8vICAgfQogICAgICAgICAgICAgICAgLy8gICAvLyBsb2dEZWJ1ZygiaGVyZTQiKTsKICAgICAgICAgICAgICAgIC8vIH0KICAgICAgICAgICAgICAgIC8vIGlmIChldmVudC5pc19yZXBlYXRpbmcgPT0gMSkgewogICAgICAgICAgICAgICAgLy8gICAgIGVsZW1lbnQuZmluZCgiLmZjLXRpdGxlIikucHJlcGVuZCgiJm5ic3A7PGkgY2xhc3M9J2ZhIGZhLXJlcGVhdCc+PC9pPiZuYnNwOyIpOwogICAgICAgICAgICAgICAgLy8gICAgIC8vICBlbGVtZW50LmZpbmQoIi5mYy10aXRsZSIpLmFwcGVuZCgiJm5ic3A7PGltZyBzcmM9Jy9wdWJsaWMvaW1hZ2VzL3JlY3VycmluZy1pY29uLnBuZycgd2lkdGg9JzEwcHgnIGhlaWdodD0nMTBweCcvPiIpOwogICAgICAgICAgICAgICAgLy8gfQogICAgICAgICAgICB9LAogICAgICAgICAgICBtaW5UaW1lOiAkZ0NhbGVuZGFyRGlzcGxheU1pblRpbWUsCiAgICAgICAgICAgIG1heFRpbWU6ICRnQ2FsZW5kYXJEaXNwbGF5TWF4VGltZSwKICAgICAgICAgICAgc2VsZWN0YWJsZTogdHJ1ZSwKICAgICAgICAgICAgc2VsZWN0SGVscGVyOiBmYWxzZSwKICAgICAgICAgICAgdGltZXpvbmU6IGZhbHNlLAogICAgICAgICAgICBpc1JUTDogdHJ1ZSwKICAgICAgICAgICAgbGFuZzogImhlIiwKICAgICAgICAgICAgc2VsZWN0Q29uc3RyYWludDogewogICAgICAgICAgICAgICAgc3RhcnQ6ICcwMDowMScsCiAgICAgICAgICAgICAgICBlbmQ6ICcyMzo1OScsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRlZmF1bHREYXRlOiBtb21lbnQoY3VyckRlZmF1bHREYXRlKSwKICAgICAgICAgICAgYWxsRGF5U2xvdDogZmFsc2UsCiAgICAgICAgICAgIGxvYWRpbmc6IGZ1bmN0aW9uKGJvb2wpIHsKICAgICAgICAgICAgICAgIGlmIChib29sKSB7CiAgICAgICAgICAgICAgICAgICAgbG9nRGVidWcoJ2xvYWRpbmcgY2FsZW5kYXIgJyArICRzY29wZS5jYWxlbmRhcik7CgogICAgICAgICAgICAgICAgICAgIC8vICQoJyNsb2FkaW5nJykuc2hvdygpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvLyAkKCcjbG9hZGluZycpLmhpZGUoKTsKICAgICAgICAgICAgICAgICAgICBsb2dEZWJ1ZygnZmluaXNoZWQgbG9hZGluZyBjYWxlbmRhciAnICsgJHNjb3BlLmNhbGVuZGFyKTsKICAgICAgICAgICAgICAgICAgICBpZiAoISRzY29wZS5maXhlZFNjaGVkdWxlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIC8vICRzY29wZS5iYWNrVG9GaXhlZCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBzZWxlY3Q6IGZ1bmN0aW9uKHN0YXJ0LCBlbmQsIGFsbERheSkgewogICAgICAgICAgICAgIC8vIHRoaXMgaXMgY2FsbGVkIHdoZW4gY3JlYXRpbmcgYSBuZXcgYmxvY2sKICAgICAgICAgICAgICAkc2NvcGUuY3JlYXRlTGltaXRhdGlvbkJsb2NrKHN0YXJ0LCBlbmQpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKCiAgICAvLyBjcmVhdGUgbGltaXRhdGlvbiBibG9jawogICAgJHNjb3BlLmNyZWF0ZUxpbWl0YXRpb25CbG9jayA9IGZ1bmN0aW9uKHN0YXJ0LCBlbmQpCiAgICB7CiAgICAgICAgbG9nRGVidWcoImZ1bmN0aW9uOiBjcmVhdGVMaW1pdGF0aW9uQmxvY2siKTsKICAgICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAgICAgICAgICAgYW5pbWF0aW9uOiBmYWxzZSwKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfbGltaXRhdGlvbl9jcmVhdGUucGhwJywKICAgICAgICAgICAgc2l6ZTogJ3hzJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ2J1c2luZXNzX21vZGFsX2xpbWl0YXRpb25fY3JlYXRlJywKICAgICAgICAgICAgcmVzb2x2ZTogewogICAgICAgICAgICAgIHN0YXJ0OiBmdW5jdGlvbigpCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICByZXR1cm4gc3RhcnQ7CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBlbmQ6IGZ1bmN0aW9uKCkKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBlbmQ7CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBmaXhlZFNjaGVkdWxlOiBmdW5jdGlvbiAoKQogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuZml4ZWRTY2hlZHVsZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0KICAgICRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKTsKCiAgICAgICAgdmlzaWJsZURhdGVTdGFydCA9IG5ldyBEYXRlKHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3Jykuc3RhcnQpOwogICAgICAgIHZpc2libGVEYXRlRW5kID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5lbmQpOwoKICAgICAgICAkc2NvcGUuY2FsZW5kYXJUaXRsZUNlbnRlciA9IHZpc2libGVEYXRlU3RhcnQuZ2V0RGF0ZSgpICsgIiAiICsgbW9udGhOYW1lc1t2aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCldICsKICAgICAgICAgICAgIiDigJQgIiArIHZpc2libGVEYXRlRW5kLmdldERhdGUoKSArICIgIiArIG1vbnRoTmFtZXNbdmlzaWJsZURhdGVFbmQuZ2V0TW9udGgoKV0gKwogICAgICAgICAgICAiICIgKyB2aXNpYmxlRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCk7CiAgICB9OwogICAgLyogZXZlbnQgc291cmNlcyBhcnJheSovCiAgICAkc2NvcGUuZXZlbnRTb3VyY2VzID0gW3sKICAgICAgICB1cmw6ICcvYXBpL2FkbWluL2NhbGVuZGFyL2xpbWl0YXRpb25zL3BlcmRheS9nZXRwb3N0JywKICAgICAgICB0eXBlOiAnUE9TVCcKICAgIH1dOwoKICAgIC8vICRzY29wZS5nZXRFdmVudHMgPSBmdW5jdGlvbigpIHsKICAgIC8vICAgICBjYWxlbmRhciA9ICdjYWxlbmRhcl9ob3Vyc19vZl93b3JrJzsKICAgIC8vICAgICBhbGxsRXZlbnRzQXJyYXkgPSB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdjbGllbnRFdmVudHMnKTsKICAgIC8vICAgICBmb3IgKGkgaW4gYWxsbEV2ZW50c0FycmF5KSB7CiAgICAvLyAgICAgICAgIGxvZ0RlYnVnKGFsbGxFdmVudHNBcnJheVtpXSk7CiAgICAvLyAgICAgfQogICAgLy8KICAgIC8vIH0KCiAgICAkc2NvcGUuZ290b1RvZGF5ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgJHNjb3BlLmdvdG9EYXRlKG5ldyBEYXRlKCkpOwogICAgfQogICAgJHNjb3BlLmdvdG9OZXh0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ25leHQnKTsKICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVtb3ZlRXZlbnRzJyk7CiAgICAgICAgJHNjb3BlLnVwZGF0ZUNhbGVuZGFyQ2VudGVyVGl0bGUoKTsKICAgIH0KICAgICRzY29wZS5nb3RvUHJldiA9IGZ1bmN0aW9uKCkgewogICAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZW1vdmVFdmVudHMnKTsKICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncHJldicpOwogICAgICAgICRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlKCk7CiAgICB9CiAgICAkc2NvcGUuZ290b0RhdGUgPSBmdW5jdGlvbihuZXdkYXRlKSB7CiAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dvdG9EYXRlJywgbmV3ZGF0ZSk7CiAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2NoYW5nZVZpZXcnLCAnYWdlbmRhV2VlaycpOwogICAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZW1vdmVFdmVudHMnKTsKICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwoKICAgICAgICAkc2NvcGUudXBkYXRlQ2FsZW5kYXJDZW50ZXJUaXRsZSgpOwogICAgICAgICRzY29wZS5maXhlZFNjaGVkdWxlID0gZmFsc2U7CiAgICB9CgogICAgJHNjb3BlLmJhY2tUb0ZpeGVkID0gZnVuY3Rpb24oKSB7CiAgICAgICAgJHNjb3BlLmZpeGVkU2NoZWR1bGUgPSB0cnVlOwogICAgICAgICRzY29wZS5jYWxlbmRhclRpdGxlQ2VudGVyID0gItep16LXldeqINek16LXmdec15XXqiDXp9eR15XXoteV16oiOwogICAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdjaGFuZ2VWaWV3JywgJ2RvbnRTaG93RGF0ZScpOwogICAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnb3RvRGF0ZScsIG1vbWVudCgkZ0hvdXIwZGF0ZSkpOwogICAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZW1vdmVFdmVudHMnKTsKICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwoKICAgIH0KCiAgICAvLyAkc2NvcGUuZGVsZXRlQWxsRXZlbnRzID0gZnVuY3Rpb24oKSB7CiAgICAvLyAgICAgY2FsZW5kYXIgPSAnY2FsZW5kYXJfaG91cnNfb2Zfd29yayc7CiAgICAvLyAgICAgYWxsbEV2ZW50c0FycmF5ID0gdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignY2xpZW50RXZlbnRzJyk7CiAgICAvLyAgICAgZm9yIChpIGluIGFsbGxFdmVudHNBcnJheSkgewogICAgLy8gICAgICAgICBsb2dEZWJ1ZyhhbGxsRXZlbnRzQXJyYXlbaV0pOwogICAgLy8gICAgICAgICAkc2NvcGUuZGVsZXRlQ2FsZW5kYXJKU0V2ZW50KGNhbGVuZGFyLCBhbGxsRXZlbnRzQXJyYXlbaV0uaWQpOwogICAgLy8gICAgICAgICAkc2NvcGUuZGVsZXRlQ2FsZW5kYXJEQkV2ZW50KGFsbGxFdmVudHNBcnJheVtpXS5pZCk7CiAgICAvLyAgICAgfQogICAgLy8KICAgIC8vIH0KICAgICRzY29wZS51cGRhdGVMaW1pdGF0aW9uRGF0YWJhc2UgPSBmdW5jdGlvbihzdGFydF9wYXJhbSwgZW5kX3BhcmFtLCBldmVudF9pZCwgdGVtcF9saW1pdF9pZCwgdGhlZXZlbnQpIHsKCiAgICAgICAgbG9nRGVidWcoInVwZGF0ZUxpbWl0YXRpb25EYXRhYmFzZSBzdGFydD0iICsgc3RhcnRfcGFyYW0gKyAiLCBlbmQ9IiArIGVuZF9wYXJhbSArICIsZXZlbnRfaWQ9IiArIGV2ZW50X2lkKTsKCiAgICAgICAgZnVuY3Rpb24gdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uX2ZhaWx1cmUoKQogICAgICAgIHsKICAgICAgICAgIGNhbGVuZGFyID0gImNhbGVuZGFyX2hvdXJzX29mX3dvcmsiOwogICAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwogICAgICAgIH0KICAgICAgICAvLyBpZiB0aGUgZXZlbnQgdGhhdCBpcyBnZXR0aW5nIHVwZGF0ZWQgaXMgYW4gZXZlbnQgZnJvbSAxOTcwIChub3QgcGVyZGF5KQogICAgICAgIC8vIHRoZW4gd2UgYWRkIGEgbmV3IHBlcmRheSBsaW1pdGF0aW9uIHdpdGggbGltaXRfaWQgb2YgdGhlIDE5NzAgbGltaXRhdGlvbnMgLSB3aXRoIHRoZSBuZXcgdGltZXMuCgogICAgICAgIC8vIG90aGVyd2lzZSB3ZSBqdXN0IHVwZGF0ZSB0aGUgcGVyZGF5IGxpbWl0YXRpb24KCiAgICAgICAgaWYgKCRzY29wZS5maXhlZFNjaGVkdWxlKSAvLyBmaXhlZCBzY2hlZHVsZSB2cyBzcGVjaWZpYyB3ZWVkL2RheSBsaW1pdGF0aW9uCiAgICAgICAgewogICAgICAgICAgdGhlZGF0YSA9IHsKICAgICAgICAgICAgICBzdGFydF9kYXRlOiBzdGFydF9wYXJhbSwKICAgICAgICAgICAgICBlbmRfZGF0ZTogZW5kX3BhcmFtLAogICAgICAgICAgICAgIHRlbXBfbGltaXRfaWQ6IHRlbXBfbGltaXRfaWQsCiAgICAgICAgICAgICAgbGltaXRfaWQ6IGV2ZW50X2lkCiAgICAgICAgICB9OwoKICAgICAgICAgIHVwZGF0ZUNhbGVuZGFyTGltaXRhdGlvbigkaHR0cCwkc2NvcGUsdGhlZGF0YSxldmVudF9pZCwgbnVsbCwgdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uX2ZhaWx1cmUpOwogICAgICAgIH0KICAgICAgICBlbHNlIC8vIG5vdCBmaXhlZCBzY2hlZHVsZSAtIGRhaWx5L3dlZWtseSBsaW1pdGF0aW9ucwogICAgICAgIHsKICAgICAgICAgICAgaWYgKCh0aGVldmVudC5saW1pdF9pZCAhPSBudWxsKSAmICh0aGVldmVudC5kYXlfbGltaXRfaWQgPT0gLTEpKSAvLyBldmVudCBsaW1pdGF0aW9uIGhhcyBsaW1pdF9pZCBzbyBpdHMgYW4gMTk3MCBldmVudAogICAgICAgICAgICAvLyBuZWVkIHRvIGFkZCBhIG5ldyBwZXJkYXkgbGltaXRhdGlvbiB0aGF0IHBvaW50IChsaW1pdF9pZCkgdG8gdGhlIG9sZCAxOTcwIGV2ZW50IHRvIGNhbmNlbCBpdAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICB0ZW1wX2xpbWl0X2lkID0gY2FsY190ZW1wX2xpbWl0X2lkKCk7CiAgICAgICAgICAgICAgICB0aGVldmVudC50ZW1wX2xpbWl0X2lkID0gdGVtcF9saW1pdF9pZDsKICAgICAgICAgICAgICAgIHRoZWV2ZW50LmRheV9saW1pdF9pZCA9IHRlbXBfbGltaXRfaWQ7CiAgICAgICAgICAgICAgICAvLyB0aGUgbW92ZWQgZXZlbnQgaW4gdGhlIGNhbGVuZGFyIG5vdyBoYXMgZGF5X2xpbWl0X2lkIGFuZCB0ZW1wX2xpbWl0X2lkCiAgICAgICAgICAgICAgICAvLyBpZiBpdHMgbG9hZGVkIGZyb20gdGhlIGRiLCBpdCB3aWxsIG9ubHkgaGF2ZSBkYXlfbGltaXRfaWQgKGFuZCBub3QgdGhlIHRlbXAgb25lKQogICAgICAgICAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnXS5mdWxsQ2FsZW5kYXIoJ3VwZGF0ZUV2ZW50JywgdGhlZXZlbnQpOwogICAgICAgICAgICAgICAgY29uc29sZS5sb2coIlhYWFhYWFhYWFhYWFgiKTsKICAgICAgICAgICAgICAgIHRoZWRhdGEgPSB7CiAgICAgICAgICAgICAgICAgICAgc3RhcnRfZGF0ZTogc3RhcnRfcGFyYW0sCiAgICAgICAgICAgICAgICAgICAgZW5kX2RhdGU6IGVuZF9wYXJhbSwKICAgICAgICAgICAgICAgICAgICBjb2xvcjogdGhlZXZlbnQuY29sb3IsCiAgICAgICAgICAgICAgICAgICAgdGVtcF9saW1pdF9pZDogdGVtcF9saW1pdF9pZCwKICAgICAgICAgICAgICAgICAgICBldmVudF90eXBlX2lkOiB0aGVldmVudC5ldmVudF90eXBlX2lkLAogICAgICAgICAgICAgICAgICAgIGV2ZW50X3R5cGVzOiB0aGVldmVudC5ldmVudF90eXBlcywKICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbl9pZDogdGhlZXZlbnQubG9jYXRpb25faWQsCiAgICAgICAgICAgICAgICAgICAgZW1wX2lkOiB0aGVldmVudC5lbXBfaWQsCiAgICAgICAgICAgICAgICAgICAgbGltaXRfaWQ6IHRoZWV2ZW50LmlkLAogICAgICAgICAgICAgICAgICAgIHRpdGxlOiB0aGVldmVudC50aXRsZQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIGNyZWF0ZUNhbGVuZGFyTGltaXRhdGlvblBlckRheSgkaHR0cCwkc2NvcGUsdGhlZGF0YSxudWxsLCB1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25fZmFpbHVyZSk7CgogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgLy8gZXZlbnQgbGltaXRhdGlvbiB0byBtb3ZlL3VwZGF0ZSBoYXMgbm8gbGltaXRfaWQgLSBzbyB0aGlzIGlzIG5ldyBwZXJkYXkgZXZlbnQgLSB3ZSBqdXN0IHVwZGF0ZSBpdAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgdGhlZGF0YT0gewogICAgICAgICAgICAgICAgICBzdGFydF9kYXRlOiBzdGFydF9wYXJhbSwKICAgICAgICAgICAgICAgICAgZW5kX2RhdGU6IGVuZF9wYXJhbSwKICAgICAgICAgICAgICAgICAgdGVtcF9kYXlfbGltaXRfaWQ6IHRoZWV2ZW50LnRlbXBfbGltaXRfaWQsCiAgICAgICAgICAgICAgICAgIGxvY2F0aW9uX2lkOiB0aGVldmVudC5sb2NhdGlvbl9pZCwKICAgICAgICAgICAgICAgICAgZGF5X2xpbWl0X2lkOiB0aGVldmVudC5kYXlfbGltaXRfaWQKICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIHVwZGF0ZUNhbGVuZGFyTGltaXRhdGlvblBlckRheSgkaHR0cCwkc2NvcGUsdGhlZGF0YSxudWxsLCB1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25fZmFpbHVyZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Owp9KTsKCmt1emVBcHAuY29udHJvbGxlcignRXZlbnRDbGFzc1BhZ2VDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkdGltZW91dCwgJGh0dHAsICRyb290U2NvcGUsICRyb3V0ZVBhcmFtcywgJGxvY2F0aW9uLCAkcm91dGUsIHNoYXJlZERhdGEsICR1aWJNb2RhbCkKewogIGdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCk7CiAgZ2V0QWxsQ2xpZW50cygkaHR0cCwkc2NvcGUsJ2V2ZW50VHlwZVVzZXJzJyk7CiAgZ2V0QnVzaW5lc3NMb2NhdGlvbnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19sb2NhdGlvbnMnKTsKICBnZXRBbGxJbnN0cnVjdG9ycygkaHR0cCwkc2NvcGUsJ2luc3RydWN0b3JzJyk7CgogICRzY29wZS51cGRhdGVFdmVudFRpdGxlID0gZnVuY3Rpb24obmV3VmFsdWUsY3VycmVudEV2ZW50KQogIHsKICAgIG5ld190aXRsZT1uZXdWYWx1ZTsKICAgIHNldEV2ZW50VGl0bGUoJGh0dHAsJHNjb3BlLGN1cnJlbnRFdmVudC5ldmVudF9pZCwgbmV3X3RpdGxlLCB1cGRhdGVFdmVudF9jYWxsYmFjaywgdXBkYXRlRXZlbnRfY2FsbGJhY2spOwoKICAgIGZ1bmN0aW9uIHVwZGF0ZUV2ZW50X2NhbGxiYWNrKCkKICAgIHsKICAgICAgZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCk7CiAgICB9CgogIH07CgogICRzY29wZS51cGRhdGVFdmVudE1heFBhcnRpY2lwYW50cyA9IGZ1bmN0aW9uKG5ld1ZhbHVlLGN1cnJlbnRFdmVudCkKICB7CiAgICBuZXdfbWF4X3BhcnRpY2lwYW50cz1uZXdWYWx1ZTsKICAgIGlmICggbmV3X21heF9wYXJ0aWNpcGFudHMgPCBjdXJyZW50RXZlbnQubm9fb2ZfdXNlcnMgKXsKICAgICAgc2V0RXZlbnRNYXhQYXJ0aWNpcGFudHMoJGh0dHAsJHNjb3BlLGN1cnJlbnRFdmVudC5ldmVudF9pZCwgY3VycmVudEV2ZW50Lm5vX29mX3VzZXJzLCBjdXJyZW50RXZlbnQubm9fb2ZfdXNlcnMsIHVwZGF0ZUV2ZW50X2NhbGxiYWNrLCB1cGRhdGVFdmVudF9jYWxsYmFjayk7CiAgICB9IGVsc2UgewogICAgICBzZXRFdmVudE1heFBhcnRpY2lwYW50cygkaHR0cCwkc2NvcGUsY3VycmVudEV2ZW50LmV2ZW50X2lkLCBuZXdfbWF4X3BhcnRpY2lwYW50cywgY3VycmVudEV2ZW50Lm5vX29mX3VzZXJzLCB1cGRhdGVFdmVudF9jYWxsYmFjaywgdXBkYXRlRXZlbnRfY2FsbGJhY2spOwogICAgfQoKICAgIGZ1bmN0aW9uIHVwZGF0ZUV2ZW50X2NhbGxiYWNrKCkKICAgIHsKICAgICAgZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCk7CiAgICB9CgogIH07CgogICRzY29wZS51cGRhdGVVc2VyRXZlbnRQcmljZSA9IGZ1bmN0aW9uKG5ld3ZhbHVlLCB0aGVldmVudCwgZXVzZXIpCiAgewogICAgbmV3X3ByaWNlPW5ld3ZhbHVlOwogICAgc2V0Q2xpZW50RXZlbnRQcmljZSgkaHR0cCwkc2NvcGUsZXVzZXIuYnVzaW5lc3NfdXNlcl9pZCx0aGVldmVudC5ldmVudF9pZCwgbmV3X3ByaWNlLHNldENsaWVudEV2ZW50UHJpY2VfY2FsbGJhY2ssIHNldENsaWVudEV2ZW50UHJpY2VfY2FsbGJhY2spOwogICAgZnVuY3Rpb24gc2V0Q2xpZW50RXZlbnRQcmljZV9jYWxsYmFjaygpCiAgICB7CiAgICAgIGdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQpOwogICAgfQogIH07CgogICRzY29wZS51cGRhdGVMb2NhdGlvbkV2ZW50ID0gZnVuY3Rpb24oKQogIHsKICAgIGNvbnNvbGUubG9nKCJmdW5jdGlvbjogdXBkYXRlTG9jYXRpb25FdmVudCIpOwogICAgdXBkYXRlRXZlbnRMb2NhdGlvbigkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLCRzY29wZS5jdXJyZW50RXZlbnQubG9jYXRpb25faWQsdXBkYXRlRXZlbnRMb2NhdGlvbl9jYWxsYmFjaywgdXBkYXRlRXZlbnRMb2NhdGlvbl9jYWxsYmFjayk7CiAgICAkc2NvcGUudXBkYXRlTG9jYXRpb25BbGVydE1lc3NhZ2U9Itee16LXk9eb158g16HXmNeY15XXoS4uLiI7CiAgICBmdW5jdGlvbiB1cGRhdGVFdmVudExvY2F0aW9uX2NhbGxiYWNrKCkKICAgIHsKICAgICAgJHNjb3BlLnVwZGF0ZUxvY2F0aW9uQWxlcnRNZXNzYWdlPSLXoteV15PXm9efINeR15TXptec15fXlCEiOwogICAgICAkdGltZW91dChmdW5jdGlvbigpCiAgICAgIHsKICAgICAgICAkc2NvcGUudXBkYXRlTG9jYXRpb25BbGVydE1lc3NhZ2U9bnVsbDsKICAgICAgfSwgMTUwMCk7CiAgICB9CiAgfTsKCiAgJHNjb3BlLnVwZGF0ZUluc3RydWN0b3JDbGFzc0V2ZW50ID0gZnVuY3Rpb24oKQogIHsKICAgIGNvbnNvbGUubG9nKCJmdW5jdGlvbjogdXBkYXRlSW5zdHJ1Y3RvckNsYXNzRXZlbnQiKTsKICAgIHVwZGF0ZUV2ZW50SW5zdHJ1Y3RvcigkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLCRzY29wZS5jdXJyZW50RXZlbnQuaW5zdHJ1Y3Rvcl9pZCx1cGRhdGVFdmVudEluc3RydWN0b3JfY2FsbGJhY2ssIHVwZGF0ZUV2ZW50SW5zdHJ1Y3Rvcl9jYWxsYmFjayk7CiAgICAkc2NvcGUudXBkYXRlSW5zdHJ1Y3RvckFsZXJ0TWVzc2FnZT0i157XoteT15vXnyDXodeY15jXldehLi4uIjsKICAgIGZ1bmN0aW9uIHVwZGF0ZUV2ZW50SW5zdHJ1Y3Rvcl9jYWxsYmFjaygpCiAgICB7CiAgICAgICRzY29wZS51cGRhdGVJbnN0cnVjdG9yQWxlcnRNZXNzYWdlPSLXoteV15PXm9efINeR15TXptec15fXlCEiOwogICAgICAkdGltZW91dChmdW5jdGlvbigpCiAgICAgIHsKICAgICAgICAkc2NvcGUudXBkYXRlSW5zdHJ1Y3RvckFsZXJ0TWVzc2FnZT1udWxsOwogICAgICB9LCAxNTAwKTsKICAgIH0KICB9CgoKICAkc2NvcGUuYWN0aXZhdGVFdmVudENsYXNzID0gZnVuY3Rpb24oKQogIHsKICAgIHsKICAgICAgbG9nRGVidWcoInJlb3BlbkV2ZW50Iik7CiAgICAgIHJlb3BlbkV2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkLCRzY29wZS5zZWxlY3RlZEV2ZW50LGFmdGVyUmVvcGVuRXZlbnQsYWZ0ZXJSZW9wZW5FdmVudCk7CiAgICAgIGZ1bmN0aW9uIGFmdGVyUmVvcGVuRXZlbnQoKQogICAgICB7CiAgICAgICAgZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCk7CiAgICAgIH07CiAgICB9CiAgfQoKICAvLyBjbG9zZSBldmVudCBjbGFzcwogICRzY29wZS5jbG9zZUV2ZW50Q2xhc3MgPSBmdW5jdGlvbigpIHsKICAgICAgbG9nRGVidWcoImV2ZW50IGNyZWF0ZSBtb2RhbCIpOwoKICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgICAgICAgICBhbmltYXRpb246IGZhbHNlLAogICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfZXZlbnRfY2xhc3NfY2xvc2UucGhwJywKICAgICAgICAgIHNpemU6ICd4cycsCiAgICAgICAgICBjb250cm9sbGVyOiAnY2xhc3NDbG9zZU1vZGFsQ29udHJvbGxlcicsCiAgICAgICAgICByZXNvbHZlOiB7CiAgICAgICAgICAgICAgZXZlbnRfaWQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZDsKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgIH0pOwogIH07CgogIC8vIGRlbGV0ZSByZXBlYXRpbmcvY2xhc3MgZXZlbnQKICAkc2NvcGUuZGVsZXRlQ2xhc3NFdmVudCA9IGZ1bmN0aW9uKCkKICB7CiAgICBpZiAoJHNjb3BlLmN1cnJlbnRFdmVudC5pc19yZXBlYXRpbmc9PTApCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJjbGFzcyBldmVudCBub3QgcmVwZWF0aW5nIik7CiAgICAgICRzY29wZS5kZWxldGVDbGFzc0V2ZW50U2luZ2xlKCk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJjbGFzcyBldmVudCBpcyByZXBlYXRpbmciKTsKICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgICAgICAgICBhbmltYXRpb246IGZhbHNlLAogICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfcmVwZWF0aW5nX2V2ZW50X2RlbGV0ZV9hbGwucGhwJywKICAgICAgICAgIHNpemU6ICd4cycsCiAgICAgICAgICBjb250cm9sbGVyOiAnY2xhc3NEZWxldGVBbGxNb2RhbENvbnRyb2xsZXInLAogICAgICAgICAgcmVzb2x2ZTogewogICAgICAgICAgICAgIGN1cnJlbnRFdmVudDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuY3VycmVudEV2ZW50OwogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfTsKCiAgJHNjb3BlLmRlbGV0ZUNsYXNzRXZlbnRTaW5nbGU9ZnVuY3Rpb24gKCkgLy8gZGVsZXRlIG9ubHkgb25lL2N1cnJlbnQgY2xhc3MgZXZlaHQKICB7CiAgICBjYW5jZWxDbGFzc0V2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkLGNhbmNlbENsYXNzRXZlbnRfY2FsbGJhY2ssIGNhbmNlbENsYXNzRXZlbnRfY2FsbGJhY2spOwogICAgZnVuY3Rpb24gY2FuY2VsQ2xhc3NFdmVudF9jYWxsYmFjaygpCiAgICB7CiAgICAgIGdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQpOwogICAgfQogIH0KCiAgJHNjb3BlLiRvbigicmVsb2FkRXZlbnQiLGZ1bmN0aW9uKGUsYSl7CiAgICAgICAvLyBQb3N0IHlvdXIgY29kZQogICBsb2dEZWJ1ZygiYnJvYWRjYXN0ZWQgLSByZWxvYWRpbmcgZXZlbnQgIithLmV2ZW50X2lkKTsKICAgZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkKTsKfSk7CgogIC8vIHJlbW92ZSBlbmQgdXNlciBmcm9tIGV2ZW50CiAgJHNjb3BlLmV2ZW50UmVtb3ZlRW5kVXNlciA9IGZ1bmN0aW9uKGVuZHVzZXJfaWQpCiAgewogICAgY29uc29sZS5sb2coImV2ZW50UmVtb3ZlRW5kVXNlciIpOwogICAgcmVtb3ZlRW5kVXNlckZyb21FdmVudCgkaHR0cCwkc2NvcGUsZW5kdXNlcl9pZCwkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkLHJlbW92ZUVuZFVzZXJGcm9tRXZlbnRfZmluaXNoLCByZW1vdmVFbmRVc2VyRnJvbUV2ZW50X2ZpbmlzaCk7CiAgICBmdW5jdGlvbiByZW1vdmVFbmRVc2VyRnJvbUV2ZW50X2ZpbmlzaCgpCiAgICB7CiAgICAgIGdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCk7CiAgICB9CiAgfTsKCiAgJHNjb3BlLmV2ZW50Q2xpZW50U2VsZWN0ZWQgPSBmdW5jdGlvbihzZWxlY3RlZCkgewogICAgICBpZiAoc2VsZWN0ZWQpIHsKICAgICAgICAgIC8vIGFsZXJ0KEpTT04uc3RyaW5naWZ5KCBzZWxlY3RlZCwgbnVsbCwgMiApKTsKICAgICAgICAgIGxvZ0RlYnVnKCdldmVudENsaWVudFNlbGVjdGVkMiB5ZXMgc2VsZWN0ZWQgJyArIHNlbGVjdGVkLm9yaWdpbmFsT2JqZWN0LmZpcnN0X25hbWUpOwogICAgICAgICAgJHNjb3BlLmV2ZW50QWRkRW5kVXNlcihzZWxlY3RlZC5vcmlnaW5hbE9iamVjdC5idXNpbmVzc191c2VyX2lkKTsKICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnYW5ndWNvbXBsZXRlLWFsdDpjbGVhcklucHV0JywgJ2NsaWVudF9hbmd1Y29tcGxldGUnKTsKCiAgICAgIH0gZWxzZSB7CiAgICAgICAgICBsb2dEZWJ1Zygnbm90IHNlbGVjdGVkJyk7CiAgICAgIH0KICB9OwoKICAkc2NvcGUuZXZlbnRBZGRFbmRVc2VyID0gZnVuY3Rpb24oZW5kdXNlcl9pZCkKICB7CiAgICBhZGRFbmRVc2VyVG9FdmVudCgkaHR0cCwkc2NvcGUsZW5kdXNlcl9pZCwkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkLGFkZEVuZFVzZXJUb0V2ZW50X2ZpbmlzaCwgYWRkRW5kVXNlclRvRXZlbnRfZmluaXNoKTsKICAgIGZ1bmN0aW9uIGFkZEVuZFVzZXJUb0V2ZW50X2ZpbmlzaCgpCiAgICB7CiAgICAgIGdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCk7CiAgICB9CiAgfTsKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ0V2ZW50UGFnZUNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICR0aW1lb3V0LCAkaHR0cCwgJHVpYk1vZGFsICxzaGFyZWRQcm9wZXJ0aWVzLCAkcm91dGVQYXJhbXMsICRyb290U2NvcGUsICRsb2NhdGlvbiwgJHJvdXRlLCBzaGFyZWREYXRhKQp7CiAgbG9nRGVidWcoIkV2ZW50UGFnZUNvbnRyb2xsZXIiKTsKCiAgZ2V0QWxsSW5zdHJ1Y3RvcnNJbmNJbmFjdGl2ZSgkaHR0cCwkc2NvcGUsJ2luc3RydWN0b3JzJyxnZXRBbGxJbnN0cnVjdG9yc0luY0luYWN0aXZlX3N1Y2Nlc3MpOwogIGdldEJ1c2luZXNzTG9jYXRpb25zKCRodHRwLCRzY29wZSwnYnVzaW5lc3NfbG9jYXRpb25zJyk7CgogIGZ1bmN0aW9uIGdldEFsbEluc3RydWN0b3JzSW5jSW5hY3RpdmVfc3VjY2VzcygpCiAgewogICAgZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLHNldFBhcnRpY2lwYXRlZCk7CiAgfQoKICAkc2NvcGUuZXh0cmFGaWVsZHNBbGVydE1lc3NhZ2U9bnVsbDsKCiAgJHNjb3BlLnVwZGF0ZUV2ZW50VGl0bGUgPSBmdW5jdGlvbihuZXdWYWx1ZSxjdXJyZW50RXZlbnQpCiAgewogICAgbmV3X3RpdGxlPW5ld1ZhbHVlOwogICAgc2V0RXZlbnRUaXRsZSgkaHR0cCwkc2NvcGUsY3VycmVudEV2ZW50LmV2ZW50X2lkLCBuZXdfdGl0bGUsIHVwZGF0ZUV2ZW50X2NhbGxiYWNrLCB1cGRhdGVFdmVudF9jYWxsYmFjayk7CgogICAgZnVuY3Rpb24gdXBkYXRlRXZlbnRfY2FsbGJhY2soKQogICAgewogICAgICBnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkKTsKICAgIH0KCiAgfTsKCgogICRzY29wZS51cGRhdGVFdmVudEV4dHJhRmllbGRzID0gZnVuY3Rpb24oKQogIHsKICAgIGxvZ0RlYnVnKCJ1cGRhdGVFdmVudEV4dHJhRmllbGRzIik7CiAgICB0aGVkYXRhID0gewogICAgICAgZXh0cmFGaWVsZHM6JHNjb3BlLmN1cnJlbnRFdmVudC5leHRyYUZpZWxkcwogICAgICB9OwogICAgJHNjb3BlLmV4dHJhRmllbGRzQWxlcnRNZXNzYWdlPSLXntei15PXm9efINeg16rXldeg15nXnSwg15DXoNeQINeU157XqtefLi4uIjsKICAgIHVwZGF0ZUV2ZW50RXh0cmFGaWVsZHMoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCx0aGVkYXRhLHVwZGF0ZUV2ZW50RXh0cmFGaWVsZHNfY2FsbGJhY2ssIHVwZGF0ZUV2ZW50RXh0cmFGaWVsZHNfY2FsbGJhY2spOwoKICAgIGZ1bmN0aW9uIHVwZGF0ZUV2ZW50RXh0cmFGaWVsZHNfY2FsbGJhY2soKQogICAgewogICAgICBnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkcm91dGVQYXJhbXMuZXZlbnRfaWQsc2V0UGFydGljaXBhdGVkKTsKICAgICAgJHNjb3BlLmV4dHJhRmllbGRzQWxlcnRNZXNzYWdlPSLXqteZ16LXldeTINeg16nXnteoINeR15TXptec15fXlCEiOwogICAgICAkdGltZW91dChmdW5jdGlvbigpCiAgICAgIHsKICAgICAgICAkc2NvcGUuZXh0cmFGaWVsZHNBbGVydE1lc3NhZ2U9bnVsbDsKICAgICAgfSwgMzAwMCk7CiAgICB9CiAgfTsKCiAgJHNjb3BlLnJlc2NoZWR1bGVFdmVudCA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1Zygic2VldGluZyBldmVudCB0byBtb3ZlICAiKyRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXSk7CiAgICBzaGFyZWRQcm9wZXJ0aWVzLnNldF9ldmVudF9yZXNjaGVkdWxlKCRzY29wZS5jdXJyZW50RXZlbnQpOwogICAgLy8gdXNlcl9pbmZvPSB7CiAgICAvLyAgICAgdXNlcl9pZDogJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudFVzZXJzWzBdLnVzZXJfaWQsCiAgICAvLyAgICAgYnVzZXJfZmlyc3RfbmFtZTogJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudFVzZXJzWzBdLmJ1c2VyX2ZpcnN0X25hbWUsCiAgICAvLyAgICAgYnVzZXJfbGFzdF9uYW1lOiAkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfbGFzdF9uYW1lCiAgICAvLyB9OwogICAgLy8gc2hhcmVkUHJvcGVydGllcy5zZXRfc2VsZWN0ZWRfdXNlcih1c2VyX2luZm8pOwogICAgJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jYWxlbmRhcicpOwogIH0KCiAgJHNjb3BlLnVwZGF0ZUxvY2F0aW9uRXZlbnQgPSBmdW5jdGlvbigpCiAgewogICAgY29uc29sZS5sb2coImZ1bmN0aW9uOiB1cGRhdGVMb2NhdGlvbkV2ZW50Iik7CiAgICB1cGRhdGVFdmVudExvY2F0aW9uKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuZXZlbnRfaWQsJHNjb3BlLmN1cnJlbnRFdmVudC5sb2NhdGlvbl9pZCx1cGRhdGVFdmVudExvY2F0aW9uX2NhbGxiYWNrLCB1cGRhdGVFdmVudExvY2F0aW9uX2NhbGxiYWNrKTsKICAgICRzY29wZS51cGRhdGVMb2NhdGlvbkFsZXJ0TWVzc2FnZT0i157XoteT15vXnyDXodeY15jXldehLi4uIjsKICAgIGZ1bmN0aW9uIHVwZGF0ZUV2ZW50TG9jYXRpb25fY2FsbGJhY2soKQogICAgewogICAgICAkc2NvcGUudXBkYXRlTG9jYXRpb25BbGVydE1lc3NhZ2U9Itei15XXk9eb158g15HXlNem15zXl9eUISI7CiAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkKICAgICAgewogICAgICAgICRzY29wZS51cGRhdGVMb2NhdGlvbkFsZXJ0TWVzc2FnZT1udWxsOwogICAgICB9LCAxNTAwKTsKICAgIH0KICB9OwoKICAkc2NvcGUudXBkYXRlSW5zdHJ1Y3RvckV2ZW50ID0gZnVuY3Rpb24oKQogIHsKICAgIGNvbnNvbGUubG9nKCJmdW5jdGlvbjogdXBkYXRlSW5zdHJ1Y3RvckV2ZW50Iik7CiAgICB1cGRhdGVFdmVudEluc3RydWN0b3IoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCwkc2NvcGUuY3VycmVudEV2ZW50Lmluc3RydWN0b3JfaWQsdXBkYXRlRXZlbnRJbnN0cnVjdG9yX2NhbGxiYWNrLCB1cGRhdGVFdmVudEluc3RydWN0b3JfY2FsbGJhY2spOwogICAgJHNjb3BlLnVwZGF0ZUluc3RydWN0b3JBbGVydE1lc3NhZ2U9Itee16LXk9eb158g16HXmNeY15XXoS4uLiI7CiAgICBmdW5jdGlvbiB1cGRhdGVFdmVudEluc3RydWN0b3JfY2FsbGJhY2soKQogICAgewogICAgICAkc2NvcGUudXBkYXRlSW5zdHJ1Y3RvckFsZXJ0TWVzc2FnZT0i16LXldeT15vXnyDXkdeU16bXnNeX15QhIjsKICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKQogICAgICB7CiAgICAgICAgJHNjb3BlLnVwZGF0ZUluc3RydWN0b3JBbGVydE1lc3NhZ2U9bnVsbDsKICAgICAgfSwgMTUwMCk7CiAgICB9CiAgfTsKCiAgJHNjb3BlLmluaXRpYXRlUGF5bWVudCA9IGZ1bmN0aW9uKGlzcGx1cykKICB7CiAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAgICAgICBhbmltYXRpb246IGZhbHNlLAogICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2NsaWVudF9wYXltZW50LnBocCcsCiAgICAgICAgY29udHJvbGxlcjogJ2J1c2luZXNzQ2xpZW5kQ2FyZFBheW1lbnQnLAogICAgICAgIC8vIHNpemU6IHNpemUsCiAgICAgICAgcmVzb2x2ZTogewogICAgICAgICAgY3VycmVudENsaWVudDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgcmV0dXJuICRzY29wZS5jdXJyZW50RXZlbnRDbGllbnRzWzBdOwogICAgICAgICAgfSwKICAgICAgICAgIGlzcGx1czogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGlzcGx1czsKICAgICAgICAgIH0KICAgICAgICB9CiAgICB9KTsKICB9CgogICRzY29wZS5kZWxldGVFdmVudD1mdW5jdGlvbiAoKQogIHsKICAgIC8vIGNoZWNraW5nIGlmIGNhbmNlbGluZyBhIGdlbmVyY190eXBlIGV2ZW50IC0gdGhlbiB0aGVyZSdzIG5vIHVzZXIKICAgIGlmICgkc2NvcGUuY3VycmVudEV2ZW50LmlzX2dlbmVyaWNfZXR5cGU9PTEpCiAgICB7CiAgICAgIGNhbmNlbFNpbmdsZUV2ZW50KCRodHRwLCRzY29wZSwwLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCxjYW5jZWxTaW5nbGVFdmVudF9jYWxsYmFjaywgY2FuY2VsU2luZ2xlRXZlbnRfY2FsbGJhY2spOwogICAgfQogICAgZWxzZQogICAgewogICAgICBjYW5jZWxTaW5nbGVFdmVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudFVzZXJzWzBdLmJ1c2luZXNzX3VzZXJfaWQsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLGNhbmNlbFNpbmdsZUV2ZW50X2NhbGxiYWNrLCBjYW5jZWxTaW5nbGVFdmVudF9jYWxsYmFjayk7CiAgICB9CiAgICBmdW5jdGlvbiBjYW5jZWxTaW5nbGVFdmVudF9jYWxsYmFjaygpCiAgICB7CiAgICAgIGdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCxzZXRQYXJ0aWNpcGF0ZWQpOwogICAgfQogIH0KCiAgJHNjb3BlLnNldFBhcnRpY2lwYXRpb25TdGF0dXMgPSBmdW5jdGlvbigpCiAgewogICAgc2V0RXZlbnRVc2VyUGFydGljaXBhdGlvblN0YXR1cygkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRVc2Vyc1swXS5idXNpbmVzc191c2VyX2lkLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRVc2Vyc1swXS5ldmVudF91c2VyX3N0YXR1c19pZCxzZXRQYXJ0aWNpcGF0aW9uU3RhdHVzX2NhbGxiYWNrLCBzZXRQYXJ0aWNpcGF0aW9uU3RhdHVzX2NhbGxiYWNrKTsKICAgICRzY29wZS51cGRhdGVTdGF0dXNBbGVydE1lc3NhZ2U9Itee16LXk9eb158g16HXmNeY15XXoS4uLiI7CiAgICBmdW5jdGlvbiBzZXRQYXJ0aWNpcGF0aW9uU3RhdHVzX2NhbGxiYWNrKCkKICAgIHsKICAgICAgLy8gZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLHNldFBhcnRpY2lwYXRlZCk7CiAgICAgIHNldFBhcnRpY2lwYXRlZCgpOwogICAgICAkc2NvcGUudXBkYXRlU3RhdHVzQWxlcnRNZXNzYWdlPSLXoteV15PXm9efINeR15TXptec15fXlCEiOwogICAgICAkdGltZW91dChmdW5jdGlvbigpCiAgICAgIHsKICAgICAgICAkc2NvcGUudXBkYXRlU3RhdHVzQWxlcnRNZXNzYWdlPW51bGw7CiAgICAgIH0sIDI1MDApOwogICAgfQogIH0KCiAgZnVuY3Rpb24gc2V0UGFydGljaXBhdGVkKCkKICB7CiAgICBsb2dEZWJ1ZygiZ2V0IGNsaWVudCBpbmZvIik7CiAgICBnZXRCdXNpbmVzc0NsaWVudEluZm8oJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnRDbGllbnRzJywkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50VXNlcnNbMF0uYnVzaW5lc3NfdXNlcl9pZCk7CiAgICBsb2dEZWJ1Zygic2V0dGluZyBzZXRQYXJ0aWNpcGF0ZWQiKTsKICAgIGlmICgkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50VXNlcnNbMF0uc3RhdHVzX25hbWUhPSRnVXNlcl9zdGF0dXNfYWJzZW50ZWQpCiAgICB7CiAgICAgICRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRVc2Vyc1swXS5wYXJ0aWNpcGF0ZWQ9dHJ1ZTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudFVzZXJzWzBdLnBhcnRpY2lwYXRlZD1mYWxzZTsKICAgIH0KCiAgICAvLyB0aGlzIGxvb3AgaXMgZm9yIGZpeGluZyB0aGUgZGF0ZSBmb3JtYXQgdG8gYXBwZWFyIHByb3Blcmx5IGluIHRoZSBpbnB1dCBkYXRlIGh0bWwgb2JqZWN0CiAgICBmb3IgKGkgPSAwOyBpPCAoJHNjb3BlLmN1cnJlbnRFdmVudC5leHRyYUZpZWxkcykubGVuZ3RoOyBpKyspCiAgICB7CiAgICAgIGxvZ0RlYnVnKCRzY29wZS5jdXJyZW50RXZlbnQuZXh0cmFGaWVsZHNbaV0pOwogICAgICBpZiAoJHNjb3BlLmN1cnJlbnRFdmVudC5leHRyYUZpZWxkc1tpXS5maWVsZF9kYXRhdHlwZT09IkRBVEUiKQogICAgICB7CiAgICAgICAgLy8gbG9nRGVidWcoImRhdGUiKTsKICAgICAgICAkc2NvcGUuY3VycmVudEV2ZW50LmV4dHJhRmllbGRzW2ldLmZpZWxkX3ZhbHVlPW5ldyBEYXRlKCRzY29wZS5jdXJyZW50RXZlbnQuZXh0cmFGaWVsZHNbaV0uZmllbGRfdmFsdWUpOwogICAgICB9CiAgICB9CgogICAgbG9nRGVidWcoIiRzY29wZS5jdXJyZW50RXZlbnQuaW5zdHJ1Y3Rvcl9pZDs9Iiskc2NvcGUuY3VycmVudEV2ZW50Lmluc3RydWN0b3JfaWQpOwogICAgZm9yKHZhciBpID0gMDsgaSA8ICRzY29wZS5pbnN0cnVjdG9ycy5sZW5ndGg7IGkrKykKICAgIHsKICAgICAgbG9nRGVidWcoJHNjb3BlLmluc3RydWN0b3JzW2ldLmlzX2FjdGl2ZSk7CiAgICAgIGlmICgkc2NvcGUuaW5zdHJ1Y3RvcnNbaV0uYnVzaW5lc3NfdXNlcl9pZD09JHNjb3BlLmN1cnJlbnRFdmVudC5pbnN0cnVjdG9yX2lkKQogICAgICB7CiAgICAgICAgbG9nRGVidWcoInllc2giKTsKICAgICAgICAkc2NvcGUuaW5zdHJ1Y3RvcnNbaV0uaXNfYWN0aXZlPTE7CiAgICAgIH0KICAgIH0KICB9CgogICRzY29wZS51cGRhdGVVc2VyRXZlbnRQcmljZSA9IGZ1bmN0aW9uKG5ld3ZhbHVlLCB0aGVldmVudCkKICB7CiAgICBuZXdfcHJpY2U9bmV3dmFsdWU7CiAgICBzZXRDbGllbnRFdmVudFByaWNlKCRodHRwLCRzY29wZSwkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50VXNlcnNbMF0uYnVzaW5lc3NfdXNlcl9pZCx0aGVldmVudC5ldmVudF9pZCwgbmV3X3ByaWNlLHNldENsaWVudEV2ZW50UHJpY2VfY2FsbGJhY2ssIHNldENsaWVudEV2ZW50UHJpY2VfY2FsbGJhY2spOwogICAgZnVuY3Rpb24gc2V0Q2xpZW50RXZlbnRQcmljZV9jYWxsYmFjaygpCiAgICB7CiAgICAgIGdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCxzZXRQYXJ0aWNpcGF0ZWQpOwogICAgfQogIH07CgogICRzY29wZS4kb24oImV2ZW50UGFnZVJlbG9hZERhdGEiLGZ1bmN0aW9uKGUsYSkKICB7CiAgICBnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkcm91dGVQYXJhbXMuZXZlbnRfaWQsc2V0UGFydGljaXBhdGVkKTsKICB9KTsKCiAgJHNjb3BlLmNsb3NlRXZlbnQgPSBmdW5jdGlvbigpCiAgewogICAgbG9nRGVidWcoImNoZWNraW5nIGlmIGV2ZW50IGhhcyBleHRyYSBmaWVsZHMgdGhhdCBhcmUgcmVxdWlyZWQgYmVmb3JlIGNsb3NpbmcgaXQiKTsKICAgIGNoZWNrRXZlbnRFeHRyYUZpZWxkcygkaHR0cCwkc2NvcGUsJ2NoZWNrRXZlbnRFeHRyYUZpZWxkcycsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLGNoZWNrRXZlbnRFeHRyYUZpZWxkc19zdWNjZXNzKTsKICAgIGZ1bmN0aW9uIGNoZWNrRXZlbnRFeHRyYUZpZWxkc19zdWNjZXNzKCkKICAgIHsKICAgICAgaWYgKCRzY29wZS5jaGVja0V2ZW50RXh0cmFGaWVsZHM9PXRydWUpCiAgICAgIHsKICAgICAgICBsb2dEZWJ1ZygiZXZlbnQgaGFzIGFsbCBleHRyYSBmaWVsZHMgb2ssIGNsb3NpbmcgZXZlbnQiKTsKICAgICAgICAvLyAkc2NvcGUuY3VycmVudEV2ZW50Lmlnbm9yZUV4dHJhRmllbGRzVmFsaWRhdGlvbj10cnVlOwogICAgICAgIGNsb3NlRXZlbnQoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCwkc2NvcGUuY3VycmVudEV2ZW50LGFmdGVyQ2xvc2VFdmVudCxhZnRlckNsb3NlRXZlbnQpOwogICAgICAgIGZ1bmN0aW9uIGFmdGVyQ2xvc2VFdmVudCgpCiAgICAgICAgewogICAgICAgICAgZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLHNldFBhcnRpY2lwYXRlZCk7CiAgICAgICAgfTsKICAgICAgfQogICAgICBlbHNlCiAgICAgIHsKICAgICAgICBsb2dEZWJ1ZygiZXZlbnQgaGFzIGV4dHJhIGZpZWxkcyByZXF1aXJlZCB0aGF0IGFyZSBub3QgZmlsbGVkIik7CiAgICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgICAgICAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2V2ZW50X2Nsb3NlX2lnbm9yZV9tYW5kYXRvcnlfZmllbGRzLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdldmVudENsb3NlSWdub3JlTWFuZGF0b3J5RmllbGRzTW9kYWxDb250cm9sbGVyJywKICAgICAgICAgICAgc2l6ZTogJ20nLAogICAgICAgICAgICByZXNvbHZlOiB7CiAgICAgICAgICAgICAgICBjdXJyZW50RXZlbnQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuY3VycmVudEV2ZW50OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICB9CiAgJHNjb3BlLnJlb3BlbkV2ZW50ID0gZnVuY3Rpb24oKQogIHsKICAgIGxvZ0RlYnVnKCJyZW9wZW5FdmVudCIpOwogICAgcmVvcGVuRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQsJHNjb3BlLmN1cnJlbnRFdmVudCxhZnRlclJlb3BlbkV2ZW50LGFmdGVyUmVvcGVuRXZlbnQpOwogICAgZnVuY3Rpb24gYWZ0ZXJSZW9wZW5FdmVudCgpCiAgICB7CiAgICAgIGdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQsc2V0UGFydGljaXBhdGVkKTsKICAgIH07CiAgfQoKfSk7CgprdXplQXBwLmZpbHRlcignc3RhcnRGcm9tJywgZnVuY3Rpb24oKQp7CiAgICByZXR1cm4gZnVuY3Rpb24oaW5wdXQsIHN0YXJ0KQogICAgewogICAgICAgaWYoIWlucHV0KSByZXR1cm4gW107CiAgICAgICAgLy8gY29uc29sZS5sb2coImhlcmVyZWVlICIraW5wdXQpOwogICAgICAgIHN0YXJ0ID0gK3N0YXJ0OyAvL3BhcnNlIHRvIGludAogICAgICAgIHJldHVybiBpbnB1dC5zbGljZShzdGFydCk7CiAgICB9Cn0pOwovLyBhbmd1bGFyIGZpbHRlciBmb3IgZXZlbnRzIGJlZm9yZS9hZnRlciB0b2RheQprdXplQXBwLmZpbHRlcignYmVmb3JlTm93JywgZnVuY3Rpb24oKSB7CiAgLy8gQ3JlYXRlIHRoZSByZXR1cm4gZnVuY3Rpb24gYW5kIHNldCB0aGUgcmVxdWlyZWQgcGFyYW1ldGVyIG5hbWUgdG8gKippbnB1dCoqCiByZXR1cm4gZnVuY3Rpb24oaW5wdXQpIHsKICAgdmFyIG91dCA9IFtdOwoKICAgLy8gVXNpbmcgdGhlIGFuZ3VsYXIuZm9yRWFjaCBtZXRob2QsIGdvIHRocm91Z2ggdGhlIGFycmF5IG9mIGRhdGEgYW5kIHBlcmZvcm0gdGhlIG9wZXJhdGlvbiBvZiBmaWd1cmluZyBvdXQgaWYgdGhlIGxhbmd1YWdlIGlzIHN0YXRpY2FsbHkgb3IgZHluYW1pY2FsbHkgdHlwZWQuCiAgIHZhciBicm93c2VyX2Vwb2NoID0gKG5ldyBEYXRlKS5nZXRUaW1lKCk7CgogICBhbmd1bGFyLmZvckVhY2goaW5wdXQsIGZ1bmN0aW9uKGV2ZW50KQogICB7CiAgICAvLyAgbG9nRGVidWcoImZpbHRlcmluZywgZXZlbnQuZXZlbnRfdXNlcl9zdGF0dXNfaWQ9IitldmVudC5ldmVudF91c2VyX3N0YXR1c19pZCk7CiAgICAgaWYgKGV2ZW50LnN0YXJ0X2Vwb2NoIDw9IChicm93c2VyX2Vwb2NoLzEwMDApKQogICAgIHsKICAgICAgIG91dC5wdXNoKGV2ZW50KQogICAgIH0KICAgfSkKICAgcmV0dXJuIG91dDsKIH0KfSk7Cmt1emVBcHAuZmlsdGVyKCdhZnRlck5vdycsIGZ1bmN0aW9uKCkgewogIC8vIENyZWF0ZSB0aGUgcmV0dXJuIGZ1bmN0aW9uIGFuZCBzZXQgdGhlIHJlcXVpcmVkIHBhcmFtZXRlciBuYW1lIHRvICoqaW5wdXQqKgogcmV0dXJuIGZ1bmN0aW9uKGlucHV0KSB7CiAgIHZhciBvdXQgPSBbXTsKCiAgIC8vIFVzaW5nIHRoZSBhbmd1bGFyLmZvckVhY2ggbWV0aG9kLCBnbyB0aHJvdWdoIHRoZSBhcnJheSBvZiBkYXRhIGFuZCBwZXJmb3JtIHRoZSBvcGVyYXRpb24gb2YgZmlndXJpbmcgb3V0IGlmIHRoZSBsYW5ndWFnZSBpcyBzdGF0aWNhbGx5IG9yIGR5bmFtaWNhbGx5IHR5cGVkLgogICB2YXIgYnJvd3Nlcl9lcG9jaCA9IChuZXcgRGF0ZSkuZ2V0VGltZSgpOwoKICAgYW5ndWxhci5mb3JFYWNoKGlucHV0LCBmdW5jdGlvbihldmVudCkKICAgewogICAgLy8gIGxvZ0RlYnVnKCJmaWx0ZXJpbmcsIGV2ZW50LmV2ZW50X3VzZXJfc3RhdHVzX2lkPSIrZXZlbnQuZXZlbnRfdXNlcl9zdGF0dXNfaWQpOwogICAgIGlmIChldmVudC5zdGFydF9lcG9jaCA+IChicm93c2VyX2Vwb2NoLzEwMDApKQogICAgIHsKICAgICAgIG91dC5wdXNoKGV2ZW50KQogICAgIH0KICAgfSkKICAgcmV0dXJuIG91dDsKIH0KfSk7CgprdXplQXBwLmZpbHRlcignaXNBY3RpdmUnLCBmdW5jdGlvbigpIHsKICAvLyBDcmVhdGUgdGhlIHJldHVybiBmdW5jdGlvbiBhbmQgc2V0IHRoZSByZXF1aXJlZCBwYXJhbWV0ZXIgbmFtZSB0byAqKmlucHV0KioKIHJldHVybiBmdW5jdGlvbihpbnB1dCkgewogICB2YXIgb3V0ID0gW107CgogICAvLyBVc2luZyB0aGUgYW5ndWxhci5mb3JFYWNoIG1ldGhvZCwgZ28gdGhyb3VnaCB0aGUgYXJyYXkgb2YgZGF0YSBhbmQgcGVyZm9ybSB0aGUgb3BlcmF0aW9uIG9mIGZpZ3VyaW5nIG91dCBpZiB0aGUgbGFuZ3VhZ2UgaXMgc3RhdGljYWxseSBvciBkeW5hbWljYWxseSB0eXBlZC4KCiAgIGFuZ3VsYXIuZm9yRWFjaChpbnB1dCwgZnVuY3Rpb24oZXZlbnQpCiAgIHsKICAgIC8vICBsb2dEZWJ1ZygiZmlsdGVyaW5nLCBldmVudC5ldmVudF91c2VyX3N0YXR1c19pZD0iK2V2ZW50LmV2ZW50X3VzZXJfc3RhdHVzX2lkKTsKICAgICBpZiAoZXZlbnQuaXNfYWN0aXZlPT0xKQogICAgIHsKICAgICAgIG91dC5wdXNoKGV2ZW50KQogICAgIH0KICAgfSkKICAgcmV0dXJuIG91dDsKIH0KfSk7CgprdXplQXBwLmZpbHRlcignc2hvdWxkX2JlX2Rpc3BsYXllZCcsIGZ1bmN0aW9uKCkgewogIC8vIENyZWF0ZSB0aGUgcmV0dXJuIGZ1bmN0aW9uIGFuZCBzZXQgdGhlIHJlcXVpcmVkIHBhcmFtZXRlciBuYW1lIHRvICoqaW5wdXQqKgogcmV0dXJuIGZ1bmN0aW9uKGlucHV0KSB7CiAgIHZhciBvdXQgPSBbXTsKCiAgIC8vIFVzaW5nIHRoZSBhbmd1bGFyLmZvckVhY2ggbWV0aG9kLCBnbyB0aHJvdWdoIHRoZSBhcnJheSBvZiBkYXRhIGFuZCBwZXJmb3JtIHRoZSBvcGVyYXRpb24gb2YgZmlndXJpbmcgb3V0IGlmIHRoZSBsYW5ndWFnZSBpcyBzdGF0aWNhbGx5IG9yIGR5bmFtaWNhbGx5IHR5cGVkLgoKICAgYW5ndWxhci5mb3JFYWNoKGlucHV0LCBmdW5jdGlvbihldmVudCkKICAgewogICAgLy8gIGxvZ0RlYnVnKCJmaWx0ZXJpbmcsIGV2ZW50LmV2ZW50X3VzZXJfc3RhdHVzX2lkPSIrZXZlbnQuZXZlbnRfdXNlcl9zdGF0dXNfaWQpOwogICAgIGlmIChldmVudC5zaG91bGRfYmVfZGlzcGxheWVkPT0xKQogICAgIHsKICAgICAgIG91dC5wdXNoKGV2ZW50KQogICAgIH0KICAgfSkKICAgcmV0dXJuIG91dDsKIH0KfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ0luc3RydWN0b3JTaG93MUNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICR0aW1lb3V0LCAkaHR0cCwgc2hhcmVkUHJvcGVydGllcywgJHJvb3RTY29wZSwgJHJvdXRlUGFyYW1zLCAkbG9jYXRpb24sICRyb3V0ZSwgc2hhcmVkRGF0YSwgJHVpYk1vZGFsKQp7CiAgZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLGdldEJ1c2luZXNzQ2xpZW50SW5mb19zdWNjZXNzKTsKCiAgZnVuY3Rpb24gZ2V0QnVzaW5lc3NDbGllbnRJbmZvX3N1Y2Nlc3MoKQogIHsKICAgIGdldENsaWVudEV4dHJhRmllbGRzKCRodHRwLCRzY29wZSwkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYnVzaW5lc3NfdXNlcl9pZCwnY2xpZW50RXh0cmFGaWVsZHMnLGdldENsaWVudEV4dHJhRmllbGRzX3N1Y2Nlc3MpOwoKICAgIGZ1bmN0aW9uIGdldENsaWVudEV4dHJhRmllbGRzX3N1Y2Nlc3MoKQogICAgewogICAgICBmb3IgKGkgPSAwOyBpPCAoJHNjb3BlLmNsaWVudEV4dHJhRmllbGRzKS5sZW5ndGg7IGkrKykKICAgICAgewogICAgICAgIGxvZ0RlYnVnKCRzY29wZS5jbGllbnRFeHRyYUZpZWxkc1tpXSk7CiAgICAgICAgaWYgKCRzY29wZS5jbGllbnRFeHRyYUZpZWxkc1tpXS5maWVsZF9kYXRhdHlwZT09IkRBVEUiKQogICAgICAgIHsKICAgICAgICAgIC8vIGxvZ0RlYnVnKCJkYXRlIik7CiAgICAgICAgICAkc2NvcGUuY2xpZW50RXh0cmFGaWVsZHNbaV0uZmllbGRfdmFsdWU9bmV3IERhdGUoJHNjb3BlLmNsaWVudEV4dHJhRmllbGRzW2ldLmZpZWxkX3ZhbHVlKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CgogICRzY29wZS5hcmNoaXZlQ2xpZW50TW9kYWwgPSBmdW5jdGlvbigpCiAgewogICAgLy8gYXJjaGl2ZS9kZWxldGUgY2xpZW50IC0gYXNrIGlmIHN1cmUKICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewogICAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYXJjaGl2ZV9jbGllbnRfbW9kYWwucGhwJywKICAgICAgICBzaXplOiAneHMnLAogICAgICAgIGNvbnRyb2xsZXI6ICdhcmNoaXZlX2NsaWVudF9tb2RhbCcsICAvLyAncGF5bWVueURldGFpbHNNb2RhbENvbnRyb2xsZXInLAogICAgICAgIHJlc29sdmU6IHsKICAgICAgICAgIGJ1c2luZXNzX3VzZXJfaWQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYnVzaW5lc3NfdXNlcl9pZDsKICAgICAgICAgIH0sCiAgICAgICAgICBidXNlcl9sYXN0X25hbWU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYnVzZXJfbGFzdF9uYW1lOwogICAgICAgICAgfSwKICAgICAgICAgIGJ1c2VyX2ZpcnN0X25hbWU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYnVzZXJfZmlyc3RfbmFtZTsKICAgICAgICAgIH0sCiAgICAgICAgICBpc19pbnN0cnVjdG9yOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICB9KTsKICB9CgogICRzY29wZS51cGRhdGVVc2VyRmlyc3ROYW1lID0gZnVuY3Rpb24obmV3VmFsdWUpCiAgewogICAgc2V0Q2xpZW50Rmlyc3ROYW1lKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCxuZXdWYWx1ZSxhZnRlckNsaWVudFNldCxhZnRlckNsaWVudFNldCk7CiAgICBmdW5jdGlvbiBhZnRlckNsaWVudFNldCgpCiAgICB7CiAgICAgIGdldEJ1c2luZXNzQ2xpZW50SW5mbygkaHR0cCwkc2NvcGUsJ2Zvcm1VcGRhdGVDbGllbnRBbmd1bGFyJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CiAgICB9CiAgfQogICRzY29wZS51cGRhdGVVc2VyTGFzdE5hbWUgPSBmdW5jdGlvbihuZXdWYWx1ZSkKICB7CiAgICBzZXRDbGllbnRMYXN0TmFtZSgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsbmV3VmFsdWUsYWZ0ZXJDbGllbnRTZXQsYWZ0ZXJDbGllbnRTZXQpOwogICAgZnVuY3Rpb24gYWZ0ZXJDbGllbnRTZXQoKQogICAgewogICAgICBnZXRCdXNpbmVzc0NsaWVudEluZm8oJGh0dHAsJHNjb3BlLCdmb3JtVXBkYXRlQ2xpZW50QW5ndWxhcicsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwogICAgfQogIH0KICAkc2NvcGUudXBkYXRlVXNlclBob25lTnVtYmVyID0gZnVuY3Rpb24obmV3VmFsdWUpCiAgewogICAgbmV3VmFsdWUgPSBuZXdWYWx1ZS5yZXBsYWNlKCctJywnJyk7CiAgICBpZiAoaXNOYU4obmV3VmFsdWUpKQogICAgewogICAgICBhbGVydCgi15DXoNeQINeU15bXnyDXnteh16TXqCDXmNec16TXldefINeq16fXmdefIik7CiAgICAgIGdldEJ1c2luZXNzQ2xpZW50SW5mbygkaHR0cCwkc2NvcGUsJ2Zvcm1VcGRhdGVDbGllbnRBbmd1bGFyJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgIHNldENsaWVudFBob25lTnVtYmVyKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCxuZXdWYWx1ZSxzZXRDbGllbnRQaG9uZU51bWJlcl9jYWxsYmFjayxzZXRDbGllbnRQaG9uZU51bWJlcl9jYWxsYmFjayk7CiAgICAgIGZ1bmN0aW9uIHNldENsaWVudFBob25lTnVtYmVyX2NhbGxiYWNrKCkKICAgICAgewogICAgICAgIGdldEJ1c2luZXNzQ2xpZW50SW5mbygkaHR0cCwkc2NvcGUsJ2Zvcm1VcGRhdGVDbGllbnRBbmd1bGFyJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CiAgICAgIH0KICAgIH0KICB9Cgp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ0NsaWVudHNTaG93MUNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICR0aW1lb3V0LCAkaHR0cCwgc2hhcmVkUHJvcGVydGllcywgJHJvb3RTY29wZSwgJHJvdXRlUGFyYW1zLCAkbG9jYXRpb24sICRyb3V0ZSwgc2hhcmVkRGF0YSwgJHVpYk1vZGFsKQp7CiAgICBnZXRCdXNpbmVzc0NsaWVudEluZm8oJGh0dHAsJHNjb3BlLCdmb3JtVXBkYXRlQ2xpZW50QW5ndWxhcicsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsZ2V0QnVzaW5lc3NDbGllbnRJbmZvX3N1Y2Nlc3MpOwoKICAgIGZ1bmN0aW9uIGdldEJ1c2luZXNzQ2xpZW50SW5mb19zdWNjZXNzKCkKICAgIHsKICAgICAgZ2V0Q2xpZW50RXh0cmFGaWVsZHMoJGh0dHAsJHNjb3BlLCRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5idXNpbmVzc191c2VyX2lkLCdjbGllbnRFeHRyYUZpZWxkcycsZ2V0Q2xpZW50RXh0cmFGaWVsZHNfc3VjY2Vzcyk7CgogICAgICBmdW5jdGlvbiBnZXRDbGllbnRFeHRyYUZpZWxkc19zdWNjZXNzKCkKICAgICAgewogICAgICAgIGZvciAoaSA9IDA7IGk8ICgkc2NvcGUuY2xpZW50RXh0cmFGaWVsZHMpLmxlbmd0aDsgaSsrKQogICAgICAgIHsKICAgICAgICAgIGxvZ0RlYnVnKCRzY29wZS5jbGllbnRFeHRyYUZpZWxkc1tpXSk7CiAgICAgICAgICBpZiAoJHNjb3BlLmNsaWVudEV4dHJhRmllbGRzW2ldLmZpZWxkX2RhdGF0eXBlPT0iREFURSIpCiAgICAgICAgICB7CiAgICAgICAgICAgIC8vIGxvZ0RlYnVnKCJkYXRlIik7CiAgICAgICAgICAgICRzY29wZS5jbGllbnRFeHRyYUZpZWxkc1tpXS5maWVsZF92YWx1ZT1uZXcgRGF0ZSgkc2NvcGUuY2xpZW50RXh0cmFGaWVsZHNbaV0uZmllbGRfdmFsdWUpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQp7CiAgICBnZXRDbGllbnRFdmVudHMoJGh0dHAsJHNjb3BlLCdjdXJyZW50Q2xpZW50RXZlbnRzJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CgogICAgZ2V0Q2xpZW50UGF5bWVudHMoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLCdjdXJyZW50Q2xpZW50UGF5bWVudHMnKTsKCiAgICAkc2NvcGUuYXJjaGl2ZUNsaWVudE1vZGFsID0gZnVuY3Rpb24oKQogICAgewogICAgICAvLyBhcmNoaXZlL2RlbGV0ZSBjbGllbnQgLSBhc2sgaWYgc3VyZQogICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAgICAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdhcmNoaXZlX2NsaWVudF9tb2RhbC5waHAnLAogICAgICAgICAgc2l6ZTogJ3hzJywKICAgICAgICAgIGNvbnRyb2xsZXI6ICdhcmNoaXZlX2NsaWVudF9tb2RhbCcsICAvLyAncGF5bWVueURldGFpbHNNb2RhbENvbnRyb2xsZXInLAogICAgICAgICAgcmVzb2x2ZTogewogICAgICAgICAgICBidXNpbmVzc191c2VyX2lkOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYnVzaW5lc3NfdXNlcl9pZDsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgYnVzZXJfbGFzdF9uYW1lOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYnVzZXJfbGFzdF9uYW1lOwogICAgICAgICAgICB9LAogICAgICAgICAgICBidXNlcl9maXJzdF9uYW1lOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYnVzZXJfZmlyc3RfbmFtZTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgaXNfaW5zdHJ1Y3RvcjogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgICAkc2NvcGUucGFja2FnZURlbGV0ZSA9IGZ1bmN0aW9uKHBhY2thZ2UpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJwYWNrYWdlIGRlbGV0ZSAiK0pTT04uc3RyaW5naWZ5KHBhY2thZ2UpKTsKICAgICAgZGVsZXRlUGFja2FnZSgkaHR0cCwkc2NvcGUscGFja2FnZS5wYWNrYWdlX3VzZXJfaWQsJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLmJ1c2luZXNzX3VzZXJfaWQsc3VjY2Vzc19jYWxsYmFjaywgc3VjY2Vzc19jYWxsYmFjayk7CiAgICAgIGZ1bmN0aW9uIHN1Y2Nlc3NfY2FsbGJhY2soKQogICAgICB7CiAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgICB9CiAgICB9CgogICAgJHNjb3BlLnVwZGF0ZUNsaWVudEV4dHJhRmllbGRzID0gZnVuY3Rpb24oKQogICAgewogICAgICBsb2dEZWJ1ZygidXBkYXRlRXZlbnRFeHRyYUZpZWxkcyIpOwogICAgICB0aGVkYXRhID0gewogICAgICAgICBleHRyYUZpZWxkczokc2NvcGUuY2xpZW50RXh0cmFGaWVsZHMKICAgICAgICB9OwogICAgICAkc2NvcGUuZXh0cmFGaWVsZHNBbGVydE1lc3NhZ2U9Itee16LXk9eb158g16DXqteV16DXmdedLCDXkNeg15Ag15TXnteq158uLi4iOwogICAgICB1cGRhdGVDbGllbnRFeHRyYUZpZWxkcygkaHR0cCwkc2NvcGUsJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLmJ1c2luZXNzX3VzZXJfaWQsdGhlZGF0YSx1cGRhdGVFdmVudEV4dHJhRmllbGRzX2NhbGxiYWNrLCB1cGRhdGVFdmVudEV4dHJhRmllbGRzX2NhbGxiYWNrKTsKCiAgICAgIGZ1bmN0aW9uIHVwZGF0ZUV2ZW50RXh0cmFGaWVsZHNfY2FsbGJhY2soKQogICAgICB7CiAgICAgICAgLy8gZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLHNldFBhcnRpY2lwYXRlZCk7CiAgICAgICAgJHNjb3BlLmV4dHJhRmllbGRzQWxlcnRNZXNzYWdlPSLXqteZ16LXldeTINeg16nXnteoINeR15TXptec15fXlCEiOwogICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkKICAgICAgICB7CiAgICAgICAgICAkc2NvcGUuZXh0cmFGaWVsZHNBbGVydE1lc3NhZ2U9bnVsbDsKICAgICAgICB9LCAzMDAwKTsKICAgICAgfQogICAgfTsKCiAgICAkc2NvcGUuc2NoZWR1bGVFdmVudEZvckNsaWVudCA9IGZ1bmN0aW9uKCkKICAgIHsKICAgICAgbG9nRGVidWcoInNlZXRpbmcgc2hhcmUgcHJvcGVydHkgdXNlcl9pZCAiKyRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXSk7CiAgICAgIHNoYXJlZFByb3BlcnRpZXMuc2V0X3NlbGVjdGVkX3VzZXIoJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdKTsKICAgICAgJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jYWxlbmRhcicpOwogICAgfQogICAgJHNjb3BlLmludm9pY2VHZW5lcmF0ZUNoZWNrYm94ID0gZnVuY3Rpb24oZnBheW1lbnQpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJpbnZvaWNlR2VuZXJhdGVDaGVja2JveCBmb3IgIitKU09OLnN0cmluZ2lmeShmcGF5bWVudCkpOwogICAgICBzZXRDbGllbnRQYXltZW50SW52b2ljZUdlbmVyYXRlZCgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsZnBheW1lbnQudXNlcl9wYXltZW50X2lkLGZwYXltZW50Lmludm9pY2VfZ2VuZXJhdGVkLHNldENsaWVudFBheW1lbnRJbnZvaWNlR2VuZXJhdGVkX2NhbGxiYWNrLCBzZXRDbGllbnRQYXltZW50SW52b2ljZUdlbmVyYXRlZF9jYWxsYmFjayk7CiAgICAgIGZ1bmN0aW9uIHNldENsaWVudFBheW1lbnRJbnZvaWNlR2VuZXJhdGVkX2NhbGxiYWNrKCkKICAgICAgewogICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKICAgICAgfQogICAgfTsKCiAgICAkc2NvcGUucmVjYWxjVXNlckJhbGFuY2UgPSBmdW5jdGlvbigpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJyZWNhbGNVc2VyQmFsYW5jZSIpOwogICAgICByZWNhbGNVc2VyQmFsYW5jZSgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsIHJlY2FsY1VzZXJCYWxhbmNlX2NhbGxiYWNrKTsKICAgICAgZnVuY3Rpb24gcmVjYWxjVXNlckJhbGFuY2VfY2FsbGJhY2soKQogICAgICB7CiAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgICB9ICAgIH0KICAgICRzY29wZS51cGRhdGVFdmVudFBhY2thZ2VSZWZlcmVuY2UgPSBmdW5jdGlvbih1c2VyX2lkLCBmbWVldGluZykKICAgIHsKICAgICAgbG9nRGVidWcoInVwZGF0ZUV2ZW50UGFja2FnZVJlZmVyZW5jZSwgdXNlcj0iK3VzZXJfaWQrIiwgZm1lZXRpbmc9IitKU09OLnN0cmluZ2lmeShmbWVldGluZykpOwogICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAgICAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9jbGllbnRfZXZlbnRfcGFja2FnZV9hc3NvY2lhdGlvbi5waHAnLAogICAgICAgICAgc2l6ZTogJ3hzJywKICAgICAgICAgIGNvbnRyb2xsZXI6ICdldmVudFBhY2thZ2VBc3NvY2lhdGlvbk1vZGFsQ29udHJvbGxlcicsICAvLyAncGF5bWVueURldGFpbHNNb2RhbENvbnRyb2xsZXInLAogICAgICAgICAgcmVzb2x2ZTogewogICAgICAgICAgICAgIGZtZWV0aW5nOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIGZtZWV0aW5nOwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgYmFsYW5jZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYmFsYW5jZTsKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGJ1c2luZXNzX3VzZXJfaWQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQ7CiAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICB9KTsKICAgIH07CgogICAgJHNjb3BlLnVwZGF0ZVBhY2thZ2VQYXltZW50UmVmZXJlbmNlID0gZnVuY3Rpb24odXNlcl9pZCwgZnBhY2thZ2UpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJ1cGRhdGVQYWNrYWdlUGF5bWVudFJlZmVyZW5jZSwgdXNlcj0iK3VzZXJfaWQrIiwgZnBhY2thZ2U9IitKU09OLnN0cmluZ2lmeShmcGFja2FnZSkpOwogICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAgICAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9jbGllbnRfcGFja2FnZV9wYXltZW50X2Fzc29jaWF0aW9uLnBocCcsCiAgICAgICAgICBzaXplOiAneHMnLAogICAgICAgICAgY29udHJvbGxlcjogJ3BhY2thZ2VQYXltZW50QXNzb2NpYXRpb25Nb2RhbENvbnRyb2xsZXInLCAgLy8gJ3BheW1lbnlEZXRhaWxzTW9kYWxDb250cm9sbGVyJywKICAgICAgICAgIHJlc29sdmU6IHsKICAgICAgICAgICAgICBmcGFja2FnZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBmcGFja2FnZTsKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGJhbGFuY2U6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLmJhbGFuY2U7CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBidXNpbmVzc191c2VyX2lkOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuICRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkOwogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgfSk7CiAgICB9OwoKICAgIC8vIHNob3cgcGF5bWVudCBwb3B1cAogICAgJHNjb3BlLnNob3dQYXltZW50RGV0YWlscyA9IGZ1bmN0aW9uKGZwYXltZW50KQogICAgewogICAgICBsb2dEZWJ1Zygic2hvd1BheW1lbnREZXRhaWxzIik7CiAgICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewogICAgICAgICAgYW5pbWF0aW9uOiBmYWxzZSwKICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2NsaWVudF9wYXltZW50X2RldGFpbHMucGhwJywKICAgICAgICAgIHNpemU6ICd4cycsCiAgICAgICAgICBjb250cm9sbGVyOiAncGF5bWVueURldGFpbHNNb2RhbENvbnRyb2xsZXInLAogICAgICAgICAgcmVzb2x2ZTogewogICAgICAgICAgICAgIGZwYXltZW50OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIGZwYXltZW50OwogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgICAkc2NvcGUuaW52b2ljZU51bWJlckNoYW5nZWQgPSBmdW5jdGlvbihuZXdfaW52b2ljZV9udW1iZXIsZnBheW1lbnQpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJpbnZvaWNlTnVtYmVyQ2hhbmdlZCAiKyBuZXdfaW52b2ljZV9udW1iZXIgKyJmb3IgIitKU09OLnN0cmluZ2lmeShmcGF5bWVudCkpOwogICAgICBzZXRDbGllbnRQYXltZW50SW52b2ljZU51bWJlcigkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsZnBheW1lbnQudXNlcl9wYXltZW50X2lkLG5ld19pbnZvaWNlX251bWJlcixzZXRDbGllbnRQYXltZW50SW52b2ljZU51bWJlcl9jYWxsYmFjaywgc2V0Q2xpZW50UGF5bWVudEludm9pY2VOdW1iZXJfY2FsbGJhY2spOwogICAgICBmdW5jdGlvbiBzZXRDbGllbnRQYXltZW50SW52b2ljZU51bWJlcl9jYWxsYmFjaygpCiAgICAgIHsKICAgICAgICAvLyAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NsaWVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCiAgICAgIH0KICAgIH07CgogICAgJHNjb3BlLiRvbigiY2xpZW50UGFnZVJlbG9hZERhdGEiLGZ1bmN0aW9uKGUsYSkKICAgIHsKICAgICAgbG9nRGVidWcoImNsaWVudFBhZ2VSZWxvYWREYXRhIik7CiAgICAgIGdldEJ1c2luZXNzVXNlclBhY2thZ2VzKCRodHRwLCRzY29wZSwndXNlcl9wYWNrYWdlcycsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwogICAgICBnZXRDbGllbnRQYXltZW50cygkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsJ2N1cnJlbnRDbGllbnRQYXltZW50cycpOwogICAgICBnZXRDbGllbnRFdmVudHMoJGh0dHAsJHNjb3BlLCdjdXJyZW50Q2xpZW50RXZlbnRzJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CiAgICAgIGdldEJ1c2luZXNzQ2xpZW50SW5mbygkaHR0cCwkc2NvcGUsJ2Zvcm1VcGRhdGVDbGllbnRBbmd1bGFyJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CgogICAgfSk7CgogICAgJHNjb3BlLmlzQ29uZmlybWVkT3JDbG9zZWQgPSBmdW5jdGlvbihldmVudCkKICAgIHsKICAgICAgaWYgKCRzY29wZS5zaG93QWxsRXZlbnRzKQogICAgICB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KCiAgICAgIGlmICgoZXZlbnQuaXNfY29uZmlybWVkID09IDEpIHx8IChldmVudC5pc19maW5hbF9zdGF0dXMgPT0gMSkgfHwgKChldmVudC5pc193YWl0aW5nX2xpc3QgPT0gMSkgJiYgKGV2ZW50LmlzX2NhbmNlbGVkID09IDApKSkKICAgICAgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIGVsc2UKICAgICAgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfQogICAgJHNjb3BlLmdvdG9DbGllbnRFZGl0UGFnZT1nb3RvQ2xpZW50RWRpdFBhZ2U7CiAgICAkc2NvcGUuZ290b0JhY2s9ZnVuY3Rpb24oKQogICAgewogICAgICBsb2dEZWJ1ZygnZ28gYmFjaycpOwogICAgICB3aW5kb3cuaGlzdG9yeS5iYWNrKCk7CiAgICB9OwoKICAgICRzY29wZS5nb3RvRXZlbnRQYWdlID0gZnVuY3Rpb24gKHRoZWV2ZW50KQogICAgewogICAgICBnb3RvRXZlbnRQYWdlKHRoZWV2ZW50KTsKICAgIH0KfQogICAgJHNjb3BlLmluaXRpYXRlUGF5bWVudCA9IGZ1bmN0aW9uKGlzcGx1cykKICAgIHsKICAgICAgbG9nRGVidWcoImluaXRpYXRlUGF5bWVudCBpc3BsdXMiK2lzcGx1cyk7CiAgICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewogICAgICAgICAgYW5pbWF0aW9uOiBmYWxzZSwKICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2NsaWVudF9wYXltZW50LnBocCcsCiAgICAgICAgICBjb250cm9sbGVyOiAnYnVzaW5lc3NDbGllbmRDYXJkUGF5bWVudCcsCiAgICAgICAgICAvLyBzaXplOiBzaXplLAogICAgICAgICAgcmVzb2x2ZTogewogICAgICAgICAgICBjdXJyZW50Q2xpZW50OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF07CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGlzcGx1czogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gaXNwbHVzOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgIH0pOwogICAgfQoKICAgICRzY29wZS51cGRhdGVVc2VyRmlyc3ROYW1lID0gZnVuY3Rpb24obmV3VmFsdWUpCiAgICB7CiAgICAgIHNldENsaWVudEZpcnN0TmFtZSgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsbmV3VmFsdWUsYWZ0ZXJDbGllbnRTZXQsYWZ0ZXJDbGllbnRTZXQpOwogICAgICBmdW5jdGlvbiBhZnRlckNsaWVudFNldCgpCiAgICAgIHsKICAgICAgICBnZXRCdXNpbmVzc0NsaWVudEluZm8oJGh0dHAsJHNjb3BlLCdmb3JtVXBkYXRlQ2xpZW50QW5ndWxhcicsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwogICAgICB9CiAgICB9CiAgICAkc2NvcGUudXBkYXRlVXNlckxhc3ROYW1lID0gZnVuY3Rpb24obmV3VmFsdWUpCiAgICB7CiAgICAgIHNldENsaWVudExhc3ROYW1lKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCxuZXdWYWx1ZSxhZnRlckNsaWVudFNldCxhZnRlckNsaWVudFNldCk7CiAgICAgIGZ1bmN0aW9uIGFmdGVyQ2xpZW50U2V0KCkKICAgICAgewogICAgICAgIGdldEJ1c2luZXNzQ2xpZW50SW5mbygkaHR0cCwkc2NvcGUsJ2Zvcm1VcGRhdGVDbGllbnRBbmd1bGFyJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CiAgICAgIH0KICAgIH0KICAgICRzY29wZS51cGRhdGVVc2VyRW1haWwgPSBmdW5jdGlvbihuZXdWYWx1ZSkKICAgIHsKICAgICAgc2V0Q2xpZW50RW1haWwoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLG5ld1ZhbHVlLGFmdGVyc2V0Q2xpZW50RW1haWwsYWZ0ZXJzZXRDbGllbnRFbWFpbCk7CiAgICAgIGZ1bmN0aW9uIGFmdGVyc2V0Q2xpZW50RW1haWwoKQogICAgICB7CiAgICAgICAgZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKICAgICAgfQogICAgfQoKCiAgICAkc2NvcGUudXBkYXRlVXNlclBob25lTnVtYmVyID0gZnVuY3Rpb24obmV3VmFsdWUpCiAgICB7CiAgICAgIG5ld1ZhbHVlID0gbmV3VmFsdWUucmVwbGFjZSgnLScsJycpOwogICAgICBpZiAoaXNOYU4obmV3VmFsdWUpKQogICAgICB7CiAgICAgICAgYWxlcnQoIteQ16DXkCDXlNeW158g157Xodek16gg15jXnNek15XXnyDXqten15nXnyIpOwogICAgICAgIGdldEJ1c2luZXNzQ2xpZW50SW5mbygkaHR0cCwkc2NvcGUsJ2Zvcm1VcGRhdGVDbGllbnRBbmd1bGFyJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CiAgICAgIH0KICAgICAgZWxzZQogICAgICB7CiAgICAgICAgc2V0Q2xpZW50UGhvbmVOdW1iZXIoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLG5ld1ZhbHVlLHNldENsaWVudFBob25lTnVtYmVyX2NhbGxiYWNrLHNldENsaWVudFBob25lTnVtYmVyX2NhbGxiYWNrKTsKICAgICAgICBmdW5jdGlvbiBzZXRDbGllbnRQaG9uZU51bWJlcl9jYWxsYmFjaygpCiAgICAgICAgewogICAgICAgICAgZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgICRzY29wZS51cGRhdGVVc2VyRXZlbnRQcmljZSA9IGZ1bmN0aW9uKG5ld3ZhbHVlLCB0aGVldmVudCkKICAgIHsKICAgICAgbmV3X3ByaWNlPW5ld3ZhbHVlOwogICAgICBzZXRDbGllbnRFdmVudFByaWNlKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCx0aGVldmVudC5ldmVudF9pZCwgbmV3X3ByaWNlLHNldENsaWVudEV2ZW50UHJpY2VfY2FsbGJhY2ssIHNldENsaWVudEV2ZW50UHJpY2VfY2FsbGJhY2spOwogICAgICBmdW5jdGlvbiBzZXRDbGllbnRFdmVudFByaWNlX2NhbGxiYWNrKCkKICAgICAgewogICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKICAgICAgfQogICAgfTsKCiAgICAkc2NvcGUudXBkYXRlVXNlclBhY2thZ2VFdmVudHNDb3VudGVyID0gZnVuY3Rpb24obmV3dmFsdWUsIHRoZXBhY2thZ2UpCiAgICB7CiAgICAgIGV2ZW50c19jb3VudGVyPW5ld3ZhbHVlOwogICAgICBzZXRVc2VyUGFja2FnZUV2ZW50c0NvdW50ZXIoJGh0dHAsJHNjb3BlLHRoZXBhY2thZ2UucGFja2FnZV91c2VyX2lkLGV2ZW50c19jb3VudGVyLHNldFVzZXJQYWNrYWdlRXZlbnRzQ291bnRlcl9jYWxsYmFjaywgc2V0VXNlclBhY2thZ2VFdmVudHNDb3VudGVyX2NhbGxiYWNrKQogICAgICBmdW5jdGlvbiBzZXRVc2VyUGFja2FnZUV2ZW50c0NvdW50ZXJfY2FsbGJhY2soKQogICAgICB7CiAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgICB9CiAgICB9OwogICAgJHNjb3BlLnVwZGF0ZVVzZXJQYWNrYWdlUGFja2FnZVByaWNlID0gZnVuY3Rpb24obmV3dmFsdWUsIHRoZXBhY2thZ2UpCiAgICB7CiAgICAgIHBhY2thZ2VfcHJpY2U9bmV3dmFsdWU7CiAgICAgIHNldFVzZXJQYWNrYWdlUGFja2FnZVByaWNlKCRodHRwLCRzY29wZSx0aGVwYWNrYWdlLnBhY2thZ2VfdXNlcl9pZCxwYWNrYWdlX3ByaWNlLHNldFVzZXJQYWNrYWdlUGFja2FnZVByaWNlX2NhbGxiYWNrLCBzZXRVc2VyUGFja2FnZVBhY2thZ2VQcmljZV9jYWxsYmFjaykKICAgICAgZnVuY3Rpb24gc2V0VXNlclBhY2thZ2VQYWNrYWdlUHJpY2VfY2FsbGJhY2soKQogICAgICB7CiAgICAgICAgLy8gZ2V0QnVzaW5lc3NVc2VyUGFja2FnZXMoJGh0dHAsJHNjb3BlLCd1c2VyX3BhY2thZ2VzJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CiAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgICB9CiAgICB9OwoKICAgICRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhciA9IHt9OwogICAgbG9nRGVidWcoJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwogICAgJHNjb3BlLnNob3dfY2xpZW50X3VwZGF0ZV9jbGllbnQgPSB0cnVlOwogICAgJHNjb3BlLnNob3dfY2xpZW50X3VwZGF0ZV9zYXZlID0gZmFsc2U7CiAgICAkc2NvcGUuc2hvd19jbGllbnRfZGVsZXRlX2NsaWVudCA9IHRydWU7CiAgICAkc2NvcGUuc2hvd19jbGllbnRfdXBkYXRlX2NhbmNlbCA9IGZhbHNlOwoKICAgICRzY29wZS51cGRhdGVDbGllbnRFbmFibGUgPSBmdW5jdGlvbigpIHsKICAgICAgICBsb2dEZWJ1ZygiZW5hYmxpbmcgZWRpdGluZyAoJHNjb3BlLmNsaWVudHNVcGRhdGVEaXNhYmxlZCB3YXMgIiArICRzY29wZS5jbGllbnRzVXBkYXRlRGlzYWJsZWQgKyAiKSIpOwogICAgICAgICRzY29wZS5jbGllbnRzVXBkYXRlRGlzYWJsZWQgPSBmYWxzZTsKICAgICAgICAkc2NvcGUuc2hvd19jbGllbnRfdXBkYXRlX2NsaWVudCA9IGZhbHNlOwogICAgICAgICRzY29wZS5zaG93X2NsaWVudF91cGRhdGVfc2F2ZSA9IHRydWU7CiAgICAgICAgJHNjb3BlLnNob3dfY2xpZW50X2RlbGV0ZV9jbGllbnQgPSBmYWxzZTsKICAgICAgICAkc2NvcGUuc2hvd19jbGllbnRfdXBkYXRlX2NhbmNlbCA9IHRydWU7CiAgICB9CiAgICAkc2NvcGUudXBkYXRlQ2xpZW50RGlzYWJsZSA9IGZ1bmN0aW9uKCkgewogICAgICAgIGxvZ0RlYnVnKCJkaXNhYmxlIGVkaXRpbmciKTsKICAgICAgICAvLwkJJGxvY2F0aW9uLnBhdGgoJy9DbGllbnRzLycrJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwogICAgICAgICRyb3V0ZS5yZWxvYWQoKTsKICAgIH0KICAgICRzY29wZS5zY2hlZHVsZUV2ZW50RnJvbUVuZFVzZXIgPSBmdW5jdGlvbigpIHsKICAgICAgICBzaGFyZWREYXRhLnNldFNlbGVjdGVkRW5kVXNlcih7CiAgICAgICAgICAgIGlkOiAkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCwKICAgICAgICAgICAgZmlyc3RfbmFtZTogJHNjb3BlLmN1cnJlbnRDbGllbnQudXNlcnNbMF0uZmlyc3RfbmFtZSwKICAgICAgICAgICAgbGFzdF9uYW1lOiAkc2NvcGUuY3VycmVudENsaWVudC51c2Vyc1swXS5sYXN0X25hbWUKICAgICAgICB9KTsKICAgICAgICBsb2dEZWJ1Zygic2NoZWR1bGUgZXZlbnQgZm9yIHVzZXIgIiArICRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKICAgICAgICAvLwkJJGxvY2F0aW9uLnBhdGgoJy9DbGllbnRzLycrJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwogICAgICAgICRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfY2FsZW5kYXInKTsKICAgIH0KCiAgICAvLyByZW1vdmUgZW5kIHVzZXIgZnJvbSBldmVudAogICAgJHNjb3BlLnVzZXJEZWxldGVFdmVudCA9IGZ1bmN0aW9uKGVuZHVzZXJfaWQsIHRoZWV2ZW50KQogICAgewogICAgICAvLyBpZiBpdCdzIGEgY2xhc3MgLSB3ZSBzaW1wbHkgcmVtb3ZlIHRoZSB1c2VyIGZyb20gdGhlIGV2ZW50CiAgICAgIGlmICh0aGVldmVudC5pc19jbGFzcz09MSkKICAgICAgewogICAgICAgIGxvZ0RlYnVnKCJzY29wZS51c2VyRGVsZXRlRXZlbnQiKTsKICAgICAgICByZW1vdmVFbmRVc2VyRnJvbUV2ZW50KCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCx0aGVldmVudC5ldmVudF9pZCxyZW1vdmVFbmRVc2VyRnJvbUV2ZW50X2ZpbmlzaCwgcmVtb3ZlRW5kVXNlckZyb21FdmVudF9maW5pc2gpOwogICAgICAgIGZ1bmN0aW9uIHJlbW92ZUVuZFVzZXJGcm9tRXZlbnRfZmluaXNoKCkKICAgICAgICB7CiAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NsaWVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCiAgICAgICAgfQogICAgICB9CiAgICAgIC8vIGlmIGl0cyBub3QgYSBjbGFzcyAtIHdlIG5lZWQgdG8gcmVtb3ZlIHRoZSBldmVudCBpdHNlbGYKICAgICAgZWxzZQogICAgICB7CiAgICAgICAgLy8gYWxlcnQoIm5vdCBjbGFzcyBldmVudCwgVE9ETyIpOwogICAgICB9CiAgICB9OwoKICAgIC8vIHJldHJldmluZyBwYWNrYWdlcyBmb3IgdGhlIGJ1c2luZXNzCiAgICBnZXRCdXNpbmVzc1BhY2thZ2VzKCRodHRwLCRzY29wZSwncGFja2FnZXMnKTsKCiAgICAvLyBnZXQgcGFja2FnZXMgZm9yIHRoaXMgc3BlY2lmaWMgdXNlcgogICAgZ2V0QnVzaW5lc3NVc2VyUGFja2FnZXMoJGh0dHAsJHNjb3BlLCd1c2VyX3BhY2thZ2VzJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CiAgICAvLyBhZGRpbmcgcGFja2FnZSB0byB1c2VyIC0gY2FsbGVkIHdoZW4gYSBwYWNrYWdlIGlzIHNlbGVjdGVkCiAgICAkc2NvcGUucGFja2FnZUZvckNsaWVudFNlbGVjdGVkID0gZnVuY3Rpb24oc2VsZWN0ZWRQYWNrYWdlKSB7CiAgICAgICAgaWYgKHNlbGVjdGVkUGFja2FnZSkgewogICAgICAgICAgICAvLyBsb2dEZWJ1ZygneWVzIHNlbGVjdGVkICcgKyBKU09OLnN0cmluZ2lmeShzZWxlY3RlZFBhY2thZ2UpKTsKICAgICAgICAgICAgYWRkQnVzaW5lc3NQYWNrYWdlVG9Vc2VyKCRodHRwLCRzY29wZSxzZWxlY3RlZFBhY2thZ2Uub3JpZ2luYWxPYmplY3QsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsYWRkQnVzaW5lc3NQYWNrYWdlU3VjY2Vzcyk7CiAgICAgICAgICAgIGZ1bmN0aW9uIGFkZEJ1c2luZXNzUGFja2FnZVN1Y2Nlc3MoKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgbG9nRGVidWcoImFkZEJ1c2luZXNzUGFja2FnZVN1Y2Nlc3MyIik7CiAgICAgICAgICAgICAgLy8gZ2V0QnVzaW5lc3NQYWNrYWdlcygkaHR0cCwkc2NvcGUsJ3BhY2thZ2VzJyk7CiAgICAgICAgICAgICAgLy8gZ2V0QnVzaW5lc3NVc2VyUGFja2FnZXMoJGh0dHAsJHNjb3BlLCd1c2VyX3BhY2thZ2VzJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CiAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgICAgICAgICB9CiAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnYW5ndWNvbXBsZXRlLWFsdDpjbGVhcklucHV0JywgJ2NsaWVudF9hbmd1Y29tcGxldGUnKTsKICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgLy8gbG9nRGVidWcoJ25vdCBzZWxlY3RlZCwgZG8gbm90aGluZycpOwogICAgICAgIH0KICAgIH07Cn0pOwoKCi8vIE5lZWQgdG8gZGlzdGluZ3Vpc2ggYmV0d2VlbiBlbmQgdXNlciAoY2xpZW50KSBhbmQgYnVzaW5lc3Mgb3duZXIuCi8vIGN1cnJlbnRseSBjYWxscyBvbmx5IGVuZCB1c2VyCmt1emVBcHAuY29udHJvbGxlcignSG9tZUNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkdWliTW9kYWwpCnsKCiAgICBnZXRBbGxDbGllbnRzKCRodHRwLCRzY29wZSwnYWxsQ2xpZW50cycpOwoKICAgICRzY29wZS5ob21lcGFnZUxpbWl0PTY7CiAgICBnZXRPcGVuZWRFdmVudHMoJGh0dHAsJHNjb3BlLCRzY29wZS5ob21lcGFnZUxpbWl0LCdvcGVuZWRfZXZlbnRzJyk7CgogICAgdmFyIHRvZGF5ZGF0ZSA9IG5ldyBEYXRlKCk7CiAgICB2YXIgaG93bWFueWRheXNhaGVhZD0zMDsKICAgIHZhciBzdGFydGRhdGU9dG9kYXlkYXRlLmdldEZ1bGxZZWFyKCkrIi0iKygxK3RvZGF5ZGF0ZS5nZXRNb250aCgpKSsiLSIrdG9kYXlkYXRlLmdldERhdGUoKTsKICAgIHRvZGF5ZGF0ZS5zZXREYXRlKHRvZGF5ZGF0ZS5nZXREYXRlKCkgKyBob3dtYW55ZGF5c2FoZWFkKTsKICAgIHZhciBlbmRkYXRlPXRvZGF5ZGF0ZS5nZXRGdWxsWWVhcigpKyItIisoMSt0b2RheWRhdGUuZ2V0TW9udGgoKSkrIi0iK3RvZGF5ZGF0ZS5nZXREYXRlKCk7CgogICAgLy8gZmlsdGVyIGZvciB1c2VycyB3aG8gaGF2ZSBkZWJ0CiAgICAkc2NvcGUuaGF2ZURlYnQgPSBmdW5jdGlvbihldXNlcikKICAgIHsKICAgICAgaWYgKGV1c2VyLnVzZXJfYmFsYW5jZSA8IDApCiAgICAgIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICBlbHNlCiAgICAgIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH07CgogICAgJHNjb3BlLmdvdG9DbGllbnRQYWdlID0gZnVuY3Rpb24oYnVzaW5lc3NfdXNlcl9pZCkKICAgIHsKICAgICAgLy8gbG9nRGVidWcoZXVzZXIpOwogICAgICB3aW5kb3cubG9jYXRpb24uaHJlZj0nLyMvYnVzaW5lc3NfY2xpZW50cy8nICsgYnVzaW5lc3NfdXNlcl9pZDsKICAgIH0KCiAgICB2YXIgcGF5bG9hZCA9ICdzdGFydD0nICsgc3RhcnRkYXRlICsgJyZlbmQ9JyArIGVuZGRhdGU7CiAgICB2YXIgY29uZmlnID0gewogICAgICBoZWFkZXJzOiB7J0NvbnRlbnQtVHlwZSc6J2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZDsgY2hhcnNldD1VVEYtOCd9CiAgICB9CiAgICB2YXIgcG9zdHVybCA9ICIvYXBpL2FkbWluL2V2ZW50cy9nZXRwb3N0IjsKCiAgICAkaHR0cC5wb3N0KHBvc3R1cmwsIHBheWxvYWQsIGNvbmZpZykuc3VjY2VzcyhmdW5jdGlvbihkYXRhKQogICAgewogICAgICBsb2dEZWJ1ZygiZG9uZSIpOwogICAgICAkc2NvcGUuYWRtaW5fZXZlbnRzID0gZGF0YTsKICAgIH0pOwoKICAgICRzY29wZS5zaG93RXZlbnRQb3B1cCA9IGZ1bmN0aW9uKHNlbGVjdGVkRXZlbnQpIHsKICAgICAgICBzaG93RXZlbnRQb3B1cChzZWxlY3RlZEV2ZW50LCAkdWliTW9kYWwpCiAgICB9OwogICAgJHNjb3BlLmVkaXRFdmVudD0gZnVuY3Rpb24gKHRoZWV2ZW50KQogICAgewogICAgICBnb3RvRXZlbnRQYWdlKHRoZWV2ZW50KTsKICAgIH0KfSk7CgovLyBrdXplQXBwLmNvbnRyb2xsZXIoJ0J1c2luZXNzQ29uZmlnQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRyb3V0ZVBhcmFtcywgJGxvY2F0aW9uLCAkcm91dGUsIHNoYXJlZERhdGEpIHsKCmt1emVBcHAuY29udHJvbGxlcignQ29uZmlnVXNlckNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICR1aWJNb2RhbCwgJGh0dHAsICR0aW1lb3V0KQp7CiAgJHNjb3BlLmluVGhlTWlkZGxlT2ZTYXZlPWZhbHNlOwoKICBsb2dEZWJ1ZygiQ29uZmlnVXNlckNvbnRyb2xsZXIiKTsKICAvLyAkc2NvcGUuYWpheF9pbmZvPSLXlNep15nXoNeV15nXmdedINeg16nXnteo15UiOwoKICBnZXRMb2dnZWRVc2VySW5mbygkaHR0cCwkc2NvcGUsJ3VzZXJQcm9wZXJ0aWVzJyxnZXRMb2dnZWRVc2VySW5mb19zdWNjZXNzLGdldExvZ2dlZFVzZXJJbmZvX2ZhaWx1cmUpOwogIGZ1bmN0aW9uIGdldExvZ2dlZFVzZXJJbmZvX3N1Y2Nlc3MoKQogIHsKICAgIGxvZ0RlYnVnKCJnZXRMb2dnZWRVc2VySW5mb19zdWNjZXNzIik7CiAgICAkc2NvcGUudXNlclByb3BlcnRpZXNEdXBsaWNhdGUgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KCRzY29wZS51c2VyUHJvcGVydGllcykpOwogIH0KICBmdW5jdGlvbiBnZXRMb2dnZWRVc2VySW5mb19mYWlsdXJlKCkKICB7CiAgICBsb2dEZWJ1ZygiZ2V0TG9nZ2VkVXNlckluZm9fZmFpbHVyZSIpOwogIH0KCiAgJHNjb3BlLmJhY2sgPSBmdW5jdGlvbigpIHsKICAgIHdpbmRvdy5oaXN0b3J5LmJhY2soKTsKICB9OwoKICAkc2NvcGUuY2hhbmdlUGFzc3dvcmRNb2RhbCA9IGZ1bmN0aW9uKCkKICB7CiAgICAkc2NvcGUuaW5UaGVNaWRkbGVPZlNhdmU9dHJ1ZTsKICAgIGZ1bmN0aW9uIHNtc1Jlc2V0UGFzc3dvcmRfc3VjY2VzcygpCiAgICB7CiAgICAgIGNvbnNvbGUubG9nKCJzbXNSZXNldFBhc3N3b3JkX3N1Y2Nlc3MiKTsKICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgICAgICAgICBhbmltYXRpb246IGZhbHNlLAogICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnbW9kYWxfY2hhbmdlX3Bhc3N3b3JkLnBocCcsCiAgICAgICAgICBjb250cm9sbGVyOiAnbW9kYWxfY2hhbmdlX3Bhc3N3b3JkJywKICAgICAgICAgIHNpemU6ICdsJywKICAgICAgICAgIHJlc29sdmU6IHsKICAgICAgICAgICAgICB1c2VyX3Bob25lX251bWJlcjogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIC8vIHBhc3Npbmcgb3JpZ2luYWwgcGhvbmUgbnVtYmVyCiAgICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUudXNlclByb3BlcnRpZXNEdXBsaWNhdGVbMF0ucGhvbmVfbnVtYmVyOwogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgfSk7CgogICAgICBtb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHJlc3VsdCkgewogICAgICAgICRzY29wZS5pblRoZU1pZGRsZU9mU2F2ZT1mYWxzZTsKICAgICAgICBsb2dEZWJ1Zygnc21zUmVzZXRQYXNzd29yZCBNb2RhbCBmaW5pc2VoZCByZXN1bHQ6ICcgKyByZXN1bHQpOwogICAgICAgICRzY29wZS5hamF4X2luZm89IteU16HXmdeh157XkCDXoteV15PXm9eg15Qg15HXlNem15zXl9eUISI7CiAgICAgICAgLy8gZ2V0TG9nZ2VkVXNlckluZm8oJGh0dHAsJHNjb3BlLCd1c2VyUHJvcGVydGllcycsZ2V0TG9nZ2VkVXNlckluZm9fc3VjY2VzcyxnZXRMb2dnZWRVc2VySW5mb19mYWlsdXJlKTsKICAgICAgICAkdGltZW91dChmdW5jdGlvbigpCiAgICAgICAgewogICAgICAgICAgJHNjb3BlLmFqYXhfaW5mbz1udWxsOwogICAgICAgIH0sIDIwMDApOwogICAgICAgICAgbG9nRGVidWcoJ3Ntc1Jlc2V0UGFzc3dvcmQgTW9kYWwgZGlzbWlzc2VkIGF0OiAnICsgbmV3IERhdGUoKSk7CiAgICAgIH0sIGZ1bmN0aW9uKCkgewogICAgICAgICAgJHNjb3BlLmluVGhlTWlkZGxlT2ZTYXZlPWZhbHNlOwogICAgICAgICAgbG9nRGVidWcoJ21vZGFsX2NoYW5nZV9wYXNzd29yZCBNb2RhbCBkaXNtaXNzZWQgYXQ6ICcgKyBuZXcgRGF0ZSgpKTsKICAgICAgfSk7CiAgICB9CgoKICAgIGNoYW5nZVBhc3N3b3JkU01TKCRodHRwLCRzY29wZSwkc2NvcGUudXNlclByb3BlcnRpZXNEdXBsaWNhdGVbMF0ucGhvbmVfbnVtYmVyLHNtc1Jlc2V0UGFzc3dvcmRfc3VjY2Vzcyk7CiAgfQogICRzY29wZS51cGRhdGVVc2VyQ29uZmlnPWZ1bmN0aW9uKCkKICB7CiAgICAkc2NvcGUuaW5UaGVNaWRkbGVPZlNhdmU9dHJ1ZTsKICAgIGxvZ0RlYnVnKCJ1cGRhdGVVc2VyQ29uZmlnLCBpblRoZU1pZGRsZU9mU2F2ZT0iKyRzY29wZS5pblRoZU1pZGRsZU9mU2F2ZSk7CiAgICAvLyBsb2dEZWJ1Zygkc2NvcGUudXNlclByb3BlcnRpZXNEdXBsaWNhdGUpOwogICAgLy8gbG9nRGVidWcoJHNjb3BlLnVzZXJQcm9wZXJ0aWVzKTsKICAgIGlmIChhbmd1bGFyLmVxdWFscygkc2NvcGUudXNlclByb3BlcnRpZXNEdXBsaWNhdGVbMF0ucGhvbmVfbnVtYmVyLCRzY29wZS51c2VyUHJvcGVydGllc1swXS5waG9uZV9udW1iZXIpKQogICAgewogICAgICBsb2dEZWJ1Zygibm90aGluZyBjaGFuZ2VkIGluIHBob25lIG51bWJlciwgY2hlY2tpbmcgb3RoZXIgZGF0YSBvdGhlciBkYXRhIik7CiAgICAgIGlmIChhbmd1bGFyLmVxdWFscygkc2NvcGUudXNlclByb3BlcnRpZXNEdXBsaWNhdGVbMF0sJHNjb3BlLnVzZXJQcm9wZXJ0aWVzWzBdKSkKICAgICAgewogICAgICAgICRzY29wZS5pblRoZU1pZGRsZU9mU2F2ZT1mYWxzZTsKICAgICAgICBsb2dEZWJ1Zygibm90aGluZyBjaGFuZ2VkIGluIGRldGFpbHMsIG5vdGhpbmcgdG8gc2F2ZSIpOwogICAgICAgICRzY29wZS5hamF4X2luZm89Itec15Ag15HXldem16LXlSDXqdeZ16DXldeZ15nXnSDXnNep157Xmdeo15QuLi4iOwogICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkKICAgICAgICB7CiAgICAgICAgICAkc2NvcGUuYWpheF9pbmZvPW51bGw7CiAgICAgICAgfSwgMTUwMCk7CiAgICAgIH0KICAgICAgZWxzZQogICAgICB7CiAgICAgICAgY2hhbmdlVXNlckRldGFpbHMoJGh0dHAsJHNjb3BlLCRzY29wZS51c2VyUHJvcGVydGllc1swXS5maXJzdF9uYW1lLCRzY29wZS51c2VyUHJvcGVydGllc1swXS5sYXN0X25hbWUsICRzY29wZS51c2VyUHJvcGVydGllc1swXS5lbWFpbF9hZGRyZXNzLGNoYW5nZVVzZXJEZXRhaWxzX3N1Y2Nlc3MsIGNoYW5nZVVzZXJEZXRhaWxzX2ZhaWx1cmUpOwogICAgICAgICRzY29wZS5hamF4X2luZm89Itee16LXk9eb158g16nXmdeg15XXmdeZ150uLi4iOwogICAgICB9CgogICAgICBmdW5jdGlvbiBjaGFuZ2VVc2VyRGV0YWlsc19zdWNjZXNzKCkKICAgICAgewogICAgICAgIGxvZ0RlYnVnKCJjaGFuZ2VVc2VyRGV0YWlsc19zdWNjZXNzIik7CiAgICAgICAgJHNjb3BlLmFqYXhfaW5mbz0i15TXqdeZ16DXldeZ15nXnSDXoNep157XqNeVINeR15TXptec15fXlCEiOwogICAgICAgICRzY29wZS5pblRoZU1pZGRsZU9mU2F2ZT1mYWxzZTsKICAgICAgICAkdGltZW91dChmdW5jdGlvbigpCiAgICAgICAgewogICAgICAgICAgJHNjb3BlLmFqYXhfaW5mbz1udWxsOwogICAgICAgIH0sIDE1MDApOwogICAgICAgIGdldExvZ2dlZFVzZXJJbmZvKCRodHRwLCRzY29wZSwndXNlclByb3BlcnRpZXMnLGdldExvZ2dlZFVzZXJJbmZvX3N1Y2Nlc3MsZ2V0TG9nZ2VkVXNlckluZm9fZmFpbHVyZSk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gY2hhbmdlVXNlckRldGFpbHNfZmFpbHVyZSgpCiAgICAgIHsKICAgICAgICBsb2dEZWJ1ZygiY2hhbmdlVXNlckRldGFpbHNfZmFpbHVyZSIpOwogICAgICB9CgogICAgfQogICAgZWxzZQogICAgewogICAgICAvLyB1cGRhdGUgdXNlciBpbmZvIC0gYWZ0ZXIgdmVyaWZ5aW5nIHBhc3N3b3JkCiAgICAgIGNvbnNvbGUubG9nKCJwaG9uZSBjaGFuZ2VkLCBjaGVja2luZyBpZiBuZXcgcGhvbmUgaXMgaW4gZGVzY2VudCBmb3JtYXQiKTsKICAgICAgaWYgKCFjaGVja1Bob25lTnVtYmVyKCRzY29wZS51c2VyUHJvcGVydGllc1swXS5waG9uZV9udW1iZXIpKQogICAgICB7CiAgICAgICAgJHNjb3BlLmFqYXhfaW5mbz0i15DXoNeQINeU15bXnyDXnteh16TXqCDXmNec16TXldefINeh15zXldec16jXmSDXqten15nXnyDXnNen15HXnNeqINeU15XXk9ei15XXqiDXnten15nXldeWLiI7CiAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKQogICAgICAgIHsKICAgICAgICAgICRzY29wZS5hamF4X2luZm89bnVsbDsKICAgICAgICB9LCAzMDAwKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgY29uc29sZS5sb2coInBob25lIGNoYW5nZWQsIGNoZWNraW5nIGlmIG5ldyBwaG9uZSBpcyBub3QgdXNlZCBhbHJlYWR5Iik7CiAgICAgIGlzTmV3UGhvbmVVc2VkSWZOb3RTZW5kU01TKCRodHRwLCRzY29wZSwkc2NvcGUudXNlclByb3BlcnRpZXNbMF0ucGhvbmVfbnVtYmVyLCBpc05ld1Bob25lVXNlZF9zdWNjZXNzLCBpc05ld1Bob25lVXNlZF9mYWlsdXJlLGZhbHNlKTsKICAgICAgZnVuY3Rpb24gaXNOZXdQaG9uZVVzZWRfc3VjY2VzcyhyZXNwb25zZSkKICAgICAgewogICAgICAgIGNvbnNvbGUubG9nKCJwaG9uZSBub3QgdXNlZCAtIHByb21wdGluZyBmb3IgcGFzc3dvcmQiKTsKICAgICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAgICAgICAgICAgYW5pbWF0aW9uOiBmYWxzZSwKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnbW9kYWxfY2hlY2tfcGFzc3dvcmRfdXBkYXRlX2NvbmZpZy5waHAnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnbW9kYWxfY2hlY2tfcGFzc3dvcmRfdXBkYXRlX2NvbmZpZycsCiAgICAgICAgICAgIHNpemU6ICdsJywKICAgICAgICAgICAgcmVzb2x2ZTogewogICAgICAgICAgICAgIG5ld191c2VyX3Byb2VydGllczogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUudXNlclByb3BlcnRpZXNbMF07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIG1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7CiAgICAgICAgICAgIGxvZ0RlYnVnKCdtb2RhbF9jaGVja19wYXNzd29yZF91cGRhdGVfY29uZmlnIE1vZGFsIGZpbmlzaGVkIHJlc3VsdDogJyArIHJlc3VsdCk7CiAgICAgICAgICAgICRzY29wZS5hamF4X2luZm89IteU16nXmdeg15XXmdeZ150g16DXqdee16jXlSDXkdeU16bXnNeX15QhIjsKICAgICAgICAgICAgJHNjb3BlLmluVGhlTWlkZGxlT2ZTYXZlPWZhbHNlOwogICAgICAgICAgICBnZXRMb2dnZWRVc2VySW5mbygkaHR0cCwkc2NvcGUsJ3VzZXJQcm9wZXJ0aWVzJyxnZXRMb2dnZWRVc2VySW5mb19zdWNjZXNzLGdldExvZ2dlZFVzZXJJbmZvX2ZhaWx1cmUpOwogICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAkc2NvcGUuYWpheF9pbmZvPW51bGw7CiAgICAgICAgICAgIH0sIDMwMDApOwogICAgICAgIH0sIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAkc2NvcGUuaW5UaGVNaWRkbGVPZlNhdmU9ZmFsc2U7CiAgICAgICAgICAgIGxvZ0RlYnVnKCdtb2RhbF9jaGVja19wYXNzd29yZF91cGRhdGVfY29uZmlnIE1vZGFsIGRpc21pc3NlZCBhdDogJyArIG5ldyBEYXRlKCkpOwogICAgICAgIH0pOwogICAgICB9CgogICAgICBmdW5jdGlvbiBpc05ld1Bob25lVXNlZF9mYWlsdXJlKHJlc3BvbnNlKQogICAgICB7CiAgICAgICAgJHNjb3BlLmFqYXhfaW5mbz1yZXNwb25zZS5tZXNzYWdlOwogICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkKICAgICAgICB7CiAgICAgICAgICAkc2NvcGUuYWpheF9pbmZvPW51bGw7CiAgICAgICAgfSwgMjAwMCk7CiAgICAgIH0KICAgIH0KICB9Owp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ21vZGFsX2NoZWNrX3Bhc3N3b3JkX3VwZGF0ZV9jb25maWcnLCBmdW5jdGlvbigkc2NvcGUsICR0aW1lb3V0LCAkdWliTW9kYWxJbnN0YW5jZSwgbmV3X3VzZXJfcHJvZXJ0aWVzLCAkaHR0cCkKewogICRzY29wZS5uZXdfdXNlcl9wcm9lcnRpZXM9bmV3X3VzZXJfcHJvZXJ0aWVzOwogIGxvZ0RlYnVnKCJtb2RhbF9jaGVja19wYXNzd29yZF91cGRhdGVfY29uZmlnIGNvbnRyb2xsZXIiKTsKICAvLyAkc2NvcGUucGhvbmVfdmVyaWZpY2F0aW9uID0ge307IC8vIHRoZXNlIGFyZSB0aGUgY29tcGxldGUgZGV0YWlscyBmb3IgdGhlIG5ldyBldmVudCAvLwogIC8vICRzY29wZS5waG9uZV92ZXJpZmljYXRpb24ucGhvbmVfbnVtYmVyPW5ld191c2VyX3Byb2VydGllcy5waG9uZV9udW1iZXI7CiAgJHNjb3BlLmNsb3NlID0gZnVuY3Rpb24oKSB7CiAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCdkaXNtaXNzJyk7CiAgfTsKCiAgJHNjb3BlLmNoYW5nZVBob25lTnVtYmVyID0gZnVuY3Rpb24oKQogIHsKICAgIGNoYW5nZVVzZXJEZXRhaWxzVmVyaWZ5KCRodHRwLCRzY29wZSwkc2NvcGUubmV3X3VzZXJfcHJvZXJ0aWVzLnBob25lX251bWJlciwkc2NvcGUubmV3X3VzZXJfcHJvZXJ0aWVzLmZpcnN0X25hbWUsJHNjb3BlLm5ld191c2VyX3Byb2VydGllcy5sYXN0X25hbWUsICRzY29wZS5uZXdfdXNlcl9wcm9lcnRpZXMuZW1haWxfYWRkcmVzcywkc2NvcGUudmVyaWZ5X3VzZXJfcGFzc3dvcmQsJHNjb3BlLnBob25lX3ZlcmlmaWNhdGlvbixjaGFuZ2VVc2VyRGV0YWlsc1ZlcmlmeV9zdWNjZXNzLCBjaGFuZ2VVc2VyRGV0YWlsc1ZlcmlmeV9mYWlsdXJlLGZhbHNlKTsKICAgIGZ1bmN0aW9uIGNoYW5nZVVzZXJEZXRhaWxzVmVyaWZ5X3N1Y2Nlc3MoKQogICAgewogICAgICBsb2dEZWJ1ZygiY2hhbmdlVXNlckRldGFpbHNWZXJpZnlfc3VjY2VzcyIpOwogICAgICAvLyBhbGVydCgn15TXqdeZ16DXldeZ15nXnSDXoteV15PXm9eg15Ug15HXlNem15zXl9eUJyk7CiAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKHRydWUpOwogICAgfQogICAgZnVuY3Rpb24gY2hhbmdlVXNlckRldGFpbHNWZXJpZnlfZmFpbHVyZShyZXNwb25zZSkKICAgIHsKICAgICAgbG9nRGVidWcoImNoYW5nZVVzZXJEZXRhaWxzVmVyaWZ5X2ZhaWx1cmUgIityZXNwb25zZS5tZXNzYWdlKTsKICAgICAgJHNjb3BlLmFqYXhfZXJyb3I9cmVzcG9uc2UubWVzc2FnZSsiLiI7CiAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkKICAgICAgewogICAgICAgICRzY29wZS5hamF4X2Vycm9yPW51bGw7CiAgICAgIH0sIDQwMDApOwogICAgfQogIH0KfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdtb2RhbF9jaGFuZ2VfcGFzc3dvcmQnLCBmdW5jdGlvbigkc2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCB1c2VyX3Bob25lX251bWJlciwgJGh0dHApCnsKICBsb2dEZWJ1ZygibW9kYWxfY2hhbmdlX3Bhc3N3b3JkIGNvbnRyb2xsZXIiKTsKICAkc2NvcGUucGhvbmVfdmVyaWZpY2F0aW9uID0ge307IC8vIHRoZXNlIGFyZSB0aGUgY29tcGxldGUgZGV0YWlscyBmb3IgdGhlIG5ldyBldmVudCAvLwogICRzY29wZS5waG9uZV92ZXJpZmljYXRpb24ucGhvbmVfbnVtYmVyPXVzZXJfcGhvbmVfbnVtYmVyOwogICRzY29wZS5waG9uZV92ZXJpZmljYXRpb24uc21zX2Vycm9yPSIiOwogICRzY29wZS5jbG9zZSA9IGZ1bmN0aW9uKCkgewogICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnZGlzbWlzcycpOwogIH07CgogICRzY29wZS5jaGFuZ2VQYXNzd29yZCA9IGZ1bmN0aW9uKCkKICB7CiAgICBjaGFuZ2VQYXNzd29yZCgkaHR0cCwkc2NvcGUsJHNjb3BlLnBob25lX3ZlcmlmaWNhdGlvbi51c2VyX3Bhc3N3b3JkLCRzY29wZS5waG9uZV92ZXJpZmljYXRpb24udXNlcl9wYXNzd29yZDIsJHNjb3BlLnBob25lX3ZlcmlmaWNhdGlvbi52ZXJpZmljYXRpb25fY29kZSwgY2hhbmdlUGFzc3dvcmRfc3VjY2VzcywgY2hhbmdlUGFzc3dvcmRfZmFpbHVyZSxmYWxzZSk7CiAgICAkc2NvcGUuYWpheF9lcnJvcj0iIjsKICAgIGZ1bmN0aW9uIGNoYW5nZVBhc3N3b3JkX3N1Y2Nlc3MoKQogICAgewogICAgICBsb2dEZWJ1ZygiY2hhbmdlUGFzc3dvcmRfc3VjY2VzcyIpOwogICAgICBzdGF0dXM9ImZmZmZmIjsKICAgICAgLy8gYWxlcnQoJ9eU16HXmdeh157XkCDXoteV15PXm9eg15Qg15HXlNem15zXl9eUJyk7CiAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKHRydWUpOwogICAgfQogICAgZnVuY3Rpb24gY2hhbmdlUGFzc3dvcmRfZmFpbHVyZShyZXNwb25zZSkKICAgIHsKICAgICAgbG9nRGVidWcoImNoYW5nZVBhc3N3b3JkX2ZhaWx1cmUgIityZXNwb25zZS5tZXNzYWdlKTsKICAgICAgJHNjb3BlLmFqYXhfZXJyb3I9cmVzcG9uc2UubWVzc2FnZTsKICAgIH0KICB9Cn0pOwoKa3V6ZUFwcC5mYWN0b3J5KCdCdXNpbmVzc0NvbmZpZycsIGZ1bmN0aW9uKCRodHRwKSB7CiAgICByZXR1cm4gewogICAgICAgIGdldDogZnVuY3Rpb24gKCkgewogICAgICAgICAgbG9nRGVidWcoImxvYWQgZ2V0X2J1c2luZXNzX2NvbmZpZyIpOwogICAgICAgICAgcmV0dXJuICRodHRwLmdldCgiL2FwaS9hZG1pbi9idXNpbmVzc19jb25maWciKQogICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkgewogICAgICAgICAgICAgIHJlc3VsdCA9IHJlc3BvbnNlLmRhdGFbMF07CiAgICAgICAgICAgICAgcmVzdWx0LnVzZV9ob2xpZGF5cz0hIXBhcnNlSW50KHJlc3BvbnNlLmRhdGFbMF0udXNlX2hvbGlkYXlzKTsKICAgICAgICAgICAgICByZXN1bHQuc21zX25vdGlmaWNhdGlvbnM9ISFwYXJzZUludChyZXNwb25zZS5kYXRhWzBdLnNtc19ub3RpZmljYXRpb25zKTsKICAgICAgICAgICAgICByZXN1bHQuc3RhcnRfaW52b2ljZV9udW1iZXIgPSBwYXJzZUludChyZXNwb25zZS5kYXRhWzBdLnN0YXJ0X2ludm9pY2VfbnVtYmVyKTsKICAgICAgICAgICAgICB2YXIgZCA9IG5ldyBEYXRlKCk7CiAgICAgICAgICAgICAgZC5zZXRIb3VycyggcmVzdWx0LmNhbGVuZGFyX2Rpc3BsYXlfc3RhcnRfaG91cnMgKTsKICAgICAgICAgICAgICBkLnNldE1pbnV0ZXMoIHJlc3VsdC5jYWxlbmRhcl9kaXNwbGF5X3N0YXJ0X21pbnV0ZXMgKTsKICAgICAgICAgICAgICByZXN1bHQubXl0aW1lID0gZDsKICAgICAgICAgICAgICByZXN1bHQuY2FsZW5kYXJfZGlzcGxheV9zdGFydCA9IGQ7CiAgICAgICAgICAgICAgdmFyIGQgPSBuZXcgRGF0ZSgpOwogICAgICAgICAgICAgIGQuc2V0SG91cnMoIHJlc3VsdC5jYWxlbmRhcl9kaXNwbGF5X2VuZF9ob3VycyApOwogICAgICAgICAgICAgIGQuc2V0TWludXRlcyggcmVzdWx0LmNhbGVuZGFyX2Rpc3BsYXlfZW5kX21pbnV0ZXMgKTsKICAgICAgICAgICAgICByZXN1bHQubXl0aW1lID0gZDsKICAgICAgICAgICAgICByZXN1bHQuY2FsZW5kYXJfZGlzcGxheV9lbmQgPSBkOwogICAgICAgICAgICAgIHJlc3VsdC52YXRfcmF0ZSA9IE51bWJlcihyZXN1bHQudmF0X3JhdGUpOwogICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9Owp9KTsKCmt1emVBcHAuY29udHJvbGxlcignQ29uZmlnQnVzaW5lc3NDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJHRpbWVvdXQsIEJ1c2luZXNzQ29uZmlnKQp7CiAgbG9nRGVidWcoIm15IGJ1c2luZXNzIGNvbmZpZyIpOwogICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzPVtdOwoKICBmdW5jdGlvbiBnZXRfYnVzaW5lc3NfY29uZmlnKCkgewogICAgbG9nRGVidWcoImdldF9idXNpbmVzc19jb25maWciKTsKICAgIGxvZ0RlYnVnKCJCdXNpbmVzc0NvbmZpZzogIiwgQnVzaW5lc3NDb25maWcpOwogICAgQnVzaW5lc3NDb25maWcuZ2V0KCkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7ICRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMgPSByZXN1bHQ7IH0pOwogIH0KICBnZXRfYnVzaW5lc3NfY29uZmlnKCk7CgoKICAkc2NvcGUuaHN0ZXAgPSAxOwogICRzY29wZS5tc3RlcCA9IDE1OwoKICAgICRzY29wZS5idXNpbmVzc0NvbmZpZ0NhbmNlbCA9IGZ1bmN0aW9uKCkgewogICAgICB3aW5kb3cuaGlzdG9yeS5iYWNrKCk7CiAgICB9OwoKICAgICRzY29wZS51cGRhdGVCdXNpbmVzc0NvbmZpZyA9IGZ1bmN0aW9uKCkgewogICAgICAgIGxvZ0RlYnVnKCJ1cGRhdGluZyBidXNpbmVzcyBjb25maWciICsgSlNPTi5zdHJpbmdpZnkoJHNjb3BlLmJ1c2luZXNzUHJvcGVydGllcykpOwoKICAgICAgICAkc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzX2FqYXhfZXJyb3I9IiI7CiAgICAgICAgJHNjb3BlLmJ1c2luZXNzUHJvcGVydGllcy5jYWxlbmRhcl9kaXNwbGF5X3N0YXJ0X2hvdXJzPSRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMuY2FsZW5kYXJfZGlzcGxheV9zdGFydC5nZXRIb3VycygpOwogICAgICAgICRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMuY2FsZW5kYXJfZGlzcGxheV9zdGFydF9taW51dGVzPSRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMuY2FsZW5kYXJfZGlzcGxheV9zdGFydC5nZXRNaW51dGVzKCk7CiAgICAgICAgJHNjb3BlLmJ1c2luZXNzUHJvcGVydGllcy5jYWxlbmRhcl9kaXNwbGF5X2VuZF9ob3Vycz0kc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzLmNhbGVuZGFyX2Rpc3BsYXlfZW5kLmdldEhvdXJzKCk7CiAgICAgICAgJHNjb3BlLmJ1c2luZXNzUHJvcGVydGllcy5jYWxlbmRhcl9kaXNwbGF5X2VuZF9taW51dGVzPSRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMuY2FsZW5kYXJfZGlzcGxheV9lbmQuZ2V0TWludXRlcygpOwogICAgICAgIGlmICgkc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzLmNhbGVuZGFyX2Rpc3BsYXlfc3RhcnRfaG91cnM+JHNjb3BlLmJ1c2luZXNzUHJvcGVydGllcy5jYWxlbmRhcl9kaXNwbGF5X2VuZF9ob3VycykKICAgICAgICB7CiAgICAgICAgICBhbGVydCgn15bXntefINeh15nXldedINec15Ag15nXm9eV15wg15zXlNeZ15XXqiDXnNek16DXmSDXltee158g15TXqteX15zXlCcpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICAkc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzX2FqYXhfZXJyb3I9Itee16LXk9eb158g16DXqteV16DXmdedLi4uIjsKCiAgICAgICAgJGh0dHAoewogICAgICAgICAgICBtZXRob2Q6ICdQT1NUJywKICAgICAgICAgICAgdXJsOiAnL2FwaS9hZG1pbi9idXNpbmVzc19jb25maWcvc2V0JywKICAgICAgICAgICAgZGF0YTogJHNjb3BlLmJ1c2luZXNzUHJvcGVydGllcywgLy8gcGFzcyBpbiBkYXRhIGFzIHN0cmluZ3MKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uO2NoYXJzZXQ9dXRmLTgnCiAgICAgICAgICAgIH0KICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHsKCiAgICAgICAgICAgIGxvZ0RlYnVnKGRhdGEpOwogICAgICAgICAgICBpZiAoIWRhdGEuc3VjY2VzcykgewogICAgICAgICAgICAgICAgbG9nRGVidWcoImVycm9yICIgKyBkYXRhLk1lc3NhZ2UpOwogICAgICAgICAgICAgICAgJHNjb3BlLmJ1c2luZXNzUHJvcGVydGllc19hamF4X2Vycm9yID0gZGF0YS5NZXNzYWdlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJGdDYWxlbmRhckRpc3BsYXlNaW5UaW1lPWRhdGEuanNvbi5uZXdTdGFydFRpbWU7CiAgICAgICAgICAgICAgICAkZ0NhbGVuZGFyRGlzcGxheU1heFRpbWU9ZGF0YS5qc29uLm5ld0VuZFRpbWU7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygidXBkYXRlZCBnQ2FsZW5kYXJEaXNwbGF5TWluVGltZT0iKyRnQ2FsZW5kYXJEaXNwbGF5TWluVGltZSk7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygidXBkYXRlZCBnQ2FsZW5kYXJEaXNwbGF5TWF4VGltZT0iKyRnQ2FsZW5kYXJEaXNwbGF5TWF4VGltZSk7CiAgICAgICAgICAgICAgICAkc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzX2FqYXhfZXJyb3I9Itei15XXk9eb158g15HXlNem15zXl9eUISI7CiAgICAgICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXNfYWpheF9lcnJvcj1udWxsOwogICAgICAgICAgICAgICAgfSwgMjAwMCk7CiAgICAgICAgICAgICAgICBnZXRfYnVzaW5lc3NfY29uZmlnKCk7CiAgICAgICAgICAgICAgICAvLyB3aW5kb3cuaGlzdG9yeS5iYWNrKCk7CiAgICAgICAgICAgICAgICAvLyAkc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzX2FqYXhfZXJyb3IgPSAi16TXqNeY15kg15TXoteh16cg16DXqdee16jXlSDXkdeU16bXnNeX15QuIjsKCiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH07Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignY2xpZW50Q2FyZENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUpIHsKICAgIGxvZ0RlYnVnKCJjbGllbnRDYXJkQ29udHJvbGxlciIpOwogICAgJHNjb3BlLmZ1dHVyZU1lZXRpbmdzID0gW3sKICAgICAgICBkYXRldGltZTogIteo15DXqdeV158sIDI1LjEuMjAxNiIsCiAgICAgICAgaG91cjogIjE0OjAwIiwKICAgICAgICB0eXBlOiAi16fXkdeV16bXlCIsCiAgICAgICAgcHJpY2U6ICIxMDAiLAogICAgICAgIGxhYmVsczogW3sKICAgICAgICAgICAgbGFiZWw6ICJzdWNjZXNzIiwKICAgICAgICAgICAgdGV4dDogItep15XXnNedIgogICAgICAgIH0sIHsKICAgICAgICAgICAgbGFiZWw6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgdGV4dDogItec15Ag16rXldei15MiCiAgICAgICAgfV0KICAgIH0sIHsKICAgICAgICBkYXRldGltZTogIteo15DXqdeV158sIDI1LjEuMjAxNiIsCiAgICAgICAgaG91cjogIjE0OjAwIiwKICAgICAgICB0eXBlOiAi16fXkdeV16bXlCIsCiAgICAgICAgcHJpY2U6ICIxMDAiLAogICAgICAgIGxhYmVsczogW3sKICAgICAgICAgICAgbGFiZWw6ICJkYW5nZXIiLAogICAgICAgICAgICB0ZXh0OiAi15zXkCDXqdeV15zXnSIKICAgICAgICB9LCB7CiAgICAgICAgICAgIGxhYmVsOiAiaW5mbyIsCiAgICAgICAgICAgIHRleHQ6ICLXqteV16LXkyIKICAgICAgICB9XQogICAgfSwgewogICAgICAgIGRhdGV0aW1lOiAi16nXnNeZ16nXmSwgMjUuMS4yMDE2IiwKICAgICAgICBob3VyOiAiMTQ6MDAiLAogICAgICAgIHR5cGU6ICLXp9eR15XXpteUIiwKICAgICAgICBwcmljZTogIjEwMCIsCiAgICAgICAgbGFiZWxzOiBbewogICAgICAgICAgICBsYWJlbDogImRhbmdlciIsCiAgICAgICAgICAgIHRleHQ6ICLXnNeQINep15XXnNedIgogICAgICAgIH0sIHsKICAgICAgICAgICAgbGFiZWw6ICJpbmZvIiwKICAgICAgICAgICAgdGV4dDogIteq15XXoteTIgogICAgICAgIH1dCiAgICB9LCB7CiAgICAgICAgZGF0ZXRpbWU6ICLXqNeQ16nXldefLCAyNS4xLjIwMTYiLAogICAgICAgIGhvdXI6ICIxNDowMCIsCiAgICAgICAgdHlwZTogIten15HXldem15QiLAogICAgICAgIHByaWNlOiAiMTAwIgogICAgfSwgXQoKICAgICRzY29wZS5oaXN0b3J5TWVldGluZ3MgPSBbewogICAgICAgIGRhdGV0aW1lOiAi16jXkNep15XXnywgMjUuMS4yMDE2IiwKICAgICAgICBob3VyOiAiMTQ6MDAiLAogICAgICAgIHR5cGU6ICLXp9eR15XXpteUIiwKICAgICAgICBwcmljZTogIjEwMCIKICAgIH0sIHsKICAgICAgICBkYXRldGltZTogIteo15DXqdeV158sIDI1LjEuMjAxNiIsCiAgICAgICAgaG91cjogIjE0OjAwIiwKICAgICAgICB0eXBlOiAi16fXkdeV16bXlCIsCiAgICAgICAgcHJpY2U6ICIxMDAiCiAgICB9LCB7CiAgICAgICAgZGF0ZXRpbWU6ICLXqdec15nXqdeZLCAyNS4xLjIwMTYiLAogICAgICAgIGhvdXI6ICIxNDowMCIsCiAgICAgICAgdHlwZTogIten15HXldem15QiLAogICAgICAgIHByaWNlOiAiMTAwIgogICAgfSwgewogICAgICAgIGRhdGV0aW1lOiAi16jXkNep15XXnywgMjUuMS4yMDE2IiwKICAgICAgICBob3VyOiAiMTQ6MDAiLAogICAgICAgIHR5cGU6ICLXp9eR15XXpteUIiwKICAgICAgICBwcmljZTogIjEwMCIKICAgIH0sIF0KCiAgICAkc2NvcGUuY2NQYXltZW50cyA9IFt7CiAgICAgICAgZGF0ZXRpbWU6ICLXqNeQ16nXldefLCAyNS4xLjIwMTYiLAogICAgICAgIHJlY2lwdF9udW06ICI3NjciLAogICAgICAgIGFtb3VudDogIjMwMCIsCiAgICAgICAgbGFiZWxzOiBbewogICAgICAgICAgICBsYWJlbDogImRhbmdlciIsCiAgICAgICAgICAgIHRleHQ6ICLXnNeQINep15XXmdeZ15oiCiAgICAgICAgfSwgewogICAgICAgICAgICBsYWJlbDogImluZm8iLAogICAgICAgICAgICB0ZXh0OiAi15TXldek16fXkyIKICAgICAgICB9XQogICAgfSwgXQoKCn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdrdXplQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikgewoKICAgIC8vIG1haW4ga3V6ZSBjb250cm9sbGVyCgogICAgLy8gTVVTVCBTRVQgTEFOR1VBR0UgQkVGT1JFIEFOWSBPVEhFUiBPUEVSQVRJT04gISEhCiAgICB1cGRhdGVHbG9iYWxMYW5ndWFnZSgkc2NvcGUsICRnRGVmYXVsdExhbmcpOwogICAgLy8gTVVTVCBTRVQgTEFOR1VBR0UgQkVGT1JFIEFOWSBPVEhFUiBPUEVSQVRJT04gISEhCgogICAgLy8gbG9nRGVidWcoInh4eHh4eHh4IiArICRzY29wZS5sYW5nZmlsZVsnc2hvd19hbGxfY2xpZW50cyddKTsKCiAgICAkc2NvcGUuc2hvd0NsaWVudHNDb2x1bW5zID0gW3sKICAgICAgICBmaWVsZDogJ3VzZXJfaWQnLAogICAgICAgIG5hbWU6ICRzY29wZS5sYW5nZmlsZVsnc2hvd19hbGxfY2xpZW50c191c2VyaWQnXQogICAgfSwgewogICAgICAgIGZpZWxkOiAnYnVzZXJfZmlyc3RfbmFtZScsCiAgICAgICAgbmFtZTogJHNjb3BlLmxhbmdmaWxlWydzaG93X2FsbF9jbGllbnRzX2ZpcnN0X25hbWUnXQogICAgfSwgewogICAgICAgIGZpZWxkOiAnYnVzZXJfbGFzdF9uYW1lJywKICAgICAgICBuYW1lOiAkc2NvcGUubGFuZ2ZpbGVbJ3Nob3dfYWxsX2NsaWVudHNfbGFzdF9uYW1lJ10KICAgIH0sIHsKICAgICAgICBmaWVsZDogJ3JvbGVfbmFtZScsCiAgICAgICAgbmFtZTogJHNjb3BlLmxhbmdmaWxlWydzaG93X2FsbF9jbGllbnRzX2FwcHJvdmVkJ10KICAgIH1dOwoKCiAgICAkc2NvcGUuZ3JpZENsaWVudENsaWNrID0gZnVuY3Rpb24ocm93KSB7CiAgICAgICAgLy9sb2dEZWJ1Zyhyb3cpOwogICAgICAgIHZhciByb3dfdXNlcmlkID0gcm93LmVudGl0eS51c2VyX2lkOwogICAgICAgIGxvZ0RlYnVnKCJzZWxlY3RlZCByb3cgdXNlcl9pZCA9IiArIHJvd191c2VyaWQpOwogICAgICAgICRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfY2xpZW50cy8nICsgcm93X3VzZXJpZCk7CiAgICB9OwoKICAgICRzY29wZS5zaG93Q2xpZW50c0dyaWRPcHRpb25zID0gewogICAgICAgIGVuYWJsZUZpbHRlcmluZzogZmFsc2UsCiAgICAgICAgZW5hYmxlU29ydGluZzogdHJ1ZSwKICAgICAgICBjb2x1bW5EZWZzOiAkc2NvcGUuc2hvd0NsaWVudHNDb2x1bW5zLAogICAgICAgIHJvd1RlbXBsYXRlOiAnL3B1YmxpYy9jb21wb25lbnRzL2NsaWVudHMtZ3JpZC1yb3cuaHRtbCcsCiAgICAgICAgb25SZWdpc3RlckFwaTogZnVuY3Rpb24oZ3JpZEFwaSkgewogICAgICAgICAgICAkc2NvcGUuZ3JpZEFwaSA9IGdyaWRBcGk7CiAgICAgICAgICAgICRzY29wZS5ncmlkQXBpLmdyaWQucmVnaXN0ZXJSb3dzUHJvY2Vzc29yKCRzY29wZS5zaW5nbGVGaWx0ZXIsIDIwMCk7CiAgICAgICAgfSwKICAgIH07CgogICAgJHNjb3BlLmlzQWN0aXZlID0gZnVuY3Rpb24odmlld0xvY2F0aW9uKSB7CiAgICAgICAgbG9nRGVidWcoInZpZXdMb2NhdGlvbiA9ICIgKyB2aWV3TG9jYXRpb24pOwogICAgICAgIHZhciBhY3RpdmUgPSAodmlld0xvY2F0aW9uID09PSAkbG9jYXRpb24ucGF0aCgpKTsKICAgICAgICByZXR1cm4gYWN0aXZlOwogICAgfTsKCiAgICAkc2NvcGUuZmlsdGVyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgbG9nRGVidWcoInNpbmdsZSBmaWx0ZXIiKTsKICAgICAgICAkc2NvcGUuZ3JpZEFwaS5ncmlkLnJlZnJlc2goKTsKICAgICAgICBpZiAoJHNjb3BlLmZpbHRlci5WYWx1ZSAhPSAiIikgewogICAgICAgICAgICAkc2NvcGUuZmlsdGVyLmJ1dHRvblZhbHVlID0gIiciICsgJHNjb3BlLmZpbHRlci5WYWx1ZSArICInIjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkc2NvcGUuZmlsdGVyLmJ1dHRvblZhbHVlID0gIiI7CiAgICAgICAgfQogICAgfTsKCiAgICAkc2NvcGUuc2luZ2xlRmlsdGVyID0gZnVuY3Rpb24ocmVuZGVyYWJsZVJvd3MpIHsKICAgICAgICB2YXIgbWF0Y2hlciA9IG5ldyBSZWdFeHAoJHNjb3BlLmZpbHRlci5WYWx1ZSk7CiAgICAgICAgbG9nRGVidWcoInNjb3BlPSIgKyAkc2NvcGUpOwogICAgICAgIGxvZ0RlYnVnKCJzY29wZS5maWx0ZXIuVmFsdWU9IiArICRzY29wZS5maWx0ZXIuVmFsdWUpOwogICAgICAgIGlmICgoJHNjb3BlLmZpbHRlci5WYWx1ZSA9PSBudWxsKSB8fCAoJHNjb3BlLmZpbHRlci5WYWx1ZSA9PSAiIikpIHsKICAgICAgICAgICAgbG9nRGVidWcoImVtcHR5IGZpbHRlciIpOwogICAgICAgICAgICByZXR1cm4gcmVuZGVyYWJsZVJvd3M7CiAgICAgICAgfQogICAgICAgIHJlbmRlcmFibGVSb3dzLmZvckVhY2goZnVuY3Rpb24ocm93KSB7CiAgICAgICAgICAgIC8vCQkJbG9nRGVidWcoInJvdz0iK3Jvdyk7CiAgICAgICAgICAgIHJvdy52aXNpYmxlID0gZmFsc2U7CiAgICAgICAgICAgIHZhciAkY3VyckZpcnN0TmFtZSA9IHJvdy5lbnRpdHlbJ2ZpcnN0X25hbWUnXTsKICAgICAgICAgICAgdmFyICRjdXJyTGFzdE5hbWUgPSByb3cuZW50aXR5WydsYXN0X25hbWUnXTsKICAgICAgICAgICAgbG9nRGVidWcoImN1cnJGaXJzdE5hbWU9IiArICRjdXJyRmlyc3ROYW1lKTsKCiAgICAgICAgICAgIGlmICgkY3VyckZpcnN0TmFtZSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoJGN1cnJGaXJzdE5hbWUuaW5kZXhPZigkc2NvcGUuZmlsdGVyLlZhbHVlKSA+IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgcm93LnZpc2libGUgPSB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgLy8gcm93IGlzIG51bGwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgcm93LnZpc2libGUgPSBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCRjdXJyTGFzdE5hbWUgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKCRjdXJyTGFzdE5hbWUuaW5kZXhPZigkc2NvcGUuZmlsdGVyLlZhbHVlKSA+IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgcm93LnZpc2libGUgPSB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgLy8gcm93IGlzIG51bGwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgcm93LnZpc2libGUgPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHJldHVybiByZW5kZXJhYmxlUm93czsKICAgIH07CgogICAgLy8gaW1wb3J0YW50ISEgaW5pdGlhbGl6aW5nIGFuZ3VsYXIgZm9ybXMgYXMgYXJyYXlzCiAgICAkc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIgPSB7fTsKICAgICRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhciA9IHt9OwoKICAgIC8vIGxvZ0RlYnVnKCJsb2NhdGlvbj0iICsgJGxvY2F0aW9uKTsKICAgIC8vIGxvZ0RlYnVnKCRsb2NhdGlvbik7CgogICAgJHNjb3BlLmNoYW5nZUxhbmcgPSBmdW5jdGlvbigkbmV3bGFuZykgewogICAgICAgIGxvZ0RlYnVnKCRuZXdsYW5nKTsKICAgICAgICAvLyRzY29wZS5zcENsYXNzID0gJ3JpZ2h0JzsKICAgICAgICB1cGRhdGVHbG9iYWxMYW5ndWFnZSgkc2NvcGUsICRuZXdsYW5nKQogICAgfQoKICAgICRzY29wZS5hZGROZXdDbGllbnQgPSBmdW5jdGlvbigpIHsKICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2NsaWVudHMvYWRkJyk7CiAgICB9CiAgICAkc2NvcGUuYWRkTmV3SW5zdHJ1Y3RvciA9IGZ1bmN0aW9uKCkgewogICAgICAgICRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfaW5zdHJ1Y3RvcnMvYWRkJyk7CiAgICB9Cn0pOwoKLy8vLy8vIGJlZm9yZSBmb3JtcwprdXplQXBwLmNvbnRyb2xsZXIoJ0RlbW9Db250cm9sbGVyJywgWwogICAgJyRzY29wZScsICckYnVpbGRlcicsICckdmFsaWRhdG9yJywKICAgIGZ1bmN0aW9uKCRzY29wZSwgJGJ1aWxkZXIsICR2YWxpZGF0b3IpIHsKICAgICAgICB2YXIgY2hlY2tib3gsIHRleHRib3g7CiAgICAgICAgdGV4dGJveCA9ICRidWlsZGVyLmFkZEZvcm1PYmplY3QoJ2RlZmF1bHQnLCB7CiAgICAgICAgICAgIGlkOiAndGV4dGJveCcsCiAgICAgICAgICAgIGNvbXBvbmVudDogJ3RleHRJbnB1dCcsCiAgICAgICAgICAgIGxhYmVsOiAnTmFtZScsCiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnWW91ciBuYW1lJywKICAgICAgICAgICAgcGxhY2Vob2xkZXI6ICdZb3VyIG5hbWUnLAogICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgZWRpdGFibGU6IGZhbHNlCiAgICAgICAgfSk7CiAgICAgICAgY2hlY2tib3ggPSAkYnVpbGRlci5hZGRGb3JtT2JqZWN0KCdkZWZhdWx0JywgewogICAgICAgICAgICBpZDogJ2NoZWNrYm94JywKICAgICAgICAgICAgY29tcG9uZW50OiAnY2hlY2tib3gnLAogICAgICAgICAgICBsYWJlbDogJ1BldHMnLAogICAgICAgICAgICBkZXNjcmlwdGlvbjogJ0RvIHlvdSBoYXZlIGFueSBwZXRzPycsCiAgICAgICAgICAgIG9wdGlvbnM6IFsnRG9nJywgJ0NhdCddCiAgICAgICAgfSk7CiAgICAgICAgJGJ1aWxkZXIuYWRkRm9ybU9iamVjdCgnZGVmYXVsdCcsIHsKICAgICAgICAgICAgY29tcG9uZW50OiAnc2FtcGxlSW5wdXQnCiAgICAgICAgfSk7CiAgICAgICAgJHNjb3BlLmZvcm0gPSAkYnVpbGRlci5mb3Jtc1snZGVmYXVsdCddOwogICAgICAgICRzY29wZS5pbnB1dCA9IFtdOwogICAgICAgICRzY29wZS5kZWZhdWx0VmFsdWUgPSB7fTsKICAgICAgICAkc2NvcGUuZGVmYXVsdFZhbHVlW3RleHRib3guaWRdID0gJ2RlZmF1bHQgdmFsdWUnOwogICAgICAgICRzY29wZS5kZWZhdWx0VmFsdWVbY2hlY2tib3guaWRdID0gW3RydWUsIHRydWVdOwogICAgICAgIHJldHVybiAkc2NvcGUuc3VibWl0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiAkdmFsaWRhdG9yLnZhbGlkYXRlKCRzY29wZSwgJ2RlZmF1bHQnKS5zdWNjZXNzKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGxvZ0RlYnVnKCdzdWNjZXNzJyk7CiAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGxvZ0RlYnVnKCdlcnJvcicpOwogICAgICAgICAgICB9KTsKICAgICAgICB9OwogICAgfQpdKTsKCmt1emVBcHAuY29udHJvbGxlcignQWxlcnREZW1vQ3RybCcsIGZ1bmN0aW9uKCRzY29wZSkgewogICAgJHNjb3BlLmFsZXJ0cyA9IFt7CiAgICAgICAgdHlwZTogJ2RhbmdlcicsCiAgICAgICAgbXNnOiAnT2ggc25hcCEgQ2hhbmdlIGEgZmV3IHRoaW5ncyB1cCBhbmQgdHJ5IHN1Ym1pdHRpbmcgYWdhaW4uJwogICAgfSwgewogICAgICAgIHR5cGU6ICdzdWNjZXNzJywKICAgICAgICBtc2c6ICdXZWxsIGRvbmUhIFlvdSBzdWNjZXNzZnVsbHkgcmVhZCB0aGlzIGltcG9ydGFudCBhbGVydCBtZXNzYWdlLicKICAgIH1dOwoKICAgICRzY29wZS5hZGRBbGVydCA9IGZ1bmN0aW9uKCkgewogICAgICAgICRzY29wZS5hbGVydHMucHVzaCh7CiAgICAgICAgICAgIG1zZzogJ0Fub3RoZXIgYWxlcnQhJwogICAgICAgIH0pOwogICAgfTsKCiAgICAkc2NvcGUuY2xvc2VBbGVydCA9IGZ1bmN0aW9uKGluZGV4KSB7CiAgICAgICAgJHNjb3BlLmFsZXJ0cy5zcGxpY2UoaW5kZXgsIDEpOwogICAgfTsKfSk7CgoKZnVuY3Rpb24gaXNOdW1iZXJLZXkoZXZ0KXsKICAgIHZhciBjaGFyQ29kZSA9IChldnQud2hpY2gpID8gZXZ0LndoaWNoIDogZXZlbnQua2V5Q29kZTsKICAgIHJldHVybiAhKGNoYXJDb2RlID4gMzEgJiYgKGNoYXJDb2RlIDwgNDggfHwgY2hhckNvZGUgPiA1NykpOwp9Cg==</text>
      </register>
      <register name="1" type="2">
        <text encoding="base64">PD9waHAgaW5jbHVkZSAnYnVzaW5lc3MtYXBwLXYxMS5qcycKPz4K</text>
      </register>
      <register name="2" type="2">
        <text encoding="base64">ICAgIGt1emVfdXRpbHM6OmxvZ0RlYnVnKCJVc2VyIGVtYWlsOiAkZW1haWwiKTsK</text>
      </register>
      <register name="r" type="4">
        <keys>
          <key char="64" code="0" mods="0" />
          <key char="116" code="0" mods="0" />
          <key char="119" code="0" mods="0" />
          <key char="105" code="0" mods="0" />
          <key char="123" code="0" mods="0" />
          <key char="32" code="0" mods="0" />
          <key char="116" code="0" mods="0" />
          <key char="121" code="0" mods="0" />
          <key char="65535" code="8" mods="0" />
          <key char="65535" code="8" mods="0" />
          <key char="99" code="0" mods="0" />
          <key char="111" code="0" mods="0" />
          <key char="100" code="0" mods="0" />
          <key char="101" code="0" mods="0" />
          <key char="32" code="0" mods="0" />
          <key char="58" code="0" mods="0" />
          <key char="65535" code="91" mods="130" />
          <key char="65" code="0" mods="0" />
          <key char="44" code="0" mods="0" />
          <key char="65535" code="8" mods="0" />
          <key char="44" code="0" mods="0" />
          <key char="65535" code="91" mods="130" />
          <key char="119" code="0" mods="0" />
          <key char="119" code="0" mods="0" />
          <key char="105" code="0" mods="0" />
          <key char="110" code="0" mods="0" />
          <key char="97" code="0" mods="0" />
          <key char="109" code="0" mods="0" />
          <key char="101" code="0" mods="0" />
          <key char="58" code="0" mods="0" />
          <key char="32" code="0" mods="0" />
          <key char="34" code="0" mods="0" />
          <key char="65535" code="91" mods="130" />
          <key char="65" code="0" mods="0" />
          <key char="34" code="0" mods="0" />
          <key char="65535" code="91" mods="130" />
          <key char="65" code="0" mods="0" />
          <key char="65535" code="10" mods="0" />
          <key char="125" code="0" mods="0" />
          <key char="65535" code="91" mods="130" />
          <key char="97" code="0" mods="0" />
          <key char="44" code="0" mods="0" />
          <key char="65535" code="91" mods="130" />
          <key char="119" code="0" mods="0" />
          <key char="119" code="0" mods="0" />
          <key char="48" code="0" mods="0" />
        </keys>
      </register>
      <register name="3" type="2">
        <text encoding="base64">ICAgIAo=</text>
      </register>
      <register name="4" type="2">
        <text encoding="base64">ICAgIGlmICghJGJ1c2luZXNzX2RldGFpbHNbJ2ludm9pY2Vfc3lzdGVtX2FjY291bnRfaWQnXSkgewogICAgICByZXR1cm4gIiI7CiAgICB9Cg==</text>
      </register>
      <register name="t" type="4">
        <keys>
          <key char="119" code="0" mods="0" />
          <key char="105" code="0" mods="0" />
          <key char="123" code="0" mods="0" />
          <key char="32" code="0" mods="0" />
          <key char="99" code="0" mods="0" />
          <key char="111" code="0" mods="0" />
          <key char="100" code="0" mods="0" />
          <key char="101" code="0" mods="0" />
          <key char="58" code="0" mods="0" />
          <key char="32" code="0" mods="0" />
          <key char="65535" code="91" mods="130" />
          <key char="65" code="0" mods="0" />
          <key char="44" code="0" mods="0" />
          <key char="65535" code="91" mods="130" />
          <key char="119" code="0" mods="0" />
          <key char="119" code="0" mods="0" />
          <key char="105" code="0" mods="0" />
          <key char="110" code="0" mods="0" />
          <key char="97" code="0" mods="0" />
          <key char="109" code="0" mods="0" />
          <key char="101" code="0" mods="0" />
          <key char="58" code="0" mods="0" />
          <key char="32" code="0" mods="0" />
          <key char="34" code="0" mods="0" />
          <key char="65535" code="91" mods="130" />
          <key char="65" code="0" mods="0" />
          <key char="34" code="0" mods="0" />
          <key char="65535" code="91" mods="130" />
          <key char="111" code="0" mods="0" />
          <key char="125" code="0" mods="0" />
          <key char="44" code="0" mods="0" />
          <key char="65535" code="91" mods="130" />
          <key char="119" code="0" mods="0" />
          <key char="119" code="0" mods="0" />
          <key char="48" code="0" mods="0" />
        </keys>
      </register>
      <register name="5" type="2">
        <text encoding="base64">ICAgIGt1emVfdXRpbHM6OmxvZ0RlYnVnKCJBY2NvdW50IGlkIGlzIG5vdyAiIC4gZ2V0dHlwZSgkaW52b2ljZV9kYXRhWydhY2NvdW50X2lkJ10pIC4gIiB2YWx1ZSAke2ludm9pY2VfZGF0YVsnYWNjb3VudF9pZCddfSIpOwo=</text>
      </register>
      <register name="6" type="2">
        <text encoding="base64">ICAgIGlmICghKQo=</text>
      </register>
      <register name="7" type="2">
        <text encoding="base64">ICAgICAga3V6ZV91dGlsczo6bG9nRGVidWcoIkxpbmV0IC9hcGkvY3JlYXRlL2FjY291bnQgcmVzdWx0OiAiIC4gJGludm9pY2VfcmVzdWx0Wydib2R5J11bJ2lkJ10pOwo=</text>
      </register>
      <register name="8" type="2">
        <text encoding="base64">ICAgIGt1emVfdXRpbHM6OmxvZ0RlYnVnKCJTZW5kaW5nIHJlcXVlc3QgdG8gIiAuICRsaW5ldF91cmwpOwo=</text>
      </register>
      <register name="9" type="2">
        <text encoding="base64">QUxURVIgVEFCTEUga3pfYnVzaW5lc3NlcyBBREQgKAogIGludm9pY2Vfc3lzdGVtX2FjY291bnRfaWQgSU5UCiAgKTsK</text>
      </register>
      <register name=":" type="4">
        <text>%s/&quot;yPos&quot;: 0.20000000298023225/&quot;yPos&quot;: 0.1/</text>
      </register>
    </registers>
    <search>
      <last-search>\cUser</last-search>
      <last-offset />
      <last-pattern>\cUser</last-pattern>
      <last-replace>&quot;yPos&quot;: 0.1</last-replace>
      <last-substitute>&quot;yPos&quot;: 0.20000000298023225</last-substitute>
      <last-dir>1</last-dir>
      <show-last>false</show-last>
    </search>
    <history>
      <history-search>
        <entry encoding="base64">IFwu</entry>
        <entry encoding="base64">ID0uKiQ=</entry>
        <entry encoding="base64">IHx8IG51bGw=</entry>
        <entry encoding="base64">LCA=</entry>
        <entry encoding="base64">IFwuIA==</entry>
        <entry>&quot;&quot;</entry>
        <entry>,</entry>
        <entry>'</entry>
        <entry>payment</entry>
        <entry>credit_card_type</entry>
        <entry>console.log</entry>
        <entry>cliend</entry>
        <entry>thedata</entry>
        <entry>Clliend</entry>
        <entry>Business</entry>
        <entry>paymentMethods</entry>
        <entry>business</entry>
        <entry>admin</entry>
        <entry>\/business_config</entry>
        <entry>\cUser</entry>
      </history-search>
      <history-cmd>
        <entry encoding="base64">JzwsJz5zLzsvJ107Lw==</entry>
        <entry>s/, /\r/g</entry>
        <entry>s/, /,\r/g</entry>
        <entry>Reg</entry>
        <entry>reg</entry>
        <entry encoding="base64">JzwsJz5zL1wkLy9n</entry>
        <entry encoding="base64">JzwsJz5zLywkLyAuICIsIi8=</entry>
        <entry encoding="base64">JzwsJz5zLywkLyAuICIsIiAuLw==</entry>
        <entry encoding="base64">JzwsJz5zL1xFLykv</entry>
        <entry encoding="base64">JzwsJz5zL1w+Lykv</entry>
        <entry encoding="base64">JzwsJz5zLyAuLykgLi8=</entry>
        <entry encoding="base64">JzwsJz5zLyBcLi8pIC4v</entry>
        <entry encoding="base64">JzwsJz5zLyA9LiokLywv</entry>
        <entry encoding="base64">JzwsJz5zLyB8fCBudWxsLy8=</entry>
        <entry encoding="base64">JzwsJz5zLywgLywiIC4gIi8=</entry>
        <entry encoding="base64">JzwsJz5zLywgLywiIC4gIi9n</entry>
        <entry encoding="base64">JzwsJz5zLyBcLiAvIC5cci9n</entry>
        <entry encoding="base64">JzwsJz5zLyIiLyInJyIv</entry>
        <entry encoding="base64">JzwsJz5zLywvJywv</entry>
        <entry encoding="base64">JzwsJz5zLycvLw==</entry>
      </history-cmd>
      <history-expr />
      <history-input />
    </history>
    <shortcut-conflicts>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed OPEN_BRACKET</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed V</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed F</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed U</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed S</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed N</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed P</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed W</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>shift ctrl pressed A</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed C</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed D</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed R</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed A</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed T</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed I</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed B</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed CLOSE_BRACKET</text>
      </shortcut-conflict>
    </shortcut-conflicts>
  </component>
</application>
<application>
  <component name="VimSettings">
    <state version="4" enabled="true" />
    <globalmarks />
    <filemarks>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/Decoration.cs" timestamp="1498573346394">
        <mark key="'" line="71" column="19" />
        <mark key="[" line="26" column="41" />
        <mark key="]" line="26" column="41" />
        <mark key="^" line="26" column="41" />
        <mark key="." line="26" column="41" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/DataService/ShapeData.cs" timestamp="1498570609670">
        <mark key="'" line="50" column="4" />
        <mark key="[" line="9" column="40" />
        <mark key="]" line="11" column="23" />
        <mark key="." line="11" column="23" />
        <mark key="^" line="11" column="23" />
      </file>
      <file name="$USER_HOME$/Projects/mocha-given/index.d.ts" timestamp="1490284104781">
        <mark key="'" line="1" column="0" />
        <mark key="[" line="11" column="0" />
        <mark key="]" line="11" column="0" />
        <mark key="." line="11" column="0" />
        <mark key="^" line="1" column="11" />
      </file>
      <file name="/a.dummy" timestamp="1498741252881">
        <mark key="[" line="0" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/phpold/kuze_utils.php" timestamp="1497784331390">
        <mark key="'" line="59" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/CameraMovement.cs" timestamp="1497450852828">
        <mark key="'" line="193" column="4" />
      </file>
      <file name="$USER_HOME$/Projects/Guy Prives/Automator/server/api/updater/updater.helpers.ts" timestamp="1492791203674">
        <mark key="'" line="25" column="36" />
        <mark key="[" line="33" column="48" />
        <mark key="]" line="34" column="24" />
        <mark key="." line="34" column="24" />
        <mark key="^" line="34" column="24" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/UI/ExitToast.cs" timestamp="1497532567374">
        <mark key="'" line="40" column="0" />
        <mark key="[" line="2" column="0" />
        <mark key="]" line="2" column="0" />
        <mark key="." line="2" column="0" />
        <mark key="^" line="10" column="9" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/PieceGenerator.cs" timestamp="1498668509814">
        <mark key="'" line="0" column="0" />
        <mark key="[" line="43" column="0" />
        <mark key="]" line="43" column="0" />
        <mark key="." line="43" column="0" />
        <mark key="^" line="78" column="66" />
      </file>
      <file name="$APPLICATION_CONFIG_DIR$/scratches/scratch.json" timestamp="1492339698148">
        <mark key="'" line="21" column="0" />
        <mark key="[" line="2" column="14" />
        <mark key="]" line="2" column="13" />
        <mark key="." line="2" column="13" />
        <mark key="^" line="2" column="13" />
      </file>
      <file name="$APPLICATION_CONFIG_DIR$/scratches/scratch_3.json" timestamp="1492678325641">
        <mark key="'" line="4983" column="0" />
        <mark key="[" line="0" column="0" />
        <mark key="]" line="0" column="48708" />
        <mark key="^" line="0" column="48708" />
        <mark key="." line="0" column="48708" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/UI/GameEditor/SaveButton.cs" timestamp="1498572998507">
        <mark key="'" line="74" column="42" />
        <mark key="[" line="74" column="42" />
        <mark key="]" line="74" column="50" />
        <mark key="." line="74" column="50" />
        <mark key="^" line="74" column="50" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/PuzzlePiece.cs" timestamp="1497973981788">
        <mark key="'" line="70" column="42" />
        <mark key="[" line="199" column="8" />
        <mark key="]" line="199" column="42" />
        <mark key="." line="199" column="42" />
        <mark key="^" line="199" column="42" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/public/js/angular/kuze_business_utils-v11.js" timestamp="1499174664320">
        <mark key="'" line="53" column="9" />
        <mark key="[" line="52" column="2" />
        <mark key="]" line="52" column="4" />
        <mark key="." line="52" column="4" />
        <mark key="^" line="52" column="4" />
      </file>
      <file name="/kuze_config.php" timestamp="1499159276667">
        <mark key="[" line="11" column="0" />
        <mark key="]" line="11" column="69" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/angular/business_modal_client_payment.php" timestamp="1499847243075">
        <mark key="'" line="112" column="37" />
        <mark key="[" line="56" column="59" />
        <mark key="]" line="56" column="62" />
        <mark key="." line="56" column="62" />
        <mark key="^" line="56" column="62" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/db_scripts/DB_Changes_v300.sql" timestamp="1499162835057">
        <mark key="[" line="3" column="0" />
        <mark key="]" line="35" column="57" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/public/js/angular/kuze_enduser_app.js" timestamp="1498045366621">
        <mark key="'" line="1187" column="20" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/db_scripts/2017_07_04_Business_invoices.sql" timestamp="1499168657271">
        <mark key="[" line="0" column="0" />
        <mark key="]" line="0" column="54" />
        <mark key="." line="1" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/api/invoices.php" timestamp="1498725747370">
        <mark key="'" line="95" column="4" />
        <mark key="[" line="7" column="6" />
        <mark key="]" line="7" column="6" />
        <mark key="." line="7" column="6" />
        <mark key="^" line="115" column="43" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/AndroidGalleryImageSaver.cs" timestamp="1497519923388">
        <mark key="'" line="31" column="0" />
        <mark key="[" line="15" column="0" />
        <mark key="]" line="15" column="0" />
        <mark key="^" line="15" column="16" />
        <mark key="." line="15" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/kuze_db.php" timestamp="1499159045352">
        <mark key="'" line="161" column="27" />
      </file>
      <file name="$USER_HOME$/Projects/Guy Prives/Automator/server/package.json" timestamp="1492003154014">
        <mark key="'" line="6" column="19" />
        <mark key="[" line="37" column="19" />
        <mark key="]" line="37" column="24" />
        <mark key="." line="37" column="24" />
        <mark key="^" line="37" column="24" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/kuze_payment_utils.php" timestamp="1499171287564">
        <mark key="'" line="241" column="48" />
        <mark key="[" line="244" column="100" />
        <mark key="]" line="244" column="115" />
        <mark key="^" line="244" column="115" />
        <mark key="." line="244" column="115" />
      </file>
      <file name="$USER_HOME$/Projects/mocha-given/package.json" timestamp="1490283218372">
        <mark key="'" line="10" column="18" />
        <mark key="[" line="10" column="14" />
        <mark key="]" line="10" column="18" />
        <mark key="^" line="10" column="18" />
        <mark key="." line="10" column="18" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/kuze_config/dev/kuze_config.php" timestamp="1499164550456">
        <mark key="[" line="14" column="21" />
        <mark key="]" line="14" column="23" />
        <mark key="." line="14" column="23" />
        <mark key="^" line="14" column="23" />
      </file>
      <file name="$USER_HOME$/Projects/luftzig.com/front/src/Styling.elm" timestamp="1497700286779">
        <mark key="'" line="39" column="31" />
        <mark key="[" line="39" column="47" />
        <mark key="]" line="39" column="47" />
        <mark key="." line="39" column="47" />
        <mark key="^" line="39" column="47" />
      </file>
      <file name="$USER_HOME$/Projects/luftzig.com/front/elm-stuff/packages/rtfeldman/elm-css/8.1.0/src/Css.elm" timestamp="1497694656695">
        <mark key="'" line="4371" column="8" />
      </file>
      <file name="$USER_HOME$/Projects/luftzig.com/front/src/View.elm" timestamp="1497799291882">
        <mark key="'" line="94" column="10" />
        <mark key="[" line="2" column="7" />
        <mark key="]" line="2" column="15" />
        <mark key="." line="2" column="15" />
        <mark key="^" line="2" column="15" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/kuze_const.php" timestamp="1499168789899">
        <mark key="'" line="55" column="34" />
        <mark key="[" line="51" column="23" />
        <mark key="]" line="51" column="24" />
        <mark key="." line="51" column="24" />
        <mark key="^" line="48" column="13" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/api/api_admin.php" timestamp="1499175417121">
        <mark key="'" line="611" column="44" />
        <mark key="[" line="3154" column="114" />
        <mark key="]" line="3154" column="138" />
        <mark key="." line="3154" column="138" />
        <mark key="^" line="3154" column="138" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/public/js/angular/config-js.php" timestamp="1499175214438">
        <mark key="'" line="152" column="0" />
        <mark key="[" line="72" column="20" />
        <mark key="]" line="73" column="8" />
        <mark key="." line="73" column="8" />
        <mark key="^" line="73" column="8" />
      </file>
      <file name="vim_settings.xml" timestamp="1498470093079">
        <mark key="[" line="0" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/site.conf" timestamp="1497783226999">
        <mark key="'" line="0" column="0" />
        <mark key="[" line="0" column="0" />
        <mark key="]" line="39" column="0" />
        <mark key="." line="8" column="4" />
        <mark key="^" line="8" column="4" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" timestamp="1499845165123">
        <mark key="'" line="3" column="0" />
        <mark key="^" line="3" column="4" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/angular/business_config.php" timestamp="1498044504233">
        <mark key="[" line="31" column="0" />
        <mark key="]" line="31" column="0" />
        <mark key="." line="31" column="0" />
      </file>
      <file name="$APPLICATION_CONFIG_DIR$/scratches/scratch_5.json" timestamp="1492685289704">
        <mark key="'" line="7" column="18" />
        <mark key="[" line="0" column="0" />
        <mark key="]" line="0" column="9003" />
        <mark key="^" line="0" column="9003" />
        <mark key="." line="0" column="9003" />
      </file>
      <file name="$APPLICATION_CONFIG_DIR$/consoles/.datagrid/cell" timestamp="1499162790640">
        <mark key="[" line="0" column="0" />
        <mark key="]" line="0" column="0" />
        <mark key="." line="0" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/luftzig.com/front/src/Main.elm" timestamp="1497695316614">
        <mark key="'" line="11" column="17" />
        <mark key="[" line="24" column="8" />
        <mark key="]" line="24" column="23" />
        <mark key="." line="24" column="23" />
        <mark key="^" line="24" column="23" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" timestamp="1499846311253">
        <mark key="'" line="1941" column="44" />
        <mark key="[" line="1933" column="86" />
        <mark key="]" line="1933" column="87" />
        <mark key="." line="1933" column="86" />
        <mark key="^" line="1933" column="100" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/ImmortalManager.cs" timestamp="1498141711502">
        <mark key="'" line="123" column="73" />
        <mark key="[" line="127" column="67" />
        <mark key="]" line="127" column="70" />
        <mark key="^" line="127" column="70" />
        <mark key="." line="127" column="70" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/DataService/DataService.cs" timestamp="1498473617414">
        <mark key="'" line="16" column="24" />
        <mark key="[" line="38" column="54" />
        <mark key="]" line="38" column="54" />
        <mark key="^" line="38" column="56" />
        <mark key="." line="38" column="54" />
      </file>
      <file name="$USER_HOME$/Projects/the_bar_node/server/test/greeter-spec.ts" timestamp="1490284305782">
        <mark key="'" line="4" column="40" />
        <mark key="[" line="14" column="22" />
        <mark key="]" line="14" column="22" />
        <mark key="." line="14" column="22" />
        <mark key="^" line="12" column="37" />
      </file>
      <file name="$USER_HOME$/Projects/Guy Prives/Automator/server/api/updater/updater.model.ts" timestamp="1492787491819">
        <mark key="'" line="19" column="105" />
        <mark key="[" line="19" column="105" />
        <mark key="]" line="19" column="105" />
        <mark key="^" line="19" column="105" />
        <mark key="." line="19" column="105" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/DataService/StageData.cs" timestamp="1498123623435">
        <mark key="'" line="9" column="14" />
      </file>
      <file name="$APPLICATION_CONFIG_DIR$/scratches/scratch_6.json" timestamp="1492685876216">
        <mark key="'" line="452" column="0" />
        <mark key="[" line="517" column="35" />
        <mark key="]" line="517" column="33" />
        <mark key="^" line="517" column="33" />
        <mark key="." line="517" column="33" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/GardenScreenshot.cs" timestamp="1498662602044">
        <mark key="'" line="132" column="52" />
        <mark key="[" line="131" column="27" />
        <mark key="]" line="132" column="52" />
        <mark key="." line="132" column="52" />
        <mark key="^" line="132" column="52" />
      </file>
      <file name="$APPLICATION_CONFIG_DIR$/scratches/scratch_1.js" timestamp="1498387185354">
        <mark key="'" line="0" column="0" />
        <mark key="[" line="38" column="0" />
        <mark key="]" line="195" column="1" />
        <mark key="^" line="195" column="1" />
        <mark key="." line="167" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/invoice/create-doc.php" timestamp="1498744316602">
        <mark key="'" line="147" column="0" />
        <mark key="[" line="64" column="0" />
        <mark key="]" line="133" column="1" />
        <mark key="." line="101" column="23" />
        <mark key="^" line="101" column="23" />
      </file>
      <file name="$USER_HOME$/Projects/Guy Prives/Automator/server/api/appreciate-client/appreciate-client.ts" timestamp="1492789578918">
        <mark key="'" line="82" column="20" />
        <mark key="[" line="65" column="41" />
        <mark key="]" line="65" column="51" />
        <mark key="^" line="65" column="51" />
        <mark key="." line="65" column="51" />
      </file>
      <file name="$USER_HOME$/Projects/Guy Prives/Automator/server/api/appreciate-client/patch-request-converter.ts" timestamp="1492680861043">
        <mark key="'" line="64" column="0" />
        <mark key="[" line="65" column="25" />
        <mark key="]" line="65" column="31" />
        <mark key="^" line="65" column="31" />
        <mark key="." line="65" column="31" />
      </file>
      <file name="/dummy.sql" timestamp="1499175222411">
        <mark key="[" line="0" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/UI/GameEditor/LoadButton.cs" timestamp="1498489326900">
        <mark key="'" line="0" column="0" />
        <mark key="[" line="7" column="0" />
        <mark key="]" line="7" column="0" />
        <mark key="^" line="37" column="52" />
        <mark key="." line="7" column="0" />
      </file>
      <file name="$APPLICATION_CONFIG_DIR$/consoles/db/6e25fe0b-98f3-46a4-9336-01e7aed49277/console.sql" timestamp="1499171616631">
        <mark key="[" line="0" column="52" />
        <mark key="]" line="0" column="75" />
        <mark key="^" line="0" column="75" />
        <mark key="." line="0" column="75" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/Borders.cs" timestamp="1497869872208">
        <mark key="'" line="0" column="0" />
        <mark key="[" line="27" column="0" />
        <mark key="]" line="27" column="0" />
        <mark key="^" line="14" column="49" />
        <mark key="." line="27" column="0" />
      </file>
      <file name="/Dummy.txt" timestamp="1499845223758">
        <mark key="[" line="0" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/luftzig.com/front/src/Sections/CodeSection.elm" timestamp="1497799548443">
        <mark key="'" line="39" column="20" />
        <mark key="[" line="22" column="21" />
        <mark key="]" line="22" column="20" />
        <mark key="." line="22" column="20" />
        <mark key="^" line="22" column="20" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" timestamp="1498746722575">
        <mark key="'" line="9" column="26" />
        <mark key="[" line="9" column="26" />
        <mark key="]" line="9" column="57" />
        <mark key="^" line="8" column="23" />
        <mark key="." line="8" column="23" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/kuze_login.php" timestamp="1497776244958">
        <mark key="'" line="43" column="8" />
      </file>
      <file name="$APPLICATION_CONFIG_DIR$/scratches/scratch_1.json" timestamp="1492339311193">
        <mark key="'" line="2669" column="0" />
        <mark key="[" line="0" column="0" />
        <mark key="]" line="2669" column="0" />
        <mark key="^" line="0" column="31135" />
        <mark key="." line="0" column="31135" />
      </file>
    </filemarks>
    <jumps>
      <jump line="466" column="34" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="470" column="10" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="471" column="34" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="21" column="51" filename="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" />
      <jump line="149" column="40" filename="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" />
      <jump line="137" column="0" filename="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" />
      <jump line="8" column="24" filename="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" />
      <jump line="9" column="26" filename="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" />
      <jump line="5570" column="21" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5822" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="14" column="66" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="202" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="202" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="791" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="161" column="27" filename="$USER_HOME$/Projects/kuze/php/kuze_db.php" />
      <jump line="781" column="41" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="319" column="31" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="1921" column="24" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="5522" column="23" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="5750" column="17" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="5861" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5860" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="6101" column="1" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="6100" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="3378" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="6106" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="1983" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="1919" column="9" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="1947" column="11" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5519" column="23" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5745" column="17" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5772" column="81" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5780" column="14" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5788" column="9" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5792" column="15" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="1918" column="9" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="1892" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="3" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="1889" column="57" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="1339" column="12" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5382" column="24" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5381" column="25" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="4723" column="8" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5275" column="8" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="3380" column="19" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="3383" column="2" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="189" column="2" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="2" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="4729" column="43" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5059" column="59" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5282" column="43" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="213" column="17" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="47" column="0" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="2263" column="56" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="49" column="34" filename="$USER_HOME$/Projects/kuze/php/kuze_const.php" />
      <jump line="152" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/config-js.php" />
      <jump line="1926" column="52" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5742" column="15" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="2002" column="6" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="2269" column="49" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="3132" column="11" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="3133" column="24" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="3167" column="37" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="575" column="55" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="593" column="55" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="611" column="44" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="237" column="38" filename="$USER_HOME$/Projects/kuze/php/kuze_payment_utils.php" />
      <jump line="113" column="8" filename="$USER_HOME$/Projects/kuze/php/kuze_payment_utils.php" />
      <jump line="241" column="48" filename="$USER_HOME$/Projects/kuze/php/kuze_payment_utils.php" />
      <jump line="7" column="27" filename="$USER_HOME$/Projects/kuze/php/kuze_payment_utils.php" />
      <jump line="661" column="9" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/kuze_business_utils-v11.js" />
      <jump line="5047" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="4871" column="2" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5222" column="19" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5438" column="6" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5278" column="45" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5268" column="19" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="4690" column="8" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="4715" column="19" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5269" column="19" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="1892" column="22" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="727" column="8" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/kuze_business_utils-v11.js" />
      <jump line="48" column="2" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/kuze_business_utils-v11.js" />
      <jump line="738" column="6" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/kuze_business_utils-v11.js" />
      <jump line="4621" column="49" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5280" column="82" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="1888" column="20" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="1893" column="12" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="4716" column="19" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5270" column="19" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="4726" column="18" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="53" column="9" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/kuze_business_utils-v11.js" />
      <jump line="5283" column="12" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="4725" column="18" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5272" column="19" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="1955" column="19" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="0" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5886" column="4" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="1934" column="44" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="13" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
    </jumps>
    <registers>
      <register name="&quot;" type="4">
        <text>label</text>
      </register>
      <register name="-" type="4">
        <text>label</text>
      </register>
      <register name="/" type="4">
        <text encoding="base64">XDxidXNpbmVzc0NsaWVuZENhcmRQYXltZW50XD4=</text>
      </register>
      <register name="0" type="2">
        <text encoding="base64">Ly8gdjExIC0gMjMgbWFyY2ggMjAxNwovL0RlZmluZSBhbiBhbmd1bGFyIG1vZHVsZSBmb3Igb3VyIGFwcAoKdmFyIGt1emVJc0NhbGVuZGFyRHJhZ2dibGU7Cmt1emVJc0NhbGVuZGFyRHJhZ2dibGUgPSB0cnVlOwoKLy8gYW5ndWxhciBtb2R1bGVzCi8vJGFuZ3VsYXJNb2R1bGVzPVsnbmdSb3V0ZScsJ3VpLmJvb3RzdHJhcCcsJ3VpLmdyaWQnXTsKJGFuZ3VsYXJNb2R1bGVzID0gWyduZ1JvdXRlJywgJ3VpLmJvb3RzdHJhcCcsICd1aS5ncmlkJywgJ2J1aWxkZXInLCAnYnVpbGRlci5jb21wb25lbnRzJywgJ3ZhbGlkYXRvci5ydWxlcycsICd1aS5jYWxlbmRhcicsICdjaGVja2xpc3QtbW9kZWwnLCAndWkuYm9vdHN0cmFwLmRhdGV0aW1lcGlja2VyJywgJ2FuZ3Vjb21wbGV0ZS1hbHQnLCAnbXVsdGlwbGVTZWxlY3QnLCdhbmd1bGFySW5saW5lRWRpdCcsJ3RleHRBbmd1bGFyJywnbmdDc3YnXTsKCnZhciBkYXlOYW1lcyA9IFsn16jXkNep15XXnycsICfXqdeg15knLCAn16nXnNeZ16nXmScsICfXqNeR15nXoteZJywgJ9eX157Xmdep15knLCAn16nXmdep15knLCAn16nXkdeqJ107CnZhciBtb250aE5hbWVzID0gWyLXmdeg15XXkNeoIiwgItek15HXqNeV15DXqCIsICLXnteo16UiLCAi15DXpNeo15nXnCIsICLXnteQ15kiLCAi15nXldeg15kiLAogICLXmdeV15zXmSIsICLXkNeV15LXldeh15giLCAi16HXpNeY157XkdeoIiwgIteQ15XXp9eY15XXkdeoIiwgIteg15XXkdee15HXqCIsICLXk9em157XkdeoIgpdOwoKdmFyIGxvZ2luTmV4dFNjcmVlbj0iIjsKCihmdW5jdGlvbigpe0RhdGUuc2hvcnRNb250aHM9WyJKYW4iLCJGZWIiLCJNYXIiLCJBcHIiLCJNYXkiLCJKdW4iLCJKdWwiLCJBdWciLCJTZXAiLCJPY3QiLCJOb3YiLCJEZWMiXSxEYXRlLmxvbmdNb250aHM9WyJKYW51YXJ5IiwiRmVicnVhcnkiLCJNYXJjaCIsIkFwcmlsIiwiTWF5IiwiSnVuZSIsIkp1bHkiLCJBdWd1c3QiLCJTZXB0ZW1iZXIiLCJPY3RvYmVyIiwiTm92ZW1iZXIiLCJEZWNlbWJlciJdLERhdGUuc2hvcnREYXlzPVsiU3VuIiwiTW9uIiwiVHVlIiwiV2VkIiwiVGh1IiwiRnJpIiwiU2F0Il0sRGF0ZS5sb25nRGF5cz1bIlN1bmRheSIsIk1vbmRheSIsIlR1ZXNkYXkiLCJXZWRuZXNkYXkiLCJUaHVyc2RheSIsIkZyaWRheSIsIlNhdHVyZGF5Il07dmFyIHQ9e2Q6ZnVuY3Rpb24oKXtyZXR1cm4odGhpcy5nZXREYXRlKCk8MTA/IjAiOiIiKSt0aGlzLmdldERhdGUoKX0sRDpmdW5jdGlvbigpe3JldHVybiBEYXRlLnNob3J0RGF5c1t0aGlzLmdldERheSgpXX0sajpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldERhdGUoKX0sbDpmdW5jdGlvbigpe3JldHVybiBEYXRlLmxvbmdEYXlzW3RoaXMuZ2V0RGF5KCldfSxOOmZ1bmN0aW9uKCl7cmV0dXJuIDA9PXRoaXMuZ2V0RGF5KCk/Nzp0aGlzLmdldERheSgpfSxTOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZ2V0RGF0ZSgpJTEwPT0xJiYxMSE9dGhpcy5nZXREYXRlKCk/InN0Ijp0aGlzLmdldERhdGUoKSUxMD09MiYmMTIhPXRoaXMuZ2V0RGF0ZSgpPyJuZCI6dGhpcy5nZXREYXRlKCklMTA9PTMmJjEzIT10aGlzLmdldERhdGUoKT8icmQiOiJ0aCJ9LHc6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5nZXREYXkoKX0sejpmdW5jdGlvbigpe3ZhciB0PW5ldyBEYXRlKHRoaXMuZ2V0RnVsbFllYXIoKSwwLDEpO3JldHVybiBNYXRoLmNlaWwoKHRoaXMtdCkvODY0ZTUpfSxXOmZ1bmN0aW9uKCl7dmFyIHQ9bmV3IERhdGUodGhpcy52YWx1ZU9mKCkpLGU9KHRoaXMuZ2V0RGF5KCkrNiklNzt0LnNldERhdGUodC5nZXREYXRlKCktZSszKTt2YXIgbj10LnZhbHVlT2YoKTtyZXR1cm4gdC5zZXRNb250aCgwLDEpLDQhPT10LmdldERheSgpJiZ0LnNldE1vbnRoKDAsMSsoNC10LmdldERheSgpKzcpJTcpLDErTWF0aC5jZWlsKChuLXQpLzYwNDhlNSl9LEY6ZnVuY3Rpb24oKXtyZXR1cm4gRGF0ZS5sb25nTW9udGhzW3RoaXMuZ2V0TW9udGgoKV19LG06ZnVuY3Rpb24oKXtyZXR1cm4odGhpcy5nZXRNb250aCgpPDk/IjAiOiIiKSsodGhpcy5nZXRNb250aCgpKzEpfSxNOmZ1bmN0aW9uKCl7cmV0dXJuIERhdGUuc2hvcnRNb250aHNbdGhpcy5nZXRNb250aCgpXX0sbjpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldE1vbnRoKCkrMX0sdDpmdW5jdGlvbigpe3ZhciB0PXRoaXMuZ2V0RnVsbFllYXIoKSxlPXRoaXMuZ2V0TW9udGgoKSsxO3JldHVybiAxMj09PWUmJih0PXQrKyxlPTApLG5ldyBEYXRlKHQsZSwwKS5nZXREYXRlKCl9LEw6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLmdldEZ1bGxZZWFyKCk7cmV0dXJuIHQlNDAwPT0wfHx0JTEwMCE9MCYmdCU0PT0wfSxvOmZ1bmN0aW9uKCl7dmFyIHQ9bmV3IERhdGUodGhpcy52YWx1ZU9mKCkpO3JldHVybiB0LnNldERhdGUodC5nZXREYXRlKCktKHRoaXMuZ2V0RGF5KCkrNiklNyszKSx0LmdldEZ1bGxZZWFyKCl9LFk6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5nZXRGdWxsWWVhcigpfSx5OmZ1bmN0aW9uKCl7cmV0dXJuKCIiK3RoaXMuZ2V0RnVsbFllYXIoKSkuc3Vic3RyKDIpfSxhOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZ2V0SG91cnMoKTwxMj8iYW0iOiJwbSJ9LEE6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5nZXRIb3VycygpPDEyPyJBTSI6IlBNIn0sQjpmdW5jdGlvbigpe3JldHVybiBNYXRoLmZsb29yKDFlMyooKHRoaXMuZ2V0VVRDSG91cnMoKSsxKSUyNCt0aGlzLmdldFVUQ01pbnV0ZXMoKS82MCt0aGlzLmdldFVUQ1NlY29uZHMoKS8zNjAwKS8yNCl9LGc6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5nZXRIb3VycygpJTEyfHwxMn0sRzpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldEhvdXJzKCl9LGg6ZnVuY3Rpb24oKXtyZXR1cm4oKHRoaXMuZ2V0SG91cnMoKSUxMnx8MTIpPDEwPyIwIjoiIikrKHRoaXMuZ2V0SG91cnMoKSUxMnx8MTIpfSxIOmZ1bmN0aW9uKCl7cmV0dXJuKHRoaXMuZ2V0SG91cnMoKTwxMD8iMCI6IiIpK3RoaXMuZ2V0SG91cnMoKX0saTpmdW5jdGlvbigpe3JldHVybih0aGlzLmdldE1pbnV0ZXMoKTwxMD8iMCI6IiIpK3RoaXMuZ2V0TWludXRlcygpfSxzOmZ1bmN0aW9uKCl7cmV0dXJuKHRoaXMuZ2V0U2Vjb25kcygpPDEwPyIwIjoiIikrdGhpcy5nZXRTZWNvbmRzKCl9LHU6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLmdldE1pbGxpc2Vjb25kcygpO3JldHVybigxMD50PyIwMCI6MTAwPnQ/IjAiOiIiKSt0fSxlOmZ1bmN0aW9uKCl7cmV0dXJuL1woKC4qKVwpLy5leGVjKChuZXcgRGF0ZSkudG9TdHJpbmcoKSlbMV19LEk6ZnVuY3Rpb24oKXtmb3IodmFyIHQ9bnVsbCxlPTA7MTI+ZTsrK2Upe3ZhciBuPW5ldyBEYXRlKHRoaXMuZ2V0RnVsbFllYXIoKSxlLDEpLGk9bi5nZXRUaW1lem9uZU9mZnNldCgpO2lmKG51bGw9PT10KXQ9aTtlbHNle2lmKHQ+aSl7dD1pO2JyZWFrfWlmKGk+dClicmVha319cmV0dXJuIHRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKT09dHwwfSxPOmZ1bmN0aW9uKCl7cmV0dXJuKC10aGlzLmdldFRpbWV6b25lT2Zmc2V0KCk8MD8iLSI6IisiKSsoTWF0aC5hYnModGhpcy5nZXRUaW1lem9uZU9mZnNldCgpLzYwKTwxMD8iMCI6IiIpK01hdGguZmxvb3IoTWF0aC5hYnModGhpcy5nZXRUaW1lem9uZU9mZnNldCgpLzYwKSkrKDA9PU1hdGguYWJzKHRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKSU2MCk/IjAwIjooTWF0aC5hYnModGhpcy5nZXRUaW1lem9uZU9mZnNldCgpJTYwKTwxMD8iMCI6IiIpK01hdGguYWJzKHRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKSU2MCkpfSxQOmZ1bmN0aW9uKCl7cmV0dXJuKC10aGlzLmdldFRpbWV6b25lT2Zmc2V0KCk8MD8iLSI6IisiKSsoTWF0aC5hYnModGhpcy5nZXRUaW1lem9uZU9mZnNldCgpLzYwKTwxMD8iMCI6IiIpK01hdGguZmxvb3IoTWF0aC5hYnModGhpcy5nZXRUaW1lem9uZU9mZnNldCgpLzYwKSkrIjoiKygwPT1NYXRoLmFicyh0aGlzLmdldFRpbWV6b25lT2Zmc2V0KCklNjApPyIwMCI6KE1hdGguYWJzKHRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKSU2MCk8MTA/IjAiOiIiKStNYXRoLmFicyh0aGlzLmdldFRpbWV6b25lT2Zmc2V0KCklNjApKX0sVDpmdW5jdGlvbigpe3JldHVybiB0aGlzLnRvVGltZVN0cmluZygpLnJlcGxhY2UoL14uKyBcKD8oW15cKV0rKVwpPyQvLCIkMSIpfSxaOmZ1bmN0aW9uKCl7cmV0dXJuIDYwKi10aGlzLmdldFRpbWV6b25lT2Zmc2V0KCl9LGM6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5mb3JtYXQoIlktbS1kXFxUSDppOnNQIil9LHI6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy50b1N0cmluZygpfSxVOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZ2V0VGltZSgpLzFlM319O0RhdGUucHJvdG90eXBlLmZvcm1hdD1mdW5jdGlvbihlKXt2YXIgbj10aGlzO3JldHVybiBlLnJlcGxhY2UoLyhcXD8pKC4pL2csZnVuY3Rpb24oZSxpLHIpe3JldHVybiIiPT09aSYmdFtyXT90W3JdLmNhbGwobik6cn0pfX0pLmNhbGwodGhpcyk7CgpmdW5jdGlvbiBnb3RvQ2xpZW50UGFnZShidXNpbmVzc191c2VyX2lkKQp7CiAgd2luZG93LmxvY2F0aW9uLmhyZWY9Jy8jL2J1c2luZXNzX2NsaWVudHMvJyArIGJ1c2luZXNzX3VzZXJfaWQ7Cn0KZnVuY3Rpb24gZ290b0luc3RydWN0b3JQYWdlKGJ1c2luZXNzX3VzZXJfaWQpCnsKICB3aW5kb3cubG9jYXRpb24uaHJlZj0nLyMvYnVzaW5lc3NfaW5zdHJ1Y3RvcnMvJyArIGJ1c2luZXNzX3VzZXJfaWQ7Cn0KCmZ1bmN0aW9uIGdvdG9FdmVudFBhZ2UodGhlZXZlbnQpCnsKICBsb2dEZWJ1ZygiZ290b0V2ZW50UGFnZSAiK3RoZWV2ZW50KTsKICBpZiAodGhlZXZlbnQuaXNfY2xhc3M9PTEpCiAgewogICAgd2luZG93LmxvY2F0aW9uLmhyZWY9Jy8jL2V2ZW50X2NsYXNzLycgKyB0aGVldmVudC5ldmVudF9pZDsKICB9CiAgZWxzZQogIHsKICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmPScvIy9ldmVudC8nICsgdGhlZXZlbnQuZXZlbnRfaWQ7CiAgfQp9CgpmdW5jdGlvbiBnb3RvTG9jYXRpb25QYWdlKGxvY2F0aW9uX2lkKQp7CiAgbG9nRGVidWcoImdvdG9Mb2NhdGlvblBhZ2UgIitsb2NhdGlvbl9pZCk7CiAgd2luZG93LmxvY2F0aW9uLmhyZWY9Jy8jL2J1c2luZXNzX2xvY2F0aW9ucy8nICsgbG9jYXRpb25faWQ7Cgp9CgpmdW5jdGlvbiBnb3RvQ2xpZW50RWRpdFBhZ2UodXNlcl9pZCkKewogIHdpbmRvdy5sb2NhdGlvbi5ocmVmPScvIy9idXNpbmVzc19jbGllbnRzLycgKyB1c2VyX2lkICsgJy9lZGl0JzsKfQoKZnVuY3Rpb24gZ290b0JhY2soKQp7CiAgd2luZG93Lmhpc3RvcnkuYmFjaygpOwp9CgpmdW5jdGlvbiBzaG93RXZlbnRQb3B1cChzZWxlY3RlZEV2ZW50LCAkdWliTW9kYWwpCnsKICAvLyB0aGlzIGZ1bmN0aW9uIHVzZWQgdG8gYnJpbmcgYSBwb3B1cAogIC8vIG5vdyBpdCBnb2VzIHRvIHRoZSBldmVudCBwYWdlCiAgZ290b0V2ZW50UGFnZShzZWxlY3RlZEV2ZW50KTsKCiAgLy8gaWYgKHNlbGVjdGVkRXZlbnQuaXNfcmVwZWF0aW5nID09IDEpIHsKICAvLyAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgLy8gICAgICAgICBhbmltYXRpb246IGZhbHNlLAogIC8vICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfY2xhc3Nfc2luZ2xlLnBocCcsCiAgLy8gICAgICAgICBjb250cm9sbGVyOiAnZXZlbnRSZWN1cnJpbmdEZXRhaWxzQnVzaW5lc3NDYWxlbmRhck1vZGFsQ29udHJvbGxlcicsCiAgLy8gICAgICAgICAvLyBzaXplOiBzaXplLAogIC8vICAgICAgICAgcmVzb2x2ZTogewogIC8vICAgICAgICAgICAgIHNlbGVjdGVkRXZlbnQ6IGZ1bmN0aW9uKCkgewogIC8vICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZWN0ZWRFdmVudDsKICAvLyAgICAgICAgICAgICB9CiAgLy8gICAgICAgICB9CiAgLy8gICAgIH0pOwogIC8vIH0gZWxzZSB7CiAgLy8gICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewogIC8vICAgICAgICAgYW5pbWF0aW9uOiBmYWxzZSwKICAvLyAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2V2ZW50X3NpbmdsZS5waHAnLAogIC8vICAgICAgICAgY29udHJvbGxlcjogJ2V2ZW50RGV0YWlsc0J1c2luZXNzQ2FsZW5kYXJNb2RhbENvbnRyb2xsZXInLAogIC8vICAgICAgICAgLy8gc2l6ZTogc2l6ZSwKICAvLyAgICAgICAgIHJlc29sdmU6IHsKICAvLyAgICAgICAgICAgICBzZWxlY3RlZEV2ZW50OiBmdW5jdGlvbigpIHsKICAvLyAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGVjdGVkRXZlbnQ7CiAgLy8gICAgICAgICAgICAgfQogIC8vICAgICAgICAgfQogIC8vICAgICB9KTsKICAvLyB9Cn0KZnVuY3Rpb24gdXBkYXRlR2xvYmFsTGFuZ3VhZ2UoJHNjb3BlLCAkbmV3bGFuZykgewoKICAvLwl2YXIgZ0xhbmc9Z0xhbmdCYXNlW2dMYW5nQ3Vycl07CiAgJGdMYW5nID0gZ0xhbmdCYXNlWyRuZXdsYW5nXTsKICAvLyBsb2dEZWJ1ZygiZ0xhbmdCYXNlWyRuZXdsYW5nXVsndGl0bGUxJ109IiArIGdMYW5nQmFzZVskbmV3bGFuZ11bJ3RpdGxlMSddKTsKICAvLyBsb2dEZWJ1ZygibGFuZ3VnYWdlOiIgKyAkZ0xhbmdbJ2xhbmd1YWdlJ10pOwogIC8vCWxvZ0RlYnVnKCJsYW5ndWdhZ2UgZGlyOiAiKyRnTGFuZ1snZGlyJ10pOwogIC8vCWxvZ0RlYnVnKCJjaGFuZ2luZyBsYW5ndWFnZSB0byAiKyRuZXdsYW5nKQogICRzY29wZS5zcENsYXNzID0gJGdMYW5nWydjbGFzcyddOwogIC8vCWxvZ0RlYnVnKCJpcyBhcnJheT8gIithbmd1bGFyLmlzQXJyYXkoJGdMYW5nKSk7CiAgLy8JbG9nRGVidWcoIiRnTGFuZ1snZGlyJ109IiskZ0xhbmdbJ2RpciddKTsKICAvLwlsb2dEZWJ1ZygiJGdMYW5nWyd0aXRsZTEnXT0iKyRnTGFuZ1sndGl0bGUxJ10pOwogICRzY29wZS5sYW5nZmlsZSA9ICRnTGFuZzsKICAvLyBsb2dEZWJ1ZygiaXMgYXJyYXk/ICIgKyBhbmd1bGFyLmlzQXJyYXkoJHNjb3BlLmxhbmdmaWxlKSk7CiAgLy8gbG9nRGVidWcoIiRzY29wZS5sYW5nZmlsZT0iICsgJHNjb3BlLmxhbmdmaWxlKTsKICAvLyBsb2dEZWJ1ZygiJHNjb3BlLmxhbmdmaWxlWyd0aXRsZTEnXT0iICsgJHNjb3BlLmxhbmdmaWxlWyd0aXRsZTEnXSk7CgogICRzY29wZS50ZXN0bmV3dmFyID0gJHNjb3BlLmxhbmdmaWxlWyd0aXRsZTEnXTsKICAvLwkkc2NvcGUubWVzc2FnZT0kc2NvcGUubGFuZ2ZpbGVbJ3RpdGxlMSddOwp9CgpmdW5jdGlvbiBnZXRSYW5kb21Db2xvcigpIHsKICB2YXIgbGV0dGVycyA9ICcwMTIzNDU2Nzg5QUJDREVGJy5zcGxpdCgnJyk7CiAgdmFyIGNvbG9yID0gJyMnOwogIGZvciAodmFyIGkgPSAwOyBpIDwgNjsgaSsrKSB7CiAgICBjb2xvciArPSBsZXR0ZXJzW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDE2KV07CiAgfQogIHJldHVybiBjb2xvcjsKfQoKZnVuY3Rpb24gZ2V0UmFuZG9tSW50KG1pbiwgbWF4KSB7CiAgcmV0dXJuIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChtYXggLSBtaW4gKyAxKSkgKyBtaW47Cn0KCmZ1bmN0aW9uIGNhbGNfdGVtcF9saW1pdF9pZCgpIHsKICB2YXIgZCA9IG5ldyBEYXRlKCk7CiAgdmFyIHJhbmRvbWxpbWl0ID0gZC5nZXRUaW1lKCk7CiAgbG9nRGVidWcoImNhbGNfdGVtcF9saW1pdF9pZD0iICsgcmFuZG9tbGltaXQpOwogIHJldHVybiByYW5kb21saW1pdDsKfQoKdmFyICRnTG9nTGV2ZWwgPSAnZGVidWcnOwoKLy8gc3RhcnRpbmcKbG9nRGVidWcoIm1haW4gJGdMb2dMZXZlbD0iICsgJGdMb2dMZXZlbCk7CmxvZ0RlYnVnKCJpbml0aWFsaXplIGFuZ3VsYXIiKTsKbG9nRGVidWcoImluaXRpYWxpemluZyBtb2R1bGVzICIgKyAkYW5ndWxhck1vZHVsZXMpOwoKdmFyIGt1emVBcHAgPSBhbmd1bGFyLm1vZHVsZSgna3V6ZUFwcCcsICRhbmd1bGFyTW9kdWxlcykKCi8vJHJvb3RTY29wZS5zcENsYXNzID0gJ3JpZ2h0JzsKa3V6ZVJ1biA9IGZ1bmN0aW9uKCkgewoKfQprdXplQXBwLnJ1bihbCiAgJyRidWlsZGVyJywKICBmdW5jdGlvbigkYnVpbGRlcikgewogICAgLy8gbG9nRGVidWcoImluc2lkZSBrdXplQXBwLnJ1biIpOwogICAgJGJ1aWxkZXIucmVnaXN0ZXJDb21wb25lbnQoJ3NhbXBsZUlucHV0JywgewogICAgICBncm91cDogJ2Zyb20gaHRtbCcsCiAgICAgIGxhYmVsOiAnU2FtcGxlJywKICAgICAgZGVzY3JpcHRpb246ICdGcm9tIGh0bWwgdGVtcGxhdGUnLAogICAgICBwbGFjZWhvbGRlcjogJ3BsYWNlaG9sZGVyJywKICAgICAgcmVxdWlyZWQ6IGZhbHNlLAogICAgICB2YWxpZGF0aW9uT3B0aW9uczogW3sKICAgICAgICBsYWJlbDogJ25vbmUnLAogICAgICAgIHJ1bGU6ICcvLiovJwogICAgICB9LCB7CiAgICAgICAgbGFiZWw6ICdudW1iZXInLAogICAgICAgIHJ1bGU6ICdbbnVtYmVyXScKICAgICAgfSwgewogICAgICAgIGxhYmVsOiAnZW1haWwnLAogICAgICAgIHJ1bGU6ICdbZW1haWxdJwogICAgICB9LCB7CiAgICAgICAgbGFiZWw6ICd1cmwnLAogICAgICAgIHJ1bGU6ICdbdXJsXScKICAgICAgfV0sCiAgICAgIHRlbXBsYXRlVXJsOiAnL2FuZ3VsYXItZm9ybS1idWlsZGVyL2V4YW1wbGUvdGVtcGxhdGUuaHRtbCcsCiAgICAgIHBvcG92ZXJUZW1wbGF0ZVVybDogJy9hbmd1bGFyLWZvcm0tYnVpbGRlci9leGFtcGxlL3BvcG92ZXJUZW1wbGF0ZS5odG1sJwogICAgfSk7CiAgICByZXR1cm4gJGJ1aWxkZXIucmVnaXN0ZXJDb21wb25lbnQoJ25hbWUnLCB7CiAgICAgIGdyb3VwOiAnRGVmYXVsdCcsCiAgICAgIGxhYmVsOiAnTmFtZScsCiAgICAgIHJlcXVpcmVkOiBmYWxzZSwKICAgICAgYXJyYXlUb1RleHQ6IHRydWUsCiAgICAgIHRlbXBsYXRlOiAiPGRpdiBjbGFzcz1cImZvcm0tZ3JvdXBcIj5cbiAgICA8bGFiZWwgZm9yPVwie3tmb3JtTmFtZStpbmRleH19XCIgY2xhc3M9XCJjb2wtbWQtNCBjb250cm9sLWxhYmVsXCIgbmctY2xhc3M9XCJ7J2ZiLXJlcXVpcmVkJzpyZXF1aXJlZH1cIj57e2xhYmVsfX08L2xhYmVsPlxuICAgIDxkaXYgY2xhc3M9XCJjb2wtbWQtOFwiPlxuICAgICAgICA8aW5wdXQgdHlwZT0naGlkZGVuJyBuZy1tb2RlbD1cImlucHV0VGV4dFwiIHZhbGlkYXRvci1yZXF1aXJlZD1cInt7cmVxdWlyZWR9fVwiIHZhbGlkYXRvci1ncm91cD1cInt7Zm9ybU5hbWV9fVwiLz5cbiAgICAgICAgPGRpdiBjbGFzcz1cImNvbC1zbS02XCIgc3R5bGU9XCJwYWRkaW5nLWxlZnQ6IDA7XCI+XG4gICAgICAgICAgICA8aW5wdXQgdHlwZT1cInRleHRcIlxuICAgICAgICAgICAgICAgIG5nLW1vZGVsPVwiaW5wdXRBcnJheVswXVwiXG4gICAgICAgICAgICAgICAgY2xhc3M9XCJmb3JtLWNvbnRyb2xcIiBpZD1cInt7Zm9ybU5hbWUraW5kZXh9fS0wXCIvPlxuICAgICAgICAgICAgPHAgY2xhc3M9J2hlbHAtYmxvY2snPkZpcnN0IG5hbWU8L3A+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwiY29sLXNtLTZcIiBzdHlsZT1cInBhZGRpbmctbGVmdDogMDtcIj5cbiAgICAgICAgICAgIDxpbnB1dCB0eXBlPVwidGV4dFwiXG4gICAgICAgICAgICAgICAgbmctbW9kZWw9XCJpbnB1dEFycmF5WzFdXCJcbiAgICAgICAgICAgICAgICBjbGFzcz1cImZvcm0tY29udHJvbFwiIGlkPVwie3tmb3JtTmFtZStpbmRleH19LTFcIi8+XG4gICAgICAgICAgICA8cCBjbGFzcz0naGVscC1ibG9jayc+TGFzdCBuYW1lPC9wPlxuICAgICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbjwvZGl2PiIsCiAgICAgIHBvcG92ZXJUZW1wbGF0ZTogIjxmb3JtPlxuICAgIDxkaXYgY2xhc3M9XCJmb3JtLWdyb3VwXCI+XG4gICAgICAgIDxsYWJlbCBjbGFzcz0nY29udHJvbC1sYWJlbCc+TGFiZWw8L2xhYmVsPlxuICAgICAgICA8aW5wdXQgdHlwZT0ndGV4dCcgbmctbW9kZWw9XCJsYWJlbFwiIHZhbGlkYXRvcj1cIltyZXF1aXJlZF1cIiBjbGFzcz0nZm9ybS1jb250cm9sJy8+XG4gICAgPC9kaXY+XG4gICAgPGRpdiBjbGFzcz1cImNoZWNrYm94XCI+XG4gICAgICAgIDxsYWJlbD5cbiAgICAgICAgICAgIDxpbnB1dCB0eXBlPSdjaGVja2JveCcgbmctbW9kZWw9XCJyZXF1aXJlZFwiIC8+XG4gICAgICAgICAgICBSZXF1aXJlZFxuICAgICAgICA8L2xhYmVsPlxuICAgIDwvZGl2PlxuXG4gICAgPGhyLz5cbiAgICA8ZGl2IGNsYXNzPSdmb3JtLWdyb3VwJz5cbiAgICAgICAgPGlucHV0IHR5cGU9J3N1Ym1pdCcgbmctY2xpY2s9XCJwb3BvdmVyLnNhdmUoJGV2ZW50KVwiIGNsYXNzPSdidG4gYnRuLXByaW1hcnknIHZhbHVlPSdTYXZlJy8+XG4gICAgICAgIDxpbnB1dCB0eXBlPSdidXR0b24nIG5nLWNsaWNrPVwicG9wb3Zlci5jYW5jZWwoJGV2ZW50KVwiIGNsYXNzPSdidG4gYnRuLWRlZmF1bHQnIHZhbHVlPSdDYW5jZWwnLz5cbiAgICAgICAgPGlucHV0IHR5cGU9J2J1dHRvbicgbmctY2xpY2s9XCJwb3BvdmVyLnJlbW92ZSgkZXZlbnQpXCIgY2xhc3M9J2J0biBidG4tZGFuZ2VyJyB2YWx1ZT0nRGVsZXRlJy8+XG4gICAgPC9kaXY+XG48L2Zvcm0+IgogICAgfSk7CiAgfQpdKQoKa3V6ZUFwcC5ydW4oZnVuY3Rpb24oJHJvb3RTY29wZSkgewogIGxvZ0RlYnVnKCJydW4gJHJvb3RTY29wZSIpOwogICRyb290U2NvcGUuJG9uKCdsb2FkaW5nOnByb2dyZXNzJywgZnVuY3Rpb24gKCl7CiAgICAvLyBzaG93IGxvYWRpbmcgZ2lmCiAgICAvLyAkc2NvcGUuY3Vyc29yZGVsZXRlPSJ3YWl0IjsKICAgIC8vIGRvY3VtZW50LmJvZHkuc3R5bGUuY3Vyc29yPSd3YWl0JzsKICB9KTsKCiAgJHJvb3RTY29wZS4kb24oJ2xvYWRpbmc6ZmluaXNoJywgZnVuY3Rpb24gKCl7CiAgICAvLyAkc2NvcGUuY3Vyc29yZGVsZXRlPSIiOwogICAgLy8gZG9jdW1lbnQuYm9keS5zdHlsZS5jdXJzb3I9Jyc7CiAgfSk7Cn0pOwoKLy8gREVMRVRFRCAtIHhlZGl0YWJsZSBzdHVmZgovLyBrdXplQXBwLnJ1bihmdW5jdGlvbihlZGl0YWJsZU9wdGlvbnMsIGVkaXRhYmxlVGhlbWVzKSB7Ci8vICAgICBsb2dEZWJ1ZygiaW5pdGlhbGl6aW5nIHhlZGl0YWJsZSBlZGl0YWJsZU9wdGlvbnMiKTsKLy8gICAgIGVkaXRhYmxlT3B0aW9ucy50aGVtZSA9ICdiczMnOyAvLyBib290c3RyYXAzIHRoZW1lLiBDYW4gYmUgYWxzbyAnYnMyJywgJ2RlZmF1bHQnCi8vICAgICAvLyBlZGl0YWJsZU9wdGlvbnMuZGVmYXVsdHMubW9kZSA9ICdpbmxpbmUnOwovLyAgICAgbG9nRGVidWcoZWRpdGFibGVPcHRpb25zKTsKLy8gICAgIC8vIGVkaXRhYmxlT3B0aW9ucy5tb2RlID0gJ2lubGluZSc7Ci8vICAgICBlZGl0YWJsZVRoZW1lcy5iczMuaW5wdXRDbGFzcyA9ICdpbnB1dC1zbSc7Ci8vICAgICBlZGl0YWJsZVRoZW1lcy5iczMuYnV0dG9uc0NsYXNzID0gJ2J0bi1zbSc7Ci8vIH0pOwoKLy8gYWZ0ZXIgZm9ybXMKLy9EZWZpbmUgUm91dGluZyBmb3IgYXBwCi8vVXJpIC9BZGROZXdPcmRlciAtPiB0ZW1wbGF0ZSBhZGRfb3JkZXIuaHRtbCBhbmQgQ29udHJvbGxlciBDbGllbnRzQWRkQ29udHJvbGxlcgovL1VyaSAvU2hvd09yZGVycyAtPiB0ZW1wbGF0ZSBzaG93X29yZGVycy5odG1sIGFuZCBDb250cm9sbGVyIENsaWVudHNBZGRDb250cm9sbGVyCmt1emVBcHAuY29uZmlnKFsnJHJvdXRlUHJvdmlkZXInLAogIGZ1bmN0aW9uKCRyb3V0ZVByb3ZpZGVyKSB7CiAgICAvLyBsb2dEZWJ1Zygkcm91dGVQcm92aWRlcik7CiAgICAkcm91dGVQcm92aWRlci4KICAgIC8vIHdoZW4oJy9jbGllbnRjYXJkJywgewogICAgLy8gICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2NsaWVudF9jYXJkLmh0bWwnLAogICAgLy8gICAgIGNvbnRyb2xsZXI6ICdjbGllbnRDYXJkQ29udHJvbGxlcicKICAgIC8vIH0pLgogICAgd2hlbignL2NvbnRhY3QnLCB7CiAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2NvbnRhY3QucGhwJywKICAgICAgLy8gY29udHJvbGxlcjogJ2VuZFVzZXJIb21lQ29udHJvbGxlcicKICAgICAgY29udHJvbGxlcjogJ2NvbnRhY3RDb250cm9sbGVyJwogICAgfSkuCiAgICB3aGVuKCcvZXZlbnRfdHlwZXMnLCB7CiAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2V2ZW50X3R5cGVzLmh0bWwnLAogICAgICBjb250cm9sbGVyOiAnRXZlbnRUeXBlc0NvbnRyb2xsZXInCiAgICB9KS4KICAgIHdoZW4oJy9ldmVudF90eXBlcy9hZGQnLCB7CiAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2V2ZW50X3R5cGVfYWRkLnBocCcsCiAgICAgIGNvbnRyb2xsZXI6ICdFdmVudFR5cGVOZXdDb250cm9sbGVyJwogICAgfSkuCiAgICB3aGVuKCcvZXZlbnRfdHlwZXMvOmV2ZW50X3R5cGVfaWQnLCB7CiAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2V2ZW50X3R5cGVfYWRkLnBocCcsCiAgICAgIGNvbnRyb2xsZXI6ICdFdmVudFR5cGVVcGRhdGVDb250cm9sbGVyJwogICAgfSkuCiAgICB3aGVuKCcvaG91cnNfb2Zfd29yaycsIHsKICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfaG91cnNfb2Zfd29yay5odG1sJywKICAgICAgY29udHJvbGxlcjogJ0hvdXJzT2ZXb3JrQ29udHJvbGxlcicKICAgIH0pLgogICAgd2hlbignL2J1c2luZXNzX2NhbGVuZGFyJywgewogICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19jYWxlbmRhci5waHAnLAogICAgICBjb250cm9sbGVyOiAnQnVzaW5lc3NDYWxlbmRhckNvbnRyb2xsZXInLAogICAgICByZWxvYWRPblNlYXJjaDogZmFsc2UKICAgIH0pLgogICAgd2hlbignL2FuZ3VsYXItZm9ybS1idWlsZGVyJywgewogICAgICB0ZW1wbGF0ZVVybDogJy9hbmd1bGFyLWZvcm0tYnVpbGRlci9pbmRleC5odG1sJywKICAgICAgY29udHJvbGxlcjogJ0RlbW9Db250cm9sbGVyJwogICAgfSkuCiAgICB3aGVuKCcvYnVzaW5lc3NfY2xpZW50cy9hZGQnLCB7CiAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2NsaWVudHNfYWRkLmh0bWwnLAogICAgICBjb250cm9sbGVyOiAnQ2xpZW50c0FkZENvbnRyb2xsZXInCiAgICB9KS4KICAgIHdoZW4oJy9idXNpbmVzc19jbGllbnRzJywgewogICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19jbGllbnRzLnBocCcsCiAgICAgIGNvbnRyb2xsZXI6ICdDbGllbnRzU2hvd0NvbnRyb2xsZXInCiAgICB9KS4KICAgIHdoZW4oJy9idXNpbmVzc19jbGllbnRzLzpidXNpbmVzc191c2VyX2lkJywgewogICAgICB0ZW1wbGF0ZVVybDogZnVuY3Rpb24ocGFyYW1zKSB7CiAgICAgICAgcmV0dXJuICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfY2xpZW50X2NhcmQucGhwP2J1c2luZXNzX3VzZXJfaWQ9JyArIHBhcmFtcy5idXNpbmVzc191c2VyX2lkIDsKICAgICAgfSwKICAgICAgY29udHJvbGxlcjogJ0NsaWVudHNTaG93MUNvbnRyb2xsZXInCiAgICB9KS4KICAgIHdoZW4oJy9idXNpbmVzc19yZXBvcnRzJywgewogICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19yZXBvcnRzLmh0bWwnLAogICAgICBjb250cm9sbGVyOiAnQnVzaW5lc3NSZXBvcnRzQ29udHJvbGxlcicKICAgIH0pLgogICAgd2hlbignL2J1c2luZXNzX2luc3RydWN0b3JzJywgewogICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19pbnN0cnVjdG9ycy5waHAnLAogICAgICBjb250cm9sbGVyOiAnSW5zdHJ1Y3RvcnNTaG93Q29udHJvbGxlcicKICAgIH0pLgogICAgd2hlbignL2J1c2luZXNzX2luc3RydWN0b3JzL2FkZCcsIHsKICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfY2xpZW50c19hZGQuaHRtbCcsCiAgICAgIGNvbnRyb2xsZXI6ICdJbnN0cnVjdG9yc0FkZENvbnRyb2xsZXInCiAgICB9KS4KICAgIHdoZW4oJy9idXNpbmVzc19sb2NhdGlvbnMnLCB7CiAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2xvY2F0aW9ucy5waHAnLAogICAgICBjb250cm9sbGVyOiAnYnVzaW5lc3NfbG9jYXRpb25zJwogICAgfSkuCiAgICB3aGVuKCcvYnVzaW5lc3NfbG9jYXRpb25zL2FkZCcsIHsKICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbG9jYXRpb25zX2FkZC5waHAnLAogICAgICBjb250cm9sbGVyOiAnYnVzaW5lc3NfbG9jYXRpb25zX2FkZCcKICAgIH0pLgogICAgd2hlbignL2J1c2luZXNzX2xvY2F0aW9ucy86bG9jYXRpb25faWQnLCB7CiAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2xvY2F0aW9uc19hZGQucGhwJywKICAgICAgY29udHJvbGxlcjogJ2J1c2luZXNzX2xvY2F0aW9uc191cGRhdGUnCiAgICB9KS4KICAgIHdoZW4oJy9idXNpbmVzc19pbnN0cnVjdG9ycy86YnVzaW5lc3NfdXNlcl9pZCcsIHsKICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfaW5zdHJ1Y3Rvcl9jYXJkLnBocCcsCiAgICAgIGNvbnRyb2xsZXI6ICdJbnN0cnVjdG9yU2hvdzFDb250cm9sbGVyJwogICAgfSkuCiAgICB3aGVuKCcvZXZlbnQvOmV2ZW50X2lkJywgewogICAgICB0ZW1wbGF0ZVVybDogZnVuY3Rpb24ocGFyYW1zKSB7CiAgICAgICAgcmV0dXJuICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfZXZlbnRfY2FyZC5waHA/ZXZlbnRfaWQ9JyArIHBhcmFtcy5ldmVudF9pZCA7CiAgICAgIH0sCiAgICAgIGNvbnRyb2xsZXI6ICdFdmVudFBhZ2VDb250cm9sbGVyJwogICAgfSkuCiAgICB3aGVuKCcvZXZlbnRfY2xhc3MvOmV2ZW50X2lkJywgewogICAgICB0ZW1wbGF0ZVVybDogZnVuY3Rpb24ocGFyYW1zKSB7CiAgICAgICAgcmV0dXJuICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfZXZlbnRfY2xhc3NfY2FyZC5waHA/ZXZlbnRfaWQ9JyArIHBhcmFtcy5ldmVudF9pZCA7CiAgICAgIH0sCiAgICAgIGNvbnRyb2xsZXI6ICdFdmVudENsYXNzUGFnZUNvbnRyb2xsZXInCiAgICB9KS4KICAgIHdoZW4oJy9wYWNrYWdlcycsIHsKICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfcGFja2FnZXNfc2hvdy5waHAnLAogICAgICBjb250cm9sbGVyOiAnUGFja2FnZXNDb250cm9sbGVyJwogICAgfSkuCiAgICB3aGVuKCcvcGFja2FnZXMvYWRkJywgewogICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19wYWNrYWdlc19jcmVhdGUucGhwJywKICAgICAgY29udHJvbGxlcjogJ2J1c2luZXNzX3BhY2thZ2VzX2FkZF9jbnRsJwogICAgfSkuCiAgICB3aGVuKCcvcGFja2FnZXMvOnBhY2thZ2VfaWQnLCB7CiAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX3BhY2thZ2VzX2NyZWF0ZS5waHAnLAogICAgICBjb250cm9sbGVyOiAnYnVzaW5lc3NfcGFja2FnZXNfdXBkYXRlX2NudGwnCiAgICB9KS4KICAgIHdoZW4oJy9idXNpbmVzc19jb25maWcnLCB7CiAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2NvbmZpZy5waHAnLAogICAgICBjb250cm9sbGVyOiAnQ29uZmlnQnVzaW5lc3NDb250cm9sbGVyJwogICAgfSkuCiAgICB3aGVuKCcvdXNlcl9jb25maWcnLCB7CiAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ3VzZXJfY29uZmlnLnBocCcsCiAgICAgIGNvbnRyb2xsZXI6ICdDb25maWdVc2VyQ29udHJvbGxlcicKICAgIH0pLgogICAgd2hlbignL2J1c2luZXNzX2RvY3MnLCB7CiAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2RvY3MuaHRtbCcsCiAgICAgIGNvbnRyb2xsZXI6ICdCdXNpbmVzc0RvY3NDb250cm9sbGVyJwogICAgfSkuCiAgICB3aGVuKCcvJywgewogICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdob21lLnBocCcsCiAgICAgIGNvbnRyb2xsZXI6ICdIb21lQ29udHJvbGxlcicKICAgIH0pLgogICAgb3RoZXJ3aXNlKHsKICAgICAgLy8gICAgcmVkaXJlY3RUbzogJy8nCiAgICB9KTsKICB9Cl0pOwoKa3V6ZUFwcC5mYWN0b3J5KCdodHRwSW50ZXJjZXB0b3InLCBbJyRxJywgJyRyb290U2NvcGUnLAogIGZ1bmN0aW9uICgkcSwgJHJvb3RTY29wZSkgewogICAgdmFyIGxvYWRpbmdDb3VudCA9IDA7CgogICAgcmV0dXJuIHsKICAgICAgcmVxdWVzdDogZnVuY3Rpb24gKGNvbmZpZykgewogICAgICAgIGlmKCsrbG9hZGluZ0NvdW50ID09PSAxKSAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2xvYWRpbmc6cHJvZ3Jlc3MnKTsKICAgICAgICByZXR1cm4gY29uZmlnIHx8ICRxLndoZW4oY29uZmlnKTsKICAgICAgfSwKCiAgICAgIHJlc3BvbnNlOiBmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBpZigtLWxvYWRpbmdDb3VudCA9PT0gMCkgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdsb2FkaW5nOmZpbmlzaCcpOwogICAgICAgIHJldHVybiByZXNwb25zZSB8fCAkcS53aGVuKHJlc3BvbnNlKTsKICAgICAgfSwKCiAgICAgIHJlc3BvbnNlRXJyb3I6IGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIGlmKC0tbG9hZGluZ0NvdW50ID09PSAwKSAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2xvYWRpbmc6ZmluaXNoJyk7CiAgICAgICAgcmV0dXJuICRxLnJlamVjdChyZXNwb25zZSk7CiAgICAgIH0KICAgIH07CiAgfQpdKS5jb25maWcoWyckaHR0cFByb3ZpZGVyJywgZnVuY3Rpb24gKCRodHRwUHJvdmlkZXIpIHsKICAkaHR0cFByb3ZpZGVyLmludGVyY2VwdG9ycy5wdXNoKCdodHRwSW50ZXJjZXB0b3InKTsKfV0pOwoKa3V6ZUFwcC5mYWN0b3J5KCdzaGFyZWREYXRhJywgZnVuY3Rpb24oKSB7CiAgdmFyIHNlbGVjdGVkRW5kVXNlciA9IG51bGw7CgogIHJldHVybiB7CiAgICBnZXRTZWxlY3RlZEVuZFVzZXI6IGZ1bmN0aW9uKCkgewogICAgICAvL1lvdSBjb3VsZCBhbHNvIHJldHVybiBzcGVjaWZpYyBhdHRyaWJ1dGUgb2YgdGhlIGZvcm0gZGF0YSBpbnN0ZWFkCiAgICAgIC8vb2YgdGhlIGVudGlyZSBkYXRhCiAgICAgIHJldHVybiBzZWxlY3RlZEVuZFVzZXI7CiAgICB9LAogICAgc2V0U2VsZWN0ZWRFbmRVc2VyOiBmdW5jdGlvbihuZXdTZWxlY3RlZEVuZFVzZXIpIHsKICAgICAgLy9Zb3UgY291bGQgYWxzbyBzZXQgc3BlY2lmaWMgYXR0cmlidXRlIG9mIHRoZSBmb3JtIGRhdGEgaW5zdGVhZAogICAgICBzZWxlY3RlZEVuZFVzZXIgPSBuZXdTZWxlY3RlZEVuZFVzZXI7CiAgICB9LAogIH07Cn0pOwoKa3V6ZUFwcC5kaXJlY3RpdmUoJ2NvbnZlcnRUb051bWJlcicsIGZ1bmN0aW9uKCkgewogIHJldHVybiB7CiAgICByZXF1aXJlOiAnbmdNb2RlbCcsCiAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWxlbWVudCwgYXR0cnMsIG5nTW9kZWwpIHsKICAgICAgbmdNb2RlbC4kcGFyc2Vycy5wdXNoKGZ1bmN0aW9uKHZhbCkgewogICAgICAgIHJldHVybiB2YWwgIT0gbnVsbCA/IHBhcnNlSW50KHZhbCwgMTApIDogbnVsbDsKICAgICAgfSk7CiAgICAgIG5nTW9kZWwuJGZvcm1hdHRlcnMucHVzaChmdW5jdGlvbih2YWwpIHsKICAgICAgICByZXR1cm4gdmFsICE9IG51bGwgPyAnJyArIHZhbCA6IG51bGw7CiAgICAgIH0pOwogICAgfQogIH07Cn0pOwoKa3V6ZUFwcC5kaXJlY3RpdmUoJ2VsYXN0aWMnLCBbCiAgJyR0aW1lb3V0JywKICBmdW5jdGlvbigkdGltZW91dCkgewogICAgcmV0dXJuIHsKICAgICAgcmVzdHJpY3Q6ICdBJywKICAgICAgbGluazogZnVuY3Rpb24oJHNjb3BlLCBlbGVtZW50KSB7CiAgICAgICAgJHNjb3BlLmluaXRpYWxIZWlnaHQgPSAkc2NvcGUuaW5pdGlhbEhlaWdodCB8fCBlbGVtZW50WzBdLnN0eWxlLmhlaWdodDsKICAgICAgICB2YXIgcmVzaXplID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICBlbGVtZW50WzBdLnN0eWxlLmhlaWdodCA9ICRzY29wZS5pbml0aWFsSGVpZ2h0OwogICAgICAgICAgZWxlbWVudFswXS5zdHlsZS5oZWlnaHQgPSAiIiArIGVsZW1lbnRbMF0uc2Nyb2xsSGVpZ2h0ICsgInB4IjsKICAgICAgICB9OwogICAgICAgIGVsZW1lbnQub24oImlucHV0IGNoYW5nZSIsIHJlc2l6ZSk7CiAgICAgICAgLy8gZWxlbWVudC5vbigiaW5wdXQgY2hhbmdlIiwgcmVzaXplKTsKICAgICAgICAkdGltZW91dChyZXNpemUsIDApOwogICAgICB9CiAgICB9OwogIH0KXSk7CgprdXplQXBwLnNlcnZpY2UoJ3NoYXJlZFByb3BlcnRpZXMnLCBmdW5jdGlvbiAoKSB7CiAgdmFyIHNlbGVjdGVkX3VzZXIgPSBudWxsOwogIHZhciBjYWxlbmRhcl9kYXRlID0gbnVsbDsKICB2YXIgZXZlbnRfcmVzY2hlZHVsZSA9IG51bGw7CiAgdmFyIHNlbGVjdGVkX2luc3RydWN0b3IgPSAwOwogIHZhciBldmVudF90eXBlX2Zvcl9zdWdnZXN0aW9ucyA9IG51bGw7CiAgcmV0dXJuIHsKICAgIGdldF9zZWxlY3RlZF9pbnN0cnVjdG9yOiBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBzZWxlY3RlZF9pbnN0cnVjdG9yOwogICAgfSwKICAgIHNldF9zZWxlY3RlZF9pbnN0cnVjdG9yOiBmdW5jdGlvbih2YWx1ZSkgewogICAgICBzZWxlY3RlZF9pbnN0cnVjdG9yID0gdmFsdWU7CiAgICB9LAogICAgZ2V0X3NlbGVjdGVkX3VzZXI6IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHNlbGVjdGVkX3VzZXI7CiAgICB9LAogICAgc2V0X3NlbGVjdGVkX3VzZXI6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgIHNlbGVjdGVkX3VzZXIgPSB2YWx1ZTsKICAgIH0sCiAgICBzZXRfZXZlbnRfcmVzY2hlZHVsZTogZnVuY3Rpb24odmFsdWUpIHsKICAgICAgZXZlbnRfcmVzY2hlZHVsZSA9IHZhbHVlOwogICAgfSwKICAgIGdldF9ldmVudF9yZXNjaGVkdWxlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBldmVudF9yZXNjaGVkdWxlOwogICAgfSwKICAgIGdldF9jYWxlbmRhcl9kYXRlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBjYWxlbmRhcl9kYXRlOwogICAgfSwKICAgIHNldF9jYWxlbmRhcl9kYXRlOiBmdW5jdGlvbih2YWx1ZSkgewogICAgICBjYWxlbmRhcl9kYXRlID0gdmFsdWU7CiAgICB9LAogICAgZ2V0X2V2ZW50X3R5cGVfZm9yX3N1Z2dlc3Rpb25zOiBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBldmVudF90eXBlX2Zvcl9zdWdnZXN0aW9uczsKICAgIH0sCiAgICBzZXRfZXZlbnRfdHlwZV9mb3Jfc3VnZ2VzdGlvbnM6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgIC8vIGxvZ0RlYnVnKCJzZXRfZXZlbnRfdHlwZV9mb3Jfc3VnZ2VzdGlvbnM9Iit2YWx1ZSk7CiAgICAgIGV2ZW50X3R5cGVfZm9yX3N1Z2dlc3Rpb25zID0gdmFsdWU7CiAgICB9CiAgfTsKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ21lbnVDb250cm9sbGVyJywgWyckc2NvcGUnLCAnJGxvY2F0aW9uJywgZnVuY3Rpb24oJHNjb3BlLCAkbG9jYXRpb24pIHsKICByZXR1cm4gdHJ1ZTsKICBsb2dEZWJ1ZygiJHNjb3BlLmlzQ3VycmVudFBhdGg9IiArICRzY29wZS5pc0N1cnJlbnRQYXRoKTsKICAkc2NvcGUuaXNDdXJyZW50UGF0aCA9IGZ1bmN0aW9uKHBhdGgpIHsKICAgIHJldHVybiAkbG9jYXRpb24ucGF0aCgpID09IHBhdGg7CiAgfTsKfV0pOwoKCgprdXplQXBwLmNvbnRyb2xsZXIoJ0J1c2luZXNzUmVwb3J0c0NvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkbG9jYXRpb24sJHJvdXRlUGFyYW1zKQp7CgogIGxvZ0RlYnVnKCJjb250cm9sbGVyOiBCdXNpbmVzc1JlcG9ydHNDb250cm9sbGVyIik7CgogICRzY29wZS5vcmRlckJ5RmllbGQgPSAnc3RhcnRfZXBvY2gnOwogICRzY29wZS5yZXZlcnNlU29ydD10cnVlOwogICRzY29wZS5ldmVudE1vZGVsPXRydWU7CgogIGdldEJ1c2luZXNzTG9jYXRpb25zKCRodHRwLCRzY29wZSwnYnVzaW5lc3NfbG9jYXRpb25zJyk7CiAgZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzKCRodHRwLCRzY29wZSwnZXZlbnRfdHlwZXMnKTsKICBnZXRBbGxJbnN0cnVjdG9ycygkaHR0cCwkc2NvcGUsJ2luc3RydWN0b3JzJyk7CiAgZ2V0QWxsQ2xpZW50c0FuZEFyY2hpdmUoJGh0dHAsJHNjb3BlLCdjbGllbnRzJyk7CiAgJHNjb3BlLnN0YXR1c2VzID0gWyB7InN0YXR1c19pZCI6IjAiLCJzdGF0dXNfbmFtZSI6Itek16rXldeXIn0sIHsic3RhdHVzX2lkIjoiMSIsInN0YXR1c19uYW1lIjoi16HXkteV16gifV07CiAgJHNjb3BlLmNhbmNlbGxhdGlvbnMgPSBbIHsiaXNfY2FuY2VsZWQiOiIwIiwiY2FuY2VsbGF0aW9uX25hbWUiOiLXnNeQINeR15XXmNecIn0seyJpc19jYW5jZWxlZCI6IjEiLCJjYW5jZWxsYXRpb25fbmFtZSI6IteR15XXmNecIn1dOwogICRzY29wZS5tb250aHMgPSBbIHsibW9udGgiOiIxIn0seyJtb250aCI6IjIifSx7Im1vbnRoIjoiMyJ9LHsibW9udGgiOiI0In0seyJtb250aCI6IjUifSx7Im1vbnRoIjoiNiJ9LHsibW9udGgiOiI3In0seyJtb250aCI6IjgifSx7Im1vbnRoIjoiOSJ9LHsibW9udGgiOiIxMCJ9LHsibW9udGgiOiIxMSJ9LHsibW9udGgiOiIxMiJ9XTsKICAkc2NvcGUueWVhcnMgPSBbIHsieWVhciI6IjIwMTYifSx7InllYXIiOiIyMDE3In1dOwogICRzY29wZS5wZXJpb2RzID0gWwogICAgeyJwZXJpb2RfbmFtZSI6IteU15nXodeY15XXqNeZIiwgInBlcmlvZF9zaWduIjoiLTEifSwKICAgIHsicGVyaW9kX25hbWUiOiLXlNeZ15XXnSIsICJwZXJpb2Rfc2lnbiI6IjAifSwKICAgIHsicGVyaW9kX25hbWUiOiLXoteq15nXk9eZIiwgInBlcmlvZF9zaWduIjoiMSJ9LAogIF0KCiAgJHNjb3BlLmNzdl9jb2x1bW5zX29yZGVyID0gWydldmVudF90eXBlX25hbWUnLCAnc3RhcnRfdGltZScsICdldmVudF91c2VyX2NsaWVudHMnLCAnaW5zdHJ1Y3Rvcl9uYW1lJywgJ2lzX2NhbmNlbGVkJywgJ2lzX2NvbXBsZXRlZCcsICdhY3R1YWxfcHJpY2UnLCAncGFydGljaXBhdGVkJ107CiAgJHNjb3BlLmNzdl9jb2x1bW5zX2hlYWRlciA9IFsn16HXldeSINee16TXktepJywgJ9eq15DXqNeZ15og15XXqdei15QnLCAn157Xqdeq16rXpNeZ150nLCAn157Xk9eo15nXmicsJ9ee15HXldeY15wnLCAn16HXkteV16gnLCAn157Xl9eZ16gnLCAn157Xqdeq16rXpNeZ150nXTsKCgoKICAkc2NvcGUuZ290b0NsaWVudFBhZ2U9IGZ1bmN0aW9uIChidXNpbmVzc1VzZXJpZCkgewogICAgZ290b0NsaWVudFBhZ2UoYnVzaW5lc3NVc2VyaWQpOwogIH0KCiAgZnVuY3Rpb24gbGlzdF90b19zdHJpbmdfYnlfdmFsdWUoeCx2YWx1ZSl7CiAgICBpZiAoIHggIT0gdW5kZWZpbmVkICl7CiAgICAgIHZhciB4MSA9IG5ldyBBcnJheSgpOwogICAgICBmb3IgKGkgPSAwOyBpIDwgeC5sZW5ndGg7IGkrKyl7CiAgICAgICAgeDFbaV0gPSB4W2ldW3ZhbHVlXTsKICAgICAgfQogICAgICB4MSA9IHgxLmpvaW4oKTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHJldHVybiB4MTsKICB9CgogICRzY29wZS5yZXBvcnRfaXNfbG9hZGluZyA9IGZhbHNlOwoKICAkc2NvcGUuZXZlbnRzUmVwb3J0ID0gZnVuY3Rpb24oKXsKICAgIGxvZ0RlYnVnKCJldmVudHNSZXBvcnQiKTsKCiAgICAkc2NvcGUuc2hvd0FnZyA9ICgkc2NvcGUuZXZlbnRUeXBlTW9kZWwpIHx8CiAgICAgICAgKCRzY29wZS5pbnN0cnVjdG9yTW9kZWwpIHx8ICgkc2NvcGUubW9udGhNb2RlbCkgfHwgKCRzY29wZS5jbGllbnRzTW9kZWwpIHx8ICgkc2NvcGUueWVhck1vZGVsKSA7CgogICAgZXZlbnRfdHlwZV9pZF9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuc2VsZWN0ZWRFdmVudFR5cGVGaWx0ZXIsICJldmVudF90eXBlX2lkIiApOwogICAgaW5zdHJ1Y3Rvcl9pZF9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuc2VsZWN0ZWRJbnN0cnVjdG9yRmlsdGVyLCAiYnVzaW5lc3NfdXNlcl9pZCIgKTsKICAgIG1vbnRoX2ZpbHRlciA9IGxpc3RfdG9fc3RyaW5nX2J5X3ZhbHVlKCRzY29wZS5zZWxlY3RlZE1vbnRoRmlsdGVyLCAibW9udGgiICk7CiAgICBjbGllbnRfZmlsdGVyID0gbGlzdF90b19zdHJpbmdfYnlfdmFsdWUoJHNjb3BlLnNlbGVjdGVkQ2xpZW50RmlsdGVyLCAiYnVzaW5lc3NfdXNlcl9pZCIgKTsKICAgIHllYXJfZmlsdGVyID0gbGlzdF90b19zdHJpbmdfYnlfdmFsdWUoJHNjb3BlLnNlbGVjdGVkWWVhckZpbHRlciwgInllYXIiICk7CiAgICBzdGF0dXNfZmlsdGVyID0gbGlzdF90b19zdHJpbmdfYnlfdmFsdWUoJHNjb3BlLnNlbGVjdGVkU3RhdHVzRmlsdGVyLCAic3RhdHVzX2lkIiApOwogICAgaXNfY2FuY2VsZWRfZmlsdGVyID0gbGlzdF90b19zdHJpbmdfYnlfdmFsdWUoJHNjb3BlLnNlbGVjdGVkSXNfY2FuY2VsZWRGaWx0ZXIsICJpc19jYW5jZWxlZCIgKTsKICAgIHBlcmlvZF9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuc2VsZWN0ZWRQZXJpb2RGaWx0ZXIsICJwZXJpb2Rfc2lnbiIgKTsKCiAgICAkc2NvcGUuZXZlbnRSZXBvcnRDb25maWcgPSB7fTsKCiAgICAkc2NvcGUuZXZlbnRSZXBvcnRDb25maWcuc291cmNlID0gImRvY3MiOwoKICAgICRzY29wZS5ldmVudFJlcG9ydENvbmZpZy5maWx0ZXJzID0gewogICAgICBldmVudF90eXBlX2lkOiBldmVudF90eXBlX2lkX2ZpbHRlciwKICAgICAgaW5zdHJ1Y3Rvcl9pZDogaW5zdHJ1Y3Rvcl9pZF9maWx0ZXIsCiAgICAgIG1vbnRoOiBtb250aF9maWx0ZXIsCiAgICAgIHllYXI6IHllYXJfZmlsdGVyLAogICAgICBjbGllbnQ6IGNsaWVudF9maWx0ZXIsCiAgICAgIHN0YXR1czogc3RhdHVzX2ZpbHRlciwKICAgICAgcGVyaW9kOiBwZXJpb2RfZmlsdGVyLAogICAgICBpc19jYW5jZWxlZDogaXNfY2FuY2VsZWRfZmlsdGVyCiAgICB9OwoKICAgICRzY29wZS5ldmVudFJlcG9ydENvbmZpZy5hZ2dyZWdhdGlvbnMgPSB7CiAgICAgIGV2ZW50X3R5cGVfaWQ6ICRzY29wZS5ldmVudFR5cGVNb2RlbCwKICAgICAgaW5zdHJ1Y3Rvcl9pZDogJHNjb3BlLmluc3RydWN0b3JNb2RlbCwKICAgICAgbW9udGg6ICRzY29wZS5tb250aE1vZGVsLAogICAgICB5ZWFyOiAkc2NvcGUueWVhck1vZGVsLAogICAgICBjbGllbnQ6ICRzY29wZS5jbGllbnRNb2RlbCwKICAgIH07CgogICAgaWYgKCAkc2NvcGUuc2hvd0FnZyApIHsKICAgICAgZ2V0RXZlbnRzUmVwb3J0KCRodHRwLCRzY29wZSwgJHNjb3BlLmV2ZW50UmVwb3J0Q29uZmlnLCBnZXRFdmVudHNSZXBvcnRBZ2dyZWdhdGVkX3N1Y2Nlc3MpOwogICAgICAkc2NvcGUucmVwb3J0X2lzX2xvYWRpbmcgPSB0cnVlOwogICAgfSBlbHNlIHsKICAgICAgZ2V0RXZlbnRzUmVwb3J0KCRodHRwLCRzY29wZSwgJHNjb3BlLmV2ZW50UmVwb3J0Q29uZmlnLCBnZXRFdmVudHNSZXBvcnRMaXN0X3N1Y2Nlc3MpOwogICAgICAkc2NvcGUucmVwb3J0X2lzX2xvYWRpbmcgPSB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldEV2ZW50c1JlcG9ydExpc3Rfc3VjY2VzcyhyZXNwb25zZSl7CiAgICAgICRzY29wZS5FdmVudFJlcG9ydExpc3QgPSByZXNwb25zZS5qc29uOwogICAgICAkc2NvcGUuZG93bmxvYWRfcmVwb3J0ID0gJHNjb3BlWyAnRXZlbnRSZXBvcnRMaXN0JyBdOwogICAgICAkc2NvcGUucmVwb3J0X2lzX2xvYWRpbmcgPSBmYWxzZTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRFdmVudHNSZXBvcnRBZ2dyZWdhdGVkX3N1Y2Nlc3MocmVzcG9uc2UpewogICAgICAkc2NvcGUuRXZlbnRSZXBvcnRBZ2dyZWdhdGVkID0gcmVzcG9uc2UuanNvbjsKICAgICAgJHNjb3BlLmRvd25sb2FkX3JlcG9ydCA9ICRzY29wZVsgJ0V2ZW50UmVwb3J0QWdncmVnYXRlZCcgXTsKICAgICAgJHNjb3BlLnJlcG9ydF9pc19sb2FkaW5nID0gZmFsc2U7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0Q2xpZW50c1JlcG9ydExpc3Rfc3VjY2VzcyhyZXNwb25zZSl7CiAgICAgICRzY29wZS5DbGllbnRzUmVwb3J0TGlzdCA9IHJlc3BvbnNlLmpzb247CiAgICAgIGNvbnNvbGUubG9nKCItLS0tLS0tLS0tLS0iKQogICAgICBjb25zb2xlLmxvZygkc2NvcGUuQ2xpZW50c1JlcG9ydExpc3QpCiAgICAgIGNvbnNvbGUubG9nKCItLS0tLS0tLS0tLS0iKQogICAgICAkc2NvcGUucmVwb3J0X2lzX2xvYWRpbmcgPSBmYWxzZTsKICAgIH0KCgogIH0KCiAgJHNjb3BlLmNsaWVudHNSZXBvcnQgPSBmdW5jdGlvbigpewogICAgbG9nRGVidWcoImNsaWVudHNSZXBvcnQiKTsKCiAgICBjbGllbnRfZmlsdGVyID0gbGlzdF90b19zdHJpbmdfYnlfdmFsdWUoJHNjb3BlLnNlbGVjdGVkQ2xpZW50RmlsdGVyLCAiY2xpZW50IiApOwoKICAgICRzY29wZS5ldmVudFJlcG9ydENvbmZpZyA9IHt9OwoKICAgICRzY29wZS5ldmVudFJlcG9ydENvbmZpZy5maWx0ZXJzID0gewogICAgICBjbGllbnQ6IGNsaWVudF9maWx0ZXIsCiAgICB9OwoKICAgICRzY29wZS5ldmVudFJlcG9ydENvbmZpZy5hZ2dyZWdhdGlvbnMgPSB7CiAgICB9OwoKICAgIGdldENsaWVudHNSZXBvcnQoJGh0dHAsJHNjb3BlLCBnZXRDbGllbnRzUmVwb3J0X3N1Y2Nlc3MpOwogICAgJHNjb3BlLnJlcG9ydF9pc19sb2FkaW5nID0gdHJ1ZTsKICAgIGZ1bmN0aW9uIGdldENsaWVudHNSZXBvcnRfc3VjY2VzcyhyZXNwb25zZSl7CiAgICAgICRzY29wZS5jbGllbnRSZXBvcnQgPSByZXNwb25zZS5qc29uOwogICAgICAkc2NvcGUuZG93bmxvYWRfcmVwb3J0ID0gJHNjb3BlWyAnY2xpZW50UmVwb3J0JyBdOwogICAgICAkc2NvcGUucmVwb3J0X2lzX2xvYWRpbmcgPSBmYWxzZTsKICAgIH0KICB9CgogICRzY29wZS5lZGl0RXZlbnQ9IGZ1bmN0aW9uICh0aGVldmVudCkKICB7CiAgICBnb3RvRXZlbnRQYWdlKHRoZWV2ZW50KTsKICB9CgogICRzY29wZS5ldmVudHNSZXBvcnQoKTsKICAkc2NvcGUuc2VsZWN0ZWRSZXBvcnQ9ImV2ZW50cyI7Cn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdidXNpbmVzc19wYWNrYWdlc191cGRhdGVfY250bCcsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbiwkcm91dGVQYXJhbXMpCnsKICAkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyID0ge307IC8vIHRoZXNlIGFyZSB0aGUgY29tcGxldGUgZGV0YWlscyBmb3IgdGhlIG5ldyBldmVudCAvLwogICRzY29wZS5wYWNrYWdlX2lzX3VwZGF0ZSA9IHRydWU7CiAgJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5wYWNrYWdlX2xpbWl0X3R5cGU9MTsKCi8vIGdldHR0aW5nIHRoZSBwYWNrYWdlIGFuZCBpdHMgZXZlbnQgdHlwZXMKICBnZXRCdXNpbmVzc1BhY2thZ2UoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5wYWNrYWdlX2lkLCdmb3JtQWRkUGFja2FnZUFuZ3VsYXInLGZ1bmN0aW9uKHJlc3BvbnNlKQogIHsKICAgICRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuaXNfdXBkYXRlID0gdHJ1ZTsKICAgICRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIub3JpZ0V2ZW50VHlwZXM9YW5ndWxhci5jb3B5KCRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuc2VsZWN0ZWRFdmVudFR5cGVzKTsKICAgICRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIucGFja2FnZV9saW1pdF90eXBlPTE7Ci8vIHRoZW4gZ2V0dGluZyBhbGwgdGhlIGV2ZW50IHR5cGVzCiAgICBnZXRFdmVudFR5cGVzTm9BZG1pbigkaHR0cCwkc2NvcGUsJ3JlbGF0ZWRFdmVudFR5cGVzJyxnZXRFdmVudFR5cGVzTm9BZG1pbl9zdWNjZXNzKTsKICAgIGZ1bmN0aW9uIGdldEV2ZW50VHlwZXNOb0FkbWluX3N1Y2Nlc3MoKQogICAgewovLyB0aGVuIHJlbW92aW5nIGV4aXN0aW5nIGV2ZW50IHR5cGVzIG9mIHBhY2thZ2UgZnJvbSBsaXN0Ci8vIGNvbnNvbGUubG9nKCRzY29wZS5yZWxhdGVkRXZlbnRUeXBlc1swXSk7Ci8vIGNvbnNvbGUubG9nKCRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuc2VsZWN0ZWRFdmVudFR5cGVzWzBdKTsKICAgICAgZm9yKHZhciBpID0gMDsgaSA8ICRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuc2VsZWN0ZWRFdmVudFR5cGVzLmxlbmd0aDsgaSsrKQogICAgICB7Ci8vIGNvcHlpbmcgdGhlIGFjdHVhbCBvYmplY3Qgb2YgJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5zZWxlY3RlZEV2ZW50VHlwZXNbaV0KICAgICAgICBmb3IodmFyIGogPSAwOyBqIDwgJHNjb3BlLnJlbGF0ZWRFdmVudFR5cGVzLmxlbmd0aDsgaisrKQogICAgICAgIHsKICAgICAgICAgIGlmICgkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLnNlbGVjdGVkRXZlbnRUeXBlc1tpXS5ldmVudF90eXBlX2lkPT0kc2NvcGUucmVsYXRlZEV2ZW50VHlwZXNbal0uZXZlbnRfdHlwZV9pZCkKICAgICAgICAgIHsKICAgICAgICAgICAgJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5zZWxlY3RlZEV2ZW50VHlwZXNbaV09YW5ndWxhci5jb3B5KCRzY29wZS5yZWxhdGVkRXZlbnRUeXBlc1tqXSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfSk7CiAgJHNjb3BlLmdvdG9CYWNrID0gZ290b0JhY2s7CiAgJHNjb3BlLmNyZWF0ZVBhY2thZ2UgPSBmdW5jdGlvbigpCiAgewogICAgY29uc29sZS5sb2coInVwZGF0ZVBhY2thZ2VEZXRhaWxzIik7CiAgICB1cGRhdGVQYWNrYWdlRGV0YWlscygkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLnBhY2thZ2VfaWQsJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhcixzdWNjZXNzX2NhbGxiYWNrLCBmYWlsdXJlX2NhbGxiYWNrKTsKICAgIGZ1bmN0aW9uIHN1Y2Nlc3NfY2FsbGJhY2soKQogICAgewogICAgICBnb3RvQmFjaygpOwogICAgfQogICAgZnVuY3Rpb24gZmFpbHVyZV9jYWxsYmFjaygpCiAgICB7CiAgICAgIGdvdG9CYWNrKCk7CiAgICB9CiAgfTsKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2J1c2luZXNzX3BhY2thZ2VzX2FkZF9jbnRsJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uKSB7CiAgbG9nRGVidWcoJ2J1c2luZXNzX3BhY2thZ2VzX2FkZF9jbnRsJyk7CiAgJHNjb3BlLnBhY2thZ2VfaXNfdXBkYXRlID0gZmFsc2U7CiAgJHNjb3BlLmdvdG9CYWNrID0gZ290b0JhY2s7CiAgJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhciA9IHt9OwogICRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuZXZlbnRzX2NvdW50ZXIgPSAxOwogICRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuZXZlbnRzX3Blcl93ZWVrID0gMTsKICAkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLnBhY2thZ2VfZHVyYXRpb25fbW9udGhzID0gMzsKICAkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLnBhY2thZ2VfbGltaXRfdHlwZT0xOwogIGdldEV2ZW50VHlwZXNOb0FkbWluKCRodHRwLCRzY29wZSwncmVsYXRlZEV2ZW50VHlwZXMnKTsKCiAgJHNjb3BlLmNyZWF0ZVBhY2thZ2UgPSBmdW5jdGlvbigpCiAgewogICAgY3JlYXRlUGFja2FnZSgkaHR0cCwkc2NvcGUsJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhcixjcmVhdGVQYWNrYWdlX3N1Y2Nlc3MsIGNyZWF0ZVBhY2thZ2VfZmFpbHVyZSk7CiAgICBmdW5jdGlvbiBjcmVhdGVQYWNrYWdlX3N1Y2Nlc3MoKQogICAgewogICAgICAkbG9jYXRpb24ucGF0aCgnL3BhY2thZ2VzJyk7CiAgICB9CiAgICBmdW5jdGlvbiBjcmVhdGVQYWNrYWdlX2ZhaWx1cmUoKQogICAgewovLyBsb2dFcnJvcigiZXJyb3IgIiArIGRhdGEubWVzc2FnZSk7Ci8vICRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuYWpheF9lcnJvciA9IGRhdGEubWVzc2FnZTsKICAgIH0KICB9Cn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdidXNpbmVzc19sb2NhdGlvbnMnLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkbG9jYXRpb24pIHsKICBsb2dEZWJ1ZygnYnVzaW5lc3NfbG9jYXRpb25zIGNvbnRyb2xsZXInKTsKICBnZXRCdXNpbmVzc0xvY2F0aW9ucygkaHR0cCwkc2NvcGUsJ2J1c2luZXNzX2xvY2F0aW9ucycpOwogICRzY29wZS5hZGROZXdMb2NhdGlvbiA9IGZ1bmN0aW9uICgpCiAgewogICAgJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19sb2NhdGlvbnMvYWRkJyk7CiAgfQogICRzY29wZS5nb3RvTG9jYXRpb25QYWdlID0gZnVuY3Rpb24obG9jYXRpb25faWQpCiAgewogICAgZ290b0xvY2F0aW9uUGFnZShsb2NhdGlvbl9pZCk7CiAgfQp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ0J1c2luZXNzRG9jc0NvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkbG9jYXRpb24pIHsKICBsb2dEZWJ1ZygnQnVzaW5lc3NEb2NzQ29udHJvbGxlcicpOwp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ2J1c2luZXNzX2xvY2F0aW9uc191cGRhdGUnLCBmdW5jdGlvbigkc2NvcGUsICRyb3V0ZVBhcmFtcywgJGh0dHAsICRsb2NhdGlvbikgewogIGxvZ0RlYnVnKCdidXNpbmVzc19sb2NhdGlvbnNfdXBkYXRlIGNvbnRyb2xsZXInKTsKICAkc2NvcGUuaXNfdXBkYXRlPXRydWU7Ci8vIGdldEJ1c2luZXNzTG9jYXRpb25zKCRodHRwLCRzY29wZSwnYnVzaW5lc3NfbG9jYXRpb25zJyk7CiAgZ2V0QnVzaW5lc3NMb2NhdGlvbigkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmxvY2F0aW9uX2lkLCdjdXJyX2xvY2F0aW9uJyxnZXRCdXNpbmVzc0xvY2F0aW9uX3N1Y2Nlc3MpOwogIGZ1bmN0aW9uIGdldEJ1c2luZXNzTG9jYXRpb25fc3VjY2VzcygpCiAgewogICAgJHNjb3BlLmZvcm1BZGRMb2NhdGlvbkFuZ3VsYXI9JHNjb3BlLmN1cnJfbG9jYXRpb25bMF07CiAgfQoKCiAgJHNjb3BlLmFkZExvY2F0aW9uID0gZnVuY3Rpb24oKQogIHsKLy8gaW4gdGhpcyBjYXNlIC0gdXBkYXRlIGxvY2F0aW9uCiAgICB0aGVkYXRhID0gJHNjb3BlLmZvcm1BZGRMb2NhdGlvbkFuZ3VsYXI7CgogICAgZnVuY3Rpb24gYWRkTG9jYXRpb25fc3VjY2VzcygpCiAgICB7CiAgICAgICRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfbG9jYXRpb25zJyk7CiAgICB9CiAgICBmdW5jdGlvbiBhZGRMb2NhdGlvbl9mYWlsdXJlKCkKICAgIHsKICAgICAgJHNjb3BlLmZvcm1BZGRMb2NhdGlvbkFuZ3VsYXIuYWpheF9lcnJvciA9IHJlc3BvbnNlLm1lc3NhZ2U7CiAgICB9CiAgICB1cGRhdGVMb2NhdGlvbigkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmxvY2F0aW9uX2lkLCB0aGVkYXRhLGFkZExvY2F0aW9uX3N1Y2Nlc3MsYWRkTG9jYXRpb25fZmFpbHVyZSk7CiAgfQp9KTsKCmt1emVBcHAuY29udHJvbGxlcignYnVzaW5lc3NfbG9jYXRpb25zX2FkZCcsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikgewogIGxvZ0RlYnVnKCdidXNpbmVzc19sb2NhdGlvbnNfYWRkIGNvbnRyb2xsZXInKTsKICBnZXRCdXNpbmVzc0xvY2F0aW9ucygkaHR0cCwkc2NvcGUsJ2J1c2luZXNzX2xvY2F0aW9ucycpOwogICRzY29wZS5pc191cGRhdGU9ZmFsc2U7CgogICRzY29wZS5hZGRMb2NhdGlvbiA9IGZ1bmN0aW9uKCkKICB7CiAgICB0aGVkYXRhID0gJHNjb3BlLmZvcm1BZGRMb2NhdGlvbkFuZ3VsYXI7CgogICAgZnVuY3Rpb24gYWRkTG9jYXRpb25fc3VjY2VzcygpCiAgICB7CiAgICAgICRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfbG9jYXRpb25zJyk7CiAgICB9CiAgICBmdW5jdGlvbiBhZGRMb2NhdGlvbl9mYWlsdXJlKCkKICAgIHsKICAgICAgJHNjb3BlLmZvcm1BZGRMb2NhdGlvbkFuZ3VsYXIuYWpheF9lcnJvciA9IHJlc3BvbnNlLm1lc3NhZ2U7CiAgICB9CiAgICBhZGRMb2NhdGlvbigkaHR0cCwkc2NvcGUsdGhlZGF0YSxhZGRMb2NhdGlvbl9zdWNjZXNzLGFkZExvY2F0aW9uX2ZhaWx1cmUpOwogIH0KfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ0luc3RydWN0b3JzQWRkQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikgewogIGxvZ0RlYnVnKCdJbnN0cnVjdG9yc0FkZENvbnRyb2xsZXInKTsKICAkc2NvcGUuaXNJbnN0cnVjdG9yPXRydWU7CiAgJHNjb3BlLnVzZXJ0eXBlPSJpbnN0cnVjdG9yIjsKICAkc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIgPSB7fTsKICAkc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIuaXNfdXBkYXRlPWZhbHNlOwogICRzY29wZS5hZGRDbGllbnQgPSBmdW5jdGlvbigpIC8vIGFkZCBpbnN0cnVjdG9yLCB1c2luZyB0aGUgc2FtZSBmdW5jdGlvbiBuYW1lIGFzIHdlIHVzZSB0aGUgc2FtZSBzY3JlZW4KICB7CiAgICB0aGVkYXRhID0gJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyOwoKICAgIGZ1bmN0aW9uIGFkZEluc3RydWN0b3Jfc3VjY2VzcygpCiAgICB7CiAgICAgICRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfaW5zdHJ1Y3RvcnMnKTsKICAgIH0KICAgIGZ1bmN0aW9uIGFkZENsaWVudF9mYWlsdXJlKCkKICAgIHsKICAgICAgJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyLmFqYXhfZXJyb3IgPSByZXNwb25zZS5tZXNzYWdlOwogICAgfQogICAgYWRkSW5zdHJ1Y3RvcigkaHR0cCwkc2NvcGUsdGhlZGF0YSxhZGRJbnN0cnVjdG9yX3N1Y2Nlc3MpOwogIH0KfSk7Cmt1emVBcHAuY29udHJvbGxlcignQ2xpZW50c0FkZENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkdGltZW91dCwgJGxvY2F0aW9uLCBzaGFyZWRQcm9wZXJ0aWVzKSB7CiAgbG9nRGVidWcoJ0NsaWVudHNBZGRDb250cm9sbGVyIC0gVGhpcyBpcyBBZGQgbmV3IGNsaWVudCBzY3JlZW4nKTsKICAkc2NvcGUuaXNJbnN0cnVjdG9yPWZhbHNlOwoKICAkc2NvcGUudXNlcnR5cGU9ImVuZHVzZXIiOwogICRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhciA9IHt9OwogICRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5pc191cGRhdGU9ZmFsc2U7CiAgJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyLmRpc2FibGVfcGhvbmVfZWRpdGluZz1mYWxzZTsKCiAgaWYgKCgkc2NvcGUuZmlsdGVyLlZhbHVlICE9ICIiKSAmJiAodHlwZW9mICRzY29wZS5maWx0ZXIuVmFsdWUgIT0gJ3VuZGVmaW5lZCcpKSB7CiAgICBsb2dEZWJ1ZygiY2xpZW50cyBmaWx0ZXIgaXMgbm90IGVtcHR5Iik7CiAgICB2YXIgZmlsdGVyID0gU3RyaW5nKCRzY29wZS5maWx0ZXIuVmFsdWUpOwogICAgaWYgKGZpbHRlci5pbmRleE9mKCIgIikgPiAwKSB7CiAgICAgICRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5maXJzdF9uYW1lID0gZmlsdGVyLnN1YnN0cigwLCBmaWx0ZXIuaW5kZXhPZigiICIpKTsKICAgICAgJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyLmxhc3RfbmFtZSA9IGZpbHRlci5zdWJzdHIoMSArIGZpbHRlci5pbmRleE9mKCIgIikpOwogICAgfSBlbHNlIHsKICAgICAgJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyLmZpcnN0X25hbWUgPSBmaWx0ZXI7CiAgICAgICRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5sYXN0X25hbWUgPSAiIjsKICAgIH0KICAgICRzY29wZS5maWx0ZXIuVmFsdWUgPSAiIjsKICAgICRzY29wZS5maWx0ZXIuYnV0dG9uVmFsdWUgPSAiIjsKICB9IGVsc2UgewogIH0KCiAgJHNjb3BlLmdvdG9CYWNrID0gZnVuY3Rpb24oKQogIHsKICAgICRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfY2xpZW50cycpOwogIH0KCiAgJHNjb3BlLmFkZENsaWVudCA9IGZ1bmN0aW9uKCkKICB7CiAgICB0aGVkYXRhID0gJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyOwoKICAgIGZ1bmN0aW9uIGFkZENsaWVudF9zdWNjZXNzKHVzZXJfaWQpCiAgICB7CiAgICAgIGlmICgkc2NvcGUuc2F2ZV9hbmRfc2NoZWR1bGUpCiAgICAgIHsKLy8gJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jbGllbnRzLycrdXNlcl9pZC5qc29uKTsKICAgICAgICBsb2dEZWJ1ZygiTkVXIHVzZXIgdXNlcl9pZD0iK3VzZXJfaWQuanNvbik7CgogICAgICAgIHVzZXJfaW5mbz0gewogICAgICAgICAgYnVzaW5lc3NfdXNlcl9pZDogdXNlcl9pZC5qc29uLAogICAgICAgICAgYnVzZXJfZmlyc3RfbmFtZTogJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyLmJ1c2VyX2ZpcnN0X25hbWUsCiAgICAgICAgICBidXNlcl9sYXN0X25hbWU6ICRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5idXNlcl9sYXN0X25hbWUKICAgICAgICB9OwoKICAgICAgICBzaGFyZWRQcm9wZXJ0aWVzLnNldF9zZWxlY3RlZF91c2VyKHVzZXJfaW5mbyk7CiAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jYWxlbmRhcicpOwoKICAgICAgfQogICAgICBlbHNlCiAgICAgIHsKICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2NsaWVudHMvJyk7CiAgICAgIH0KICAgICAgY29uc29sZS5sb2coIm5ldyB1c2VyIGlkID0gIit1c2VyX2lkLmpzb24pOwogICAgfQogICAgZnVuY3Rpb24gYWRkQ2xpZW50X2ZhaWx1cmUocmVzcG9uc2UpCiAgICB7CiAgICAgICRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5hamF4X2Vycm9yID0gcmVzcG9uc2UubWVzc2FnZTsKICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKQogICAgICB7CiAgICAgICAgJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyLmFqYXhfZXJyb3I9bnVsbDsKICAgICAgfSwgMjUwMCk7CiAgICB9CiAgICBhZGRDbGllbnQoJGh0dHAsJHNjb3BlLHRoZWRhdGEsYWRkQ2xpZW50X3N1Y2Nlc3MsIGFkZENsaWVudF9mYWlsdXJlLGZhbHNlKTsKICB9Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignUGFja2FnZXNDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uKSB7CiAgbG9nRGVidWcoJ1BhY2thZ2VzQ29udHJvbGxlcicpOwogIGdldEJ1c2luZXNzUGFja2FnZXMoJGh0dHAsJHNjb3BlLCdwYWNrYWdlcycpOwoKICAkc2NvcGUuc2hvd1BhY2thZ2UgPSBmdW5jdGlvbiAodGhlcGFja2FnZSkKICB7CiAgICAkbG9jYXRpb24ucGF0aCgnL3BhY2thZ2VzLycrdGhlcGFja2FnZS5wYWNrYWdlX2lkKTsKICB9Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignSW5zdHJ1Y3RvcnNTaG93Q29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikgewogIGxvZ0RlYnVnKCdJbnN0cnVjdG9yc1Nob3dDb250cm9sbGVyJyk7CiAgJHNjb3BlLm9yZGVyQnlGaWVsZCA9ICdidXNlcl9zdGFydF9kYXRlJzsKICAkc2NvcGUucmV2ZXJzZVNvcnQ9dHJ1ZTsKCiAgZ2V0QWxsSW5zdHJ1Y3RvcnMoJGh0dHAsJHNjb3BlLCdhbGxDbGllbnRzJyxnZXRBbGxJbnN0cnVjdG9yc19zdWNjZXNzKTsKICBmdW5jdGlvbiBnZXRBbGxJbnN0cnVjdG9yc19zdWNjZXNzKCkKICB7CiAgICAkc2NvcGUuc2hvd0NsaWVudHNHcmlkT3B0aW9ucy5kYXRhPSRzY29wZS5hbGxDbGllbnRzOwogIH0KCiAgJHNjb3BlLmdvdG9JbnN0cnVjdG9yUGFnZT0gZnVuY3Rpb24gKGJ1c2luZXNzX3VzZXJfaWQpCiAgewogICAgZ290b0luc3RydWN0b3JQYWdlKGJ1c2luZXNzX3VzZXJfaWQpOwogIH0KCiAgJHNjb3BlLmNsaWVudE5hbWVGaWx0ZXI9IiI7CiAgJHNjb3BlLmlucHV0RmlsdGVyID0gZnVuY3Rpb24gKGl0ZW0pCiAgewovLyBjb25zb2xlLmxvZyhpdGVtLmJ1c2VyX3Bob25lX251bWJlcik7CiAgICByZXR1cm4gZmlsdGVyX2ZpcnN0bGFzdF9uYW1lKGl0ZW0uYnVzZXJfZmlyc3RfbmFtZSxpdGVtLmJ1c2VyX2xhc3RfbmFtZSxpdGVtLmJ1c2VyX3Bob25lX251bWJlciwkc2NvcGUuY2xpZW50TmFtZUZpbHRlcik7CiAgfTsKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ0NsaWVudHNTaG93Q29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHVpYk1vZGFsLCAkaHR0cCwgJGxvY2F0aW9uKSB7CiAgbG9nRGVidWcoJ0NsaWVudHNTaG93Q29udHJvbGxlcicpOwogICRzY29wZS5vcmRlckJ5RmllbGQgPSAnYnVzZXJfc3RhcnRfZGF0ZSc7CiAgJHNjb3BlLnJldmVyc2VTb3J0PXRydWU7CgogIGdldEFsbENsaWVudHMoJGh0dHAsJHNjb3BlLCdhbGxDbGllbnRzJyxnZXRDbGllbnRfc3VjY2Vzcyk7CiAgZnVuY3Rpb24gZ2V0Q2xpZW50X3N1Y2Nlc3MoKQogIHsKICAgICRzY29wZS5zaG93Q2xpZW50c0dyaWRPcHRpb25zLmRhdGE9JHNjb3BlLmFsbENsaWVudHM7CiAgfQoKICAkc2NvcGUuZ290b0NsaWVudFBhZ2U9IGZ1bmN0aW9uIChidXNpbmVzc1VzZXJpZCkKICB7CiAgICBnb3RvQ2xpZW50UGFnZShidXNpbmVzc1VzZXJpZCk7CiAgfQoKLy8gZmlsdGVyIGFyY2hpdmVkIGNsaWVudHMKICAkc2NvcGUuc2hvd0FyY2hpdmVkQ2hlY2tib3g9ZmFsc2U7CiAgJHNjb3BlLnNob3dBcmNoaXZlZCA9IGZ1bmN0aW9uIChlY2xpZW50KQogIHsKICAgIGlmIChlY2xpZW50LmlzX2FjdGl2ZT09MCkKICAgIHsKICAgICAgbG9nRGVidWcoZWNsaWVudCk7CiAgICAgIGlmICgkc2NvcGUuc2hvd0FyY2hpdmVkQ2hlY2tib3gpCiAgICAgIHsKICAgICAgICByZXR1cm4gZWNsaWVudDsKICAgICAgfQogICAgfQogICAgZWxzZSB7CiAgICAgIHJldHVybiBlY2xpZW50OwogICAgfQogIH07CgogICRzY29wZS5jbGllbnROYW1lRmlsdGVyPSIiOwogICRzY29wZS5pbnB1dEZpbHRlciA9IGZ1bmN0aW9uIChpdGVtKQogIHsKICAgIC8vIGNvbnNvbGUubG9nKCJjbGllbnROYW1lRmlsdGVyIik7CiAgICByZXR1cm4gZmlsdGVyX2ZpcnN0bGFzdF9uYW1lKGl0ZW0uYnVzZXJfZmlyc3RfbmFtZSxpdGVtLmJ1c2VyX2xhc3RfbmFtZSxpdGVtLmJ1c2VyX3Bob25lX251bWJlciwkc2NvcGUuY2xpZW50TmFtZUZpbHRlcik7CiAgfTsKCiAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXM9W107Ci8vICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzID0gWwovLyAgIHsiZmllbGRfaWQiOjAsImZpZWxkX25hbWUiOiLXqteQ16jXmdeaINec15nXk9eUIiwiZmllbGRfZGF0YXR5cGUiOiJEQVRFIiwiaXNfbWFuZGF0b3J5IjowLCAiZnJvbWRiIjogZmFsc2UsICJkYl9pZF90b2ZpeCI6IDAsICJpc19hY3RpdmUiOiAxLCAibW9kaWZpZWQiOiBmYWxzZX0sCi8vICAgeyJmaWVsZF9pZCI6MCwiZmllbGRfbmFtZSI6IteU16LXqNeV16oiLCJmaWVsZF9kYXRhdHlwZSI6IlRFWFRfQVJFQSIsImlzX21hbmRhdG9yeSI6MCwgImZyb21kYiI6IGZhbHNlLCAiZGJfaWRfdG9maXgiOiAwLCAiaXNfYWN0aXZlIjogMSwgIm1vZGlmaWVkIjogZmFsc2V9Ci8vIF07CgogIGZ1bmN0aW9uIGdldENsaWVudHNFeHRyYUZpZWxkc19zdWNjZXNzKCkKICB7CiAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyA9ICRzY29wZS5leHRyYUZpZWxkczsKICB9CiAgZ2V0Q2xpZW50c0V4dHJhRmllbGRzKCRodHRwLCRzY29wZSwnZXh0cmFGaWVsZHMnLGdldENsaWVudHNFeHRyYUZpZWxkc19zdWNjZXNzKTsKCiAgJHNjb3BlLmV2ZW50VHlwZUV4dHJhRmllbGRzUG9wID0gZnVuY3Rpb24oZXZlbnRUeXBlUHJvcGVydGllcykgewogICAgbG9nRGVidWcoImV2ZW50VHlwZUV4dHJhRmllbGRzUG9wMyIpOwoKICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewogICAgICBhbmltYXRpb246IGZhbHNlLAogICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9jbGllbnRfZXh0cmFfZmllbGRzLnBocCcsCiAgICAgIGNvbnRyb2xsZXI6ICdldmVudFR5cGVFeHRyYUZpZWxkc01vZGFsQ29udHJvbGxlcicsCiAgICAgIHNpemU6ICdsJywKICAgICAgcmVzb2x2ZTogewogICAgICAgIGV2ZW50VHlwZVByb3BlcnRpZXM6IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIGV2ZW50VHlwZVByb3BlcnRpZXM7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKCiAgICBtb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHNlbGVjdGVkSXRlbSkgewogICAgICBsb2dEZWJ1ZyhzZWxlY3RlZEl0ZW0pOwogICAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyA9IHNlbGVjdGVkSXRlbTsKICAgIH0sIGZ1bmN0aW9uKCkgewogICAgICBsb2dEZWJ1ZygnTW9kYWwgZGlzbWlzc2VkIGF0OiAnICsgbmV3IERhdGUoKSk7CiAgICB9KTsKICB9Owp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ3NjaGVkdWxlckNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkcm91dGVQYXJhbXMpIHsKICBldmVudF90eXBlX2lkPSRyb3V0ZVBhcmFtcy5ldmVudF90eXBlX2lkOwoKICAkc2NvcGUuc3VnZ2VzdGlvbkRhdGUgPSBbXTsKICAkc2NvcGUuc3VnZ2VzdGlvbkRhdGUuZGF0ZSA9IG5ldyBEYXRlKCk7CiAgJHNjb3BlLnN1Z2dlc3Rpb25EYXRlLm9wdGlvbnMgPSB7Ci8vIG1pbkRhdGU6IG5ldyBEYXRlKCksCi8vIHNob3dXZWVrczogdHJ1ZSwKICAgIG1pblZpZXc6J2RheScsCiAgICBzdGFydFZpZXc6ICdkYXknCgogIH07CiAgdmFyIHRoZXRpbWUgPSBuZXcgRGF0ZSgpOwogICRzY29wZS5maWx0ZXJBbGxEYXlzQ2hlY2tib3g9dHJ1ZTsKICAkc2NvcGUuZmlsdGVyRGF5SXRlbXMgPSB7CgogICAgJ9eo15DXqdeV158nOiB0cnVlLAogICAgJ9ep16DXmSc6IHRydWUsCiAgICAn16nXnNeZ16nXmSc6IHRydWUsCiAgICAn16jXkdeZ16LXmSc6IHRydWUsCiAgICAn15fXnteZ16nXmSc6IHRydWUsCiAgICAn16nXmdep15knOiB0cnVlLAogICAgJ9ep15HXqic6IHRydWUKICB9OwoKICAkc2NvcGUub25UaW1lU2V0ID0gZnVuY3Rpb24gKG5ld0RhdGUsIG9sZERhdGUpIHsKICAgIGxvZ0RlYnVnKCJuZXcgZGF0ZSAiK25ld0RhdGUuZ2V0VGltZSgpICsgIiBvbGQgZGF0ZSAiK29sZERhdGUuZ2V0VGltZSgpKTsKICAgIGRpZmY9bmV3RGF0ZS5nZXRUaW1lKCktb2xkRGF0ZS5nZXRUaW1lKCk7Ci8vIGlmIG5ldyBkYXRlIGlzIGluIGEgZGlmZmVyZW50IHdlZWsKLy8gd2UgcmVmZXRjaCBzdWdnZXN0aW9ucyBmb3IgdGhlIGN1cnJlbnQgd2VlawogICAgdmFyIG5ld0RhdGVXID0gbmV3IERhdGUobmV3RGF0ZSk7CiAgICB2YXIgb2xkRGF0ZVcgPSBuZXcgRGF0ZShvbGREYXRlKTsKLy8gYWxlcnQobmV3RGF0ZVcuZm9ybWF0KCdXJykpOwovLyBhbGVydChvbGREYXRlVy5mb3JtYXQoJ1cnKSk7CiAgICBpZiAobmV3RGF0ZVcuZm9ybWF0KCdXJykhPW9sZERhdGVXLmZvcm1hdCgnVycpKQogICAgewogICAgICBsb2dEZWJ1ZygiZGlmZiBpcyBhIHdlZWsgb3IgbW9yZSwgcmVmZXRjaGluZyBzdWdnZXN0aW9ucyIpOwogICAgICAkaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3QvIitldmVudF90eXBlX2lkKyIvIituZXdEYXRlLmdldEZ1bGxZZWFyKCkrIi8iKyhuZXdEYXRlLmdldE1vbnRoKCkrMSkrIi8iK25ld0RhdGUuZ2V0RGF0ZSgpKyIvIituZXdEYXRlLmdldEhvdXJzKCkgKyAiLyIgKyBuZXdEYXRlLmdldE1pbnV0ZXMoKSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkgewovLwkgICAgJHNjb3BlLm15RGF0YSA9IHJlc3BvbnNlLmRhdGE7Ci8vCQlsb2dEZWJ1ZygiZ3JpZG9wdGlvbnM9Iiskc2NvcGUuZ3JpZE9wdGlvbnMpOwogICAgICAgICRzY29wZS5ldmVudHNTdWdnZXN0ZWQgPSByZXNwb25zZS5kYXRhOwogICAgICB9KTsKCiAgICB9CiAgfQoKICAkc2NvcGUub3B0aW9ucyA9IHsKICAgIGN1c3RvbUNsYXNzOiBnZXREYXlDbGFzcywKICAgIG1pbkRhdGU6IG5ldyBEYXRlKCksCiAgICBzaG93V2Vla3M6IHRydWUKICB9OwogICRzY29wZS5kdCA9IG5ldyBEYXRlKCk7CgoKICBmdW5jdGlvbiBnZXREYXlDbGFzcyhkYXRhKSB7CiAgICByZXR1cm4gJyc7CiAgfQoKICAkc2NvcGUuZGF5c0l0ZW1zID0gWwogICAge25hbWU6J9eo15DXqdeV158nfSwKICAgIHtuYW1lOifXqdeg15knfSwKICAgIHtuYW1lOifXqdec15nXqdeZJ30sCiAgICB7bmFtZTon16jXkdeZ16LXmSd9LAogICAge25hbWU6J9eX157Xmdep15knfSwKICAgIHtuYW1lOifXqdeZ16nXmSd9LAogICAge25hbWU6J9ep15HXqid9CiAgXTsKCiAgJHNjb3BlLmZpbHRlckFsbERheUl0ZW1zU2V0ID0gZnVuY3Rpb24gKCkKICB7CiAgICAkc2NvcGUuZmlsdGVyRGF5SXRlbXNbJ9eo15DXqdeV158nXT0kc2NvcGUuZmlsdGVyQWxsRGF5c0NoZWNrYm94OwogICAgJHNjb3BlLmZpbHRlckRheUl0ZW1zWyfXqdeg15knXT0kc2NvcGUuZmlsdGVyQWxsRGF5c0NoZWNrYm94OwogICAgJHNjb3BlLmZpbHRlckRheUl0ZW1zWyfXqdec15nXqdeZJ109JHNjb3BlLmZpbHRlckFsbERheXNDaGVja2JveDsKICAgICRzY29wZS5maWx0ZXJEYXlJdGVtc1sn16jXkdeZ16LXmSddPSRzY29wZS5maWx0ZXJBbGxEYXlzQ2hlY2tib3g7CiAgICAkc2NvcGUuZmlsdGVyRGF5SXRlbXNbJ9eX157Xmdep15knXT0kc2NvcGUuZmlsdGVyQWxsRGF5c0NoZWNrYm94OwogICAgJHNjb3BlLmZpbHRlckRheUl0ZW1zWyfXqdeZ16nXmSddPSRzY29wZS5maWx0ZXJBbGxEYXlzQ2hlY2tib3g7CiAgICAkc2NvcGUuZmlsdGVyRGF5SXRlbXNbJ9ep15HXqiddPSRzY29wZS5maWx0ZXJBbGxEYXlzQ2hlY2tib3g7CiAgfQoKICAkc2NvcGUuc3VnZ2VzdEZpbHRlckRheXMgPSBmdW5jdGlvbiAoZXN1Z2dlc3QpCiAgewovLyBsb2dEZWJ1Zyhlc3VnZ2VzdCk7CiAgICBpZiAoKCRzY29wZS5maWx0ZXJEYXlJdGVtc1tlc3VnZ2VzdC5zdGFydF9mb3JtYXRfZG93XSkgJiAoKCRzY29wZS5zdWdnZXN0aW9uRGF0ZS5kYXRlLmdldFRpbWUoKS8xMDAwKTxlc3VnZ2VzdC5zdGFydF9lcG9jaCkpCiAgICB7CiAgICAgIHJldHVybiBlc3VnZ2VzdDsKICAgIH0KICB9OwoKICBsb2dEZWJ1Zygnc2NoZWR1bGVyQ29udHJvbGxlciBmb3IgZXZlbnQgdHlwZSBpZCAnK2V2ZW50X3R5cGVfaWQrIiAiK3RoZXRpbWUuZ2V0SG91cnMoKSArICI6IiArIHRoZXRpbWUuZ2V0TWludXRlcygpICsgIjoiICsgdGhldGltZS5nZXRTZWNvbmRzKCkpOwogICRodHRwLmdldCgkZ0FwaVVSTFByZWZpeCArICIvZW5kdXNlci9ldmVudHMvc3VnZ2VzdC8iK2V2ZW50X3R5cGVfaWQrIi8iK3RoZXRpbWUuZ2V0RnVsbFllYXIoKSsiLyIrKHRoZXRpbWUuZ2V0TW9udGgoKSsxKSsiLyIrdGhldGltZS5nZXREYXRlKCkrIi8iK3RoZXRpbWUuZ2V0SG91cnMoKSArICIvIiArIHRoZXRpbWUuZ2V0TWludXRlcygpKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7Ci8vCSAgICAkc2NvcGUubXlEYXRhID0gcmVzcG9uc2UuZGF0YTsKLy8JCWxvZ0RlYnVnKCJncmlkb3B0aW9ucz0iKyRzY29wZS5ncmlkT3B0aW9ucyk7CiAgICAkc2NvcGUuZXZlbnRzU3VnZ2VzdGVkID0gcmVzcG9uc2UuZGF0YTsKICB9KTsKCiAgJGh0dHAuZ2V0KCRnQXBpVVJMUHJlZml4ICsgIi9lbmR1c2VyL2V2ZW50X3R5cGVzLyIrZXZlbnRfdHlwZV9pZCkudGhlbihmdW5jdGlvbihyZXNwb25zZSkgewovLwkgICAgJHNjb3BlLm15RGF0YSA9IHJlc3BvbnNlLmRhdGE7Ci8vCQlsb2dEZWJ1ZygiZ3JpZG9wdGlvbnM9Iiskc2NvcGUuZ3JpZE9wdGlvbnMpOwogICAgJHNjb3BlLmV2ZW50VHlwZURldGFpbHMgPSByZXNwb25zZS5kYXRhOwogIH0pOwp9KTsKCmt1emVBcHAuY29udHJvbGxlcignY29udGFjdENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwKSB7CiAgbG9nRGVidWcoJ2NvbnRhY3RDb250cm9sbGVyJyk7Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcigncGFja2FnZVBheW1lbnRBc3NvY2lhdGlvbk1vZGFsQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHJvdXRlUGFyYW1zLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIGZwYWNrYWdlLCBiYWxhbmNlLCBidXNpbmVzc191c2VyX2lkLCB1aUNhbGVuZGFyQ29uZmlnKQp7CiAgbG9nRGVidWcoInBhY2thZ2VQYXltZW50QXNzb2NpYXRpb25Nb2RhbENvbnRyb2xsZXIiKTsKCiAgJHNjb3BlLmZwYWNrYWdlPWZwYWNrYWdlOwogICRzY29wZS5iYWxhbmNlPWJhbGFuY2U7CiAgJHNjb3BlLnBhY2thZ2VfcGF5bWVudHM9JHNjb3BlLmZwYWNrYWdlLnBhY2thZ2VfcGF5bWVudHM7CiAgJHNjb3BlLnByZXZpb3VzX2lzX2FsbF9wYWlkPSRzY29wZS5mcGFja2FnZS5pc19hbGxfcGFpZDsKICAkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZD1idXNpbmVzc191c2VyX2lkOwoKLy8gJ2NhbGN1bGF0aW5nJyBwcmV2aW91cyBzdGF0dXMgb2YgcGF5bWVudAogIGlmICgkc2NvcGUucGFja2FnZV9wYXltZW50cz4wKQogIHsKICAgIGlmICgkc2NvcGUucHJldmlvdXNfaXNfYWxsX3BhaWQ9PTEpCiAgICB7CiAgICAgICRzY29wZS5wcmV2aW91c19zdGF0dXM9ImlzX2FsbF9wYWlkIjsKICAgICAgJHNjb3BlLnBhY2thZ2Vfc3RhdHVzX2lkPS0xOwogICAgICAkc2NvcGUucHJldmlvdXNfcGFja2FnZV9zdGF0dXNfaWQ9LTE7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICRzY29wZS5wcmV2aW91c19zdGF0dXM9ImlzX3BhcnRseV9wYWlkIjsKICAgICAgJHNjb3BlLnBhY2thZ2Vfc3RhdHVzX2lkPS0xOwogICAgICAkc2NvcGUucHJldmlvdXNfcGFja2FnZV9zdGF0dXNfaWQ9LTE7CiAgICB9CiAgfQogIGVsc2UKICB7CiAgICAkc2NvcGUucHJldmlvdXNfc3RhdHVzPSJub3RfcGFpZCI7CiAgICAkc2NvcGUucGFja2FnZV9zdGF0dXNfaWQ9MDsKICAgICRzY29wZS5wcmV2aW91c19wYWNrYWdlX3N0YXR1c19pZD0wOwoKICB9CiAgbG9nRGVidWcoInByZXZpb3VzX3N0YXR1cz0iKyRzY29wZS5wcmV2aW91c19zdGF0dXMpOwoKICAkc2NvcGUuY2xvc2VNb2RhbCA9IGZ1bmN0aW9uKCkKICB7CiAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgfTsKICAkc2NvcGUudXBkYXRlUGFja2FnZVBheW1lbnQgPSBmdW5jdGlvbigpCiAgewovLyBjb25zb2xlLmxvZygicHJldmlvdXNfcGFja2FnZV91c2VyX2lkPSIrJHNjb3BlLmZtZWV0aW5nLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZCk7Ci8vIGNvbnNvbGUubG9nKCJwYWNrYWdlX3VzZXJfaWQ9Iiskc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkKTsKICAgIGxvZ0RlYnVnKCJ1cGRhdGVQYWNrYWdlUGF5bWVudCIpCi8vIGlmIHNlbGVjdGVkIHBhY2thZ2UgaXMgbGlrZSBwcmV2aW91cyBwYWNrYWdlIC0gZG8gbm90aGluZwogICAgaWYgKCgkc2NvcGUucHJldmlvdXNfcGFja2FnZV9zdGF0dXNfaWQ9PSRzY29wZS5wYWNrYWdlX3N0YXR1c19pZCkpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJzZWxlY3RlZCBvcHRpb24gaXMgbGlrZSBwcmV2aW91cyBvcHRpb24gLSBkbyBub3RoaW5nIik7CiAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICAgIH0KCi8vIHByZXZpb3VzIHBhY2thZ2Ugd2FzIHBhaWQvcGFydGx5LXBhaWQgLSBub3cgbm90aGluZ3MgaXMgc2VsZWN0ZWQKICAgIGVsc2UgaWYgKCgkc2NvcGUucHJldmlvdXNfcGFja2FnZV9zdGF0dXNfaWQ9PS0xKSAmJiAoJHNjb3BlLnBhY2thZ2Vfc3RhdHVzX2lkPT0wKSkKICAgIHsKICAgICAgbG9nRGVidWcoIndhcyBwYWlkL3BhcnRseSBwYWlkLCByZW1vdmluZyBwYXltZW50Iik7CiAgICAgIHJlbW92ZVBhY2thZ2VQYXltZW50KCRodHRwLCRzY29wZSwkc2NvcGUuZnBhY2thZ2UucGFja2FnZV91c2VyX2lkLCRzY29wZS5idXNpbmVzc191c2VyX2lkLHVwZGF0ZUV2ZW50UGFja2FnZV9zdWNjZXNzKTsKICAgIH0KLy8gcHJldmlvdXMgcGFja2FnZSB3YXMgc2VsZWN0ZWQgLSBub3cgYSBkaWZmZXJlbnQgcGFja2FnZSBpcyBzZWxlY3RlZAogICAgZWxzZSBpZiAoKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3N0YXR1c19pZD09MCkgJiYgKCRzY29wZS5wYWNrYWdlX3N0YXR1c19pZD09LTEpKQogICAgewogICAgICBsb2dEZWJ1Zygid2FzIG5vdCBwYWlkIC0gbm93IHBheSBmdWxseS9wYXJ0aWFsbHkiKTsKICAgICAgcGF5Rm9yUGFja2FnZSgkaHR0cCwkc2NvcGUsJHNjb3BlLmZwYWNrYWdlLnBhY2thZ2VfdXNlcl9pZCwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCx1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2Vzcyk7CgovLyByZWFzc2lnbkV2ZW50UGFja2FnZUFzc29jaWF0aW9uKCRodHRwLCRzY29wZSwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZCwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCx1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2Vzcyk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiB1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2VzcygpCiAgewogICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgbG9nRGVidWcoImJyb2FkY2FzdGluZyBjbGllbnRQYWdlUmVsb2FkRGF0YSIpOwogICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogIH0KCn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdldmVudFBhY2thZ2VBc3NvY2lhdGlvbk1vZGFsQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHJvdXRlUGFyYW1zLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIGZtZWV0aW5nLCBiYWxhbmNlLCBidXNpbmVzc191c2VyX2lkLCB1aUNhbGVuZGFyQ29uZmlnKQp7CiAgJHNjb3BlLmZtZWV0aW5nPWFuZ3VsYXIuY29weShmbWVldGluZyk7CiAgJHNjb3BlLmJhbGFuY2U9YmFsYW5jZTsKICAkc2NvcGUucHJldmlvdXNfcGFja2FnZV91c2VyX2lkPSRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQ7CiAgJHNjb3BlLnByZXZpb3VzX2V2ZW50X3BheW1lbnRzPSRzY29wZS5mbWVldGluZy5ldmVudF9wYXltZW50czsKICAkc2NvcGUucHJldmlvdXNfaXNfYWxsX3BhaWQ9JHNjb3BlLmZtZWV0aW5nLmlzX2FsbF9wYWlkOwogICRzY29wZS5idXNpbmVzc191c2VyX2lkPWJ1c2luZXNzX3VzZXJfaWQ7CgovLyAnY2FsY3VsYXRpbmcnIHByZXZpb3VzIHN0YXR1cyBvZiBwYXltZW50CiAgaWYgKCRzY29wZS5wcmV2aW91c19ldmVudF9wYXltZW50cz4wKQogIHsKICAgIGlmICgkc2NvcGUucHJldmlvdXNfaXNfYWxsX3BhaWQ9PTEpCiAgICB7CiAgICAgICRzY29wZS5wcmV2aW91c19zdGF0dXM9ImlzX2FsbF9wYWlkIjsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgJHNjb3BlLnByZXZpb3VzX3N0YXR1cz0iaXNfcGFydGx5X3BhaWQiOwogICAgfQogIH0KICBlbHNlCiAgewogICAgaWYgKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ+MCkKICAgIHsKICAgICAgJHNjb3BlLnByZXZpb3VzX3N0YXR1cz0iaXNfcGFja2FnZV9wYWlkIjsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgJHNjb3BlLnByZXZpb3VzX3N0YXR1cz0ibm90X3BhaWQiOwogICAgfQogIH0KICBsb2dEZWJ1ZygicHJldmlvdXNfc3RhdHVzPSIrJHNjb3BlLnByZXZpb3VzX3N0YXR1cyk7CgogIGlmICgoJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZD09MCkgJiYgKCRzY29wZS5mbWVldGluZy5ldmVudF9wYXltZW50cz4wKSkKICB7Ci8vIHRoaXMgaXMgYSBjYXNlIHdoZXJlIHBheW1lbnQgd2FzIHBhcnRseSBvciBmdWxseSBtYWRlIGZyb20gYmFsYW5jZQogICAgJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZD0tMTsKICAgICRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ9LTE7CiAgfQoKICBsb2dEZWJ1ZygiZXZlbnRQYWNrYWdlQXNzb2NpYXRpb25Nb2RhbENvbnRyb2xsZXIiKTsKICBnZXRQYWNrYWdlc0ZvckV2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJ3JlbGF0ZWRQYWNrYWdlcycsZ2V0UGFja2FnZXNGb3JFdmVudF9zdWNjZXNzKTsgLy8gd2FzIGdldEJ1c2luZXNzUGFja2FnZQogIGZ1bmN0aW9uIGdldFBhY2thZ2VzRm9yRXZlbnRfc3VjY2VzcygpCiAgewogIH0KCiAgJHNjb3BlLmNsb3NlTW9kYWwgPSBmdW5jdGlvbigpCiAgewogICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogIH07CiAgJHNjb3BlLnVwZGF0ZUV2ZW50UGFja2FnZSA9IGZ1bmN0aW9uKCkKICB7CiAgICBjb25zb2xlLmxvZygicHJldmlvdXNfcGFja2FnZV91c2VyX2lkPSIrJHNjb3BlLmZtZWV0aW5nLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZCk7CiAgICBjb25zb2xlLmxvZygicGFja2FnZV91c2VyX2lkPSIrJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZCk7Ci8vIGlmIHNlbGVjdGVkIHBhY2thZ2UgaXMgbGlrZSBwcmV2aW91cyBwYWNrYWdlIC0gZG8gbm90aGluZwogICAgaWYgKCgkc2NvcGUucHJldmlvdXNfcGFja2FnZV91c2VyX2lkPT0kc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkKSkKICAgIHsKICAgICAgbG9nRGVidWcoInNlbGVjdGVkIG9wdGlvbiBpcyBsaWtlIHByZXZpb3VzIG9wdGlvbiAtIGRvIG5vdGhpbmciKTsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgfQovLyBpZiBzZWxlY3RlZCBwYWNrYWdlIGlzIGxpa2UgcHJldmlvdXMgcGFja2FnZSAtIGRvIG5vdGhpbmcKICAgIGlmICgoJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD09JHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZCkgJiYgKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ+MCkpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJzZWxlY3RlZCBwYWNrYWdlIGlzIGxpa2UgcHJldmlvdXMgcGFja2FnZSAtIGRvIG5vdGhpbmciKTsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgfQovLyBwcmV2aW91cyBwYWNrYWdlIHdhcyBzZWxlY3QgLSBub3cgbm90aGluZ3MgaXMgc2VsZWN0ZWQKICAgIGVsc2UgaWYgKCgkc2NvcGUucHJldmlvdXNfcGFja2FnZV91c2VyX2lkPjApICYmICgkc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkPT0wKSkKICAgIHsKICAgICAgbG9nRGVidWcoIm5vIHBhY2thZ2Ugc2VsZWN0ZWQsIHJlbW92ZSBwYWNrYWdlLWV2ZW50IGFzc29jaWF0aW9uIik7CiAgICAgIHJlbW92ZUV2ZW50UGFja2FnZUFzc29jaWF0aW9uKCRodHRwLCRzY29wZSwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwogICAgfQovLyBwcmV2aW91cyBwYWNrYWdlIHdhcyBzZWxlY3RlZCAtIG5vdyBhIGRpZmZlcmVudCBwYWNrYWdlIGlzIHNlbGVjdGVkCiAgICBlbHNlIGlmICgoJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD4wKSAmJiAoJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZD4wKSkKICAgIHsKICAgICAgbG9nRGVidWcoInVwZGF0aW5nIG5ldyBwYWNrYWdlIHRvIHBhY2thZ2VfdXNlcl9pZD0gIiskc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkKTsKICAgICAgcmVhc3NpZ25FdmVudFBhY2thZ2VBc3NvY2lhdGlvbigkaHR0cCwkc2NvcGUsJHNjb3BlLmZtZWV0aW5nLmV2ZW50X2lkLCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwogICAgfQovLyBwcmV2aW91cyBwYWNrYWdlIHdhcyBub25lIC0gbm93IGEgcGFja2FnZSBpcyBzZWxlY3RlZAogICAgZWxzZSBpZiAoKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ9PTApICYmICgkc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkPjApKQogICAgewogICAgICBsb2dEZWJ1ZygidXBkYXRpbmcgbmV3IHBhY2thZ2UgdG8gcGFja2FnZV91c2VyX2lkPSAiKyRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQpOwogICAgICByZWFzc2lnbkV2ZW50UGFja2FnZUFzc29jaWF0aW9uKCRodHRwLCRzY29wZSwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZCwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCx1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2Vzcyk7CiAgICB9Ci8vIHByZXZpb3VzIGFzc29jaWF0aW9uIHdhcyBwYWlkIG9yIGhhbGYgcGFpZCAtIG5vdyBpdHMgbm9uZQogICAgZWxzZSBpZiAoKCRzY29wZS5wcmV2aW91c19ldmVudF9wYXltZW50cz4wKSAmJiAoJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZD09MCkpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJyZW1vdmluZyBwYXltZW50IGZyb20gZXZlbnQsIHBhY2thZ2VfdXNlcl9pZD0gIiskc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkKTsKICAgICAgcmVtb3ZlRXZlbnRQYXltZW50QXNzb2NpYXRpb24oJGh0dHAsJHNjb3BlLCRzY29wZS5mbWVldGluZy5ldmVudF9pZCwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCx1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2Vzcyk7CgovLyByZWFzc2lnbkV2ZW50UGFja2FnZUFzc29jaWF0aW9uKCRodHRwLCRzY29wZSwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZCwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCx1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2Vzcyk7Ci8vIHRvZG8KICAgIH0KLy8gd2FzIHBhY2thZ2UgcGF5bWVudCAtPiBub3cgYmFsYW5jZSBwYXltZW50CiAgICBlbHNlIGlmICgoJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD4wKSAmJiAoJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZD09LTEpKQogICAgewogICAgICBsb2dEZWJ1ZygibW92aW5nIHBheW1lbnQgZnJvbSBwYWNrYWdlIHRvIGJhbGFuY2UiKTsKICAgICAgYWRkRXZlbnRQYXltZW50UmVtb3ZlUGFja2FnZSgkaHR0cCwkc2NvcGUsJHNjb3BlLmZtZWV0aW5nLmV2ZW50X2lkLCRzY29wZS5idXNpbmVzc191c2VyX2lkLHVwZGF0ZUV2ZW50UGFja2FnZV9zdWNjZXNzKTsKICAgIH0KLy8gd2FzIGJhbGFuY2UgcGF5bWVudCAtPiBub3cgcGFja2FnZSBwYXltZW50CiAgICBlbHNlIGlmICgoJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD09LTEpICYmICgkc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkPjApKQogICAgewogICAgICBsb2dEZWJ1ZygibW92aW5nIHBheW1lbnQgZnJvbSBiYWxhbmNlIHRvIHBhY2thZ2UiKTsKICAgICAgYWRkRXZlbnRQYWNrYWdlUmVtb3ZlUGF5bWVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLmZtZWV0aW5nLmV2ZW50X2lkLCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwoKICAgIH0KLy8gd2FzIG5vdCBwYWlkIGF0IGFsbCAtPiBub3cgYmFsYW5jZSBwYXkKICAgIGVsc2UgaWYgKCgkc2NvcGUucHJldmlvdXNfcGFja2FnZV91c2VyX2lkPT0wKSAmJiAoJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZD09LTEpKQogICAgewogICAgICBsb2dEZWJ1ZygibW92aW5nIHBheW1lbnQgZnJvbSBub25lIHRvIGJhbGFuY2UiKTsKICAgICAgYWRkRXZlbnRQYXltZW50QXNzb2NpYXRpb24oJGh0dHAsJHNjb3BlLCRzY29wZS5mbWVldGluZy5ldmVudF9pZCwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCx1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2Vzcyk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiB1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2VzcygpCiAgewogICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgbG9nRGVidWcoImJyb2FkY2FzdGluZyBjbGllbnRQYWdlUmVsb2FkRGF0YSIpOwogICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogIH0KCn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignYXJjaGl2ZV9jbGllbnRfbW9kYWwnLCBmdW5jdGlvbigkc2NvcGUsICRsb2NhdGlvbiwgaXNfaW5zdHJ1Y3RvciwgYnVzaW5lc3NfdXNlcl9pZCwgYnVzZXJfZmlyc3RfbmFtZSwgYnVzZXJfbGFzdF9uYW1lLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIHVpQ2FsZW5kYXJDb25maWcpIHsKICAkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZD1idXNpbmVzc191c2VyX2lkOwogICRzY29wZS5idXNlcl9maXJzdF9uYW1lPWJ1c2VyX2ZpcnN0X25hbWU7CiAgJHNjb3BlLmJ1c2VyX2xhc3RfbmFtZT1idXNlcl9sYXN0X25hbWU7CiAgJHNjb3BlLmlzX2luc3RydWN0b3I9aXNfaW5zdHJ1Y3RvcjsKCiAgbG9nRGVidWcoImFyY2hpdmVfY2xpZW50X21vZGFsIGNvbnRyb2xsZXIiKTsKCiAgJHNjb3BlLmNsb3NlTW9kYWwgPSBmdW5jdGlvbigpIHsKICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICB9OwoKICAkc2NvcGUuYXJjaGl2ZUNsaWVudCA9IGZ1bmN0aW9uKCkKICB7CiAgICBhcmNoaXZlQ2xpZW50KCRodHRwLCRzY29wZSwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCxhcmNoaXZlQ2xpZW50X3N1Y2Nlc3MpOwogICAgZnVuY3Rpb24gYXJjaGl2ZUNsaWVudF9zdWNjZXNzKCkKICAgIHsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgICBpZiAoJHNjb3BlLmlzX2luc3RydWN0b3IpCiAgICAgIHsKICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2luc3RydWN0b3JzJyk7CiAgICAgIH0KICAgICAgZWxzZSB7CiAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jbGllbnRzJyk7CiAgICAgIH0KICAgIH0KICB9Cgp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ3BheW1lbnlEZXRhaWxzTW9kYWxDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkcm91dGVQYXJhbXMsICRyb290U2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgZnBheW1lbnQsIHVpQ2FsZW5kYXJDb25maWcpIHsKICAkc2NvcGUuZnBheW1lbnQ9e307CiAgJHNjb3BlLmZwYXltZW50LnBheW1lbnRfZGF0ZT1mcGF5bWVudC5wYXltZW50X2RhdGU7CiAgJHNjb3BlLmZwYXltZW50LnBheW1lbnRfYW1vdW50PWZwYXltZW50LnBheW1lbnRfYW1vdW50OwogICRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2dlbmVyYXRlZD1mcGF5bWVudC5pbnZvaWNlX2dlbmVyYXRlZDsKICAkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9udW1iZXI9ZnBheW1lbnQuaW52b2ljZV9udW1iZXI7CiAgaWYgKGZwYXltZW50Lmludm9pY2VfZGF0ZT09bnVsbCkKICB7CiAgICAkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlX2Zvcm1hdD1uZXcgRGF0ZSgpOwogIH0KICBlbHNlCiAgewogICAgJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZV9mb3JtYXQ9ZnBheW1lbnQuaW52b2ljZV9kYXRlX2Zvcm1hdDsKICB9CiAgJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZT1mcGF5bWVudC5pbnZvaWNlX2RhdGU7CiAgJHNjb3BlLnNlbGVjdGVkUGF5bWVudE1ldGhvZD17CiAgICBuYW1lOiBmcGF5bWVudC5wYXltZW50X21ldGhvZF9uYW1lX3R4dCwKICAgIG1ldGhvZDogZnBheW1lbnQucGF5bWVudF9tZXRob2RfbmFtZQogIH07CiAgJHNjb3BlLmlzUGF5bWVudE1ldGhvZFNlbGVjdGVkPXRydWU7CgogIGxvZ0RlYnVnKCJvbGQgZGF0ZSAiKyRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2RhdGUpOwogIGlmICgkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlIT1udWxsKQogIHsKICAgICRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2RhdGVfZm9ybWF0ID0gbmV3IERhdGUoJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZSk7CiAgfQogICRzY29wZS5wYXltZW50TWV0aG9kcyA9IHBheW1lbnRNZXRob2RzOwogICRzY29wZS5wYXltZW50VHlwZVRpdGxlPWZwYXltZW50LnBheW1lbnRfbWV0aG9kX25hbWVfdHh0OwogICRzY29wZS5mcGF5bWVudC5pbnZvaWNlX3NvdXJjZT0iRVhURVJOQUwiOwoKICBsb2dEZWJ1Zygkc2NvcGUucGF5bWVudE1ldGhvZHMpOwogIGxvZ0RlYnVnKCJwYXltZW55RGV0YWlsc01vZGFsQ29udHJvbGxlciBmb3IgcGF5bWVudCAiK0pTT04uc3RyaW5naWZ5KGZwYXltZW50LCBudWxsLCA0KSk7CgogICRzY29wZS5zZWxlY3RQYXltZW50TWV0aG9kID0gZnVuY3Rpb24ocGF5bWVudCkgewogICAgJHNjb3BlLnBheW1lbnRUeXBlVGl0bGU9cGF5bWVudC5uYW1lOwogICAgbG9nRGVidWcoInBheW1lbnQ9IitwYXltZW50KTsKCiAgICAkc2NvcGUuc2VsZWN0ZWRQYXltZW50TWV0aG9kPXBheW1lbnQ7CiAgICAkc2NvcGUuaXNQYXltZW50TWV0aG9kU2VsZWN0ZWQ9dHJ1ZTsKICB9OwoKICAkc2NvcGUuY2xvc2VNb2RhbCA9IGZ1bmN0aW9uKCkgewogICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogIH07CgogICRzY29wZS51cGRhdGVQYXltZW50ID0gZnVuY3Rpb24oKQogIHsKLy8gbG9nRGVidWcoY3VycmVudENsaWVudCk7CiAgICBsb2dEZWJ1ZygicGF5bWVudCBtZXRob2QiKTsKICAgIGxvZ0RlYnVnKCRzY29wZS5zZWxlY3RlZFBheW1lbnRNZXRob2QpOwogICAgbG9nRGVidWcoIiRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2dlbmVyYXRlZD08Iiskc2NvcGUuZnBheW1lbnQuaW52b2ljZV9nZW5lcmF0ZWQrIj4sICRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2RhdGVfZm9ybWF0PSIrJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZV9mb3JtYXQpOwogICAgbG9nRGVidWcoIiRzY29wZS5zZWxlY3RlZFBheW1lbnRNZXRob2QubWV0aG9kPSIrJHNjb3BlLnNlbGVjdGVkUGF5bWVudE1ldGhvZC5tZXRob2QpOwogICAgaWYgKCgkc2NvcGUuZnBheW1lbnQucGF5bWVudF9hbW91bnQ9PTApIHx8ICgkc2NvcGUuZnBheW1lbnQucGF5bWVudF9hbW91bnQ9PScnKSB8fCAoJHNjb3BlLmZwYXltZW50LnBheW1lbnRfYW1vdW50PT1udWxsKSkKICAgIHsKICAgICAgJHNjb3BlLnVzZXJFcnJvcj0i15DXoNeQINeU15bXnyDXodeb15XXnSDXm9ec16nXlNeVIjsKLy8gYWxlcnQoJ3NzJyk7CiAgICB9CiAgICBlbHNlIGlmICghJHNjb3BlLmlzUGF5bWVudE1ldGhvZFNlbGVjdGVkKQogICAgewogICAgICAkc2NvcGUudXNlckVycm9yPSLXkNeg15Ag15HXl9eoINeQ157Xptei15kg16rXqdec15XXnSI7Ci8vIGFsZXJ0KCdzcycpOwogICAgfQogICAgZWxzZQogICAgewogICAgICBpZiAoKCRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2dlbmVyYXRlZCE9MSkgfHwgKCRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2RhdGVfZm9ybWF0PT1udWxsKSkKICAgICAgewogICAgICAgIHZhciBpbnZvaWNlX2RhdGVfZm9ybWF0ID0gIm51bGwiOwogICAgICB9CiAgICAgIGVsc2UKICAgICAgewogICAgICAgIHZhciBpbnZvaWNlX2RhdGVfZm9ybWF0ID0gJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZV9mb3JtYXQuZ2V0RGF0ZSgpICArICItIiArICgkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlX2Zvcm1hdC5nZXRNb250aCgpKzEpICsgIi0iICsgJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZV9mb3JtYXQuZ2V0RnVsbFllYXIoKTsKICAgICAgfQogICAgICB0aGVkYXRhPSB7CiAgICAgICAgYmFsYW5jZVRvUGF5OiAkc2NvcGUuZnBheW1lbnQucGF5bWVudF9hbW91bnQsCiAgICAgICAgcGF5bWVudF9tZXRob2RfbmFtZTogJHNjb3BlLnNlbGVjdGVkUGF5bWVudE1ldGhvZC5tZXRob2QsCiAgICAgICAgaW52b2ljZV9udW1iZXI6ICRzY29wZS5mcGF5bWVudC5pbnZvaWNlX251bWJlciwKICAgICAgICBpbnZvaWNlX2dlbmVyYXRlZDogJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZ2VuZXJhdGVkLAogICAgICAgIGludm9pY2VfZGF0ZTogaW52b2ljZV9kYXRlX2Zvcm1hdCwKICAgICAgICBpbnZvaWNlX3NvdXJjZTogJHNjb3BlLmZwYXltZW50Lmludm9pY2Vfc291cmNlCiAgICAgIH07CiAgICAgIHVwZGF0ZVBheW1lbnRGb3JDbGllbnQoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLGZwYXltZW50LnVzZXJfcGF5bWVudF9pZCx0aGVkYXRhLGNyZWF0ZVBheW1lbnRGb3JDbGllbnRfY2FsbGJhY2ssIGNyZWF0ZVBheW1lbnRGb3JDbGllbnRfZmFpbHVyZSk7CiAgICAgIGZ1bmN0aW9uIGNyZWF0ZVBheW1lbnRGb3JDbGllbnRfY2FsbGJhY2soKQogICAgICB7CiAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgICAgIGxvZ0RlYnVnKCJicm9hZGNhc3RpbmcgY2xpZW50UGFnZVJlbG9hZERhdGEiKTsKICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NsaWVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCiAgICAgIH0KICAgICAgZnVuY3Rpb24gY3JlYXRlUGF5bWVudEZvckNsaWVudF9mYWlsdXJlKCkKICAgICAgewogICAgICAgIGxvZ0RlYnVnKCJicm9hZGNhc3RpbmcgY2xpZW50UGFnZVJlbG9hZERhdGEiKTsKLy8gJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgICB9CiAgICB9CiAgfQp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ2V2ZW50VHlwZUV4dHJhRmllbGRzTW9kYWxDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIGV2ZW50VHlwZVByb3BlcnRpZXMsIHVpQ2FsZW5kYXJDb25maWcpIHsKICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcz1ldmVudFR5cGVQcm9wZXJ0aWVzOwogIGxvZ0RlYnVnKCJldmVudFR5cGVFeHRyYUZpZWxkc01vZGFsQ29udHJvbGxlcj0iK0pTT04uc3RyaW5naWZ5KGV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMsIG51bGwsIDQpKTsKICBpZiAoZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcz09bnVsbCkKICB7CiAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllc09yaWc9W107CiAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcz1bXTsKICB9CiAgZWxzZSBpZiAoZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcy5sZW5ndGg+MCkKICB7CiAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllc09yaWc9KGV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMpLnNsaWNlKDApOwogIH0KICBlbHNlCiAgewogICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXNPcmlnPVtdOwogICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHM9W107CiAgfQogICRzY29wZS5va0xpbWl0YXRpb25Nb2RhbCA9IGZ1bmN0aW9uKCkgewogICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogIH07CgogICRzY29wZS5jYW5jZWwgPSBmdW5jdGlvbigpCiAgewogICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXM9JHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXNPcmlnOwogICAgbG9nRGVidWcoImNsb3NlIik7CiAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllc09yaWcpOwogIH0KICAkc2NvcGUuc2F2ZUFuZENsb3NlID0gZnVuY3Rpb24oKQogIHsKICAgIGxvZ0RlYnVnKCJzYXZlIGFuZCBjbG9zZSIpOwogICAgZnVuY3Rpb24gc2V0Q2xpZW50c0V4dHJhRmllbGRzX3N1Y2Nlc3MoKQogICAgewoKICAgIH0KICAgICRzY29wZS5DbGllbnRzRGV0YWlscz17fTsKICAgICRzY29wZS5DbGllbnRzRGV0YWlscy5leHRyYUZpZWxkcz0kc2NvcGUuZXh0cmFGaWVsZHM7CiAgICBzZXRDbGllbnRzRXh0cmFGaWVsZHMoJGh0dHAsJHNjb3BlLCRzY29wZS5DbGllbnRzRGV0YWlscyxzZXRDbGllbnRzRXh0cmFGaWVsZHNfc3VjY2Vzcyk7CiAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyk7CiAgfQoKICAkc2NvcGUuZHVwbGljYXRlRmllbGROYW1lcz0iIjsKICAkc2NvcGUuYWRkRXh0cmFGaWVsZHMgPSBmdW5jdGlvbigpCiAgewogICAgbG9nRGVidWcoImFkZEV4dHJhRmllbGRzIHZhbGlkYXRpbmciKTsKICAgIC8vIGNoZWNraW5nIGZvciBkdXBsaWNhdGUgbmFtZXMKICAgIHZhciBleHRyYUZpZWxkc05hbWVzID0gW107CiAgICBmb3IgKHZhciBpPTE7IGk8JHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMubGVuZ3RoOyBpKyspCiAgICB7CiAgICAgIGV4dHJhRmllbGRzTmFtZXMucHVzaCgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkc1tpXS5maWVsZF9uYW1lKTsKICAgIH0KICAgIGV4dHJhRmllbGRzTmFtZXMuc29ydCgpOwogICAgdmFyIGxhc3QgPSBleHRyYUZpZWxkc05hbWVzWzBdOwogICAgZm9yICh2YXIgaT0xOyBpPGV4dHJhRmllbGRzTmFtZXMubGVuZ3RoOyBpKyspCiAgICB7CiAgICAgIGlmIChleHRyYUZpZWxkc05hbWVzW2ldID09IGxhc3QpCiAgICAgIHsKICAgICAgICAvLyAgYWxlcnQoJ0R1cGxpY2F0ZSA6ICcrbGFzdCk7CiAgICAgICAgJHNjb3BlLmR1cGxpY2F0ZUZpZWxkTmFtZXM9J9en15nXmdedINep15PXlCDXm9ek15XXnCDXkdep150gIicrbGFzdCsnIi4uLic7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGxhc3QgPSBleHRyYUZpZWxkc05hbWVzW2ldOwogICAgfQogICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMpOwogIH0KCiAgJHNjb3BlLmV4dHJhRmllbGRzID0gZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkczsKICAkc2NvcGUuZmllbGRUeXBlcyA9IFt7ZmllbGRfZGF0YXR5cGU6ICJURVhUX0FSRUEiLCBuYW1lOifXqteZ15HXqiDXmNen16HXmCd9LCB7ZmllbGRfZGF0YXR5cGU6ICJOVU1CRVIiLCBuYW1lOifXnteh16TXqCd9ICwge2ZpZWxkX2RhdGF0eXBlOiAiU1RSSU5HIiwgbmFtZTon15jXp9eh15gg16fXpteoJ30gLCB7ZmllbGRfZGF0YXR5cGU6ICJCT09MRUFOIiwgbmFtZTon16rXmdeR16og16HXmdee15XXnyd9ICwge2ZpZWxkX2RhdGF0eXBlOiAiREFURSIsIG5hbWU6J9eq15DXqNeZ15onfV07CgogICRzY29wZS5hZGROZXdGaWVsZCA9IGZ1bmN0aW9uKCkgewogICAgdmFyIG5ld0l0ZW1ObyA9ICRzY29wZS5leHRyYUZpZWxkcy5sZW5ndGgrMTsKICAgICRzY29wZS5leHRyYUZpZWxkcy5wdXNoKHsiZmllbGRfZGF0YXR5cGUiOiJTVFJJTkciLCJpc19tYW5kYXRvcnkiOjAsICJmcm9tZGIiOiBmYWxzZSwgImZpZWxkX2lkIjogMCwgImlzX2FjdGl2ZSI6IDEsICJtb2RpZmllZCI6IDB9KTsKCiAgICBsb2dEZWJ1ZygiZXh0cmEgZmllbGRzOiAiICsgSlNPTi5zdHJpbmdpZnkoJHNjb3BlLmV4dHJhRmllbGRzLCBudWxsLCAyKSk7CgogIH07CgogICRzY29wZS5yZW1vdmVGaWVsZCA9IGZ1bmN0aW9uKGNob2ljZSkKICB7Ci8vIHJlbW92aW5nIGZpZWxkCi8vIGlmIGl0cyBub3Qgb3JpZ2luYXRlZCBmcm9tIGRhdGFiYXNlIC0gdGhlbiB3ZSBzaW1wbHkgZGVsZXRlIGl0IGZyb20gdGhlIGFycmF5Ci8vIG90aGVyd2lzZSB3ZSBtYXJrIGl0IGFzIGFjdGl2ZT1mYWxzZQogICAgbG9nRGVidWcoY2hvaWNlKTsKLy8gdmFyIGxhc3RJdGVtID0gKGNob2ljZS5pZCktMTsvLyRzY29wZS5jaG9pY2VzLmxlbmd0aC0xOwovLyAkc2NvcGUuY2hvaWNlcy5zcGxpY2UobGFzdEl0ZW0sMSk7CiAgICBmb3IodmFyIGkgPSAwOyBpIDwgJHNjb3BlLmV4dHJhRmllbGRzLmxlbmd0aDsgaSsrKQogICAgewogICAgICBpZiAoJHNjb3BlLmV4dHJhRmllbGRzW2ldID09IGNob2ljZSkKICAgICAgewogICAgICAgIGlmIChjaG9pY2UuZnJvbWRiPT1mYWxzZSkKICAgICAgICB7Ci8vIGlmIG5vdCBmcm9tIGRiIC0gcmVtb3ZpbmcgaXQgZnJvbSB0aGUgYXJyYXkgb2YgZXh0cmEtZmllbGRzCiAgICAgICAgICAkc2NvcGUuZXh0cmFGaWVsZHMuc3BsaWNlKGksIDEpOwogICAgICAgIH0KICAgICAgICBlbHNlCiAgICAgICAgewovLyBpZiBmaWVsZCBvcmlnaW5hdGVkIGZyb20gZGIgLSB0aGFuIHdlIGRvbnQgcmVtb3ZlIGl0IGZyb20gdGhlIGFycmF5Ci8vIGFuZCBtYXJrIGl0IGFzIGFjdGl2ZT1mYWxzZSBzbyB0aGF0IGl0IGNhbiBiZSBoYW5kZWxlZCBvbiB0aGUgc2VydmVyCiAgICAgICAgICBjaG9pY2UuaXNfYWN0aXZlPTA7CiAgICAgICAgICBjaG9pY2UubW9kaWZpZWQ9dHJ1ZTsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICB9Owp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ2V2ZW50Q2xvc2VJZ25vcmVNYW5kYXRvcnlGaWVsZHNNb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRyb3V0ZVBhcmFtcywgJHJvb3RTY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRodHRwLCBjdXJyZW50RXZlbnQsIHVpQ2FsZW5kYXJDb25maWcpIHsKICAkc2NvcGUuY3VycmVudEV2ZW50PWN1cnJlbnRFdmVudDsKCiAgJHNjb3BlLm9rQ2FuY2VsID0gZnVuY3Rpb24oKSB7CiAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgfTsKCiAgJHNjb3BlLmNsb3NlRXZlbnRJZ25vcmVNYW5kYXRvcnlGaWVsZHMgPSBmdW5jdGlvbigpCiAgewogICAgbG9nRGVidWcoImlnbm9yZSBtYW5kYXRvcnkgZXh0cmEgZmllbGRzIGFuZCBjbG9zZSBldmVudCIpOwogICAgJHNjb3BlLmN1cnJlbnRFdmVudC5pZ25vcmVFeHRyYUZpZWxkc1ZhbGlkYXRpb249dHJ1ZTsKICAgIGNsb3NlRXZlbnQoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCwkc2NvcGUuY3VycmVudEV2ZW50LGFmdGVyQ2xvc2VFdmVudCxhZnRlckNsb3NlRXZlbnQpOwogICAgZnVuY3Rpb24gYWZ0ZXJDbG9zZUV2ZW50KCkKICAgIHsKICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdldmVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCiAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICAgIH07CiAgfQp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ2V2ZW50VHlwZUNoYW5nZWRQb3B1cENvbnRyb2xsZXInLCBmdW5jdGlvbigkbG9jYXRpb24sICRzY29wZSwgJHJvdXRlUGFyYW1zLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIGV2ZW50VHlwZVByb3BlcnRpZXMsIHVpQ2FsZW5kYXJDb25maWcpIHsKICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcz1ldmVudFR5cGVQcm9wZXJ0aWVzOwogICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLnVwZGF0ZWRfZnJvbV9kYXRlPW5ldyBEYXRlKCk7CiAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMudXBkYXRlX2V4aXN0aW5nX2V2ZW50cz1mYWxzZTsKCiAgJHNjb3BlLmNsb3NlTW9kYWwgPSBmdW5jdGlvbigpIHsKICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICB9OwoKICAkc2NvcGUudXBkYXRlRXZlbnRUeXBlID0gZnVuY3Rpb24oKQogIHsKICAgIGxvZ0RlYnVnKCJ1cGRhdGUgRXZlbnQgVHlwZSAiICsgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXZlbnRfdHlwZV9pZCk7CiAgICBpZiAoJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMubWF4X3JlZ2lzdHJhdGlvbnM9PScnKQogICAgewogICAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5tYXhfcmVnaXN0cmF0aW9ucz0wOwogICAgfQogICAgdXBkYXRlRXZlbnRUeXBlKCRodHRwLCRzY29wZSwkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5ldmVudF90eXBlX2lkLCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLHVwZGF0ZUV2ZW50VHlwZV9zdWNjZXNzKTsKICAgIGZ1bmN0aW9uIHVwZGF0ZUV2ZW50VHlwZV9zdWNjZXNzKCkKICAgIHsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgICAkbG9jYXRpb24ucGF0aCgnL2V2ZW50X3R5cGVzJyk7CiAgICB9CiAgfQoKfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdjbGFzc0RlbGV0ZUFsbE1vZGFsQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHJvb3RTY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRodHRwLCBjdXJyZW50RXZlbnQsIHVpQ2FsZW5kYXJDb25maWcpCnsKICBsb2dEZWJ1ZygiY29udHJvbGxlcjogY2xhc3NEZWxldGVBbGxNb2RhbENvbnRyb2xsZXIiKTsKICAkc2NvcGUuY3VycmVudEV2ZW50PWN1cnJlbnRFdmVudDsKICAkc2NvcGUuY2xvc2VNb2RhbCA9IGZ1bmN0aW9uKCkKICB7CiAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgfTsKCgogICRzY29wZS5kZWxldGVDbGFzc0V2ZW50U2luZ2xlPWZ1bmN0aW9uICgpIC8vIGRlbGV0ZSBvbmx5IG9uZS9jdXJyZW50IGNsYXNzIGV2ZWh0CiAgewogICAgY2FuY2VsQ2xhc3NFdmVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCxjYW5jZWxDbGFzc0V2ZW50X2NhbGxiYWNrLCBjYW5jZWxDbGFzc0V2ZW50X2NhbGxiYWNrKTsKICAgIGZ1bmN0aW9uIGNhbmNlbENsYXNzRXZlbnRfY2FsbGJhY2soKQogICAgewogICAgICBnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkKTsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ3JlbG9hZEV2ZW50Jyx7ZXZlbnRfaWQgOiAkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkfSk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCiAgICB9CiAgfQogICRzY29wZS5kZWxldGVDbGFzc0V2ZW50c0FsbD1mdW5jdGlvbiAoKSAvLyBkZWxldGUgYWxsIHJlcGVhdGluZyBldmVudHMKICB7CiAgICBjYW5jZWxDbGFzc1JlcGVhdGluZ0V2ZW50KCRodHRwLCRzY29wZSwwLCRzY29wZS5jdXJyZW50RXZlbnQucmVwZWF0X2V2ZW50X2lkLGNhbmNlbENsYXNzRXZlbnRfY2FsbGJhY2ssIGNhbmNlbENsYXNzRXZlbnRfY2FsbGJhY2spOwogICAgZnVuY3Rpb24gY2FuY2VsQ2xhc3NFdmVudF9jYWxsYmFjaygpCiAgICB7CiAgICAgIGdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQpOwogICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgncmVsb2FkRXZlbnQnLHtldmVudF9pZCA6ICRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWR9KTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKICAgIH0KICB9CiAgJHNjb3BlLmRlbGV0ZUNsYXNzRXZlbnRzQWxsU3RhcnRpbmdFdmVudElEPWZ1bmN0aW9uICgpIC8vIGRlbGV0ZSBhbGwgcmVwZWF0aW5nIGV2ZW50cyBzdGFydGluZyBldmVudF9pZAogIHsKICAgIGNhbmNlbENsYXNzUmVwZWF0aW5nRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQsJHNjb3BlLmN1cnJlbnRFdmVudC5yZXBlYXRfZXZlbnRfaWQsY2FuY2VsQ2xhc3NFdmVudF9jYWxsYmFjaywgY2FuY2VsQ2xhc3NFdmVudF9jYWxsYmFjayk7CiAgICBmdW5jdGlvbiBjYW5jZWxDbGFzc0V2ZW50X2NhbGxiYWNrKCkKICAgIHsKLy8gZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCk7CiAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdyZWxvYWRFdmVudCcse2V2ZW50X2lkIDogJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZH0pOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgfQogIH0KCn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignYnVzaW5lc3NfbW9kYWxfbGltaXRhdGlvbl9jcmVhdGUnLCBmdW5jdGlvbigkc2NvcGUsICRyb290U2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgc3RhcnQsZW5kLCBmaXhlZFNjaGVkdWxlLCB1aUNhbGVuZGFyQ29uZmlnKSB7CgogICRzY29wZS5maXhlZFNjaGVkdWxlPWZpeGVkU2NoZWR1bGU7CiAgJHNjb3BlLm9yaWdpbmFsX3N0YXJ0PXN0YXJ0OwogICRzY29wZS5vcmlnaW5hbF9lbmQ9ZW5kOwoKICAkc2NvcGUuc3RhcnQ9bmV3IG1vbWVudChzdGFydCkqMTAwMDsKICAkc2NvcGUuZW5kPW5ldyBtb21lbnQoZW5kKSoxMDAwOwogIGNvbnNvbGUubG9nKCdzdGFydD0nK3N0YXJ0KTsKICBjb25zb2xlLmxvZygnZW5kPScrZW5kKTsKCiAgZ2V0QnVzaW5lc3NMb2NhdGlvbnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19sb2NhdGlvbnMnLGdldEJ1c2luZXNzTG9jYXRpb25zX3N1Y2Nlc3MpOwogIGZ1bmN0aW9uIGdldEJ1c2luZXNzTG9jYXRpb25zX3N1Y2Nlc3MoKQogIHsKICAgICRzY29wZS5uZXdFdmVudERldGFpbHMubG9jYXRpb25faWQ9JHNjb3BlLmJ1c2luZXNzX2xvY2F0aW9uc1swXS5sb2NhdGlvbl9pZDsKICB9CgogIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc3RhcnQpOwogIHNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKGVuZCk7CiAgbG9nRGVidWcoInNlbGVjdGVkRGF0ZVN0YXJ0ID0gIitzZWxlY3RlZERhdGVTdGFydCk7CiAgdmFyIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZSgpICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKICB2YXIgc2VsZWN0ZWREYXRlRW5kID0gbmV3IERhdGUoc2VsZWN0ZWREYXRlRW5kLmdldFRpbWUoKSArIHNlbGVjdGVkRGF0ZUVuZC5nZXRUaW1lem9uZU9mZnNldCgpICogNjAwMDApOwoKLy8gbG9nRGVidWcoImRhdGU9IiArIHNlbGVjdGVkRGF0ZVN0YXJ0KTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudCA9IFtdOwogICRzY29wZS5uZXdFdmVudERldGFpbHMgPSBbXTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0SG91cnMoKTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBzZWxlY3RlZERhdGVTdGFydC5nZXRNaW51dGVzKCk7CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkb3cgPSBkYXlOYW1lc1tzZWxlY3RlZERhdGVTdGFydC5nZXREYXkoKV07CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXRlID0gc2VsZWN0ZWREYXRlU3RhcnQ7CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aCA9IG1vbnRoTmFtZXNbc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TW9udGgoKV07CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aDExMiA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldE1vbnRoKCkrMTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRheW9mbW9udGggPSBzZWxlY3RlZERhdGVTdGFydC5nZXREYXRlKCk7CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RnVsbFllYXIoKTsKICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWVfaW5wdXRfZm9ybWF0PSBuZXcgRGF0ZSgxOTcwLCAwLCAxLCAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzLCAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMsIDApOwoKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycyA9IHNlbGVjdGVkRGF0ZUVuZC5nZXRIb3VycygpOwogICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKSA8IDEwID8gJzAnIDogJycpICsgc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKTsKCgogICRzY29wZS5jYW5jZWwgPSBmdW5jdGlvbigpIHsKICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICB9OwoKICBnZXRBbGxJbnN0cnVjdG9ycygkaHR0cCwkc2NvcGUsJ2luc3RydWN0b3JzJyxnZXRBbGxJbnN0cnVjdG9yc19zdWNjZXNzKTsKICBmdW5jdGlvbiBnZXRBbGxJbnN0cnVjdG9yc19zdWNjZXNzKCkKICB7CiAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmluc3RydWN0b3JfaWQ9JHNjb3BlLmluc3RydWN0b3JzWzBdLmJ1c2luZXNzX3VzZXJfaWQ7CiAgfQogIGdldE5vQ2xhc3NFdmVudFR5cGVzTm9BZG1pbigkaHR0cCwkc2NvcGUsJ3JlbGF0ZWRFdmVudFR5cGVzJyk7CgogICRzY29wZS5jcmVhdGVOZXdMaW1pdGF0aW9uID0gZnVuY3Rpb24oKQogIHsKICAgIGxvZ0RlYnVnKCJmdW5jdGlvbjogY3JlYXRlTmV3TGltaXRhdGlvbiIpOwogICAgY2FsZW5kYXIgPSAnY2FsZW5kYXJfaG91cnNfb2Zfd29yayc7CgogICAgaWYgKCRzY29wZS5zZWxlY3RlZEV2ZW50VHlwZXMubGVuZ3RoPDEpCiAgICB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vyczwkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKQogICAgewogICAgICBhbGVydCgi15bXntefINeh15nXldedINec16TXoNeZINeW157XnyDXlNeq15fXnNeUIik7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vycz09JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykKICAgIHsKICAgICAgaWYgKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXM8PSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcykKICAgICAgewogICAgICAgIGFsZXJ0KCLXltee158g16HXmdeV150g15zXpNeg15kg15bXntefINeU16rXl9ec15QiKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgaWYgKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXM8KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcysxMCkpCiAgICAgIHsKICAgICAgICBhbGVydCgi15HXnNeV16cg16fXmNefINeeLTEwINeT16fXldeqIik7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9CiAgICBpZiAoIWt1emVJc0NhbGVuZGFyRHJhZ2dibGUpIHsKICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigndW5zZWxlY3QnKTsKICAgIH0KICAgIGxvZ0RlYnVnKCJzdGFydD0iICsgc3RhcnQpOwogICAgY2hlY2tEYXRlID0gbmV3IERhdGUoc3RhcnQpOwogICAgbG9nRGVidWcoImNoZWNrIGRhdGUgPSAiICsgY2hlY2tEYXRlKQogICAgbG9nRGVidWcoImVuZD0iICsgZW5kKTsKICAgIGVjb2xvcj0iIzAwYTY1YSI7CgogICAgaWYgKGNoZWNrRGF0ZS5nZXRGdWxsWWVhcigpID09IDE5NzApIHsKICAgICAgZGF5X2xpbWl0X2lkID0gLTE7CiAgICB9IGVsc2UgewogICAgICBkYXlfbGltaXRfaWQgPSAxOwogICAgfQoKLy8gdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbXS5mdWxsQ2FsZW5kYXIoJ3JlcmVuZGVyRXZlbnRzJyk7CgogICAgdGVtcF9saW1pdF9pZCA9IGNhbGNfdGVtcF9saW1pdF9pZCgpOwoKICAgIGxvZ0RlYnVnKCRzY29wZS5zZWxlY3RlZEV2ZW50VHlwZXNbMF0pOwogICAgbG9nRGVidWcoJHNjb3BlLnNlbGVjdGVkRXZlbnRUeXBlc1swXS5ldmVudF90eXBlX2lkKTsKCiAgICBzdGFydF9wYXJhbT1zdGFydDsKICAgIGVuZF9wYXJhbT1lbmQ7CiAgICB0aXRsZV9wYXJhbT0nJzsKICAgIGxvZ0RlYnVnKCJhZGRMaW1pdGF0aW9uVG9EYXRhYmFzZSBzdGFydD0iICsgc3RhcnRfcGFyYW0gKyAiLCBlbmQ9IiArICIsIHRpdGxlPSIgKyB0aXRsZV9wYXJhbSApOwoKICAgIHRoZWRhdGEgPSB7CiAgICAgIHN0YXJ0X2RhdGU6ICRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZSwKICAgICAgZW5kX2RhdGU6ICRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kX3RpbWUsCiAgICAgIGNvbG9yOiBlY29sb3IsCiAgICAgIHRlbXBfbGltaXRfaWQ6IHRlbXBfbGltaXRfaWQsCiAgICAgIGVtcF9pZDogJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pbnN0cnVjdG9yX2lkLAogICAgICBsb2NhdGlvbl9pZDogJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5sb2NhdGlvbl9pZCwKICAgICAgZXZlbnRfdHlwZV9pZDogJHNjb3BlLnNlbGVjdGVkRXZlbnRUeXBlc1swXS5ldmVudF90eXBlX2lkLAogICAgICBldmVudF90eXBlczogJHNjb3BlLnNlbGVjdGVkRXZlbnRUeXBlcywKICAgICAgdGl0bGU6IHRpdGxlX3BhcmFtCiAgICB9OwoKICAgIGlmICgkc2NvcGUuZml4ZWRTY2hlZHVsZSkgLy8gZml4ZWQgc2NoZWR1bGUgdnMgc3BlY2lmaWMgd2VlZC9kYXkgbGltaXRhdGlvbgogICAgewogICAgICBjcmVhdGVDYWxlbmRhckxpbWl0YXRpb24oJGh0dHAsJHNjb3BlLHRoZWRhdGEsbGltaXRhdGlvbl9zdWNjZXNzX2NhbGxiYWNrKTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgY3JlYXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5KCRodHRwLCRzY29wZSx0aGVkYXRhLGxpbWl0YXRpb25fc3VjY2Vzc19jYWxsYmFjayk7CiAgICB9CiAgICBmdW5jdGlvbiBsaW1pdGF0aW9uX3N1Y2Nlc3NfY2FsbGJhY2soKQogICAgewogICAgICBsb2dEZWJ1Zygic3VjY2VzcyIpOwogICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZWZldGNoRXZlbnRzJyk7CiAgICAgICR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoKTsKICAgIH0KCiAgfQoKICAkc2NvcGUuc3RhcnRNaW51dGVzID0gZnVuY3Rpb24oKQogIHsKICAgIGxvZ0RlYnVnKCJzdGFydE1pbnV0ZXMgIisoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKSk7CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXM9bWludXRlc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKTsKICAgIGNhbGN1bGF0ZVN0YXJ0VGltZSgpOwogIH0KICAkc2NvcGUuc3RhcnRIb3VycyA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1Zygic3RhcnRIb3VycyAiK2hvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKSk7CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzPWhvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKTsKICAgIGNhbGN1bGF0ZVN0YXJ0VGltZSgpOwogIH0KICAkc2NvcGUuZW5kTWludXRlcyA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1ZygiZW5kTWludXRlcyAiKygkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzKSk7CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzPW1pbnV0ZXNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpOwogICAgY2FsY3VsYXRlRW5kVGltZSgpOwogIH0KICAkc2NvcGUuZW5kSG91cnMgPSBmdW5jdGlvbigpCiAgewogICAgbG9nRGVidWcoImVuZEhvdXJzICIraG91cnNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzKSk7CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vycz1ob3Vyc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMpOwogICAgY2FsY3VsYXRlRW5kVGltZSgpOwogIH0KCgogIGZ1bmN0aW9uIGNhbGN1bGF0ZVN0YXJ0VGltZSgpCiAgewogICAgZXZlbnRZZWFyPSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0eWVhcjsKICAgIGV2ZW50TW9udGg9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aDExMjsKICAgIGV2ZW50RGF5PSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aDsKICAgIGlmIChwYXJzZUludChldmVudE1vbnRoKTwxMCkKICAgIHsKICAgICAgZXZlbnRNb250aD0iMCIrZXZlbnRNb250aDsKICAgIH0KICAgIGlmIChwYXJzZUludChldmVudERheSk8MTApCiAgICB7CiAgICAgIGV2ZW50RGF5PSIwIitldmVudERheTsKICAgIH0KICAgIGxvZ0RlYnVnKCIkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXI9IitldmVudFllYXIpOwogICAgbG9nRGVidWcoIiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aD0iK2V2ZW50TW9udGgpOwogICAgbG9nRGVidWcoIiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bW9udGg9IitldmVudERheSk7CiAgICBuZXdfc3RhcnQ9bW9tZW50LnV0YyhldmVudFllYXIrIi0iK2V2ZW50TW9udGgrIi0iK2V2ZW50RGF5KyJUMDA6MDA6MDAiKS5hZGQoKChwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKSo2MCkrcGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKSksICdtaW51dGVzJyk7CiAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWU9bmV3X3N0YXJ0OwogICAgbG9nRGVidWcoIm5ld19zdGFydD0iK25ld19zdGFydCk7CiAgfQogIGZ1bmN0aW9uIGNhbGN1bGF0ZUVuZFRpbWUoKQogIHsKICAgIGV2ZW50WWVhcj0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXI7CiAgICBldmVudE1vbnRoPSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bW9udGgxMTI7CiAgICBldmVudERheT0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRheW9mbW9udGg7CiAgICBpZiAocGFyc2VJbnQoZXZlbnRNb250aCk8MTApCiAgICB7CiAgICAgIGV2ZW50TW9udGg9IjAiK2V2ZW50TW9udGg7CiAgICB9CiAgICBpZiAocGFyc2VJbnQoZXZlbnREYXkpPDEwKQogICAgewogICAgICBldmVudERheT0iMCIrZXZlbnREYXk7CiAgICB9CiAgICBsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyPSIrZXZlbnRZZWFyKTsKICAgIGxvZ0RlYnVnKCIkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRheW9mbW9udGg9IitldmVudE1vbnRoKTsKICAgIGxvZ0RlYnVnKCIkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoPSIrZXZlbnREYXkpOwogICAgbmV3X2VuZD1tb21lbnQudXRjKGV2ZW50WWVhcisiLSIrZXZlbnRNb250aCsiLSIrZXZlbnREYXkrIlQwMDowMDowMCIpLmFkZCgoKHBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzKSo2MCkrcGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcykpLCAnbWludXRlcycpOwogICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmRfdGltZT1uZXdfZW5kOwogICAgbG9nRGVidWcoIm5ld19lbmQ9IituZXdfZW5kKTsKICB9CgogIGNhbGN1bGF0ZVN0YXJ0VGltZSgpOwogIGNhbGN1bGF0ZUVuZFRpbWUoKTsKCiAgZnVuY3Rpb24gbWludXRlc0NoYW5nZWQodGhlbWludXRlcykKICB7CiAgICBsb2dEZWJ1ZygidGhlbWludXRlcz0iK3RoZW1pbnV0ZXMpOwogICAgaWYgKHR5cGVvZiB0aGVtaW51dGVzPT0idW5kZWZpbmVkIikKICAgIHsKICAgICAgcmV0dXJuICIwMCI7CiAgICB9CiAgICB0aGVtaW51dGVzPXBhcnNlSW50KHRoZW1pbnV0ZXMpOwogICAgaWYgKHRoZW1pbnV0ZXM+NjApCiAgICB7CiAgICAgIHJldHVybiAiMDAiOwogICAgfQogICAgZWxzZSBpZiAodGhlbWludXRlczwwKQogICAgewogICAgICByZXR1cm4gIjAwIjsKICAgIH0KICAgIGVsc2UgaWYgKHRoZW1pbnV0ZXM9PSIiKQogICAgewogICAgICByZXR1cm4gIjAwIjsKICAgIH0KICAgIGVsc2UgaWYgKHRoZW1pbnV0ZXM8MTApCiAgICB7CiAgICAgIHJldHVybiAiMCIrdGhlbWludXRlczsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgcmV0dXJuIHRoZW1pbnV0ZXM7CiAgICB9CiAgfQogIGZ1bmN0aW9uIGhvdXJzQ2hhbmdlZCh0aGVob3VycykKICB7CiAgICBsb2dEZWJ1ZygidGhlaG91cnM9Iit0aGVob3Vycyk7CiAgICBpZiAodHlwZW9mIHRoZWhvdXJzPT0idW5kZWZpbmVkIikKICAgIHsKICAgICAgcmV0dXJuICIwIjsKICAgIH0KICAgIHRoZWhvdXJzPXBhcnNlSW50KHRoZWhvdXJzKTsKICAgIGlmICh0aGVob3Vycz4yNCkKICAgIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CiAgICBlbHNlIGlmICh0aGVob3VyczwwKQogICAgewogICAgICByZXR1cm4gMDsKICAgIH0KICAgIGVsc2UgaWYgKHRoZWhvdXJzPT0iIikKICAgIHsKICAgICAgcmV0dXJuICIwIjsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgcmV0dXJuIHRoZWhvdXJzOwogICAgfQogIH0KfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2NsYXNzQ2xvc2VNb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRyb290U2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgZXZlbnRfaWQsIHVpQ2FsZW5kYXJDb25maWcpIHsKICBnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnc2VsZWN0ZWRFdmVudCcsZXZlbnRfaWQsYWZ0ZXJHZXRDbGllbnRTcGVjaWZpY0V2ZW50KTsKICBmdW5jdGlvbiBhZnRlckdldENsaWVudFNwZWNpZmljRXZlbnQoKQogIHsKICAgIGZvciAoaSA9IDA7IGkgPCAkc2NvcGUuc2VsZWN0ZWRFdmVudC5ldmVudFVzZXJzLmxlbmd0aDsgaSsrKQogICAgewogICAgICBpZiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRVc2Vyc1tpXS5zdGF0dXNfbmFtZSE9JGdVc2VyX3N0YXR1c19hYnNlbnRlZCkKICAgICAgewogICAgICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50VXNlcnNbaV0ucGFydGljaXBhdGVkPXRydWU7CiAgICAgIH0KICAgICAgaWYgKCRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50VXNlcnNbaV0uaXNfd2FpdGluZ19saXN0PT0xKQogICAgICB7CiAgICAgICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRVc2Vyc1tpXS5wYXJ0aWNpcGF0ZWQ9ZmFsc2U7CiAgICAgIH0KICAgIH0KICAgIGxvZ0RlYnVnKCRzY29wZS5zZWxlY3RlZEV2ZW50KTsKICB9CgovLyBjbGlja2VkIHJvdyAtIGNoZWNrL3VuY2hlY2sgdGhlIGNoZWNrYm94IG9mIGEgdXNlcgogICRzY29wZS5yb3dDbGlja2VkID0gZnVuY3Rpb24ob2JqKQogIHsKICAgIGxvZ0RlYnVnKCdyb3cgY2xpY2tlZCcpOwogICAgb2JqLnBhcnRpY2lwYXRlZCA9ICFvYmoucGFydGljaXBhdGVkOwogIH07CgogICRzY29wZS5va0xpbWl0YXRpb25Nb2RhbCA9IGZ1bmN0aW9uKCkgewogICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogIH07CgogICRzY29wZS5jbG9zZUNsYXNzID0gZnVuY3Rpb24oKQogIHsKICAgIGNsb3NlQ2xhc3NFdmVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRfaWQsJHNjb3BlLnNlbGVjdGVkRXZlbnQsYWZ0ZXJDbG9zZUV2ZW50LGFmdGVyQ2xvc2VFdmVudCk7CiAgICBmdW5jdGlvbiBhZnRlckNsb3NlRXZlbnQoKQogICAgewogICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgncmVsb2FkRXZlbnQnLHtldmVudF9pZCA6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50X2lkfSk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCiAgICB9OwogIH0KfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2J1c2luZXNzQ2xpZW5kQ2FyZFBheW1lbnQnLCBmdW5jdGlvbigkc2NvcGUsICRyb3V0ZVBhcmFtcywgJHJvb3RTY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRodHRwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50Q2xpZW50LCBpc3BsdXMsIHVpQ2FsZW5kYXJDb25maWcsIGJ1c2luZXNzQ29uZmlnLCBwYXltZW50cykKewogICRzY29wZS5pc3BsdXM9aXNwbHVzOwogIGxvZ0RlYnVnKCdidXNpbmVzc0NsaWVuZENhcmRQYXltZW50IGlzcGx1cz0nICtpc3BsdXMrIiBjdXJyZW50Q2xpZW50PSIrIEpTT04uc3RyaW5naWZ5KGN1cnJlbnRDbGllbnQsIG51bGwsIDIpKTsKICAkc2NvcGUua3V6ZUlzTG9hZGluZz1mYWxzZTsKICBsb2dEZWJ1ZygnY3VycmVudENsaWVudC5wYXltZW50X2JhbGFuY2U9JytjdXJyZW50Q2xpZW50LnBheW1lbnRfYmFsYW5jZSsiLGN1cnJlbnRDbGllbnQudW5wYWlkX2JhbGFuY2UgPSIrY3VycmVudENsaWVudC51bnBhaWRfYmFsYW5jZSk7CiAgdGhlYmFsYW5jZSA9IGN1cnJlbnRDbGllbnQucGF5bWVudF9iYWxhbmNlLWN1cnJlbnRDbGllbnQudW5wYWlkX2JhbGFuY2U7CiAgbG9nRGVidWcoJ3RoZWJhbGFuY2U9Jyt0aGViYWxhbmNlKTsKICBpZiAodGhlYmFsYW5jZTwwKQogIHsKICAgICRzY29wZS5iYWxhbmNlVG9QYXk9TWF0aC5hYnModGhlYmFsYW5jZSk7CiAgfQogIGVsc2UKICB7CiAgICAkc2NvcGUuYmFsYW5jZVRvUGF5PTA7CiAgfQogIHVwZGF0ZUJhbGFuY2UodHJ1ZSk7CiAgJHNjb3BlLnBheW1lbnRUeXBlVGl0bGU9IteR15fXqCI7CiAgJHNjb3BlLmN1cnJlbnRDbGllbnQ9Y3VycmVudENsaWVudDsKICBsb2dEZWJ1Zygkc2NvcGUuY3VycmVudENsaWVudCk7CiAgJHNjb3BlLmludm9pY2Vfc291cmNlX2lkID0gYnVzaW5lc3NDb25maWcuaW52b2ljZV9zb3VyY2VfaWQ7CiAgJHNjb3BlLmhhc1ZhdCA9IGJ1c2luZXNzQ29uZmlnLnZhdF9yYXRlID4gMDsKCiAgJHNjb3BlLmNsb3NlTW9kYWwgPSBmdW5jdGlvbigpIHsKICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICB9OwoKICAkc2NvcGUuZXh0ZXJuYWxfaW52b2ljZV9nZW5lcmF0ZWQ9ZmFsc2U7CiAgJHNjb3BlLmludm9pY2VfZGF0ZV9mb3JtYXQ9bmV3IERhdGUoKTsKCiAgZ2V0TmV4dEludm9pY2VOdW1iZXIoJGh0dHAsJHNjb3BlLCRzY29wZS5jdXJyZW50Q2xpZW50LmJ1c2luZXNzX3VzZXJfaWQsJ2ludm9pY2VfbnVtYmVyJyk7CgogICRzY29wZS5wYXltZW50TWV0aG9kcyA9IHBheW1lbnRNZXRob2RzOwogICRzY29wZS5jcmVkaXRDYXJkVHlwZXMgPSBjcmVkaXRDYXJkVHlwZXM7CiAgJHNjb3BlLmNyZWRpdFRyYW5zYWN0aW9uVHlwZXMgPSBjcmVkaXRUcmFuc2FjdGlvblR5cGVzOwogICRzY29wZS5iYW5rcyA9IGJhbmtzOwogICRzY29wZS5kb2N1bWVudFR5cGVzID0gaW52b2ljZURvY3VtZW50VHlwZXMuZmlsdGVyKGZ1bmN0aW9uIChkb2MpIHsKICAgIHJldHVybiBkb2MudXNlclR5cGVzID09PSAiYWxsIiB8fCBkb2MudXNlclR5cGVzLmluY2x1ZGVzKE51bWJlcihidXNpbmVzc0NvbmZpZy5idXNpbmVzc190eXBlKSkKICB9KTsKCi8vIGluZGljYXRpb24gd2hldGhlciBwYXltZW50IG1ldGhvZCB3YXMgc2VsZWN0ZWQKICAkc2NvcGUuaXNQYXltZW50TWV0aG9kU2VsZWN0ZWQgPSBmYWxzZTsKICAkc2NvcGUucHJlZmlsbFBheW1lbnRNZXRob2QgPSBmdW5jdGlvbiAocGF5bWVudE1ldGhvZCwgcGF5bWVudHMpIHsKICAgIHZhciBmaWVsZHMgPSB7CiAgICAgICdDSEVDSyc6IFsnYmFua19jb21wYW55X2NvZGUnLCAnYmFua19icmFuY2hfbnVtYmVyJywgJ2FjY291bnRfbnVtYmVyJ10sCiAgICAgICdCQU5LX1RSQU5TRkVSJzogWydiYW5rX2NvbXBhbnlfY29kZScsICdiYW5rX2JyYW5jaF9udW1iZXInLCAnYWNjb3VudF9udW1iZXInXSwKICAgICAgJ0NSRURJVF9DQVJEJzogWydjcmVkaXRfY2FyZF90eXBlJywgJ2NyZWRpdF9jYXJkX251bWJlciddCiAgICB9W3BheW1lbnRNZXRob2QubWV0aG9kXTsKICAgIGlmIChmaWVsZHMgPT09IHVuZGVmaW5lZCkgcmV0dXJuOwogICAgdmFyIHBvc3NpYmxlTWF0Y2hlcyA9IHBheW1lbnRzCiAgICAgICAgLmZpbHRlcihmdW5jdGlvbiAocCkgewogICAgICAgICAgcmV0dXJuIHAucGF5bWVudF9tZXRob2RfbmFtZSA9PT0gcGF5bWVudE1ldGhvZC5tZXRob2QKICAgICAgICB9KQogICAgICAgIC5maWx0ZXIoZnVuY3Rpb24gKHApIHsKICAgICAgICAgIHJldHVybiBmaWVsZHMuZXZlcnkoZnVuY3Rpb24gKGZpZWxkKSB7CiAgICAgICAgICAgIHJldHVybiBwW2ZpZWxkXSAhPT0gdW5kZWZpbmVkCiAgICAgICAgICB9KQogICAgICAgIH0pCiAgICAgICAgLnNvcnQoZnVuY3Rpb24gKHAxLCBwMikgewogICAgICAgICAgdmFyIGEgPSBuZXcgRGF0ZShwMS5jcmVhdGlvbl9kYXRlKSwgYiA9IG5ldyBEYXRlKHAyLmNyZWF0aW9uX2RhdGUpOwogICAgICAgICAgcmV0dXJuIChhID4gYikgLSAoYSA8IGIpOwogICAgICAgIH0pCiAgICBjb25zb2xlLmxvZygiUG9zc2libGUgcGF5bWVudHMgaW5mbzogIiwgcG9zc2libGVNYXRjaGVzKTsKICB9OwogICRzY29wZS5zZWxlY3RQYXltZW50TWV0aG9kID0gZnVuY3Rpb24ocGF5bWVudCkgewogICAgJHNjb3BlLnBheW1lbnRUeXBlVGl0bGU9cGF5bWVudC5uYW1lOwogICAgJHNjb3BlLnNlbGVjdGVkUGF5bWVudE1ldGhvZD1wYXltZW50OwogICAgJHNjb3BlLmlzUGF5bWVudE1ldGhvZFNlbGVjdGVkPXRydWU7CiAgICAkc2NvcGUucHJlZmlsbFBheW1lbnRNZXRob2QocGF5bWVudCwgcGF5bWVudHMpOwogIH07CgogIGZ1bmN0aW9uIHVwZGF0ZUJhbGFuY2UgKGlzU291cmNlV2l0aFZhdCkgewogICAgaWYgKGlzU291cmNlV2l0aFZhdCkgewogICAgICAkc2NvcGUuYmFsYW5jZVRvUGF5Tm9WYXQgPSBOdW1iZXIoKCRzY29wZS5iYWxhbmNlVG9QYXkgLyAoMSArIGJ1c2luZXNzQ29uZmlnLnZhdF9yYXRlKSkudG9GaXhlZCgyKSk7CiAgICB9IGVsc2UgewogICAgICAkc2NvcGUuYmFsYW5jZVRvUGF5ID0gTnVtYmVyKCgkc2NvcGUuYmFsYW5jZVRvUGF5Tm9WYXQgKiAoMSArIGJ1c2luZXNzQ29uZmlnLnZhdF9yYXRlKSkudG9GaXhlZCgyKSk7CiAgICB9CiAgfQoKICAkc2NvcGUudXBkYXRlQmFsYW5jZSA9IHVwZGF0ZUJhbGFuY2U7CgogICRzY29wZS5vbkRvY3VtZW50VHlwZUNoYW5nZWQgPSBmdW5jdGlvbiBvbkRvY3VtZW50VHlwZUNoYW5nZWQoKSB7CiAgICAkc2NvcGUuaW52b2ljZV9nZW5lcmF0ZWQgPSBOdW1iZXIoJHNjb3BlLmRvY3VtZW50X3R5cGUpICE9PSAwOwogIH07CgogICRzY29wZS5tYWtlUGF5bWVudCA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1ZyhjdXJyZW50Q2xpZW50KTsKICAgIGxvZ0RlYnVnKCJwYXltZW50IG1ldGhvZCIpOwogICAgbG9nRGVidWcoJHNjb3BlLnNlbGVjdGVkUGF5bWVudE1ldGhvZCk7CiAgICBsb2dEZWJ1ZygiJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZ2VuZXJhdGVkPTwiKyRzY29wZS5pbnZvaWNlX2dlbmVyYXRlZCsiPiIpOwoKICAgIGlmICgoJHNjb3BlLmJhbGFuY2VUb1BheT09MCkgfHwgKCRzY29wZS5iYWxhbmNlVG9QYXk9PScnKXx8ICgkc2NvcGUuYmFsYW5jZVRvUGF5PT1udWxsKSkKICAgIHsKICAgICAgJHNjb3BlLnVzZXJFcnJvcj0i15DXoNeQINeU15bXnyDXodeb15XXnSDXm9ec16nXlNeVIjsKICAgIH0KICAgIGVsc2UgaWYgKCEkc2NvcGUuaXNQYXltZW50TWV0aG9kU2VsZWN0ZWQpCiAgICB7CiAgICAgICRzY29wZS51c2VyRXJyb3I9IteQ16DXkCDXkdeX16gg15DXntem16LXmSDXqtep15zXldedIjsKLy8gYWxlcnQoJ3NzJyk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgIGlmICgoJHNjb3BlLmludm9pY2VfZ2VuZXJhdGVkIT0xKSB8fCAoJHNjb3BlLmludm9pY2VfZGF0ZV9mb3JtYXQ9PW51bGwpKQogICAgICB7CiAgICAgICAgdmFyIGludm9pY2VfZGF0ZV9mb3JtYXQgPSAibnVsbCI7CiAgICAgIH0KICAgICAgZWxzZQogICAgICB7CiAgICAgICAgdmFyIGludm9pY2VfZGF0ZV9mb3JtYXQgPSAkc2NvcGUuaW52b2ljZV9kYXRlX2Zvcm1hdC5nZXREYXRlKCkgICsgIi0iICsgKCRzY29wZS5pbnZvaWNlX2RhdGVfZm9ybWF0LmdldE1vbnRoKCkrMSkgKyAiLSIgKyAkc2NvcGUuaW52b2ljZV9kYXRlX2Zvcm1hdC5nZXRGdWxsWWVhcigpOwogICAgICB9CiAgICAgIGlmIChpc3BsdXMpCiAgICAgIHsKICAgICAgICB3aGF0VG9QYXk9JHNjb3BlLmJhbGFuY2VUb1BheTsKICAgICAgfQogICAgICBlbHNlIHsKICAgICAgICB3aGF0VG9QYXk9LSRzY29wZS5iYWxhbmNlVG9QYXk7CiAgICAgIH0KICAgICAgdGhlZGF0YT0gewogICAgICAgIGJhbGFuY2VUb1BheTogd2hhdFRvUGF5LAogICAgICAgIGJhbGFuY2VUb1BheU5vVmF0OiAkc2NvcGUuYmFsYW5jZVRvUGF5Tm9WYXQgKiAoaXNwbHVzID8gKzEgOiAtMSksCiAgICAgICAgcGF5bWVudF9tZXRob2RfbmFtZTogJHNjb3BlLnNlbGVjdGVkUGF5bWVudE1ldGhvZC5tZXRob2QsCiAgICAgICAgaW52b2ljZV9udW1iZXI6ICRzY29wZS5pbnZvaWNlX251bWJlciwKICAgICAgICBpbnZvaWNlX2dlbmVyYXRlZDogJHNjb3BlLmludm9pY2VfZ2VuZXJhdGVkLAogICAgICAgIGludm9pY2VfZGF0ZTogaW52b2ljZV9kYXRlX2Zvcm1hdCwKICAgICAgICBiYW5rX2NvbXBhbnlfY29kZTogJHNjb3BlLmJhbmtfY29tcGFueV9jb2RlLAogICAgICAgIGJhbmtfYnJhbmNoX251bWJlcjogJHNjb3BlLmJhbmtfYnJhbmNoX251bWJlciwKICAgICAgICBjaGVja19udW1iZXI6ICRzY29wZS5jaGVja19udW1iZXIsCiAgICAgICAgYWNjb3VudF9udW1iZXI6ICRzY29wZS5hY2NvdW50X251bWJlciwKICAgICAgICBjcmVkaXRfY2FyZF9udW1iZXI6ICRzY29wZS5jcmVkaXRfY2FyZF9udW1iZXIsCiAgICAgICAgY3JlZGl0X2NhcmRfdHlwZTogJHNjb3BlLmNyZWRpdF9jYXJkX3R5cGUsCiAgICAgICAgY3JlZGl0X2NhcmRfdHJhbnNhY3Rpb25fdHlwZTogJHNjb3BlLmNyZWRpdF9jYXJkX3RyYW5zYWN0aW9uX3R5cGUsCiAgICAgICAgaW52b2ljZV9jb21tZW50czogJHNjb3BlLmludm9pY2VfY29tbWVudHMsCiAgICAgICAgZG9jdW1lbnRfdHlwZTogJHNjb3BlLmRvY3VtZW50X3R5cGUKICAgICAgfTsKICAgICAgJHNjb3BlLmt1emVJc0xvYWRpbmc9dHJ1ZTsKICAgICAgY3JlYXRlUGF5bWVudEZvckNsaWVudCgkaHR0cCwkc2NvcGUsY3VycmVudENsaWVudC5idXNpbmVzc191c2VyX2lkLHRoZWRhdGEsY3JlYXRlUGF5bWVudEZvckNsaWVudF9zdWNjZXNzLCBjcmVhdGVQYXltZW50Rm9yQ2xpZW50X2ZhaWx1cmUpOwogICAgICBmdW5jdGlvbiBjcmVhdGVQYXltZW50Rm9yQ2xpZW50X3N1Y2Nlc3MoKQogICAgICB7CiAgICAgICAgJHNjb3BlLmt1emVJc0xvYWRpbmc9ZmFsc2U7CiAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgICAgIGxvZ0RlYnVnKCJicm9hZGNhc3RpbmcgY2xpZW50UGFnZVJlbG9hZERhdGEiKTsKICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NsaWVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCiAgICAgICAgbG9nRGVidWcoImJyb2FkY2FzdGluZyBldmVudFBhZ2VSZWxvYWREYXRhIik7CiAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdldmVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCi8vIGxvZ0RlYnVnKCJicm9hZGNhc3RpbmcgcmVsb2FkRXZlbnQiKTsKLy8gJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdyZWxvYWRFdmVudCcpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGNyZWF0ZVBheW1lbnRGb3JDbGllbnRfZmFpbHVyZSgpCiAgICAgIHsKICAgICAgICAkc2NvcGUua3V6ZUlzTG9hZGluZz1mYWxzZTsKICAgICAgfQogICAgfQogIH0KfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdldmVudERldGFpbHNCdXNpbmVzc0NhbGVuZGFyTW9kYWxDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIHNlbGVjdGVkRXZlbnQsIHVpQ2FsZW5kYXJDb25maWcpIHsKICB2YXIgZGF5TmFtZXMgPSBbJ9eo15DXqdeV158nLCAn16nXoNeZJywgJ9ep15zXmdep15knLCAn16jXkdeZ16LXmScsICfXl9ee15nXqdeZJywgJ9ep15nXqdeZJywgJ9ep15HXqiddOwoKICAkc2NvcGUuZ290b0NsaWVudFBhZ2U9IGZ1bmN0aW9uIChidXNpbmVzVXNlcmlkKQogIHsKICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICAgIGdvdG9DbGllbnRQYWdlKGJ1c2luZXNVc2VyaWQpOwogIH0KICAkc2NvcGUuZWRpdEV2ZW50PSBmdW5jdGlvbiAodGhlZXZlbnQpCiAgewogICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgZ290b0V2ZW50UGFnZSh0aGVldmVudCk7CiAgfQoKICBsb2dEZWJ1Zygic2VsZWN0ZWQgRXZlbnQgaW5mbyA9IiArIEpTT04uc3RyaW5naWZ5KHNlbGVjdGVkRXZlbnQsIG51bGwsIDIpKTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudCA9IHNlbGVjdGVkRXZlbnQ7CiAgc2VsZWN0ZWREYXRlU3RhcnQgPSBuZXcgRGF0ZShzZWxlY3RlZEV2ZW50LnN0YXJ0KTsKICB2YXIgc2VsZWN0ZWREYXRlU3RhcnQgPSBuZXcgRGF0ZShzZWxlY3RlZERhdGVTdGFydC5nZXRUaW1lKCkgKyBzZWxlY3RlZERhdGVTdGFydC5nZXRUaW1lem9uZU9mZnNldCgpICogNjAwMDApOwoKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0SG91cnMoKTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBzZWxlY3RlZERhdGVTdGFydC5nZXRNaW51dGVzKCk7CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkb3cgPSBkYXlOYW1lc1tzZWxlY3RlZERhdGVTdGFydC5nZXREYXkoKV07CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXRlID0gc2VsZWN0ZWREYXRlU3RhcnQ7CgogICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0RGF5ID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RGF0ZSgpOwogICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0TW9udGggPSAxICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TW9udGgoKTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydE1vbnRoVHh0ID0gbW9udGhOYW1lc1skc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydE1vbnRoIC0gMV07CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRZZWFyID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RnVsbFllYXIoKTsKCiAgc2VsZWN0ZWREYXRlRW5kID0gbmV3IERhdGUoc2VsZWN0ZWRFdmVudC5lbmQpOwogIHZhciBzZWxlY3RlZERhdGVFbmQgPSBuZXcgRGF0ZShzZWxlY3RlZERhdGVFbmQuZ2V0VGltZSgpICsgc2VsZWN0ZWREYXRlRW5kLmdldFRpbWV6b25lT2Zmc2V0KCkgKiA2MDAwMCk7CgogICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzID0gc2VsZWN0ZWREYXRlRW5kLmdldEhvdXJzKCk7CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kZG93ID0gZGF5TmFtZXNbc2VsZWN0ZWREYXRlRW5kLmdldERheSgpXTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzID0gKHNlbGVjdGVkRGF0ZUVuZC5nZXRNaW51dGVzKCkgPCAxMCA/ICcwJyA6ICcnKSArIHNlbGVjdGVkRGF0ZUVuZC5nZXRNaW51dGVzKCk7CiAgJHNjb3BlLm9rTGltaXRhdGlvbk1vZGFsID0gZnVuY3Rpb24oKSB7CiAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgfTsKCiAgJHNjb3BlLmRlbGV0ZUxpbWl0YXRpb25Nb2RhbCA9IGZ1bmN0aW9uKCkgewogICAgJHVpYk1vZGFsSW5zdGFuY2UuZGlzbWlzcygnZGVsZXRlJyk7CiAgICBjYWxlbmRhciA9ICdjYWxlbmRhcl9idXNpbmVzcyc7CgogICAgJHNjb3BlLmRlbGV0ZUNhbGVuZGFyREJFdmVudChzZWxlY3RlZEV2ZW50LCBjYWxlbmRhcik7CiAgfTsKICAkc2NvcGUuZGVsZXRlQ2FsZW5kYXJKU0V2ZW50ID0gZnVuY3Rpb24oY2FsZW5kYXIsIHNlbGVjdGVkRXZlbnRpZCkgewoKICAgIGxvZ0RlYnVnKCJjYWxlbmRhcl9ob3Vyc19vZl93b3JrX2NvbmZpZz0iICsgdWlDYWxlbmRhckNvbmZpZyk7CiAgICBsb2dEZWJ1ZygidWlDYWxlbmRhckNvbmZpZ1tjYWxlbmRhcl09IiArIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWydjYWxlbmRhcl9idXNpbmVzcyddKTsKICAgIGxvZ0RlYnVnKCJkZWxldGUganMgZXZlbnQgIiArIHNlbGVjdGVkRXZlbnRpZCk7CiAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZW1vdmVFdmVudHMnLCBbc2VsZWN0ZWRFdmVudGlkXSk7IC8vIGdvIHRvIGRhdGUgaW4gY2FsZW5kYXIgZ290bwogIH07CiAgJHNjb3BlLmRlbGV0ZUNhbGVuZGFyREJFdmVudCA9IGZ1bmN0aW9uKHNlbGVjdGVkRXZlbnQsIGNhbGVuZGFyKSB7CiAgICBsb2dEZWJ1ZygiZGVsZXRlIGV2ZW50ICIgKyBzZWxlY3RlZEV2ZW50LmlkKTsKICAgICRodHRwKHsKICAgICAgbWV0aG9kOiAnUE9TVCcsCiAgICAgIHVybDogJy9hcGkvYWRtaW4vZXZlbnRzL2RlbGV0ZS8nICsgc2VsZWN0ZWRFdmVudC5pZCwKICAgICAgZGF0YTogewogICAgICAgIHRlbXBfbGltaXRfaWQ6IHNlbGVjdGVkRXZlbnQudGVtcF9saW1pdF9pZAogICAgICB9LAogICAgICBoZWFkZXJzOiB7CiAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uO2NoYXJzZXQ9dXRmLTgnCiAgICAgIH0KICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkgewoKICAgICAgbG9nRGVidWcoZGF0YSk7CiAgICAgIGlmICghZGF0YS5zdWNjZXNzKSB7CiAgICAgICAgbG9nRGVidWcoImRlbGV0ZSBsaW1pdF9pZCBlcnJvciArIiArIGRhdGEubWVzc2FnZSk7Ci8vIGlmIG5vdCBzdWNjZXNzZnVsLCBiaW5kIGVycm9ycyB0byBlcnJvciB2YXJpYWJsZXMKLy8JCQkgICRzY29wZS5lcnJvck5hbWUgPSBkYXRhLmVycm9ycy5uYW1lOwovLwkJCSAgJHNjb3BlLmVycm9yU3VwZXJoZXJvID0gZGF0YS5lcnJvcnMuc3VwZXJoZXJvQWxpYXM7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbG9nRGVidWcoImRlbGV0ZSBsaW1pdF9pZCBzdWNjZXNzIik7Ci8vIGlmIHN1Y2Nlc3NmdWwsIGJpbmQgc3VjY2VzcyBtZXNzYWdlIHRvIG1lc3NhZ2UKLy8JCQkgICRzY29wZS5tZXNzYWdlID0gZGF0YS5tZXNzYWdlOwogICAgICAgICRzY29wZS5kZWxldGVDYWxlbmRhckpTRXZlbnQoY2FsZW5kYXIsIHNlbGVjdGVkRXZlbnQuaWQpOwoKICAgICAgfQogICAgfSk7CgogICAgbG9nRGVidWcoImFmdGVyIHJlbW92ZSBldmVudCIpOwogIH07Cn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdldmVudFJlY3VycmluZ0RldGFpbHNCdXNpbmVzc0NhbGVuZGFyTW9kYWxDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIHNlbGVjdGVkRXZlbnQsIHVpQ2FsZW5kYXJDb25maWcpIHsKICB2YXIgZGF5TmFtZXMgPSBbJ9eo15DXqdeV158nLCAn16nXoNeZJywgJ9ep15zXmdep15knLCAn16jXkdeZ16LXmScsICfXl9ee15nXqdeZJywgJ9ep15nXqdeZJywgJ9ep15HXqiddOwoKICAkc2NvcGUuZ290b0NsaWVudFBhZ2U9IGZ1bmN0aW9uIChidXNpbmVzc1VzZXJpZCkKICB7CiAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgICBnb3RvQ2xpZW50UGFnZShidXNpbmVzc1VzZXJpZCk7CiAgfQogICRzY29wZS5lZGl0RXZlbnQ9IGZ1bmN0aW9uICh0aGVldmVudCkKICB7CiAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgICBnb3RvRXZlbnRQYWdlKHRoZWV2ZW50KTsKICB9CgoKICBsb2dEZWJ1Zygic2VsZWN0ZWQgUmVjdXJyaW5nIEV2ZW50IGluZm8gPSIgKyBKU09OLnN0cmluZ2lmeShzZWxlY3RlZEV2ZW50LCBudWxsLCAyKSk7CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQgPSBzZWxlY3RlZEV2ZW50OwogIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc2VsZWN0ZWRFdmVudC5zdGFydCk7CiAgdmFyIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZSgpICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKCi8vIGxvZ0RlYnVnKCJzZWxlY3RlZEV2ZW50LnN0YXJ0PSIgKyBzZWxlY3RlZEV2ZW50LnN0YXJ0KTsKLy8gbG9nRGVidWcoImRhdGU9IiArIHNlbGVjdGVkRGF0ZVN0YXJ0KTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0SG91cnMoKTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBzZWxlY3RlZERhdGVTdGFydC5nZXRNaW51dGVzKCk7CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkb3cgPSBkYXlOYW1lc1tzZWxlY3RlZERhdGVTdGFydC5nZXREYXkoKV07CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXRlID0gc2VsZWN0ZWREYXRlU3RhcnQ7CgogICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0RGF5ID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RGF0ZSgpOwogICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0TW9udGggPSAxICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TW9udGgoKTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydE1vbnRoVHh0ID0gbW9udGhOYW1lc1skc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydE1vbnRoIC0gMV07CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRZZWFyID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RnVsbFllYXIoKTsKCiAgc2VsZWN0ZWREYXRlRW5kID0gbmV3IERhdGUoc2VsZWN0ZWRFdmVudC5lbmQpOwogIHZhciBzZWxlY3RlZERhdGVFbmQgPSBuZXcgRGF0ZShzZWxlY3RlZERhdGVFbmQuZ2V0VGltZSgpICsgc2VsZWN0ZWREYXRlRW5kLmdldFRpbWV6b25lT2Zmc2V0KCkgKiA2MDAwMCk7CgovLyBsb2dEZWJ1Zygic2VsZWN0ZWRFdmVudC5lbmQ9IiArIHNlbGVjdGVkRXZlbnQuZW5kKTsKLy8gbG9nRGVidWcoImRhdGU9IiArIHNlbGVjdGVkRGF0ZUVuZCk7CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMgPSBzZWxlY3RlZERhdGVFbmQuZ2V0SG91cnMoKTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRkb3cgPSBkYXlOYW1lc1tzZWxlY3RlZERhdGVFbmQuZ2V0RGF5KCldOwogICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKSA8IDEwID8gJzAnIDogJycpICsgc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKTsKICAkc2NvcGUub2tMaW1pdGF0aW9uTW9kYWwgPSBmdW5jdGlvbigpIHsKICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICB9OwoKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2V2ZW50RGV0YWlsc0hvdXJzT2ZXb3JrTW9kYWxDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIHNlbGVjdGVkRXZlbnQsIGZpeGVkU2NoZWR1bGUsIHVpQ2FsZW5kYXJDb25maWcpIHsKICB2YXIgZGF5TmFtZXMgPSBbJ9eo15DXqdeV158nLCAn16nXoNeZJywgJ9ep15zXmdep15knLCAn16jXkdeZ16LXmScsICfXl9ee15nXqdeZJywgJ9ep15nXqdeZJywgJ9ep15HXqiddOwoKLy8gbG9nRGVidWcoInNlbGVjdGVkIEV2ZW50ID0iICsgSlNPTi5zdHJpbmdpZnkoc2VsZWN0ZWRFdmVudCwgbnVsbCwgNCkpOwogICRzY29wZS5maXhlZFNjaGVkdWxlPWZpeGVkU2NoZWR1bGU7CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQgPSBzZWxlY3RlZEV2ZW50OwogICRzY29wZS5zZWxlY3RlZEV2ZW50Lm9yaWdfZXZlbnRfdHlwZXMgPSBhbmd1bGFyLmNvcHkoc2VsZWN0ZWRFdmVudC5ldmVudF90eXBlcyk7CiAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscyA9IFtdOwoKICBnZXRCdXNpbmVzc0xvY2F0aW9ucygkaHR0cCwkc2NvcGUsJ2J1c2luZXNzX2xvY2F0aW9ucycpOwoKICBsb2dEZWJ1ZygiaG91cnMgb2Ygd29yayBibG9jay9ldmVudCBjbGlja2VkICIrSlNPTi5zdHJpbmdpZnkoJHNjb3BlLnNlbGVjdGVkRXZlbnQpKTsKCiAgc2VsZWN0ZWREYXRlU3RhcnQgPSBuZXcgRGF0ZShzZWxlY3RlZEV2ZW50LnN0YXJ0KTsKICB2YXIgc2VsZWN0ZWREYXRlU3RhcnQgPSBuZXcgRGF0ZShzZWxlY3RlZERhdGVTdGFydC5nZXRUaW1lKCkgKyBzZWxlY3RlZERhdGVTdGFydC5nZXRUaW1lem9uZU9mZnNldCgpICogNjAwMDApOwogIGdldEFsbEluc3RydWN0b3JzKCRodHRwLCRzY29wZSwnaW5zdHJ1Y3RvcnMnKTsKICBnZXROb0NsYXNzRXZlbnRUeXBlc05vQWRtaW4oJGh0dHAsJHNjb3BlLCdyZWxhdGVkRXZlbnRUeXBlcycsZ2V0Tm9DbGFzc0V2ZW50VHlwZXNOb0FkbWluX3N1Y2Nlc3MpOwogIGZ1bmN0aW9uIGdldE5vQ2xhc3NFdmVudFR5cGVzTm9BZG1pbl9zdWNjZXNzKCkKICB7CiAgICBmb3IodmFyIGkgPSAwOyBpIDwgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRfdHlwZXMubGVuZ3RoOyBpKyspCiAgICB7Ci8vIGNvcHlpbmcgdGhlIGFjdHVhbCBvYmplY3Qgb2YgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRfdHlwZXNbaV0KICAgICAgZm9yKHZhciBqID0gMDsgaiA8ICRzY29wZS5yZWxhdGVkRXZlbnRUeXBlcy5sZW5ndGg7IGorKykKICAgICAgewogICAgICAgIGlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5ldmVudF90eXBlc1tpXS5ldmVudF90eXBlX2lkPT0kc2NvcGUucmVsYXRlZEV2ZW50VHlwZXNbal0uZXZlbnRfdHlwZV9pZCkKICAgICAgICB7CiAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5ldmVudF90eXBlc1tpXT1hbmd1bGFyLmNvcHkoJHNjb3BlLnJlbGF0ZWRFdmVudFR5cGVzW2pdKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CgovLyBsb2dEZWJ1Zygic2VsZWN0ZWRFdmVudC5zdGFydD0iICsgc2VsZWN0ZWRFdmVudC5zdGFydCk7Ci8vIGxvZ0RlYnVnKCJkYXRlPSIgKyBzZWxlY3RlZERhdGVTdGFydCk7CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycyA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldEhvdXJzKCk7CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzID0gKHNlbGVjdGVkRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKSA8IDEwID8gJzAnIDogJycpICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TWludXRlcygpOwogICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZG93ID0gZGF5TmFtZXNbc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RGF5KCldOwogICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF0ZSA9IHNlbGVjdGVkRGF0ZVN0YXJ0OwoKICBzZWxlY3RlZERhdGVFbmQgPSBuZXcgRGF0ZShzZWxlY3RlZEV2ZW50LmVuZCk7CiAgdmFyIHNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKHNlbGVjdGVkRGF0ZUVuZC5nZXRUaW1lKCkgKyBzZWxlY3RlZERhdGVFbmQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKCiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aCA9IG1vbnRoTmFtZXNbc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TW9udGgoKV07CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aDExMiA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldE1vbnRoKCkrMTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRheW9mbW9udGggPSBzZWxlY3RlZERhdGVTdGFydC5nZXREYXRlKCk7CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RnVsbFllYXIoKTsKLy8gJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5zdGFydF90aW1lX2lucHV0X2Zvcm1hdD0gbmV3IERhdGUoMTk3MCwgMCwgMSwgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycywgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzLCAwKTsKCi8vIGxvZ0RlYnVnKCJzZWxlY3RlZEV2ZW50LmVuZD0iICsgc2VsZWN0ZWRFdmVudC5lbmQpOwovLyBsb2dEZWJ1ZygiZGF0ZT0iICsgc2VsZWN0ZWREYXRlRW5kKTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycyA9IHNlbGVjdGVkRGF0ZUVuZC5nZXRIb3VycygpOwogICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGRvdyA9IGRheU5hbWVzW3NlbGVjdGVkRGF0ZUVuZC5nZXREYXkoKV07CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcyA9IChzZWxlY3RlZERhdGVFbmQuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBzZWxlY3RlZERhdGVFbmQuZ2V0TWludXRlcygpOwoKCiAgJHNjb3BlLm9rTGltaXRhdGlvbk1vZGFsID0gZnVuY3Rpb24oKSB7CiAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgfTsKCiAgJHNjb3BlLnVwZGF0ZUxpbWl0YXRpb25Nb2RhbCA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1ZygiZnVuY3Rpb246IHVwZGF0ZUxpbWl0YXRpb25Nb2RhbCIpOwogICAgaWYgKCRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50X3R5cGVzLmxlbmd0aDwxKQogICAgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBpZiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnM8JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykKICAgIHsKICAgICAgYWxlcnQoIteW157XnyDXodeZ15XXnSDXnNek16DXmSDXltee158g15TXqteX15zXlCIpOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBpZiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnM9PSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMpCiAgICB7CiAgICAgIGlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzPD0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpCiAgICAgIHsKICAgICAgICBhbGVydCgi15bXntefINeh15nXldedINec16TXoNeZINeW157XnyDXlNeq15fXnNeUIik7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIGlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzPCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMrMTApKQogICAgICB7CiAgICAgICAgYWxlcnQoIteR15zXldenINen15jXnyDXni0xMCDXk9en15XXqiIpOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfQoKCiAgICBmdW5jdGlvbiB1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25fc3VjY2VzcygpCiAgICB7CiAgICAgIGNhbGVuZGFyID0gJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnOwogICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZWZldGNoRXZlbnRzJyk7IC8vIGdvIHRvIGRhdGUgaW4gY2FsZW5kYXIgZ290bwogICAgICAkdWliTW9kYWxJbnN0YW5jZS5kaXNtaXNzKCdkZWxldGUnKTsKICAgIH0KCiAgICBpZiAoJHNjb3BlLmZpeGVkU2NoZWR1bGUpCiAgICB7Ci8vIGZpeGVkIHNjaGVkdWxlIC0gdXBhZHRpbmcgbGltaXRhdGlvbiAxOTcwCiAgICAgIHRoZWRhdGEgPSB7CiAgICAgICAgc3RhcnRfZGF0ZTogbmV3X3N0YXJ0LAogICAgICAgIGVuZF9kYXRlOiBuZXdfZW5kLAogICAgICAgIHRlbXBfbGltaXRfaWQ6IG51bGwsCiAgICAgICAgbGltaXRfaWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmxpbWl0X2lkLAogICAgICAgIGV2ZW50X3R5cGVzOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5ldmVudF90eXBlcywKICAgICAgICBsb2NhdGlvbl9pZDogJHNjb3BlLnNlbGVjdGVkRXZlbnQubG9jYXRpb25faWQsCiAgICAgICAgb3JpZ19ldmVudF90eXBlczogJHNjb3BlLnNlbGVjdGVkRXZlbnQub3JpZ19ldmVudF90eXBlcywKICAgICAgICBlbXBfaWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmVtcF9pZAogICAgICB9OwogICAgICB1cGRhdGVDYWxlbmRhckxpbWl0YXRpb24oJGh0dHAsJHNjb3BlLHRoZWRhdGEsJHNjb3BlLnNlbGVjdGVkRXZlbnQubGltaXRfaWQsIHVwZGF0ZUNhbGVuZGFyTGltaXRhdGlvbl9zdWNjZXNzKTsKICAgIH0KICAgIGVsc2UKLy8gbm90IGZpeGVkIHNjaGVkdWxlIC0gcGVyZGF5IGJsb2NrCiAgICB7Ci8vLy8vLy8vLy8vCiAgICAgIGlmICgoJHNjb3BlLnNlbGVjdGVkRXZlbnQubGltaXRfaWQgIT0gbnVsbCkgJiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZGF5X2xpbWl0X2lkID09IC0xKSkgLy8gZXZlbnQgbGltaXRhdGlvbiBoYXMgbGltaXRfaWQgc28gaXRzIGFuIDE5NzAgZXZlbnQKLy8gbmVlZCB0byBhZGQgYSBuZXcgcGVyZGF5IGxpbWl0YXRpb24gdGhhdCBwb2ludCAobGltaXRfaWQpIHRvIHRoZSBvbGQgMTk3MCBldmVudCB0byByZXBsYWN0ZSBpdAogICAgICB7CiAgICAgICAgdGVtcF9saW1pdF9pZCA9IGNhbGNfdGVtcF9saW1pdF9pZCgpOwovLyB0aGVldmVudC50ZW1wX2xpbWl0X2lkID0gdGVtcF9saW1pdF9pZDsKLy8gdGhlZXZlbnQuZGF5X2xpbWl0X2lkID0gdGVtcF9saW1pdF9pZDsKLy8gdGhlIG1vdmVkIGV2ZW50IGluIHRoZSBjYWxlbmRhciBub3cgaGFzIGRheV9saW1pdF9pZCBhbmQgdGVtcF9saW1pdF9pZAovLyBpZiBpdHMgbG9hZGVkIGZyb20gdGhlIGRiLCBpdCB3aWxsIG9ubHkgaGF2ZSBkYXlfbGltaXRfaWQgKGFuZCBub3QgdGhlIHRlbXAgb25lKQovLyB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1snY2FsZW5kYXJfaG91cnNfb2Zfd29yayddLmZ1bGxDYWxlbmRhcigndXBkYXRlRXZlbnQnLCB0aGVldmVudCk7Ci8vIGNvbnNvbGUubG9nKCJYWFhYWFhYWFhYWFhYIik7CiAgICAgICAgdGhlZGF0YSA9IHsKICAgICAgICAgIHN0YXJ0X2RhdGU6IG5ld19zdGFydCwKICAgICAgICAgIGVuZF9kYXRlOiBuZXdfZW5kLAogICAgICAgICAgY29sb3I6ICcnLAogICAgICAgICAgdGVtcF9saW1pdF9pZDogMCwKICAgICAgICAgIGV2ZW50X3R5cGVfaWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50X3R5cGVfaWQsCiAgICAgICAgICBldmVudF90eXBlczogJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRfdHlwZXMsCiAgICAgICAgICBsaW1pdF9pZDogJHNjb3BlLnNlbGVjdGVkRXZlbnQuaWQsCiAgICAgICAgICBsb2NhdGlvbl9pZDogJHNjb3BlLnNlbGVjdGVkRXZlbnQubG9jYXRpb25faWQsCiAgICAgICAgICBlbXBfaWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmVtcF9pZAovLyB0aXRsZTogdGhlZXZlbnQudGl0bGUKICAgICAgICB9OwogICAgICAgIGNyZWF0ZUNhbGVuZGFyTGltaXRhdGlvblBlckRheSgkaHR0cCwkc2NvcGUsdGhlZGF0YSx1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25fc3VjY2Vzcyk7CgogICAgICB9CiAgICAgIGVsc2UKICAgICAgewogICAgICAgIHRoZWRhdGE9IHsKICAgICAgICAgIHN0YXJ0X2RhdGU6IG5ld19zdGFydCwKICAgICAgICAgIGVuZF9kYXRlOiBuZXdfZW5kLAogICAgICAgICAgdGVtcF9kYXlfbGltaXRfaWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LnRlbXBfbGltaXRfaWQsCiAgICAgICAgICBvcmlnX2V2ZW50X3R5cGVzOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5vcmlnX2V2ZW50X3R5cGVzLAogICAgICAgICAgZXZlbnRfdHlwZXM6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50X3R5cGVzLAogICAgICAgICAgbG9jYXRpb25faWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmxvY2F0aW9uX2lkLAogICAgICAgICAgZGF5X2xpbWl0X2lkOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5kYXlfbGltaXRfaWQsCiAgICAgICAgICBlbXBfaWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmVtcF9pZAogICAgICAgIH07CiAgICAgICAgdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5KCRodHRwLCRzY29wZSx0aGVkYXRhLHVwZGF0ZUNhbGVuZGFyTGltaXRhdGlvbl9zdWNjZXNzKTsKICAgICAgfQogICAgfQogIH0KICAkc2NvcGUuZGVsZXRlTGltaXRhdGlvbk1vZGFsID0gZnVuY3Rpb24oKSB7CiAgICBjYWxlbmRhciA9ICdjYWxlbmRhcl9ob3Vyc19vZl93b3JrJzsKCi8vIHJlbW92aW5nIGxpbWl0YXRpb24gZnJvbSBkYXRhYmFzZSwgaWYgdHJ1ZSAtIHJlbW92aW5nIGZyb20gZGlzcGxheSBhbHNvCiAgICBpZiAoJHNjb3BlLmRlbGV0ZUNhbGVuZGFyREJMaW1pdGF0aW9uRXZlbnQoc2VsZWN0ZWRFdmVudCkpCiAgICB7Ci8vICRzY29wZS5kZWxldGVDYWxlbmRhckpTRXZlbnQoY2FsZW5kYXIsIHNlbGVjdGVkRXZlbnQuaWQpOwogICAgfQogICAgJHVpYk1vZGFsSW5zdGFuY2UuZGlzbWlzcygnZGVsZXRlJyk7CiAgfTsKICAkc2NvcGUuZGVsZXRlQ2FsZW5kYXJKU0V2ZW50ID0gZnVuY3Rpb24oY2FsZW5kYXIsIHNlbGVjdGVkRXZlbnRpZCkgewoKICAgIGxvZ0RlYnVnKCJjYWxlbmRhcl9ob3Vyc19vZl93b3JrX2NvbmZpZz0iICsgdWlDYWxlbmRhckNvbmZpZyk7CiAgICBsb2dEZWJ1ZygidWlDYWxlbmRhckNvbmZpZ1tjYWxlbmRhcl09IiArIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWydjYWxlbmRhcl9ob3Vyc19vZl93b3JrJ10pOwogICAgbG9nRGVidWcoImRlbGV0ZSBqcyBldmVudCAiICsgc2VsZWN0ZWRFdmVudGlkKTsKICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlbW92ZUV2ZW50cycsIFtzZWxlY3RlZEV2ZW50aWRdKTsgLy8gZ28gdG8gZGF0ZSBpbiBjYWxlbmRhciBnb3RvCiAgfTsKICAkc2NvcGUuZGVsZXRlQ2FsZW5kYXJEQkxpbWl0YXRpb25FdmVudCA9IGZ1bmN0aW9uKHNlbGVjdGVkRXZlbnQpIHsKICAgIGNhbGVuZGFyID0gJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnOwovLyByZXR1cm4gZmFsc2U7CgovLyBkZWxldGluZyBldmVudCBsaW1pdGF0aW9uIChub3QgcGVyIGRheSkKLy8gZWl0aGVyIGZyb20gMTk3MCAoaG91cnNfb2Zfd29yayBwYWdlKQovLyBvciBmcm9tIHRoZWlyIGluc3RhbmNlIGluIHRoZSBjdXJyZW50IHdlZWsncyBsaW1pdGF0aW9uLgovLyBlaXRoZXIgd2F5IGRheV9saW1pdF9pZCBpcyAtMSBmb3IgbGltaXRhdGlvbnMgZnJvbSAxOTcwCiAgICBpZiAoc2VsZWN0ZWRFdmVudC5kYXlfbGltaXRfaWQgPT0gLTEpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJyZW1vdmluZyBldmVudCBsaW1pdGF0aW9uLCBjaGVja2lnbiBpZiBpdHMgaW4gMTk3MCAodGhlIG9yaWdpbmFsKSBvciBhbiBpbnN0YW5jZSBpbiBwcmVzZW50Iik7CiAgICAgIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc2VsZWN0ZWRFdmVudC5zdGFydCk7Ci8vIGlmIGl0cyAxOTcwIHRoaXMgbWVhbnMgd2UncmUgaW4gdGhlIGhvdXJzX29mX3dvcmsgZ2VuZXJhbCBwYWdlCi8vIHNvIHdlIHNpbXBseSBkZWxldGUgaXQKICAgICAgaWYgKHNlbGVjdGVkRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCkgPT0gMTk3MCkKICAgICAgewogICAgICAgIGxvZ0RlYnVnKCJyZW1vdmluZyBldmVudCBsaW1pdGF0aW9uIGZyb20gMTk3MCIpOwogICAgICAgIHRoZWRhdGE9IHsKICAgICAgICAgIHRlbXBfbGltaXRfaWQ6IHNlbGVjdGVkRXZlbnQudGVtcF9saW1pdF9pZAogICAgICAgIH07CiAgICAgICAgZGVsZXRlQ2FsZW5kYXJMaW1pdGF0aW9uKCRodHRwLCRzY29wZSx0aGVkYXRhLHNlbGVjdGVkRXZlbnQubGltaXRfaWQsIGRlbGV0ZUNhbGVuZGFyTGltaXRhdGlvbl9zdWNjZXNzKTsKICAgICAgICBmdW5jdGlvbiBkZWxldGVDYWxlbmRhckxpbWl0YXRpb25fc3VjY2VzcygpCiAgICAgICAgewogICAgICAgICAgJHNjb3BlLmRlbGV0ZUNhbGVuZGFySlNFdmVudChjYWxlbmRhciwgc2VsZWN0ZWRFdmVudC5pZCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGVsc2UKICAgICAgewovLyByZW1vdmluZyBldmVudCBsaW1pdGF0aW9uIGZyb20gdGhlIGEgc3BlY2lmaWMgd2VlawovLyB0aGlzIG1lYW5zIGFkZGluZyBldmVudCBsaW1pdGF0aW9uIHBlciBkYXkgd2l0aCByYW5nZSBlbmQ9c3RhcnQKLy8gbWF5YmUgQlVHIEJVR0dZPwogICAgICAgIGxvZ0RlYnVnKCJ4IHJlbW92aW5nIGV2ZW50IGxpbWl0YXRpb24gZnJvbSBhIHNwZWNpZmljIHdlZWssIHRoaXMgbWVhbnMgYWRkaW5nIGV2ZW50IGxpbWl0YXRpb24gcGVyIGRheSB3aXRoIHJhbmdlIDAtMCIpOwovLyBsb2dEZWJ1ZyhKU09OLnN0cmluZ2lmeShzZWxlY3RlZEV2ZW50KSk7CgogICAgICAgIHRoZWRhdGEgPSB7CiAgICAgICAgICBzdGFydF9kYXRlOiBzZWxlY3RlZEV2ZW50LnN0YXJ0LAogICAgICAgICAgZW5kX2RhdGU6IHNlbGVjdGVkRXZlbnQuc3RhcnQsCiAgICAgICAgICBjb2xvcjogIiMwMDAwMDAiLAogICAgICAgICAgdGVtcF9saW1pdF9pZDogMSwKICAgICAgICAgIGV2ZW50X3R5cGVfaWQ6IHNlbGVjdGVkRXZlbnQuZXZlbnRfdHlwZV9pZCwKICAgICAgICAgIGxvY2F0aW9uX2lkOiBzZWxlY3RlZEV2ZW50LmxvY2F0aW9uX2lkLAogICAgICAgICAgbGltaXRfaWQ6IHNlbGVjdGVkRXZlbnQubGltaXRfaWQsCiAgICAgICAgICB0aXRsZTogc2VsZWN0ZWRFdmVudC50aXRsZQogICAgICAgIH07CgogICAgICAgIGNyZWF0ZUNhbGVuZGFyTGltaXRhdGlvblBlckRheSgkaHR0cCwkc2NvcGUsdGhlZGF0YSxjcmVhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXlfc3VjY2Vzcyk7CiAgICAgICAgZnVuY3Rpb24gY3JlYXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5X3N1Y2Nlc3MoKQogICAgICAgIHsKICAgICAgICAgICRzY29wZS5kZWxldGVDYWxlbmRhckpTRXZlbnQoY2FsZW5kYXIsIHNlbGVjdGVkRXZlbnQuaWQpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgZWxzZQogICAgewovLyBkZWxldGluZyBhIHBlcmRheSBsaW1pdGF0aW9uLgovLyBpZiBpdCdzIGEgcGVyZGF5IHRoYXQgInJlcGxhY2VkIiBhIDE5NzAgb25lCi8vIHRoZW4gd2UgY2Fubm90IGRlbGV0ZSBpdCAob3RoZXJ3aXNlIHRoZSBvcmlnaW5hbCAxOTcwIHdpbGwgcmVhcHBlYXIpCi8vIHNvIHdlIHNldCBpdCB0byBzdGFydD1lbmQKLy8gdGhpcyBtYXliZSBhIEJVRyBhbmQgY2F1c2UgVFJPVUJMRSAvLyBUT0RPCi8vIG90aGV3aXNlIHdlIGNhbiBkZWxldGUgaXQgLSB0aGUgcGVyZGF5IC0gYXMgaXRzIGEgbmV3IHBlcmRheSBhbmQgbm90ICJyZXBsYWNpbmciIGEgMTk3MCBvbmUKCiAgICAgIGlmIChzZWxlY3RlZEV2ZW50LmxpbWl0X2lkICE9IG51bGwpIC8vIHRoaXMgaXMgdGhlIHBlcmRheSB0aGF0IHJlcGxhY2VzIGEgMTk3MCBvbmUgLSB3ZSBzZXQgaXQgdG8gc3RhcnQ9ZW5kCiAgICAgIHsKICAgICAgICBsb2dEZWJ1ZygicmVtb3ZpbmcgZXZlbnQgbGltaXRhdGlvbiBwZXIgZGF5IHJlbGF0ZWQgdG8gMTk3MCAodXBkYXRpbmcgaXQgdG8gc3RhcnQ9ZW5kKSIpOwoKICAgICAgICB0aGVkYXRhPSB7CiAgICAgICAgICBzdGFydF9kYXRlOiBzZWxlY3RlZEV2ZW50LnN0YXJ0LAogICAgICAgICAgZW5kX2RhdGU6IHNlbGVjdGVkRXZlbnQuc3RhcnQsCiAgICAgICAgICB0ZW1wX2RheV9saW1pdF9pZDogc2VsZWN0ZWRFdmVudC50ZW1wX2xpbWl0X2lkLAogICAgICAgICAgZGF5X2xpbWl0X2lkOiBzZWxlY3RlZEV2ZW50LmRheV9saW1pdF9pZAogICAgICAgIH07CiAgICAgICAgdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5KCRodHRwLCRzY29wZSx0aGVkYXRhLHVwZGF0ZUNhbGVuZGFyTGltaXRhdGlvblBlckRheV9zdWNjZXMpOwoKICAgICAgICBmdW5jdGlvbiB1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXlfc3VjY2VzKCkKICAgICAgICB7CiAgICAgICAgICAkc2NvcGUuZGVsZXRlQ2FsZW5kYXJKU0V2ZW50KGNhbGVuZGFyLCBzZWxlY3RlZEV2ZW50LmlkKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZWxzZSAgLy8gdGhpcyBpcyB0aGUgY2FzZSB3aGVyZSB0aGUgcGVyZGF5IGRvZXNudCByZXBsYWNlIGEgMTk3MCBvbmUsIHdlIGNhbiBzaW1wbHkgZGVsZXRlIGl0CiAgICAgIHsKICAgICAgICBsb2dEZWJ1ZygicmVtb3ZpbmcgZXZlbnQgbGltaXRhdGlvbiBwZXIgZGF5IHJlbGF0ZWQgbm90IHJlbGF0ZWQgdG8gMTk3MCAoc28gd2UncmUgZGVsZXRpbmcgaXQpIik7CiAgICAgICAgdGhlZGF0YSA9IHsKICAgICAgICAgIHRlbXBfbGltaXRfaWQ6IHNlbGVjdGVkRXZlbnQudGVtcF9saW1pdF9pZAogICAgICAgIH07CiAgICAgICAgZGVsZXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5KCRodHRwLCRzY29wZSx0aGVkYXRhLHNlbGVjdGVkRXZlbnQuZGF5X2xpbWl0X2lkLCBkZWxldGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXlfc3VjY2Vzcyk7CiAgICAgICAgZnVuY3Rpb24gZGVsZXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5X3N1Y2Nlc3MoKQogICAgICAgIHsKICAgICAgICAgICRzY29wZS5kZWxldGVDYWxlbmRhckpTRXZlbnQoY2FsZW5kYXIsIHNlbGVjdGVkRXZlbnQuaWQpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgbG9nRGVidWcoImFmdGVyIHJlbW92ZSBldmVudCIpOwoKICB9OwoKCiAgJHNjb3BlLnN0YXJ0TWludXRlcyA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1Zygic3RhcnRNaW51dGVzICIrKCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcykpOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzPW1pbnV0ZXNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcyk7CiAgICBjYWxjdWxhdGVTdGFydFRpbWUoKTsKICB9CiAgJHNjb3BlLnN0YXJ0SG91cnMgPSBmdW5jdGlvbigpCiAgewogICAgbG9nRGVidWcoInN0YXJ0SG91cnMgIitob3Vyc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykpOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3Vycz1ob3Vyc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3Vycyk7CiAgICBjYWxjdWxhdGVTdGFydFRpbWUoKTsKICB9CiAgJHNjb3BlLmVuZE1pbnV0ZXMgPSBmdW5jdGlvbigpCiAgewogICAgbG9nRGVidWcoImVuZE1pbnV0ZXMgIisoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcykpOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcz1taW51dGVzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzKTsKICAgIGNhbGN1bGF0ZUVuZFRpbWUoKTsKICB9CiAgJHNjb3BlLmVuZEhvdXJzID0gZnVuY3Rpb24oKQogIHsKICAgIGxvZ0RlYnVnKCJlbmRIb3VycyAiK2hvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycykpOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnM9aG91cnNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzKTsKICAgIGNhbGN1bGF0ZUVuZFRpbWUoKTsKICB9CgoKICBmdW5jdGlvbiBjYWxjdWxhdGVTdGFydFRpbWUoKQogIHsKICAgIGV2ZW50WWVhcj0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXI7CiAgICBldmVudE1vbnRoPSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bW9udGgxMTI7CiAgICBldmVudERheT0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRheW9mbW9udGg7CiAgICBpZiAocGFyc2VJbnQoZXZlbnRNb250aCk8MTApCiAgICB7CiAgICAgIGV2ZW50TW9udGg9IjAiK2V2ZW50TW9udGg7CiAgICB9CiAgICBpZiAocGFyc2VJbnQoZXZlbnREYXkpPDEwKQogICAgewogICAgICBldmVudERheT0iMCIrZXZlbnREYXk7CiAgICB9CgogICAgbmV3X3N0YXJ0PW1vbWVudC51dGMoZXZlbnRZZWFyKyItIitldmVudE1vbnRoKyItIitldmVudERheSsiVDAwOjAwOjAwIikuYWRkKCgocGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykqNjApK3BhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcykpLCAnbWludXRlcycpOwogICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5zdGFydF90aW1lPW5ld19zdGFydDsKICAgIGxvZ0RlYnVnKCJuZXdfc3RhcnQ9IituZXdfc3RhcnQpOwogIH0KICBmdW5jdGlvbiBjYWxjdWxhdGVFbmRUaW1lKCkKICB7CiAgICBldmVudFllYXI9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyOwogICAgZXZlbnRNb250aD0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoMTEyOwogICAgZXZlbnREYXk9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXlvZm1vbnRoOwogICAgaWYgKHBhcnNlSW50KGV2ZW50TW9udGgpPDEwKQogICAgewogICAgICBldmVudE1vbnRoPSIwIitldmVudE1vbnRoOwogICAgfQogICAgaWYgKHBhcnNlSW50KGV2ZW50RGF5KTwxMCkKICAgIHsKICAgICAgZXZlbnREYXk9IjAiK2V2ZW50RGF5OwogICAgfQoKICAgIG5ld19lbmQ9bW9tZW50LnV0YyhldmVudFllYXIrIi0iK2V2ZW50TW9udGgrIi0iK2V2ZW50RGF5KyJUMDA6MDA6MDAiKS5hZGQoKChwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycykqNjApK3BhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpKSwgJ21pbnV0ZXMnKTsKICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kX3RpbWU9bmV3X2VuZDsKICAgIGxvZ0RlYnVnKCJuZXdfZW5kPSIrbmV3X2VuZCk7CiAgfQoKICBjYWxjdWxhdGVTdGFydFRpbWUoKTsKICBjYWxjdWxhdGVFbmRUaW1lKCk7CgogIGZ1bmN0aW9uIG1pbnV0ZXNDaGFuZ2VkKHRoZW1pbnV0ZXMpCiAgewogICAgbG9nRGVidWcoInRoZW1pbnV0ZXM9Iit0aGVtaW51dGVzKTsKICAgIGlmICh0eXBlb2YgdGhlbWludXRlcz09InVuZGVmaW5lZCIpCiAgICB7CiAgICAgIHJldHVybiAiMDAiOwogICAgfQogICAgdGhlbWludXRlcz1wYXJzZUludCh0aGVtaW51dGVzKTsKICAgIGlmICh0aGVtaW51dGVzPjYwKQogICAgewogICAgICByZXR1cm4gIjAwIjsKICAgIH0KICAgIGVsc2UgaWYgKHRoZW1pbnV0ZXM8MCkKICAgIHsKICAgICAgcmV0dXJuICIwMCI7CiAgICB9CiAgICBlbHNlIGlmICh0aGVtaW51dGVzPT0iIikKICAgIHsKICAgICAgcmV0dXJuICIwMCI7CiAgICB9CiAgICBlbHNlIGlmICh0aGVtaW51dGVzPDEwKQogICAgewogICAgICByZXR1cm4gIjAiK3RoZW1pbnV0ZXM7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgIHJldHVybiB0aGVtaW51dGVzOwogICAgfQogIH0KICBmdW5jdGlvbiBob3Vyc0NoYW5nZWQodGhlaG91cnMpCiAgewogICAgbG9nRGVidWcoInRoZWhvdXJzPSIrdGhlaG91cnMpOwogICAgaWYgKHR5cGVvZiB0aGVob3Vycz09InVuZGVmaW5lZCIpCiAgICB7CiAgICAgIHJldHVybiAiMCI7CiAgICB9CiAgICB0aGVob3Vycz1wYXJzZUludCh0aGVob3Vycyk7CiAgICBpZiAodGhlaG91cnM+MjQpCiAgICB7CiAgICAgIHJldHVybiAwOwogICAgfQogICAgZWxzZSBpZiAodGhlaG91cnM8MCkKICAgIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CiAgICBlbHNlIGlmICh0aGVob3Vycz09IiIpCiAgICB7CiAgICAgIHJldHVybiAiMCI7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgIHJldHVybiB0aGVob3VyczsKICAgIH0KICB9Cgp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ0V2ZW50VHlwZXNDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGNvbXBpbGUsIHVpQ2FsZW5kYXJDb25maWcsICR1aWJNb2RhbCwkbG9jYXRpb24pIHsKICBsb2dEZWJ1ZygnRXZlbnRUeXBlcyBDb250cm9sbGVyJyk7CgogIGdldEFsbEJ1c2luZXNzRXZlbnRUeXBlcygkaHR0cCwkc2NvcGUsJ2V2ZW50X3R5cGVzJyk7CiAgJHNjb3BlLnNob3dFdmVudFR5cGUgPSBmdW5jdGlvbiAodGhlRXZlbnQpCiAgewogICAgJGxvY2F0aW9uLnBhdGgoJy9ldmVudF90eXBlcy8nK3RoZUV2ZW50LmV2ZW50X3R5cGVfaWQpOwogIH0KfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ0V2ZW50VHlwZU5ld0NvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkY29tcGlsZSwgdWlDYWxlbmRhckNvbmZpZywgJHVpYk1vZGFsLCAkbG9jYXRpb24pIHsKICBsb2dEZWJ1ZygnRXZlbnRUeXBlcyBDb250cm9sbGVyIE5ldycpOwoKICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcyA9IHt9OyAvLyB0aGVzZSBhcmUgdGhlIGNvbXBsZXRlIGRldGFpbHMgZm9yIHRoZSBuZXcgZXZlbnQgLy8KICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5pc19jbGFzcyA9IDA7CiAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuYmxvY2tFeHRyYVRpbWUgPSBmYWxzZTsKICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5kdXJhdGlvbl9iZWZvcmVfZXZlbnQgPSAwOwogICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmR1cmF0aW9uX2FmdGVyX2V2ZW50ID0gMDsKICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5pbmhlcml0X21haW5faG91cnMgPSAxOwogICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF93YWl0aW5nX2xpc3QgPSAzOwogICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmlzX3VwZGF0ZSA9IGZhbHNlOwogICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF9wYXJ0aWNpcGFudHMgPSAxOwogICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF9yZWdpc3RyYXRpb25zPTE7CiAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuaXNfcHVibGljPTE7CiAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuaW5zdHJ1Y3Rvcl9pZD0wOwoKICAkc2NvcGUuZXZlbnRDb2xvclN0eWxlID0ge307CiAgZGVmYXVsdENvbG9yID0gJzAwYTY1YSc7CiAgJHNjb3BlLmV2ZW50Q29sb3JTdHlsZVtkZWZhdWx0Q29sb3JdID0gewogICAgJ3RyYW5zZm9ybSc6ICdyb3RhdGUoMzBkZWcpJwogIH07CiAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXZlbnRDb2xvciA9ICIjIiArIGRlZmF1bHRDb2xvcjsKICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyA9IFsKICAgIHsiZmllbGRfbmFtZSI6Iteh15nXm9eV150g157XpNeS16kiLCJmaWVsZF9kYXRhdHlwZSI6IlRFWFRfQVJFQSIsImlzX21hbmRhdG9yeSI6MCwgImZyb21kYiI6IGZhbHNlLCAiZGJfaWRfdG9maXgiOiAwLCAiaXNfYWN0aXZlIjogMSwgIm1vZGlmaWVkIjogZmFsc2V9LAogICAgeyJmaWVsZF9uYW1lIjoi16nXmdei15XXqNeZINeR15nXqiIsImZpZWxkX2RhdGF0eXBlIjoiVEVYVF9BUkVBIiwiaXNfbWFuZGF0b3J5IjowLCAiZnJvbWRiIjogZmFsc2UsICJkYl9pZF90b2ZpeCI6IDAsICJpc19hY3RpdmUiOiAxLCAibW9kaWZpZWQiOiBmYWxzZX0KICBdOwoKICBnZXRBbGxJbnN0cnVjdG9ycygkaHR0cCwkc2NvcGUsJ2luc3RydWN0b3JzJyxnZXRBbGxJbnN0cnVjdG9yc19zdWNjZXNzKTsKICBmdW5jdGlvbiBnZXRBbGxJbnN0cnVjdG9yc19zdWNjZXNzKCkKICB7Ci8vICRzY29wZS5pbnN0cnVjdG9ycy51bnNoaWZ0KHtidXNpbmVzc191c2VyX2lkOjAsIGJ1c2VyX2ZpcnN0X25hbWU6IiIsIGJ1c2VyX2xhc3RfbmFtZToiIn0pOwogICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuaW5zdHJ1Y3Rvcl9pZD0kc2NvcGUuaW5zdHJ1Y3RvcnNbMF0uYnVzaW5lc3NfdXNlcl9pZDsKICB9CgogICRzY29wZS5ldmVudFR5cGVFeHRyYUZpZWxkc1BvcCA9IGZ1bmN0aW9uKGV2ZW50VHlwZVByb3BlcnRpZXMpIHsKICAgIGxvZ0RlYnVnKCJldmVudFR5cGVFeHRyYUZpZWxkc1BvcDEiKTsKCiAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAgICAgYW5pbWF0aW9uOiBmYWxzZSwKICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfZXZlbnRfdHlwZV9leHRyYV9maWVsZHMucGhwJywKICAgICAgY29udHJvbGxlcjogJ2V2ZW50VHlwZUV4dHJhRmllbGRzTW9kYWxDb250cm9sbGVyJywKICAgICAgc2l6ZTogJ2wnLAogICAgICByZXNvbHZlOiB7CiAgICAgICAgZXZlbnRUeXBlUHJvcGVydGllczogZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gZXZlbnRUeXBlUHJvcGVydGllczsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwoKICAgIG1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24oc2VsZWN0ZWRJdGVtKSB7CiAgICAgIGxvZ0RlYnVnKHNlbGVjdGVkSXRlbSk7CiAgICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzID0gc2VsZWN0ZWRJdGVtOwogICAgfSwgZnVuY3Rpb24oKSB7CiAgICAgIGxvZ0RlYnVnKCdNb2RhbCBkaXNtaXNzZWQgYXQ6ICcgKyBuZXcgRGF0ZSgpKTsKICAgIH0pOwogIH07CgogICRzY29wZS5jaGFuZ2VFdmVudENvbG9yID0gZnVuY3Rpb24obmV3Q29sb3IpIHsKICAgIGxvZ0RlYnVnKCJjaG9vc2luZyBjb2xvciAiICsgbmV3Q29sb3IpOwogICAgJHNjb3BlLmV2ZW50Q29sb3IgPSBuZXdDb2xvcjsKICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV2ZW50Q29sb3IgPSAiIyIgKyBuZXdDb2xvcjsKICAgICRzY29wZS5ldmVudENvbG9yU3R5bGUgPSB7CiAgICAgICdiYWNrZ3JvdW5kLWNvbG9yJzogIiMiICsgbmV3Q29sb3IKICAgIH07CiAgICAkc2NvcGUuZXZlbnRDb2xvclN0eWxlW25ld0NvbG9yXSA9IHsKICAgICAgJ3RyYW5zZm9ybSc6ICdyb3RhdGUoMzBkZWcpJwogICAgfTsKCiAgfQoKICAkc2NvcGUuYWRkRXZlbnRUeXBlQ2FuY2VsID0gZnVuY3Rpb24oKSB7CiAgICAkbG9jYXRpb24ucGF0aCgnL2V2ZW50X3R5cGVzJyk7CiAgfTsKCiAgJHNjb3BlLmR1cGxpY2F0ZUZpZWxkTmFtZXM9IiI7CiAgJHNjb3BlLmFkZEV2ZW50VHlwZSA9IGZ1bmN0aW9uKCkgewogICAgLy8gY2hlY2sgZXh0cmEgZmllbGRzIGR1cGxpY2F0ZSBuYW1lcyAtIHN0YXJ0CiAgICBsb2dEZWJ1ZygiYWRkRXZlbnRUeXBlOiBjaGVjayBleHRyYSBmaWVsZHMgZHVwbGljYXRlIG5hbWVzIC0gc3RhcnQiKTsKICAgIHZhciBleHRyYUZpZWxkc05hbWVzID0gW107CiAgICBmb3IgKHZhciBpPTE7IGk8JHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMubGVuZ3RoOyBpKyspCiAgICB7CiAgICAgIGV4dHJhRmllbGRzTmFtZXMucHVzaCgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkc1tpXS5maWVsZF9uYW1lKTsKICAgIH0KICAgIGV4dHJhRmllbGRzTmFtZXMuc29ydCgpOwogICAgdmFyIGxhc3QgPSBleHRyYUZpZWxkc05hbWVzWzBdOwogICAgZm9yICh2YXIgaT0xOyBpPGV4dHJhRmllbGRzTmFtZXMubGVuZ3RoOyBpKyspCiAgICB7CiAgICAgIGlmIChleHRyYUZpZWxkc05hbWVzW2ldID09IGxhc3QpCiAgICAgIHsKICAgICAgICAvLyAgYWxlcnQoJ0R1cGxpY2F0ZSA6ICcrbGFzdCk7CiAgICAgICAgJHNjb3BlLmR1cGxpY2F0ZUZpZWxkTmFtZXM9J9en15nXmdedINep15PXlCDXqteZ16LXldeTINeo16TXldeQ15kg15vXpNeV15wg15HXqdedICInK2xhc3QrJyIuLi4nOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBsYXN0ID0gZXh0cmFGaWVsZHNOYW1lc1tpXTsKICAgIH0KICAgIC8vIGNoZWNrIGV4dHJhIGZpZWxkcyBkdXBsaWNhdGUgbmFtZXMgLSBlbmQKCiAgICBsb2dEZWJ1ZygiYWRkIEV2ZW50IFR5cGUiICsgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMgKyAiZXh0cmEgZmllbGRzPSIgKyRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzKTsKICAgIGlmICgoJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMubWF4X3JlZ2lzdHJhdGlvbnM9PScnKSB8fCAoISRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF9yZWdpc3RyYXRpb25zKSkKICAgIHsKICAgICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMubWF4X3JlZ2lzdHJhdGlvbnM9MDsKICAgIH0KICAgIGFkZEV2ZW50VHlwZSgkaHR0cCwkc2NvcGUsJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMsYWRkRXZlbnRUeXBlX3N1Y2Nlc3MpOwogICAgZnVuY3Rpb24gYWRkRXZlbnRUeXBlX3N1Y2Nlc3MoKQogICAgewogICAgICAkbG9jYXRpb24ucGF0aCgnL2V2ZW50X3R5cGVzJyk7CiAgICB9CiAgfTsKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ0V2ZW50VHlwZVVwZGF0ZUNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkY29tcGlsZSwgJHJvdXRlUGFyYW1zLCB1aUNhbGVuZGFyQ29uZmlnLCAkdWliTW9kYWwsICRsb2NhdGlvbikgewogIGV2ZW50X3R5cGVfaWQ9JHJvdXRlUGFyYW1zLmV2ZW50X3R5cGVfaWQ7CiAgbG9nRGVidWcoJ0V2ZW50VHlwZXMgQ29udHJvbGxlciBVcGRhdGUgJytldmVudF90eXBlX2lkKTsKCiAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMgPSB7fTsgLy8gdGhlc2UgYXJlIHRoZSBjb21wbGV0ZSBkZXRhaWxzIGZvciB0aGUgbmV3IGV2ZW50IC8vCiAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuaXNfdXBkYXRlID0gdHJ1ZTsKCiAgJHNjb3BlLmV2ZW50Q29sb3JTdHlsZSA9IHt9OwogIGdldEFsbEluc3RydWN0b3JzKCRodHRwLCRzY29wZSwnaW5zdHJ1Y3RvcnMnLGdldEFsbEluc3RydWN0b3JzX3N1Y2Nlc3MpOwogIGZ1bmN0aW9uIGdldEFsbEluc3RydWN0b3JzX3N1Y2Nlc3MoKQogIHsKICAgICRzY29wZS5pbnN0cnVjdG9ycy51bnNoaWZ0KHtidXNpbmVzc191c2VyX2lkOm51bGwsIGJ1c2VyX2ZpcnN0X25hbWU6IiIsIGJ1c2VyX2xhc3RfbmFtZToiIn0pOwogIH0KCiAgZ2V0QnVzaW5lc3NFdmVudFR5cGUoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5ldmVudF90eXBlX2lkLCdldmVudFR5cGVQcm9wZXJ0aWVzJyxnZXRCdXNpbmVzc0V2ZW50VHlwZV9zdWNjZXNzKTsKCiAgZnVuY3Rpb24gZ2V0QnVzaW5lc3NFdmVudFR5cGVfc3VjY2VzcygpCiAgewogICAgaWYgKCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF9yZWdpc3RyYXRpb25zPT1udWxsKQogICAgewogICAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5tYXhfcmVnaXN0cmF0aW9ucz0xOwogICAgfQogICAgaWYgKCgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5kdXJhdGlvbl9iZWZvcmVfZXZlbnQ+MCkgfCAoJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZHVyYXRpb25fYWZ0ZXJfZXZlbnQ+MCkpCiAgICB7CiAgICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmJsb2NrRXh0cmFUaW1lID0gMTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuYmxvY2tFeHRyYVRpbWUgPSAwOwogICAgfQovLyAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5pbmhlcml0X21haW5faG91cnMgPSByZXNwb25zZS5kYXRhWzBdLmluaGVyaXRfbWFpbl9ob3VyczsKICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmlzX3VwZGF0ZSA9IHRydWU7CiAgICBsb2dEZWJ1ZygiJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuY29sb3I9Iiskc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5jb2xvcik7CiAgICAkc2NvcGUuZXZlbnRDb2xvclN0eWxlWyRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmNvbG9yXSA9IHsKICAgICAgJ3RyYW5zZm9ybSc6ICdyb3RhdGUoMzBkZWcpJwogICAgfTsKICAgICRzY29wZS5jaGFuZ2VFdmVudENvbG9yKCgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5jb2xvcikuc3Vic3RyKDEpKTsKICAgIGxvZ0RlYnVnKCIkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5pbnN0cnVjdG9yX2lkPSIrJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuaW5zdHJ1Y3Rvcl9pZCk7Ci8vIHNhdmluZyBldmVudCB0eXBlIGRldGFpbHMgYXNpZGUgdG8gbGF0ZXIgY2hlY2sgaWYgYW55dGhpbmcgY2hhbmdlZAogICAgbG9nRGVidWcoImR1cGxpY2F0aW5nIG9iamVjdCBvZiBldmVudCB0eXBlIHRvIGxhdGVyIGNvbXBhcmUgIit0eXBlb2YgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMpOwogICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXNEdXBsaWNhdGUgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzKSk7CiAgICBsb2dEZWJ1ZygiJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXNEdXBsaWNhdGUgPSIrJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXNEdXBsaWNhdGUuZXZlbnRfdHlwZV9uYW1lKTsKICB9OwoKLy8gZXZlbnQgdHlwZSBjaGFuZ2VkIHBvcHVwCiAgJHNjb3BlLmV2ZW50VHlwZUNoYW5nZWRQb3B1cCA9IGZ1bmN0aW9uKGV2ZW50VHlwZVByb3BlcnRpZXMpIHsKICAgIGxvZ0RlYnVnKCJldmVudFR5cGVDaGFuZ2VkUG9wdXAiKTsKCiAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAgICAgYW5pbWF0aW9uOiBmYWxzZSwKICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfZXZlbnRfdHlwZV9jaGFuZ2VkLnBocCcsCiAgICAgIGNvbnRyb2xsZXI6ICdldmVudFR5cGVDaGFuZ2VkUG9wdXBDb250cm9sbGVyJywKICAgICAgc2l6ZTogJ2wnLAogICAgICByZXNvbHZlOiB7CiAgICAgICAgZXZlbnRUeXBlUHJvcGVydGllczogZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXM7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKCiAgICBtb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHNlbGVjdGVkSXRlbSkKICAgIHsKICAgICAgbG9nRGVidWcoc2VsZWN0ZWRJdGVtKTsKICAgICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMgPSBzZWxlY3RlZEl0ZW07CiAgICB9LCBmdW5jdGlvbigpIHsKICAgICAgbG9nRGVidWcoJ01vZGFsIGRpc21pc3NlZCBhdDogJyArIG5ldyBEYXRlKCkpOwogICAgfSk7CiAgfTsKCi8vIGV2ZW50IHR5cGUgZXh0cmEgZmllbGQgcG9wdXAKICAkc2NvcGUuZXZlbnRUeXBlRXh0cmFGaWVsZHNQb3AgPSBmdW5jdGlvbihldmVudFR5cGVQcm9wZXJ0aWVzKSB7CiAgICBsb2dEZWJ1ZygiZXZlbnRUeXBlRXh0cmFGaWVsZHNQb3AyIik7CgogICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2V2ZW50X3R5cGVfZXh0cmFfZmllbGRzLnBocCcsCiAgICAgIGNvbnRyb2xsZXI6ICdldmVudFR5cGVFeHRyYUZpZWxkc01vZGFsQ29udHJvbGxlcicsCiAgICAgIHNpemU6ICdsJywKICAgICAgcmVzb2x2ZTogewogICAgICAgIGV2ZW50VHlwZVByb3BlcnRpZXM6IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIGV2ZW50VHlwZVByb3BlcnRpZXM7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKCiAgICBtb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHNlbGVjdGVkSXRlbSkgewogICAgICBsb2dEZWJ1ZyhzZWxlY3RlZEl0ZW0pOwogICAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyA9IHNlbGVjdGVkSXRlbTsKICAgIH0sIGZ1bmN0aW9uKCkgewogICAgICBsb2dEZWJ1ZygnTW9kYWwgZGlzbWlzc2VkIGF0OiAnICsgbmV3IERhdGUoKSk7CiAgICB9KTsKICB9OwoKCiAgJHNjb3BlLmNoYW5nZUV2ZW50Q29sb3IgPSBmdW5jdGlvbihuZXdDb2xvcikgewogICAgbG9nRGVidWcoImNob29zaW5nIGNvbG9yICIgKyBuZXdDb2xvcik7CiAgICAkc2NvcGUuZXZlbnRDb2xvciA9IG5ld0NvbG9yOwogICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXZlbnRDb2xvciA9ICIjIiArIG5ld0NvbG9yOwogICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuY29sb3IgPSAiIyIgKyBuZXdDb2xvcjsKICAgICRzY29wZS5ldmVudENvbG9yU3R5bGUgPSB7CiAgICAgICdiYWNrZ3JvdW5kLWNvbG9yJzogIiMiICsgbmV3Q29sb3IKICAgIH07CiAgICAkc2NvcGUuZXZlbnRDb2xvclN0eWxlW25ld0NvbG9yXSA9IHsKICAgICAgJ3RyYW5zZm9ybSc6ICdyb3RhdGUoMzBkZWcpJwogICAgfTsKCiAgfQoKICAkc2NvcGUuYWRkRXZlbnRUeXBlQ2FuY2VsID0gZnVuY3Rpb24oKSB7CiAgICAkbG9jYXRpb24ucGF0aCgnL2V2ZW50X3R5cGVzJyk7CiAgfTsKCiAgJHNjb3BlLmFkZEV2ZW50VHlwZSA9IGZ1bmN0aW9uKCkgeyAvLyB0aGlzIGZ1bmN0aW9uIFVQREFURVMgZXZlbnQgdHlwZSAobm90IGFkZHMpCi8vIGNoZWNraW5nIGlmIGFueXRoaW5nIGNoYW5nZWQgcmVhbGx5Ci8vIGFuZCBhc2tpbmcgaWYgd2Ugc2hvdWxkIHVwZGF0ZSBhbGwgZXZlbnRzIGZyb20gbm93IChvciBvbmx5IG5ld2x5IGNyZWF0ZWQgZXZlbnRzKQovLyBjaGVja2luZwogICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXNEdXBsaWNhdGUuZXh0cmFGaWVsZHM9JHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHM7CiAgICAvLyBpZiAoYW5ndWxhci5lcXVhbHMoJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXNEdXBsaWNhdGUsJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMpKQogICAgaWYgKHRydWUpIC8vIGlnbm9yaW5nIHRyeWluZyB0byBtYWtlIGNoYW5nZXMgdG8gZXZlbnRzCiAgICB7Ci8vICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzRHVwbGljYXRlLmV4dHJhRmllbGRzID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcykpOwoKICAgICAgbG9nRGVidWcoIm5vdGhpbmcgY2hhbmdlZCBpbiBldmVudCB0eXBlLCBvciBvbmx5IGV4dHJhIGZpZWxkcyIpOwogICAgICAkc2NvcGUudXBkYXRlRXZlbnRUeXBlKCk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJldmVudCB0eXBlIGNoYW5nZWQiKTsKICAgICAgJHNjb3BlLmV2ZW50VHlwZUNoYW5nZWRQb3B1cCgpOwogICAgfQovLyAkc2NvcGUudXBkYXRlRXZlbnRUeXBlKCk7CiAgfQogICRzY29wZS51cGRhdGVFdmVudFR5cGUgPSBmdW5jdGlvbigpCiAgewogICAgLy8gY2hlY2sgZXh0cmEgZmllbGRzIGR1cGxpY2F0ZSBuYW1lcyAtIHN0YXJ0CiAgICBsb2dEZWJ1ZygiYWRkRXZlbnRUeXBlOiBjaGVjayBleHRyYSBmaWVsZHMgZHVwbGljYXRlIG5hbWVzIC0gc3RhcnQiKTsKICAgIHZhciBleHRyYUZpZWxkc05hbWVzID0gW107CiAgICBmb3IgKHZhciBpPTE7IGk8JHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMubGVuZ3RoOyBpKyspCiAgICB7CiAgICAgIGV4dHJhRmllbGRzTmFtZXMucHVzaCgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkc1tpXS5maWVsZF9uYW1lKTsKICAgIH0KICAgIGV4dHJhRmllbGRzTmFtZXMuc29ydCgpOwogICAgdmFyIGxhc3QgPSBleHRyYUZpZWxkc05hbWVzWzBdOwogICAgZm9yICh2YXIgaT0xOyBpPGV4dHJhRmllbGRzTmFtZXMubGVuZ3RoOyBpKyspCiAgICB7CiAgICAgIGlmIChleHRyYUZpZWxkc05hbWVzW2ldID09IGxhc3QpCiAgICAgIHsKICAgICAgICAvLyAgYWxlcnQoJ0R1cGxpY2F0ZSA6ICcrbGFzdCk7CiAgICAgICAgbG9nRGVidWcoJ9en15nXmdedINep15PXlCDXqteZ16LXldeTINeo16TXldeQ15kg15vXpNeV15wg15HXqdedICInK2xhc3QrJyIuLi4nKTsKICAgICAgICAkc2NvcGUuZHVwbGljYXRlRmllbGROYW1lcz0n16fXmdeZ150g16nXk9eUINeq15nXoteV15Mg16jXpNeV15DXmSDXm9ek15XXnCDXkdep150gIicrbGFzdCsnIi4uLic7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGxhc3QgPSBleHRyYUZpZWxkc05hbWVzW2ldOwogICAgfQogICAgLy8gY2hlY2sgZXh0cmEgZmllbGRzIGR1cGxpY2F0ZSBuYW1lcyAtIGVuZAoKICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLnVwZGF0ZV9leGlzdGluZ19ldmVudHM9ZmFsc2U7CgogICAgbG9nRGVidWcoInVwZGF0ZUV2ZW50VHlwZTogdXBkYXRlIEV2ZW50IFR5cGUgIiArICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV2ZW50X3R5cGVfaWQpOwogICAgaWYgKCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF9yZWdpc3RyYXRpb25zPT0nJykKICAgIHsKICAgICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMubWF4X3JlZ2lzdHJhdGlvbnM9MDsKICAgIH0KICAgIHVwZGF0ZUV2ZW50VHlwZSgkaHR0cCwkc2NvcGUsJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXZlbnRfdHlwZV9pZCwkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcyx1cGRhdGVFdmVudFR5cGVfc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiB1cGRhdGVFdmVudFR5cGVfc3VjY2VzcygpCiAgICB7CiAgICAgICRsb2NhdGlvbi5wYXRoKCcvZXZlbnRfdHlwZXMnKTsKICAgIH0KICB9Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignZXZlbnRDcmVhdGVNb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkcm9vdFNjb3BlLCBzaGFyZWRQcm9wZXJ0aWVzLCBldmVudF90eXBlX2lkLCBsb2NhdGlvbl9pZCwgZW1wX2lkLCAkaHR0cCwgc3RhcnREYXRlLCByZXNjaGVkdWxlX2V2ZW50LCB1aUNhbGVuZGFyQ29uZmlnKSB7CiAgc3RhcnREYXRlPW5ldyBtb21lbnQoc3RhcnREYXRlKTsKICBsb2dEZWJ1ZygiZXZlbnRDcmVhdGVNb2RhbENvbnRyb2xsZXIsIHN0YXJ0RGF0ZT0iK3N0YXJ0RGF0ZSsiIHR5cGUgIit0eXBlb2Ygc3RhcnREYXRlKTsKICBsb2dEZWJ1ZygiZXZlbnRDcmVhdGVNb2RhbENvbnRyb2xsZXIsIHJlc2NoZWR1bGVfZXZlbnQ9IityZXNjaGVkdWxlX2V2ZW50KTsKCiAgJHNjb3BlLmV2ZW50VHlwZVRpdGxlID0gIteR15fXqCDXodeV15Ig157XpNeS16kiOwogICRzY29wZS5zaG93RXZlbnRUeXBlU2VsZWN0ZWQgPSBmYWxzZTsKICAkc2NvcGUuc2hvd0V2ZW50Q2xpZW50U2VsZWN0ZWQgPSBmYWxzZTsKICAkc2NvcGUubmV3RXZlbnREZXRhaWxzID0ge307IC8vIHRoZXNlIGFyZSB0aGUgY29tcGxldGUgZGV0YWlscyBmb3IgdGhlIG5ldyBldmVudCAvLwogICRzY29wZS5uZXdFdmVudERldGFpbHMucmVwZWF0VHlwZSA9ICJmb3JldmVyIjsKICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnJlcGVhdEZpeGVkVGltZXMgPSAiNCI7CiAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5tYXhfcGFydGljaXBhbnRzID0gMTsKCiAgbG9nRGVidWcoIlhYWCA9ICIrSlNPTi5zdHJpbmdpZnkocmVzY2hlZHVsZV9ldmVudCkpOwoKICAkc2NvcGUucmVzY2hlZHVsZV9ldmVudD1mYWxzZTsKICAkc2NvcGUucmVzY2hlZHVsZV9ldmVudF9kZXRhaWxzPXJlc2NoZWR1bGVfZXZlbnQ7CiAgaWYgKCRzY29wZS5yZXNjaGVkdWxlX2V2ZW50X2RldGFpbHMhPW51bGwpCiAgewogICAgbG9nRGVidWcoInJlc2NoZWR1bGVfZXZlbnRfZGV0YWlscz0iKyRzY29wZS5yZXNjaGVkdWxlX2V2ZW50X2RldGFpbHMuZXZlbnRfaWQpOwogICAgbG9nRGVidWcoSlNPTi5zdHJpbmdpZnkoJHNjb3BlLnJlc2NoZWR1bGVfZXZlbnRfZGV0YWlscykpOwogICAgJHNjb3BlLnJlc2NoZWR1bGVfZXZlbnQ9dHJ1ZTsKICAgICRzY29wZS5naXZlbl9ldmVudF90eXBlX2lkID0gJHNjb3BlLnJlc2NoZWR1bGVfZXZlbnRfZGV0YWlscy5ldmVudF90eXBlX2lkOwovLyBzdGlsbCBwcmVmZXJpbmcgZW1wX2lkIGZyb20gc2NoZWR1bGVyIHN1Z2dlc3Rpb24gaXMgaXQgd2FzIHNlbGVjdGVkCiAgICBpZiAoZW1wX2lkIT0wKQogICAgewogICAgICAkc2NvcGUuZ2l2ZW5fZW1wX2lkID0gZW1wX2lkOwogICAgfQogICAgZWxzZQogICAgewogICAgICAkc2NvcGUuZ2l2ZW5fZW1wX2lkID0gJHNjb3BlLnJlc2NoZWR1bGVfZXZlbnRfZGV0YWlscy5pbnN0cnVjdG9yX2lkOwogICAgfQovLyBzdGlsbCBwcmVmZXJpbmcgbG9jYXRpb25faWQgZnJvbSBzY2hlZHVsZXIgc3VnZ2VzdGlvbiBvdmVyIHRoZSBvcmlnaW5hbCBsb2NhdGlvbiBmcm9tIGV2ZW50CiAgICBpZiAobG9jYXRpb25faWQhPTApCiAgICB7CiAgICAgICRzY29wZS5naXZlbl9sb2NhdGlvbl9pZCA9IGxvY2F0aW9uX2lkOwogICAgfQogICAgZWxzZQogICAgewogICAgICAkc2NvcGUuZ2l2ZW5fbG9jYXRpb25faWQgPSAkc2NvcGUucmVzY2hlZHVsZV9ldmVudF9kZXRhaWxzLmxvY2F0aW9uX2lkOwogICAgfQogIH0KICBlbHNlCiAgewogICAgJHNjb3BlLmdpdmVuX2V2ZW50X3R5cGVfaWQgPSBldmVudF90eXBlX2lkOwogICAgJHNjb3BlLmdpdmVuX2xvY2F0aW9uX2lkID0gbG9jYXRpb25faWQ7CiAgICAkc2NvcGUuZ2l2ZW5fZW1wX2lkID0gZW1wX2lkOwogIH0KICBpZiAoJHNjb3BlLmdpdmVuX2V2ZW50X3R5cGVfaWQ+MCkKICB7CiAgICAkc2NvcGUucHJldmlvdXNseV9zZWxlY3RlZF9ldmVudF90eXBlPXRydWU7CiAgfQogIGVsc2UKICB7CiAgICAkc2NvcGUucHJldmlvdXNseV9zZWxlY3RlZF9ldmVudF90eXBlPWZhbHNlOwogIH0KICBsb2dEZWJ1ZygiJHNjb3BlLmdpdmVuX2V2ZW50X3R5cGVfaWQ9Iiskc2NvcGUuZ2l2ZW5fZXZlbnRfdHlwZV9pZCk7CgogIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc3RhcnREYXRlKTsKICBsb2dEZWJ1Zygic2VsZWN0ZWREYXRlU3RhcnQgPSAiK3NlbGVjdGVkRGF0ZVN0YXJ0KTsKICB2YXIgc2VsZWN0ZWREYXRlU3RhcnQgPSBuZXcgRGF0ZShzZWxlY3RlZERhdGVTdGFydC5nZXRUaW1lKCkgKyBzZWxlY3RlZERhdGVTdGFydC5nZXRUaW1lem9uZU9mZnNldCgpICogNjAwMDApOwoKLy8gbG9nRGVidWcoImRhdGU9IiArIHNlbGVjdGVkRGF0ZVN0YXJ0KTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudCA9IFtdOwogICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRIb3VycygpOwogICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcyA9IChzZWxlY3RlZERhdGVTdGFydC5nZXRNaW51dGVzKCkgPCAxMCA/ICcwJyA6ICcnKSArIHNlbGVjdGVkRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRvdyA9IGRheU5hbWVzW3NlbGVjdGVkRGF0ZVN0YXJ0LmdldERheSgpXTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRhdGUgPSBzZWxlY3RlZERhdGVTdGFydDsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoID0gbW9udGhOYW1lc1tzZWxlY3RlZERhdGVTdGFydC5nZXRNb250aCgpXTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoMTEyID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TW9udGgoKSsxOwogICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aCA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldERhdGUoKTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXIgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRGdWxsWWVhcigpOwogICRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZV9pbnB1dF9mb3JtYXQ9IG5ldyBEYXRlKDE5NzAsIDAsIDEsICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMsICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcywgMCk7CgogICRzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZCA9ICRzY29wZS5naXZlbl9lbXBfaWQ7CiAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5sb2NhdGlvbl9pZCA9ICRzY29wZS5naXZlbl9sb2NhdGlvbl9pZDsKCiAgZ2V0QnVzaW5lc3NMb2NhdGlvbnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19sb2NhdGlvbnMnLGdldEJ1c2luZXNzTG9jYXRpb25zX2ZpbmlzaCk7CiAgZnVuY3Rpb24gZ2V0QnVzaW5lc3NMb2NhdGlvbnNfZmluaXNoKCkKICB7CiAgICBpZiAoJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5sb2NhdGlvbl9pZD09MCkKICAgIHsKICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5sb2NhdGlvbl9pZD0kc2NvcGUuYnVzaW5lc3NfbG9jYXRpb25zWzBdLmxvY2F0aW9uX2lkOwogICAgfQogIH0KCiAgY29uc29sZS5sb2coIiRzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZD0iKyRzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZCk7Ci8vIGlmIGNsaWVudCB3YXMgcHJldmlvdXNseSBzZWxlY3RlZAogICRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyPWZhbHNlOwogIGxvZ0RlYnVnKCJzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyPSIrc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcik7CiAgaWYgKHNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKSE9bnVsbCkKICB7Ci8vIGNvbnNvbGUubG9nKCJnb3QgcHJldmlvdXMgc2VsZWN0ZWQgdXNlciAiK3NoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKS5idXNlcl9maXJzdF9uYW1lKTsKICAgICRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VybmFtZT1zaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfZmlyc3RfbmFtZSsiICIrc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2VyX2xhc3RfbmFtZTsKICAgICRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyPXRydWU7CgogICAgJHNjb3BlLnNob3dFdmVudENsaWVudFNlbGVjdGVkID0gdHJ1ZTsKICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kdXNlcl9pZCA9IHNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKS5idXNpbmVzc191c2VyX2lkOwogICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmR1c2VyX2ZpcnN0X25hbWUgPSBzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfZmlyc3RfbmFtZTsKICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kdXNlcl9sYXN0X25hbWUgPSBzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfbGFzdF9uYW1lOwogICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5idXNpbmVzc191c2VyX2lkID0gc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2luZXNzX3VzZXJfaWQ7CgogIH0KICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWUgPSBzdGFydERhdGU7CiAgbG9nRGVidWcoIiRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZTE9Iiskc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWUpOwogICRzY29wZS5zdGFydE1pbnV0ZXMgPSBmdW5jdGlvbigpCiAgewogICAgbG9nRGVidWcoInN0YXJ0TWludXRlcyAiKygkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpKTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcz1taW51dGVzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpOwogICAgY2FsY3VsYXRlU3RhcnRUaW1lKCk7CiAgICBjYWxjdWxhdGVFbmRUaW1lRHluYW1pYygpOwogIH0KICAkc2NvcGUuc3RhcnRIb3VycyA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1Zygic3RhcnRIb3VycyAiK2hvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKSk7CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzPWhvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKTsKICAgIGNhbGN1bGF0ZVN0YXJ0VGltZSgpOwogICAgY2FsY3VsYXRlRW5kVGltZUR5bmFtaWMoKTsKICB9CgogICRzY29wZS5lbmRNaW51dGVzID0gZnVuY3Rpb24oKQogIHsKICAgIGxvZ0RlYnVnKCJlbmRNaW51dGVzICIrKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpKTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXM9bWludXRlc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcyk7CiAgICBjYWxjdWxhdGVTdGFydFRpbWUoKTsKICAgIGNhbGN1bGF0ZUVuZFRpbWVEeW5hbWljKCk7CiAgfQogICRzY29wZS5lbmRIb3VycyA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1ZygiZW5kSG91cnMgIitob3Vyc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMpKTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzPWhvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vycyk7CiAgICBjYWxjdWxhdGVTdGFydFRpbWUoKTsKICAgIGNhbGN1bGF0ZUVuZFRpbWVEeW5hbWljKCk7CiAgfQoKICBmdW5jdGlvbiBjYWxjdWxhdGVTdGFydFRpbWUoKQogIHsKICAgIGV2ZW50WWVhcj0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXI7CiAgICBldmVudE1vbnRoPSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bW9udGgxMTI7CiAgICBldmVudERheT0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRheW9mbW9udGg7CiAgICBpZiAocGFyc2VJbnQoZXZlbnRNb250aCk8MTApCiAgICB7CiAgICAgIGV2ZW50TW9udGg9IjAiK2V2ZW50TW9udGg7CiAgICB9CiAgICBpZiAocGFyc2VJbnQoZXZlbnREYXkpPDEwKQogICAgewogICAgICBldmVudERheT0iMCIrZXZlbnREYXk7CiAgICB9CiAgICBsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyPSIrZXZlbnRZZWFyKTsKICAgIGxvZ0RlYnVnKCIkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRheW9mbW9udGg9IitldmVudE1vbnRoKTsKICAgIGxvZ0RlYnVnKCIkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoPSIrZXZlbnREYXkpOwogICAgbmV3X3N0YXJ0PW1vbWVudC51dGMoZXZlbnRZZWFyKyItIitldmVudE1vbnRoKyItIitldmVudERheSsiVDAwOjAwOjAwIikuYWRkKCgocGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykqNjApK3BhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcykpLCAnbWludXRlcycpOwogICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5zdGFydF90aW1lPW5ld19zdGFydDsKICAgIGxvZ0RlYnVnKCJuZXdfc3RhcnQ9IituZXdfc3RhcnQpOwogIH0KICBmdW5jdGlvbiBtaW51dGVzQ2hhbmdlZCh0aGVtaW51dGVzKQogIHsKICAgIGxvZ0RlYnVnKCJ0aGVtaW51dGVzPSIrdGhlbWludXRlcyk7CiAgICBpZiAodHlwZW9mIHRoZW1pbnV0ZXM9PSJ1bmRlZmluZWQiKQogICAgewogICAgICByZXR1cm4gIjAwIjsKICAgIH0KICAgIGlmIChpc05hTih0aGVtaW51dGVzKSkKICAgIHsKICAgICAgcmV0dXJuICIwMCI7CiAgICB9CiAgICBpZiAodGhlbWludXRlcz09JycpCiAgICB7CiAgICAgIHJldHVybiAiMDAiOwogICAgfQogICAgdGhlbWludXRlcz1wYXJzZUludCh0aGVtaW51dGVzKTsKICAgIGlmICh0aGVtaW51dGVzPjYwKQogICAgewogICAgICByZXR1cm4gIjAwIjsKICAgIH0KICAgIGVsc2UgaWYgKHRoZW1pbnV0ZXM8MCkKICAgIHsKICAgICAgcmV0dXJuICIwMCI7CiAgICB9CiAgICBlbHNlIGlmICh0aGVtaW51dGVzPT0iIikKICAgIHsKICAgICAgcmV0dXJuICIwMCI7CiAgICB9CiAgICBlbHNlIGlmICh0aGVtaW51dGVzPDEwKQogICAgewogICAgICByZXR1cm4gIjAiK3RoZW1pbnV0ZXM7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgIHJldHVybiB0aGVtaW51dGVzOwogICAgfQogIH0KICBmdW5jdGlvbiBob3Vyc0NoYW5nZWQodGhlaG91cnMpCiAgewogICAgbG9nRGVidWcoInRoZWhvdXJzPSIrdGhlaG91cnMpOwogICAgaWYgKHR5cGVvZiB0aGVob3Vycz09InVuZGVmaW5lZCIpCiAgICB7CiAgICAgIHJldHVybiAiMCI7CiAgICB9CiAgICBpZiAoaXNOYU4odGhlaG91cnMpKQogICAgewogICAgICByZXR1cm4gIjAiOwogICAgfQogICAgaWYgKHRoZWhvdXJzPT0nJykKICAgIHsKICAgICAgcmV0dXJuICIwIjsKICAgIH0KICAgIHRoZWhvdXJzPXBhcnNlSW50KHRoZWhvdXJzKTsKICAgIGlmICh0aGVob3Vycz4yNCkKICAgIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CiAgICBlbHNlIGlmICh0aGVob3VyczwwKQogICAgewogICAgICByZXR1cm4gMDsKICAgIH0KICAgIGVsc2UgaWYgKHRoZWhvdXJzPT0iIikKICAgIHsKICAgICAgcmV0dXJuICIwIjsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgcmV0dXJuIHRoZWhvdXJzOwogICAgfQogIH0KICBnZXRBbGxJbnN0cnVjdG9ycygkaHR0cCwkc2NvcGUsJ2luc3RydWN0b3JzJyxnZXRBbGxJbnN0cnVjdG9yc19zdWNjZXNzKTsKICBmdW5jdGlvbiBnZXRBbGxJbnN0cnVjdG9yc19zdWNjZXNzKCkKICB7Ci8vICRzY29wZS5pbnN0cnVjdG9ycy51bnNoaWZ0KHtidXNpbmVzc191c2VyX2lkOm51bGwsIGJ1c2VyX2ZpcnN0X25hbWU6IiIsIGJ1c2VyX2xhc3RfbmFtZToiIn0pOwogICAgaWYgKCEkc2NvcGUubmV3RXZlbnREZXRhaWxzLmluc3RydWN0b3JfaWQ+MCkKICAgIHsKICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pbnN0cnVjdG9yX2lkPSRzY29wZS5pbnN0cnVjdG9yc1swXS5idXNpbmVzc191c2VyX2lkOwogICAgfQogIH0KCiAgJHNjb3BlLnNlbGVjdEV2ZW50VHlwZSA9IGZ1bmN0aW9uKCkgewovLyByZW1vdmluZyBldmVudCB0eXBlINeR15fXqCDXodeV15Ig157XpNeS16kKICAgIGlmICgkc2NvcGUuZXZlbnRUeXBlT3B0aW9uc1swXS5ldmVudF90eXBlX2lkPT0wKQogICAgewogICAgICAkc2NvcGUuZXZlbnRUeXBlT3B0aW9ucy5zcGxpY2UoMCwgMSk7CiAgICB9CiAgICAkc2NvcGUuYWpheF9lcnJvcj0nJzsKICAgIGNob2ljZT0kc2NvcGUuc2VsZWN0RXZlbnRUeXBlU2VsZWN0ZWQ7CiAgICBsb2dEZWJ1Zygic2VsZWN0RXZlbnRUeXBlIik7CiAgICBsb2dEZWJ1ZyhKU09OLnN0cmluZ2lmeSgkc2NvcGUuc2VsZWN0RXZlbnRUeXBlU2VsZWN0ZWQpKTsKICAgICRzY29wZS5ldmVudFR5cGVUaXRsZSA9IGNob2ljZS5ldmVudF90eXBlX25hbWU7CiAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmV2ZW50X3R5cGVfaWQgPSBjaG9pY2UuZXZlbnRfdHlwZV9pZDsKCiAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmV2ZW50X25hbWUgPSBjaG9pY2UuZXZlbnRfdHlwZV9uYW1lOwogICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5vcmlnaW5hbF9ldmVudF9uYW1lID0gY2hvaWNlLmV2ZW50X3R5cGVfbmFtZTsKICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuZXZlbnRfZGVzY3JpcHRpb24gPSBjaG9pY2UuZXZlbnRfdHlwZV9kZXNjcmlwdGlvbjsKICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuaXNfY2xhc3MgPSBjaG9pY2UuaXNfY2xhc3M7CiAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLm9yaWdpbmFsX3ByaWNlID0gY2hvaWNlLm9yaWdpbmFsX3ByaWNlOwogICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pc19nZW5lcmljX2V0eXBlID0gY2hvaWNlLmlzX2dlbmVyaWNfZXR5cGU7Ci8vICRzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZCA9IGNob2ljZS5pbnN0cnVjdG9yX2lkOwogICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5kdXJhdGlvbl9ldmVudCA9IGNob2ljZS5kdXJhdGlvbl9ldmVudDsKLy8gbG9nRGVidWcoInNjb3BlLm5ld0V2ZW50RGV0YWlscy5pc19jbGFzcz0iKyRzY29wZS5uZXdFdmVudERldGFpbHMuaXNfY2xhc3MpOwovLyBsb2dEZWJ1Zygic2NvcGUubmV3RXZlbnREZXRhaWxzLmluc3RydWN0b3JfaWQ9Iiskc2NvcGUubmV3RXZlbnREZXRhaWxzLmluc3RydWN0b3JfaWQpOwovLyBsb2dEZWJ1Zygic3RhcnREYXRlPSIrc3RhcnREYXRlKTsKLy8gJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5zdGFydF90aW1lID0gc3RhcnREYXRlOwogICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5ldmVudHR5cGUgPSBjaG9pY2U7CiAgICBjYWxjdWxhdGVFbmRUaW1lKCk7CgovLyAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWVfaW5wdXRfZm9ybWF0PSBuZXcgRGF0ZSgxOTcwLCAwLCAxLCAxNCwgNTcsIDApOwoKICAgIGxvZ0RlYnVnKCJuZXdFdmVudCBzdGFydD0iICsgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5zdGFydF90aW1lKTsKICAgIGxvZ0RlYnVnKCJuZXdFdmVudCBlbmQ9IiArICRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kX3RpbWUpOwoKICAgICRzY29wZS5zaG93RXZlbnRUeXBlU2VsZWN0ZWQgPSB0cnVlOwogIH0KCi8vIHRoaXMgZnVuY3Rpb24gY2FsY3VsYXRlcyBlbmQgdGltZSBhY2NvcmRpbmcgdG8gdGhlIGxlbmd0aCBvZiB0aGUgZXZlbnR0eXBlCiAgZnVuY3Rpb24gY2FsY3VsYXRlRW5kVGltZSgpCiAgewogICAgY29uc29sZS5sb2coIiRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZT0iKyRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZSk7CiAgICBlbmQgPSBtb21lbnQoJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5zdGFydF90aW1lKS5hZGQoJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5kdXJhdGlvbl9ldmVudCwgJ21pbnV0ZXMnKTsKICAgIHNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKGVuZCk7CiAgICBzZWxlY3RlZERhdGVFbmQgPSBuZXcgRGF0ZShzZWxlY3RlZERhdGVFbmQuZ2V0VGltZSgpICsgc2VsZWN0ZWREYXRlRW5kLmdldFRpbWV6b25lT2Zmc2V0KCkgKiA2MDAwMCk7CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycyA9IHNlbGVjdGVkRGF0ZUVuZC5nZXRIb3VycygpOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kZG93ID0gZGF5TmFtZXNbc2VsZWN0ZWREYXRlRW5kLmdldERheSgpXTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKSA8IDEwID8gJzAnIDogJycpICsgc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKTsKICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kX3RpbWUgPSBlbmQ7Ci8vIGNhbGN1bGF0aW5nIGR1cmF0aW9uCiAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50PXBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpLXBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcyk7CiAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50PSRzY29wZS5uZXdFdmVudERldGFpbHMuZHVyYXRpb25fZXZlbnQrKHBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzKS1wYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKSkqNjA7CiAgICBpZiAoJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5kdXJhdGlvbl9ldmVudDwwKQogICAgewogICAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50PTA7CiAgICB9CiAgfQoKLy8gdGhpcyBmdW5jdGlvbiBjYWxjdWxhdGVzIGVuZCB0aW1lIGFjY29yZGluZyB0byB0aGUgaW5wdXQgZnJvbSBtb2RhbCB3aW5kb3cKLy8gYW5kIG5vdCBhY2NvcmRpbmcgdG8gZXZlbnQgdHlwZSBsZW5ndGgKICBmdW5jdGlvbiBjYWxjdWxhdGVFbmRUaW1lRHluYW1pYygpCiAgewogICAgZXZlbnRZZWFyPSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0eWVhcjsKICAgIGV2ZW50TW9udGg9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aDExMjsKICAgIGV2ZW50RGF5PSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aDsKICAgIGlmIChwYXJzZUludChldmVudE1vbnRoKTwxMCkKICAgIHsKICAgICAgZXZlbnRNb250aD0iMCIrZXZlbnRNb250aDsKICAgIH0KICAgIGlmIChwYXJzZUludChldmVudERheSk8MTApCiAgICB7CiAgICAgIGV2ZW50RGF5PSIwIitldmVudERheTsKICAgIH0KICAgIGxvZ0RlYnVnKCIkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXI9IitldmVudFllYXIpOwogICAgbG9nRGVidWcoIiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aD0iK2V2ZW50TW9udGgpOwogICAgbG9nRGVidWcoIiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bW9udGg9IitldmVudERheSk7CiAgICBuZXdfZW5kPW1vbWVudC51dGMoZXZlbnRZZWFyKyItIitldmVudE1vbnRoKyItIitldmVudERheSsiVDAwOjAwOjAwIikuYWRkKCgocGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMpKjYwKStwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzKSksICdtaW51dGVzJyk7CiAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZF90aW1lPW5ld19lbmQ7CiAgICBsb2dEZWJ1ZygibmV3X2VuZD0iK25ld19lbmQpOwovLyBjYWxjdWxhdGluZyBkdXJhdGlvbgogICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5kdXJhdGlvbl9ldmVudD1wYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzKS1wYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpOwogICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5kdXJhdGlvbl9ldmVudD0kc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50KyhwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycyktcGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykpKjYwOwogICAgaWYgKCRzY29wZS5uZXdFdmVudERldGFpbHMuZHVyYXRpb25fZXZlbnQ8MCkKICAgIHsKICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5kdXJhdGlvbl9ldmVudD0wOwogICAgfQogIH0KICBnZXRBbGxCdXNpbmVzc0V2ZW50VHlwZXMoJGh0dHAsJHNjb3BlLCdldmVudFR5cGVPcHRpb25zJyxnZXRBbGxCdXNpbmVzc0V2ZW50VHlwZXNfc3VjY2Vzcyk7CiAgZnVuY3Rpb24gZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzX3N1Y2Nlc3MoKQogIHsKLy8gYWZ0ZXIgbG9hZGluZyBldmVudCB0eXBlcywgaWYgdGhlIGdpdmVuIGV2ZW50IHR5cGUgaXMgIT0gMCB3ZSAic2VsZWN0IiBpdAogICAgY29uc29sZS5sb2coImdldEFsbEJ1c2luZXNzRXZlbnRUeXBlc19zdWNjZXNzIik7CiAgICBpZiAoJHNjb3BlLmdpdmVuX2V2ZW50X3R5cGVfaWQ+MCkKICAgIHsKICAgICAgZm9yKHZhciBpID0gMDsgaSA8ICRzY29wZS5ldmVudFR5cGVPcHRpb25zLmxlbmd0aDsgaSsrKQogICAgICB7CiAgICAgICAgaWYgKCRzY29wZS5ldmVudFR5cGVPcHRpb25zW2ldLmV2ZW50X3R5cGVfaWQ9PSRzY29wZS5naXZlbl9ldmVudF90eXBlX2lkKQogICAgICAgIHsKICAgICAgICAgIGNvbnNvbGUubG9nKCJnaXZlbl9ldmVudF90eXBlX2lkIGZvdW5kIik7Ci8vICRzY29wZS5jYWxjdWxhdGVTdGFydFRpbWUoKTsKICAgICAgICAgICRzY29wZS5zZWxlY3RFdmVudFR5cGVTZWxlY3RlZD0kc2NvcGUuZXZlbnRUeXBlT3B0aW9uc1tpXTsKLy8gJHNjb3BlLnNlbGVjdEV2ZW50VHlwZSgkc2NvcGUuZXZlbnRUeXBlT3B0aW9uc1tpXSk7CiAgICAgICAgICAkc2NvcGUuc2VsZWN0RXZlbnRUeXBlKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBlbHNlIHsKICAgICAgJHNjb3BlLmV2ZW50VHlwZU9wdGlvbnMudW5zaGlmdCh7ImV2ZW50X3R5cGVfaWQiOjAsICJldmVudF90eXBlX25hbWUiOiLXkdeX16gg16HXldeSINee16TXktepIiwgaXNfdmFjYXRpb246IDB9KTsKICAgICAgJHNjb3BlLnNlbGVjdEV2ZW50VHlwZVNlbGVjdGVkPSRzY29wZS5ldmVudFR5cGVPcHRpb25zWzBdOwogICAgfQogIH0KICBnZXRBbGxDbGllbnRzKCRodHRwLCRzY29wZSwnZXZlbnRUeXBlVXNlcnMnKTsKCiAgJHNjb3BlLmV2ZW50Q2xpZW50U2VsZWN0ZWQgPSBmdW5jdGlvbihzZWxlY3RlZCkgewogICAgaWYgKHNlbGVjdGVkKSB7Ci8vIGFsZXJ0KEpTT04uc3RyaW5naWZ5KCBzZWxlY3RlZCwgbnVsbCwgMiApKTsKICAgICAgbG9nRGVidWcoJ2NsaWVudCBzZWxlY3RlZCAnICsgc2VsZWN0ZWQub3JpZ2luYWxPYmplY3QuYnVzZXJfZmlyc3RfbmFtZSk7CiAgICAgICRzY29wZS5zaG93RXZlbnRDbGllbnRTZWxlY3RlZCA9IHRydWU7CiAgICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kdXNlcl9pZCA9IHNlbGVjdGVkLm9yaWdpbmFsT2JqZWN0LmJ1c2luZXNzX3VzZXJfaWQ7CiAgICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kdXNlcl9maXJzdF9uYW1lID0gc2VsZWN0ZWQub3JpZ2luYWxPYmplY3QuYnVzZXJfZmlyc3RfbmFtZTsKICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmR1c2VyX2xhc3RfbmFtZSA9IHNlbGVjdGVkLm9yaWdpbmFsT2JqZWN0LmJ1c2VyX2xhc3RfbmFtZTsKICAgIH0gZWxzZSB7CiAgICAgIGxvZ0RlYnVnKCdub3Qgc2VsZWN0ZWQnKTsKLy8gJHNjb3BlLmV2ZW50Q2xpZW50RGVTZWxlY3RlZCgpOwogICAgfQogIH07CiAgJHNjb3BlLmV2ZW50Q2xpZW50RGVTZWxlY3RlZCA9IGZ1bmN0aW9uKCkgewogICAgJHNjb3BlLnNob3dFdmVudENsaWVudFNlbGVjdGVkID0gZmFsc2U7CiAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZHVzZXJfaWQgPSBudWxsOwogICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmR1c2VyX2ZpcnN0X25hbWUgPSBudWxsOwogICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmR1c2VyX2xhc3RfbmFtZSA9IG51bGw7CiAgICAkc2NvcGUuY2xlYXJDbGllbnRJbnB1dCgnY2xpZW50X2FuZ3Vjb21wbGV0ZScpOwogIH0KCiAgJHNjb3BlLmNsZWFyQ2xpZW50SW5wdXQgPSBmdW5jdGlvbihpZCkgewogICAgaWYgKGlkKSB7CiAgICAgICRzY29wZS4kYnJvYWRjYXN0KCdhbmd1Y29tcGxldGUtYWx0OmNsZWFySW5wdXQnLCBpZCk7CiAgICB9Ci8vIGVsc2V7Ci8vICAgJHNjb3BlLiRicm9hZGNhc3QoJ2FuZ3Vjb21wbGV0ZS1hbHQ6Y2xlYXJJbnB1dCcpOwovLyB9CiAgfQoKICAkc2NvcGUuY2FuY2VsID0gZnVuY3Rpb24oKSB7CiAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgfTsKCiAgJHNjb3BlLnVwZGF0ZUV2ZW50TmFtZUNoZWNrID0gZnVuY3Rpb24obmV3VmFsdWUpCiAgewogICAgbG9nRGVidWcoInVwZGF0ZUV2ZW50TmFtZT0iK25ld1ZhbHVlKTsKICAgIGlmIChuZXdWYWx1ZT09IiIpCiAgICB7CiAgICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuZXZlbnRfbmFtZSA9ICRzY29wZS5uZXdFdmVudERldGFpbHMub3JpZ2luYWxfZXZlbnRfbmFtZTsKICAgIH0KICB9Ci8vIHJlc2NoZWR1bGVFdmVudAogICRzY29wZS5yZXNjaGVkdWxlRXZlbnQgPSBmdW5jdGlvbigpIHsKICAgIGxvZ0RlYnVnKCJmdW5jdGlvbjogcmVzY2hlZHVsZUV2ZW50Iik7CgovLyBuZXdFdmVudEpTT05EZXRhaWxzID0gSlNPTi5zdHJpbmdpZnkoJHNjb3BlLm5ld0V2ZW50RGV0YWlscywgbnVsbCwgNCk7IC8vIChPcHRpb25hbCkgYmVhdXRpZnVsIGluZGVudGVkIG91dHB1dC4KICAgIGxvZ0RlYnVnKCJyZXNjaGVkdWxlRXZlbnQsICIgKyBKU09OLnN0cmluZ2lmeSgkc2NvcGUubmV3RXZlbnREZXRhaWxzLCBudWxsLCA0KSk7Ci8vIGlmICgkc2NvcGUubmV3RXZlbnREZXRhaWxzLmV2ZW50UmVjdXJyaW5nKSB7Ci8vICAgY3JlYXRlUmVjdXJyaW5nRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5uZXdFdmVudERldGFpbHMsY3JlYXRlUmVjdXJyaW5nRXZlbnRfc3VjY2Vzcyk7Ci8vICAgZnVuY3Rpb24gY3JlYXRlUmVjdXJyaW5nRXZlbnRfc3VjY2VzcygpCi8vICAgewovLyAgICAgY2FsZW5kYXIgPSAiY2FsZW5kYXJfYnVzaW5lc3MiOwovLyAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwovLyAgICAgJHVpYk1vZGFsSW5zdGFuY2UuZGlzbWlzcygpOwovLyAgICAgLy8gZXJyb3Igd2FzCi8vICAgICAvLyBsb2dEZWJ1ZygiZXJyb3IgIiArIGRhdGEuTWVzc2FnZSk7Ci8vICAgICAvLyAkc2NvcGUuYWpheF9lcnJvciA9IGRhdGEuTWVzc2FnZTsKLy8gICB9Ci8vIH0KLy8gZWxzZQogICAgewovLyBpZiBldmVudCBpcyBub3QgY2xhc3MsIGEgY2xpZW50IG11c3QgYmUgc2VsZWN0ZWQKLy8gaWYgKCghJHNjb3BlLnNob3dFdmVudENsaWVudFNlbGVjdGVkKSAmJiAoISRzY29wZS5uZXdFdmVudERldGFpbHMuaXNfY2xhc3MpKQovLyB7Ci8vICAgLy8gYWxlcnQoJ2NsaWVudCBtdXN0IGJlIHNlbGVjdGVkJyk7Ci8vICAgJHNjb3BlLmFqYXhfZXJyb3I9IteQ16DXkCDXlNeV16HXoyDXntep16rXqtejINec157XpNeS16kiOwovLyAgIHJldHVybjsKLy8gfQogICAgICByZXNjaGVkdWxlRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5yZXNjaGVkdWxlX2V2ZW50X2RldGFpbHMuZXZlbnRfaWQsJHNjb3BlLm5ld0V2ZW50RGV0YWlscyxyZXNjaGVkdWxlRXZlbnRfc3VjY2Vzcyk7CiAgICAgIGZ1bmN0aW9uIHJlc2NoZWR1bGVFdmVudF9zdWNjZXNzKCkKICAgICAgewogICAgICAgIGNhbGVuZGFyID0gImNhbGVuZGFyX2J1c2luZXNzIjsKICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZWZldGNoRXZlbnRzJyk7CiAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjYWxlbmRhckV2ZW50UmVzY2hlZHVsZURlc2VsZWN0Jyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCiAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuZGlzbWlzcygnYWRkZWQnKTsKICAgICAgfQovLyBvbiBmYWlsdXJlIHdhcwovLyAkc2NvcGUuYWpheF9lcnJvciA9IGRhdGEuTWVzc2FnZTsKICAgIH0KICB9OwoKICAkc2NvcGUuY3JlYXRlTmV3RXZlbnQgPSBmdW5jdGlvbigpIHsKICAgIGxvZ0RlYnVnKCJjcmVhdGVOZXdFdmVudCBzdGFydF90aW1lPSIrIHR5cGVvZiAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWUpOwoKICAgIG5ld0V2ZW50SlNPTkRldGFpbHMgPSBKU09OLnN0cmluZ2lmeSgkc2NvcGUubmV3RXZlbnREZXRhaWxzLCBudWxsLCA0KTsgLy8gKE9wdGlvbmFsKSBiZWF1dGlmdWwgaW5kZW50ZWQgb3V0cHV0LgogICAgbG9nRGVidWcoImNyZWF0ZU5ld0V2ZW50LCAiICsgbmV3RXZlbnRKU09ORGV0YWlscyk7CiAgICBpZiAoJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5ldmVudFJlY3VycmluZykgewogICAgICBjcmVhdGVSZWN1cnJpbmdFdmVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLm5ld0V2ZW50RGV0YWlscyxjcmVhdGVSZWN1cnJpbmdFdmVudF9zdWNjZXNzKTsKICAgICAgZnVuY3Rpb24gY3JlYXRlUmVjdXJyaW5nRXZlbnRfc3VjY2VzcygpCiAgICAgIHsKICAgICAgICBjYWxlbmRhciA9ICJjYWxlbmRhcl9idXNpbmVzcyI7CiAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwogICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoKTsKLy8gZXJyb3Igd2FzCi8vIGxvZ0RlYnVnKCJlcnJvciAiICsgZGF0YS5NZXNzYWdlKTsKLy8gJHNjb3BlLmFqYXhfZXJyb3IgPSBkYXRhLk1lc3NhZ2U7CiAgICAgIH0KICAgIH0KICAgIGVsc2UKICAgIHsKLy8gY2hlY2tpbmcgZXZlbnQgdGltZSBsb2dpYwogICAgICBpZiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3Vycz4kc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycykKICAgICAgewogICAgICAgICRzY29wZS5hamF4X2Vycm9yPSLXltee158g15TXlNeq15fXnNeUINep15wg15TXntek15LXqSDXkNeX16jXmSDXltee158g15TXodeZ15XXnSDXqdec15UiOwogICAgICAgIHJldHVybjsKICAgICAgfQovLyBjaGVja2luZyBldmVudCB0aW1lIGxvZ2ljCiAgICAgIGlmIChwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKT09cGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMpKQogICAgICB7CiAgICAgICAgaWYgKHBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcyk+PXBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpKQogICAgICAgIHsKICAgICAgICAgICRzY29wZS5hamF4X2Vycm9yPSLXltee158g15TXlNeq15fXnNeUINep15wg15TXntek15LXqSDXkNeX16jXmSDXltee158g15TXodeZ15XXnSDXqdec15UiOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzPSIrJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKTsKICAgICAgICBsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcz0iKyRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpOwogICAgICAgIGlmICgocGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKSs1KT49cGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcykpCiAgICAgICAgewogICAgICAgICAgJHNjb3BlLmFqYXhfZXJyb3I9IteQ15XXqNeaINeU157XpNeS16kg15fXmdeZ15Eg15zXlNeZ15XXqiDXnNek15fXldeqIDUg15PXp9eV16oiOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgfQovLyBpZiBldmVudCBpcyBub3QgY2xhc3MsIGEgY2xpZW50IG11c3QgYmUgc2VsZWN0ZWQKICAgICAgaWYgKCghJHNjb3BlLnNob3dFdmVudENsaWVudFNlbGVjdGVkKSAmJiAoISRzY29wZS5uZXdFdmVudERldGFpbHMuaXNfY2xhc3MpICYmICgkc2NvcGUubmV3RXZlbnREZXRhaWxzLmlzX2dlbmVyaWNfZXR5cGU9PTApKQogICAgICB7Ci8vIGFsZXJ0KCdjbGllbnQgbXVzdCBiZSBzZWxlY3RlZCcpOwogICAgICAgICRzY29wZS5hamF4X2Vycm9yPSLXkNeg15Ag15TXldeh16Mg157Xqdeq16rXoyDXnNee16TXktepIjsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKCRzY29wZS5zZWxlY3RFdmVudFR5cGVTZWxlY3RlZC5ldmVudF90eXBlX2lkPT0wKQogICAgICB7Ci8vIGFsZXJ0KCdjbGllbnQgbXVzdCBiZSBzZWxlY3RlZCcpOwogICAgICAgICRzY29wZS5hamF4X2Vycm9yPSLXkNeg15Ag15HXl9eoINeh15XXkiDXntek15LXqSAiOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBjcmVhdGVFdmVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLm5ld0V2ZW50RGV0YWlscyxjcmVhdGVFdmVudF9zdWNjZXNzKTsKICAgICAgZnVuY3Rpb24gY3JlYXRlRXZlbnRfc3VjY2VzcygpCiAgICAgIHsKICAgICAgICBjYWxlbmRhciA9ICJjYWxlbmRhcl9idXNpbmVzcyI7CiAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwogICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoJ2FkZGVkJyk7CiAgICAgIH0KLy8gb24gZmFpbHVyZSB3YXMKLy8gJHNjb3BlLmFqYXhfZXJyb3IgPSBkYXRhLk1lc3NhZ2U7CiAgICB9CiAgfQp9KTsKLy8vLyBmZmZmZmZmCmt1emVBcHAuY29udHJvbGxlcignQnVzaW5lc3NDYWxlbmRhckNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCBzaGFyZWRQcm9wZXJ0aWVzLCAkY29tcGlsZSwgJGxvY2F0aW9uLCB1aUNhbGVuZGFyQ29uZmlnLCAkdWliTW9kYWwsIHNoYXJlZERhdGEpIHsKICBpbml0aWFsRW5kVXNlciA9IHNoYXJlZERhdGEuZ2V0U2VsZWN0ZWRFbmRVc2VyKCk7CiAgbG9nRGVidWcoJ0J1c2luZXNzQ2FsZW5kYXIgQ29udHJvbGxlciwgc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpPScgKyBzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkpOwoKICBnZXRCdXNpbmVzc0xvY2F0aW9ucygkaHR0cCwkc2NvcGUsJ2J1c2luZXNzX2xvY2F0aW9ucycpOwoKICAkc2NvcGUuc3RhdHVzZXMgPSBbIHsic3RhdHVzX2lkIjoiMCIsInN0YXR1c19uYW1lIjoi16TXqteV15cifSwgeyJzdGF0dXNfaWQiOiIxIiwic3RhdHVzX25hbWUiOiLXodeS15XXqCJ9XTsKICAkc2NvcGUudGhlZGF0YV9yZXBvcnQgPSB7fTsKCiAgJHNjb3BlLnRoZWRhdGFfcmVwb3J0LnNvdXJjZSA9ICJjYWxlbmRhciI7CiAgJHNjb3BlLnRoZWRhdGFfcmVwb3J0LmZpbHRlcnMgPSB7CiAgICBpc19jYW5jZWxlZDogIjAiCiAgfTsKCiAgJHNjb3BlLnVwZGF0ZUV2ZW50cyA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1ZygidXBkYXRlRXZlbnRzIik7CiAgICBpbnN0cnVjdG9yX2lkX2ZpbHRlciA9IGxpc3RfdG9fc3RyaW5nX2J5X3ZhbHVlKCRzY29wZS5jYWxlbmRhckluc3RydWN0b3JGaWx0ZXIsICJidXNpbmVzc191c2VyX2lkIiApOwogICAgZXZlbnRfdHlwZV9pZF9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuY2FsZW5kYXJFdmVudFR5cGVGaWx0ZXIsICJldmVudF90eXBlX2lkIiApOwogICAgc3RhdHVzX2ZpbHRlciA9IGxpc3RfdG9fc3RyaW5nX2J5X3ZhbHVlKCRzY29wZS5jYWxlbmRhclN0YXR1c0ZpbHRlciwgInN0YXR1c19pZCIgKTsKCiAgICAkc2NvcGUudGhlZGF0YV9yZXBvcnQuZmlsdGVycyA9IHsKICAgICAgaW5zdHJ1Y3Rvcl9pZDogaW5zdHJ1Y3Rvcl9pZF9maWx0ZXIsCiAgICAgIGV2ZW50X3R5cGVfaWQ6IGV2ZW50X3R5cGVfaWRfZmlsdGVyLAogICAgICBzdGF0dXM6IHN0YXR1c19maWx0ZXIsCiAgICAgIGlzX2NhbmNlbGVkOiAiMCIKICAgIH07CgogICAgLy8gY29uc29sZS5sb2coJHNjb3BlLmNhbGVuZGFyKTsKICAgIGxvZ0RlYnVnKCJiZWZvcmUgcmVmZXRjaEV2ZW50cyIpOwogICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKICAgIGxvZ0RlYnVnKCJhZnRlciByZWZldGNoRXZlbnRzIik7CiAgICAvLyB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwoKICB9CgogICRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyPWZhbHNlOwoKICBpZiAoc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpIT1udWxsKQogIHsKICAgIGNvbnNvbGUubG9nKCJnb3QgcHJldmlvdXMgc2VsZWN0ZWQgdXNlciAiK3NoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKS5idXNlcl9maXJzdF9uYW1lKTsKICAgICRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VybmFtZT1zaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfZmlyc3RfbmFtZSsiICIrc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2VyX2xhc3RfbmFtZTsKICAgICRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyX2lkPXNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKS5idXNpbmVzc191c2VyX2lkOwogICAgbG9nRGVidWcoIiRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyX2lkPSIrJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJfaWQpOwoKICAgICRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyPXRydWU7CiAgfQoKLy8gY2hlY2tpbmcgaWYgY2FsZW5kYXIgc2hvdWxkIHN0YXJ0IHdpdGggYSBzcGVjaWZpYyBkYXRlIChmcm9tIHVybCBvciBmcm9tIHByZXZpb3VzbHkgc2VsZWN0ZWQgZGF0ZSkKICBsb2dEZWJ1ZygiJGxvY2F0aW9uLnNlYXJjaCgpLnN0YXJ0PSIgKyAkbG9jYXRpb24uc2VhcmNoKCkuc3RhcnQpOwogIGlmICh0eXBlb2YgJGxvY2F0aW9uLnNlYXJjaCgpLnN0YXJ0ICE9ICd1bmRlZmluZWQnKQogIHsKICAgIGN1cnJEZWZhdWx0RGF0ZSA9ICRsb2NhdGlvbi5zZWFyY2goKS5zdGFydDsKICB9CiAgZWxzZSBpZiAoc2hhcmVkUHJvcGVydGllcy5nZXRfY2FsZW5kYXJfZGF0ZSgpIT1udWxsKQogIHsKICAgIGNvbnNvbGUubG9nKCJnb3QgcHJldmlvdXMgZGF0ZSAgIitzaGFyZWRQcm9wZXJ0aWVzLmdldF9jYWxlbmRhcl9kYXRlKCkpOwogICAgY3VyckRlZmF1bHREYXRlID0gc2hhcmVkUHJvcGVydGllcy5nZXRfY2FsZW5kYXJfZGF0ZSgpOwogIH0KICBlbHNlCiAgewogICAgY3VyckRlZmF1bHREYXRlID0gbmV3IERhdGUoKTsKICB9CiAgZ2V0QWxsSW5zdHJ1Y3RvcnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19pbnN0cnVjdG9ycycsZ2V0QWxsSW5zdHJ1Y3RvcnNfZmluaXNoKTsKICBnZXRBbGxJbnN0cnVjdG9ycygkaHR0cCwkc2NvcGUsJ2luc3RydWN0b3JzJyk7CiAgZnVuY3Rpb24gZ2V0QWxsSW5zdHJ1Y3RvcnNfZmluaXNoKCkKICB7Ci8vIGNvbnNvbGUubG9nKCRzY29wZS5idXNpbmVzc19pbnN0cnVjdG9ycyk7CiAgICAkc2NvcGUuYnVzaW5lc3NfaW5zdHJ1Y3RvcnMudW5zaGlmdCh7ImJ1c2VyX2Z1bGxfbmFtZSI6Iteb15wg15TXpteV15XXqiIsICJidXNlcl9maXJzdF9uYW1lIjoi15vXldec150iLCJidXNlcl9sYXN0X25hbWUiOiIiLCAidXNlcl9pZCI6IDAsICJidXNpbmVzc191c2VyX2lkIjogMH0pOwoKLy8gc2V0dGluZyBzZWxlY3RlZCBnZXRfc2VsZWN0ZWRfaW5zdHJ1Y3RvcgogICAgJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX2luc3RydWN0b3I9ZmFsc2U7CiAgICBpZiAoc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfaW5zdHJ1Y3RvcigpPj0wKQogICAgewovLyBjb25zb2xlLmxvZygiZ290IHByZXZpb3VzIHNlbGVjdGVkIGluc3RydWN0b3IgIitzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF9pbnN0cnVjdG9yKCkpOwogICAgICAkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfaW5zdHJ1Y3Rvcl9pZD1zaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF9pbnN0cnVjdG9yKCk7CiAgICAgICRzY29wZS5wcmV2aW91c19zZWxlY3RlZF9pbnN0cnVjdG9yPXRydWU7CiAgICAgICRzY29wZS5zZWxlY3RlZF9idXNpbmVzc191c2VyX2lkPXNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX2luc3RydWN0b3IoKTsKICAgIH0KICB9CiAgZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzKCRodHRwLCRzY29wZSwnZXZlbnRfdHlwZXNfY2FscycpOwogIGdldEFsbEJ1c2luZXNzRXZlbnRUeXBlc05vU3lzdGVtKCRodHRwLCRzY29wZSwnZXZlbnRfdHlwZXMnKTsKCi8vIHNldHRpbmcgc2VsZWN0ZWQgdXNlciBpZAogICRzY29wZS5wcmV2aW91c19ldmVudF9yZXNjaGVkdWxlPWZhbHNlOwogICRzY29wZS5wcmV2aW91c19ldmVudF9yZXNjaGVkdWxlX2V2ZW50PW51bGw7CgogICRzY29wZS4kb24oImNhbGVuZGFyRXZlbnRSZXNjaGVkdWxlRGVzZWxlY3QiLGZ1bmN0aW9uKGUsYSkKICB7CiAgICAkc2NvcGUuY2FsZW5kYXJFdmVudFJlc2NoZWR1bGVEZXNlbGVjdCgpOwogIH0pOwoKLy8gZGVzZWxlY3RpbmcgZXZlbnQgZnJvbSBiZWluZyByZXNjaGVkdWxlZAogICRzY29wZS5jYWxlbmRhckV2ZW50UmVzY2hlZHVsZURlc2VsZWN0PWZ1bmN0aW9uKCkKICB7CiAgICBzaGFyZWRQcm9wZXJ0aWVzLnNldF9ldmVudF9yZXNjaGVkdWxlKG51bGwpOwogICAgJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGU9ZmFsc2U7CiAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwogIH0KLy8gZGVsZXRpbmcgY2xpZW50IHNlbGVjdGlvbiBpbiBjYWxlbmRhcgogICRzY29wZS5jYWxlbmRhckNsaWVudERlc2VsZWN0PWZ1bmN0aW9uKCkgLy8gcmVsb2FkIGNsYXNzL2V2ZW50IHN1Z2dlc3Rpb25zCiAgewogICAgJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXI9ZmFsc2U7CiAgICBzaGFyZWRQcm9wZXJ0aWVzLnNldF9zZWxlY3RlZF91c2VyKG51bGwpOwogICAgJHNjb3BlLmV2ZW50VHlwZVNlbGVjdGVkKCk7CiAgfQogIGlmIChpbml0aWFsRW5kVXNlciAhPSBudWxsKSB7CiAgICAkc2NvcGUuYnVzaW5lc3NDYWxlbmRhckluaXRpYWxOYW1lID0gdHJ1ZTsKICAgIHNoYXJlZERhdGEuc2V0U2VsZWN0ZWRFbmRVc2VyKG51bGwpOwogICAgJHNjb3BlLmJ1c2luZXNzQ2FsZW5kYXJJbml0aWFscyA9IHsKICAgICAgbmFtZTogaW5pdGlhbEVuZFVzZXIuZmlyc3RfbmFtZSArICIgIiArIGluaXRpYWxFbmRVc2VyLmxhc3RfbmFtZQogICAgfTsKICB9IGVsc2UgewogICAgJHNjb3BlLmJ1c2luZXNzQ2FsZW5kYXJJbml0aWFsTmFtZSA9IGZhbHNlOwogIH0KICAvKiBjb25maWcgb2JqZWN0ICovCiAgJHNjb3BlLmNhbGVuZGFyX25hbWUgPSAiY2FsZW5kYXJfYnVzaW5lc3MiOwogICRzY29wZS5jYWxlbmRhciA9ICJjYWxlbmRhcl9idXNpbmVzcyI7CiAgLyogZXZlbnQgc291cmNlcyBhcnJheSovCgogIC8vIHRoZWRhdGEgPSB7IHNvdXJjZTogImNhbGVuZGFyIiB9CiAgLy8gdGhlZGF0YVsnZmlsdGVycyddID0geyBpbnN0cnVjdG9yX2lkOiAiMTk1In07CgogIC8vIGNvbnNvbGUubG9nKHRoZWRhdGEpOwoKICAkc2NvcGUuYnVzaW5lc3NDYWxlbmRhckV2ZW50U291cmNlcyA9IFt7CiAgICAvLyB1cmw6ICcvYXBpL2FkbWluL2V2ZW50cy9nZXRwb3N0JywKICAgIHVybDogJy9hcGkvYWRtaW4vcmVwb3J0cy9ldmVudHMyJywKICAgIGRhdGE6ICRzY29wZS50aGVkYXRhX3JlcG9ydCAsCiAgICB0eXBlOiAnUE9TVCcKICB9LCB7CiAgICB1cmw6ICcvYXBpL2FkbWluL2NhbGVuZGFyL2xpbWl0YXRpb25zL2JhY2tncm91bmQvZ2V0cG9zdCcsCiAgICBkYXRhOiAkc2NvcGUudGhlZGF0YV9yZXBvcnQgLAogICAgdHlwZTogJ1BPU1QnICAgIC8vIH0sIHsKLy8gICAgIHVybDogJy9hcGkvYWRtaW4vcmVjdXJyaW5nL2dldHBvc3QnLAovLyAgICAgdHlwZTogJ1BPU1QnCiAgfV07CgogICRzY29wZS5nb3RvVG9kYXkgPSBmdW5jdGlvbigpIHsKICAgICRzY29wZS5nb3RvRGF0ZShuZXcgRGF0ZSgpKTsKICAgIHZpc2libGVEYXRlU3RhcnQgPSBuZXcgRGF0ZSh1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ2V0VmlldycpLnN0YXJ0KTsKICAgIGRhdGVUb0dvVG8gPSB2aXNpYmxlRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCkgKyAiLSIgKyAoJzAnICsgKHZpc2libGVEYXRlU3RhcnQuZ2V0TW9udGgoKSArIDEpKS5zbGljZSgtMikgKyAiLSIgKyAoJzAnICsgdmlzaWJsZURhdGVTdGFydC5nZXREYXRlKCkpLnNsaWNlKC0yKTsKICAgIHNoYXJlZFByb3BlcnRpZXMuc2V0X2NhbGVuZGFyX2RhdGUoZGF0ZVRvR29Ubyk7CiAgICAkc2NvcGUudmlzaWJsZURhdGVTdGFydD12aXNpYmxlRGF0ZVN0YXJ0OwogICAgJGxvY2F0aW9uLnNlYXJjaCgnc3RhcnQnLGRhdGVUb0dvVG8pOwogIH0KCiAgJHNjb3BlLmluc3RydWN0b3JTZWxlY3RlZD1mdW5jdGlvbih0aGlzdGhpcykKICB7CiAgICB1cGRhdGVTdWdnZXN0aW9ucygpOwogIH0KICAkc2NvcGUuZXZlbnRUeXBlU2VsZWN0ZWQ9ZnVuY3Rpb24odGhpc3RoaXMpCiAgewogICAgdXBkYXRlU3VnZ2VzdGlvbnMoKTsKICB9CiAgZnVuY3Rpb24gdXBkYXRlU3VnZ2VzdGlvbnMoKQogIHsKICAgIGxvZ0RlYnVnKCJmdW5jdGlvbjogdXBkYXRlU3VnZ2VzdGlvbnMiKTsKICAgIHNoYXJlZFByb3BlcnRpZXMuc2V0X2V2ZW50X3R5cGVfZm9yX3N1Z2dlc3Rpb25zKCRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkKTsKICAgIHNoYXJlZFByb3BlcnRpZXMuc2V0X3NlbGVjdGVkX2luc3RydWN0b3IoJHNjb3BlLnNlbGVjdGVkX2J1c2luZXNzX3VzZXJfaWQpOwogICAgZm9yIChpPTA7aTwkc2NvcGUuZXZlbnRfdHlwZXMubGVuZ3RoO2krKykKICAgIHsKLy8gY29uc29sZS5sb2coJHNjb3BlLmV2ZW50X3R5cGVzW2ldLmV2ZW50X3R5cGVfaWQpOwogICAgICBpZiAoJHNjb3BlLnNlbGVjdGVkX2V2ZW50X3R5cGVfaWQ9PSRzY29wZS5ldmVudF90eXBlc1tpXS5ldmVudF90eXBlX2lkKQogICAgICB7Ci8vIGNvbnNvbGUubG9nKCJmb3VuZCBldmVudCB0eXBlIGlkIik7CiAgICAgICAgaWYgKCRzY29wZS5ldmVudF90eXBlc1tpXS5pc19jbGFzcykgLy8gaXMgY2xhc3MKICAgICAgICB7CiAgICAgICAgICBsb2dEZWJ1ZygiJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXI9Iiskc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcik7CiAgICAgICAgICBpZiAoJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXIpCiAgICAgICAgICB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCJpcyBjbGFzcyBzdWdnZXN0aW9uZCIpOwogICAgICAgICAgICAkaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3RjbGFzcy8iKyRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkKyIvIiskc2NvcGUuc2VsZWN0ZWRfYnVzaW5lc3NfdXNlcl9pZCsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSsiLyIrKCRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkrMSkrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0SG91cnMoKSArICIvIiArICRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKSArICIvIiArICRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyX2lkKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkX2V2ZW50X3R5cGVfaWRfaXNfY2xhc3M9dHJ1ZTsKICAgICAgICAgICAgICAkc2NvcGUuZXZlbnRzU3VnZ2VzdGVkID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgICBlbHNlCiAgICAgICAgICB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCJub3QgaXMgY2xhc3Mgc3VnZ2VzdGlvbmQiKTsKICAgICAgICAgICAgJGh0dHAuZ2V0KCRnQXBpVVJMUHJlZml4ICsgIi9lbmR1c2VyL2V2ZW50cy9zdWdnZXN0Y2xhc3MvIiskc2NvcGUuc2VsZWN0ZWRfZXZlbnRfdHlwZV9pZCsiLyIrJHNjb3BlLnNlbGVjdGVkX2J1c2luZXNzX3VzZXJfaWQrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCkrIi8iKygkc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpKzEpKyIvIiskc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXREYXRlKCkrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldEhvdXJzKCkgKyAiLyIgKyAkc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXRNaW51dGVzKCkgKyAiLzAiKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkX2V2ZW50X3R5cGVfaWRfaXNfY2xhc3M9dHJ1ZTsKICAgICAgICAgICAgICAkc2NvcGUuZXZlbnRzU3VnZ2VzdGVkID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UgLy8gaXMgbm90IGNsYXNzCiAgICAgICAgewogICAgICAgICAgJGh0dHAuZ2V0KCRnQXBpVVJMUHJlZml4ICsgIi9lbmR1c2VyL2V2ZW50cy9zdWdnZXN0LyIrJHNjb3BlLnNlbGVjdGVkX2V2ZW50X3R5cGVfaWQrIi8iKyRzY29wZS5zZWxlY3RlZF9idXNpbmVzc191c2VyX2lkKyIvIiskc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpKyIvIisoJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0TW9udGgoKSsxKSsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0RGF0ZSgpKyIvIiskc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXRIb3VycygpICsgIi8iICsgJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0TWludXRlcygpKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKQogICAgICAgICAgewogICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRfZXZlbnRfdHlwZV9pZF9pc19jbGFzcz1mYWxzZTsKICAgICAgICAgICAgJHNjb3BlLmV2ZW50c1N1Z2dlc3RlZCA9IHJlc3BvbnNlLmRhdGE7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CgogICRzY29wZS5nb3RvTmV4dCA9IGZ1bmN0aW9uKCkgewogICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlbW92ZUV2ZW50cycpOwogICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ25leHQnKTsKICAgICRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlKCk7Ci8vIGFkZGluZyB0aGUgZm9sbG93aW5nIHRvIG1ha2UgdGhlIHVybAovLyBwb2ludCB0byB0aGUgcmlnaHQgd2VlaywgaWYgZ29pbmcgdG8gYSBkaWZmZXJlbnQgVVJMIGFuZCB0aGVuIGdvaW5nIGJhY2sKICAgIHZpc2libGVEYXRlU3RhcnQgPSBuZXcgRGF0ZSh1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ2V0VmlldycpLnN0YXJ0KTsKICAgIGRhdGVUb0dvVG8gPSB2aXNpYmxlRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCkgKyAiLSIgKyAoJzAnICsgKHZpc2libGVEYXRlU3RhcnQuZ2V0TW9udGgoKSArIDEpKS5zbGljZSgtMikgKyAiLSIgKyAoJzAnICsgdmlzaWJsZURhdGVTdGFydC5nZXREYXRlKCkpLnNsaWNlKC0yKTsKICAgIHNoYXJlZFByb3BlcnRpZXMuc2V0X2NhbGVuZGFyX2RhdGUoZGF0ZVRvR29Ubyk7CiAgICAkc2NvcGUudmlzaWJsZURhdGVTdGFydD12aXNpYmxlRGF0ZVN0YXJ0OwogICAgJGxvY2F0aW9uLnNlYXJjaCgnc3RhcnQnLGRhdGVUb0dvVG8pOwogIH0KICAkc2NvcGUuZ290b1ByZXYgPSBmdW5jdGlvbigpIHsKICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZW1vdmVFdmVudHMnKTsKICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdwcmV2Jyk7CiAgICAkc2NvcGUudXBkYXRlQ2FsZW5kYXJDZW50ZXJUaXRsZSgpOwovLyBhZGRpbmcgdGhlIGZvbGxvd2luZyB0byBtYWtlIHRoZSB1cmwKLy8gcG9pbnQgdG8gdGhlIHJpZ2h0IHdlZWssIGlmIGdvaW5nIHRvIGEgZGlmZmVyZW50IFVSTCBhbmQgdGhlbiBnb2luZyBiYWNrCiAgICB2aXNpYmxlRGF0ZVN0YXJ0ID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5zdGFydCk7CiAgICBkYXRlVG9Hb1RvID0gdmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpICsgIi0iICsgKCcwJyArICh2aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkgKyAxKSkuc2xpY2UoLTIpICsgIi0iICsgKCcwJyArIHZpc2libGVEYXRlU3RhcnQuZ2V0RGF0ZSgpKS5zbGljZSgtMik7CiAgICBzaGFyZWRQcm9wZXJ0aWVzLnNldF9jYWxlbmRhcl9kYXRlKGRhdGVUb0dvVG8pOwogICAgJHNjb3BlLnZpc2libGVEYXRlU3RhcnQ9dmlzaWJsZURhdGVTdGFydDsKICAgICRsb2NhdGlvbi5zZWFyY2goJ3N0YXJ0JyxkYXRlVG9Hb1RvKTsKCiAgfQogICRzY29wZS5nb3RvRGF0ZSA9IGZ1bmN0aW9uKG5ld2RhdGUpIHsKICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnb3RvRGF0ZScsIG5ld2RhdGUpOwogICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlbW92ZUV2ZW50cycpOwogICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKICAgICRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlKCk7CiAgfQoKICAkc2NvcGUuZWRpdEhvdXJzT2ZXb3JrID0gZnVuY3Rpb24oKSB7Ci8vIHBhcmFtIHNob3VsZCBsb29rIGxpa2UgIjIwMTYtMDctMDEiCiAgICB2aXNpYmxlRGF0ZVN0YXJ0ID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5zdGFydCk7CiAgICBkYXRlVG9Hb1RvID0gdmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpICsgIi0iICsgKCcwJyArICh2aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkgKyAxKSkuc2xpY2UoLTIpICsgIi0iICsgKCcwJyArIHZpc2libGVEYXRlU3RhcnQuZ2V0RGF0ZSgpKS5zbGljZSgtMik7CiAgICAkbG9jYXRpb24ucGF0aCgnL2hvdXJzX29mX3dvcmsnKS5zZWFyY2goewogICAgICBzdGFydDogZGF0ZVRvR29UbwogICAgfSk7CiAgfTsKCiAgJHNjb3BlLnVwZGF0ZUNhbGVuZGFyQ2VudGVyVGl0bGUgPSBmdW5jdGlvbigpIHsKICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3Jyk7CgogICAgdmlzaWJsZURhdGVTdGFydCA9IG5ldyBEYXRlKHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3Jykuc3RhcnQpOwogICAgdmlzaWJsZURhdGVFbmQgPSBuZXcgRGF0ZSh1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ2V0VmlldycpLmVuZCk7CgogICAgJHNjb3BlLmNhbGVuZGFyVGl0bGVDZW50ZXIgPSB2aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSArICIgIiArIG1vbnRoTmFtZXNbdmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpXSArCiAgICAgICAgIiDigJQgIiArIHZpc2libGVEYXRlRW5kLmdldERhdGUoKSArICIgIiArIG1vbnRoTmFtZXNbdmlzaWJsZURhdGVFbmQuZ2V0TW9udGgoKV0gKwogICAgICAgICIgIiArIHZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKTsKICB9OwoKICAkc2NvcGUuc2hvd0V2ZW50UG9wdXAgPSBmdW5jdGlvbihzZWxlY3RlZEV2ZW50KSB7CiAgICBzaG93RXZlbnRQb3B1cChzZWxlY3RlZEV2ZW50LCAkdWliTW9kYWwpCiAgfTsKCiAgJHNjb3BlLmV2ZW50Q3JlYXRlTW9kYWxGcm9tU2NoZWR1bGVyID0gZnVuY3Rpb24oZXN1Z2dlc3QpCiAgewovLyBpZiBjbGFzcyAtIGdvIHRvIGV2ZW50IGNsYXNzCiAgICBjb25zb2xlLmxvZyhlc3VnZ2VzdCk7CiAgICBmb3IgKGk9MDtpPCRzY29wZS5ldmVudF90eXBlcy5sZW5ndGg7aSsrKQogICAgewogICAgICBpZiAoZXN1Z2dlc3QuZXZlbnRfdHlwZV9pZD09JHNjb3BlLmV2ZW50X3R5cGVzW2ldLmV2ZW50X3R5cGVfaWQpCiAgICAgIHsKICAgICAgICBpZiAoJHNjb3BlLmV2ZW50X3R5cGVzW2ldLmlzX2NsYXNzKQogICAgICAgIHsKICAgICAgICAgIGNvbnNvbGUubG9nKCJpcyBjbGFzcyIpOwogICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWY9Jy8jL2V2ZW50X2NsYXNzLycgKyBlc3VnZ2VzdC5ldmVudF9pZDsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGxvZ0RlYnVnKEpTT04uc3RyaW5naWZ5KGVzdWdnZXN0KSk7CiAgICBsb2dEZWJ1Zyhlc3VnZ2VzdC5zdGFydF9lcG9jaCk7CiAgICBzdGFydERhdGU9ZXN1Z2dlc3Quc3RhcnRfZXBvY2gqMTAwMDsKCiAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAgICAgYW5pbWF0aW9uOiBmYWxzZSwKICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfZXZlbnRfY3JlYXRlLnBocCcsCiAgICAgIGNvbnRyb2xsZXI6ICdldmVudENyZWF0ZU1vZGFsQ29udHJvbGxlcicsCiAgICAgIHNpemU6ICdsJywKICAgICAgcmVzb2x2ZTogewogICAgICAgIHN0YXJ0RGF0ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gc3RhcnREYXRlOwogICAgICAgIH0sCiAgICAgICAgZXZlbnRfdHlwZV9pZDogZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gJHNjb3BlLnNlbGVjdGVkX2V2ZW50X3R5cGVfaWQ7CiAgICAgICAgfSwKICAgICAgICBsb2NhdGlvbl9pZDogZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gZXN1Z2dlc3QubG9jYXRpb25faWQ7CiAgICAgICAgfSwKICAgICAgICBlbXBfaWQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIGVzdWdnZXN0LmVtcF9pZDsKICAgICAgICB9LAogICAgICAgIHJlc2NoZWR1bGVfZXZlbnQ6IGZ1bmN0aW9uKCkKICAgICAgICB7CiAgICAgICAgICBpZiAoJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGUpCiAgICAgICAgICB7CiAgICAgICAgICAgIHJldHVybiAkc2NvcGUucHJldmlvdXNfZXZlbnRfcmVzY2hlZHVsZV9ldmVudDsKICAgICAgICAgIH0KICAgICAgICAgIGVsc2UKICAgICAgICAgIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgfQogICAgfSk7CgogIH0KICAkc2NvcGUuZXZlbnRDcmVhdGVNb2RhbCA9IGZ1bmN0aW9uKHN0YXJ0RGF0ZSwgc2l6ZSkgewogICAgbG9nRGVidWcoImV2ZW50Q3JlYXRlTW9kYWwgc3RhcnREYXRlPSIrc3RhcnREYXRlKTsKCiAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAgICAgYW5pbWF0aW9uOiBmYWxzZSwKICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfZXZlbnRfY3JlYXRlLnBocCcsCiAgICAgIGNvbnRyb2xsZXI6ICdldmVudENyZWF0ZU1vZGFsQ29udHJvbGxlcicsCiAgICAgIHNpemU6IHNpemUsCiAgICAgIHJlc29sdmU6IHsKICAgICAgICBzdGFydERhdGU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIHN0YXJ0RGF0ZTsKICAgICAgICB9LAogICAgICAgIGV2ZW50X3R5cGVfaWQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfSwKICAgICAgICBsb2NhdGlvbl9pZDogZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9LAogICAgICAgIGVtcF9pZDogZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9LAogICAgICAgIHJlc2NoZWR1bGVfZXZlbnQ6IGZ1bmN0aW9uKCkKICAgICAgICB7CiAgICAgICAgICBpZiAoJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGUpCiAgICAgICAgICB7CiAgICAgICAgICAgIHJldHVybiAkc2NvcGUucHJldmlvdXNfZXZlbnRfcmVzY2hlZHVsZV9ldmVudDsKICAgICAgICAgIH0KICAgICAgICAgIGVsc2UKICAgICAgICAgIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9ICAgICAgICAgICAgICAgIH0KCiAgICAgIH0KICAgIH0pOwoKICAgIG1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24oc2VsZWN0ZWRJdGVtKSB7CiAgICAgICRzY29wZS5zZWxlY3RlZCA9IHNlbGVjdGVkSXRlbTsKICAgIH0sIGZ1bmN0aW9uKCkgewogICAgICBsb2dEZWJ1ZygnTW9kYWwgZGlzbWlzc2VkIGF0OiAnICsgbmV3IERhdGUoKSk7CiAgICB9KTsKICB9OwoKLy8vCiAgJHNjb3BlLnVwZGF0ZUV2ZW50RGF0YWJhc2UgPSBmdW5jdGlvbihzdGFydF9wYXJhbSwgZW5kX3BhcmFtLCBldmVudF9pZCwgdGhlZXZlbnQpCiAgewoKICAgIGxvZ0RlYnVnKCJ1cGRhdGVFdmVudERhdGFiYXNlIHN0YXJ0PSIgKyBzdGFydF9wYXJhbSArICIsIGVuZD0iICsgZW5kX3BhcmFtICsgIiwgZXZlbnRfaWQ9IiArIGV2ZW50X2lkKTsKICAgIHRoZXVybCA9ICcvYXBpL2FkbWluL2V2ZW50cy9zZXQvJyArIGV2ZW50X2lkOwoKICAgICRodHRwKHsKICAgICAgbWV0aG9kOiAnUE9TVCcsCiAgICAgIHVybDogdGhldXJsLAogICAgICBkYXRhOiB7CiAgICAgICAgc3RhcnRfZGF0ZTogc3RhcnRfcGFyYW0sCiAgICAgICAgZW5kX2RhdGU6IGVuZF9wYXJhbSwKICAgICAgICBldmVudF9pZDogZXZlbnRfaWQKICAgICAgfSwKICAgICAgaGVhZGVyczogewogICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbjtjaGFyc2V0PXV0Zi04JwogICAgICB9CiAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHsKCiAgICAgIGxvZ0RlYnVnKGRhdGEpOwogICAgICBpZiAoZGF0YS5FcnJvcikgewogICAgICAgIGxvZ0RlYnVnKCJlcnJvciAiICsgZGF0YS5NZXNzYWdlKTsKICAgICAgICBhbGVydCgnZXJyb3InKTsKICAgICAgICBjYWxlbmRhciA9ICJjYWxlbmRhcl9idXNpbmVzcyI7CiAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwogICAgICB9IGVsc2UgewogICAgICAgIGxvZ0RlYnVnKCJzdWNjZXNzIik7CiAgICAgICAgY2FsZW5kYXIgPSAiY2FsZW5kYXJfYnVzaW5lc3MiOwovLyB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZWZldGNoRXZlbnRzJyk7Ci8vICR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoJ2FkZGVkIGFuZCByZWZldGNoRXZlbnRzJyk7CiAgICAgIH0KICAgIH0pOwoKICB9OwovLy8KCiAgJHNjb3BlLmNsYXNzRXZlbnRBZGRVc2VyID0gZnVuY3Rpb24oZXN1Z2dlc3QpCiAgewogICAgY29uc29sZS5sb2coImNsYXNzRXZlbnRBZGRVc2VyIG9yIFJlbW92ZSIpOwogICAgaWYgKChlc3VnZ2VzdC5pc19yZWdpc3RlcmVkPT0xKSB8ICgoZXN1Z2dlc3QuaXNfd2FpdGluZ2xpc3Q9PTEpICYmIChlc3VnZ2VzdC5pc19jYW5jZWxlZD09MCkpKQogICAgewogICAgICBjb25zb2xlLmxvZygibmVlZCB0byB1bnJlZ2lzdGVyIik7CiAgICAgIHJlbW92ZUVuZFVzZXJGcm9tRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyX2lkLGVzdWdnZXN0LmV2ZW50X2lkLHJlbW92ZUVuZFVzZXJGcm9tRXZlbnRfY2FsbGJhY2ssIHJlbW92ZUVuZFVzZXJGcm9tRXZlbnRfY2FsbGJhY2spOwogICAgICBmdW5jdGlvbiByZW1vdmVFbmRVc2VyRnJvbUV2ZW50X2NhbGxiYWNrKCkKICAgICAgewogICAgICAgICRzY29wZS5ldmVudFR5cGVTZWxlY3RlZCgpOwogICAgICAgIGNhbGVuZGFyID0gImNhbGVuZGFyX2J1c2luZXNzIjsKICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZWZldGNoRXZlbnRzJyk7CgogICAgICB9CiAgICB9CiAgICBlbHNlCiAgICB7Ci8vIGNvbnNvbGUubG9nKGVzdWdnZXN0LmV2ZW50X2lkKTsKLy8gY29uc29sZS5sb2coJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJfaWQpOwovLyBpZiBzZWxlY3RlZCB1c2VyIC0gYWRkaW5nIGhpbS9oZXIgdG8gY2xhc3MKICAgICAgaWYgKCRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyKQogICAgICB7CiAgICAgICAgYWRkRW5kVXNlclRvRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyX2lkLGVzdWdnZXN0LmV2ZW50X2lkLGFkZEVuZFVzZXJUb0V2ZW50X2NhbGxiYWNrLCBhZGRFbmRVc2VyVG9FdmVudF9jYWxsYmFjayk7CiAgICAgICAgZnVuY3Rpb24gYWRkRW5kVXNlclRvRXZlbnRfY2FsbGJhY2soKQogICAgICAgIHsKICAgICAgICAgIGNhbGVuZGFyID0gImNhbGVuZGFyX2J1c2luZXNzIjsKICAgICAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKICAgICAgICAgICRzY29wZS5ldmVudFR5cGVTZWxlY3RlZCgpOwogICAgICAgIH0KICAgICAgfQogICAgICBlbHNlIC8vIGVsc2UgLSBnb2luZyB0byBjbGFzcyBwYWdlCiAgICAgIHsKICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZj0nLyMvZXZlbnRfY2xhc3MvJyArIGVzdWdnZXN0LmV2ZW50X2lkOwogICAgICB9CiAgICB9CiAgfQogICRzY29wZS5jYWxlbmRhcl9idXNpbmVzc19jb25maWcgPSB7CiAgICBjYWxlbmRhcjogewogICAgICBoZWlnaHQ6ICdhdXRvJywKICAgICAgZWRpdGFibGU6IHRydWUsCi8vIGhlYWRlcjogewovLyAgICAgbGVmdDogJycsCi8vICAgICBjZW50ZXI6ICcnLAovLyAgICAgcmlnaHQ6ICcnCi8vIH0sCi8vIGhlYWRlcjogewovLyAgICAgbGVmdDogJ3RpdGxlJywKLy8gICAgIGNlbnRlcjogJycsCi8vICAgICByaWdodDogJ3RvZGF5IHByZXYsbmV4dCcKLy8gfSwKICAgICAgdGl0bGVGb3JtYXQ6IHsKLy8gd2VlazogICJkIFtNTU1deyAnJiM4MjExOycgZCBNTU19IgogICAgICB9LAovLyB0aXRsZUZvcm1hdDogewovLyAgICAgbW9udGg6ICdNTU1NIHl5eXknLAovLyAgICAgd2VlazogIk1NTSBkWyB5eXl5XXsgJyYjODIxMjsnWyBNTU1dIGQgeXl5eX0iLAovLyAgICAgZGF5OiAnTU0vZGQnCi8vIH0sCiAgICAgIGhlYWRlcjogJycsCi8vIGRlZmF1bHRWaWV3OiAnYWdlbmRhV2VlaycsCi8vIHZpZXdzOiB7Ci8vICAgICBkb250U2hvd0RhdGU6IHsKLy8gICAgICAgICB0eXBlOiAnYWdlbmRhV2VlaycsCi8vICAgICAgICAgZHVyYXRpb246IHsKLy8gICAgICAgICAgICAgZGF5czogNwovLyAgICAgICAgIH0sCi8vICAgICAgICAgdGl0bGU6ICdBcGVydHVyYScsCi8vICAgICAgICAgY29sdW1uRm9ybWF0OiAnZGRkZCcgLy8gRm9ybWF0IHRoZSBkYXkgdG8gb25seSBzaG93IGxpa2UgJ01vbmRheScKLy8gICAgICAgICAgICAgLy8gaGlkZGVuRGF5czogWzAsIDZdIC8vIEhpZGUgU3VuZGF5IGFuZCBTYXR1cmRheT8KLy8gICAgIH0KLy8gfSwKLy8gc2xvdER1cmF0aW9uOiAnMDA6MTU6MDAnLAogICAgICBldmVudERyb3A6IGZ1bmN0aW9uKGV2ZW50LCBkYXlEZWx0YSwgbWludXRlRGVsdGEsIGFsbERheSwgcmV2ZXJ0RnVuYywgdWlDYWxlbmRhckNvbmZpZykgewogICAgICAgIGxvZ0RlYnVnKCJldmVudCBkcm9wIiArIGV2ZW50LnRpdGxlICsgIigiICsgZXZlbnQuaWQgKyAiKSBtb3ZlZCAiICsgbWludXRlRGVsdGEgKyAiIG1pbnV0ZXMiKTsKICAgICAgICBsb2dEZWJ1Zygib2xkIHN0YXJ0PSIgKyBldmVudC5zdGFydCArICIsIG9sZCBlbmQ9IiArIGV2ZW50LmVuZCk7CiAgICAgICAgJHNjb3BlLnVwZGF0ZUV2ZW50RGF0YWJhc2UoZXZlbnQuc3RhcnQsIGV2ZW50LmVuZCwgZXZlbnQuaWQsIGV2ZW50KTsKICAgICAgfSwKICAgICAgZXZlbnRSZXNpemU6IGZ1bmN0aW9uKGV2ZW50LCBkZWx0YSwgcmV2ZXJ0RnVuYykgewogICAgICAgIGxvZ0RlYnVnKCJldmVudCByZXNpemUiICsgZXZlbnQudGl0bGUgKyAiKCIgKyBldmVudC5pZCArICIpIG1vdmVkICIpOwogICAgICAgIGxvZ0RlYnVnKCJvbGQgc3RhcnQ9IiArIGV2ZW50LnN0YXJ0ICsgIiwgb2xkIGVuZD0iICsgZXZlbnQuZW5kKTsKICAgICAgICAkc2NvcGUudXBkYXRlRXZlbnREYXRhYmFzZShldmVudC5zdGFydCwgZXZlbnQuZW5kLCBldmVudC5pZCwgZXZlbnQpOwogICAgICB9LAogICAgICBkZWZhdWx0VmlldzogJ2FnZW5kYVdlZWsnLAogICAgICBldmVudFN0YXJ0RWRpdGFibGU6ZmFsc2UsCiAgICAgIGV2ZW50RHVyYXRpb25FZGl0YWJsZTpmYWxzZSwKICAgICAgZGVmYXVsdERhdGU6IG1vbWVudChjdXJyRGVmYXVsdERhdGUpLAoKLy8gZGVmYXVsdFZpZXc6ICdkb250U2hvd0RhdGUnLAogICAgICBldmVudENsaWNrOiBmdW5jdGlvbihjYWxFdmVudCwganNFdmVudCwgdmlldykgewogICAgICAgIGxvZ0RlYnVnKCJjYWxlbmRhciBldmVudCBjbGlja2VkICIgKyBjYWxFdmVudC50aXRsZSArICIoIiArIGNhbEV2ZW50LmlkICsgIikgIiArIGNhbEV2ZW50LnN0YXJ0ICsgIiAiICsgY2FsRXZlbnQuZW5kKTsKLy8gbG9nRGVidWcoSlNPTi5zdHJpbmdpZnkoY2FsRXZlbnQpKTsKLy8gaWYgaXQncyBhIGdlbmVyaWMgZXZlbnQgKHZhY2F0aW9uIGV0YykKLy8gc2hvdyBwb3B1cCB3aXRoIG9wdGlvbiB0byBkZWxldGUKICAgICAgICBpZiAoY2FsRXZlbnQuaXNfZ2VuZXJpY19ldHlwZT09MSkKICAgICAgICB7Ci8vICRzY29wZS5zaG93R2VuZXJpY0V2ZW50KGNhbEV2ZW50KTsKICAgICAgICAgICRzY29wZS5zaG93RXZlbnRQb3B1cChjYWxFdmVudCk7CgogICAgICAgIH0KICAgICAgICBlbHNlCiAgICAgICAgewogICAgICAgICAgJHNjb3BlLnNob3dFdmVudFBvcHVwKGNhbEV2ZW50KTsKICAgICAgICB9Ci8vIGNoYW5nZSB0aGUgYm9yZGVyIGNvbG9yIGp1c3QgZm9yIGZ1bgovLyAkKHRoaXMpLmNzcygnYm9yZGVyLWNvbG9yJywgJ3JlZCcpOwoKICAgICAgfSwKICAgICAgZGF5Q2xpY2s6IGZ1bmN0aW9uKGRhdGUsIGpzRXZlbnQsIHZpZXcpIHsKLy8gbG9nRGVidWcoIm5ldyBldmVudCBjcmVhdGlvbiBjbGlja2VkICIgKyBjYWxFdmVudC50aXRsZSArICIoIiArIGNhbEV2ZW50LmlkICsgIikgIiArIGNhbEV2ZW50LnN0YXJ0ICsgIiAiICsgY2FsRXZlbnQuZW5kKTsKLy8gICAgIHN0YXJ0ID0gZGF0ZTsKLy8gICAgIGVuZCA9IG1vbWVudChzdGFydCkuYWRkKDQ1LCAnbWludXRlcycpOwogICAgICAgIGlmICh2aWV3Lm5hbWUgPT09ICJtb250aCIpIHsKICAgICAgICAgIGNhbGVuZGFyID0gImNhbGVuZGFyX2J1c2luZXNzIjsKICAgICAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2NoYW5nZVZpZXcnLCAiYWdlbmRhV2VlayIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAkc2NvcGUuZXZlbnRDcmVhdGVNb2RhbChkYXRlKTsKICAgICAgICB9Ci8vIGNoYW5nZSB0aGUgYm9yZGVyIGNvbG9yIGp1c3QgZm9yIGZ1bgovLyAkKHRoaXMpLmNzcygnYm9yZGVyLWNvbG9yJywgJ3JlZCcpOwoKICAgICAgfSwKICAgICAgZXZlbnRSZW5kZXI6IGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KQogICAgICB7CiAgICAgICAgaWYgKCFldmVudC5ldmVudF9pZD4wKQogICAgICAgIHsKLy8gbm90IGEgcmVhbCBldmVudCAtIHByb2JhYmx5IGJsb2NrIC8gYmFja2dyb3VuZAovLyBpZ25vcmluZyBpdAogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KLy8gY2hhbmdpbmcgbG9vayBhbmQgZmVlbCBvZiBldmVuIHRoYXQgaXMgdG8gcmVzY2hlZHVsZQogICAgICAgIGlmIChzaGFyZWRQcm9wZXJ0aWVzLmdldF9ldmVudF9yZXNjaGVkdWxlKCkhPW51bGwpCiAgICAgICAgewogICAgICAgICAgaWYgKGV2ZW50LmV2ZW50X2lkPT1zaGFyZWRQcm9wZXJ0aWVzLmdldF9ldmVudF9yZXNjaGVkdWxlKCkuZXZlbnRfaWQpCiAgICAgICAgICB7CiAgICAgICAgICAgIGVsZW1lbnQuY3NzKCdiYWNrZ3JvdW5kLWNvbG9yJywgJyNBOUE5QTkJJyk7CiAgICAgICAgICAgIGVsZW1lbnQuY3NzKCdib3JkZXItY29sb3InLCAnI0E5QTlBOQknKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoZXZlbnQuaXNfZ2VuZXJpY19ldHlwZT09MSkKICAgICAgICB7CgogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChldmVudC5pc19jbGFzcz09MSkKICAgICAgICB7Ci8vIGlmIGNsYXNzIGFkZGluZyBudW1iZXIgb2YgcGFydGljaXBhbnRzCiAgICAgICAgICBpZiAoZXZlbnQubm9fb2Zfd2FpdGluZ191c2Vycz4wKQogICAgICAgICAgewogICAgICAgICAgICBlbGVtZW50LmZpbmQoJy5mYy10aXRsZScpLnByZXBlbmQoZXZlbnQubm9fb2ZfdXNlcnMrIi8iK2V2ZW50Lm1heF9wYXJ0aWNpcGFudHMrICIgKCIrZXZlbnQubm9fb2Zfd2FpdGluZ191c2VycysiKSIrIiAtICIpOwogICAgICAgICAgfQogICAgICAgICAgZWxzZQogICAgICAgICAgewogICAgICAgICAgICBlbGVtZW50LmZpbmQoJy5mYy10aXRsZScpLnByZXBlbmQoZXZlbnQubm9fb2ZfdXNlcnMrIi8iK2V2ZW50Lm1heF9wYXJ0aWNpcGFudHMrIiAtICIpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlCiAgICAgICAgewovLyBpZiBub3QgY2xhc3MgLSB3cml0aW5nIHRoZSBlbmR1c2VyIG5hbWUKICAgICAgICAgIGlmIChldmVudC5kdXJhdGlvbl9ldmVudCE9MCkgLy8gYWxzbyBpZiBub3QgaG91cnMgb2Ygd29yawogICAgICAgICAgewovLyBlbGVtZW50LmZpbmQoJy5mYy10aXRsZScpLmFwcGVuZCgiICgiK2V2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfZmlyc3RfbmFtZSsiICIrZXZlbnQuZXZlbnRVc2Vyc1swXS5idXNlcl9sYXN0X25hbWUrIikiKTsKLy8gY29uc29sZS5sb2coZXZlbnQuZXZlbnRVc2Vycyk7Ci8vIGNvbnNvbGUubG9nKGV2ZW50LmV2ZW50VXNlcnMubGVuZ3RoKTsKICAgICAgICAgICAgLy8gaWYgKGV2ZW50LmV2ZW50VXNlcnMubGVuZ3RoPjApCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAvLyBlbGVtZW50LmZpbmQoJy5mYy10aXRsZScpLnByZXBlbmQoIiIrZXZlbnQuZXZlbnRVc2Vyc1swXS5idXNlcl9maXJzdF9uYW1lKyIgIitldmVudC5ldmVudFVzZXJzWzBdLmJ1c2VyX2xhc3RfbmFtZSsiICgiKTsKICAgICAgICAgICAgICBlbGVtZW50LmZpbmQoJy5mYy10aXRsZScpLnByZXBlbmQoIiIrZXZlbnQuZXZlbnRfdXNlcl9jbGllbnRzKyIgKCIpOwogICAgICAgICAgICAgIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykuYXBwZW5kKCIpIik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KLy8gbG9nRGVidWcoImhlcmU0Iik7CiAgICAgICAgfQogICAgICAgIGlmIChldmVudC5pc19yZXBlYXRpbmcgPT0gMSkgewogICAgICAgICAgZWxlbWVudC5maW5kKCIuZmMtdGl0bGUiKS5hcHBlbmQoIiZuYnNwOzxpIGNsYXNzPSdmYSBmYS1yZXBlYXQnPjwvaT4mbmJzcDsiKTsKLy8gIGVsZW1lbnQuZmluZCgiLmZjLXRpdGxlIikuYXBwZW5kKCImbmJzcDs8aW1nIHNyYz0nL3B1YmxpYy9pbWFnZXMvcmVjdXJyaW5nLWljb24ucG5nJyB3aWR0aD0nMTBweCcgaGVpZ2h0PScxMHB4Jy8+Iik7CiAgICAgICAgfQogICAgICB9LAogICAgICBtaW5UaW1lOiAkZ0NhbGVuZGFyRGlzcGxheU1pblRpbWUsCiAgICAgIG1heFRpbWU6ICRnQ2FsZW5kYXJEaXNwbGF5TWF4VGltZSwKICAgICAgc2VsZWN0YWJsZTogZmFsc2UsCiAgICAgIHNlbGVjdEhlbHBlcjogZmFsc2UsCiAgICAgIHRpbWV6b25lOiBmYWxzZSwKICAgICAgaXNSVEw6IHRydWUsCiAgICAgIGxhbmc6ICJoZSIsIC8vIGtrCiAgICAgIGFsbERheVNsb3Q6IGZhbHNlLAogICAgICBsb2FkaW5nOiBmdW5jdGlvbihib29sKSB7CiAgICAgICAgaWYgKGJvb2wpIHsKICAgICAgICAgIGxvZ0RlYnVnKCdsb2FkaW5nIGNhbGVuZGFyMSAnICsgJHNjb3BlLmNhbGVuZGFyKTsKLy8gJCgnI2xvYWRpbmcnKS5zaG93KCk7CiAgICAgICAgfSBlbHNlIHsKLy8gJCgnI2xvYWRpbmcnKS5oaWRlKCk7CiAgICAgICAgICBsb2dEZWJ1ZygnZmluaXNoZWQgbG9hZGluZyBjYWxlbmRhciB4JyArICRzY29wZS5jYWxlbmRhcik7CiAgICAgICAgICAkc2NvcGUudXBkYXRlQ2FsZW5kYXJDZW50ZXJUaXRsZSgpOwogICAgICAgICAgbG9nRGVidWcoImFmdGVyIGNhbGVuZGFyIGxvYWQgdmlzaWJsZURhdGVTdGFydD0iK3VpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3Jykuc3RhcnQpOwogICAgICAgICAgdmlzaWJsZURhdGVTdGFydCA9IG5ldyBEYXRlKHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3Jykuc3RhcnQpOwogICAgICAgICAgZGF0ZVRvR29UbyA9IHZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSArICItIiArICgnMCcgKyAodmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpICsgMSkpLnNsaWNlKC0yKSArICItIiArICgnMCcgKyB2aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSkuc2xpY2UoLTIpOwovLyBjb25zb2xlLmxvZygiZGF0ZVRvR29UbyIrZGF0ZVRvR29Ubyk7Ci8vICRodHRwLmdldCgkZ0FwaVVSTFByZWZpeCArICIvZW5kdXNlci9ldmVudHMvc3VnZ2VzdC8iK3Zpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSsiLyIrdGhpc193ZWVrX2Z1bGxfeWVhcisiLyIrdGhpc193ZWVrX21vbnRoKyIvIit0aGlzX3dlZWtfZGF5X29mX21vbnRoKyIvIisgdGhpc193ZWVrX2hvdXJzKyAiLyIgKyB0aGlzX3dlZWtfbWludXRlcykudGhlbihmdW5jdGlvbihyZXNwb25zZSkKICAgICAgICAgICRzY29wZS5ldmVudF90eXBlX2lkPSRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkOwogICAgICAgICAgJHNjb3BlLnZpc2libGVEYXRlU3RhcnQ9dmlzaWJsZURhdGVTdGFydDsKLy8xMjEyMTIKLy8gaWYgKCRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkX2lzX2NsYXNzKQovLyB7Ci8vICAgJGh0dHAuZ2V0KCRnQXBpVVJMUHJlZml4ICsgIi9lbmR1c2VyL2V2ZW50cy9zdWdnZXN0Y2xhc3MvIiskc2NvcGUuZXZlbnRfdHlwZV9pZCsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSsiLyIrKCRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkrMSkrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0SG91cnMoKSArICIvIiArICRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKSsgIi8iICsgJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJfaWQpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpCi8vICAgewovLyAgICAgICAvLwkgICAgJHNjb3BlLm15RGF0YSA9IHJlc3BvbnNlLmRhdGE7Ci8vICAgICAgIC8vCQlsb2dEZWJ1ZygiZ3JpZG9wdGlvbnM9Iiskc2NvcGUuZ3JpZE9wdGlvbnMpOwovLyAgICAgICAkc2NvcGUuZXZlbnRzU3VnZ2VzdGVkID0gcmVzcG9uc2UuZGF0YTsKLy8gICAgICAgLy8gJHNjb3BlLmRhdGVUb0dvVG89ZGF0ZVRvR29UbzsKLy8gICB9KTsKLy8gfQovLyBlbHNlCi8vIHsKLy8gICAkaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3QvIiskc2NvcGUuZXZlbnRfdHlwZV9pZCsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSsiLyIrKCRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkrMSkrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0SG91cnMoKSArICIvIiArICRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkKLy8gICB7Ci8vICAgICAgIC8vCSAgICAkc2NvcGUubXlEYXRhID0gcmVzcG9uc2UuZGF0YTsKLy8gICAgICAgLy8JCWxvZ0RlYnVnKCJncmlkb3B0aW9ucz0iKyRzY29wZS5ncmlkT3B0aW9ucyk7Ci8vICAgICAgICRzY29wZS5ldmVudHNTdWdnZXN0ZWQgPSByZXNwb25zZS5kYXRhOwovLyAgICAgICAvLyAkc2NvcGUuZGF0ZVRvR29Ubz1kYXRlVG9Hb1RvOwovLyAgIH0pOwovLyB9CgovLyBhZnRlciBjYWxlbmRhciBpcyBsb2FkZWQgLSBsb2FkaW5nIGV2ZW50IHR5cGVzIGFuZCBzdWdnZXN0aW9uIGZvciBxdWV1ZXMKLy8gd2UgaGFuZGxlIHRoaW5ncyByZWxhdGVkIHRvIHRoZSBldmVudCB0eXBlcyBvbmx5IGFmdGVyIGxvYWRpbmcgdGhlbSAoYW5kIHRoZSBjYWxlbmRhcikKICAgICAgICAgIGdldEFsbEJ1c2luZXNzRXZlbnRUeXBlc05vU3lzdGVtKCRodHRwLCRzY29wZSwnZXZlbnRfdHlwZXMnLGdldEFsbEJ1c2luZXNzRXZlbnRUeXBlc05vU3lzdGVtX2NhbGxiYWNrKTsKCiAgICAgICAgICBmdW5jdGlvbiBnZXRBbGxCdXNpbmVzc0V2ZW50VHlwZXNOb1N5c3RlbV9jYWxsYmFjaygpCiAgICAgICAgICB7ICAgIC8vIGNoZWNraW5nIGlmIGNhbGVuZGFyIHNob3VsZCBzdGFydCB3aXRoIGEgc3BlY2lmaWMgZXZlbnQgdHlwZSBmb3Igc3VnZ2VzdGlvbnMKLy8gbG9nRGVidWcoIlggc2hhcmVkUHJvcGVydGllcy5nZXRfZXZlbnRfdHlwZV9mb3Jfc3VnZ2VzdGlvbnM9IitzaGFyZWRQcm9wZXJ0aWVzLmdldF9ldmVudF90eXBlX2Zvcl9zdWdnZXN0aW9ucygpKTsKICAgICAgICAgICAgaWYgKHNoYXJlZFByb3BlcnRpZXMuZ2V0X2V2ZW50X3R5cGVfZm9yX3N1Z2dlc3Rpb25zKCkhPW51bGwpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRfZXZlbnRfdHlwZV9pZD1zaGFyZWRQcm9wZXJ0aWVzLmdldF9ldmVudF90eXBlX2Zvcl9zdWdnZXN0aW9ucygpOwogICAgICAgICAgICAgICRzY29wZS5ldmVudFR5cGVTZWxlY3RlZCgkc2NvcGUuc2VsZWN0ZWRfZXZlbnRfdHlwZV9pZCk7CiAgICAgICAgICAgIH0KCi8vIGZpcnN0IGNoZWNraW5nIGlmIHRoZXJlJ3MgYW4gZXZlbnQgdG8gcmVzY2hlZHVsZQogICAgICAgICAgICBpZiAoc2hhcmVkUHJvcGVydGllcy5nZXRfZXZlbnRfcmVzY2hlZHVsZSgpIT1udWxsKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGU9dHJ1ZTsKICAgICAgICAgICAgICAkc2NvcGUucHJldmlvdXNfZXZlbnRfcmVzY2hlZHVsZV9ldmVudD1zaGFyZWRQcm9wZXJ0aWVzLmdldF9ldmVudF9yZXNjaGVkdWxlKCk7CiAgICAgICAgICAgICAgc2hhcmVkUHJvcGVydGllcy5zZXRfZXZlbnRfcmVzY2hlZHVsZShudWxsKTsKICAgICAgICAgICAgICBsb2dEZWJ1ZygiZ290IGV2ZW50IHRvIHJlc2NoZWR1bGUgIitKU09OLnN0cmluZ2lmeSgkc2NvcGUucHJldmlvdXNfZXZlbnRfcmVzY2hlZHVsZV9ldmVudCkpOwogICAgICAgICAgICAgIGxvZ0RlYnVnKCJyZXNjaGVkdWxlIGV2ZW50X3R5cGVfaWQ9Iiskc2NvcGUucHJldmlvdXNfZXZlbnRfcmVzY2hlZHVsZV9ldmVudC5ldmVudF90eXBlX2lkKTsKICAgICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRfZXZlbnRfdHlwZV9pZD0kc2NvcGUucHJldmlvdXNfZXZlbnRfcmVzY2hlZHVsZV9ldmVudC5ldmVudF90eXBlX2lkOwogICAgICAgICAgICAgICRzY29wZS5ldmVudFR5cGVTZWxlY3RlZCgpOwogICAgICAgICAgICB9Ci8vIGNoZWNraW5nIHNlbGVjdGVkIHVzZXIgb25seSBpZiB0aGVyZSdzIG5vIHNlbGVjdGVkIGV2ZW50IHRvIG1vdmUKICAgICAgICAgICAgZWxzZSBpZiAoc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpIT1udWxsKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgY29uc29sZS5sb2coImdvdCBwcmV2aW91cyBzZWxlY3RlZCB1c2VyICIrc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2VyX2ZpcnN0X25hbWUpOwogICAgICAgICAgICAgICRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VybmFtZT1zaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfZmlyc3RfbmFtZSsiICIrc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2VyX2xhc3RfbmFtZTsKICAgICAgICAgICAgICAkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcl9pZD1zaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzaW5lc3NfdXNlcl9pZDsKICAgICAgICAgICAgICBsb2dEZWJ1ZygiJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJfaWQ9Iiskc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcl9pZCk7CgogICAgICAgICAgICAgICRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyPXRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICB9LAovLyBzZWxlY3Q6IGZ1bmN0aW9uKHN0YXJ0LCBlbmQsIGFsbERheSkgewovLyAgICAgLy8gdmFyIHRpdGxlID0gcHJvbXB0KCdFdmVudCBUaXRsZTonICsgKHN0YXJ0ICsgMzUyODAwMDAwKSAvICg2MCAqIDEwMDApICsgIiAiICsgZW5kICsgIiAiICsgYWxsRGF5KTsKLy8gICAgIHRpdGxlID0gItep16LXldeqINek16LXmdec15XXqiI7Ci8vICAgICBpZiAodGl0bGUpIHsKLy8gICAgICAgICBsb2dEZWJ1ZygiY3JlYXRpbmcgZGV2ZW50IHN0YXJ0Iik7Ci8vICAgICAgICAgbG9nRGVidWcoInN0YXJ0PSIgKyBzdGFydCk7Ci8vICAgICAgICAgY2hlY2tEYXRlID0gbmV3IERhdGUoc3RhcnQpOwovLyAgICAgICAgIGxvZ0RlYnVnKCJjaGVjayBkYXRlID0gIiArIGNoZWNrRGF0ZSkKLy8gICAgICAgICBsb2dEZWJ1ZygiZW5kPSIgKyBlbmQpOwovLyAgICAgICAgIGVjb2xvciA9ICIjIiArICRzY29wZS5ldmVudENvbG9yOyAvL2dldFJhbmRvbUNvbG9yKCk7Ci8vCi8vCi8vICAgICAgICAgLy8gdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbXS5mdWxsQ2FsZW5kYXIoJ3JlcmVuZGVyRXZlbnRzJyk7Ci8vCi8vICAgICAgICAgY2FsZW5kYXIgPSAkc2NvcGUuY2FsZW5kYXJfbmFtZTsKLy8gICAgICAgICB0ZW1wX2xpbWl0X2lkID0gJGdDYWxlbmRhclRlbXBFbnZJRDEgLSBnZXRSYW5kb21JbnQoMTAsIDgwKTsKLy8gICAgICAgICBuZXdFdmVudCA9IHsKLy8gICAgICAgICAgICAgaWQ6IHRlbXBfbGltaXRfaWQsCi8vICAgICAgICAgICAgIHRpdGxlOiB0aXRsZSwKLy8gICAgICAgICAgICAgc3RhcnQ6IHN0YXJ0LAovLyAgICAgICAgICAgICBjb2xvcjogZWNvbG9yLAovLyAgICAgICAgICAgICBlbmQ6IGVuZCwKLy8gICAgICAgICAgICAgYWxsRGF5OiBmYWxzZSwKLy8gICAgICAgICAgICAgY2xhc3NOYW1lOiBbJ29wZW5TZXNhbWUnXQovLyAgICAgICAgICAgICAgICAgLy8gY29sb3I6IHJlc291cmNlLmV2ZW50Q29sb3IKLy8gICAgICAgICB9OwovLyAgICAgICAgIGNhbGVuZGFyID0gJHNjb3BlLmNhbGVuZGFyX25hbWU7Ci8vCi8vICAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVuZGVyRXZlbnQnLCBuZXdFdmVudCwgdHJ1ZSk7Ci8vICAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigndW5zZWxlY3QnKTsKLy8KLy8gICAgICAgICBsb2dEZWJ1ZygiY3JlYXRpbmcgZGV2ZW50IGVuZCIpOwovLyAgICAgICAgICRzY29wZS5hZGRFdmVudFRvRGF0YWJhc2Uoc3RhcnQsIGVuZCwgdGl0bGUsIGVjb2xvciwgdGVtcF9saW1pdF9pZCk7Ci8vCi8vICAgICB9Ci8vIH0KICAgIH0KICB9Owp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ0hvdXJzT2ZXb3JrQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRjb21waWxlLCAkbG9jYXRpb24sIHVpQ2FsZW5kYXJDb25maWcsICR1aWJNb2RhbCkgewogIGxvZ0RlYnVnKCdIb3Vyc09mV29yayBDb250cm9sbGVyJyk7CgogIGxvZ0RlYnVnKCIkbG9jYXRpb24uc2VhcmNoKCkuc3RhcnQ9IiArICRsb2NhdGlvbi5zZWFyY2goKS5zdGFydCk7CiAgaWYgKHR5cGVvZiAkbG9jYXRpb24uc2VhcmNoKCkuc3RhcnQgPT0gJ3VuZGVmaW5lZCcpIHsKICAgIGN1cnJEZWZhdWx0RGF0ZSA9ICRnSG91cjBkYXRlOwogICAgJHNjb3BlLmZpeGVkU2NoZWR1bGUgPSB0cnVlOwogICAgJHNjb3BlLmNhbGVuZGFyVGl0bGVDZW50ZXIgPSAi16nXoteV16og16TXoteZ15zXldeqINen15HXldei15XXqiI7CiAgICBsb2dEZWJ1Zygi16nXoteV16og16TXoteZ15zXldeqINen15HXldei15XXqiIpOwogICAgaG91cnNPZldvcmtEZWZhdWx0Vmlldz0nZG9udFNob3dEYXRlJzsKICB9IGVsc2UgewogICAgY3VyckRlZmF1bHREYXRlID0gJGxvY2F0aW9uLnNlYXJjaCgpLnN0YXJ0OwogICAgJHNjb3BlLmZpeGVkU2NoZWR1bGUgPSBmYWxzZTsKLy8gJHNjb3BlLmNhbGVuZGFyVGl0bGVDZW50ZXIgPSAi16nXoteV16og16TXoteZ15zXldeqINen15HXldei15XXqiI7CiAgICBob3Vyc09mV29ya0RlZmF1bHRWaWV3PSdhZ2VuZGFXZWVrJzsKICB9CgoKICAkc2NvcGUudmlzaWJsZURhdGUgPSBbXTsKICAkc2NvcGUuY2FsZW5kYXIgPSAnY2FsZW5kYXJfaG91cnNfb2Zfd29yayc7CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnRUeXBlID0gW107CgogIGdldEFsbEJ1c2luZXNzRXZlbnRUeXBlcygkaHR0cCwkc2NvcGUsJ2V2ZW50X3R5cGVzJyxnZXRBbGxCdXNpbmVzc0V2ZW50VHlwZXNfY2FsbGJhY2spOwoKICBmdW5jdGlvbiBnZXRBbGxCdXNpbmVzc0V2ZW50VHlwZXNfY2FsbGJhY2soKQogIHsKICAgICRzY29wZS5zZWxlY3RFdmVudFR5cGUoJHNjb3BlLmV2ZW50X3R5cGVzWzBdKTsKICB9CiAgJHNjb3BlLmJhY2tUb0NhbGVuZGFyID0gZnVuY3Rpb24oKSB7CiAgICB2aXNpYmxlRGF0ZVN0YXJ0ID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5zdGFydCk7CiAgICBkYXRlVG9Hb1RvID0gdmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpICsgIi0iICsgKCcwJyArICh2aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkgKyAxKSkuc2xpY2UoLTIpICsgIi0iICsgKCcwJyArIHZpc2libGVEYXRlU3RhcnQuZ2V0RGF0ZSgpKS5zbGljZSgtMik7CiAgICAkbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2NhbGVuZGFyJykuc2VhcmNoKHsKICAgICAgc3RhcnQ6IGRhdGVUb0dvVG8KICAgIH0pOwogIH0KICAkc2NvcGUuc2VsZWN0RXZlbnRUeXBlID0gZnVuY3Rpb24oZXZlbnRUeXBlKSB7CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudFR5cGUgPSBldmVudFR5cGU7CiAgICBsb2dEZWJ1Zygic2VsZWN0ZWQgRXZlbnQgVHlwZSA9ICIgKyAkc2NvcGUuc2VsZWN0ZWRFdmVudFR5cGUuZXZlbnRfdHlwZV9pZCArICIsICIgKyAkc2NvcGUuc2VsZWN0ZWRFdmVudFR5cGUuZXZlbnRfdHlwZV9uYW1lKTsKICAgIGt1emVJc0NhbGVuZGFyRHJhZ2dibGUgPSAkc2NvcGUuc2VsZWN0ZWRFdmVudFR5cGUuZGlmZl9yYW5nZTsKICB9OwoKICAkc2NvcGUuY2hhbmdlRXZlbnRDb2xvciA9IGZ1bmN0aW9uKG5ld0NvbG9yKSB7CiAgICAkc2NvcGUuZXZlbnRDb2xvciA9IG5ld0NvbG9yOwogICAgYWxsbEV2ZW50c0FycmF5ID0gdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignY2xpZW50RXZlbnRzJyk7CiAgICBmb3IgKGkgaW4gYWxsbEV2ZW50c0FycmF5KSB7CiAgICAgIGFsbGxFdmVudHNBcnJheVtpXS5jb2xvciA9ICIjIiArIG5ld0NvbG9yOwogICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCd1cGRhdGVFdmVudCcsIGFsbGxFdmVudHNBcnJheVtpXSk7CiAgICB9CiAgfTsKCiAgJHNjb3BlLmV2ZW50Q2xpY2tNb2R1bGUgPSBmdW5jdGlvbihzZWxlY3RlZEV2ZW50LCBzaXplKSB7CiAgICBsb2dEZWJ1Zygic2VsZWN0ZWQgRXZlbnQgdGl0bGU9IiArIHNlbGVjdGVkRXZlbnQudGl0bGUpOwoKCiAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAgICAgYW5pbWF0aW9uOiBmYWxzZSwKICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfbGltaXRhdGlvbl9kZXRhaWxzLmh0bWwnLAogICAgICBjb250cm9sbGVyOiAnZXZlbnREZXRhaWxzSG91cnNPZldvcmtNb2RhbENvbnRyb2xsZXInLAogICAgICBzaXplOiBzaXplLAogICAgICByZXNvbHZlOiB7CiAgICAgICAgc2VsZWN0ZWRFdmVudDogZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gc2VsZWN0ZWRFdmVudDsKICAgICAgICB9LAogICAgICAgIGZpeGVkU2NoZWR1bGU6IGZ1bmN0aW9uICgpCiAgICAgICAgewogICAgICAgICAgcmV0dXJuICRzY29wZS5maXhlZFNjaGVkdWxlOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CgogICAgbW9kYWxJbnN0YW5jZS5yZXN1bHQudGhlbihmdW5jdGlvbihzZWxlY3RlZEl0ZW0pIHsKICAgICAgJHNjb3BlLnNlbGVjdGVkID0gc2VsZWN0ZWRJdGVtOwogICAgfSwgZnVuY3Rpb24oKSB7CiAgICAgIGxvZ0RlYnVnKCdNb2RhbCBkaXNtaXNzZWQgYXQ6ICcgKyBuZXcgRGF0ZSgpKTsKICAgIH0pOwogIH07CgoKICB2YXIgZGF0ZSA9IG5ldyBEYXRlKCk7CiAgdmFyIGQgPSBkYXRlLmdldERhdGUoKTsKICB2YXIgbSA9IGRhdGUuZ2V0TW9udGgoKTsKICB2YXIgeSA9IGRhdGUuZ2V0RnVsbFllYXIoKTsKCgogIGZ1bmN0aW9uIGdldFRpbWVTdGFtcChub3cpIHsKICAgIHJldHVybiAoKG5vdy5nZXRNb250aCgpICsgMSkgKyAnLycgKyAobm93LmdldERhdGUoKSkgKyAnLycgKyBub3cuZ2V0RnVsbFllYXIoKSArICIgIiArIG5vdy5nZXRIb3VycygpICsgJzonICsgKChub3cuZ2V0TWludXRlcygpIDwgMTApID8gKCIwIiArIG5vdy5nZXRNaW51dGVzKCkpIDogKG5vdy5nZXRNaW51dGVzKCkpKSArICc6JyArICgobm93LmdldFNlY29uZHMoKSA8IDEwKSA/ICgiMCIgKyBub3cKICAgICAgICAuZ2V0U2Vjb25kcygpKSA6IChub3cuZ2V0U2Vjb25kcygpKSkpOwogIH0KCgogIC8qIENoYW5nZSBWaWV3ICovCiAgJHNjb3BlLmNoYW5nZVZpZXcgPSBmdW5jdGlvbih2aWV3LCBjYWxlbmRhcikgewogICAgbG9nRGVidWcoImNoYW5nZSB2aWV3ICIgKyB2aWV3KTsKICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2NoYW5nZVZpZXcnLCB2aWV3KTsKICB9OwogIC8qIENoYW5nZSBWaWV3ICovCgogICRzY29wZS5yZW5kZXJDYWxlbmRlciA9IGZ1bmN0aW9uKGNhbGVuZGFyKSB7CiAgICAkdGltZW91dChmdW5jdGlvbigpIHsKICAgICAgaWYgKHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXSkgewogICAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlbmRlcicpOwogICAgICB9CiAgICB9KTsKICB9OwoKICAkc2NvcGUuY2hhbmdlU2VsZWN0YWJsZSA9IGZ1bmN0aW9uKCkgewogICAga3V6ZUlzQ2FsZW5kYXJEcmFnZ2JsZSA9ICFrdXplSXNDYWxlbmRhckRyYWdnYmxlOwogICAgY2FsZW5kYXIgPSAnY2FsZW5kYXJfaG91cnNfb2Zfd29yayc7Ci8vIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5jYWxlbmRhci5vcHRpb25zLnNlbGVjdGFibGUgPSBmYWxzZTsKICAgIHZpZXcgPSB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdvcHRpb24nLCAnc2VsZWN0YWJsZScsIGZhbHNlKTsKLy8gdmlldy5jYWxlbmRhci5vcHRpb25zLnNlbGVjdGFibGUgPSBmYWxzZTsKICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlbmRlcicpOwoKICB9CiAgLyogY29uZmlnIG9iamVjdCAqLwoKICAkc2NvcGUuY2FsZW5kYXJfaG91cnNfb2Zfd29ya19jb25maWcgPSB7CiAgICBjYWxlbmRhcjogewogICAgICBoZWlnaHQ6ICdhdXRvJywKICAgICAgZWRpdGFibGU6IHRydWUsCi8vIGhlYWRlcjogewovLyAgICAgbGVmdDogJycsCi8vICAgICBjZW50ZXI6ICcnLAovLyAgICAgcmlnaHQ6ICcnCi8vIH0sCiAgICAgIGhlYWRlcjogJycsCi8vIGhlYWRlcjogewovLyAgICAgbGVmdDogJ3RpdGxlJywKLy8gICAgIGNlbnRlcjogJycsCi8vICAgICByaWdodDogJ3RvZGF5IHByZXYsbmV4dCcKLy8gfSwKLy8gZGVmYXVsdFZpZXc6ICdhZ2VuZGFXZWVrJywKICAgICAgdmlld3M6IHsKICAgICAgICBkb250U2hvd0RhdGU6IHsKICAgICAgICAgIHR5cGU6ICdhZ2VuZGFXZWVrJywKICAgICAgICAgIGR1cmF0aW9uOiB7CiAgICAgICAgICAgIGRheXM6IDcKICAgICAgICAgIH0sCiAgICAgICAgICB0aXRsZTogJ0FwZXJ0dXJhJywKICAgICAgICAgIGNvbHVtbkZvcm1hdDogJ2RkZGQnIC8vIEZvcm1hdCB0aGUgZGF5IHRvIG9ubHkgc2hvdyBsaWtlICdNb25kYXknCi8vIGhpZGRlbkRheXM6IFswLCA2XSAvLyBIaWRlIFN1bmRheSBhbmQgU2F0dXJkYXk/CiAgICAgICAgfSwKICAgICAgICBkb1Nob3dEYXRlOiB7CiAgICAgICAgICB0eXBlOiAnYWdlbmRhV2VlaycsCiAgICAgICAgICBkdXJhdGlvbjogewogICAgICAgICAgICBkYXlzOiA3CiAgICAgICAgICB9LAogICAgICAgICAgdGl0bGU6ICdBcGVydHVyYScsCgovLyBoaWRkZW5EYXlzOiBbMCwgNl0gLy8gSGlkZSBTdW5kYXkgYW5kIFNhdHVyZGF5PwogICAgICAgIH0KICAgICAgfSwKICAgICAgZXZlbnREcm9wOiBmdW5jdGlvbihldmVudCwgZGF5RGVsdGEsIG1pbnV0ZURlbHRhLCBhbGxEYXksIHJldmVydEZ1bmMsIHVpQ2FsZW5kYXJDb25maWcpIHsKICAgICAgICBsb2dEZWJ1ZygiZXZlbnRkcm9wIiArIGV2ZW50LnRpdGxlICsgIigiICsgZXZlbnQuaWQgKyAiKSBtb3ZlZCAiICsgbWludXRlRGVsdGEgKyAiIG1pbnV0ZXMiKTsKICAgICAgICBsb2dEZWJ1Zygib2xkIHN0YXJ0PSIgKyBldmVudC5zdGFydCArICIsIG9sZCBlbmQ9IiArIGV2ZW50LmVuZCk7CiAgICAgICAgJHNjb3BlLnVwZGF0ZUxpbWl0YXRpb25EYXRhYmFzZShldmVudC5zdGFydCwgZXZlbnQuZW5kLCBldmVudC5pZCwgZXZlbnQudGVtcF9saW1pdF9pZCwgZXZlbnQpOwogICAgICB9LAogICAgICBldmVudFJlc2l6ZTogZnVuY3Rpb24oZXZlbnQsIGRlbHRhLCByZXZlcnRGdW5jKSB7CiAgICAgICAgbG9nRGVidWcoImV2ZW50cmVzaXplLCBldmVudC5lbmQ9IiArIGV2ZW50LmVuZCk7CiAgICAgICAgJHNjb3BlLnVwZGF0ZUxpbWl0YXRpb25EYXRhYmFzZShldmVudC5zdGFydCwgZXZlbnQuZW5kLCBldmVudC5pZCwgZXZlbnQudGVtcF9saW1pdF9pZCwgZXZlbnQpOwogICAgICB9LAogICAgICBkZWZhdWx0VmlldzogaG91cnNPZldvcmtEZWZhdWx0VmlldywKICAgICAgZXZlbnRDbGljazogZnVuY3Rpb24oY2FsRXZlbnQsIGpzRXZlbnQsIHZpZXcpIHsKICAgICAgICBsb2dEZWJ1ZygiZXZlbnQgY2xpY2tlZCAiICsgY2FsRXZlbnQudGl0bGUgKyAiKGlkPSIgKyBjYWxFdmVudC5pZCArICIsIGRheV9saW1pdF9pZD0iICsgY2FsRXZlbnQuZGF5X2xpbWl0X2lkICsgIiwgdGVtcF9saW1pdF9pZD0iICsgY2FsRXZlbnQudGVtcF9saW1pdF9pZCArICIsIGxpbWl0X2lkPSIgKyBjYWxFdmVudC5saW1pdF9pZCArICIpIHN0YXJ0PSIgKyBjYWxFdmVudC5zdGFydCArICIsIGVuZD0iICsgY2FsRXZlbnQuZW5kKTsKICAgICAgICAkc2NvcGUuZXZlbnRDbGlja01vZHVsZShjYWxFdmVudCk7Ci8vIGNoYW5nZSB0aGUgYm9yZGVyIGNvbG9yIGp1c3QgZm9yIGZ1bgovLyAkKHRoaXMpLmNzcygnYm9yZGVyLWNvbG9yJywgJ3JlZCcpOwoKICAgICAgfSwKICAgICAgZXZlbnRSZW5kZXI6IGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KQogICAgICB7CiAgICAgICAgY29uc29sZS5sb2coZXZlbnQpOwogICAgICAgIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZChldmVudC5sb2NhdGlvbl9uYW1lKyIgLyA8YnIvPiIpOwogICAgICAgIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZChldmVudC5pbnN0cnVjdG9yX25hbWUrIiAvIDxici8+Iik7Ci8vIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZCgiIitldmVudC5ldmVudFVzZXJzWzBdLmJ1c2VyX2ZpcnN0X25hbWUrIiAiK2V2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfbGFzdF9uYW1lKyIgKCIpOwoKLy8gY29uc29sZS5sb2coInJlbmRlciBsaW1pdGF0aW9uICIrSlNPTi5zdHJpbmdpZnkoZXZlbnQpKTsKLy8gaWYgKGV2ZW50LmlzX2NsYXNzPT0xKQovLyB7Ci8vICAgLy8gaWYgY2xhc3MgYWRkaW5nIG51bWJlciBvZiBwYXJ0aWNpcGFudHMKLy8gICBpZiAoZXZlbnQubm9fb2Zfd2FpdGluZ191c2Vycz4wKQovLyAgIHsKLy8gICAgIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZChldmVudC5ub19vZl91c2VycysiLyIrZXZlbnQubWF4X3BhcnRpY2lwYW50cysgIiAoIitldmVudC5ub19vZl93YWl0aW5nX3VzZXJzKyIpIisiIC0gIik7Ci8vICAgfQovLyAgIGVsc2UKLy8gICB7Ci8vICAgICBlbGVtZW50LmZpbmQoJy5mYy10aXRsZScpLnByZXBlbmQoZXZlbnQubm9fb2ZfdXNlcnMrIi8iK2V2ZW50Lm1heF9wYXJ0aWNpcGFudHMrIiAtICIpOwovLyAgIH0KLy8gfQovLyBlbHNlCi8vIHsKLy8gICAvLyBpZiBub3QgY2xhc3MgLSB3cml0aW5nIHRoZSBlbmR1c2VyIG5hbWUKLy8gICBpZiAoZXZlbnQuZHVyYXRpb25fZXZlbnQhPTApIC8vIGFsc28gaWYgbm90IGhvdXJzIG9mIHdvcmsKLy8gICB7Ci8vICAgICAvLyBlbGVtZW50LmZpbmQoJy5mYy10aXRsZScpLmFwcGVuZCgiICgiK2V2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfZmlyc3RfbmFtZSsiICIrZXZlbnQuZXZlbnRVc2Vyc1swXS5idXNlcl9sYXN0X25hbWUrIikiKTsKLy8gICAgIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZCgiIitldmVudC5ldmVudFVzZXJzWzBdLmJ1c2VyX2ZpcnN0X25hbWUrIiAiK2V2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfbGFzdF9uYW1lKyIgKCIpOwovLyAgICAgZWxlbWVudC5maW5kKCcuZmMtdGl0bGUnKS5hcHBlbmQoIikiKTsKLy8gICB9Ci8vICAgLy8gbG9nRGVidWcoImhlcmU0Iik7Ci8vIH0KLy8gaWYgKGV2ZW50LmlzX3JlcGVhdGluZyA9PSAxKSB7Ci8vICAgICBlbGVtZW50LmZpbmQoIi5mYy10aXRsZSIpLnByZXBlbmQoIiZuYnNwOzxpIGNsYXNzPSdmYSBmYS1yZXBlYXQnPjwvaT4mbmJzcDsiKTsKLy8gICAgIC8vICBlbGVtZW50LmZpbmQoIi5mYy10aXRsZSIpLmFwcGVuZCgiJm5ic3A7PGltZyBzcmM9Jy9wdWJsaWMvaW1hZ2VzL3JlY3VycmluZy1pY29uLnBuZycgd2lkdGg9JzEwcHgnIGhlaWdodD0nMTBweCcvPiIpOwovLyB9CiAgICAgIH0sCiAgICAgIG1pblRpbWU6ICRnQ2FsZW5kYXJEaXNwbGF5TWluVGltZSwKICAgICAgbWF4VGltZTogJGdDYWxlbmRhckRpc3BsYXlNYXhUaW1lLAogICAgICBzZWxlY3RhYmxlOiB0cnVlLAogICAgICBzZWxlY3RIZWxwZXI6IGZhbHNlLAogICAgICB0aW1lem9uZTogZmFsc2UsCiAgICAgIGlzUlRMOiB0cnVlLAogICAgICBsYW5nOiAiaGUiLAogICAgICBzZWxlY3RDb25zdHJhaW50OiB7CiAgICAgICAgc3RhcnQ6ICcwMDowMScsCiAgICAgICAgZW5kOiAnMjM6NTknLAogICAgICB9LAogICAgICBkZWZhdWx0RGF0ZTogbW9tZW50KGN1cnJEZWZhdWx0RGF0ZSksCiAgICAgIGFsbERheVNsb3Q6IGZhbHNlLAogICAgICBsb2FkaW5nOiBmdW5jdGlvbihib29sKSB7CiAgICAgICAgaWYgKGJvb2wpIHsKICAgICAgICAgIGxvZ0RlYnVnKCdsb2FkaW5nIGNhbGVuZGFyMiAnICsgJHNjb3BlLmNhbGVuZGFyKTsKCi8vICQoJyNsb2FkaW5nJykuc2hvdygpOwogICAgICAgIH0gZWxzZSB7Ci8vICQoJyNsb2FkaW5nJykuaGlkZSgpOwogICAgICAgICAgbG9nRGVidWcoJ2ZpbmlzaGVkIGxvYWRpbmcgY2FsZW5kYXIgJyArICRzY29wZS5jYWxlbmRhcik7CiAgICAgICAgICBpZiAoISRzY29wZS5maXhlZFNjaGVkdWxlKSB7CiAgICAgICAgICAgICRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlKCk7CiAgICAgICAgICB9Ci8vICRzY29wZS5iYWNrVG9GaXhlZCgpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgc2VsZWN0OiBmdW5jdGlvbihzdGFydCwgZW5kLCBhbGxEYXkpIHsKLy8gdGhpcyBpcyBjYWxsZWQgd2hlbiBjcmVhdGluZyBhIG5ldyBibG9jawogICAgICAgICRzY29wZS5jcmVhdGVMaW1pdGF0aW9uQmxvY2soc3RhcnQsIGVuZCk7CiAgICAgIH0KICAgIH0KICB9OwoKLy8gY3JlYXRlIGxpbWl0YXRpb24gYmxvY2sKICAkc2NvcGUuY3JlYXRlTGltaXRhdGlvbkJsb2NrID0gZnVuY3Rpb24oc3RhcnQsIGVuZCkKICB7CiAgICBsb2dEZWJ1ZygiZnVuY3Rpb246IGNyZWF0ZUxpbWl0YXRpb25CbG9jayIpOwogICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2xpbWl0YXRpb25fY3JlYXRlLnBocCcsCiAgICAgIHNpemU6ICd4cycsCiAgICAgIGNvbnRyb2xsZXI6ICdidXNpbmVzc19tb2RhbF9saW1pdGF0aW9uX2NyZWF0ZScsCiAgICAgIHJlc29sdmU6IHsKICAgICAgICBzdGFydDogZnVuY3Rpb24oKQogICAgICAgIHsKICAgICAgICAgIHJldHVybiBzdGFydDsKICAgICAgICB9LAogICAgICAgIGVuZDogZnVuY3Rpb24oKQogICAgICAgIHsKICAgICAgICAgIHJldHVybiBlbmQ7CiAgICAgICAgfSwKICAgICAgICBmaXhlZFNjaGVkdWxlOiBmdW5jdGlvbiAoKQogICAgICAgIHsKICAgICAgICAgIHJldHVybiAkc2NvcGUuZml4ZWRTY2hlZHVsZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogIH0KICAkc2NvcGUudXBkYXRlQ2FsZW5kYXJDZW50ZXJUaXRsZSA9IGZ1bmN0aW9uKCkgewogICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKTsKCiAgICB2aXNpYmxlRGF0ZVN0YXJ0ID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5zdGFydCk7CiAgICB2aXNpYmxlRGF0ZUVuZCA9IG5ldyBEYXRlKHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3JykuZW5kKTsKCiAgICAkc2NvcGUuY2FsZW5kYXJUaXRsZUNlbnRlciA9IHZpc2libGVEYXRlU3RhcnQuZ2V0RGF0ZSgpICsgIiAiICsgbW9udGhOYW1lc1t2aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCldICsKICAgICAgICAiIOKAlCAiICsgdmlzaWJsZURhdGVFbmQuZ2V0RGF0ZSgpICsgIiAiICsgbW9udGhOYW1lc1t2aXNpYmxlRGF0ZUVuZC5nZXRNb250aCgpXSArCiAgICAgICAgIiAiICsgdmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpOwogIH07CiAgLyogZXZlbnQgc291cmNlcyBhcnJheSovCiAgJHNjb3BlLmV2ZW50U291cmNlcyA9IFt7CiAgICB1cmw6ICcvYXBpL2FkbWluL2NhbGVuZGFyL2xpbWl0YXRpb25zL3BlcmRheS9nZXRwb3N0JywKICAgIHR5cGU6ICdQT1NUJwogIH1dOwoKLy8gJHNjb3BlLmdldEV2ZW50cyA9IGZ1bmN0aW9uKCkgewovLyAgICAgY2FsZW5kYXIgPSAnY2FsZW5kYXJfaG91cnNfb2Zfd29yayc7Ci8vICAgICBhbGxsRXZlbnRzQXJyYXkgPSB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdjbGllbnRFdmVudHMnKTsKLy8gICAgIGZvciAoaSBpbiBhbGxsRXZlbnRzQXJyYXkpIHsKLy8gICAgICAgICBsb2dEZWJ1ZyhhbGxsRXZlbnRzQXJyYXlbaV0pOwovLyAgICAgfQovLwovLyB9CgogICRzY29wZS5nb3RvVG9kYXkgPSBmdW5jdGlvbigpIHsKICAgICRzY29wZS5nb3RvRGF0ZShuZXcgRGF0ZSgpKTsKICB9CiAgJHNjb3BlLmdvdG9OZXh0ID0gZnVuY3Rpb24oKSB7CiAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignbmV4dCcpOwogICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlbW92ZUV2ZW50cycpOwogICAgJHNjb3BlLnVwZGF0ZUNhbGVuZGFyQ2VudGVyVGl0bGUoKTsKICB9CiAgJHNjb3BlLmdvdG9QcmV2ID0gZnVuY3Rpb24oKSB7CiAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVtb3ZlRXZlbnRzJyk7CiAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncHJldicpOwogICAgJHNjb3BlLnVwZGF0ZUNhbGVuZGFyQ2VudGVyVGl0bGUoKTsKICB9CiAgJHNjb3BlLmdvdG9EYXRlID0gZnVuY3Rpb24obmV3ZGF0ZSkgewogICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dvdG9EYXRlJywgbmV3ZGF0ZSk7CiAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignY2hhbmdlVmlldycsICdhZ2VuZGFXZWVrJyk7CiAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVtb3ZlRXZlbnRzJyk7CiAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwoKICAgICRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlKCk7CiAgICAkc2NvcGUuZml4ZWRTY2hlZHVsZSA9IGZhbHNlOwogIH0KCiAgJHNjb3BlLmJhY2tUb0ZpeGVkID0gZnVuY3Rpb24oKSB7CiAgICAkc2NvcGUuZml4ZWRTY2hlZHVsZSA9IHRydWU7CiAgICAkc2NvcGUuY2FsZW5kYXJUaXRsZUNlbnRlciA9ICLXqdei15XXqiDXpNei15nXnNeV16og16fXkdeV16LXldeqIjsKICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdjaGFuZ2VWaWV3JywgJ2RvbnRTaG93RGF0ZScpOwogICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dvdG9EYXRlJywgbW9tZW50KCRnSG91cjBkYXRlKSk7CiAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVtb3ZlRXZlbnRzJyk7CiAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwoKICB9CgovLyAkc2NvcGUuZGVsZXRlQWxsRXZlbnRzID0gZnVuY3Rpb24oKSB7Ci8vICAgICBjYWxlbmRhciA9ICdjYWxlbmRhcl9ob3Vyc19vZl93b3JrJzsKLy8gICAgIGFsbGxFdmVudHNBcnJheSA9IHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2NsaWVudEV2ZW50cycpOwovLyAgICAgZm9yIChpIGluIGFsbGxFdmVudHNBcnJheSkgewovLyAgICAgICAgIGxvZ0RlYnVnKGFsbGxFdmVudHNBcnJheVtpXSk7Ci8vICAgICAgICAgJHNjb3BlLmRlbGV0ZUNhbGVuZGFySlNFdmVudChjYWxlbmRhciwgYWxsbEV2ZW50c0FycmF5W2ldLmlkKTsKLy8gICAgICAgICAkc2NvcGUuZGVsZXRlQ2FsZW5kYXJEQkV2ZW50KGFsbGxFdmVudHNBcnJheVtpXS5pZCk7Ci8vICAgICB9Ci8vCi8vIH0KICAkc2NvcGUudXBkYXRlTGltaXRhdGlvbkRhdGFiYXNlID0gZnVuY3Rpb24oc3RhcnRfcGFyYW0sIGVuZF9wYXJhbSwgZXZlbnRfaWQsIHRlbXBfbGltaXRfaWQsIHRoZWV2ZW50KSB7CgogICAgbG9nRGVidWcoInVwZGF0ZUxpbWl0YXRpb25EYXRhYmFzZSBzdGFydD0iICsgc3RhcnRfcGFyYW0gKyAiLCBlbmQ9IiArIGVuZF9wYXJhbSArICIsZXZlbnRfaWQ9IiArIGV2ZW50X2lkKTsKCiAgICBmdW5jdGlvbiB1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25fZmFpbHVyZSgpCiAgICB7CiAgICAgIGNhbGVuZGFyID0gImNhbGVuZGFyX2hvdXJzX29mX3dvcmsiOwogICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZWZldGNoRXZlbnRzJyk7CiAgICB9Ci8vIGlmIHRoZSBldmVudCB0aGF0IGlzIGdldHRpbmcgdXBkYXRlZCBpcyBhbiBldmVudCBmcm9tIDE5NzAgKG5vdCBwZXJkYXkpCi8vIHRoZW4gd2UgYWRkIGEgbmV3IHBlcmRheSBsaW1pdGF0aW9uIHdpdGggbGltaXRfaWQgb2YgdGhlIDE5NzAgbGltaXRhdGlvbnMgLSB3aXRoIHRoZSBuZXcgdGltZXMuCgovLyBvdGhlcndpc2Ugd2UganVzdCB1cGRhdGUgdGhlIHBlcmRheSBsaW1pdGF0aW9uCgogICAgaWYgKCRzY29wZS5maXhlZFNjaGVkdWxlKSAvLyBmaXhlZCBzY2hlZHVsZSB2cyBzcGVjaWZpYyB3ZWVkL2RheSBsaW1pdGF0aW9uCiAgICB7CiAgICAgIHRoZWRhdGEgPSB7CiAgICAgICAgc3RhcnRfZGF0ZTogc3RhcnRfcGFyYW0sCiAgICAgICAgZW5kX2RhdGU6IGVuZF9wYXJhbSwKICAgICAgICB0ZW1wX2xpbWl0X2lkOiB0ZW1wX2xpbWl0X2lkLAogICAgICAgIGxpbWl0X2lkOiBldmVudF9pZAogICAgICB9OwoKICAgICAgdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uKCRodHRwLCRzY29wZSx0aGVkYXRhLGV2ZW50X2lkLCBudWxsLCB1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25fZmFpbHVyZSk7CiAgICB9CiAgICBlbHNlIC8vIG5vdCBmaXhlZCBzY2hlZHVsZSAtIGRhaWx5L3dlZWtseSBsaW1pdGF0aW9ucwogICAgewogICAgICBpZiAoKHRoZWV2ZW50LmxpbWl0X2lkICE9IG51bGwpICYgKHRoZWV2ZW50LmRheV9saW1pdF9pZCA9PSAtMSkpIC8vIGV2ZW50IGxpbWl0YXRpb24gaGFzIGxpbWl0X2lkIHNvIGl0cyBhbiAxOTcwIGV2ZW50Ci8vIG5lZWQgdG8gYWRkIGEgbmV3IHBlcmRheSBsaW1pdGF0aW9uIHRoYXQgcG9pbnQgKGxpbWl0X2lkKSB0byB0aGUgb2xkIDE5NzAgZXZlbnQgdG8gY2FuY2VsIGl0CiAgICAgIHsKICAgICAgICB0ZW1wX2xpbWl0X2lkID0gY2FsY190ZW1wX2xpbWl0X2lkKCk7CiAgICAgICAgdGhlZXZlbnQudGVtcF9saW1pdF9pZCA9IHRlbXBfbGltaXRfaWQ7CiAgICAgICAgdGhlZXZlbnQuZGF5X2xpbWl0X2lkID0gdGVtcF9saW1pdF9pZDsKLy8gdGhlIG1vdmVkIGV2ZW50IGluIHRoZSBjYWxlbmRhciBub3cgaGFzIGRheV9saW1pdF9pZCBhbmQgdGVtcF9saW1pdF9pZAovLyBpZiBpdHMgbG9hZGVkIGZyb20gdGhlIGRiLCBpdCB3aWxsIG9ubHkgaGF2ZSBkYXlfbGltaXRfaWQgKGFuZCBub3QgdGhlIHRlbXAgb25lKQogICAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWydjYWxlbmRhcl9ob3Vyc19vZl93b3JrJ10uZnVsbENhbGVuZGFyKCd1cGRhdGVFdmVudCcsIHRoZWV2ZW50KTsKCiAgICAgICAgdGhlZGF0YSA9IHsKICAgICAgICAgIHN0YXJ0X2RhdGU6IHN0YXJ0X3BhcmFtLAogICAgICAgICAgZW5kX2RhdGU6IGVuZF9wYXJhbSwKICAgICAgICAgIGNvbG9yOiB0aGVldmVudC5jb2xvciwKICAgICAgICAgIHRlbXBfbGltaXRfaWQ6IHRlbXBfbGltaXRfaWQsCiAgICAgICAgICBldmVudF90eXBlX2lkOiB0aGVldmVudC5ldmVudF90eXBlX2lkLAogICAgICAgICAgZXZlbnRfdHlwZXM6IHRoZWV2ZW50LmV2ZW50X3R5cGVzLAogICAgICAgICAgbG9jYXRpb25faWQ6IHRoZWV2ZW50LmxvY2F0aW9uX2lkLAogICAgICAgICAgZW1wX2lkOiB0aGVldmVudC5lbXBfaWQsCiAgICAgICAgICBsaW1pdF9pZDogdGhlZXZlbnQuaWQsCiAgICAgICAgICB0aXRsZTogdGhlZXZlbnQudGl0bGUKICAgICAgICB9OwogICAgICAgIGNyZWF0ZUNhbGVuZGFyTGltaXRhdGlvblBlckRheSgkaHR0cCwkc2NvcGUsdGhlZGF0YSxudWxsLCB1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25fZmFpbHVyZSk7CgogICAgICB9CiAgICAgIGVsc2UgLy8gZXZlbnQgbGltaXRhdGlvbiB0byBtb3ZlL3VwZGF0ZSBoYXMgbm8gbGltaXRfaWQgLSBzbyB0aGlzIGlzIG5ldyBwZXJkYXkgZXZlbnQgLSB3ZSBqdXN0IHVwZGF0ZSBpdAogICAgICB7CiAgICAgICAgdGhlZGF0YT0gewogICAgICAgICAgc3RhcnRfZGF0ZTogc3RhcnRfcGFyYW0sCiAgICAgICAgICBlbmRfZGF0ZTogZW5kX3BhcmFtLAogICAgICAgICAgdGVtcF9kYXlfbGltaXRfaWQ6IHRoZWV2ZW50LnRlbXBfbGltaXRfaWQsCiAgICAgICAgICBsb2NhdGlvbl9pZDogdGhlZXZlbnQubG9jYXRpb25faWQsCiAgICAgICAgICBkYXlfbGltaXRfaWQ6IHRoZWV2ZW50LmRheV9saW1pdF9pZAogICAgICAgIH07CiAgICAgICAgdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5KCRodHRwLCRzY29wZSx0aGVkYXRhLG51bGwsIHVwZGF0ZUNhbGVuZGFyTGltaXRhdGlvbl9mYWlsdXJlKTsKICAgICAgfQogICAgfQogIH07Cn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdFdmVudENsYXNzUGFnZUNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICR0aW1lb3V0LCAkaHR0cCwgJHJvb3RTY29wZSwgJHJvdXRlUGFyYW1zLCAkbG9jYXRpb24sICRyb3V0ZSwgc2hhcmVkRGF0YSwgJHVpYk1vZGFsKQp7CiAgZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkKTsKICBnZXRBbGxDbGllbnRzKCRodHRwLCRzY29wZSwnZXZlbnRUeXBlVXNlcnMnKTsKICBnZXRCdXNpbmVzc0xvY2F0aW9ucygkaHR0cCwkc2NvcGUsJ2J1c2luZXNzX2xvY2F0aW9ucycpOwogIGdldEFsbEluc3RydWN0b3JzKCRodHRwLCRzY29wZSwnaW5zdHJ1Y3RvcnMnKTsKCiAgJHNjb3BlLnVwZGF0ZUV2ZW50VGl0bGUgPSBmdW5jdGlvbihuZXdWYWx1ZSxjdXJyZW50RXZlbnQpCiAgewogICAgbmV3X3RpdGxlPW5ld1ZhbHVlOwogICAgc2V0RXZlbnRUaXRsZSgkaHR0cCwkc2NvcGUsY3VycmVudEV2ZW50LmV2ZW50X2lkLCBuZXdfdGl0bGUsIHVwZGF0ZUV2ZW50X2NhbGxiYWNrLCB1cGRhdGVFdmVudF9jYWxsYmFjayk7CgogICAgZnVuY3Rpb24gdXBkYXRlRXZlbnRfY2FsbGJhY2soKQogICAgewogICAgICBnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkKTsKICAgIH0KCiAgfTsKCiAgJHNjb3BlLnVwZGF0ZUV2ZW50TWF4UGFydGljaXBhbnRzID0gZnVuY3Rpb24obmV3VmFsdWUsY3VycmVudEV2ZW50KQogIHsKICAgIG5ld19tYXhfcGFydGljaXBhbnRzPW5ld1ZhbHVlOwogICAgaWYgKCBuZXdfbWF4X3BhcnRpY2lwYW50cyA8IGN1cnJlbnRFdmVudC5ub19vZl91c2VycyApewogICAgICBzZXRFdmVudE1heFBhcnRpY2lwYW50cygkaHR0cCwkc2NvcGUsY3VycmVudEV2ZW50LmV2ZW50X2lkLCBjdXJyZW50RXZlbnQubm9fb2ZfdXNlcnMsIGN1cnJlbnRFdmVudC5ub19vZl91c2VycywgdXBkYXRlRXZlbnRfY2FsbGJhY2ssIHVwZGF0ZUV2ZW50X2NhbGxiYWNrKTsKICAgIH0gZWxzZSB7CiAgICAgIHNldEV2ZW50TWF4UGFydGljaXBhbnRzKCRodHRwLCRzY29wZSxjdXJyZW50RXZlbnQuZXZlbnRfaWQsIG5ld19tYXhfcGFydGljaXBhbnRzLCBjdXJyZW50RXZlbnQubm9fb2ZfdXNlcnMsIHVwZGF0ZUV2ZW50X2NhbGxiYWNrLCB1cGRhdGVFdmVudF9jYWxsYmFjayk7CiAgICB9CgogICAgZnVuY3Rpb24gdXBkYXRlRXZlbnRfY2FsbGJhY2soKQogICAgewogICAgICBnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkKTsKICAgIH0KCiAgfTsKCiAgJHNjb3BlLnVwZGF0ZVVzZXJFdmVudFByaWNlID0gZnVuY3Rpb24obmV3dmFsdWUsIHRoZWV2ZW50LCBldXNlcikKICB7CiAgICBuZXdfcHJpY2U9bmV3dmFsdWU7CiAgICBzZXRDbGllbnRFdmVudFByaWNlKCRodHRwLCRzY29wZSxldXNlci5idXNpbmVzc191c2VyX2lkLHRoZWV2ZW50LmV2ZW50X2lkLCBuZXdfcHJpY2Usc2V0Q2xpZW50RXZlbnRQcmljZV9jYWxsYmFjaywgc2V0Q2xpZW50RXZlbnRQcmljZV9jYWxsYmFjayk7CiAgICBmdW5jdGlvbiBzZXRDbGllbnRFdmVudFByaWNlX2NhbGxiYWNrKCkKICAgIHsKICAgICAgZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCk7CiAgICB9CiAgfTsKCiAgJHNjb3BlLnVwZGF0ZUxvY2F0aW9uRXZlbnQgPSBmdW5jdGlvbigpCiAgewogICAgY29uc29sZS5sb2coImZ1bmN0aW9uOiB1cGRhdGVMb2NhdGlvbkV2ZW50Iik7CiAgICB1cGRhdGVFdmVudExvY2F0aW9uKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuZXZlbnRfaWQsJHNjb3BlLmN1cnJlbnRFdmVudC5sb2NhdGlvbl9pZCx1cGRhdGVFdmVudExvY2F0aW9uX2NhbGxiYWNrLCB1cGRhdGVFdmVudExvY2F0aW9uX2NhbGxiYWNrKTsKICAgICRzY29wZS51cGRhdGVMb2NhdGlvbkFsZXJ0TWVzc2FnZT0i157XoteT15vXnyDXodeY15jXldehLi4uIjsKICAgIGZ1bmN0aW9uIHVwZGF0ZUV2ZW50TG9jYXRpb25fY2FsbGJhY2soKQogICAgewogICAgICAkc2NvcGUudXBkYXRlTG9jYXRpb25BbGVydE1lc3NhZ2U9Itei15XXk9eb158g15HXlNem15zXl9eUISI7CiAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkKICAgICAgewogICAgICAgICRzY29wZS51cGRhdGVMb2NhdGlvbkFsZXJ0TWVzc2FnZT1udWxsOwogICAgICB9LCAxNTAwKTsKICAgIH0KICB9OwoKICAkc2NvcGUudXBkYXRlSW5zdHJ1Y3RvckNsYXNzRXZlbnQgPSBmdW5jdGlvbigpCiAgewogICAgY29uc29sZS5sb2coImZ1bmN0aW9uOiB1cGRhdGVJbnN0cnVjdG9yQ2xhc3NFdmVudCIpOwogICAgdXBkYXRlRXZlbnRJbnN0cnVjdG9yKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuZXZlbnRfaWQsJHNjb3BlLmN1cnJlbnRFdmVudC5pbnN0cnVjdG9yX2lkLHVwZGF0ZUV2ZW50SW5zdHJ1Y3Rvcl9jYWxsYmFjaywgdXBkYXRlRXZlbnRJbnN0cnVjdG9yX2NhbGxiYWNrKTsKICAgICRzY29wZS51cGRhdGVJbnN0cnVjdG9yQWxlcnRNZXNzYWdlPSLXntei15PXm9efINeh15jXmNeV16EuLi4iOwogICAgZnVuY3Rpb24gdXBkYXRlRXZlbnRJbnN0cnVjdG9yX2NhbGxiYWNrKCkKICAgIHsKICAgICAgJHNjb3BlLnVwZGF0ZUluc3RydWN0b3JBbGVydE1lc3NhZ2U9Itei15XXk9eb158g15HXlNem15zXl9eUISI7CiAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkKICAgICAgewogICAgICAgICRzY29wZS51cGRhdGVJbnN0cnVjdG9yQWxlcnRNZXNzYWdlPW51bGw7CiAgICAgIH0sIDE1MDApOwogICAgfQogIH0KCgogICRzY29wZS5hY3RpdmF0ZUV2ZW50Q2xhc3MgPSBmdW5jdGlvbigpCiAgewogICAgewogICAgICBsb2dEZWJ1ZygicmVvcGVuRXZlbnQiKTsKICAgICAgcmVvcGVuRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQsJHNjb3BlLnNlbGVjdGVkRXZlbnQsYWZ0ZXJSZW9wZW5FdmVudCxhZnRlclJlb3BlbkV2ZW50KTsKICAgICAgZnVuY3Rpb24gYWZ0ZXJSZW9wZW5FdmVudCgpCiAgICAgIHsKICAgICAgICBnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkKTsKICAgICAgfTsKICAgIH0KICB9CgovLyBjbG9zZSBldmVudCBjbGFzcwogICRzY29wZS5jbG9zZUV2ZW50Q2xhc3MgPSBmdW5jdGlvbigpIHsKICAgIGxvZ0RlYnVnKCJjbG9zZUV2ZW50Q2xhc3MiKTsKCiAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAgICAgYW5pbWF0aW9uOiBmYWxzZSwKICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfZXZlbnRfY2xhc3NfY2xvc2UucGhwJywKICAgICAgc2l6ZTogJ3hzJywKICAgICAgY29udHJvbGxlcjogJ2NsYXNzQ2xvc2VNb2RhbENvbnRyb2xsZXInLAogICAgICByZXNvbHZlOiB7CiAgICAgICAgZXZlbnRfaWQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuICRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQ7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKICB9OwoKLy8gZGVsZXRlIHJlcGVhdGluZy9jbGFzcyBldmVudAogICRzY29wZS5kZWxldGVDbGFzc0V2ZW50ID0gZnVuY3Rpb24oKQogIHsKICAgIGlmICgkc2NvcGUuY3VycmVudEV2ZW50LmlzX3JlcGVhdGluZz09MCkKICAgIHsKICAgICAgbG9nRGVidWcoImNsYXNzIGV2ZW50IG5vdCByZXBlYXRpbmciKTsKICAgICAgJHNjb3BlLmRlbGV0ZUNsYXNzRXZlbnRTaW5nbGUoKTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgbG9nRGVidWcoImNsYXNzIGV2ZW50IGlzIHJlcGVhdGluZyIpOwogICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAgICAgICBhbmltYXRpb246IGZhbHNlLAogICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX3JlcGVhdGluZ19ldmVudF9kZWxldGVfYWxsLnBocCcsCiAgICAgICAgc2l6ZTogJ3hzJywKICAgICAgICBjb250cm9sbGVyOiAnY2xhc3NEZWxldGVBbGxNb2RhbENvbnRyb2xsZXInLAogICAgICAgIHJlc29sdmU6IHsKICAgICAgICAgIGN1cnJlbnRFdmVudDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiAkc2NvcGUuY3VycmVudEV2ZW50OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfTsKCiAgJHNjb3BlLmRlbGV0ZUNsYXNzRXZlbnRTaW5nbGU9ZnVuY3Rpb24gKCkgLy8gZGVsZXRlIG9ubHkgb25lL2N1cnJlbnQgY2xhc3MgZXZlaHQKICB7CiAgICBjYW5jZWxDbGFzc0V2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkLGNhbmNlbENsYXNzRXZlbnRfY2FsbGJhY2ssIGNhbmNlbENsYXNzRXZlbnRfY2FsbGJhY2spOwogICAgZnVuY3Rpb24gY2FuY2VsQ2xhc3NFdmVudF9jYWxsYmFjaygpCiAgICB7CiAgICAgIGdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQpOwogICAgfQogIH0KCiAgJHNjb3BlLiRvbigicmVsb2FkRXZlbnQiLGZ1bmN0aW9uKGUsYSl7Ci8vIFBvc3QgeW91ciBjb2RlCiAgICBsb2dEZWJ1ZygiYnJvYWRjYXN0ZWQgLSByZWxvYWRpbmcgZXZlbnQgIithLmV2ZW50X2lkKTsKICAgIGdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCk7CiAgfSk7CgovLyByZW1vdmUgZW5kIHVzZXIgZnJvbSBldmVudAogICRzY29wZS5ldmVudFJlbW92ZUVuZFVzZXIgPSBmdW5jdGlvbihlbmR1c2VyX2lkKQogIHsKICAgIGNvbnNvbGUubG9nKCJldmVudFJlbW92ZUVuZFVzZXIiKTsKICAgIHJlbW92ZUVuZFVzZXJGcm9tRXZlbnQoJGh0dHAsJHNjb3BlLGVuZHVzZXJfaWQsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCxyZW1vdmVFbmRVc2VyRnJvbUV2ZW50X2ZpbmlzaCwgcmVtb3ZlRW5kVXNlckZyb21FdmVudF9maW5pc2gpOwogICAgZnVuY3Rpb24gcmVtb3ZlRW5kVXNlckZyb21FdmVudF9maW5pc2goKQogICAgewogICAgICBnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkcm91dGVQYXJhbXMuZXZlbnRfaWQpOwogICAgfQogIH07CgogICRzY29wZS5ldmVudENsaWVudFNlbGVjdGVkID0gZnVuY3Rpb24oc2VsZWN0ZWQpIHsKICAgIGlmIChzZWxlY3RlZCkgewovLyBhbGVydChKU09OLnN0cmluZ2lmeSggc2VsZWN0ZWQsIG51bGwsIDIgKSk7CiAgICAgIGxvZ0RlYnVnKCdldmVudENsaWVudFNlbGVjdGVkMiB5ZXMgc2VsZWN0ZWQgJyArIHNlbGVjdGVkLm9yaWdpbmFsT2JqZWN0LmZpcnN0X25hbWUpOwogICAgICAkc2NvcGUuZXZlbnRBZGRFbmRVc2VyKHNlbGVjdGVkLm9yaWdpbmFsT2JqZWN0LmJ1c2luZXNzX3VzZXJfaWQpOwogICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2FuZ3Vjb21wbGV0ZS1hbHQ6Y2xlYXJJbnB1dCcsICdjbGllbnRfYW5ndWNvbXBsZXRlJyk7CgogICAgfSBlbHNlIHsKICAgICAgbG9nRGVidWcoJ25vdCBzZWxlY3RlZCcpOwogICAgfQogIH07CgogICRzY29wZS5ldmVudEFkZEVuZFVzZXIgPSBmdW5jdGlvbihlbmR1c2VyX2lkKQogIHsKICAgIGFkZEVuZFVzZXJUb0V2ZW50KCRodHRwLCRzY29wZSxlbmR1c2VyX2lkLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQsYWRkRW5kVXNlclRvRXZlbnRfZmluaXNoLCBhZGRFbmRVc2VyVG9FdmVudF9maW5pc2gpOwogICAgZnVuY3Rpb24gYWRkRW5kVXNlclRvRXZlbnRfZmluaXNoKCkKICAgIHsKICAgICAgZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkKTsKICAgIH0KICB9Owp9KTsKCmt1emVBcHAuY29udHJvbGxlcignRXZlbnRQYWdlQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHRpbWVvdXQsICRodHRwLCAkdWliTW9kYWwgLHNoYXJlZFByb3BlcnRpZXMsICRyb3V0ZVBhcmFtcywgJHJvb3RTY29wZSwgJGxvY2F0aW9uLCAkcm91dGUsIHNoYXJlZERhdGEsIEJ1c2luZXNzQ29uZmlnKQp7CiAgbG9nRGVidWcoIkV2ZW50UGFnZUNvbnRyb2xsZXIiKTsKCiAgZ2V0QWxsSW5zdHJ1Y3RvcnNJbmNJbmFjdGl2ZSgkaHR0cCwkc2NvcGUsJ2luc3RydWN0b3JzJyxnZXRBbGxJbnN0cnVjdG9yc0luY0luYWN0aXZlX3N1Y2Nlc3MpOwogIGdldEJ1c2luZXNzTG9jYXRpb25zKCRodHRwLCRzY29wZSwnYnVzaW5lc3NfbG9jYXRpb25zJyk7CgogIGZ1bmN0aW9uIGdldEFsbEluc3RydWN0b3JzSW5jSW5hY3RpdmVfc3VjY2VzcygpCiAgewogICAgZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLHNldFBhcnRpY2lwYXRlZCk7CiAgfQoKICB2YXIgaW5pdGlhbGl6aW5nID0gdHJ1ZSA7CgogICRzY29wZS4kd2F0Y2goImN1cnJlbnRFdmVudCIsIGZ1bmN0aW9uKG5ld1ZhbHVlLCBvbGRWYWx1ZSkgewogICAgaWYgKGluaXRpYWxpemluZykgewogICAgICAkdGltZW91dChmdW5jdGlvbigpIHsgaW5pdGlhbGl6aW5nID0gZmFsc2U7IH0pOwogICAgfSBlbHNlIHsKICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICB2YXIgdGltZW91dElkOwogICAgICAgICQoJyNkb2NzIDppbnB1dCwgdGV4dGFyZWEnKS5vbignaW5wdXQgcHJvcGVydHljaGFuZ2UgY2hhbmdlJywgZnVuY3Rpb24oKSB7CiAgICAgICAgICAvLyAgY29uc29sZS5sb2coJ1RleHRhcmVhIENoYW5nZScpOwogICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXRJZCk7CiAgICAgICAgICAvLyBSdW5zIFggc2Vjb25kIChYKjEwMDAgbXMpIGFmdGVyIHRoZSBsYXN0IGNoYW5nZQogICAgICAgICAgdGltZW91dElkID0gc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgJHNjb3BlLnVwZGF0ZUV2ZW50RXh0cmFGaWVsZHMoKQogICAgICAgICAgfSwgNzAwKTsKICAgICAgICB9KTsKICAgICAgfSwgMTAwMCk7CiAgICB9CiAgfSk7CgogICRzY29wZS5leHRyYUZpZWxkc0FsZXJ0TWVzc2FnZT1udWxsOwoKICAkc2NvcGUudXBkYXRlRXZlbnRUaXRsZSA9IGZ1bmN0aW9uKG5ld1ZhbHVlLGN1cnJlbnRFdmVudCkKICB7CiAgICBuZXdfdGl0bGU9bmV3VmFsdWU7CiAgICBzZXRFdmVudFRpdGxlKCRodHRwLCRzY29wZSxjdXJyZW50RXZlbnQuZXZlbnRfaWQsIG5ld190aXRsZSwgdXBkYXRlRXZlbnRfY2FsbGJhY2ssIHVwZGF0ZUV2ZW50X2NhbGxiYWNrKTsKCiAgICBmdW5jdGlvbiB1cGRhdGVFdmVudF9jYWxsYmFjaygpCiAgICB7CiAgICAgIGdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQpOwogICAgfQoKICB9OwoKCiAgJHNjb3BlLnVwZGF0ZUV2ZW50RXh0cmFGaWVsZHMgPSBmdW5jdGlvbigpCiAgewogICAgbG9nRGVidWcoInNhdmUgdXBkYXRlRXZlbnRFeHRyYUZpZWxkcyIpOwogICAgdGhlZGF0YSA9IHsKICAgICAgZXh0cmFGaWVsZHM6JHNjb3BlLmN1cnJlbnRFdmVudC5leHRyYUZpZWxkcwogICAgfTsKICAgICRzY29wZS5leHRyYUZpZWxkc0FsZXJ0TWVzc2FnZT0i16nXldee16guLi4iOwogICAgdXBkYXRlRXZlbnRFeHRyYUZpZWxkcygkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLHRoZWRhdGEsdXBkYXRlRXZlbnRFeHRyYUZpZWxkc19jYWxsYmFjaywgdXBkYXRlRXZlbnRFeHRyYUZpZWxkc19jYWxsYmFjayk7CgogICAgZnVuY3Rpb24gdXBkYXRlRXZlbnRFeHRyYUZpZWxkc19jYWxsYmFjaygpCiAgICB7CiAgICAgIC8vIGdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCxzZXRQYXJ0aWNpcGF0ZWQpOwoKICAgICAgJHNjb3BlLmV4dHJhRmllbGRzQWxlcnRNZXNzYWdlPSLXoNep157XqCEiOwogICAgICAkdGltZW91dChmdW5jdGlvbigpCiAgICAgIHsKICAgICAgICAkc2NvcGUuZXh0cmFGaWVsZHNBbGVydE1lc3NhZ2U9bnVsbDsKICAgICAgfSwgMjMwMCk7CiAgICB9CiAgfTsKCiAgJHNjb3BlLnJlc2NoZWR1bGVFdmVudCA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1Zygic2VldGluZyBldmVudCB0byBtb3ZlICAiKyRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXSk7CiAgICBzaGFyZWRQcm9wZXJ0aWVzLnNldF9ldmVudF9yZXNjaGVkdWxlKCRzY29wZS5jdXJyZW50RXZlbnQpOwogICAgc2hhcmVkUHJvcGVydGllcy5zZXRfc2VsZWN0ZWRfdXNlcihudWxsKTsKCi8vIHVzZXJfaW5mbz0gewovLyAgICAgdXNlcl9pZDogJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudFVzZXJzWzBdLnVzZXJfaWQsCi8vICAgICBidXNlcl9maXJzdF9uYW1lOiAkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfZmlyc3RfbmFtZSwKLy8gICAgIGJ1c2VyX2xhc3RfbmFtZTogJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudFVzZXJzWzBdLmJ1c2VyX2xhc3RfbmFtZQovLyB9OwovLyBzaGFyZWRQcm9wZXJ0aWVzLnNldF9zZWxlY3RlZF91c2VyKHVzZXJfaW5mbyk7CiAgICAkbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2NhbGVuZGFyJyk7CiAgfQoKICAkc2NvcGUudXBkYXRlTG9jYXRpb25FdmVudCA9IGZ1bmN0aW9uKCkKICB7CiAgICBjb25zb2xlLmxvZygiZnVuY3Rpb246IHVwZGF0ZUxvY2F0aW9uRXZlbnQiKTsKICAgIHVwZGF0ZUV2ZW50TG9jYXRpb24oJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCwkc2NvcGUuY3VycmVudEV2ZW50LmxvY2F0aW9uX2lkLHVwZGF0ZUV2ZW50TG9jYXRpb25fY2FsbGJhY2ssIHVwZGF0ZUV2ZW50TG9jYXRpb25fY2FsbGJhY2spOwogICAgJHNjb3BlLnVwZGF0ZUxvY2F0aW9uQWxlcnRNZXNzYWdlPSLXntei15PXm9efINeh15jXmNeV16EuLi4iOwogICAgZnVuY3Rpb24gdXBkYXRlRXZlbnRMb2NhdGlvbl9jYWxsYmFjaygpCiAgICB7CiAgICAgICRzY29wZS51cGRhdGVMb2NhdGlvbkFsZXJ0TWVzc2FnZT0i16LXldeT15vXnyDXkdeU16bXnNeX15QhIjsKICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKQogICAgICB7CiAgICAgICAgJHNjb3BlLnVwZGF0ZUxvY2F0aW9uQWxlcnRNZXNzYWdlPW51bGw7CiAgICAgIH0sIDE1MDApOwogICAgfQogIH07CgogICRzY29wZS51cGRhdGVJbnN0cnVjdG9yRXZlbnQgPSBmdW5jdGlvbigpCiAgewogICAgY29uc29sZS5sb2coImZ1bmN0aW9uOiB1cGRhdGVJbnN0cnVjdG9yRXZlbnQiKTsKICAgIHVwZGF0ZUV2ZW50SW5zdHJ1Y3RvcigkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLCRzY29wZS5jdXJyZW50RXZlbnQuaW5zdHJ1Y3Rvcl9pZCx1cGRhdGVFdmVudEluc3RydWN0b3JfY2FsbGJhY2ssIHVwZGF0ZUV2ZW50SW5zdHJ1Y3Rvcl9jYWxsYmFjayk7CiAgICAkc2NvcGUudXBkYXRlSW5zdHJ1Y3RvckFsZXJ0TWVzc2FnZT0i157XoteT15vXnyDXodeY15jXldehLi4uIjsKICAgIGZ1bmN0aW9uIHVwZGF0ZUV2ZW50SW5zdHJ1Y3Rvcl9jYWxsYmFjaygpCiAgICB7CiAgICAgICRzY29wZS51cGRhdGVJbnN0cnVjdG9yQWxlcnRNZXNzYWdlPSLXoteV15PXm9efINeR15TXptec15fXlCEiOwogICAgICAkdGltZW91dChmdW5jdGlvbigpCiAgICAgIHsKICAgICAgICAkc2NvcGUudXBkYXRlSW5zdHJ1Y3RvckFsZXJ0TWVzc2FnZT1udWxsOwogICAgICB9LCAxNTAwKTsKICAgIH0KICB9OwoKICAkc2NvcGUuaW5pdGlhdGVQYXltZW50ID0gZnVuY3Rpb24gKGlzcGx1cykgewogICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2NsaWVudF9wYXltZW50LnBocCcsCiAgICAgIGNvbnRyb2xsZXI6ICdidXNpbmVzc0NsaWVuZENhcmRQYXltZW50JywKLy8gc2l6ZTogc2l6ZSwKICAgICAgcmVzb2x2ZTogewogICAgICAgIGN1cnJlbnRDbGllbnQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiAkc2NvcGUuY3VycmVudEV2ZW50Q2xpZW50c1swXTsKICAgICAgICB9LAogICAgICAgIGlzcGx1czogZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIGlzcGx1czsKICAgICAgICB9LAogICAgICAgIGJ1c2luZXNzQ29uZmlnOiBCdXNpbmVzc0NvbmZpZy5nZXQoKSwKICAgICAgICBwYXltZW50czogZ2V0Q2xpZW50UGF5bWVudHNQcm9taXNlKCRodHRwLCAkc2NvcGUuY3VycmVudEV2ZW50Q2xpZW50c1swXS5idXNpbmVzc191c2VyX2lkKQogICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocikgewogICAgICAgICAgICAgIHJldHVybiByLmRhdGEuanNvbgogICAgICAgICAgICB9KQogICAgICB9CiAgICB9KTsKICB9CgogICRzY29wZS5kZWxldGVFdmVudD1mdW5jdGlvbiAoKQogIHsKLy8gY2hlY2tpbmcgaWYgY2FuY2VsaW5nIGEgZ2VuZXJjX3R5cGUgZXZlbnQgLSB0aGVuIHRoZXJlJ3Mgbm8gdXNlcgogICAgaWYgKCRzY29wZS5jdXJyZW50RXZlbnQuaXNfZ2VuZXJpY19ldHlwZT09MSkKICAgIHsKICAgICAgY2FuY2VsU2luZ2xlRXZlbnQoJGh0dHAsJHNjb3BlLDAsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLGNhbmNlbFNpbmdsZUV2ZW50X2NhbGxiYWNrLCBjYW5jZWxTaW5nbGVFdmVudF9jYWxsYmFjayk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgIGNhbmNlbFNpbmdsZUV2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50VXNlcnNbMF0uYnVzaW5lc3NfdXNlcl9pZCwkcm91dGVQYXJhbXMuZXZlbnRfaWQsY2FuY2VsU2luZ2xlRXZlbnRfY2FsbGJhY2ssIGNhbmNlbFNpbmdsZUV2ZW50X2NhbGxiYWNrKTsKICAgIH0KICAgIGZ1bmN0aW9uIGNhbmNlbFNpbmdsZUV2ZW50X2NhbGxiYWNrKCkKICAgIHsKICAgICAgZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLHNldFBhcnRpY2lwYXRlZCk7CiAgICB9CiAgfQoKICAkc2NvcGUuc2V0UGFydGljaXBhdGlvblN0YXR1cyA9IGZ1bmN0aW9uKCkKICB7CiAgICBzZXRFdmVudFVzZXJQYXJ0aWNpcGF0aW9uU3RhdHVzKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuZXZlbnRfaWQsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudFVzZXJzWzBdLmJ1c2luZXNzX3VzZXJfaWQsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudFVzZXJzWzBdLmV2ZW50X3VzZXJfc3RhdHVzX2lkLHNldFBhcnRpY2lwYXRpb25TdGF0dXNfY2FsbGJhY2ssIHNldFBhcnRpY2lwYXRpb25TdGF0dXNfY2FsbGJhY2spOwogICAgJHNjb3BlLnVwZGF0ZVN0YXR1c0FsZXJ0TWVzc2FnZT0i157XoteT15vXnyDXodeY15jXldehLi4uIjsKICAgIGZ1bmN0aW9uIHNldFBhcnRpY2lwYXRpb25TdGF0dXNfY2FsbGJhY2soKQogICAgewovLyBnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkcm91dGVQYXJhbXMuZXZlbnRfaWQsc2V0UGFydGljaXBhdGVkKTsKICAgICAgc2V0UGFydGljaXBhdGVkKCk7CiAgICAgICRzY29wZS51cGRhdGVTdGF0dXNBbGVydE1lc3NhZ2U9Itei15XXk9eb158g15HXlNem15zXl9eUISI7CiAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkKICAgICAgewogICAgICAgICRzY29wZS51cGRhdGVTdGF0dXNBbGVydE1lc3NhZ2U9bnVsbDsKICAgICAgfSwgMjUwMCk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBzZXRQYXJ0aWNpcGF0ZWQoKQogIHsKICAgIGxvZ0RlYnVnKCJnZXQgY2xpZW50IGluZm8iKTsKICAgIGdldEJ1c2luZXNzQ2xpZW50SW5mbygkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudENsaWVudHMnLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRVc2Vyc1swXS5idXNpbmVzc191c2VyX2lkKTsKICAgIGxvZ0RlYnVnKCJzZXR0aW5nIHNldFBhcnRpY2lwYXRlZCIpOwogICAgaWYgKCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRVc2Vyc1swXS5zdGF0dXNfbmFtZSE9JGdVc2VyX3N0YXR1c19hYnNlbnRlZCkKICAgIHsKICAgICAgJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudFVzZXJzWzBdLnBhcnRpY2lwYXRlZD10cnVlOwogICAgfQogICAgZWxzZQogICAgewogICAgICAkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50VXNlcnNbMF0ucGFydGljaXBhdGVkPWZhbHNlOwogICAgfQoKLy8gdGhpcyBsb29wIGlzIGZvciBmaXhpbmcgdGhlIGRhdGUgZm9ybWF0IHRvIGFwcGVhciBwcm9wZXJseSBpbiB0aGUgaW5wdXQgZGF0ZSBodG1sIG9iamVjdAogICAgZm9yIChpID0gMDsgaTwgKCRzY29wZS5jdXJyZW50RXZlbnQuZXh0cmFGaWVsZHMpLmxlbmd0aDsgaSsrKQogICAgewogICAgICBsb2dEZWJ1Zygkc2NvcGUuY3VycmVudEV2ZW50LmV4dHJhRmllbGRzW2ldKTsKICAgICAgaWYgKCRzY29wZS5jdXJyZW50RXZlbnQuZXh0cmFGaWVsZHNbaV0uZmllbGRfZGF0YXR5cGU9PSJEQVRFIikKICAgICAgewovLyBsb2dEZWJ1ZygiZGF0ZSIpOwogICAgICAgICRzY29wZS5jdXJyZW50RXZlbnQuZXh0cmFGaWVsZHNbaV0uZmllbGRfdmFsdWU9bmV3IERhdGUoJHNjb3BlLmN1cnJlbnRFdmVudC5leHRyYUZpZWxkc1tpXS5maWVsZF92YWx1ZSk7CiAgICAgIH0KICAgIH0KCiAgICBsb2dEZWJ1ZygiJHNjb3BlLmN1cnJlbnRFdmVudC5pbnN0cnVjdG9yX2lkOz0iKyRzY29wZS5jdXJyZW50RXZlbnQuaW5zdHJ1Y3Rvcl9pZCk7CiAgICBmb3IodmFyIGkgPSAwOyBpIDwgJHNjb3BlLmluc3RydWN0b3JzLmxlbmd0aDsgaSsrKQogICAgewogICAgICBsb2dEZWJ1Zygkc2NvcGUuaW5zdHJ1Y3RvcnNbaV0uaXNfYWN0aXZlKTsKICAgICAgaWYgKCRzY29wZS5pbnN0cnVjdG9yc1tpXS5idXNpbmVzc191c2VyX2lkPT0kc2NvcGUuY3VycmVudEV2ZW50Lmluc3RydWN0b3JfaWQpCiAgICAgIHsKICAgICAgICBsb2dEZWJ1ZygieWVzaCIpOwogICAgICAgICRzY29wZS5pbnN0cnVjdG9yc1tpXS5pc19hY3RpdmU9MTsKICAgICAgfQogICAgfQogIH0KCiAgJHNjb3BlLnVwZGF0ZVVzZXJFdmVudFByaWNlID0gZnVuY3Rpb24obmV3dmFsdWUsIHRoZWV2ZW50KQogIHsKICAgIG5ld19wcmljZT1uZXd2YWx1ZTsKICAgIHNldENsaWVudEV2ZW50UHJpY2UoJGh0dHAsJHNjb3BlLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRVc2Vyc1swXS5idXNpbmVzc191c2VyX2lkLHRoZWV2ZW50LmV2ZW50X2lkLCBuZXdfcHJpY2Usc2V0Q2xpZW50RXZlbnRQcmljZV9jYWxsYmFjaywgc2V0Q2xpZW50RXZlbnRQcmljZV9jYWxsYmFjayk7CiAgICBmdW5jdGlvbiBzZXRDbGllbnRFdmVudFByaWNlX2NhbGxiYWNrKCkKICAgIHsKICAgICAgZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLHNldFBhcnRpY2lwYXRlZCk7CiAgICB9CiAgfTsKCiAgJHNjb3BlLiRvbigiZXZlbnRQYWdlUmVsb2FkRGF0YSIsZnVuY3Rpb24oZSxhKQogIHsKICAgIGdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCxzZXRQYXJ0aWNpcGF0ZWQpOwogIH0pOwoKCgoKICAkc2NvcGUuY2xvc2VFdmVudCA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1ZygiY2hlY2tpbmcgaWYgZXZlbnQgaGFzIGV4dHJhIGZpZWxkcyB0aGF0IGFyZSByZXF1aXJlZCBiZWZvcmUgY2xvc2luZyBpdCIpOwogICAgY2hlY2tFdmVudEV4dHJhRmllbGRzKCRodHRwLCRzY29wZSwnY2hlY2tFdmVudEV4dHJhRmllbGRzJywkcm91dGVQYXJhbXMuZXZlbnRfaWQsY2hlY2tFdmVudEV4dHJhRmllbGRzX3N1Y2Nlc3MpOwogICAgZnVuY3Rpb24gY2hlY2tFdmVudEV4dHJhRmllbGRzX3N1Y2Nlc3MoKQogICAgewogICAgICBpZiAoJHNjb3BlLmNoZWNrRXZlbnRFeHRyYUZpZWxkcz09dHJ1ZSkKICAgICAgewogICAgICAgIGxvZ0RlYnVnKCJldmVudCBoYXMgYWxsIGV4dHJhIGZpZWxkcyBvaywgY2xvc2luZyBldmVudCIpOwovLyAkc2NvcGUuY3VycmVudEV2ZW50Lmlnbm9yZUV4dHJhRmllbGRzVmFsaWRhdGlvbj10cnVlOwogICAgICAgIGNsb3NlRXZlbnQoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCwkc2NvcGUuY3VycmVudEV2ZW50LGFmdGVyQ2xvc2VFdmVudCxhZnRlckNsb3NlRXZlbnQpOwogICAgICAgIGZ1bmN0aW9uIGFmdGVyQ2xvc2VFdmVudCgpCiAgICAgICAgewogICAgICAgICAgZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLHNldFBhcnRpY2lwYXRlZCk7CiAgICAgICAgfTsKICAgICAgfQogICAgICBlbHNlCiAgICAgIHsKICAgICAgICBsb2dEZWJ1ZygiZXZlbnQgaGFzIGV4dHJhIGZpZWxkcyByZXF1aXJlZCB0aGF0IGFyZSBub3QgZmlsbGVkIik7CiAgICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgICAgICAgICBhbmltYXRpb246IGZhbHNlLAogICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfZXZlbnRfY2xvc2VfaWdub3JlX21hbmRhdG9yeV9maWVsZHMucGhwJywKICAgICAgICAgIGNvbnRyb2xsZXI6ICdldmVudENsb3NlSWdub3JlTWFuZGF0b3J5RmllbGRzTW9kYWxDb250cm9sbGVyJywKICAgICAgICAgIHNpemU6ICdtJywKICAgICAgICAgIHJlc29sdmU6IHsKICAgICAgICAgICAgY3VycmVudEV2ZW50OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICByZXR1cm4gJHNjb3BlLmN1cnJlbnRFdmVudDsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgfQogICRzY29wZS5yZW9wZW5FdmVudCA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1ZygicmVvcGVuRXZlbnQiKTsKICAgIHJlb3BlbkV2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkLCRzY29wZS5jdXJyZW50RXZlbnQsYWZ0ZXJSZW9wZW5FdmVudCxhZnRlclJlb3BlbkV2ZW50KTsKICAgIGZ1bmN0aW9uIGFmdGVyUmVvcGVuRXZlbnQoKQogICAgewogICAgICBnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkLHNldFBhcnRpY2lwYXRlZCk7CiAgICB9OwogIH0KCn0pOwoKa3V6ZUFwcC5maWx0ZXIoJ3N0YXJ0RnJvbScsIGZ1bmN0aW9uKCkKewogIHJldHVybiBmdW5jdGlvbihpbnB1dCwgc3RhcnQpCiAgewogICAgaWYoIWlucHV0KSByZXR1cm4gW107Ci8vIGNvbnNvbGUubG9nKCJoZXJlcmVlZSAiK2lucHV0KTsKICAgIHN0YXJ0ID0gK3N0YXJ0OyAvL3BhcnNlIHRvIGludAogICAgcmV0dXJuIGlucHV0LnNsaWNlKHN0YXJ0KTsKICB9Cn0pOwovLyBhbmd1bGFyIGZpbHRlciBmb3IgZXZlbnRzIGJlZm9yZS9hZnRlciB0b2RheQprdXplQXBwLmZpbHRlcignYmVmb3JlTm93JywgZnVuY3Rpb24oKSB7Ci8vIENyZWF0ZSB0aGUgcmV0dXJuIGZ1bmN0aW9uIGFuZCBzZXQgdGhlIHJlcXVpcmVkIHBhcmFtZXRlciBuYW1lIHRvICoqaW5wdXQqKgogIHJldHVybiBmdW5jdGlvbihpbnB1dCkgewogICAgdmFyIG91dCA9IFtdOwoKLy8gVXNpbmcgdGhlIGFuZ3VsYXIuZm9yRWFjaCBtZXRob2QsIGdvIHRocm91Z2ggdGhlIGFycmF5IG9mIGRhdGEgYW5kIHBlcmZvcm0gdGhlIG9wZXJhdGlvbiBvZiBmaWd1cmluZyBvdXQgaWYgdGhlIGxhbmd1YWdlIGlzIHN0YXRpY2FsbHkgb3IgZHluYW1pY2FsbHkgdHlwZWQuCiAgICB2YXIgYnJvd3Nlcl9lcG9jaCA9IChuZXcgRGF0ZSkuZ2V0VGltZSgpOwoKICAgIGFuZ3VsYXIuZm9yRWFjaChpbnB1dCwgZnVuY3Rpb24oZXZlbnQpCiAgICB7Ci8vICBsb2dEZWJ1ZygiZmlsdGVyaW5nLCBldmVudC5ldmVudF91c2VyX3N0YXR1c19pZD0iK2V2ZW50LmV2ZW50X3VzZXJfc3RhdHVzX2lkKTsKICAgICAgaWYgKGV2ZW50LnN0YXJ0X2Vwb2NoIDw9IChicm93c2VyX2Vwb2NoLzEwMDApKQogICAgICB7CiAgICAgICAgb3V0LnB1c2goZXZlbnQpCiAgICAgIH0KICAgIH0pCiAgICByZXR1cm4gb3V0OwogIH0KfSk7Cmt1emVBcHAuZmlsdGVyKCdhZnRlck5vdycsIGZ1bmN0aW9uKCkgewovLyBDcmVhdGUgdGhlIHJldHVybiBmdW5jdGlvbiBhbmQgc2V0IHRoZSByZXF1aXJlZCBwYXJhbWV0ZXIgbmFtZSB0byAqKmlucHV0KioKICByZXR1cm4gZnVuY3Rpb24oaW5wdXQpIHsKICAgIHZhciBvdXQgPSBbXTsKCi8vIFVzaW5nIHRoZSBhbmd1bGFyLmZvckVhY2ggbWV0aG9kLCBnbyB0aHJvdWdoIHRoZSBhcnJheSBvZiBkYXRhIGFuZCBwZXJmb3JtIHRoZSBvcGVyYXRpb24gb2YgZmlndXJpbmcgb3V0IGlmIHRoZSBsYW5ndWFnZSBpcyBzdGF0aWNhbGx5IG9yIGR5bmFtaWNhbGx5IHR5cGVkLgogICAgdmFyIGJyb3dzZXJfZXBvY2ggPSAobmV3IERhdGUpLmdldFRpbWUoKTsKCiAgICBhbmd1bGFyLmZvckVhY2goaW5wdXQsIGZ1bmN0aW9uKGV2ZW50KQogICAgewovLyAgbG9nRGVidWcoImZpbHRlcmluZywgZXZlbnQuZXZlbnRfdXNlcl9zdGF0dXNfaWQ9IitldmVudC5ldmVudF91c2VyX3N0YXR1c19pZCk7CiAgICAgIGlmIChldmVudC5zdGFydF9lcG9jaCA+IChicm93c2VyX2Vwb2NoLzEwMDApKQogICAgICB7CiAgICAgICAgb3V0LnB1c2goZXZlbnQpCiAgICAgIH0KICAgIH0pCiAgICByZXR1cm4gb3V0OwogIH0KfSk7CgprdXplQXBwLmZpbHRlcignaXNBY3RpdmUnLCBmdW5jdGlvbigpIHsKLy8gQ3JlYXRlIHRoZSByZXR1cm4gZnVuY3Rpb24gYW5kIHNldCB0aGUgcmVxdWlyZWQgcGFyYW1ldGVyIG5hbWUgdG8gKippbnB1dCoqCiAgcmV0dXJuIGZ1bmN0aW9uKGlucHV0KSB7CiAgICB2YXIgb3V0ID0gW107CgovLyBVc2luZyB0aGUgYW5ndWxhci5mb3JFYWNoIG1ldGhvZCwgZ28gdGhyb3VnaCB0aGUgYXJyYXkgb2YgZGF0YSBhbmQgcGVyZm9ybSB0aGUgb3BlcmF0aW9uIG9mIGZpZ3VyaW5nIG91dCBpZiB0aGUgbGFuZ3VhZ2UgaXMgc3RhdGljYWxseSBvciBkeW5hbWljYWxseSB0eXBlZC4KCiAgICBhbmd1bGFyLmZvckVhY2goaW5wdXQsIGZ1bmN0aW9uKGV2ZW50KQogICAgewovLyAgbG9nRGVidWcoImZpbHRlcmluZywgZXZlbnQuZXZlbnRfdXNlcl9zdGF0dXNfaWQ9IitldmVudC5ldmVudF91c2VyX3N0YXR1c19pZCk7CiAgICAgIGlmIChldmVudC5pc19hY3RpdmU9PTEpCiAgICAgIHsKICAgICAgICBvdXQucHVzaChldmVudCkKICAgICAgfQogICAgfSkKICAgIHJldHVybiBvdXQ7CiAgfQp9KTsKCmt1emVBcHAuZmlsdGVyKCdzaG91bGRfYmVfZGlzcGxheWVkJywgZnVuY3Rpb24oKSB7Ci8vIENyZWF0ZSB0aGUgcmV0dXJuIGZ1bmN0aW9uIGFuZCBzZXQgdGhlIHJlcXVpcmVkIHBhcmFtZXRlciBuYW1lIHRvICoqaW5wdXQqKgogIHJldHVybiBmdW5jdGlvbihpbnB1dCkgewogICAgdmFyIG91dCA9IFtdOwoKLy8gVXNpbmcgdGhlIGFuZ3VsYXIuZm9yRWFjaCBtZXRob2QsIGdvIHRocm91Z2ggdGhlIGFycmF5IG9mIGRhdGEgYW5kIHBlcmZvcm0gdGhlIG9wZXJhdGlvbiBvZiBmaWd1cmluZyBvdXQgaWYgdGhlIGxhbmd1YWdlIGlzIHN0YXRpY2FsbHkgb3IgZHluYW1pY2FsbHkgdHlwZWQuCgogICAgYW5ndWxhci5mb3JFYWNoKGlucHV0LCBmdW5jdGlvbihldmVudCkKICAgIHsKLy8gIGxvZ0RlYnVnKCJmaWx0ZXJpbmcsIGV2ZW50LmV2ZW50X3VzZXJfc3RhdHVzX2lkPSIrZXZlbnQuZXZlbnRfdXNlcl9zdGF0dXNfaWQpOwogICAgICBpZiAoZXZlbnQuc2hvdWxkX2JlX2Rpc3BsYXllZD09MSkKICAgICAgewogICAgICAgIG91dC5wdXNoKGV2ZW50KQogICAgICB9CiAgICB9KQogICAgcmV0dXJuIG91dDsKICB9Cn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdJbnN0cnVjdG9yU2hvdzFDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkdGltZW91dCwgJGh0dHAsIHNoYXJlZFByb3BlcnRpZXMsICRyb290U2NvcGUsICRyb3V0ZVBhcmFtcywgJGxvY2F0aW9uLCAkcm91dGUsIHNoYXJlZERhdGEsICR1aWJNb2RhbCkKewogIGdldEJ1c2luZXNzQ2xpZW50SW5mbygkaHR0cCwkc2NvcGUsJ2Zvcm1VcGRhdGVDbGllbnRBbmd1bGFyJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCxnZXRCdXNpbmVzc0NsaWVudEluZm9fc3VjY2Vzcyk7CiAgZ2V0c2VjdXJpdHlQcm9maWxlcygkaHR0cCwkc2NvcGUsJ3NlY19wcm9maWxlcycpOwoKICBmdW5jdGlvbiBnZXRCdXNpbmVzc0NsaWVudEluZm9fc3VjY2VzcygpCiAgewogICAgZ2V0Q2xpZW50RXh0cmFGaWVsZHMoJGh0dHAsJHNjb3BlLCRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5idXNpbmVzc191c2VyX2lkLCdjbGllbnRFeHRyYUZpZWxkcycsZ2V0Q2xpZW50RXh0cmFGaWVsZHNfc3VjY2Vzcyk7CgogICAgZnVuY3Rpb24gZ2V0Q2xpZW50RXh0cmFGaWVsZHNfc3VjY2VzcygpCiAgICB7CiAgICAgIGZvciAoaSA9IDA7IGk8ICgkc2NvcGUuY2xpZW50RXh0cmFGaWVsZHMpLmxlbmd0aDsgaSsrKQogICAgICB7CiAgICAgICAgbG9nRGVidWcoJHNjb3BlLmNsaWVudEV4dHJhRmllbGRzW2ldKTsKICAgICAgICBpZiAoJHNjb3BlLmNsaWVudEV4dHJhRmllbGRzW2ldLmZpZWxkX2RhdGF0eXBlPT0iREFURSIpCiAgICAgICAgewovLyBsb2dEZWJ1ZygiZGF0ZSIpOwogICAgICAgICAgJHNjb3BlLmNsaWVudEV4dHJhRmllbGRzW2ldLmZpZWxkX3ZhbHVlPW5ldyBEYXRlKCRzY29wZS5jbGllbnRFeHRyYUZpZWxkc1tpXS5maWVsZF92YWx1ZSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQoKICAkc2NvcGUudXBkYXRlX3NlY19wcm9maWxlID0gZnVuY3Rpb24oKQogIHsKICAgIGxvZ0RlYnVnKCJ1cGRhdGVfc2VjX3Byb2ZpbGUgZm9yIGJ1aWQ9Iiskc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYnVzaW5lc3NfdXNlcl9pZCsgIiwgcHJvZmlsZV9pZCIrJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLnNlY19wcm9maWxlX2lkKTsKICAgIHVwZGF0ZV9zZWNfcHJvZmlsZSgkaHR0cCwkc2NvcGUsJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLmJ1c2luZXNzX3VzZXJfaWQsJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLnNlY19wcm9maWxlX2lkLHVwZGF0ZV9zZWNfcHJvZmlsZV9zdWNjZXNzKTsKICAgIGZ1bmN0aW9uIHVwZGF0ZV9zZWNfcHJvZmlsZV9zdWNjZXNzKCkKICAgIHsKICAgICAgZ2V0c2VjdXJpdHlQcm9maWxlcygkaHR0cCwkc2NvcGUsJ3NlY19wcm9maWxlcycpOwogICAgfQogIH0KICAkc2NvcGUuYXJjaGl2ZUNsaWVudE1vZGFsID0gZnVuY3Rpb24oKQogIHsKLy8gYXJjaGl2ZS9kZWxldGUgY2xpZW50IC0gYXNrIGlmIHN1cmUKICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewogICAgICBhbmltYXRpb246IGZhbHNlLAogICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdhcmNoaXZlX2NsaWVudF9tb2RhbC5waHAnLAogICAgICBzaXplOiAneHMnLAogICAgICBjb250cm9sbGVyOiAnYXJjaGl2ZV9jbGllbnRfbW9kYWwnLCAgLy8gJ3BheW1lbnlEZXRhaWxzTW9kYWxDb250cm9sbGVyJywKICAgICAgcmVzb2x2ZTogewogICAgICAgIGJ1c2luZXNzX3VzZXJfaWQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuICRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5idXNpbmVzc191c2VyX2lkOwogICAgICAgIH0sCiAgICAgICAgYnVzZXJfbGFzdF9uYW1lOiBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYnVzZXJfbGFzdF9uYW1lOwogICAgICAgIH0sCiAgICAgICAgYnVzZXJfZmlyc3RfbmFtZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLmJ1c2VyX2ZpcnN0X25hbWU7CiAgICAgICAgfSwKICAgICAgICBpc19pbnN0cnVjdG9yOiBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CiAgfQoKICAkc2NvcGUudXBkYXRlVXNlckZpcnN0TmFtZSA9IGZ1bmN0aW9uKG5ld1ZhbHVlKQogIHsKICAgIHNldENsaWVudEZpcnN0TmFtZSgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsbmV3VmFsdWUsYWZ0ZXJDbGllbnRTZXQsYWZ0ZXJDbGllbnRTZXQpOwogICAgZnVuY3Rpb24gYWZ0ZXJDbGllbnRTZXQoKQogICAgewogICAgICBnZXRCdXNpbmVzc0NsaWVudEluZm8oJGh0dHAsJHNjb3BlLCdmb3JtVXBkYXRlQ2xpZW50QW5ndWxhcicsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwogICAgfQogIH0KICAkc2NvcGUudXBkYXRlVXNlckxhc3ROYW1lID0gZnVuY3Rpb24obmV3VmFsdWUpCiAgewogICAgc2V0Q2xpZW50TGFzdE5hbWUoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLG5ld1ZhbHVlLGFmdGVyQ2xpZW50U2V0LGFmdGVyQ2xpZW50U2V0KTsKICAgIGZ1bmN0aW9uIGFmdGVyQ2xpZW50U2V0KCkKICAgIHsKICAgICAgZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKICAgIH0KICB9CiAgJHNjb3BlLnVwZGF0ZVVzZXJQaG9uZU51bWJlciA9IGZ1bmN0aW9uKG5ld1ZhbHVlKQogIHsKICAgIG5ld1ZhbHVlID0gbmV3VmFsdWUucmVwbGFjZSgnLScsJycpOwogICAgaWYgKGlzTmFOKG5ld1ZhbHVlKSkKICAgIHsKICAgICAgYWxlcnQoIteQ16DXkCDXlNeW158g157Xodek16gg15jXnNek15XXnyDXqten15nXnyIpOwogICAgICBnZXRCdXNpbmVzc0NsaWVudEluZm8oJGh0dHAsJHNjb3BlLCdmb3JtVXBkYXRlQ2xpZW50QW5ndWxhcicsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwogICAgfQogICAgZWxzZQogICAgewogICAgICBzZXRDbGllbnRQaG9uZU51bWJlcigkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsbmV3VmFsdWUsc2V0Q2xpZW50UGhvbmVOdW1iZXJfY2FsbGJhY2ssc2V0Q2xpZW50UGhvbmVOdW1iZXJfY2FsbGJhY2spOwogICAgICBmdW5jdGlvbiBzZXRDbGllbnRQaG9uZU51bWJlcl9jYWxsYmFjaygpCiAgICAgIHsKICAgICAgICBnZXRCdXNpbmVzc0NsaWVudEluZm8oJGh0dHAsJHNjb3BlLCdmb3JtVXBkYXRlQ2xpZW50QW5ndWxhcicsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwogICAgICB9CiAgICB9CiAgfQoKfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdDbGllbnRzU2hvdzFDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkdGltZW91dCwgJGh0dHAsIHNoYXJlZFByb3BlcnRpZXMsICRyb290U2NvcGUsICRyb3V0ZVBhcmFtcywgJGxvY2F0aW9uLCAkcm91dGUsIHNoYXJlZERhdGEsICR1aWJNb2RhbCwgQnVzaW5lc3NDb25maWcpCnsKICBnZXRCdXNpbmVzc0NsaWVudEluZm8oJGh0dHAsJHNjb3BlLCdmb3JtVXBkYXRlQ2xpZW50QW5ndWxhcicsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsZ2V0QnVzaW5lc3NDbGllbnRJbmZvX3N1Y2Nlc3MpOwoKICBmdW5jdGlvbiBnZXRCdXNpbmVzc0NsaWVudEluZm9fc3VjY2VzcygpCiAgewogICAgZ2V0Q2xpZW50RXh0cmFGaWVsZHMoJGh0dHAsJHNjb3BlLCRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5idXNpbmVzc191c2VyX2lkLCdjbGllbnRFeHRyYUZpZWxkcycsZ2V0Q2xpZW50RXh0cmFGaWVsZHNfc3VjY2Vzcyk7CgogICAgZnVuY3Rpb24gZ2V0Q2xpZW50RXh0cmFGaWVsZHNfc3VjY2VzcygpCiAgICB7CiAgICAgIGZvciAoaSA9IDA7IGk8ICgkc2NvcGUuY2xpZW50RXh0cmFGaWVsZHMpLmxlbmd0aDsgaSsrKQogICAgICB7CiAgICAgICAgbG9nRGVidWcoJHNjb3BlLmNsaWVudEV4dHJhRmllbGRzW2ldKTsKICAgICAgICBpZiAoJHNjb3BlLmNsaWVudEV4dHJhRmllbGRzW2ldLmZpZWxkX2RhdGF0eXBlPT0iREFURSIpCiAgICAgICAgewovLyBsb2dEZWJ1ZygiZGF0ZSIpOwogICAgICAgICAgJHNjb3BlLmNsaWVudEV4dHJhRmllbGRzW2ldLmZpZWxkX3ZhbHVlPW5ldyBEYXRlKCRzY29wZS5jbGllbnRFeHRyYUZpZWxkc1tpXS5maWVsZF92YWx1ZSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQogIHsKICAgIGdldENsaWVudEV2ZW50cygkaHR0cCwkc2NvcGUsJ2N1cnJlbnRDbGllbnRFdmVudHMnLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKCiAgICBnZXRDbGllbnRQYXltZW50cygkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsJ2N1cnJlbnRDbGllbnRQYXltZW50cycpOwoKICAgICRzY29wZS5hcmNoaXZlQ2xpZW50TW9kYWwgPSBmdW5jdGlvbigpCiAgICB7Ci8vIGFyY2hpdmUvZGVsZXRlIGNsaWVudCAtIGFzayBpZiBzdXJlCiAgICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewogICAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYXJjaGl2ZV9jbGllbnRfbW9kYWwucGhwJywKICAgICAgICBzaXplOiAneHMnLAogICAgICAgIGNvbnRyb2xsZXI6ICdhcmNoaXZlX2NsaWVudF9tb2RhbCcsICAvLyAncGF5bWVueURldGFpbHNNb2RhbENvbnRyb2xsZXInLAogICAgICAgIHJlc29sdmU6IHsKICAgICAgICAgIGJ1c2luZXNzX3VzZXJfaWQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLmJ1c2luZXNzX3VzZXJfaWQ7CiAgICAgICAgICB9LAogICAgICAgICAgYnVzZXJfbGFzdF9uYW1lOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuICRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5idXNlcl9sYXN0X25hbWU7CiAgICAgICAgICB9LAogICAgICAgICAgYnVzZXJfZmlyc3RfbmFtZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYnVzZXJfZmlyc3RfbmFtZTsKICAgICAgICAgIH0sCiAgICAgICAgICBpc19pbnN0cnVjdG9yOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgICAkc2NvcGUucGFja2FnZURlbGV0ZSA9IGZ1bmN0aW9uKHBhY2thZ2UpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJwYWNrYWdlIGRlbGV0ZSAiK0pTT04uc3RyaW5naWZ5KHBhY2thZ2UpKTsKICAgICAgZGVsZXRlUGFja2FnZSgkaHR0cCwkc2NvcGUscGFja2FnZS5wYWNrYWdlX3VzZXJfaWQsJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLmJ1c2luZXNzX3VzZXJfaWQsc3VjY2Vzc19jYWxsYmFjaywgc3VjY2Vzc19jYWxsYmFjayk7CiAgICAgIGZ1bmN0aW9uIHN1Y2Nlc3NfY2FsbGJhY2soKQogICAgICB7CiAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgICB9CiAgICB9CgogICAgJHNjb3BlLnVwZGF0ZUNsaWVudEV4dHJhRmllbGRzID0gZnVuY3Rpb24oKQogICAgewogICAgICBsb2dEZWJ1ZygidXBkYXRlQ2xpZW50RXh0cmFGaWVsZHMiKTsKICAgICAgdGhlZGF0YSA9IHsKICAgICAgICBleHRyYUZpZWxkczokc2NvcGUuY2xpZW50RXh0cmFGaWVsZHMKICAgICAgfTsKICAgICAgJHNjb3BlLmV4dHJhRmllbGRzQWxlcnRNZXNzYWdlPSLXqdeV157XqC4uLiI7CiAgICAgIHVwZGF0ZUNsaWVudEV4dHJhRmllbGRzKCRodHRwLCRzY29wZSwkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYnVzaW5lc3NfdXNlcl9pZCx0aGVkYXRhLHVwZGF0ZUV2ZW50Q2xpZW50RmllbGRzX2NhbGxiYWNrLCB1cGRhdGVFdmVudENsaWVudEZpZWxkc19jYWxsYmFjayk7CgogICAgICBmdW5jdGlvbiB1cGRhdGVFdmVudENsaWVudEZpZWxkc19jYWxsYmFjaygpCiAgICAgIHsKLy8gZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLHNldFBhcnRpY2lwYXRlZCk7CiAgICAgICAgJHNjb3BlLmV4dHJhRmllbGRzQWxlcnRNZXNzYWdlPSLXoNep157XqCEiOwogICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkKICAgICAgICB7CiAgICAgICAgICAkc2NvcGUuZXh0cmFGaWVsZHNBbGVydE1lc3NhZ2U9bnVsbDsKICAgICAgICB9LCAzMDAwKTsKICAgICAgfQogICAgfTsKCiAgICAkc2NvcGUuc2NoZWR1bGVFdmVudEZvckNsaWVudCA9IGZ1bmN0aW9uKCkKICAgIHsKICAgICAgbG9nRGVidWcoInNlZXRpbmcgc2hhcmUgcHJvcGVydHkgdXNlcl9pZCAiKyRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXSk7CiAgICAgIHNoYXJlZFByb3BlcnRpZXMuc2V0X3NlbGVjdGVkX3VzZXIoJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdKTsKICAgICAgJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jYWxlbmRhcicpOwogICAgfQogICAgJHNjb3BlLmludm9pY2VHZW5lcmF0ZUNoZWNrYm94ID0gZnVuY3Rpb24oZnBheW1lbnQpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJpbnZvaWNlR2VuZXJhdGVDaGVja2JveCBmb3IgIitKU09OLnN0cmluZ2lmeShmcGF5bWVudCkpOwogICAgICBzZXRDbGllbnRQYXltZW50SW52b2ljZUdlbmVyYXRlZCgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsZnBheW1lbnQudXNlcl9wYXltZW50X2lkLGZwYXltZW50Lmludm9pY2VfZ2VuZXJhdGVkLHNldENsaWVudFBheW1lbnRJbnZvaWNlR2VuZXJhdGVkX2NhbGxiYWNrLCBzZXRDbGllbnRQYXltZW50SW52b2ljZUdlbmVyYXRlZF9jYWxsYmFjayk7CiAgICAgIGZ1bmN0aW9uIHNldENsaWVudFBheW1lbnRJbnZvaWNlR2VuZXJhdGVkX2NhbGxiYWNrKCkKICAgICAgewogICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKICAgICAgfQogICAgfTsKCiAgICAkc2NvcGUucmVjYWxjVXNlckJhbGFuY2UgPSBmdW5jdGlvbigpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJyZWNhbGNVc2VyQmFsYW5jZSIpOwogICAgICByZWNhbGNVc2VyQmFsYW5jZSgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsIHJlY2FsY1VzZXJCYWxhbmNlX2NhbGxiYWNrKTsKICAgICAgZnVuY3Rpb24gcmVjYWxjVXNlckJhbGFuY2VfY2FsbGJhY2soKQogICAgICB7CiAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgICB9ICAgIH0KICAgICRzY29wZS51cGRhdGVFdmVudFBhY2thZ2VSZWZlcmVuY2UgPSBmdW5jdGlvbih1c2VyX2lkLCBmbWVldGluZykKICAgIHsKICAgICAgbG9nRGVidWcoInVwZGF0ZUV2ZW50UGFja2FnZVJlZmVyZW5jZSwgdXNlcj0iK3VzZXJfaWQrIiwgZm1lZXRpbmc9IitKU09OLnN0cmluZ2lmeShmbWVldGluZykpOwogICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAgICAgICBhbmltYXRpb246IGZhbHNlLAogICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2NsaWVudF9ldmVudF9wYWNrYWdlX2Fzc29jaWF0aW9uLnBocCcsCiAgICAgICAgc2l6ZTogJ3hzJywKICAgICAgICBjb250cm9sbGVyOiAnZXZlbnRQYWNrYWdlQXNzb2NpYXRpb25Nb2RhbENvbnRyb2xsZXInLCAgLy8gJ3BheW1lbnlEZXRhaWxzTW9kYWxDb250cm9sbGVyJywKICAgICAgICByZXNvbHZlOiB7CiAgICAgICAgICBmbWVldGluZzogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiBmbWVldGluZzsKICAgICAgICAgIH0sCiAgICAgICAgICBiYWxhbmNlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuICRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5iYWxhbmNlOwogICAgICAgICAgfSwKICAgICAgICAgIGJ1c2luZXNzX3VzZXJfaWQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQ7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgIH07CgogICAgJHNjb3BlLnVwZGF0ZVBhY2thZ2VQYXltZW50UmVmZXJlbmNlID0gZnVuY3Rpb24odXNlcl9pZCwgZnBhY2thZ2UpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJ1cGRhdGVQYWNrYWdlUGF5bWVudFJlZmVyZW5jZSwgdXNlcj0iK3VzZXJfaWQrIiwgZnBhY2thZ2U9IitKU09OLnN0cmluZ2lmeShmcGFja2FnZSkpOwogICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAgICAgICBhbmltYXRpb246IGZhbHNlLAogICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2NsaWVudF9wYWNrYWdlX3BheW1lbnRfYXNzb2NpYXRpb24ucGhwJywKICAgICAgICBzaXplOiAneHMnLAogICAgICAgIGNvbnRyb2xsZXI6ICdwYWNrYWdlUGF5bWVudEFzc29jaWF0aW9uTW9kYWxDb250cm9sbGVyJywgIC8vICdwYXltZW55RGV0YWlsc01vZGFsQ29udHJvbGxlcicsCiAgICAgICAgcmVzb2x2ZTogewogICAgICAgICAgZnBhY2thZ2U6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gZnBhY2thZ2U7CiAgICAgICAgICB9LAogICAgICAgICAgYmFsYW5jZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYmFsYW5jZTsKICAgICAgICAgIH0sCiAgICAgICAgICBidXNpbmVzc191c2VyX2lkOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuICRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9OwoKLy8gc2hvdyBwYXltZW50IHBvcHVwCiAgICAkc2NvcGUuc2hvd1BheW1lbnREZXRhaWxzID0gZnVuY3Rpb24oZnBheW1lbnQpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJzaG93UGF5bWVudERldGFpbHMiKTsKICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgICAgICAgYW5pbWF0aW9uOiBmYWxzZSwKICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9jbGllbnRfcGF5bWVudF9kZXRhaWxzLnBocCcsCiAgICAgICAgc2l6ZTogJ3hzJywKICAgICAgICBjb250cm9sbGVyOiAncGF5bWVueURldGFpbHNNb2RhbENvbnRyb2xsZXInLAogICAgICAgIHJlc29sdmU6IHsKICAgICAgICAgIGZwYXltZW50OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIGZwYXltZW50OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgICAkc2NvcGUuaW52b2ljZU51bWJlckNoYW5nZWQgPSBmdW5jdGlvbihuZXdfaW52b2ljZV9udW1iZXIsZnBheW1lbnQpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJpbnZvaWNlTnVtYmVyQ2hhbmdlZCAiKyBuZXdfaW52b2ljZV9udW1iZXIgKyJmb3IgIitKU09OLnN0cmluZ2lmeShmcGF5bWVudCkpOwogICAgICBzZXRDbGllbnRQYXltZW50SW52b2ljZU51bWJlcigkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsZnBheW1lbnQudXNlcl9wYXltZW50X2lkLG5ld19pbnZvaWNlX251bWJlcixzZXRDbGllbnRQYXltZW50SW52b2ljZU51bWJlcl9jYWxsYmFjaywgc2V0Q2xpZW50UGF5bWVudEludm9pY2VOdW1iZXJfY2FsbGJhY2spOwogICAgICBmdW5jdGlvbiBzZXRDbGllbnRQYXltZW50SW52b2ljZU51bWJlcl9jYWxsYmFjaygpCiAgICAgIHsKLy8gJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgICB9CiAgICB9OwoKICAgICRzY29wZS4kb24oImNsaWVudFBhZ2VSZWxvYWREYXRhIixmdW5jdGlvbihlLGEpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJjbGllbnRQYWdlUmVsb2FkRGF0YSIpOwogICAgICBnZXRCdXNpbmVzc1VzZXJQYWNrYWdlcygkaHR0cCwkc2NvcGUsJ3VzZXJfcGFja2FnZXMnLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKICAgICAgZ2V0Q2xpZW50UGF5bWVudHMoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLCdjdXJyZW50Q2xpZW50UGF5bWVudHMnKTsKICAgICAgZ2V0Q2xpZW50RXZlbnRzKCRodHRwLCRzY29wZSwnY3VycmVudENsaWVudEV2ZW50cycsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwogICAgICBnZXRCdXNpbmVzc0NsaWVudEluZm8oJGh0dHAsJHNjb3BlLCdmb3JtVXBkYXRlQ2xpZW50QW5ndWxhcicsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwoKICAgICAgLy8gJHRpbWVvdXQoZnVuY3Rpb24oKQogICAgICAvLyB7CiAgICAgIC8vICAgJHNjb3BlLmN1cnNvcmRlbGV0ZT0iIjsKICAgICAgLy8gICBkb2N1bWVudC5ib2R5LnN0eWxlLmN1cnNvcj0nJzsKICAgICAgLy8gfSwgMjAwMCk7CgogICAgfSk7CgogICAgJHNjb3BlLmlzQ29uZmlybWVkT3JDbG9zZWQgPSBmdW5jdGlvbihldmVudCkKICAgIHsKICAgICAgaWYgKCRzY29wZS5zaG93QWxsRXZlbnRzKQogICAgICB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KCiAgICAgIGlmICgoZXZlbnQuaXNfY29uZmlybWVkID09IDEpIHx8IChldmVudC5pc19maW5hbF9zdGF0dXMgPT0gMSkgfHwgKChldmVudC5pc193YWl0aW5nX2xpc3QgPT0gMSkgJiYgKGV2ZW50LmlzX2NhbmNlbGVkID09IDApKSkKICAgICAgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIGVsc2UKICAgICAgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfQogICAgJHNjb3BlLmdvdG9DbGllbnRFZGl0UGFnZT1nb3RvQ2xpZW50RWRpdFBhZ2U7CiAgICAkc2NvcGUuZ290b0JhY2s9ZnVuY3Rpb24oKQogICAgewogICAgICBsb2dEZWJ1ZygnZ28gYmFjaycpOwogICAgICB3aW5kb3cuaGlzdG9yeS5iYWNrKCk7CiAgICB9OwoKICAgICRzY29wZS5nb3RvRXZlbnRQYWdlID0gZnVuY3Rpb24gKHRoZWV2ZW50KQogICAgewogICAgICBnb3RvRXZlbnRQYWdlKHRoZWV2ZW50KTsKICAgIH0KICB9CiAgJHNjb3BlLmluaXRpYXRlUGF5bWVudCA9IGZ1bmN0aW9uKGlzcGx1cykKICB7CiAgICBsb2dEZWJ1ZygiaW5pdGlhdGVQYXltZW50IGlzcGx1cyIraXNwbHVzKTsKICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewogICAgICBhbmltYXRpb246IGZhbHNlLAogICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9jbGllbnRfcGF5bWVudC5waHAnLAogICAgICBjb250cm9sbGVyOiAnYnVzaW5lc3NDbGllbmRDYXJkUGF5bWVudCcsCi8vIHNpemU6IHNpemUsCiAgICAgIHJlc29sdmU6IHsKICAgICAgICBjdXJyZW50Q2xpZW50OiBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF07CiAgICAgICAgfSwKICAgICAgICBpc3BsdXM6IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIGlzcGx1czsKICAgICAgICB9LAogICAgICAgIGJ1c2luZXNzQ29uZmlnOiBCdXNpbmVzc0NvbmZpZy5nZXQoKSwKICAgICAgICBwYXltZW50czogZ2V0Q2xpZW50UGF5bWVudHNQcm9taXNlKCRodHRwLCAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYnVzaW5lc3NfdXNlcl9pZCkKICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHIpIHsKICAgICAgICAgICAgICByZXR1cm4gci5kYXRhLmpzb24KICAgICAgICAgICAgfSkKICAgICAgfQogICAgfSk7CiAgfQoKICAkc2NvcGUudXBkYXRlVXNlckZpcnN0TmFtZSA9IGZ1bmN0aW9uKG5ld1ZhbHVlKQogIHsKICAgIHNldENsaWVudEZpcnN0TmFtZSgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsbmV3VmFsdWUsYWZ0ZXJDbGllbnRTZXQsYWZ0ZXJDbGllbnRTZXQpOwogICAgZnVuY3Rpb24gYWZ0ZXJDbGllbnRTZXQoKQogICAgewogICAgICBnZXRCdXNpbmVzc0NsaWVudEluZm8oJGh0dHAsJHNjb3BlLCdmb3JtVXBkYXRlQ2xpZW50QW5ndWxhcicsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwogICAgfQogIH0KICAkc2NvcGUudXBkYXRlVXNlckxhc3ROYW1lID0gZnVuY3Rpb24obmV3VmFsdWUpCiAgewogICAgc2V0Q2xpZW50TGFzdE5hbWUoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLG5ld1ZhbHVlLGFmdGVyQ2xpZW50U2V0LGFmdGVyQ2xpZW50U2V0KTsKICAgIGZ1bmN0aW9uIGFmdGVyQ2xpZW50U2V0KCkKICAgIHsKICAgICAgZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKICAgIH0KICB9CiAgJHNjb3BlLnVwZGF0ZVVzZXJFbWFpbCA9IGZ1bmN0aW9uKG5ld1ZhbHVlKQogIHsKICAgIHNldENsaWVudEVtYWlsKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCxuZXdWYWx1ZSxhZnRlcnNldENsaWVudEVtYWlsLGFmdGVyc2V0Q2xpZW50RW1haWwpOwogICAgZnVuY3Rpb24gYWZ0ZXJzZXRDbGllbnRFbWFpbCgpCiAgICB7CiAgICAgIGdldEJ1c2luZXNzQ2xpZW50SW5mbygkaHR0cCwkc2NvcGUsJ2Zvcm1VcGRhdGVDbGllbnRBbmd1bGFyJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CiAgICB9CiAgfQoKCiAgJHNjb3BlLnVwZGF0ZVVzZXJQaG9uZU51bWJlciA9IGZ1bmN0aW9uKG5ld1ZhbHVlKQogIHsKICAgIG5ld1ZhbHVlID0gbmV3VmFsdWUucmVwbGFjZSgnLScsJycpOwogICAgaWYgKGlzTmFOKG5ld1ZhbHVlKSkKICAgIHsKICAgICAgYWxlcnQoIteQ16DXkCDXlNeW158g157Xodek16gg15jXnNek15XXnyDXqten15nXnyIpOwogICAgICBnZXRCdXNpbmVzc0NsaWVudEluZm8oJGh0dHAsJHNjb3BlLCdmb3JtVXBkYXRlQ2xpZW50QW5ndWxhcicsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwogICAgfQogICAgZWxzZQogICAgewogICAgICBzZXRDbGllbnRQaG9uZU51bWJlcigkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsbmV3VmFsdWUsc2V0Q2xpZW50UGhvbmVOdW1iZXJfY2FsbGJhY2ssc2V0Q2xpZW50UGhvbmVOdW1iZXJfY2FsbGJhY2spOwogICAgICBmdW5jdGlvbiBzZXRDbGllbnRQaG9uZU51bWJlcl9jYWxsYmFjaygpCiAgICAgIHsKICAgICAgICBnZXRCdXNpbmVzc0NsaWVudEluZm8oJGh0dHAsJHNjb3BlLCdmb3JtVXBkYXRlQ2xpZW50QW5ndWxhcicsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwogICAgICB9CiAgICB9CiAgfQogICRzY29wZS51cGRhdGVVc2VyRXZlbnRQcmljZSA9IGZ1bmN0aW9uKG5ld3ZhbHVlLCB0aGVldmVudCkKICB7CiAgICBuZXdfcHJpY2U9bmV3dmFsdWU7CiAgICBzZXRDbGllbnRFdmVudFByaWNlKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCx0aGVldmVudC5ldmVudF9pZCwgbmV3X3ByaWNlLHNldENsaWVudEV2ZW50UHJpY2VfY2FsbGJhY2ssIHNldENsaWVudEV2ZW50UHJpY2VfY2FsbGJhY2spOwogICAgZnVuY3Rpb24gc2V0Q2xpZW50RXZlbnRQcmljZV9jYWxsYmFjaygpCiAgICB7CiAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKICAgIH0KICB9OwoKICAkc2NvcGUudXBkYXRlVXNlclBhY2thZ2VFdmVudHNDb3VudGVyID0gZnVuY3Rpb24obmV3dmFsdWUsIHRoZXBhY2thZ2UpCiAgewogICAgZXZlbnRzX2NvdW50ZXI9bmV3dmFsdWU7CiAgICBzZXRVc2VyUGFja2FnZUV2ZW50c0NvdW50ZXIoJGh0dHAsJHNjb3BlLHRoZXBhY2thZ2UucGFja2FnZV91c2VyX2lkLGV2ZW50c19jb3VudGVyLHNldFVzZXJQYWNrYWdlRXZlbnRzQ291bnRlcl9jYWxsYmFjaywgc2V0VXNlclBhY2thZ2VFdmVudHNDb3VudGVyX2NhbGxiYWNrKQogICAgZnVuY3Rpb24gc2V0VXNlclBhY2thZ2VFdmVudHNDb3VudGVyX2NhbGxiYWNrKCkKICAgIHsKICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgfQogIH07CiAgJHNjb3BlLnVwZGF0ZVVzZXJQYWNrYWdlUGFja2FnZVByaWNlID0gZnVuY3Rpb24obmV3dmFsdWUsIHRoZXBhY2thZ2UpCiAgewogICAgcGFja2FnZV9wcmljZT1uZXd2YWx1ZTsKICAgIHNldFVzZXJQYWNrYWdlUGFja2FnZVByaWNlKCRodHRwLCRzY29wZSx0aGVwYWNrYWdlLnBhY2thZ2VfdXNlcl9pZCxwYWNrYWdlX3ByaWNlLHNldFVzZXJQYWNrYWdlUGFja2FnZVByaWNlX2NhbGxiYWNrLCBzZXRVc2VyUGFja2FnZVBhY2thZ2VQcmljZV9jYWxsYmFjaykKICAgIGZ1bmN0aW9uIHNldFVzZXJQYWNrYWdlUGFja2FnZVByaWNlX2NhbGxiYWNrKCkKICAgIHsKLy8gZ2V0QnVzaW5lc3NVc2VyUGFja2FnZXMoJGh0dHAsJHNjb3BlLCd1c2VyX3BhY2thZ2VzJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CiAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKICAgIH0KICB9OwoKICAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXIgPSB7fTsKICBsb2dEZWJ1Zygkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CiAgJHNjb3BlLnNob3dfY2xpZW50X3VwZGF0ZV9jbGllbnQgPSB0cnVlOwogICRzY29wZS5zaG93X2NsaWVudF91cGRhdGVfc2F2ZSA9IGZhbHNlOwogICRzY29wZS5zaG93X2NsaWVudF9kZWxldGVfY2xpZW50ID0gdHJ1ZTsKICAkc2NvcGUuc2hvd19jbGllbnRfdXBkYXRlX2NhbmNlbCA9IGZhbHNlOwoKICAkc2NvcGUudXBkYXRlQ2xpZW50RW5hYmxlID0gZnVuY3Rpb24oKSB7CiAgICBsb2dEZWJ1ZygiZW5hYmxpbmcgZWRpdGluZyAoJHNjb3BlLmNsaWVudHNVcGRhdGVEaXNhYmxlZCB3YXMgIiArICRzY29wZS5jbGllbnRzVXBkYXRlRGlzYWJsZWQgKyAiKSIpOwogICAgJHNjb3BlLmNsaWVudHNVcGRhdGVEaXNhYmxlZCA9IGZhbHNlOwogICAgJHNjb3BlLnNob3dfY2xpZW50X3VwZGF0ZV9jbGllbnQgPSBmYWxzZTsKICAgICRzY29wZS5zaG93X2NsaWVudF91cGRhdGVfc2F2ZSA9IHRydWU7CiAgICAkc2NvcGUuc2hvd19jbGllbnRfZGVsZXRlX2NsaWVudCA9IGZhbHNlOwogICAgJHNjb3BlLnNob3dfY2xpZW50X3VwZGF0ZV9jYW5jZWwgPSB0cnVlOwogIH0KICAkc2NvcGUudXBkYXRlQ2xpZW50RGlzYWJsZSA9IGZ1bmN0aW9uKCkgewogICAgbG9nRGVidWcoImRpc2FibGUgZWRpdGluZyIpOwovLwkJJGxvY2F0aW9uLnBhdGgoJy9DbGllbnRzLycrJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwogICAgJHJvdXRlLnJlbG9hZCgpOwogIH0KICAkc2NvcGUuc2NoZWR1bGVFdmVudEZyb21FbmRVc2VyID0gZnVuY3Rpb24oKSB7CiAgICBzaGFyZWREYXRhLnNldFNlbGVjdGVkRW5kVXNlcih7CiAgICAgIGlkOiAkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCwKICAgICAgZmlyc3RfbmFtZTogJHNjb3BlLmN1cnJlbnRDbGllbnQudXNlcnNbMF0uZmlyc3RfbmFtZSwKICAgICAgbGFzdF9uYW1lOiAkc2NvcGUuY3VycmVudENsaWVudC51c2Vyc1swXS5sYXN0X25hbWUKICAgIH0pOwogICAgbG9nRGVidWcoInNjaGVkdWxlIGV2ZW50IGZvciB1c2VyICIgKyAkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7Ci8vCQkkbG9jYXRpb24ucGF0aCgnL0NsaWVudHMvJyskcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CiAgICAkbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2NhbGVuZGFyJyk7CiAgfQoKICAkc2NvcGUudXNlckRlbGV0ZVBheW1lbnQgPSBmdW5jdGlvbiAoZnBheW1lbnQpCiAgewogICAgLy8gJHNjb3BlLmN1cnNvcmRlbGV0ZT0id2FpdCI7CiAgICBsb2dEZWJ1ZygidXNlckRlbGV0ZVBheW1lbnQiKTsKICAgIC8vIGRvY3VtZW50LmJvZHkuc3R5bGUuY3Vyc29yPSd3YWl0JzsKCiAgICBkZWxldGVDbGllbnRQYXltZW50cygkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsZnBheW1lbnQudXNlcl9wYXltZW50X2lkLGRlbGV0ZUNsaWVudFBheW1lbnRzX3N1Y2Nlc3NfY2FsbGJhY2spOwogICAgZnVuY3Rpb24gZGVsZXRlQ2xpZW50UGF5bWVudHNfc3VjY2Vzc19jYWxsYmFjaygpCiAgICB7CiAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKICAgICAgbG9nRGVidWcoInVzZXJEZWxldGVQYXltZW50Iik7CiAgICAgIC8vICRzY29wZS5jdXJzb3JkZWxldGU9IiI7CiAgICAgIC8vIGRvY3VtZW50LmJvZHkuc3R5bGUuY3Vyc29yPScnOwogICAgfQogIH0KLy8gcmVtb3ZlIGVuZCB1c2VyIGZyb20gZXZlbnQKICAkc2NvcGUudXNlckRlbGV0ZUV2ZW50ID0gZnVuY3Rpb24oZW5kdXNlcl9pZCwgdGhlZXZlbnQpCiAgewovLyBpZiBpdCdzIGEgY2xhc3MgLSB3ZSBzaW1wbHkgcmVtb3ZlIHRoZSB1c2VyIGZyb20gdGhlIGV2ZW50CiAgICBpZiAodGhlZXZlbnQuaXNfY2xhc3M9PTEpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJzY29wZS51c2VyRGVsZXRlRXZlbnQiKTsKICAgICAgcmVtb3ZlRW5kVXNlckZyb21FdmVudCgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsdGhlZXZlbnQuZXZlbnRfaWQscmVtb3ZlRW5kVXNlckZyb21FdmVudF9maW5pc2gsIHJlbW92ZUVuZFVzZXJGcm9tRXZlbnRfZmluaXNoKTsKICAgICAgZnVuY3Rpb24gcmVtb3ZlRW5kVXNlckZyb21FdmVudF9maW5pc2goKQogICAgICB7CiAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgICB9CiAgICB9Ci8vIGlmIGl0cyBub3QgYSBjbGFzcyAtIHdlIG5lZWQgdG8gcmVtb3ZlIHRoZSBldmVudCBpdHNlbGYKICAgIGVsc2UKICAgIHsKLy8gYWxlcnQoIm5vdCBjbGFzcyBldmVudCwgVE9ETyIpOwogICAgfQogIH07CgovLyByZXRyZXZpbmcgcGFja2FnZXMgZm9yIHRoZSBidXNpbmVzcwogIGdldEJ1c2luZXNzUGFja2FnZXMoJGh0dHAsJHNjb3BlLCdwYWNrYWdlcycpOwoKLy8gZ2V0IHBhY2thZ2VzIGZvciB0aGlzIHNwZWNpZmljIHVzZXIKICBnZXRCdXNpbmVzc1VzZXJQYWNrYWdlcygkaHR0cCwkc2NvcGUsJ3VzZXJfcGFja2FnZXMnLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKLy8gYWRkaW5nIHBhY2thZ2UgdG8gdXNlciAtIGNhbGxlZCB3aGVuIGEgcGFja2FnZSBpcyBzZWxlY3RlZAogICRzY29wZS5wYWNrYWdlRm9yQ2xpZW50U2VsZWN0ZWQgPSBmdW5jdGlvbihzZWxlY3RlZFBhY2thZ2UpIHsKICAgIGlmIChzZWxlY3RlZFBhY2thZ2UpIHsKLy8gbG9nRGVidWcoJ3llcyBzZWxlY3RlZCAnICsgSlNPTi5zdHJpbmdpZnkoc2VsZWN0ZWRQYWNrYWdlKSk7CiAgICAgIGFkZEJ1c2luZXNzUGFja2FnZVRvVXNlcigkaHR0cCwkc2NvcGUsc2VsZWN0ZWRQYWNrYWdlLm9yaWdpbmFsT2JqZWN0LCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLGFkZEJ1c2luZXNzUGFja2FnZVN1Y2Nlc3MpOwogICAgICBmdW5jdGlvbiBhZGRCdXNpbmVzc1BhY2thZ2VTdWNjZXNzKCkKICAgICAgewogICAgICAgIGxvZ0RlYnVnKCJhZGRCdXNpbmVzc1BhY2thZ2VTdWNjZXNzMiIpOwovLyBnZXRCdXNpbmVzc1BhY2thZ2VzKCRodHRwLCRzY29wZSwncGFja2FnZXMnKTsKLy8gZ2V0QnVzaW5lc3NVc2VyUGFja2FnZXMoJGh0dHAsJHNjb3BlLCd1c2VyX3BhY2thZ2VzJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CiAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgICB9CiAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnYW5ndWNvbXBsZXRlLWFsdDpjbGVhcklucHV0JywgJ2NsaWVudF9hbmd1Y29tcGxldGUnKTsKICAgIH0KICAgIGVsc2UKICAgIHsKLy8gbG9nRGVidWcoJ25vdCBzZWxlY3RlZCwgZG8gbm90aGluZycpOwogICAgfQogIH07Cn0pOwoKCi8vIE5lZWQgdG8gZGlzdGluZ3Vpc2ggYmV0d2VlbiBlbmQgdXNlciAoY2xpZW50KSBhbmQgYnVzaW5lc3Mgb3duZXIuCi8vIGN1cnJlbnRseSBjYWxscyBvbmx5IGVuZCB1c2VyCmt1emVBcHAuY29udHJvbGxlcignSG9tZUNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkdWliTW9kYWwpCnsKCiAgZ2V0QWxsQ2xpZW50cygkaHR0cCwkc2NvcGUsJ2FsbENsaWVudHMnKTsKCiAgJHNjb3BlLmhvbWVwYWdlTGltaXQ9NjsKICBnZXRPcGVuZWRFdmVudHMoJGh0dHAsJHNjb3BlLCRzY29wZS5ob21lcGFnZUxpbWl0LCdvcGVuZWRfZXZlbnRzJyk7CgogIHZhciB0b2RheWRhdGUgPSBuZXcgRGF0ZSgpOwogIHZhciBob3dtYW55ZGF5c2FoZWFkPTMwOwogIHZhciBzdGFydGRhdGU9dG9kYXlkYXRlLmdldEZ1bGxZZWFyKCkrIi0iKygxK3RvZGF5ZGF0ZS5nZXRNb250aCgpKSsiLSIrdG9kYXlkYXRlLmdldERhdGUoKTsKICB0b2RheWRhdGUuc2V0RGF0ZSh0b2RheWRhdGUuZ2V0RGF0ZSgpICsgaG93bWFueWRheXNhaGVhZCk7CiAgdmFyIGVuZGRhdGU9dG9kYXlkYXRlLmdldEZ1bGxZZWFyKCkrIi0iKygxK3RvZGF5ZGF0ZS5nZXRNb250aCgpKSsiLSIrdG9kYXlkYXRlLmdldERhdGUoKTsKCi8vIGZpbHRlciBmb3IgdXNlcnMgd2hvIGhhdmUgZGVidAogICRzY29wZS5oYXZlRGVidCA9IGZ1bmN0aW9uKGV1c2VyKQogIHsKICAgIGlmIChldXNlci51c2VyX2JhbGFuY2UgPCAwKQogICAgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogIH07CgogICRzY29wZS5nb3RvQ2xpZW50UGFnZSA9IGZ1bmN0aW9uKGJ1c2luZXNzX3VzZXJfaWQpCiAgewovLyBsb2dEZWJ1ZyhldXNlcik7CiAgICB3aW5kb3cubG9jYXRpb24uaHJlZj0nLyMvYnVzaW5lc3NfY2xpZW50cy8nICsgYnVzaW5lc3NfdXNlcl9pZDsKICB9CgogIHZhciBwYXlsb2FkID0gJ3N0YXJ0PScgKyBzdGFydGRhdGUgKyAnJmVuZD0nICsgZW5kZGF0ZTsKICB2YXIgY29uZmlnID0gewogICAgaGVhZGVyczogeydDb250ZW50LVR5cGUnOidhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQ7IGNoYXJzZXQ9VVRGLTgnfQogIH0KICB2YXIgcG9zdHVybCA9ICIvYXBpL2FkbWluL3JlcG9ydHMvZXZlbnRzMiI7CgogICRzY29wZS5ldmVudFJlcG9ydENvbmZpZyA9IHt9OwogICRzY29wZS5ldmVudFJlcG9ydENvbmZpZy5zb3VyY2UgPSAiZG9jcyI7CiAgJHNjb3BlLmV2ZW50UmVwb3J0Q29uZmlnLmZpbHRlcnMgPSB7CiAgICBzdGFydF9kYXRlOiBzdGFydGRhdGUsCiAgICBpc19jYW5jZWxlZDogJzAnLAogICAgZW5kX2RhdGU6IGVuZGRhdGUKICB9OwoKICBnZXRFdmVudHNSZXBvcnQoJGh0dHAsJHNjb3BlLCAkc2NvcGUuZXZlbnRSZXBvcnRDb25maWcsIGdldEV2ZW50c1JlcG9ydEFnZ3JlZ2F0ZWRfc3VjY2Vzcyk7CgogIGZ1bmN0aW9uIGdldEV2ZW50c1JlcG9ydEFnZ3JlZ2F0ZWRfc3VjY2VzcyhyZXNwb25zZSl7CiAgICAkc2NvcGUuYWRtaW5fZXZlbnRzID0gcmVzcG9uc2UuanNvbjsKICB9CiAgLy8gJGh0dHAucG9zdChwb3N0dXJsLCBwYXlsb2FkLCBjb25maWcpLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkKICAvLyB7CiAgLy8gICBsb2dEZWJ1ZygiZG9uZSIpOwogIC8vICAgJHNjb3BlLmFkbWluX2V2ZW50cyA9IGRhdGE7CiAgLy8gfSk7CgogICRzY29wZS5zaG93RXZlbnRQb3B1cCA9IGZ1bmN0aW9uKHNlbGVjdGVkRXZlbnQpIHsKICAgIHNob3dFdmVudFBvcHVwKHNlbGVjdGVkRXZlbnQsICR1aWJNb2RhbCkKICB9OwogICRzY29wZS5lZGl0RXZlbnQ9IGZ1bmN0aW9uICh0aGVldmVudCkKICB7CiAgICBnb3RvRXZlbnRQYWdlKHRoZWV2ZW50KTsKICB9Cn0pOwoKLy8ga3V6ZUFwcC5jb250cm9sbGVyKCdCdXNpbmVzc0NvbmZpZ0NvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkcm91dGVQYXJhbXMsICRsb2NhdGlvbiwgJHJvdXRlLCBzaGFyZWREYXRhKSB7CgprdXplQXBwLmNvbnRyb2xsZXIoJ0NvbmZpZ1VzZXJDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkdWliTW9kYWwsICRodHRwLCAkdGltZW91dCkKewogICRzY29wZS5pblRoZU1pZGRsZU9mU2F2ZT1mYWxzZTsKCiAgbG9nRGVidWcoIkNvbmZpZ1VzZXJDb250cm9sbGVyIik7Ci8vICRzY29wZS5hamF4X2luZm89IteU16nXmdeg15XXmdeZ150g16DXqdee16jXlSI7CgogIGdldEJ1c2luZXNzVXNlclJlbGF0aW9ucygkaHR0cCwkc2NvcGUsJ2J1c2luZXNzX3VzZXJfcmVsYXRpb25zJyxnZXRMb2dnZWRVc2VySW5mb19zdWNjZXNzLGdldExvZ2dlZFVzZXJJbmZvX2ZhaWx1cmUpOwoKICBnZXRMb2dnZWRVc2VySW5mbygkaHR0cCwkc2NvcGUsJ3VzZXJQcm9wZXJ0aWVzJyxnZXRMb2dnZWRVc2VySW5mb19zdWNjZXNzLGdldExvZ2dlZFVzZXJJbmZvX2ZhaWx1cmUpOwogIGZ1bmN0aW9uIGdldExvZ2dlZFVzZXJJbmZvX3N1Y2Nlc3MoKQogIHsKICAgIGxvZ0RlYnVnKCJnZXRMb2dnZWRVc2VySW5mb19zdWNjZXNzIik7CiAgICAvLyAkc2NvcGUudXNlclByb3BlcnRpZXNEdXBsaWNhdGUgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KCRzY29wZS51c2VyUHJvcGVydGllcykpOwogIH0KICBmdW5jdGlvbiBnZXRMb2dnZWRVc2VySW5mb19mYWlsdXJlKCkKICB7CiAgICBsb2dEZWJ1ZygiZ2V0TG9nZ2VkVXNlckluZm9fZmFpbHVyZSIpOwogIH0KCiAgJHNjb3BlLmJhY2sgPSBmdW5jdGlvbigpIHsKICAgIHdpbmRvdy5oaXN0b3J5LmJhY2soKTsKICB9OwoKICAkc2NvcGUuY2hhbmdlUGFzc3dvcmRNb2RhbCA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1ZygiY2hhbmdlUGFzc3dvcmRNb2RhbCIrJHNjb3BlLnVzZXJQcm9wZXJ0aWVzRHVwbGljYXRlWzBdKTsKICAgICRzY29wZS5pblRoZU1pZGRsZU9mU2F2ZT10cnVlOwogICAgZnVuY3Rpb24gc21zUmVzZXRQYXNzd29yZF9zdWNjZXNzKCkKICAgIHsKICAgICAgY29uc29sZS5sb2coInNtc1Jlc2V0UGFzc3dvcmRfc3VjY2VzcyIpOwogICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAgICAgICBhbmltYXRpb246IGZhbHNlLAogICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ21vZGFsX2NoYW5nZV9wYXNzd29yZC5waHAnLAogICAgICAgIGNvbnRyb2xsZXI6ICdtb2RhbF9jaGFuZ2VfcGFzc3dvcmQnLAogICAgICAgIHNpemU6ICdsJywKICAgICAgICByZXNvbHZlOiB7CiAgICAgICAgICB1c2VyX3Bob25lX251bWJlcjogZnVuY3Rpb24oKSB7Ci8vIHBhc3Npbmcgb3JpZ2luYWwgcGhvbmUgbnVtYmVyCiAgICAgICAgICAgIHJldHVybiAkc2NvcGUudXNlclByb3BlcnRpZXNEdXBsaWNhdGVbMF0ucGhvbmVfbnVtYmVyOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CgogICAgICBtb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHJlc3VsdCkgewogICAgICAgICRzY29wZS5pblRoZU1pZGRsZU9mU2F2ZT1mYWxzZTsKICAgICAgICBsb2dEZWJ1Zygnc21zUmVzZXRQYXNzd29yZCBNb2RhbCBmaW5pc2VoZCByZXN1bHQ6ICcgKyByZXN1bHQpOwogICAgICAgICRzY29wZS5hamF4X2luZm89IteU16HXmdeh157XkCDXoteV15PXm9eg15Qg15HXlNem15zXl9eUISI7Ci8vIGdldExvZ2dlZFVzZXJJbmZvKCRodHRwLCRzY29wZSwndXNlclByb3BlcnRpZXMnLGdldExvZ2dlZFVzZXJJbmZvX3N1Y2Nlc3MsZ2V0TG9nZ2VkVXNlckluZm9fZmFpbHVyZSk7CiAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKQogICAgICAgIHsKICAgICAgICAgICRzY29wZS5hamF4X2luZm89bnVsbDsKICAgICAgICB9LCAyMDAwKTsKICAgICAgICBsb2dEZWJ1Zygnc21zUmVzZXRQYXNzd29yZCBNb2RhbCBkaXNtaXNzZWQgYXQ6ICcgKyBuZXcgRGF0ZSgpKTsKICAgICAgfSwgZnVuY3Rpb24oKSB7CiAgICAgICAgJHNjb3BlLmluVGhlTWlkZGxlT2ZTYXZlPWZhbHNlOwogICAgICAgIGxvZ0RlYnVnKCdtb2RhbF9jaGFuZ2VfcGFzc3dvcmQgTW9kYWwgZGlzbWlzc2VkIGF0OiAnICsgbmV3IERhdGUoKSk7CiAgICAgIH0pOwogICAgfQoKCiAgICBjaGFuZ2VQYXNzd29yZFNNUygkaHR0cCwkc2NvcGUsJHNjb3BlLnVzZXJQcm9wZXJ0aWVzRHVwbGljYXRlWzBdLnBob25lX251bWJlcixzbXNSZXNldFBhc3N3b3JkX3N1Y2Nlc3MpOwogIH0KICAkc2NvcGUudXBkYXRlVXNlckNvbmZpZz1mdW5jdGlvbigpCiAgewogICAgJHNjb3BlLmluVGhlTWlkZGxlT2ZTYXZlPXRydWU7CiAgICBsb2dEZWJ1ZygidXBkYXRlVXNlckNvbmZpZywgaW5UaGVNaWRkbGVPZlNhdmU9Iiskc2NvcGUuaW5UaGVNaWRkbGVPZlNhdmUpOwovLyBsb2dEZWJ1Zygkc2NvcGUudXNlclByb3BlcnRpZXNEdXBsaWNhdGUpOwovLyBsb2dEZWJ1Zygkc2NvcGUudXNlclByb3BlcnRpZXMpOwogICAgaWYgKGFuZ3VsYXIuZXF1YWxzKCRzY29wZS51c2VyUHJvcGVydGllc0R1cGxpY2F0ZVswXS5waG9uZV9udW1iZXIsJHNjb3BlLnVzZXJQcm9wZXJ0aWVzWzBdLnBob25lX251bWJlcikpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJub3RoaW5nIGNoYW5nZWQgaW4gcGhvbmUgbnVtYmVyLCBjaGVja2luZyBvdGhlciBkYXRhIG90aGVyIGRhdGEiKTsKICAgICAgaWYgKGFuZ3VsYXIuZXF1YWxzKCRzY29wZS51c2VyUHJvcGVydGllc0R1cGxpY2F0ZVswXSwkc2NvcGUudXNlclByb3BlcnRpZXNbMF0pKQogICAgICB7CiAgICAgICAgJHNjb3BlLmluVGhlTWlkZGxlT2ZTYXZlPWZhbHNlOwogICAgICAgIGxvZ0RlYnVnKCJub3RoaW5nIGNoYW5nZWQgaW4gZGV0YWlscywgbm90aGluZyB0byBzYXZlIik7CiAgICAgICAgJHNjb3BlLmFqYXhfaW5mbz0i15zXkCDXkdeV16bXoteVINep15nXoNeV15nXmdedINec16nXnteZ16jXlC4uLiI7CiAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKQogICAgICAgIHsKICAgICAgICAgICRzY29wZS5hamF4X2luZm89bnVsbDsKICAgICAgICB9LCAxNTAwKTsKICAgICAgfQogICAgICBlbHNlCiAgICAgIHsKICAgICAgICBjaGFuZ2VVc2VyRGV0YWlscygkaHR0cCwkc2NvcGUsJHNjb3BlLnVzZXJQcm9wZXJ0aWVzWzBdLmZpcnN0X25hbWUsJHNjb3BlLnVzZXJQcm9wZXJ0aWVzWzBdLmxhc3RfbmFtZSwgJHNjb3BlLnVzZXJQcm9wZXJ0aWVzWzBdLmVtYWlsX2FkZHJlc3MsY2hhbmdlVXNlckRldGFpbHNfc3VjY2VzcywgY2hhbmdlVXNlckRldGFpbHNfZmFpbHVyZSk7CiAgICAgICAgJHNjb3BlLmFqYXhfaW5mbz0i157XoteT15vXnyDXqdeZ16DXldeZ15nXnS4uLiI7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGNoYW5nZVVzZXJEZXRhaWxzX3N1Y2Nlc3MoKQogICAgICB7CiAgICAgICAgbG9nRGVidWcoImNoYW5nZVVzZXJEZXRhaWxzX3N1Y2Nlc3MiKTsKICAgICAgICAkc2NvcGUuYWpheF9pbmZvPSLXlNep15nXoNeV15nXmdedINeg16nXnteo15Ug15HXlNem15zXl9eUISI7CiAgICAgICAgJHNjb3BlLmluVGhlTWlkZGxlT2ZTYXZlPWZhbHNlOwogICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkKICAgICAgICB7CiAgICAgICAgICAkc2NvcGUuYWpheF9pbmZvPW51bGw7CiAgICAgICAgfSwgMTUwMCk7CiAgICAgICAgZ2V0TG9nZ2VkVXNlckluZm8oJGh0dHAsJHNjb3BlLCd1c2VyUHJvcGVydGllcycsZ2V0TG9nZ2VkVXNlckluZm9fc3VjY2VzcyxnZXRMb2dnZWRVc2VySW5mb19mYWlsdXJlKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBjaGFuZ2VVc2VyRGV0YWlsc19mYWlsdXJlKCkKICAgICAgewogICAgICAgIGxvZ0RlYnVnKCJjaGFuZ2VVc2VyRGV0YWlsc19mYWlsdXJlIik7CiAgICAgIH0KCiAgICB9CiAgICBlbHNlCiAgICB7Ci8vIHVwZGF0ZSB1c2VyIGluZm8gLSBhZnRlciB2ZXJpZnlpbmcgcGFzc3dvcmQKICAgICAgY29uc29sZS5sb2coInBob25lIGNoYW5nZWQsIGNoZWNraW5nIGlmIG5ldyBwaG9uZSBpcyBpbiBkZXNjZW50IGZvcm1hdCIpOwogICAgICBpZiAoIWNoZWNrUGhvbmVOdW1iZXIoJHNjb3BlLnVzZXJQcm9wZXJ0aWVzWzBdLnBob25lX251bWJlcikpCiAgICAgIHsKICAgICAgICAkc2NvcGUuYWpheF9pbmZvPSLXkNeg15Ag15TXltefINee16HXpNeoINeY15zXpNeV158g16HXnNeV15zXqNeZINeq16fXmdefINec16fXkdec16og15TXldeT16LXldeqINee16fXmdeV15YuIjsKICAgICAgICAkdGltZW91dChmdW5jdGlvbigpCiAgICAgICAgewogICAgICAgICAgJHNjb3BlLmFqYXhfaW5mbz1udWxsOwogICAgICAgIH0sIDMwMDApOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBjb25zb2xlLmxvZygicGhvbmUgY2hhbmdlZCwgY2hlY2tpbmcgaWYgbmV3IHBob25lIGlzIG5vdCB1c2VkIGFscmVhZHkiKTsKICAgICAgaXNOZXdQaG9uZVVzZWRJZk5vdFNlbmRTTVMoJGh0dHAsJHNjb3BlLCRzY29wZS51c2VyUHJvcGVydGllc1swXS5waG9uZV9udW1iZXIsIGlzTmV3UGhvbmVVc2VkX3N1Y2Nlc3MsIGlzTmV3UGhvbmVVc2VkX2ZhaWx1cmUsZmFsc2UpOwogICAgICBmdW5jdGlvbiBpc05ld1Bob25lVXNlZF9zdWNjZXNzKHJlc3BvbnNlKQogICAgICB7CiAgICAgICAgY29uc29sZS5sb2coInBob25lIG5vdCB1c2VkIC0gcHJvbXB0aW5nIGZvciBwYXNzd29yZCIpOwogICAgICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewogICAgICAgICAgYW5pbWF0aW9uOiBmYWxzZSwKICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ21vZGFsX2NoZWNrX3Bhc3N3b3JkX3VwZGF0ZV9jb25maWcucGhwJywKICAgICAgICAgIGNvbnRyb2xsZXI6ICdtb2RhbF9jaGVja19wYXNzd29yZF91cGRhdGVfY29uZmlnJywKICAgICAgICAgIHNpemU6ICdsJywKICAgICAgICAgIHJlc29sdmU6IHsKICAgICAgICAgICAgbmV3X3VzZXJfcHJvZXJ0aWVzOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICByZXR1cm4gJHNjb3BlLnVzZXJQcm9wZXJ0aWVzWzBdOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIG1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7CiAgICAgICAgICBsb2dEZWJ1ZygnbW9kYWxfY2hlY2tfcGFzc3dvcmRfdXBkYXRlX2NvbmZpZyBNb2RhbCBmaW5pc2hlZCByZXN1bHQ6ICcgKyByZXN1bHQpOwogICAgICAgICAgJHNjb3BlLmFqYXhfaW5mbz0i15TXqdeZ16DXldeZ15nXnSDXoNep157XqNeVINeR15TXptec15fXlCEiOwogICAgICAgICAgJHNjb3BlLmluVGhlTWlkZGxlT2ZTYXZlPWZhbHNlOwogICAgICAgICAgZ2V0TG9nZ2VkVXNlckluZm8oJGh0dHAsJHNjb3BlLCd1c2VyUHJvcGVydGllcycsZ2V0TG9nZ2VkVXNlckluZm9fc3VjY2VzcyxnZXRMb2dnZWRVc2VySW5mb19mYWlsdXJlKTsKICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkKICAgICAgICAgIHsKICAgICAgICAgICAgJHNjb3BlLmFqYXhfaW5mbz1udWxsOwogICAgICAgICAgfSwgMzAwMCk7CiAgICAgICAgfSwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAkc2NvcGUuaW5UaGVNaWRkbGVPZlNhdmU9ZmFsc2U7CiAgICAgICAgICBsb2dEZWJ1ZygnbW9kYWxfY2hlY2tfcGFzc3dvcmRfdXBkYXRlX2NvbmZpZyBNb2RhbCBkaXNtaXNzZWQgYXQ6ICcgKyBuZXcgRGF0ZSgpKTsKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gaXNOZXdQaG9uZVVzZWRfZmFpbHVyZShyZXNwb25zZSkKICAgICAgewogICAgICAgICRzY29wZS5hamF4X2luZm89cmVzcG9uc2UubWVzc2FnZTsKICAgICAgICAkdGltZW91dChmdW5jdGlvbigpCiAgICAgICAgewogICAgICAgICAgJHNjb3BlLmFqYXhfaW5mbz1udWxsOwogICAgICAgIH0sIDIwMDApOwogICAgICB9CiAgICB9CiAgfTsKfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdtb2RhbF9jaGVja19wYXNzd29yZF91cGRhdGVfY29uZmlnJywgZnVuY3Rpb24oJHNjb3BlLCAkdGltZW91dCwgJHVpYk1vZGFsSW5zdGFuY2UsIG5ld191c2VyX3Byb2VydGllcywgJGh0dHApCnsKICAkc2NvcGUubmV3X3VzZXJfcHJvZXJ0aWVzPW5ld191c2VyX3Byb2VydGllczsKICBsb2dEZWJ1ZygibW9kYWxfY2hlY2tfcGFzc3dvcmRfdXBkYXRlX2NvbmZpZyBjb250cm9sbGVyIik7Ci8vICRzY29wZS5waG9uZV92ZXJpZmljYXRpb24gPSB7fTsgLy8gdGhlc2UgYXJlIHRoZSBjb21wbGV0ZSBkZXRhaWxzIGZvciB0aGUgbmV3IGV2ZW50IC8vCi8vICRzY29wZS5waG9uZV92ZXJpZmljYXRpb24ucGhvbmVfbnVtYmVyPW5ld191c2VyX3Byb2VydGllcy5waG9uZV9udW1iZXI7CiAgJHNjb3BlLmNsb3NlID0gZnVuY3Rpb24oKSB7CiAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnZGlzbWlzcycpOwogIH07CgogICRzY29wZS5jaGFuZ2VQaG9uZU51bWJlciA9IGZ1bmN0aW9uKCkKICB7CiAgICBjaGFuZ2VVc2VyRGV0YWlsc1ZlcmlmeSgkaHR0cCwkc2NvcGUsJHNjb3BlLm5ld191c2VyX3Byb2VydGllcy5waG9uZV9udW1iZXIsJHNjb3BlLm5ld191c2VyX3Byb2VydGllcy5maXJzdF9uYW1lLCRzY29wZS5uZXdfdXNlcl9wcm9lcnRpZXMubGFzdF9uYW1lLCAkc2NvcGUubmV3X3VzZXJfcHJvZXJ0aWVzLmVtYWlsX2FkZHJlc3MsJHNjb3BlLnZlcmlmeV91c2VyX3Bhc3N3b3JkLCRzY29wZS5waG9uZV92ZXJpZmljYXRpb24sY2hhbmdlVXNlckRldGFpbHNWZXJpZnlfc3VjY2VzcywgY2hhbmdlVXNlckRldGFpbHNWZXJpZnlfZmFpbHVyZSxmYWxzZSk7CiAgICBmdW5jdGlvbiBjaGFuZ2VVc2VyRGV0YWlsc1ZlcmlmeV9zdWNjZXNzKCkKICAgIHsKICAgICAgbG9nRGVidWcoImNoYW5nZVVzZXJEZXRhaWxzVmVyaWZ5X3N1Y2Nlc3MiKTsKLy8gYWxlcnQoJ9eU16nXmdeg15XXmdeZ150g16LXldeT15vXoNeVINeR15TXptec15fXlCcpOwogICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSh0cnVlKTsKICAgIH0KICAgIGZ1bmN0aW9uIGNoYW5nZVVzZXJEZXRhaWxzVmVyaWZ5X2ZhaWx1cmUocmVzcG9uc2UpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJjaGFuZ2VVc2VyRGV0YWlsc1ZlcmlmeV9mYWlsdXJlICIrcmVzcG9uc2UubWVzc2FnZSk7CiAgICAgICRzY29wZS5hamF4X2Vycm9yPXJlc3BvbnNlLm1lc3NhZ2UrIi4iOwogICAgICAkdGltZW91dChmdW5jdGlvbigpCiAgICAgIHsKICAgICAgICAkc2NvcGUuYWpheF9lcnJvcj1udWxsOwogICAgICB9LCA0MDAwKTsKICAgIH0KICB9Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignbW9kYWxfY2hhbmdlX3Bhc3N3b3JkJywgZnVuY3Rpb24oJHNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgdXNlcl9waG9uZV9udW1iZXIsICRodHRwKQp7CiAgbG9nRGVidWcoIm1vZGFsX2NoYW5nZV9wYXNzd29yZCBjb250cm9sbGVyIik7CiAgJHNjb3BlLnBob25lX3ZlcmlmaWNhdGlvbiA9IHt9OyAvLyB0aGVzZSBhcmUgdGhlIGNvbXBsZXRlIGRldGFpbHMgZm9yIHRoZSBuZXcgZXZlbnQgLy8KICAkc2NvcGUucGhvbmVfdmVyaWZpY2F0aW9uLnBob25lX251bWJlcj11c2VyX3Bob25lX251bWJlcjsKICAkc2NvcGUucGhvbmVfdmVyaWZpY2F0aW9uLnNtc19lcnJvcj0iIjsKICAkc2NvcGUuY2xvc2UgPSBmdW5jdGlvbigpIHsKICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCdkaXNtaXNzJyk7CiAgfTsKCiAgJHNjb3BlLmNoYW5nZVBhc3N3b3JkID0gZnVuY3Rpb24oKQogIHsKICAgIGNoYW5nZVBhc3N3b3JkKCRodHRwLCRzY29wZSwkc2NvcGUucGhvbmVfdmVyaWZpY2F0aW9uLnVzZXJfcGFzc3dvcmQsJHNjb3BlLnBob25lX3ZlcmlmaWNhdGlvbi51c2VyX3Bhc3N3b3JkMiwkc2NvcGUucGhvbmVfdmVyaWZpY2F0aW9uLnZlcmlmaWNhdGlvbl9jb2RlLCBjaGFuZ2VQYXNzd29yZF9zdWNjZXNzLCBjaGFuZ2VQYXNzd29yZF9mYWlsdXJlLGZhbHNlKTsKICAgICRzY29wZS5hamF4X2Vycm9yPSIiOwogICAgZnVuY3Rpb24gY2hhbmdlUGFzc3dvcmRfc3VjY2VzcygpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJjaGFuZ2VQYXNzd29yZF9zdWNjZXNzIik7CiAgICAgIHN0YXR1cz0iZmZmZmYiOwovLyBhbGVydCgn15TXodeZ16HXnteQINei15XXk9eb16DXlCDXkdeU16bXnNeX15QnKTsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UodHJ1ZSk7CiAgICB9CiAgICBmdW5jdGlvbiBjaGFuZ2VQYXNzd29yZF9mYWlsdXJlKHJlc3BvbnNlKQogICAgewogICAgICBsb2dEZWJ1ZygiY2hhbmdlUGFzc3dvcmRfZmFpbHVyZSAiK3Jlc3BvbnNlLm1lc3NhZ2UpOwogICAgICAkc2NvcGUuYWpheF9lcnJvcj1yZXNwb25zZS5tZXNzYWdlOwogICAgfQogIH0KfSk7CgprdXplQXBwLmZhY3RvcnkoJ0J1c2luZXNzQ29uZmlnJywgZnVuY3Rpb24oJGh0dHApIHsKICByZXR1cm4gewogICAgZ2V0OiBmdW5jdGlvbiAoKSB7CiAgICAgIGxvZ0RlYnVnKCJsb2FkIGdldF9idXNpbmVzc19jb25maWciKTsKICAgICAgcmV0dXJuICRodHRwLmdldCgiL2FwaS9hZG1pbi9idXNpbmVzc19jb25maWciKQogICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHsKICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHJlc3BvbnNlLmRhdGFbMF07CiAgICAgICAgICAgIHJlc3VsdC51c2VfaG9saWRheXM9ISFwYXJzZUludChyZXNwb25zZS5kYXRhWzBdLnVzZV9ob2xpZGF5cyk7CiAgICAgICAgICAgIHJlc3VsdC5zbXNfbm90aWZpY2F0aW9ucz0hIXBhcnNlSW50KHJlc3BvbnNlLmRhdGFbMF0uc21zX25vdGlmaWNhdGlvbnMpOwogICAgICAgICAgICByZXN1bHQuc3RhcnRfaW52b2ljZV9udW1iZXIgPSBwYXJzZUludChyZXNwb25zZS5kYXRhWzBdLnN0YXJ0X2ludm9pY2VfbnVtYmVyKTsKICAgICAgICAgICAgdmFyIGQgPSBuZXcgRGF0ZSgpOwogICAgICAgICAgICBkLnNldEhvdXJzKCByZXN1bHQuY2FsZW5kYXJfZGlzcGxheV9zdGFydF9ob3VycyApOwogICAgICAgICAgICBkLnNldE1pbnV0ZXMoIHJlc3VsdC5jYWxlbmRhcl9kaXNwbGF5X3N0YXJ0X21pbnV0ZXMgKTsKICAgICAgICAgICAgcmVzdWx0Lm15dGltZSA9IGQ7CiAgICAgICAgICAgIHJlc3VsdC5jYWxlbmRhcl9kaXNwbGF5X3N0YXJ0ID0gZDsKICAgICAgICAgICAgdmFyIGQgPSBuZXcgRGF0ZSgpOwogICAgICAgICAgICBkLnNldEhvdXJzKCByZXN1bHQuY2FsZW5kYXJfZGlzcGxheV9lbmRfaG91cnMgKTsKICAgICAgICAgICAgZC5zZXRNaW51dGVzKCByZXN1bHQuY2FsZW5kYXJfZGlzcGxheV9lbmRfbWludXRlcyApOwogICAgICAgICAgICByZXN1bHQubXl0aW1lID0gZDsKICAgICAgICAgICAgcmVzdWx0LmNhbGVuZGFyX2Rpc3BsYXlfZW5kID0gZDsKICAgICAgICAgICAgcmVzdWx0LnZhdF9yYXRlID0gTnVtYmVyKHJlc3VsdC52YXRfcmF0ZSk7CiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgICB9KTsKICAgIH0KICB9Owp9KTsKCmt1emVBcHAuY29udHJvbGxlcignQ29uZmlnQnVzaW5lc3NDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJHRpbWVvdXQsIEJ1c2luZXNzQ29uZmlnKQp7CiAgbG9nRGVidWcoIm15IGJ1c2luZXNzIGNvbmZpZyIpOwogICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzPVtdOwoKICBmdW5jdGlvbiBnZXRfYnVzaW5lc3NfY29uZmlnKCkgewogICAgbG9nRGVidWcoImdldF9idXNpbmVzc19jb25maWciKTsKICAgIGxvZ0RlYnVnKCJCdXNpbmVzc0NvbmZpZzogIiwgQnVzaW5lc3NDb25maWcpOwogICAgQnVzaW5lc3NDb25maWcuZ2V0KCkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7ICRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMgPSByZXN1bHQ7IH0pOwogIH0KICBnZXRfYnVzaW5lc3NfY29uZmlnKCk7CgoKICAkc2NvcGUuaHN0ZXAgPSAxOwogICRzY29wZS5tc3RlcCA9IDE1OwoKICAkc2NvcGUuYnVzaW5lc3NDb25maWdDYW5jZWwgPSBmdW5jdGlvbigpIHsKICAgIHdpbmRvdy5oaXN0b3J5LmJhY2soKTsKICB9OwoKICAkc2NvcGUudXBkYXRlQnVzaW5lc3NDb25maWcgPSBmdW5jdGlvbigpIHsKICAgIGxvZ0RlYnVnKCJ1cGRhdGluZyBidXNpbmVzcyBjb25maWciICsgSlNPTi5zdHJpbmdpZnkoJHNjb3BlLmJ1c2luZXNzUHJvcGVydGllcykpOwoKICAgICRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXNfYWpheF9lcnJvcj0iIjsKICAgICRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMuY2FsZW5kYXJfZGlzcGxheV9zdGFydF9ob3Vycz0kc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzLmNhbGVuZGFyX2Rpc3BsYXlfc3RhcnQuZ2V0SG91cnMoKTsKICAgICRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMuY2FsZW5kYXJfZGlzcGxheV9zdGFydF9taW51dGVzPSRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMuY2FsZW5kYXJfZGlzcGxheV9zdGFydC5nZXRNaW51dGVzKCk7CiAgICAkc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzLmNhbGVuZGFyX2Rpc3BsYXlfZW5kX2hvdXJzPSRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMuY2FsZW5kYXJfZGlzcGxheV9lbmQuZ2V0SG91cnMoKTsKICAgICRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMuY2FsZW5kYXJfZGlzcGxheV9lbmRfbWludXRlcz0kc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzLmNhbGVuZGFyX2Rpc3BsYXlfZW5kLmdldE1pbnV0ZXMoKTsKICAgIGlmICgkc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzLmNhbGVuZGFyX2Rpc3BsYXlfc3RhcnRfaG91cnM+JHNjb3BlLmJ1c2luZXNzUHJvcGVydGllcy5jYWxlbmRhcl9kaXNwbGF5X2VuZF9ob3VycykKICAgIHsKICAgICAgYWxlcnQoJ9eW157XnyDXodeZ15XXnSDXnNeQINeZ15vXldecINec15TXmdeV16og15zXpNeg15kg15bXntefINeU16rXl9ec15QnKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgJHNjb3BlLmJ1c2luZXNzUHJvcGVydGllc19hamF4X2Vycm9yPSLXntei15PXm9efINeg16rXldeg15nXnS4uLiI7CgogICAgJGh0dHAoewogICAgICBtZXRob2Q6ICdQT1NUJywKICAgICAgdXJsOiAnL2FwaS9hZG1pbi9idXNpbmVzc19jb25maWcvc2V0JywKICAgICAgZGF0YTogJHNjb3BlLmJ1c2luZXNzUHJvcGVydGllcywgLy8gcGFzcyBpbiBkYXRhIGFzIHN0cmluZ3MKICAgICAgaGVhZGVyczogewogICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbjtjaGFyc2V0PXV0Zi04JwogICAgICB9CiAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHsKCiAgICAgIGxvZ0RlYnVnKGRhdGEpOwogICAgICBpZiAoIWRhdGEuc3VjY2VzcykgewogICAgICAgIGxvZ0RlYnVnKCJlcnJvciAiICsgZGF0YS5NZXNzYWdlKTsKICAgICAgICAkc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzX2FqYXhfZXJyb3IgPSBkYXRhLk1lc3NhZ2U7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgJGdDYWxlbmRhckRpc3BsYXlNaW5UaW1lPWRhdGEuanNvbi5uZXdTdGFydFRpbWU7CiAgICAgICAgJGdDYWxlbmRhckRpc3BsYXlNYXhUaW1lPWRhdGEuanNvbi5uZXdFbmRUaW1lOwogICAgICAgIGNvbnNvbGUubG9nKCJ1cGRhdGVkIGdDYWxlbmRhckRpc3BsYXlNaW5UaW1lPSIrJGdDYWxlbmRhckRpc3BsYXlNaW5UaW1lKTsKICAgICAgICBjb25zb2xlLmxvZygidXBkYXRlZCBnQ2FsZW5kYXJEaXNwbGF5TWF4VGltZT0iKyRnQ2FsZW5kYXJEaXNwbGF5TWF4VGltZSk7CiAgICAgICAgJHNjb3BlLmJ1c2luZXNzUHJvcGVydGllc19hamF4X2Vycm9yPSLXoteV15PXm9efINeR15TXptec15fXlCEiOwogICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkKICAgICAgICB7CiAgICAgICAgICAkc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzX2FqYXhfZXJyb3I9bnVsbDsKICAgICAgICB9LCAyMDAwKTsKICAgICAgICBnZXRfYnVzaW5lc3NfY29uZmlnKCk7Ci8vIHdpbmRvdy5oaXN0b3J5LmJhY2soKTsKLy8gJHNjb3BlLmJ1c2luZXNzUHJvcGVydGllc19hamF4X2Vycm9yID0gItek16jXmNeZINeU16LXodenINeg16nXnteo15Ug15HXlNem15zXl9eULiI7CgogICAgICB9CiAgICB9KTsKICB9Owp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ2NsaWVudENhcmRDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlKSB7CiAgbG9nRGVidWcoImNsaWVudENhcmRDb250cm9sbGVyIik7CiAgJHNjb3BlLmZ1dHVyZU1lZXRpbmdzID0gW3sKICAgIGRhdGV0aW1lOiAi16jXkNep15XXnywgMjUuMS4yMDE2IiwKICAgIGhvdXI6ICIxNDowMCIsCiAgICB0eXBlOiAi16fXkdeV16bXlCIsCiAgICBwcmljZTogIjEwMCIsCiAgICBsYWJlbHM6IFt7CiAgICAgIGxhYmVsOiAic3VjY2VzcyIsCiAgICAgIHRleHQ6ICLXqdeV15zXnSIKICAgIH0sIHsKICAgICAgbGFiZWw6ICJ3YXJuaW5nIiwKICAgICAgdGV4dDogItec15Ag16rXldei15MiCiAgICB9XQogIH0sIHsKICAgIGRhdGV0aW1lOiAi16jXkNep15XXnywgMjUuMS4yMDE2IiwKICAgIGhvdXI6ICIxNDowMCIsCiAgICB0eXBlOiAi16fXkdeV16bXlCIsCiAgICBwcmljZTogIjEwMCIsCiAgICBsYWJlbHM6IFt7CiAgICAgIGxhYmVsOiAiZGFuZ2VyIiwKICAgICAgdGV4dDogItec15Ag16nXldec150iCiAgICB9LCB7CiAgICAgIGxhYmVsOiAiaW5mbyIsCiAgICAgIHRleHQ6ICLXqteV16LXkyIKICAgIH1dCiAgfSwgewogICAgZGF0ZXRpbWU6ICLXqdec15nXqdeZLCAyNS4xLjIwMTYiLAogICAgaG91cjogIjE0OjAwIiwKICAgIHR5cGU6ICLXp9eR15XXpteUIiwKICAgIHByaWNlOiAiMTAwIiwKICAgIGxhYmVsczogW3sKICAgICAgbGFiZWw6ICJkYW5nZXIiLAogICAgICB0ZXh0OiAi15zXkCDXqdeV15zXnSIKICAgIH0sIHsKICAgICAgbGFiZWw6ICJpbmZvIiwKICAgICAgdGV4dDogIteq15XXoteTIgogICAgfV0KICB9LCB7CiAgICBkYXRldGltZTogIteo15DXqdeV158sIDI1LjEuMjAxNiIsCiAgICBob3VyOiAiMTQ6MDAiLAogICAgdHlwZTogIten15HXldem15QiLAogICAgcHJpY2U6ICIxMDAiCiAgfSwgXQoKICAkc2NvcGUuaGlzdG9yeU1lZXRpbmdzID0gW3sKICAgIGRhdGV0aW1lOiAi16jXkNep15XXnywgMjUuMS4yMDE2IiwKICAgIGhvdXI6ICIxNDowMCIsCiAgICB0eXBlOiAi16fXkdeV16bXlCIsCiAgICBwcmljZTogIjEwMCIKICB9LCB7CiAgICBkYXRldGltZTogIteo15DXqdeV158sIDI1LjEuMjAxNiIsCiAgICBob3VyOiAiMTQ6MDAiLAogICAgdHlwZTogIten15HXldem15QiLAogICAgcHJpY2U6ICIxMDAiCiAgfSwgewogICAgZGF0ZXRpbWU6ICLXqdec15nXqdeZLCAyNS4xLjIwMTYiLAogICAgaG91cjogIjE0OjAwIiwKICAgIHR5cGU6ICLXp9eR15XXpteUIiwKICAgIHByaWNlOiAiMTAwIgogIH0sIHsKICAgIGRhdGV0aW1lOiAi16jXkNep15XXnywgMjUuMS4yMDE2IiwKICAgIGhvdXI6ICIxNDowMCIsCiAgICB0eXBlOiAi16fXkdeV16bXlCIsCiAgICBwcmljZTogIjEwMCIKICB9LCBdCgogICRzY29wZS5jY1BheW1lbnRzID0gW3sKICAgIGRhdGV0aW1lOiAi16jXkNep15XXnywgMjUuMS4yMDE2IiwKICAgIHJlY2lwdF9udW06ICI3NjciLAogICAgYW1vdW50OiAiMzAwIiwKICAgIGxhYmVsczogW3sKICAgICAgbGFiZWw6ICJkYW5nZXIiLAogICAgICB0ZXh0OiAi15zXkCDXqdeV15nXmdeaIgogICAgfSwgewogICAgICBsYWJlbDogImluZm8iLAogICAgICB0ZXh0OiAi15TXldek16fXkyIKICAgIH1dCiAgfSwgXQoKCn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdrdXplQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikgewoKLy8gbWFpbiBrdXplIGNvbnRyb2xsZXIKCi8vIE1VU1QgU0VUIExBTkdVQUdFIEJFRk9SRSBBTlkgT1RIRVIgT1BFUkFUSU9OICEhIQogIHVwZGF0ZUdsb2JhbExhbmd1YWdlKCRzY29wZSwgJGdEZWZhdWx0TGFuZyk7Ci8vIE1VU1QgU0VUIExBTkdVQUdFIEJFRk9SRSBBTlkgT1RIRVIgT1BFUkFUSU9OICEhIQoKLy8gbG9nRGVidWcoInh4eHh4eHh4IiArICRzY29wZS5sYW5nZmlsZVsnc2hvd19hbGxfY2xpZW50cyddKTsKCiAgJHNjb3BlLnNob3dDbGllbnRzQ29sdW1ucyA9IFt7CiAgICBmaWVsZDogJ3VzZXJfaWQnLAogICAgbmFtZTogJHNjb3BlLmxhbmdmaWxlWydzaG93X2FsbF9jbGllbnRzX3VzZXJpZCddCiAgfSwgewogICAgZmllbGQ6ICdidXNlcl9maXJzdF9uYW1lJywKICAgIG5hbWU6ICRzY29wZS5sYW5nZmlsZVsnc2hvd19hbGxfY2xpZW50c19maXJzdF9uYW1lJ10KICB9LCB7CiAgICBmaWVsZDogJ2J1c2VyX2xhc3RfbmFtZScsCiAgICBuYW1lOiAkc2NvcGUubGFuZ2ZpbGVbJ3Nob3dfYWxsX2NsaWVudHNfbGFzdF9uYW1lJ10KICB9LCB7CiAgICBmaWVsZDogJ3JvbGVfbmFtZScsCiAgICBuYW1lOiAkc2NvcGUubGFuZ2ZpbGVbJ3Nob3dfYWxsX2NsaWVudHNfYXBwcm92ZWQnXQogIH1dOwoKCiAgJHNjb3BlLmdyaWRDbGllbnRDbGljayA9IGZ1bmN0aW9uKHJvdykgewovL2xvZ0RlYnVnKHJvdyk7CiAgICB2YXIgcm93X3VzZXJpZCA9IHJvdy5lbnRpdHkudXNlcl9pZDsKICAgIGxvZ0RlYnVnKCJzZWxlY3RlZCByb3cgdXNlcl9pZCA9IiArIHJvd191c2VyaWQpOwogICAgJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jbGllbnRzLycgKyByb3dfdXNlcmlkKTsKICB9OwoKICAkc2NvcGUuc2hvd0NsaWVudHNHcmlkT3B0aW9ucyA9IHsKICAgIGVuYWJsZUZpbHRlcmluZzogZmFsc2UsCiAgICBlbmFibGVTb3J0aW5nOiB0cnVlLAogICAgY29sdW1uRGVmczogJHNjb3BlLnNob3dDbGllbnRzQ29sdW1ucywKICAgIHJvd1RlbXBsYXRlOiAnL3B1YmxpYy9jb21wb25lbnRzL2NsaWVudHMtZ3JpZC1yb3cuaHRtbCcsCiAgICBvblJlZ2lzdGVyQXBpOiBmdW5jdGlvbihncmlkQXBpKSB7CiAgICAgICRzY29wZS5ncmlkQXBpID0gZ3JpZEFwaTsKICAgICAgJHNjb3BlLmdyaWRBcGkuZ3JpZC5yZWdpc3RlclJvd3NQcm9jZXNzb3IoJHNjb3BlLnNpbmdsZUZpbHRlciwgMjAwKTsKICAgIH0sCiAgfTsKCiAgJHNjb3BlLmlzQWN0aXZlID0gZnVuY3Rpb24odmlld0xvY2F0aW9uKSB7CiAgICBsb2dEZWJ1Zygidmlld0xvY2F0aW9uID0gIiArIHZpZXdMb2NhdGlvbik7CiAgICB2YXIgYWN0aXZlID0gKHZpZXdMb2NhdGlvbiA9PT0gJGxvY2F0aW9uLnBhdGgoKSk7CiAgICByZXR1cm4gYWN0aXZlOwogIH07CgogICRzY29wZS5maWx0ZXIgPSBmdW5jdGlvbigpIHsKICAgIGxvZ0RlYnVnKCJzaW5nbGUgZmlsdGVyIik7CiAgICAkc2NvcGUuZ3JpZEFwaS5ncmlkLnJlZnJlc2goKTsKICAgIGlmICgkc2NvcGUuZmlsdGVyLlZhbHVlICE9ICIiKSB7CiAgICAgICRzY29wZS5maWx0ZXIuYnV0dG9uVmFsdWUgPSAiJyIgKyAkc2NvcGUuZmlsdGVyLlZhbHVlICsgIiciOwogICAgfSBlbHNlIHsKICAgICAgJHNjb3BlLmZpbHRlci5idXR0b25WYWx1ZSA9ICIiOwogICAgfQogIH07CgogICRzY29wZS5zaW5nbGVGaWx0ZXIgPSBmdW5jdGlvbihyZW5kZXJhYmxlUm93cykgewogICAgdmFyIG1hdGNoZXIgPSBuZXcgUmVnRXhwKCRzY29wZS5maWx0ZXIuVmFsdWUpOwogICAgbG9nRGVidWcoInNjb3BlPSIgKyAkc2NvcGUpOwogICAgbG9nRGVidWcoInNjb3BlLmZpbHRlci5WYWx1ZT0iICsgJHNjb3BlLmZpbHRlci5WYWx1ZSk7CiAgICBpZiAoKCRzY29wZS5maWx0ZXIuVmFsdWUgPT0gbnVsbCkgfHwgKCRzY29wZS5maWx0ZXIuVmFsdWUgPT0gIiIpKSB7CiAgICAgIGxvZ0RlYnVnKCJlbXB0eSBmaWx0ZXIiKTsKICAgICAgcmV0dXJuIHJlbmRlcmFibGVSb3dzOwogICAgfQogICAgcmVuZGVyYWJsZVJvd3MuZm9yRWFjaChmdW5jdGlvbihyb3cpIHsKLy8JCQlsb2dEZWJ1Zygicm93PSIrcm93KTsKICAgICAgcm93LnZpc2libGUgPSBmYWxzZTsKICAgICAgdmFyICRjdXJyRmlyc3ROYW1lID0gcm93LmVudGl0eVsnZmlyc3RfbmFtZSddOwogICAgICB2YXIgJGN1cnJMYXN0TmFtZSA9IHJvdy5lbnRpdHlbJ2xhc3RfbmFtZSddOwogICAgICBsb2dEZWJ1ZygiY3VyckZpcnN0TmFtZT0iICsgJGN1cnJGaXJzdE5hbWUpOwoKICAgICAgaWYgKCRjdXJyRmlyc3ROYW1lICE9IG51bGwpIHsKICAgICAgICBpZiAoJGN1cnJGaXJzdE5hbWUuaW5kZXhPZigkc2NvcGUuZmlsdGVyLlZhbHVlKSA+IC0xKSB7CiAgICAgICAgICByb3cudmlzaWJsZSA9IHRydWU7CiAgICAgICAgfQogICAgICB9IGVsc2UgLy8gcm93IGlzIG51bGwKICAgICAgewogICAgICAgIHJvdy52aXNpYmxlID0gZmFsc2U7CiAgICAgIH0KCiAgICAgIGlmICgkY3Vyckxhc3ROYW1lICE9IG51bGwpIHsKICAgICAgICBpZiAoJGN1cnJMYXN0TmFtZS5pbmRleE9mKCRzY29wZS5maWx0ZXIuVmFsdWUpID4gLTEpIHsKICAgICAgICAgIHJvdy52aXNpYmxlID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0gZWxzZSAvLyByb3cgaXMgbnVsbAogICAgICB7CiAgICAgICAgcm93LnZpc2libGUgPSBmYWxzZTsKICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gcmVuZGVyYWJsZVJvd3M7CiAgfTsKCi8vIGltcG9ydGFudCEhIGluaXRpYWxpemluZyBhbmd1bGFyIGZvcm1zIGFzIGFycmF5cwogICRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhciA9IHt9OwogICRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhciA9IHt9OwoKLy8gbG9nRGVidWcoImxvY2F0aW9uPSIgKyAkbG9jYXRpb24pOwovLyBsb2dEZWJ1ZygkbG9jYXRpb24pOwoKICAkc2NvcGUuY2hhbmdlTGFuZyA9IGZ1bmN0aW9uKCRuZXdsYW5nKSB7CiAgICBsb2dEZWJ1ZygkbmV3bGFuZyk7Ci8vJHNjb3BlLnNwQ2xhc3MgPSAncmlnaHQnOwogICAgdXBkYXRlR2xvYmFsTGFuZ3VhZ2UoJHNjb3BlLCAkbmV3bGFuZykKICB9CgogICRzY29wZS5hZGROZXdDbGllbnQgPSBmdW5jdGlvbigpIHsKICAgICRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfY2xpZW50cy9hZGQnKTsKICB9CiAgJHNjb3BlLmFkZE5ld0luc3RydWN0b3IgPSBmdW5jdGlvbigpIHsKICAgICRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfaW5zdHJ1Y3RvcnMvYWRkJyk7CiAgfQp9KTsKCi8vLy8vLyBiZWZvcmUgZm9ybXMKa3V6ZUFwcC5jb250cm9sbGVyKCdEZW1vQ29udHJvbGxlcicsIFsKICAnJHNjb3BlJywgJyRidWlsZGVyJywgJyR2YWxpZGF0b3InLAogIGZ1bmN0aW9uKCRzY29wZSwgJGJ1aWxkZXIsICR2YWxpZGF0b3IpIHsKICAgIHZhciBjaGVja2JveCwgdGV4dGJveDsKICAgIHRleHRib3ggPSAkYnVpbGRlci5hZGRGb3JtT2JqZWN0KCdkZWZhdWx0JywgewogICAgICBpZDogJ3RleHRib3gnLAogICAgICBjb21wb25lbnQ6ICd0ZXh0SW5wdXQnLAogICAgICBsYWJlbDogJ05hbWUnLAogICAgICBkZXNjcmlwdGlvbjogJ1lvdXIgbmFtZScsCiAgICAgIHBsYWNlaG9sZGVyOiAnWW91ciBuYW1lJywKICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgIGVkaXRhYmxlOiBmYWxzZQogICAgfSk7CiAgICBjaGVja2JveCA9ICRidWlsZGVyLmFkZEZvcm1PYmplY3QoJ2RlZmF1bHQnLCB7CiAgICAgIGlkOiAnY2hlY2tib3gnLAogICAgICBjb21wb25lbnQ6ICdjaGVja2JveCcsCiAgICAgIGxhYmVsOiAnUGV0cycsCiAgICAgIGRlc2NyaXB0aW9uOiAnRG8geW91IGhhdmUgYW55IHBldHM/JywKICAgICAgb3B0aW9uczogWydEb2cnLCAnQ2F0J10KICAgIH0pOwogICAgJGJ1aWxkZXIuYWRkRm9ybU9iamVjdCgnZGVmYXVsdCcsIHsKICAgICAgY29tcG9uZW50OiAnc2FtcGxlSW5wdXQnCiAgICB9KTsKICAgICRzY29wZS5mb3JtID0gJGJ1aWxkZXIuZm9ybXNbJ2RlZmF1bHQnXTsKICAgICRzY29wZS5pbnB1dCA9IFtdOwogICAgJHNjb3BlLmRlZmF1bHRWYWx1ZSA9IHt9OwogICAgJHNjb3BlLmRlZmF1bHRWYWx1ZVt0ZXh0Ym94LmlkXSA9ICdkZWZhdWx0IHZhbHVlJzsKICAgICRzY29wZS5kZWZhdWx0VmFsdWVbY2hlY2tib3guaWRdID0gW3RydWUsIHRydWVdOwogICAgcmV0dXJuICRzY29wZS5zdWJtaXQgPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuICR2YWxpZGF0b3IudmFsaWRhdGUoJHNjb3BlLCAnZGVmYXVsdCcpLnN1Y2Nlc3MoZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIGxvZ0RlYnVnKCdzdWNjZXNzJyk7CiAgICAgIH0pLmVycm9yKGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBsb2dEZWJ1ZygnZXJyb3InKTsKICAgICAgfSk7CiAgICB9OwogIH0KXSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ0FsZXJ0RGVtb0N0cmwnLCBmdW5jdGlvbigkc2NvcGUpIHsKICAkc2NvcGUuYWxlcnRzID0gW3sKICAgIHR5cGU6ICdkYW5nZXInLAogICAgbXNnOiAnT2ggc25hcCEgQ2hhbmdlIGEgZmV3IHRoaW5ncyB1cCBhbmQgdHJ5IHN1Ym1pdHRpbmcgYWdhaW4uJwogIH0sIHsKICAgIHR5cGU6ICdzdWNjZXNzJywKICAgIG1zZzogJ1dlbGwgZG9uZSEgWW91IHN1Y2Nlc3NmdWxseSByZWFkIHRoaXMgaW1wb3J0YW50IGFsZXJ0IG1lc3NhZ2UuJwogIH1dOwoKICAkc2NvcGUuYWRkQWxlcnQgPSBmdW5jdGlvbigpIHsKICAgICRzY29wZS5hbGVydHMucHVzaCh7CiAgICAgIG1zZzogJ0Fub3RoZXIgYWxlcnQhJwogICAgfSk7CiAgfTsKCiAgJHNjb3BlLmNsb3NlQWxlcnQgPSBmdW5jdGlvbihpbmRleCkgewogICAgJHNjb3BlLmFsZXJ0cy5zcGxpY2UoaW5kZXgsIDEpOwogIH07Cn0pOwoKCmZ1bmN0aW9uIGlzTnVtYmVyS2V5KGV2dCl7CiAgdmFyIGNoYXJDb2RlID0gKGV2dC53aGljaCkgPyBldnQud2hpY2ggOiBldmVudC5rZXlDb2RlOwogIHJldHVybiAhKGNoYXJDb2RlID4gMzEgJiYgKGNoYXJDb2RlIDwgNDggfHwgY2hhckNvZGUgPiA1NykpOwp9Cg==</text>
      </register>
      <register name="1" type="2">
        <text encoding="base64">ICAgICAgICAgIDxvcHRpb24gZGF0YS1uZy1yZXBlYXQ9ImJhbmsgaW4gYmFua3MiIHZhbHVlPSJ7e2JhbmsuY29kZX19Ij57e2JhbmsubmFtZX19PC9vcHRpb24+Cg==</text>
      </register>
      <register name="2" type="2">
        <text encoding="base64">ICAgIAo=</text>
      </register>
      <register name="r" type="4">
        <keys>
          <key char="64" code="0" mods="0" />
          <key char="116" code="0" mods="0" />
          <key char="119" code="0" mods="0" />
          <key char="105" code="0" mods="0" />
          <key char="123" code="0" mods="0" />
          <key char="32" code="0" mods="0" />
          <key char="116" code="0" mods="0" />
          <key char="121" code="0" mods="0" />
          <key char="65535" code="8" mods="0" />
          <key char="65535" code="8" mods="0" />
          <key char="99" code="0" mods="0" />
          <key char="111" code="0" mods="0" />
          <key char="100" code="0" mods="0" />
          <key char="101" code="0" mods="0" />
          <key char="32" code="0" mods="0" />
          <key char="58" code="0" mods="0" />
          <key char="65535" code="91" mods="130" />
          <key char="65" code="0" mods="0" />
          <key char="44" code="0" mods="0" />
          <key char="65535" code="8" mods="0" />
          <key char="44" code="0" mods="0" />
          <key char="65535" code="91" mods="130" />
          <key char="119" code="0" mods="0" />
          <key char="119" code="0" mods="0" />
          <key char="105" code="0" mods="0" />
          <key char="110" code="0" mods="0" />
          <key char="97" code="0" mods="0" />
          <key char="109" code="0" mods="0" />
          <key char="101" code="0" mods="0" />
          <key char="58" code="0" mods="0" />
          <key char="32" code="0" mods="0" />
          <key char="34" code="0" mods="0" />
          <key char="65535" code="91" mods="130" />
          <key char="65" code="0" mods="0" />
          <key char="34" code="0" mods="0" />
          <key char="65535" code="91" mods="130" />
          <key char="65" code="0" mods="0" />
          <key char="65535" code="10" mods="0" />
          <key char="125" code="0" mods="0" />
          <key char="65535" code="91" mods="130" />
          <key char="97" code="0" mods="0" />
          <key char="44" code="0" mods="0" />
          <key char="65535" code="91" mods="130" />
          <key char="119" code="0" mods="0" />
          <key char="119" code="0" mods="0" />
          <key char="48" code="0" mods="0" />
        </keys>
      </register>
      <register name="3" type="2">
        <text encoding="base64">ICAgIGNvbnNvbGUubG9nKCJhZGRpbmcgbWF0Y2ggdG8gc2NvcGU6ICIsIHBvc3NpYmxlTWF0Y2gsIGZpZWxkcyk7Cg==</text>
      </register>
      <register name="4" type="2">
        <text encoding="base64">ICBmdW5jdGlvbgo=</text>
      </register>
      <register name="t" type="4">
        <keys>
          <key char="119" code="0" mods="0" />
          <key char="105" code="0" mods="0" />
          <key char="123" code="0" mods="0" />
          <key char="32" code="0" mods="0" />
          <key char="99" code="0" mods="0" />
          <key char="111" code="0" mods="0" />
          <key char="100" code="0" mods="0" />
          <key char="101" code="0" mods="0" />
          <key char="58" code="0" mods="0" />
          <key char="32" code="0" mods="0" />
          <key char="65535" code="91" mods="130" />
          <key char="65" code="0" mods="0" />
          <key char="44" code="0" mods="0" />
          <key char="65535" code="91" mods="130" />
          <key char="119" code="0" mods="0" />
          <key char="119" code="0" mods="0" />
          <key char="105" code="0" mods="0" />
          <key char="110" code="0" mods="0" />
          <key char="97" code="0" mods="0" />
          <key char="109" code="0" mods="0" />
          <key char="101" code="0" mods="0" />
          <key char="58" code="0" mods="0" />
          <key char="32" code="0" mods="0" />
          <key char="34" code="0" mods="0" />
          <key char="65535" code="91" mods="130" />
          <key char="65" code="0" mods="0" />
          <key char="34" code="0" mods="0" />
          <key char="65535" code="91" mods="130" />
          <key char="111" code="0" mods="0" />
          <key char="125" code="0" mods="0" />
          <key char="44" code="0" mods="0" />
          <key char="65535" code="91" mods="130" />
          <key char="119" code="0" mods="0" />
          <key char="119" code="0" mods="0" />
          <key char="48" code="0" mods="0" />
        </keys>
      </register>
      <register name="5" type="2">
        <text encoding="base64">ICAgIAo=</text>
      </register>
      <register name="6" type="2">
        <text encoding="base64">ICAgIGNvbnNvbGUubG9nKCJQb3NzaWJsZSBwYXltZW50cyBpbmZvOiAiLCBwb3NzaWJsZU1hdGNoZXMpOwo=</text>
      </register>
      <register name="7" type="2">
        <text encoding="base64">PD9waHAKcmVxdWlyZV9vbmNlKCRfU0VSVkVSWydET0NVTUVOVF9ST09UJ10uIi9rdXplX2xhbmcucGhwIik7Cj8+Cjw/cGhwIGluY2x1ZGUgKCdidXNpbmVzcy1hcHAtdjExLmpzJykgPz4K</text>
      </register>
      <register name="8" type="2">
        <text encoding="base64">Ly8gdjExIC0gMjMgbWFyY2ggMjAxNwovL0RlZmluZSBhbiBhbmd1bGFyIG1vZHVsZSBmb3Igb3VyIGFwcAoKdmFyIGt1emVJc0NhbGVuZGFyRHJhZ2dibGU7Cmt1emVJc0NhbGVuZGFyRHJhZ2dibGUgPSB0cnVlOwoKLy8gYW5ndWxhciBtb2R1bGVzCi8vJGFuZ3VsYXJNb2R1bGVzPVsnbmdSb3V0ZScsJ3VpLmJvb3RzdHJhcCcsJ3VpLmdyaWQnXTsKJGFuZ3VsYXJNb2R1bGVzID0gWyduZ1JvdXRlJywgJ3VpLmJvb3RzdHJhcCcsICd1aS5ncmlkJywgJ2J1aWxkZXInLCAnYnVpbGRlci5jb21wb25lbnRzJywgJ3ZhbGlkYXRvci5ydWxlcycsICd1aS5jYWxlbmRhcicsICdjaGVja2xpc3QtbW9kZWwnLCAndWkuYm9vdHN0cmFwLmRhdGV0aW1lcGlja2VyJywgJ2FuZ3Vjb21wbGV0ZS1hbHQnLCAnbXVsdGlwbGVTZWxlY3QnLCdhbmd1bGFySW5saW5lRWRpdCcsJ3RleHRBbmd1bGFyJywnbmdDc3YnXTsKCnZhciBkYXlOYW1lcyA9IFsn16jXkNep15XXnycsICfXqdeg15knLCAn16nXnNeZ16nXmScsICfXqNeR15nXoteZJywgJ9eX157Xmdep15knLCAn16nXmdep15knLCAn16nXkdeqJ107CnZhciBtb250aE5hbWVzID0gWyLXmdeg15XXkNeoIiwgItek15HXqNeV15DXqCIsICLXnteo16UiLCAi15DXpNeo15nXnCIsICLXnteQ15kiLCAi15nXldeg15kiLAogICLXmdeV15zXmSIsICLXkNeV15LXldeh15giLCAi16HXpNeY157XkdeoIiwgIteQ15XXp9eY15XXkdeoIiwgIteg15XXkdee15HXqCIsICLXk9em157XkdeoIgpdOwoKdmFyIGxvZ2luTmV4dFNjcmVlbj0iIjsKCihmdW5jdGlvbigpe0RhdGUuc2hvcnRNb250aHM9WyJKYW4iLCJGZWIiLCJNYXIiLCJBcHIiLCJNYXkiLCJKdW4iLCJKdWwiLCJBdWciLCJTZXAiLCJPY3QiLCJOb3YiLCJEZWMiXSxEYXRlLmxvbmdNb250aHM9WyJKYW51YXJ5IiwiRmVicnVhcnkiLCJNYXJjaCIsIkFwcmlsIiwiTWF5IiwiSnVuZSIsIkp1bHkiLCJBdWd1c3QiLCJTZXB0ZW1iZXIiLCJPY3RvYmVyIiwiTm92ZW1iZXIiLCJEZWNlbWJlciJdLERhdGUuc2hvcnREYXlzPVsiU3VuIiwiTW9uIiwiVHVlIiwiV2VkIiwiVGh1IiwiRnJpIiwiU2F0Il0sRGF0ZS5sb25nRGF5cz1bIlN1bmRheSIsIk1vbmRheSIsIlR1ZXNkYXkiLCJXZWRuZXNkYXkiLCJUaHVyc2RheSIsIkZyaWRheSIsIlNhdHVyZGF5Il07dmFyIHQ9e2Q6ZnVuY3Rpb24oKXtyZXR1cm4odGhpcy5nZXREYXRlKCk8MTA/IjAiOiIiKSt0aGlzLmdldERhdGUoKX0sRDpmdW5jdGlvbigpe3JldHVybiBEYXRlLnNob3J0RGF5c1t0aGlzLmdldERheSgpXX0sajpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldERhdGUoKX0sbDpmdW5jdGlvbigpe3JldHVybiBEYXRlLmxvbmdEYXlzW3RoaXMuZ2V0RGF5KCldfSxOOmZ1bmN0aW9uKCl7cmV0dXJuIDA9PXRoaXMuZ2V0RGF5KCk/Nzp0aGlzLmdldERheSgpfSxTOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZ2V0RGF0ZSgpJTEwPT0xJiYxMSE9dGhpcy5nZXREYXRlKCk/InN0Ijp0aGlzLmdldERhdGUoKSUxMD09MiYmMTIhPXRoaXMuZ2V0RGF0ZSgpPyJuZCI6dGhpcy5nZXREYXRlKCklMTA9PTMmJjEzIT10aGlzLmdldERhdGUoKT8icmQiOiJ0aCJ9LHc6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5nZXREYXkoKX0sejpmdW5jdGlvbigpe3ZhciB0PW5ldyBEYXRlKHRoaXMuZ2V0RnVsbFllYXIoKSwwLDEpO3JldHVybiBNYXRoLmNlaWwoKHRoaXMtdCkvODY0ZTUpfSxXOmZ1bmN0aW9uKCl7dmFyIHQ9bmV3IERhdGUodGhpcy52YWx1ZU9mKCkpLGU9KHRoaXMuZ2V0RGF5KCkrNiklNzt0LnNldERhdGUodC5nZXREYXRlKCktZSszKTt2YXIgbj10LnZhbHVlT2YoKTtyZXR1cm4gdC5zZXRNb250aCgwLDEpLDQhPT10LmdldERheSgpJiZ0LnNldE1vbnRoKDAsMSsoNC10LmdldERheSgpKzcpJTcpLDErTWF0aC5jZWlsKChuLXQpLzYwNDhlNSl9LEY6ZnVuY3Rpb24oKXtyZXR1cm4gRGF0ZS5sb25nTW9udGhzW3RoaXMuZ2V0TW9udGgoKV19LG06ZnVuY3Rpb24oKXtyZXR1cm4odGhpcy5nZXRNb250aCgpPDk/IjAiOiIiKSsodGhpcy5nZXRNb250aCgpKzEpfSxNOmZ1bmN0aW9uKCl7cmV0dXJuIERhdGUuc2hvcnRNb250aHNbdGhpcy5nZXRNb250aCgpXX0sbjpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldE1vbnRoKCkrMX0sdDpmdW5jdGlvbigpe3ZhciB0PXRoaXMuZ2V0RnVsbFllYXIoKSxlPXRoaXMuZ2V0TW9udGgoKSsxO3JldHVybiAxMj09PWUmJih0PXQrKyxlPTApLG5ldyBEYXRlKHQsZSwwKS5nZXREYXRlKCl9LEw6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLmdldEZ1bGxZZWFyKCk7cmV0dXJuIHQlNDAwPT0wfHx0JTEwMCE9MCYmdCU0PT0wfSxvOmZ1bmN0aW9uKCl7dmFyIHQ9bmV3IERhdGUodGhpcy52YWx1ZU9mKCkpO3JldHVybiB0LnNldERhdGUodC5nZXREYXRlKCktKHRoaXMuZ2V0RGF5KCkrNiklNyszKSx0LmdldEZ1bGxZZWFyKCl9LFk6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5nZXRGdWxsWWVhcigpfSx5OmZ1bmN0aW9uKCl7cmV0dXJuKCIiK3RoaXMuZ2V0RnVsbFllYXIoKSkuc3Vic3RyKDIpfSxhOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZ2V0SG91cnMoKTwxMj8iYW0iOiJwbSJ9LEE6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5nZXRIb3VycygpPDEyPyJBTSI6IlBNIn0sQjpmdW5jdGlvbigpe3JldHVybiBNYXRoLmZsb29yKDFlMyooKHRoaXMuZ2V0VVRDSG91cnMoKSsxKSUyNCt0aGlzLmdldFVUQ01pbnV0ZXMoKS82MCt0aGlzLmdldFVUQ1NlY29uZHMoKS8zNjAwKS8yNCl9LGc6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5nZXRIb3VycygpJTEyfHwxMn0sRzpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldEhvdXJzKCl9LGg6ZnVuY3Rpb24oKXtyZXR1cm4oKHRoaXMuZ2V0SG91cnMoKSUxMnx8MTIpPDEwPyIwIjoiIikrKHRoaXMuZ2V0SG91cnMoKSUxMnx8MTIpfSxIOmZ1bmN0aW9uKCl7cmV0dXJuKHRoaXMuZ2V0SG91cnMoKTwxMD8iMCI6IiIpK3RoaXMuZ2V0SG91cnMoKX0saTpmdW5jdGlvbigpe3JldHVybih0aGlzLmdldE1pbnV0ZXMoKTwxMD8iMCI6IiIpK3RoaXMuZ2V0TWludXRlcygpfSxzOmZ1bmN0aW9uKCl7cmV0dXJuKHRoaXMuZ2V0U2Vjb25kcygpPDEwPyIwIjoiIikrdGhpcy5nZXRTZWNvbmRzKCl9LHU6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLmdldE1pbGxpc2Vjb25kcygpO3JldHVybigxMD50PyIwMCI6MTAwPnQ/IjAiOiIiKSt0fSxlOmZ1bmN0aW9uKCl7cmV0dXJuL1woKC4qKVwpLy5leGVjKChuZXcgRGF0ZSkudG9TdHJpbmcoKSlbMV19LEk6ZnVuY3Rpb24oKXtmb3IodmFyIHQ9bnVsbCxlPTA7MTI+ZTsrK2Upe3ZhciBuPW5ldyBEYXRlKHRoaXMuZ2V0RnVsbFllYXIoKSxlLDEpLGk9bi5nZXRUaW1lem9uZU9mZnNldCgpO2lmKG51bGw9PT10KXQ9aTtlbHNle2lmKHQ+aSl7dD1pO2JyZWFrfWlmKGk+dClicmVha319cmV0dXJuIHRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKT09dHwwfSxPOmZ1bmN0aW9uKCl7cmV0dXJuKC10aGlzLmdldFRpbWV6b25lT2Zmc2V0KCk8MD8iLSI6IisiKSsoTWF0aC5hYnModGhpcy5nZXRUaW1lem9uZU9mZnNldCgpLzYwKTwxMD8iMCI6IiIpK01hdGguZmxvb3IoTWF0aC5hYnModGhpcy5nZXRUaW1lem9uZU9mZnNldCgpLzYwKSkrKDA9PU1hdGguYWJzKHRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKSU2MCk/IjAwIjooTWF0aC5hYnModGhpcy5nZXRUaW1lem9uZU9mZnNldCgpJTYwKTwxMD8iMCI6IiIpK01hdGguYWJzKHRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKSU2MCkpfSxQOmZ1bmN0aW9uKCl7cmV0dXJuKC10aGlzLmdldFRpbWV6b25lT2Zmc2V0KCk8MD8iLSI6IisiKSsoTWF0aC5hYnModGhpcy5nZXRUaW1lem9uZU9mZnNldCgpLzYwKTwxMD8iMCI6IiIpK01hdGguZmxvb3IoTWF0aC5hYnModGhpcy5nZXRUaW1lem9uZU9mZnNldCgpLzYwKSkrIjoiKygwPT1NYXRoLmFicyh0aGlzLmdldFRpbWV6b25lT2Zmc2V0KCklNjApPyIwMCI6KE1hdGguYWJzKHRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKSU2MCk8MTA/IjAiOiIiKStNYXRoLmFicyh0aGlzLmdldFRpbWV6b25lT2Zmc2V0KCklNjApKX0sVDpmdW5jdGlvbigpe3JldHVybiB0aGlzLnRvVGltZVN0cmluZygpLnJlcGxhY2UoL14uKyBcKD8oW15cKV0rKVwpPyQvLCIkMSIpfSxaOmZ1bmN0aW9uKCl7cmV0dXJuIDYwKi10aGlzLmdldFRpbWV6b25lT2Zmc2V0KCl9LGM6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5mb3JtYXQoIlktbS1kXFxUSDppOnNQIil9LHI6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy50b1N0cmluZygpfSxVOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZ2V0VGltZSgpLzFlM319O0RhdGUucHJvdG90eXBlLmZvcm1hdD1mdW5jdGlvbihlKXt2YXIgbj10aGlzO3JldHVybiBlLnJlcGxhY2UoLyhcXD8pKC4pL2csZnVuY3Rpb24oZSxpLHIpe3JldHVybiIiPT09aSYmdFtyXT90W3JdLmNhbGwobik6cn0pfX0pLmNhbGwodGhpcyk7CgpmdW5jdGlvbiBnb3RvQ2xpZW50UGFnZShidXNpbmVzc191c2VyX2lkKQp7CiAgd2luZG93LmxvY2F0aW9uLmhyZWY9Jy8jL2J1c2luZXNzX2NsaWVudHMvJyArIGJ1c2luZXNzX3VzZXJfaWQ7Cn0KZnVuY3Rpb24gZ290b0luc3RydWN0b3JQYWdlKGJ1c2luZXNzX3VzZXJfaWQpCnsKICB3aW5kb3cubG9jYXRpb24uaHJlZj0nLyMvYnVzaW5lc3NfaW5zdHJ1Y3RvcnMvJyArIGJ1c2luZXNzX3VzZXJfaWQ7Cn0KCmZ1bmN0aW9uIGdvdG9FdmVudFBhZ2UodGhlZXZlbnQpCnsKICBsb2dEZWJ1ZygiZ290b0V2ZW50UGFnZSAiK3RoZWV2ZW50KTsKICBpZiAodGhlZXZlbnQuaXNfY2xhc3M9PTEpCiAgewogICAgd2luZG93LmxvY2F0aW9uLmhyZWY9Jy8jL2V2ZW50X2NsYXNzLycgKyB0aGVldmVudC5ldmVudF9pZDsKICB9CiAgZWxzZQogIHsKICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmPScvIy9ldmVudC8nICsgdGhlZXZlbnQuZXZlbnRfaWQ7CiAgfQp9CgpmdW5jdGlvbiBnb3RvTG9jYXRpb25QYWdlKGxvY2F0aW9uX2lkKQp7CiAgbG9nRGVidWcoImdvdG9Mb2NhdGlvblBhZ2UgIitsb2NhdGlvbl9pZCk7CiAgd2luZG93LmxvY2F0aW9uLmhyZWY9Jy8jL2J1c2luZXNzX2xvY2F0aW9ucy8nICsgbG9jYXRpb25faWQ7Cgp9CgpmdW5jdGlvbiBnb3RvQ2xpZW50RWRpdFBhZ2UodXNlcl9pZCkKewogIHdpbmRvdy5sb2NhdGlvbi5ocmVmPScvIy9idXNpbmVzc19jbGllbnRzLycgKyB1c2VyX2lkICsgJy9lZGl0JzsKfQoKZnVuY3Rpb24gZ290b0JhY2soKQp7CiAgd2luZG93Lmhpc3RvcnkuYmFjaygpOwp9CgpmdW5jdGlvbiBzaG93RXZlbnRQb3B1cChzZWxlY3RlZEV2ZW50LCAkdWliTW9kYWwpCnsKICAvLyB0aGlzIGZ1bmN0aW9uIHVzZWQgdG8gYnJpbmcgYSBwb3B1cAogIC8vIG5vdyBpdCBnb2VzIHRvIHRoZSBldmVudCBwYWdlCiAgZ290b0V2ZW50UGFnZShzZWxlY3RlZEV2ZW50KTsKCiAgLy8gaWYgKHNlbGVjdGVkRXZlbnQuaXNfcmVwZWF0aW5nID09IDEpIHsKICAvLyAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgLy8gICAgICAgICBhbmltYXRpb246IGZhbHNlLAogIC8vICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfY2xhc3Nfc2luZ2xlLnBocCcsCiAgLy8gICAgICAgICBjb250cm9sbGVyOiAnZXZlbnRSZWN1cnJpbmdEZXRhaWxzQnVzaW5lc3NDYWxlbmRhck1vZGFsQ29udHJvbGxlcicsCiAgLy8gICAgICAgICAvLyBzaXplOiBzaXplLAogIC8vICAgICAgICAgcmVzb2x2ZTogewogIC8vICAgICAgICAgICAgIHNlbGVjdGVkRXZlbnQ6IGZ1bmN0aW9uKCkgewogIC8vICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZWN0ZWRFdmVudDsKICAvLyAgICAgICAgICAgICB9CiAgLy8gICAgICAgICB9CiAgLy8gICAgIH0pOwogIC8vIH0gZWxzZSB7CiAgLy8gICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewogIC8vICAgICAgICAgYW5pbWF0aW9uOiBmYWxzZSwKICAvLyAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2V2ZW50X3NpbmdsZS5waHAnLAogIC8vICAgICAgICAgY29udHJvbGxlcjogJ2V2ZW50RGV0YWlsc0J1c2luZXNzQ2FsZW5kYXJNb2RhbENvbnRyb2xsZXInLAogIC8vICAgICAgICAgLy8gc2l6ZTogc2l6ZSwKICAvLyAgICAgICAgIHJlc29sdmU6IHsKICAvLyAgICAgICAgICAgICBzZWxlY3RlZEV2ZW50OiBmdW5jdGlvbigpIHsKICAvLyAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGVjdGVkRXZlbnQ7CiAgLy8gICAgICAgICAgICAgfQogIC8vICAgICAgICAgfQogIC8vICAgICB9KTsKICAvLyB9Cn0KZnVuY3Rpb24gdXBkYXRlR2xvYmFsTGFuZ3VhZ2UoJHNjb3BlLCAkbmV3bGFuZykgewoKICAvLwl2YXIgZ0xhbmc9Z0xhbmdCYXNlW2dMYW5nQ3Vycl07CiAgJGdMYW5nID0gZ0xhbmdCYXNlWyRuZXdsYW5nXTsKICAvLyBsb2dEZWJ1ZygiZ0xhbmdCYXNlWyRuZXdsYW5nXVsndGl0bGUxJ109IiArIGdMYW5nQmFzZVskbmV3bGFuZ11bJ3RpdGxlMSddKTsKICAvLyBsb2dEZWJ1ZygibGFuZ3VnYWdlOiIgKyAkZ0xhbmdbJ2xhbmd1YWdlJ10pOwogIC8vCWxvZ0RlYnVnKCJsYW5ndWdhZ2UgZGlyOiAiKyRnTGFuZ1snZGlyJ10pOwogIC8vCWxvZ0RlYnVnKCJjaGFuZ2luZyBsYW5ndWFnZSB0byAiKyRuZXdsYW5nKQogICRzY29wZS5zcENsYXNzID0gJGdMYW5nWydjbGFzcyddOwogIC8vCWxvZ0RlYnVnKCJpcyBhcnJheT8gIithbmd1bGFyLmlzQXJyYXkoJGdMYW5nKSk7CiAgLy8JbG9nRGVidWcoIiRnTGFuZ1snZGlyJ109IiskZ0xhbmdbJ2RpciddKTsKICAvLwlsb2dEZWJ1ZygiJGdMYW5nWyd0aXRsZTEnXT0iKyRnTGFuZ1sndGl0bGUxJ10pOwogICRzY29wZS5sYW5nZmlsZSA9ICRnTGFuZzsKICAvLyBsb2dEZWJ1ZygiaXMgYXJyYXk/ICIgKyBhbmd1bGFyLmlzQXJyYXkoJHNjb3BlLmxhbmdmaWxlKSk7CiAgLy8gbG9nRGVidWcoIiRzY29wZS5sYW5nZmlsZT0iICsgJHNjb3BlLmxhbmdmaWxlKTsKICAvLyBsb2dEZWJ1ZygiJHNjb3BlLmxhbmdmaWxlWyd0aXRsZTEnXT0iICsgJHNjb3BlLmxhbmdmaWxlWyd0aXRsZTEnXSk7CgogICRzY29wZS50ZXN0bmV3dmFyID0gJHNjb3BlLmxhbmdmaWxlWyd0aXRsZTEnXTsKICAvLwkkc2NvcGUubWVzc2FnZT0kc2NvcGUubGFuZ2ZpbGVbJ3RpdGxlMSddOwp9CgpmdW5jdGlvbiBnZXRSYW5kb21Db2xvcigpIHsKICB2YXIgbGV0dGVycyA9ICcwMTIzNDU2Nzg5QUJDREVGJy5zcGxpdCgnJyk7CiAgdmFyIGNvbG9yID0gJyMnOwogIGZvciAodmFyIGkgPSAwOyBpIDwgNjsgaSsrKSB7CiAgICBjb2xvciArPSBsZXR0ZXJzW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDE2KV07CiAgfQogIHJldHVybiBjb2xvcjsKfQoKZnVuY3Rpb24gZ2V0UmFuZG9tSW50KG1pbiwgbWF4KSB7CiAgcmV0dXJuIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChtYXggLSBtaW4gKyAxKSkgKyBtaW47Cn0KCmZ1bmN0aW9uIGNhbGNfdGVtcF9saW1pdF9pZCgpIHsKICB2YXIgZCA9IG5ldyBEYXRlKCk7CiAgdmFyIHJhbmRvbWxpbWl0ID0gZC5nZXRUaW1lKCk7CiAgbG9nRGVidWcoImNhbGNfdGVtcF9saW1pdF9pZD0iICsgcmFuZG9tbGltaXQpOwogIHJldHVybiByYW5kb21saW1pdDsKfQoKdmFyICRnTG9nTGV2ZWwgPSAnZGVidWcnOwoKLy8gc3RhcnRpbmcKbG9nRGVidWcoIm1haW4gJGdMb2dMZXZlbD0iICsgJGdMb2dMZXZlbCk7CmxvZ0RlYnVnKCJpbml0aWFsaXplIGFuZ3VsYXIiKTsKbG9nRGVidWcoImluaXRpYWxpemluZyBtb2R1bGVzICIgKyAkYW5ndWxhck1vZHVsZXMpOwoKdmFyIGt1emVBcHAgPSBhbmd1bGFyLm1vZHVsZSgna3V6ZUFwcCcsICRhbmd1bGFyTW9kdWxlcykKCi8vJHJvb3RTY29wZS5zcENsYXNzID0gJ3JpZ2h0JzsKa3V6ZVJ1biA9IGZ1bmN0aW9uKCkgewoKfQprdXplQXBwLnJ1bihbCiAgJyRidWlsZGVyJywKICBmdW5jdGlvbigkYnVpbGRlcikgewogICAgLy8gbG9nRGVidWcoImluc2lkZSBrdXplQXBwLnJ1biIpOwogICAgJGJ1aWxkZXIucmVnaXN0ZXJDb21wb25lbnQoJ3NhbXBsZUlucHV0JywgewogICAgICBncm91cDogJ2Zyb20gaHRtbCcsCiAgICAgIGxhYmVsOiAnU2FtcGxlJywKICAgICAgZGVzY3JpcHRpb246ICdGcm9tIGh0bWwgdGVtcGxhdGUnLAogICAgICBwbGFjZWhvbGRlcjogJ3BsYWNlaG9sZGVyJywKICAgICAgcmVxdWlyZWQ6IGZhbHNlLAogICAgICB2YWxpZGF0aW9uT3B0aW9uczogW3sKICAgICAgICBsYWJlbDogJ25vbmUnLAogICAgICAgIHJ1bGU6ICcvLiovJwogICAgICB9LCB7CiAgICAgICAgbGFiZWw6ICdudW1iZXInLAogICAgICAgIHJ1bGU6ICdbbnVtYmVyXScKICAgICAgfSwgewogICAgICAgIGxhYmVsOiAnZW1haWwnLAogICAgICAgIHJ1bGU6ICdbZW1haWxdJwogICAgICB9LCB7CiAgICAgICAgbGFiZWw6ICd1cmwnLAogICAgICAgIHJ1bGU6ICdbdXJsXScKICAgICAgfV0sCiAgICAgIHRlbXBsYXRlVXJsOiAnL2FuZ3VsYXItZm9ybS1idWlsZGVyL2V4YW1wbGUvdGVtcGxhdGUuaHRtbCcsCiAgICAgIHBvcG92ZXJUZW1wbGF0ZVVybDogJy9hbmd1bGFyLWZvcm0tYnVpbGRlci9leGFtcGxlL3BvcG92ZXJUZW1wbGF0ZS5odG1sJwogICAgfSk7CiAgICByZXR1cm4gJGJ1aWxkZXIucmVnaXN0ZXJDb21wb25lbnQoJ25hbWUnLCB7CiAgICAgIGdyb3VwOiAnRGVmYXVsdCcsCiAgICAgIGxhYmVsOiAnTmFtZScsCiAgICAgIHJlcXVpcmVkOiBmYWxzZSwKICAgICAgYXJyYXlUb1RleHQ6IHRydWUsCiAgICAgIHRlbXBsYXRlOiAiPGRpdiBjbGFzcz1cImZvcm0tZ3JvdXBcIj5cbiAgICA8bGFiZWwgZm9yPVwie3tmb3JtTmFtZStpbmRleH19XCIgY2xhc3M9XCJjb2wtbWQtNCBjb250cm9sLWxhYmVsXCIgbmctY2xhc3M9XCJ7J2ZiLXJlcXVpcmVkJzpyZXF1aXJlZH1cIj57e2xhYmVsfX08L2xhYmVsPlxuICAgIDxkaXYgY2xhc3M9XCJjb2wtbWQtOFwiPlxuICAgICAgICA8aW5wdXQgdHlwZT0naGlkZGVuJyBuZy1tb2RlbD1cImlucHV0VGV4dFwiIHZhbGlkYXRvci1yZXF1aXJlZD1cInt7cmVxdWlyZWR9fVwiIHZhbGlkYXRvci1ncm91cD1cInt7Zm9ybU5hbWV9fVwiLz5cbiAgICAgICAgPGRpdiBjbGFzcz1cImNvbC1zbS02XCIgc3R5bGU9XCJwYWRkaW5nLWxlZnQ6IDA7XCI+XG4gICAgICAgICAgICA8aW5wdXQgdHlwZT1cInRleHRcIlxuICAgICAgICAgICAgICAgIG5nLW1vZGVsPVwiaW5wdXRBcnJheVswXVwiXG4gICAgICAgICAgICAgICAgY2xhc3M9XCJmb3JtLWNvbnRyb2xcIiBpZD1cInt7Zm9ybU5hbWUraW5kZXh9fS0wXCIvPlxuICAgICAgICAgICAgPHAgY2xhc3M9J2hlbHAtYmxvY2snPkZpcnN0IG5hbWU8L3A+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwiY29sLXNtLTZcIiBzdHlsZT1cInBhZGRpbmctbGVmdDogMDtcIj5cbiAgICAgICAgICAgIDxpbnB1dCB0eXBlPVwidGV4dFwiXG4gICAgICAgICAgICAgICAgbmctbW9kZWw9XCJpbnB1dEFycmF5WzFdXCJcbiAgICAgICAgICAgICAgICBjbGFzcz1cImZvcm0tY29udHJvbFwiIGlkPVwie3tmb3JtTmFtZStpbmRleH19LTFcIi8+XG4gICAgICAgICAgICA8cCBjbGFzcz0naGVscC1ibG9jayc+TGFzdCBuYW1lPC9wPlxuICAgICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbjwvZGl2PiIsCiAgICAgIHBvcG92ZXJUZW1wbGF0ZTogIjxmb3JtPlxuICAgIDxkaXYgY2xhc3M9XCJmb3JtLWdyb3VwXCI+XG4gICAgICAgIDxsYWJlbCBjbGFzcz0nY29udHJvbC1sYWJlbCc+TGFiZWw8L2xhYmVsPlxuICAgICAgICA8aW5wdXQgdHlwZT0ndGV4dCcgbmctbW9kZWw9XCJsYWJlbFwiIHZhbGlkYXRvcj1cIltyZXF1aXJlZF1cIiBjbGFzcz0nZm9ybS1jb250cm9sJy8+XG4gICAgPC9kaXY+XG4gICAgPGRpdiBjbGFzcz1cImNoZWNrYm94XCI+XG4gICAgICAgIDxsYWJlbD5cbiAgICAgICAgICAgIDxpbnB1dCB0eXBlPSdjaGVja2JveCcgbmctbW9kZWw9XCJyZXF1aXJlZFwiIC8+XG4gICAgICAgICAgICBSZXF1aXJlZFxuICAgICAgICA8L2xhYmVsPlxuICAgIDwvZGl2PlxuXG4gICAgPGhyLz5cbiAgICA8ZGl2IGNsYXNzPSdmb3JtLWdyb3VwJz5cbiAgICAgICAgPGlucHV0IHR5cGU9J3N1Ym1pdCcgbmctY2xpY2s9XCJwb3BvdmVyLnNhdmUoJGV2ZW50KVwiIGNsYXNzPSdidG4gYnRuLXByaW1hcnknIHZhbHVlPSdTYXZlJy8+XG4gICAgICAgIDxpbnB1dCB0eXBlPSdidXR0b24nIG5nLWNsaWNrPVwicG9wb3Zlci5jYW5jZWwoJGV2ZW50KVwiIGNsYXNzPSdidG4gYnRuLWRlZmF1bHQnIHZhbHVlPSdDYW5jZWwnLz5cbiAgICAgICAgPGlucHV0IHR5cGU9J2J1dHRvbicgbmctY2xpY2s9XCJwb3BvdmVyLnJlbW92ZSgkZXZlbnQpXCIgY2xhc3M9J2J0biBidG4tZGFuZ2VyJyB2YWx1ZT0nRGVsZXRlJy8+XG4gICAgPC9kaXY+XG48L2Zvcm0+IgogICAgfSk7CiAgfQpdKQoKa3V6ZUFwcC5ydW4oZnVuY3Rpb24oJHJvb3RTY29wZSkgewogIGxvZ0RlYnVnKCJydW4gJHJvb3RTY29wZSIpOwogICRyb290U2NvcGUuJG9uKCdsb2FkaW5nOnByb2dyZXNzJywgZnVuY3Rpb24gKCl7CiAgICAvLyBzaG93IGxvYWRpbmcgZ2lmCiAgICAvLyAkc2NvcGUuY3Vyc29yZGVsZXRlPSJ3YWl0IjsKICAgIC8vIGRvY3VtZW50LmJvZHkuc3R5bGUuY3Vyc29yPSd3YWl0JzsKICB9KTsKCiAgJHJvb3RTY29wZS4kb24oJ2xvYWRpbmc6ZmluaXNoJywgZnVuY3Rpb24gKCl7CiAgICAvLyAkc2NvcGUuY3Vyc29yZGVsZXRlPSIiOwogICAgLy8gZG9jdW1lbnQuYm9keS5zdHlsZS5jdXJzb3I9Jyc7CiAgfSk7Cn0pOwoKLy8gREVMRVRFRCAtIHhlZGl0YWJsZSBzdHVmZgovLyBrdXplQXBwLnJ1bihmdW5jdGlvbihlZGl0YWJsZU9wdGlvbnMsIGVkaXRhYmxlVGhlbWVzKSB7Ci8vICAgICBsb2dEZWJ1ZygiaW5pdGlhbGl6aW5nIHhlZGl0YWJsZSBlZGl0YWJsZU9wdGlvbnMiKTsKLy8gICAgIGVkaXRhYmxlT3B0aW9ucy50aGVtZSA9ICdiczMnOyAvLyBib290c3RyYXAzIHRoZW1lLiBDYW4gYmUgYWxzbyAnYnMyJywgJ2RlZmF1bHQnCi8vICAgICAvLyBlZGl0YWJsZU9wdGlvbnMuZGVmYXVsdHMubW9kZSA9ICdpbmxpbmUnOwovLyAgICAgbG9nRGVidWcoZWRpdGFibGVPcHRpb25zKTsKLy8gICAgIC8vIGVkaXRhYmxlT3B0aW9ucy5tb2RlID0gJ2lubGluZSc7Ci8vICAgICBlZGl0YWJsZVRoZW1lcy5iczMuaW5wdXRDbGFzcyA9ICdpbnB1dC1zbSc7Ci8vICAgICBlZGl0YWJsZVRoZW1lcy5iczMuYnV0dG9uc0NsYXNzID0gJ2J0bi1zbSc7Ci8vIH0pOwoKLy8gYWZ0ZXIgZm9ybXMKLy9EZWZpbmUgUm91dGluZyBmb3IgYXBwCi8vVXJpIC9BZGROZXdPcmRlciAtPiB0ZW1wbGF0ZSBhZGRfb3JkZXIuaHRtbCBhbmQgQ29udHJvbGxlciBDbGllbnRzQWRkQ29udHJvbGxlcgovL1VyaSAvU2hvd09yZGVycyAtPiB0ZW1wbGF0ZSBzaG93X29yZGVycy5odG1sIGFuZCBDb250cm9sbGVyIENsaWVudHNBZGRDb250cm9sbGVyCmt1emVBcHAuY29uZmlnKFsnJHJvdXRlUHJvdmlkZXInLAogIGZ1bmN0aW9uKCRyb3V0ZVByb3ZpZGVyKSB7CiAgICAvLyBsb2dEZWJ1Zygkcm91dGVQcm92aWRlcik7CiAgICAkcm91dGVQcm92aWRlci4KICAgIC8vIHdoZW4oJy9jbGllbnRjYXJkJywgewogICAgLy8gICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2NsaWVudF9jYXJkLmh0bWwnLAogICAgLy8gICAgIGNvbnRyb2xsZXI6ICdjbGllbnRDYXJkQ29udHJvbGxlcicKICAgIC8vIH0pLgogICAgd2hlbignL2NvbnRhY3QnLCB7CiAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2NvbnRhY3QucGhwJywKICAgICAgLy8gY29udHJvbGxlcjogJ2VuZFVzZXJIb21lQ29udHJvbGxlcicKICAgICAgY29udHJvbGxlcjogJ2NvbnRhY3RDb250cm9sbGVyJwogICAgfSkuCiAgICB3aGVuKCcvZXZlbnRfdHlwZXMnLCB7CiAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2V2ZW50X3R5cGVzLmh0bWwnLAogICAgICBjb250cm9sbGVyOiAnRXZlbnRUeXBlc0NvbnRyb2xsZXInCiAgICB9KS4KICAgIHdoZW4oJy9ldmVudF90eXBlcy9hZGQnLCB7CiAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2V2ZW50X3R5cGVfYWRkLnBocCcsCiAgICAgIGNvbnRyb2xsZXI6ICdFdmVudFR5cGVOZXdDb250cm9sbGVyJwogICAgfSkuCiAgICB3aGVuKCcvZXZlbnRfdHlwZXMvOmV2ZW50X3R5cGVfaWQnLCB7CiAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2V2ZW50X3R5cGVfYWRkLnBocCcsCiAgICAgIGNvbnRyb2xsZXI6ICdFdmVudFR5cGVVcGRhdGVDb250cm9sbGVyJwogICAgfSkuCiAgICB3aGVuKCcvaG91cnNfb2Zfd29yaycsIHsKICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfaG91cnNfb2Zfd29yay5odG1sJywKICAgICAgY29udHJvbGxlcjogJ0hvdXJzT2ZXb3JrQ29udHJvbGxlcicKICAgIH0pLgogICAgd2hlbignL2J1c2luZXNzX2NhbGVuZGFyJywgewogICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19jYWxlbmRhci5waHAnLAogICAgICBjb250cm9sbGVyOiAnQnVzaW5lc3NDYWxlbmRhckNvbnRyb2xsZXInLAogICAgICByZWxvYWRPblNlYXJjaDogZmFsc2UKICAgIH0pLgogICAgd2hlbignL2FuZ3VsYXItZm9ybS1idWlsZGVyJywgewogICAgICB0ZW1wbGF0ZVVybDogJy9hbmd1bGFyLWZvcm0tYnVpbGRlci9pbmRleC5odG1sJywKICAgICAgY29udHJvbGxlcjogJ0RlbW9Db250cm9sbGVyJwogICAgfSkuCiAgICB3aGVuKCcvYnVzaW5lc3NfY2xpZW50cy9hZGQnLCB7CiAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2NsaWVudHNfYWRkLmh0bWwnLAogICAgICBjb250cm9sbGVyOiAnQ2xpZW50c0FkZENvbnRyb2xsZXInCiAgICB9KS4KICAgIHdoZW4oJy9idXNpbmVzc19jbGllbnRzJywgewogICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19jbGllbnRzLnBocCcsCiAgICAgIGNvbnRyb2xsZXI6ICdDbGllbnRzU2hvd0NvbnRyb2xsZXInCiAgICB9KS4KICAgIHdoZW4oJy9idXNpbmVzc19jbGllbnRzLzpidXNpbmVzc191c2VyX2lkJywgewogICAgICB0ZW1wbGF0ZVVybDogZnVuY3Rpb24ocGFyYW1zKSB7CiAgICAgICAgcmV0dXJuICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfY2xpZW50X2NhcmQucGhwP2J1c2luZXNzX3VzZXJfaWQ9JyArIHBhcmFtcy5idXNpbmVzc191c2VyX2lkIDsKICAgICAgfSwKICAgICAgY29udHJvbGxlcjogJ0NsaWVudHNTaG93MUNvbnRyb2xsZXInCiAgICB9KS4KICAgIHdoZW4oJy9idXNpbmVzc19yZXBvcnRzJywgewogICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19yZXBvcnRzLmh0bWwnLAogICAgICBjb250cm9sbGVyOiAnQnVzaW5lc3NSZXBvcnRzQ29udHJvbGxlcicKICAgIH0pLgogICAgd2hlbignL2J1c2luZXNzX2luc3RydWN0b3JzJywgewogICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19pbnN0cnVjdG9ycy5waHAnLAogICAgICBjb250cm9sbGVyOiAnSW5zdHJ1Y3RvcnNTaG93Q29udHJvbGxlcicKICAgIH0pLgogICAgd2hlbignL2J1c2luZXNzX2luc3RydWN0b3JzL2FkZCcsIHsKICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfY2xpZW50c19hZGQuaHRtbCcsCiAgICAgIGNvbnRyb2xsZXI6ICdJbnN0cnVjdG9yc0FkZENvbnRyb2xsZXInCiAgICB9KS4KICAgIHdoZW4oJy9idXNpbmVzc19sb2NhdGlvbnMnLCB7CiAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2xvY2F0aW9ucy5waHAnLAogICAgICBjb250cm9sbGVyOiAnYnVzaW5lc3NfbG9jYXRpb25zJwogICAgfSkuCiAgICB3aGVuKCcvYnVzaW5lc3NfbG9jYXRpb25zL2FkZCcsIHsKICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbG9jYXRpb25zX2FkZC5waHAnLAogICAgICBjb250cm9sbGVyOiAnYnVzaW5lc3NfbG9jYXRpb25zX2FkZCcKICAgIH0pLgogICAgd2hlbignL2J1c2luZXNzX2xvY2F0aW9ucy86bG9jYXRpb25faWQnLCB7CiAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2xvY2F0aW9uc19hZGQucGhwJywKICAgICAgY29udHJvbGxlcjogJ2J1c2luZXNzX2xvY2F0aW9uc191cGRhdGUnCiAgICB9KS4KICAgIHdoZW4oJy9idXNpbmVzc19pbnN0cnVjdG9ycy86YnVzaW5lc3NfdXNlcl9pZCcsIHsKICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfaW5zdHJ1Y3Rvcl9jYXJkLnBocCcsCiAgICAgIGNvbnRyb2xsZXI6ICdJbnN0cnVjdG9yU2hvdzFDb250cm9sbGVyJwogICAgfSkuCiAgICB3aGVuKCcvZXZlbnQvOmV2ZW50X2lkJywgewogICAgICB0ZW1wbGF0ZVVybDogZnVuY3Rpb24ocGFyYW1zKSB7CiAgICAgICAgcmV0dXJuICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfZXZlbnRfY2FyZC5waHA/ZXZlbnRfaWQ9JyArIHBhcmFtcy5ldmVudF9pZCA7CiAgICAgIH0sCiAgICAgIGNvbnRyb2xsZXI6ICdFdmVudFBhZ2VDb250cm9sbGVyJwogICAgfSkuCiAgICB3aGVuKCcvZXZlbnRfY2xhc3MvOmV2ZW50X2lkJywgewogICAgICB0ZW1wbGF0ZVVybDogZnVuY3Rpb24ocGFyYW1zKSB7CiAgICAgICAgcmV0dXJuICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfZXZlbnRfY2xhc3NfY2FyZC5waHA/ZXZlbnRfaWQ9JyArIHBhcmFtcy5ldmVudF9pZCA7CiAgICAgIH0sCiAgICAgIGNvbnRyb2xsZXI6ICdFdmVudENsYXNzUGFnZUNvbnRyb2xsZXInCiAgICB9KS4KICAgIHdoZW4oJy9wYWNrYWdlcycsIHsKICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfcGFja2FnZXNfc2hvdy5waHAnLAogICAgICBjb250cm9sbGVyOiAnUGFja2FnZXNDb250cm9sbGVyJwogICAgfSkuCiAgICB3aGVuKCcvcGFja2FnZXMvYWRkJywgewogICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19wYWNrYWdlc19jcmVhdGUucGhwJywKICAgICAgY29udHJvbGxlcjogJ2J1c2luZXNzX3BhY2thZ2VzX2FkZF9jbnRsJwogICAgfSkuCiAgICB3aGVuKCcvcGFja2FnZXMvOnBhY2thZ2VfaWQnLCB7CiAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX3BhY2thZ2VzX2NyZWF0ZS5waHAnLAogICAgICBjb250cm9sbGVyOiAnYnVzaW5lc3NfcGFja2FnZXNfdXBkYXRlX2NudGwnCiAgICB9KS4KICAgIHdoZW4oJy9idXNpbmVzc19jb25maWcnLCB7CiAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2NvbmZpZy5waHAnLAogICAgICBjb250cm9sbGVyOiAnQ29uZmlnQnVzaW5lc3NDb250cm9sbGVyJwogICAgfSkuCiAgICB3aGVuKCcvdXNlcl9jb25maWcnLCB7CiAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ3VzZXJfY29uZmlnLnBocCcsCiAgICAgIGNvbnRyb2xsZXI6ICdDb25maWdVc2VyQ29udHJvbGxlcicKICAgIH0pLgogICAgd2hlbignL2J1c2luZXNzX2RvY3MnLCB7CiAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2RvY3MuaHRtbCcsCiAgICAgIGNvbnRyb2xsZXI6ICdCdXNpbmVzc0RvY3NDb250cm9sbGVyJwogICAgfSkuCiAgICB3aGVuKCcvJywgewogICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdob21lLnBocCcsCiAgICAgIGNvbnRyb2xsZXI6ICdIb21lQ29udHJvbGxlcicKICAgIH0pLgogICAgb3RoZXJ3aXNlKHsKICAgICAgLy8gICAgcmVkaXJlY3RUbzogJy8nCiAgICB9KTsKICB9Cl0pOwoKa3V6ZUFwcC5mYWN0b3J5KCdodHRwSW50ZXJjZXB0b3InLCBbJyRxJywgJyRyb290U2NvcGUnLAogIGZ1bmN0aW9uICgkcSwgJHJvb3RTY29wZSkgewogICAgdmFyIGxvYWRpbmdDb3VudCA9IDA7CgogICAgcmV0dXJuIHsKICAgICAgcmVxdWVzdDogZnVuY3Rpb24gKGNvbmZpZykgewogICAgICAgIGlmKCsrbG9hZGluZ0NvdW50ID09PSAxKSAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2xvYWRpbmc6cHJvZ3Jlc3MnKTsKICAgICAgICByZXR1cm4gY29uZmlnIHx8ICRxLndoZW4oY29uZmlnKTsKICAgICAgfSwKCiAgICAgIHJlc3BvbnNlOiBmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBpZigtLWxvYWRpbmdDb3VudCA9PT0gMCkgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdsb2FkaW5nOmZpbmlzaCcpOwogICAgICAgIHJldHVybiByZXNwb25zZSB8fCAkcS53aGVuKHJlc3BvbnNlKTsKICAgICAgfSwKCiAgICAgIHJlc3BvbnNlRXJyb3I6IGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIGlmKC0tbG9hZGluZ0NvdW50ID09PSAwKSAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2xvYWRpbmc6ZmluaXNoJyk7CiAgICAgICAgcmV0dXJuICRxLnJlamVjdChyZXNwb25zZSk7CiAgICAgIH0KICAgIH07CiAgfQpdKS5jb25maWcoWyckaHR0cFByb3ZpZGVyJywgZnVuY3Rpb24gKCRodHRwUHJvdmlkZXIpIHsKICAkaHR0cFByb3ZpZGVyLmludGVyY2VwdG9ycy5wdXNoKCdodHRwSW50ZXJjZXB0b3InKTsKfV0pOwoKa3V6ZUFwcC5mYWN0b3J5KCdzaGFyZWREYXRhJywgZnVuY3Rpb24oKSB7CiAgdmFyIHNlbGVjdGVkRW5kVXNlciA9IG51bGw7CgogIHJldHVybiB7CiAgICBnZXRTZWxlY3RlZEVuZFVzZXI6IGZ1bmN0aW9uKCkgewogICAgICAvL1lvdSBjb3VsZCBhbHNvIHJldHVybiBzcGVjaWZpYyBhdHRyaWJ1dGUgb2YgdGhlIGZvcm0gZGF0YSBpbnN0ZWFkCiAgICAgIC8vb2YgdGhlIGVudGlyZSBkYXRhCiAgICAgIHJldHVybiBzZWxlY3RlZEVuZFVzZXI7CiAgICB9LAogICAgc2V0U2VsZWN0ZWRFbmRVc2VyOiBmdW5jdGlvbihuZXdTZWxlY3RlZEVuZFVzZXIpIHsKICAgICAgLy9Zb3UgY291bGQgYWxzbyBzZXQgc3BlY2lmaWMgYXR0cmlidXRlIG9mIHRoZSBmb3JtIGRhdGEgaW5zdGVhZAogICAgICBzZWxlY3RlZEVuZFVzZXIgPSBuZXdTZWxlY3RlZEVuZFVzZXI7CiAgICB9LAogIH07Cn0pOwoKa3V6ZUFwcC5kaXJlY3RpdmUoJ2NvbnZlcnRUb051bWJlcicsIGZ1bmN0aW9uKCkgewogIHJldHVybiB7CiAgICByZXF1aXJlOiAnbmdNb2RlbCcsCiAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWxlbWVudCwgYXR0cnMsIG5nTW9kZWwpIHsKICAgICAgbmdNb2RlbC4kcGFyc2Vycy5wdXNoKGZ1bmN0aW9uKHZhbCkgewogICAgICAgIHJldHVybiB2YWwgIT0gbnVsbCA/IHBhcnNlSW50KHZhbCwgMTApIDogbnVsbDsKICAgICAgfSk7CiAgICAgIG5nTW9kZWwuJGZvcm1hdHRlcnMucHVzaChmdW5jdGlvbih2YWwpIHsKICAgICAgICByZXR1cm4gdmFsICE9IG51bGwgPyAnJyArIHZhbCA6IG51bGw7CiAgICAgIH0pOwogICAgfQogIH07Cn0pOwoKa3V6ZUFwcC5kaXJlY3RpdmUoJ2VsYXN0aWMnLCBbCiAgJyR0aW1lb3V0JywKICBmdW5jdGlvbigkdGltZW91dCkgewogICAgcmV0dXJuIHsKICAgICAgcmVzdHJpY3Q6ICdBJywKICAgICAgbGluazogZnVuY3Rpb24oJHNjb3BlLCBlbGVtZW50KSB7CiAgICAgICAgJHNjb3BlLmluaXRpYWxIZWlnaHQgPSAkc2NvcGUuaW5pdGlhbEhlaWdodCB8fCBlbGVtZW50WzBdLnN0eWxlLmhlaWdodDsKICAgICAgICB2YXIgcmVzaXplID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICBlbGVtZW50WzBdLnN0eWxlLmhlaWdodCA9ICRzY29wZS5pbml0aWFsSGVpZ2h0OwogICAgICAgICAgZWxlbWVudFswXS5zdHlsZS5oZWlnaHQgPSAiIiArIGVsZW1lbnRbMF0uc2Nyb2xsSGVpZ2h0ICsgInB4IjsKICAgICAgICB9OwogICAgICAgIGVsZW1lbnQub24oImlucHV0IGNoYW5nZSIsIHJlc2l6ZSk7CiAgICAgICAgLy8gZWxlbWVudC5vbigiaW5wdXQgY2hhbmdlIiwgcmVzaXplKTsKICAgICAgICAkdGltZW91dChyZXNpemUsIDApOwogICAgICB9CiAgICB9OwogIH0KXSk7CgprdXplQXBwLnNlcnZpY2UoJ3NoYXJlZFByb3BlcnRpZXMnLCBmdW5jdGlvbiAoKSB7CiAgdmFyIHNlbGVjdGVkX3VzZXIgPSBudWxsOwogIHZhciBjYWxlbmRhcl9kYXRlID0gbnVsbDsKICB2YXIgZXZlbnRfcmVzY2hlZHVsZSA9IG51bGw7CiAgdmFyIHNlbGVjdGVkX2luc3RydWN0b3IgPSAwOwogIHZhciBldmVudF90eXBlX2Zvcl9zdWdnZXN0aW9ucyA9IG51bGw7CiAgcmV0dXJuIHsKICAgIGdldF9zZWxlY3RlZF9pbnN0cnVjdG9yOiBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBzZWxlY3RlZF9pbnN0cnVjdG9yOwogICAgfSwKICAgIHNldF9zZWxlY3RlZF9pbnN0cnVjdG9yOiBmdW5jdGlvbih2YWx1ZSkgewogICAgICBzZWxlY3RlZF9pbnN0cnVjdG9yID0gdmFsdWU7CiAgICB9LAogICAgZ2V0X3NlbGVjdGVkX3VzZXI6IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHNlbGVjdGVkX3VzZXI7CiAgICB9LAogICAgc2V0X3NlbGVjdGVkX3VzZXI6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgIHNlbGVjdGVkX3VzZXIgPSB2YWx1ZTsKICAgIH0sCiAgICBzZXRfZXZlbnRfcmVzY2hlZHVsZTogZnVuY3Rpb24odmFsdWUpIHsKICAgICAgZXZlbnRfcmVzY2hlZHVsZSA9IHZhbHVlOwogICAgfSwKICAgIGdldF9ldmVudF9yZXNjaGVkdWxlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBldmVudF9yZXNjaGVkdWxlOwogICAgfSwKICAgIGdldF9jYWxlbmRhcl9kYXRlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBjYWxlbmRhcl9kYXRlOwogICAgfSwKICAgIHNldF9jYWxlbmRhcl9kYXRlOiBmdW5jdGlvbih2YWx1ZSkgewogICAgICBjYWxlbmRhcl9kYXRlID0gdmFsdWU7CiAgICB9LAogICAgZ2V0X2V2ZW50X3R5cGVfZm9yX3N1Z2dlc3Rpb25zOiBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBldmVudF90eXBlX2Zvcl9zdWdnZXN0aW9uczsKICAgIH0sCiAgICBzZXRfZXZlbnRfdHlwZV9mb3Jfc3VnZ2VzdGlvbnM6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgIC8vIGxvZ0RlYnVnKCJzZXRfZXZlbnRfdHlwZV9mb3Jfc3VnZ2VzdGlvbnM9Iit2YWx1ZSk7CiAgICAgIGV2ZW50X3R5cGVfZm9yX3N1Z2dlc3Rpb25zID0gdmFsdWU7CiAgICB9CiAgfTsKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ21lbnVDb250cm9sbGVyJywgWyckc2NvcGUnLCAnJGxvY2F0aW9uJywgZnVuY3Rpb24oJHNjb3BlLCAkbG9jYXRpb24pIHsKICByZXR1cm4gdHJ1ZTsKICBsb2dEZWJ1ZygiJHNjb3BlLmlzQ3VycmVudFBhdGg9IiArICRzY29wZS5pc0N1cnJlbnRQYXRoKTsKICAkc2NvcGUuaXNDdXJyZW50UGF0aCA9IGZ1bmN0aW9uKHBhdGgpIHsKICAgIHJldHVybiAkbG9jYXRpb24ucGF0aCgpID09IHBhdGg7CiAgfTsKfV0pOwoKCgprdXplQXBwLmNvbnRyb2xsZXIoJ0J1c2luZXNzUmVwb3J0c0NvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkbG9jYXRpb24sJHJvdXRlUGFyYW1zKQp7CgogIGxvZ0RlYnVnKCJjb250cm9sbGVyOiBCdXNpbmVzc1JlcG9ydHNDb250cm9sbGVyIik7CgogICRzY29wZS5vcmRlckJ5RmllbGQgPSAnc3RhcnRfZXBvY2gnOwogICRzY29wZS5yZXZlcnNlU29ydD10cnVlOwogICRzY29wZS5ldmVudE1vZGVsPXRydWU7CgogIGdldEJ1c2luZXNzTG9jYXRpb25zKCRodHRwLCRzY29wZSwnYnVzaW5lc3NfbG9jYXRpb25zJyk7CiAgZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzKCRodHRwLCRzY29wZSwnZXZlbnRfdHlwZXMnKTsKICBnZXRBbGxJbnN0cnVjdG9ycygkaHR0cCwkc2NvcGUsJ2luc3RydWN0b3JzJyk7CiAgZ2V0QWxsQ2xpZW50c0FuZEFyY2hpdmUoJGh0dHAsJHNjb3BlLCdjbGllbnRzJyk7CiAgJHNjb3BlLnN0YXR1c2VzID0gWyB7InN0YXR1c19pZCI6IjAiLCJzdGF0dXNfbmFtZSI6Itek16rXldeXIn0sIHsic3RhdHVzX2lkIjoiMSIsInN0YXR1c19uYW1lIjoi16HXkteV16gifV07CiAgJHNjb3BlLmNhbmNlbGxhdGlvbnMgPSBbIHsiaXNfY2FuY2VsZWQiOiIwIiwiY2FuY2VsbGF0aW9uX25hbWUiOiLXnNeQINeR15XXmNecIn0seyJpc19jYW5jZWxlZCI6IjEiLCJjYW5jZWxsYXRpb25fbmFtZSI6IteR15XXmNecIn1dOwogICRzY29wZS5tb250aHMgPSBbIHsibW9udGgiOiIxIn0seyJtb250aCI6IjIifSx7Im1vbnRoIjoiMyJ9LHsibW9udGgiOiI0In0seyJtb250aCI6IjUifSx7Im1vbnRoIjoiNiJ9LHsibW9udGgiOiI3In0seyJtb250aCI6IjgifSx7Im1vbnRoIjoiOSJ9LHsibW9udGgiOiIxMCJ9LHsibW9udGgiOiIxMSJ9LHsibW9udGgiOiIxMiJ9XTsKICAkc2NvcGUueWVhcnMgPSBbIHsieWVhciI6IjIwMTYifSx7InllYXIiOiIyMDE3In1dOwogICRzY29wZS5wZXJpb2RzID0gWwogICAgeyJwZXJpb2RfbmFtZSI6IteU15nXodeY15XXqNeZIiwgInBlcmlvZF9zaWduIjoiLTEifSwKICAgIHsicGVyaW9kX25hbWUiOiLXlNeZ15XXnSIsICJwZXJpb2Rfc2lnbiI6IjAifSwKICAgIHsicGVyaW9kX25hbWUiOiLXoteq15nXk9eZIiwgInBlcmlvZF9zaWduIjoiMSJ9LAogIF0KCiAgJHNjb3BlLmNzdl9jb2x1bW5zX29yZGVyID0gWydldmVudF90eXBlX25hbWUnLCAnc3RhcnRfdGltZScsICdldmVudF91c2VyX2NsaWVudHMnLCAnaW5zdHJ1Y3Rvcl9uYW1lJywgJ2lzX2NhbmNlbGVkJywgJ2lzX2NvbXBsZXRlZCcsICdhY3R1YWxfcHJpY2UnLCAncGFydGljaXBhdGVkJ107CiAgJHNjb3BlLmNzdl9jb2x1bW5zX2hlYWRlciA9IFsn16HXldeSINee16TXktepJywgJ9eq15DXqNeZ15og15XXqdei15QnLCAn157Xqdeq16rXpNeZ150nLCAn157Xk9eo15nXmicsJ9ee15HXldeY15wnLCAn16HXkteV16gnLCAn157Xl9eZ16gnLCAn157Xqdeq16rXpNeZ150nXTsKCgoKICAkc2NvcGUuZ290b0NsaWVudFBhZ2U9IGZ1bmN0aW9uIChidXNpbmVzc1VzZXJpZCkgewogICAgZ290b0NsaWVudFBhZ2UoYnVzaW5lc3NVc2VyaWQpOwogIH0KCiAgZnVuY3Rpb24gbGlzdF90b19zdHJpbmdfYnlfdmFsdWUoeCx2YWx1ZSl7CiAgICBpZiAoIHggIT0gdW5kZWZpbmVkICl7CiAgICAgIHZhciB4MSA9IG5ldyBBcnJheSgpOwogICAgICBmb3IgKGkgPSAwOyBpIDwgeC5sZW5ndGg7IGkrKyl7CiAgICAgICAgeDFbaV0gPSB4W2ldW3ZhbHVlXTsKICAgICAgfQogICAgICB4MSA9IHgxLmpvaW4oKTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHJldHVybiB4MTsKICB9CgogICRzY29wZS5yZXBvcnRfaXNfbG9hZGluZyA9IGZhbHNlOwoKICAkc2NvcGUuZXZlbnRzUmVwb3J0ID0gZnVuY3Rpb24oKXsKICAgIGxvZ0RlYnVnKCJldmVudHNSZXBvcnQiKTsKCiAgICAkc2NvcGUuc2hvd0FnZyA9ICgkc2NvcGUuZXZlbnRUeXBlTW9kZWwpIHx8CiAgICAgICAgKCRzY29wZS5pbnN0cnVjdG9yTW9kZWwpIHx8ICgkc2NvcGUubW9udGhNb2RlbCkgfHwgKCRzY29wZS5jbGllbnRzTW9kZWwpIHx8ICgkc2NvcGUueWVhck1vZGVsKSA7CgogICAgZXZlbnRfdHlwZV9pZF9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuc2VsZWN0ZWRFdmVudFR5cGVGaWx0ZXIsICJldmVudF90eXBlX2lkIiApOwogICAgaW5zdHJ1Y3Rvcl9pZF9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuc2VsZWN0ZWRJbnN0cnVjdG9yRmlsdGVyLCAiYnVzaW5lc3NfdXNlcl9pZCIgKTsKICAgIG1vbnRoX2ZpbHRlciA9IGxpc3RfdG9fc3RyaW5nX2J5X3ZhbHVlKCRzY29wZS5zZWxlY3RlZE1vbnRoRmlsdGVyLCAibW9udGgiICk7CiAgICBjbGllbnRfZmlsdGVyID0gbGlzdF90b19zdHJpbmdfYnlfdmFsdWUoJHNjb3BlLnNlbGVjdGVkQ2xpZW50RmlsdGVyLCAiYnVzaW5lc3NfdXNlcl9pZCIgKTsKICAgIHllYXJfZmlsdGVyID0gbGlzdF90b19zdHJpbmdfYnlfdmFsdWUoJHNjb3BlLnNlbGVjdGVkWWVhckZpbHRlciwgInllYXIiICk7CiAgICBzdGF0dXNfZmlsdGVyID0gbGlzdF90b19zdHJpbmdfYnlfdmFsdWUoJHNjb3BlLnNlbGVjdGVkU3RhdHVzRmlsdGVyLCAic3RhdHVzX2lkIiApOwogICAgaXNfY2FuY2VsZWRfZmlsdGVyID0gbGlzdF90b19zdHJpbmdfYnlfdmFsdWUoJHNjb3BlLnNlbGVjdGVkSXNfY2FuY2VsZWRGaWx0ZXIsICJpc19jYW5jZWxlZCIgKTsKICAgIHBlcmlvZF9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuc2VsZWN0ZWRQZXJpb2RGaWx0ZXIsICJwZXJpb2Rfc2lnbiIgKTsKCiAgICAkc2NvcGUuZXZlbnRSZXBvcnRDb25maWcgPSB7fTsKCiAgICAkc2NvcGUuZXZlbnRSZXBvcnRDb25maWcuc291cmNlID0gImRvY3MiOwoKICAgICRzY29wZS5ldmVudFJlcG9ydENvbmZpZy5maWx0ZXJzID0gewogICAgICBldmVudF90eXBlX2lkOiBldmVudF90eXBlX2lkX2ZpbHRlciwKICAgICAgaW5zdHJ1Y3Rvcl9pZDogaW5zdHJ1Y3Rvcl9pZF9maWx0ZXIsCiAgICAgIG1vbnRoOiBtb250aF9maWx0ZXIsCiAgICAgIHllYXI6IHllYXJfZmlsdGVyLAogICAgICBjbGllbnQ6IGNsaWVudF9maWx0ZXIsCiAgICAgIHN0YXR1czogc3RhdHVzX2ZpbHRlciwKICAgICAgcGVyaW9kOiBwZXJpb2RfZmlsdGVyLAogICAgICBpc19jYW5jZWxlZDogaXNfY2FuY2VsZWRfZmlsdGVyCiAgICB9OwoKICAgICRzY29wZS5ldmVudFJlcG9ydENvbmZpZy5hZ2dyZWdhdGlvbnMgPSB7CiAgICAgIGV2ZW50X3R5cGVfaWQ6ICRzY29wZS5ldmVudFR5cGVNb2RlbCwKICAgICAgaW5zdHJ1Y3Rvcl9pZDogJHNjb3BlLmluc3RydWN0b3JNb2RlbCwKICAgICAgbW9udGg6ICRzY29wZS5tb250aE1vZGVsLAogICAgICB5ZWFyOiAkc2NvcGUueWVhck1vZGVsLAogICAgICBjbGllbnQ6ICRzY29wZS5jbGllbnRNb2RlbCwKICAgIH07CgogICAgaWYgKCAkc2NvcGUuc2hvd0FnZyApIHsKICAgICAgZ2V0RXZlbnRzUmVwb3J0KCRodHRwLCRzY29wZSwgJHNjb3BlLmV2ZW50UmVwb3J0Q29uZmlnLCBnZXRFdmVudHNSZXBvcnRBZ2dyZWdhdGVkX3N1Y2Nlc3MpOwogICAgICAkc2NvcGUucmVwb3J0X2lzX2xvYWRpbmcgPSB0cnVlOwogICAgfSBlbHNlIHsKICAgICAgZ2V0RXZlbnRzUmVwb3J0KCRodHRwLCRzY29wZSwgJHNjb3BlLmV2ZW50UmVwb3J0Q29uZmlnLCBnZXRFdmVudHNSZXBvcnRMaXN0X3N1Y2Nlc3MpOwogICAgICAkc2NvcGUucmVwb3J0X2lzX2xvYWRpbmcgPSB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldEV2ZW50c1JlcG9ydExpc3Rfc3VjY2VzcyhyZXNwb25zZSl7CiAgICAgICRzY29wZS5FdmVudFJlcG9ydExpc3QgPSByZXNwb25zZS5qc29uOwogICAgICAkc2NvcGUuZG93bmxvYWRfcmVwb3J0ID0gJHNjb3BlWyAnRXZlbnRSZXBvcnRMaXN0JyBdOwogICAgICAkc2NvcGUucmVwb3J0X2lzX2xvYWRpbmcgPSBmYWxzZTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRFdmVudHNSZXBvcnRBZ2dyZWdhdGVkX3N1Y2Nlc3MocmVzcG9uc2UpewogICAgICAkc2NvcGUuRXZlbnRSZXBvcnRBZ2dyZWdhdGVkID0gcmVzcG9uc2UuanNvbjsKICAgICAgJHNjb3BlLmRvd25sb2FkX3JlcG9ydCA9ICRzY29wZVsgJ0V2ZW50UmVwb3J0QWdncmVnYXRlZCcgXTsKICAgICAgJHNjb3BlLnJlcG9ydF9pc19sb2FkaW5nID0gZmFsc2U7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0Q2xpZW50c1JlcG9ydExpc3Rfc3VjY2VzcyhyZXNwb25zZSl7CiAgICAgICRzY29wZS5DbGllbnRzUmVwb3J0TGlzdCA9IHJlc3BvbnNlLmpzb247CiAgICAgIGNvbnNvbGUubG9nKCItLS0tLS0tLS0tLS0iKQogICAgICBjb25zb2xlLmxvZygkc2NvcGUuQ2xpZW50c1JlcG9ydExpc3QpCiAgICAgIGNvbnNvbGUubG9nKCItLS0tLS0tLS0tLS0iKQogICAgICAkc2NvcGUucmVwb3J0X2lzX2xvYWRpbmcgPSBmYWxzZTsKICAgIH0KCgogIH0KCiAgJHNjb3BlLmNsaWVudHNSZXBvcnQgPSBmdW5jdGlvbigpewogICAgbG9nRGVidWcoImNsaWVudHNSZXBvcnQiKTsKCiAgICBjbGllbnRfZmlsdGVyID0gbGlzdF90b19zdHJpbmdfYnlfdmFsdWUoJHNjb3BlLnNlbGVjdGVkQ2xpZW50RmlsdGVyLCAiY2xpZW50IiApOwoKICAgICRzY29wZS5ldmVudFJlcG9ydENvbmZpZyA9IHt9OwoKICAgICRzY29wZS5ldmVudFJlcG9ydENvbmZpZy5maWx0ZXJzID0gewogICAgICBjbGllbnQ6IGNsaWVudF9maWx0ZXIsCiAgICB9OwoKICAgICRzY29wZS5ldmVudFJlcG9ydENvbmZpZy5hZ2dyZWdhdGlvbnMgPSB7CiAgICB9OwoKICAgIGdldENsaWVudHNSZXBvcnQoJGh0dHAsJHNjb3BlLCBnZXRDbGllbnRzUmVwb3J0X3N1Y2Nlc3MpOwogICAgJHNjb3BlLnJlcG9ydF9pc19sb2FkaW5nID0gdHJ1ZTsKICAgIGZ1bmN0aW9uIGdldENsaWVudHNSZXBvcnRfc3VjY2VzcyhyZXNwb25zZSl7CiAgICAgICRzY29wZS5jbGllbnRSZXBvcnQgPSByZXNwb25zZS5qc29uOwogICAgICAkc2NvcGUuZG93bmxvYWRfcmVwb3J0ID0gJHNjb3BlWyAnY2xpZW50UmVwb3J0JyBdOwogICAgICAkc2NvcGUucmVwb3J0X2lzX2xvYWRpbmcgPSBmYWxzZTsKICAgIH0KICB9CgogICRzY29wZS5lZGl0RXZlbnQ9IGZ1bmN0aW9uICh0aGVldmVudCkKICB7CiAgICBnb3RvRXZlbnRQYWdlKHRoZWV2ZW50KTsKICB9CgogICRzY29wZS5ldmVudHNSZXBvcnQoKTsKICAkc2NvcGUuc2VsZWN0ZWRSZXBvcnQ9ImV2ZW50cyI7Cn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdidXNpbmVzc19wYWNrYWdlc191cGRhdGVfY250bCcsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbiwkcm91dGVQYXJhbXMpCnsKICAkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyID0ge307IC8vIHRoZXNlIGFyZSB0aGUgY29tcGxldGUgZGV0YWlscyBmb3IgdGhlIG5ldyBldmVudCAvLwogICRzY29wZS5wYWNrYWdlX2lzX3VwZGF0ZSA9IHRydWU7CiAgJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5wYWNrYWdlX2xpbWl0X3R5cGU9MTsKCi8vIGdldHR0aW5nIHRoZSBwYWNrYWdlIGFuZCBpdHMgZXZlbnQgdHlwZXMKICBnZXRCdXNpbmVzc1BhY2thZ2UoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5wYWNrYWdlX2lkLCdmb3JtQWRkUGFja2FnZUFuZ3VsYXInLGZ1bmN0aW9uKHJlc3BvbnNlKQogIHsKICAgICRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuaXNfdXBkYXRlID0gdHJ1ZTsKICAgICRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIub3JpZ0V2ZW50VHlwZXM9YW5ndWxhci5jb3B5KCRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuc2VsZWN0ZWRFdmVudFR5cGVzKTsKICAgICRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIucGFja2FnZV9saW1pdF90eXBlPTE7Ci8vIHRoZW4gZ2V0dGluZyBhbGwgdGhlIGV2ZW50IHR5cGVzCiAgICBnZXRFdmVudFR5cGVzTm9BZG1pbigkaHR0cCwkc2NvcGUsJ3JlbGF0ZWRFdmVudFR5cGVzJyxnZXRFdmVudFR5cGVzTm9BZG1pbl9zdWNjZXNzKTsKICAgIGZ1bmN0aW9uIGdldEV2ZW50VHlwZXNOb0FkbWluX3N1Y2Nlc3MoKQogICAgewovLyB0aGVuIHJlbW92aW5nIGV4aXN0aW5nIGV2ZW50IHR5cGVzIG9mIHBhY2thZ2UgZnJvbSBsaXN0Ci8vIGNvbnNvbGUubG9nKCRzY29wZS5yZWxhdGVkRXZlbnRUeXBlc1swXSk7Ci8vIGNvbnNvbGUubG9nKCRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuc2VsZWN0ZWRFdmVudFR5cGVzWzBdKTsKICAgICAgZm9yKHZhciBpID0gMDsgaSA8ICRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuc2VsZWN0ZWRFdmVudFR5cGVzLmxlbmd0aDsgaSsrKQogICAgICB7Ci8vIGNvcHlpbmcgdGhlIGFjdHVhbCBvYmplY3Qgb2YgJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5zZWxlY3RlZEV2ZW50VHlwZXNbaV0KICAgICAgICBmb3IodmFyIGogPSAwOyBqIDwgJHNjb3BlLnJlbGF0ZWRFdmVudFR5cGVzLmxlbmd0aDsgaisrKQogICAgICAgIHsKICAgICAgICAgIGlmICgkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLnNlbGVjdGVkRXZlbnRUeXBlc1tpXS5ldmVudF90eXBlX2lkPT0kc2NvcGUucmVsYXRlZEV2ZW50VHlwZXNbal0uZXZlbnRfdHlwZV9pZCkKICAgICAgICAgIHsKICAgICAgICAgICAgJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5zZWxlY3RlZEV2ZW50VHlwZXNbaV09YW5ndWxhci5jb3B5KCRzY29wZS5yZWxhdGVkRXZlbnRUeXBlc1tqXSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfSk7CiAgJHNjb3BlLmdvdG9CYWNrID0gZ290b0JhY2s7CiAgJHNjb3BlLmNyZWF0ZVBhY2thZ2UgPSBmdW5jdGlvbigpCiAgewogICAgY29uc29sZS5sb2coInVwZGF0ZVBhY2thZ2VEZXRhaWxzIik7CiAgICB1cGRhdGVQYWNrYWdlRGV0YWlscygkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLnBhY2thZ2VfaWQsJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhcixzdWNjZXNzX2NhbGxiYWNrLCBmYWlsdXJlX2NhbGxiYWNrKTsKICAgIGZ1bmN0aW9uIHN1Y2Nlc3NfY2FsbGJhY2soKQogICAgewogICAgICBnb3RvQmFjaygpOwogICAgfQogICAgZnVuY3Rpb24gZmFpbHVyZV9jYWxsYmFjaygpCiAgICB7CiAgICAgIGdvdG9CYWNrKCk7CiAgICB9CiAgfTsKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2J1c2luZXNzX3BhY2thZ2VzX2FkZF9jbnRsJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uKSB7CiAgbG9nRGVidWcoJ2J1c2luZXNzX3BhY2thZ2VzX2FkZF9jbnRsJyk7CiAgJHNjb3BlLnBhY2thZ2VfaXNfdXBkYXRlID0gZmFsc2U7CiAgJHNjb3BlLmdvdG9CYWNrID0gZ290b0JhY2s7CiAgJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhciA9IHt9OwogICRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuZXZlbnRzX2NvdW50ZXIgPSAxOwogICRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuZXZlbnRzX3Blcl93ZWVrID0gMTsKICAkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLnBhY2thZ2VfZHVyYXRpb25fbW9udGhzID0gMzsKICAkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLnBhY2thZ2VfbGltaXRfdHlwZT0xOwogIGdldEV2ZW50VHlwZXNOb0FkbWluKCRodHRwLCRzY29wZSwncmVsYXRlZEV2ZW50VHlwZXMnKTsKCiAgJHNjb3BlLmNyZWF0ZVBhY2thZ2UgPSBmdW5jdGlvbigpCiAgewogICAgY3JlYXRlUGFja2FnZSgkaHR0cCwkc2NvcGUsJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhcixjcmVhdGVQYWNrYWdlX3N1Y2Nlc3MsIGNyZWF0ZVBhY2thZ2VfZmFpbHVyZSk7CiAgICBmdW5jdGlvbiBjcmVhdGVQYWNrYWdlX3N1Y2Nlc3MoKQogICAgewogICAgICAkbG9jYXRpb24ucGF0aCgnL3BhY2thZ2VzJyk7CiAgICB9CiAgICBmdW5jdGlvbiBjcmVhdGVQYWNrYWdlX2ZhaWx1cmUoKQogICAgewovLyBsb2dFcnJvcigiZXJyb3IgIiArIGRhdGEubWVzc2FnZSk7Ci8vICRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuYWpheF9lcnJvciA9IGRhdGEubWVzc2FnZTsKICAgIH0KICB9Cn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdidXNpbmVzc19sb2NhdGlvbnMnLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkbG9jYXRpb24pIHsKICBsb2dEZWJ1ZygnYnVzaW5lc3NfbG9jYXRpb25zIGNvbnRyb2xsZXInKTsKICBnZXRCdXNpbmVzc0xvY2F0aW9ucygkaHR0cCwkc2NvcGUsJ2J1c2luZXNzX2xvY2F0aW9ucycpOwogICRzY29wZS5hZGROZXdMb2NhdGlvbiA9IGZ1bmN0aW9uICgpCiAgewogICAgJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19sb2NhdGlvbnMvYWRkJyk7CiAgfQogICRzY29wZS5nb3RvTG9jYXRpb25QYWdlID0gZnVuY3Rpb24obG9jYXRpb25faWQpCiAgewogICAgZ290b0xvY2F0aW9uUGFnZShsb2NhdGlvbl9pZCk7CiAgfQp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ0J1c2luZXNzRG9jc0NvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkbG9jYXRpb24pIHsKICBsb2dEZWJ1ZygnQnVzaW5lc3NEb2NzQ29udHJvbGxlcicpOwp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ2J1c2luZXNzX2xvY2F0aW9uc191cGRhdGUnLCBmdW5jdGlvbigkc2NvcGUsICRyb3V0ZVBhcmFtcywgJGh0dHAsICRsb2NhdGlvbikgewogIGxvZ0RlYnVnKCdidXNpbmVzc19sb2NhdGlvbnNfdXBkYXRlIGNvbnRyb2xsZXInKTsKICAkc2NvcGUuaXNfdXBkYXRlPXRydWU7Ci8vIGdldEJ1c2luZXNzTG9jYXRpb25zKCRodHRwLCRzY29wZSwnYnVzaW5lc3NfbG9jYXRpb25zJyk7CiAgZ2V0QnVzaW5lc3NMb2NhdGlvbigkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmxvY2F0aW9uX2lkLCdjdXJyX2xvY2F0aW9uJyxnZXRCdXNpbmVzc0xvY2F0aW9uX3N1Y2Nlc3MpOwogIGZ1bmN0aW9uIGdldEJ1c2luZXNzTG9jYXRpb25fc3VjY2VzcygpCiAgewogICAgJHNjb3BlLmZvcm1BZGRMb2NhdGlvbkFuZ3VsYXI9JHNjb3BlLmN1cnJfbG9jYXRpb25bMF07CiAgfQoKCiAgJHNjb3BlLmFkZExvY2F0aW9uID0gZnVuY3Rpb24oKQogIHsKLy8gaW4gdGhpcyBjYXNlIC0gdXBkYXRlIGxvY2F0aW9uCiAgICB0aGVkYXRhID0gJHNjb3BlLmZvcm1BZGRMb2NhdGlvbkFuZ3VsYXI7CgogICAgZnVuY3Rpb24gYWRkTG9jYXRpb25fc3VjY2VzcygpCiAgICB7CiAgICAgICRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfbG9jYXRpb25zJyk7CiAgICB9CiAgICBmdW5jdGlvbiBhZGRMb2NhdGlvbl9mYWlsdXJlKCkKICAgIHsKICAgICAgJHNjb3BlLmZvcm1BZGRMb2NhdGlvbkFuZ3VsYXIuYWpheF9lcnJvciA9IHJlc3BvbnNlLm1lc3NhZ2U7CiAgICB9CiAgICB1cGRhdGVMb2NhdGlvbigkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmxvY2F0aW9uX2lkLCB0aGVkYXRhLGFkZExvY2F0aW9uX3N1Y2Nlc3MsYWRkTG9jYXRpb25fZmFpbHVyZSk7CiAgfQp9KTsKCmt1emVBcHAuY29udHJvbGxlcignYnVzaW5lc3NfbG9jYXRpb25zX2FkZCcsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikgewogIGxvZ0RlYnVnKCdidXNpbmVzc19sb2NhdGlvbnNfYWRkIGNvbnRyb2xsZXInKTsKICBnZXRCdXNpbmVzc0xvY2F0aW9ucygkaHR0cCwkc2NvcGUsJ2J1c2luZXNzX2xvY2F0aW9ucycpOwogICRzY29wZS5pc191cGRhdGU9ZmFsc2U7CgogICRzY29wZS5hZGRMb2NhdGlvbiA9IGZ1bmN0aW9uKCkKICB7CiAgICB0aGVkYXRhID0gJHNjb3BlLmZvcm1BZGRMb2NhdGlvbkFuZ3VsYXI7CgogICAgZnVuY3Rpb24gYWRkTG9jYXRpb25fc3VjY2VzcygpCiAgICB7CiAgICAgICRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfbG9jYXRpb25zJyk7CiAgICB9CiAgICBmdW5jdGlvbiBhZGRMb2NhdGlvbl9mYWlsdXJlKCkKICAgIHsKICAgICAgJHNjb3BlLmZvcm1BZGRMb2NhdGlvbkFuZ3VsYXIuYWpheF9lcnJvciA9IHJlc3BvbnNlLm1lc3NhZ2U7CiAgICB9CiAgICBhZGRMb2NhdGlvbigkaHR0cCwkc2NvcGUsdGhlZGF0YSxhZGRMb2NhdGlvbl9zdWNjZXNzLGFkZExvY2F0aW9uX2ZhaWx1cmUpOwogIH0KfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ0luc3RydWN0b3JzQWRkQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikgewogIGxvZ0RlYnVnKCdJbnN0cnVjdG9yc0FkZENvbnRyb2xsZXInKTsKICAkc2NvcGUuaXNJbnN0cnVjdG9yPXRydWU7CiAgJHNjb3BlLnVzZXJ0eXBlPSJpbnN0cnVjdG9yIjsKICAkc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIgPSB7fTsKICAkc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIuaXNfdXBkYXRlPWZhbHNlOwogICRzY29wZS5hZGRDbGllbnQgPSBmdW5jdGlvbigpIC8vIGFkZCBpbnN0cnVjdG9yLCB1c2luZyB0aGUgc2FtZSBmdW5jdGlvbiBuYW1lIGFzIHdlIHVzZSB0aGUgc2FtZSBzY3JlZW4KICB7CiAgICB0aGVkYXRhID0gJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyOwoKICAgIGZ1bmN0aW9uIGFkZEluc3RydWN0b3Jfc3VjY2VzcygpCiAgICB7CiAgICAgICRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfaW5zdHJ1Y3RvcnMnKTsKICAgIH0KICAgIGZ1bmN0aW9uIGFkZENsaWVudF9mYWlsdXJlKCkKICAgIHsKICAgICAgJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyLmFqYXhfZXJyb3IgPSByZXNwb25zZS5tZXNzYWdlOwogICAgfQogICAgYWRkSW5zdHJ1Y3RvcigkaHR0cCwkc2NvcGUsdGhlZGF0YSxhZGRJbnN0cnVjdG9yX3N1Y2Nlc3MpOwogIH0KfSk7Cmt1emVBcHAuY29udHJvbGxlcignQ2xpZW50c0FkZENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkdGltZW91dCwgJGxvY2F0aW9uLCBzaGFyZWRQcm9wZXJ0aWVzKSB7CiAgbG9nRGVidWcoJ0NsaWVudHNBZGRDb250cm9sbGVyIC0gVGhpcyBpcyBBZGQgbmV3IGNsaWVudCBzY3JlZW4nKTsKICAkc2NvcGUuaXNJbnN0cnVjdG9yPWZhbHNlOwoKICAkc2NvcGUudXNlcnR5cGU9ImVuZHVzZXIiOwogICRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhciA9IHt9OwogICRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5pc191cGRhdGU9ZmFsc2U7CiAgJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyLmRpc2FibGVfcGhvbmVfZWRpdGluZz1mYWxzZTsKCiAgaWYgKCgkc2NvcGUuZmlsdGVyLlZhbHVlICE9ICIiKSAmJiAodHlwZW9mICRzY29wZS5maWx0ZXIuVmFsdWUgIT0gJ3VuZGVmaW5lZCcpKSB7CiAgICBsb2dEZWJ1ZygiY2xpZW50cyBmaWx0ZXIgaXMgbm90IGVtcHR5Iik7CiAgICB2YXIgZmlsdGVyID0gU3RyaW5nKCRzY29wZS5maWx0ZXIuVmFsdWUpOwogICAgaWYgKGZpbHRlci5pbmRleE9mKCIgIikgPiAwKSB7CiAgICAgICRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5maXJzdF9uYW1lID0gZmlsdGVyLnN1YnN0cigwLCBmaWx0ZXIuaW5kZXhPZigiICIpKTsKICAgICAgJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyLmxhc3RfbmFtZSA9IGZpbHRlci5zdWJzdHIoMSArIGZpbHRlci5pbmRleE9mKCIgIikpOwogICAgfSBlbHNlIHsKICAgICAgJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyLmZpcnN0X25hbWUgPSBmaWx0ZXI7CiAgICAgICRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5sYXN0X25hbWUgPSAiIjsKICAgIH0KICAgICRzY29wZS5maWx0ZXIuVmFsdWUgPSAiIjsKICAgICRzY29wZS5maWx0ZXIuYnV0dG9uVmFsdWUgPSAiIjsKICB9IGVsc2UgewogIH0KCiAgJHNjb3BlLmdvdG9CYWNrID0gZnVuY3Rpb24oKQogIHsKICAgICRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfY2xpZW50cycpOwogIH0KCiAgJHNjb3BlLmFkZENsaWVudCA9IGZ1bmN0aW9uKCkKICB7CiAgICB0aGVkYXRhID0gJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyOwoKICAgIGZ1bmN0aW9uIGFkZENsaWVudF9zdWNjZXNzKHVzZXJfaWQpCiAgICB7CiAgICAgIGlmICgkc2NvcGUuc2F2ZV9hbmRfc2NoZWR1bGUpCiAgICAgIHsKLy8gJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jbGllbnRzLycrdXNlcl9pZC5qc29uKTsKICAgICAgICBsb2dEZWJ1ZygiTkVXIHVzZXIgdXNlcl9pZD0iK3VzZXJfaWQuanNvbik7CgogICAgICAgIHVzZXJfaW5mbz0gewogICAgICAgICAgYnVzaW5lc3NfdXNlcl9pZDogdXNlcl9pZC5qc29uLAogICAgICAgICAgYnVzZXJfZmlyc3RfbmFtZTogJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyLmJ1c2VyX2ZpcnN0X25hbWUsCiAgICAgICAgICBidXNlcl9sYXN0X25hbWU6ICRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5idXNlcl9sYXN0X25hbWUKICAgICAgICB9OwoKICAgICAgICBzaGFyZWRQcm9wZXJ0aWVzLnNldF9zZWxlY3RlZF91c2VyKHVzZXJfaW5mbyk7CiAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jYWxlbmRhcicpOwoKICAgICAgfQogICAgICBlbHNlCiAgICAgIHsKICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2NsaWVudHMvJyk7CiAgICAgIH0KICAgICAgY29uc29sZS5sb2coIm5ldyB1c2VyIGlkID0gIit1c2VyX2lkLmpzb24pOwogICAgfQogICAgZnVuY3Rpb24gYWRkQ2xpZW50X2ZhaWx1cmUocmVzcG9uc2UpCiAgICB7CiAgICAgICRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5hamF4X2Vycm9yID0gcmVzcG9uc2UubWVzc2FnZTsKICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKQogICAgICB7CiAgICAgICAgJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyLmFqYXhfZXJyb3I9bnVsbDsKICAgICAgfSwgMjUwMCk7CiAgICB9CiAgICBhZGRDbGllbnQoJGh0dHAsJHNjb3BlLHRoZWRhdGEsYWRkQ2xpZW50X3N1Y2Nlc3MsIGFkZENsaWVudF9mYWlsdXJlLGZhbHNlKTsKICB9Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignUGFja2FnZXNDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uKSB7CiAgbG9nRGVidWcoJ1BhY2thZ2VzQ29udHJvbGxlcicpOwogIGdldEJ1c2luZXNzUGFja2FnZXMoJGh0dHAsJHNjb3BlLCdwYWNrYWdlcycpOwoKICAkc2NvcGUuc2hvd1BhY2thZ2UgPSBmdW5jdGlvbiAodGhlcGFja2FnZSkKICB7CiAgICAkbG9jYXRpb24ucGF0aCgnL3BhY2thZ2VzLycrdGhlcGFja2FnZS5wYWNrYWdlX2lkKTsKICB9Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignSW5zdHJ1Y3RvcnNTaG93Q29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikgewogIGxvZ0RlYnVnKCdJbnN0cnVjdG9yc1Nob3dDb250cm9sbGVyJyk7CiAgJHNjb3BlLm9yZGVyQnlGaWVsZCA9ICdidXNlcl9zdGFydF9kYXRlJzsKICAkc2NvcGUucmV2ZXJzZVNvcnQ9dHJ1ZTsKCiAgZ2V0QWxsSW5zdHJ1Y3RvcnMoJGh0dHAsJHNjb3BlLCdhbGxDbGllbnRzJyxnZXRBbGxJbnN0cnVjdG9yc19zdWNjZXNzKTsKICBmdW5jdGlvbiBnZXRBbGxJbnN0cnVjdG9yc19zdWNjZXNzKCkKICB7CiAgICAkc2NvcGUuc2hvd0NsaWVudHNHcmlkT3B0aW9ucy5kYXRhPSRzY29wZS5hbGxDbGllbnRzOwogIH0KCiAgJHNjb3BlLmdvdG9JbnN0cnVjdG9yUGFnZT0gZnVuY3Rpb24gKGJ1c2luZXNzX3VzZXJfaWQpCiAgewogICAgZ290b0luc3RydWN0b3JQYWdlKGJ1c2luZXNzX3VzZXJfaWQpOwogIH0KCiAgJHNjb3BlLmNsaWVudE5hbWVGaWx0ZXI9IiI7CiAgJHNjb3BlLmlucHV0RmlsdGVyID0gZnVuY3Rpb24gKGl0ZW0pCiAgewovLyBjb25zb2xlLmxvZyhpdGVtLmJ1c2VyX3Bob25lX251bWJlcik7CiAgICByZXR1cm4gZmlsdGVyX2ZpcnN0bGFzdF9uYW1lKGl0ZW0uYnVzZXJfZmlyc3RfbmFtZSxpdGVtLmJ1c2VyX2xhc3RfbmFtZSxpdGVtLmJ1c2VyX3Bob25lX251bWJlciwkc2NvcGUuY2xpZW50TmFtZUZpbHRlcik7CiAgfTsKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ0NsaWVudHNTaG93Q29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHVpYk1vZGFsLCAkaHR0cCwgJGxvY2F0aW9uKSB7CiAgbG9nRGVidWcoJ0NsaWVudHNTaG93Q29udHJvbGxlcicpOwogICRzY29wZS5vcmRlckJ5RmllbGQgPSAnYnVzZXJfc3RhcnRfZGF0ZSc7CiAgJHNjb3BlLnJldmVyc2VTb3J0PXRydWU7CgogIGdldEFsbENsaWVudHMoJGh0dHAsJHNjb3BlLCdhbGxDbGllbnRzJyxnZXRDbGllbnRfc3VjY2Vzcyk7CiAgZnVuY3Rpb24gZ2V0Q2xpZW50X3N1Y2Nlc3MoKQogIHsKICAgICRzY29wZS5zaG93Q2xpZW50c0dyaWRPcHRpb25zLmRhdGE9JHNjb3BlLmFsbENsaWVudHM7CiAgfQoKICAkc2NvcGUuZ290b0NsaWVudFBhZ2U9IGZ1bmN0aW9uIChidXNpbmVzc1VzZXJpZCkKICB7CiAgICBnb3RvQ2xpZW50UGFnZShidXNpbmVzc1VzZXJpZCk7CiAgfQoKLy8gZmlsdGVyIGFyY2hpdmVkIGNsaWVudHMKICAkc2NvcGUuc2hvd0FyY2hpdmVkQ2hlY2tib3g9ZmFsc2U7CiAgJHNjb3BlLnNob3dBcmNoaXZlZCA9IGZ1bmN0aW9uIChlY2xpZW50KQogIHsKICAgIGlmIChlY2xpZW50LmlzX2FjdGl2ZT09MCkKICAgIHsKICAgICAgbG9nRGVidWcoZWNsaWVudCk7CiAgICAgIGlmICgkc2NvcGUuc2hvd0FyY2hpdmVkQ2hlY2tib3gpCiAgICAgIHsKICAgICAgICByZXR1cm4gZWNsaWVudDsKICAgICAgfQogICAgfQogICAgZWxzZSB7CiAgICAgIHJldHVybiBlY2xpZW50OwogICAgfQogIH07CgogICRzY29wZS5jbGllbnROYW1lRmlsdGVyPSIiOwogICRzY29wZS5pbnB1dEZpbHRlciA9IGZ1bmN0aW9uIChpdGVtKQogIHsKICAgIC8vIGNvbnNvbGUubG9nKCJjbGllbnROYW1lRmlsdGVyIik7CiAgICByZXR1cm4gZmlsdGVyX2ZpcnN0bGFzdF9uYW1lKGl0ZW0uYnVzZXJfZmlyc3RfbmFtZSxpdGVtLmJ1c2VyX2xhc3RfbmFtZSxpdGVtLmJ1c2VyX3Bob25lX251bWJlciwkc2NvcGUuY2xpZW50TmFtZUZpbHRlcik7CiAgfTsKCiAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXM9W107Ci8vICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzID0gWwovLyAgIHsiZmllbGRfaWQiOjAsImZpZWxkX25hbWUiOiLXqteQ16jXmdeaINec15nXk9eUIiwiZmllbGRfZGF0YXR5cGUiOiJEQVRFIiwiaXNfbWFuZGF0b3J5IjowLCAiZnJvbWRiIjogZmFsc2UsICJkYl9pZF90b2ZpeCI6IDAsICJpc19hY3RpdmUiOiAxLCAibW9kaWZpZWQiOiBmYWxzZX0sCi8vICAgeyJmaWVsZF9pZCI6MCwiZmllbGRfbmFtZSI6IteU16LXqNeV16oiLCJmaWVsZF9kYXRhdHlwZSI6IlRFWFRfQVJFQSIsImlzX21hbmRhdG9yeSI6MCwgImZyb21kYiI6IGZhbHNlLCAiZGJfaWRfdG9maXgiOiAwLCAiaXNfYWN0aXZlIjogMSwgIm1vZGlmaWVkIjogZmFsc2V9Ci8vIF07CgogIGZ1bmN0aW9uIGdldENsaWVudHNFeHRyYUZpZWxkc19zdWNjZXNzKCkKICB7CiAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyA9ICRzY29wZS5leHRyYUZpZWxkczsKICB9CiAgZ2V0Q2xpZW50c0V4dHJhRmllbGRzKCRodHRwLCRzY29wZSwnZXh0cmFGaWVsZHMnLGdldENsaWVudHNFeHRyYUZpZWxkc19zdWNjZXNzKTsKCiAgJHNjb3BlLmV2ZW50VHlwZUV4dHJhRmllbGRzUG9wID0gZnVuY3Rpb24oZXZlbnRUeXBlUHJvcGVydGllcykgewogICAgbG9nRGVidWcoImV2ZW50VHlwZUV4dHJhRmllbGRzUG9wMyIpOwoKICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewogICAgICBhbmltYXRpb246IGZhbHNlLAogICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9jbGllbnRfZXh0cmFfZmllbGRzLnBocCcsCiAgICAgIGNvbnRyb2xsZXI6ICdldmVudFR5cGVFeHRyYUZpZWxkc01vZGFsQ29udHJvbGxlcicsCiAgICAgIHNpemU6ICdsJywKICAgICAgcmVzb2x2ZTogewogICAgICAgIGV2ZW50VHlwZVByb3BlcnRpZXM6IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIGV2ZW50VHlwZVByb3BlcnRpZXM7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKCiAgICBtb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHNlbGVjdGVkSXRlbSkgewogICAgICBsb2dEZWJ1ZyhzZWxlY3RlZEl0ZW0pOwogICAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyA9IHNlbGVjdGVkSXRlbTsKICAgIH0sIGZ1bmN0aW9uKCkgewogICAgICBsb2dEZWJ1ZygnTW9kYWwgZGlzbWlzc2VkIGF0OiAnICsgbmV3IERhdGUoKSk7CiAgICB9KTsKICB9Owp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ3NjaGVkdWxlckNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkcm91dGVQYXJhbXMpIHsKICBldmVudF90eXBlX2lkPSRyb3V0ZVBhcmFtcy5ldmVudF90eXBlX2lkOwoKICAkc2NvcGUuc3VnZ2VzdGlvbkRhdGUgPSBbXTsKICAkc2NvcGUuc3VnZ2VzdGlvbkRhdGUuZGF0ZSA9IG5ldyBEYXRlKCk7CiAgJHNjb3BlLnN1Z2dlc3Rpb25EYXRlLm9wdGlvbnMgPSB7Ci8vIG1pbkRhdGU6IG5ldyBEYXRlKCksCi8vIHNob3dXZWVrczogdHJ1ZSwKICAgIG1pblZpZXc6J2RheScsCiAgICBzdGFydFZpZXc6ICdkYXknCgogIH07CiAgdmFyIHRoZXRpbWUgPSBuZXcgRGF0ZSgpOwogICRzY29wZS5maWx0ZXJBbGxEYXlzQ2hlY2tib3g9dHJ1ZTsKICAkc2NvcGUuZmlsdGVyRGF5SXRlbXMgPSB7CgogICAgJ9eo15DXqdeV158nOiB0cnVlLAogICAgJ9ep16DXmSc6IHRydWUsCiAgICAn16nXnNeZ16nXmSc6IHRydWUsCiAgICAn16jXkdeZ16LXmSc6IHRydWUsCiAgICAn15fXnteZ16nXmSc6IHRydWUsCiAgICAn16nXmdep15knOiB0cnVlLAogICAgJ9ep15HXqic6IHRydWUKICB9OwoKICAkc2NvcGUub25UaW1lU2V0ID0gZnVuY3Rpb24gKG5ld0RhdGUsIG9sZERhdGUpIHsKICAgIGxvZ0RlYnVnKCJuZXcgZGF0ZSAiK25ld0RhdGUuZ2V0VGltZSgpICsgIiBvbGQgZGF0ZSAiK29sZERhdGUuZ2V0VGltZSgpKTsKICAgIGRpZmY9bmV3RGF0ZS5nZXRUaW1lKCktb2xkRGF0ZS5nZXRUaW1lKCk7Ci8vIGlmIG5ldyBkYXRlIGlzIGluIGEgZGlmZmVyZW50IHdlZWsKLy8gd2UgcmVmZXRjaCBzdWdnZXN0aW9ucyBmb3IgdGhlIGN1cnJlbnQgd2VlawogICAgdmFyIG5ld0RhdGVXID0gbmV3IERhdGUobmV3RGF0ZSk7CiAgICB2YXIgb2xkRGF0ZVcgPSBuZXcgRGF0ZShvbGREYXRlKTsKLy8gYWxlcnQobmV3RGF0ZVcuZm9ybWF0KCdXJykpOwovLyBhbGVydChvbGREYXRlVy5mb3JtYXQoJ1cnKSk7CiAgICBpZiAobmV3RGF0ZVcuZm9ybWF0KCdXJykhPW9sZERhdGVXLmZvcm1hdCgnVycpKQogICAgewogICAgICBsb2dEZWJ1ZygiZGlmZiBpcyBhIHdlZWsgb3IgbW9yZSwgcmVmZXRjaGluZyBzdWdnZXN0aW9ucyIpOwogICAgICAkaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3QvIitldmVudF90eXBlX2lkKyIvIituZXdEYXRlLmdldEZ1bGxZZWFyKCkrIi8iKyhuZXdEYXRlLmdldE1vbnRoKCkrMSkrIi8iK25ld0RhdGUuZ2V0RGF0ZSgpKyIvIituZXdEYXRlLmdldEhvdXJzKCkgKyAiLyIgKyBuZXdEYXRlLmdldE1pbnV0ZXMoKSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkgewovLwkgICAgJHNjb3BlLm15RGF0YSA9IHJlc3BvbnNlLmRhdGE7Ci8vCQlsb2dEZWJ1ZygiZ3JpZG9wdGlvbnM9Iiskc2NvcGUuZ3JpZE9wdGlvbnMpOwogICAgICAgICRzY29wZS5ldmVudHNTdWdnZXN0ZWQgPSByZXNwb25zZS5kYXRhOwogICAgICB9KTsKCiAgICB9CiAgfQoKICAkc2NvcGUub3B0aW9ucyA9IHsKICAgIGN1c3RvbUNsYXNzOiBnZXREYXlDbGFzcywKICAgIG1pbkRhdGU6IG5ldyBEYXRlKCksCiAgICBzaG93V2Vla3M6IHRydWUKICB9OwogICRzY29wZS5kdCA9IG5ldyBEYXRlKCk7CgoKICBmdW5jdGlvbiBnZXREYXlDbGFzcyhkYXRhKSB7CiAgICByZXR1cm4gJyc7CiAgfQoKICAkc2NvcGUuZGF5c0l0ZW1zID0gWwogICAge25hbWU6J9eo15DXqdeV158nfSwKICAgIHtuYW1lOifXqdeg15knfSwKICAgIHtuYW1lOifXqdec15nXqdeZJ30sCiAgICB7bmFtZTon16jXkdeZ16LXmSd9LAogICAge25hbWU6J9eX157Xmdep15knfSwKICAgIHtuYW1lOifXqdeZ16nXmSd9LAogICAge25hbWU6J9ep15HXqid9CiAgXTsKCiAgJHNjb3BlLmZpbHRlckFsbERheUl0ZW1zU2V0ID0gZnVuY3Rpb24gKCkKICB7CiAgICAkc2NvcGUuZmlsdGVyRGF5SXRlbXNbJ9eo15DXqdeV158nXT0kc2NvcGUuZmlsdGVyQWxsRGF5c0NoZWNrYm94OwogICAgJHNjb3BlLmZpbHRlckRheUl0ZW1zWyfXqdeg15knXT0kc2NvcGUuZmlsdGVyQWxsRGF5c0NoZWNrYm94OwogICAgJHNjb3BlLmZpbHRlckRheUl0ZW1zWyfXqdec15nXqdeZJ109JHNjb3BlLmZpbHRlckFsbERheXNDaGVja2JveDsKICAgICRzY29wZS5maWx0ZXJEYXlJdGVtc1sn16jXkdeZ16LXmSddPSRzY29wZS5maWx0ZXJBbGxEYXlzQ2hlY2tib3g7CiAgICAkc2NvcGUuZmlsdGVyRGF5SXRlbXNbJ9eX157Xmdep15knXT0kc2NvcGUuZmlsdGVyQWxsRGF5c0NoZWNrYm94OwogICAgJHNjb3BlLmZpbHRlckRheUl0ZW1zWyfXqdeZ16nXmSddPSRzY29wZS5maWx0ZXJBbGxEYXlzQ2hlY2tib3g7CiAgICAkc2NvcGUuZmlsdGVyRGF5SXRlbXNbJ9ep15HXqiddPSRzY29wZS5maWx0ZXJBbGxEYXlzQ2hlY2tib3g7CiAgfQoKICAkc2NvcGUuc3VnZ2VzdEZpbHRlckRheXMgPSBmdW5jdGlvbiAoZXN1Z2dlc3QpCiAgewovLyBsb2dEZWJ1Zyhlc3VnZ2VzdCk7CiAgICBpZiAoKCRzY29wZS5maWx0ZXJEYXlJdGVtc1tlc3VnZ2VzdC5zdGFydF9mb3JtYXRfZG93XSkgJiAoKCRzY29wZS5zdWdnZXN0aW9uRGF0ZS5kYXRlLmdldFRpbWUoKS8xMDAwKTxlc3VnZ2VzdC5zdGFydF9lcG9jaCkpCiAgICB7CiAgICAgIHJldHVybiBlc3VnZ2VzdDsKICAgIH0KICB9OwoKICBsb2dEZWJ1Zygnc2NoZWR1bGVyQ29udHJvbGxlciBmb3IgZXZlbnQgdHlwZSBpZCAnK2V2ZW50X3R5cGVfaWQrIiAiK3RoZXRpbWUuZ2V0SG91cnMoKSArICI6IiArIHRoZXRpbWUuZ2V0TWludXRlcygpICsgIjoiICsgdGhldGltZS5nZXRTZWNvbmRzKCkpOwogICRodHRwLmdldCgkZ0FwaVVSTFByZWZpeCArICIvZW5kdXNlci9ldmVudHMvc3VnZ2VzdC8iK2V2ZW50X3R5cGVfaWQrIi8iK3RoZXRpbWUuZ2V0RnVsbFllYXIoKSsiLyIrKHRoZXRpbWUuZ2V0TW9udGgoKSsxKSsiLyIrdGhldGltZS5nZXREYXRlKCkrIi8iK3RoZXRpbWUuZ2V0SG91cnMoKSArICIvIiArIHRoZXRpbWUuZ2V0TWludXRlcygpKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7Ci8vCSAgICAkc2NvcGUubXlEYXRhID0gcmVzcG9uc2UuZGF0YTsKLy8JCWxvZ0RlYnVnKCJncmlkb3B0aW9ucz0iKyRzY29wZS5ncmlkT3B0aW9ucyk7CiAgICAkc2NvcGUuZXZlbnRzU3VnZ2VzdGVkID0gcmVzcG9uc2UuZGF0YTsKICB9KTsKCiAgJGh0dHAuZ2V0KCRnQXBpVVJMUHJlZml4ICsgIi9lbmR1c2VyL2V2ZW50X3R5cGVzLyIrZXZlbnRfdHlwZV9pZCkudGhlbihmdW5jdGlvbihyZXNwb25zZSkgewovLwkgICAgJHNjb3BlLm15RGF0YSA9IHJlc3BvbnNlLmRhdGE7Ci8vCQlsb2dEZWJ1ZygiZ3JpZG9wdGlvbnM9Iiskc2NvcGUuZ3JpZE9wdGlvbnMpOwogICAgJHNjb3BlLmV2ZW50VHlwZURldGFpbHMgPSByZXNwb25zZS5kYXRhOwogIH0pOwp9KTsKCmt1emVBcHAuY29udHJvbGxlcignY29udGFjdENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwKSB7CiAgbG9nRGVidWcoJ2NvbnRhY3RDb250cm9sbGVyJyk7Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcigncGFja2FnZVBheW1lbnRBc3NvY2lhdGlvbk1vZGFsQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHJvdXRlUGFyYW1zLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIGZwYWNrYWdlLCBiYWxhbmNlLCBidXNpbmVzc191c2VyX2lkLCB1aUNhbGVuZGFyQ29uZmlnKQp7CiAgbG9nRGVidWcoInBhY2thZ2VQYXltZW50QXNzb2NpYXRpb25Nb2RhbENvbnRyb2xsZXIiKTsKCiAgJHNjb3BlLmZwYWNrYWdlPWZwYWNrYWdlOwogICRzY29wZS5iYWxhbmNlPWJhbGFuY2U7CiAgJHNjb3BlLnBhY2thZ2VfcGF5bWVudHM9JHNjb3BlLmZwYWNrYWdlLnBhY2thZ2VfcGF5bWVudHM7CiAgJHNjb3BlLnByZXZpb3VzX2lzX2FsbF9wYWlkPSRzY29wZS5mcGFja2FnZS5pc19hbGxfcGFpZDsKICAkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZD1idXNpbmVzc191c2VyX2lkOwoKLy8gJ2NhbGN1bGF0aW5nJyBwcmV2aW91cyBzdGF0dXMgb2YgcGF5bWVudAogIGlmICgkc2NvcGUucGFja2FnZV9wYXltZW50cz4wKQogIHsKICAgIGlmICgkc2NvcGUucHJldmlvdXNfaXNfYWxsX3BhaWQ9PTEpCiAgICB7CiAgICAgICRzY29wZS5wcmV2aW91c19zdGF0dXM9ImlzX2FsbF9wYWlkIjsKICAgICAgJHNjb3BlLnBhY2thZ2Vfc3RhdHVzX2lkPS0xOwogICAgICAkc2NvcGUucHJldmlvdXNfcGFja2FnZV9zdGF0dXNfaWQ9LTE7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICRzY29wZS5wcmV2aW91c19zdGF0dXM9ImlzX3BhcnRseV9wYWlkIjsKICAgICAgJHNjb3BlLnBhY2thZ2Vfc3RhdHVzX2lkPS0xOwogICAgICAkc2NvcGUucHJldmlvdXNfcGFja2FnZV9zdGF0dXNfaWQ9LTE7CiAgICB9CiAgfQogIGVsc2UKICB7CiAgICAkc2NvcGUucHJldmlvdXNfc3RhdHVzPSJub3RfcGFpZCI7CiAgICAkc2NvcGUucGFja2FnZV9zdGF0dXNfaWQ9MDsKICAgICRzY29wZS5wcmV2aW91c19wYWNrYWdlX3N0YXR1c19pZD0wOwoKICB9CiAgbG9nRGVidWcoInByZXZpb3VzX3N0YXR1cz0iKyRzY29wZS5wcmV2aW91c19zdGF0dXMpOwoKICAkc2NvcGUuY2xvc2VNb2RhbCA9IGZ1bmN0aW9uKCkKICB7CiAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgfTsKICAkc2NvcGUudXBkYXRlUGFja2FnZVBheW1lbnQgPSBmdW5jdGlvbigpCiAgewovLyBjb25zb2xlLmxvZygicHJldmlvdXNfcGFja2FnZV91c2VyX2lkPSIrJHNjb3BlLmZtZWV0aW5nLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZCk7Ci8vIGNvbnNvbGUubG9nKCJwYWNrYWdlX3VzZXJfaWQ9Iiskc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkKTsKICAgIGxvZ0RlYnVnKCJ1cGRhdGVQYWNrYWdlUGF5bWVudCIpCi8vIGlmIHNlbGVjdGVkIHBhY2thZ2UgaXMgbGlrZSBwcmV2aW91cyBwYWNrYWdlIC0gZG8gbm90aGluZwogICAgaWYgKCgkc2NvcGUucHJldmlvdXNfcGFja2FnZV9zdGF0dXNfaWQ9PSRzY29wZS5wYWNrYWdlX3N0YXR1c19pZCkpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJzZWxlY3RlZCBvcHRpb24gaXMgbGlrZSBwcmV2aW91cyBvcHRpb24gLSBkbyBub3RoaW5nIik7CiAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICAgIH0KCi8vIHByZXZpb3VzIHBhY2thZ2Ugd2FzIHBhaWQvcGFydGx5LXBhaWQgLSBub3cgbm90aGluZ3MgaXMgc2VsZWN0ZWQKICAgIGVsc2UgaWYgKCgkc2NvcGUucHJldmlvdXNfcGFja2FnZV9zdGF0dXNfaWQ9PS0xKSAmJiAoJHNjb3BlLnBhY2thZ2Vfc3RhdHVzX2lkPT0wKSkKICAgIHsKICAgICAgbG9nRGVidWcoIndhcyBwYWlkL3BhcnRseSBwYWlkLCByZW1vdmluZyBwYXltZW50Iik7CiAgICAgIHJlbW92ZVBhY2thZ2VQYXltZW50KCRodHRwLCRzY29wZSwkc2NvcGUuZnBhY2thZ2UucGFja2FnZV91c2VyX2lkLCRzY29wZS5idXNpbmVzc191c2VyX2lkLHVwZGF0ZUV2ZW50UGFja2FnZV9zdWNjZXNzKTsKICAgIH0KLy8gcHJldmlvdXMgcGFja2FnZSB3YXMgc2VsZWN0ZWQgLSBub3cgYSBkaWZmZXJlbnQgcGFja2FnZSBpcyBzZWxlY3RlZAogICAgZWxzZSBpZiAoKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3N0YXR1c19pZD09MCkgJiYgKCRzY29wZS5wYWNrYWdlX3N0YXR1c19pZD09LTEpKQogICAgewogICAgICBsb2dEZWJ1Zygid2FzIG5vdCBwYWlkIC0gbm93IHBheSBmdWxseS9wYXJ0aWFsbHkiKTsKICAgICAgcGF5Rm9yUGFja2FnZSgkaHR0cCwkc2NvcGUsJHNjb3BlLmZwYWNrYWdlLnBhY2thZ2VfdXNlcl9pZCwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCx1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2Vzcyk7CgovLyByZWFzc2lnbkV2ZW50UGFja2FnZUFzc29jaWF0aW9uKCRodHRwLCRzY29wZSwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZCwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCx1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2Vzcyk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiB1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2VzcygpCiAgewogICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgbG9nRGVidWcoImJyb2FkY2FzdGluZyBjbGllbnRQYWdlUmVsb2FkRGF0YSIpOwogICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogIH0KCn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdldmVudFBhY2thZ2VBc3NvY2lhdGlvbk1vZGFsQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHJvdXRlUGFyYW1zLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIGZtZWV0aW5nLCBiYWxhbmNlLCBidXNpbmVzc191c2VyX2lkLCB1aUNhbGVuZGFyQ29uZmlnKQp7CiAgJHNjb3BlLmZtZWV0aW5nPWFuZ3VsYXIuY29weShmbWVldGluZyk7CiAgJHNjb3BlLmJhbGFuY2U9YmFsYW5jZTsKICAkc2NvcGUucHJldmlvdXNfcGFja2FnZV91c2VyX2lkPSRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQ7CiAgJHNjb3BlLnByZXZpb3VzX2V2ZW50X3BheW1lbnRzPSRzY29wZS5mbWVldGluZy5ldmVudF9wYXltZW50czsKICAkc2NvcGUucHJldmlvdXNfaXNfYWxsX3BhaWQ9JHNjb3BlLmZtZWV0aW5nLmlzX2FsbF9wYWlkOwogICRzY29wZS5idXNpbmVzc191c2VyX2lkPWJ1c2luZXNzX3VzZXJfaWQ7CgovLyAnY2FsY3VsYXRpbmcnIHByZXZpb3VzIHN0YXR1cyBvZiBwYXltZW50CiAgaWYgKCRzY29wZS5wcmV2aW91c19ldmVudF9wYXltZW50cz4wKQogIHsKICAgIGlmICgkc2NvcGUucHJldmlvdXNfaXNfYWxsX3BhaWQ9PTEpCiAgICB7CiAgICAgICRzY29wZS5wcmV2aW91c19zdGF0dXM9ImlzX2FsbF9wYWlkIjsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgJHNjb3BlLnByZXZpb3VzX3N0YXR1cz0iaXNfcGFydGx5X3BhaWQiOwogICAgfQogIH0KICBlbHNlCiAgewogICAgaWYgKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ+MCkKICAgIHsKICAgICAgJHNjb3BlLnByZXZpb3VzX3N0YXR1cz0iaXNfcGFja2FnZV9wYWlkIjsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgJHNjb3BlLnByZXZpb3VzX3N0YXR1cz0ibm90X3BhaWQiOwogICAgfQogIH0KICBsb2dEZWJ1ZygicHJldmlvdXNfc3RhdHVzPSIrJHNjb3BlLnByZXZpb3VzX3N0YXR1cyk7CgogIGlmICgoJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZD09MCkgJiYgKCRzY29wZS5mbWVldGluZy5ldmVudF9wYXltZW50cz4wKSkKICB7Ci8vIHRoaXMgaXMgYSBjYXNlIHdoZXJlIHBheW1lbnQgd2FzIHBhcnRseSBvciBmdWxseSBtYWRlIGZyb20gYmFsYW5jZQogICAgJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZD0tMTsKICAgICRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ9LTE7CiAgfQoKICBsb2dEZWJ1ZygiZXZlbnRQYWNrYWdlQXNzb2NpYXRpb25Nb2RhbENvbnRyb2xsZXIiKTsKICBnZXRQYWNrYWdlc0ZvckV2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJ3JlbGF0ZWRQYWNrYWdlcycsZ2V0UGFja2FnZXNGb3JFdmVudF9zdWNjZXNzKTsgLy8gd2FzIGdldEJ1c2luZXNzUGFja2FnZQogIGZ1bmN0aW9uIGdldFBhY2thZ2VzRm9yRXZlbnRfc3VjY2VzcygpCiAgewogIH0KCiAgJHNjb3BlLmNsb3NlTW9kYWwgPSBmdW5jdGlvbigpCiAgewogICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogIH07CiAgJHNjb3BlLnVwZGF0ZUV2ZW50UGFja2FnZSA9IGZ1bmN0aW9uKCkKICB7CiAgICBjb25zb2xlLmxvZygicHJldmlvdXNfcGFja2FnZV91c2VyX2lkPSIrJHNjb3BlLmZtZWV0aW5nLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZCk7CiAgICBjb25zb2xlLmxvZygicGFja2FnZV91c2VyX2lkPSIrJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZCk7Ci8vIGlmIHNlbGVjdGVkIHBhY2thZ2UgaXMgbGlrZSBwcmV2aW91cyBwYWNrYWdlIC0gZG8gbm90aGluZwogICAgaWYgKCgkc2NvcGUucHJldmlvdXNfcGFja2FnZV91c2VyX2lkPT0kc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkKSkKICAgIHsKICAgICAgbG9nRGVidWcoInNlbGVjdGVkIG9wdGlvbiBpcyBsaWtlIHByZXZpb3VzIG9wdGlvbiAtIGRvIG5vdGhpbmciKTsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgfQovLyBpZiBzZWxlY3RlZCBwYWNrYWdlIGlzIGxpa2UgcHJldmlvdXMgcGFja2FnZSAtIGRvIG5vdGhpbmcKICAgIGlmICgoJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD09JHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZCkgJiYgKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ+MCkpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJzZWxlY3RlZCBwYWNrYWdlIGlzIGxpa2UgcHJldmlvdXMgcGFja2FnZSAtIGRvIG5vdGhpbmciKTsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgfQovLyBwcmV2aW91cyBwYWNrYWdlIHdhcyBzZWxlY3QgLSBub3cgbm90aGluZ3MgaXMgc2VsZWN0ZWQKICAgIGVsc2UgaWYgKCgkc2NvcGUucHJldmlvdXNfcGFja2FnZV91c2VyX2lkPjApICYmICgkc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkPT0wKSkKICAgIHsKICAgICAgbG9nRGVidWcoIm5vIHBhY2thZ2Ugc2VsZWN0ZWQsIHJlbW92ZSBwYWNrYWdlLWV2ZW50IGFzc29jaWF0aW9uIik7CiAgICAgIHJlbW92ZUV2ZW50UGFja2FnZUFzc29jaWF0aW9uKCRodHRwLCRzY29wZSwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwogICAgfQovLyBwcmV2aW91cyBwYWNrYWdlIHdhcyBzZWxlY3RlZCAtIG5vdyBhIGRpZmZlcmVudCBwYWNrYWdlIGlzIHNlbGVjdGVkCiAgICBlbHNlIGlmICgoJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD4wKSAmJiAoJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZD4wKSkKICAgIHsKICAgICAgbG9nRGVidWcoInVwZGF0aW5nIG5ldyBwYWNrYWdlIHRvIHBhY2thZ2VfdXNlcl9pZD0gIiskc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkKTsKICAgICAgcmVhc3NpZ25FdmVudFBhY2thZ2VBc3NvY2lhdGlvbigkaHR0cCwkc2NvcGUsJHNjb3BlLmZtZWV0aW5nLmV2ZW50X2lkLCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwogICAgfQovLyBwcmV2aW91cyBwYWNrYWdlIHdhcyBub25lIC0gbm93IGEgcGFja2FnZSBpcyBzZWxlY3RlZAogICAgZWxzZSBpZiAoKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ9PTApICYmICgkc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkPjApKQogICAgewogICAgICBsb2dEZWJ1ZygidXBkYXRpbmcgbmV3IHBhY2thZ2UgdG8gcGFja2FnZV91c2VyX2lkPSAiKyRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQpOwogICAgICByZWFzc2lnbkV2ZW50UGFja2FnZUFzc29jaWF0aW9uKCRodHRwLCRzY29wZSwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZCwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCx1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2Vzcyk7CiAgICB9Ci8vIHByZXZpb3VzIGFzc29jaWF0aW9uIHdhcyBwYWlkIG9yIGhhbGYgcGFpZCAtIG5vdyBpdHMgbm9uZQogICAgZWxzZSBpZiAoKCRzY29wZS5wcmV2aW91c19ldmVudF9wYXltZW50cz4wKSAmJiAoJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZD09MCkpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJyZW1vdmluZyBwYXltZW50IGZyb20gZXZlbnQsIHBhY2thZ2VfdXNlcl9pZD0gIiskc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkKTsKICAgICAgcmVtb3ZlRXZlbnRQYXltZW50QXNzb2NpYXRpb24oJGh0dHAsJHNjb3BlLCRzY29wZS5mbWVldGluZy5ldmVudF9pZCwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCx1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2Vzcyk7CgovLyByZWFzc2lnbkV2ZW50UGFja2FnZUFzc29jaWF0aW9uKCRodHRwLCRzY29wZSwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZCwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCx1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2Vzcyk7Ci8vIHRvZG8KICAgIH0KLy8gd2FzIHBhY2thZ2UgcGF5bWVudCAtPiBub3cgYmFsYW5jZSBwYXltZW50CiAgICBlbHNlIGlmICgoJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD4wKSAmJiAoJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZD09LTEpKQogICAgewogICAgICBsb2dEZWJ1ZygibW92aW5nIHBheW1lbnQgZnJvbSBwYWNrYWdlIHRvIGJhbGFuY2UiKTsKICAgICAgYWRkRXZlbnRQYXltZW50UmVtb3ZlUGFja2FnZSgkaHR0cCwkc2NvcGUsJHNjb3BlLmZtZWV0aW5nLmV2ZW50X2lkLCRzY29wZS5idXNpbmVzc191c2VyX2lkLHVwZGF0ZUV2ZW50UGFja2FnZV9zdWNjZXNzKTsKICAgIH0KLy8gd2FzIGJhbGFuY2UgcGF5bWVudCAtPiBub3cgcGFja2FnZSBwYXltZW50CiAgICBlbHNlIGlmICgoJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD09LTEpICYmICgkc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkPjApKQogICAgewogICAgICBsb2dEZWJ1ZygibW92aW5nIHBheW1lbnQgZnJvbSBiYWxhbmNlIHRvIHBhY2thZ2UiKTsKICAgICAgYWRkRXZlbnRQYWNrYWdlUmVtb3ZlUGF5bWVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLmZtZWV0aW5nLmV2ZW50X2lkLCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwoKICAgIH0KLy8gd2FzIG5vdCBwYWlkIGF0IGFsbCAtPiBub3cgYmFsYW5jZSBwYXkKICAgIGVsc2UgaWYgKCgkc2NvcGUucHJldmlvdXNfcGFja2FnZV91c2VyX2lkPT0wKSAmJiAoJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZD09LTEpKQogICAgewogICAgICBsb2dEZWJ1ZygibW92aW5nIHBheW1lbnQgZnJvbSBub25lIHRvIGJhbGFuY2UiKTsKICAgICAgYWRkRXZlbnRQYXltZW50QXNzb2NpYXRpb24oJGh0dHAsJHNjb3BlLCRzY29wZS5mbWVldGluZy5ldmVudF9pZCwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCx1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2Vzcyk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiB1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2VzcygpCiAgewogICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgbG9nRGVidWcoImJyb2FkY2FzdGluZyBjbGllbnRQYWdlUmVsb2FkRGF0YSIpOwogICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogIH0KCn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignYXJjaGl2ZV9jbGllbnRfbW9kYWwnLCBmdW5jdGlvbigkc2NvcGUsICRsb2NhdGlvbiwgaXNfaW5zdHJ1Y3RvciwgYnVzaW5lc3NfdXNlcl9pZCwgYnVzZXJfZmlyc3RfbmFtZSwgYnVzZXJfbGFzdF9uYW1lLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIHVpQ2FsZW5kYXJDb25maWcpIHsKICAkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZD1idXNpbmVzc191c2VyX2lkOwogICRzY29wZS5idXNlcl9maXJzdF9uYW1lPWJ1c2VyX2ZpcnN0X25hbWU7CiAgJHNjb3BlLmJ1c2VyX2xhc3RfbmFtZT1idXNlcl9sYXN0X25hbWU7CiAgJHNjb3BlLmlzX2luc3RydWN0b3I9aXNfaW5zdHJ1Y3RvcjsKCiAgbG9nRGVidWcoImFyY2hpdmVfY2xpZW50X21vZGFsIGNvbnRyb2xsZXIiKTsKCiAgJHNjb3BlLmNsb3NlTW9kYWwgPSBmdW5jdGlvbigpIHsKICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICB9OwoKICAkc2NvcGUuYXJjaGl2ZUNsaWVudCA9IGZ1bmN0aW9uKCkKICB7CiAgICBhcmNoaXZlQ2xpZW50KCRodHRwLCRzY29wZSwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCxhcmNoaXZlQ2xpZW50X3N1Y2Nlc3MpOwogICAgZnVuY3Rpb24gYXJjaGl2ZUNsaWVudF9zdWNjZXNzKCkKICAgIHsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgICBpZiAoJHNjb3BlLmlzX2luc3RydWN0b3IpCiAgICAgIHsKICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2luc3RydWN0b3JzJyk7CiAgICAgIH0KICAgICAgZWxzZSB7CiAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jbGllbnRzJyk7CiAgICAgIH0KICAgIH0KICB9Cgp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ3BheW1lbnlEZXRhaWxzTW9kYWxDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkcm91dGVQYXJhbXMsICRyb290U2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgZnBheW1lbnQsIHVpQ2FsZW5kYXJDb25maWcpIHsKICAkc2NvcGUuZnBheW1lbnQ9e307CiAgJHNjb3BlLmZwYXltZW50LnBheW1lbnRfZGF0ZT1mcGF5bWVudC5wYXltZW50X2RhdGU7CiAgJHNjb3BlLmZwYXltZW50LnBheW1lbnRfYW1vdW50PWZwYXltZW50LnBheW1lbnRfYW1vdW50OwogICRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2dlbmVyYXRlZD1mcGF5bWVudC5pbnZvaWNlX2dlbmVyYXRlZDsKICAkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9udW1iZXI9ZnBheW1lbnQuaW52b2ljZV9udW1iZXI7CiAgaWYgKGZwYXltZW50Lmludm9pY2VfZGF0ZT09bnVsbCkKICB7CiAgICAkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlX2Zvcm1hdD1uZXcgRGF0ZSgpOwogIH0KICBlbHNlCiAgewogICAgJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZV9mb3JtYXQ9ZnBheW1lbnQuaW52b2ljZV9kYXRlX2Zvcm1hdDsKICB9CiAgJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZT1mcGF5bWVudC5pbnZvaWNlX2RhdGU7CiAgJHNjb3BlLnNlbGVjdGVkUGF5bWVudE1ldGhvZD17CiAgICBuYW1lOiBmcGF5bWVudC5wYXltZW50X21ldGhvZF9uYW1lX3R4dCwKICAgIG1ldGhvZDogZnBheW1lbnQucGF5bWVudF9tZXRob2RfbmFtZQogIH07CiAgJHNjb3BlLmlzUGF5bWVudE1ldGhvZFNlbGVjdGVkPXRydWU7CgogIGxvZ0RlYnVnKCJvbGQgZGF0ZSAiKyRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2RhdGUpOwogIGlmICgkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlIT1udWxsKQogIHsKICAgICRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2RhdGVfZm9ybWF0ID0gbmV3IERhdGUoJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZSk7CiAgfQogICRzY29wZS5wYXltZW50TWV0aG9kcyA9IHBheW1lbnRNZXRob2RzOwogICRzY29wZS5wYXltZW50VHlwZVRpdGxlPWZwYXltZW50LnBheW1lbnRfbWV0aG9kX25hbWVfdHh0OwogICRzY29wZS5mcGF5bWVudC5pbnZvaWNlX3NvdXJjZT0iRVhURVJOQUwiOwoKICBsb2dEZWJ1Zygkc2NvcGUucGF5bWVudE1ldGhvZHMpOwogIGxvZ0RlYnVnKCJwYXltZW55RGV0YWlsc01vZGFsQ29udHJvbGxlciBmb3IgcGF5bWVudCAiK0pTT04uc3RyaW5naWZ5KGZwYXltZW50LCBudWxsLCA0KSk7CgogICRzY29wZS5zZWxlY3RQYXltZW50TWV0aG9kID0gZnVuY3Rpb24ocGF5bWVudCkgewogICAgJHNjb3BlLnBheW1lbnRUeXBlVGl0bGU9cGF5bWVudC5uYW1lOwogICAgbG9nRGVidWcoInBheW1lbnQ9IitwYXltZW50KTsKCiAgICAkc2NvcGUuc2VsZWN0ZWRQYXltZW50TWV0aG9kPXBheW1lbnQ7CiAgICAkc2NvcGUuaXNQYXltZW50TWV0aG9kU2VsZWN0ZWQ9dHJ1ZTsKICB9OwoKICAkc2NvcGUuY2xvc2VNb2RhbCA9IGZ1bmN0aW9uKCkgewogICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogIH07CgogICRzY29wZS51cGRhdGVQYXltZW50ID0gZnVuY3Rpb24oKQogIHsKLy8gbG9nRGVidWcoY3VycmVudENsaWVudCk7CiAgICBsb2dEZWJ1ZygicGF5bWVudCBtZXRob2QiKTsKICAgIGxvZ0RlYnVnKCRzY29wZS5zZWxlY3RlZFBheW1lbnRNZXRob2QpOwogICAgbG9nRGVidWcoIiRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2dlbmVyYXRlZD08Iiskc2NvcGUuZnBheW1lbnQuaW52b2ljZV9nZW5lcmF0ZWQrIj4sICRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2RhdGVfZm9ybWF0PSIrJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZV9mb3JtYXQpOwogICAgbG9nRGVidWcoIiRzY29wZS5zZWxlY3RlZFBheW1lbnRNZXRob2QubWV0aG9kPSIrJHNjb3BlLnNlbGVjdGVkUGF5bWVudE1ldGhvZC5tZXRob2QpOwogICAgaWYgKCgkc2NvcGUuZnBheW1lbnQucGF5bWVudF9hbW91bnQ9PTApIHx8ICgkc2NvcGUuZnBheW1lbnQucGF5bWVudF9hbW91bnQ9PScnKSB8fCAoJHNjb3BlLmZwYXltZW50LnBheW1lbnRfYW1vdW50PT1udWxsKSkKICAgIHsKICAgICAgJHNjb3BlLnVzZXJFcnJvcj0i15DXoNeQINeU15bXnyDXodeb15XXnSDXm9ec16nXlNeVIjsKLy8gYWxlcnQoJ3NzJyk7CiAgICB9CiAgICBlbHNlIGlmICghJHNjb3BlLmlzUGF5bWVudE1ldGhvZFNlbGVjdGVkKQogICAgewogICAgICAkc2NvcGUudXNlckVycm9yPSLXkNeg15Ag15HXl9eoINeQ157Xptei15kg16rXqdec15XXnSI7Ci8vIGFsZXJ0KCdzcycpOwogICAgfQogICAgZWxzZQogICAgewogICAgICBpZiAoKCRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2dlbmVyYXRlZCE9MSkgfHwgKCRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2RhdGVfZm9ybWF0PT1udWxsKSkKICAgICAgewogICAgICAgIHZhciBpbnZvaWNlX2RhdGVfZm9ybWF0ID0gIm51bGwiOwogICAgICB9CiAgICAgIGVsc2UKICAgICAgewogICAgICAgIHZhciBpbnZvaWNlX2RhdGVfZm9ybWF0ID0gJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZV9mb3JtYXQuZ2V0RGF0ZSgpICArICItIiArICgkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlX2Zvcm1hdC5nZXRNb250aCgpKzEpICsgIi0iICsgJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZV9mb3JtYXQuZ2V0RnVsbFllYXIoKTsKICAgICAgfQogICAgICB0aGVkYXRhPSB7CiAgICAgICAgYmFsYW5jZVRvUGF5OiAkc2NvcGUuZnBheW1lbnQucGF5bWVudF9hbW91bnQsCiAgICAgICAgcGF5bWVudF9tZXRob2RfbmFtZTogJHNjb3BlLnNlbGVjdGVkUGF5bWVudE1ldGhvZC5tZXRob2QsCiAgICAgICAgaW52b2ljZV9udW1iZXI6ICRzY29wZS5mcGF5bWVudC5pbnZvaWNlX251bWJlciwKICAgICAgICBpbnZvaWNlX2dlbmVyYXRlZDogJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZ2VuZXJhdGVkLAogICAgICAgIGludm9pY2VfZGF0ZTogaW52b2ljZV9kYXRlX2Zvcm1hdCwKICAgICAgICBpbnZvaWNlX3NvdXJjZTogJHNjb3BlLmZwYXltZW50Lmludm9pY2Vfc291cmNlCiAgICAgIH07CiAgICAgIHVwZGF0ZVBheW1lbnRGb3JDbGllbnQoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLGZwYXltZW50LnVzZXJfcGF5bWVudF9pZCx0aGVkYXRhLGNyZWF0ZVBheW1lbnRGb3JDbGllbnRfY2FsbGJhY2ssIGNyZWF0ZVBheW1lbnRGb3JDbGllbnRfZmFpbHVyZSk7CiAgICAgIGZ1bmN0aW9uIGNyZWF0ZVBheW1lbnRGb3JDbGllbnRfY2FsbGJhY2soKQogICAgICB7CiAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgICAgIGxvZ0RlYnVnKCJicm9hZGNhc3RpbmcgY2xpZW50UGFnZVJlbG9hZERhdGEiKTsKICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NsaWVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCiAgICAgIH0KICAgICAgZnVuY3Rpb24gY3JlYXRlUGF5bWVudEZvckNsaWVudF9mYWlsdXJlKCkKICAgICAgewogICAgICAgIGxvZ0RlYnVnKCJicm9hZGNhc3RpbmcgY2xpZW50UGFnZVJlbG9hZERhdGEiKTsKLy8gJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgICB9CiAgICB9CiAgfQp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ2V2ZW50VHlwZUV4dHJhRmllbGRzTW9kYWxDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIGV2ZW50VHlwZVByb3BlcnRpZXMsIHVpQ2FsZW5kYXJDb25maWcpIHsKICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcz1ldmVudFR5cGVQcm9wZXJ0aWVzOwogIGxvZ0RlYnVnKCJldmVudFR5cGVFeHRyYUZpZWxkc01vZGFsQ29udHJvbGxlcj0iK0pTT04uc3RyaW5naWZ5KGV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMsIG51bGwsIDQpKTsKICBpZiAoZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcz09bnVsbCkKICB7CiAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllc09yaWc9W107CiAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcz1bXTsKICB9CiAgZWxzZSBpZiAoZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcy5sZW5ndGg+MCkKICB7CiAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllc09yaWc9KGV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMpLnNsaWNlKDApOwogIH0KICBlbHNlCiAgewogICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXNPcmlnPVtdOwogICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHM9W107CiAgfQogICRzY29wZS5va0xpbWl0YXRpb25Nb2RhbCA9IGZ1bmN0aW9uKCkgewogICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogIH07CgogICRzY29wZS5jYW5jZWwgPSBmdW5jdGlvbigpCiAgewogICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXM9JHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXNPcmlnOwogICAgbG9nRGVidWcoImNsb3NlIik7CiAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllc09yaWcpOwogIH0KICAkc2NvcGUuc2F2ZUFuZENsb3NlID0gZnVuY3Rpb24oKQogIHsKICAgIGxvZ0RlYnVnKCJzYXZlIGFuZCBjbG9zZSIpOwogICAgZnVuY3Rpb24gc2V0Q2xpZW50c0V4dHJhRmllbGRzX3N1Y2Nlc3MoKQogICAgewoKICAgIH0KICAgICRzY29wZS5DbGllbnRzRGV0YWlscz17fTsKICAgICRzY29wZS5DbGllbnRzRGV0YWlscy5leHRyYUZpZWxkcz0kc2NvcGUuZXh0cmFGaWVsZHM7CiAgICBzZXRDbGllbnRzRXh0cmFGaWVsZHMoJGh0dHAsJHNjb3BlLCRzY29wZS5DbGllbnRzRGV0YWlscyxzZXRDbGllbnRzRXh0cmFGaWVsZHNfc3VjY2Vzcyk7CiAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyk7CiAgfQoKICAkc2NvcGUuZHVwbGljYXRlRmllbGROYW1lcz0iIjsKICAkc2NvcGUuYWRkRXh0cmFGaWVsZHMgPSBmdW5jdGlvbigpCiAgewogICAgbG9nRGVidWcoImFkZEV4dHJhRmllbGRzIHZhbGlkYXRpbmciKTsKICAgIC8vIGNoZWNraW5nIGZvciBkdXBsaWNhdGUgbmFtZXMKICAgIHZhciBleHRyYUZpZWxkc05hbWVzID0gW107CiAgICBmb3IgKHZhciBpPTE7IGk8JHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMubGVuZ3RoOyBpKyspCiAgICB7CiAgICAgIGV4dHJhRmllbGRzTmFtZXMucHVzaCgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkc1tpXS5maWVsZF9uYW1lKTsKICAgIH0KICAgIGV4dHJhRmllbGRzTmFtZXMuc29ydCgpOwogICAgdmFyIGxhc3QgPSBleHRyYUZpZWxkc05hbWVzWzBdOwogICAgZm9yICh2YXIgaT0xOyBpPGV4dHJhRmllbGRzTmFtZXMubGVuZ3RoOyBpKyspCiAgICB7CiAgICAgIGlmIChleHRyYUZpZWxkc05hbWVzW2ldID09IGxhc3QpCiAgICAgIHsKICAgICAgICAvLyAgYWxlcnQoJ0R1cGxpY2F0ZSA6ICcrbGFzdCk7CiAgICAgICAgJHNjb3BlLmR1cGxpY2F0ZUZpZWxkTmFtZXM9J9en15nXmdedINep15PXlCDXm9ek15XXnCDXkdep150gIicrbGFzdCsnIi4uLic7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGxhc3QgPSBleHRyYUZpZWxkc05hbWVzW2ldOwogICAgfQogICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMpOwogIH0KCiAgJHNjb3BlLmV4dHJhRmllbGRzID0gZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkczsKICAkc2NvcGUuZmllbGRUeXBlcyA9IFt7ZmllbGRfZGF0YXR5cGU6ICJURVhUX0FSRUEiLCBuYW1lOifXqteZ15HXqiDXmNen16HXmCd9LCB7ZmllbGRfZGF0YXR5cGU6ICJOVU1CRVIiLCBuYW1lOifXnteh16TXqCd9ICwge2ZpZWxkX2RhdGF0eXBlOiAiU1RSSU5HIiwgbmFtZTon15jXp9eh15gg16fXpteoJ30gLCB7ZmllbGRfZGF0YXR5cGU6ICJCT09MRUFOIiwgbmFtZTon16rXmdeR16og16HXmdee15XXnyd9ICwge2ZpZWxkX2RhdGF0eXBlOiAiREFURSIsIG5hbWU6J9eq15DXqNeZ15onfV07CgogICRzY29wZS5hZGROZXdGaWVsZCA9IGZ1bmN0aW9uKCkgewogICAgdmFyIG5ld0l0ZW1ObyA9ICRzY29wZS5leHRyYUZpZWxkcy5sZW5ndGgrMTsKICAgICRzY29wZS5leHRyYUZpZWxkcy5wdXNoKHsiZmllbGRfZGF0YXR5cGUiOiJTVFJJTkciLCJpc19tYW5kYXRvcnkiOjAsICJmcm9tZGIiOiBmYWxzZSwgImZpZWxkX2lkIjogMCwgImlzX2FjdGl2ZSI6IDEsICJtb2RpZmllZCI6IDB9KTsKCiAgICBsb2dEZWJ1ZygiZXh0cmEgZmllbGRzOiAiICsgSlNPTi5zdHJpbmdpZnkoJHNjb3BlLmV4dHJhRmllbGRzLCBudWxsLCAyKSk7CgogIH07CgogICRzY29wZS5yZW1vdmVGaWVsZCA9IGZ1bmN0aW9uKGNob2ljZSkKICB7Ci8vIHJlbW92aW5nIGZpZWxkCi8vIGlmIGl0cyBub3Qgb3JpZ2luYXRlZCBmcm9tIGRhdGFiYXNlIC0gdGhlbiB3ZSBzaW1wbHkgZGVsZXRlIGl0IGZyb20gdGhlIGFycmF5Ci8vIG90aGVyd2lzZSB3ZSBtYXJrIGl0IGFzIGFjdGl2ZT1mYWxzZQogICAgbG9nRGVidWcoY2hvaWNlKTsKLy8gdmFyIGxhc3RJdGVtID0gKGNob2ljZS5pZCktMTsvLyRzY29wZS5jaG9pY2VzLmxlbmd0aC0xOwovLyAkc2NvcGUuY2hvaWNlcy5zcGxpY2UobGFzdEl0ZW0sMSk7CiAgICBmb3IodmFyIGkgPSAwOyBpIDwgJHNjb3BlLmV4dHJhRmllbGRzLmxlbmd0aDsgaSsrKQogICAgewogICAgICBpZiAoJHNjb3BlLmV4dHJhRmllbGRzW2ldID09IGNob2ljZSkKICAgICAgewogICAgICAgIGlmIChjaG9pY2UuZnJvbWRiPT1mYWxzZSkKICAgICAgICB7Ci8vIGlmIG5vdCBmcm9tIGRiIC0gcmVtb3ZpbmcgaXQgZnJvbSB0aGUgYXJyYXkgb2YgZXh0cmEtZmllbGRzCiAgICAgICAgICAkc2NvcGUuZXh0cmFGaWVsZHMuc3BsaWNlKGksIDEpOwogICAgICAgIH0KICAgICAgICBlbHNlCiAgICAgICAgewovLyBpZiBmaWVsZCBvcmlnaW5hdGVkIGZyb20gZGIgLSB0aGFuIHdlIGRvbnQgcmVtb3ZlIGl0IGZyb20gdGhlIGFycmF5Ci8vIGFuZCBtYXJrIGl0IGFzIGFjdGl2ZT1mYWxzZSBzbyB0aGF0IGl0IGNhbiBiZSBoYW5kZWxlZCBvbiB0aGUgc2VydmVyCiAgICAgICAgICBjaG9pY2UuaXNfYWN0aXZlPTA7CiAgICAgICAgICBjaG9pY2UubW9kaWZpZWQ9dHJ1ZTsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICB9Owp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ2V2ZW50Q2xvc2VJZ25vcmVNYW5kYXRvcnlGaWVsZHNNb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRyb3V0ZVBhcmFtcywgJHJvb3RTY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRodHRwLCBjdXJyZW50RXZlbnQsIHVpQ2FsZW5kYXJDb25maWcpIHsKICAkc2NvcGUuY3VycmVudEV2ZW50PWN1cnJlbnRFdmVudDsKCiAgJHNjb3BlLm9rQ2FuY2VsID0gZnVuY3Rpb24oKSB7CiAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgfTsKCiAgJHNjb3BlLmNsb3NlRXZlbnRJZ25vcmVNYW5kYXRvcnlGaWVsZHMgPSBmdW5jdGlvbigpCiAgewogICAgbG9nRGVidWcoImlnbm9yZSBtYW5kYXRvcnkgZXh0cmEgZmllbGRzIGFuZCBjbG9zZSBldmVudCIpOwogICAgJHNjb3BlLmN1cnJlbnRFdmVudC5pZ25vcmVFeHRyYUZpZWxkc1ZhbGlkYXRpb249dHJ1ZTsKICAgIGNsb3NlRXZlbnQoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCwkc2NvcGUuY3VycmVudEV2ZW50LGFmdGVyQ2xvc2VFdmVudCxhZnRlckNsb3NlRXZlbnQpOwogICAgZnVuY3Rpb24gYWZ0ZXJDbG9zZUV2ZW50KCkKICAgIHsKICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdldmVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCiAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICAgIH07CiAgfQp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ2V2ZW50VHlwZUNoYW5nZWRQb3B1cENvbnRyb2xsZXInLCBmdW5jdGlvbigkbG9jYXRpb24sICRzY29wZSwgJHJvdXRlUGFyYW1zLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIGV2ZW50VHlwZVByb3BlcnRpZXMsIHVpQ2FsZW5kYXJDb25maWcpIHsKICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcz1ldmVudFR5cGVQcm9wZXJ0aWVzOwogICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLnVwZGF0ZWRfZnJvbV9kYXRlPW5ldyBEYXRlKCk7CiAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMudXBkYXRlX2V4aXN0aW5nX2V2ZW50cz1mYWxzZTsKCiAgJHNjb3BlLmNsb3NlTW9kYWwgPSBmdW5jdGlvbigpIHsKICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICB9OwoKICAkc2NvcGUudXBkYXRlRXZlbnRUeXBlID0gZnVuY3Rpb24oKQogIHsKICAgIGxvZ0RlYnVnKCJ1cGRhdGUgRXZlbnQgVHlwZSAiICsgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXZlbnRfdHlwZV9pZCk7CiAgICBpZiAoJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMubWF4X3JlZ2lzdHJhdGlvbnM9PScnKQogICAgewogICAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5tYXhfcmVnaXN0cmF0aW9ucz0wOwogICAgfQogICAgdXBkYXRlRXZlbnRUeXBlKCRodHRwLCRzY29wZSwkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5ldmVudF90eXBlX2lkLCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLHVwZGF0ZUV2ZW50VHlwZV9zdWNjZXNzKTsKICAgIGZ1bmN0aW9uIHVwZGF0ZUV2ZW50VHlwZV9zdWNjZXNzKCkKICAgIHsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgICAkbG9jYXRpb24ucGF0aCgnL2V2ZW50X3R5cGVzJyk7CiAgICB9CiAgfQoKfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdjbGFzc0RlbGV0ZUFsbE1vZGFsQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHJvb3RTY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRodHRwLCBjdXJyZW50RXZlbnQsIHVpQ2FsZW5kYXJDb25maWcpCnsKICBsb2dEZWJ1ZygiY29udHJvbGxlcjogY2xhc3NEZWxldGVBbGxNb2RhbENvbnRyb2xsZXIiKTsKICAkc2NvcGUuY3VycmVudEV2ZW50PWN1cnJlbnRFdmVudDsKICAkc2NvcGUuY2xvc2VNb2RhbCA9IGZ1bmN0aW9uKCkKICB7CiAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgfTsKCgogICRzY29wZS5kZWxldGVDbGFzc0V2ZW50U2luZ2xlPWZ1bmN0aW9uICgpIC8vIGRlbGV0ZSBvbmx5IG9uZS9jdXJyZW50IGNsYXNzIGV2ZWh0CiAgewogICAgY2FuY2VsQ2xhc3NFdmVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCxjYW5jZWxDbGFzc0V2ZW50X2NhbGxiYWNrLCBjYW5jZWxDbGFzc0V2ZW50X2NhbGxiYWNrKTsKICAgIGZ1bmN0aW9uIGNhbmNlbENsYXNzRXZlbnRfY2FsbGJhY2soKQogICAgewogICAgICBnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkKTsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ3JlbG9hZEV2ZW50Jyx7ZXZlbnRfaWQgOiAkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkfSk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCiAgICB9CiAgfQogICRzY29wZS5kZWxldGVDbGFzc0V2ZW50c0FsbD1mdW5jdGlvbiAoKSAvLyBkZWxldGUgYWxsIHJlcGVhdGluZyBldmVudHMKICB7CiAgICBjYW5jZWxDbGFzc1JlcGVhdGluZ0V2ZW50KCRodHRwLCRzY29wZSwwLCRzY29wZS5jdXJyZW50RXZlbnQucmVwZWF0X2V2ZW50X2lkLGNhbmNlbENsYXNzRXZlbnRfY2FsbGJhY2ssIGNhbmNlbENsYXNzRXZlbnRfY2FsbGJhY2spOwogICAgZnVuY3Rpb24gY2FuY2VsQ2xhc3NFdmVudF9jYWxsYmFjaygpCiAgICB7CiAgICAgIGdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQpOwogICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgncmVsb2FkRXZlbnQnLHtldmVudF9pZCA6ICRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWR9KTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKICAgIH0KICB9CiAgJHNjb3BlLmRlbGV0ZUNsYXNzRXZlbnRzQWxsU3RhcnRpbmdFdmVudElEPWZ1bmN0aW9uICgpIC8vIGRlbGV0ZSBhbGwgcmVwZWF0aW5nIGV2ZW50cyBzdGFydGluZyBldmVudF9pZAogIHsKICAgIGNhbmNlbENsYXNzUmVwZWF0aW5nRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQsJHNjb3BlLmN1cnJlbnRFdmVudC5yZXBlYXRfZXZlbnRfaWQsY2FuY2VsQ2xhc3NFdmVudF9jYWxsYmFjaywgY2FuY2VsQ2xhc3NFdmVudF9jYWxsYmFjayk7CiAgICBmdW5jdGlvbiBjYW5jZWxDbGFzc0V2ZW50X2NhbGxiYWNrKCkKICAgIHsKLy8gZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCk7CiAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdyZWxvYWRFdmVudCcse2V2ZW50X2lkIDogJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZH0pOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgfQogIH0KCn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignYnVzaW5lc3NfbW9kYWxfbGltaXRhdGlvbl9jcmVhdGUnLCBmdW5jdGlvbigkc2NvcGUsICRyb290U2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgc3RhcnQsZW5kLCBmaXhlZFNjaGVkdWxlLCB1aUNhbGVuZGFyQ29uZmlnKSB7CgogICRzY29wZS5maXhlZFNjaGVkdWxlPWZpeGVkU2NoZWR1bGU7CiAgJHNjb3BlLm9yaWdpbmFsX3N0YXJ0PXN0YXJ0OwogICRzY29wZS5vcmlnaW5hbF9lbmQ9ZW5kOwoKICAkc2NvcGUuc3RhcnQ9bmV3IG1vbWVudChzdGFydCkqMTAwMDsKICAkc2NvcGUuZW5kPW5ldyBtb21lbnQoZW5kKSoxMDAwOwogIGNvbnNvbGUubG9nKCdzdGFydD0nK3N0YXJ0KTsKICBjb25zb2xlLmxvZygnZW5kPScrZW5kKTsKCiAgZ2V0QnVzaW5lc3NMb2NhdGlvbnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19sb2NhdGlvbnMnLGdldEJ1c2luZXNzTG9jYXRpb25zX3N1Y2Nlc3MpOwogIGZ1bmN0aW9uIGdldEJ1c2luZXNzTG9jYXRpb25zX3N1Y2Nlc3MoKQogIHsKICAgICRzY29wZS5uZXdFdmVudERldGFpbHMubG9jYXRpb25faWQ9JHNjb3BlLmJ1c2luZXNzX2xvY2F0aW9uc1swXS5sb2NhdGlvbl9pZDsKICB9CgogIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc3RhcnQpOwogIHNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKGVuZCk7CiAgbG9nRGVidWcoInNlbGVjdGVkRGF0ZVN0YXJ0ID0gIitzZWxlY3RlZERhdGVTdGFydCk7CiAgdmFyIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZSgpICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKICB2YXIgc2VsZWN0ZWREYXRlRW5kID0gbmV3IERhdGUoc2VsZWN0ZWREYXRlRW5kLmdldFRpbWUoKSArIHNlbGVjdGVkRGF0ZUVuZC5nZXRUaW1lem9uZU9mZnNldCgpICogNjAwMDApOwoKLy8gbG9nRGVidWcoImRhdGU9IiArIHNlbGVjdGVkRGF0ZVN0YXJ0KTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudCA9IFtdOwogICRzY29wZS5uZXdFdmVudERldGFpbHMgPSBbXTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0SG91cnMoKTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBzZWxlY3RlZERhdGVTdGFydC5nZXRNaW51dGVzKCk7CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkb3cgPSBkYXlOYW1lc1tzZWxlY3RlZERhdGVTdGFydC5nZXREYXkoKV07CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXRlID0gc2VsZWN0ZWREYXRlU3RhcnQ7CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aCA9IG1vbnRoTmFtZXNbc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TW9udGgoKV07CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aDExMiA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldE1vbnRoKCkrMTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRheW9mbW9udGggPSBzZWxlY3RlZERhdGVTdGFydC5nZXREYXRlKCk7CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RnVsbFllYXIoKTsKICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWVfaW5wdXRfZm9ybWF0PSBuZXcgRGF0ZSgxOTcwLCAwLCAxLCAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzLCAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMsIDApOwoKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycyA9IHNlbGVjdGVkRGF0ZUVuZC5nZXRIb3VycygpOwogICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKSA8IDEwID8gJzAnIDogJycpICsgc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKTsKCgogICRzY29wZS5jYW5jZWwgPSBmdW5jdGlvbigpIHsKICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICB9OwoKICBnZXRBbGxJbnN0cnVjdG9ycygkaHR0cCwkc2NvcGUsJ2luc3RydWN0b3JzJyxnZXRBbGxJbnN0cnVjdG9yc19zdWNjZXNzKTsKICBmdW5jdGlvbiBnZXRBbGxJbnN0cnVjdG9yc19zdWNjZXNzKCkKICB7CiAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmluc3RydWN0b3JfaWQ9JHNjb3BlLmluc3RydWN0b3JzWzBdLmJ1c2luZXNzX3VzZXJfaWQ7CiAgfQogIGdldE5vQ2xhc3NFdmVudFR5cGVzTm9BZG1pbigkaHR0cCwkc2NvcGUsJ3JlbGF0ZWRFdmVudFR5cGVzJyk7CgogICRzY29wZS5jcmVhdGVOZXdMaW1pdGF0aW9uID0gZnVuY3Rpb24oKQogIHsKICAgIGxvZ0RlYnVnKCJmdW5jdGlvbjogY3JlYXRlTmV3TGltaXRhdGlvbiIpOwogICAgY2FsZW5kYXIgPSAnY2FsZW5kYXJfaG91cnNfb2Zfd29yayc7CgogICAgaWYgKCRzY29wZS5zZWxlY3RlZEV2ZW50VHlwZXMubGVuZ3RoPDEpCiAgICB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vyczwkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKQogICAgewogICAgICBhbGVydCgi15bXntefINeh15nXldedINec16TXoNeZINeW157XnyDXlNeq15fXnNeUIik7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vycz09JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykKICAgIHsKICAgICAgaWYgKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXM8PSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcykKICAgICAgewogICAgICAgIGFsZXJ0KCLXltee158g16HXmdeV150g15zXpNeg15kg15bXntefINeU16rXl9ec15QiKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgaWYgKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXM8KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcysxMCkpCiAgICAgIHsKICAgICAgICBhbGVydCgi15HXnNeV16cg16fXmNefINeeLTEwINeT16fXldeqIik7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9CiAgICBpZiAoIWt1emVJc0NhbGVuZGFyRHJhZ2dibGUpIHsKICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigndW5zZWxlY3QnKTsKICAgIH0KICAgIGxvZ0RlYnVnKCJzdGFydD0iICsgc3RhcnQpOwogICAgY2hlY2tEYXRlID0gbmV3IERhdGUoc3RhcnQpOwogICAgbG9nRGVidWcoImNoZWNrIGRhdGUgPSAiICsgY2hlY2tEYXRlKQogICAgbG9nRGVidWcoImVuZD0iICsgZW5kKTsKICAgIGVjb2xvcj0iIzAwYTY1YSI7CgogICAgaWYgKGNoZWNrRGF0ZS5nZXRGdWxsWWVhcigpID09IDE5NzApIHsKICAgICAgZGF5X2xpbWl0X2lkID0gLTE7CiAgICB9IGVsc2UgewogICAgICBkYXlfbGltaXRfaWQgPSAxOwogICAgfQoKLy8gdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbXS5mdWxsQ2FsZW5kYXIoJ3JlcmVuZGVyRXZlbnRzJyk7CgogICAgdGVtcF9saW1pdF9pZCA9IGNhbGNfdGVtcF9saW1pdF9pZCgpOwoKICAgIGxvZ0RlYnVnKCRzY29wZS5zZWxlY3RlZEV2ZW50VHlwZXNbMF0pOwogICAgbG9nRGVidWcoJHNjb3BlLnNlbGVjdGVkRXZlbnRUeXBlc1swXS5ldmVudF90eXBlX2lkKTsKCiAgICBzdGFydF9wYXJhbT1zdGFydDsKICAgIGVuZF9wYXJhbT1lbmQ7CiAgICB0aXRsZV9wYXJhbT0nJzsKICAgIGxvZ0RlYnVnKCJhZGRMaW1pdGF0aW9uVG9EYXRhYmFzZSBzdGFydD0iICsgc3RhcnRfcGFyYW0gKyAiLCBlbmQ9IiArICIsIHRpdGxlPSIgKyB0aXRsZV9wYXJhbSApOwoKICAgIHRoZWRhdGEgPSB7CiAgICAgIHN0YXJ0X2RhdGU6ICRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZSwKICAgICAgZW5kX2RhdGU6ICRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kX3RpbWUsCiAgICAgIGNvbG9yOiBlY29sb3IsCiAgICAgIHRlbXBfbGltaXRfaWQ6IHRlbXBfbGltaXRfaWQsCiAgICAgIGVtcF9pZDogJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pbnN0cnVjdG9yX2lkLAogICAgICBsb2NhdGlvbl9pZDogJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5sb2NhdGlvbl9pZCwKICAgICAgZXZlbnRfdHlwZV9pZDogJHNjb3BlLnNlbGVjdGVkRXZlbnRUeXBlc1swXS5ldmVudF90eXBlX2lkLAogICAgICBldmVudF90eXBlczogJHNjb3BlLnNlbGVjdGVkRXZlbnRUeXBlcywKICAgICAgdGl0bGU6IHRpdGxlX3BhcmFtCiAgICB9OwoKICAgIGlmICgkc2NvcGUuZml4ZWRTY2hlZHVsZSkgLy8gZml4ZWQgc2NoZWR1bGUgdnMgc3BlY2lmaWMgd2VlZC9kYXkgbGltaXRhdGlvbgogICAgewogICAgICBjcmVhdGVDYWxlbmRhckxpbWl0YXRpb24oJGh0dHAsJHNjb3BlLHRoZWRhdGEsbGltaXRhdGlvbl9zdWNjZXNzX2NhbGxiYWNrKTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgY3JlYXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5KCRodHRwLCRzY29wZSx0aGVkYXRhLGxpbWl0YXRpb25fc3VjY2Vzc19jYWxsYmFjayk7CiAgICB9CiAgICBmdW5jdGlvbiBsaW1pdGF0aW9uX3N1Y2Nlc3NfY2FsbGJhY2soKQogICAgewogICAgICBsb2dEZWJ1Zygic3VjY2VzcyIpOwogICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZWZldGNoRXZlbnRzJyk7CiAgICAgICR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoKTsKICAgIH0KCiAgfQoKICAkc2NvcGUuc3RhcnRNaW51dGVzID0gZnVuY3Rpb24oKQogIHsKICAgIGxvZ0RlYnVnKCJzdGFydE1pbnV0ZXMgIisoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKSk7CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXM9bWludXRlc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKTsKICAgIGNhbGN1bGF0ZVN0YXJ0VGltZSgpOwogIH0KICAkc2NvcGUuc3RhcnRIb3VycyA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1Zygic3RhcnRIb3VycyAiK2hvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKSk7CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzPWhvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKTsKICAgIGNhbGN1bGF0ZVN0YXJ0VGltZSgpOwogIH0KICAkc2NvcGUuZW5kTWludXRlcyA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1ZygiZW5kTWludXRlcyAiKygkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzKSk7CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzPW1pbnV0ZXNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpOwogICAgY2FsY3VsYXRlRW5kVGltZSgpOwogIH0KICAkc2NvcGUuZW5kSG91cnMgPSBmdW5jdGlvbigpCiAgewogICAgbG9nRGVidWcoImVuZEhvdXJzICIraG91cnNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzKSk7CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vycz1ob3Vyc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMpOwogICAgY2FsY3VsYXRlRW5kVGltZSgpOwogIH0KCgogIGZ1bmN0aW9uIGNhbGN1bGF0ZVN0YXJ0VGltZSgpCiAgewogICAgZXZlbnRZZWFyPSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0eWVhcjsKICAgIGV2ZW50TW9udGg9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aDExMjsKICAgIGV2ZW50RGF5PSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aDsKICAgIGlmIChwYXJzZUludChldmVudE1vbnRoKTwxMCkKICAgIHsKICAgICAgZXZlbnRNb250aD0iMCIrZXZlbnRNb250aDsKICAgIH0KICAgIGlmIChwYXJzZUludChldmVudERheSk8MTApCiAgICB7CiAgICAgIGV2ZW50RGF5PSIwIitldmVudERheTsKICAgIH0KICAgIGxvZ0RlYnVnKCIkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXI9IitldmVudFllYXIpOwogICAgbG9nRGVidWcoIiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aD0iK2V2ZW50TW9udGgpOwogICAgbG9nRGVidWcoIiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bW9udGg9IitldmVudERheSk7CiAgICBuZXdfc3RhcnQ9bW9tZW50LnV0YyhldmVudFllYXIrIi0iK2V2ZW50TW9udGgrIi0iK2V2ZW50RGF5KyJUMDA6MDA6MDAiKS5hZGQoKChwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKSo2MCkrcGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKSksICdtaW51dGVzJyk7CiAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWU9bmV3X3N0YXJ0OwogICAgbG9nRGVidWcoIm5ld19zdGFydD0iK25ld19zdGFydCk7CiAgfQogIGZ1bmN0aW9uIGNhbGN1bGF0ZUVuZFRpbWUoKQogIHsKICAgIGV2ZW50WWVhcj0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXI7CiAgICBldmVudE1vbnRoPSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bW9udGgxMTI7CiAgICBldmVudERheT0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRheW9mbW9udGg7CiAgICBpZiAocGFyc2VJbnQoZXZlbnRNb250aCk8MTApCiAgICB7CiAgICAgIGV2ZW50TW9udGg9IjAiK2V2ZW50TW9udGg7CiAgICB9CiAgICBpZiAocGFyc2VJbnQoZXZlbnREYXkpPDEwKQogICAgewogICAgICBldmVudERheT0iMCIrZXZlbnREYXk7CiAgICB9CiAgICBsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyPSIrZXZlbnRZZWFyKTsKICAgIGxvZ0RlYnVnKCIkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRheW9mbW9udGg9IitldmVudE1vbnRoKTsKICAgIGxvZ0RlYnVnKCIkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoPSIrZXZlbnREYXkpOwogICAgbmV3X2VuZD1tb21lbnQudXRjKGV2ZW50WWVhcisiLSIrZXZlbnRNb250aCsiLSIrZXZlbnREYXkrIlQwMDowMDowMCIpLmFkZCgoKHBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzKSo2MCkrcGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcykpLCAnbWludXRlcycpOwogICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmRfdGltZT1uZXdfZW5kOwogICAgbG9nRGVidWcoIm5ld19lbmQ9IituZXdfZW5kKTsKICB9CgogIGNhbGN1bGF0ZVN0YXJ0VGltZSgpOwogIGNhbGN1bGF0ZUVuZFRpbWUoKTsKCiAgZnVuY3Rpb24gbWludXRlc0NoYW5nZWQodGhlbWludXRlcykKICB7CiAgICBsb2dEZWJ1ZygidGhlbWludXRlcz0iK3RoZW1pbnV0ZXMpOwogICAgaWYgKHR5cGVvZiB0aGVtaW51dGVzPT0idW5kZWZpbmVkIikKICAgIHsKICAgICAgcmV0dXJuICIwMCI7CiAgICB9CiAgICB0aGVtaW51dGVzPXBhcnNlSW50KHRoZW1pbnV0ZXMpOwogICAgaWYgKHRoZW1pbnV0ZXM+NjApCiAgICB7CiAgICAgIHJldHVybiAiMDAiOwogICAgfQogICAgZWxzZSBpZiAodGhlbWludXRlczwwKQogICAgewogICAgICByZXR1cm4gIjAwIjsKICAgIH0KICAgIGVsc2UgaWYgKHRoZW1pbnV0ZXM9PSIiKQogICAgewogICAgICByZXR1cm4gIjAwIjsKICAgIH0KICAgIGVsc2UgaWYgKHRoZW1pbnV0ZXM8MTApCiAgICB7CiAgICAgIHJldHVybiAiMCIrdGhlbWludXRlczsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgcmV0dXJuIHRoZW1pbnV0ZXM7CiAgICB9CiAgfQogIGZ1bmN0aW9uIGhvdXJzQ2hhbmdlZCh0aGVob3VycykKICB7CiAgICBsb2dEZWJ1ZygidGhlaG91cnM9Iit0aGVob3Vycyk7CiAgICBpZiAodHlwZW9mIHRoZWhvdXJzPT0idW5kZWZpbmVkIikKICAgIHsKICAgICAgcmV0dXJuICIwIjsKICAgIH0KICAgIHRoZWhvdXJzPXBhcnNlSW50KHRoZWhvdXJzKTsKICAgIGlmICh0aGVob3Vycz4yNCkKICAgIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CiAgICBlbHNlIGlmICh0aGVob3VyczwwKQogICAgewogICAgICByZXR1cm4gMDsKICAgIH0KICAgIGVsc2UgaWYgKHRoZWhvdXJzPT0iIikKICAgIHsKICAgICAgcmV0dXJuICIwIjsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgcmV0dXJuIHRoZWhvdXJzOwogICAgfQogIH0KfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2NsYXNzQ2xvc2VNb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRyb290U2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgZXZlbnRfaWQsIHVpQ2FsZW5kYXJDb25maWcpIHsKICBnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnc2VsZWN0ZWRFdmVudCcsZXZlbnRfaWQsYWZ0ZXJHZXRDbGllbnRTcGVjaWZpY0V2ZW50KTsKICBmdW5jdGlvbiBhZnRlckdldENsaWVudFNwZWNpZmljRXZlbnQoKQogIHsKICAgIGZvciAoaSA9IDA7IGkgPCAkc2NvcGUuc2VsZWN0ZWRFdmVudC5ldmVudFVzZXJzLmxlbmd0aDsgaSsrKQogICAgewogICAgICBpZiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRVc2Vyc1tpXS5zdGF0dXNfbmFtZSE9JGdVc2VyX3N0YXR1c19hYnNlbnRlZCkKICAgICAgewogICAgICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50VXNlcnNbaV0ucGFydGljaXBhdGVkPXRydWU7CiAgICAgIH0KICAgICAgaWYgKCRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50VXNlcnNbaV0uaXNfd2FpdGluZ19saXN0PT0xKQogICAgICB7CiAgICAgICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRVc2Vyc1tpXS5wYXJ0aWNpcGF0ZWQ9ZmFsc2U7CiAgICAgIH0KICAgIH0KICAgIGxvZ0RlYnVnKCRzY29wZS5zZWxlY3RlZEV2ZW50KTsKICB9CgovLyBjbGlja2VkIHJvdyAtIGNoZWNrL3VuY2hlY2sgdGhlIGNoZWNrYm94IG9mIGEgdXNlcgogICRzY29wZS5yb3dDbGlja2VkID0gZnVuY3Rpb24ob2JqKQogIHsKICAgIGxvZ0RlYnVnKCdyb3cgY2xpY2tlZCcpOwogICAgb2JqLnBhcnRpY2lwYXRlZCA9ICFvYmoucGFydGljaXBhdGVkOwogIH07CgogICRzY29wZS5va0xpbWl0YXRpb25Nb2RhbCA9IGZ1bmN0aW9uKCkgewogICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogIH07CgogICRzY29wZS5jbG9zZUNsYXNzID0gZnVuY3Rpb24oKQogIHsKICAgIGNsb3NlQ2xhc3NFdmVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRfaWQsJHNjb3BlLnNlbGVjdGVkRXZlbnQsYWZ0ZXJDbG9zZUV2ZW50LGFmdGVyQ2xvc2VFdmVudCk7CiAgICBmdW5jdGlvbiBhZnRlckNsb3NlRXZlbnQoKQogICAgewogICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgncmVsb2FkRXZlbnQnLHtldmVudF9pZCA6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50X2lkfSk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCiAgICB9OwogIH0KfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2J1c2luZXNzQ2xpZW5kQ2FyZFBheW1lbnQnLCBmdW5jdGlvbigkc2NvcGUsICRyb3V0ZVBhcmFtcywgJHJvb3RTY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRodHRwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50Q2xpZW50LCBpc3BsdXMsIHVpQ2FsZW5kYXJDb25maWcsIGJ1c2luZXNzQ29uZmlnLCBwYXltZW50cykKewogICRzY29wZS5pc3BsdXM9aXNwbHVzOwogIGxvZ0RlYnVnKCdidXNpbmVzc0NsaWVuZENhcmRQYXltZW50IGlzcGx1cz0nICtpc3BsdXMrIiBjdXJyZW50Q2xpZW50PSIrIEpTT04uc3RyaW5naWZ5KGN1cnJlbnRDbGllbnQsIG51bGwsIDIpKTsKICAkc2NvcGUua3V6ZUlzTG9hZGluZz1mYWxzZTsKICBsb2dEZWJ1ZygnY3VycmVudENsaWVudC5wYXltZW50X2JhbGFuY2U9JytjdXJyZW50Q2xpZW50LnBheW1lbnRfYmFsYW5jZSsiLGN1cnJlbnRDbGllbnQudW5wYWlkX2JhbGFuY2UgPSIrY3VycmVudENsaWVudC51bnBhaWRfYmFsYW5jZSk7CiAgdGhlYmFsYW5jZSA9IGN1cnJlbnRDbGllbnQucGF5bWVudF9iYWxhbmNlLWN1cnJlbnRDbGllbnQudW5wYWlkX2JhbGFuY2U7CiAgbG9nRGVidWcoJ3RoZWJhbGFuY2U9Jyt0aGViYWxhbmNlKTsKICBpZiAodGhlYmFsYW5jZTwwKQogIHsKICAgICRzY29wZS5iYWxhbmNlVG9QYXk9TWF0aC5hYnModGhlYmFsYW5jZSk7CiAgfQogIGVsc2UKICB7CiAgICAkc2NvcGUuYmFsYW5jZVRvUGF5PTA7CiAgfQogIHVwZGF0ZUJhbGFuY2UodHJ1ZSk7CiAgJHNjb3BlLnBheW1lbnRUeXBlVGl0bGU9IteR15fXqCI7CiAgJHNjb3BlLmN1cnJlbnRDbGllbnQ9Y3VycmVudENsaWVudDsKICBsb2dEZWJ1Zygkc2NvcGUuY3VycmVudENsaWVudCk7CiAgJHNjb3BlLmludm9pY2Vfc291cmNlX2lkID0gYnVzaW5lc3NDb25maWcuaW52b2ljZV9zb3VyY2VfaWQ7CiAgJHNjb3BlLmhhc1ZhdCA9IGJ1c2luZXNzQ29uZmlnLnZhdF9yYXRlID4gMDsKCiAgJHNjb3BlLmNsb3NlTW9kYWwgPSBmdW5jdGlvbigpIHsKICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICB9OwoKICAkc2NvcGUuZXh0ZXJuYWxfaW52b2ljZV9nZW5lcmF0ZWQ9ZmFsc2U7CiAgJHNjb3BlLmludm9pY2VfZGF0ZV9mb3JtYXQ9bmV3IERhdGUoKTsKCiAgZ2V0TmV4dEludm9pY2VOdW1iZXIoJGh0dHAsJHNjb3BlLCRzY29wZS5jdXJyZW50Q2xpZW50LmJ1c2luZXNzX3VzZXJfaWQsJ2ludm9pY2VfbnVtYmVyJyk7CgogICRzY29wZS5wYXltZW50TWV0aG9kcyA9IHBheW1lbnRNZXRob2RzOwogICRzY29wZS5jcmVkaXRDYXJkVHlwZXMgPSBjcmVkaXRDYXJkVHlwZXM7CiAgJHNjb3BlLmNyZWRpdFRyYW5zYWN0aW9uVHlwZXMgPSBjcmVkaXRUcmFuc2FjdGlvblR5cGVzOwogICRzY29wZS5iYW5rcyA9IGJhbmtzOwogICRzY29wZS5kb2N1bWVudFR5cGVzID0gaW52b2ljZURvY3VtZW50VHlwZXMuZmlsdGVyKGZ1bmN0aW9uIChkb2MpIHsKICAgIHJldHVybiBkb2MudXNlclR5cGVzID09PSAiYWxsIiB8fCBkb2MudXNlclR5cGVzLmluY2x1ZGVzKE51bWJlcihidXNpbmVzc0NvbmZpZy5idXNpbmVzc190eXBlKSkKICB9KTsKCi8vIGluZGljYXRpb24gd2hldGhlciBwYXltZW50IG1ldGhvZCB3YXMgc2VsZWN0ZWQKICAkc2NvcGUuaXNQYXltZW50TWV0aG9kU2VsZWN0ZWQgPSBmYWxzZTsKICAkc2NvcGUucHJlZmlsbFBheW1lbnRNZXRob2QgPSBmdW5jdGlvbiAocGF5bWVudE1ldGhvZCwgcGF5bWVudHMpIHsKICAgIHZhciBmaWVsZHMgPSB7CiAgICAgICdDSEVDSyc6IFsnYmFua19jb21wYW55X2NvZGUnLCAnYmFua19icmFuY2hfbnVtYmVyJywgJ2FjY291bnRfbnVtYmVyJ10sCiAgICAgICdCQU5LX1RSQU5TRkVSJzogWydiYW5rX2NvbXBhbnlfY29kZScsICdiYW5rX2JyYW5jaF9udW1iZXInLCAnYWNjb3VudF9udW1iZXInXSwKICAgICAgJ0NSRURJVF9DQVJEJzogWydjcmVkaXRfY2FyZF90eXBlJywgJ2NyZWRpdF9jYXJkX251bWJlciddCiAgICB9W3BheW1lbnRNZXRob2QubWV0aG9kXTsKICAgIGlmIChmaWVsZHMgPT09IHVuZGVmaW5lZCkgcmV0dXJuOwogICAgdmFyIHBvc3NpYmxlTWF0Y2hlcyA9IHBheW1lbnRzCiAgICAgICAgLmZpbHRlcihmdW5jdGlvbiAocCkgewogICAgICAgICAgcmV0dXJuIHAucGF5bWVudF9tZXRob2RfbmFtZSA9PT0gcGF5bWVudE1ldGhvZC5tZXRob2QKICAgICAgICB9KQogICAgICAgIC5maWx0ZXIoZnVuY3Rpb24gKHApIHsKICAgICAgICAgIHJldHVybiBmaWVsZHMuZXZlcnkoZnVuY3Rpb24gKGZpZWxkKSB7CiAgICAgICAgICAgIHJldHVybiBwW2ZpZWxkXSAhPT0gdW5kZWZpbmVkCiAgICAgICAgICB9KQogICAgICAgIH0pCiAgICAgICAgLnNvcnQoZnVuY3Rpb24gKHAxLCBwMikgewogICAgICAgICAgdmFyIGEgPSBuZXcgRGF0ZShwMS5jcmVhdGlvbl9kYXRlKSwgYiA9IG5ldyBEYXRlKHAyLmNyZWF0aW9uX2RhdGUpOwogICAgICAgICAgcmV0dXJuIChhID4gYikgLSAoYSA8IGIpOwogICAgICAgIH0pCiAgICBjb25zb2xlLmxvZygiUG9zc2libGUgcGF5bWVudHMgaW5mbzogIiwgcG9zc2libGVNYXRjaGVzKTsKICB9OwogICRzY29wZS5zZWxlY3RQYXltZW50TWV0aG9kID0gZnVuY3Rpb24ocGF5bWVudCkgewogICAgJHNjb3BlLnBheW1lbnRUeXBlVGl0bGU9cGF5bWVudC5uYW1lOwogICAgJHNjb3BlLnNlbGVjdGVkUGF5bWVudE1ldGhvZD1wYXltZW50OwogICAgJHNjb3BlLmlzUGF5bWVudE1ldGhvZFNlbGVjdGVkPXRydWU7CiAgICAkc2NvcGUucHJlZmlsbFBheW1lbnRNZXRob2QocGF5bWVudCwgcGF5bWVudHMpOwogIH07CgogIGZ1bmN0aW9uIHVwZGF0ZUJhbGFuY2UgKGlzU291cmNlV2l0aFZhdCkgewogICAgaWYgKGlzU291cmNlV2l0aFZhdCkgewogICAgICAkc2NvcGUuYmFsYW5jZVRvUGF5Tm9WYXQgPSBOdW1iZXIoKCRzY29wZS5iYWxhbmNlVG9QYXkgLyAoMSArIGJ1c2luZXNzQ29uZmlnLnZhdF9yYXRlKSkudG9GaXhlZCgyKSk7CiAgICB9IGVsc2UgewogICAgICAkc2NvcGUuYmFsYW5jZVRvUGF5ID0gTnVtYmVyKCgkc2NvcGUuYmFsYW5jZVRvUGF5Tm9WYXQgKiAoMSArIGJ1c2luZXNzQ29uZmlnLnZhdF9yYXRlKSkudG9GaXhlZCgyKSk7CiAgICB9CiAgfQoKICAkc2NvcGUudXBkYXRlQmFsYW5jZSA9IHVwZGF0ZUJhbGFuY2U7CgogICRzY29wZS5vbkRvY3VtZW50VHlwZUNoYW5nZWQgPSBmdW5jdGlvbiBvbkRvY3VtZW50VHlwZUNoYW5nZWQoKSB7CiAgICAkc2NvcGUuaW52b2ljZV9nZW5lcmF0ZWQgPSBOdW1iZXIoJHNjb3BlLmRvY3VtZW50X3R5cGUpICE9PSAwOwogIH07CgogICRzY29wZS5tYWtlUGF5bWVudCA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1ZyhjdXJyZW50Q2xpZW50KTsKICAgIGxvZ0RlYnVnKCJwYXltZW50IG1ldGhvZCIpOwogICAgbG9nRGVidWcoJHNjb3BlLnNlbGVjdGVkUGF5bWVudE1ldGhvZCk7CiAgICBsb2dEZWJ1ZygiJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZ2VuZXJhdGVkPTwiKyRzY29wZS5pbnZvaWNlX2dlbmVyYXRlZCsiPiIpOwoKICAgIGlmICgoJHNjb3BlLmJhbGFuY2VUb1BheT09MCkgfHwgKCRzY29wZS5iYWxhbmNlVG9QYXk9PScnKXx8ICgkc2NvcGUuYmFsYW5jZVRvUGF5PT1udWxsKSkKICAgIHsKICAgICAgJHNjb3BlLnVzZXJFcnJvcj0i15DXoNeQINeU15bXnyDXodeb15XXnSDXm9ec16nXlNeVIjsKICAgIH0KICAgIGVsc2UgaWYgKCEkc2NvcGUuaXNQYXltZW50TWV0aG9kU2VsZWN0ZWQpCiAgICB7CiAgICAgICRzY29wZS51c2VyRXJyb3I9IteQ16DXkCDXkdeX16gg15DXntem16LXmSDXqtep15zXldedIjsKLy8gYWxlcnQoJ3NzJyk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgIGlmICgoJHNjb3BlLmludm9pY2VfZ2VuZXJhdGVkIT0xKSB8fCAoJHNjb3BlLmludm9pY2VfZGF0ZV9mb3JtYXQ9PW51bGwpKQogICAgICB7CiAgICAgICAgdmFyIGludm9pY2VfZGF0ZV9mb3JtYXQgPSAibnVsbCI7CiAgICAgIH0KICAgICAgZWxzZQogICAgICB7CiAgICAgICAgdmFyIGludm9pY2VfZGF0ZV9mb3JtYXQgPSAkc2NvcGUuaW52b2ljZV9kYXRlX2Zvcm1hdC5nZXREYXRlKCkgICsgIi0iICsgKCRzY29wZS5pbnZvaWNlX2RhdGVfZm9ybWF0LmdldE1vbnRoKCkrMSkgKyAiLSIgKyAkc2NvcGUuaW52b2ljZV9kYXRlX2Zvcm1hdC5nZXRGdWxsWWVhcigpOwogICAgICB9CiAgICAgIGlmIChpc3BsdXMpCiAgICAgIHsKICAgICAgICB3aGF0VG9QYXk9JHNjb3BlLmJhbGFuY2VUb1BheTsKICAgICAgfQogICAgICBlbHNlIHsKICAgICAgICB3aGF0VG9QYXk9LSRzY29wZS5iYWxhbmNlVG9QYXk7CiAgICAgIH0KICAgICAgdGhlZGF0YT0gewogICAgICAgIGJhbGFuY2VUb1BheTogd2hhdFRvUGF5LAogICAgICAgIGJhbGFuY2VUb1BheU5vVmF0OiAkc2NvcGUuYmFsYW5jZVRvUGF5Tm9WYXQgKiAoaXNwbHVzID8gKzEgOiAtMSksCiAgICAgICAgcGF5bWVudF9tZXRob2RfbmFtZTogJHNjb3BlLnNlbGVjdGVkUGF5bWVudE1ldGhvZC5tZXRob2QsCiAgICAgICAgaW52b2ljZV9udW1iZXI6ICRzY29wZS5pbnZvaWNlX251bWJlciwKICAgICAgICBpbnZvaWNlX2dlbmVyYXRlZDogJHNjb3BlLmludm9pY2VfZ2VuZXJhdGVkLAogICAgICAgIGludm9pY2VfZGF0ZTogaW52b2ljZV9kYXRlX2Zvcm1hdCwKICAgICAgICBiYW5rX2NvbXBhbnlfY29kZTogJHNjb3BlLmJhbmtfY29tcGFueV9jb2RlLAogICAgICAgIGJhbmtfYnJhbmNoX251bWJlcjogJHNjb3BlLmJhbmtfYnJhbmNoX251bWJlciwKICAgICAgICBjaGVja19udW1iZXI6ICRzY29wZS5jaGVja19udW1iZXIsCiAgICAgICAgYWNjb3VudF9udW1iZXI6ICRzY29wZS5hY2NvdW50X251bWJlciwKICAgICAgICBjcmVkaXRfY2FyZF9udW1iZXI6ICRzY29wZS5jcmVkaXRfY2FyZF9udW1iZXIsCiAgICAgICAgY3JlZGl0X2NhcmRfdHlwZTogJHNjb3BlLmNyZWRpdF9jYXJkX3R5cGUsCiAgICAgICAgY3JlZGl0X2NhcmRfdHJhbnNhY3Rpb25fdHlwZTogJHNjb3BlLmNyZWRpdF9jYXJkX3RyYW5zYWN0aW9uX3R5cGUsCiAgICAgICAgaW52b2ljZV9jb21tZW50czogJHNjb3BlLmludm9pY2VfY29tbWVudHMsCiAgICAgICAgZG9jdW1lbnRfdHlwZTogJHNjb3BlLmRvY3VtZW50X3R5cGUKICAgICAgfTsKICAgICAgJHNjb3BlLmt1emVJc0xvYWRpbmc9dHJ1ZTsKICAgICAgY3JlYXRlUGF5bWVudEZvckNsaWVudCgkaHR0cCwkc2NvcGUsY3VycmVudENsaWVudC5idXNpbmVzc191c2VyX2lkLHRoZWRhdGEsY3JlYXRlUGF5bWVudEZvckNsaWVudF9zdWNjZXNzLCBjcmVhdGVQYXltZW50Rm9yQ2xpZW50X2ZhaWx1cmUpOwogICAgICBmdW5jdGlvbiBjcmVhdGVQYXltZW50Rm9yQ2xpZW50X3N1Y2Nlc3MoKQogICAgICB7CiAgICAgICAgJHNjb3BlLmt1emVJc0xvYWRpbmc9ZmFsc2U7CiAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgICAgIGxvZ0RlYnVnKCJicm9hZGNhc3RpbmcgY2xpZW50UGFnZVJlbG9hZERhdGEiKTsKICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NsaWVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCiAgICAgICAgbG9nRGVidWcoImJyb2FkY2FzdGluZyBldmVudFBhZ2VSZWxvYWREYXRhIik7CiAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdldmVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCi8vIGxvZ0RlYnVnKCJicm9hZGNhc3RpbmcgcmVsb2FkRXZlbnQiKTsKLy8gJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdyZWxvYWRFdmVudCcpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGNyZWF0ZVBheW1lbnRGb3JDbGllbnRfZmFpbHVyZSgpCiAgICAgIHsKICAgICAgICAkc2NvcGUua3V6ZUlzTG9hZGluZz1mYWxzZTsKICAgICAgfQogICAgfQogIH0KfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdldmVudERldGFpbHNCdXNpbmVzc0NhbGVuZGFyTW9kYWxDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIHNlbGVjdGVkRXZlbnQsIHVpQ2FsZW5kYXJDb25maWcpIHsKICB2YXIgZGF5TmFtZXMgPSBbJ9eo15DXqdeV158nLCAn16nXoNeZJywgJ9ep15zXmdep15knLCAn16jXkdeZ16LXmScsICfXl9ee15nXqdeZJywgJ9ep15nXqdeZJywgJ9ep15HXqiddOwoKICAkc2NvcGUuZ290b0NsaWVudFBhZ2U9IGZ1bmN0aW9uIChidXNpbmVzVXNlcmlkKQogIHsKICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICAgIGdvdG9DbGllbnRQYWdlKGJ1c2luZXNVc2VyaWQpOwogIH0KICAkc2NvcGUuZWRpdEV2ZW50PSBmdW5jdGlvbiAodGhlZXZlbnQpCiAgewogICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgZ290b0V2ZW50UGFnZSh0aGVldmVudCk7CiAgfQoKICBsb2dEZWJ1Zygic2VsZWN0ZWQgRXZlbnQgaW5mbyA9IiArIEpTT04uc3RyaW5naWZ5KHNlbGVjdGVkRXZlbnQsIG51bGwsIDIpKTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudCA9IHNlbGVjdGVkRXZlbnQ7CiAgc2VsZWN0ZWREYXRlU3RhcnQgPSBuZXcgRGF0ZShzZWxlY3RlZEV2ZW50LnN0YXJ0KTsKICB2YXIgc2VsZWN0ZWREYXRlU3RhcnQgPSBuZXcgRGF0ZShzZWxlY3RlZERhdGVTdGFydC5nZXRUaW1lKCkgKyBzZWxlY3RlZERhdGVTdGFydC5nZXRUaW1lem9uZU9mZnNldCgpICogNjAwMDApOwoKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0SG91cnMoKTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBzZWxlY3RlZERhdGVTdGFydC5nZXRNaW51dGVzKCk7CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkb3cgPSBkYXlOYW1lc1tzZWxlY3RlZERhdGVTdGFydC5nZXREYXkoKV07CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXRlID0gc2VsZWN0ZWREYXRlU3RhcnQ7CgogICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0RGF5ID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RGF0ZSgpOwogICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0TW9udGggPSAxICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TW9udGgoKTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydE1vbnRoVHh0ID0gbW9udGhOYW1lc1skc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydE1vbnRoIC0gMV07CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRZZWFyID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RnVsbFllYXIoKTsKCiAgc2VsZWN0ZWREYXRlRW5kID0gbmV3IERhdGUoc2VsZWN0ZWRFdmVudC5lbmQpOwogIHZhciBzZWxlY3RlZERhdGVFbmQgPSBuZXcgRGF0ZShzZWxlY3RlZERhdGVFbmQuZ2V0VGltZSgpICsgc2VsZWN0ZWREYXRlRW5kLmdldFRpbWV6b25lT2Zmc2V0KCkgKiA2MDAwMCk7CgogICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzID0gc2VsZWN0ZWREYXRlRW5kLmdldEhvdXJzKCk7CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kZG93ID0gZGF5TmFtZXNbc2VsZWN0ZWREYXRlRW5kLmdldERheSgpXTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzID0gKHNlbGVjdGVkRGF0ZUVuZC5nZXRNaW51dGVzKCkgPCAxMCA/ICcwJyA6ICcnKSArIHNlbGVjdGVkRGF0ZUVuZC5nZXRNaW51dGVzKCk7CiAgJHNjb3BlLm9rTGltaXRhdGlvbk1vZGFsID0gZnVuY3Rpb24oKSB7CiAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgfTsKCiAgJHNjb3BlLmRlbGV0ZUxpbWl0YXRpb25Nb2RhbCA9IGZ1bmN0aW9uKCkgewogICAgJHVpYk1vZGFsSW5zdGFuY2UuZGlzbWlzcygnZGVsZXRlJyk7CiAgICBjYWxlbmRhciA9ICdjYWxlbmRhcl9idXNpbmVzcyc7CgogICAgJHNjb3BlLmRlbGV0ZUNhbGVuZGFyREJFdmVudChzZWxlY3RlZEV2ZW50LCBjYWxlbmRhcik7CiAgfTsKICAkc2NvcGUuZGVsZXRlQ2FsZW5kYXJKU0V2ZW50ID0gZnVuY3Rpb24oY2FsZW5kYXIsIHNlbGVjdGVkRXZlbnRpZCkgewoKICAgIGxvZ0RlYnVnKCJjYWxlbmRhcl9ob3Vyc19vZl93b3JrX2NvbmZpZz0iICsgdWlDYWxlbmRhckNvbmZpZyk7CiAgICBsb2dEZWJ1ZygidWlDYWxlbmRhckNvbmZpZ1tjYWxlbmRhcl09IiArIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWydjYWxlbmRhcl9idXNpbmVzcyddKTsKICAgIGxvZ0RlYnVnKCJkZWxldGUganMgZXZlbnQgIiArIHNlbGVjdGVkRXZlbnRpZCk7CiAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZW1vdmVFdmVudHMnLCBbc2VsZWN0ZWRFdmVudGlkXSk7IC8vIGdvIHRvIGRhdGUgaW4gY2FsZW5kYXIgZ290bwogIH07CiAgJHNjb3BlLmRlbGV0ZUNhbGVuZGFyREJFdmVudCA9IGZ1bmN0aW9uKHNlbGVjdGVkRXZlbnQsIGNhbGVuZGFyKSB7CiAgICBsb2dEZWJ1ZygiZGVsZXRlIGV2ZW50ICIgKyBzZWxlY3RlZEV2ZW50LmlkKTsKICAgICRodHRwKHsKICAgICAgbWV0aG9kOiAnUE9TVCcsCiAgICAgIHVybDogJy9hcGkvYWRtaW4vZXZlbnRzL2RlbGV0ZS8nICsgc2VsZWN0ZWRFdmVudC5pZCwKICAgICAgZGF0YTogewogICAgICAgIHRlbXBfbGltaXRfaWQ6IHNlbGVjdGVkRXZlbnQudGVtcF9saW1pdF9pZAogICAgICB9LAogICAgICBoZWFkZXJzOiB7CiAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uO2NoYXJzZXQ9dXRmLTgnCiAgICAgIH0KICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkgewoKICAgICAgbG9nRGVidWcoZGF0YSk7CiAgICAgIGlmICghZGF0YS5zdWNjZXNzKSB7CiAgICAgICAgbG9nRGVidWcoImRlbGV0ZSBsaW1pdF9pZCBlcnJvciArIiArIGRhdGEubWVzc2FnZSk7Ci8vIGlmIG5vdCBzdWNjZXNzZnVsLCBiaW5kIGVycm9ycyB0byBlcnJvciB2YXJpYWJsZXMKLy8JCQkgICRzY29wZS5lcnJvck5hbWUgPSBkYXRhLmVycm9ycy5uYW1lOwovLwkJCSAgJHNjb3BlLmVycm9yU3VwZXJoZXJvID0gZGF0YS5lcnJvcnMuc3VwZXJoZXJvQWxpYXM7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbG9nRGVidWcoImRlbGV0ZSBsaW1pdF9pZCBzdWNjZXNzIik7Ci8vIGlmIHN1Y2Nlc3NmdWwsIGJpbmQgc3VjY2VzcyBtZXNzYWdlIHRvIG1lc3NhZ2UKLy8JCQkgICRzY29wZS5tZXNzYWdlID0gZGF0YS5tZXNzYWdlOwogICAgICAgICRzY29wZS5kZWxldGVDYWxlbmRhckpTRXZlbnQoY2FsZW5kYXIsIHNlbGVjdGVkRXZlbnQuaWQpOwoKICAgICAgfQogICAgfSk7CgogICAgbG9nRGVidWcoImFmdGVyIHJlbW92ZSBldmVudCIpOwogIH07Cn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdldmVudFJlY3VycmluZ0RldGFpbHNCdXNpbmVzc0NhbGVuZGFyTW9kYWxDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIHNlbGVjdGVkRXZlbnQsIHVpQ2FsZW5kYXJDb25maWcpIHsKICB2YXIgZGF5TmFtZXMgPSBbJ9eo15DXqdeV158nLCAn16nXoNeZJywgJ9ep15zXmdep15knLCAn16jXkdeZ16LXmScsICfXl9ee15nXqdeZJywgJ9ep15nXqdeZJywgJ9ep15HXqiddOwoKICAkc2NvcGUuZ290b0NsaWVudFBhZ2U9IGZ1bmN0aW9uIChidXNpbmVzc1VzZXJpZCkKICB7CiAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgICBnb3RvQ2xpZW50UGFnZShidXNpbmVzc1VzZXJpZCk7CiAgfQogICRzY29wZS5lZGl0RXZlbnQ9IGZ1bmN0aW9uICh0aGVldmVudCkKICB7CiAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgICBnb3RvRXZlbnRQYWdlKHRoZWV2ZW50KTsKICB9CgoKICBsb2dEZWJ1Zygic2VsZWN0ZWQgUmVjdXJyaW5nIEV2ZW50IGluZm8gPSIgKyBKU09OLnN0cmluZ2lmeShzZWxlY3RlZEV2ZW50LCBudWxsLCAyKSk7CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQgPSBzZWxlY3RlZEV2ZW50OwogIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc2VsZWN0ZWRFdmVudC5zdGFydCk7CiAgdmFyIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZSgpICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKCi8vIGxvZ0RlYnVnKCJzZWxlY3RlZEV2ZW50LnN0YXJ0PSIgKyBzZWxlY3RlZEV2ZW50LnN0YXJ0KTsKLy8gbG9nRGVidWcoImRhdGU9IiArIHNlbGVjdGVkRGF0ZVN0YXJ0KTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0SG91cnMoKTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBzZWxlY3RlZERhdGVTdGFydC5nZXRNaW51dGVzKCk7CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkb3cgPSBkYXlOYW1lc1tzZWxlY3RlZERhdGVTdGFydC5nZXREYXkoKV07CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXRlID0gc2VsZWN0ZWREYXRlU3RhcnQ7CgogICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0RGF5ID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RGF0ZSgpOwogICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0TW9udGggPSAxICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TW9udGgoKTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydE1vbnRoVHh0ID0gbW9udGhOYW1lc1skc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydE1vbnRoIC0gMV07CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRZZWFyID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RnVsbFllYXIoKTsKCiAgc2VsZWN0ZWREYXRlRW5kID0gbmV3IERhdGUoc2VsZWN0ZWRFdmVudC5lbmQpOwogIHZhciBzZWxlY3RlZERhdGVFbmQgPSBuZXcgRGF0ZShzZWxlY3RlZERhdGVFbmQuZ2V0VGltZSgpICsgc2VsZWN0ZWREYXRlRW5kLmdldFRpbWV6b25lT2Zmc2V0KCkgKiA2MDAwMCk7CgovLyBsb2dEZWJ1Zygic2VsZWN0ZWRFdmVudC5lbmQ9IiArIHNlbGVjdGVkRXZlbnQuZW5kKTsKLy8gbG9nRGVidWcoImRhdGU9IiArIHNlbGVjdGVkRGF0ZUVuZCk7CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMgPSBzZWxlY3RlZERhdGVFbmQuZ2V0SG91cnMoKTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRkb3cgPSBkYXlOYW1lc1tzZWxlY3RlZERhdGVFbmQuZ2V0RGF5KCldOwogICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKSA8IDEwID8gJzAnIDogJycpICsgc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKTsKICAkc2NvcGUub2tMaW1pdGF0aW9uTW9kYWwgPSBmdW5jdGlvbigpIHsKICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICB9OwoKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2V2ZW50RGV0YWlsc0hvdXJzT2ZXb3JrTW9kYWxDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIHNlbGVjdGVkRXZlbnQsIGZpeGVkU2NoZWR1bGUsIHVpQ2FsZW5kYXJDb25maWcpIHsKICB2YXIgZGF5TmFtZXMgPSBbJ9eo15DXqdeV158nLCAn16nXoNeZJywgJ9ep15zXmdep15knLCAn16jXkdeZ16LXmScsICfXl9ee15nXqdeZJywgJ9ep15nXqdeZJywgJ9ep15HXqiddOwoKLy8gbG9nRGVidWcoInNlbGVjdGVkIEV2ZW50ID0iICsgSlNPTi5zdHJpbmdpZnkoc2VsZWN0ZWRFdmVudCwgbnVsbCwgNCkpOwogICRzY29wZS5maXhlZFNjaGVkdWxlPWZpeGVkU2NoZWR1bGU7CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQgPSBzZWxlY3RlZEV2ZW50OwogICRzY29wZS5zZWxlY3RlZEV2ZW50Lm9yaWdfZXZlbnRfdHlwZXMgPSBhbmd1bGFyLmNvcHkoc2VsZWN0ZWRFdmVudC5ldmVudF90eXBlcyk7CiAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscyA9IFtdOwoKICBnZXRCdXNpbmVzc0xvY2F0aW9ucygkaHR0cCwkc2NvcGUsJ2J1c2luZXNzX2xvY2F0aW9ucycpOwoKICBsb2dEZWJ1ZygiaG91cnMgb2Ygd29yayBibG9jay9ldmVudCBjbGlja2VkICIrSlNPTi5zdHJpbmdpZnkoJHNjb3BlLnNlbGVjdGVkRXZlbnQpKTsKCiAgc2VsZWN0ZWREYXRlU3RhcnQgPSBuZXcgRGF0ZShzZWxlY3RlZEV2ZW50LnN0YXJ0KTsKICB2YXIgc2VsZWN0ZWREYXRlU3RhcnQgPSBuZXcgRGF0ZShzZWxlY3RlZERhdGVTdGFydC5nZXRUaW1lKCkgKyBzZWxlY3RlZERhdGVTdGFydC5nZXRUaW1lem9uZU9mZnNldCgpICogNjAwMDApOwogIGdldEFsbEluc3RydWN0b3JzKCRodHRwLCRzY29wZSwnaW5zdHJ1Y3RvcnMnKTsKICBnZXROb0NsYXNzRXZlbnRUeXBlc05vQWRtaW4oJGh0dHAsJHNjb3BlLCdyZWxhdGVkRXZlbnRUeXBlcycsZ2V0Tm9DbGFzc0V2ZW50VHlwZXNOb0FkbWluX3N1Y2Nlc3MpOwogIGZ1bmN0aW9uIGdldE5vQ2xhc3NFdmVudFR5cGVzTm9BZG1pbl9zdWNjZXNzKCkKICB7CiAgICBmb3IodmFyIGkgPSAwOyBpIDwgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRfdHlwZXMubGVuZ3RoOyBpKyspCiAgICB7Ci8vIGNvcHlpbmcgdGhlIGFjdHVhbCBvYmplY3Qgb2YgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRfdHlwZXNbaV0KICAgICAgZm9yKHZhciBqID0gMDsgaiA8ICRzY29wZS5yZWxhdGVkRXZlbnRUeXBlcy5sZW5ndGg7IGorKykKICAgICAgewogICAgICAgIGlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5ldmVudF90eXBlc1tpXS5ldmVudF90eXBlX2lkPT0kc2NvcGUucmVsYXRlZEV2ZW50VHlwZXNbal0uZXZlbnRfdHlwZV9pZCkKICAgICAgICB7CiAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5ldmVudF90eXBlc1tpXT1hbmd1bGFyLmNvcHkoJHNjb3BlLnJlbGF0ZWRFdmVudFR5cGVzW2pdKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CgovLyBsb2dEZWJ1Zygic2VsZWN0ZWRFdmVudC5zdGFydD0iICsgc2VsZWN0ZWRFdmVudC5zdGFydCk7Ci8vIGxvZ0RlYnVnKCJkYXRlPSIgKyBzZWxlY3RlZERhdGVTdGFydCk7CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycyA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldEhvdXJzKCk7CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzID0gKHNlbGVjdGVkRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKSA8IDEwID8gJzAnIDogJycpICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TWludXRlcygpOwogICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZG93ID0gZGF5TmFtZXNbc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RGF5KCldOwogICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF0ZSA9IHNlbGVjdGVkRGF0ZVN0YXJ0OwoKICBzZWxlY3RlZERhdGVFbmQgPSBuZXcgRGF0ZShzZWxlY3RlZEV2ZW50LmVuZCk7CiAgdmFyIHNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKHNlbGVjdGVkRGF0ZUVuZC5nZXRUaW1lKCkgKyBzZWxlY3RlZERhdGVFbmQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKCiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aCA9IG1vbnRoTmFtZXNbc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TW9udGgoKV07CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aDExMiA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldE1vbnRoKCkrMTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRheW9mbW9udGggPSBzZWxlY3RlZERhdGVTdGFydC5nZXREYXRlKCk7CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RnVsbFllYXIoKTsKLy8gJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5zdGFydF90aW1lX2lucHV0X2Zvcm1hdD0gbmV3IERhdGUoMTk3MCwgMCwgMSwgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycywgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzLCAwKTsKCi8vIGxvZ0RlYnVnKCJzZWxlY3RlZEV2ZW50LmVuZD0iICsgc2VsZWN0ZWRFdmVudC5lbmQpOwovLyBsb2dEZWJ1ZygiZGF0ZT0iICsgc2VsZWN0ZWREYXRlRW5kKTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycyA9IHNlbGVjdGVkRGF0ZUVuZC5nZXRIb3VycygpOwogICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGRvdyA9IGRheU5hbWVzW3NlbGVjdGVkRGF0ZUVuZC5nZXREYXkoKV07CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcyA9IChzZWxlY3RlZERhdGVFbmQuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBzZWxlY3RlZERhdGVFbmQuZ2V0TWludXRlcygpOwoKCiAgJHNjb3BlLm9rTGltaXRhdGlvbk1vZGFsID0gZnVuY3Rpb24oKSB7CiAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgfTsKCiAgJHNjb3BlLnVwZGF0ZUxpbWl0YXRpb25Nb2RhbCA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1ZygiZnVuY3Rpb246IHVwZGF0ZUxpbWl0YXRpb25Nb2RhbCIpOwogICAgaWYgKCRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50X3R5cGVzLmxlbmd0aDwxKQogICAgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBpZiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnM8JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykKICAgIHsKICAgICAgYWxlcnQoIteW157XnyDXodeZ15XXnSDXnNek16DXmSDXltee158g15TXqteX15zXlCIpOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBpZiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnM9PSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMpCiAgICB7CiAgICAgIGlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzPD0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpCiAgICAgIHsKICAgICAgICBhbGVydCgi15bXntefINeh15nXldedINec16TXoNeZINeW157XnyDXlNeq15fXnNeUIik7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIGlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzPCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMrMTApKQogICAgICB7CiAgICAgICAgYWxlcnQoIteR15zXldenINen15jXnyDXni0xMCDXk9en15XXqiIpOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfQoKCiAgICBmdW5jdGlvbiB1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25fc3VjY2VzcygpCiAgICB7CiAgICAgIGNhbGVuZGFyID0gJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnOwogICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZWZldGNoRXZlbnRzJyk7IC8vIGdvIHRvIGRhdGUgaW4gY2FsZW5kYXIgZ290bwogICAgICAkdWliTW9kYWxJbnN0YW5jZS5kaXNtaXNzKCdkZWxldGUnKTsKICAgIH0KCiAgICBpZiAoJHNjb3BlLmZpeGVkU2NoZWR1bGUpCiAgICB7Ci8vIGZpeGVkIHNjaGVkdWxlIC0gdXBhZHRpbmcgbGltaXRhdGlvbiAxOTcwCiAgICAgIHRoZWRhdGEgPSB7CiAgICAgICAgc3RhcnRfZGF0ZTogbmV3X3N0YXJ0LAogICAgICAgIGVuZF9kYXRlOiBuZXdfZW5kLAogICAgICAgIHRlbXBfbGltaXRfaWQ6IG51bGwsCiAgICAgICAgbGltaXRfaWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmxpbWl0X2lkLAogICAgICAgIGV2ZW50X3R5cGVzOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5ldmVudF90eXBlcywKICAgICAgICBsb2NhdGlvbl9pZDogJHNjb3BlLnNlbGVjdGVkRXZlbnQubG9jYXRpb25faWQsCiAgICAgICAgb3JpZ19ldmVudF90eXBlczogJHNjb3BlLnNlbGVjdGVkRXZlbnQub3JpZ19ldmVudF90eXBlcywKICAgICAgICBlbXBfaWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmVtcF9pZAogICAgICB9OwogICAgICB1cGRhdGVDYWxlbmRhckxpbWl0YXRpb24oJGh0dHAsJHNjb3BlLHRoZWRhdGEsJHNjb3BlLnNlbGVjdGVkRXZlbnQubGltaXRfaWQsIHVwZGF0ZUNhbGVuZGFyTGltaXRhdGlvbl9zdWNjZXNzKTsKICAgIH0KICAgIGVsc2UKLy8gbm90IGZpeGVkIHNjaGVkdWxlIC0gcGVyZGF5IGJsb2NrCiAgICB7Ci8vLy8vLy8vLy8vCiAgICAgIGlmICgoJHNjb3BlLnNlbGVjdGVkRXZlbnQubGltaXRfaWQgIT0gbnVsbCkgJiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZGF5X2xpbWl0X2lkID09IC0xKSkgLy8gZXZlbnQgbGltaXRhdGlvbiBoYXMgbGltaXRfaWQgc28gaXRzIGFuIDE5NzAgZXZlbnQKLy8gbmVlZCB0byBhZGQgYSBuZXcgcGVyZGF5IGxpbWl0YXRpb24gdGhhdCBwb2ludCAobGltaXRfaWQpIHRvIHRoZSBvbGQgMTk3MCBldmVudCB0byByZXBsYWN0ZSBpdAogICAgICB7CiAgICAgICAgdGVtcF9saW1pdF9pZCA9IGNhbGNfdGVtcF9saW1pdF9pZCgpOwovLyB0aGVldmVudC50ZW1wX2xpbWl0X2lkID0gdGVtcF9saW1pdF9pZDsKLy8gdGhlZXZlbnQuZGF5X2xpbWl0X2lkID0gdGVtcF9saW1pdF9pZDsKLy8gdGhlIG1vdmVkIGV2ZW50IGluIHRoZSBjYWxlbmRhciBub3cgaGFzIGRheV9saW1pdF9pZCBhbmQgdGVtcF9saW1pdF9pZAovLyBpZiBpdHMgbG9hZGVkIGZyb20gdGhlIGRiLCBpdCB3aWxsIG9ubHkgaGF2ZSBkYXlfbGltaXRfaWQgKGFuZCBub3QgdGhlIHRlbXAgb25lKQovLyB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1snY2FsZW5kYXJfaG91cnNfb2Zfd29yayddLmZ1bGxDYWxlbmRhcigndXBkYXRlRXZlbnQnLCB0aGVldmVudCk7Ci8vIGNvbnNvbGUubG9nKCJYWFhYWFhYWFhYWFhYIik7CiAgICAgICAgdGhlZGF0YSA9IHsKICAgICAgICAgIHN0YXJ0X2RhdGU6IG5ld19zdGFydCwKICAgICAgICAgIGVuZF9kYXRlOiBuZXdfZW5kLAogICAgICAgICAgY29sb3I6ICcnLAogICAgICAgICAgdGVtcF9saW1pdF9pZDogMCwKICAgICAgICAgIGV2ZW50X3R5cGVfaWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50X3R5cGVfaWQsCiAgICAgICAgICBldmVudF90eXBlczogJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRfdHlwZXMsCiAgICAgICAgICBsaW1pdF9pZDogJHNjb3BlLnNlbGVjdGVkRXZlbnQuaWQsCiAgICAgICAgICBsb2NhdGlvbl9pZDogJHNjb3BlLnNlbGVjdGVkRXZlbnQubG9jYXRpb25faWQsCiAgICAgICAgICBlbXBfaWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmVtcF9pZAovLyB0aXRsZTogdGhlZXZlbnQudGl0bGUKICAgICAgICB9OwogICAgICAgIGNyZWF0ZUNhbGVuZGFyTGltaXRhdGlvblBlckRheSgkaHR0cCwkc2NvcGUsdGhlZGF0YSx1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25fc3VjY2Vzcyk7CgogICAgICB9CiAgICAgIGVsc2UKICAgICAgewogICAgICAgIHRoZWRhdGE9IHsKICAgICAgICAgIHN0YXJ0X2RhdGU6IG5ld19zdGFydCwKICAgICAgICAgIGVuZF9kYXRlOiBuZXdfZW5kLAogICAgICAgICAgdGVtcF9kYXlfbGltaXRfaWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LnRlbXBfbGltaXRfaWQsCiAgICAgICAgICBvcmlnX2V2ZW50X3R5cGVzOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5vcmlnX2V2ZW50X3R5cGVzLAogICAgICAgICAgZXZlbnRfdHlwZXM6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50X3R5cGVzLAogICAgICAgICAgbG9jYXRpb25faWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmxvY2F0aW9uX2lkLAogICAgICAgICAgZGF5X2xpbWl0X2lkOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5kYXlfbGltaXRfaWQsCiAgICAgICAgICBlbXBfaWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmVtcF9pZAogICAgICAgIH07CiAgICAgICAgdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5KCRodHRwLCRzY29wZSx0aGVkYXRhLHVwZGF0ZUNhbGVuZGFyTGltaXRhdGlvbl9zdWNjZXNzKTsKICAgICAgfQogICAgfQogIH0KICAkc2NvcGUuZGVsZXRlTGltaXRhdGlvbk1vZGFsID0gZnVuY3Rpb24oKSB7CiAgICBjYWxlbmRhciA9ICdjYWxlbmRhcl9ob3Vyc19vZl93b3JrJzsKCi8vIHJlbW92aW5nIGxpbWl0YXRpb24gZnJvbSBkYXRhYmFzZSwgaWYgdHJ1ZSAtIHJlbW92aW5nIGZyb20gZGlzcGxheSBhbHNvCiAgICBpZiAoJHNjb3BlLmRlbGV0ZUNhbGVuZGFyREJMaW1pdGF0aW9uRXZlbnQoc2VsZWN0ZWRFdmVudCkpCiAgICB7Ci8vICRzY29wZS5kZWxldGVDYWxlbmRhckpTRXZlbnQoY2FsZW5kYXIsIHNlbGVjdGVkRXZlbnQuaWQpOwogICAgfQogICAgJHVpYk1vZGFsSW5zdGFuY2UuZGlzbWlzcygnZGVsZXRlJyk7CiAgfTsKICAkc2NvcGUuZGVsZXRlQ2FsZW5kYXJKU0V2ZW50ID0gZnVuY3Rpb24oY2FsZW5kYXIsIHNlbGVjdGVkRXZlbnRpZCkgewoKICAgIGxvZ0RlYnVnKCJjYWxlbmRhcl9ob3Vyc19vZl93b3JrX2NvbmZpZz0iICsgdWlDYWxlbmRhckNvbmZpZyk7CiAgICBsb2dEZWJ1ZygidWlDYWxlbmRhckNvbmZpZ1tjYWxlbmRhcl09IiArIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWydjYWxlbmRhcl9ob3Vyc19vZl93b3JrJ10pOwogICAgbG9nRGVidWcoImRlbGV0ZSBqcyBldmVudCAiICsgc2VsZWN0ZWRFdmVudGlkKTsKICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlbW92ZUV2ZW50cycsIFtzZWxlY3RlZEV2ZW50aWRdKTsgLy8gZ28gdG8gZGF0ZSBpbiBjYWxlbmRhciBnb3RvCiAgfTsKICAkc2NvcGUuZGVsZXRlQ2FsZW5kYXJEQkxpbWl0YXRpb25FdmVudCA9IGZ1bmN0aW9uKHNlbGVjdGVkRXZlbnQpIHsKICAgIGNhbGVuZGFyID0gJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnOwovLyByZXR1cm4gZmFsc2U7CgovLyBkZWxldGluZyBldmVudCBsaW1pdGF0aW9uIChub3QgcGVyIGRheSkKLy8gZWl0aGVyIGZyb20gMTk3MCAoaG91cnNfb2Zfd29yayBwYWdlKQovLyBvciBmcm9tIHRoZWlyIGluc3RhbmNlIGluIHRoZSBjdXJyZW50IHdlZWsncyBsaW1pdGF0aW9uLgovLyBlaXRoZXIgd2F5IGRheV9saW1pdF9pZCBpcyAtMSBmb3IgbGltaXRhdGlvbnMgZnJvbSAxOTcwCiAgICBpZiAoc2VsZWN0ZWRFdmVudC5kYXlfbGltaXRfaWQgPT0gLTEpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJyZW1vdmluZyBldmVudCBsaW1pdGF0aW9uLCBjaGVja2lnbiBpZiBpdHMgaW4gMTk3MCAodGhlIG9yaWdpbmFsKSBvciBhbiBpbnN0YW5jZSBpbiBwcmVzZW50Iik7CiAgICAgIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc2VsZWN0ZWRFdmVudC5zdGFydCk7Ci8vIGlmIGl0cyAxOTcwIHRoaXMgbWVhbnMgd2UncmUgaW4gdGhlIGhvdXJzX29mX3dvcmsgZ2VuZXJhbCBwYWdlCi8vIHNvIHdlIHNpbXBseSBkZWxldGUgaXQKICAgICAgaWYgKHNlbGVjdGVkRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCkgPT0gMTk3MCkKICAgICAgewogICAgICAgIGxvZ0RlYnVnKCJyZW1vdmluZyBldmVudCBsaW1pdGF0aW9uIGZyb20gMTk3MCIpOwogICAgICAgIHRoZWRhdGE9IHsKICAgICAgICAgIHRlbXBfbGltaXRfaWQ6IHNlbGVjdGVkRXZlbnQudGVtcF9saW1pdF9pZAogICAgICAgIH07CiAgICAgICAgZGVsZXRlQ2FsZW5kYXJMaW1pdGF0aW9uKCRodHRwLCRzY29wZSx0aGVkYXRhLHNlbGVjdGVkRXZlbnQubGltaXRfaWQsIGRlbGV0ZUNhbGVuZGFyTGltaXRhdGlvbl9zdWNjZXNzKTsKICAgICAgICBmdW5jdGlvbiBkZWxldGVDYWxlbmRhckxpbWl0YXRpb25fc3VjY2VzcygpCiAgICAgICAgewogICAgICAgICAgJHNjb3BlLmRlbGV0ZUNhbGVuZGFySlNFdmVudChjYWxlbmRhciwgc2VsZWN0ZWRFdmVudC5pZCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGVsc2UKICAgICAgewovLyByZW1vdmluZyBldmVudCBsaW1pdGF0aW9uIGZyb20gdGhlIGEgc3BlY2lmaWMgd2VlawovLyB0aGlzIG1lYW5zIGFkZGluZyBldmVudCBsaW1pdGF0aW9uIHBlciBkYXkgd2l0aCByYW5nZSBlbmQ9c3RhcnQKLy8gbWF5YmUgQlVHIEJVR0dZPwogICAgICAgIGxvZ0RlYnVnKCJ4IHJlbW92aW5nIGV2ZW50IGxpbWl0YXRpb24gZnJvbSBhIHNwZWNpZmljIHdlZWssIHRoaXMgbWVhbnMgYWRkaW5nIGV2ZW50IGxpbWl0YXRpb24gcGVyIGRheSB3aXRoIHJhbmdlIDAtMCIpOwovLyBsb2dEZWJ1ZyhKU09OLnN0cmluZ2lmeShzZWxlY3RlZEV2ZW50KSk7CgogICAgICAgIHRoZWRhdGEgPSB7CiAgICAgICAgICBzdGFydF9kYXRlOiBzZWxlY3RlZEV2ZW50LnN0YXJ0LAogICAgICAgICAgZW5kX2RhdGU6IHNlbGVjdGVkRXZlbnQuc3RhcnQsCiAgICAgICAgICBjb2xvcjogIiMwMDAwMDAiLAogICAgICAgICAgdGVtcF9saW1pdF9pZDogMSwKICAgICAgICAgIGV2ZW50X3R5cGVfaWQ6IHNlbGVjdGVkRXZlbnQuZXZlbnRfdHlwZV9pZCwKICAgICAgICAgIGxvY2F0aW9uX2lkOiBzZWxlY3RlZEV2ZW50LmxvY2F0aW9uX2lkLAogICAgICAgICAgbGltaXRfaWQ6IHNlbGVjdGVkRXZlbnQubGltaXRfaWQsCiAgICAgICAgICB0aXRsZTogc2VsZWN0ZWRFdmVudC50aXRsZQogICAgICAgIH07CgogICAgICAgIGNyZWF0ZUNhbGVuZGFyTGltaXRhdGlvblBlckRheSgkaHR0cCwkc2NvcGUsdGhlZGF0YSxjcmVhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXlfc3VjY2Vzcyk7CiAgICAgICAgZnVuY3Rpb24gY3JlYXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5X3N1Y2Nlc3MoKQogICAgICAgIHsKICAgICAgICAgICRzY29wZS5kZWxldGVDYWxlbmRhckpTRXZlbnQoY2FsZW5kYXIsIHNlbGVjdGVkRXZlbnQuaWQpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgZWxzZQogICAgewovLyBkZWxldGluZyBhIHBlcmRheSBsaW1pdGF0aW9uLgovLyBpZiBpdCdzIGEgcGVyZGF5IHRoYXQgInJlcGxhY2VkIiBhIDE5NzAgb25lCi8vIHRoZW4gd2UgY2Fubm90IGRlbGV0ZSBpdCAob3RoZXJ3aXNlIHRoZSBvcmlnaW5hbCAxOTcwIHdpbGwgcmVhcHBlYXIpCi8vIHNvIHdlIHNldCBpdCB0byBzdGFydD1lbmQKLy8gdGhpcyBtYXliZSBhIEJVRyBhbmQgY2F1c2UgVFJPVUJMRSAvLyBUT0RPCi8vIG90aGV3aXNlIHdlIGNhbiBkZWxldGUgaXQgLSB0aGUgcGVyZGF5IC0gYXMgaXRzIGEgbmV3IHBlcmRheSBhbmQgbm90ICJyZXBsYWNpbmciIGEgMTk3MCBvbmUKCiAgICAgIGlmIChzZWxlY3RlZEV2ZW50LmxpbWl0X2lkICE9IG51bGwpIC8vIHRoaXMgaXMgdGhlIHBlcmRheSB0aGF0IHJlcGxhY2VzIGEgMTk3MCBvbmUgLSB3ZSBzZXQgaXQgdG8gc3RhcnQ9ZW5kCiAgICAgIHsKICAgICAgICBsb2dEZWJ1ZygicmVtb3ZpbmcgZXZlbnQgbGltaXRhdGlvbiBwZXIgZGF5IHJlbGF0ZWQgdG8gMTk3MCAodXBkYXRpbmcgaXQgdG8gc3RhcnQ9ZW5kKSIpOwoKICAgICAgICB0aGVkYXRhPSB7CiAgICAgICAgICBzdGFydF9kYXRlOiBzZWxlY3RlZEV2ZW50LnN0YXJ0LAogICAgICAgICAgZW5kX2RhdGU6IHNlbGVjdGVkRXZlbnQuc3RhcnQsCiAgICAgICAgICB0ZW1wX2RheV9saW1pdF9pZDogc2VsZWN0ZWRFdmVudC50ZW1wX2xpbWl0X2lkLAogICAgICAgICAgZGF5X2xpbWl0X2lkOiBzZWxlY3RlZEV2ZW50LmRheV9saW1pdF9pZAogICAgICAgIH07CiAgICAgICAgdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5KCRodHRwLCRzY29wZSx0aGVkYXRhLHVwZGF0ZUNhbGVuZGFyTGltaXRhdGlvblBlckRheV9zdWNjZXMpOwoKICAgICAgICBmdW5jdGlvbiB1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXlfc3VjY2VzKCkKICAgICAgICB7CiAgICAgICAgICAkc2NvcGUuZGVsZXRlQ2FsZW5kYXJKU0V2ZW50KGNhbGVuZGFyLCBzZWxlY3RlZEV2ZW50LmlkKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZWxzZSAgLy8gdGhpcyBpcyB0aGUgY2FzZSB3aGVyZSB0aGUgcGVyZGF5IGRvZXNudCByZXBsYWNlIGEgMTk3MCBvbmUsIHdlIGNhbiBzaW1wbHkgZGVsZXRlIGl0CiAgICAgIHsKICAgICAgICBsb2dEZWJ1ZygicmVtb3ZpbmcgZXZlbnQgbGltaXRhdGlvbiBwZXIgZGF5IHJlbGF0ZWQgbm90IHJlbGF0ZWQgdG8gMTk3MCAoc28gd2UncmUgZGVsZXRpbmcgaXQpIik7CiAgICAgICAgdGhlZGF0YSA9IHsKICAgICAgICAgIHRlbXBfbGltaXRfaWQ6IHNlbGVjdGVkRXZlbnQudGVtcF9saW1pdF9pZAogICAgICAgIH07CiAgICAgICAgZGVsZXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5KCRodHRwLCRzY29wZSx0aGVkYXRhLHNlbGVjdGVkRXZlbnQuZGF5X2xpbWl0X2lkLCBkZWxldGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXlfc3VjY2Vzcyk7CiAgICAgICAgZnVuY3Rpb24gZGVsZXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5X3N1Y2Nlc3MoKQogICAgICAgIHsKICAgICAgICAgICRzY29wZS5kZWxldGVDYWxlbmRhckpTRXZlbnQoY2FsZW5kYXIsIHNlbGVjdGVkRXZlbnQuaWQpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgbG9nRGVidWcoImFmdGVyIHJlbW92ZSBldmVudCIpOwoKICB9OwoKCiAgJHNjb3BlLnN0YXJ0TWludXRlcyA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1Zygic3RhcnRNaW51dGVzICIrKCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcykpOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzPW1pbnV0ZXNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcyk7CiAgICBjYWxjdWxhdGVTdGFydFRpbWUoKTsKICB9CiAgJHNjb3BlLnN0YXJ0SG91cnMgPSBmdW5jdGlvbigpCiAgewogICAgbG9nRGVidWcoInN0YXJ0SG91cnMgIitob3Vyc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykpOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3Vycz1ob3Vyc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3Vycyk7CiAgICBjYWxjdWxhdGVTdGFydFRpbWUoKTsKICB9CiAgJHNjb3BlLmVuZE1pbnV0ZXMgPSBmdW5jdGlvbigpCiAgewogICAgbG9nRGVidWcoImVuZE1pbnV0ZXMgIisoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcykpOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcz1taW51dGVzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzKTsKICAgIGNhbGN1bGF0ZUVuZFRpbWUoKTsKICB9CiAgJHNjb3BlLmVuZEhvdXJzID0gZnVuY3Rpb24oKQogIHsKICAgIGxvZ0RlYnVnKCJlbmRIb3VycyAiK2hvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycykpOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnM9aG91cnNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzKTsKICAgIGNhbGN1bGF0ZUVuZFRpbWUoKTsKICB9CgoKICBmdW5jdGlvbiBjYWxjdWxhdGVTdGFydFRpbWUoKQogIHsKICAgIGV2ZW50WWVhcj0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXI7CiAgICBldmVudE1vbnRoPSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bW9udGgxMTI7CiAgICBldmVudERheT0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRheW9mbW9udGg7CiAgICBpZiAocGFyc2VJbnQoZXZlbnRNb250aCk8MTApCiAgICB7CiAgICAgIGV2ZW50TW9udGg9IjAiK2V2ZW50TW9udGg7CiAgICB9CiAgICBpZiAocGFyc2VJbnQoZXZlbnREYXkpPDEwKQogICAgewogICAgICBldmVudERheT0iMCIrZXZlbnREYXk7CiAgICB9CgogICAgbmV3X3N0YXJ0PW1vbWVudC51dGMoZXZlbnRZZWFyKyItIitldmVudE1vbnRoKyItIitldmVudERheSsiVDAwOjAwOjAwIikuYWRkKCgocGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykqNjApK3BhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcykpLCAnbWludXRlcycpOwogICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5zdGFydF90aW1lPW5ld19zdGFydDsKICAgIGxvZ0RlYnVnKCJuZXdfc3RhcnQ9IituZXdfc3RhcnQpOwogIH0KICBmdW5jdGlvbiBjYWxjdWxhdGVFbmRUaW1lKCkKICB7CiAgICBldmVudFllYXI9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyOwogICAgZXZlbnRNb250aD0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoMTEyOwogICAgZXZlbnREYXk9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXlvZm1vbnRoOwogICAgaWYgKHBhcnNlSW50KGV2ZW50TW9udGgpPDEwKQogICAgewogICAgICBldmVudE1vbnRoPSIwIitldmVudE1vbnRoOwogICAgfQogICAgaWYgKHBhcnNlSW50KGV2ZW50RGF5KTwxMCkKICAgIHsKICAgICAgZXZlbnREYXk9IjAiK2V2ZW50RGF5OwogICAgfQoKICAgIG5ld19lbmQ9bW9tZW50LnV0YyhldmVudFllYXIrIi0iK2V2ZW50TW9udGgrIi0iK2V2ZW50RGF5KyJUMDA6MDA6MDAiKS5hZGQoKChwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycykqNjApK3BhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpKSwgJ21pbnV0ZXMnKTsKICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kX3RpbWU9bmV3X2VuZDsKICAgIGxvZ0RlYnVnKCJuZXdfZW5kPSIrbmV3X2VuZCk7CiAgfQoKICBjYWxjdWxhdGVTdGFydFRpbWUoKTsKICBjYWxjdWxhdGVFbmRUaW1lKCk7CgogIGZ1bmN0aW9uIG1pbnV0ZXNDaGFuZ2VkKHRoZW1pbnV0ZXMpCiAgewogICAgbG9nRGVidWcoInRoZW1pbnV0ZXM9Iit0aGVtaW51dGVzKTsKICAgIGlmICh0eXBlb2YgdGhlbWludXRlcz09InVuZGVmaW5lZCIpCiAgICB7CiAgICAgIHJldHVybiAiMDAiOwogICAgfQogICAgdGhlbWludXRlcz1wYXJzZUludCh0aGVtaW51dGVzKTsKICAgIGlmICh0aGVtaW51dGVzPjYwKQogICAgewogICAgICByZXR1cm4gIjAwIjsKICAgIH0KICAgIGVsc2UgaWYgKHRoZW1pbnV0ZXM8MCkKICAgIHsKICAgICAgcmV0dXJuICIwMCI7CiAgICB9CiAgICBlbHNlIGlmICh0aGVtaW51dGVzPT0iIikKICAgIHsKICAgICAgcmV0dXJuICIwMCI7CiAgICB9CiAgICBlbHNlIGlmICh0aGVtaW51dGVzPDEwKQogICAgewogICAgICByZXR1cm4gIjAiK3RoZW1pbnV0ZXM7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgIHJldHVybiB0aGVtaW51dGVzOwogICAgfQogIH0KICBmdW5jdGlvbiBob3Vyc0NoYW5nZWQodGhlaG91cnMpCiAgewogICAgbG9nRGVidWcoInRoZWhvdXJzPSIrdGhlaG91cnMpOwogICAgaWYgKHR5cGVvZiB0aGVob3Vycz09InVuZGVmaW5lZCIpCiAgICB7CiAgICAgIHJldHVybiAiMCI7CiAgICB9CiAgICB0aGVob3Vycz1wYXJzZUludCh0aGVob3Vycyk7CiAgICBpZiAodGhlaG91cnM+MjQpCiAgICB7CiAgICAgIHJldHVybiAwOwogICAgfQogICAgZWxzZSBpZiAodGhlaG91cnM8MCkKICAgIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CiAgICBlbHNlIGlmICh0aGVob3Vycz09IiIpCiAgICB7CiAgICAgIHJldHVybiAiMCI7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgIHJldHVybiB0aGVob3VyczsKICAgIH0KICB9Cgp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ0V2ZW50VHlwZXNDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGNvbXBpbGUsIHVpQ2FsZW5kYXJDb25maWcsICR1aWJNb2RhbCwkbG9jYXRpb24pIHsKICBsb2dEZWJ1ZygnRXZlbnRUeXBlcyBDb250cm9sbGVyJyk7CgogIGdldEFsbEJ1c2luZXNzRXZlbnRUeXBlcygkaHR0cCwkc2NvcGUsJ2V2ZW50X3R5cGVzJyk7CiAgJHNjb3BlLnNob3dFdmVudFR5cGUgPSBmdW5jdGlvbiAodGhlRXZlbnQpCiAgewogICAgJGxvY2F0aW9uLnBhdGgoJy9ldmVudF90eXBlcy8nK3RoZUV2ZW50LmV2ZW50X3R5cGVfaWQpOwogIH0KfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ0V2ZW50VHlwZU5ld0NvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkY29tcGlsZSwgdWlDYWxlbmRhckNvbmZpZywgJHVpYk1vZGFsLCAkbG9jYXRpb24pIHsKICBsb2dEZWJ1ZygnRXZlbnRUeXBlcyBDb250cm9sbGVyIE5ldycpOwoKICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcyA9IHt9OyAvLyB0aGVzZSBhcmUgdGhlIGNvbXBsZXRlIGRldGFpbHMgZm9yIHRoZSBuZXcgZXZlbnQgLy8KICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5pc19jbGFzcyA9IDA7CiAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuYmxvY2tFeHRyYVRpbWUgPSBmYWxzZTsKICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5kdXJhdGlvbl9iZWZvcmVfZXZlbnQgPSAwOwogICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmR1cmF0aW9uX2FmdGVyX2V2ZW50ID0gMDsKICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5pbmhlcml0X21haW5faG91cnMgPSAxOwogICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF93YWl0aW5nX2xpc3QgPSAzOwogICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmlzX3VwZGF0ZSA9IGZhbHNlOwogICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF9wYXJ0aWNpcGFudHMgPSAxOwogICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF9yZWdpc3RyYXRpb25zPTE7CiAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuaXNfcHVibGljPTE7CiAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuaW5zdHJ1Y3Rvcl9pZD0wOwoKICAkc2NvcGUuZXZlbnRDb2xvclN0eWxlID0ge307CiAgZGVmYXVsdENvbG9yID0gJzAwYTY1YSc7CiAgJHNjb3BlLmV2ZW50Q29sb3JTdHlsZVtkZWZhdWx0Q29sb3JdID0gewogICAgJ3RyYW5zZm9ybSc6ICdyb3RhdGUoMzBkZWcpJwogIH07CiAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXZlbnRDb2xvciA9ICIjIiArIGRlZmF1bHRDb2xvcjsKICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyA9IFsKICAgIHsiZmllbGRfbmFtZSI6Iteh15nXm9eV150g157XpNeS16kiLCJmaWVsZF9kYXRhdHlwZSI6IlRFWFRfQVJFQSIsImlzX21hbmRhdG9yeSI6MCwgImZyb21kYiI6IGZhbHNlLCAiZGJfaWRfdG9maXgiOiAwLCAiaXNfYWN0aXZlIjogMSwgIm1vZGlmaWVkIjogZmFsc2V9LAogICAgeyJmaWVsZF9uYW1lIjoi16nXmdei15XXqNeZINeR15nXqiIsImZpZWxkX2RhdGF0eXBlIjoiVEVYVF9BUkVBIiwiaXNfbWFuZGF0b3J5IjowLCAiZnJvbWRiIjogZmFsc2UsICJkYl9pZF90b2ZpeCI6IDAsICJpc19hY3RpdmUiOiAxLCAibW9kaWZpZWQiOiBmYWxzZX0KICBdOwoKICBnZXRBbGxJbnN0cnVjdG9ycygkaHR0cCwkc2NvcGUsJ2luc3RydWN0b3JzJyxnZXRBbGxJbnN0cnVjdG9yc19zdWNjZXNzKTsKICBmdW5jdGlvbiBnZXRBbGxJbnN0cnVjdG9yc19zdWNjZXNzKCkKICB7Ci8vICRzY29wZS5pbnN0cnVjdG9ycy51bnNoaWZ0KHtidXNpbmVzc191c2VyX2lkOjAsIGJ1c2VyX2ZpcnN0X25hbWU6IiIsIGJ1c2VyX2xhc3RfbmFtZToiIn0pOwogICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuaW5zdHJ1Y3Rvcl9pZD0kc2NvcGUuaW5zdHJ1Y3RvcnNbMF0uYnVzaW5lc3NfdXNlcl9pZDsKICB9CgogICRzY29wZS5ldmVudFR5cGVFeHRyYUZpZWxkc1BvcCA9IGZ1bmN0aW9uKGV2ZW50VHlwZVByb3BlcnRpZXMpIHsKICAgIGxvZ0RlYnVnKCJldmVudFR5cGVFeHRyYUZpZWxkc1BvcDEiKTsKCiAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAgICAgYW5pbWF0aW9uOiBmYWxzZSwKICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfZXZlbnRfdHlwZV9leHRyYV9maWVsZHMucGhwJywKICAgICAgY29udHJvbGxlcjogJ2V2ZW50VHlwZUV4dHJhRmllbGRzTW9kYWxDb250cm9sbGVyJywKICAgICAgc2l6ZTogJ2wnLAogICAgICByZXNvbHZlOiB7CiAgICAgICAgZXZlbnRUeXBlUHJvcGVydGllczogZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gZXZlbnRUeXBlUHJvcGVydGllczsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwoKICAgIG1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24oc2VsZWN0ZWRJdGVtKSB7CiAgICAgIGxvZ0RlYnVnKHNlbGVjdGVkSXRlbSk7CiAgICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzID0gc2VsZWN0ZWRJdGVtOwogICAgfSwgZnVuY3Rpb24oKSB7CiAgICAgIGxvZ0RlYnVnKCdNb2RhbCBkaXNtaXNzZWQgYXQ6ICcgKyBuZXcgRGF0ZSgpKTsKICAgIH0pOwogIH07CgogICRzY29wZS5jaGFuZ2VFdmVudENvbG9yID0gZnVuY3Rpb24obmV3Q29sb3IpIHsKICAgIGxvZ0RlYnVnKCJjaG9vc2luZyBjb2xvciAiICsgbmV3Q29sb3IpOwogICAgJHNjb3BlLmV2ZW50Q29sb3IgPSBuZXdDb2xvcjsKICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV2ZW50Q29sb3IgPSAiIyIgKyBuZXdDb2xvcjsKICAgICRzY29wZS5ldmVudENvbG9yU3R5bGUgPSB7CiAgICAgICdiYWNrZ3JvdW5kLWNvbG9yJzogIiMiICsgbmV3Q29sb3IKICAgIH07CiAgICAkc2NvcGUuZXZlbnRDb2xvclN0eWxlW25ld0NvbG9yXSA9IHsKICAgICAgJ3RyYW5zZm9ybSc6ICdyb3RhdGUoMzBkZWcpJwogICAgfTsKCiAgfQoKICAkc2NvcGUuYWRkRXZlbnRUeXBlQ2FuY2VsID0gZnVuY3Rpb24oKSB7CiAgICAkbG9jYXRpb24ucGF0aCgnL2V2ZW50X3R5cGVzJyk7CiAgfTsKCiAgJHNjb3BlLmR1cGxpY2F0ZUZpZWxkTmFtZXM9IiI7CiAgJHNjb3BlLmFkZEV2ZW50VHlwZSA9IGZ1bmN0aW9uKCkgewogICAgLy8gY2hlY2sgZXh0cmEgZmllbGRzIGR1cGxpY2F0ZSBuYW1lcyAtIHN0YXJ0CiAgICBsb2dEZWJ1ZygiYWRkRXZlbnRUeXBlOiBjaGVjayBleHRyYSBmaWVsZHMgZHVwbGljYXRlIG5hbWVzIC0gc3RhcnQiKTsKICAgIHZhciBleHRyYUZpZWxkc05hbWVzID0gW107CiAgICBmb3IgKHZhciBpPTE7IGk8JHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMubGVuZ3RoOyBpKyspCiAgICB7CiAgICAgIGV4dHJhRmllbGRzTmFtZXMucHVzaCgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkc1tpXS5maWVsZF9uYW1lKTsKICAgIH0KICAgIGV4dHJhRmllbGRzTmFtZXMuc29ydCgpOwogICAgdmFyIGxhc3QgPSBleHRyYUZpZWxkc05hbWVzWzBdOwogICAgZm9yICh2YXIgaT0xOyBpPGV4dHJhRmllbGRzTmFtZXMubGVuZ3RoOyBpKyspCiAgICB7CiAgICAgIGlmIChleHRyYUZpZWxkc05hbWVzW2ldID09IGxhc3QpCiAgICAgIHsKICAgICAgICAvLyAgYWxlcnQoJ0R1cGxpY2F0ZSA6ICcrbGFzdCk7CiAgICAgICAgJHNjb3BlLmR1cGxpY2F0ZUZpZWxkTmFtZXM9J9en15nXmdedINep15PXlCDXqteZ16LXldeTINeo16TXldeQ15kg15vXpNeV15wg15HXqdedICInK2xhc3QrJyIuLi4nOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBsYXN0ID0gZXh0cmFGaWVsZHNOYW1lc1tpXTsKICAgIH0KICAgIC8vIGNoZWNrIGV4dHJhIGZpZWxkcyBkdXBsaWNhdGUgbmFtZXMgLSBlbmQKCiAgICBsb2dEZWJ1ZygiYWRkIEV2ZW50IFR5cGUiICsgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMgKyAiZXh0cmEgZmllbGRzPSIgKyRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzKTsKICAgIGlmICgoJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMubWF4X3JlZ2lzdHJhdGlvbnM9PScnKSB8fCAoISRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF9yZWdpc3RyYXRpb25zKSkKICAgIHsKICAgICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMubWF4X3JlZ2lzdHJhdGlvbnM9MDsKICAgIH0KICAgIGFkZEV2ZW50VHlwZSgkaHR0cCwkc2NvcGUsJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMsYWRkRXZlbnRUeXBlX3N1Y2Nlc3MpOwogICAgZnVuY3Rpb24gYWRkRXZlbnRUeXBlX3N1Y2Nlc3MoKQogICAgewogICAgICAkbG9jYXRpb24ucGF0aCgnL2V2ZW50X3R5cGVzJyk7CiAgICB9CiAgfTsKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ0V2ZW50VHlwZVVwZGF0ZUNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkY29tcGlsZSwgJHJvdXRlUGFyYW1zLCB1aUNhbGVuZGFyQ29uZmlnLCAkdWliTW9kYWwsICRsb2NhdGlvbikgewogIGV2ZW50X3R5cGVfaWQ9JHJvdXRlUGFyYW1zLmV2ZW50X3R5cGVfaWQ7CiAgbG9nRGVidWcoJ0V2ZW50VHlwZXMgQ29udHJvbGxlciBVcGRhdGUgJytldmVudF90eXBlX2lkKTsKCiAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMgPSB7fTsgLy8gdGhlc2UgYXJlIHRoZSBjb21wbGV0ZSBkZXRhaWxzIGZvciB0aGUgbmV3IGV2ZW50IC8vCiAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuaXNfdXBkYXRlID0gdHJ1ZTsKCiAgJHNjb3BlLmV2ZW50Q29sb3JTdHlsZSA9IHt9OwogIGdldEFsbEluc3RydWN0b3JzKCRodHRwLCRzY29wZSwnaW5zdHJ1Y3RvcnMnLGdldEFsbEluc3RydWN0b3JzX3N1Y2Nlc3MpOwogIGZ1bmN0aW9uIGdldEFsbEluc3RydWN0b3JzX3N1Y2Nlc3MoKQogIHsKICAgICRzY29wZS5pbnN0cnVjdG9ycy51bnNoaWZ0KHtidXNpbmVzc191c2VyX2lkOm51bGwsIGJ1c2VyX2ZpcnN0X25hbWU6IiIsIGJ1c2VyX2xhc3RfbmFtZToiIn0pOwogIH0KCiAgZ2V0QnVzaW5lc3NFdmVudFR5cGUoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5ldmVudF90eXBlX2lkLCdldmVudFR5cGVQcm9wZXJ0aWVzJyxnZXRCdXNpbmVzc0V2ZW50VHlwZV9zdWNjZXNzKTsKCiAgZnVuY3Rpb24gZ2V0QnVzaW5lc3NFdmVudFR5cGVfc3VjY2VzcygpCiAgewogICAgaWYgKCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF9yZWdpc3RyYXRpb25zPT1udWxsKQogICAgewogICAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5tYXhfcmVnaXN0cmF0aW9ucz0xOwogICAgfQogICAgaWYgKCgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5kdXJhdGlvbl9iZWZvcmVfZXZlbnQ+MCkgfCAoJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZHVyYXRpb25fYWZ0ZXJfZXZlbnQ+MCkpCiAgICB7CiAgICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmJsb2NrRXh0cmFUaW1lID0gMTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuYmxvY2tFeHRyYVRpbWUgPSAwOwogICAgfQovLyAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5pbmhlcml0X21haW5faG91cnMgPSByZXNwb25zZS5kYXRhWzBdLmluaGVyaXRfbWFpbl9ob3VyczsKICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmlzX3VwZGF0ZSA9IHRydWU7CiAgICBsb2dEZWJ1ZygiJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuY29sb3I9Iiskc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5jb2xvcik7CiAgICAkc2NvcGUuZXZlbnRDb2xvclN0eWxlWyRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmNvbG9yXSA9IHsKICAgICAgJ3RyYW5zZm9ybSc6ICdyb3RhdGUoMzBkZWcpJwogICAgfTsKICAgICRzY29wZS5jaGFuZ2VFdmVudENvbG9yKCgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5jb2xvcikuc3Vic3RyKDEpKTsKICAgIGxvZ0RlYnVnKCIkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5pbnN0cnVjdG9yX2lkPSIrJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuaW5zdHJ1Y3Rvcl9pZCk7Ci8vIHNhdmluZyBldmVudCB0eXBlIGRldGFpbHMgYXNpZGUgdG8gbGF0ZXIgY2hlY2sgaWYgYW55dGhpbmcgY2hhbmdlZAogICAgbG9nRGVidWcoImR1cGxpY2F0aW5nIG9iamVjdCBvZiBldmVudCB0eXBlIHRvIGxhdGVyIGNvbXBhcmUgIit0eXBlb2YgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMpOwogICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXNEdXBsaWNhdGUgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzKSk7CiAgICBsb2dEZWJ1ZygiJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXNEdXBsaWNhdGUgPSIrJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXNEdXBsaWNhdGUuZXZlbnRfdHlwZV9uYW1lKTsKICB9OwoKLy8gZXZlbnQgdHlwZSBjaGFuZ2VkIHBvcHVwCiAgJHNjb3BlLmV2ZW50VHlwZUNoYW5nZWRQb3B1cCA9IGZ1bmN0aW9uKGV2ZW50VHlwZVByb3BlcnRpZXMpIHsKICAgIGxvZ0RlYnVnKCJldmVudFR5cGVDaGFuZ2VkUG9wdXAiKTsKCiAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAgICAgYW5pbWF0aW9uOiBmYWxzZSwKICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfZXZlbnRfdHlwZV9jaGFuZ2VkLnBocCcsCiAgICAgIGNvbnRyb2xsZXI6ICdldmVudFR5cGVDaGFuZ2VkUG9wdXBDb250cm9sbGVyJywKICAgICAgc2l6ZTogJ2wnLAogICAgICByZXNvbHZlOiB7CiAgICAgICAgZXZlbnRUeXBlUHJvcGVydGllczogZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXM7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKCiAgICBtb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHNlbGVjdGVkSXRlbSkKICAgIHsKICAgICAgbG9nRGVidWcoc2VsZWN0ZWRJdGVtKTsKICAgICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMgPSBzZWxlY3RlZEl0ZW07CiAgICB9LCBmdW5jdGlvbigpIHsKICAgICAgbG9nRGVidWcoJ01vZGFsIGRpc21pc3NlZCBhdDogJyArIG5ldyBEYXRlKCkpOwogICAgfSk7CiAgfTsKCi8vIGV2ZW50IHR5cGUgZXh0cmEgZmllbGQgcG9wdXAKICAkc2NvcGUuZXZlbnRUeXBlRXh0cmFGaWVsZHNQb3AgPSBmdW5jdGlvbihldmVudFR5cGVQcm9wZXJ0aWVzKSB7CiAgICBsb2dEZWJ1ZygiZXZlbnRUeXBlRXh0cmFGaWVsZHNQb3AyIik7CgogICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2V2ZW50X3R5cGVfZXh0cmFfZmllbGRzLnBocCcsCiAgICAgIGNvbnRyb2xsZXI6ICdldmVudFR5cGVFeHRyYUZpZWxkc01vZGFsQ29udHJvbGxlcicsCiAgICAgIHNpemU6ICdsJywKICAgICAgcmVzb2x2ZTogewogICAgICAgIGV2ZW50VHlwZVByb3BlcnRpZXM6IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIGV2ZW50VHlwZVByb3BlcnRpZXM7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKCiAgICBtb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHNlbGVjdGVkSXRlbSkgewogICAgICBsb2dEZWJ1ZyhzZWxlY3RlZEl0ZW0pOwogICAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyA9IHNlbGVjdGVkSXRlbTsKICAgIH0sIGZ1bmN0aW9uKCkgewogICAgICBsb2dEZWJ1ZygnTW9kYWwgZGlzbWlzc2VkIGF0OiAnICsgbmV3IERhdGUoKSk7CiAgICB9KTsKICB9OwoKCiAgJHNjb3BlLmNoYW5nZUV2ZW50Q29sb3IgPSBmdW5jdGlvbihuZXdDb2xvcikgewogICAgbG9nRGVidWcoImNob29zaW5nIGNvbG9yICIgKyBuZXdDb2xvcik7CiAgICAkc2NvcGUuZXZlbnRDb2xvciA9IG5ld0NvbG9yOwogICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXZlbnRDb2xvciA9ICIjIiArIG5ld0NvbG9yOwogICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuY29sb3IgPSAiIyIgKyBuZXdDb2xvcjsKICAgICRzY29wZS5ldmVudENvbG9yU3R5bGUgPSB7CiAgICAgICdiYWNrZ3JvdW5kLWNvbG9yJzogIiMiICsgbmV3Q29sb3IKICAgIH07CiAgICAkc2NvcGUuZXZlbnRDb2xvclN0eWxlW25ld0NvbG9yXSA9IHsKICAgICAgJ3RyYW5zZm9ybSc6ICdyb3RhdGUoMzBkZWcpJwogICAgfTsKCiAgfQoKICAkc2NvcGUuYWRkRXZlbnRUeXBlQ2FuY2VsID0gZnVuY3Rpb24oKSB7CiAgICAkbG9jYXRpb24ucGF0aCgnL2V2ZW50X3R5cGVzJyk7CiAgfTsKCiAgJHNjb3BlLmFkZEV2ZW50VHlwZSA9IGZ1bmN0aW9uKCkgeyAvLyB0aGlzIGZ1bmN0aW9uIFVQREFURVMgZXZlbnQgdHlwZSAobm90IGFkZHMpCi8vIGNoZWNraW5nIGlmIGFueXRoaW5nIGNoYW5nZWQgcmVhbGx5Ci8vIGFuZCBhc2tpbmcgaWYgd2Ugc2hvdWxkIHVwZGF0ZSBhbGwgZXZlbnRzIGZyb20gbm93IChvciBvbmx5IG5ld2x5IGNyZWF0ZWQgZXZlbnRzKQovLyBjaGVja2luZwogICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXNEdXBsaWNhdGUuZXh0cmFGaWVsZHM9JHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHM7CiAgICAvLyBpZiAoYW5ndWxhci5lcXVhbHMoJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXNEdXBsaWNhdGUsJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMpKQogICAgaWYgKHRydWUpIC8vIGlnbm9yaW5nIHRyeWluZyB0byBtYWtlIGNoYW5nZXMgdG8gZXZlbnRzCiAgICB7Ci8vICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzRHVwbGljYXRlLmV4dHJhRmllbGRzID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcykpOwoKICAgICAgbG9nRGVidWcoIm5vdGhpbmcgY2hhbmdlZCBpbiBldmVudCB0eXBlLCBvciBvbmx5IGV4dHJhIGZpZWxkcyIpOwogICAgICAkc2NvcGUudXBkYXRlRXZlbnRUeXBlKCk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJldmVudCB0eXBlIGNoYW5nZWQiKTsKICAgICAgJHNjb3BlLmV2ZW50VHlwZUNoYW5nZWRQb3B1cCgpOwogICAgfQovLyAkc2NvcGUudXBkYXRlRXZlbnRUeXBlKCk7CiAgfQogICRzY29wZS51cGRhdGVFdmVudFR5cGUgPSBmdW5jdGlvbigpCiAgewogICAgLy8gY2hlY2sgZXh0cmEgZmllbGRzIGR1cGxpY2F0ZSBuYW1lcyAtIHN0YXJ0CiAgICBsb2dEZWJ1ZygiYWRkRXZlbnRUeXBlOiBjaGVjayBleHRyYSBmaWVsZHMgZHVwbGljYXRlIG5hbWVzIC0gc3RhcnQiKTsKICAgIHZhciBleHRyYUZpZWxkc05hbWVzID0gW107CiAgICBmb3IgKHZhciBpPTE7IGk8JHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMubGVuZ3RoOyBpKyspCiAgICB7CiAgICAgIGV4dHJhRmllbGRzTmFtZXMucHVzaCgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkc1tpXS5maWVsZF9uYW1lKTsKICAgIH0KICAgIGV4dHJhRmllbGRzTmFtZXMuc29ydCgpOwogICAgdmFyIGxhc3QgPSBleHRyYUZpZWxkc05hbWVzWzBdOwogICAgZm9yICh2YXIgaT0xOyBpPGV4dHJhRmllbGRzTmFtZXMubGVuZ3RoOyBpKyspCiAgICB7CiAgICAgIGlmIChleHRyYUZpZWxkc05hbWVzW2ldID09IGxhc3QpCiAgICAgIHsKICAgICAgICAvLyAgYWxlcnQoJ0R1cGxpY2F0ZSA6ICcrbGFzdCk7CiAgICAgICAgbG9nRGVidWcoJ9en15nXmdedINep15PXlCDXqteZ16LXldeTINeo16TXldeQ15kg15vXpNeV15wg15HXqdedICInK2xhc3QrJyIuLi4nKTsKICAgICAgICAkc2NvcGUuZHVwbGljYXRlRmllbGROYW1lcz0n16fXmdeZ150g16nXk9eUINeq15nXoteV15Mg16jXpNeV15DXmSDXm9ek15XXnCDXkdep150gIicrbGFzdCsnIi4uLic7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGxhc3QgPSBleHRyYUZpZWxkc05hbWVzW2ldOwogICAgfQogICAgLy8gY2hlY2sgZXh0cmEgZmllbGRzIGR1cGxpY2F0ZSBuYW1lcyAtIGVuZAoKICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLnVwZGF0ZV9leGlzdGluZ19ldmVudHM9ZmFsc2U7CgogICAgbG9nRGVidWcoInVwZGF0ZUV2ZW50VHlwZTogdXBkYXRlIEV2ZW50IFR5cGUgIiArICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV2ZW50X3R5cGVfaWQpOwogICAgaWYgKCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF9yZWdpc3RyYXRpb25zPT0nJykKICAgIHsKICAgICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMubWF4X3JlZ2lzdHJhdGlvbnM9MDsKICAgIH0KICAgIHVwZGF0ZUV2ZW50VHlwZSgkaHR0cCwkc2NvcGUsJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXZlbnRfdHlwZV9pZCwkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcyx1cGRhdGVFdmVudFR5cGVfc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiB1cGRhdGVFdmVudFR5cGVfc3VjY2VzcygpCiAgICB7CiAgICAgICRsb2NhdGlvbi5wYXRoKCcvZXZlbnRfdHlwZXMnKTsKICAgIH0KICB9Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignZXZlbnRDcmVhdGVNb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkcm9vdFNjb3BlLCBzaGFyZWRQcm9wZXJ0aWVzLCBldmVudF90eXBlX2lkLCBsb2NhdGlvbl9pZCwgZW1wX2lkLCAkaHR0cCwgc3RhcnREYXRlLCByZXNjaGVkdWxlX2V2ZW50LCB1aUNhbGVuZGFyQ29uZmlnKSB7CiAgc3RhcnREYXRlPW5ldyBtb21lbnQoc3RhcnREYXRlKTsKICBsb2dEZWJ1ZygiZXZlbnRDcmVhdGVNb2RhbENvbnRyb2xsZXIsIHN0YXJ0RGF0ZT0iK3N0YXJ0RGF0ZSsiIHR5cGUgIit0eXBlb2Ygc3RhcnREYXRlKTsKICBsb2dEZWJ1ZygiZXZlbnRDcmVhdGVNb2RhbENvbnRyb2xsZXIsIHJlc2NoZWR1bGVfZXZlbnQ9IityZXNjaGVkdWxlX2V2ZW50KTsKCiAgJHNjb3BlLmV2ZW50VHlwZVRpdGxlID0gIteR15fXqCDXodeV15Ig157XpNeS16kiOwogICRzY29wZS5zaG93RXZlbnRUeXBlU2VsZWN0ZWQgPSBmYWxzZTsKICAkc2NvcGUuc2hvd0V2ZW50Q2xpZW50U2VsZWN0ZWQgPSBmYWxzZTsKICAkc2NvcGUubmV3RXZlbnREZXRhaWxzID0ge307IC8vIHRoZXNlIGFyZSB0aGUgY29tcGxldGUgZGV0YWlscyBmb3IgdGhlIG5ldyBldmVudCAvLwogICRzY29wZS5uZXdFdmVudERldGFpbHMucmVwZWF0VHlwZSA9ICJmb3JldmVyIjsKICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnJlcGVhdEZpeGVkVGltZXMgPSAiNCI7CiAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5tYXhfcGFydGljaXBhbnRzID0gMTsKCiAgbG9nRGVidWcoIlhYWCA9ICIrSlNPTi5zdHJpbmdpZnkocmVzY2hlZHVsZV9ldmVudCkpOwoKICAkc2NvcGUucmVzY2hlZHVsZV9ldmVudD1mYWxzZTsKICAkc2NvcGUucmVzY2hlZHVsZV9ldmVudF9kZXRhaWxzPXJlc2NoZWR1bGVfZXZlbnQ7CiAgaWYgKCRzY29wZS5yZXNjaGVkdWxlX2V2ZW50X2RldGFpbHMhPW51bGwpCiAgewogICAgbG9nRGVidWcoInJlc2NoZWR1bGVfZXZlbnRfZGV0YWlscz0iKyRzY29wZS5yZXNjaGVkdWxlX2V2ZW50X2RldGFpbHMuZXZlbnRfaWQpOwogICAgbG9nRGVidWcoSlNPTi5zdHJpbmdpZnkoJHNjb3BlLnJlc2NoZWR1bGVfZXZlbnRfZGV0YWlscykpOwogICAgJHNjb3BlLnJlc2NoZWR1bGVfZXZlbnQ9dHJ1ZTsKICAgICRzY29wZS5naXZlbl9ldmVudF90eXBlX2lkID0gJHNjb3BlLnJlc2NoZWR1bGVfZXZlbnRfZGV0YWlscy5ldmVudF90eXBlX2lkOwovLyBzdGlsbCBwcmVmZXJpbmcgZW1wX2lkIGZyb20gc2NoZWR1bGVyIHN1Z2dlc3Rpb24gaXMgaXQgd2FzIHNlbGVjdGVkCiAgICBpZiAoZW1wX2lkIT0wKQogICAgewogICAgICAkc2NvcGUuZ2l2ZW5fZW1wX2lkID0gZW1wX2lkOwogICAgfQogICAgZWxzZQogICAgewogICAgICAkc2NvcGUuZ2l2ZW5fZW1wX2lkID0gJHNjb3BlLnJlc2NoZWR1bGVfZXZlbnRfZGV0YWlscy5pbnN0cnVjdG9yX2lkOwogICAgfQovLyBzdGlsbCBwcmVmZXJpbmcgbG9jYXRpb25faWQgZnJvbSBzY2hlZHVsZXIgc3VnZ2VzdGlvbiBvdmVyIHRoZSBvcmlnaW5hbCBsb2NhdGlvbiBmcm9tIGV2ZW50CiAgICBpZiAobG9jYXRpb25faWQhPTApCiAgICB7CiAgICAgICRzY29wZS5naXZlbl9sb2NhdGlvbl9pZCA9IGxvY2F0aW9uX2lkOwogICAgfQogICAgZWxzZQogICAgewogICAgICAkc2NvcGUuZ2l2ZW5fbG9jYXRpb25faWQgPSAkc2NvcGUucmVzY2hlZHVsZV9ldmVudF9kZXRhaWxzLmxvY2F0aW9uX2lkOwogICAgfQogIH0KICBlbHNlCiAgewogICAgJHNjb3BlLmdpdmVuX2V2ZW50X3R5cGVfaWQgPSBldmVudF90eXBlX2lkOwogICAgJHNjb3BlLmdpdmVuX2xvY2F0aW9uX2lkID0gbG9jYXRpb25faWQ7CiAgICAkc2NvcGUuZ2l2ZW5fZW1wX2lkID0gZW1wX2lkOwogIH0KICBpZiAoJHNjb3BlLmdpdmVuX2V2ZW50X3R5cGVfaWQ+MCkKICB7CiAgICAkc2NvcGUucHJldmlvdXNseV9zZWxlY3RlZF9ldmVudF90eXBlPXRydWU7CiAgfQogIGVsc2UKICB7CiAgICAkc2NvcGUucHJldmlvdXNseV9zZWxlY3RlZF9ldmVudF90eXBlPWZhbHNlOwogIH0KICBsb2dEZWJ1ZygiJHNjb3BlLmdpdmVuX2V2ZW50X3R5cGVfaWQ9Iiskc2NvcGUuZ2l2ZW5fZXZlbnRfdHlwZV9pZCk7CgogIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc3RhcnREYXRlKTsKICBsb2dEZWJ1Zygic2VsZWN0ZWREYXRlU3RhcnQgPSAiK3NlbGVjdGVkRGF0ZVN0YXJ0KTsKICB2YXIgc2VsZWN0ZWREYXRlU3RhcnQgPSBuZXcgRGF0ZShzZWxlY3RlZERhdGVTdGFydC5nZXRUaW1lKCkgKyBzZWxlY3RlZERhdGVTdGFydC5nZXRUaW1lem9uZU9mZnNldCgpICogNjAwMDApOwoKLy8gbG9nRGVidWcoImRhdGU9IiArIHNlbGVjdGVkRGF0ZVN0YXJ0KTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudCA9IFtdOwogICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRIb3VycygpOwogICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcyA9IChzZWxlY3RlZERhdGVTdGFydC5nZXRNaW51dGVzKCkgPCAxMCA/ICcwJyA6ICcnKSArIHNlbGVjdGVkRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRvdyA9IGRheU5hbWVzW3NlbGVjdGVkRGF0ZVN0YXJ0LmdldERheSgpXTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRhdGUgPSBzZWxlY3RlZERhdGVTdGFydDsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoID0gbW9udGhOYW1lc1tzZWxlY3RlZERhdGVTdGFydC5nZXRNb250aCgpXTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoMTEyID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TW9udGgoKSsxOwogICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aCA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldERhdGUoKTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXIgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRGdWxsWWVhcigpOwogICRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZV9pbnB1dF9mb3JtYXQ9IG5ldyBEYXRlKDE5NzAsIDAsIDEsICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMsICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcywgMCk7CgogICRzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZCA9ICRzY29wZS5naXZlbl9lbXBfaWQ7CiAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5sb2NhdGlvbl9pZCA9ICRzY29wZS5naXZlbl9sb2NhdGlvbl9pZDsKCiAgZ2V0QnVzaW5lc3NMb2NhdGlvbnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19sb2NhdGlvbnMnLGdldEJ1c2luZXNzTG9jYXRpb25zX2ZpbmlzaCk7CiAgZnVuY3Rpb24gZ2V0QnVzaW5lc3NMb2NhdGlvbnNfZmluaXNoKCkKICB7CiAgICBpZiAoJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5sb2NhdGlvbl9pZD09MCkKICAgIHsKICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5sb2NhdGlvbl9pZD0kc2NvcGUuYnVzaW5lc3NfbG9jYXRpb25zWzBdLmxvY2F0aW9uX2lkOwogICAgfQogIH0KCiAgY29uc29sZS5sb2coIiRzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZD0iKyRzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZCk7Ci8vIGlmIGNsaWVudCB3YXMgcHJldmlvdXNseSBzZWxlY3RlZAogICRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyPWZhbHNlOwogIGxvZ0RlYnVnKCJzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyPSIrc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcik7CiAgaWYgKHNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKSE9bnVsbCkKICB7Ci8vIGNvbnNvbGUubG9nKCJnb3QgcHJldmlvdXMgc2VsZWN0ZWQgdXNlciAiK3NoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKS5idXNlcl9maXJzdF9uYW1lKTsKICAgICRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VybmFtZT1zaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfZmlyc3RfbmFtZSsiICIrc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2VyX2xhc3RfbmFtZTsKICAgICRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyPXRydWU7CgogICAgJHNjb3BlLnNob3dFdmVudENsaWVudFNlbGVjdGVkID0gdHJ1ZTsKICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kdXNlcl9pZCA9IHNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKS5idXNpbmVzc191c2VyX2lkOwogICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmR1c2VyX2ZpcnN0X25hbWUgPSBzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfZmlyc3RfbmFtZTsKICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kdXNlcl9sYXN0X25hbWUgPSBzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfbGFzdF9uYW1lOwogICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5idXNpbmVzc191c2VyX2lkID0gc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2luZXNzX3VzZXJfaWQ7CgogIH0KICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWUgPSBzdGFydERhdGU7CiAgbG9nRGVidWcoIiRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZTE9Iiskc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWUpOwogICRzY29wZS5zdGFydE1pbnV0ZXMgPSBmdW5jdGlvbigpCiAgewogICAgbG9nRGVidWcoInN0YXJ0TWludXRlcyAiKygkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpKTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcz1taW51dGVzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpOwogICAgY2FsY3VsYXRlU3RhcnRUaW1lKCk7CiAgICBjYWxjdWxhdGVFbmRUaW1lRHluYW1pYygpOwogIH0KICAkc2NvcGUuc3RhcnRIb3VycyA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1Zygic3RhcnRIb3VycyAiK2hvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKSk7CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzPWhvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKTsKICAgIGNhbGN1bGF0ZVN0YXJ0VGltZSgpOwogICAgY2FsY3VsYXRlRW5kVGltZUR5bmFtaWMoKTsKICB9CgogICRzY29wZS5lbmRNaW51dGVzID0gZnVuY3Rpb24oKQogIHsKICAgIGxvZ0RlYnVnKCJlbmRNaW51dGVzICIrKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpKTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXM9bWludXRlc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcyk7CiAgICBjYWxjdWxhdGVTdGFydFRpbWUoKTsKICAgIGNhbGN1bGF0ZUVuZFRpbWVEeW5hbWljKCk7CiAgfQogICRzY29wZS5lbmRIb3VycyA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1ZygiZW5kSG91cnMgIitob3Vyc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMpKTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzPWhvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vycyk7CiAgICBjYWxjdWxhdGVTdGFydFRpbWUoKTsKICAgIGNhbGN1bGF0ZUVuZFRpbWVEeW5hbWljKCk7CiAgfQoKICBmdW5jdGlvbiBjYWxjdWxhdGVTdGFydFRpbWUoKQogIHsKICAgIGV2ZW50WWVhcj0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXI7CiAgICBldmVudE1vbnRoPSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bW9udGgxMTI7CiAgICBldmVudERheT0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRheW9mbW9udGg7CiAgICBpZiAocGFyc2VJbnQoZXZlbnRNb250aCk8MTApCiAgICB7CiAgICAgIGV2ZW50TW9udGg9IjAiK2V2ZW50TW9udGg7CiAgICB9CiAgICBpZiAocGFyc2VJbnQoZXZlbnREYXkpPDEwKQogICAgewogICAgICBldmVudERheT0iMCIrZXZlbnREYXk7CiAgICB9CiAgICBsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyPSIrZXZlbnRZZWFyKTsKICAgIGxvZ0RlYnVnKCIkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRheW9mbW9udGg9IitldmVudE1vbnRoKTsKICAgIGxvZ0RlYnVnKCIkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoPSIrZXZlbnREYXkpOwogICAgbmV3X3N0YXJ0PW1vbWVudC51dGMoZXZlbnRZZWFyKyItIitldmVudE1vbnRoKyItIitldmVudERheSsiVDAwOjAwOjAwIikuYWRkKCgocGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykqNjApK3BhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcykpLCAnbWludXRlcycpOwogICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5zdGFydF90aW1lPW5ld19zdGFydDsKICAgIGxvZ0RlYnVnKCJuZXdfc3RhcnQ9IituZXdfc3RhcnQpOwogIH0KICBmdW5jdGlvbiBtaW51dGVzQ2hhbmdlZCh0aGVtaW51dGVzKQogIHsKICAgIGxvZ0RlYnVnKCJ0aGVtaW51dGVzPSIrdGhlbWludXRlcyk7CiAgICBpZiAodHlwZW9mIHRoZW1pbnV0ZXM9PSJ1bmRlZmluZWQiKQogICAgewogICAgICByZXR1cm4gIjAwIjsKICAgIH0KICAgIGlmIChpc05hTih0aGVtaW51dGVzKSkKICAgIHsKICAgICAgcmV0dXJuICIwMCI7CiAgICB9CiAgICBpZiAodGhlbWludXRlcz09JycpCiAgICB7CiAgICAgIHJldHVybiAiMDAiOwogICAgfQogICAgdGhlbWludXRlcz1wYXJzZUludCh0aGVtaW51dGVzKTsKICAgIGlmICh0aGVtaW51dGVzPjYwKQogICAgewogICAgICByZXR1cm4gIjAwIjsKICAgIH0KICAgIGVsc2UgaWYgKHRoZW1pbnV0ZXM8MCkKICAgIHsKICAgICAgcmV0dXJuICIwMCI7CiAgICB9CiAgICBlbHNlIGlmICh0aGVtaW51dGVzPT0iIikKICAgIHsKICAgICAgcmV0dXJuICIwMCI7CiAgICB9CiAgICBlbHNlIGlmICh0aGVtaW51dGVzPDEwKQogICAgewogICAgICByZXR1cm4gIjAiK3RoZW1pbnV0ZXM7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgIHJldHVybiB0aGVtaW51dGVzOwogICAgfQogIH0KICBmdW5jdGlvbiBob3Vyc0NoYW5nZWQodGhlaG91cnMpCiAgewogICAgbG9nRGVidWcoInRoZWhvdXJzPSIrdGhlaG91cnMpOwogICAgaWYgKHR5cGVvZiB0aGVob3Vycz09InVuZGVmaW5lZCIpCiAgICB7CiAgICAgIHJldHVybiAiMCI7CiAgICB9CiAgICBpZiAoaXNOYU4odGhlaG91cnMpKQogICAgewogICAgICByZXR1cm4gIjAiOwogICAgfQogICAgaWYgKHRoZWhvdXJzPT0nJykKICAgIHsKICAgICAgcmV0dXJuICIwIjsKICAgIH0KICAgIHRoZWhvdXJzPXBhcnNlSW50KHRoZWhvdXJzKTsKICAgIGlmICh0aGVob3Vycz4yNCkKICAgIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CiAgICBlbHNlIGlmICh0aGVob3VyczwwKQogICAgewogICAgICByZXR1cm4gMDsKICAgIH0KICAgIGVsc2UgaWYgKHRoZWhvdXJzPT0iIikKICAgIHsKICAgICAgcmV0dXJuICIwIjsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgcmV0dXJuIHRoZWhvdXJzOwogICAgfQogIH0KICBnZXRBbGxJbnN0cnVjdG9ycygkaHR0cCwkc2NvcGUsJ2luc3RydWN0b3JzJyxnZXRBbGxJbnN0cnVjdG9yc19zdWNjZXNzKTsKICBmdW5jdGlvbiBnZXRBbGxJbnN0cnVjdG9yc19zdWNjZXNzKCkKICB7Ci8vICRzY29wZS5pbnN0cnVjdG9ycy51bnNoaWZ0KHtidXNpbmVzc191c2VyX2lkOm51bGwsIGJ1c2VyX2ZpcnN0X25hbWU6IiIsIGJ1c2VyX2xhc3RfbmFtZToiIn0pOwogICAgaWYgKCEkc2NvcGUubmV3RXZlbnREZXRhaWxzLmluc3RydWN0b3JfaWQ+MCkKICAgIHsKICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pbnN0cnVjdG9yX2lkPSRzY29wZS5pbnN0cnVjdG9yc1swXS5idXNpbmVzc191c2VyX2lkOwogICAgfQogIH0KCiAgJHNjb3BlLnNlbGVjdEV2ZW50VHlwZSA9IGZ1bmN0aW9uKCkgewovLyByZW1vdmluZyBldmVudCB0eXBlINeR15fXqCDXodeV15Ig157XpNeS16kKICAgIGlmICgkc2NvcGUuZXZlbnRUeXBlT3B0aW9uc1swXS5ldmVudF90eXBlX2lkPT0wKQogICAgewogICAgICAkc2NvcGUuZXZlbnRUeXBlT3B0aW9ucy5zcGxpY2UoMCwgMSk7CiAgICB9CiAgICAkc2NvcGUuYWpheF9lcnJvcj0nJzsKICAgIGNob2ljZT0kc2NvcGUuc2VsZWN0RXZlbnRUeXBlU2VsZWN0ZWQ7CiAgICBsb2dEZWJ1Zygic2VsZWN0RXZlbnRUeXBlIik7CiAgICBsb2dEZWJ1ZyhKU09OLnN0cmluZ2lmeSgkc2NvcGUuc2VsZWN0RXZlbnRUeXBlU2VsZWN0ZWQpKTsKICAgICRzY29wZS5ldmVudFR5cGVUaXRsZSA9IGNob2ljZS5ldmVudF90eXBlX25hbWU7CiAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmV2ZW50X3R5cGVfaWQgPSBjaG9pY2UuZXZlbnRfdHlwZV9pZDsKCiAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmV2ZW50X25hbWUgPSBjaG9pY2UuZXZlbnRfdHlwZV9uYW1lOwogICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5vcmlnaW5hbF9ldmVudF9uYW1lID0gY2hvaWNlLmV2ZW50X3R5cGVfbmFtZTsKICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuZXZlbnRfZGVzY3JpcHRpb24gPSBjaG9pY2UuZXZlbnRfdHlwZV9kZXNjcmlwdGlvbjsKICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuaXNfY2xhc3MgPSBjaG9pY2UuaXNfY2xhc3M7CiAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLm9yaWdpbmFsX3ByaWNlID0gY2hvaWNlLm9yaWdpbmFsX3ByaWNlOwogICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pc19nZW5lcmljX2V0eXBlID0gY2hvaWNlLmlzX2dlbmVyaWNfZXR5cGU7Ci8vICRzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZCA9IGNob2ljZS5pbnN0cnVjdG9yX2lkOwogICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5kdXJhdGlvbl9ldmVudCA9IGNob2ljZS5kdXJhdGlvbl9ldmVudDsKLy8gbG9nRGVidWcoInNjb3BlLm5ld0V2ZW50RGV0YWlscy5pc19jbGFzcz0iKyRzY29wZS5uZXdFdmVudERldGFpbHMuaXNfY2xhc3MpOwovLyBsb2dEZWJ1Zygic2NvcGUubmV3RXZlbnREZXRhaWxzLmluc3RydWN0b3JfaWQ9Iiskc2NvcGUubmV3RXZlbnREZXRhaWxzLmluc3RydWN0b3JfaWQpOwovLyBsb2dEZWJ1Zygic3RhcnREYXRlPSIrc3RhcnREYXRlKTsKLy8gJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5zdGFydF90aW1lID0gc3RhcnREYXRlOwogICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5ldmVudHR5cGUgPSBjaG9pY2U7CiAgICBjYWxjdWxhdGVFbmRUaW1lKCk7CgovLyAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWVfaW5wdXRfZm9ybWF0PSBuZXcgRGF0ZSgxOTcwLCAwLCAxLCAxNCwgNTcsIDApOwoKICAgIGxvZ0RlYnVnKCJuZXdFdmVudCBzdGFydD0iICsgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5zdGFydF90aW1lKTsKICAgIGxvZ0RlYnVnKCJuZXdFdmVudCBlbmQ9IiArICRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kX3RpbWUpOwoKICAgICRzY29wZS5zaG93RXZlbnRUeXBlU2VsZWN0ZWQgPSB0cnVlOwogIH0KCi8vIHRoaXMgZnVuY3Rpb24gY2FsY3VsYXRlcyBlbmQgdGltZSBhY2NvcmRpbmcgdG8gdGhlIGxlbmd0aCBvZiB0aGUgZXZlbnR0eXBlCiAgZnVuY3Rpb24gY2FsY3VsYXRlRW5kVGltZSgpCiAgewogICAgY29uc29sZS5sb2coIiRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZT0iKyRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZSk7CiAgICBlbmQgPSBtb21lbnQoJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5zdGFydF90aW1lKS5hZGQoJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5kdXJhdGlvbl9ldmVudCwgJ21pbnV0ZXMnKTsKICAgIHNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKGVuZCk7CiAgICBzZWxlY3RlZERhdGVFbmQgPSBuZXcgRGF0ZShzZWxlY3RlZERhdGVFbmQuZ2V0VGltZSgpICsgc2VsZWN0ZWREYXRlRW5kLmdldFRpbWV6b25lT2Zmc2V0KCkgKiA2MDAwMCk7CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycyA9IHNlbGVjdGVkRGF0ZUVuZC5nZXRIb3VycygpOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kZG93ID0gZGF5TmFtZXNbc2VsZWN0ZWREYXRlRW5kLmdldERheSgpXTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKSA8IDEwID8gJzAnIDogJycpICsgc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKTsKICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kX3RpbWUgPSBlbmQ7Ci8vIGNhbGN1bGF0aW5nIGR1cmF0aW9uCiAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50PXBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpLXBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcyk7CiAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50PSRzY29wZS5uZXdFdmVudERldGFpbHMuZHVyYXRpb25fZXZlbnQrKHBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzKS1wYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKSkqNjA7CiAgICBpZiAoJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5kdXJhdGlvbl9ldmVudDwwKQogICAgewogICAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50PTA7CiAgICB9CiAgfQoKLy8gdGhpcyBmdW5jdGlvbiBjYWxjdWxhdGVzIGVuZCB0aW1lIGFjY29yZGluZyB0byB0aGUgaW5wdXQgZnJvbSBtb2RhbCB3aW5kb3cKLy8gYW5kIG5vdCBhY2NvcmRpbmcgdG8gZXZlbnQgdHlwZSBsZW5ndGgKICBmdW5jdGlvbiBjYWxjdWxhdGVFbmRUaW1lRHluYW1pYygpCiAgewogICAgZXZlbnRZZWFyPSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0eWVhcjsKICAgIGV2ZW50TW9udGg9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aDExMjsKICAgIGV2ZW50RGF5PSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aDsKICAgIGlmIChwYXJzZUludChldmVudE1vbnRoKTwxMCkKICAgIHsKICAgICAgZXZlbnRNb250aD0iMCIrZXZlbnRNb250aDsKICAgIH0KICAgIGlmIChwYXJzZUludChldmVudERheSk8MTApCiAgICB7CiAgICAgIGV2ZW50RGF5PSIwIitldmVudERheTsKICAgIH0KICAgIGxvZ0RlYnVnKCIkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXI9IitldmVudFllYXIpOwogICAgbG9nRGVidWcoIiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aD0iK2V2ZW50TW9udGgpOwogICAgbG9nRGVidWcoIiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bW9udGg9IitldmVudERheSk7CiAgICBuZXdfZW5kPW1vbWVudC51dGMoZXZlbnRZZWFyKyItIitldmVudE1vbnRoKyItIitldmVudERheSsiVDAwOjAwOjAwIikuYWRkKCgocGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMpKjYwKStwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzKSksICdtaW51dGVzJyk7CiAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZF90aW1lPW5ld19lbmQ7CiAgICBsb2dEZWJ1ZygibmV3X2VuZD0iK25ld19lbmQpOwovLyBjYWxjdWxhdGluZyBkdXJhdGlvbgogICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5kdXJhdGlvbl9ldmVudD1wYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzKS1wYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpOwogICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5kdXJhdGlvbl9ldmVudD0kc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50KyhwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycyktcGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykpKjYwOwogICAgaWYgKCRzY29wZS5uZXdFdmVudERldGFpbHMuZHVyYXRpb25fZXZlbnQ8MCkKICAgIHsKICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5kdXJhdGlvbl9ldmVudD0wOwogICAgfQogIH0KICBnZXRBbGxCdXNpbmVzc0V2ZW50VHlwZXMoJGh0dHAsJHNjb3BlLCdldmVudFR5cGVPcHRpb25zJyxnZXRBbGxCdXNpbmVzc0V2ZW50VHlwZXNfc3VjY2Vzcyk7CiAgZnVuY3Rpb24gZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzX3N1Y2Nlc3MoKQogIHsKLy8gYWZ0ZXIgbG9hZGluZyBldmVudCB0eXBlcywgaWYgdGhlIGdpdmVuIGV2ZW50IHR5cGUgaXMgIT0gMCB3ZSAic2VsZWN0IiBpdAogICAgY29uc29sZS5sb2coImdldEFsbEJ1c2luZXNzRXZlbnRUeXBlc19zdWNjZXNzIik7CiAgICBpZiAoJHNjb3BlLmdpdmVuX2V2ZW50X3R5cGVfaWQ+MCkKICAgIHsKICAgICAgZm9yKHZhciBpID0gMDsgaSA8ICRzY29wZS5ldmVudFR5cGVPcHRpb25zLmxlbmd0aDsgaSsrKQogICAgICB7CiAgICAgICAgaWYgKCRzY29wZS5ldmVudFR5cGVPcHRpb25zW2ldLmV2ZW50X3R5cGVfaWQ9PSRzY29wZS5naXZlbl9ldmVudF90eXBlX2lkKQogICAgICAgIHsKICAgICAgICAgIGNvbnNvbGUubG9nKCJnaXZlbl9ldmVudF90eXBlX2lkIGZvdW5kIik7Ci8vICRzY29wZS5jYWxjdWxhdGVTdGFydFRpbWUoKTsKICAgICAgICAgICRzY29wZS5zZWxlY3RFdmVudFR5cGVTZWxlY3RlZD0kc2NvcGUuZXZlbnRUeXBlT3B0aW9uc1tpXTsKLy8gJHNjb3BlLnNlbGVjdEV2ZW50VHlwZSgkc2NvcGUuZXZlbnRUeXBlT3B0aW9uc1tpXSk7CiAgICAgICAgICAkc2NvcGUuc2VsZWN0RXZlbnRUeXBlKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBlbHNlIHsKICAgICAgJHNjb3BlLmV2ZW50VHlwZU9wdGlvbnMudW5zaGlmdCh7ImV2ZW50X3R5cGVfaWQiOjAsICJldmVudF90eXBlX25hbWUiOiLXkdeX16gg16HXldeSINee16TXktepIiwgaXNfdmFjYXRpb246IDB9KTsKICAgICAgJHNjb3BlLnNlbGVjdEV2ZW50VHlwZVNlbGVjdGVkPSRzY29wZS5ldmVudFR5cGVPcHRpb25zWzBdOwogICAgfQogIH0KICBnZXRBbGxDbGllbnRzKCRodHRwLCRzY29wZSwnZXZlbnRUeXBlVXNlcnMnKTsKCiAgJHNjb3BlLmV2ZW50Q2xpZW50U2VsZWN0ZWQgPSBmdW5jdGlvbihzZWxlY3RlZCkgewogICAgaWYgKHNlbGVjdGVkKSB7Ci8vIGFsZXJ0KEpTT04uc3RyaW5naWZ5KCBzZWxlY3RlZCwgbnVsbCwgMiApKTsKICAgICAgbG9nRGVidWcoJ2NsaWVudCBzZWxlY3RlZCAnICsgc2VsZWN0ZWQub3JpZ2luYWxPYmplY3QuYnVzZXJfZmlyc3RfbmFtZSk7CiAgICAgICRzY29wZS5zaG93RXZlbnRDbGllbnRTZWxlY3RlZCA9IHRydWU7CiAgICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kdXNlcl9pZCA9IHNlbGVjdGVkLm9yaWdpbmFsT2JqZWN0LmJ1c2luZXNzX3VzZXJfaWQ7CiAgICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kdXNlcl9maXJzdF9uYW1lID0gc2VsZWN0ZWQub3JpZ2luYWxPYmplY3QuYnVzZXJfZmlyc3RfbmFtZTsKICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmR1c2VyX2xhc3RfbmFtZSA9IHNlbGVjdGVkLm9yaWdpbmFsT2JqZWN0LmJ1c2VyX2xhc3RfbmFtZTsKICAgIH0gZWxzZSB7CiAgICAgIGxvZ0RlYnVnKCdub3Qgc2VsZWN0ZWQnKTsKLy8gJHNjb3BlLmV2ZW50Q2xpZW50RGVTZWxlY3RlZCgpOwogICAgfQogIH07CiAgJHNjb3BlLmV2ZW50Q2xpZW50RGVTZWxlY3RlZCA9IGZ1bmN0aW9uKCkgewogICAgJHNjb3BlLnNob3dFdmVudENsaWVudFNlbGVjdGVkID0gZmFsc2U7CiAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZHVzZXJfaWQgPSBudWxsOwogICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmR1c2VyX2ZpcnN0X25hbWUgPSBudWxsOwogICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmR1c2VyX2xhc3RfbmFtZSA9IG51bGw7CiAgICAkc2NvcGUuY2xlYXJDbGllbnRJbnB1dCgnY2xpZW50X2FuZ3Vjb21wbGV0ZScpOwogIH0KCiAgJHNjb3BlLmNsZWFyQ2xpZW50SW5wdXQgPSBmdW5jdGlvbihpZCkgewogICAgaWYgKGlkKSB7CiAgICAgICRzY29wZS4kYnJvYWRjYXN0KCdhbmd1Y29tcGxldGUtYWx0OmNsZWFySW5wdXQnLCBpZCk7CiAgICB9Ci8vIGVsc2V7Ci8vICAgJHNjb3BlLiRicm9hZGNhc3QoJ2FuZ3Vjb21wbGV0ZS1hbHQ6Y2xlYXJJbnB1dCcpOwovLyB9CiAgfQoKICAkc2NvcGUuY2FuY2VsID0gZnVuY3Rpb24oKSB7CiAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgfTsKCiAgJHNjb3BlLnVwZGF0ZUV2ZW50TmFtZUNoZWNrID0gZnVuY3Rpb24obmV3VmFsdWUpCiAgewogICAgbG9nRGVidWcoInVwZGF0ZUV2ZW50TmFtZT0iK25ld1ZhbHVlKTsKICAgIGlmIChuZXdWYWx1ZT09IiIpCiAgICB7CiAgICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuZXZlbnRfbmFtZSA9ICRzY29wZS5uZXdFdmVudERldGFpbHMub3JpZ2luYWxfZXZlbnRfbmFtZTsKICAgIH0KICB9Ci8vIHJlc2NoZWR1bGVFdmVudAogICRzY29wZS5yZXNjaGVkdWxlRXZlbnQgPSBmdW5jdGlvbigpIHsKICAgIGxvZ0RlYnVnKCJmdW5jdGlvbjogcmVzY2hlZHVsZUV2ZW50Iik7CgovLyBuZXdFdmVudEpTT05EZXRhaWxzID0gSlNPTi5zdHJpbmdpZnkoJHNjb3BlLm5ld0V2ZW50RGV0YWlscywgbnVsbCwgNCk7IC8vIChPcHRpb25hbCkgYmVhdXRpZnVsIGluZGVudGVkIG91dHB1dC4KICAgIGxvZ0RlYnVnKCJyZXNjaGVkdWxlRXZlbnQsICIgKyBKU09OLnN0cmluZ2lmeSgkc2NvcGUubmV3RXZlbnREZXRhaWxzLCBudWxsLCA0KSk7Ci8vIGlmICgkc2NvcGUubmV3RXZlbnREZXRhaWxzLmV2ZW50UmVjdXJyaW5nKSB7Ci8vICAgY3JlYXRlUmVjdXJyaW5nRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5uZXdFdmVudERldGFpbHMsY3JlYXRlUmVjdXJyaW5nRXZlbnRfc3VjY2Vzcyk7Ci8vICAgZnVuY3Rpb24gY3JlYXRlUmVjdXJyaW5nRXZlbnRfc3VjY2VzcygpCi8vICAgewovLyAgICAgY2FsZW5kYXIgPSAiY2FsZW5kYXJfYnVzaW5lc3MiOwovLyAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwovLyAgICAgJHVpYk1vZGFsSW5zdGFuY2UuZGlzbWlzcygpOwovLyAgICAgLy8gZXJyb3Igd2FzCi8vICAgICAvLyBsb2dEZWJ1ZygiZXJyb3IgIiArIGRhdGEuTWVzc2FnZSk7Ci8vICAgICAvLyAkc2NvcGUuYWpheF9lcnJvciA9IGRhdGEuTWVzc2FnZTsKLy8gICB9Ci8vIH0KLy8gZWxzZQogICAgewovLyBpZiBldmVudCBpcyBub3QgY2xhc3MsIGEgY2xpZW50IG11c3QgYmUgc2VsZWN0ZWQKLy8gaWYgKCghJHNjb3BlLnNob3dFdmVudENsaWVudFNlbGVjdGVkKSAmJiAoISRzY29wZS5uZXdFdmVudERldGFpbHMuaXNfY2xhc3MpKQovLyB7Ci8vICAgLy8gYWxlcnQoJ2NsaWVudCBtdXN0IGJlIHNlbGVjdGVkJyk7Ci8vICAgJHNjb3BlLmFqYXhfZXJyb3I9IteQ16DXkCDXlNeV16HXoyDXntep16rXqtejINec157XpNeS16kiOwovLyAgIHJldHVybjsKLy8gfQogICAgICByZXNjaGVkdWxlRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5yZXNjaGVkdWxlX2V2ZW50X2RldGFpbHMuZXZlbnRfaWQsJHNjb3BlLm5ld0V2ZW50RGV0YWlscyxyZXNjaGVkdWxlRXZlbnRfc3VjY2Vzcyk7CiAgICAgIGZ1bmN0aW9uIHJlc2NoZWR1bGVFdmVudF9zdWNjZXNzKCkKICAgICAgewogICAgICAgIGNhbGVuZGFyID0gImNhbGVuZGFyX2J1c2luZXNzIjsKICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZWZldGNoRXZlbnRzJyk7CiAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjYWxlbmRhckV2ZW50UmVzY2hlZHVsZURlc2VsZWN0Jyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCiAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuZGlzbWlzcygnYWRkZWQnKTsKICAgICAgfQovLyBvbiBmYWlsdXJlIHdhcwovLyAkc2NvcGUuYWpheF9lcnJvciA9IGRhdGEuTWVzc2FnZTsKICAgIH0KICB9OwoKICAkc2NvcGUuY3JlYXRlTmV3RXZlbnQgPSBmdW5jdGlvbigpIHsKICAgIGxvZ0RlYnVnKCJjcmVhdGVOZXdFdmVudCBzdGFydF90aW1lPSIrIHR5cGVvZiAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWUpOwoKICAgIG5ld0V2ZW50SlNPTkRldGFpbHMgPSBKU09OLnN0cmluZ2lmeSgkc2NvcGUubmV3RXZlbnREZXRhaWxzLCBudWxsLCA0KTsgLy8gKE9wdGlvbmFsKSBiZWF1dGlmdWwgaW5kZW50ZWQgb3V0cHV0LgogICAgbG9nRGVidWcoImNyZWF0ZU5ld0V2ZW50LCAiICsgbmV3RXZlbnRKU09ORGV0YWlscyk7CiAgICBpZiAoJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5ldmVudFJlY3VycmluZykgewogICAgICBjcmVhdGVSZWN1cnJpbmdFdmVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLm5ld0V2ZW50RGV0YWlscyxjcmVhdGVSZWN1cnJpbmdFdmVudF9zdWNjZXNzKTsKICAgICAgZnVuY3Rpb24gY3JlYXRlUmVjdXJyaW5nRXZlbnRfc3VjY2VzcygpCiAgICAgIHsKICAgICAgICBjYWxlbmRhciA9ICJjYWxlbmRhcl9idXNpbmVzcyI7CiAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwogICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoKTsKLy8gZXJyb3Igd2FzCi8vIGxvZ0RlYnVnKCJlcnJvciAiICsgZGF0YS5NZXNzYWdlKTsKLy8gJHNjb3BlLmFqYXhfZXJyb3IgPSBkYXRhLk1lc3NhZ2U7CiAgICAgIH0KICAgIH0KICAgIGVsc2UKICAgIHsKLy8gY2hlY2tpbmcgZXZlbnQgdGltZSBsb2dpYwogICAgICBpZiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3Vycz4kc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycykKICAgICAgewogICAgICAgICRzY29wZS5hamF4X2Vycm9yPSLXltee158g15TXlNeq15fXnNeUINep15wg15TXntek15LXqSDXkNeX16jXmSDXltee158g15TXodeZ15XXnSDXqdec15UiOwogICAgICAgIHJldHVybjsKICAgICAgfQovLyBjaGVja2luZyBldmVudCB0aW1lIGxvZ2ljCiAgICAgIGlmIChwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKT09cGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMpKQogICAgICB7CiAgICAgICAgaWYgKHBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcyk+PXBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpKQogICAgICAgIHsKICAgICAgICAgICRzY29wZS5hamF4X2Vycm9yPSLXltee158g15TXlNeq15fXnNeUINep15wg15TXntek15LXqSDXkNeX16jXmSDXltee158g15TXodeZ15XXnSDXqdec15UiOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzPSIrJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKTsKICAgICAgICBsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcz0iKyRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpOwogICAgICAgIGlmICgocGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKSs1KT49cGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcykpCiAgICAgICAgewogICAgICAgICAgJHNjb3BlLmFqYXhfZXJyb3I9IteQ15XXqNeaINeU157XpNeS16kg15fXmdeZ15Eg15zXlNeZ15XXqiDXnNek15fXldeqIDUg15PXp9eV16oiOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgfQovLyBpZiBldmVudCBpcyBub3QgY2xhc3MsIGEgY2xpZW50IG11c3QgYmUgc2VsZWN0ZWQKICAgICAgaWYgKCghJHNjb3BlLnNob3dFdmVudENsaWVudFNlbGVjdGVkKSAmJiAoISRzY29wZS5uZXdFdmVudERldGFpbHMuaXNfY2xhc3MpICYmICgkc2NvcGUubmV3RXZlbnREZXRhaWxzLmlzX2dlbmVyaWNfZXR5cGU9PTApKQogICAgICB7Ci8vIGFsZXJ0KCdjbGllbnQgbXVzdCBiZSBzZWxlY3RlZCcpOwogICAgICAgICRzY29wZS5hamF4X2Vycm9yPSLXkNeg15Ag15TXldeh16Mg157Xqdeq16rXoyDXnNee16TXktepIjsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKCRzY29wZS5zZWxlY3RFdmVudFR5cGVTZWxlY3RlZC5ldmVudF90eXBlX2lkPT0wKQogICAgICB7Ci8vIGFsZXJ0KCdjbGllbnQgbXVzdCBiZSBzZWxlY3RlZCcpOwogICAgICAgICRzY29wZS5hamF4X2Vycm9yPSLXkNeg15Ag15HXl9eoINeh15XXkiDXntek15LXqSAiOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBjcmVhdGVFdmVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLm5ld0V2ZW50RGV0YWlscyxjcmVhdGVFdmVudF9zdWNjZXNzKTsKICAgICAgZnVuY3Rpb24gY3JlYXRlRXZlbnRfc3VjY2VzcygpCiAgICAgIHsKICAgICAgICBjYWxlbmRhciA9ICJjYWxlbmRhcl9idXNpbmVzcyI7CiAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwogICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoJ2FkZGVkJyk7CiAgICAgIH0KLy8gb24gZmFpbHVyZSB3YXMKLy8gJHNjb3BlLmFqYXhfZXJyb3IgPSBkYXRhLk1lc3NhZ2U7CiAgICB9CiAgfQp9KTsKLy8vLyBmZmZmZmZmCmt1emVBcHAuY29udHJvbGxlcignQnVzaW5lc3NDYWxlbmRhckNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCBzaGFyZWRQcm9wZXJ0aWVzLCAkY29tcGlsZSwgJGxvY2F0aW9uLCB1aUNhbGVuZGFyQ29uZmlnLCAkdWliTW9kYWwsIHNoYXJlZERhdGEpIHsKICBpbml0aWFsRW5kVXNlciA9IHNoYXJlZERhdGEuZ2V0U2VsZWN0ZWRFbmRVc2VyKCk7CiAgbG9nRGVidWcoJ0J1c2luZXNzQ2FsZW5kYXIgQ29udHJvbGxlciwgc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpPScgKyBzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkpOwoKICBnZXRCdXNpbmVzc0xvY2F0aW9ucygkaHR0cCwkc2NvcGUsJ2J1c2luZXNzX2xvY2F0aW9ucycpOwoKICAkc2NvcGUuc3RhdHVzZXMgPSBbIHsic3RhdHVzX2lkIjoiMCIsInN0YXR1c19uYW1lIjoi16TXqteV15cifSwgeyJzdGF0dXNfaWQiOiIxIiwic3RhdHVzX25hbWUiOiLXodeS15XXqCJ9XTsKICAkc2NvcGUudGhlZGF0YV9yZXBvcnQgPSB7fTsKCiAgJHNjb3BlLnRoZWRhdGFfcmVwb3J0LnNvdXJjZSA9ICJjYWxlbmRhciI7CiAgJHNjb3BlLnRoZWRhdGFfcmVwb3J0LmZpbHRlcnMgPSB7CiAgICBpc19jYW5jZWxlZDogIjAiCiAgfTsKCiAgJHNjb3BlLnVwZGF0ZUV2ZW50cyA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1ZygidXBkYXRlRXZlbnRzIik7CiAgICBpbnN0cnVjdG9yX2lkX2ZpbHRlciA9IGxpc3RfdG9fc3RyaW5nX2J5X3ZhbHVlKCRzY29wZS5jYWxlbmRhckluc3RydWN0b3JGaWx0ZXIsICJidXNpbmVzc191c2VyX2lkIiApOwogICAgZXZlbnRfdHlwZV9pZF9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuY2FsZW5kYXJFdmVudFR5cGVGaWx0ZXIsICJldmVudF90eXBlX2lkIiApOwogICAgc3RhdHVzX2ZpbHRlciA9IGxpc3RfdG9fc3RyaW5nX2J5X3ZhbHVlKCRzY29wZS5jYWxlbmRhclN0YXR1c0ZpbHRlciwgInN0YXR1c19pZCIgKTsKCiAgICAkc2NvcGUudGhlZGF0YV9yZXBvcnQuZmlsdGVycyA9IHsKICAgICAgaW5zdHJ1Y3Rvcl9pZDogaW5zdHJ1Y3Rvcl9pZF9maWx0ZXIsCiAgICAgIGV2ZW50X3R5cGVfaWQ6IGV2ZW50X3R5cGVfaWRfZmlsdGVyLAogICAgICBzdGF0dXM6IHN0YXR1c19maWx0ZXIsCiAgICAgIGlzX2NhbmNlbGVkOiAiMCIKICAgIH07CgogICAgLy8gY29uc29sZS5sb2coJHNjb3BlLmNhbGVuZGFyKTsKICAgIGxvZ0RlYnVnKCJiZWZvcmUgcmVmZXRjaEV2ZW50cyIpOwogICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKICAgIGxvZ0RlYnVnKCJhZnRlciByZWZldGNoRXZlbnRzIik7CiAgICAvLyB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwoKICB9CgogICRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyPWZhbHNlOwoKICBpZiAoc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpIT1udWxsKQogIHsKICAgIGNvbnNvbGUubG9nKCJnb3QgcHJldmlvdXMgc2VsZWN0ZWQgdXNlciAiK3NoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKS5idXNlcl9maXJzdF9uYW1lKTsKICAgICRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VybmFtZT1zaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfZmlyc3RfbmFtZSsiICIrc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2VyX2xhc3RfbmFtZTsKICAgICRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyX2lkPXNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKS5idXNpbmVzc191c2VyX2lkOwogICAgbG9nRGVidWcoIiRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyX2lkPSIrJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJfaWQpOwoKICAgICRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyPXRydWU7CiAgfQoKLy8gY2hlY2tpbmcgaWYgY2FsZW5kYXIgc2hvdWxkIHN0YXJ0IHdpdGggYSBzcGVjaWZpYyBkYXRlIChmcm9tIHVybCBvciBmcm9tIHByZXZpb3VzbHkgc2VsZWN0ZWQgZGF0ZSkKICBsb2dEZWJ1ZygiJGxvY2F0aW9uLnNlYXJjaCgpLnN0YXJ0PSIgKyAkbG9jYXRpb24uc2VhcmNoKCkuc3RhcnQpOwogIGlmICh0eXBlb2YgJGxvY2F0aW9uLnNlYXJjaCgpLnN0YXJ0ICE9ICd1bmRlZmluZWQnKQogIHsKICAgIGN1cnJEZWZhdWx0RGF0ZSA9ICRsb2NhdGlvbi5zZWFyY2goKS5zdGFydDsKICB9CiAgZWxzZSBpZiAoc2hhcmVkUHJvcGVydGllcy5nZXRfY2FsZW5kYXJfZGF0ZSgpIT1udWxsKQogIHsKICAgIGNvbnNvbGUubG9nKCJnb3QgcHJldmlvdXMgZGF0ZSAgIitzaGFyZWRQcm9wZXJ0aWVzLmdldF9jYWxlbmRhcl9kYXRlKCkpOwogICAgY3VyckRlZmF1bHREYXRlID0gc2hhcmVkUHJvcGVydGllcy5nZXRfY2FsZW5kYXJfZGF0ZSgpOwogIH0KICBlbHNlCiAgewogICAgY3VyckRlZmF1bHREYXRlID0gbmV3IERhdGUoKTsKICB9CiAgZ2V0QWxsSW5zdHJ1Y3RvcnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19pbnN0cnVjdG9ycycsZ2V0QWxsSW5zdHJ1Y3RvcnNfZmluaXNoKTsKICBnZXRBbGxJbnN0cnVjdG9ycygkaHR0cCwkc2NvcGUsJ2luc3RydWN0b3JzJyk7CiAgZnVuY3Rpb24gZ2V0QWxsSW5zdHJ1Y3RvcnNfZmluaXNoKCkKICB7Ci8vIGNvbnNvbGUubG9nKCRzY29wZS5idXNpbmVzc19pbnN0cnVjdG9ycyk7CiAgICAkc2NvcGUuYnVzaW5lc3NfaW5zdHJ1Y3RvcnMudW5zaGlmdCh7ImJ1c2VyX2Z1bGxfbmFtZSI6Iteb15wg15TXpteV15XXqiIsICJidXNlcl9maXJzdF9uYW1lIjoi15vXldec150iLCJidXNlcl9sYXN0X25hbWUiOiIiLCAidXNlcl9pZCI6IDAsICJidXNpbmVzc191c2VyX2lkIjogMH0pOwoKLy8gc2V0dGluZyBzZWxlY3RlZCBnZXRfc2VsZWN0ZWRfaW5zdHJ1Y3RvcgogICAgJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX2luc3RydWN0b3I9ZmFsc2U7CiAgICBpZiAoc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfaW5zdHJ1Y3RvcigpPj0wKQogICAgewovLyBjb25zb2xlLmxvZygiZ290IHByZXZpb3VzIHNlbGVjdGVkIGluc3RydWN0b3IgIitzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF9pbnN0cnVjdG9yKCkpOwogICAgICAkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfaW5zdHJ1Y3Rvcl9pZD1zaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF9pbnN0cnVjdG9yKCk7CiAgICAgICRzY29wZS5wcmV2aW91c19zZWxlY3RlZF9pbnN0cnVjdG9yPXRydWU7CiAgICAgICRzY29wZS5zZWxlY3RlZF9idXNpbmVzc191c2VyX2lkPXNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX2luc3RydWN0b3IoKTsKICAgIH0KICB9CiAgZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzKCRodHRwLCRzY29wZSwnZXZlbnRfdHlwZXNfY2FscycpOwogIGdldEFsbEJ1c2luZXNzRXZlbnRUeXBlc05vU3lzdGVtKCRodHRwLCRzY29wZSwnZXZlbnRfdHlwZXMnKTsKCi8vIHNldHRpbmcgc2VsZWN0ZWQgdXNlciBpZAogICRzY29wZS5wcmV2aW91c19ldmVudF9yZXNjaGVkdWxlPWZhbHNlOwogICRzY29wZS5wcmV2aW91c19ldmVudF9yZXNjaGVkdWxlX2V2ZW50PW51bGw7CgogICRzY29wZS4kb24oImNhbGVuZGFyRXZlbnRSZXNjaGVkdWxlRGVzZWxlY3QiLGZ1bmN0aW9uKGUsYSkKICB7CiAgICAkc2NvcGUuY2FsZW5kYXJFdmVudFJlc2NoZWR1bGVEZXNlbGVjdCgpOwogIH0pOwoKLy8gZGVzZWxlY3RpbmcgZXZlbnQgZnJvbSBiZWluZyByZXNjaGVkdWxlZAogICRzY29wZS5jYWxlbmRhckV2ZW50UmVzY2hlZHVsZURlc2VsZWN0PWZ1bmN0aW9uKCkKICB7CiAgICBzaGFyZWRQcm9wZXJ0aWVzLnNldF9ldmVudF9yZXNjaGVkdWxlKG51bGwpOwogICAgJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGU9ZmFsc2U7CiAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwogIH0KLy8gZGVsZXRpbmcgY2xpZW50IHNlbGVjdGlvbiBpbiBjYWxlbmRhcgogICRzY29wZS5jYWxlbmRhckNsaWVudERlc2VsZWN0PWZ1bmN0aW9uKCkgLy8gcmVsb2FkIGNsYXNzL2V2ZW50IHN1Z2dlc3Rpb25zCiAgewogICAgJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXI9ZmFsc2U7CiAgICBzaGFyZWRQcm9wZXJ0aWVzLnNldF9zZWxlY3RlZF91c2VyKG51bGwpOwogICAgJHNjb3BlLmV2ZW50VHlwZVNlbGVjdGVkKCk7CiAgfQogIGlmIChpbml0aWFsRW5kVXNlciAhPSBudWxsKSB7CiAgICAkc2NvcGUuYnVzaW5lc3NDYWxlbmRhckluaXRpYWxOYW1lID0gdHJ1ZTsKICAgIHNoYXJlZERhdGEuc2V0U2VsZWN0ZWRFbmRVc2VyKG51bGwpOwogICAgJHNjb3BlLmJ1c2luZXNzQ2FsZW5kYXJJbml0aWFscyA9IHsKICAgICAgbmFtZTogaW5pdGlhbEVuZFVzZXIuZmlyc3RfbmFtZSArICIgIiArIGluaXRpYWxFbmRVc2VyLmxhc3RfbmFtZQogICAgfTsKICB9IGVsc2UgewogICAgJHNjb3BlLmJ1c2luZXNzQ2FsZW5kYXJJbml0aWFsTmFtZSA9IGZhbHNlOwogIH0KICAvKiBjb25maWcgb2JqZWN0ICovCiAgJHNjb3BlLmNhbGVuZGFyX25hbWUgPSAiY2FsZW5kYXJfYnVzaW5lc3MiOwogICRzY29wZS5jYWxlbmRhciA9ICJjYWxlbmRhcl9idXNpbmVzcyI7CiAgLyogZXZlbnQgc291cmNlcyBhcnJheSovCgogIC8vIHRoZWRhdGEgPSB7IHNvdXJjZTogImNhbGVuZGFyIiB9CiAgLy8gdGhlZGF0YVsnZmlsdGVycyddID0geyBpbnN0cnVjdG9yX2lkOiAiMTk1In07CgogIC8vIGNvbnNvbGUubG9nKHRoZWRhdGEpOwoKICAkc2NvcGUuYnVzaW5lc3NDYWxlbmRhckV2ZW50U291cmNlcyA9IFt7CiAgICAvLyB1cmw6ICcvYXBpL2FkbWluL2V2ZW50cy9nZXRwb3N0JywKICAgIHVybDogJy9hcGkvYWRtaW4vcmVwb3J0cy9ldmVudHMyJywKICAgIGRhdGE6ICRzY29wZS50aGVkYXRhX3JlcG9ydCAsCiAgICB0eXBlOiAnUE9TVCcKICB9LCB7CiAgICB1cmw6ICcvYXBpL2FkbWluL2NhbGVuZGFyL2xpbWl0YXRpb25zL2JhY2tncm91bmQvZ2V0cG9zdCcsCiAgICBkYXRhOiAkc2NvcGUudGhlZGF0YV9yZXBvcnQgLAogICAgdHlwZTogJ1BPU1QnICAgIC8vIH0sIHsKLy8gICAgIHVybDogJy9hcGkvYWRtaW4vcmVjdXJyaW5nL2dldHBvc3QnLAovLyAgICAgdHlwZTogJ1BPU1QnCiAgfV07CgogICRzY29wZS5nb3RvVG9kYXkgPSBmdW5jdGlvbigpIHsKICAgICRzY29wZS5nb3RvRGF0ZShuZXcgRGF0ZSgpKTsKICAgIHZpc2libGVEYXRlU3RhcnQgPSBuZXcgRGF0ZSh1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ2V0VmlldycpLnN0YXJ0KTsKICAgIGRhdGVUb0dvVG8gPSB2aXNpYmxlRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCkgKyAiLSIgKyAoJzAnICsgKHZpc2libGVEYXRlU3RhcnQuZ2V0TW9udGgoKSArIDEpKS5zbGljZSgtMikgKyAiLSIgKyAoJzAnICsgdmlzaWJsZURhdGVTdGFydC5nZXREYXRlKCkpLnNsaWNlKC0yKTsKICAgIHNoYXJlZFByb3BlcnRpZXMuc2V0X2NhbGVuZGFyX2RhdGUoZGF0ZVRvR29Ubyk7CiAgICAkc2NvcGUudmlzaWJsZURhdGVTdGFydD12aXNpYmxlRGF0ZVN0YXJ0OwogICAgJGxvY2F0aW9uLnNlYXJjaCgnc3RhcnQnLGRhdGVUb0dvVG8pOwogIH0KCiAgJHNjb3BlLmluc3RydWN0b3JTZWxlY3RlZD1mdW5jdGlvbih0aGlzdGhpcykKICB7CiAgICB1cGRhdGVTdWdnZXN0aW9ucygpOwogIH0KICAkc2NvcGUuZXZlbnRUeXBlU2VsZWN0ZWQ9ZnVuY3Rpb24odGhpc3RoaXMpCiAgewogICAgdXBkYXRlU3VnZ2VzdGlvbnMoKTsKICB9CiAgZnVuY3Rpb24gdXBkYXRlU3VnZ2VzdGlvbnMoKQogIHsKICAgIGxvZ0RlYnVnKCJmdW5jdGlvbjogdXBkYXRlU3VnZ2VzdGlvbnMiKTsKICAgIHNoYXJlZFByb3BlcnRpZXMuc2V0X2V2ZW50X3R5cGVfZm9yX3N1Z2dlc3Rpb25zKCRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkKTsKICAgIHNoYXJlZFByb3BlcnRpZXMuc2V0X3NlbGVjdGVkX2luc3RydWN0b3IoJHNjb3BlLnNlbGVjdGVkX2J1c2luZXNzX3VzZXJfaWQpOwogICAgZm9yIChpPTA7aTwkc2NvcGUuZXZlbnRfdHlwZXMubGVuZ3RoO2krKykKICAgIHsKLy8gY29uc29sZS5sb2coJHNjb3BlLmV2ZW50X3R5cGVzW2ldLmV2ZW50X3R5cGVfaWQpOwogICAgICBpZiAoJHNjb3BlLnNlbGVjdGVkX2V2ZW50X3R5cGVfaWQ9PSRzY29wZS5ldmVudF90eXBlc1tpXS5ldmVudF90eXBlX2lkKQogICAgICB7Ci8vIGNvbnNvbGUubG9nKCJmb3VuZCBldmVudCB0eXBlIGlkIik7CiAgICAgICAgaWYgKCRzY29wZS5ldmVudF90eXBlc1tpXS5pc19jbGFzcykgLy8gaXMgY2xhc3MKICAgICAgICB7CiAgICAgICAgICBsb2dEZWJ1ZygiJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXI9Iiskc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcik7CiAgICAgICAgICBpZiAoJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXIpCiAgICAgICAgICB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCJpcyBjbGFzcyBzdWdnZXN0aW9uZCIpOwogICAgICAgICAgICAkaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3RjbGFzcy8iKyRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkKyIvIiskc2NvcGUuc2VsZWN0ZWRfYnVzaW5lc3NfdXNlcl9pZCsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSsiLyIrKCRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkrMSkrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0SG91cnMoKSArICIvIiArICRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKSArICIvIiArICRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyX2lkKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkX2V2ZW50X3R5cGVfaWRfaXNfY2xhc3M9dHJ1ZTsKICAgICAgICAgICAgICAkc2NvcGUuZXZlbnRzU3VnZ2VzdGVkID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgICBlbHNlCiAgICAgICAgICB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCJub3QgaXMgY2xhc3Mgc3VnZ2VzdGlvbmQiKTsKICAgICAgICAgICAgJGh0dHAuZ2V0KCRnQXBpVVJMUHJlZml4ICsgIi9lbmR1c2VyL2V2ZW50cy9zdWdnZXN0Y2xhc3MvIiskc2NvcGUuc2VsZWN0ZWRfZXZlbnRfdHlwZV9pZCsiLyIrJHNjb3BlLnNlbGVjdGVkX2J1c2luZXNzX3VzZXJfaWQrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCkrIi8iKygkc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpKzEpKyIvIiskc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXREYXRlKCkrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldEhvdXJzKCkgKyAiLyIgKyAkc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXRNaW51dGVzKCkgKyAiLzAiKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkX2V2ZW50X3R5cGVfaWRfaXNfY2xhc3M9dHJ1ZTsKICAgICAgICAgICAgICAkc2NvcGUuZXZlbnRzU3VnZ2VzdGVkID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UgLy8gaXMgbm90IGNsYXNzCiAgICAgICAgewogICAgICAgICAgJGh0dHAuZ2V0KCRnQXBpVVJMUHJlZml4ICsgIi9lbmR1c2VyL2V2ZW50cy9zdWdnZXN0LyIrJHNjb3BlLnNlbGVjdGVkX2V2ZW50X3R5cGVfaWQrIi8iKyRzY29wZS5zZWxlY3RlZF9idXNpbmVzc191c2VyX2lkKyIvIiskc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpKyIvIisoJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0TW9udGgoKSsxKSsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0RGF0ZSgpKyIvIiskc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXRIb3VycygpICsgIi8iICsgJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0TWludXRlcygpKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKQogICAgICAgICAgewogICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRfZXZlbnRfdHlwZV9pZF9pc19jbGFzcz1mYWxzZTsKICAgICAgICAgICAgJHNjb3BlLmV2ZW50c1N1Z2dlc3RlZCA9IHJlc3BvbnNlLmRhdGE7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CgogICRzY29wZS5nb3RvTmV4dCA9IGZ1bmN0aW9uKCkgewogICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlbW92ZUV2ZW50cycpOwogICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ25leHQnKTsKICAgICRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlKCk7Ci8vIGFkZGluZyB0aGUgZm9sbG93aW5nIHRvIG1ha2UgdGhlIHVybAovLyBwb2ludCB0byB0aGUgcmlnaHQgd2VlaywgaWYgZ29pbmcgdG8gYSBkaWZmZXJlbnQgVVJMIGFuZCB0aGVuIGdvaW5nIGJhY2sKICAgIHZpc2libGVEYXRlU3RhcnQgPSBuZXcgRGF0ZSh1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ2V0VmlldycpLnN0YXJ0KTsKICAgIGRhdGVUb0dvVG8gPSB2aXNpYmxlRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCkgKyAiLSIgKyAoJzAnICsgKHZpc2libGVEYXRlU3RhcnQuZ2V0TW9udGgoKSArIDEpKS5zbGljZSgtMikgKyAiLSIgKyAoJzAnICsgdmlzaWJsZURhdGVTdGFydC5nZXREYXRlKCkpLnNsaWNlKC0yKTsKICAgIHNoYXJlZFByb3BlcnRpZXMuc2V0X2NhbGVuZGFyX2RhdGUoZGF0ZVRvR29Ubyk7CiAgICAkc2NvcGUudmlzaWJsZURhdGVTdGFydD12aXNpYmxlRGF0ZVN0YXJ0OwogICAgJGxvY2F0aW9uLnNlYXJjaCgnc3RhcnQnLGRhdGVUb0dvVG8pOwogIH0KICAkc2NvcGUuZ290b1ByZXYgPSBmdW5jdGlvbigpIHsKICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZW1vdmVFdmVudHMnKTsKICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdwcmV2Jyk7CiAgICAkc2NvcGUudXBkYXRlQ2FsZW5kYXJDZW50ZXJUaXRsZSgpOwovLyBhZGRpbmcgdGhlIGZvbGxvd2luZyB0byBtYWtlIHRoZSB1cmwKLy8gcG9pbnQgdG8gdGhlIHJpZ2h0IHdlZWssIGlmIGdvaW5nIHRvIGEgZGlmZmVyZW50IFVSTCBhbmQgdGhlbiBnb2luZyBiYWNrCiAgICB2aXNpYmxlRGF0ZVN0YXJ0ID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5zdGFydCk7CiAgICBkYXRlVG9Hb1RvID0gdmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpICsgIi0iICsgKCcwJyArICh2aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkgKyAxKSkuc2xpY2UoLTIpICsgIi0iICsgKCcwJyArIHZpc2libGVEYXRlU3RhcnQuZ2V0RGF0ZSgpKS5zbGljZSgtMik7CiAgICBzaGFyZWRQcm9wZXJ0aWVzLnNldF9jYWxlbmRhcl9kYXRlKGRhdGVUb0dvVG8pOwogICAgJHNjb3BlLnZpc2libGVEYXRlU3RhcnQ9dmlzaWJsZURhdGVTdGFydDsKICAgICRsb2NhdGlvbi5zZWFyY2goJ3N0YXJ0JyxkYXRlVG9Hb1RvKTsKCiAgfQogICRzY29wZS5nb3RvRGF0ZSA9IGZ1bmN0aW9uKG5ld2RhdGUpIHsKICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnb3RvRGF0ZScsIG5ld2RhdGUpOwogICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlbW92ZUV2ZW50cycpOwogICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKICAgICRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlKCk7CiAgfQoKICAkc2NvcGUuZWRpdEhvdXJzT2ZXb3JrID0gZnVuY3Rpb24oKSB7Ci8vIHBhcmFtIHNob3VsZCBsb29rIGxpa2UgIjIwMTYtMDctMDEiCiAgICB2aXNpYmxlRGF0ZVN0YXJ0ID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5zdGFydCk7CiAgICBkYXRlVG9Hb1RvID0gdmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpICsgIi0iICsgKCcwJyArICh2aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkgKyAxKSkuc2xpY2UoLTIpICsgIi0iICsgKCcwJyArIHZpc2libGVEYXRlU3RhcnQuZ2V0RGF0ZSgpKS5zbGljZSgtMik7CiAgICAkbG9jYXRpb24ucGF0aCgnL2hvdXJzX29mX3dvcmsnKS5zZWFyY2goewogICAgICBzdGFydDogZGF0ZVRvR29UbwogICAgfSk7CiAgfTsKCiAgJHNjb3BlLnVwZGF0ZUNhbGVuZGFyQ2VudGVyVGl0bGUgPSBmdW5jdGlvbigpIHsKICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3Jyk7CgogICAgdmlzaWJsZURhdGVTdGFydCA9IG5ldyBEYXRlKHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3Jykuc3RhcnQpOwogICAgdmlzaWJsZURhdGVFbmQgPSBuZXcgRGF0ZSh1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ2V0VmlldycpLmVuZCk7CgogICAgJHNjb3BlLmNhbGVuZGFyVGl0bGVDZW50ZXIgPSB2aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSArICIgIiArIG1vbnRoTmFtZXNbdmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpXSArCiAgICAgICAgIiDigJQgIiArIHZpc2libGVEYXRlRW5kLmdldERhdGUoKSArICIgIiArIG1vbnRoTmFtZXNbdmlzaWJsZURhdGVFbmQuZ2V0TW9udGgoKV0gKwogICAgICAgICIgIiArIHZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKTsKICB9OwoKICAkc2NvcGUuc2hvd0V2ZW50UG9wdXAgPSBmdW5jdGlvbihzZWxlY3RlZEV2ZW50KSB7CiAgICBzaG93RXZlbnRQb3B1cChzZWxlY3RlZEV2ZW50LCAkdWliTW9kYWwpCiAgfTsKCiAgJHNjb3BlLmV2ZW50Q3JlYXRlTW9kYWxGcm9tU2NoZWR1bGVyID0gZnVuY3Rpb24oZXN1Z2dlc3QpCiAgewovLyBpZiBjbGFzcyAtIGdvIHRvIGV2ZW50IGNsYXNzCiAgICBjb25zb2xlLmxvZyhlc3VnZ2VzdCk7CiAgICBmb3IgKGk9MDtpPCRzY29wZS5ldmVudF90eXBlcy5sZW5ndGg7aSsrKQogICAgewogICAgICBpZiAoZXN1Z2dlc3QuZXZlbnRfdHlwZV9pZD09JHNjb3BlLmV2ZW50X3R5cGVzW2ldLmV2ZW50X3R5cGVfaWQpCiAgICAgIHsKICAgICAgICBpZiAoJHNjb3BlLmV2ZW50X3R5cGVzW2ldLmlzX2NsYXNzKQogICAgICAgIHsKICAgICAgICAgIGNvbnNvbGUubG9nKCJpcyBjbGFzcyIpOwogICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWY9Jy8jL2V2ZW50X2NsYXNzLycgKyBlc3VnZ2VzdC5ldmVudF9pZDsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGxvZ0RlYnVnKEpTT04uc3RyaW5naWZ5KGVzdWdnZXN0KSk7CiAgICBsb2dEZWJ1Zyhlc3VnZ2VzdC5zdGFydF9lcG9jaCk7CiAgICBzdGFydERhdGU9ZXN1Z2dlc3Quc3RhcnRfZXBvY2gqMTAwMDsKCiAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAgICAgYW5pbWF0aW9uOiBmYWxzZSwKICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfZXZlbnRfY3JlYXRlLnBocCcsCiAgICAgIGNvbnRyb2xsZXI6ICdldmVudENyZWF0ZU1vZGFsQ29udHJvbGxlcicsCiAgICAgIHNpemU6ICdsJywKICAgICAgcmVzb2x2ZTogewogICAgICAgIHN0YXJ0RGF0ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gc3RhcnREYXRlOwogICAgICAgIH0sCiAgICAgICAgZXZlbnRfdHlwZV9pZDogZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gJHNjb3BlLnNlbGVjdGVkX2V2ZW50X3R5cGVfaWQ7CiAgICAgICAgfSwKICAgICAgICBsb2NhdGlvbl9pZDogZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gZXN1Z2dlc3QubG9jYXRpb25faWQ7CiAgICAgICAgfSwKICAgICAgICBlbXBfaWQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIGVzdWdnZXN0LmVtcF9pZDsKICAgICAgICB9LAogICAgICAgIHJlc2NoZWR1bGVfZXZlbnQ6IGZ1bmN0aW9uKCkKICAgICAgICB7CiAgICAgICAgICBpZiAoJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGUpCiAgICAgICAgICB7CiAgICAgICAgICAgIHJldHVybiAkc2NvcGUucHJldmlvdXNfZXZlbnRfcmVzY2hlZHVsZV9ldmVudDsKICAgICAgICAgIH0KICAgICAgICAgIGVsc2UKICAgICAgICAgIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgfQogICAgfSk7CgogIH0KICAkc2NvcGUuZXZlbnRDcmVhdGVNb2RhbCA9IGZ1bmN0aW9uKHN0YXJ0RGF0ZSwgc2l6ZSkgewogICAgbG9nRGVidWcoImV2ZW50Q3JlYXRlTW9kYWwgc3RhcnREYXRlPSIrc3RhcnREYXRlKTsKCiAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAgICAgYW5pbWF0aW9uOiBmYWxzZSwKICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfZXZlbnRfY3JlYXRlLnBocCcsCiAgICAgIGNvbnRyb2xsZXI6ICdldmVudENyZWF0ZU1vZGFsQ29udHJvbGxlcicsCiAgICAgIHNpemU6IHNpemUsCiAgICAgIHJlc29sdmU6IHsKICAgICAgICBzdGFydERhdGU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIHN0YXJ0RGF0ZTsKICAgICAgICB9LAogICAgICAgIGV2ZW50X3R5cGVfaWQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfSwKICAgICAgICBsb2NhdGlvbl9pZDogZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9LAogICAgICAgIGVtcF9pZDogZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9LAogICAgICAgIHJlc2NoZWR1bGVfZXZlbnQ6IGZ1bmN0aW9uKCkKICAgICAgICB7CiAgICAgICAgICBpZiAoJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGUpCiAgICAgICAgICB7CiAgICAgICAgICAgIHJldHVybiAkc2NvcGUucHJldmlvdXNfZXZlbnRfcmVzY2hlZHVsZV9ldmVudDsKICAgICAgICAgIH0KICAgICAgICAgIGVsc2UKICAgICAgICAgIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9ICAgICAgICAgICAgICAgIH0KCiAgICAgIH0KICAgIH0pOwoKICAgIG1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24oc2VsZWN0ZWRJdGVtKSB7CiAgICAgICRzY29wZS5zZWxlY3RlZCA9IHNlbGVjdGVkSXRlbTsKICAgIH0sIGZ1bmN0aW9uKCkgewogICAgICBsb2dEZWJ1ZygnTW9kYWwgZGlzbWlzc2VkIGF0OiAnICsgbmV3IERhdGUoKSk7CiAgICB9KTsKICB9OwoKLy8vCiAgJHNjb3BlLnVwZGF0ZUV2ZW50RGF0YWJhc2UgPSBmdW5jdGlvbihzdGFydF9wYXJhbSwgZW5kX3BhcmFtLCBldmVudF9pZCwgdGhlZXZlbnQpCiAgewoKICAgIGxvZ0RlYnVnKCJ1cGRhdGVFdmVudERhdGFiYXNlIHN0YXJ0PSIgKyBzdGFydF9wYXJhbSArICIsIGVuZD0iICsgZW5kX3BhcmFtICsgIiwgZXZlbnRfaWQ9IiArIGV2ZW50X2lkKTsKICAgIHRoZXVybCA9ICcvYXBpL2FkbWluL2V2ZW50cy9zZXQvJyArIGV2ZW50X2lkOwoKICAgICRodHRwKHsKICAgICAgbWV0aG9kOiAnUE9TVCcsCiAgICAgIHVybDogdGhldXJsLAogICAgICBkYXRhOiB7CiAgICAgICAgc3RhcnRfZGF0ZTogc3RhcnRfcGFyYW0sCiAgICAgICAgZW5kX2RhdGU6IGVuZF9wYXJhbSwKICAgICAgICBldmVudF9pZDogZXZlbnRfaWQKICAgICAgfSwKICAgICAgaGVhZGVyczogewogICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbjtjaGFyc2V0PXV0Zi04JwogICAgICB9CiAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHsKCiAgICAgIGxvZ0RlYnVnKGRhdGEpOwogICAgICBpZiAoZGF0YS5FcnJvcikgewogICAgICAgIGxvZ0RlYnVnKCJlcnJvciAiICsgZGF0YS5NZXNzYWdlKTsKICAgICAgICBhbGVydCgnZXJyb3InKTsKICAgICAgICBjYWxlbmRhciA9ICJjYWxlbmRhcl9idXNpbmVzcyI7CiAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwogICAgICB9IGVsc2UgewogICAgICAgIGxvZ0RlYnVnKCJzdWNjZXNzIik7CiAgICAgICAgY2FsZW5kYXIgPSAiY2FsZW5kYXJfYnVzaW5lc3MiOwovLyB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZWZldGNoRXZlbnRzJyk7Ci8vICR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoJ2FkZGVkIGFuZCByZWZldGNoRXZlbnRzJyk7CiAgICAgIH0KICAgIH0pOwoKICB9OwovLy8KCiAgJHNjb3BlLmNsYXNzRXZlbnRBZGRVc2VyID0gZnVuY3Rpb24oZXN1Z2dlc3QpCiAgewogICAgY29uc29sZS5sb2coImNsYXNzRXZlbnRBZGRVc2VyIG9yIFJlbW92ZSIpOwogICAgaWYgKChlc3VnZ2VzdC5pc19yZWdpc3RlcmVkPT0xKSB8ICgoZXN1Z2dlc3QuaXNfd2FpdGluZ2xpc3Q9PTEpICYmIChlc3VnZ2VzdC5pc19jYW5jZWxlZD09MCkpKQogICAgewogICAgICBjb25zb2xlLmxvZygibmVlZCB0byB1bnJlZ2lzdGVyIik7CiAgICAgIHJlbW92ZUVuZFVzZXJGcm9tRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyX2lkLGVzdWdnZXN0LmV2ZW50X2lkLHJlbW92ZUVuZFVzZXJGcm9tRXZlbnRfY2FsbGJhY2ssIHJlbW92ZUVuZFVzZXJGcm9tRXZlbnRfY2FsbGJhY2spOwogICAgICBmdW5jdGlvbiByZW1vdmVFbmRVc2VyRnJvbUV2ZW50X2NhbGxiYWNrKCkKICAgICAgewogICAgICAgICRzY29wZS5ldmVudFR5cGVTZWxlY3RlZCgpOwogICAgICAgIGNhbGVuZGFyID0gImNhbGVuZGFyX2J1c2luZXNzIjsKICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZWZldGNoRXZlbnRzJyk7CgogICAgICB9CiAgICB9CiAgICBlbHNlCiAgICB7Ci8vIGNvbnNvbGUubG9nKGVzdWdnZXN0LmV2ZW50X2lkKTsKLy8gY29uc29sZS5sb2coJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJfaWQpOwovLyBpZiBzZWxlY3RlZCB1c2VyIC0gYWRkaW5nIGhpbS9oZXIgdG8gY2xhc3MKICAgICAgaWYgKCRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyKQogICAgICB7CiAgICAgICAgYWRkRW5kVXNlclRvRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyX2lkLGVzdWdnZXN0LmV2ZW50X2lkLGFkZEVuZFVzZXJUb0V2ZW50X2NhbGxiYWNrLCBhZGRFbmRVc2VyVG9FdmVudF9jYWxsYmFjayk7CiAgICAgICAgZnVuY3Rpb24gYWRkRW5kVXNlclRvRXZlbnRfY2FsbGJhY2soKQogICAgICAgIHsKICAgICAgICAgIGNhbGVuZGFyID0gImNhbGVuZGFyX2J1c2luZXNzIjsKICAgICAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKICAgICAgICAgICRzY29wZS5ldmVudFR5cGVTZWxlY3RlZCgpOwogICAgICAgIH0KICAgICAgfQogICAgICBlbHNlIC8vIGVsc2UgLSBnb2luZyB0byBjbGFzcyBwYWdlCiAgICAgIHsKICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZj0nLyMvZXZlbnRfY2xhc3MvJyArIGVzdWdnZXN0LmV2ZW50X2lkOwogICAgICB9CiAgICB9CiAgfQogICRzY29wZS5jYWxlbmRhcl9idXNpbmVzc19jb25maWcgPSB7CiAgICBjYWxlbmRhcjogewogICAgICBoZWlnaHQ6ICdhdXRvJywKICAgICAgZWRpdGFibGU6IHRydWUsCi8vIGhlYWRlcjogewovLyAgICAgbGVmdDogJycsCi8vICAgICBjZW50ZXI6ICcnLAovLyAgICAgcmlnaHQ6ICcnCi8vIH0sCi8vIGhlYWRlcjogewovLyAgICAgbGVmdDogJ3RpdGxlJywKLy8gICAgIGNlbnRlcjogJycsCi8vICAgICByaWdodDogJ3RvZGF5IHByZXYsbmV4dCcKLy8gfSwKICAgICAgdGl0bGVGb3JtYXQ6IHsKLy8gd2VlazogICJkIFtNTU1deyAnJiM4MjExOycgZCBNTU19IgogICAgICB9LAovLyB0aXRsZUZvcm1hdDogewovLyAgICAgbW9udGg6ICdNTU1NIHl5eXknLAovLyAgICAgd2VlazogIk1NTSBkWyB5eXl5XXsgJyYjODIxMjsnWyBNTU1dIGQgeXl5eX0iLAovLyAgICAgZGF5OiAnTU0vZGQnCi8vIH0sCiAgICAgIGhlYWRlcjogJycsCi8vIGRlZmF1bHRWaWV3OiAnYWdlbmRhV2VlaycsCi8vIHZpZXdzOiB7Ci8vICAgICBkb250U2hvd0RhdGU6IHsKLy8gICAgICAgICB0eXBlOiAnYWdlbmRhV2VlaycsCi8vICAgICAgICAgZHVyYXRpb246IHsKLy8gICAgICAgICAgICAgZGF5czogNwovLyAgICAgICAgIH0sCi8vICAgICAgICAgdGl0bGU6ICdBcGVydHVyYScsCi8vICAgICAgICAgY29sdW1uRm9ybWF0OiAnZGRkZCcgLy8gRm9ybWF0IHRoZSBkYXkgdG8gb25seSBzaG93IGxpa2UgJ01vbmRheScKLy8gICAgICAgICAgICAgLy8gaGlkZGVuRGF5czogWzAsIDZdIC8vIEhpZGUgU3VuZGF5IGFuZCBTYXR1cmRheT8KLy8gICAgIH0KLy8gfSwKLy8gc2xvdER1cmF0aW9uOiAnMDA6MTU6MDAnLAogICAgICBldmVudERyb3A6IGZ1bmN0aW9uKGV2ZW50LCBkYXlEZWx0YSwgbWludXRlRGVsdGEsIGFsbERheSwgcmV2ZXJ0RnVuYywgdWlDYWxlbmRhckNvbmZpZykgewogICAgICAgIGxvZ0RlYnVnKCJldmVudCBkcm9wIiArIGV2ZW50LnRpdGxlICsgIigiICsgZXZlbnQuaWQgKyAiKSBtb3ZlZCAiICsgbWludXRlRGVsdGEgKyAiIG1pbnV0ZXMiKTsKICAgICAgICBsb2dEZWJ1Zygib2xkIHN0YXJ0PSIgKyBldmVudC5zdGFydCArICIsIG9sZCBlbmQ9IiArIGV2ZW50LmVuZCk7CiAgICAgICAgJHNjb3BlLnVwZGF0ZUV2ZW50RGF0YWJhc2UoZXZlbnQuc3RhcnQsIGV2ZW50LmVuZCwgZXZlbnQuaWQsIGV2ZW50KTsKICAgICAgfSwKICAgICAgZXZlbnRSZXNpemU6IGZ1bmN0aW9uKGV2ZW50LCBkZWx0YSwgcmV2ZXJ0RnVuYykgewogICAgICAgIGxvZ0RlYnVnKCJldmVudCByZXNpemUiICsgZXZlbnQudGl0bGUgKyAiKCIgKyBldmVudC5pZCArICIpIG1vdmVkICIpOwogICAgICAgIGxvZ0RlYnVnKCJvbGQgc3RhcnQ9IiArIGV2ZW50LnN0YXJ0ICsgIiwgb2xkIGVuZD0iICsgZXZlbnQuZW5kKTsKICAgICAgICAkc2NvcGUudXBkYXRlRXZlbnREYXRhYmFzZShldmVudC5zdGFydCwgZXZlbnQuZW5kLCBldmVudC5pZCwgZXZlbnQpOwogICAgICB9LAogICAgICBkZWZhdWx0VmlldzogJ2FnZW5kYVdlZWsnLAogICAgICBldmVudFN0YXJ0RWRpdGFibGU6ZmFsc2UsCiAgICAgIGV2ZW50RHVyYXRpb25FZGl0YWJsZTpmYWxzZSwKICAgICAgZGVmYXVsdERhdGU6IG1vbWVudChjdXJyRGVmYXVsdERhdGUpLAoKLy8gZGVmYXVsdFZpZXc6ICdkb250U2hvd0RhdGUnLAogICAgICBldmVudENsaWNrOiBmdW5jdGlvbihjYWxFdmVudCwganNFdmVudCwgdmlldykgewogICAgICAgIGxvZ0RlYnVnKCJjYWxlbmRhciBldmVudCBjbGlja2VkICIgKyBjYWxFdmVudC50aXRsZSArICIoIiArIGNhbEV2ZW50LmlkICsgIikgIiArIGNhbEV2ZW50LnN0YXJ0ICsgIiAiICsgY2FsRXZlbnQuZW5kKTsKLy8gbG9nRGVidWcoSlNPTi5zdHJpbmdpZnkoY2FsRXZlbnQpKTsKLy8gaWYgaXQncyBhIGdlbmVyaWMgZXZlbnQgKHZhY2F0aW9uIGV0YykKLy8gc2hvdyBwb3B1cCB3aXRoIG9wdGlvbiB0byBkZWxldGUKICAgICAgICBpZiAoY2FsRXZlbnQuaXNfZ2VuZXJpY19ldHlwZT09MSkKICAgICAgICB7Ci8vICRzY29wZS5zaG93R2VuZXJpY0V2ZW50KGNhbEV2ZW50KTsKICAgICAgICAgICRzY29wZS5zaG93RXZlbnRQb3B1cChjYWxFdmVudCk7CgogICAgICAgIH0KICAgICAgICBlbHNlCiAgICAgICAgewogICAgICAgICAgJHNjb3BlLnNob3dFdmVudFBvcHVwKGNhbEV2ZW50KTsKICAgICAgICB9Ci8vIGNoYW5nZSB0aGUgYm9yZGVyIGNvbG9yIGp1c3QgZm9yIGZ1bgovLyAkKHRoaXMpLmNzcygnYm9yZGVyLWNvbG9yJywgJ3JlZCcpOwoKICAgICAgfSwKICAgICAgZGF5Q2xpY2s6IGZ1bmN0aW9uKGRhdGUsIGpzRXZlbnQsIHZpZXcpIHsKLy8gbG9nRGVidWcoIm5ldyBldmVudCBjcmVhdGlvbiBjbGlja2VkICIgKyBjYWxFdmVudC50aXRsZSArICIoIiArIGNhbEV2ZW50LmlkICsgIikgIiArIGNhbEV2ZW50LnN0YXJ0ICsgIiAiICsgY2FsRXZlbnQuZW5kKTsKLy8gICAgIHN0YXJ0ID0gZGF0ZTsKLy8gICAgIGVuZCA9IG1vbWVudChzdGFydCkuYWRkKDQ1LCAnbWludXRlcycpOwogICAgICAgIGlmICh2aWV3Lm5hbWUgPT09ICJtb250aCIpIHsKICAgICAgICAgIGNhbGVuZGFyID0gImNhbGVuZGFyX2J1c2luZXNzIjsKICAgICAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2NoYW5nZVZpZXcnLCAiYWdlbmRhV2VlayIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAkc2NvcGUuZXZlbnRDcmVhdGVNb2RhbChkYXRlKTsKICAgICAgICB9Ci8vIGNoYW5nZSB0aGUgYm9yZGVyIGNvbG9yIGp1c3QgZm9yIGZ1bgovLyAkKHRoaXMpLmNzcygnYm9yZGVyLWNvbG9yJywgJ3JlZCcpOwoKICAgICAgfSwKICAgICAgZXZlbnRSZW5kZXI6IGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KQogICAgICB7CiAgICAgICAgaWYgKCFldmVudC5ldmVudF9pZD4wKQogICAgICAgIHsKLy8gbm90IGEgcmVhbCBldmVudCAtIHByb2JhYmx5IGJsb2NrIC8gYmFja2dyb3VuZAovLyBpZ25vcmluZyBpdAogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KLy8gY2hhbmdpbmcgbG9vayBhbmQgZmVlbCBvZiBldmVuIHRoYXQgaXMgdG8gcmVzY2hlZHVsZQogICAgICAgIGlmIChzaGFyZWRQcm9wZXJ0aWVzLmdldF9ldmVudF9yZXNjaGVkdWxlKCkhPW51bGwpCiAgICAgICAgewogICAgICAgICAgaWYgKGV2ZW50LmV2ZW50X2lkPT1zaGFyZWRQcm9wZXJ0aWVzLmdldF9ldmVudF9yZXNjaGVkdWxlKCkuZXZlbnRfaWQpCiAgICAgICAgICB7CiAgICAgICAgICAgIGVsZW1lbnQuY3NzKCdiYWNrZ3JvdW5kLWNvbG9yJywgJyNBOUE5QTkJJyk7CiAgICAgICAgICAgIGVsZW1lbnQuY3NzKCdib3JkZXItY29sb3InLCAnI0E5QTlBOQknKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoZXZlbnQuaXNfZ2VuZXJpY19ldHlwZT09MSkKICAgICAgICB7CgogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChldmVudC5pc19jbGFzcz09MSkKICAgICAgICB7Ci8vIGlmIGNsYXNzIGFkZGluZyBudW1iZXIgb2YgcGFydGljaXBhbnRzCiAgICAgICAgICBpZiAoZXZlbnQubm9fb2Zfd2FpdGluZ191c2Vycz4wKQogICAgICAgICAgewogICAgICAgICAgICBlbGVtZW50LmZpbmQoJy5mYy10aXRsZScpLnByZXBlbmQoZXZlbnQubm9fb2ZfdXNlcnMrIi8iK2V2ZW50Lm1heF9wYXJ0aWNpcGFudHMrICIgKCIrZXZlbnQubm9fb2Zfd2FpdGluZ191c2VycysiKSIrIiAtICIpOwogICAgICAgICAgfQogICAgICAgICAgZWxzZQogICAgICAgICAgewogICAgICAgICAgICBlbGVtZW50LmZpbmQoJy5mYy10aXRsZScpLnByZXBlbmQoZXZlbnQubm9fb2ZfdXNlcnMrIi8iK2V2ZW50Lm1heF9wYXJ0aWNpcGFudHMrIiAtICIpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlCiAgICAgICAgewovLyBpZiBub3QgY2xhc3MgLSB3cml0aW5nIHRoZSBlbmR1c2VyIG5hbWUKICAgICAgICAgIGlmIChldmVudC5kdXJhdGlvbl9ldmVudCE9MCkgLy8gYWxzbyBpZiBub3QgaG91cnMgb2Ygd29yawogICAgICAgICAgewovLyBlbGVtZW50LmZpbmQoJy5mYy10aXRsZScpLmFwcGVuZCgiICgiK2V2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfZmlyc3RfbmFtZSsiICIrZXZlbnQuZXZlbnRVc2Vyc1swXS5idXNlcl9sYXN0X25hbWUrIikiKTsKLy8gY29uc29sZS5sb2coZXZlbnQuZXZlbnRVc2Vycyk7Ci8vIGNvbnNvbGUubG9nKGV2ZW50LmV2ZW50VXNlcnMubGVuZ3RoKTsKICAgICAgICAgICAgLy8gaWYgKGV2ZW50LmV2ZW50VXNlcnMubGVuZ3RoPjApCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAvLyBlbGVtZW50LmZpbmQoJy5mYy10aXRsZScpLnByZXBlbmQoIiIrZXZlbnQuZXZlbnRVc2Vyc1swXS5idXNlcl9maXJzdF9uYW1lKyIgIitldmVudC5ldmVudFVzZXJzWzBdLmJ1c2VyX2xhc3RfbmFtZSsiICgiKTsKICAgICAgICAgICAgICBlbGVtZW50LmZpbmQoJy5mYy10aXRsZScpLnByZXBlbmQoIiIrZXZlbnQuZXZlbnRfdXNlcl9jbGllbnRzKyIgKCIpOwogICAgICAgICAgICAgIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykuYXBwZW5kKCIpIik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KLy8gbG9nRGVidWcoImhlcmU0Iik7CiAgICAgICAgfQogICAgICAgIGlmIChldmVudC5pc19yZXBlYXRpbmcgPT0gMSkgewogICAgICAgICAgZWxlbWVudC5maW5kKCIuZmMtdGl0bGUiKS5hcHBlbmQoIiZuYnNwOzxpIGNsYXNzPSdmYSBmYS1yZXBlYXQnPjwvaT4mbmJzcDsiKTsKLy8gIGVsZW1lbnQuZmluZCgiLmZjLXRpdGxlIikuYXBwZW5kKCImbmJzcDs8aW1nIHNyYz0nL3B1YmxpYy9pbWFnZXMvcmVjdXJyaW5nLWljb24ucG5nJyB3aWR0aD0nMTBweCcgaGVpZ2h0PScxMHB4Jy8+Iik7CiAgICAgICAgfQogICAgICB9LAogICAgICBtaW5UaW1lOiAkZ0NhbGVuZGFyRGlzcGxheU1pblRpbWUsCiAgICAgIG1heFRpbWU6ICRnQ2FsZW5kYXJEaXNwbGF5TWF4VGltZSwKICAgICAgc2VsZWN0YWJsZTogZmFsc2UsCiAgICAgIHNlbGVjdEhlbHBlcjogZmFsc2UsCiAgICAgIHRpbWV6b25lOiBmYWxzZSwKICAgICAgaXNSVEw6IHRydWUsCiAgICAgIGxhbmc6ICJoZSIsIC8vIGtrCiAgICAgIGFsbERheVNsb3Q6IGZhbHNlLAogICAgICBsb2FkaW5nOiBmdW5jdGlvbihib29sKSB7CiAgICAgICAgaWYgKGJvb2wpIHsKICAgICAgICAgIGxvZ0RlYnVnKCdsb2FkaW5nIGNhbGVuZGFyMSAnICsgJHNjb3BlLmNhbGVuZGFyKTsKLy8gJCgnI2xvYWRpbmcnKS5zaG93KCk7CiAgICAgICAgfSBlbHNlIHsKLy8gJCgnI2xvYWRpbmcnKS5oaWRlKCk7CiAgICAgICAgICBsb2dEZWJ1ZygnZmluaXNoZWQgbG9hZGluZyBjYWxlbmRhciB4JyArICRzY29wZS5jYWxlbmRhcik7CiAgICAgICAgICAkc2NvcGUudXBkYXRlQ2FsZW5kYXJDZW50ZXJUaXRsZSgpOwogICAgICAgICAgbG9nRGVidWcoImFmdGVyIGNhbGVuZGFyIGxvYWQgdmlzaWJsZURhdGVTdGFydD0iK3VpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3Jykuc3RhcnQpOwogICAgICAgICAgdmlzaWJsZURhdGVTdGFydCA9IG5ldyBEYXRlKHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3Jykuc3RhcnQpOwogICAgICAgICAgZGF0ZVRvR29UbyA9IHZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSArICItIiArICgnMCcgKyAodmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpICsgMSkpLnNsaWNlKC0yKSArICItIiArICgnMCcgKyB2aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSkuc2xpY2UoLTIpOwovLyBjb25zb2xlLmxvZygiZGF0ZVRvR29UbyIrZGF0ZVRvR29Ubyk7Ci8vICRodHRwLmdldCgkZ0FwaVVSTFByZWZpeCArICIvZW5kdXNlci9ldmVudHMvc3VnZ2VzdC8iK3Zpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSsiLyIrdGhpc193ZWVrX2Z1bGxfeWVhcisiLyIrdGhpc193ZWVrX21vbnRoKyIvIit0aGlzX3dlZWtfZGF5X29mX21vbnRoKyIvIisgdGhpc193ZWVrX2hvdXJzKyAiLyIgKyB0aGlzX3dlZWtfbWludXRlcykudGhlbihmdW5jdGlvbihyZXNwb25zZSkKICAgICAgICAgICRzY29wZS5ldmVudF90eXBlX2lkPSRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkOwogICAgICAgICAgJHNjb3BlLnZpc2libGVEYXRlU3RhcnQ9dmlzaWJsZURhdGVTdGFydDsKLy8xMjEyMTIKLy8gaWYgKCRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkX2lzX2NsYXNzKQovLyB7Ci8vICAgJGh0dHAuZ2V0KCRnQXBpVVJMUHJlZml4ICsgIi9lbmR1c2VyL2V2ZW50cy9zdWdnZXN0Y2xhc3MvIiskc2NvcGUuZXZlbnRfdHlwZV9pZCsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSsiLyIrKCRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkrMSkrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0SG91cnMoKSArICIvIiArICRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKSsgIi8iICsgJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJfaWQpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpCi8vICAgewovLyAgICAgICAvLwkgICAgJHNjb3BlLm15RGF0YSA9IHJlc3BvbnNlLmRhdGE7Ci8vICAgICAgIC8vCQlsb2dEZWJ1ZygiZ3JpZG9wdGlvbnM9Iiskc2NvcGUuZ3JpZE9wdGlvbnMpOwovLyAgICAgICAkc2NvcGUuZXZlbnRzU3VnZ2VzdGVkID0gcmVzcG9uc2UuZGF0YTsKLy8gICAgICAgLy8gJHNjb3BlLmRhdGVUb0dvVG89ZGF0ZVRvR29UbzsKLy8gICB9KTsKLy8gfQovLyBlbHNlCi8vIHsKLy8gICAkaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3QvIiskc2NvcGUuZXZlbnRfdHlwZV9pZCsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSsiLyIrKCRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkrMSkrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0SG91cnMoKSArICIvIiArICRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkKLy8gICB7Ci8vICAgICAgIC8vCSAgICAkc2NvcGUubXlEYXRhID0gcmVzcG9uc2UuZGF0YTsKLy8gICAgICAgLy8JCWxvZ0RlYnVnKCJncmlkb3B0aW9ucz0iKyRzY29wZS5ncmlkT3B0aW9ucyk7Ci8vICAgICAgICRzY29wZS5ldmVudHNTdWdnZXN0ZWQgPSByZXNwb25zZS5kYXRhOwovLyAgICAgICAvLyAkc2NvcGUuZGF0ZVRvR29Ubz1kYXRlVG9Hb1RvOwovLyAgIH0pOwovLyB9CgovLyBhZnRlciBjYWxlbmRhciBpcyBsb2FkZWQgLSBsb2FkaW5nIGV2ZW50IHR5cGVzIGFuZCBzdWdnZXN0aW9uIGZvciBxdWV1ZXMKLy8gd2UgaGFuZGxlIHRoaW5ncyByZWxhdGVkIHRvIHRoZSBldmVudCB0eXBlcyBvbmx5IGFmdGVyIGxvYWRpbmcgdGhlbSAoYW5kIHRoZSBjYWxlbmRhcikKICAgICAgICAgIGdldEFsbEJ1c2luZXNzRXZlbnRUeXBlc05vU3lzdGVtKCRodHRwLCRzY29wZSwnZXZlbnRfdHlwZXMnLGdldEFsbEJ1c2luZXNzRXZlbnRUeXBlc05vU3lzdGVtX2NhbGxiYWNrKTsKCiAgICAgICAgICBmdW5jdGlvbiBnZXRBbGxCdXNpbmVzc0V2ZW50VHlwZXNOb1N5c3RlbV9jYWxsYmFjaygpCiAgICAgICAgICB7ICAgIC8vIGNoZWNraW5nIGlmIGNhbGVuZGFyIHNob3VsZCBzdGFydCB3aXRoIGEgc3BlY2lmaWMgZXZlbnQgdHlwZSBmb3Igc3VnZ2VzdGlvbnMKLy8gbG9nRGVidWcoIlggc2hhcmVkUHJvcGVydGllcy5nZXRfZXZlbnRfdHlwZV9mb3Jfc3VnZ2VzdGlvbnM9IitzaGFyZWRQcm9wZXJ0aWVzLmdldF9ldmVudF90eXBlX2Zvcl9zdWdnZXN0aW9ucygpKTsKICAgICAgICAgICAgaWYgKHNoYXJlZFByb3BlcnRpZXMuZ2V0X2V2ZW50X3R5cGVfZm9yX3N1Z2dlc3Rpb25zKCkhPW51bGwpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRfZXZlbnRfdHlwZV9pZD1zaGFyZWRQcm9wZXJ0aWVzLmdldF9ldmVudF90eXBlX2Zvcl9zdWdnZXN0aW9ucygpOwogICAgICAgICAgICAgICRzY29wZS5ldmVudFR5cGVTZWxlY3RlZCgkc2NvcGUuc2VsZWN0ZWRfZXZlbnRfdHlwZV9pZCk7CiAgICAgICAgICAgIH0KCi8vIGZpcnN0IGNoZWNraW5nIGlmIHRoZXJlJ3MgYW4gZXZlbnQgdG8gcmVzY2hlZHVsZQogICAgICAgICAgICBpZiAoc2hhcmVkUHJvcGVydGllcy5nZXRfZXZlbnRfcmVzY2hlZHVsZSgpIT1udWxsKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGU9dHJ1ZTsKICAgICAgICAgICAgICAkc2NvcGUucHJldmlvdXNfZXZlbnRfcmVzY2hlZHVsZV9ldmVudD1zaGFyZWRQcm9wZXJ0aWVzLmdldF9ldmVudF9yZXNjaGVkdWxlKCk7CiAgICAgICAgICAgICAgc2hhcmVkUHJvcGVydGllcy5zZXRfZXZlbnRfcmVzY2hlZHVsZShudWxsKTsKICAgICAgICAgICAgICBsb2dEZWJ1ZygiZ290IGV2ZW50IHRvIHJlc2NoZWR1bGUgIitKU09OLnN0cmluZ2lmeSgkc2NvcGUucHJldmlvdXNfZXZlbnRfcmVzY2hlZHVsZV9ldmVudCkpOwogICAgICAgICAgICAgIGxvZ0RlYnVnKCJyZXNjaGVkdWxlIGV2ZW50X3R5cGVfaWQ9Iiskc2NvcGUucHJldmlvdXNfZXZlbnRfcmVzY2hlZHVsZV9ldmVudC5ldmVudF90eXBlX2lkKTsKICAgICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRfZXZlbnRfdHlwZV9pZD0kc2NvcGUucHJldmlvdXNfZXZlbnRfcmVzY2hlZHVsZV9ldmVudC5ldmVudF90eXBlX2lkOwogICAgICAgICAgICAgICRzY29wZS5ldmVudFR5cGVTZWxlY3RlZCgpOwogICAgICAgICAgICB9Ci8vIGNoZWNraW5nIHNlbGVjdGVkIHVzZXIgb25seSBpZiB0aGVyZSdzIG5vIHNlbGVjdGVkIGV2ZW50IHRvIG1vdmUKICAgICAgICAgICAgZWxzZSBpZiAoc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpIT1udWxsKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgY29uc29sZS5sb2coImdvdCBwcmV2aW91cyBzZWxlY3RlZCB1c2VyICIrc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2VyX2ZpcnN0X25hbWUpOwogICAgICAgICAgICAgICRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VybmFtZT1zaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfZmlyc3RfbmFtZSsiICIrc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2VyX2xhc3RfbmFtZTsKICAgICAgICAgICAgICAkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcl9pZD1zaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzaW5lc3NfdXNlcl9pZDsKICAgICAgICAgICAgICBsb2dEZWJ1ZygiJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJfaWQ9Iiskc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcl9pZCk7CgogICAgICAgICAgICAgICRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyPXRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICB9LAovLyBzZWxlY3Q6IGZ1bmN0aW9uKHN0YXJ0LCBlbmQsIGFsbERheSkgewovLyAgICAgLy8gdmFyIHRpdGxlID0gcHJvbXB0KCdFdmVudCBUaXRsZTonICsgKHN0YXJ0ICsgMzUyODAwMDAwKSAvICg2MCAqIDEwMDApICsgIiAiICsgZW5kICsgIiAiICsgYWxsRGF5KTsKLy8gICAgIHRpdGxlID0gItep16LXldeqINek16LXmdec15XXqiI7Ci8vICAgICBpZiAodGl0bGUpIHsKLy8gICAgICAgICBsb2dEZWJ1ZygiY3JlYXRpbmcgZGV2ZW50IHN0YXJ0Iik7Ci8vICAgICAgICAgbG9nRGVidWcoInN0YXJ0PSIgKyBzdGFydCk7Ci8vICAgICAgICAgY2hlY2tEYXRlID0gbmV3IERhdGUoc3RhcnQpOwovLyAgICAgICAgIGxvZ0RlYnVnKCJjaGVjayBkYXRlID0gIiArIGNoZWNrRGF0ZSkKLy8gICAgICAgICBsb2dEZWJ1ZygiZW5kPSIgKyBlbmQpOwovLyAgICAgICAgIGVjb2xvciA9ICIjIiArICRzY29wZS5ldmVudENvbG9yOyAvL2dldFJhbmRvbUNvbG9yKCk7Ci8vCi8vCi8vICAgICAgICAgLy8gdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbXS5mdWxsQ2FsZW5kYXIoJ3JlcmVuZGVyRXZlbnRzJyk7Ci8vCi8vICAgICAgICAgY2FsZW5kYXIgPSAkc2NvcGUuY2FsZW5kYXJfbmFtZTsKLy8gICAgICAgICB0ZW1wX2xpbWl0X2lkID0gJGdDYWxlbmRhclRlbXBFbnZJRDEgLSBnZXRSYW5kb21JbnQoMTAsIDgwKTsKLy8gICAgICAgICBuZXdFdmVudCA9IHsKLy8gICAgICAgICAgICAgaWQ6IHRlbXBfbGltaXRfaWQsCi8vICAgICAgICAgICAgIHRpdGxlOiB0aXRsZSwKLy8gICAgICAgICAgICAgc3RhcnQ6IHN0YXJ0LAovLyAgICAgICAgICAgICBjb2xvcjogZWNvbG9yLAovLyAgICAgICAgICAgICBlbmQ6IGVuZCwKLy8gICAgICAgICAgICAgYWxsRGF5OiBmYWxzZSwKLy8gICAgICAgICAgICAgY2xhc3NOYW1lOiBbJ29wZW5TZXNhbWUnXQovLyAgICAgICAgICAgICAgICAgLy8gY29sb3I6IHJlc291cmNlLmV2ZW50Q29sb3IKLy8gICAgICAgICB9OwovLyAgICAgICAgIGNhbGVuZGFyID0gJHNjb3BlLmNhbGVuZGFyX25hbWU7Ci8vCi8vICAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVuZGVyRXZlbnQnLCBuZXdFdmVudCwgdHJ1ZSk7Ci8vICAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigndW5zZWxlY3QnKTsKLy8KLy8gICAgICAgICBsb2dEZWJ1ZygiY3JlYXRpbmcgZGV2ZW50IGVuZCIpOwovLyAgICAgICAgICRzY29wZS5hZGRFdmVudFRvRGF0YWJhc2Uoc3RhcnQsIGVuZCwgdGl0bGUsIGVjb2xvciwgdGVtcF9saW1pdF9pZCk7Ci8vCi8vICAgICB9Ci8vIH0KICAgIH0KICB9Owp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ0hvdXJzT2ZXb3JrQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRjb21waWxlLCAkbG9jYXRpb24sIHVpQ2FsZW5kYXJDb25maWcsICR1aWJNb2RhbCkgewogIGxvZ0RlYnVnKCdIb3Vyc09mV29yayBDb250cm9sbGVyJyk7CgogIGxvZ0RlYnVnKCIkbG9jYXRpb24uc2VhcmNoKCkuc3RhcnQ9IiArICRsb2NhdGlvbi5zZWFyY2goKS5zdGFydCk7CiAgaWYgKHR5cGVvZiAkbG9jYXRpb24uc2VhcmNoKCkuc3RhcnQgPT0gJ3VuZGVmaW5lZCcpIHsKICAgIGN1cnJEZWZhdWx0RGF0ZSA9ICRnSG91cjBkYXRlOwogICAgJHNjb3BlLmZpeGVkU2NoZWR1bGUgPSB0cnVlOwogICAgJHNjb3BlLmNhbGVuZGFyVGl0bGVDZW50ZXIgPSAi16nXoteV16og16TXoteZ15zXldeqINen15HXldei15XXqiI7CiAgICBsb2dEZWJ1Zygi16nXoteV16og16TXoteZ15zXldeqINen15HXldei15XXqiIpOwogICAgaG91cnNPZldvcmtEZWZhdWx0Vmlldz0nZG9udFNob3dEYXRlJzsKICB9IGVsc2UgewogICAgY3VyckRlZmF1bHREYXRlID0gJGxvY2F0aW9uLnNlYXJjaCgpLnN0YXJ0OwogICAgJHNjb3BlLmZpeGVkU2NoZWR1bGUgPSBmYWxzZTsKLy8gJHNjb3BlLmNhbGVuZGFyVGl0bGVDZW50ZXIgPSAi16nXoteV16og16TXoteZ15zXldeqINen15HXldei15XXqiI7CiAgICBob3Vyc09mV29ya0RlZmF1bHRWaWV3PSdhZ2VuZGFXZWVrJzsKICB9CgoKICAkc2NvcGUudmlzaWJsZURhdGUgPSBbXTsKICAkc2NvcGUuY2FsZW5kYXIgPSAnY2FsZW5kYXJfaG91cnNfb2Zfd29yayc7CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnRUeXBlID0gW107CgogIGdldEFsbEJ1c2luZXNzRXZlbnRUeXBlcygkaHR0cCwkc2NvcGUsJ2V2ZW50X3R5cGVzJyxnZXRBbGxCdXNpbmVzc0V2ZW50VHlwZXNfY2FsbGJhY2spOwoKICBmdW5jdGlvbiBnZXRBbGxCdXNpbmVzc0V2ZW50VHlwZXNfY2FsbGJhY2soKQogIHsKICAgICRzY29wZS5zZWxlY3RFdmVudFR5cGUoJHNjb3BlLmV2ZW50X3R5cGVzWzBdKTsKICB9CiAgJHNjb3BlLmJhY2tUb0NhbGVuZGFyID0gZnVuY3Rpb24oKSB7CiAgICB2aXNpYmxlRGF0ZVN0YXJ0ID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5zdGFydCk7CiAgICBkYXRlVG9Hb1RvID0gdmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpICsgIi0iICsgKCcwJyArICh2aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkgKyAxKSkuc2xpY2UoLTIpICsgIi0iICsgKCcwJyArIHZpc2libGVEYXRlU3RhcnQuZ2V0RGF0ZSgpKS5zbGljZSgtMik7CiAgICAkbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2NhbGVuZGFyJykuc2VhcmNoKHsKICAgICAgc3RhcnQ6IGRhdGVUb0dvVG8KICAgIH0pOwogIH0KICAkc2NvcGUuc2VsZWN0RXZlbnRUeXBlID0gZnVuY3Rpb24oZXZlbnRUeXBlKSB7CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudFR5cGUgPSBldmVudFR5cGU7CiAgICBsb2dEZWJ1Zygic2VsZWN0ZWQgRXZlbnQgVHlwZSA9ICIgKyAkc2NvcGUuc2VsZWN0ZWRFdmVudFR5cGUuZXZlbnRfdHlwZV9pZCArICIsICIgKyAkc2NvcGUuc2VsZWN0ZWRFdmVudFR5cGUuZXZlbnRfdHlwZV9uYW1lKTsKICAgIGt1emVJc0NhbGVuZGFyRHJhZ2dibGUgPSAkc2NvcGUuc2VsZWN0ZWRFdmVudFR5cGUuZGlmZl9yYW5nZTsKICB9OwoKICAkc2NvcGUuY2hhbmdlRXZlbnRDb2xvciA9IGZ1bmN0aW9uKG5ld0NvbG9yKSB7CiAgICAkc2NvcGUuZXZlbnRDb2xvciA9IG5ld0NvbG9yOwogICAgYWxsbEV2ZW50c0FycmF5ID0gdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignY2xpZW50RXZlbnRzJyk7CiAgICBmb3IgKGkgaW4gYWxsbEV2ZW50c0FycmF5KSB7CiAgICAgIGFsbGxFdmVudHNBcnJheVtpXS5jb2xvciA9ICIjIiArIG5ld0NvbG9yOwogICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCd1cGRhdGVFdmVudCcsIGFsbGxFdmVudHNBcnJheVtpXSk7CiAgICB9CiAgfTsKCiAgJHNjb3BlLmV2ZW50Q2xpY2tNb2R1bGUgPSBmdW5jdGlvbihzZWxlY3RlZEV2ZW50LCBzaXplKSB7CiAgICBsb2dEZWJ1Zygic2VsZWN0ZWQgRXZlbnQgdGl0bGU9IiArIHNlbGVjdGVkRXZlbnQudGl0bGUpOwoKCiAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAgICAgYW5pbWF0aW9uOiBmYWxzZSwKICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfbGltaXRhdGlvbl9kZXRhaWxzLmh0bWwnLAogICAgICBjb250cm9sbGVyOiAnZXZlbnREZXRhaWxzSG91cnNPZldvcmtNb2RhbENvbnRyb2xsZXInLAogICAgICBzaXplOiBzaXplLAogICAgICByZXNvbHZlOiB7CiAgICAgICAgc2VsZWN0ZWRFdmVudDogZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gc2VsZWN0ZWRFdmVudDsKICAgICAgICB9LAogICAgICAgIGZpeGVkU2NoZWR1bGU6IGZ1bmN0aW9uICgpCiAgICAgICAgewogICAgICAgICAgcmV0dXJuICRzY29wZS5maXhlZFNjaGVkdWxlOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CgogICAgbW9kYWxJbnN0YW5jZS5yZXN1bHQudGhlbihmdW5jdGlvbihzZWxlY3RlZEl0ZW0pIHsKICAgICAgJHNjb3BlLnNlbGVjdGVkID0gc2VsZWN0ZWRJdGVtOwogICAgfSwgZnVuY3Rpb24oKSB7CiAgICAgIGxvZ0RlYnVnKCdNb2RhbCBkaXNtaXNzZWQgYXQ6ICcgKyBuZXcgRGF0ZSgpKTsKICAgIH0pOwogIH07CgoKICB2YXIgZGF0ZSA9IG5ldyBEYXRlKCk7CiAgdmFyIGQgPSBkYXRlLmdldERhdGUoKTsKICB2YXIgbSA9IGRhdGUuZ2V0TW9udGgoKTsKICB2YXIgeSA9IGRhdGUuZ2V0RnVsbFllYXIoKTsKCgogIGZ1bmN0aW9uIGdldFRpbWVTdGFtcChub3cpIHsKICAgIHJldHVybiAoKG5vdy5nZXRNb250aCgpICsgMSkgKyAnLycgKyAobm93LmdldERhdGUoKSkgKyAnLycgKyBub3cuZ2V0RnVsbFllYXIoKSArICIgIiArIG5vdy5nZXRIb3VycygpICsgJzonICsgKChub3cuZ2V0TWludXRlcygpIDwgMTApID8gKCIwIiArIG5vdy5nZXRNaW51dGVzKCkpIDogKG5vdy5nZXRNaW51dGVzKCkpKSArICc6JyArICgobm93LmdldFNlY29uZHMoKSA8IDEwKSA/ICgiMCIgKyBub3cKICAgICAgICAuZ2V0U2Vjb25kcygpKSA6IChub3cuZ2V0U2Vjb25kcygpKSkpOwogIH0KCgogIC8qIENoYW5nZSBWaWV3ICovCiAgJHNjb3BlLmNoYW5nZVZpZXcgPSBmdW5jdGlvbih2aWV3LCBjYWxlbmRhcikgewogICAgbG9nRGVidWcoImNoYW5nZSB2aWV3ICIgKyB2aWV3KTsKICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2NoYW5nZVZpZXcnLCB2aWV3KTsKICB9OwogIC8qIENoYW5nZSBWaWV3ICovCgogICRzY29wZS5yZW5kZXJDYWxlbmRlciA9IGZ1bmN0aW9uKGNhbGVuZGFyKSB7CiAgICAkdGltZW91dChmdW5jdGlvbigpIHsKICAgICAgaWYgKHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXSkgewogICAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlbmRlcicpOwogICAgICB9CiAgICB9KTsKICB9OwoKICAkc2NvcGUuY2hhbmdlU2VsZWN0YWJsZSA9IGZ1bmN0aW9uKCkgewogICAga3V6ZUlzQ2FsZW5kYXJEcmFnZ2JsZSA9ICFrdXplSXNDYWxlbmRhckRyYWdnYmxlOwogICAgY2FsZW5kYXIgPSAnY2FsZW5kYXJfaG91cnNfb2Zfd29yayc7Ci8vIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5jYWxlbmRhci5vcHRpb25zLnNlbGVjdGFibGUgPSBmYWxzZTsKICAgIHZpZXcgPSB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdvcHRpb24nLCAnc2VsZWN0YWJsZScsIGZhbHNlKTsKLy8gdmlldy5jYWxlbmRhci5vcHRpb25zLnNlbGVjdGFibGUgPSBmYWxzZTsKICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlbmRlcicpOwoKICB9CiAgLyogY29uZmlnIG9iamVjdCAqLwoKICAkc2NvcGUuY2FsZW5kYXJfaG91cnNfb2Zfd29ya19jb25maWcgPSB7CiAgICBjYWxlbmRhcjogewogICAgICBoZWlnaHQ6ICdhdXRvJywKICAgICAgZWRpdGFibGU6IHRydWUsCi8vIGhlYWRlcjogewovLyAgICAgbGVmdDogJycsCi8vICAgICBjZW50ZXI6ICcnLAovLyAgICAgcmlnaHQ6ICcnCi8vIH0sCiAgICAgIGhlYWRlcjogJycsCi8vIGhlYWRlcjogewovLyAgICAgbGVmdDogJ3RpdGxlJywKLy8gICAgIGNlbnRlcjogJycsCi8vICAgICByaWdodDogJ3RvZGF5IHByZXYsbmV4dCcKLy8gfSwKLy8gZGVmYXVsdFZpZXc6ICdhZ2VuZGFXZWVrJywKICAgICAgdmlld3M6IHsKICAgICAgICBkb250U2hvd0RhdGU6IHsKICAgICAgICAgIHR5cGU6ICdhZ2VuZGFXZWVrJywKICAgICAgICAgIGR1cmF0aW9uOiB7CiAgICAgICAgICAgIGRheXM6IDcKICAgICAgICAgIH0sCiAgICAgICAgICB0aXRsZTogJ0FwZXJ0dXJhJywKICAgICAgICAgIGNvbHVtbkZvcm1hdDogJ2RkZGQnIC8vIEZvcm1hdCB0aGUgZGF5IHRvIG9ubHkgc2hvdyBsaWtlICdNb25kYXknCi8vIGhpZGRlbkRheXM6IFswLCA2XSAvLyBIaWRlIFN1bmRheSBhbmQgU2F0dXJkYXk/CiAgICAgICAgfSwKICAgICAgICBkb1Nob3dEYXRlOiB7CiAgICAgICAgICB0eXBlOiAnYWdlbmRhV2VlaycsCiAgICAgICAgICBkdXJhdGlvbjogewogICAgICAgICAgICBkYXlzOiA3CiAgICAgICAgICB9LAogICAgICAgICAgdGl0bGU6ICdBcGVydHVyYScsCgovLyBoaWRkZW5EYXlzOiBbMCwgNl0gLy8gSGlkZSBTdW5kYXkgYW5kIFNhdHVyZGF5PwogICAgICAgIH0KICAgICAgfSwKICAgICAgZXZlbnREcm9wOiBmdW5jdGlvbihldmVudCwgZGF5RGVsdGEsIG1pbnV0ZURlbHRhLCBhbGxEYXksIHJldmVydEZ1bmMsIHVpQ2FsZW5kYXJDb25maWcpIHsKICAgICAgICBsb2dEZWJ1ZygiZXZlbnRkcm9wIiArIGV2ZW50LnRpdGxlICsgIigiICsgZXZlbnQuaWQgKyAiKSBtb3ZlZCAiICsgbWludXRlRGVsdGEgKyAiIG1pbnV0ZXMiKTsKICAgICAgICBsb2dEZWJ1Zygib2xkIHN0YXJ0PSIgKyBldmVudC5zdGFydCArICIsIG9sZCBlbmQ9IiArIGV2ZW50LmVuZCk7CiAgICAgICAgJHNjb3BlLnVwZGF0ZUxpbWl0YXRpb25EYXRhYmFzZShldmVudC5zdGFydCwgZXZlbnQuZW5kLCBldmVudC5pZCwgZXZlbnQudGVtcF9saW1pdF9pZCwgZXZlbnQpOwogICAgICB9LAogICAgICBldmVudFJlc2l6ZTogZnVuY3Rpb24oZXZlbnQsIGRlbHRhLCByZXZlcnRGdW5jKSB7CiAgICAgICAgbG9nRGVidWcoImV2ZW50cmVzaXplLCBldmVudC5lbmQ9IiArIGV2ZW50LmVuZCk7CiAgICAgICAgJHNjb3BlLnVwZGF0ZUxpbWl0YXRpb25EYXRhYmFzZShldmVudC5zdGFydCwgZXZlbnQuZW5kLCBldmVudC5pZCwgZXZlbnQudGVtcF9saW1pdF9pZCwgZXZlbnQpOwogICAgICB9LAogICAgICBkZWZhdWx0VmlldzogaG91cnNPZldvcmtEZWZhdWx0VmlldywKICAgICAgZXZlbnRDbGljazogZnVuY3Rpb24oY2FsRXZlbnQsIGpzRXZlbnQsIHZpZXcpIHsKICAgICAgICBsb2dEZWJ1ZygiZXZlbnQgY2xpY2tlZCAiICsgY2FsRXZlbnQudGl0bGUgKyAiKGlkPSIgKyBjYWxFdmVudC5pZCArICIsIGRheV9saW1pdF9pZD0iICsgY2FsRXZlbnQuZGF5X2xpbWl0X2lkICsgIiwgdGVtcF9saW1pdF9pZD0iICsgY2FsRXZlbnQudGVtcF9saW1pdF9pZCArICIsIGxpbWl0X2lkPSIgKyBjYWxFdmVudC5saW1pdF9pZCArICIpIHN0YXJ0PSIgKyBjYWxFdmVudC5zdGFydCArICIsIGVuZD0iICsgY2FsRXZlbnQuZW5kKTsKICAgICAgICAkc2NvcGUuZXZlbnRDbGlja01vZHVsZShjYWxFdmVudCk7Ci8vIGNoYW5nZSB0aGUgYm9yZGVyIGNvbG9yIGp1c3QgZm9yIGZ1bgovLyAkKHRoaXMpLmNzcygnYm9yZGVyLWNvbG9yJywgJ3JlZCcpOwoKICAgICAgfSwKICAgICAgZXZlbnRSZW5kZXI6IGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KQogICAgICB7CiAgICAgICAgY29uc29sZS5sb2coZXZlbnQpOwogICAgICAgIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZChldmVudC5sb2NhdGlvbl9uYW1lKyIgLyA8YnIvPiIpOwogICAgICAgIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZChldmVudC5pbnN0cnVjdG9yX25hbWUrIiAvIDxici8+Iik7Ci8vIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZCgiIitldmVudC5ldmVudFVzZXJzWzBdLmJ1c2VyX2ZpcnN0X25hbWUrIiAiK2V2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfbGFzdF9uYW1lKyIgKCIpOwoKLy8gY29uc29sZS5sb2coInJlbmRlciBsaW1pdGF0aW9uICIrSlNPTi5zdHJpbmdpZnkoZXZlbnQpKTsKLy8gaWYgKGV2ZW50LmlzX2NsYXNzPT0xKQovLyB7Ci8vICAgLy8gaWYgY2xhc3MgYWRkaW5nIG51bWJlciBvZiBwYXJ0aWNpcGFudHMKLy8gICBpZiAoZXZlbnQubm9fb2Zfd2FpdGluZ191c2Vycz4wKQovLyAgIHsKLy8gICAgIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZChldmVudC5ub19vZl91c2VycysiLyIrZXZlbnQubWF4X3BhcnRpY2lwYW50cysgIiAoIitldmVudC5ub19vZl93YWl0aW5nX3VzZXJzKyIpIisiIC0gIik7Ci8vICAgfQovLyAgIGVsc2UKLy8gICB7Ci8vICAgICBlbGVtZW50LmZpbmQoJy5mYy10aXRsZScpLnByZXBlbmQoZXZlbnQubm9fb2ZfdXNlcnMrIi8iK2V2ZW50Lm1heF9wYXJ0aWNpcGFudHMrIiAtICIpOwovLyAgIH0KLy8gfQovLyBlbHNlCi8vIHsKLy8gICAvLyBpZiBub3QgY2xhc3MgLSB3cml0aW5nIHRoZSBlbmR1c2VyIG5hbWUKLy8gICBpZiAoZXZlbnQuZHVyYXRpb25fZXZlbnQhPTApIC8vIGFsc28gaWYgbm90IGhvdXJzIG9mIHdvcmsKLy8gICB7Ci8vICAgICAvLyBlbGVtZW50LmZpbmQoJy5mYy10aXRsZScpLmFwcGVuZCgiICgiK2V2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfZmlyc3RfbmFtZSsiICIrZXZlbnQuZXZlbnRVc2Vyc1swXS5idXNlcl9sYXN0X25hbWUrIikiKTsKLy8gICAgIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZCgiIitldmVudC5ldmVudFVzZXJzWzBdLmJ1c2VyX2ZpcnN0X25hbWUrIiAiK2V2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfbGFzdF9uYW1lKyIgKCIpOwovLyAgICAgZWxlbWVudC5maW5kKCcuZmMtdGl0bGUnKS5hcHBlbmQoIikiKTsKLy8gICB9Ci8vICAgLy8gbG9nRGVidWcoImhlcmU0Iik7Ci8vIH0KLy8gaWYgKGV2ZW50LmlzX3JlcGVhdGluZyA9PSAxKSB7Ci8vICAgICBlbGVtZW50LmZpbmQoIi5mYy10aXRsZSIpLnByZXBlbmQoIiZuYnNwOzxpIGNsYXNzPSdmYSBmYS1yZXBlYXQnPjwvaT4mbmJzcDsiKTsKLy8gICAgIC8vICBlbGVtZW50LmZpbmQoIi5mYy10aXRsZSIpLmFwcGVuZCgiJm5ic3A7PGltZyBzcmM9Jy9wdWJsaWMvaW1hZ2VzL3JlY3VycmluZy1pY29uLnBuZycgd2lkdGg9JzEwcHgnIGhlaWdodD0nMTBweCcvPiIpOwovLyB9CiAgICAgIH0sCiAgICAgIG1pblRpbWU6ICRnQ2FsZW5kYXJEaXNwbGF5TWluVGltZSwKICAgICAgbWF4VGltZTogJGdDYWxlbmRhckRpc3BsYXlNYXhUaW1lLAogICAgICBzZWxlY3RhYmxlOiB0cnVlLAogICAgICBzZWxlY3RIZWxwZXI6IGZhbHNlLAogICAgICB0aW1lem9uZTogZmFsc2UsCiAgICAgIGlzUlRMOiB0cnVlLAogICAgICBsYW5nOiAiaGUiLAogICAgICBzZWxlY3RDb25zdHJhaW50OiB7CiAgICAgICAgc3RhcnQ6ICcwMDowMScsCiAgICAgICAgZW5kOiAnMjM6NTknLAogICAgICB9LAogICAgICBkZWZhdWx0RGF0ZTogbW9tZW50KGN1cnJEZWZhdWx0RGF0ZSksCiAgICAgIGFsbERheVNsb3Q6IGZhbHNlLAogICAgICBsb2FkaW5nOiBmdW5jdGlvbihib29sKSB7CiAgICAgICAgaWYgKGJvb2wpIHsKICAgICAgICAgIGxvZ0RlYnVnKCdsb2FkaW5nIGNhbGVuZGFyMiAnICsgJHNjb3BlLmNhbGVuZGFyKTsKCi8vICQoJyNsb2FkaW5nJykuc2hvdygpOwogICAgICAgIH0gZWxzZSB7Ci8vICQoJyNsb2FkaW5nJykuaGlkZSgpOwogICAgICAgICAgbG9nRGVidWcoJ2ZpbmlzaGVkIGxvYWRpbmcgY2FsZW5kYXIgJyArICRzY29wZS5jYWxlbmRhcik7CiAgICAgICAgICBpZiAoISRzY29wZS5maXhlZFNjaGVkdWxlKSB7CiAgICAgICAgICAgICRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlKCk7CiAgICAgICAgICB9Ci8vICRzY29wZS5iYWNrVG9GaXhlZCgpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgc2VsZWN0OiBmdW5jdGlvbihzdGFydCwgZW5kLCBhbGxEYXkpIHsKLy8gdGhpcyBpcyBjYWxsZWQgd2hlbiBjcmVhdGluZyBhIG5ldyBibG9jawogICAgICAgICRzY29wZS5jcmVhdGVMaW1pdGF0aW9uQmxvY2soc3RhcnQsIGVuZCk7CiAgICAgIH0KICAgIH0KICB9OwoKLy8gY3JlYXRlIGxpbWl0YXRpb24gYmxvY2sKICAkc2NvcGUuY3JlYXRlTGltaXRhdGlvbkJsb2NrID0gZnVuY3Rpb24oc3RhcnQsIGVuZCkKICB7CiAgICBsb2dEZWJ1ZygiZnVuY3Rpb246IGNyZWF0ZUxpbWl0YXRpb25CbG9jayIpOwogICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2xpbWl0YXRpb25fY3JlYXRlLnBocCcsCiAgICAgIHNpemU6ICd4cycsCiAgICAgIGNvbnRyb2xsZXI6ICdidXNpbmVzc19tb2RhbF9saW1pdGF0aW9uX2NyZWF0ZScsCiAgICAgIHJlc29sdmU6IHsKICAgICAgICBzdGFydDogZnVuY3Rpb24oKQogICAgICAgIHsKICAgICAgICAgIHJldHVybiBzdGFydDsKICAgICAgICB9LAogICAgICAgIGVuZDogZnVuY3Rpb24oKQogICAgICAgIHsKICAgICAgICAgIHJldHVybiBlbmQ7CiAgICAgICAgfSwKICAgICAgICBmaXhlZFNjaGVkdWxlOiBmdW5jdGlvbiAoKQogICAgICAgIHsKICAgICAgICAgIHJldHVybiAkc2NvcGUuZml4ZWRTY2hlZHVsZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogIH0KICAkc2NvcGUudXBkYXRlQ2FsZW5kYXJDZW50ZXJUaXRsZSA9IGZ1bmN0aW9uKCkgewogICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKTsKCiAgICB2aXNpYmxlRGF0ZVN0YXJ0ID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5zdGFydCk7CiAgICB2aXNpYmxlRGF0ZUVuZCA9IG5ldyBEYXRlKHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3JykuZW5kKTsKCiAgICAkc2NvcGUuY2FsZW5kYXJUaXRsZUNlbnRlciA9IHZpc2libGVEYXRlU3RhcnQuZ2V0RGF0ZSgpICsgIiAiICsgbW9udGhOYW1lc1t2aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCldICsKICAgICAgICAiIOKAlCAiICsgdmlzaWJsZURhdGVFbmQuZ2V0RGF0ZSgpICsgIiAiICsgbW9udGhOYW1lc1t2aXNpYmxlRGF0ZUVuZC5nZXRNb250aCgpXSArCiAgICAgICAgIiAiICsgdmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpOwogIH07CiAgLyogZXZlbnQgc291cmNlcyBhcnJheSovCiAgJHNjb3BlLmV2ZW50U291cmNlcyA9IFt7CiAgICB1cmw6ICcvYXBpL2FkbWluL2NhbGVuZGFyL2xpbWl0YXRpb25zL3BlcmRheS9nZXRwb3N0JywKICAgIHR5cGU6ICdQT1NUJwogIH1dOwoKLy8gJHNjb3BlLmdldEV2ZW50cyA9IGZ1bmN0aW9uKCkgewovLyAgICAgY2FsZW5kYXIgPSAnY2FsZW5kYXJfaG91cnNfb2Zfd29yayc7Ci8vICAgICBhbGxsRXZlbnRzQXJyYXkgPSB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdjbGllbnRFdmVudHMnKTsKLy8gICAgIGZvciAoaSBpbiBhbGxsRXZlbnRzQXJyYXkpIHsKLy8gICAgICAgICBsb2dEZWJ1ZyhhbGxsRXZlbnRzQXJyYXlbaV0pOwovLyAgICAgfQovLwovLyB9CgogICRzY29wZS5nb3RvVG9kYXkgPSBmdW5jdGlvbigpIHsKICAgICRzY29wZS5nb3RvRGF0ZShuZXcgRGF0ZSgpKTsKICB9CiAgJHNjb3BlLmdvdG9OZXh0ID0gZnVuY3Rpb24oKSB7CiAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignbmV4dCcpOwogICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlbW92ZUV2ZW50cycpOwogICAgJHNjb3BlLnVwZGF0ZUNhbGVuZGFyQ2VudGVyVGl0bGUoKTsKICB9CiAgJHNjb3BlLmdvdG9QcmV2ID0gZnVuY3Rpb24oKSB7CiAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVtb3ZlRXZlbnRzJyk7CiAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncHJldicpOwogICAgJHNjb3BlLnVwZGF0ZUNhbGVuZGFyQ2VudGVyVGl0bGUoKTsKICB9CiAgJHNjb3BlLmdvdG9EYXRlID0gZnVuY3Rpb24obmV3ZGF0ZSkgewogICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dvdG9EYXRlJywgbmV3ZGF0ZSk7CiAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignY2hhbmdlVmlldycsICdhZ2VuZGFXZWVrJyk7CiAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVtb3ZlRXZlbnRzJyk7CiAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwoKICAgICRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlKCk7CiAgICAkc2NvcGUuZml4ZWRTY2hlZHVsZSA9IGZhbHNlOwogIH0KCiAgJHNjb3BlLmJhY2tUb0ZpeGVkID0gZnVuY3Rpb24oKSB7CiAgICAkc2NvcGUuZml4ZWRTY2hlZHVsZSA9IHRydWU7CiAgICAkc2NvcGUuY2FsZW5kYXJUaXRsZUNlbnRlciA9ICLXqdei15XXqiDXpNei15nXnNeV16og16fXkdeV16LXldeqIjsKICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdjaGFuZ2VWaWV3JywgJ2RvbnRTaG93RGF0ZScpOwogICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dvdG9EYXRlJywgbW9tZW50KCRnSG91cjBkYXRlKSk7CiAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVtb3ZlRXZlbnRzJyk7CiAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwoKICB9CgovLyAkc2NvcGUuZGVsZXRlQWxsRXZlbnRzID0gZnVuY3Rpb24oKSB7Ci8vICAgICBjYWxlbmRhciA9ICdjYWxlbmRhcl9ob3Vyc19vZl93b3JrJzsKLy8gICAgIGFsbGxFdmVudHNBcnJheSA9IHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2NsaWVudEV2ZW50cycpOwovLyAgICAgZm9yIChpIGluIGFsbGxFdmVudHNBcnJheSkgewovLyAgICAgICAgIGxvZ0RlYnVnKGFsbGxFdmVudHNBcnJheVtpXSk7Ci8vICAgICAgICAgJHNjb3BlLmRlbGV0ZUNhbGVuZGFySlNFdmVudChjYWxlbmRhciwgYWxsbEV2ZW50c0FycmF5W2ldLmlkKTsKLy8gICAgICAgICAkc2NvcGUuZGVsZXRlQ2FsZW5kYXJEQkV2ZW50KGFsbGxFdmVudHNBcnJheVtpXS5pZCk7Ci8vICAgICB9Ci8vCi8vIH0KICAkc2NvcGUudXBkYXRlTGltaXRhdGlvbkRhdGFiYXNlID0gZnVuY3Rpb24oc3RhcnRfcGFyYW0sIGVuZF9wYXJhbSwgZXZlbnRfaWQsIHRlbXBfbGltaXRfaWQsIHRoZWV2ZW50KSB7CgogICAgbG9nRGVidWcoInVwZGF0ZUxpbWl0YXRpb25EYXRhYmFzZSBzdGFydD0iICsgc3RhcnRfcGFyYW0gKyAiLCBlbmQ9IiArIGVuZF9wYXJhbSArICIsZXZlbnRfaWQ9IiArIGV2ZW50X2lkKTsKCiAgICBmdW5jdGlvbiB1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25fZmFpbHVyZSgpCiAgICB7CiAgICAgIGNhbGVuZGFyID0gImNhbGVuZGFyX2hvdXJzX29mX3dvcmsiOwogICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZWZldGNoRXZlbnRzJyk7CiAgICB9Ci8vIGlmIHRoZSBldmVudCB0aGF0IGlzIGdldHRpbmcgdXBkYXRlZCBpcyBhbiBldmVudCBmcm9tIDE5NzAgKG5vdCBwZXJkYXkpCi8vIHRoZW4gd2UgYWRkIGEgbmV3IHBlcmRheSBsaW1pdGF0aW9uIHdpdGggbGltaXRfaWQgb2YgdGhlIDE5NzAgbGltaXRhdGlvbnMgLSB3aXRoIHRoZSBuZXcgdGltZXMuCgovLyBvdGhlcndpc2Ugd2UganVzdCB1cGRhdGUgdGhlIHBlcmRheSBsaW1pdGF0aW9uCgogICAgaWYgKCRzY29wZS5maXhlZFNjaGVkdWxlKSAvLyBmaXhlZCBzY2hlZHVsZSB2cyBzcGVjaWZpYyB3ZWVkL2RheSBsaW1pdGF0aW9uCiAgICB7CiAgICAgIHRoZWRhdGEgPSB7CiAgICAgICAgc3RhcnRfZGF0ZTogc3RhcnRfcGFyYW0sCiAgICAgICAgZW5kX2RhdGU6IGVuZF9wYXJhbSwKICAgICAgICB0ZW1wX2xpbWl0X2lkOiB0ZW1wX2xpbWl0X2lkLAogICAgICAgIGxpbWl0X2lkOiBldmVudF9pZAogICAgICB9OwoKICAgICAgdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uKCRodHRwLCRzY29wZSx0aGVkYXRhLGV2ZW50X2lkLCBudWxsLCB1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25fZmFpbHVyZSk7CiAgICB9CiAgICBlbHNlIC8vIG5vdCBmaXhlZCBzY2hlZHVsZSAtIGRhaWx5L3dlZWtseSBsaW1pdGF0aW9ucwogICAgewogICAgICBpZiAoKHRoZWV2ZW50LmxpbWl0X2lkICE9IG51bGwpICYgKHRoZWV2ZW50LmRheV9saW1pdF9pZCA9PSAtMSkpIC8vIGV2ZW50IGxpbWl0YXRpb24gaGFzIGxpbWl0X2lkIHNvIGl0cyBhbiAxOTcwIGV2ZW50Ci8vIG5lZWQgdG8gYWRkIGEgbmV3IHBlcmRheSBsaW1pdGF0aW9uIHRoYXQgcG9pbnQgKGxpbWl0X2lkKSB0byB0aGUgb2xkIDE5NzAgZXZlbnQgdG8gY2FuY2VsIGl0CiAgICAgIHsKICAgICAgICB0ZW1wX2xpbWl0X2lkID0gY2FsY190ZW1wX2xpbWl0X2lkKCk7CiAgICAgICAgdGhlZXZlbnQudGVtcF9saW1pdF9pZCA9IHRlbXBfbGltaXRfaWQ7CiAgICAgICAgdGhlZXZlbnQuZGF5X2xpbWl0X2lkID0gdGVtcF9saW1pdF9pZDsKLy8gdGhlIG1vdmVkIGV2ZW50IGluIHRoZSBjYWxlbmRhciBub3cgaGFzIGRheV9saW1pdF9pZCBhbmQgdGVtcF9saW1pdF9pZAovLyBpZiBpdHMgbG9hZGVkIGZyb20gdGhlIGRiLCBpdCB3aWxsIG9ubHkgaGF2ZSBkYXlfbGltaXRfaWQgKGFuZCBub3QgdGhlIHRlbXAgb25lKQogICAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWydjYWxlbmRhcl9ob3Vyc19vZl93b3JrJ10uZnVsbENhbGVuZGFyKCd1cGRhdGVFdmVudCcsIHRoZWV2ZW50KTsKCiAgICAgICAgdGhlZGF0YSA9IHsKICAgICAgICAgIHN0YXJ0X2RhdGU6IHN0YXJ0X3BhcmFtLAogICAgICAgICAgZW5kX2RhdGU6IGVuZF9wYXJhbSwKICAgICAgICAgIGNvbG9yOiB0aGVldmVudC5jb2xvciwKICAgICAgICAgIHRlbXBfbGltaXRfaWQ6IHRlbXBfbGltaXRfaWQsCiAgICAgICAgICBldmVudF90eXBlX2lkOiB0aGVldmVudC5ldmVudF90eXBlX2lkLAogICAgICAgICAgZXZlbnRfdHlwZXM6IHRoZWV2ZW50LmV2ZW50X3R5cGVzLAogICAgICAgICAgbG9jYXRpb25faWQ6IHRoZWV2ZW50LmxvY2F0aW9uX2lkLAogICAgICAgICAgZW1wX2lkOiB0aGVldmVudC5lbXBfaWQsCiAgICAgICAgICBsaW1pdF9pZDogdGhlZXZlbnQuaWQsCiAgICAgICAgICB0aXRsZTogdGhlZXZlbnQudGl0bGUKICAgICAgICB9OwogICAgICAgIGNyZWF0ZUNhbGVuZGFyTGltaXRhdGlvblBlckRheSgkaHR0cCwkc2NvcGUsdGhlZGF0YSxudWxsLCB1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25fZmFpbHVyZSk7CgogICAgICB9CiAgICAgIGVsc2UgLy8gZXZlbnQgbGltaXRhdGlvbiB0byBtb3ZlL3VwZGF0ZSBoYXMgbm8gbGltaXRfaWQgLSBzbyB0aGlzIGlzIG5ldyBwZXJkYXkgZXZlbnQgLSB3ZSBqdXN0IHVwZGF0ZSBpdAogICAgICB7CiAgICAgICAgdGhlZGF0YT0gewogICAgICAgICAgc3RhcnRfZGF0ZTogc3RhcnRfcGFyYW0sCiAgICAgICAgICBlbmRfZGF0ZTogZW5kX3BhcmFtLAogICAgICAgICAgdGVtcF9kYXlfbGltaXRfaWQ6IHRoZWV2ZW50LnRlbXBfbGltaXRfaWQsCiAgICAgICAgICBsb2NhdGlvbl9pZDogdGhlZXZlbnQubG9jYXRpb25faWQsCiAgICAgICAgICBkYXlfbGltaXRfaWQ6IHRoZWV2ZW50LmRheV9saW1pdF9pZAogICAgICAgIH07CiAgICAgICAgdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5KCRodHRwLCRzY29wZSx0aGVkYXRhLG51bGwsIHVwZGF0ZUNhbGVuZGFyTGltaXRhdGlvbl9mYWlsdXJlKTsKICAgICAgfQogICAgfQogIH07Cn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdFdmVudENsYXNzUGFnZUNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICR0aW1lb3V0LCAkaHR0cCwgJHJvb3RTY29wZSwgJHJvdXRlUGFyYW1zLCAkbG9jYXRpb24sICRyb3V0ZSwgc2hhcmVkRGF0YSwgJHVpYk1vZGFsKQp7CiAgZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkKTsKICBnZXRBbGxDbGllbnRzKCRodHRwLCRzY29wZSwnZXZlbnRUeXBlVXNlcnMnKTsKICBnZXRCdXNpbmVzc0xvY2F0aW9ucygkaHR0cCwkc2NvcGUsJ2J1c2luZXNzX2xvY2F0aW9ucycpOwogIGdldEFsbEluc3RydWN0b3JzKCRodHRwLCRzY29wZSwnaW5zdHJ1Y3RvcnMnKTsKCiAgJHNjb3BlLnVwZGF0ZUV2ZW50VGl0bGUgPSBmdW5jdGlvbihuZXdWYWx1ZSxjdXJyZW50RXZlbnQpCiAgewogICAgbmV3X3RpdGxlPW5ld1ZhbHVlOwogICAgc2V0RXZlbnRUaXRsZSgkaHR0cCwkc2NvcGUsY3VycmVudEV2ZW50LmV2ZW50X2lkLCBuZXdfdGl0bGUsIHVwZGF0ZUV2ZW50X2NhbGxiYWNrLCB1cGRhdGVFdmVudF9jYWxsYmFjayk7CgogICAgZnVuY3Rpb24gdXBkYXRlRXZlbnRfY2FsbGJhY2soKQogICAgewogICAgICBnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkKTsKICAgIH0KCiAgfTsKCiAgJHNjb3BlLnVwZGF0ZUV2ZW50TWF4UGFydGljaXBhbnRzID0gZnVuY3Rpb24obmV3VmFsdWUsY3VycmVudEV2ZW50KQogIHsKICAgIG5ld19tYXhfcGFydGljaXBhbnRzPW5ld1ZhbHVlOwogICAgaWYgKCBuZXdfbWF4X3BhcnRpY2lwYW50cyA8IGN1cnJlbnRFdmVudC5ub19vZl91c2VycyApewogICAgICBzZXRFdmVudE1heFBhcnRpY2lwYW50cygkaHR0cCwkc2NvcGUsY3VycmVudEV2ZW50LmV2ZW50X2lkLCBjdXJyZW50RXZlbnQubm9fb2ZfdXNlcnMsIGN1cnJlbnRFdmVudC5ub19vZl91c2VycywgdXBkYXRlRXZlbnRfY2FsbGJhY2ssIHVwZGF0ZUV2ZW50X2NhbGxiYWNrKTsKICAgIH0gZWxzZSB7CiAgICAgIHNldEV2ZW50TWF4UGFydGljaXBhbnRzKCRodHRwLCRzY29wZSxjdXJyZW50RXZlbnQuZXZlbnRfaWQsIG5ld19tYXhfcGFydGljaXBhbnRzLCBjdXJyZW50RXZlbnQubm9fb2ZfdXNlcnMsIHVwZGF0ZUV2ZW50X2NhbGxiYWNrLCB1cGRhdGVFdmVudF9jYWxsYmFjayk7CiAgICB9CgogICAgZnVuY3Rpb24gdXBkYXRlRXZlbnRfY2FsbGJhY2soKQogICAgewogICAgICBnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkKTsKICAgIH0KCiAgfTsKCiAgJHNjb3BlLnVwZGF0ZVVzZXJFdmVudFByaWNlID0gZnVuY3Rpb24obmV3dmFsdWUsIHRoZWV2ZW50LCBldXNlcikKICB7CiAgICBuZXdfcHJpY2U9bmV3dmFsdWU7CiAgICBzZXRDbGllbnRFdmVudFByaWNlKCRodHRwLCRzY29wZSxldXNlci5idXNpbmVzc191c2VyX2lkLHRoZWV2ZW50LmV2ZW50X2lkLCBuZXdfcHJpY2Usc2V0Q2xpZW50RXZlbnRQcmljZV9jYWxsYmFjaywgc2V0Q2xpZW50RXZlbnRQcmljZV9jYWxsYmFjayk7CiAgICBmdW5jdGlvbiBzZXRDbGllbnRFdmVudFByaWNlX2NhbGxiYWNrKCkKICAgIHsKICAgICAgZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCk7CiAgICB9CiAgfTsKCiAgJHNjb3BlLnVwZGF0ZUxvY2F0aW9uRXZlbnQgPSBmdW5jdGlvbigpCiAgewogICAgY29uc29sZS5sb2coImZ1bmN0aW9uOiB1cGRhdGVMb2NhdGlvbkV2ZW50Iik7CiAgICB1cGRhdGVFdmVudExvY2F0aW9uKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuZXZlbnRfaWQsJHNjb3BlLmN1cnJlbnRFdmVudC5sb2NhdGlvbl9pZCx1cGRhdGVFdmVudExvY2F0aW9uX2NhbGxiYWNrLCB1cGRhdGVFdmVudExvY2F0aW9uX2NhbGxiYWNrKTsKICAgICRzY29wZS51cGRhdGVMb2NhdGlvbkFsZXJ0TWVzc2FnZT0i157XoteT15vXnyDXodeY15jXldehLi4uIjsKICAgIGZ1bmN0aW9uIHVwZGF0ZUV2ZW50TG9jYXRpb25fY2FsbGJhY2soKQogICAgewogICAgICAkc2NvcGUudXBkYXRlTG9jYXRpb25BbGVydE1lc3NhZ2U9Itei15XXk9eb158g15HXlNem15zXl9eUISI7CiAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkKICAgICAgewogICAgICAgICRzY29wZS51cGRhdGVMb2NhdGlvbkFsZXJ0TWVzc2FnZT1udWxsOwogICAgICB9LCAxNTAwKTsKICAgIH0KICB9OwoKICAkc2NvcGUudXBkYXRlSW5zdHJ1Y3RvckNsYXNzRXZlbnQgPSBmdW5jdGlvbigpCiAgewogICAgY29uc29sZS5sb2coImZ1bmN0aW9uOiB1cGRhdGVJbnN0cnVjdG9yQ2xhc3NFdmVudCIpOwogICAgdXBkYXRlRXZlbnRJbnN0cnVjdG9yKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuZXZlbnRfaWQsJHNjb3BlLmN1cnJlbnRFdmVudC5pbnN0cnVjdG9yX2lkLHVwZGF0ZUV2ZW50SW5zdHJ1Y3Rvcl9jYWxsYmFjaywgdXBkYXRlRXZlbnRJbnN0cnVjdG9yX2NhbGxiYWNrKTsKICAgICRzY29wZS51cGRhdGVJbnN0cnVjdG9yQWxlcnRNZXNzYWdlPSLXntei15PXm9efINeh15jXmNeV16EuLi4iOwogICAgZnVuY3Rpb24gdXBkYXRlRXZlbnRJbnN0cnVjdG9yX2NhbGxiYWNrKCkKICAgIHsKICAgICAgJHNjb3BlLnVwZGF0ZUluc3RydWN0b3JBbGVydE1lc3NhZ2U9Itei15XXk9eb158g15HXlNem15zXl9eUISI7CiAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkKICAgICAgewogICAgICAgICRzY29wZS51cGRhdGVJbnN0cnVjdG9yQWxlcnRNZXNzYWdlPW51bGw7CiAgICAgIH0sIDE1MDApOwogICAgfQogIH0KCgogICRzY29wZS5hY3RpdmF0ZUV2ZW50Q2xhc3MgPSBmdW5jdGlvbigpCiAgewogICAgewogICAgICBsb2dEZWJ1ZygicmVvcGVuRXZlbnQiKTsKICAgICAgcmVvcGVuRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQsJHNjb3BlLnNlbGVjdGVkRXZlbnQsYWZ0ZXJSZW9wZW5FdmVudCxhZnRlclJlb3BlbkV2ZW50KTsKICAgICAgZnVuY3Rpb24gYWZ0ZXJSZW9wZW5FdmVudCgpCiAgICAgIHsKICAgICAgICBnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkKTsKICAgICAgfTsKICAgIH0KICB9CgovLyBjbG9zZSBldmVudCBjbGFzcwogICRzY29wZS5jbG9zZUV2ZW50Q2xhc3MgPSBmdW5jdGlvbigpIHsKICAgIGxvZ0RlYnVnKCJjbG9zZUV2ZW50Q2xhc3MiKTsKCiAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAgICAgYW5pbWF0aW9uOiBmYWxzZSwKICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfZXZlbnRfY2xhc3NfY2xvc2UucGhwJywKICAgICAgc2l6ZTogJ3hzJywKICAgICAgY29udHJvbGxlcjogJ2NsYXNzQ2xvc2VNb2RhbENvbnRyb2xsZXInLAogICAgICByZXNvbHZlOiB7CiAgICAgICAgZXZlbnRfaWQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuICRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQ7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKICB9OwoKLy8gZGVsZXRlIHJlcGVhdGluZy9jbGFzcyBldmVudAogICRzY29wZS5kZWxldGVDbGFzc0V2ZW50ID0gZnVuY3Rpb24oKQogIHsKICAgIGlmICgkc2NvcGUuY3VycmVudEV2ZW50LmlzX3JlcGVhdGluZz09MCkKICAgIHsKICAgICAgbG9nRGVidWcoImNsYXNzIGV2ZW50IG5vdCByZXBlYXRpbmciKTsKICAgICAgJHNjb3BlLmRlbGV0ZUNsYXNzRXZlbnRTaW5nbGUoKTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgbG9nRGVidWcoImNsYXNzIGV2ZW50IGlzIHJlcGVhdGluZyIpOwogICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAgICAgICBhbmltYXRpb246IGZhbHNlLAogICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX3JlcGVhdGluZ19ldmVudF9kZWxldGVfYWxsLnBocCcsCiAgICAgICAgc2l6ZTogJ3hzJywKICAgICAgICBjb250cm9sbGVyOiAnY2xhc3NEZWxldGVBbGxNb2RhbENvbnRyb2xsZXInLAogICAgICAgIHJlc29sdmU6IHsKICAgICAgICAgIGN1cnJlbnRFdmVudDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiAkc2NvcGUuY3VycmVudEV2ZW50OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfTsKCiAgJHNjb3BlLmRlbGV0ZUNsYXNzRXZlbnRTaW5nbGU9ZnVuY3Rpb24gKCkgLy8gZGVsZXRlIG9ubHkgb25lL2N1cnJlbnQgY2xhc3MgZXZlaHQKICB7CiAgICBjYW5jZWxDbGFzc0V2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkLGNhbmNlbENsYXNzRXZlbnRfY2FsbGJhY2ssIGNhbmNlbENsYXNzRXZlbnRfY2FsbGJhY2spOwogICAgZnVuY3Rpb24gY2FuY2VsQ2xhc3NFdmVudF9jYWxsYmFjaygpCiAgICB7CiAgICAgIGdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQpOwogICAgfQogIH0KCiAgJHNjb3BlLiRvbigicmVsb2FkRXZlbnQiLGZ1bmN0aW9uKGUsYSl7Ci8vIFBvc3QgeW91ciBjb2RlCiAgICBsb2dEZWJ1ZygiYnJvYWRjYXN0ZWQgLSByZWxvYWRpbmcgZXZlbnQgIithLmV2ZW50X2lkKTsKICAgIGdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCk7CiAgfSk7CgovLyByZW1vdmUgZW5kIHVzZXIgZnJvbSBldmVudAogICRzY29wZS5ldmVudFJlbW92ZUVuZFVzZXIgPSBmdW5jdGlvbihlbmR1c2VyX2lkKQogIHsKICAgIGNvbnNvbGUubG9nKCJldmVudFJlbW92ZUVuZFVzZXIiKTsKICAgIHJlbW92ZUVuZFVzZXJGcm9tRXZlbnQoJGh0dHAsJHNjb3BlLGVuZHVzZXJfaWQsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCxyZW1vdmVFbmRVc2VyRnJvbUV2ZW50X2ZpbmlzaCwgcmVtb3ZlRW5kVXNlckZyb21FdmVudF9maW5pc2gpOwogICAgZnVuY3Rpb24gcmVtb3ZlRW5kVXNlckZyb21FdmVudF9maW5pc2goKQogICAgewogICAgICBnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkcm91dGVQYXJhbXMuZXZlbnRfaWQpOwogICAgfQogIH07CgogICRzY29wZS5ldmVudENsaWVudFNlbGVjdGVkID0gZnVuY3Rpb24oc2VsZWN0ZWQpIHsKICAgIGlmIChzZWxlY3RlZCkgewovLyBhbGVydChKU09OLnN0cmluZ2lmeSggc2VsZWN0ZWQsIG51bGwsIDIgKSk7CiAgICAgIGxvZ0RlYnVnKCdldmVudENsaWVudFNlbGVjdGVkMiB5ZXMgc2VsZWN0ZWQgJyArIHNlbGVjdGVkLm9yaWdpbmFsT2JqZWN0LmZpcnN0X25hbWUpOwogICAgICAkc2NvcGUuZXZlbnRBZGRFbmRVc2VyKHNlbGVjdGVkLm9yaWdpbmFsT2JqZWN0LmJ1c2luZXNzX3VzZXJfaWQpOwogICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2FuZ3Vjb21wbGV0ZS1hbHQ6Y2xlYXJJbnB1dCcsICdjbGllbnRfYW5ndWNvbXBsZXRlJyk7CgogICAgfSBlbHNlIHsKICAgICAgbG9nRGVidWcoJ25vdCBzZWxlY3RlZCcpOwogICAgfQogIH07CgogICRzY29wZS5ldmVudEFkZEVuZFVzZXIgPSBmdW5jdGlvbihlbmR1c2VyX2lkKQogIHsKICAgIGFkZEVuZFVzZXJUb0V2ZW50KCRodHRwLCRzY29wZSxlbmR1c2VyX2lkLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQsYWRkRW5kVXNlclRvRXZlbnRfZmluaXNoLCBhZGRFbmRVc2VyVG9FdmVudF9maW5pc2gpOwogICAgZnVuY3Rpb24gYWRkRW5kVXNlclRvRXZlbnRfZmluaXNoKCkKICAgIHsKICAgICAgZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkKTsKICAgIH0KICB9Owp9KTsKCmt1emVBcHAuY29udHJvbGxlcignRXZlbnRQYWdlQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHRpbWVvdXQsICRodHRwLCAkdWliTW9kYWwgLHNoYXJlZFByb3BlcnRpZXMsICRyb3V0ZVBhcmFtcywgJHJvb3RTY29wZSwgJGxvY2F0aW9uLCAkcm91dGUsIHNoYXJlZERhdGEsIEJ1c2luZXNzQ29uZmlnKQp7CiAgbG9nRGVidWcoIkV2ZW50UGFnZUNvbnRyb2xsZXIiKTsKCiAgZ2V0QWxsSW5zdHJ1Y3RvcnNJbmNJbmFjdGl2ZSgkaHR0cCwkc2NvcGUsJ2luc3RydWN0b3JzJyxnZXRBbGxJbnN0cnVjdG9yc0luY0luYWN0aXZlX3N1Y2Nlc3MpOwogIGdldEJ1c2luZXNzTG9jYXRpb25zKCRodHRwLCRzY29wZSwnYnVzaW5lc3NfbG9jYXRpb25zJyk7CgogIGZ1bmN0aW9uIGdldEFsbEluc3RydWN0b3JzSW5jSW5hY3RpdmVfc3VjY2VzcygpCiAgewogICAgZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLHNldFBhcnRpY2lwYXRlZCk7CiAgfQoKICB2YXIgaW5pdGlhbGl6aW5nID0gdHJ1ZSA7CgogICRzY29wZS4kd2F0Y2goImN1cnJlbnRFdmVudCIsIGZ1bmN0aW9uKG5ld1ZhbHVlLCBvbGRWYWx1ZSkgewogICAgaWYgKGluaXRpYWxpemluZykgewogICAgICAkdGltZW91dChmdW5jdGlvbigpIHsgaW5pdGlhbGl6aW5nID0gZmFsc2U7IH0pOwogICAgfSBlbHNlIHsKICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICB2YXIgdGltZW91dElkOwogICAgICAgICQoJyNkb2NzIDppbnB1dCwgdGV4dGFyZWEnKS5vbignaW5wdXQgcHJvcGVydHljaGFuZ2UgY2hhbmdlJywgZnVuY3Rpb24oKSB7CiAgICAgICAgICAvLyAgY29uc29sZS5sb2coJ1RleHRhcmVhIENoYW5nZScpOwogICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXRJZCk7CiAgICAgICAgICAvLyBSdW5zIFggc2Vjb25kIChYKjEwMDAgbXMpIGFmdGVyIHRoZSBsYXN0IGNoYW5nZQogICAgICAgICAgdGltZW91dElkID0gc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgJHNjb3BlLnVwZGF0ZUV2ZW50RXh0cmFGaWVsZHMoKQogICAgICAgICAgfSwgNzAwKTsKICAgICAgICB9KTsKICAgICAgfSwgMTAwMCk7CiAgICB9CiAgfSk7CgogICRzY29wZS5leHRyYUZpZWxkc0FsZXJ0TWVzc2FnZT1udWxsOwoKICAkc2NvcGUudXBkYXRlRXZlbnRUaXRsZSA9IGZ1bmN0aW9uKG5ld1ZhbHVlLGN1cnJlbnRFdmVudCkKICB7CiAgICBuZXdfdGl0bGU9bmV3VmFsdWU7CiAgICBzZXRFdmVudFRpdGxlKCRodHRwLCRzY29wZSxjdXJyZW50RXZlbnQuZXZlbnRfaWQsIG5ld190aXRsZSwgdXBkYXRlRXZlbnRfY2FsbGJhY2ssIHVwZGF0ZUV2ZW50X2NhbGxiYWNrKTsKCiAgICBmdW5jdGlvbiB1cGRhdGVFdmVudF9jYWxsYmFjaygpCiAgICB7CiAgICAgIGdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQpOwogICAgfQoKICB9OwoKCiAgJHNjb3BlLnVwZGF0ZUV2ZW50RXh0cmFGaWVsZHMgPSBmdW5jdGlvbigpCiAgewogICAgbG9nRGVidWcoInNhdmUgdXBkYXRlRXZlbnRFeHRyYUZpZWxkcyIpOwogICAgdGhlZGF0YSA9IHsKICAgICAgZXh0cmFGaWVsZHM6JHNjb3BlLmN1cnJlbnRFdmVudC5leHRyYUZpZWxkcwogICAgfTsKICAgICRzY29wZS5leHRyYUZpZWxkc0FsZXJ0TWVzc2FnZT0i16nXldee16guLi4iOwogICAgdXBkYXRlRXZlbnRFeHRyYUZpZWxkcygkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLHRoZWRhdGEsdXBkYXRlRXZlbnRFeHRyYUZpZWxkc19jYWxsYmFjaywgdXBkYXRlRXZlbnRFeHRyYUZpZWxkc19jYWxsYmFjayk7CgogICAgZnVuY3Rpb24gdXBkYXRlRXZlbnRFeHRyYUZpZWxkc19jYWxsYmFjaygpCiAgICB7CiAgICAgIC8vIGdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCxzZXRQYXJ0aWNpcGF0ZWQpOwoKICAgICAgJHNjb3BlLmV4dHJhRmllbGRzQWxlcnRNZXNzYWdlPSLXoNep157XqCEiOwogICAgICAkdGltZW91dChmdW5jdGlvbigpCiAgICAgIHsKICAgICAgICAkc2NvcGUuZXh0cmFGaWVsZHNBbGVydE1lc3NhZ2U9bnVsbDsKICAgICAgfSwgMjMwMCk7CiAgICB9CiAgfTsKCiAgJHNjb3BlLnJlc2NoZWR1bGVFdmVudCA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1Zygic2VldGluZyBldmVudCB0byBtb3ZlICAiKyRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXSk7CiAgICBzaGFyZWRQcm9wZXJ0aWVzLnNldF9ldmVudF9yZXNjaGVkdWxlKCRzY29wZS5jdXJyZW50RXZlbnQpOwogICAgc2hhcmVkUHJvcGVydGllcy5zZXRfc2VsZWN0ZWRfdXNlcihudWxsKTsKCi8vIHVzZXJfaW5mbz0gewovLyAgICAgdXNlcl9pZDogJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudFVzZXJzWzBdLnVzZXJfaWQsCi8vICAgICBidXNlcl9maXJzdF9uYW1lOiAkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfZmlyc3RfbmFtZSwKLy8gICAgIGJ1c2VyX2xhc3RfbmFtZTogJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudFVzZXJzWzBdLmJ1c2VyX2xhc3RfbmFtZQovLyB9OwovLyBzaGFyZWRQcm9wZXJ0aWVzLnNldF9zZWxlY3RlZF91c2VyKHVzZXJfaW5mbyk7CiAgICAkbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2NhbGVuZGFyJyk7CiAgfQoKICAkc2NvcGUudXBkYXRlTG9jYXRpb25FdmVudCA9IGZ1bmN0aW9uKCkKICB7CiAgICBjb25zb2xlLmxvZygiZnVuY3Rpb246IHVwZGF0ZUxvY2F0aW9uRXZlbnQiKTsKICAgIHVwZGF0ZUV2ZW50TG9jYXRpb24oJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCwkc2NvcGUuY3VycmVudEV2ZW50LmxvY2F0aW9uX2lkLHVwZGF0ZUV2ZW50TG9jYXRpb25fY2FsbGJhY2ssIHVwZGF0ZUV2ZW50TG9jYXRpb25fY2FsbGJhY2spOwogICAgJHNjb3BlLnVwZGF0ZUxvY2F0aW9uQWxlcnRNZXNzYWdlPSLXntei15PXm9efINeh15jXmNeV16EuLi4iOwogICAgZnVuY3Rpb24gdXBkYXRlRXZlbnRMb2NhdGlvbl9jYWxsYmFjaygpCiAgICB7CiAgICAgICRzY29wZS51cGRhdGVMb2NhdGlvbkFsZXJ0TWVzc2FnZT0i16LXldeT15vXnyDXkdeU16bXnNeX15QhIjsKICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKQogICAgICB7CiAgICAgICAgJHNjb3BlLnVwZGF0ZUxvY2F0aW9uQWxlcnRNZXNzYWdlPW51bGw7CiAgICAgIH0sIDE1MDApOwogICAgfQogIH07CgogICRzY29wZS51cGRhdGVJbnN0cnVjdG9yRXZlbnQgPSBmdW5jdGlvbigpCiAgewogICAgY29uc29sZS5sb2coImZ1bmN0aW9uOiB1cGRhdGVJbnN0cnVjdG9yRXZlbnQiKTsKICAgIHVwZGF0ZUV2ZW50SW5zdHJ1Y3RvcigkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLCRzY29wZS5jdXJyZW50RXZlbnQuaW5zdHJ1Y3Rvcl9pZCx1cGRhdGVFdmVudEluc3RydWN0b3JfY2FsbGJhY2ssIHVwZGF0ZUV2ZW50SW5zdHJ1Y3Rvcl9jYWxsYmFjayk7CiAgICAkc2NvcGUudXBkYXRlSW5zdHJ1Y3RvckFsZXJ0TWVzc2FnZT0i157XoteT15vXnyDXodeY15jXldehLi4uIjsKICAgIGZ1bmN0aW9uIHVwZGF0ZUV2ZW50SW5zdHJ1Y3Rvcl9jYWxsYmFjaygpCiAgICB7CiAgICAgICRzY29wZS51cGRhdGVJbnN0cnVjdG9yQWxlcnRNZXNzYWdlPSLXoteV15PXm9efINeR15TXptec15fXlCEiOwogICAgICAkdGltZW91dChmdW5jdGlvbigpCiAgICAgIHsKICAgICAgICAkc2NvcGUudXBkYXRlSW5zdHJ1Y3RvckFsZXJ0TWVzc2FnZT1udWxsOwogICAgICB9LCAxNTAwKTsKICAgIH0KICB9OwoKICAkc2NvcGUuaW5pdGlhdGVQYXltZW50ID0gZnVuY3Rpb24gKGlzcGx1cykgewogICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2NsaWVudF9wYXltZW50LnBocCcsCiAgICAgIGNvbnRyb2xsZXI6ICdidXNpbmVzc0NsaWVuZENhcmRQYXltZW50JywKLy8gc2l6ZTogc2l6ZSwKICAgICAgcmVzb2x2ZTogewogICAgICAgIGN1cnJlbnRDbGllbnQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiAkc2NvcGUuY3VycmVudEV2ZW50Q2xpZW50c1swXTsKICAgICAgICB9LAogICAgICAgIGlzcGx1czogZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIGlzcGx1czsKICAgICAgICB9LAogICAgICAgIGJ1c2luZXNzQ29uZmlnOiBCdXNpbmVzc0NvbmZpZy5nZXQoKSwKICAgICAgICBwYXltZW50czogZ2V0Q2xpZW50UGF5bWVudHNQcm9taXNlKCRodHRwLCAkc2NvcGUuY3VycmVudEV2ZW50Q2xpZW50c1swXS5idXNpbmVzc191c2VyX2lkKQogICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocikgewogICAgICAgICAgICAgIHJldHVybiByLmRhdGEuanNvbgogICAgICAgICAgICB9KQogICAgICB9CiAgICB9KTsKICB9CgogICRzY29wZS5kZWxldGVFdmVudD1mdW5jdGlvbiAoKQogIHsKLy8gY2hlY2tpbmcgaWYgY2FuY2VsaW5nIGEgZ2VuZXJjX3R5cGUgZXZlbnQgLSB0aGVuIHRoZXJlJ3Mgbm8gdXNlcgogICAgaWYgKCRzY29wZS5jdXJyZW50RXZlbnQuaXNfZ2VuZXJpY19ldHlwZT09MSkKICAgIHsKICAgICAgY2FuY2VsU2luZ2xlRXZlbnQoJGh0dHAsJHNjb3BlLDAsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLGNhbmNlbFNpbmdsZUV2ZW50X2NhbGxiYWNrLCBjYW5jZWxTaW5nbGVFdmVudF9jYWxsYmFjayk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgIGNhbmNlbFNpbmdsZUV2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50VXNlcnNbMF0uYnVzaW5lc3NfdXNlcl9pZCwkcm91dGVQYXJhbXMuZXZlbnRfaWQsY2FuY2VsU2luZ2xlRXZlbnRfY2FsbGJhY2ssIGNhbmNlbFNpbmdsZUV2ZW50X2NhbGxiYWNrKTsKICAgIH0KICAgIGZ1bmN0aW9uIGNhbmNlbFNpbmdsZUV2ZW50X2NhbGxiYWNrKCkKICAgIHsKICAgICAgZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLHNldFBhcnRpY2lwYXRlZCk7CiAgICB9CiAgfQoKICAkc2NvcGUuc2V0UGFydGljaXBhdGlvblN0YXR1cyA9IGZ1bmN0aW9uKCkKICB7CiAgICBzZXRFdmVudFVzZXJQYXJ0aWNpcGF0aW9uU3RhdHVzKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuZXZlbnRfaWQsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudFVzZXJzWzBdLmJ1c2luZXNzX3VzZXJfaWQsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudFVzZXJzWzBdLmV2ZW50X3VzZXJfc3RhdHVzX2lkLHNldFBhcnRpY2lwYXRpb25TdGF0dXNfY2FsbGJhY2ssIHNldFBhcnRpY2lwYXRpb25TdGF0dXNfY2FsbGJhY2spOwogICAgJHNjb3BlLnVwZGF0ZVN0YXR1c0FsZXJ0TWVzc2FnZT0i157XoteT15vXnyDXodeY15jXldehLi4uIjsKICAgIGZ1bmN0aW9uIHNldFBhcnRpY2lwYXRpb25TdGF0dXNfY2FsbGJhY2soKQogICAgewovLyBnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkcm91dGVQYXJhbXMuZXZlbnRfaWQsc2V0UGFydGljaXBhdGVkKTsKICAgICAgc2V0UGFydGljaXBhdGVkKCk7CiAgICAgICRzY29wZS51cGRhdGVTdGF0dXNBbGVydE1lc3NhZ2U9Itei15XXk9eb158g15HXlNem15zXl9eUISI7CiAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkKICAgICAgewogICAgICAgICRzY29wZS51cGRhdGVTdGF0dXNBbGVydE1lc3NhZ2U9bnVsbDsKICAgICAgfSwgMjUwMCk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBzZXRQYXJ0aWNpcGF0ZWQoKQogIHsKICAgIGxvZ0RlYnVnKCJnZXQgY2xpZW50IGluZm8iKTsKICAgIGdldEJ1c2luZXNzQ2xpZW50SW5mbygkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudENsaWVudHMnLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRVc2Vyc1swXS5idXNpbmVzc191c2VyX2lkKTsKICAgIGxvZ0RlYnVnKCJzZXR0aW5nIHNldFBhcnRpY2lwYXRlZCIpOwogICAgaWYgKCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRVc2Vyc1swXS5zdGF0dXNfbmFtZSE9JGdVc2VyX3N0YXR1c19hYnNlbnRlZCkKICAgIHsKICAgICAgJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudFVzZXJzWzBdLnBhcnRpY2lwYXRlZD10cnVlOwogICAgfQogICAgZWxzZQogICAgewogICAgICAkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50VXNlcnNbMF0ucGFydGljaXBhdGVkPWZhbHNlOwogICAgfQoKLy8gdGhpcyBsb29wIGlzIGZvciBmaXhpbmcgdGhlIGRhdGUgZm9ybWF0IHRvIGFwcGVhciBwcm9wZXJseSBpbiB0aGUgaW5wdXQgZGF0ZSBodG1sIG9iamVjdAogICAgZm9yIChpID0gMDsgaTwgKCRzY29wZS5jdXJyZW50RXZlbnQuZXh0cmFGaWVsZHMpLmxlbmd0aDsgaSsrKQogICAgewogICAgICBsb2dEZWJ1Zygkc2NvcGUuY3VycmVudEV2ZW50LmV4dHJhRmllbGRzW2ldKTsKICAgICAgaWYgKCRzY29wZS5jdXJyZW50RXZlbnQuZXh0cmFGaWVsZHNbaV0uZmllbGRfZGF0YXR5cGU9PSJEQVRFIikKICAgICAgewovLyBsb2dEZWJ1ZygiZGF0ZSIpOwogICAgICAgICRzY29wZS5jdXJyZW50RXZlbnQuZXh0cmFGaWVsZHNbaV0uZmllbGRfdmFsdWU9bmV3IERhdGUoJHNjb3BlLmN1cnJlbnRFdmVudC5leHRyYUZpZWxkc1tpXS5maWVsZF92YWx1ZSk7CiAgICAgIH0KICAgIH0KCiAgICBsb2dEZWJ1ZygiJHNjb3BlLmN1cnJlbnRFdmVudC5pbnN0cnVjdG9yX2lkOz0iKyRzY29wZS5jdXJyZW50RXZlbnQuaW5zdHJ1Y3Rvcl9pZCk7CiAgICBmb3IodmFyIGkgPSAwOyBpIDwgJHNjb3BlLmluc3RydWN0b3JzLmxlbmd0aDsgaSsrKQogICAgewogICAgICBsb2dEZWJ1Zygkc2NvcGUuaW5zdHJ1Y3RvcnNbaV0uaXNfYWN0aXZlKTsKICAgICAgaWYgKCRzY29wZS5pbnN0cnVjdG9yc1tpXS5idXNpbmVzc191c2VyX2lkPT0kc2NvcGUuY3VycmVudEV2ZW50Lmluc3RydWN0b3JfaWQpCiAgICAgIHsKICAgICAgICBsb2dEZWJ1ZygieWVzaCIpOwogICAgICAgICRzY29wZS5pbnN0cnVjdG9yc1tpXS5pc19hY3RpdmU9MTsKICAgICAgfQogICAgfQogIH0KCiAgJHNjb3BlLnVwZGF0ZVVzZXJFdmVudFByaWNlID0gZnVuY3Rpb24obmV3dmFsdWUsIHRoZWV2ZW50KQogIHsKICAgIG5ld19wcmljZT1uZXd2YWx1ZTsKICAgIHNldENsaWVudEV2ZW50UHJpY2UoJGh0dHAsJHNjb3BlLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRVc2Vyc1swXS5idXNpbmVzc191c2VyX2lkLHRoZWV2ZW50LmV2ZW50X2lkLCBuZXdfcHJpY2Usc2V0Q2xpZW50RXZlbnRQcmljZV9jYWxsYmFjaywgc2V0Q2xpZW50RXZlbnRQcmljZV9jYWxsYmFjayk7CiAgICBmdW5jdGlvbiBzZXRDbGllbnRFdmVudFByaWNlX2NhbGxiYWNrKCkKICAgIHsKICAgICAgZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLHNldFBhcnRpY2lwYXRlZCk7CiAgICB9CiAgfTsKCiAgJHNjb3BlLiRvbigiZXZlbnRQYWdlUmVsb2FkRGF0YSIsZnVuY3Rpb24oZSxhKQogIHsKICAgIGdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCxzZXRQYXJ0aWNpcGF0ZWQpOwogIH0pOwoKCgoKICAkc2NvcGUuY2xvc2VFdmVudCA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1ZygiY2hlY2tpbmcgaWYgZXZlbnQgaGFzIGV4dHJhIGZpZWxkcyB0aGF0IGFyZSByZXF1aXJlZCBiZWZvcmUgY2xvc2luZyBpdCIpOwogICAgY2hlY2tFdmVudEV4dHJhRmllbGRzKCRodHRwLCRzY29wZSwnY2hlY2tFdmVudEV4dHJhRmllbGRzJywkcm91dGVQYXJhbXMuZXZlbnRfaWQsY2hlY2tFdmVudEV4dHJhRmllbGRzX3N1Y2Nlc3MpOwogICAgZnVuY3Rpb24gY2hlY2tFdmVudEV4dHJhRmllbGRzX3N1Y2Nlc3MoKQogICAgewogICAgICBpZiAoJHNjb3BlLmNoZWNrRXZlbnRFeHRyYUZpZWxkcz09dHJ1ZSkKICAgICAgewogICAgICAgIGxvZ0RlYnVnKCJldmVudCBoYXMgYWxsIGV4dHJhIGZpZWxkcyBvaywgY2xvc2luZyBldmVudCIpOwovLyAkc2NvcGUuY3VycmVudEV2ZW50Lmlnbm9yZUV4dHJhRmllbGRzVmFsaWRhdGlvbj10cnVlOwogICAgICAgIGNsb3NlRXZlbnQoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCwkc2NvcGUuY3VycmVudEV2ZW50LGFmdGVyQ2xvc2VFdmVudCxhZnRlckNsb3NlRXZlbnQpOwogICAgICAgIGZ1bmN0aW9uIGFmdGVyQ2xvc2VFdmVudCgpCiAgICAgICAgewogICAgICAgICAgZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLHNldFBhcnRpY2lwYXRlZCk7CiAgICAgICAgfTsKICAgICAgfQogICAgICBlbHNlCiAgICAgIHsKICAgICAgICBsb2dEZWJ1ZygiZXZlbnQgaGFzIGV4dHJhIGZpZWxkcyByZXF1aXJlZCB0aGF0IGFyZSBub3QgZmlsbGVkIik7CiAgICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgICAgICAgICBhbmltYXRpb246IGZhbHNlLAogICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfZXZlbnRfY2xvc2VfaWdub3JlX21hbmRhdG9yeV9maWVsZHMucGhwJywKICAgICAgICAgIGNvbnRyb2xsZXI6ICdldmVudENsb3NlSWdub3JlTWFuZGF0b3J5RmllbGRzTW9kYWxDb250cm9sbGVyJywKICAgICAgICAgIHNpemU6ICdtJywKICAgICAgICAgIHJlc29sdmU6IHsKICAgICAgICAgICAgY3VycmVudEV2ZW50OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICByZXR1cm4gJHNjb3BlLmN1cnJlbnRFdmVudDsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgfQogICRzY29wZS5yZW9wZW5FdmVudCA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1ZygicmVvcGVuRXZlbnQiKTsKICAgIHJlb3BlbkV2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkLCRzY29wZS5jdXJyZW50RXZlbnQsYWZ0ZXJSZW9wZW5FdmVudCxhZnRlclJlb3BlbkV2ZW50KTsKICAgIGZ1bmN0aW9uIGFmdGVyUmVvcGVuRXZlbnQoKQogICAgewogICAgICBnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkLHNldFBhcnRpY2lwYXRlZCk7CiAgICB9OwogIH0KCn0pOwoKa3V6ZUFwcC5maWx0ZXIoJ3N0YXJ0RnJvbScsIGZ1bmN0aW9uKCkKewogIHJldHVybiBmdW5jdGlvbihpbnB1dCwgc3RhcnQpCiAgewogICAgaWYoIWlucHV0KSByZXR1cm4gW107Ci8vIGNvbnNvbGUubG9nKCJoZXJlcmVlZSAiK2lucHV0KTsKICAgIHN0YXJ0ID0gK3N0YXJ0OyAvL3BhcnNlIHRvIGludAogICAgcmV0dXJuIGlucHV0LnNsaWNlKHN0YXJ0KTsKICB9Cn0pOwovLyBhbmd1bGFyIGZpbHRlciBmb3IgZXZlbnRzIGJlZm9yZS9hZnRlciB0b2RheQprdXplQXBwLmZpbHRlcignYmVmb3JlTm93JywgZnVuY3Rpb24oKSB7Ci8vIENyZWF0ZSB0aGUgcmV0dXJuIGZ1bmN0aW9uIGFuZCBzZXQgdGhlIHJlcXVpcmVkIHBhcmFtZXRlciBuYW1lIHRvICoqaW5wdXQqKgogIHJldHVybiBmdW5jdGlvbihpbnB1dCkgewogICAgdmFyIG91dCA9IFtdOwoKLy8gVXNpbmcgdGhlIGFuZ3VsYXIuZm9yRWFjaCBtZXRob2QsIGdvIHRocm91Z2ggdGhlIGFycmF5IG9mIGRhdGEgYW5kIHBlcmZvcm0gdGhlIG9wZXJhdGlvbiBvZiBmaWd1cmluZyBvdXQgaWYgdGhlIGxhbmd1YWdlIGlzIHN0YXRpY2FsbHkgb3IgZHluYW1pY2FsbHkgdHlwZWQuCiAgICB2YXIgYnJvd3Nlcl9lcG9jaCA9IChuZXcgRGF0ZSkuZ2V0VGltZSgpOwoKICAgIGFuZ3VsYXIuZm9yRWFjaChpbnB1dCwgZnVuY3Rpb24oZXZlbnQpCiAgICB7Ci8vICBsb2dEZWJ1ZygiZmlsdGVyaW5nLCBldmVudC5ldmVudF91c2VyX3N0YXR1c19pZD0iK2V2ZW50LmV2ZW50X3VzZXJfc3RhdHVzX2lkKTsKICAgICAgaWYgKGV2ZW50LnN0YXJ0X2Vwb2NoIDw9IChicm93c2VyX2Vwb2NoLzEwMDApKQogICAgICB7CiAgICAgICAgb3V0LnB1c2goZXZlbnQpCiAgICAgIH0KICAgIH0pCiAgICByZXR1cm4gb3V0OwogIH0KfSk7Cmt1emVBcHAuZmlsdGVyKCdhZnRlck5vdycsIGZ1bmN0aW9uKCkgewovLyBDcmVhdGUgdGhlIHJldHVybiBmdW5jdGlvbiBhbmQgc2V0IHRoZSByZXF1aXJlZCBwYXJhbWV0ZXIgbmFtZSB0byAqKmlucHV0KioKICByZXR1cm4gZnVuY3Rpb24oaW5wdXQpIHsKICAgIHZhciBvdXQgPSBbXTsKCi8vIFVzaW5nIHRoZSBhbmd1bGFyLmZvckVhY2ggbWV0aG9kLCBnbyB0aHJvdWdoIHRoZSBhcnJheSBvZiBkYXRhIGFuZCBwZXJmb3JtIHRoZSBvcGVyYXRpb24gb2YgZmlndXJpbmcgb3V0IGlmIHRoZSBsYW5ndWFnZSBpcyBzdGF0aWNhbGx5IG9yIGR5bmFtaWNhbGx5IHR5cGVkLgogICAgdmFyIGJyb3dzZXJfZXBvY2ggPSAobmV3IERhdGUpLmdldFRpbWUoKTsKCiAgICBhbmd1bGFyLmZvckVhY2goaW5wdXQsIGZ1bmN0aW9uKGV2ZW50KQogICAgewovLyAgbG9nRGVidWcoImZpbHRlcmluZywgZXZlbnQuZXZlbnRfdXNlcl9zdGF0dXNfaWQ9IitldmVudC5ldmVudF91c2VyX3N0YXR1c19pZCk7CiAgICAgIGlmIChldmVudC5zdGFydF9lcG9jaCA+IChicm93c2VyX2Vwb2NoLzEwMDApKQogICAgICB7CiAgICAgICAgb3V0LnB1c2goZXZlbnQpCiAgICAgIH0KICAgIH0pCiAgICByZXR1cm4gb3V0OwogIH0KfSk7CgprdXplQXBwLmZpbHRlcignaXNBY3RpdmUnLCBmdW5jdGlvbigpIHsKLy8gQ3JlYXRlIHRoZSByZXR1cm4gZnVuY3Rpb24gYW5kIHNldCB0aGUgcmVxdWlyZWQgcGFyYW1ldGVyIG5hbWUgdG8gKippbnB1dCoqCiAgcmV0dXJuIGZ1bmN0aW9uKGlucHV0KSB7CiAgICB2YXIgb3V0ID0gW107CgovLyBVc2luZyB0aGUgYW5ndWxhci5mb3JFYWNoIG1ldGhvZCwgZ28gdGhyb3VnaCB0aGUgYXJyYXkgb2YgZGF0YSBhbmQgcGVyZm9ybSB0aGUgb3BlcmF0aW9uIG9mIGZpZ3VyaW5nIG91dCBpZiB0aGUgbGFuZ3VhZ2UgaXMgc3RhdGljYWxseSBvciBkeW5hbWljYWxseSB0eXBlZC4KCiAgICBhbmd1bGFyLmZvckVhY2goaW5wdXQsIGZ1bmN0aW9uKGV2ZW50KQogICAgewovLyAgbG9nRGVidWcoImZpbHRlcmluZywgZXZlbnQuZXZlbnRfdXNlcl9zdGF0dXNfaWQ9IitldmVudC5ldmVudF91c2VyX3N0YXR1c19pZCk7CiAgICAgIGlmIChldmVudC5pc19hY3RpdmU9PTEpCiAgICAgIHsKICAgICAgICBvdXQucHVzaChldmVudCkKICAgICAgfQogICAgfSkKICAgIHJldHVybiBvdXQ7CiAgfQp9KTsKCmt1emVBcHAuZmlsdGVyKCdzaG91bGRfYmVfZGlzcGxheWVkJywgZnVuY3Rpb24oKSB7Ci8vIENyZWF0ZSB0aGUgcmV0dXJuIGZ1bmN0aW9uIGFuZCBzZXQgdGhlIHJlcXVpcmVkIHBhcmFtZXRlciBuYW1lIHRvICoqaW5wdXQqKgogIHJldHVybiBmdW5jdGlvbihpbnB1dCkgewogICAgdmFyIG91dCA9IFtdOwoKLy8gVXNpbmcgdGhlIGFuZ3VsYXIuZm9yRWFjaCBtZXRob2QsIGdvIHRocm91Z2ggdGhlIGFycmF5IG9mIGRhdGEgYW5kIHBlcmZvcm0gdGhlIG9wZXJhdGlvbiBvZiBmaWd1cmluZyBvdXQgaWYgdGhlIGxhbmd1YWdlIGlzIHN0YXRpY2FsbHkgb3IgZHluYW1pY2FsbHkgdHlwZWQuCgogICAgYW5ndWxhci5mb3JFYWNoKGlucHV0LCBmdW5jdGlvbihldmVudCkKICAgIHsKLy8gIGxvZ0RlYnVnKCJmaWx0ZXJpbmcsIGV2ZW50LmV2ZW50X3VzZXJfc3RhdHVzX2lkPSIrZXZlbnQuZXZlbnRfdXNlcl9zdGF0dXNfaWQpOwogICAgICBpZiAoZXZlbnQuc2hvdWxkX2JlX2Rpc3BsYXllZD09MSkKICAgICAgewogICAgICAgIG91dC5wdXNoKGV2ZW50KQogICAgICB9CiAgICB9KQogICAgcmV0dXJuIG91dDsKICB9Cn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdJbnN0cnVjdG9yU2hvdzFDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkdGltZW91dCwgJGh0dHAsIHNoYXJlZFByb3BlcnRpZXMsICRyb290U2NvcGUsICRyb3V0ZVBhcmFtcywgJGxvY2F0aW9uLCAkcm91dGUsIHNoYXJlZERhdGEsICR1aWJNb2RhbCkKewogIGdldEJ1c2luZXNzQ2xpZW50SW5mbygkaHR0cCwkc2NvcGUsJ2Zvcm1VcGRhdGVDbGllbnRBbmd1bGFyJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCxnZXRCdXNpbmVzc0NsaWVudEluZm9fc3VjY2Vzcyk7CiAgZ2V0c2VjdXJpdHlQcm9maWxlcygkaHR0cCwkc2NvcGUsJ3NlY19wcm9maWxlcycpOwoKICBmdW5jdGlvbiBnZXRCdXNpbmVzc0NsaWVudEluZm9fc3VjY2VzcygpCiAgewogICAgZ2V0Q2xpZW50RXh0cmFGaWVsZHMoJGh0dHAsJHNjb3BlLCRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5idXNpbmVzc191c2VyX2lkLCdjbGllbnRFeHRyYUZpZWxkcycsZ2V0Q2xpZW50RXh0cmFGaWVsZHNfc3VjY2Vzcyk7CgogICAgZnVuY3Rpb24gZ2V0Q2xpZW50RXh0cmFGaWVsZHNfc3VjY2VzcygpCiAgICB7CiAgICAgIGZvciAoaSA9IDA7IGk8ICgkc2NvcGUuY2xpZW50RXh0cmFGaWVsZHMpLmxlbmd0aDsgaSsrKQogICAgICB7CiAgICAgICAgbG9nRGVidWcoJHNjb3BlLmNsaWVudEV4dHJhRmllbGRzW2ldKTsKICAgICAgICBpZiAoJHNjb3BlLmNsaWVudEV4dHJhRmllbGRzW2ldLmZpZWxkX2RhdGF0eXBlPT0iREFURSIpCiAgICAgICAgewovLyBsb2dEZWJ1ZygiZGF0ZSIpOwogICAgICAgICAgJHNjb3BlLmNsaWVudEV4dHJhRmllbGRzW2ldLmZpZWxkX3ZhbHVlPW5ldyBEYXRlKCRzY29wZS5jbGllbnRFeHRyYUZpZWxkc1tpXS5maWVsZF92YWx1ZSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQoKICAkc2NvcGUudXBkYXRlX3NlY19wcm9maWxlID0gZnVuY3Rpb24oKQogIHsKICAgIGxvZ0RlYnVnKCJ1cGRhdGVfc2VjX3Byb2ZpbGUgZm9yIGJ1aWQ9Iiskc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYnVzaW5lc3NfdXNlcl9pZCsgIiwgcHJvZmlsZV9pZCIrJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLnNlY19wcm9maWxlX2lkKTsKICAgIHVwZGF0ZV9zZWNfcHJvZmlsZSgkaHR0cCwkc2NvcGUsJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLmJ1c2luZXNzX3VzZXJfaWQsJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLnNlY19wcm9maWxlX2lkLHVwZGF0ZV9zZWNfcHJvZmlsZV9zdWNjZXNzKTsKICAgIGZ1bmN0aW9uIHVwZGF0ZV9zZWNfcHJvZmlsZV9zdWNjZXNzKCkKICAgIHsKICAgICAgZ2V0c2VjdXJpdHlQcm9maWxlcygkaHR0cCwkc2NvcGUsJ3NlY19wcm9maWxlcycpOwogICAgfQogIH0KICAkc2NvcGUuYXJjaGl2ZUNsaWVudE1vZGFsID0gZnVuY3Rpb24oKQogIHsKLy8gYXJjaGl2ZS9kZWxldGUgY2xpZW50IC0gYXNrIGlmIHN1cmUKICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewogICAgICBhbmltYXRpb246IGZhbHNlLAogICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdhcmNoaXZlX2NsaWVudF9tb2RhbC5waHAnLAogICAgICBzaXplOiAneHMnLAogICAgICBjb250cm9sbGVyOiAnYXJjaGl2ZV9jbGllbnRfbW9kYWwnLCAgLy8gJ3BheW1lbnlEZXRhaWxzTW9kYWxDb250cm9sbGVyJywKICAgICAgcmVzb2x2ZTogewogICAgICAgIGJ1c2luZXNzX3VzZXJfaWQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuICRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5idXNpbmVzc191c2VyX2lkOwogICAgICAgIH0sCiAgICAgICAgYnVzZXJfbGFzdF9uYW1lOiBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYnVzZXJfbGFzdF9uYW1lOwogICAgICAgIH0sCiAgICAgICAgYnVzZXJfZmlyc3RfbmFtZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLmJ1c2VyX2ZpcnN0X25hbWU7CiAgICAgICAgfSwKICAgICAgICBpc19pbnN0cnVjdG9yOiBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CiAgfQoKICAkc2NvcGUudXBkYXRlVXNlckZpcnN0TmFtZSA9IGZ1bmN0aW9uKG5ld1ZhbHVlKQogIHsKICAgIHNldENsaWVudEZpcnN0TmFtZSgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsbmV3VmFsdWUsYWZ0ZXJDbGllbnRTZXQsYWZ0ZXJDbGllbnRTZXQpOwogICAgZnVuY3Rpb24gYWZ0ZXJDbGllbnRTZXQoKQogICAgewogICAgICBnZXRCdXNpbmVzc0NsaWVudEluZm8oJGh0dHAsJHNjb3BlLCdmb3JtVXBkYXRlQ2xpZW50QW5ndWxhcicsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwogICAgfQogIH0KICAkc2NvcGUudXBkYXRlVXNlckxhc3ROYW1lID0gZnVuY3Rpb24obmV3VmFsdWUpCiAgewogICAgc2V0Q2xpZW50TGFzdE5hbWUoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLG5ld1ZhbHVlLGFmdGVyQ2xpZW50U2V0LGFmdGVyQ2xpZW50U2V0KTsKICAgIGZ1bmN0aW9uIGFmdGVyQ2xpZW50U2V0KCkKICAgIHsKICAgICAgZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKICAgIH0KICB9CiAgJHNjb3BlLnVwZGF0ZVVzZXJQaG9uZU51bWJlciA9IGZ1bmN0aW9uKG5ld1ZhbHVlKQogIHsKICAgIG5ld1ZhbHVlID0gbmV3VmFsdWUucmVwbGFjZSgnLScsJycpOwogICAgaWYgKGlzTmFOKG5ld1ZhbHVlKSkKICAgIHsKICAgICAgYWxlcnQoIteQ16DXkCDXlNeW158g157Xodek16gg15jXnNek15XXnyDXqten15nXnyIpOwogICAgICBnZXRCdXNpbmVzc0NsaWVudEluZm8oJGh0dHAsJHNjb3BlLCdmb3JtVXBkYXRlQ2xpZW50QW5ndWxhcicsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwogICAgfQogICAgZWxzZQogICAgewogICAgICBzZXRDbGllbnRQaG9uZU51bWJlcigkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsbmV3VmFsdWUsc2V0Q2xpZW50UGhvbmVOdW1iZXJfY2FsbGJhY2ssc2V0Q2xpZW50UGhvbmVOdW1iZXJfY2FsbGJhY2spOwogICAgICBmdW5jdGlvbiBzZXRDbGllbnRQaG9uZU51bWJlcl9jYWxsYmFjaygpCiAgICAgIHsKICAgICAgICBnZXRCdXNpbmVzc0NsaWVudEluZm8oJGh0dHAsJHNjb3BlLCdmb3JtVXBkYXRlQ2xpZW50QW5ndWxhcicsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwogICAgICB9CiAgICB9CiAgfQoKfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdDbGllbnRzU2hvdzFDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkdGltZW91dCwgJGh0dHAsIHNoYXJlZFByb3BlcnRpZXMsICRyb290U2NvcGUsICRyb3V0ZVBhcmFtcywgJGxvY2F0aW9uLCAkcm91dGUsIHNoYXJlZERhdGEsICR1aWJNb2RhbCwgQnVzaW5lc3NDb25maWcpCnsKICBnZXRCdXNpbmVzc0NsaWVudEluZm8oJGh0dHAsJHNjb3BlLCdmb3JtVXBkYXRlQ2xpZW50QW5ndWxhcicsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsZ2V0QnVzaW5lc3NDbGllbnRJbmZvX3N1Y2Nlc3MpOwoKICBmdW5jdGlvbiBnZXRCdXNpbmVzc0NsaWVudEluZm9fc3VjY2VzcygpCiAgewogICAgZ2V0Q2xpZW50RXh0cmFGaWVsZHMoJGh0dHAsJHNjb3BlLCRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5idXNpbmVzc191c2VyX2lkLCdjbGllbnRFeHRyYUZpZWxkcycsZ2V0Q2xpZW50RXh0cmFGaWVsZHNfc3VjY2Vzcyk7CgogICAgZnVuY3Rpb24gZ2V0Q2xpZW50RXh0cmFGaWVsZHNfc3VjY2VzcygpCiAgICB7CiAgICAgIGZvciAoaSA9IDA7IGk8ICgkc2NvcGUuY2xpZW50RXh0cmFGaWVsZHMpLmxlbmd0aDsgaSsrKQogICAgICB7CiAgICAgICAgbG9nRGVidWcoJHNjb3BlLmNsaWVudEV4dHJhRmllbGRzW2ldKTsKICAgICAgICBpZiAoJHNjb3BlLmNsaWVudEV4dHJhRmllbGRzW2ldLmZpZWxkX2RhdGF0eXBlPT0iREFURSIpCiAgICAgICAgewovLyBsb2dEZWJ1ZygiZGF0ZSIpOwogICAgICAgICAgJHNjb3BlLmNsaWVudEV4dHJhRmllbGRzW2ldLmZpZWxkX3ZhbHVlPW5ldyBEYXRlKCRzY29wZS5jbGllbnRFeHRyYUZpZWxkc1tpXS5maWVsZF92YWx1ZSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQogIHsKICAgIGdldENsaWVudEV2ZW50cygkaHR0cCwkc2NvcGUsJ2N1cnJlbnRDbGllbnRFdmVudHMnLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKCiAgICBnZXRDbGllbnRQYXltZW50cygkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsJ2N1cnJlbnRDbGllbnRQYXltZW50cycpOwoKICAgICRzY29wZS5hcmNoaXZlQ2xpZW50TW9kYWwgPSBmdW5jdGlvbigpCiAgICB7Ci8vIGFyY2hpdmUvZGVsZXRlIGNsaWVudCAtIGFzayBpZiBzdXJlCiAgICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewogICAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYXJjaGl2ZV9jbGllbnRfbW9kYWwucGhwJywKICAgICAgICBzaXplOiAneHMnLAogICAgICAgIGNvbnRyb2xsZXI6ICdhcmNoaXZlX2NsaWVudF9tb2RhbCcsICAvLyAncGF5bWVueURldGFpbHNNb2RhbENvbnRyb2xsZXInLAogICAgICAgIHJlc29sdmU6IHsKICAgICAgICAgIGJ1c2luZXNzX3VzZXJfaWQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLmJ1c2luZXNzX3VzZXJfaWQ7CiAgICAgICAgICB9LAogICAgICAgICAgYnVzZXJfbGFzdF9uYW1lOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuICRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5idXNlcl9sYXN0X25hbWU7CiAgICAgICAgICB9LAogICAgICAgICAgYnVzZXJfZmlyc3RfbmFtZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYnVzZXJfZmlyc3RfbmFtZTsKICAgICAgICAgIH0sCiAgICAgICAgICBpc19pbnN0cnVjdG9yOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgICAkc2NvcGUucGFja2FnZURlbGV0ZSA9IGZ1bmN0aW9uKHBhY2thZ2UpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJwYWNrYWdlIGRlbGV0ZSAiK0pTT04uc3RyaW5naWZ5KHBhY2thZ2UpKTsKICAgICAgZGVsZXRlUGFja2FnZSgkaHR0cCwkc2NvcGUscGFja2FnZS5wYWNrYWdlX3VzZXJfaWQsJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLmJ1c2luZXNzX3VzZXJfaWQsc3VjY2Vzc19jYWxsYmFjaywgc3VjY2Vzc19jYWxsYmFjayk7CiAgICAgIGZ1bmN0aW9uIHN1Y2Nlc3NfY2FsbGJhY2soKQogICAgICB7CiAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgICB9CiAgICB9CgogICAgJHNjb3BlLnVwZGF0ZUNsaWVudEV4dHJhRmllbGRzID0gZnVuY3Rpb24oKQogICAgewogICAgICBsb2dEZWJ1ZygidXBkYXRlQ2xpZW50RXh0cmFGaWVsZHMiKTsKICAgICAgdGhlZGF0YSA9IHsKICAgICAgICBleHRyYUZpZWxkczokc2NvcGUuY2xpZW50RXh0cmFGaWVsZHMKICAgICAgfTsKICAgICAgJHNjb3BlLmV4dHJhRmllbGRzQWxlcnRNZXNzYWdlPSLXqdeV157XqC4uLiI7CiAgICAgIHVwZGF0ZUNsaWVudEV4dHJhRmllbGRzKCRodHRwLCRzY29wZSwkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYnVzaW5lc3NfdXNlcl9pZCx0aGVkYXRhLHVwZGF0ZUV2ZW50Q2xpZW50RmllbGRzX2NhbGxiYWNrLCB1cGRhdGVFdmVudENsaWVudEZpZWxkc19jYWxsYmFjayk7CgogICAgICBmdW5jdGlvbiB1cGRhdGVFdmVudENsaWVudEZpZWxkc19jYWxsYmFjaygpCiAgICAgIHsKLy8gZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLHNldFBhcnRpY2lwYXRlZCk7CiAgICAgICAgJHNjb3BlLmV4dHJhRmllbGRzQWxlcnRNZXNzYWdlPSLXoNep157XqCEiOwogICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkKICAgICAgICB7CiAgICAgICAgICAkc2NvcGUuZXh0cmFGaWVsZHNBbGVydE1lc3NhZ2U9bnVsbDsKICAgICAgICB9LCAzMDAwKTsKICAgICAgfQogICAgfTsKCiAgICAkc2NvcGUuc2NoZWR1bGVFdmVudEZvckNsaWVudCA9IGZ1bmN0aW9uKCkKICAgIHsKICAgICAgbG9nRGVidWcoInNlZXRpbmcgc2hhcmUgcHJvcGVydHkgdXNlcl9pZCAiKyRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXSk7CiAgICAgIHNoYXJlZFByb3BlcnRpZXMuc2V0X3NlbGVjdGVkX3VzZXIoJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdKTsKICAgICAgJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jYWxlbmRhcicpOwogICAgfQogICAgJHNjb3BlLmludm9pY2VHZW5lcmF0ZUNoZWNrYm94ID0gZnVuY3Rpb24oZnBheW1lbnQpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJpbnZvaWNlR2VuZXJhdGVDaGVja2JveCBmb3IgIitKU09OLnN0cmluZ2lmeShmcGF5bWVudCkpOwogICAgICBzZXRDbGllbnRQYXltZW50SW52b2ljZUdlbmVyYXRlZCgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsZnBheW1lbnQudXNlcl9wYXltZW50X2lkLGZwYXltZW50Lmludm9pY2VfZ2VuZXJhdGVkLHNldENsaWVudFBheW1lbnRJbnZvaWNlR2VuZXJhdGVkX2NhbGxiYWNrLCBzZXRDbGllbnRQYXltZW50SW52b2ljZUdlbmVyYXRlZF9jYWxsYmFjayk7CiAgICAgIGZ1bmN0aW9uIHNldENsaWVudFBheW1lbnRJbnZvaWNlR2VuZXJhdGVkX2NhbGxiYWNrKCkKICAgICAgewogICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKICAgICAgfQogICAgfTsKCiAgICAkc2NvcGUucmVjYWxjVXNlckJhbGFuY2UgPSBmdW5jdGlvbigpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJyZWNhbGNVc2VyQmFsYW5jZSIpOwogICAgICByZWNhbGNVc2VyQmFsYW5jZSgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsIHJlY2FsY1VzZXJCYWxhbmNlX2NhbGxiYWNrKTsKICAgICAgZnVuY3Rpb24gcmVjYWxjVXNlckJhbGFuY2VfY2FsbGJhY2soKQogICAgICB7CiAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgICB9ICAgIH0KICAgICRzY29wZS51cGRhdGVFdmVudFBhY2thZ2VSZWZlcmVuY2UgPSBmdW5jdGlvbih1c2VyX2lkLCBmbWVldGluZykKICAgIHsKICAgICAgbG9nRGVidWcoInVwZGF0ZUV2ZW50UGFja2FnZVJlZmVyZW5jZSwgdXNlcj0iK3VzZXJfaWQrIiwgZm1lZXRpbmc9IitKU09OLnN0cmluZ2lmeShmbWVldGluZykpOwogICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAgICAgICBhbmltYXRpb246IGZhbHNlLAogICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2NsaWVudF9ldmVudF9wYWNrYWdlX2Fzc29jaWF0aW9uLnBocCcsCiAgICAgICAgc2l6ZTogJ3hzJywKICAgICAgICBjb250cm9sbGVyOiAnZXZlbnRQYWNrYWdlQXNzb2NpYXRpb25Nb2RhbENvbnRyb2xsZXInLCAgLy8gJ3BheW1lbnlEZXRhaWxzTW9kYWxDb250cm9sbGVyJywKICAgICAgICByZXNvbHZlOiB7CiAgICAgICAgICBmbWVldGluZzogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiBmbWVldGluZzsKICAgICAgICAgIH0sCiAgICAgICAgICBiYWxhbmNlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuICRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5iYWxhbmNlOwogICAgICAgICAgfSwKICAgICAgICAgIGJ1c2luZXNzX3VzZXJfaWQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQ7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgIH07CgogICAgJHNjb3BlLnVwZGF0ZVBhY2thZ2VQYXltZW50UmVmZXJlbmNlID0gZnVuY3Rpb24odXNlcl9pZCwgZnBhY2thZ2UpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJ1cGRhdGVQYWNrYWdlUGF5bWVudFJlZmVyZW5jZSwgdXNlcj0iK3VzZXJfaWQrIiwgZnBhY2thZ2U9IitKU09OLnN0cmluZ2lmeShmcGFja2FnZSkpOwogICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAgICAgICBhbmltYXRpb246IGZhbHNlLAogICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2NsaWVudF9wYWNrYWdlX3BheW1lbnRfYXNzb2NpYXRpb24ucGhwJywKICAgICAgICBzaXplOiAneHMnLAogICAgICAgIGNvbnRyb2xsZXI6ICdwYWNrYWdlUGF5bWVudEFzc29jaWF0aW9uTW9kYWxDb250cm9sbGVyJywgIC8vICdwYXltZW55RGV0YWlsc01vZGFsQ29udHJvbGxlcicsCiAgICAgICAgcmVzb2x2ZTogewogICAgICAgICAgZnBhY2thZ2U6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gZnBhY2thZ2U7CiAgICAgICAgICB9LAogICAgICAgICAgYmFsYW5jZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYmFsYW5jZTsKICAgICAgICAgIH0sCiAgICAgICAgICBidXNpbmVzc191c2VyX2lkOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuICRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9OwoKLy8gc2hvdyBwYXltZW50IHBvcHVwCiAgICAkc2NvcGUuc2hvd1BheW1lbnREZXRhaWxzID0gZnVuY3Rpb24oZnBheW1lbnQpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJzaG93UGF5bWVudERldGFpbHMiKTsKICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgICAgICAgYW5pbWF0aW9uOiBmYWxzZSwKICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9jbGllbnRfcGF5bWVudF9kZXRhaWxzLnBocCcsCiAgICAgICAgc2l6ZTogJ3hzJywKICAgICAgICBjb250cm9sbGVyOiAncGF5bWVueURldGFpbHNNb2RhbENvbnRyb2xsZXInLAogICAgICAgIHJlc29sdmU6IHsKICAgICAgICAgIGZwYXltZW50OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIGZwYXltZW50OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgICAkc2NvcGUuaW52b2ljZU51bWJlckNoYW5nZWQgPSBmdW5jdGlvbihuZXdfaW52b2ljZV9udW1iZXIsZnBheW1lbnQpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJpbnZvaWNlTnVtYmVyQ2hhbmdlZCAiKyBuZXdfaW52b2ljZV9udW1iZXIgKyJmb3IgIitKU09OLnN0cmluZ2lmeShmcGF5bWVudCkpOwogICAgICBzZXRDbGllbnRQYXltZW50SW52b2ljZU51bWJlcigkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsZnBheW1lbnQudXNlcl9wYXltZW50X2lkLG5ld19pbnZvaWNlX251bWJlcixzZXRDbGllbnRQYXltZW50SW52b2ljZU51bWJlcl9jYWxsYmFjaywgc2V0Q2xpZW50UGF5bWVudEludm9pY2VOdW1iZXJfY2FsbGJhY2spOwogICAgICBmdW5jdGlvbiBzZXRDbGllbnRQYXltZW50SW52b2ljZU51bWJlcl9jYWxsYmFjaygpCiAgICAgIHsKLy8gJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgICB9CiAgICB9OwoKICAgICRzY29wZS4kb24oImNsaWVudFBhZ2VSZWxvYWREYXRhIixmdW5jdGlvbihlLGEpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJjbGllbnRQYWdlUmVsb2FkRGF0YSIpOwogICAgICBnZXRCdXNpbmVzc1VzZXJQYWNrYWdlcygkaHR0cCwkc2NvcGUsJ3VzZXJfcGFja2FnZXMnLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKICAgICAgZ2V0Q2xpZW50UGF5bWVudHMoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLCdjdXJyZW50Q2xpZW50UGF5bWVudHMnKTsKICAgICAgZ2V0Q2xpZW50RXZlbnRzKCRodHRwLCRzY29wZSwnY3VycmVudENsaWVudEV2ZW50cycsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwogICAgICBnZXRCdXNpbmVzc0NsaWVudEluZm8oJGh0dHAsJHNjb3BlLCdmb3JtVXBkYXRlQ2xpZW50QW5ndWxhcicsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwoKICAgICAgLy8gJHRpbWVvdXQoZnVuY3Rpb24oKQogICAgICAvLyB7CiAgICAgIC8vICAgJHNjb3BlLmN1cnNvcmRlbGV0ZT0iIjsKICAgICAgLy8gICBkb2N1bWVudC5ib2R5LnN0eWxlLmN1cnNvcj0nJzsKICAgICAgLy8gfSwgMjAwMCk7CgogICAgfSk7CgogICAgJHNjb3BlLmlzQ29uZmlybWVkT3JDbG9zZWQgPSBmdW5jdGlvbihldmVudCkKICAgIHsKICAgICAgaWYgKCRzY29wZS5zaG93QWxsRXZlbnRzKQogICAgICB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KCiAgICAgIGlmICgoZXZlbnQuaXNfY29uZmlybWVkID09IDEpIHx8IChldmVudC5pc19maW5hbF9zdGF0dXMgPT0gMSkgfHwgKChldmVudC5pc193YWl0aW5nX2xpc3QgPT0gMSkgJiYgKGV2ZW50LmlzX2NhbmNlbGVkID09IDApKSkKICAgICAgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIGVsc2UKICAgICAgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfQogICAgJHNjb3BlLmdvdG9DbGllbnRFZGl0UGFnZT1nb3RvQ2xpZW50RWRpdFBhZ2U7CiAgICAkc2NvcGUuZ290b0JhY2s9ZnVuY3Rpb24oKQogICAgewogICAgICBsb2dEZWJ1ZygnZ28gYmFjaycpOwogICAgICB3aW5kb3cuaGlzdG9yeS5iYWNrKCk7CiAgICB9OwoKICAgICRzY29wZS5nb3RvRXZlbnRQYWdlID0gZnVuY3Rpb24gKHRoZWV2ZW50KQogICAgewogICAgICBnb3RvRXZlbnRQYWdlKHRoZWV2ZW50KTsKICAgIH0KICB9CiAgJHNjb3BlLmluaXRpYXRlUGF5bWVudCA9IGZ1bmN0aW9uKGlzcGx1cykKICB7CiAgICBsb2dEZWJ1ZygiaW5pdGlhdGVQYXltZW50IGlzcGx1cyIraXNwbHVzKTsKICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewogICAgICBhbmltYXRpb246IGZhbHNlLAogICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9jbGllbnRfcGF5bWVudC5waHAnLAogICAgICBjb250cm9sbGVyOiAnYnVzaW5lc3NDbGllbmRDYXJkUGF5bWVudCcsCi8vIHNpemU6IHNpemUsCiAgICAgIHJlc29sdmU6IHsKICAgICAgICBjdXJyZW50Q2xpZW50OiBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF07CiAgICAgICAgfSwKICAgICAgICBpc3BsdXM6IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIGlzcGx1czsKICAgICAgICB9LAogICAgICAgIGJ1c2luZXNzQ29uZmlnOiBCdXNpbmVzc0NvbmZpZy5nZXQoKSwKICAgICAgICBwYXltZW50czogZ2V0Q2xpZW50UGF5bWVudHNQcm9taXNlKCRodHRwLCAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYnVzaW5lc3NfdXNlcl9pZCkKICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHIpIHsKICAgICAgICAgICAgICByZXR1cm4gci5kYXRhLmpzb24KICAgICAgICAgICAgfSkKICAgICAgfQogICAgfSk7CiAgfQoKICAkc2NvcGUudXBkYXRlVXNlckZpcnN0TmFtZSA9IGZ1bmN0aW9uKG5ld1ZhbHVlKQogIHsKICAgIHNldENsaWVudEZpcnN0TmFtZSgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsbmV3VmFsdWUsYWZ0ZXJDbGllbnRTZXQsYWZ0ZXJDbGllbnRTZXQpOwogICAgZnVuY3Rpb24gYWZ0ZXJDbGllbnRTZXQoKQogICAgewogICAgICBnZXRCdXNpbmVzc0NsaWVudEluZm8oJGh0dHAsJHNjb3BlLCdmb3JtVXBkYXRlQ2xpZW50QW5ndWxhcicsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwogICAgfQogIH0KICAkc2NvcGUudXBkYXRlVXNlckxhc3ROYW1lID0gZnVuY3Rpb24obmV3VmFsdWUpCiAgewogICAgc2V0Q2xpZW50TGFzdE5hbWUoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLG5ld1ZhbHVlLGFmdGVyQ2xpZW50U2V0LGFmdGVyQ2xpZW50U2V0KTsKICAgIGZ1bmN0aW9uIGFmdGVyQ2xpZW50U2V0KCkKICAgIHsKICAgICAgZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKICAgIH0KICB9CiAgJHNjb3BlLnVwZGF0ZVVzZXJFbWFpbCA9IGZ1bmN0aW9uKG5ld1ZhbHVlKQogIHsKICAgIHNldENsaWVudEVtYWlsKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCxuZXdWYWx1ZSxhZnRlcnNldENsaWVudEVtYWlsLGFmdGVyc2V0Q2xpZW50RW1haWwpOwogICAgZnVuY3Rpb24gYWZ0ZXJzZXRDbGllbnRFbWFpbCgpCiAgICB7CiAgICAgIGdldEJ1c2luZXNzQ2xpZW50SW5mbygkaHR0cCwkc2NvcGUsJ2Zvcm1VcGRhdGVDbGllbnRBbmd1bGFyJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CiAgICB9CiAgfQoKCiAgJHNjb3BlLnVwZGF0ZVVzZXJQaG9uZU51bWJlciA9IGZ1bmN0aW9uKG5ld1ZhbHVlKQogIHsKICAgIG5ld1ZhbHVlID0gbmV3VmFsdWUucmVwbGFjZSgnLScsJycpOwogICAgaWYgKGlzTmFOKG5ld1ZhbHVlKSkKICAgIHsKICAgICAgYWxlcnQoIteQ16DXkCDXlNeW158g157Xodek16gg15jXnNek15XXnyDXqten15nXnyIpOwogICAgICBnZXRCdXNpbmVzc0NsaWVudEluZm8oJGh0dHAsJHNjb3BlLCdmb3JtVXBkYXRlQ2xpZW50QW5ndWxhcicsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwogICAgfQogICAgZWxzZQogICAgewogICAgICBzZXRDbGllbnRQaG9uZU51bWJlcigkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsbmV3VmFsdWUsc2V0Q2xpZW50UGhvbmVOdW1iZXJfY2FsbGJhY2ssc2V0Q2xpZW50UGhvbmVOdW1iZXJfY2FsbGJhY2spOwogICAgICBmdW5jdGlvbiBzZXRDbGllbnRQaG9uZU51bWJlcl9jYWxsYmFjaygpCiAgICAgIHsKICAgICAgICBnZXRCdXNpbmVzc0NsaWVudEluZm8oJGh0dHAsJHNjb3BlLCdmb3JtVXBkYXRlQ2xpZW50QW5ndWxhcicsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwogICAgICB9CiAgICB9CiAgfQogICRzY29wZS51cGRhdGVVc2VyRXZlbnRQcmljZSA9IGZ1bmN0aW9uKG5ld3ZhbHVlLCB0aGVldmVudCkKICB7CiAgICBuZXdfcHJpY2U9bmV3dmFsdWU7CiAgICBzZXRDbGllbnRFdmVudFByaWNlKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCx0aGVldmVudC5ldmVudF9pZCwgbmV3X3ByaWNlLHNldENsaWVudEV2ZW50UHJpY2VfY2FsbGJhY2ssIHNldENsaWVudEV2ZW50UHJpY2VfY2FsbGJhY2spOwogICAgZnVuY3Rpb24gc2V0Q2xpZW50RXZlbnRQcmljZV9jYWxsYmFjaygpCiAgICB7CiAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKICAgIH0KICB9OwoKICAkc2NvcGUudXBkYXRlVXNlclBhY2thZ2VFdmVudHNDb3VudGVyID0gZnVuY3Rpb24obmV3dmFsdWUsIHRoZXBhY2thZ2UpCiAgewogICAgZXZlbnRzX2NvdW50ZXI9bmV3dmFsdWU7CiAgICBzZXRVc2VyUGFja2FnZUV2ZW50c0NvdW50ZXIoJGh0dHAsJHNjb3BlLHRoZXBhY2thZ2UucGFja2FnZV91c2VyX2lkLGV2ZW50c19jb3VudGVyLHNldFVzZXJQYWNrYWdlRXZlbnRzQ291bnRlcl9jYWxsYmFjaywgc2V0VXNlclBhY2thZ2VFdmVudHNDb3VudGVyX2NhbGxiYWNrKQogICAgZnVuY3Rpb24gc2V0VXNlclBhY2thZ2VFdmVudHNDb3VudGVyX2NhbGxiYWNrKCkKICAgIHsKICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgfQogIH07CiAgJHNjb3BlLnVwZGF0ZVVzZXJQYWNrYWdlUGFja2FnZVByaWNlID0gZnVuY3Rpb24obmV3dmFsdWUsIHRoZXBhY2thZ2UpCiAgewogICAgcGFja2FnZV9wcmljZT1uZXd2YWx1ZTsKICAgIHNldFVzZXJQYWNrYWdlUGFja2FnZVByaWNlKCRodHRwLCRzY29wZSx0aGVwYWNrYWdlLnBhY2thZ2VfdXNlcl9pZCxwYWNrYWdlX3ByaWNlLHNldFVzZXJQYWNrYWdlUGFja2FnZVByaWNlX2NhbGxiYWNrLCBzZXRVc2VyUGFja2FnZVBhY2thZ2VQcmljZV9jYWxsYmFjaykKICAgIGZ1bmN0aW9uIHNldFVzZXJQYWNrYWdlUGFja2FnZVByaWNlX2NhbGxiYWNrKCkKICAgIHsKLy8gZ2V0QnVzaW5lc3NVc2VyUGFja2FnZXMoJGh0dHAsJHNjb3BlLCd1c2VyX3BhY2thZ2VzJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CiAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKICAgIH0KICB9OwoKICAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXIgPSB7fTsKICBsb2dEZWJ1Zygkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CiAgJHNjb3BlLnNob3dfY2xpZW50X3VwZGF0ZV9jbGllbnQgPSB0cnVlOwogICRzY29wZS5zaG93X2NsaWVudF91cGRhdGVfc2F2ZSA9IGZhbHNlOwogICRzY29wZS5zaG93X2NsaWVudF9kZWxldGVfY2xpZW50ID0gdHJ1ZTsKICAkc2NvcGUuc2hvd19jbGllbnRfdXBkYXRlX2NhbmNlbCA9IGZhbHNlOwoKICAkc2NvcGUudXBkYXRlQ2xpZW50RW5hYmxlID0gZnVuY3Rpb24oKSB7CiAgICBsb2dEZWJ1ZygiZW5hYmxpbmcgZWRpdGluZyAoJHNjb3BlLmNsaWVudHNVcGRhdGVEaXNhYmxlZCB3YXMgIiArICRzY29wZS5jbGllbnRzVXBkYXRlRGlzYWJsZWQgKyAiKSIpOwogICAgJHNjb3BlLmNsaWVudHNVcGRhdGVEaXNhYmxlZCA9IGZhbHNlOwogICAgJHNjb3BlLnNob3dfY2xpZW50X3VwZGF0ZV9jbGllbnQgPSBmYWxzZTsKICAgICRzY29wZS5zaG93X2NsaWVudF91cGRhdGVfc2F2ZSA9IHRydWU7CiAgICAkc2NvcGUuc2hvd19jbGllbnRfZGVsZXRlX2NsaWVudCA9IGZhbHNlOwogICAgJHNjb3BlLnNob3dfY2xpZW50X3VwZGF0ZV9jYW5jZWwgPSB0cnVlOwogIH0KICAkc2NvcGUudXBkYXRlQ2xpZW50RGlzYWJsZSA9IGZ1bmN0aW9uKCkgewogICAgbG9nRGVidWcoImRpc2FibGUgZWRpdGluZyIpOwovLwkJJGxvY2F0aW9uLnBhdGgoJy9DbGllbnRzLycrJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwogICAgJHJvdXRlLnJlbG9hZCgpOwogIH0KICAkc2NvcGUuc2NoZWR1bGVFdmVudEZyb21FbmRVc2VyID0gZnVuY3Rpb24oKSB7CiAgICBzaGFyZWREYXRhLnNldFNlbGVjdGVkRW5kVXNlcih7CiAgICAgIGlkOiAkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCwKICAgICAgZmlyc3RfbmFtZTogJHNjb3BlLmN1cnJlbnRDbGllbnQudXNlcnNbMF0uZmlyc3RfbmFtZSwKICAgICAgbGFzdF9uYW1lOiAkc2NvcGUuY3VycmVudENsaWVudC51c2Vyc1swXS5sYXN0X25hbWUKICAgIH0pOwogICAgbG9nRGVidWcoInNjaGVkdWxlIGV2ZW50IGZvciB1c2VyICIgKyAkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7Ci8vCQkkbG9jYXRpb24ucGF0aCgnL0NsaWVudHMvJyskcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CiAgICAkbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2NhbGVuZGFyJyk7CiAgfQoKICAkc2NvcGUudXNlckRlbGV0ZVBheW1lbnQgPSBmdW5jdGlvbiAoZnBheW1lbnQpCiAgewogICAgLy8gJHNjb3BlLmN1cnNvcmRlbGV0ZT0id2FpdCI7CiAgICBsb2dEZWJ1ZygidXNlckRlbGV0ZVBheW1lbnQiKTsKICAgIC8vIGRvY3VtZW50LmJvZHkuc3R5bGUuY3Vyc29yPSd3YWl0JzsKCiAgICBkZWxldGVDbGllbnRQYXltZW50cygkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsZnBheW1lbnQudXNlcl9wYXltZW50X2lkLGRlbGV0ZUNsaWVudFBheW1lbnRzX3N1Y2Nlc3NfY2FsbGJhY2spOwogICAgZnVuY3Rpb24gZGVsZXRlQ2xpZW50UGF5bWVudHNfc3VjY2Vzc19jYWxsYmFjaygpCiAgICB7CiAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKICAgICAgbG9nRGVidWcoInVzZXJEZWxldGVQYXltZW50Iik7CiAgICAgIC8vICRzY29wZS5jdXJzb3JkZWxldGU9IiI7CiAgICAgIC8vIGRvY3VtZW50LmJvZHkuc3R5bGUuY3Vyc29yPScnOwogICAgfQogIH0KLy8gcmVtb3ZlIGVuZCB1c2VyIGZyb20gZXZlbnQKICAkc2NvcGUudXNlckRlbGV0ZUV2ZW50ID0gZnVuY3Rpb24oZW5kdXNlcl9pZCwgdGhlZXZlbnQpCiAgewovLyBpZiBpdCdzIGEgY2xhc3MgLSB3ZSBzaW1wbHkgcmVtb3ZlIHRoZSB1c2VyIGZyb20gdGhlIGV2ZW50CiAgICBpZiAodGhlZXZlbnQuaXNfY2xhc3M9PTEpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJzY29wZS51c2VyRGVsZXRlRXZlbnQiKTsKICAgICAgcmVtb3ZlRW5kVXNlckZyb21FdmVudCgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsdGhlZXZlbnQuZXZlbnRfaWQscmVtb3ZlRW5kVXNlckZyb21FdmVudF9maW5pc2gsIHJlbW92ZUVuZFVzZXJGcm9tRXZlbnRfZmluaXNoKTsKICAgICAgZnVuY3Rpb24gcmVtb3ZlRW5kVXNlckZyb21FdmVudF9maW5pc2goKQogICAgICB7CiAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgICB9CiAgICB9Ci8vIGlmIGl0cyBub3QgYSBjbGFzcyAtIHdlIG5lZWQgdG8gcmVtb3ZlIHRoZSBldmVudCBpdHNlbGYKICAgIGVsc2UKICAgIHsKLy8gYWxlcnQoIm5vdCBjbGFzcyBldmVudCwgVE9ETyIpOwogICAgfQogIH07CgovLyByZXRyZXZpbmcgcGFja2FnZXMgZm9yIHRoZSBidXNpbmVzcwogIGdldEJ1c2luZXNzUGFja2FnZXMoJGh0dHAsJHNjb3BlLCdwYWNrYWdlcycpOwoKLy8gZ2V0IHBhY2thZ2VzIGZvciB0aGlzIHNwZWNpZmljIHVzZXIKICBnZXRCdXNpbmVzc1VzZXJQYWNrYWdlcygkaHR0cCwkc2NvcGUsJ3VzZXJfcGFja2FnZXMnLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKLy8gYWRkaW5nIHBhY2thZ2UgdG8gdXNlciAtIGNhbGxlZCB3aGVuIGEgcGFja2FnZSBpcyBzZWxlY3RlZAogICRzY29wZS5wYWNrYWdlRm9yQ2xpZW50U2VsZWN0ZWQgPSBmdW5jdGlvbihzZWxlY3RlZFBhY2thZ2UpIHsKICAgIGlmIChzZWxlY3RlZFBhY2thZ2UpIHsKLy8gbG9nRGVidWcoJ3llcyBzZWxlY3RlZCAnICsgSlNPTi5zdHJpbmdpZnkoc2VsZWN0ZWRQYWNrYWdlKSk7CiAgICAgIGFkZEJ1c2luZXNzUGFja2FnZVRvVXNlcigkaHR0cCwkc2NvcGUsc2VsZWN0ZWRQYWNrYWdlLm9yaWdpbmFsT2JqZWN0LCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLGFkZEJ1c2luZXNzUGFja2FnZVN1Y2Nlc3MpOwogICAgICBmdW5jdGlvbiBhZGRCdXNpbmVzc1BhY2thZ2VTdWNjZXNzKCkKICAgICAgewogICAgICAgIGxvZ0RlYnVnKCJhZGRCdXNpbmVzc1BhY2thZ2VTdWNjZXNzMiIpOwovLyBnZXRCdXNpbmVzc1BhY2thZ2VzKCRodHRwLCRzY29wZSwncGFja2FnZXMnKTsKLy8gZ2V0QnVzaW5lc3NVc2VyUGFja2FnZXMoJGh0dHAsJHNjb3BlLCd1c2VyX3BhY2thZ2VzJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CiAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgICB9CiAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnYW5ndWNvbXBsZXRlLWFsdDpjbGVhcklucHV0JywgJ2NsaWVudF9hbmd1Y29tcGxldGUnKTsKICAgIH0KICAgIGVsc2UKICAgIHsKLy8gbG9nRGVidWcoJ25vdCBzZWxlY3RlZCwgZG8gbm90aGluZycpOwogICAgfQogIH07Cn0pOwoKCi8vIE5lZWQgdG8gZGlzdGluZ3Vpc2ggYmV0d2VlbiBlbmQgdXNlciAoY2xpZW50KSBhbmQgYnVzaW5lc3Mgb3duZXIuCi8vIGN1cnJlbnRseSBjYWxscyBvbmx5IGVuZCB1c2VyCmt1emVBcHAuY29udHJvbGxlcignSG9tZUNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkdWliTW9kYWwpCnsKCiAgZ2V0QWxsQ2xpZW50cygkaHR0cCwkc2NvcGUsJ2FsbENsaWVudHMnKTsKCiAgJHNjb3BlLmhvbWVwYWdlTGltaXQ9NjsKICBnZXRPcGVuZWRFdmVudHMoJGh0dHAsJHNjb3BlLCRzY29wZS5ob21lcGFnZUxpbWl0LCdvcGVuZWRfZXZlbnRzJyk7CgogIHZhciB0b2RheWRhdGUgPSBuZXcgRGF0ZSgpOwogIHZhciBob3dtYW55ZGF5c2FoZWFkPTMwOwogIHZhciBzdGFydGRhdGU9dG9kYXlkYXRlLmdldEZ1bGxZZWFyKCkrIi0iKygxK3RvZGF5ZGF0ZS5nZXRNb250aCgpKSsiLSIrdG9kYXlkYXRlLmdldERhdGUoKTsKICB0b2RheWRhdGUuc2V0RGF0ZSh0b2RheWRhdGUuZ2V0RGF0ZSgpICsgaG93bWFueWRheXNhaGVhZCk7CiAgdmFyIGVuZGRhdGU9dG9kYXlkYXRlLmdldEZ1bGxZZWFyKCkrIi0iKygxK3RvZGF5ZGF0ZS5nZXRNb250aCgpKSsiLSIrdG9kYXlkYXRlLmdldERhdGUoKTsKCi8vIGZpbHRlciBmb3IgdXNlcnMgd2hvIGhhdmUgZGVidAogICRzY29wZS5oYXZlRGVidCA9IGZ1bmN0aW9uKGV1c2VyKQogIHsKICAgIGlmIChldXNlci51c2VyX2JhbGFuY2UgPCAwKQogICAgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogIH07CgogICRzY29wZS5nb3RvQ2xpZW50UGFnZSA9IGZ1bmN0aW9uKGJ1c2luZXNzX3VzZXJfaWQpCiAgewovLyBsb2dEZWJ1ZyhldXNlcik7CiAgICB3aW5kb3cubG9jYXRpb24uaHJlZj0nLyMvYnVzaW5lc3NfY2xpZW50cy8nICsgYnVzaW5lc3NfdXNlcl9pZDsKICB9CgogIHZhciBwYXlsb2FkID0gJ3N0YXJ0PScgKyBzdGFydGRhdGUgKyAnJmVuZD0nICsgZW5kZGF0ZTsKICB2YXIgY29uZmlnID0gewogICAgaGVhZGVyczogeydDb250ZW50LVR5cGUnOidhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQ7IGNoYXJzZXQ9VVRGLTgnfQogIH0KICB2YXIgcG9zdHVybCA9ICIvYXBpL2FkbWluL3JlcG9ydHMvZXZlbnRzMiI7CgogICRzY29wZS5ldmVudFJlcG9ydENvbmZpZyA9IHt9OwogICRzY29wZS5ldmVudFJlcG9ydENvbmZpZy5zb3VyY2UgPSAiZG9jcyI7CiAgJHNjb3BlLmV2ZW50UmVwb3J0Q29uZmlnLmZpbHRlcnMgPSB7CiAgICBzdGFydF9kYXRlOiBzdGFydGRhdGUsCiAgICBpc19jYW5jZWxlZDogJzAnLAogICAgZW5kX2RhdGU6IGVuZGRhdGUKICB9OwoKICBnZXRFdmVudHNSZXBvcnQoJGh0dHAsJHNjb3BlLCAkc2NvcGUuZXZlbnRSZXBvcnRDb25maWcsIGdldEV2ZW50c1JlcG9ydEFnZ3JlZ2F0ZWRfc3VjY2Vzcyk7CgogIGZ1bmN0aW9uIGdldEV2ZW50c1JlcG9ydEFnZ3JlZ2F0ZWRfc3VjY2VzcyhyZXNwb25zZSl7CiAgICAkc2NvcGUuYWRtaW5fZXZlbnRzID0gcmVzcG9uc2UuanNvbjsKICB9CiAgLy8gJGh0dHAucG9zdChwb3N0dXJsLCBwYXlsb2FkLCBjb25maWcpLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkKICAvLyB7CiAgLy8gICBsb2dEZWJ1ZygiZG9uZSIpOwogIC8vICAgJHNjb3BlLmFkbWluX2V2ZW50cyA9IGRhdGE7CiAgLy8gfSk7CgogICRzY29wZS5zaG93RXZlbnRQb3B1cCA9IGZ1bmN0aW9uKHNlbGVjdGVkRXZlbnQpIHsKICAgIHNob3dFdmVudFBvcHVwKHNlbGVjdGVkRXZlbnQsICR1aWJNb2RhbCkKICB9OwogICRzY29wZS5lZGl0RXZlbnQ9IGZ1bmN0aW9uICh0aGVldmVudCkKICB7CiAgICBnb3RvRXZlbnRQYWdlKHRoZWV2ZW50KTsKICB9Cn0pOwoKLy8ga3V6ZUFwcC5jb250cm9sbGVyKCdCdXNpbmVzc0NvbmZpZ0NvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkcm91dGVQYXJhbXMsICRsb2NhdGlvbiwgJHJvdXRlLCBzaGFyZWREYXRhKSB7CgprdXplQXBwLmNvbnRyb2xsZXIoJ0NvbmZpZ1VzZXJDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkdWliTW9kYWwsICRodHRwLCAkdGltZW91dCkKewogICRzY29wZS5pblRoZU1pZGRsZU9mU2F2ZT1mYWxzZTsKCiAgbG9nRGVidWcoIkNvbmZpZ1VzZXJDb250cm9sbGVyIik7Ci8vICRzY29wZS5hamF4X2luZm89IteU16nXmdeg15XXmdeZ150g16DXqdee16jXlSI7CgogIGdldEJ1c2luZXNzVXNlclJlbGF0aW9ucygkaHR0cCwkc2NvcGUsJ2J1c2luZXNzX3VzZXJfcmVsYXRpb25zJyxnZXRMb2dnZWRVc2VySW5mb19zdWNjZXNzLGdldExvZ2dlZFVzZXJJbmZvX2ZhaWx1cmUpOwoKICBnZXRMb2dnZWRVc2VySW5mbygkaHR0cCwkc2NvcGUsJ3VzZXJQcm9wZXJ0aWVzJyxnZXRMb2dnZWRVc2VySW5mb19zdWNjZXNzLGdldExvZ2dlZFVzZXJJbmZvX2ZhaWx1cmUpOwogIGZ1bmN0aW9uIGdldExvZ2dlZFVzZXJJbmZvX3N1Y2Nlc3MoKQogIHsKICAgIGxvZ0RlYnVnKCJnZXRMb2dnZWRVc2VySW5mb19zdWNjZXNzIik7CiAgICAvLyAkc2NvcGUudXNlclByb3BlcnRpZXNEdXBsaWNhdGUgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KCRzY29wZS51c2VyUHJvcGVydGllcykpOwogIH0KICBmdW5jdGlvbiBnZXRMb2dnZWRVc2VySW5mb19mYWlsdXJlKCkKICB7CiAgICBsb2dEZWJ1ZygiZ2V0TG9nZ2VkVXNlckluZm9fZmFpbHVyZSIpOwogIH0KCiAgJHNjb3BlLmJhY2sgPSBmdW5jdGlvbigpIHsKICAgIHdpbmRvdy5oaXN0b3J5LmJhY2soKTsKICB9OwoKICAkc2NvcGUuY2hhbmdlUGFzc3dvcmRNb2RhbCA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1ZygiY2hhbmdlUGFzc3dvcmRNb2RhbCIrJHNjb3BlLnVzZXJQcm9wZXJ0aWVzRHVwbGljYXRlWzBdKTsKICAgICRzY29wZS5pblRoZU1pZGRsZU9mU2F2ZT10cnVlOwogICAgZnVuY3Rpb24gc21zUmVzZXRQYXNzd29yZF9zdWNjZXNzKCkKICAgIHsKICAgICAgY29uc29sZS5sb2coInNtc1Jlc2V0UGFzc3dvcmRfc3VjY2VzcyIpOwogICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAgICAgICBhbmltYXRpb246IGZhbHNlLAogICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ21vZGFsX2NoYW5nZV9wYXNzd29yZC5waHAnLAogICAgICAgIGNvbnRyb2xsZXI6ICdtb2RhbF9jaGFuZ2VfcGFzc3dvcmQnLAogICAgICAgIHNpemU6ICdsJywKICAgICAgICByZXNvbHZlOiB7CiAgICAgICAgICB1c2VyX3Bob25lX251bWJlcjogZnVuY3Rpb24oKSB7Ci8vIHBhc3Npbmcgb3JpZ2luYWwgcGhvbmUgbnVtYmVyCiAgICAgICAgICAgIHJldHVybiAkc2NvcGUudXNlclByb3BlcnRpZXNEdXBsaWNhdGVbMF0ucGhvbmVfbnVtYmVyOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CgogICAgICBtb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHJlc3VsdCkgewogICAgICAgICRzY29wZS5pblRoZU1pZGRsZU9mU2F2ZT1mYWxzZTsKICAgICAgICBsb2dEZWJ1Zygnc21zUmVzZXRQYXNzd29yZCBNb2RhbCBmaW5pc2VoZCByZXN1bHQ6ICcgKyByZXN1bHQpOwogICAgICAgICRzY29wZS5hamF4X2luZm89IteU16HXmdeh157XkCDXoteV15PXm9eg15Qg15HXlNem15zXl9eUISI7Ci8vIGdldExvZ2dlZFVzZXJJbmZvKCRodHRwLCRzY29wZSwndXNlclByb3BlcnRpZXMnLGdldExvZ2dlZFVzZXJJbmZvX3N1Y2Nlc3MsZ2V0TG9nZ2VkVXNlckluZm9fZmFpbHVyZSk7CiAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKQogICAgICAgIHsKICAgICAgICAgICRzY29wZS5hamF4X2luZm89bnVsbDsKICAgICAgICB9LCAyMDAwKTsKICAgICAgICBsb2dEZWJ1Zygnc21zUmVzZXRQYXNzd29yZCBNb2RhbCBkaXNtaXNzZWQgYXQ6ICcgKyBuZXcgRGF0ZSgpKTsKICAgICAgfSwgZnVuY3Rpb24oKSB7CiAgICAgICAgJHNjb3BlLmluVGhlTWlkZGxlT2ZTYXZlPWZhbHNlOwogICAgICAgIGxvZ0RlYnVnKCdtb2RhbF9jaGFuZ2VfcGFzc3dvcmQgTW9kYWwgZGlzbWlzc2VkIGF0OiAnICsgbmV3IERhdGUoKSk7CiAgICAgIH0pOwogICAgfQoKCiAgICBjaGFuZ2VQYXNzd29yZFNNUygkaHR0cCwkc2NvcGUsJHNjb3BlLnVzZXJQcm9wZXJ0aWVzRHVwbGljYXRlWzBdLnBob25lX251bWJlcixzbXNSZXNldFBhc3N3b3JkX3N1Y2Nlc3MpOwogIH0KICAkc2NvcGUudXBkYXRlVXNlckNvbmZpZz1mdW5jdGlvbigpCiAgewogICAgJHNjb3BlLmluVGhlTWlkZGxlT2ZTYXZlPXRydWU7CiAgICBsb2dEZWJ1ZygidXBkYXRlVXNlckNvbmZpZywgaW5UaGVNaWRkbGVPZlNhdmU9Iiskc2NvcGUuaW5UaGVNaWRkbGVPZlNhdmUpOwovLyBsb2dEZWJ1Zygkc2NvcGUudXNlclByb3BlcnRpZXNEdXBsaWNhdGUpOwovLyBsb2dEZWJ1Zygkc2NvcGUudXNlclByb3BlcnRpZXMpOwogICAgaWYgKGFuZ3VsYXIuZXF1YWxzKCRzY29wZS51c2VyUHJvcGVydGllc0R1cGxpY2F0ZVswXS5waG9uZV9udW1iZXIsJHNjb3BlLnVzZXJQcm9wZXJ0aWVzWzBdLnBob25lX251bWJlcikpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJub3RoaW5nIGNoYW5nZWQgaW4gcGhvbmUgbnVtYmVyLCBjaGVja2luZyBvdGhlciBkYXRhIG90aGVyIGRhdGEiKTsKICAgICAgaWYgKGFuZ3VsYXIuZXF1YWxzKCRzY29wZS51c2VyUHJvcGVydGllc0R1cGxpY2F0ZVswXSwkc2NvcGUudXNlclByb3BlcnRpZXNbMF0pKQogICAgICB7CiAgICAgICAgJHNjb3BlLmluVGhlTWlkZGxlT2ZTYXZlPWZhbHNlOwogICAgICAgIGxvZ0RlYnVnKCJub3RoaW5nIGNoYW5nZWQgaW4gZGV0YWlscywgbm90aGluZyB0byBzYXZlIik7CiAgICAgICAgJHNjb3BlLmFqYXhfaW5mbz0i15zXkCDXkdeV16bXoteVINep15nXoNeV15nXmdedINec16nXnteZ16jXlC4uLiI7CiAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKQogICAgICAgIHsKICAgICAgICAgICRzY29wZS5hamF4X2luZm89bnVsbDsKICAgICAgICB9LCAxNTAwKTsKICAgICAgfQogICAgICBlbHNlCiAgICAgIHsKICAgICAgICBjaGFuZ2VVc2VyRGV0YWlscygkaHR0cCwkc2NvcGUsJHNjb3BlLnVzZXJQcm9wZXJ0aWVzWzBdLmZpcnN0X25hbWUsJHNjb3BlLnVzZXJQcm9wZXJ0aWVzWzBdLmxhc3RfbmFtZSwgJHNjb3BlLnVzZXJQcm9wZXJ0aWVzWzBdLmVtYWlsX2FkZHJlc3MsY2hhbmdlVXNlckRldGFpbHNfc3VjY2VzcywgY2hhbmdlVXNlckRldGFpbHNfZmFpbHVyZSk7CiAgICAgICAgJHNjb3BlLmFqYXhfaW5mbz0i157XoteT15vXnyDXqdeZ16DXldeZ15nXnS4uLiI7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGNoYW5nZVVzZXJEZXRhaWxzX3N1Y2Nlc3MoKQogICAgICB7CiAgICAgICAgbG9nRGVidWcoImNoYW5nZVVzZXJEZXRhaWxzX3N1Y2Nlc3MiKTsKICAgICAgICAkc2NvcGUuYWpheF9pbmZvPSLXlNep15nXoNeV15nXmdedINeg16nXnteo15Ug15HXlNem15zXl9eUISI7CiAgICAgICAgJHNjb3BlLmluVGhlTWlkZGxlT2ZTYXZlPWZhbHNlOwogICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkKICAgICAgICB7CiAgICAgICAgICAkc2NvcGUuYWpheF9pbmZvPW51bGw7CiAgICAgICAgfSwgMTUwMCk7CiAgICAgICAgZ2V0TG9nZ2VkVXNlckluZm8oJGh0dHAsJHNjb3BlLCd1c2VyUHJvcGVydGllcycsZ2V0TG9nZ2VkVXNlckluZm9fc3VjY2VzcyxnZXRMb2dnZWRVc2VySW5mb19mYWlsdXJlKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBjaGFuZ2VVc2VyRGV0YWlsc19mYWlsdXJlKCkKICAgICAgewogICAgICAgIGxvZ0RlYnVnKCJjaGFuZ2VVc2VyRGV0YWlsc19mYWlsdXJlIik7CiAgICAgIH0KCiAgICB9CiAgICBlbHNlCiAgICB7Ci8vIHVwZGF0ZSB1c2VyIGluZm8gLSBhZnRlciB2ZXJpZnlpbmcgcGFzc3dvcmQKICAgICAgY29uc29sZS5sb2coInBob25lIGNoYW5nZWQsIGNoZWNraW5nIGlmIG5ldyBwaG9uZSBpcyBpbiBkZXNjZW50IGZvcm1hdCIpOwogICAgICBpZiAoIWNoZWNrUGhvbmVOdW1iZXIoJHNjb3BlLnVzZXJQcm9wZXJ0aWVzWzBdLnBob25lX251bWJlcikpCiAgICAgIHsKICAgICAgICAkc2NvcGUuYWpheF9pbmZvPSLXkNeg15Ag15TXltefINee16HXpNeoINeY15zXpNeV158g16HXnNeV15zXqNeZINeq16fXmdefINec16fXkdec16og15TXldeT16LXldeqINee16fXmdeV15YuIjsKICAgICAgICAkdGltZW91dChmdW5jdGlvbigpCiAgICAgICAgewogICAgICAgICAgJHNjb3BlLmFqYXhfaW5mbz1udWxsOwogICAgICAgIH0sIDMwMDApOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBjb25zb2xlLmxvZygicGhvbmUgY2hhbmdlZCwgY2hlY2tpbmcgaWYgbmV3IHBob25lIGlzIG5vdCB1c2VkIGFscmVhZHkiKTsKICAgICAgaXNOZXdQaG9uZVVzZWRJZk5vdFNlbmRTTVMoJGh0dHAsJHNjb3BlLCRzY29wZS51c2VyUHJvcGVydGllc1swXS5waG9uZV9udW1iZXIsIGlzTmV3UGhvbmVVc2VkX3N1Y2Nlc3MsIGlzTmV3UGhvbmVVc2VkX2ZhaWx1cmUsZmFsc2UpOwogICAgICBmdW5jdGlvbiBpc05ld1Bob25lVXNlZF9zdWNjZXNzKHJlc3BvbnNlKQogICAgICB7CiAgICAgICAgY29uc29sZS5sb2coInBob25lIG5vdCB1c2VkIC0gcHJvbXB0aW5nIGZvciBwYXNzd29yZCIpOwogICAgICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewogICAgICAgICAgYW5pbWF0aW9uOiBmYWxzZSwKICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ21vZGFsX2NoZWNrX3Bhc3N3b3JkX3VwZGF0ZV9jb25maWcucGhwJywKICAgICAgICAgIGNvbnRyb2xsZXI6ICdtb2RhbF9jaGVja19wYXNzd29yZF91cGRhdGVfY29uZmlnJywKICAgICAgICAgIHNpemU6ICdsJywKICAgICAgICAgIHJlc29sdmU6IHsKICAgICAgICAgICAgbmV3X3VzZXJfcHJvZXJ0aWVzOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICByZXR1cm4gJHNjb3BlLnVzZXJQcm9wZXJ0aWVzWzBdOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIG1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7CiAgICAgICAgICBsb2dEZWJ1ZygnbW9kYWxfY2hlY2tfcGFzc3dvcmRfdXBkYXRlX2NvbmZpZyBNb2RhbCBmaW5pc2hlZCByZXN1bHQ6ICcgKyByZXN1bHQpOwogICAgICAgICAgJHNjb3BlLmFqYXhfaW5mbz0i15TXqdeZ16DXldeZ15nXnSDXoNep157XqNeVINeR15TXptec15fXlCEiOwogICAgICAgICAgJHNjb3BlLmluVGhlTWlkZGxlT2ZTYXZlPWZhbHNlOwogICAgICAgICAgZ2V0TG9nZ2VkVXNlckluZm8oJGh0dHAsJHNjb3BlLCd1c2VyUHJvcGVydGllcycsZ2V0TG9nZ2VkVXNlckluZm9fc3VjY2VzcyxnZXRMb2dnZWRVc2VySW5mb19mYWlsdXJlKTsKICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkKICAgICAgICAgIHsKICAgICAgICAgICAgJHNjb3BlLmFqYXhfaW5mbz1udWxsOwogICAgICAgICAgfSwgMzAwMCk7CiAgICAgICAgfSwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAkc2NvcGUuaW5UaGVNaWRkbGVPZlNhdmU9ZmFsc2U7CiAgICAgICAgICBsb2dEZWJ1ZygnbW9kYWxfY2hlY2tfcGFzc3dvcmRfdXBkYXRlX2NvbmZpZyBNb2RhbCBkaXNtaXNzZWQgYXQ6ICcgKyBuZXcgRGF0ZSgpKTsKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gaXNOZXdQaG9uZVVzZWRfZmFpbHVyZShyZXNwb25zZSkKICAgICAgewogICAgICAgICRzY29wZS5hamF4X2luZm89cmVzcG9uc2UubWVzc2FnZTsKICAgICAgICAkdGltZW91dChmdW5jdGlvbigpCiAgICAgICAgewogICAgICAgICAgJHNjb3BlLmFqYXhfaW5mbz1udWxsOwogICAgICAgIH0sIDIwMDApOwogICAgICB9CiAgICB9CiAgfTsKfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdtb2RhbF9jaGVja19wYXNzd29yZF91cGRhdGVfY29uZmlnJywgZnVuY3Rpb24oJHNjb3BlLCAkdGltZW91dCwgJHVpYk1vZGFsSW5zdGFuY2UsIG5ld191c2VyX3Byb2VydGllcywgJGh0dHApCnsKICAkc2NvcGUubmV3X3VzZXJfcHJvZXJ0aWVzPW5ld191c2VyX3Byb2VydGllczsKICBsb2dEZWJ1ZygibW9kYWxfY2hlY2tfcGFzc3dvcmRfdXBkYXRlX2NvbmZpZyBjb250cm9sbGVyIik7Ci8vICRzY29wZS5waG9uZV92ZXJpZmljYXRpb24gPSB7fTsgLy8gdGhlc2UgYXJlIHRoZSBjb21wbGV0ZSBkZXRhaWxzIGZvciB0aGUgbmV3IGV2ZW50IC8vCi8vICRzY29wZS5waG9uZV92ZXJpZmljYXRpb24ucGhvbmVfbnVtYmVyPW5ld191c2VyX3Byb2VydGllcy5waG9uZV9udW1iZXI7CiAgJHNjb3BlLmNsb3NlID0gZnVuY3Rpb24oKSB7CiAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnZGlzbWlzcycpOwogIH07CgogICRzY29wZS5jaGFuZ2VQaG9uZU51bWJlciA9IGZ1bmN0aW9uKCkKICB7CiAgICBjaGFuZ2VVc2VyRGV0YWlsc1ZlcmlmeSgkaHR0cCwkc2NvcGUsJHNjb3BlLm5ld191c2VyX3Byb2VydGllcy5waG9uZV9udW1iZXIsJHNjb3BlLm5ld191c2VyX3Byb2VydGllcy5maXJzdF9uYW1lLCRzY29wZS5uZXdfdXNlcl9wcm9lcnRpZXMubGFzdF9uYW1lLCAkc2NvcGUubmV3X3VzZXJfcHJvZXJ0aWVzLmVtYWlsX2FkZHJlc3MsJHNjb3BlLnZlcmlmeV91c2VyX3Bhc3N3b3JkLCRzY29wZS5waG9uZV92ZXJpZmljYXRpb24sY2hhbmdlVXNlckRldGFpbHNWZXJpZnlfc3VjY2VzcywgY2hhbmdlVXNlckRldGFpbHNWZXJpZnlfZmFpbHVyZSxmYWxzZSk7CiAgICBmdW5jdGlvbiBjaGFuZ2VVc2VyRGV0YWlsc1ZlcmlmeV9zdWNjZXNzKCkKICAgIHsKICAgICAgbG9nRGVidWcoImNoYW5nZVVzZXJEZXRhaWxzVmVyaWZ5X3N1Y2Nlc3MiKTsKLy8gYWxlcnQoJ9eU16nXmdeg15XXmdeZ150g16LXldeT15vXoNeVINeR15TXptec15fXlCcpOwogICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSh0cnVlKTsKICAgIH0KICAgIGZ1bmN0aW9uIGNoYW5nZVVzZXJEZXRhaWxzVmVyaWZ5X2ZhaWx1cmUocmVzcG9uc2UpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJjaGFuZ2VVc2VyRGV0YWlsc1ZlcmlmeV9mYWlsdXJlICIrcmVzcG9uc2UubWVzc2FnZSk7CiAgICAgICRzY29wZS5hamF4X2Vycm9yPXJlc3BvbnNlLm1lc3NhZ2UrIi4iOwogICAgICAkdGltZW91dChmdW5jdGlvbigpCiAgICAgIHsKICAgICAgICAkc2NvcGUuYWpheF9lcnJvcj1udWxsOwogICAgICB9LCA0MDAwKTsKICAgIH0KICB9Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignbW9kYWxfY2hhbmdlX3Bhc3N3b3JkJywgZnVuY3Rpb24oJHNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgdXNlcl9waG9uZV9udW1iZXIsICRodHRwKQp7CiAgbG9nRGVidWcoIm1vZGFsX2NoYW5nZV9wYXNzd29yZCBjb250cm9sbGVyIik7CiAgJHNjb3BlLnBob25lX3ZlcmlmaWNhdGlvbiA9IHt9OyAvLyB0aGVzZSBhcmUgdGhlIGNvbXBsZXRlIGRldGFpbHMgZm9yIHRoZSBuZXcgZXZlbnQgLy8KICAkc2NvcGUucGhvbmVfdmVyaWZpY2F0aW9uLnBob25lX251bWJlcj11c2VyX3Bob25lX251bWJlcjsKICAkc2NvcGUucGhvbmVfdmVyaWZpY2F0aW9uLnNtc19lcnJvcj0iIjsKICAkc2NvcGUuY2xvc2UgPSBmdW5jdGlvbigpIHsKICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCdkaXNtaXNzJyk7CiAgfTsKCiAgJHNjb3BlLmNoYW5nZVBhc3N3b3JkID0gZnVuY3Rpb24oKQogIHsKICAgIGNoYW5nZVBhc3N3b3JkKCRodHRwLCRzY29wZSwkc2NvcGUucGhvbmVfdmVyaWZpY2F0aW9uLnVzZXJfcGFzc3dvcmQsJHNjb3BlLnBob25lX3ZlcmlmaWNhdGlvbi51c2VyX3Bhc3N3b3JkMiwkc2NvcGUucGhvbmVfdmVyaWZpY2F0aW9uLnZlcmlmaWNhdGlvbl9jb2RlLCBjaGFuZ2VQYXNzd29yZF9zdWNjZXNzLCBjaGFuZ2VQYXNzd29yZF9mYWlsdXJlLGZhbHNlKTsKICAgICRzY29wZS5hamF4X2Vycm9yPSIiOwogICAgZnVuY3Rpb24gY2hhbmdlUGFzc3dvcmRfc3VjY2VzcygpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJjaGFuZ2VQYXNzd29yZF9zdWNjZXNzIik7CiAgICAgIHN0YXR1cz0iZmZmZmYiOwovLyBhbGVydCgn15TXodeZ16HXnteQINei15XXk9eb16DXlCDXkdeU16bXnNeX15QnKTsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UodHJ1ZSk7CiAgICB9CiAgICBmdW5jdGlvbiBjaGFuZ2VQYXNzd29yZF9mYWlsdXJlKHJlc3BvbnNlKQogICAgewogICAgICBsb2dEZWJ1ZygiY2hhbmdlUGFzc3dvcmRfZmFpbHVyZSAiK3Jlc3BvbnNlLm1lc3NhZ2UpOwogICAgICAkc2NvcGUuYWpheF9lcnJvcj1yZXNwb25zZS5tZXNzYWdlOwogICAgfQogIH0KfSk7CgprdXplQXBwLmZhY3RvcnkoJ0J1c2luZXNzQ29uZmlnJywgZnVuY3Rpb24oJGh0dHApIHsKICByZXR1cm4gewogICAgZ2V0OiBmdW5jdGlvbiAoKSB7CiAgICAgIGxvZ0RlYnVnKCJsb2FkIGdldF9idXNpbmVzc19jb25maWciKTsKICAgICAgcmV0dXJuICRodHRwLmdldCgiL2FwaS9hZG1pbi9idXNpbmVzc19jb25maWciKQogICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHsKICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHJlc3BvbnNlLmRhdGFbMF07CiAgICAgICAgICAgIHJlc3VsdC51c2VfaG9saWRheXM9ISFwYXJzZUludChyZXNwb25zZS5kYXRhWzBdLnVzZV9ob2xpZGF5cyk7CiAgICAgICAgICAgIHJlc3VsdC5zbXNfbm90aWZpY2F0aW9ucz0hIXBhcnNlSW50KHJlc3BvbnNlLmRhdGFbMF0uc21zX25vdGlmaWNhdGlvbnMpOwogICAgICAgICAgICByZXN1bHQuc3RhcnRfaW52b2ljZV9udW1iZXIgPSBwYXJzZUludChyZXNwb25zZS5kYXRhWzBdLnN0YXJ0X2ludm9pY2VfbnVtYmVyKTsKICAgICAgICAgICAgdmFyIGQgPSBuZXcgRGF0ZSgpOwogICAgICAgICAgICBkLnNldEhvdXJzKCByZXN1bHQuY2FsZW5kYXJfZGlzcGxheV9zdGFydF9ob3VycyApOwogICAgICAgICAgICBkLnNldE1pbnV0ZXMoIHJlc3VsdC5jYWxlbmRhcl9kaXNwbGF5X3N0YXJ0X21pbnV0ZXMgKTsKICAgICAgICAgICAgcmVzdWx0Lm15dGltZSA9IGQ7CiAgICAgICAgICAgIHJlc3VsdC5jYWxlbmRhcl9kaXNwbGF5X3N0YXJ0ID0gZDsKICAgICAgICAgICAgdmFyIGQgPSBuZXcgRGF0ZSgpOwogICAgICAgICAgICBkLnNldEhvdXJzKCByZXN1bHQuY2FsZW5kYXJfZGlzcGxheV9lbmRfaG91cnMgKTsKICAgICAgICAgICAgZC5zZXRNaW51dGVzKCByZXN1bHQuY2FsZW5kYXJfZGlzcGxheV9lbmRfbWludXRlcyApOwogICAgICAgICAgICByZXN1bHQubXl0aW1lID0gZDsKICAgICAgICAgICAgcmVzdWx0LmNhbGVuZGFyX2Rpc3BsYXlfZW5kID0gZDsKICAgICAgICAgICAgcmVzdWx0LnZhdF9yYXRlID0gTnVtYmVyKHJlc3VsdC52YXRfcmF0ZSk7CiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgICB9KTsKICAgIH0KICB9Owp9KTsKCmt1emVBcHAuY29udHJvbGxlcignQ29uZmlnQnVzaW5lc3NDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJHRpbWVvdXQsIEJ1c2luZXNzQ29uZmlnKQp7CiAgbG9nRGVidWcoIm15IGJ1c2luZXNzIGNvbmZpZyIpOwogICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzPVtdOwoKICBmdW5jdGlvbiBnZXRfYnVzaW5lc3NfY29uZmlnKCkgewogICAgbG9nRGVidWcoImdldF9idXNpbmVzc19jb25maWciKTsKICAgIGxvZ0RlYnVnKCJCdXNpbmVzc0NvbmZpZzogIiwgQnVzaW5lc3NDb25maWcpOwogICAgQnVzaW5lc3NDb25maWcuZ2V0KCkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7ICRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMgPSByZXN1bHQ7IH0pOwogIH0KICBnZXRfYnVzaW5lc3NfY29uZmlnKCk7CgoKICAkc2NvcGUuaHN0ZXAgPSAxOwogICRzY29wZS5tc3RlcCA9IDE1OwoKICAkc2NvcGUuYnVzaW5lc3NDb25maWdDYW5jZWwgPSBmdW5jdGlvbigpIHsKICAgIHdpbmRvdy5oaXN0b3J5LmJhY2soKTsKICB9OwoKICAkc2NvcGUudXBkYXRlQnVzaW5lc3NDb25maWcgPSBmdW5jdGlvbigpIHsKICAgIGxvZ0RlYnVnKCJ1cGRhdGluZyBidXNpbmVzcyBjb25maWciICsgSlNPTi5zdHJpbmdpZnkoJHNjb3BlLmJ1c2luZXNzUHJvcGVydGllcykpOwoKICAgICRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXNfYWpheF9lcnJvcj0iIjsKICAgICRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMuY2FsZW5kYXJfZGlzcGxheV9zdGFydF9ob3Vycz0kc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzLmNhbGVuZGFyX2Rpc3BsYXlfc3RhcnQuZ2V0SG91cnMoKTsKICAgICRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMuY2FsZW5kYXJfZGlzcGxheV9zdGFydF9taW51dGVzPSRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMuY2FsZW5kYXJfZGlzcGxheV9zdGFydC5nZXRNaW51dGVzKCk7CiAgICAkc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzLmNhbGVuZGFyX2Rpc3BsYXlfZW5kX2hvdXJzPSRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMuY2FsZW5kYXJfZGlzcGxheV9lbmQuZ2V0SG91cnMoKTsKICAgICRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMuY2FsZW5kYXJfZGlzcGxheV9lbmRfbWludXRlcz0kc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzLmNhbGVuZGFyX2Rpc3BsYXlfZW5kLmdldE1pbnV0ZXMoKTsKICAgIGlmICgkc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzLmNhbGVuZGFyX2Rpc3BsYXlfc3RhcnRfaG91cnM+JHNjb3BlLmJ1c2luZXNzUHJvcGVydGllcy5jYWxlbmRhcl9kaXNwbGF5X2VuZF9ob3VycykKICAgIHsKICAgICAgYWxlcnQoJ9eW157XnyDXodeZ15XXnSDXnNeQINeZ15vXldecINec15TXmdeV16og15zXpNeg15kg15bXntefINeU16rXl9ec15QnKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgJHNjb3BlLmJ1c2luZXNzUHJvcGVydGllc19hamF4X2Vycm9yPSLXntei15PXm9efINeg16rXldeg15nXnS4uLiI7CgogICAgJGh0dHAoewogICAgICBtZXRob2Q6ICdQT1NUJywKICAgICAgdXJsOiAnL2FwaS9hZG1pbi9idXNpbmVzc19jb25maWcvc2V0JywKICAgICAgZGF0YTogJHNjb3BlLmJ1c2luZXNzUHJvcGVydGllcywgLy8gcGFzcyBpbiBkYXRhIGFzIHN0cmluZ3MKICAgICAgaGVhZGVyczogewogICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbjtjaGFyc2V0PXV0Zi04JwogICAgICB9CiAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHsKCiAgICAgIGxvZ0RlYnVnKGRhdGEpOwogICAgICBpZiAoIWRhdGEuc3VjY2VzcykgewogICAgICAgIGxvZ0RlYnVnKCJlcnJvciAiICsgZGF0YS5NZXNzYWdlKTsKICAgICAgICAkc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzX2FqYXhfZXJyb3IgPSBkYXRhLk1lc3NhZ2U7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgJGdDYWxlbmRhckRpc3BsYXlNaW5UaW1lPWRhdGEuanNvbi5uZXdTdGFydFRpbWU7CiAgICAgICAgJGdDYWxlbmRhckRpc3BsYXlNYXhUaW1lPWRhdGEuanNvbi5uZXdFbmRUaW1lOwogICAgICAgIGNvbnNvbGUubG9nKCJ1cGRhdGVkIGdDYWxlbmRhckRpc3BsYXlNaW5UaW1lPSIrJGdDYWxlbmRhckRpc3BsYXlNaW5UaW1lKTsKICAgICAgICBjb25zb2xlLmxvZygidXBkYXRlZCBnQ2FsZW5kYXJEaXNwbGF5TWF4VGltZT0iKyRnQ2FsZW5kYXJEaXNwbGF5TWF4VGltZSk7CiAgICAgICAgJHNjb3BlLmJ1c2luZXNzUHJvcGVydGllc19hamF4X2Vycm9yPSLXoteV15PXm9efINeR15TXptec15fXlCEiOwogICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkKICAgICAgICB7CiAgICAgICAgICAkc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzX2FqYXhfZXJyb3I9bnVsbDsKICAgICAgICB9LCAyMDAwKTsKICAgICAgICBnZXRfYnVzaW5lc3NfY29uZmlnKCk7Ci8vIHdpbmRvdy5oaXN0b3J5LmJhY2soKTsKLy8gJHNjb3BlLmJ1c2luZXNzUHJvcGVydGllc19hamF4X2Vycm9yID0gItek16jXmNeZINeU16LXodenINeg16nXnteo15Ug15HXlNem15zXl9eULiI7CgogICAgICB9CiAgICB9KTsKICB9Owp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ2NsaWVudENhcmRDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlKSB7CiAgbG9nRGVidWcoImNsaWVudENhcmRDb250cm9sbGVyIik7CiAgJHNjb3BlLmZ1dHVyZU1lZXRpbmdzID0gW3sKICAgIGRhdGV0aW1lOiAi16jXkNep15XXnywgMjUuMS4yMDE2IiwKICAgIGhvdXI6ICIxNDowMCIsCiAgICB0eXBlOiAi16fXkdeV16bXlCIsCiAgICBwcmljZTogIjEwMCIsCiAgICBsYWJlbHM6IFt7CiAgICAgIGxhYmVsOiAic3VjY2VzcyIsCiAgICAgIHRleHQ6ICLXqdeV15zXnSIKICAgIH0sIHsKICAgICAgbGFiZWw6ICJ3YXJuaW5nIiwKICAgICAgdGV4dDogItec15Ag16rXldei15MiCiAgICB9XQogIH0sIHsKICAgIGRhdGV0aW1lOiAi16jXkNep15XXnywgMjUuMS4yMDE2IiwKICAgIGhvdXI6ICIxNDowMCIsCiAgICB0eXBlOiAi16fXkdeV16bXlCIsCiAgICBwcmljZTogIjEwMCIsCiAgICBsYWJlbHM6IFt7CiAgICAgIGxhYmVsOiAiZGFuZ2VyIiwKICAgICAgdGV4dDogItec15Ag16nXldec150iCiAgICB9LCB7CiAgICAgIGxhYmVsOiAiaW5mbyIsCiAgICAgIHRleHQ6ICLXqteV16LXkyIKICAgIH1dCiAgfSwgewogICAgZGF0ZXRpbWU6ICLXqdec15nXqdeZLCAyNS4xLjIwMTYiLAogICAgaG91cjogIjE0OjAwIiwKICAgIHR5cGU6ICLXp9eR15XXpteUIiwKICAgIHByaWNlOiAiMTAwIiwKICAgIGxhYmVsczogW3sKICAgICAgbGFiZWw6ICJkYW5nZXIiLAogICAgICB0ZXh0OiAi15zXkCDXqdeV15zXnSIKICAgIH0sIHsKICAgICAgbGFiZWw6ICJpbmZvIiwKICAgICAgdGV4dDogIteq15XXoteTIgogICAgfV0KICB9LCB7CiAgICBkYXRldGltZTogIteo15DXqdeV158sIDI1LjEuMjAxNiIsCiAgICBob3VyOiAiMTQ6MDAiLAogICAgdHlwZTogIten15HXldem15QiLAogICAgcHJpY2U6ICIxMDAiCiAgfSwgXQoKICAkc2NvcGUuaGlzdG9yeU1lZXRpbmdzID0gW3sKICAgIGRhdGV0aW1lOiAi16jXkNep15XXnywgMjUuMS4yMDE2IiwKICAgIGhvdXI6ICIxNDowMCIsCiAgICB0eXBlOiAi16fXkdeV16bXlCIsCiAgICBwcmljZTogIjEwMCIKICB9LCB7CiAgICBkYXRldGltZTogIteo15DXqdeV158sIDI1LjEuMjAxNiIsCiAgICBob3VyOiAiMTQ6MDAiLAogICAgdHlwZTogIten15HXldem15QiLAogICAgcHJpY2U6ICIxMDAiCiAgfSwgewogICAgZGF0ZXRpbWU6ICLXqdec15nXqdeZLCAyNS4xLjIwMTYiLAogICAgaG91cjogIjE0OjAwIiwKICAgIHR5cGU6ICLXp9eR15XXpteUIiwKICAgIHByaWNlOiAiMTAwIgogIH0sIHsKICAgIGRhdGV0aW1lOiAi16jXkNep15XXnywgMjUuMS4yMDE2IiwKICAgIGhvdXI6ICIxNDowMCIsCiAgICB0eXBlOiAi16fXkdeV16bXlCIsCiAgICBwcmljZTogIjEwMCIKICB9LCBdCgogICRzY29wZS5jY1BheW1lbnRzID0gW3sKICAgIGRhdGV0aW1lOiAi16jXkNep15XXnywgMjUuMS4yMDE2IiwKICAgIHJlY2lwdF9udW06ICI3NjciLAogICAgYW1vdW50OiAiMzAwIiwKICAgIGxhYmVsczogW3sKICAgICAgbGFiZWw6ICJkYW5nZXIiLAogICAgICB0ZXh0OiAi15zXkCDXqdeV15nXmdeaIgogICAgfSwgewogICAgICBsYWJlbDogImluZm8iLAogICAgICB0ZXh0OiAi15TXldek16fXkyIKICAgIH1dCiAgfSwgXQoKCn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdrdXplQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikgewoKLy8gbWFpbiBrdXplIGNvbnRyb2xsZXIKCi8vIE1VU1QgU0VUIExBTkdVQUdFIEJFRk9SRSBBTlkgT1RIRVIgT1BFUkFUSU9OICEhIQogIHVwZGF0ZUdsb2JhbExhbmd1YWdlKCRzY29wZSwgJGdEZWZhdWx0TGFuZyk7Ci8vIE1VU1QgU0VUIExBTkdVQUdFIEJFRk9SRSBBTlkgT1RIRVIgT1BFUkFUSU9OICEhIQoKLy8gbG9nRGVidWcoInh4eHh4eHh4IiArICRzY29wZS5sYW5nZmlsZVsnc2hvd19hbGxfY2xpZW50cyddKTsKCiAgJHNjb3BlLnNob3dDbGllbnRzQ29sdW1ucyA9IFt7CiAgICBmaWVsZDogJ3VzZXJfaWQnLAogICAgbmFtZTogJHNjb3BlLmxhbmdmaWxlWydzaG93X2FsbF9jbGllbnRzX3VzZXJpZCddCiAgfSwgewogICAgZmllbGQ6ICdidXNlcl9maXJzdF9uYW1lJywKICAgIG5hbWU6ICRzY29wZS5sYW5nZmlsZVsnc2hvd19hbGxfY2xpZW50c19maXJzdF9uYW1lJ10KICB9LCB7CiAgICBmaWVsZDogJ2J1c2VyX2xhc3RfbmFtZScsCiAgICBuYW1lOiAkc2NvcGUubGFuZ2ZpbGVbJ3Nob3dfYWxsX2NsaWVudHNfbGFzdF9uYW1lJ10KICB9LCB7CiAgICBmaWVsZDogJ3JvbGVfbmFtZScsCiAgICBuYW1lOiAkc2NvcGUubGFuZ2ZpbGVbJ3Nob3dfYWxsX2NsaWVudHNfYXBwcm92ZWQnXQogIH1dOwoKCiAgJHNjb3BlLmdyaWRDbGllbnRDbGljayA9IGZ1bmN0aW9uKHJvdykgewovL2xvZ0RlYnVnKHJvdyk7CiAgICB2YXIgcm93X3VzZXJpZCA9IHJvdy5lbnRpdHkudXNlcl9pZDsKICAgIGxvZ0RlYnVnKCJzZWxlY3RlZCByb3cgdXNlcl9pZCA9IiArIHJvd191c2VyaWQpOwogICAgJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jbGllbnRzLycgKyByb3dfdXNlcmlkKTsKICB9OwoKICAkc2NvcGUuc2hvd0NsaWVudHNHcmlkT3B0aW9ucyA9IHsKICAgIGVuYWJsZUZpbHRlcmluZzogZmFsc2UsCiAgICBlbmFibGVTb3J0aW5nOiB0cnVlLAogICAgY29sdW1uRGVmczogJHNjb3BlLnNob3dDbGllbnRzQ29sdW1ucywKICAgIHJvd1RlbXBsYXRlOiAnL3B1YmxpYy9jb21wb25lbnRzL2NsaWVudHMtZ3JpZC1yb3cuaHRtbCcsCiAgICBvblJlZ2lzdGVyQXBpOiBmdW5jdGlvbihncmlkQXBpKSB7CiAgICAgICRzY29wZS5ncmlkQXBpID0gZ3JpZEFwaTsKICAgICAgJHNjb3BlLmdyaWRBcGkuZ3JpZC5yZWdpc3RlclJvd3NQcm9jZXNzb3IoJHNjb3BlLnNpbmdsZUZpbHRlciwgMjAwKTsKICAgIH0sCiAgfTsKCiAgJHNjb3BlLmlzQWN0aXZlID0gZnVuY3Rpb24odmlld0xvY2F0aW9uKSB7CiAgICBsb2dEZWJ1Zygidmlld0xvY2F0aW9uID0gIiArIHZpZXdMb2NhdGlvbik7CiAgICB2YXIgYWN0aXZlID0gKHZpZXdMb2NhdGlvbiA9PT0gJGxvY2F0aW9uLnBhdGgoKSk7CiAgICByZXR1cm4gYWN0aXZlOwogIH07CgogICRzY29wZS5maWx0ZXIgPSBmdW5jdGlvbigpIHsKICAgIGxvZ0RlYnVnKCJzaW5nbGUgZmlsdGVyIik7CiAgICAkc2NvcGUuZ3JpZEFwaS5ncmlkLnJlZnJlc2goKTsKICAgIGlmICgkc2NvcGUuZmlsdGVyLlZhbHVlICE9ICIiKSB7CiAgICAgICRzY29wZS5maWx0ZXIuYnV0dG9uVmFsdWUgPSAiJyIgKyAkc2NvcGUuZmlsdGVyLlZhbHVlICsgIiciOwogICAgfSBlbHNlIHsKICAgICAgJHNjb3BlLmZpbHRlci5idXR0b25WYWx1ZSA9ICIiOwogICAgfQogIH07CgogICRzY29wZS5zaW5nbGVGaWx0ZXIgPSBmdW5jdGlvbihyZW5kZXJhYmxlUm93cykgewogICAgdmFyIG1hdGNoZXIgPSBuZXcgUmVnRXhwKCRzY29wZS5maWx0ZXIuVmFsdWUpOwogICAgbG9nRGVidWcoInNjb3BlPSIgKyAkc2NvcGUpOwogICAgbG9nRGVidWcoInNjb3BlLmZpbHRlci5WYWx1ZT0iICsgJHNjb3BlLmZpbHRlci5WYWx1ZSk7CiAgICBpZiAoKCRzY29wZS5maWx0ZXIuVmFsdWUgPT0gbnVsbCkgfHwgKCRzY29wZS5maWx0ZXIuVmFsdWUgPT0gIiIpKSB7CiAgICAgIGxvZ0RlYnVnKCJlbXB0eSBmaWx0ZXIiKTsKICAgICAgcmV0dXJuIHJlbmRlcmFibGVSb3dzOwogICAgfQogICAgcmVuZGVyYWJsZVJvd3MuZm9yRWFjaChmdW5jdGlvbihyb3cpIHsKLy8JCQlsb2dEZWJ1Zygicm93PSIrcm93KTsKICAgICAgcm93LnZpc2libGUgPSBmYWxzZTsKICAgICAgdmFyICRjdXJyRmlyc3ROYW1lID0gcm93LmVudGl0eVsnZmlyc3RfbmFtZSddOwogICAgICB2YXIgJGN1cnJMYXN0TmFtZSA9IHJvdy5lbnRpdHlbJ2xhc3RfbmFtZSddOwogICAgICBsb2dEZWJ1ZygiY3VyckZpcnN0TmFtZT0iICsgJGN1cnJGaXJzdE5hbWUpOwoKICAgICAgaWYgKCRjdXJyRmlyc3ROYW1lICE9IG51bGwpIHsKICAgICAgICBpZiAoJGN1cnJGaXJzdE5hbWUuaW5kZXhPZigkc2NvcGUuZmlsdGVyLlZhbHVlKSA+IC0xKSB7CiAgICAgICAgICByb3cudmlzaWJsZSA9IHRydWU7CiAgICAgICAgfQogICAgICB9IGVsc2UgLy8gcm93IGlzIG51bGwKICAgICAgewogICAgICAgIHJvdy52aXNpYmxlID0gZmFsc2U7CiAgICAgIH0KCiAgICAgIGlmICgkY3Vyckxhc3ROYW1lICE9IG51bGwpIHsKICAgICAgICBpZiAoJGN1cnJMYXN0TmFtZS5pbmRleE9mKCRzY29wZS5maWx0ZXIuVmFsdWUpID4gLTEpIHsKICAgICAgICAgIHJvdy52aXNpYmxlID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0gZWxzZSAvLyByb3cgaXMgbnVsbAogICAgICB7CiAgICAgICAgcm93LnZpc2libGUgPSBmYWxzZTsKICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gcmVuZGVyYWJsZVJvd3M7CiAgfTsKCi8vIGltcG9ydGFudCEhIGluaXRpYWxpemluZyBhbmd1bGFyIGZvcm1zIGFzIGFycmF5cwogICRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhciA9IHt9OwogICRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhciA9IHt9OwoKLy8gbG9nRGVidWcoImxvY2F0aW9uPSIgKyAkbG9jYXRpb24pOwovLyBsb2dEZWJ1ZygkbG9jYXRpb24pOwoKICAkc2NvcGUuY2hhbmdlTGFuZyA9IGZ1bmN0aW9uKCRuZXdsYW5nKSB7CiAgICBsb2dEZWJ1ZygkbmV3bGFuZyk7Ci8vJHNjb3BlLnNwQ2xhc3MgPSAncmlnaHQnOwogICAgdXBkYXRlR2xvYmFsTGFuZ3VhZ2UoJHNjb3BlLCAkbmV3bGFuZykKICB9CgogICRzY29wZS5hZGROZXdDbGllbnQgPSBmdW5jdGlvbigpIHsKICAgICRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfY2xpZW50cy9hZGQnKTsKICB9CiAgJHNjb3BlLmFkZE5ld0luc3RydWN0b3IgPSBmdW5jdGlvbigpIHsKICAgICRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfaW5zdHJ1Y3RvcnMvYWRkJyk7CiAgfQp9KTsKCi8vLy8vLyBiZWZvcmUgZm9ybXMKa3V6ZUFwcC5jb250cm9sbGVyKCdEZW1vQ29udHJvbGxlcicsIFsKICAnJHNjb3BlJywgJyRidWlsZGVyJywgJyR2YWxpZGF0b3InLAogIGZ1bmN0aW9uKCRzY29wZSwgJGJ1aWxkZXIsICR2YWxpZGF0b3IpIHsKICAgIHZhciBjaGVja2JveCwgdGV4dGJveDsKICAgIHRleHRib3ggPSAkYnVpbGRlci5hZGRGb3JtT2JqZWN0KCdkZWZhdWx0JywgewogICAgICBpZDogJ3RleHRib3gnLAogICAgICBjb21wb25lbnQ6ICd0ZXh0SW5wdXQnLAogICAgICBsYWJlbDogJ05hbWUnLAogICAgICBkZXNjcmlwdGlvbjogJ1lvdXIgbmFtZScsCiAgICAgIHBsYWNlaG9sZGVyOiAnWW91ciBuYW1lJywKICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgIGVkaXRhYmxlOiBmYWxzZQogICAgfSk7CiAgICBjaGVja2JveCA9ICRidWlsZGVyLmFkZEZvcm1PYmplY3QoJ2RlZmF1bHQnLCB7CiAgICAgIGlkOiAnY2hlY2tib3gnLAogICAgICBjb21wb25lbnQ6ICdjaGVja2JveCcsCiAgICAgIGxhYmVsOiAnUGV0cycsCiAgICAgIGRlc2NyaXB0aW9uOiAnRG8geW91IGhhdmUgYW55IHBldHM/JywKICAgICAgb3B0aW9uczogWydEb2cnLCAnQ2F0J10KICAgIH0pOwogICAgJGJ1aWxkZXIuYWRkRm9ybU9iamVjdCgnZGVmYXVsdCcsIHsKICAgICAgY29tcG9uZW50OiAnc2FtcGxlSW5wdXQnCiAgICB9KTsKICAgICRzY29wZS5mb3JtID0gJGJ1aWxkZXIuZm9ybXNbJ2RlZmF1bHQnXTsKICAgICRzY29wZS5pbnB1dCA9IFtdOwogICAgJHNjb3BlLmRlZmF1bHRWYWx1ZSA9IHt9OwogICAgJHNjb3BlLmRlZmF1bHRWYWx1ZVt0ZXh0Ym94LmlkXSA9ICdkZWZhdWx0IHZhbHVlJzsKICAgICRzY29wZS5kZWZhdWx0VmFsdWVbY2hlY2tib3guaWRdID0gW3RydWUsIHRydWVdOwogICAgcmV0dXJuICRzY29wZS5zdWJtaXQgPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuICR2YWxpZGF0b3IudmFsaWRhdGUoJHNjb3BlLCAnZGVmYXVsdCcpLnN1Y2Nlc3MoZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIGxvZ0RlYnVnKCdzdWNjZXNzJyk7CiAgICAgIH0pLmVycm9yKGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBsb2dEZWJ1ZygnZXJyb3InKTsKICAgICAgfSk7CiAgICB9OwogIH0KXSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ0FsZXJ0RGVtb0N0cmwnLCBmdW5jdGlvbigkc2NvcGUpIHsKICAkc2NvcGUuYWxlcnRzID0gW3sKICAgIHR5cGU6ICdkYW5nZXInLAogICAgbXNnOiAnT2ggc25hcCEgQ2hhbmdlIGEgZmV3IHRoaW5ncyB1cCBhbmQgdHJ5IHN1Ym1pdHRpbmcgYWdhaW4uJwogIH0sIHsKICAgIHR5cGU6ICdzdWNjZXNzJywKICAgIG1zZzogJ1dlbGwgZG9uZSEgWW91IHN1Y2Nlc3NmdWxseSByZWFkIHRoaXMgaW1wb3J0YW50IGFsZXJ0IG1lc3NhZ2UuJwogIH1dOwoKICAkc2NvcGUuYWRkQWxlcnQgPSBmdW5jdGlvbigpIHsKICAgICRzY29wZS5hbGVydHMucHVzaCh7CiAgICAgIG1zZzogJ0Fub3RoZXIgYWxlcnQhJwogICAgfSk7CiAgfTsKCiAgJHNjb3BlLmNsb3NlQWxlcnQgPSBmdW5jdGlvbihpbmRleCkgewogICAgJHNjb3BlLmFsZXJ0cy5zcGxpY2UoaW5kZXgsIDEpOwogIH07Cn0pOwoKCmZ1bmN0aW9uIGlzTnVtYmVyS2V5KGV2dCl7CiAgdmFyIGNoYXJDb2RlID0gKGV2dC53aGljaCkgPyBldnQud2hpY2ggOiBldmVudC5rZXlDb2RlOwogIHJldHVybiAhKGNoYXJDb2RlID4gMzEgJiYgKGNoYXJDb2RlIDwgNDggfHwgY2hhckNvZGUgPiA1NykpOwp9Cg==</text>
      </register>
      <register name="9" type="2">
        <text encoding="base64">ICAgICAgICAucmVkdWNlKGZ1bmN0aW9uICk7Cg==</text>
      </register>
      <register name=":" type="4">
        <text>%s/&quot;yPos&quot;: 0.20000000298023225/&quot;yPos&quot;: 0.1/</text>
      </register>
    </registers>
    <search>
      <last-search encoding="base64">XDxidXNpbmVzc0NsaWVuZENhcmRQYXltZW50XD4=</last-search>
      <last-offset />
      <last-pattern encoding="base64">XDxidXNpbmVzc0NsaWVuZENhcmRQYXltZW50XD4=</last-pattern>
      <last-replace>&quot;yPos&quot;: 0.1</last-replace>
      <last-substitute>&quot;yPos&quot;: 0.20000000298023225</last-substitute>
      <last-dir>1</last-dir>
      <show-last>false</show-last>
    </search>
    <history>
      <history-search>
        <entry>\/business_config</entry>
        <entry>\cUser</entry>
        <entry>cliendCard</entry>
        <entry>cliendBu</entry>
        <entry>CliendB</entry>
        <entry>Cliend</entry>
        <entry>BusinessCo</entry>
        <entry>\cbusinessconfig</entry>
        <entry encoding="base64">XDxjdXJyZW50Q2xpZW50XD4=</entry>
        <entry>admin</entry>
        <entry>admin\/users</entry>
        <entry>business\/u</entry>
        <entry>business_config\/set</entry>
        <entry>user\/payments</entry>
        <entry>users\/payments</entry>
        <entry encoding="base64">XDxwYXltZW50c1w+</entry>
        <entry>initiatePayment</entry>
        <entry>initiateP</entry>
        <entry encoding="base64">XDxnZXRDbGllbnRQYXltZW50c1Byb21pc2VcPg==</entry>
        <entry encoding="base64">XDxidXNpbmVzc0NsaWVuZENhcmRQYXltZW50XD4=</entry>
      </history-search>
      <history-cmd>
        <entry encoding="base64">JzwsJz5zLzsvJ107Lw==</entry>
        <entry>s/, /\r/g</entry>
        <entry>s/, /,\r/g</entry>
        <entry>Reg</entry>
        <entry>reg</entry>
        <entry encoding="base64">JzwsJz5zL1wkLy9n</entry>
        <entry encoding="base64">JzwsJz5zLywkLyAuICIsIi8=</entry>
        <entry encoding="base64">JzwsJz5zLywkLyAuICIsIiAuLw==</entry>
        <entry encoding="base64">JzwsJz5zL1xFLykv</entry>
        <entry encoding="base64">JzwsJz5zL1w+Lykv</entry>
        <entry encoding="base64">JzwsJz5zLyAuLykgLi8=</entry>
        <entry encoding="base64">JzwsJz5zLyBcLi8pIC4v</entry>
        <entry encoding="base64">JzwsJz5zLyA9LiokLywv</entry>
        <entry encoding="base64">JzwsJz5zLyB8fCBudWxsLy8=</entry>
        <entry encoding="base64">JzwsJz5zLywgLywiIC4gIi8=</entry>
        <entry encoding="base64">JzwsJz5zLywgLywiIC4gIi9n</entry>
        <entry encoding="base64">JzwsJz5zLyBcLiAvIC5cci9n</entry>
        <entry encoding="base64">JzwsJz5zLyIiLyInJyIv</entry>
        <entry encoding="base64">JzwsJz5zLywvJywv</entry>
        <entry encoding="base64">JzwsJz5zLycvLw==</entry>
      </history-cmd>
      <history-expr />
      <history-input />
    </history>
    <shortcut-conflicts>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed OPEN_BRACKET</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed V</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed F</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed U</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed S</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed N</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed P</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed W</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>shift ctrl pressed A</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed C</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed D</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed R</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed A</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed T</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed I</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed B</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed CLOSE_BRACKET</text>
      </shortcut-conflict>
    </shortcut-conflicts>
  </component>
</application>
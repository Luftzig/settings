<application>
  <component name="VimSettings">
    <state version="4" enabled="true" />
    <globalmarks />
    <filemarks>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/Decoration.cs" timestamp="1498573346394">
        <mark key="'" line="71" column="19" />
        <mark key="[" line="26" column="41" />
        <mark key="]" line="26" column="41" />
        <mark key="^" line="26" column="41" />
        <mark key="." line="26" column="41" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/DataService/ShapeData.cs" timestamp="1498570609670">
        <mark key="'" line="50" column="4" />
        <mark key="[" line="9" column="40" />
        <mark key="]" line="11" column="23" />
        <mark key="." line="11" column="23" />
        <mark key="^" line="11" column="23" />
      </file>
      <file name="$USER_HOME$/Projects/mocha-given/index.d.ts" timestamp="1490284104781">
        <mark key="'" line="1" column="0" />
        <mark key="[" line="11" column="0" />
        <mark key="]" line="11" column="0" />
        <mark key="." line="11" column="0" />
        <mark key="^" line="1" column="11" />
      </file>
      <file name="/a.dummy" timestamp="1498741252881">
        <mark key="[" line="0" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/phpold/kuze_utils.php" timestamp="1497784331390">
        <mark key="'" line="59" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/CameraMovement.cs" timestamp="1497450852828">
        <mark key="'" line="193" column="4" />
      </file>
      <file name="$USER_HOME$/Projects/Guy Prives/Automator/server/api/updater/updater.helpers.ts" timestamp="1492791203674">
        <mark key="'" line="25" column="36" />
        <mark key="[" line="33" column="48" />
        <mark key="]" line="34" column="24" />
        <mark key="." line="34" column="24" />
        <mark key="^" line="34" column="24" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/UI/ExitToast.cs" timestamp="1497532567374">
        <mark key="'" line="40" column="0" />
        <mark key="[" line="2" column="0" />
        <mark key="]" line="2" column="0" />
        <mark key="." line="2" column="0" />
        <mark key="^" line="10" column="9" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/PieceGenerator.cs" timestamp="1498668509814">
        <mark key="'" line="0" column="0" />
        <mark key="[" line="43" column="0" />
        <mark key="]" line="43" column="0" />
        <mark key="." line="43" column="0" />
        <mark key="^" line="78" column="66" />
      </file>
      <file name="$APPLICATION_CONFIG_DIR$/scratches/scratch.json" timestamp="1492339698148">
        <mark key="'" line="21" column="0" />
        <mark key="[" line="2" column="14" />
        <mark key="]" line="2" column="13" />
        <mark key="." line="2" column="13" />
        <mark key="^" line="2" column="13" />
      </file>
      <file name="$APPLICATION_CONFIG_DIR$/scratches/scratch_3.json" timestamp="1492678325641">
        <mark key="'" line="4983" column="0" />
        <mark key="[" line="0" column="0" />
        <mark key="]" line="0" column="48708" />
        <mark key="^" line="0" column="48708" />
        <mark key="." line="0" column="48708" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/UI/GameEditor/SaveButton.cs" timestamp="1498572998507">
        <mark key="'" line="74" column="42" />
        <mark key="[" line="74" column="42" />
        <mark key="]" line="74" column="50" />
        <mark key="." line="74" column="50" />
        <mark key="^" line="74" column="50" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/PuzzlePiece.cs" timestamp="1497973981788">
        <mark key="'" line="70" column="42" />
        <mark key="[" line="199" column="8" />
        <mark key="]" line="199" column="42" />
        <mark key="." line="199" column="42" />
        <mark key="^" line="199" column="42" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/public/js/angular/kuze_business_utils-v11.js" timestamp="1498391567633">
        <mark key="'" line="833" column="9" />
        <mark key="[" line="642" column="22" />
        <mark key="]" line="642" column="22" />
        <mark key="^" line="642" column="22" />
        <mark key="." line="642" column="22" />
      </file>
      <file name="/kuze_config.php" timestamp="1499159276667">
        <mark key="[" line="11" column="0" />
        <mark key="]" line="11" column="69" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/angular/business_modal_client_payment.php" timestamp="1498395729099">
        <mark key="'" line="113" column="37" />
        <mark key="[" line="168" column="7" />
        <mark key="]" line="168" column="43" />
        <mark key="." line="168" column="43" />
        <mark key="^" line="168" column="43" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/public/js/angular/kuze_enduser_app.js" timestamp="1498045366621">
        <mark key="'" line="1187" column="20" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/api/invoices.php" timestamp="1498725747370">
        <mark key="'" line="95" column="4" />
        <mark key="[" line="7" column="6" />
        <mark key="]" line="7" column="6" />
        <mark key="." line="7" column="6" />
        <mark key="^" line="115" column="43" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/AndroidGalleryImageSaver.cs" timestamp="1497519923388">
        <mark key="'" line="31" column="0" />
        <mark key="[" line="15" column="0" />
        <mark key="]" line="15" column="0" />
        <mark key="^" line="15" column="16" />
        <mark key="." line="15" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/kuze_db.php" timestamp="1499159045352">
        <mark key="'" line="161" column="27" />
      </file>
      <file name="$USER_HOME$/Projects/Guy Prives/Automator/server/package.json" timestamp="1492003154014">
        <mark key="'" line="6" column="19" />
        <mark key="[" line="37" column="19" />
        <mark key="]" line="37" column="24" />
        <mark key="." line="37" column="24" />
        <mark key="^" line="37" column="24" />
      </file>
      <file name="$USER_HOME$/Projects/mocha-given/package.json" timestamp="1490283218372">
        <mark key="'" line="10" column="18" />
        <mark key="[" line="10" column="14" />
        <mark key="]" line="10" column="18" />
        <mark key="^" line="10" column="18" />
        <mark key="." line="10" column="18" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/kuze_config/dev/kuze_config.php" timestamp="1499159282333">
        <mark key="[" line="11" column="0" />
        <mark key="]" line="11" column="69" />
        <mark key="." line="11" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/luftzig.com/front/src/Styling.elm" timestamp="1497700286779">
        <mark key="'" line="39" column="31" />
        <mark key="[" line="39" column="47" />
        <mark key="]" line="39" column="47" />
        <mark key="." line="39" column="47" />
        <mark key="^" line="39" column="47" />
      </file>
      <file name="$USER_HOME$/Projects/luftzig.com/front/elm-stuff/packages/rtfeldman/elm-css/8.1.0/src/Css.elm" timestamp="1497694656695">
        <mark key="'" line="4371" column="8" />
      </file>
      <file name="$USER_HOME$/Projects/luftzig.com/front/src/View.elm" timestamp="1497799291882">
        <mark key="'" line="94" column="10" />
        <mark key="[" line="2" column="7" />
        <mark key="]" line="2" column="15" />
        <mark key="." line="2" column="15" />
        <mark key="^" line="2" column="15" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/kuze_const.php" timestamp="1498044815249">
        <mark key="'" line="75" column="0" />
        <mark key="[" line="37" column="31" />
        <mark key="]" line="37" column="34" />
        <mark key="." line="37" column="34" />
        <mark key="^" line="37" column="34" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/public/js/angular/config-js.php" timestamp="1498387204283">
        <mark key="[" line="266" column="0" />
        <mark key="]" line="266" column="4" />
        <mark key="." line="266" column="4" />
        <mark key="^" line="111" column="0" />
      </file>
      <file name="vim_settings.xml" timestamp="1498470093079">
        <mark key="[" line="0" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/site.conf" timestamp="1497783226999">
        <mark key="'" line="0" column="0" />
        <mark key="[" line="0" column="0" />
        <mark key="]" line="39" column="0" />
        <mark key="." line="8" column="4" />
        <mark key="^" line="8" column="4" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" timestamp="1499160859148">
        <mark key="'" line="3" column="0" />
        <mark key="[" line="3" column="2" />
        <mark key="]" line="3" column="4" />
        <mark key="." line="3" column="4" />
        <mark key="^" line="3" column="4" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/angular/business_config.php" timestamp="1498044504233">
        <mark key="[" line="31" column="0" />
        <mark key="]" line="31" column="0" />
        <mark key="." line="31" column="0" />
      </file>
      <file name="$APPLICATION_CONFIG_DIR$/scratches/scratch_5.json" timestamp="1492685289704">
        <mark key="'" line="7" column="18" />
        <mark key="[" line="0" column="0" />
        <mark key="]" line="0" column="9003" />
        <mark key="^" line="0" column="9003" />
        <mark key="." line="0" column="9003" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/invoice/create-acc.php" timestamp="1498738780092">
        <mark key="[" line="10" column="0" />
        <mark key="]" line="26" column="48" />
      </file>
      <file name="$USER_HOME$/Projects/luftzig.com/front/src/Main.elm" timestamp="1497695316614">
        <mark key="'" line="11" column="17" />
        <mark key="[" line="24" column="8" />
        <mark key="]" line="24" column="23" />
        <mark key="." line="24" column="23" />
        <mark key="^" line="24" column="23" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" timestamp="1499160944678">
        <mark key="'" line="5275" column="8" />
        <mark key="[" line="1889" column="96" />
        <mark key="]" line="1889" column="111" />
        <mark key="." line="1889" column="111" />
        <mark key="^" line="1889" column="111" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/ImmortalManager.cs" timestamp="1498141711502">
        <mark key="'" line="123" column="73" />
        <mark key="[" line="127" column="67" />
        <mark key="]" line="127" column="70" />
        <mark key="^" line="127" column="70" />
        <mark key="." line="127" column="70" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/DataService/DataService.cs" timestamp="1498473617414">
        <mark key="'" line="16" column="24" />
        <mark key="[" line="38" column="54" />
        <mark key="]" line="38" column="54" />
        <mark key="^" line="38" column="56" />
        <mark key="." line="38" column="54" />
      </file>
      <file name="$USER_HOME$/Projects/the_bar_node/server/test/greeter-spec.ts" timestamp="1490284305782">
        <mark key="'" line="4" column="40" />
        <mark key="[" line="14" column="22" />
        <mark key="]" line="14" column="22" />
        <mark key="." line="14" column="22" />
        <mark key="^" line="12" column="37" />
      </file>
      <file name="$USER_HOME$/Projects/Guy Prives/Automator/server/api/updater/updater.model.ts" timestamp="1492787491819">
        <mark key="'" line="19" column="105" />
        <mark key="[" line="19" column="105" />
        <mark key="]" line="19" column="105" />
        <mark key="^" line="19" column="105" />
        <mark key="." line="19" column="105" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/DataService/StageData.cs" timestamp="1498123623435">
        <mark key="'" line="9" column="14" />
      </file>
      <file name="$APPLICATION_CONFIG_DIR$/scratches/scratch_6.json" timestamp="1492685876216">
        <mark key="'" line="452" column="0" />
        <mark key="[" line="517" column="35" />
        <mark key="]" line="517" column="33" />
        <mark key="^" line="517" column="33" />
        <mark key="." line="517" column="33" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/GardenScreenshot.cs" timestamp="1498662602044">
        <mark key="'" line="132" column="52" />
        <mark key="[" line="131" column="27" />
        <mark key="]" line="132" column="52" />
        <mark key="." line="132" column="52" />
        <mark key="^" line="132" column="52" />
      </file>
      <file name="$APPLICATION_CONFIG_DIR$/scratches/scratch_1.js" timestamp="1498387185354">
        <mark key="'" line="0" column="0" />
        <mark key="[" line="38" column="0" />
        <mark key="]" line="195" column="1" />
        <mark key="^" line="195" column="1" />
        <mark key="." line="167" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/invoice/create-doc.php" timestamp="1498744316602">
        <mark key="'" line="147" column="0" />
        <mark key="[" line="64" column="0" />
        <mark key="]" line="133" column="1" />
        <mark key="." line="101" column="23" />
        <mark key="^" line="101" column="23" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/invoice/config.inc.php" timestamp="1498723747756">
        <mark key="[" line="3" column="0" />
        <mark key="]" line="8" column="18" />
      </file>
      <file name="$USER_HOME$/Projects/Guy Prives/Automator/server/api/appreciate-client/appreciate-client.ts" timestamp="1492789578918">
        <mark key="'" line="82" column="20" />
        <mark key="[" line="65" column="41" />
        <mark key="]" line="65" column="51" />
        <mark key="^" line="65" column="51" />
        <mark key="." line="65" column="51" />
      </file>
      <file name="$USER_HOME$/Projects/Guy Prives/Automator/server/api/appreciate-client/patch-request-converter.ts" timestamp="1492680861043">
        <mark key="'" line="64" column="0" />
        <mark key="[" line="65" column="25" />
        <mark key="]" line="65" column="31" />
        <mark key="^" line="65" column="31" />
        <mark key="." line="65" column="31" />
      </file>
      <file name="/dummy.sql" timestamp="1498743616409">
        <mark key="[" line="0" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/UI/GameEditor/LoadButton.cs" timestamp="1498489326900">
        <mark key="'" line="0" column="0" />
        <mark key="[" line="7" column="0" />
        <mark key="]" line="7" column="0" />
        <mark key="^" line="37" column="52" />
        <mark key="." line="7" column="0" />
      </file>
      <file name="$APPLICATION_CONFIG_DIR$/consoles/db/6e25fe0b-98f3-46a4-9336-01e7aed49277/console.sql" timestamp="1498743593854">
        <mark key="[" line="0" column="63" />
        <mark key="]" line="0" column="81" />
        <mark key="." line="0" column="81" />
        <mark key="^" line="0" column="81" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/Borders.cs" timestamp="1497869872208">
        <mark key="'" line="0" column="0" />
        <mark key="[" line="27" column="0" />
        <mark key="]" line="27" column="0" />
        <mark key="^" line="14" column="49" />
        <mark key="." line="27" column="0" />
      </file>
      <file name="/Dummy.txt" timestamp="1499161288791">
        <mark key="[" line="0" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/luftzig.com/front/src/Sections/CodeSection.elm" timestamp="1497799548443">
        <mark key="'" line="39" column="20" />
        <mark key="[" line="22" column="21" />
        <mark key="]" line="22" column="20" />
        <mark key="." line="22" column="20" />
        <mark key="^" line="22" column="20" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" timestamp="1498746722575">
        <mark key="'" line="9" column="26" />
        <mark key="[" line="9" column="26" />
        <mark key="]" line="9" column="57" />
        <mark key="^" line="8" column="23" />
        <mark key="." line="8" column="23" />
      </file>
      <file name="/business-app-v11.php" timestamp="1499159988365" />
      <file name="$USER_HOME$/Projects/kuze/php/kuze_login.php" timestamp="1497776244958">
        <mark key="'" line="43" column="8" />
      </file>
      <file name="$APPLICATION_CONFIG_DIR$/scratches/scratch_1.json" timestamp="1492339311193">
        <mark key="'" line="2669" column="0" />
        <mark key="[" line="0" column="0" />
        <mark key="]" line="2669" column="0" />
        <mark key="^" line="0" column="31135" />
        <mark key="." line="0" column="31135" />
      </file>
    </filemarks>
    <jumps>
      <jump line="6" column="0" filename="$USER_HOME$/Projects/kuze/php/invoice/create-doc.php" />
      <jump line="64" column="0" filename="$USER_HOME$/Projects/kuze/php/invoice/create-doc.php" />
      <jump line="91" column="4" filename="$USER_HOME$/Projects/kuze/php/api/invoices.php" />
      <jump line="40" column="0" filename="$USER_HOME$/Projects/kuze/php/invoice/create-doc2.php" />
      <jump line="88" column="4" filename="$USER_HOME$/Projects/kuze/php/invoice/create-doc2.php" />
      <jump line="10" column="0" filename="$USER_HOME$/Projects/kuze/php/invoice/create-doc2.php" />
      <jump line="2903" column="32" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="2904" column="38" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="2913" column="47" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="2916" column="66" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="292" column="74" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="16" column="36" filename="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" />
      <jump line="522" column="22" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="154" column="32" filename="$USER_HOME$/Projects/kuze/php/kuze_db.php" />
      <jump line="111" column="13" filename="$USER_HOME$/Projects/kuze/php/kuze_db.php" />
      <jump line="18" column="32" filename="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" />
      <jump line="19" column="29" filename="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" />
      <jump line="0" column="0" filename="$APPLICATION_CONFIG_DIR$/consoles/db/6e25fe0b-98f3-46a4-9336-01e7aed49277/console.sql" />
      <jump line="107" column="6" filename="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" />
      <jump line="0" column="0" filename="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" />
      <jump line="101" column="5" filename="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" />
      <jump line="7" column="0" filename="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" />
      <jump line="59" column="8" filename="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" />
      <jump line="2914" column="29" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="2915" column="45" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="2923" column="13" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="2925" column="2" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="100" column="46" filename="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" />
      <jump line="1951" column="27" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="126" column="21" filename="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" />
      <jump line="22" column="0" filename="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" />
      <jump line="1963" column="36" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="2929" column="29" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="111" column="37" filename="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" />
      <jump line="147" column="0" filename="$USER_HOME$/Projects/kuze/php/invoice/create-doc.php" />
      <jump line="371" column="25" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="381" column="34" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="383" column="30" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="391" column="35" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="393" column="25" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="395" column="24" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="402" column="43" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="404" column="34" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="406" column="33" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="413" column="34" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="433" column="32" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="437" column="8" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="439" column="32" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="445" column="8" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="450" column="32" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="459" column="12" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="460" column="36" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="465" column="10" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="466" column="34" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="470" column="10" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="471" column="34" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="21" column="51" filename="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" />
      <jump line="149" column="40" filename="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" />
      <jump line="137" column="0" filename="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" />
      <jump line="8" column="24" filename="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" />
      <jump line="9" column="26" filename="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" />
      <jump line="5570" column="21" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5822" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="14" column="66" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="202" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="202" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="791" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="161" column="27" filename="$USER_HOME$/Projects/kuze/php/kuze_db.php" />
      <jump line="781" column="41" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="319" column="31" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="1921" column="24" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="5522" column="23" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="5750" column="17" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="5861" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5860" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="6101" column="1" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="0" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="6100" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="3378" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="6106" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="1983" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="1888" column="63" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="1919" column="9" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="1947" column="11" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5519" column="23" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5745" column="17" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5772" column="81" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5780" column="14" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5788" column="9" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5792" column="15" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="1918" column="9" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="1892" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="3" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="1892" column="57" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="1889" column="57" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="1339" column="12" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5382" column="24" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5381" column="25" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="4723" column="8" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5275" column="8" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
    </jumps>
    <registers>
      <register name="&quot;" type="2">
        <text encoding="base64">Ly8gdjExIC0gMjMgbWFyY2ggMjAxNwovL0RlZmluZSBhbiBhbmd1bGFyIG1vZHVsZSBmb3Igb3VyIGFwcAoKdmFyIGt1emVJc0NhbGVuZGFyRHJhZ2dibGU7Cmt1emVJc0NhbGVuZGFyRHJhZ2dibGUgPSB0cnVlOwoKLy8gYW5ndWxhciBtb2R1bGVzCi8vJGFuZ3VsYXJNb2R1bGVzPVsnbmdSb3V0ZScsJ3VpLmJvb3RzdHJhcCcsJ3VpLmdyaWQnXTsKJGFuZ3VsYXJNb2R1bGVzID0gWyduZ1JvdXRlJywgJ3VpLmJvb3RzdHJhcCcsICd1aS5ncmlkJywgJ2J1aWxkZXInLCAnYnVpbGRlci5jb21wb25lbnRzJywgJ3ZhbGlkYXRvci5ydWxlcycsICd1aS5jYWxlbmRhcicsICdjaGVja2xpc3QtbW9kZWwnLCAndWkuYm9vdHN0cmFwLmRhdGV0aW1lcGlja2VyJywgJ2FuZ3Vjb21wbGV0ZS1hbHQnLCAnbXVsdGlwbGVTZWxlY3QnLCdhbmd1bGFySW5saW5lRWRpdCcsJ3RleHRBbmd1bGFyJywnbmdDc3YnXTsKCnZhciBkYXlOYW1lcyA9IFsn16jXkNep15XXnycsICfXqdeg15knLCAn16nXnNeZ16nXmScsICfXqNeR15nXoteZJywgJ9eX157Xmdep15knLCAn16nXmdep15knLCAn16nXkdeqJ107CnZhciBtb250aE5hbWVzID0gWyLXmdeg15XXkNeoIiwgItek15HXqNeV15DXqCIsICLXnteo16UiLCAi15DXpNeo15nXnCIsICLXnteQ15kiLCAi15nXldeg15kiLAogICAgIteZ15XXnNeZIiwgIteQ15XXkteV16HXmCIsICLXodek15jXnteR16giLCAi15DXlden15jXldeR16giLCAi16DXldeR157XkdeoIiwgIteT16bXnteR16giCl07Cgp2YXIgbG9naW5OZXh0U2NyZWVuPSIiOwoKKGZ1bmN0aW9uKCl7RGF0ZS5zaG9ydE1vbnRocz1bIkphbiIsIkZlYiIsIk1hciIsIkFwciIsIk1heSIsIkp1biIsIkp1bCIsIkF1ZyIsIlNlcCIsIk9jdCIsIk5vdiIsIkRlYyJdLERhdGUubG9uZ01vbnRocz1bIkphbnVhcnkiLCJGZWJydWFyeSIsIk1hcmNoIiwiQXByaWwiLCJNYXkiLCJKdW5lIiwiSnVseSIsIkF1Z3VzdCIsIlNlcHRlbWJlciIsIk9jdG9iZXIiLCJOb3ZlbWJlciIsIkRlY2VtYmVyIl0sRGF0ZS5zaG9ydERheXM9WyJTdW4iLCJNb24iLCJUdWUiLCJXZWQiLCJUaHUiLCJGcmkiLCJTYXQiXSxEYXRlLmxvbmdEYXlzPVsiU3VuZGF5IiwiTW9uZGF5IiwiVHVlc2RheSIsIldlZG5lc2RheSIsIlRodXJzZGF5IiwiRnJpZGF5IiwiU2F0dXJkYXkiXTt2YXIgdD17ZDpmdW5jdGlvbigpe3JldHVybih0aGlzLmdldERhdGUoKTwxMD8iMCI6IiIpK3RoaXMuZ2V0RGF0ZSgpfSxEOmZ1bmN0aW9uKCl7cmV0dXJuIERhdGUuc2hvcnREYXlzW3RoaXMuZ2V0RGF5KCldfSxqOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZ2V0RGF0ZSgpfSxsOmZ1bmN0aW9uKCl7cmV0dXJuIERhdGUubG9uZ0RheXNbdGhpcy5nZXREYXkoKV19LE46ZnVuY3Rpb24oKXtyZXR1cm4gMD09dGhpcy5nZXREYXkoKT83OnRoaXMuZ2V0RGF5KCl9LFM6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5nZXREYXRlKCklMTA9PTEmJjExIT10aGlzLmdldERhdGUoKT8ic3QiOnRoaXMuZ2V0RGF0ZSgpJTEwPT0yJiYxMiE9dGhpcy5nZXREYXRlKCk/Im5kIjp0aGlzLmdldERhdGUoKSUxMD09MyYmMTMhPXRoaXMuZ2V0RGF0ZSgpPyJyZCI6InRoIn0sdzpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldERheSgpfSx6OmZ1bmN0aW9uKCl7dmFyIHQ9bmV3IERhdGUodGhpcy5nZXRGdWxsWWVhcigpLDAsMSk7cmV0dXJuIE1hdGguY2VpbCgodGhpcy10KS84NjRlNSl9LFc6ZnVuY3Rpb24oKXt2YXIgdD1uZXcgRGF0ZSh0aGlzLnZhbHVlT2YoKSksZT0odGhpcy5nZXREYXkoKSs2KSU3O3Quc2V0RGF0ZSh0LmdldERhdGUoKS1lKzMpO3ZhciBuPXQudmFsdWVPZigpO3JldHVybiB0LnNldE1vbnRoKDAsMSksNCE9PXQuZ2V0RGF5KCkmJnQuc2V0TW9udGgoMCwxKyg0LXQuZ2V0RGF5KCkrNyklNyksMStNYXRoLmNlaWwoKG4tdCkvNjA0OGU1KX0sRjpmdW5jdGlvbigpe3JldHVybiBEYXRlLmxvbmdNb250aHNbdGhpcy5nZXRNb250aCgpXX0sbTpmdW5jdGlvbigpe3JldHVybih0aGlzLmdldE1vbnRoKCk8OT8iMCI6IiIpKyh0aGlzLmdldE1vbnRoKCkrMSl9LE06ZnVuY3Rpb24oKXtyZXR1cm4gRGF0ZS5zaG9ydE1vbnRoc1t0aGlzLmdldE1vbnRoKCldfSxuOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZ2V0TW9udGgoKSsxfSx0OmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5nZXRGdWxsWWVhcigpLGU9dGhpcy5nZXRNb250aCgpKzE7cmV0dXJuIDEyPT09ZSYmKHQ9dCsrLGU9MCksbmV3IERhdGUodCxlLDApLmdldERhdGUoKX0sTDpmdW5jdGlvbigpe3ZhciB0PXRoaXMuZ2V0RnVsbFllYXIoKTtyZXR1cm4gdCU0MDA9PTB8fHQlMTAwIT0wJiZ0JTQ9PTB9LG86ZnVuY3Rpb24oKXt2YXIgdD1uZXcgRGF0ZSh0aGlzLnZhbHVlT2YoKSk7cmV0dXJuIHQuc2V0RGF0ZSh0LmdldERhdGUoKS0odGhpcy5nZXREYXkoKSs2KSU3KzMpLHQuZ2V0RnVsbFllYXIoKX0sWTpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldEZ1bGxZZWFyKCl9LHk6ZnVuY3Rpb24oKXtyZXR1cm4oIiIrdGhpcy5nZXRGdWxsWWVhcigpKS5zdWJzdHIoMil9LGE6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5nZXRIb3VycygpPDEyPyJhbSI6InBtIn0sQTpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldEhvdXJzKCk8MTI/IkFNIjoiUE0ifSxCOmZ1bmN0aW9uKCl7cmV0dXJuIE1hdGguZmxvb3IoMWUzKigodGhpcy5nZXRVVENIb3VycygpKzEpJTI0K3RoaXMuZ2V0VVRDTWludXRlcygpLzYwK3RoaXMuZ2V0VVRDU2Vjb25kcygpLzM2MDApLzI0KX0sZzpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldEhvdXJzKCklMTJ8fDEyfSxHOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZ2V0SG91cnMoKX0saDpmdW5jdGlvbigpe3JldHVybigodGhpcy5nZXRIb3VycygpJTEyfHwxMik8MTA/IjAiOiIiKSsodGhpcy5nZXRIb3VycygpJTEyfHwxMil9LEg6ZnVuY3Rpb24oKXtyZXR1cm4odGhpcy5nZXRIb3VycygpPDEwPyIwIjoiIikrdGhpcy5nZXRIb3VycygpfSxpOmZ1bmN0aW9uKCl7cmV0dXJuKHRoaXMuZ2V0TWludXRlcygpPDEwPyIwIjoiIikrdGhpcy5nZXRNaW51dGVzKCl9LHM6ZnVuY3Rpb24oKXtyZXR1cm4odGhpcy5nZXRTZWNvbmRzKCk8MTA/IjAiOiIiKSt0aGlzLmdldFNlY29uZHMoKX0sdTpmdW5jdGlvbigpe3ZhciB0PXRoaXMuZ2V0TWlsbGlzZWNvbmRzKCk7cmV0dXJuKDEwPnQ/IjAwIjoxMDA+dD8iMCI6IiIpK3R9LGU6ZnVuY3Rpb24oKXtyZXR1cm4vXCgoLiopXCkvLmV4ZWMoKG5ldyBEYXRlKS50b1N0cmluZygpKVsxXX0sSTpmdW5jdGlvbigpe2Zvcih2YXIgdD1udWxsLGU9MDsxMj5lOysrZSl7dmFyIG49bmV3IERhdGUodGhpcy5nZXRGdWxsWWVhcigpLGUsMSksaT1uLmdldFRpbWV6b25lT2Zmc2V0KCk7aWYobnVsbD09PXQpdD1pO2Vsc2V7aWYodD5pKXt0PWk7YnJlYWt9aWYoaT50KWJyZWFrfX1yZXR1cm4gdGhpcy5nZXRUaW1lem9uZU9mZnNldCgpPT10fDB9LE86ZnVuY3Rpb24oKXtyZXR1cm4oLXRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKTwwPyItIjoiKyIpKyhNYXRoLmFicyh0aGlzLmdldFRpbWV6b25lT2Zmc2V0KCkvNjApPDEwPyIwIjoiIikrTWF0aC5mbG9vcihNYXRoLmFicyh0aGlzLmdldFRpbWV6b25lT2Zmc2V0KCkvNjApKSsoMD09TWF0aC5hYnModGhpcy5nZXRUaW1lem9uZU9mZnNldCgpJTYwKT8iMDAiOihNYXRoLmFicyh0aGlzLmdldFRpbWV6b25lT2Zmc2V0KCklNjApPDEwPyIwIjoiIikrTWF0aC5hYnModGhpcy5nZXRUaW1lem9uZU9mZnNldCgpJTYwKSl9LFA6ZnVuY3Rpb24oKXtyZXR1cm4oLXRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKTwwPyItIjoiKyIpKyhNYXRoLmFicyh0aGlzLmdldFRpbWV6b25lT2Zmc2V0KCkvNjApPDEwPyIwIjoiIikrTWF0aC5mbG9vcihNYXRoLmFicyh0aGlzLmdldFRpbWV6b25lT2Zmc2V0KCkvNjApKSsiOiIrKDA9PU1hdGguYWJzKHRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKSU2MCk/IjAwIjooTWF0aC5hYnModGhpcy5nZXRUaW1lem9uZU9mZnNldCgpJTYwKTwxMD8iMCI6IiIpK01hdGguYWJzKHRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKSU2MCkpfSxUOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMudG9UaW1lU3RyaW5nKCkucmVwbGFjZSgvXi4rIFwoPyhbXlwpXSspXCk/JC8sIiQxIil9LFo6ZnVuY3Rpb24oKXtyZXR1cm4gNjAqLXRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKX0sYzpmdW5jdGlvbigpe3JldHVybiB0aGlzLmZvcm1hdCgiWS1tLWRcXFRIOmk6c1AiKX0scjpmdW5jdGlvbigpe3JldHVybiB0aGlzLnRvU3RyaW5nKCl9LFU6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5nZXRUaW1lKCkvMWUzfX07RGF0ZS5wcm90b3R5cGUuZm9ybWF0PWZ1bmN0aW9uKGUpe3ZhciBuPXRoaXM7cmV0dXJuIGUucmVwbGFjZSgvKFxcPykoLikvZyxmdW5jdGlvbihlLGkscil7cmV0dXJuIiI9PT1pJiZ0W3JdP3Rbcl0uY2FsbChuKTpyfSl9fSkuY2FsbCh0aGlzKTsKCmZ1bmN0aW9uIGdvdG9DbGllbnRQYWdlKGJ1c2luZXNzX3VzZXJfaWQpCnsKICB3aW5kb3cubG9jYXRpb24uaHJlZj0nLyMvYnVzaW5lc3NfY2xpZW50cy8nICsgYnVzaW5lc3NfdXNlcl9pZDsKfQpmdW5jdGlvbiBnb3RvSW5zdHJ1Y3RvclBhZ2UoYnVzaW5lc3NfdXNlcl9pZCkKewogIHdpbmRvdy5sb2NhdGlvbi5ocmVmPScvIy9idXNpbmVzc19pbnN0cnVjdG9ycy8nICsgYnVzaW5lc3NfdXNlcl9pZDsKfQoKZnVuY3Rpb24gZ290b0V2ZW50UGFnZSh0aGVldmVudCkKewogIGxvZ0RlYnVnKCJnb3RvRXZlbnRQYWdlICIrdGhlZXZlbnQpOwogIGlmICh0aGVldmVudC5pc19jbGFzcz09MSkKICB7CiAgICB3aW5kb3cubG9jYXRpb24uaHJlZj0nLyMvZXZlbnRfY2xhc3MvJyArIHRoZWV2ZW50LmV2ZW50X2lkOwogIH0KICBlbHNlCiAgewogICAgd2luZG93LmxvY2F0aW9uLmhyZWY9Jy8jL2V2ZW50LycgKyB0aGVldmVudC5ldmVudF9pZDsKICB9Cn0KCmZ1bmN0aW9uIGdvdG9Mb2NhdGlvblBhZ2UobG9jYXRpb25faWQpCnsKICBsb2dEZWJ1ZygiZ290b0xvY2F0aW9uUGFnZSAiK2xvY2F0aW9uX2lkKTsKICB3aW5kb3cubG9jYXRpb24uaHJlZj0nLyMvYnVzaW5lc3NfbG9jYXRpb25zLycgKyBsb2NhdGlvbl9pZDsKCn0KCmZ1bmN0aW9uIGdvdG9DbGllbnRFZGl0UGFnZSh1c2VyX2lkKQp7CiAgd2luZG93LmxvY2F0aW9uLmhyZWY9Jy8jL2J1c2luZXNzX2NsaWVudHMvJyArIHVzZXJfaWQgKyAnL2VkaXQnOwp9CgpmdW5jdGlvbiBnb3RvQmFjaygpCnsKICB3aW5kb3cuaGlzdG9yeS5iYWNrKCk7Cn0KCmZ1bmN0aW9uIHNob3dFdmVudFBvcHVwKHNlbGVjdGVkRXZlbnQsICR1aWJNb2RhbCkKewogIC8vIHRoaXMgZnVuY3Rpb24gdXNlZCB0byBicmluZyBhIHBvcHVwCiAgLy8gbm93IGl0IGdvZXMgdG8gdGhlIGV2ZW50IHBhZ2UKICBnb3RvRXZlbnRQYWdlKHNlbGVjdGVkRXZlbnQpOwoKICAvLyBpZiAoc2VsZWN0ZWRFdmVudC5pc19yZXBlYXRpbmcgPT0gMSkgewogIC8vICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAvLyAgICAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgLy8gICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9jbGFzc19zaW5nbGUucGhwJywKICAvLyAgICAgICAgIGNvbnRyb2xsZXI6ICdldmVudFJlY3VycmluZ0RldGFpbHNCdXNpbmVzc0NhbGVuZGFyTW9kYWxDb250cm9sbGVyJywKICAvLyAgICAgICAgIC8vIHNpemU6IHNpemUsCiAgLy8gICAgICAgICByZXNvbHZlOiB7CiAgLy8gICAgICAgICAgICAgc2VsZWN0ZWRFdmVudDogZnVuY3Rpb24oKSB7CiAgLy8gICAgICAgICAgICAgICAgIHJldHVybiBzZWxlY3RlZEV2ZW50OwogIC8vICAgICAgICAgICAgIH0KICAvLyAgICAgICAgIH0KICAvLyAgICAgfSk7CiAgLy8gfSBlbHNlIHsKICAvLyAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgLy8gICAgICAgICBhbmltYXRpb246IGZhbHNlLAogIC8vICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfZXZlbnRfc2luZ2xlLnBocCcsCiAgLy8gICAgICAgICBjb250cm9sbGVyOiAnZXZlbnREZXRhaWxzQnVzaW5lc3NDYWxlbmRhck1vZGFsQ29udHJvbGxlcicsCiAgLy8gICAgICAgICAvLyBzaXplOiBzaXplLAogIC8vICAgICAgICAgcmVzb2x2ZTogewogIC8vICAgICAgICAgICAgIHNlbGVjdGVkRXZlbnQ6IGZ1bmN0aW9uKCkgewogIC8vICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZWN0ZWRFdmVudDsKICAvLyAgICAgICAgICAgICB9CiAgLy8gICAgICAgICB9CiAgLy8gICAgIH0pOwogIC8vIH0KfQpmdW5jdGlvbiB1cGRhdGVHbG9iYWxMYW5ndWFnZSgkc2NvcGUsICRuZXdsYW5nKSB7CgogICAgLy8JdmFyIGdMYW5nPWdMYW5nQmFzZVtnTGFuZ0N1cnJdOwogICAgJGdMYW5nID0gZ0xhbmdCYXNlWyRuZXdsYW5nXTsKICAgIC8vIGxvZ0RlYnVnKCJnTGFuZ0Jhc2VbJG5ld2xhbmddWyd0aXRsZTEnXT0iICsgZ0xhbmdCYXNlWyRuZXdsYW5nXVsndGl0bGUxJ10pOwogICAgLy8gbG9nRGVidWcoImxhbmd1Z2FnZToiICsgJGdMYW5nWydsYW5ndWFnZSddKTsKICAgIC8vCWxvZ0RlYnVnKCJsYW5ndWdhZ2UgZGlyOiAiKyRnTGFuZ1snZGlyJ10pOwogICAgLy8JbG9nRGVidWcoImNoYW5naW5nIGxhbmd1YWdlIHRvICIrJG5ld2xhbmcpCiAgICAkc2NvcGUuc3BDbGFzcyA9ICRnTGFuZ1snY2xhc3MnXTsKICAgIC8vCWxvZ0RlYnVnKCJpcyBhcnJheT8gIithbmd1bGFyLmlzQXJyYXkoJGdMYW5nKSk7CiAgICAvLwlsb2dEZWJ1ZygiJGdMYW5nWydkaXInXT0iKyRnTGFuZ1snZGlyJ10pOwogICAgLy8JbG9nRGVidWcoIiRnTGFuZ1sndGl0bGUxJ109IiskZ0xhbmdbJ3RpdGxlMSddKTsKICAgICRzY29wZS5sYW5nZmlsZSA9ICRnTGFuZzsKICAgIC8vIGxvZ0RlYnVnKCJpcyBhcnJheT8gIiArIGFuZ3VsYXIuaXNBcnJheSgkc2NvcGUubGFuZ2ZpbGUpKTsKICAgIC8vIGxvZ0RlYnVnKCIkc2NvcGUubGFuZ2ZpbGU9IiArICRzY29wZS5sYW5nZmlsZSk7CiAgICAvLyBsb2dEZWJ1ZygiJHNjb3BlLmxhbmdmaWxlWyd0aXRsZTEnXT0iICsgJHNjb3BlLmxhbmdmaWxlWyd0aXRsZTEnXSk7CgogICAgJHNjb3BlLnRlc3RuZXd2YXIgPSAkc2NvcGUubGFuZ2ZpbGVbJ3RpdGxlMSddOwogICAgLy8JJHNjb3BlLm1lc3NhZ2U9JHNjb3BlLmxhbmdmaWxlWyd0aXRsZTEnXTsKfQoKZnVuY3Rpb24gZ2V0UmFuZG9tQ29sb3IoKSB7CiAgICB2YXIgbGV0dGVycyA9ICcwMTIzNDU2Nzg5QUJDREVGJy5zcGxpdCgnJyk7CiAgICB2YXIgY29sb3IgPSAnIyc7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IDY7IGkrKykgewogICAgICAgIGNvbG9yICs9IGxldHRlcnNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTYpXTsKICAgIH0KICAgIHJldHVybiBjb2xvcjsKfQoKZnVuY3Rpb24gZ2V0UmFuZG9tSW50KG1pbiwgbWF4KSB7CiAgICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKG1heCAtIG1pbiArIDEpKSArIG1pbjsKfQoKZnVuY3Rpb24gY2FsY190ZW1wX2xpbWl0X2lkKCkgewogICAgdmFyIGQgPSBuZXcgRGF0ZSgpOwogICAgdmFyIHJhbmRvbWxpbWl0ID0gZC5nZXRUaW1lKCk7CiAgICBsb2dEZWJ1ZygiY2FsY190ZW1wX2xpbWl0X2lkPSIgKyByYW5kb21saW1pdCk7CiAgICByZXR1cm4gcmFuZG9tbGltaXQ7Cn0KCnZhciAkZ0xvZ0xldmVsID0gJ2RlYnVnJzsKCi8vIHN0YXJ0aW5nCmxvZ0RlYnVnKCJtYWluICRnTG9nTGV2ZWw9IiArICRnTG9nTGV2ZWwpOwpsb2dEZWJ1ZygiaW5pdGlhbGl6ZSBhbmd1bGFyIik7CmxvZ0RlYnVnKCJpbml0aWFsaXppbmcgbW9kdWxlcyAiICsgJGFuZ3VsYXJNb2R1bGVzKTsKCnZhciBrdXplQXBwID0gYW5ndWxhci5tb2R1bGUoJ2t1emVBcHAnLCAkYW5ndWxhck1vZHVsZXMpCgovLyRyb290U2NvcGUuc3BDbGFzcyA9ICdyaWdodCc7Cmt1emVSdW4gPSBmdW5jdGlvbigpIHsKCn0Ka3V6ZUFwcC5ydW4oWwogICAgJyRidWlsZGVyJywKICAgIGZ1bmN0aW9uKCRidWlsZGVyKSB7CiAgICAgICAgLy8gbG9nRGVidWcoImluc2lkZSBrdXplQXBwLnJ1biIpOwogICAgICAgICRidWlsZGVyLnJlZ2lzdGVyQ29tcG9uZW50KCdzYW1wbGVJbnB1dCcsIHsKICAgICAgICAgICAgZ3JvdXA6ICdmcm9tIGh0bWwnLAogICAgICAgICAgICBsYWJlbDogJ1NhbXBsZScsCiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnRnJvbSBodG1sIHRlbXBsYXRlJywKICAgICAgICAgICAgcGxhY2Vob2xkZXI6ICdwbGFjZWhvbGRlcicsCiAgICAgICAgICAgIHJlcXVpcmVkOiBmYWxzZSwKICAgICAgICAgICAgdmFsaWRhdGlvbk9wdGlvbnM6IFt7CiAgICAgICAgICAgICAgICBsYWJlbDogJ25vbmUnLAogICAgICAgICAgICAgICAgcnVsZTogJy8uKi8nCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgIGxhYmVsOiAnbnVtYmVyJywKICAgICAgICAgICAgICAgIHJ1bGU6ICdbbnVtYmVyXScKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgbGFiZWw6ICdlbWFpbCcsCiAgICAgICAgICAgICAgICBydWxlOiAnW2VtYWlsXScKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgbGFiZWw6ICd1cmwnLAogICAgICAgICAgICAgICAgcnVsZTogJ1t1cmxdJwogICAgICAgICAgICB9XSwKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYW5ndWxhci1mb3JtLWJ1aWxkZXIvZXhhbXBsZS90ZW1wbGF0ZS5odG1sJywKICAgICAgICAgICAgcG9wb3ZlclRlbXBsYXRlVXJsOiAnL2FuZ3VsYXItZm9ybS1idWlsZGVyL2V4YW1wbGUvcG9wb3ZlclRlbXBsYXRlLmh0bWwnCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuICRidWlsZGVyLnJlZ2lzdGVyQ29tcG9uZW50KCduYW1lJywgewogICAgICAgICAgICBncm91cDogJ0RlZmF1bHQnLAogICAgICAgICAgICBsYWJlbDogJ05hbWUnLAogICAgICAgICAgICByZXF1aXJlZDogZmFsc2UsCiAgICAgICAgICAgIGFycmF5VG9UZXh0OiB0cnVlLAogICAgICAgICAgICB0ZW1wbGF0ZTogIjxkaXYgY2xhc3M9XCJmb3JtLWdyb3VwXCI+XG4gICAgPGxhYmVsIGZvcj1cInt7Zm9ybU5hbWUraW5kZXh9fVwiIGNsYXNzPVwiY29sLW1kLTQgY29udHJvbC1sYWJlbFwiIG5nLWNsYXNzPVwieydmYi1yZXF1aXJlZCc6cmVxdWlyZWR9XCI+e3tsYWJlbH19PC9sYWJlbD5cbiAgICA8ZGl2IGNsYXNzPVwiY29sLW1kLThcIj5cbiAgICAgICAgPGlucHV0IHR5cGU9J2hpZGRlbicgbmctbW9kZWw9XCJpbnB1dFRleHRcIiB2YWxpZGF0b3ItcmVxdWlyZWQ9XCJ7e3JlcXVpcmVkfX1cIiB2YWxpZGF0b3ItZ3JvdXA9XCJ7e2Zvcm1OYW1lfX1cIi8+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJjb2wtc20tNlwiIHN0eWxlPVwicGFkZGluZy1sZWZ0OiAwO1wiPlxuICAgICAgICAgICAgPGlucHV0IHR5cGU9XCJ0ZXh0XCJcbiAgICAgICAgICAgICAgICBuZy1tb2RlbD1cImlucHV0QXJyYXlbMF1cIlxuICAgICAgICAgICAgICAgIGNsYXNzPVwiZm9ybS1jb250cm9sXCIgaWQ9XCJ7e2Zvcm1OYW1lK2luZGV4fX0tMFwiLz5cbiAgICAgICAgICAgIDxwIGNsYXNzPSdoZWxwLWJsb2NrJz5GaXJzdCBuYW1lPC9wPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImNvbC1zbS02XCIgc3R5bGU9XCJwYWRkaW5nLWxlZnQ6IDA7XCI+XG4gICAgICAgICAgICA8aW5wdXQgdHlwZT1cInRleHRcIlxuICAgICAgICAgICAgICAgIG5nLW1vZGVsPVwiaW5wdXRBcnJheVsxXVwiXG4gICAgICAgICAgICAgICAgY2xhc3M9XCJmb3JtLWNvbnRyb2xcIiBpZD1cInt7Zm9ybU5hbWUraW5kZXh9fS0xXCIvPlxuICAgICAgICAgICAgPHAgY2xhc3M9J2hlbHAtYmxvY2snPkxhc3QgbmFtZTwvcD5cbiAgICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG48L2Rpdj4iLAogICAgICAgICAgICBwb3BvdmVyVGVtcGxhdGU6ICI8Zm9ybT5cbiAgICA8ZGl2IGNsYXNzPVwiZm9ybS1ncm91cFwiPlxuICAgICAgICA8bGFiZWwgY2xhc3M9J2NvbnRyb2wtbGFiZWwnPkxhYmVsPC9sYWJlbD5cbiAgICAgICAgPGlucHV0IHR5cGU9J3RleHQnIG5nLW1vZGVsPVwibGFiZWxcIiB2YWxpZGF0b3I9XCJbcmVxdWlyZWRdXCIgY2xhc3M9J2Zvcm0tY29udHJvbCcvPlxuICAgIDwvZGl2PlxuICAgIDxkaXYgY2xhc3M9XCJjaGVja2JveFwiPlxuICAgICAgICA8bGFiZWw+XG4gICAgICAgICAgICA8aW5wdXQgdHlwZT0nY2hlY2tib3gnIG5nLW1vZGVsPVwicmVxdWlyZWRcIiAvPlxuICAgICAgICAgICAgUmVxdWlyZWRcbiAgICAgICAgPC9sYWJlbD5cbiAgICA8L2Rpdj5cblxuICAgIDxoci8+XG4gICAgPGRpdiBjbGFzcz0nZm9ybS1ncm91cCc+XG4gICAgICAgIDxpbnB1dCB0eXBlPSdzdWJtaXQnIG5nLWNsaWNrPVwicG9wb3Zlci5zYXZlKCRldmVudClcIiBjbGFzcz0nYnRuIGJ0bi1wcmltYXJ5JyB2YWx1ZT0nU2F2ZScvPlxuICAgICAgICA8aW5wdXQgdHlwZT0nYnV0dG9uJyBuZy1jbGljaz1cInBvcG92ZXIuY2FuY2VsKCRldmVudClcIiBjbGFzcz0nYnRuIGJ0bi1kZWZhdWx0JyB2YWx1ZT0nQ2FuY2VsJy8+XG4gICAgICAgIDxpbnB1dCB0eXBlPSdidXR0b24nIG5nLWNsaWNrPVwicG9wb3Zlci5yZW1vdmUoJGV2ZW50KVwiIGNsYXNzPSdidG4gYnRuLWRhbmdlcicgdmFsdWU9J0RlbGV0ZScvPlxuICAgIDwvZGl2PlxuPC9mb3JtPiIKICAgICAgICB9KTsKICAgIH0KXSkKCmt1emVBcHAucnVuKGZ1bmN0aW9uKCRyb290U2NvcGUpIHsKICBsb2dEZWJ1ZygicnVuICRyb290U2NvcGUiKTsKICAkcm9vdFNjb3BlLiRvbignbG9hZGluZzpwcm9ncmVzcycsIGZ1bmN0aW9uICgpewogICAgICAvLyBzaG93IGxvYWRpbmcgZ2lmCiAgICAgIC8vICRzY29wZS5jdXJzb3JkZWxldGU9IndhaXQiOwogICAgICAvLyBkb2N1bWVudC5ib2R5LnN0eWxlLmN1cnNvcj0nd2FpdCc7CiAgfSk7CgogICRyb290U2NvcGUuJG9uKCdsb2FkaW5nOmZpbmlzaCcsIGZ1bmN0aW9uICgpewogICAgLy8gJHNjb3BlLmN1cnNvcmRlbGV0ZT0iIjsKICAgIC8vIGRvY3VtZW50LmJvZHkuc3R5bGUuY3Vyc29yPScnOwogIH0pOwp9KTsKCi8vIERFTEVURUQgLSB4ZWRpdGFibGUgc3R1ZmYKLy8ga3V6ZUFwcC5ydW4oZnVuY3Rpb24oZWRpdGFibGVPcHRpb25zLCBlZGl0YWJsZVRoZW1lcykgewovLyAgICAgbG9nRGVidWcoImluaXRpYWxpemluZyB4ZWRpdGFibGUgZWRpdGFibGVPcHRpb25zIik7Ci8vICAgICBlZGl0YWJsZU9wdGlvbnMudGhlbWUgPSAnYnMzJzsgLy8gYm9vdHN0cmFwMyB0aGVtZS4gQ2FuIGJlIGFsc28gJ2JzMicsICdkZWZhdWx0JwovLyAgICAgLy8gZWRpdGFibGVPcHRpb25zLmRlZmF1bHRzLm1vZGUgPSAnaW5saW5lJzsKLy8gICAgIGxvZ0RlYnVnKGVkaXRhYmxlT3B0aW9ucyk7Ci8vICAgICAvLyBlZGl0YWJsZU9wdGlvbnMubW9kZSA9ICdpbmxpbmUnOwovLyAgICAgZWRpdGFibGVUaGVtZXMuYnMzLmlucHV0Q2xhc3MgPSAnaW5wdXQtc20nOwovLyAgICAgZWRpdGFibGVUaGVtZXMuYnMzLmJ1dHRvbnNDbGFzcyA9ICdidG4tc20nOwovLyB9KTsKCi8vIGFmdGVyIGZvcm1zCi8vRGVmaW5lIFJvdXRpbmcgZm9yIGFwcAovL1VyaSAvQWRkTmV3T3JkZXIgLT4gdGVtcGxhdGUgYWRkX29yZGVyLmh0bWwgYW5kIENvbnRyb2xsZXIgQ2xpZW50c0FkZENvbnRyb2xsZXIKLy9VcmkgL1Nob3dPcmRlcnMgLT4gdGVtcGxhdGUgc2hvd19vcmRlcnMuaHRtbCBhbmQgQ29udHJvbGxlciBDbGllbnRzQWRkQ29udHJvbGxlcgprdXplQXBwLmNvbmZpZyhbJyRyb3V0ZVByb3ZpZGVyJywKICAgIGZ1bmN0aW9uKCRyb3V0ZVByb3ZpZGVyKSB7CiAgICAgICAgLy8gbG9nRGVidWcoJHJvdXRlUHJvdmlkZXIpOwogICAgICAgICRyb3V0ZVByb3ZpZGVyLgogICAgICAgIC8vIHdoZW4oJy9jbGllbnRjYXJkJywgewogICAgICAgIC8vICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19jbGllbnRfY2FyZC5odG1sJywKICAgICAgICAvLyAgICAgY29udHJvbGxlcjogJ2NsaWVudENhcmRDb250cm9sbGVyJwogICAgICAgIC8vIH0pLgogICAgICAgIHdoZW4oJy9jb250YWN0JywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdjb250YWN0LnBocCcsCiAgICAgICAgICAgIC8vIGNvbnRyb2xsZXI6ICdlbmRVc2VySG9tZUNvbnRyb2xsZXInCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdjb250YWN0Q29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvZXZlbnRfdHlwZXMnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2V2ZW50X3R5cGVzLmh0bWwnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnRXZlbnRUeXBlc0NvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2V2ZW50X3R5cGVzL2FkZCcsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfZXZlbnRfdHlwZV9hZGQucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0V2ZW50VHlwZU5ld0NvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2V2ZW50X3R5cGVzLzpldmVudF90eXBlX2lkJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19ldmVudF90eXBlX2FkZC5waHAnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnRXZlbnRUeXBlVXBkYXRlQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvaG91cnNfb2Zfd29yaycsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfaG91cnNfb2Zfd29yay5odG1sJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0hvdXJzT2ZXb3JrQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvYnVzaW5lc3NfY2FsZW5kYXInLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2NhbGVuZGFyLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdCdXNpbmVzc0NhbGVuZGFyQ29udHJvbGxlcicsCiAgICAgICAgICAgIHJlbG9hZE9uU2VhcmNoOiBmYWxzZQogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9hbmd1bGFyLWZvcm0tYnVpbGRlcicsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYW5ndWxhci1mb3JtLWJ1aWxkZXIvaW5kZXguaHRtbCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdEZW1vQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvYnVzaW5lc3NfY2xpZW50cy9hZGQnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2NsaWVudHNfYWRkLmh0bWwnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnQ2xpZW50c0FkZENvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2J1c2luZXNzX2NsaWVudHMnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2NsaWVudHMucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0NsaWVudHNTaG93Q29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvYnVzaW5lc3NfY2xpZW50cy86YnVzaW5lc3NfdXNlcl9pZCcsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6IGZ1bmN0aW9uKHBhcmFtcykgewogICAgICAgICAgICAgICAgcmV0dXJuICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfY2xpZW50X2NhcmQucGhwP2J1c2luZXNzX3VzZXJfaWQ9JyArIHBhcmFtcy5idXNpbmVzc191c2VyX2lkIDsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgY29udHJvbGxlcjogJ0NsaWVudHNTaG93MUNvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2J1c2luZXNzX3JlcG9ydHMnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX3JlcG9ydHMuaHRtbCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdCdXNpbmVzc1JlcG9ydHNDb250cm9sbGVyJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9idXNpbmVzc19pbnN0cnVjdG9ycycsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfaW5zdHJ1Y3RvcnMucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0luc3RydWN0b3JzU2hvd0NvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2J1c2luZXNzX2luc3RydWN0b3JzL2FkZCcsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfY2xpZW50c19hZGQuaHRtbCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdJbnN0cnVjdG9yc0FkZENvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2J1c2luZXNzX2xvY2F0aW9ucycsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbG9jYXRpb25zLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdidXNpbmVzc19sb2NhdGlvbnMnCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2J1c2luZXNzX2xvY2F0aW9ucy9hZGQnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2xvY2F0aW9uc19hZGQucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ2J1c2luZXNzX2xvY2F0aW9uc19hZGQnCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2J1c2luZXNzX2xvY2F0aW9ucy86bG9jYXRpb25faWQnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2xvY2F0aW9uc19hZGQucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ2J1c2luZXNzX2xvY2F0aW9uc191cGRhdGUnCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2J1c2luZXNzX2luc3RydWN0b3JzLzpidXNpbmVzc191c2VyX2lkJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19pbnN0cnVjdG9yX2NhcmQucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0luc3RydWN0b3JTaG93MUNvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2V2ZW50LzpldmVudF9pZCcsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6IGZ1bmN0aW9uKHBhcmFtcykgewogICAgICAgICAgICAgICAgcmV0dXJuICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfZXZlbnRfY2FyZC5waHA/ZXZlbnRfaWQ9JyArIHBhcmFtcy5ldmVudF9pZCA7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdFdmVudFBhZ2VDb250cm9sbGVyJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9ldmVudF9jbGFzcy86ZXZlbnRfaWQnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBmdW5jdGlvbihwYXJhbXMpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2V2ZW50X2NsYXNzX2NhcmQucGhwP2V2ZW50X2lkPScgKyBwYXJhbXMuZXZlbnRfaWQgOwogICAgICAgICAgICB9LAogICAgICAgICAgICBjb250cm9sbGVyOiAnRXZlbnRDbGFzc1BhZ2VDb250cm9sbGVyJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9wYWNrYWdlcycsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfcGFja2FnZXNfc2hvdy5waHAnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnUGFja2FnZXNDb250cm9sbGVyJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9wYWNrYWdlcy9hZGQnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX3BhY2thZ2VzX2NyZWF0ZS5waHAnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnYnVzaW5lc3NfcGFja2FnZXNfYWRkX2NudGwnCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL3BhY2thZ2VzLzpwYWNrYWdlX2lkJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19wYWNrYWdlc19jcmVhdGUucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ2J1c2luZXNzX3BhY2thZ2VzX3VwZGF0ZV9jbnRsJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9idXNpbmVzc19jb25maWcnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2NvbmZpZy5waHAnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnQ29uZmlnQnVzaW5lc3NDb250cm9sbGVyJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy91c2VyX2NvbmZpZycsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAndXNlcl9jb25maWcucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0NvbmZpZ1VzZXJDb250cm9sbGVyJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9idXNpbmVzc19kb2NzJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19kb2NzLmh0bWwnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnQnVzaW5lc3NEb2NzQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdob21lLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdIb21lQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICBvdGhlcndpc2UoewogICAgICAgICAgICAvLyAgICByZWRpcmVjdFRvOiAnLycKICAgICAgICB9KTsKICAgIH0KXSk7CgprdXplQXBwLmZhY3RvcnkoJ2h0dHBJbnRlcmNlcHRvcicsIFsnJHEnLCAnJHJvb3RTY29wZScsCiAgICBmdW5jdGlvbiAoJHEsICRyb290U2NvcGUpIHsKICAgICAgICB2YXIgbG9hZGluZ0NvdW50ID0gMDsKCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgcmVxdWVzdDogZnVuY3Rpb24gKGNvbmZpZykgewogICAgICAgICAgICAgICAgaWYoKytsb2FkaW5nQ291bnQgPT09IDEpICRyb290U2NvcGUuJGJyb2FkY2FzdCgnbG9hZGluZzpwcm9ncmVzcycpOwogICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpZyB8fCAkcS53aGVuKGNvbmZpZyk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICByZXNwb25zZTogZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICBpZigtLWxvYWRpbmdDb3VudCA9PT0gMCkgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdsb2FkaW5nOmZpbmlzaCcpOwogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlIHx8ICRxLndoZW4ocmVzcG9uc2UpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgcmVzcG9uc2VFcnJvcjogZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICBpZigtLWxvYWRpbmdDb3VudCA9PT0gMCkgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdsb2FkaW5nOmZpbmlzaCcpOwogICAgICAgICAgICAgICAgcmV0dXJuICRxLnJlamVjdChyZXNwb25zZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgfQpdKS5jb25maWcoWyckaHR0cFByb3ZpZGVyJywgZnVuY3Rpb24gKCRodHRwUHJvdmlkZXIpIHsKICAgICRodHRwUHJvdmlkZXIuaW50ZXJjZXB0b3JzLnB1c2goJ2h0dHBJbnRlcmNlcHRvcicpOwp9XSk7CgprdXplQXBwLmZhY3RvcnkoJ3NoYXJlZERhdGEnLCBmdW5jdGlvbigpIHsKICAgIHZhciBzZWxlY3RlZEVuZFVzZXIgPSBudWxsOwoKICAgIHJldHVybiB7CiAgICAgICAgZ2V0U2VsZWN0ZWRFbmRVc2VyOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgLy9Zb3UgY291bGQgYWxzbyByZXR1cm4gc3BlY2lmaWMgYXR0cmlidXRlIG9mIHRoZSBmb3JtIGRhdGEgaW5zdGVhZAogICAgICAgICAgICAvL29mIHRoZSBlbnRpcmUgZGF0YQogICAgICAgICAgICByZXR1cm4gc2VsZWN0ZWRFbmRVc2VyOwogICAgICAgIH0sCiAgICAgICAgc2V0U2VsZWN0ZWRFbmRVc2VyOiBmdW5jdGlvbihuZXdTZWxlY3RlZEVuZFVzZXIpIHsKICAgICAgICAgICAgLy9Zb3UgY291bGQgYWxzbyBzZXQgc3BlY2lmaWMgYXR0cmlidXRlIG9mIHRoZSBmb3JtIGRhdGEgaW5zdGVhZAogICAgICAgICAgICBzZWxlY3RlZEVuZFVzZXIgPSBuZXdTZWxlY3RlZEVuZFVzZXI7CiAgICAgICAgfSwKICAgIH07Cn0pOwoKa3V6ZUFwcC5kaXJlY3RpdmUoJ2NvbnZlcnRUb051bWJlcicsIGZ1bmN0aW9uKCkgewogIHJldHVybiB7CiAgICByZXF1aXJlOiAnbmdNb2RlbCcsCiAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWxlbWVudCwgYXR0cnMsIG5nTW9kZWwpIHsKICAgICAgbmdNb2RlbC4kcGFyc2Vycy5wdXNoKGZ1bmN0aW9uKHZhbCkgewogICAgICAgIHJldHVybiB2YWwgIT0gbnVsbCA/IHBhcnNlSW50KHZhbCwgMTApIDogbnVsbDsKICAgICAgfSk7CiAgICAgIG5nTW9kZWwuJGZvcm1hdHRlcnMucHVzaChmdW5jdGlvbih2YWwpIHsKICAgICAgICByZXR1cm4gdmFsICE9IG51bGwgPyAnJyArIHZhbCA6IG51bGw7CiAgICAgIH0pOwogICAgfQogIH07Cn0pOwoKa3V6ZUFwcC5kaXJlY3RpdmUoJ2VsYXN0aWMnLCBbCiAgICAnJHRpbWVvdXQnLAogICAgZnVuY3Rpb24oJHRpbWVvdXQpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICByZXN0cmljdDogJ0EnLAogICAgICAgICAgICBsaW5rOiBmdW5jdGlvbigkc2NvcGUsIGVsZW1lbnQpIHsKICAgICAgICAgICAgICAgICRzY29wZS5pbml0aWFsSGVpZ2h0ID0gJHNjb3BlLmluaXRpYWxIZWlnaHQgfHwgZWxlbWVudFswXS5zdHlsZS5oZWlnaHQ7CiAgICAgICAgICAgICAgICB2YXIgcmVzaXplID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgZWxlbWVudFswXS5zdHlsZS5oZWlnaHQgPSAkc2NvcGUuaW5pdGlhbEhlaWdodDsKICAgICAgICAgICAgICAgICAgICBlbGVtZW50WzBdLnN0eWxlLmhlaWdodCA9ICIiICsgZWxlbWVudFswXS5zY3JvbGxIZWlnaHQgKyAicHgiOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIGVsZW1lbnQub24oImlucHV0IGNoYW5nZSIsIHJlc2l6ZSk7CiAgICAgICAgICAgICAgICAvLyBlbGVtZW50Lm9uKCJpbnB1dCBjaGFuZ2UiLCByZXNpemUpOwogICAgICAgICAgICAgICAgJHRpbWVvdXQocmVzaXplLCAwKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICB9Cl0pOwoKa3V6ZUFwcC5zZXJ2aWNlKCdzaGFyZWRQcm9wZXJ0aWVzJywgZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBzZWxlY3RlZF91c2VyID0gbnVsbDsKICAgICAgICB2YXIgY2FsZW5kYXJfZGF0ZSA9IG51bGw7CiAgICAgICAgdmFyIGV2ZW50X3Jlc2NoZWR1bGUgPSBudWxsOwogICAgICAgIHZhciBzZWxlY3RlZF9pbnN0cnVjdG9yID0gMDsKICAgICAgICB2YXIgZXZlbnRfdHlwZV9mb3Jfc3VnZ2VzdGlvbnMgPSBudWxsOwogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGdldF9zZWxlY3RlZF9pbnN0cnVjdG9yOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZWN0ZWRfaW5zdHJ1Y3RvcjsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2V0X3NlbGVjdGVkX2luc3RydWN0b3I6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgICAgICAgICBzZWxlY3RlZF9pbnN0cnVjdG9yID0gdmFsdWU7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGdldF9zZWxlY3RlZF91c2VyOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZWN0ZWRfdXNlcjsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2V0X3NlbGVjdGVkX3VzZXI6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgICAgICAgICBzZWxlY3RlZF91c2VyID0gdmFsdWU7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNldF9ldmVudF9yZXNjaGVkdWxlOiBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgICAgICAgICAgZXZlbnRfcmVzY2hlZHVsZSA9IHZhbHVlOwogICAgICAgICAgICB9LAogICAgICAgICAgICBnZXRfZXZlbnRfcmVzY2hlZHVsZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGV2ZW50X3Jlc2NoZWR1bGU7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGdldF9jYWxlbmRhcl9kYXRlOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gY2FsZW5kYXJfZGF0ZTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2V0X2NhbGVuZGFyX2RhdGU6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgICAgICAgICBjYWxlbmRhcl9kYXRlID0gdmFsdWU7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGdldF9ldmVudF90eXBlX2Zvcl9zdWdnZXN0aW9uczogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGV2ZW50X3R5cGVfZm9yX3N1Z2dlc3Rpb25zOwogICAgICAgICAgICB9LAogICAgICAgICAgICBzZXRfZXZlbnRfdHlwZV9mb3Jfc3VnZ2VzdGlvbnM6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgICAgICAgICAvLyBsb2dEZWJ1Zygic2V0X2V2ZW50X3R5cGVfZm9yX3N1Z2dlc3Rpb25zPSIrdmFsdWUpOwogICAgICAgICAgICAgICAgZXZlbnRfdHlwZV9mb3Jfc3VnZ2VzdGlvbnMgPSB2YWx1ZTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICB9KTsKCmt1emVBcHAuY29udHJvbGxlcignbWVudUNvbnRyb2xsZXInLCBbJyRzY29wZScsICckbG9jYXRpb24nLCBmdW5jdGlvbigkc2NvcGUsICRsb2NhdGlvbikgewogICAgcmV0dXJuIHRydWU7CiAgICBsb2dEZWJ1ZygiJHNjb3BlLmlzQ3VycmVudFBhdGg9IiArICRzY29wZS5pc0N1cnJlbnRQYXRoKTsKICAgICRzY29wZS5pc0N1cnJlbnRQYXRoID0gZnVuY3Rpb24ocGF0aCkgewogICAgICAgIHJldHVybiAkbG9jYXRpb24ucGF0aCgpID09IHBhdGg7CiAgICB9Owp9XSk7CgoKCmt1emVBcHAuY29udHJvbGxlcignQnVzaW5lc3NSZXBvcnRzQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbiwkcm91dGVQYXJhbXMpCnsKCiAgbG9nRGVidWcoImNvbnRyb2xsZXI6IEJ1c2luZXNzUmVwb3J0c0NvbnRyb2xsZXIiKTsKCiAgJHNjb3BlLm9yZGVyQnlGaWVsZCA9ICdzdGFydF9lcG9jaCc7CiAgJHNjb3BlLnJldmVyc2VTb3J0PXRydWU7CiAgJHNjb3BlLmV2ZW50TW9kZWw9dHJ1ZTsKCiAgZ2V0QnVzaW5lc3NMb2NhdGlvbnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19sb2NhdGlvbnMnKTsKICBnZXRBbGxCdXNpbmVzc0V2ZW50VHlwZXMoJGh0dHAsJHNjb3BlLCdldmVudF90eXBlcycpOwogIGdldEFsbEluc3RydWN0b3JzKCRodHRwLCRzY29wZSwnaW5zdHJ1Y3RvcnMnKTsKICBnZXRBbGxDbGllbnRzQW5kQXJjaGl2ZSgkaHR0cCwkc2NvcGUsJ2NsaWVudHMnKTsKICAkc2NvcGUuc3RhdHVzZXMgPSBbIHsic3RhdHVzX2lkIjoiMCIsInN0YXR1c19uYW1lIjoi16TXqteV15cifSwgeyJzdGF0dXNfaWQiOiIxIiwic3RhdHVzX25hbWUiOiLXodeS15XXqCJ9XTsKICAkc2NvcGUuY2FuY2VsbGF0aW9ucyA9IFsgeyJpc19jYW5jZWxlZCI6IjAiLCJjYW5jZWxsYXRpb25fbmFtZSI6Itec15Ag15HXldeY15wifSx7ImlzX2NhbmNlbGVkIjoiMSIsImNhbmNlbGxhdGlvbl9uYW1lIjoi15HXldeY15wifV07CiAgJHNjb3BlLm1vbnRocyA9IFsgeyJtb250aCI6IjEifSx7Im1vbnRoIjoiMiJ9LHsibW9udGgiOiIzIn0seyJtb250aCI6IjQifSx7Im1vbnRoIjoiNSJ9LHsibW9udGgiOiI2In0seyJtb250aCI6IjcifSx7Im1vbnRoIjoiOCJ9LHsibW9udGgiOiI5In0seyJtb250aCI6IjEwIn0seyJtb250aCI6IjExIn0seyJtb250aCI6IjEyIn1dOwogICRzY29wZS55ZWFycyA9IFsgeyJ5ZWFyIjoiMjAxNiJ9LHsieWVhciI6IjIwMTcifV07CiAgJHNjb3BlLnBlcmlvZHMgPSBbCiAgICAgIHsicGVyaW9kX25hbWUiOiLXlNeZ16HXmNeV16jXmSIsICJwZXJpb2Rfc2lnbiI6Ii0xIn0sCiAgICAgIHsicGVyaW9kX25hbWUiOiLXlNeZ15XXnSIsICJwZXJpb2Rfc2lnbiI6IjAifSwKICAgICAgeyJwZXJpb2RfbmFtZSI6Itei16rXmdeT15kiLCAicGVyaW9kX3NpZ24iOiIxIn0sCiAgICBdCgogICRzY29wZS5jc3ZfY29sdW1uc19vcmRlciA9IFsnZXZlbnRfdHlwZV9uYW1lJywgJ3N0YXJ0X3RpbWUnLCAnZXZlbnRfdXNlcl9jbGllbnRzJywgJ2luc3RydWN0b3JfbmFtZScsICdpc19jYW5jZWxlZCcsICdpc19jb21wbGV0ZWQnLCAnYWN0dWFsX3ByaWNlJywgJ3BhcnRpY2lwYXRlZCddOwogICRzY29wZS5jc3ZfY29sdW1uc19oZWFkZXIgPSBbJ9eh15XXkiDXntek15LXqScsICfXqteQ16jXmdeaINeV16nXoteUJywgJ9ee16nXqteq16TXmdedJywgJ9ee15PXqNeZ15onLCfXnteR15XXmNecJywgJ9eh15LXldeoJywgJ9ee15fXmdeoJywgJ9ee16nXqteq16TXmdedJ107CgoKCiAgJHNjb3BlLmdvdG9DbGllbnRQYWdlPSBmdW5jdGlvbiAoYnVzaW5lc3NVc2VyaWQpIHsKICAgIGdvdG9DbGllbnRQYWdlKGJ1c2luZXNzVXNlcmlkKTsKICB9CgogIGZ1bmN0aW9uIGxpc3RfdG9fc3RyaW5nX2J5X3ZhbHVlKHgsdmFsdWUpewogICAgaWYgKCB4ICE9IHVuZGVmaW5lZCApewogICAgICB2YXIgeDEgPSBuZXcgQXJyYXkoKTsKICAgICAgZm9yIChpID0gMDsgaSA8IHgubGVuZ3RoOyBpKyspewogICAgICAgIHgxW2ldID0geFtpXVt2YWx1ZV07CiAgICAgIH0KICAgICAgeDEgPSB4MS5qb2luKCk7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICByZXR1cm4geDE7CiAgfQoKICAkc2NvcGUucmVwb3J0X2lzX2xvYWRpbmcgPSBmYWxzZTsKCiRzY29wZS5ldmVudHNSZXBvcnQgPSBmdW5jdGlvbigpewpsb2dEZWJ1ZygiZXZlbnRzUmVwb3J0Iik7Cgokc2NvcGUuc2hvd0FnZyA9ICgkc2NvcGUuZXZlbnRUeXBlTW9kZWwpIHx8Cigkc2NvcGUuaW5zdHJ1Y3Rvck1vZGVsKSB8fCAoJHNjb3BlLm1vbnRoTW9kZWwpIHx8ICgkc2NvcGUuY2xpZW50c01vZGVsKSB8fCAoJHNjb3BlLnllYXJNb2RlbCkgOwoKZXZlbnRfdHlwZV9pZF9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuc2VsZWN0ZWRFdmVudFR5cGVGaWx0ZXIsICJldmVudF90eXBlX2lkIiApOwppbnN0cnVjdG9yX2lkX2ZpbHRlciA9IGxpc3RfdG9fc3RyaW5nX2J5X3ZhbHVlKCRzY29wZS5zZWxlY3RlZEluc3RydWN0b3JGaWx0ZXIsICJidXNpbmVzc191c2VyX2lkIiApOwptb250aF9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuc2VsZWN0ZWRNb250aEZpbHRlciwgIm1vbnRoIiApOwpjbGllbnRfZmlsdGVyID0gbGlzdF90b19zdHJpbmdfYnlfdmFsdWUoJHNjb3BlLnNlbGVjdGVkQ2xpZW50RmlsdGVyLCAiYnVzaW5lc3NfdXNlcl9pZCIgKTsKeWVhcl9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuc2VsZWN0ZWRZZWFyRmlsdGVyLCAieWVhciIgKTsKc3RhdHVzX2ZpbHRlciA9IGxpc3RfdG9fc3RyaW5nX2J5X3ZhbHVlKCRzY29wZS5zZWxlY3RlZFN0YXR1c0ZpbHRlciwgInN0YXR1c19pZCIgKTsKaXNfY2FuY2VsZWRfZmlsdGVyID0gbGlzdF90b19zdHJpbmdfYnlfdmFsdWUoJHNjb3BlLnNlbGVjdGVkSXNfY2FuY2VsZWRGaWx0ZXIsICJpc19jYW5jZWxlZCIgKTsKcGVyaW9kX2ZpbHRlciA9IGxpc3RfdG9fc3RyaW5nX2J5X3ZhbHVlKCRzY29wZS5zZWxlY3RlZFBlcmlvZEZpbHRlciwgInBlcmlvZF9zaWduIiApOwoKJHNjb3BlLmV2ZW50UmVwb3J0Q29uZmlnID0ge307CgogICAgJHNjb3BlLmV2ZW50UmVwb3J0Q29uZmlnLnNvdXJjZSA9ICJkb2NzIjsKCiRzY29wZS5ldmVudFJlcG9ydENvbmZpZy5maWx0ZXJzID0gewpldmVudF90eXBlX2lkOiBldmVudF90eXBlX2lkX2ZpbHRlciwKaW5zdHJ1Y3Rvcl9pZDogaW5zdHJ1Y3Rvcl9pZF9maWx0ZXIsCm1vbnRoOiBtb250aF9maWx0ZXIsCnllYXI6IHllYXJfZmlsdGVyLApjbGllbnQ6IGNsaWVudF9maWx0ZXIsCnN0YXR1czogc3RhdHVzX2ZpbHRlciwKcGVyaW9kOiBwZXJpb2RfZmlsdGVyLAppc19jYW5jZWxlZDogaXNfY2FuY2VsZWRfZmlsdGVyCn07Cgokc2NvcGUuZXZlbnRSZXBvcnRDb25maWcuYWdncmVnYXRpb25zID0gewpldmVudF90eXBlX2lkOiAkc2NvcGUuZXZlbnRUeXBlTW9kZWwsCmluc3RydWN0b3JfaWQ6ICRzY29wZS5pbnN0cnVjdG9yTW9kZWwsCm1vbnRoOiAkc2NvcGUubW9udGhNb2RlbCwKeWVhcjogJHNjb3BlLnllYXJNb2RlbCwKY2xpZW50OiAkc2NvcGUuY2xpZW50TW9kZWwsCn07CgppZiAoICRzY29wZS5zaG93QWdnICkgewogICAgICBnZXRFdmVudHNSZXBvcnQoJGh0dHAsJHNjb3BlLCAkc2NvcGUuZXZlbnRSZXBvcnRDb25maWcsIGdldEV2ZW50c1JlcG9ydEFnZ3JlZ2F0ZWRfc3VjY2Vzcyk7CiRzY29wZS5yZXBvcnRfaXNfbG9hZGluZyA9IHRydWU7Cn0gZWxzZSB7CiAgICAgIGdldEV2ZW50c1JlcG9ydCgkaHR0cCwkc2NvcGUsICRzY29wZS5ldmVudFJlcG9ydENvbmZpZywgZ2V0RXZlbnRzUmVwb3J0TGlzdF9zdWNjZXNzKTsKJHNjb3BlLnJlcG9ydF9pc19sb2FkaW5nID0gdHJ1ZTsKfQoKZnVuY3Rpb24gZ2V0RXZlbnRzUmVwb3J0TGlzdF9zdWNjZXNzKHJlc3BvbnNlKXsKJHNjb3BlLkV2ZW50UmVwb3J0TGlzdCA9IHJlc3BvbnNlLmpzb247CiRzY29wZS5kb3dubG9hZF9yZXBvcnQgPSAkc2NvcGVbICdFdmVudFJlcG9ydExpc3QnIF07CiRzY29wZS5yZXBvcnRfaXNfbG9hZGluZyA9IGZhbHNlOwp9CgpmdW5jdGlvbiBnZXRFdmVudHNSZXBvcnRBZ2dyZWdhdGVkX3N1Y2Nlc3MocmVzcG9uc2Upewokc2NvcGUuRXZlbnRSZXBvcnRBZ2dyZWdhdGVkID0gcmVzcG9uc2UuanNvbjsKJHNjb3BlLmRvd25sb2FkX3JlcG9ydCA9ICRzY29wZVsgJ0V2ZW50UmVwb3J0QWdncmVnYXRlZCcgXTsKJHNjb3BlLnJlcG9ydF9pc19sb2FkaW5nID0gZmFsc2U7Cn0KCmZ1bmN0aW9uIGdldENsaWVudHNSZXBvcnRMaXN0X3N1Y2Nlc3MocmVzcG9uc2Upewokc2NvcGUuQ2xpZW50c1JlcG9ydExpc3QgPSByZXNwb25zZS5qc29uOwpjb25zb2xlLmxvZygiLS0tLS0tLS0tLS0tIikKY29uc29sZS5sb2coJHNjb3BlLkNsaWVudHNSZXBvcnRMaXN0KQpjb25zb2xlLmxvZygiLS0tLS0tLS0tLS0tIikKJHNjb3BlLnJlcG9ydF9pc19sb2FkaW5nID0gZmFsc2U7Cn0KCgp9Cgokc2NvcGUuY2xpZW50c1JlcG9ydCA9IGZ1bmN0aW9uKCl7CmxvZ0RlYnVnKCJjbGllbnRzUmVwb3J0Iik7CgpjbGllbnRfZmlsdGVyID0gbGlzdF90b19zdHJpbmdfYnlfdmFsdWUoJHNjb3BlLnNlbGVjdGVkQ2xpZW50RmlsdGVyLCAiY2xpZW50IiApOwoKJHNjb3BlLmV2ZW50UmVwb3J0Q29uZmlnID0ge307Cgokc2NvcGUuZXZlbnRSZXBvcnRDb25maWcuZmlsdGVycyA9IHsKY2xpZW50OiBjbGllbnRfZmlsdGVyLAp9OwoKJHNjb3BlLmV2ZW50UmVwb3J0Q29uZmlnLmFnZ3JlZ2F0aW9ucyA9IHsKfTsKCmdldENsaWVudHNSZXBvcnQoJGh0dHAsJHNjb3BlLCBnZXRDbGllbnRzUmVwb3J0X3N1Y2Nlc3MpOwokc2NvcGUucmVwb3J0X2lzX2xvYWRpbmcgPSB0cnVlOwpmdW5jdGlvbiBnZXRDbGllbnRzUmVwb3J0X3N1Y2Nlc3MocmVzcG9uc2Upewokc2NvcGUuY2xpZW50UmVwb3J0ID0gcmVzcG9uc2UuanNvbjsKJHNjb3BlLmRvd25sb2FkX3JlcG9ydCA9ICRzY29wZVsgJ2NsaWVudFJlcG9ydCcgXTsKJHNjb3BlLnJlcG9ydF9pc19sb2FkaW5nID0gZmFsc2U7Cn0KfQoKJHNjb3BlLmVkaXRFdmVudD0gZnVuY3Rpb24gKHRoZWV2ZW50KQp7CmdvdG9FdmVudFBhZ2UodGhlZXZlbnQpOwp9Cgokc2NvcGUuZXZlbnRzUmVwb3J0KCk7CiRzY29wZS5zZWxlY3RlZFJlcG9ydD0iZXZlbnRzIjsKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2J1c2luZXNzX3BhY2thZ2VzX3VwZGF0ZV9jbnRsJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uLCRyb3V0ZVBhcmFtcykKewokc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyID0ge307IC8vIHRoZXNlIGFyZSB0aGUgY29tcGxldGUgZGV0YWlscyBmb3IgdGhlIG5ldyBldmVudCAvLwokc2NvcGUucGFja2FnZV9pc191cGRhdGUgPSB0cnVlOwokc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLnBhY2thZ2VfbGltaXRfdHlwZT0xOwoKLy8gZ2V0dHRpbmcgdGhlIHBhY2thZ2UgYW5kIGl0cyBldmVudCB0eXBlcwpnZXRCdXNpbmVzc1BhY2thZ2UoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5wYWNrYWdlX2lkLCdmb3JtQWRkUGFja2FnZUFuZ3VsYXInLGZ1bmN0aW9uKHJlc3BvbnNlKQp7CiRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuaXNfdXBkYXRlID0gdHJ1ZTsKJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5vcmlnRXZlbnRUeXBlcz1hbmd1bGFyLmNvcHkoJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5zZWxlY3RlZEV2ZW50VHlwZXMpOwokc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLnBhY2thZ2VfbGltaXRfdHlwZT0xOwovLyB0aGVuIGdldHRpbmcgYWxsIHRoZSBldmVudCB0eXBlcwpnZXRFdmVudFR5cGVzTm9BZG1pbigkaHR0cCwkc2NvcGUsJ3JlbGF0ZWRFdmVudFR5cGVzJyxnZXRFdmVudFR5cGVzTm9BZG1pbl9zdWNjZXNzKTsKZnVuY3Rpb24gZ2V0RXZlbnRUeXBlc05vQWRtaW5fc3VjY2VzcygpCnsKLy8gdGhlbiByZW1vdmluZyBleGlzdGluZyBldmVudCB0eXBlcyBvZiBwYWNrYWdlIGZyb20gbGlzdAovLyBjb25zb2xlLmxvZygkc2NvcGUucmVsYXRlZEV2ZW50VHlwZXNbMF0pOwovLyBjb25zb2xlLmxvZygkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLnNlbGVjdGVkRXZlbnRUeXBlc1swXSk7CmZvcih2YXIgaSA9IDA7IGkgPCAkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLnNlbGVjdGVkRXZlbnRUeXBlcy5sZW5ndGg7IGkrKykKewovLyBjb3B5aW5nIHRoZSBhY3R1YWwgb2JqZWN0IG9mICRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuc2VsZWN0ZWRFdmVudFR5cGVzW2ldCmZvcih2YXIgaiA9IDA7IGogPCAkc2NvcGUucmVsYXRlZEV2ZW50VHlwZXMubGVuZ3RoOyBqKyspCnsKaWYgKCRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuc2VsZWN0ZWRFdmVudFR5cGVzW2ldLmV2ZW50X3R5cGVfaWQ9PSRzY29wZS5yZWxhdGVkRXZlbnRUeXBlc1tqXS5ldmVudF90eXBlX2lkKQp7CiRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuc2VsZWN0ZWRFdmVudFR5cGVzW2ldPWFuZ3VsYXIuY29weSgkc2NvcGUucmVsYXRlZEV2ZW50VHlwZXNbal0pOwp9Cn0KfQp9Cn0pOwokc2NvcGUuZ290b0JhY2sgPSBnb3RvQmFjazsKJHNjb3BlLmNyZWF0ZVBhY2thZ2UgPSBmdW5jdGlvbigpCnsKY29uc29sZS5sb2coInVwZGF0ZVBhY2thZ2VEZXRhaWxzIik7CnVwZGF0ZVBhY2thZ2VEZXRhaWxzKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMucGFja2FnZV9pZCwkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLHN1Y2Nlc3NfY2FsbGJhY2ssIGZhaWx1cmVfY2FsbGJhY2spOwpmdW5jdGlvbiBzdWNjZXNzX2NhbGxiYWNrKCkKewpnb3RvQmFjaygpOwp9CmZ1bmN0aW9uIGZhaWx1cmVfY2FsbGJhY2soKQp7CmdvdG9CYWNrKCk7Cn0KfTsKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2J1c2luZXNzX3BhY2thZ2VzX2FkZF9jbnRsJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uKSB7CmxvZ0RlYnVnKCdidXNpbmVzc19wYWNrYWdlc19hZGRfY250bCcpOwokc2NvcGUucGFja2FnZV9pc191cGRhdGUgPSBmYWxzZTsKJHNjb3BlLmdvdG9CYWNrID0gZ290b0JhY2s7CiRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIgPSB7fTsKJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5ldmVudHNfY291bnRlciA9IDE7CiRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuZXZlbnRzX3Blcl93ZWVrID0gMTsKJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5wYWNrYWdlX2R1cmF0aW9uX21vbnRocyA9IDM7CiRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIucGFja2FnZV9saW1pdF90eXBlPTE7CmdldEV2ZW50VHlwZXNOb0FkbWluKCRodHRwLCRzY29wZSwncmVsYXRlZEV2ZW50VHlwZXMnKTsKCiRzY29wZS5jcmVhdGVQYWNrYWdlID0gZnVuY3Rpb24oKQp7CmNyZWF0ZVBhY2thZ2UoJGh0dHAsJHNjb3BlLCRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIsY3JlYXRlUGFja2FnZV9zdWNjZXNzLCBjcmVhdGVQYWNrYWdlX2ZhaWx1cmUpOwpmdW5jdGlvbiBjcmVhdGVQYWNrYWdlX3N1Y2Nlc3MoKQp7CiRsb2NhdGlvbi5wYXRoKCcvcGFja2FnZXMnKTsKfQpmdW5jdGlvbiBjcmVhdGVQYWNrYWdlX2ZhaWx1cmUoKQp7Ci8vIGxvZ0Vycm9yKCJlcnJvciAiICsgZGF0YS5tZXNzYWdlKTsKLy8gJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5hamF4X2Vycm9yID0gZGF0YS5tZXNzYWdlOwp9Cn0KfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2J1c2luZXNzX2xvY2F0aW9ucycsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikgewpsb2dEZWJ1ZygnYnVzaW5lc3NfbG9jYXRpb25zIGNvbnRyb2xsZXInKTsKZ2V0QnVzaW5lc3NMb2NhdGlvbnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19sb2NhdGlvbnMnKTsKJHNjb3BlLmFkZE5ld0xvY2F0aW9uID0gZnVuY3Rpb24gKCkKewokbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2xvY2F0aW9ucy9hZGQnKTsKfQokc2NvcGUuZ290b0xvY2F0aW9uUGFnZSA9IGZ1bmN0aW9uKGxvY2F0aW9uX2lkKQp7CmdvdG9Mb2NhdGlvblBhZ2UobG9jYXRpb25faWQpOwp9Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignQnVzaW5lc3NEb2NzQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikgewpsb2dEZWJ1ZygnQnVzaW5lc3NEb2NzQ29udHJvbGxlcicpOwp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ2J1c2luZXNzX2xvY2F0aW9uc191cGRhdGUnLCBmdW5jdGlvbigkc2NvcGUsICRyb3V0ZVBhcmFtcywgJGh0dHAsICRsb2NhdGlvbikgewpsb2dEZWJ1ZygnYnVzaW5lc3NfbG9jYXRpb25zX3VwZGF0ZSBjb250cm9sbGVyJyk7CiRzY29wZS5pc191cGRhdGU9dHJ1ZTsKLy8gZ2V0QnVzaW5lc3NMb2NhdGlvbnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19sb2NhdGlvbnMnKTsKZ2V0QnVzaW5lc3NMb2NhdGlvbigkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmxvY2F0aW9uX2lkLCdjdXJyX2xvY2F0aW9uJyxnZXRCdXNpbmVzc0xvY2F0aW9uX3N1Y2Nlc3MpOwpmdW5jdGlvbiBnZXRCdXNpbmVzc0xvY2F0aW9uX3N1Y2Nlc3MoKQp7CiRzY29wZS5mb3JtQWRkTG9jYXRpb25Bbmd1bGFyPSRzY29wZS5jdXJyX2xvY2F0aW9uWzBdOwp9CgoKJHNjb3BlLmFkZExvY2F0aW9uID0gZnVuY3Rpb24oKQp7Ci8vIGluIHRoaXMgY2FzZSAtIHVwZGF0ZSBsb2NhdGlvbgp0aGVkYXRhID0gJHNjb3BlLmZvcm1BZGRMb2NhdGlvbkFuZ3VsYXI7CgpmdW5jdGlvbiBhZGRMb2NhdGlvbl9zdWNjZXNzKCkKewokbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2xvY2F0aW9ucycpOwp9CmZ1bmN0aW9uIGFkZExvY2F0aW9uX2ZhaWx1cmUoKQp7CiRzY29wZS5mb3JtQWRkTG9jYXRpb25Bbmd1bGFyLmFqYXhfZXJyb3IgPSByZXNwb25zZS5tZXNzYWdlOwp9CnVwZGF0ZUxvY2F0aW9uKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMubG9jYXRpb25faWQsIHRoZWRhdGEsYWRkTG9jYXRpb25fc3VjY2VzcyxhZGRMb2NhdGlvbl9mYWlsdXJlKTsKfQp9KTsKCmt1emVBcHAuY29udHJvbGxlcignYnVzaW5lc3NfbG9jYXRpb25zX2FkZCcsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikgewpsb2dEZWJ1ZygnYnVzaW5lc3NfbG9jYXRpb25zX2FkZCBjb250cm9sbGVyJyk7CmdldEJ1c2luZXNzTG9jYXRpb25zKCRodHRwLCRzY29wZSwnYnVzaW5lc3NfbG9jYXRpb25zJyk7CiRzY29wZS5pc191cGRhdGU9ZmFsc2U7Cgokc2NvcGUuYWRkTG9jYXRpb24gPSBmdW5jdGlvbigpCnsKdGhlZGF0YSA9ICRzY29wZS5mb3JtQWRkTG9jYXRpb25Bbmd1bGFyOwoKZnVuY3Rpb24gYWRkTG9jYXRpb25fc3VjY2VzcygpCnsKJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19sb2NhdGlvbnMnKTsKfQpmdW5jdGlvbiBhZGRMb2NhdGlvbl9mYWlsdXJlKCkKewokc2NvcGUuZm9ybUFkZExvY2F0aW9uQW5ndWxhci5hamF4X2Vycm9yID0gcmVzcG9uc2UubWVzc2FnZTsKfQphZGRMb2NhdGlvbigkaHR0cCwkc2NvcGUsdGhlZGF0YSxhZGRMb2NhdGlvbl9zdWNjZXNzLGFkZExvY2F0aW9uX2ZhaWx1cmUpOwp9Cn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdJbnN0cnVjdG9yc0FkZENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkbG9jYXRpb24pIHsKbG9nRGVidWcoJ0luc3RydWN0b3JzQWRkQ29udHJvbGxlcicpOwokc2NvcGUuaXNJbnN0cnVjdG9yPXRydWU7CiRzY29wZS51c2VydHlwZT0iaW5zdHJ1Y3RvciI7CiRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhciA9IHt9Owokc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIuaXNfdXBkYXRlPWZhbHNlOwokc2NvcGUuYWRkQ2xpZW50ID0gZnVuY3Rpb24oKSAvLyBhZGQgaW5zdHJ1Y3RvciwgdXNpbmcgdGhlIHNhbWUgZnVuY3Rpb24gbmFtZSBhcyB3ZSB1c2UgdGhlIHNhbWUgc2NyZWVuCnsKdGhlZGF0YSA9ICRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhcjsKCmZ1bmN0aW9uIGFkZEluc3RydWN0b3Jfc3VjY2VzcygpCnsKJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19pbnN0cnVjdG9ycycpOwp9CmZ1bmN0aW9uIGFkZENsaWVudF9mYWlsdXJlKCkKewokc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIuYWpheF9lcnJvciA9IHJlc3BvbnNlLm1lc3NhZ2U7Cn0KYWRkSW5zdHJ1Y3RvcigkaHR0cCwkc2NvcGUsdGhlZGF0YSxhZGRJbnN0cnVjdG9yX3N1Y2Nlc3MpOwp9Cn0pOwprdXplQXBwLmNvbnRyb2xsZXIoJ0NsaWVudHNBZGRDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJHRpbWVvdXQsICRsb2NhdGlvbiwgc2hhcmVkUHJvcGVydGllcykgewpsb2dEZWJ1ZygnQ2xpZW50c0FkZENvbnRyb2xsZXIgLSBUaGlzIGlzIEFkZCBuZXcgY2xpZW50IHNjcmVlbicpOwokc2NvcGUuaXNJbnN0cnVjdG9yPWZhbHNlOwoKJHNjb3BlLnVzZXJ0eXBlPSJlbmR1c2VyIjsKJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyID0ge307CiRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5pc191cGRhdGU9ZmFsc2U7CiRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5kaXNhYmxlX3Bob25lX2VkaXRpbmc9ZmFsc2U7CgppZiAoKCRzY29wZS5maWx0ZXIuVmFsdWUgIT0gIiIpICYmICh0eXBlb2YgJHNjb3BlLmZpbHRlci5WYWx1ZSAhPSAndW5kZWZpbmVkJykpIHsKbG9nRGVidWcoImNsaWVudHMgZmlsdGVyIGlzIG5vdCBlbXB0eSIpOwp2YXIgZmlsdGVyID0gU3RyaW5nKCRzY29wZS5maWx0ZXIuVmFsdWUpOwppZiAoZmlsdGVyLmluZGV4T2YoIiAiKSA+IDApIHsKJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyLmZpcnN0X25hbWUgPSBmaWx0ZXIuc3Vic3RyKDAsIGZpbHRlci5pbmRleE9mKCIgIikpOwokc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIubGFzdF9uYW1lID0gZmlsdGVyLnN1YnN0cigxICsgZmlsdGVyLmluZGV4T2YoIiAiKSk7Cn0gZWxzZSB7CiRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5maXJzdF9uYW1lID0gZmlsdGVyOwokc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIubGFzdF9uYW1lID0gIiI7Cn0KJHNjb3BlLmZpbHRlci5WYWx1ZSA9ICIiOwokc2NvcGUuZmlsdGVyLmJ1dHRvblZhbHVlID0gIiI7Cn0gZWxzZSB7Cn0KCiRzY29wZS5nb3RvQmFjayA9IGZ1bmN0aW9uKCkKewokbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2NsaWVudHMnKTsKfQoKJHNjb3BlLmFkZENsaWVudCA9IGZ1bmN0aW9uKCkKewp0aGVkYXRhID0gJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyOwoKZnVuY3Rpb24gYWRkQ2xpZW50X3N1Y2Nlc3ModXNlcl9pZCkKewppZiAoJHNjb3BlLnNhdmVfYW5kX3NjaGVkdWxlKQp7Ci8vICRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfY2xpZW50cy8nK3VzZXJfaWQuanNvbik7CmxvZ0RlYnVnKCJORVcgdXNlciB1c2VyX2lkPSIrdXNlcl9pZC5qc29uKTsKCnVzZXJfaW5mbz0gewpidXNpbmVzc191c2VyX2lkOiB1c2VyX2lkLmpzb24sCmJ1c2VyX2ZpcnN0X25hbWU6ICRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5idXNlcl9maXJzdF9uYW1lLApidXNlcl9sYXN0X25hbWU6ICRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5idXNlcl9sYXN0X25hbWUKfTsKCnNoYXJlZFByb3BlcnRpZXMuc2V0X3NlbGVjdGVkX3VzZXIodXNlcl9pbmZvKTsKJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jYWxlbmRhcicpOwoKfQplbHNlCnsKJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jbGllbnRzLycpOwp9CmNvbnNvbGUubG9nKCJuZXcgdXNlciBpZCA9ICIrdXNlcl9pZC5qc29uKTsKfQpmdW5jdGlvbiBhZGRDbGllbnRfZmFpbHVyZShyZXNwb25zZSkKewokc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIuYWpheF9lcnJvciA9IHJlc3BvbnNlLm1lc3NhZ2U7CiR0aW1lb3V0KGZ1bmN0aW9uKCkKewokc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIuYWpheF9lcnJvcj1udWxsOwp9LCAyNTAwKTsKfQphZGRDbGllbnQoJGh0dHAsJHNjb3BlLHRoZWRhdGEsYWRkQ2xpZW50X3N1Y2Nlc3MsIGFkZENsaWVudF9mYWlsdXJlLGZhbHNlKTsKfQp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ1BhY2thZ2VzQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikgewpsb2dEZWJ1ZygnUGFja2FnZXNDb250cm9sbGVyJyk7CmdldEJ1c2luZXNzUGFja2FnZXMoJGh0dHAsJHNjb3BlLCdwYWNrYWdlcycpOwoKJHNjb3BlLnNob3dQYWNrYWdlID0gZnVuY3Rpb24gKHRoZXBhY2thZ2UpCnsKJGxvY2F0aW9uLnBhdGgoJy9wYWNrYWdlcy8nK3RoZXBhY2thZ2UucGFja2FnZV9pZCk7Cn0KfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdJbnN0cnVjdG9yc1Nob3dDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uKSB7CmxvZ0RlYnVnKCdJbnN0cnVjdG9yc1Nob3dDb250cm9sbGVyJyk7CiRzY29wZS5vcmRlckJ5RmllbGQgPSAnYnVzZXJfc3RhcnRfZGF0ZSc7CiRzY29wZS5yZXZlcnNlU29ydD10cnVlOwoKZ2V0QWxsSW5zdHJ1Y3RvcnMoJGh0dHAsJHNjb3BlLCdhbGxDbGllbnRzJyxnZXRBbGxJbnN0cnVjdG9yc19zdWNjZXNzKTsKZnVuY3Rpb24gZ2V0QWxsSW5zdHJ1Y3RvcnNfc3VjY2VzcygpCnsKJHNjb3BlLnNob3dDbGllbnRzR3JpZE9wdGlvbnMuZGF0YT0kc2NvcGUuYWxsQ2xpZW50czsKfQoKJHNjb3BlLmdvdG9JbnN0cnVjdG9yUGFnZT0gZnVuY3Rpb24gKGJ1c2luZXNzX3VzZXJfaWQpCnsKZ290b0luc3RydWN0b3JQYWdlKGJ1c2luZXNzX3VzZXJfaWQpOwp9Cgokc2NvcGUuY2xpZW50TmFtZUZpbHRlcj0iIjsKJHNjb3BlLmlucHV0RmlsdGVyID0gZnVuY3Rpb24gKGl0ZW0pCnsKLy8gY29uc29sZS5sb2coaXRlbS5idXNlcl9waG9uZV9udW1iZXIpOwpyZXR1cm4gZmlsdGVyX2ZpcnN0bGFzdF9uYW1lKGl0ZW0uYnVzZXJfZmlyc3RfbmFtZSxpdGVtLmJ1c2VyX2xhc3RfbmFtZSxpdGVtLmJ1c2VyX3Bob25lX251bWJlciwkc2NvcGUuY2xpZW50TmFtZUZpbHRlcik7Cn07Cn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdDbGllbnRzU2hvd0NvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICR1aWJNb2RhbCwgJGh0dHAsICRsb2NhdGlvbikgewpsb2dEZWJ1ZygnQ2xpZW50c1Nob3dDb250cm9sbGVyJyk7CiRzY29wZS5vcmRlckJ5RmllbGQgPSAnYnVzZXJfc3RhcnRfZGF0ZSc7CiRzY29wZS5yZXZlcnNlU29ydD10cnVlOwoKZ2V0QWxsQ2xpZW50cygkaHR0cCwkc2NvcGUsJ2FsbENsaWVudHMnLGdldENsaWVudF9zdWNjZXNzKTsKZnVuY3Rpb24gZ2V0Q2xpZW50X3N1Y2Nlc3MoKQp7CiRzY29wZS5zaG93Q2xpZW50c0dyaWRPcHRpb25zLmRhdGE9JHNjb3BlLmFsbENsaWVudHM7Cn0KCiRzY29wZS5nb3RvQ2xpZW50UGFnZT0gZnVuY3Rpb24gKGJ1c2luZXNzVXNlcmlkKQp7CmdvdG9DbGllbnRQYWdlKGJ1c2luZXNzVXNlcmlkKTsKfQoKLy8gZmlsdGVyIGFyY2hpdmVkIGNsaWVudHMKJHNjb3BlLnNob3dBcmNoaXZlZENoZWNrYm94PWZhbHNlOwokc2NvcGUuc2hvd0FyY2hpdmVkID0gZnVuY3Rpb24gKGVjbGllbnQpCnsKaWYgKGVjbGllbnQuaXNfYWN0aXZlPT0wKQp7CmxvZ0RlYnVnKGVjbGllbnQpOwppZiAoJHNjb3BlLnNob3dBcmNoaXZlZENoZWNrYm94KQp7CnJldHVybiBlY2xpZW50Owp9Cn0KZWxzZSB7CnJldHVybiBlY2xpZW50Owp9Cn07Cgokc2NvcGUuY2xpZW50TmFtZUZpbHRlcj0iIjsKJHNjb3BlLmlucHV0RmlsdGVyID0gZnVuY3Rpb24gKGl0ZW0pCnsKICAgICAgLy8gY29uc29sZS5sb2coImNsaWVudE5hbWVGaWx0ZXIiKTsKcmV0dXJuIGZpbHRlcl9maXJzdGxhc3RfbmFtZShpdGVtLmJ1c2VyX2ZpcnN0X25hbWUsaXRlbS5idXNlcl9sYXN0X25hbWUsaXRlbS5idXNlcl9waG9uZV9udW1iZXIsJHNjb3BlLmNsaWVudE5hbWVGaWx0ZXIpOwp9OwoKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXM9W107Ci8vICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzID0gWwovLyAgIHsiZmllbGRfaWQiOjAsImZpZWxkX25hbWUiOiLXqteQ16jXmdeaINec15nXk9eUIiwiZmllbGRfZGF0YXR5cGUiOiJEQVRFIiwiaXNfbWFuZGF0b3J5IjowLCAiZnJvbWRiIjogZmFsc2UsICJkYl9pZF90b2ZpeCI6IDAsICJpc19hY3RpdmUiOiAxLCAibW9kaWZpZWQiOiBmYWxzZX0sCi8vICAgeyJmaWVsZF9pZCI6MCwiZmllbGRfbmFtZSI6IteU16LXqNeV16oiLCJmaWVsZF9kYXRhdHlwZSI6IlRFWFRfQVJFQSIsImlzX21hbmRhdG9yeSI6MCwgImZyb21kYiI6IGZhbHNlLCAiZGJfaWRfdG9maXgiOiAwLCAiaXNfYWN0aXZlIjogMSwgIm1vZGlmaWVkIjogZmFsc2V9Ci8vIF07CgpmdW5jdGlvbiBnZXRDbGllbnRzRXh0cmFGaWVsZHNfc3VjY2VzcygpCnsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMgPSAkc2NvcGUuZXh0cmFGaWVsZHM7Cn0KZ2V0Q2xpZW50c0V4dHJhRmllbGRzKCRodHRwLCRzY29wZSwnZXh0cmFGaWVsZHMnLGdldENsaWVudHNFeHRyYUZpZWxkc19zdWNjZXNzKTsKCiRzY29wZS5ldmVudFR5cGVFeHRyYUZpZWxkc1BvcCA9IGZ1bmN0aW9uKGV2ZW50VHlwZVByb3BlcnRpZXMpIHsKICAgICAgICBsb2dEZWJ1ZygiZXZlbnRUeXBlRXh0cmFGaWVsZHNQb3AzIik7Cgp2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKYW5pbWF0aW9uOiBmYWxzZSwKdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfY2xpZW50X2V4dHJhX2ZpZWxkcy5waHAnLApjb250cm9sbGVyOiAnZXZlbnRUeXBlRXh0cmFGaWVsZHNNb2RhbENvbnRyb2xsZXInLApzaXplOiAnbCcsCnJlc29sdmU6IHsKZXZlbnRUeXBlUHJvcGVydGllczogZnVuY3Rpb24oKSB7CnJldHVybiBldmVudFR5cGVQcm9wZXJ0aWVzOwp9Cn0KfSk7Cgptb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHNlbGVjdGVkSXRlbSkgewpsb2dEZWJ1ZyhzZWxlY3RlZEl0ZW0pOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyA9IHNlbGVjdGVkSXRlbTsKfSwgZnVuY3Rpb24oKSB7CmxvZ0RlYnVnKCdNb2RhbCBkaXNtaXNzZWQgYXQ6ICcgKyBuZXcgRGF0ZSgpKTsKfSk7Cn07Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignc2NoZWR1bGVyQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRyb3V0ZVBhcmFtcykgewpldmVudF90eXBlX2lkPSRyb3V0ZVBhcmFtcy5ldmVudF90eXBlX2lkOwoKJHNjb3BlLnN1Z2dlc3Rpb25EYXRlID0gW107CiRzY29wZS5zdWdnZXN0aW9uRGF0ZS5kYXRlID0gbmV3IERhdGUoKTsKJHNjb3BlLnN1Z2dlc3Rpb25EYXRlLm9wdGlvbnMgPSB7Ci8vIG1pbkRhdGU6IG5ldyBEYXRlKCksCi8vIHNob3dXZWVrczogdHJ1ZSwKbWluVmlldzonZGF5JywKc3RhcnRWaWV3OiAnZGF5JwoKfTsKdmFyIHRoZXRpbWUgPSBuZXcgRGF0ZSgpOwokc2NvcGUuZmlsdGVyQWxsRGF5c0NoZWNrYm94PXRydWU7CiRzY29wZS5maWx0ZXJEYXlJdGVtcyA9IHsKCifXqNeQ16nXldefJzogdHJ1ZSwKJ9ep16DXmSc6IHRydWUsCifXqdec15nXqdeZJzogdHJ1ZSwKJ9eo15HXmdei15knOiB0cnVlLAon15fXnteZ16nXmSc6IHRydWUsCifXqdeZ16nXmSc6IHRydWUsCifXqdeR16onOiB0cnVlCn07Cgokc2NvcGUub25UaW1lU2V0ID0gZnVuY3Rpb24gKG5ld0RhdGUsIG9sZERhdGUpIHsKbG9nRGVidWcoIm5ldyBkYXRlICIrbmV3RGF0ZS5nZXRUaW1lKCkgKyAiIG9sZCBkYXRlICIrb2xkRGF0ZS5nZXRUaW1lKCkpOwpkaWZmPW5ld0RhdGUuZ2V0VGltZSgpLW9sZERhdGUuZ2V0VGltZSgpOwovLyBpZiBuZXcgZGF0ZSBpcyBpbiBhIGRpZmZlcmVudCB3ZWVrCi8vIHdlIHJlZmV0Y2ggc3VnZ2VzdGlvbnMgZm9yIHRoZSBjdXJyZW50IHdlZWsKdmFyIG5ld0RhdGVXID0gbmV3IERhdGUobmV3RGF0ZSk7CnZhciBvbGREYXRlVyA9IG5ldyBEYXRlKG9sZERhdGUpOwovLyBhbGVydChuZXdEYXRlVy5mb3JtYXQoJ1cnKSk7Ci8vIGFsZXJ0KG9sZERhdGVXLmZvcm1hdCgnVycpKTsKaWYgKG5ld0RhdGVXLmZvcm1hdCgnVycpIT1vbGREYXRlVy5mb3JtYXQoJ1cnKSkKewpsb2dEZWJ1ZygiZGlmZiBpcyBhIHdlZWsgb3IgbW9yZSwgcmVmZXRjaGluZyBzdWdnZXN0aW9ucyIpOwokaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3QvIitldmVudF90eXBlX2lkKyIvIituZXdEYXRlLmdldEZ1bGxZZWFyKCkrIi8iKyhuZXdEYXRlLmdldE1vbnRoKCkrMSkrIi8iK25ld0RhdGUuZ2V0RGF0ZSgpKyIvIituZXdEYXRlLmdldEhvdXJzKCkgKyAiLyIgKyBuZXdEYXRlLmdldE1pbnV0ZXMoKSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkgewovLwkgICAgJHNjb3BlLm15RGF0YSA9IHJlc3BvbnNlLmRhdGE7Ci8vCQlsb2dEZWJ1ZygiZ3JpZG9wdGlvbnM9Iiskc2NvcGUuZ3JpZE9wdGlvbnMpOwokc2NvcGUuZXZlbnRzU3VnZ2VzdGVkID0gcmVzcG9uc2UuZGF0YTsKfSk7Cgp9Cn0KCiRzY29wZS5vcHRpb25zID0gewpjdXN0b21DbGFzczogZ2V0RGF5Q2xhc3MsCm1pbkRhdGU6IG5ldyBEYXRlKCksCnNob3dXZWVrczogdHJ1ZQp9Owokc2NvcGUuZHQgPSBuZXcgRGF0ZSgpOwoKCmZ1bmN0aW9uIGdldERheUNsYXNzKGRhdGEpIHsKcmV0dXJuICcnOwp9Cgokc2NvcGUuZGF5c0l0ZW1zID0gWwp7bmFtZTon16jXkNep15XXnyd9LAp7bmFtZTon16nXoNeZJ30sCntuYW1lOifXqdec15nXqdeZJ30sCntuYW1lOifXqNeR15nXoteZJ30sCntuYW1lOifXl9ee15nXqdeZJ30sCntuYW1lOifXqdeZ16nXmSd9LAp7bmFtZTon16nXkdeqJ30KXTsKCiRzY29wZS5maWx0ZXJBbGxEYXlJdGVtc1NldCA9IGZ1bmN0aW9uICgpCnsKJHNjb3BlLmZpbHRlckRheUl0ZW1zWyfXqNeQ16nXldefJ109JHNjb3BlLmZpbHRlckFsbERheXNDaGVja2JveDsKJHNjb3BlLmZpbHRlckRheUl0ZW1zWyfXqdeg15knXT0kc2NvcGUuZmlsdGVyQWxsRGF5c0NoZWNrYm94Owokc2NvcGUuZmlsdGVyRGF5SXRlbXNbJ9ep15zXmdep15knXT0kc2NvcGUuZmlsdGVyQWxsRGF5c0NoZWNrYm94Owokc2NvcGUuZmlsdGVyRGF5SXRlbXNbJ9eo15HXmdei15knXT0kc2NvcGUuZmlsdGVyQWxsRGF5c0NoZWNrYm94Owokc2NvcGUuZmlsdGVyRGF5SXRlbXNbJ9eX157Xmdep15knXT0kc2NvcGUuZmlsdGVyQWxsRGF5c0NoZWNrYm94Owokc2NvcGUuZmlsdGVyRGF5SXRlbXNbJ9ep15nXqdeZJ109JHNjb3BlLmZpbHRlckFsbERheXNDaGVja2JveDsKJHNjb3BlLmZpbHRlckRheUl0ZW1zWyfXqdeR16onXT0kc2NvcGUuZmlsdGVyQWxsRGF5c0NoZWNrYm94Owp9Cgokc2NvcGUuc3VnZ2VzdEZpbHRlckRheXMgPSBmdW5jdGlvbiAoZXN1Z2dlc3QpCnsKLy8gbG9nRGVidWcoZXN1Z2dlc3QpOwppZiAoKCRzY29wZS5maWx0ZXJEYXlJdGVtc1tlc3VnZ2VzdC5zdGFydF9mb3JtYXRfZG93XSkgJiAoKCRzY29wZS5zdWdnZXN0aW9uRGF0ZS5kYXRlLmdldFRpbWUoKS8xMDAwKTxlc3VnZ2VzdC5zdGFydF9lcG9jaCkpCnsKcmV0dXJuIGVzdWdnZXN0Owp9Cn07Cgpsb2dEZWJ1Zygnc2NoZWR1bGVyQ29udHJvbGxlciBmb3IgZXZlbnQgdHlwZSBpZCAnK2V2ZW50X3R5cGVfaWQrIiAiK3RoZXRpbWUuZ2V0SG91cnMoKSArICI6IiArIHRoZXRpbWUuZ2V0TWludXRlcygpICsgIjoiICsgdGhldGltZS5nZXRTZWNvbmRzKCkpOwokaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3QvIitldmVudF90eXBlX2lkKyIvIit0aGV0aW1lLmdldEZ1bGxZZWFyKCkrIi8iKyh0aGV0aW1lLmdldE1vbnRoKCkrMSkrIi8iK3RoZXRpbWUuZ2V0RGF0ZSgpKyIvIit0aGV0aW1lLmdldEhvdXJzKCkgKyAiLyIgKyB0aGV0aW1lLmdldE1pbnV0ZXMoKSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkgewovLwkgICAgJHNjb3BlLm15RGF0YSA9IHJlc3BvbnNlLmRhdGE7Ci8vCQlsb2dEZWJ1ZygiZ3JpZG9wdGlvbnM9Iiskc2NvcGUuZ3JpZE9wdGlvbnMpOwokc2NvcGUuZXZlbnRzU3VnZ2VzdGVkID0gcmVzcG9uc2UuZGF0YTsKfSk7CgokaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRfdHlwZXMvIitldmVudF90eXBlX2lkKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7Ci8vCSAgICAkc2NvcGUubXlEYXRhID0gcmVzcG9uc2UuZGF0YTsKLy8JCWxvZ0RlYnVnKCJncmlkb3B0aW9ucz0iKyRzY29wZS5ncmlkT3B0aW9ucyk7CiRzY29wZS5ldmVudFR5cGVEZXRhaWxzID0gcmVzcG9uc2UuZGF0YTsKfSk7Cn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdjb250YWN0Q29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHApIHsKbG9nRGVidWcoJ2NvbnRhY3RDb250cm9sbGVyJyk7Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcigncGFja2FnZVBheW1lbnRBc3NvY2lhdGlvbk1vZGFsQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHJvdXRlUGFyYW1zLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIGZwYWNrYWdlLCBiYWxhbmNlLCBidXNpbmVzc191c2VyX2lkLCB1aUNhbGVuZGFyQ29uZmlnKQp7CmxvZ0RlYnVnKCJwYWNrYWdlUGF5bWVudEFzc29jaWF0aW9uTW9kYWxDb250cm9sbGVyIik7Cgokc2NvcGUuZnBhY2thZ2U9ZnBhY2thZ2U7CiRzY29wZS5iYWxhbmNlPWJhbGFuY2U7CiRzY29wZS5wYWNrYWdlX3BheW1lbnRzPSRzY29wZS5mcGFja2FnZS5wYWNrYWdlX3BheW1lbnRzOwokc2NvcGUucHJldmlvdXNfaXNfYWxsX3BhaWQ9JHNjb3BlLmZwYWNrYWdlLmlzX2FsbF9wYWlkOwokc2NvcGUuYnVzaW5lc3NfdXNlcl9pZD1idXNpbmVzc191c2VyX2lkOwoKLy8gJ2NhbGN1bGF0aW5nJyBwcmV2aW91cyBzdGF0dXMgb2YgcGF5bWVudAppZiAoJHNjb3BlLnBhY2thZ2VfcGF5bWVudHM+MCkKewppZiAoJHNjb3BlLnByZXZpb3VzX2lzX2FsbF9wYWlkPT0xKQp7CiRzY29wZS5wcmV2aW91c19zdGF0dXM9ImlzX2FsbF9wYWlkIjsKJHNjb3BlLnBhY2thZ2Vfc3RhdHVzX2lkPS0xOwokc2NvcGUucHJldmlvdXNfcGFja2FnZV9zdGF0dXNfaWQ9LTE7Cn0KZWxzZQp7CiRzY29wZS5wcmV2aW91c19zdGF0dXM9ImlzX3BhcnRseV9wYWlkIjsKJHNjb3BlLnBhY2thZ2Vfc3RhdHVzX2lkPS0xOwokc2NvcGUucHJldmlvdXNfcGFja2FnZV9zdGF0dXNfaWQ9LTE7Cn0KfQplbHNlCnsKJHNjb3BlLnByZXZpb3VzX3N0YXR1cz0ibm90X3BhaWQiOwokc2NvcGUucGFja2FnZV9zdGF0dXNfaWQ9MDsKJHNjb3BlLnByZXZpb3VzX3BhY2thZ2Vfc3RhdHVzX2lkPTA7Cgp9CmxvZ0RlYnVnKCJwcmV2aW91c19zdGF0dXM9Iiskc2NvcGUucHJldmlvdXNfc3RhdHVzKTsKCiRzY29wZS5jbG9zZU1vZGFsID0gZnVuY3Rpb24oKQp7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKfTsKJHNjb3BlLnVwZGF0ZVBhY2thZ2VQYXltZW50ID0gZnVuY3Rpb24oKQp7Ci8vIGNvbnNvbGUubG9nKCJwcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ9Iiskc2NvcGUuZm1lZXRpbmcucHJldmlvdXNfcGFja2FnZV91c2VyX2lkKTsKLy8gY29uc29sZS5sb2coInBhY2thZ2VfdXNlcl9pZD0iKyRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQpOwpsb2dEZWJ1ZygidXBkYXRlUGFja2FnZVBheW1lbnQiKQovLyBpZiBzZWxlY3RlZCBwYWNrYWdlIGlzIGxpa2UgcHJldmlvdXMgcGFja2FnZSAtIGRvIG5vdGhpbmcKaWYgKCgkc2NvcGUucHJldmlvdXNfcGFja2FnZV9zdGF0dXNfaWQ9PSRzY29wZS5wYWNrYWdlX3N0YXR1c19pZCkpCnsKbG9nRGVidWcoInNlbGVjdGVkIG9wdGlvbiBpcyBsaWtlIHByZXZpb3VzIG9wdGlvbiAtIGRvIG5vdGhpbmciKTsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwp9CgovLyBwcmV2aW91cyBwYWNrYWdlIHdhcyBwYWlkL3BhcnRseS1wYWlkIC0gbm93IG5vdGhpbmdzIGlzIHNlbGVjdGVkCmVsc2UgaWYgKCgkc2NvcGUucHJldmlvdXNfcGFja2FnZV9zdGF0dXNfaWQ9PS0xKSAmJiAoJHNjb3BlLnBhY2thZ2Vfc3RhdHVzX2lkPT0wKSkKewpsb2dEZWJ1Zygid2FzIHBhaWQvcGFydGx5IHBhaWQsIHJlbW92aW5nIHBheW1lbnQiKTsKcmVtb3ZlUGFja2FnZVBheW1lbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5mcGFja2FnZS5wYWNrYWdlX3VzZXJfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwp9Ci8vIHByZXZpb3VzIHBhY2thZ2Ugd2FzIHNlbGVjdGVkIC0gbm93IGEgZGlmZmVyZW50IHBhY2thZ2UgaXMgc2VsZWN0ZWQKZWxzZSBpZiAoKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3N0YXR1c19pZD09MCkgJiYgKCRzY29wZS5wYWNrYWdlX3N0YXR1c19pZD09LTEpKQp7CmxvZ0RlYnVnKCJ3YXMgbm90IHBhaWQgLSBub3cgcGF5IGZ1bGx5L3BhcnRpYWxseSIpOwpwYXlGb3JQYWNrYWdlKCRodHRwLCRzY29wZSwkc2NvcGUuZnBhY2thZ2UucGFja2FnZV91c2VyX2lkLCRzY29wZS5idXNpbmVzc191c2VyX2lkLHVwZGF0ZUV2ZW50UGFja2FnZV9zdWNjZXNzKTsKCi8vIHJlYXNzaWduRXZlbnRQYWNrYWdlQXNzb2NpYXRpb24oJGh0dHAsJHNjb3BlLCRzY29wZS5mbWVldGluZy5ldmVudF9pZCwkc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkLCRzY29wZS5idXNpbmVzc191c2VyX2lkLHVwZGF0ZUV2ZW50UGFja2FnZV9zdWNjZXNzKTsKfQp9CgpmdW5jdGlvbiB1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2VzcygpCnsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwpsb2dEZWJ1ZygiYnJvYWRjYXN0aW5nIGNsaWVudFBhZ2VSZWxvYWREYXRhIik7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKfQoKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2V2ZW50UGFja2FnZUFzc29jaWF0aW9uTW9kYWxDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkcm91dGVQYXJhbXMsICRyb290U2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgZm1lZXRpbmcsIGJhbGFuY2UsIGJ1c2luZXNzX3VzZXJfaWQsIHVpQ2FsZW5kYXJDb25maWcpCnsKJHNjb3BlLmZtZWV0aW5nPWFuZ3VsYXIuY29weShmbWVldGluZyk7CiRzY29wZS5iYWxhbmNlPWJhbGFuY2U7CiRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ9JHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZDsKJHNjb3BlLnByZXZpb3VzX2V2ZW50X3BheW1lbnRzPSRzY29wZS5mbWVldGluZy5ldmVudF9wYXltZW50czsKJHNjb3BlLnByZXZpb3VzX2lzX2FsbF9wYWlkPSRzY29wZS5mbWVldGluZy5pc19hbGxfcGFpZDsKJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQ9YnVzaW5lc3NfdXNlcl9pZDsKCi8vICdjYWxjdWxhdGluZycgcHJldmlvdXMgc3RhdHVzIG9mIHBheW1lbnQKaWYgKCRzY29wZS5wcmV2aW91c19ldmVudF9wYXltZW50cz4wKQp7CmlmICgkc2NvcGUucHJldmlvdXNfaXNfYWxsX3BhaWQ9PTEpCnsKJHNjb3BlLnByZXZpb3VzX3N0YXR1cz0iaXNfYWxsX3BhaWQiOwp9CmVsc2UKewokc2NvcGUucHJldmlvdXNfc3RhdHVzPSJpc19wYXJ0bHlfcGFpZCI7Cn0KfQplbHNlCnsKaWYgKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ+MCkKewokc2NvcGUucHJldmlvdXNfc3RhdHVzPSJpc19wYWNrYWdlX3BhaWQiOwp9CmVsc2UKewokc2NvcGUucHJldmlvdXNfc3RhdHVzPSJub3RfcGFpZCI7Cn0KfQpsb2dEZWJ1ZygicHJldmlvdXNfc3RhdHVzPSIrJHNjb3BlLnByZXZpb3VzX3N0YXR1cyk7CgppZiAoKCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQ9PTApICYmICgkc2NvcGUuZm1lZXRpbmcuZXZlbnRfcGF5bWVudHM+MCkpCnsKLy8gdGhpcyBpcyBhIGNhc2Ugd2hlcmUgcGF5bWVudCB3YXMgcGFydGx5IG9yIGZ1bGx5IG1hZGUgZnJvbSBiYWxhbmNlCiRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQ9LTE7CiRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ9LTE7Cn0KCmxvZ0RlYnVnKCJldmVudFBhY2thZ2VBc3NvY2lhdGlvbk1vZGFsQ29udHJvbGxlciIpOwpnZXRQYWNrYWdlc0ZvckV2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJ3JlbGF0ZWRQYWNrYWdlcycsZ2V0UGFja2FnZXNGb3JFdmVudF9zdWNjZXNzKTsgLy8gd2FzIGdldEJ1c2luZXNzUGFja2FnZQpmdW5jdGlvbiBnZXRQYWNrYWdlc0ZvckV2ZW50X3N1Y2Nlc3MoKQp7Cn0KCiRzY29wZS5jbG9zZU1vZGFsID0gZnVuY3Rpb24oKQp7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKfTsKJHNjb3BlLnVwZGF0ZUV2ZW50UGFja2FnZSA9IGZ1bmN0aW9uKCkKewpjb25zb2xlLmxvZygicHJldmlvdXNfcGFja2FnZV91c2VyX2lkPSIrJHNjb3BlLmZtZWV0aW5nLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZCk7CmNvbnNvbGUubG9nKCJwYWNrYWdlX3VzZXJfaWQ9Iiskc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkKTsKLy8gaWYgc2VsZWN0ZWQgcGFja2FnZSBpcyBsaWtlIHByZXZpb3VzIHBhY2thZ2UgLSBkbyBub3RoaW5nCmlmICgoJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD09JHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZCkpCnsKbG9nRGVidWcoInNlbGVjdGVkIG9wdGlvbiBpcyBsaWtlIHByZXZpb3VzIG9wdGlvbiAtIGRvIG5vdGhpbmciKTsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwp9Ci8vIGlmIHNlbGVjdGVkIHBhY2thZ2UgaXMgbGlrZSBwcmV2aW91cyBwYWNrYWdlIC0gZG8gbm90aGluZwppZiAoKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ9PSRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQpICYmICgkc2NvcGUucHJldmlvdXNfcGFja2FnZV91c2VyX2lkPjApKQp7CmxvZ0RlYnVnKCJzZWxlY3RlZCBwYWNrYWdlIGlzIGxpa2UgcHJldmlvdXMgcGFja2FnZSAtIGRvIG5vdGhpbmciKTsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwp9Ci8vIHByZXZpb3VzIHBhY2thZ2Ugd2FzIHNlbGVjdCAtIG5vdyBub3RoaW5ncyBpcyBzZWxlY3RlZAplbHNlIGlmICgoJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD4wKSAmJiAoJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZD09MCkpCnsKbG9nRGVidWcoIm5vIHBhY2thZ2Ugc2VsZWN0ZWQsIHJlbW92ZSBwYWNrYWdlLWV2ZW50IGFzc29jaWF0aW9uIik7CnJlbW92ZUV2ZW50UGFja2FnZUFzc29jaWF0aW9uKCRodHRwLCRzY29wZSwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwp9Ci8vIHByZXZpb3VzIHBhY2thZ2Ugd2FzIHNlbGVjdGVkIC0gbm93IGEgZGlmZmVyZW50IHBhY2thZ2UgaXMgc2VsZWN0ZWQKZWxzZSBpZiAoKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ+MCkgJiYgKCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQ+MCkpCnsKbG9nRGVidWcoInVwZGF0aW5nIG5ldyBwYWNrYWdlIHRvIHBhY2thZ2VfdXNlcl9pZD0gIiskc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkKTsKcmVhc3NpZ25FdmVudFBhY2thZ2VBc3NvY2lhdGlvbigkaHR0cCwkc2NvcGUsJHNjb3BlLmZtZWV0aW5nLmV2ZW50X2lkLCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwp9Ci8vIHByZXZpb3VzIHBhY2thZ2Ugd2FzIG5vbmUgLSBub3cgYSBwYWNrYWdlIGlzIHNlbGVjdGVkCmVsc2UgaWYgKCgkc2NvcGUucHJldmlvdXNfcGFja2FnZV91c2VyX2lkPT0wKSAmJiAoJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZD4wKSkKewpsb2dEZWJ1ZygidXBkYXRpbmcgbmV3IHBhY2thZ2UgdG8gcGFja2FnZV91c2VyX2lkPSAiKyRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQpOwpyZWFzc2lnbkV2ZW50UGFja2FnZUFzc29jaWF0aW9uKCRodHRwLCRzY29wZSwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZCwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCx1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2Vzcyk7Cn0KLy8gcHJldmlvdXMgYXNzb2NpYXRpb24gd2FzIHBhaWQgb3IgaGFsZiBwYWlkIC0gbm93IGl0cyBub25lCmVsc2UgaWYgKCgkc2NvcGUucHJldmlvdXNfZXZlbnRfcGF5bWVudHM+MCkgJiYgKCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQ9PTApKQp7CmxvZ0RlYnVnKCJyZW1vdmluZyBwYXltZW50IGZyb20gZXZlbnQsIHBhY2thZ2VfdXNlcl9pZD0gIiskc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkKTsKcmVtb3ZlRXZlbnRQYXltZW50QXNzb2NpYXRpb24oJGh0dHAsJHNjb3BlLCRzY29wZS5mbWVldGluZy5ldmVudF9pZCwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCx1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2Vzcyk7CgovLyByZWFzc2lnbkV2ZW50UGFja2FnZUFzc29jaWF0aW9uKCRodHRwLCRzY29wZSwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZCwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCx1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2Vzcyk7Ci8vIHRvZG8KfQovLyB3YXMgcGFja2FnZSBwYXltZW50IC0+IG5vdyBiYWxhbmNlIHBheW1lbnQKZWxzZSBpZiAoKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ+MCkgJiYgKCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQ9PS0xKSkKewpsb2dEZWJ1ZygibW92aW5nIHBheW1lbnQgZnJvbSBwYWNrYWdlIHRvIGJhbGFuY2UiKTsKYWRkRXZlbnRQYXltZW50UmVtb3ZlUGFja2FnZSgkaHR0cCwkc2NvcGUsJHNjb3BlLmZtZWV0aW5nLmV2ZW50X2lkLCRzY29wZS5idXNpbmVzc191c2VyX2lkLHVwZGF0ZUV2ZW50UGFja2FnZV9zdWNjZXNzKTsKfQovLyB3YXMgYmFsYW5jZSBwYXltZW50IC0+IG5vdyBwYWNrYWdlIHBheW1lbnQKZWxzZSBpZiAoKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ9PS0xKSAmJiAoJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZD4wKSkKewpsb2dEZWJ1ZygibW92aW5nIHBheW1lbnQgZnJvbSBiYWxhbmNlIHRvIHBhY2thZ2UiKTsKYWRkRXZlbnRQYWNrYWdlUmVtb3ZlUGF5bWVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLmZtZWV0aW5nLmV2ZW50X2lkLCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwoKfQovLyB3YXMgbm90IHBhaWQgYXQgYWxsIC0+IG5vdyBiYWxhbmNlIHBheQplbHNlIGlmICgoJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD09MCkgJiYgKCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQ9PS0xKSkKewpsb2dEZWJ1ZygibW92aW5nIHBheW1lbnQgZnJvbSBub25lIHRvIGJhbGFuY2UiKTsKYWRkRXZlbnRQYXltZW50QXNzb2NpYXRpb24oJGh0dHAsJHNjb3BlLCRzY29wZS5mbWVldGluZy5ldmVudF9pZCwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCx1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2Vzcyk7Cn0KfQoKZnVuY3Rpb24gdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MoKQp7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKbG9nRGVidWcoImJyb2FkY2FzdGluZyBjbGllbnRQYWdlUmVsb2FkRGF0YSIpOwokcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NsaWVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCn0KCn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignYXJjaGl2ZV9jbGllbnRfbW9kYWwnLCBmdW5jdGlvbigkc2NvcGUsICRsb2NhdGlvbiwgaXNfaW5zdHJ1Y3RvciwgYnVzaW5lc3NfdXNlcl9pZCwgYnVzZXJfZmlyc3RfbmFtZSwgYnVzZXJfbGFzdF9uYW1lLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIHVpQ2FsZW5kYXJDb25maWcpIHsKJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQ9YnVzaW5lc3NfdXNlcl9pZDsKJHNjb3BlLmJ1c2VyX2ZpcnN0X25hbWU9YnVzZXJfZmlyc3RfbmFtZTsKJHNjb3BlLmJ1c2VyX2xhc3RfbmFtZT1idXNlcl9sYXN0X25hbWU7CiRzY29wZS5pc19pbnN0cnVjdG9yPWlzX2luc3RydWN0b3I7Cgpsb2dEZWJ1ZygiYXJjaGl2ZV9jbGllbnRfbW9kYWwgY29udHJvbGxlciIpOwoKJHNjb3BlLmNsb3NlTW9kYWwgPSBmdW5jdGlvbigpIHsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwp9OwoKJHNjb3BlLmFyY2hpdmVDbGllbnQgPSBmdW5jdGlvbigpCnsKYXJjaGl2ZUNsaWVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsYXJjaGl2ZUNsaWVudF9zdWNjZXNzKTsKZnVuY3Rpb24gYXJjaGl2ZUNsaWVudF9zdWNjZXNzKCkKewokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CmlmICgkc2NvcGUuaXNfaW5zdHJ1Y3RvcikKewokbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2luc3RydWN0b3JzJyk7Cn0KZWxzZSB7CiRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfY2xpZW50cycpOwp9Cn0KfQoKfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdwYXltZW55RGV0YWlsc01vZGFsQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHJvdXRlUGFyYW1zLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIGZwYXltZW50LCB1aUNhbGVuZGFyQ29uZmlnKSB7CiRzY29wZS5mcGF5bWVudD17fTsKJHNjb3BlLmZwYXltZW50LnBheW1lbnRfZGF0ZT1mcGF5bWVudC5wYXltZW50X2RhdGU7CiRzY29wZS5mcGF5bWVudC5wYXltZW50X2Ftb3VudD1mcGF5bWVudC5wYXltZW50X2Ftb3VudDsKJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZ2VuZXJhdGVkPWZwYXltZW50Lmludm9pY2VfZ2VuZXJhdGVkOwokc2NvcGUuZnBheW1lbnQuaW52b2ljZV9udW1iZXI9ZnBheW1lbnQuaW52b2ljZV9udW1iZXI7CmlmIChmcGF5bWVudC5pbnZvaWNlX2RhdGU9PW51bGwpCnsKJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZV9mb3JtYXQ9bmV3IERhdGUoKTsKfQplbHNlCnsKJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZV9mb3JtYXQ9ZnBheW1lbnQuaW52b2ljZV9kYXRlX2Zvcm1hdDsKfQokc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlPWZwYXltZW50Lmludm9pY2VfZGF0ZTsKJHNjb3BlLnNlbGVjdGVkUGF5bWVudE1ldGhvZD17Cm5hbWU6IGZwYXltZW50LnBheW1lbnRfbWV0aG9kX25hbWVfdHh0LAptZXRob2Q6IGZwYXltZW50LnBheW1lbnRfbWV0aG9kX25hbWUKfTsKJHNjb3BlLmlzUGF5bWVudE1ldGhvZFNlbGVjdGVkPXRydWU7Cgpsb2dEZWJ1Zygib2xkIGRhdGUgIiskc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlKTsKaWYgKCRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2RhdGUhPW51bGwpCnsKJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZV9mb3JtYXQgPSBuZXcgRGF0ZSgkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlKTsKfQokc2NvcGUucGF5bWVudE1ldGhvZHMgPSBwYXltZW50TWV0aG9kczsKJHNjb3BlLnBheW1lbnRUeXBlVGl0bGU9ZnBheW1lbnQucGF5bWVudF9tZXRob2RfbmFtZV90eHQ7CiRzY29wZS5mcGF5bWVudC5pbnZvaWNlX3NvdXJjZT0iRVhURVJOQUwiOwoKbG9nRGVidWcoJHNjb3BlLnBheW1lbnRNZXRob2RzKTsKbG9nRGVidWcoInBheW1lbnlEZXRhaWxzTW9kYWxDb250cm9sbGVyIGZvciBwYXltZW50ICIrSlNPTi5zdHJpbmdpZnkoZnBheW1lbnQsIG51bGwsIDQpKTsKCiRzY29wZS5zZWxlY3RQYXltZW50TWV0aG9kID0gZnVuY3Rpb24ocGF5bWVudCkgewokc2NvcGUucGF5bWVudFR5cGVUaXRsZT1wYXltZW50Lm5hbWU7CmxvZ0RlYnVnKCJwYXltZW50PSIrcGF5bWVudCk7Cgokc2NvcGUuc2VsZWN0ZWRQYXltZW50TWV0aG9kPXBheW1lbnQ7CiRzY29wZS5pc1BheW1lbnRNZXRob2RTZWxlY3RlZD10cnVlOwp9OwoKJHNjb3BlLmNsb3NlTW9kYWwgPSBmdW5jdGlvbigpIHsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwp9OwoKJHNjb3BlLnVwZGF0ZVBheW1lbnQgPSBmdW5jdGlvbigpCnsKLy8gbG9nRGVidWcoY3VycmVudENsaWVudCk7CmxvZ0RlYnVnKCJwYXltZW50IG1ldGhvZCIpOwpsb2dEZWJ1Zygkc2NvcGUuc2VsZWN0ZWRQYXltZW50TWV0aG9kKTsKbG9nRGVidWcoIiRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2dlbmVyYXRlZD08Iiskc2NvcGUuZnBheW1lbnQuaW52b2ljZV9nZW5lcmF0ZWQrIj4sICRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2RhdGVfZm9ybWF0PSIrJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZV9mb3JtYXQpOwpsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkUGF5bWVudE1ldGhvZC5tZXRob2Q9Iiskc2NvcGUuc2VsZWN0ZWRQYXltZW50TWV0aG9kLm1ldGhvZCk7CmlmICgoJHNjb3BlLmZwYXltZW50LnBheW1lbnRfYW1vdW50PT0wKSB8fCAoJHNjb3BlLmZwYXltZW50LnBheW1lbnRfYW1vdW50PT0nJykgfHwgKCRzY29wZS5mcGF5bWVudC5wYXltZW50X2Ftb3VudD09bnVsbCkpCnsKJHNjb3BlLnVzZXJFcnJvcj0i15DXoNeQINeU15bXnyDXodeb15XXnSDXm9ec16nXlNeVIjsKLy8gYWxlcnQoJ3NzJyk7Cn0KZWxzZSBpZiAoISRzY29wZS5pc1BheW1lbnRNZXRob2RTZWxlY3RlZCkKewokc2NvcGUudXNlckVycm9yPSLXkNeg15Ag15HXl9eoINeQ157Xptei15kg16rXqdec15XXnSI7Ci8vIGFsZXJ0KCdzcycpOwp9CmVsc2UKewppZiAoKCRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2dlbmVyYXRlZCE9MSkgfHwgKCRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2RhdGVfZm9ybWF0PT1udWxsKSkKewp2YXIgaW52b2ljZV9kYXRlX2Zvcm1hdCA9ICJudWxsIjsKfQplbHNlCnsKdmFyIGludm9pY2VfZGF0ZV9mb3JtYXQgPSAkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlX2Zvcm1hdC5nZXREYXRlKCkgICsgIi0iICsgKCRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2RhdGVfZm9ybWF0LmdldE1vbnRoKCkrMSkgKyAiLSIgKyAkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlX2Zvcm1hdC5nZXRGdWxsWWVhcigpOwp9CnRoZWRhdGE9IHsKYmFsYW5jZVRvUGF5OiAkc2NvcGUuZnBheW1lbnQucGF5bWVudF9hbW91bnQsCnBheW1lbnRfbWV0aG9kX25hbWU6ICRzY29wZS5zZWxlY3RlZFBheW1lbnRNZXRob2QubWV0aG9kLAppbnZvaWNlX251bWJlcjogJHNjb3BlLmZwYXltZW50Lmludm9pY2VfbnVtYmVyLAppbnZvaWNlX2dlbmVyYXRlZDogJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZ2VuZXJhdGVkLAppbnZvaWNlX2RhdGU6IGludm9pY2VfZGF0ZV9mb3JtYXQsCmludm9pY2Vfc291cmNlOiAkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9zb3VyY2UKfTsKdXBkYXRlUGF5bWVudEZvckNsaWVudCgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsZnBheW1lbnQudXNlcl9wYXltZW50X2lkLHRoZWRhdGEsY3JlYXRlUGF5bWVudEZvckNsaWVudF9jYWxsYmFjaywgY3JlYXRlUGF5bWVudEZvckNsaWVudF9mYWlsdXJlKTsKZnVuY3Rpb24gY3JlYXRlUGF5bWVudEZvckNsaWVudF9jYWxsYmFjaygpCnsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwpsb2dEZWJ1ZygiYnJvYWRjYXN0aW5nIGNsaWVudFBhZ2VSZWxvYWREYXRhIik7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKfQpmdW5jdGlvbiBjcmVhdGVQYXltZW50Rm9yQ2xpZW50X2ZhaWx1cmUoKQp7CmxvZ0RlYnVnKCJicm9hZGNhc3RpbmcgY2xpZW50UGFnZVJlbG9hZERhdGEiKTsKLy8gJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwp9Cn0KfQp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ2V2ZW50VHlwZUV4dHJhRmllbGRzTW9kYWxDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIGV2ZW50VHlwZVByb3BlcnRpZXMsIHVpQ2FsZW5kYXJDb25maWcpIHsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXM9ZXZlbnRUeXBlUHJvcGVydGllczsKICBsb2dEZWJ1ZygiZXZlbnRUeXBlRXh0cmFGaWVsZHNNb2RhbENvbnRyb2xsZXI9IitKU09OLnN0cmluZ2lmeShldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzLCBudWxsLCA0KSk7CmlmIChldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzPT1udWxsKQp7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzT3JpZz1bXTsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHM9W107Cn0KZWxzZSBpZiAoZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcy5sZW5ndGg+MCkKewokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllc09yaWc9KGV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMpLnNsaWNlKDApOwp9CmVsc2UKewokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllc09yaWc9W107CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzPVtdOwp9CiRzY29wZS5va0xpbWl0YXRpb25Nb2RhbCA9IGZ1bmN0aW9uKCkgewokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7Cn07Cgokc2NvcGUuY2FuY2VsID0gZnVuY3Rpb24oKQp7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzPSRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzT3JpZzsKbG9nRGVidWcoImNsb3NlIik7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzT3JpZyk7Cn0KJHNjb3BlLnNhdmVBbmRDbG9zZSA9IGZ1bmN0aW9uKCkKewpsb2dEZWJ1Zygic2F2ZSBhbmQgY2xvc2UiKTsKZnVuY3Rpb24gc2V0Q2xpZW50c0V4dHJhRmllbGRzX3N1Y2Nlc3MoKQp7Cgp9CiRzY29wZS5DbGllbnRzRGV0YWlscz17fTsKJHNjb3BlLkNsaWVudHNEZXRhaWxzLmV4dHJhRmllbGRzPSRzY29wZS5leHRyYUZpZWxkczsKc2V0Q2xpZW50c0V4dHJhRmllbGRzKCRodHRwLCRzY29wZSwkc2NvcGUuQ2xpZW50c0RldGFpbHMsc2V0Q2xpZW50c0V4dHJhRmllbGRzX3N1Y2Nlc3MpOwokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyk7Cn0KCiAgJHNjb3BlLmR1cGxpY2F0ZUZpZWxkTmFtZXM9IiI7CiRzY29wZS5hZGRFeHRyYUZpZWxkcyA9IGZ1bmN0aW9uKCkKewogICAgbG9nRGVidWcoImFkZEV4dHJhRmllbGRzIHZhbGlkYXRpbmciKTsKICAgIC8vIGNoZWNraW5nIGZvciBkdXBsaWNhdGUgbmFtZXMKICAgIHZhciBleHRyYUZpZWxkc05hbWVzID0gW107CiAgICBmb3IgKHZhciBpPTE7IGk8JHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMubGVuZ3RoOyBpKyspCiAgICB7CiAgICAgIGV4dHJhRmllbGRzTmFtZXMucHVzaCgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkc1tpXS5maWVsZF9uYW1lKTsKICAgIH0KICAgIGV4dHJhRmllbGRzTmFtZXMuc29ydCgpOwogICAgdmFyIGxhc3QgPSBleHRyYUZpZWxkc05hbWVzWzBdOwogICAgZm9yICh2YXIgaT0xOyBpPGV4dHJhRmllbGRzTmFtZXMubGVuZ3RoOyBpKyspCiAgICB7CiAgICAgICBpZiAoZXh0cmFGaWVsZHNOYW1lc1tpXSA9PSBsYXN0KQogICAgICAgewogICAgICAgIC8vICBhbGVydCgnRHVwbGljYXRlIDogJytsYXN0KTsKICAgICAgICAgJHNjb3BlLmR1cGxpY2F0ZUZpZWxkTmFtZXM9J9en15nXmdedINep15PXlCDXm9ek15XXnCDXkdep150gIicrbGFzdCsnIi4uLic7CiAgICAgICAgIHJldHVybjsKICAgICAgIH0KICAgICAgIGxhc3QgPSBleHRyYUZpZWxkc05hbWVzW2ldOwogICAgfQokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyk7Cn0KCiRzY29wZS5leHRyYUZpZWxkcyA9IGV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHM7CiRzY29wZS5maWVsZFR5cGVzID0gW3tmaWVsZF9kYXRhdHlwZTogIlRFWFRfQVJFQSIsIG5hbWU6J9eq15nXkdeqINeY16fXodeYJ30sIHtmaWVsZF9kYXRhdHlwZTogIk5VTUJFUiIsIG5hbWU6J9ee16HXpNeoJ30gLCB7ZmllbGRfZGF0YXR5cGU6ICJTVFJJTkciLCBuYW1lOifXmNen16HXmCDXp9em16gnfSAsIHtmaWVsZF9kYXRhdHlwZTogIkJPT0xFQU4iLCBuYW1lOifXqteZ15HXqiDXodeZ157XldefJ30gLCB7ZmllbGRfZGF0YXR5cGU6ICJEQVRFIiwgbmFtZTon16rXkNeo15nXmid9XTsKCiRzY29wZS5hZGROZXdGaWVsZCA9IGZ1bmN0aW9uKCkgewp2YXIgbmV3SXRlbU5vID0gJHNjb3BlLmV4dHJhRmllbGRzLmxlbmd0aCsxOwokc2NvcGUuZXh0cmFGaWVsZHMucHVzaCh7ImZpZWxkX2RhdGF0eXBlIjoiU1RSSU5HIiwiaXNfbWFuZGF0b3J5IjowLCAiZnJvbWRiIjogZmFsc2UsICJmaWVsZF9pZCI6IDAsICJpc19hY3RpdmUiOiAxLCAibW9kaWZpZWQiOiAwfSk7CgogICAgbG9nRGVidWcoImV4dHJhIGZpZWxkczogIiArIEpTT04uc3RyaW5naWZ5KCRzY29wZS5leHRyYUZpZWxkcywgbnVsbCwgMikpOwoKfTsKCiRzY29wZS5yZW1vdmVGaWVsZCA9IGZ1bmN0aW9uKGNob2ljZSkKewovLyByZW1vdmluZyBmaWVsZAovLyBpZiBpdHMgbm90IG9yaWdpbmF0ZWQgZnJvbSBkYXRhYmFzZSAtIHRoZW4gd2Ugc2ltcGx5IGRlbGV0ZSBpdCBmcm9tIHRoZSBhcnJheQovLyBvdGhlcndpc2Ugd2UgbWFyayBpdCBhcyBhY3RpdmU9ZmFsc2UKbG9nRGVidWcoY2hvaWNlKTsKLy8gdmFyIGxhc3RJdGVtID0gKGNob2ljZS5pZCktMTsvLyRzY29wZS5jaG9pY2VzLmxlbmd0aC0xOwovLyAkc2NvcGUuY2hvaWNlcy5zcGxpY2UobGFzdEl0ZW0sMSk7CmZvcih2YXIgaSA9IDA7IGkgPCAkc2NvcGUuZXh0cmFGaWVsZHMubGVuZ3RoOyBpKyspCnsKaWYgKCRzY29wZS5leHRyYUZpZWxkc1tpXSA9PSBjaG9pY2UpCnsKaWYgKGNob2ljZS5mcm9tZGI9PWZhbHNlKQp7Ci8vIGlmIG5vdCBmcm9tIGRiIC0gcmVtb3ZpbmcgaXQgZnJvbSB0aGUgYXJyYXkgb2YgZXh0cmEtZmllbGRzCiRzY29wZS5leHRyYUZpZWxkcy5zcGxpY2UoaSwgMSk7Cn0KZWxzZQp7Ci8vIGlmIGZpZWxkIG9yaWdpbmF0ZWQgZnJvbSBkYiAtIHRoYW4gd2UgZG9udCByZW1vdmUgaXQgZnJvbSB0aGUgYXJyYXkKLy8gYW5kIG1hcmsgaXQgYXMgYWN0aXZlPWZhbHNlIHNvIHRoYXQgaXQgY2FuIGJlIGhhbmRlbGVkIG9uIHRoZSBzZXJ2ZXIKY2hvaWNlLmlzX2FjdGl2ZT0wOwpjaG9pY2UubW9kaWZpZWQ9dHJ1ZTsKfQpicmVhazsKfQp9Cn07Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignZXZlbnRDbG9zZUlnbm9yZU1hbmRhdG9yeUZpZWxkc01vZGFsQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHJvdXRlUGFyYW1zLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIGN1cnJlbnRFdmVudCwgdWlDYWxlbmRhckNvbmZpZykgewokc2NvcGUuY3VycmVudEV2ZW50PWN1cnJlbnRFdmVudDsKCiRzY29wZS5va0NhbmNlbCA9IGZ1bmN0aW9uKCkgewokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7Cn07Cgokc2NvcGUuY2xvc2VFdmVudElnbm9yZU1hbmRhdG9yeUZpZWxkcyA9IGZ1bmN0aW9uKCkKewpsb2dEZWJ1ZygiaWdub3JlIG1hbmRhdG9yeSBleHRyYSBmaWVsZHMgYW5kIGNsb3NlIGV2ZW50Iik7CiRzY29wZS5jdXJyZW50RXZlbnQuaWdub3JlRXh0cmFGaWVsZHNWYWxpZGF0aW9uPXRydWU7CmNsb3NlRXZlbnQoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCwkc2NvcGUuY3VycmVudEV2ZW50LGFmdGVyQ2xvc2VFdmVudCxhZnRlckNsb3NlRXZlbnQpOwpmdW5jdGlvbiBhZnRlckNsb3NlRXZlbnQoKQp7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgnZXZlbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7Cn07Cn0KfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdldmVudFR5cGVDaGFuZ2VkUG9wdXBDb250cm9sbGVyJywgZnVuY3Rpb24oJGxvY2F0aW9uLCAkc2NvcGUsICRyb3V0ZVBhcmFtcywgJHJvb3RTY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRodHRwLCBldmVudFR5cGVQcm9wZXJ0aWVzLCB1aUNhbGVuZGFyQ29uZmlnKSB7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzPWV2ZW50VHlwZVByb3BlcnRpZXM7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLnVwZGF0ZWRfZnJvbV9kYXRlPW5ldyBEYXRlKCk7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLnVwZGF0ZV9leGlzdGluZ19ldmVudHM9ZmFsc2U7Cgokc2NvcGUuY2xvc2VNb2RhbCA9IGZ1bmN0aW9uKCkgewokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7Cn07Cgokc2NvcGUudXBkYXRlRXZlbnRUeXBlID0gZnVuY3Rpb24oKQp7CmxvZ0RlYnVnKCJ1cGRhdGUgRXZlbnQgVHlwZSAiICsgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXZlbnRfdHlwZV9pZCk7CmlmICgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5tYXhfcmVnaXN0cmF0aW9ucz09JycpCnsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMubWF4X3JlZ2lzdHJhdGlvbnM9MDsKfQp1cGRhdGVFdmVudFR5cGUoJGh0dHAsJHNjb3BlLCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV2ZW50X3R5cGVfaWQsJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMsdXBkYXRlRXZlbnRUeXBlX3N1Y2Nlc3MpOwpmdW5jdGlvbiB1cGRhdGVFdmVudFR5cGVfc3VjY2VzcygpCnsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwokbG9jYXRpb24ucGF0aCgnL2V2ZW50X3R5cGVzJyk7Cn0KfQoKfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdjbGFzc0RlbGV0ZUFsbE1vZGFsQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHJvb3RTY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRodHRwLCBjdXJyZW50RXZlbnQsIHVpQ2FsZW5kYXJDb25maWcpCnsKbG9nRGVidWcoImNvbnRyb2xsZXI6IGNsYXNzRGVsZXRlQWxsTW9kYWxDb250cm9sbGVyIik7CiRzY29wZS5jdXJyZW50RXZlbnQ9Y3VycmVudEV2ZW50Owokc2NvcGUuY2xvc2VNb2RhbCA9IGZ1bmN0aW9uKCkKewokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7Cn07CgoKJHNjb3BlLmRlbGV0ZUNsYXNzRXZlbnRTaW5nbGU9ZnVuY3Rpb24gKCkgLy8gZGVsZXRlIG9ubHkgb25lL2N1cnJlbnQgY2xhc3MgZXZlaHQKewpjYW5jZWxDbGFzc0V2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkLGNhbmNlbENsYXNzRXZlbnRfY2FsbGJhY2ssIGNhbmNlbENsYXNzRXZlbnRfY2FsbGJhY2spOwpmdW5jdGlvbiBjYW5jZWxDbGFzc0V2ZW50X2NhbGxiYWNrKCkKewpnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkKTsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwokcm9vdFNjb3BlLiRicm9hZGNhc3QoJ3JlbG9hZEV2ZW50Jyx7ZXZlbnRfaWQgOiAkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkfSk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCn0KfQokc2NvcGUuZGVsZXRlQ2xhc3NFdmVudHNBbGw9ZnVuY3Rpb24gKCkgLy8gZGVsZXRlIGFsbCByZXBlYXRpbmcgZXZlbnRzCnsKY2FuY2VsQ2xhc3NSZXBlYXRpbmdFdmVudCgkaHR0cCwkc2NvcGUsMCwkc2NvcGUuY3VycmVudEV2ZW50LnJlcGVhdF9ldmVudF9pZCxjYW5jZWxDbGFzc0V2ZW50X2NhbGxiYWNrLCBjYW5jZWxDbGFzc0V2ZW50X2NhbGxiYWNrKTsKZnVuY3Rpb24gY2FuY2VsQ2xhc3NFdmVudF9jYWxsYmFjaygpCnsKZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCk7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdyZWxvYWRFdmVudCcse2V2ZW50X2lkIDogJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZH0pOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwp9Cn0KJHNjb3BlLmRlbGV0ZUNsYXNzRXZlbnRzQWxsU3RhcnRpbmdFdmVudElEPWZ1bmN0aW9uICgpIC8vIGRlbGV0ZSBhbGwgcmVwZWF0aW5nIGV2ZW50cyBzdGFydGluZyBldmVudF9pZAp7CmNhbmNlbENsYXNzUmVwZWF0aW5nRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQsJHNjb3BlLmN1cnJlbnRFdmVudC5yZXBlYXRfZXZlbnRfaWQsY2FuY2VsQ2xhc3NFdmVudF9jYWxsYmFjaywgY2FuY2VsQ2xhc3NFdmVudF9jYWxsYmFjayk7CmZ1bmN0aW9uIGNhbmNlbENsYXNzRXZlbnRfY2FsbGJhY2soKQp7Ci8vIGdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQpOwokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgncmVsb2FkRXZlbnQnLHtldmVudF9pZCA6ICRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWR9KTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKfQp9Cgp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ2J1c2luZXNzX21vZGFsX2xpbWl0YXRpb25fY3JlYXRlJywgZnVuY3Rpb24oJHNjb3BlLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIHN0YXJ0LGVuZCwgZml4ZWRTY2hlZHVsZSwgdWlDYWxlbmRhckNvbmZpZykgewoKJHNjb3BlLmZpeGVkU2NoZWR1bGU9Zml4ZWRTY2hlZHVsZTsKJHNjb3BlLm9yaWdpbmFsX3N0YXJ0PXN0YXJ0Owokc2NvcGUub3JpZ2luYWxfZW5kPWVuZDsKCiRzY29wZS5zdGFydD1uZXcgbW9tZW50KHN0YXJ0KSoxMDAwOwokc2NvcGUuZW5kPW5ldyBtb21lbnQoZW5kKSoxMDAwOwpjb25zb2xlLmxvZygnc3RhcnQ9JytzdGFydCk7CmNvbnNvbGUubG9nKCdlbmQ9JytlbmQpOwoKZ2V0QnVzaW5lc3NMb2NhdGlvbnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19sb2NhdGlvbnMnLGdldEJ1c2luZXNzTG9jYXRpb25zX3N1Y2Nlc3MpOwpmdW5jdGlvbiBnZXRCdXNpbmVzc0xvY2F0aW9uc19zdWNjZXNzKCkKewokc2NvcGUubmV3RXZlbnREZXRhaWxzLmxvY2F0aW9uX2lkPSRzY29wZS5idXNpbmVzc19sb2NhdGlvbnNbMF0ubG9jYXRpb25faWQ7Cn0KCnNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc3RhcnQpOwpzZWxlY3RlZERhdGVFbmQgPSBuZXcgRGF0ZShlbmQpOwpsb2dEZWJ1Zygic2VsZWN0ZWREYXRlU3RhcnQgPSAiK3NlbGVjdGVkRGF0ZVN0YXJ0KTsKdmFyIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZSgpICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKdmFyIHNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKHNlbGVjdGVkRGF0ZUVuZC5nZXRUaW1lKCkgKyBzZWxlY3RlZERhdGVFbmQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKCi8vIGxvZ0RlYnVnKCJkYXRlPSIgKyBzZWxlY3RlZERhdGVTdGFydCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50ID0gW107CiRzY29wZS5uZXdFdmVudERldGFpbHMgPSBbXTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycyA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldEhvdXJzKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcyA9IChzZWxlY3RlZERhdGVTdGFydC5nZXRNaW51dGVzKCkgPCAxMCA/ICcwJyA6ICcnKSArIHNlbGVjdGVkRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkb3cgPSBkYXlOYW1lc1tzZWxlY3RlZERhdGVTdGFydC5nZXREYXkoKV07CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF0ZSA9IHNlbGVjdGVkRGF0ZVN0YXJ0Owokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoID0gbW9udGhOYW1lc1tzZWxlY3RlZERhdGVTdGFydC5nZXRNb250aCgpXTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aDExMiA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldE1vbnRoKCkrMTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXlvZm1vbnRoID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RGF0ZSgpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXIgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRGdWxsWWVhcigpOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWVfaW5wdXRfZm9ybWF0PSBuZXcgRGF0ZSgxOTcwLCAwLCAxLCAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzLCAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMsIDApOwoKJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMgPSBzZWxlY3RlZERhdGVFbmQuZ2V0SG91cnMoKTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcyA9IChzZWxlY3RlZERhdGVFbmQuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBzZWxlY3RlZERhdGVFbmQuZ2V0TWludXRlcygpOwoKCiRzY29wZS5jYW5jZWwgPSBmdW5jdGlvbigpIHsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwp9OwoKZ2V0QWxsSW5zdHJ1Y3RvcnMoJGh0dHAsJHNjb3BlLCdpbnN0cnVjdG9ycycsZ2V0QWxsSW5zdHJ1Y3RvcnNfc3VjY2Vzcyk7CmZ1bmN0aW9uIGdldEFsbEluc3RydWN0b3JzX3N1Y2Nlc3MoKQp7CiRzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZD0kc2NvcGUuaW5zdHJ1Y3RvcnNbMF0uYnVzaW5lc3NfdXNlcl9pZDsKfQpnZXROb0NsYXNzRXZlbnRUeXBlc05vQWRtaW4oJGh0dHAsJHNjb3BlLCdyZWxhdGVkRXZlbnRUeXBlcycpOwoKJHNjb3BlLmNyZWF0ZU5ld0xpbWl0YXRpb24gPSBmdW5jdGlvbigpCnsKbG9nRGVidWcoImZ1bmN0aW9uOiBjcmVhdGVOZXdMaW1pdGF0aW9uIik7CmNhbGVuZGFyID0gJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnOwoKaWYgKCRzY29wZS5zZWxlY3RlZEV2ZW50VHlwZXMubGVuZ3RoPDEpCnsKcmV0dXJuIGZhbHNlOwp9CmlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vyczwkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKQp7CmFsZXJ0KCLXltee158g16HXmdeV150g15zXpNeg15kg15bXntefINeU16rXl9ec15QiKTsKcmV0dXJuIGZhbHNlOwp9CmlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vycz09JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykKewppZiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlczw9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKQp7CmFsZXJ0KCLXltee158g16HXmdeV150g15zXpNeg15kg15bXntefINeU16rXl9ec15QiKTsKcmV0dXJuIGZhbHNlOwp9CmlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzPCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMrMTApKQp7CmFsZXJ0KCLXkdec15XXpyDXp9eY158g154tMTAg15PXp9eV16oiKTsKcmV0dXJuIGZhbHNlOwp9Cn0KaWYgKCFrdXplSXNDYWxlbmRhckRyYWdnYmxlKSB7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3Vuc2VsZWN0Jyk7Cn0KbG9nRGVidWcoInN0YXJ0PSIgKyBzdGFydCk7CmNoZWNrRGF0ZSA9IG5ldyBEYXRlKHN0YXJ0KTsKbG9nRGVidWcoImNoZWNrIGRhdGUgPSAiICsgY2hlY2tEYXRlKQpsb2dEZWJ1ZygiZW5kPSIgKyBlbmQpOwplY29sb3I9IiMwMGE2NWEiOwoKaWYgKGNoZWNrRGF0ZS5nZXRGdWxsWWVhcigpID09IDE5NzApIHsKZGF5X2xpbWl0X2lkID0gLTE7Cn0gZWxzZSB7CmRheV9saW1pdF9pZCA9IDE7Cn0KCi8vIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW10uZnVsbENhbGVuZGFyKCdyZXJlbmRlckV2ZW50cycpOwoKdGVtcF9saW1pdF9pZCA9IGNhbGNfdGVtcF9saW1pdF9pZCgpOwoKbG9nRGVidWcoJHNjb3BlLnNlbGVjdGVkRXZlbnRUeXBlc1swXSk7CmxvZ0RlYnVnKCRzY29wZS5zZWxlY3RlZEV2ZW50VHlwZXNbMF0uZXZlbnRfdHlwZV9pZCk7CgpzdGFydF9wYXJhbT1zdGFydDsKZW5kX3BhcmFtPWVuZDsKdGl0bGVfcGFyYW09Jyc7CmxvZ0RlYnVnKCJhZGRMaW1pdGF0aW9uVG9EYXRhYmFzZSBzdGFydD0iICsgc3RhcnRfcGFyYW0gKyAiLCBlbmQ9IiArICIsIHRpdGxlPSIgKyB0aXRsZV9wYXJhbSApOwoKdGhlZGF0YSA9IHsKc3RhcnRfZGF0ZTogJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5zdGFydF90aW1lLAplbmRfZGF0ZTogJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmRfdGltZSwKY29sb3I6IGVjb2xvciwKdGVtcF9saW1pdF9pZDogdGVtcF9saW1pdF9pZCwKZW1wX2lkOiAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmluc3RydWN0b3JfaWQsCmxvY2F0aW9uX2lkOiAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmxvY2F0aW9uX2lkLApldmVudF90eXBlX2lkOiAkc2NvcGUuc2VsZWN0ZWRFdmVudFR5cGVzWzBdLmV2ZW50X3R5cGVfaWQsCmV2ZW50X3R5cGVzOiAkc2NvcGUuc2VsZWN0ZWRFdmVudFR5cGVzLAp0aXRsZTogdGl0bGVfcGFyYW0KfTsKCmlmICgkc2NvcGUuZml4ZWRTY2hlZHVsZSkgLy8gZml4ZWQgc2NoZWR1bGUgdnMgc3BlY2lmaWMgd2VlZC9kYXkgbGltaXRhdGlvbgp7CmNyZWF0ZUNhbGVuZGFyTGltaXRhdGlvbigkaHR0cCwkc2NvcGUsdGhlZGF0YSxsaW1pdGF0aW9uX3N1Y2Nlc3NfY2FsbGJhY2spOwp9CmVsc2UKewpjcmVhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXkoJGh0dHAsJHNjb3BlLHRoZWRhdGEsbGltaXRhdGlvbl9zdWNjZXNzX2NhbGxiYWNrKTsKfQpmdW5jdGlvbiBsaW1pdGF0aW9uX3N1Y2Nlc3NfY2FsbGJhY2soKQp7CmxvZ0RlYnVnKCJzdWNjZXNzIik7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKJHVpYk1vZGFsSW5zdGFuY2UuZGlzbWlzcygpOwp9Cgp9Cgokc2NvcGUuc3RhcnRNaW51dGVzID0gZnVuY3Rpb24oKQp7CmxvZ0RlYnVnKCJzdGFydE1pbnV0ZXMgIisoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKSk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcz1taW51dGVzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpOwpjYWxjdWxhdGVTdGFydFRpbWUoKTsKfQokc2NvcGUuc3RhcnRIb3VycyA9IGZ1bmN0aW9uKCkKewpsb2dEZWJ1Zygic3RhcnRIb3VycyAiK2hvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKSk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnM9aG91cnNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMpOwpjYWxjdWxhdGVTdGFydFRpbWUoKTsKfQokc2NvcGUuZW5kTWludXRlcyA9IGZ1bmN0aW9uKCkKewpsb2dEZWJ1ZygiZW5kTWludXRlcyAiKygkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzKSk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXM9bWludXRlc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcyk7CmNhbGN1bGF0ZUVuZFRpbWUoKTsKfQokc2NvcGUuZW5kSG91cnMgPSBmdW5jdGlvbigpCnsKbG9nRGVidWcoImVuZEhvdXJzICIraG91cnNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzKSk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzPWhvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vycyk7CmNhbGN1bGF0ZUVuZFRpbWUoKTsKfQoKCmZ1bmN0aW9uIGNhbGN1bGF0ZVN0YXJ0VGltZSgpCnsKZXZlbnRZZWFyPSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0eWVhcjsKZXZlbnRNb250aD0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoMTEyOwpldmVudERheT0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRheW9mbW9udGg7CmlmIChwYXJzZUludChldmVudE1vbnRoKTwxMCkKewpldmVudE1vbnRoPSIwIitldmVudE1vbnRoOwp9CmlmIChwYXJzZUludChldmVudERheSk8MTApCnsKZXZlbnREYXk9IjAiK2V2ZW50RGF5Owp9CmxvZ0RlYnVnKCIkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXI9IitldmVudFllYXIpOwpsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXlvZm1vbnRoPSIrZXZlbnRNb250aCk7CmxvZ0RlYnVnKCIkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoPSIrZXZlbnREYXkpOwpuZXdfc3RhcnQ9bW9tZW50LnV0YyhldmVudFllYXIrIi0iK2V2ZW50TW9udGgrIi0iK2V2ZW50RGF5KyJUMDA6MDA6MDAiKS5hZGQoKChwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKSo2MCkrcGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKSksICdtaW51dGVzJyk7CiRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZT1uZXdfc3RhcnQ7CmxvZ0RlYnVnKCJuZXdfc3RhcnQ9IituZXdfc3RhcnQpOwp9CmZ1bmN0aW9uIGNhbGN1bGF0ZUVuZFRpbWUoKQp7CmV2ZW50WWVhcj0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXI7CmV2ZW50TW9udGg9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aDExMjsKZXZlbnREYXk9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXlvZm1vbnRoOwppZiAocGFyc2VJbnQoZXZlbnRNb250aCk8MTApCnsKZXZlbnRNb250aD0iMCIrZXZlbnRNb250aDsKfQppZiAocGFyc2VJbnQoZXZlbnREYXkpPDEwKQp7CmV2ZW50RGF5PSIwIitldmVudERheTsKfQpsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyPSIrZXZlbnRZZWFyKTsKbG9nRGVidWcoIiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aD0iK2V2ZW50TW9udGgpOwpsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aD0iK2V2ZW50RGF5KTsKbmV3X2VuZD1tb21lbnQudXRjKGV2ZW50WWVhcisiLSIrZXZlbnRNb250aCsiLSIrZXZlbnREYXkrIlQwMDowMDowMCIpLmFkZCgoKHBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzKSo2MCkrcGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcykpLCAnbWludXRlcycpOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZF90aW1lPW5ld19lbmQ7CmxvZ0RlYnVnKCJuZXdfZW5kPSIrbmV3X2VuZCk7Cn0KCmNhbGN1bGF0ZVN0YXJ0VGltZSgpOwpjYWxjdWxhdGVFbmRUaW1lKCk7CgpmdW5jdGlvbiBtaW51dGVzQ2hhbmdlZCh0aGVtaW51dGVzKQp7CmxvZ0RlYnVnKCJ0aGVtaW51dGVzPSIrdGhlbWludXRlcyk7CmlmICh0eXBlb2YgdGhlbWludXRlcz09InVuZGVmaW5lZCIpCnsKcmV0dXJuICIwMCI7Cn0KdGhlbWludXRlcz1wYXJzZUludCh0aGVtaW51dGVzKTsKaWYgKHRoZW1pbnV0ZXM+NjApCnsKcmV0dXJuICIwMCI7Cn0KZWxzZSBpZiAodGhlbWludXRlczwwKQp7CnJldHVybiAiMDAiOwp9CmVsc2UgaWYgKHRoZW1pbnV0ZXM9PSIiKQp7CnJldHVybiAiMDAiOwp9CmVsc2UgaWYgKHRoZW1pbnV0ZXM8MTApCnsKcmV0dXJuICIwIit0aGVtaW51dGVzOwp9CmVsc2UKewpyZXR1cm4gdGhlbWludXRlczsKfQp9CmZ1bmN0aW9uIGhvdXJzQ2hhbmdlZCh0aGVob3VycykKewpsb2dEZWJ1ZygidGhlaG91cnM9Iit0aGVob3Vycyk7CmlmICh0eXBlb2YgdGhlaG91cnM9PSJ1bmRlZmluZWQiKQp7CnJldHVybiAiMCI7Cn0KdGhlaG91cnM9cGFyc2VJbnQodGhlaG91cnMpOwppZiAodGhlaG91cnM+MjQpCnsKcmV0dXJuIDA7Cn0KZWxzZSBpZiAodGhlaG91cnM8MCkKewpyZXR1cm4gMDsKfQplbHNlIGlmICh0aGVob3Vycz09IiIpCnsKcmV0dXJuICIwIjsKfQplbHNlCnsKcmV0dXJuIHRoZWhvdXJzOwp9Cn0KfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2NsYXNzQ2xvc2VNb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRyb290U2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgZXZlbnRfaWQsIHVpQ2FsZW5kYXJDb25maWcpIHsKZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ3NlbGVjdGVkRXZlbnQnLGV2ZW50X2lkLGFmdGVyR2V0Q2xpZW50U3BlY2lmaWNFdmVudCk7CmZ1bmN0aW9uIGFmdGVyR2V0Q2xpZW50U3BlY2lmaWNFdmVudCgpCnsKZm9yIChpID0gMDsgaSA8ICRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50VXNlcnMubGVuZ3RoOyBpKyspCnsKaWYgKCRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50VXNlcnNbaV0uc3RhdHVzX25hbWUhPSRnVXNlcl9zdGF0dXNfYWJzZW50ZWQpCnsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRVc2Vyc1tpXS5wYXJ0aWNpcGF0ZWQ9dHJ1ZTsKfQppZiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRVc2Vyc1tpXS5pc193YWl0aW5nX2xpc3Q9PTEpCnsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRVc2Vyc1tpXS5wYXJ0aWNpcGF0ZWQ9ZmFsc2U7Cn0KfQpsb2dEZWJ1Zygkc2NvcGUuc2VsZWN0ZWRFdmVudCk7Cn0KCi8vIGNsaWNrZWQgcm93IC0gY2hlY2svdW5jaGVjayB0aGUgY2hlY2tib3ggb2YgYSB1c2VyCiRzY29wZS5yb3dDbGlja2VkID0gZnVuY3Rpb24ob2JqKQp7CmxvZ0RlYnVnKCdyb3cgY2xpY2tlZCcpOwpvYmoucGFydGljaXBhdGVkID0gIW9iai5wYXJ0aWNpcGF0ZWQ7Cn07Cgokc2NvcGUub2tMaW1pdGF0aW9uTW9kYWwgPSBmdW5jdGlvbigpIHsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwp9OwoKJHNjb3BlLmNsb3NlQ2xhc3MgPSBmdW5jdGlvbigpCnsKY2xvc2VDbGFzc0V2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUuc2VsZWN0ZWRFdmVudC5ldmVudF9pZCwkc2NvcGUuc2VsZWN0ZWRFdmVudCxhZnRlckNsb3NlRXZlbnQsYWZ0ZXJDbG9zZUV2ZW50KTsKZnVuY3Rpb24gYWZ0ZXJDbG9zZUV2ZW50KCkKewokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgncmVsb2FkRXZlbnQnLHtldmVudF9pZCA6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50X2lkfSk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCn07Cn0KfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2J1c2luZXNzQ2xpZW5kQ2FyZFBheW1lbnQnLCBmdW5jdGlvbigkc2NvcGUsICRyb3V0ZVBhcmFtcywgJHJvb3RTY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRodHRwLCBjdXJyZW50Q2xpZW50LCBpc3BsdXMsIHVpQ2FsZW5kYXJDb25maWcpCnsKJHNjb3BlLmlzcGx1cz1pc3BsdXM7CmxvZ0RlYnVnKCdidXNpbmVzc0NsaWVuZENhcmRQYXltZW50IGlzcGx1cz0nICtpc3BsdXMrIiBjdXJyZW50Q2xpZW50PSIrIEpTT04uc3RyaW5naWZ5KGN1cnJlbnRDbGllbnQsIG51bGwsIDIpKTsKJHNjb3BlLmt1emVJc0xvYWRpbmc9ZmFsc2U7CmxvZ0RlYnVnKCdjdXJyZW50Q2xpZW50LnBheW1lbnRfYmFsYW5jZT0nK2N1cnJlbnRDbGllbnQucGF5bWVudF9iYWxhbmNlKyIsY3VycmVudENsaWVudC51bnBhaWRfYmFsYW5jZSA9IitjdXJyZW50Q2xpZW50LnVucGFpZF9iYWxhbmNlKTsKdGhlYmFsYW5jZSA9IGN1cnJlbnRDbGllbnQucGF5bWVudF9iYWxhbmNlLWN1cnJlbnRDbGllbnQudW5wYWlkX2JhbGFuY2U7CmxvZ0RlYnVnKCd0aGViYWxhbmNlPScrdGhlYmFsYW5jZSk7CmlmICh0aGViYWxhbmNlPDApCnsKJHNjb3BlLmJhbGFuY2VUb1BheT1NYXRoLmFicyh0aGViYWxhbmNlKTsKfQogIC8vIGVsc2UgaWYgKChjdXJyZW50Q2xpZW50LmJhbGFuY2U+MCkgJiYgKGN1cnJlbnRDbGllbnQudW5wYWlkX2JhbGFuY2U+MCkpCiAgLy8gewogIC8vICAgY29uc29sZS5sb2coImN1cnJlbnRDbGllbnQuYmFsYW5jZT0iK2N1cnJlbnRDbGllbnQuYmFsYW5jZSsiLCBjdXJyZW50Q2xpZW50LnVucGFpZF9iYWxhbmNlPSIrY3VycmVudENsaWVudC51bnBhaWRfYmFsYW5jZSk7CiAgLy8gICBpZiAoY3VycmVudENsaWVudC51bnBhaWRfYmFsYW5jZT5jdXJyZW50Q2xpZW50LmJhbGFuY2UpCiAgLy8gICB7CiAgLy8gICAgICRzY29wZS5iYWxhbmNlVG9QYXk9Y3VycmVudENsaWVudC51bnBhaWRfYmFsYW5jZS1jdXJyZW50Q2xpZW50LmJhbGFuY2U7CiAgLy8gICB9CiAgLy8gICBlbHNlIHsKICAvLyAgICAgJHNjb3BlLmJhbGFuY2VUb1BheT0wOwogIC8vICAgfQogIC8vIH0KZWxzZQp7CiRzY29wZS5iYWxhbmNlVG9QYXk9MDsKfQokc2NvcGUucGF5bWVudFR5cGVUaXRsZT0i15HXl9eoIjsKJHNjb3BlLmN1cnJlbnRDbGllbnQ9Y3VycmVudENsaWVudDsKbG9nRGVidWcoJHNjb3BlLmN1cnJlbnRDbGllbnQpOwokc2NvcGUuYnVzaW5lc3NDb25maWcgPSBCdXNpbmVzc0NvbmZpZy5nZXQoKTsKJHNjb3BlLmJ1c2luZXNzQ29uZmlnLnRoZW4oZnVuY3Rpb24gKGNvbmZpZykgewokc2NvcGUuaW52b2ljZV9zb3VyY2VfaWQgPSBjb25maWcuaW52b2ljZV9zb3VyY2VfaWQ7CiRzY29wZS5oYXNWYXQgPSBjb25maWcudmF0X3JhdGUgPiAwOwp9KTsKCiRzY29wZS5jbG9zZU1vZGFsID0gZnVuY3Rpb24oKSB7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKfTsKCiRzY29wZS5leHRlcm5hbF9pbnZvaWNlX2dlbmVyYXRlZD1mYWxzZTsKJHNjb3BlLmludm9pY2VfZGF0ZV9mb3JtYXQ9bmV3IERhdGUoKTsKCmdldE5leHRJbnZvaWNlTnVtYmVyKCRodHRwLCRzY29wZSwkc2NvcGUuY3VycmVudENsaWVudC5idXNpbmVzc191c2VyX2lkLCdpbnZvaWNlX251bWJlcicpOwoKJHNjb3BlLnBheW1lbnRNZXRob2RzID0gcGF5bWVudE1ldGhvZHM7CiRzY29wZS5jcmVkaXRDYXJkVHlwZXMgPSBjcmVkaXRDYXJkVHlwZXM7CiRzY29wZS5jcmVkaXRUcmFuc2FjdGlvblR5cGVzID0gY3JlZGl0VHJhbnNhY3Rpb25UeXBlczsKJHNjb3BlLmJhbmtzID0gYmFua3M7CgovLyBpbmRpY2F0aW9uIHdoZXRoZXIgcGF5bWVudCBtZXRob2Qgd2FzIHNlbGVjdGVkCiRzY29wZS5pc1BheW1lbnRNZXRob2RTZWxlY3RlZD1mYWxzZTsKJHNjb3BlLnNlbGVjdFBheW1lbnRNZXRob2QgPSBmdW5jdGlvbihwYXltZW50KSB7CiRzY29wZS5wYXltZW50VHlwZVRpdGxlPXBheW1lbnQubmFtZTsKJHNjb3BlLnNlbGVjdGVkUGF5bWVudE1ldGhvZD1wYXltZW50Owokc2NvcGUuaXNQYXltZW50TWV0aG9kU2VsZWN0ZWQ9dHJ1ZTsKfTsKCiRzY29wZS51cGRhdGVCYWxhbmNlID0gZnVuY3Rpb24gdXBkYXRlQmFsYW5jZSAoaXNTb3VyY2VXaXRoVmF0KSB7CiRzY29wZS5idXNpbmVzc0NvbmZpZy50aGVuKGZ1bmN0aW9uIChjb25maWcpIHsKaWYgKGlzU291cmNlV2l0aFZhdCkgewokc2NvcGUuYmFsYW5jZVRvUGF5Tm9WYXQgPSBOdW1iZXIoKCRzY29wZS5iYWxhbmNlVG9QYXkgLyAoMSArIGNvbmZpZy52YXRfcmF0ZSkpLnRvRml4ZWQoMikpOwp9IGVsc2Ugewokc2NvcGUuYmFsYW5jZVRvUGF5ID0gTnVtYmVyKCgkc2NvcGUuYmFsYW5jZVRvUGF5Tm9WYXQgKiAoMSArIGNvbmZpZy52YXRfcmF0ZSkpLnRvRml4ZWQoMikpOwp9Cn0pCn07Cgokc2NvcGUubWFrZVBheW1lbnQgPSBmdW5jdGlvbigpCnsKbG9nRGVidWcoY3VycmVudENsaWVudCk7CmxvZ0RlYnVnKCJwYXltZW50IG1ldGhvZCIpOwpsb2dEZWJ1Zygkc2NvcGUuc2VsZWN0ZWRQYXltZW50TWV0aG9kKTsKbG9nRGVidWcoIiRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2dlbmVyYXRlZD08Iiskc2NvcGUuaW52b2ljZV9nZW5lcmF0ZWQrIj4iKTsKCmlmICgoJHNjb3BlLmJhbGFuY2VUb1BheT09MCkgfHwgKCRzY29wZS5iYWxhbmNlVG9QYXk9PScnKXx8ICgkc2NvcGUuYmFsYW5jZVRvUGF5PT1udWxsKSkKewokc2NvcGUudXNlckVycm9yPSLXkNeg15Ag15TXltefINeh15vXldedINeb15zXqdeU15UiOwp9CmVsc2UgaWYgKCEkc2NvcGUuaXNQYXltZW50TWV0aG9kU2VsZWN0ZWQpCnsKJHNjb3BlLnVzZXJFcnJvcj0i15DXoNeQINeR15fXqCDXkNee16bXoteZINeq16nXnNeV150iOwovLyBhbGVydCgnc3MnKTsKfQplbHNlCnsKaWYgKCgkc2NvcGUuaW52b2ljZV9nZW5lcmF0ZWQhPTEpIHx8ICgkc2NvcGUuaW52b2ljZV9kYXRlX2Zvcm1hdD09bnVsbCkpCnsKdmFyIGludm9pY2VfZGF0ZV9mb3JtYXQgPSAibnVsbCI7Cn0KZWxzZQp7CnZhciBpbnZvaWNlX2RhdGVfZm9ybWF0ID0gJHNjb3BlLmludm9pY2VfZGF0ZV9mb3JtYXQuZ2V0RGF0ZSgpICArICItIiArICgkc2NvcGUuaW52b2ljZV9kYXRlX2Zvcm1hdC5nZXRNb250aCgpKzEpICsgIi0iICsgJHNjb3BlLmludm9pY2VfZGF0ZV9mb3JtYXQuZ2V0RnVsbFllYXIoKTsKfQppZiAoaXNwbHVzKQp7CndoYXRUb1BheT0kc2NvcGUuYmFsYW5jZVRvUGF5Owp9CmVsc2Ugewp3aGF0VG9QYXk9LSRzY29wZS5iYWxhbmNlVG9QYXk7Cn0KdGhlZGF0YT0gewpiYWxhbmNlVG9QYXk6IHdoYXRUb1BheSwKYmFsYW5jZVRvUGF5Tm9WYXQ6ICRzY29wZS5iYWxhbmNlVG9QYXlOb1ZhdCAqIChpc3BsdXMgPyArMSA6IC0xKSwKcGF5bWVudF9tZXRob2RfbmFtZTogJHNjb3BlLnNlbGVjdGVkUGF5bWVudE1ldGhvZC5tZXRob2QsCmludm9pY2VfbnVtYmVyOiAkc2NvcGUuaW52b2ljZV9udW1iZXIsCmludm9pY2VfZ2VuZXJhdGVkOiAkc2NvcGUuaW52b2ljZV9nZW5lcmF0ZWQsCmludm9pY2VfZGF0ZTogaW52b2ljZV9kYXRlX2Zvcm1hdCwKYmFua19jb21wYW55X2NvZGU6ICRzY29wZS5iYW5rX2NvbXBhbnlfY29kZSwKYmFua19icmFuY2hfbnVtYmVyOiAkc2NvcGUuYmFua19icmFuY2hfbnVtYmVyLApjaGVja19udW1iZXI6ICRzY29wZS5jaGVja19udW1iZXIsCmFjY291bnRfbnVtYmVyOiAkc2NvcGUuYWNjb3VudF9udW1iZXIsCmNyZWRpdF9jYXJkX251bWJlcjogJHNjb3BlLmNyZWRpdF9jYXJkX251bWJlciwKY3JlZGl0X2NhcmRfdHlwZTogJHNjb3BlLmNyZWRpdF9jYXJkX3R5cGUsCmNyZWRpdF9jYXJkX3RyYW5zYWN0aW9uX3R5cGU6ICRzY29wZS5jcmVkaXRfY2FyZF90cmFuc2FjdGlvbl90eXBlLAppbnZvaWNlX2NvbW1lbnRzOiAkc2NvcGUuaW52b2ljZV9jb21tZW50cwp9Owokc2NvcGUua3V6ZUlzTG9hZGluZz10cnVlOwpjcmVhdGVQYXltZW50Rm9yQ2xpZW50KCRodHRwLCRzY29wZSxjdXJyZW50Q2xpZW50LmJ1c2luZXNzX3VzZXJfaWQsdGhlZGF0YSxjcmVhdGVQYXltZW50Rm9yQ2xpZW50X3N1Y2Nlc3MsIGNyZWF0ZVBheW1lbnRGb3JDbGllbnRfZmFpbHVyZSk7CmZ1bmN0aW9uIGNyZWF0ZVBheW1lbnRGb3JDbGllbnRfc3VjY2VzcygpCnsKJHNjb3BlLmt1emVJc0xvYWRpbmc9ZmFsc2U7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKbG9nRGVidWcoImJyb2FkY2FzdGluZyBjbGllbnRQYWdlUmVsb2FkRGF0YSIpOwokcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NsaWVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCmxvZ0RlYnVnKCJicm9hZGNhc3RpbmcgZXZlbnRQYWdlUmVsb2FkRGF0YSIpOwokcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2V2ZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKLy8gbG9nRGVidWcoImJyb2FkY2FzdGluZyByZWxvYWRFdmVudCIpOwovLyAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ3JlbG9hZEV2ZW50Jyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCn0KZnVuY3Rpb24gY3JlYXRlUGF5bWVudEZvckNsaWVudF9mYWlsdXJlKCkKewokc2NvcGUua3V6ZUlzTG9hZGluZz1mYWxzZTsKfQp9Cn0KfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdldmVudERldGFpbHNCdXNpbmVzc0NhbGVuZGFyTW9kYWxDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIHNlbGVjdGVkRXZlbnQsIHVpQ2FsZW5kYXJDb25maWcpIHsKdmFyIGRheU5hbWVzID0gWyfXqNeQ16nXldefJywgJ9ep16DXmScsICfXqdec15nXqdeZJywgJ9eo15HXmdei15knLCAn15fXnteZ16nXmScsICfXqdeZ16nXmScsICfXqdeR16onXTsKCiRzY29wZS5nb3RvQ2xpZW50UGFnZT0gZnVuY3Rpb24gKGJ1c2luZXNVc2VyaWQpCnsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwpnb3RvQ2xpZW50UGFnZShidXNpbmVzVXNlcmlkKTsKfQokc2NvcGUuZWRpdEV2ZW50PSBmdW5jdGlvbiAodGhlZXZlbnQpCnsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwpnb3RvRXZlbnRQYWdlKHRoZWV2ZW50KTsKfQoKbG9nRGVidWcoInNlbGVjdGVkIEV2ZW50IGluZm8gPSIgKyBKU09OLnN0cmluZ2lmeShzZWxlY3RlZEV2ZW50LCBudWxsLCAyKSk7CiRzY29wZS5zZWxlY3RlZEV2ZW50ID0gc2VsZWN0ZWRFdmVudDsKc2VsZWN0ZWREYXRlU3RhcnQgPSBuZXcgRGF0ZShzZWxlY3RlZEV2ZW50LnN0YXJ0KTsKdmFyIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZSgpICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKCiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRIb3VycygpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBzZWxlY3RlZERhdGVTdGFydC5nZXRNaW51dGVzKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZG93ID0gZGF5TmFtZXNbc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RGF5KCldOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRhdGUgPSBzZWxlY3RlZERhdGVTdGFydDsKCiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0RGF5ID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RGF0ZSgpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydE1vbnRoID0gMSArIHNlbGVjdGVkRGF0ZVN0YXJ0LmdldE1vbnRoKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0TW9udGhUeHQgPSBtb250aE5hbWVzWyRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0TW9udGggLSAxXTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRZZWFyID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RnVsbFllYXIoKTsKCnNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKHNlbGVjdGVkRXZlbnQuZW5kKTsKdmFyIHNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKHNlbGVjdGVkRGF0ZUVuZC5nZXRUaW1lKCkgKyBzZWxlY3RlZERhdGVFbmQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKCiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzID0gc2VsZWN0ZWREYXRlRW5kLmdldEhvdXJzKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGRvdyA9IGRheU5hbWVzW3NlbGVjdGVkRGF0ZUVuZC5nZXREYXkoKV07CiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKSA8IDEwID8gJzAnIDogJycpICsgc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKTsKJHNjb3BlLm9rTGltaXRhdGlvbk1vZGFsID0gZnVuY3Rpb24oKSB7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKfTsKCiRzY29wZS5kZWxldGVMaW1pdGF0aW9uTW9kYWwgPSBmdW5jdGlvbigpIHsKJHVpYk1vZGFsSW5zdGFuY2UuZGlzbWlzcygnZGVsZXRlJyk7CmNhbGVuZGFyID0gJ2NhbGVuZGFyX2J1c2luZXNzJzsKCiRzY29wZS5kZWxldGVDYWxlbmRhckRCRXZlbnQoc2VsZWN0ZWRFdmVudCwgY2FsZW5kYXIpOwp9Owokc2NvcGUuZGVsZXRlQ2FsZW5kYXJKU0V2ZW50ID0gZnVuY3Rpb24oY2FsZW5kYXIsIHNlbGVjdGVkRXZlbnRpZCkgewoKbG9nRGVidWcoImNhbGVuZGFyX2hvdXJzX29mX3dvcmtfY29uZmlnPSIgKyB1aUNhbGVuZGFyQ29uZmlnKTsKbG9nRGVidWcoInVpQ2FsZW5kYXJDb25maWdbY2FsZW5kYXJdPSIgKyB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1snY2FsZW5kYXJfYnVzaW5lc3MnXSk7CmxvZ0RlYnVnKCJkZWxldGUganMgZXZlbnQgIiArIHNlbGVjdGVkRXZlbnRpZCk7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlbW92ZUV2ZW50cycsIFtzZWxlY3RlZEV2ZW50aWRdKTsgLy8gZ28gdG8gZGF0ZSBpbiBjYWxlbmRhciBnb3RvCn07CiRzY29wZS5kZWxldGVDYWxlbmRhckRCRXZlbnQgPSBmdW5jdGlvbihzZWxlY3RlZEV2ZW50LCBjYWxlbmRhcikgewpsb2dEZWJ1ZygiZGVsZXRlIGV2ZW50ICIgKyBzZWxlY3RlZEV2ZW50LmlkKTsKJGh0dHAoewptZXRob2Q6ICdQT1NUJywKdXJsOiAnL2FwaS9hZG1pbi9ldmVudHMvZGVsZXRlLycgKyBzZWxlY3RlZEV2ZW50LmlkLApkYXRhOiB7CnRlbXBfbGltaXRfaWQ6IHNlbGVjdGVkRXZlbnQudGVtcF9saW1pdF9pZAp9LApoZWFkZXJzOiB7CidDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbjtjaGFyc2V0PXV0Zi04Jwp9Cn0pLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkgewoKbG9nRGVidWcoZGF0YSk7CmlmICghZGF0YS5zdWNjZXNzKSB7CmxvZ0RlYnVnKCJkZWxldGUgbGltaXRfaWQgZXJyb3IgKyIgKyBkYXRhLm1lc3NhZ2UpOwovLyBpZiBub3Qgc3VjY2Vzc2Z1bCwgYmluZCBlcnJvcnMgdG8gZXJyb3IgdmFyaWFibGVzCi8vCQkJICAkc2NvcGUuZXJyb3JOYW1lID0gZGF0YS5lcnJvcnMubmFtZTsKLy8JCQkgICRzY29wZS5lcnJvclN1cGVyaGVybyA9IGRhdGEuZXJyb3JzLnN1cGVyaGVyb0FsaWFzOwp9IGVsc2Ugewpsb2dEZWJ1ZygiZGVsZXRlIGxpbWl0X2lkIHN1Y2Nlc3MiKTsKLy8gaWYgc3VjY2Vzc2Z1bCwgYmluZCBzdWNjZXNzIG1lc3NhZ2UgdG8gbWVzc2FnZQovLwkJCSAgJHNjb3BlLm1lc3NhZ2UgPSBkYXRhLm1lc3NhZ2U7CiRzY29wZS5kZWxldGVDYWxlbmRhckpTRXZlbnQoY2FsZW5kYXIsIHNlbGVjdGVkRXZlbnQuaWQpOwoKfQp9KTsKCmxvZ0RlYnVnKCJhZnRlciByZW1vdmUgZXZlbnQiKTsKfTsKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2V2ZW50UmVjdXJyaW5nRGV0YWlsc0J1c2luZXNzQ2FsZW5kYXJNb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgc2VsZWN0ZWRFdmVudCwgdWlDYWxlbmRhckNvbmZpZykgewp2YXIgZGF5TmFtZXMgPSBbJ9eo15DXqdeV158nLCAn16nXoNeZJywgJ9ep15zXmdep15knLCAn16jXkdeZ16LXmScsICfXl9ee15nXqdeZJywgJ9ep15nXqdeZJywgJ9ep15HXqiddOwoKJHNjb3BlLmdvdG9DbGllbnRQYWdlPSBmdW5jdGlvbiAoYnVzaW5lc3NVc2VyaWQpCnsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwpnb3RvQ2xpZW50UGFnZShidXNpbmVzc1VzZXJpZCk7Cn0KJHNjb3BlLmVkaXRFdmVudD0gZnVuY3Rpb24gKHRoZWV2ZW50KQp7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKZ290b0V2ZW50UGFnZSh0aGVldmVudCk7Cn0KCgpsb2dEZWJ1Zygic2VsZWN0ZWQgUmVjdXJyaW5nIEV2ZW50IGluZm8gPSIgKyBKU09OLnN0cmluZ2lmeShzZWxlY3RlZEV2ZW50LCBudWxsLCAyKSk7CiRzY29wZS5zZWxlY3RlZEV2ZW50ID0gc2VsZWN0ZWRFdmVudDsKc2VsZWN0ZWREYXRlU3RhcnQgPSBuZXcgRGF0ZShzZWxlY3RlZEV2ZW50LnN0YXJ0KTsKdmFyIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZSgpICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKCi8vIGxvZ0RlYnVnKCJzZWxlY3RlZEV2ZW50LnN0YXJ0PSIgKyBzZWxlY3RlZEV2ZW50LnN0YXJ0KTsKLy8gbG9nRGVidWcoImRhdGU9IiArIHNlbGVjdGVkRGF0ZVN0YXJ0KTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycyA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldEhvdXJzKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcyA9IChzZWxlY3RlZERhdGVTdGFydC5nZXRNaW51dGVzKCkgPCAxMCA/ICcwJyA6ICcnKSArIHNlbGVjdGVkRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkb3cgPSBkYXlOYW1lc1tzZWxlY3RlZERhdGVTdGFydC5nZXREYXkoKV07CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF0ZSA9IHNlbGVjdGVkRGF0ZVN0YXJ0OwoKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnREYXkgPSBzZWxlY3RlZERhdGVTdGFydC5nZXREYXRlKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0TW9udGggPSAxICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TW9udGgoKTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRNb250aFR4dCA9IG1vbnRoTmFtZXNbJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRNb250aCAtIDFdOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydFllYXIgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRGdWxsWWVhcigpOwoKc2VsZWN0ZWREYXRlRW5kID0gbmV3IERhdGUoc2VsZWN0ZWRFdmVudC5lbmQpOwp2YXIgc2VsZWN0ZWREYXRlRW5kID0gbmV3IERhdGUoc2VsZWN0ZWREYXRlRW5kLmdldFRpbWUoKSArIHNlbGVjdGVkRGF0ZUVuZC5nZXRUaW1lem9uZU9mZnNldCgpICogNjAwMDApOwoKLy8gbG9nRGVidWcoInNlbGVjdGVkRXZlbnQuZW5kPSIgKyBzZWxlY3RlZEV2ZW50LmVuZCk7Ci8vIGxvZ0RlYnVnKCJkYXRlPSIgKyBzZWxlY3RlZERhdGVFbmQpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycyA9IHNlbGVjdGVkRGF0ZUVuZC5nZXRIb3VycygpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRkb3cgPSBkYXlOYW1lc1tzZWxlY3RlZERhdGVFbmQuZ2V0RGF5KCldOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzID0gKHNlbGVjdGVkRGF0ZUVuZC5nZXRNaW51dGVzKCkgPCAxMCA/ICcwJyA6ICcnKSArIHNlbGVjdGVkRGF0ZUVuZC5nZXRNaW51dGVzKCk7CiRzY29wZS5va0xpbWl0YXRpb25Nb2RhbCA9IGZ1bmN0aW9uKCkgewokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7Cn07Cgp9KTsKCmt1emVBcHAuY29udHJvbGxlcignZXZlbnREZXRhaWxzSG91cnNPZldvcmtNb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgc2VsZWN0ZWRFdmVudCwgZml4ZWRTY2hlZHVsZSwgdWlDYWxlbmRhckNvbmZpZykgewp2YXIgZGF5TmFtZXMgPSBbJ9eo15DXqdeV158nLCAn16nXoNeZJywgJ9ep15zXmdep15knLCAn16jXkdeZ16LXmScsICfXl9ee15nXqdeZJywgJ9ep15nXqdeZJywgJ9ep15HXqiddOwoKLy8gbG9nRGVidWcoInNlbGVjdGVkIEV2ZW50ID0iICsgSlNPTi5zdHJpbmdpZnkoc2VsZWN0ZWRFdmVudCwgbnVsbCwgNCkpOwokc2NvcGUuZml4ZWRTY2hlZHVsZT1maXhlZFNjaGVkdWxlOwokc2NvcGUuc2VsZWN0ZWRFdmVudCA9IHNlbGVjdGVkRXZlbnQ7CiRzY29wZS5zZWxlY3RlZEV2ZW50Lm9yaWdfZXZlbnRfdHlwZXMgPSBhbmd1bGFyLmNvcHkoc2VsZWN0ZWRFdmVudC5ldmVudF90eXBlcyk7CiRzY29wZS5uZXdFdmVudERldGFpbHMgPSBbXTsKCmdldEJ1c2luZXNzTG9jYXRpb25zKCRodHRwLCRzY29wZSwnYnVzaW5lc3NfbG9jYXRpb25zJyk7Cgpsb2dEZWJ1ZygiaG91cnMgb2Ygd29yayBibG9jay9ldmVudCBjbGlja2VkICIrSlNPTi5zdHJpbmdpZnkoJHNjb3BlLnNlbGVjdGVkRXZlbnQpKTsKCnNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc2VsZWN0ZWRFdmVudC5zdGFydCk7CnZhciBzZWxlY3RlZERhdGVTdGFydCA9IG5ldyBEYXRlKHNlbGVjdGVkRGF0ZVN0YXJ0LmdldFRpbWUoKSArIHNlbGVjdGVkRGF0ZVN0YXJ0LmdldFRpbWV6b25lT2Zmc2V0KCkgKiA2MDAwMCk7CmdldEFsbEluc3RydWN0b3JzKCRodHRwLCRzY29wZSwnaW5zdHJ1Y3RvcnMnKTsKZ2V0Tm9DbGFzc0V2ZW50VHlwZXNOb0FkbWluKCRodHRwLCRzY29wZSwncmVsYXRlZEV2ZW50VHlwZXMnLGdldE5vQ2xhc3NFdmVudFR5cGVzTm9BZG1pbl9zdWNjZXNzKTsKZnVuY3Rpb24gZ2V0Tm9DbGFzc0V2ZW50VHlwZXNOb0FkbWluX3N1Y2Nlc3MoKQp7CmZvcih2YXIgaSA9IDA7IGkgPCAkc2NvcGUuc2VsZWN0ZWRFdmVudC5ldmVudF90eXBlcy5sZW5ndGg7IGkrKykKewovLyBjb3B5aW5nIHRoZSBhY3R1YWwgb2JqZWN0IG9mICRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50X3R5cGVzW2ldCmZvcih2YXIgaiA9IDA7IGogPCAkc2NvcGUucmVsYXRlZEV2ZW50VHlwZXMubGVuZ3RoOyBqKyspCnsKaWYgKCRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50X3R5cGVzW2ldLmV2ZW50X3R5cGVfaWQ9PSRzY29wZS5yZWxhdGVkRXZlbnRUeXBlc1tqXS5ldmVudF90eXBlX2lkKQp7CiRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50X3R5cGVzW2ldPWFuZ3VsYXIuY29weSgkc2NvcGUucmVsYXRlZEV2ZW50VHlwZXNbal0pOwp9Cn0KfQp9CgovLyBsb2dEZWJ1Zygic2VsZWN0ZWRFdmVudC5zdGFydD0iICsgc2VsZWN0ZWRFdmVudC5zdGFydCk7Ci8vIGxvZ0RlYnVnKCJkYXRlPSIgKyBzZWxlY3RlZERhdGVTdGFydCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRIb3VycygpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBzZWxlY3RlZERhdGVTdGFydC5nZXRNaW51dGVzKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZG93ID0gZGF5TmFtZXNbc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RGF5KCldOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRhdGUgPSBzZWxlY3RlZERhdGVTdGFydDsKCnNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKHNlbGVjdGVkRXZlbnQuZW5kKTsKdmFyIHNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKHNlbGVjdGVkRGF0ZUVuZC5nZXRUaW1lKCkgKyBzZWxlY3RlZERhdGVFbmQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKCiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bW9udGggPSBtb250aE5hbWVzW3NlbGVjdGVkRGF0ZVN0YXJ0LmdldE1vbnRoKCldOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoMTEyID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TW9udGgoKSsxOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRheW9mbW9udGggPSBzZWxlY3RlZERhdGVTdGFydC5nZXREYXRlKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0eWVhciA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCk7Ci8vICRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZV9pbnB1dF9mb3JtYXQ9IG5ldyBEYXRlKDE5NzAsIDAsIDEsICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMsICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcywgMCk7CgovLyBsb2dEZWJ1Zygic2VsZWN0ZWRFdmVudC5lbmQ9IiArIHNlbGVjdGVkRXZlbnQuZW5kKTsKLy8gbG9nRGVidWcoImRhdGU9IiArIHNlbGVjdGVkRGF0ZUVuZCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzID0gc2VsZWN0ZWREYXRlRW5kLmdldEhvdXJzKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGRvdyA9IGRheU5hbWVzW3NlbGVjdGVkRGF0ZUVuZC5nZXREYXkoKV07CiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKSA8IDEwID8gJzAnIDogJycpICsgc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKTsKCgokc2NvcGUub2tMaW1pdGF0aW9uTW9kYWwgPSBmdW5jdGlvbigpIHsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwp9OwoKJHNjb3BlLnVwZGF0ZUxpbWl0YXRpb25Nb2RhbCA9IGZ1bmN0aW9uKCkKewpsb2dEZWJ1ZygiZnVuY3Rpb246IHVwZGF0ZUxpbWl0YXRpb25Nb2RhbCIpOwppZiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRfdHlwZXMubGVuZ3RoPDEpCnsKcmV0dXJuIGZhbHNlOwp9CmlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vyczwkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKQp7CmFsZXJ0KCLXltee158g16HXmdeV150g15zXpNeg15kg15bXntefINeU16rXl9ec15QiKTsKcmV0dXJuIGZhbHNlOwp9CmlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vycz09JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykKewppZiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlczw9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKQp7CmFsZXJ0KCLXltee158g16HXmdeV150g15zXpNeg15kg15bXntefINeU16rXl9ec15QiKTsKcmV0dXJuIGZhbHNlOwp9CmlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzPCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMrMTApKQp7CmFsZXJ0KCLXkdec15XXpyDXp9eY158g154tMTAg15PXp9eV16oiKTsKcmV0dXJuIGZhbHNlOwp9Cn0KCgpmdW5jdGlvbiB1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25fc3VjY2VzcygpCnsKY2FsZW5kYXIgPSAnY2FsZW5kYXJfaG91cnNfb2Zfd29yayc7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsgLy8gZ28gdG8gZGF0ZSBpbiBjYWxlbmRhciBnb3RvCiR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoJ2RlbGV0ZScpOwp9CgppZiAoJHNjb3BlLmZpeGVkU2NoZWR1bGUpCnsKLy8gZml4ZWQgc2NoZWR1bGUgLSB1cGFkdGluZyBsaW1pdGF0aW9uIDE5NzAKdGhlZGF0YSA9IHsKc3RhcnRfZGF0ZTogbmV3X3N0YXJ0LAplbmRfZGF0ZTogbmV3X2VuZCwKdGVtcF9saW1pdF9pZDogbnVsbCwKbGltaXRfaWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmxpbWl0X2lkLApldmVudF90eXBlczogJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRfdHlwZXMsCmxvY2F0aW9uX2lkOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5sb2NhdGlvbl9pZCwKb3JpZ19ldmVudF90eXBlczogJHNjb3BlLnNlbGVjdGVkRXZlbnQub3JpZ19ldmVudF90eXBlcywKZW1wX2lkOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbXBfaWQKfTsKdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uKCRodHRwLCRzY29wZSx0aGVkYXRhLCRzY29wZS5zZWxlY3RlZEV2ZW50LmxpbWl0X2lkLCB1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25fc3VjY2Vzcyk7Cn0KZWxzZQovLyBub3QgZml4ZWQgc2NoZWR1bGUgLSBwZXJkYXkgYmxvY2sKewovLy8vLy8vLy8vLwppZiAoKCRzY29wZS5zZWxlY3RlZEV2ZW50LmxpbWl0X2lkICE9IG51bGwpICYgKCRzY29wZS5zZWxlY3RlZEV2ZW50LmRheV9saW1pdF9pZCA9PSAtMSkpIC8vIGV2ZW50IGxpbWl0YXRpb24gaGFzIGxpbWl0X2lkIHNvIGl0cyBhbiAxOTcwIGV2ZW50Ci8vIG5lZWQgdG8gYWRkIGEgbmV3IHBlcmRheSBsaW1pdGF0aW9uIHRoYXQgcG9pbnQgKGxpbWl0X2lkKSB0byB0aGUgb2xkIDE5NzAgZXZlbnQgdG8gcmVwbGFjdGUgaXQKewp0ZW1wX2xpbWl0X2lkID0gY2FsY190ZW1wX2xpbWl0X2lkKCk7Ci8vIHRoZWV2ZW50LnRlbXBfbGltaXRfaWQgPSB0ZW1wX2xpbWl0X2lkOwovLyB0aGVldmVudC5kYXlfbGltaXRfaWQgPSB0ZW1wX2xpbWl0X2lkOwovLyB0aGUgbW92ZWQgZXZlbnQgaW4gdGhlIGNhbGVuZGFyIG5vdyBoYXMgZGF5X2xpbWl0X2lkIGFuZCB0ZW1wX2xpbWl0X2lkCi8vIGlmIGl0cyBsb2FkZWQgZnJvbSB0aGUgZGIsIGl0IHdpbGwgb25seSBoYXZlIGRheV9saW1pdF9pZCAoYW5kIG5vdCB0aGUgdGVtcCBvbmUpCi8vIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWydjYWxlbmRhcl9ob3Vyc19vZl93b3JrJ10uZnVsbENhbGVuZGFyKCd1cGRhdGVFdmVudCcsIHRoZWV2ZW50KTsKLy8gY29uc29sZS5sb2coIlhYWFhYWFhYWFhYWFgiKTsKdGhlZGF0YSA9IHsKc3RhcnRfZGF0ZTogbmV3X3N0YXJ0LAplbmRfZGF0ZTogbmV3X2VuZCwKY29sb3I6ICcnLAp0ZW1wX2xpbWl0X2lkOiAwLApldmVudF90eXBlX2lkOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5ldmVudF90eXBlX2lkLApldmVudF90eXBlczogJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRfdHlwZXMsCmxpbWl0X2lkOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5pZCwKbG9jYXRpb25faWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmxvY2F0aW9uX2lkLAplbXBfaWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmVtcF9pZAovLyB0aXRsZTogdGhlZXZlbnQudGl0bGUKfTsKY3JlYXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5KCRodHRwLCRzY29wZSx0aGVkYXRhLHVwZGF0ZUNhbGVuZGFyTGltaXRhdGlvbl9zdWNjZXNzKTsKCn0KZWxzZQp7CnRoZWRhdGE9IHsKc3RhcnRfZGF0ZTogbmV3X3N0YXJ0LAplbmRfZGF0ZTogbmV3X2VuZCwKdGVtcF9kYXlfbGltaXRfaWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LnRlbXBfbGltaXRfaWQsCm9yaWdfZXZlbnRfdHlwZXM6ICRzY29wZS5zZWxlY3RlZEV2ZW50Lm9yaWdfZXZlbnRfdHlwZXMsCmV2ZW50X3R5cGVzOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5ldmVudF90eXBlcywKbG9jYXRpb25faWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmxvY2F0aW9uX2lkLApkYXlfbGltaXRfaWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmRheV9saW1pdF9pZCwKZW1wX2lkOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbXBfaWQKfTsKdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5KCRodHRwLCRzY29wZSx0aGVkYXRhLHVwZGF0ZUNhbGVuZGFyTGltaXRhdGlvbl9zdWNjZXNzKTsKfQp9Cn0KJHNjb3BlLmRlbGV0ZUxpbWl0YXRpb25Nb2RhbCA9IGZ1bmN0aW9uKCkgewpjYWxlbmRhciA9ICdjYWxlbmRhcl9ob3Vyc19vZl93b3JrJzsKCi8vIHJlbW92aW5nIGxpbWl0YXRpb24gZnJvbSBkYXRhYmFzZSwgaWYgdHJ1ZSAtIHJlbW92aW5nIGZyb20gZGlzcGxheSBhbHNvCmlmICgkc2NvcGUuZGVsZXRlQ2FsZW5kYXJEQkxpbWl0YXRpb25FdmVudChzZWxlY3RlZEV2ZW50KSkKewovLyAkc2NvcGUuZGVsZXRlQ2FsZW5kYXJKU0V2ZW50KGNhbGVuZGFyLCBzZWxlY3RlZEV2ZW50LmlkKTsKfQokdWliTW9kYWxJbnN0YW5jZS5kaXNtaXNzKCdkZWxldGUnKTsKfTsKJHNjb3BlLmRlbGV0ZUNhbGVuZGFySlNFdmVudCA9IGZ1bmN0aW9uKGNhbGVuZGFyLCBzZWxlY3RlZEV2ZW50aWQpIHsKCmxvZ0RlYnVnKCJjYWxlbmRhcl9ob3Vyc19vZl93b3JrX2NvbmZpZz0iICsgdWlDYWxlbmRhckNvbmZpZyk7CmxvZ0RlYnVnKCJ1aUNhbGVuZGFyQ29uZmlnW2NhbGVuZGFyXT0iICsgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnXSk7CmxvZ0RlYnVnKCJkZWxldGUganMgZXZlbnQgIiArIHNlbGVjdGVkRXZlbnRpZCk7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlbW92ZUV2ZW50cycsIFtzZWxlY3RlZEV2ZW50aWRdKTsgLy8gZ28gdG8gZGF0ZSBpbiBjYWxlbmRhciBnb3RvCn07CiRzY29wZS5kZWxldGVDYWxlbmRhckRCTGltaXRhdGlvbkV2ZW50ID0gZnVuY3Rpb24oc2VsZWN0ZWRFdmVudCkgewpjYWxlbmRhciA9ICdjYWxlbmRhcl9ob3Vyc19vZl93b3JrJzsKLy8gcmV0dXJuIGZhbHNlOwoKLy8gZGVsZXRpbmcgZXZlbnQgbGltaXRhdGlvbiAobm90IHBlciBkYXkpCi8vIGVpdGhlciBmcm9tIDE5NzAgKGhvdXJzX29mX3dvcmsgcGFnZSkKLy8gb3IgZnJvbSB0aGVpciBpbnN0YW5jZSBpbiB0aGUgY3VycmVudCB3ZWVrJ3MgbGltaXRhdGlvbi4KLy8gZWl0aGVyIHdheSBkYXlfbGltaXRfaWQgaXMgLTEgZm9yIGxpbWl0YXRpb25zIGZyb20gMTk3MAppZiAoc2VsZWN0ZWRFdmVudC5kYXlfbGltaXRfaWQgPT0gLTEpCnsKbG9nRGVidWcoInJlbW92aW5nIGV2ZW50IGxpbWl0YXRpb24sIGNoZWNraWduIGlmIGl0cyBpbiAxOTcwICh0aGUgb3JpZ2luYWwpIG9yIGFuIGluc3RhbmNlIGluIHByZXNlbnQiKTsKc2VsZWN0ZWREYXRlU3RhcnQgPSBuZXcgRGF0ZShzZWxlY3RlZEV2ZW50LnN0YXJ0KTsKLy8gaWYgaXRzIDE5NzAgdGhpcyBtZWFucyB3ZSdyZSBpbiB0aGUgaG91cnNfb2Zfd29yayBnZW5lcmFsIHBhZ2UKLy8gc28gd2Ugc2ltcGx5IGRlbGV0ZSBpdAppZiAoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSA9PSAxOTcwKQp7CmxvZ0RlYnVnKCJyZW1vdmluZyBldmVudCBsaW1pdGF0aW9uIGZyb20gMTk3MCIpOwp0aGVkYXRhPSB7CnRlbXBfbGltaXRfaWQ6IHNlbGVjdGVkRXZlbnQudGVtcF9saW1pdF9pZAp9OwpkZWxldGVDYWxlbmRhckxpbWl0YXRpb24oJGh0dHAsJHNjb3BlLHRoZWRhdGEsc2VsZWN0ZWRFdmVudC5saW1pdF9pZCwgZGVsZXRlQ2FsZW5kYXJMaW1pdGF0aW9uX3N1Y2Nlc3MpOwpmdW5jdGlvbiBkZWxldGVDYWxlbmRhckxpbWl0YXRpb25fc3VjY2VzcygpCnsKJHNjb3BlLmRlbGV0ZUNhbGVuZGFySlNFdmVudChjYWxlbmRhciwgc2VsZWN0ZWRFdmVudC5pZCk7Cn0KfQplbHNlCnsKLy8gcmVtb3ZpbmcgZXZlbnQgbGltaXRhdGlvbiBmcm9tIHRoZSBhIHNwZWNpZmljIHdlZWsKLy8gdGhpcyBtZWFucyBhZGRpbmcgZXZlbnQgbGltaXRhdGlvbiBwZXIgZGF5IHdpdGggcmFuZ2UgZW5kPXN0YXJ0Ci8vIG1heWJlIEJVRyBCVUdHWT8KbG9nRGVidWcoInggcmVtb3ZpbmcgZXZlbnQgbGltaXRhdGlvbiBmcm9tIGEgc3BlY2lmaWMgd2VlaywgdGhpcyBtZWFucyBhZGRpbmcgZXZlbnQgbGltaXRhdGlvbiBwZXIgZGF5IHdpdGggcmFuZ2UgMC0wIik7Ci8vIGxvZ0RlYnVnKEpTT04uc3RyaW5naWZ5KHNlbGVjdGVkRXZlbnQpKTsKCnRoZWRhdGEgPSB7CnN0YXJ0X2RhdGU6IHNlbGVjdGVkRXZlbnQuc3RhcnQsCmVuZF9kYXRlOiBzZWxlY3RlZEV2ZW50LnN0YXJ0LApjb2xvcjogIiMwMDAwMDAiLAp0ZW1wX2xpbWl0X2lkOiAxLApldmVudF90eXBlX2lkOiBzZWxlY3RlZEV2ZW50LmV2ZW50X3R5cGVfaWQsCmxvY2F0aW9uX2lkOiBzZWxlY3RlZEV2ZW50LmxvY2F0aW9uX2lkLApsaW1pdF9pZDogc2VsZWN0ZWRFdmVudC5saW1pdF9pZCwKdGl0bGU6IHNlbGVjdGVkRXZlbnQudGl0bGUKfTsKCmNyZWF0ZUNhbGVuZGFyTGltaXRhdGlvblBlckRheSgkaHR0cCwkc2NvcGUsdGhlZGF0YSxjcmVhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXlfc3VjY2Vzcyk7CmZ1bmN0aW9uIGNyZWF0ZUNhbGVuZGFyTGltaXRhdGlvblBlckRheV9zdWNjZXNzKCkKewokc2NvcGUuZGVsZXRlQ2FsZW5kYXJKU0V2ZW50KGNhbGVuZGFyLCBzZWxlY3RlZEV2ZW50LmlkKTsKfQp9Cn0KZWxzZQp7Ci8vIGRlbGV0aW5nIGEgcGVyZGF5IGxpbWl0YXRpb24uCi8vIGlmIGl0J3MgYSBwZXJkYXkgdGhhdCAicmVwbGFjZWQiIGEgMTk3MCBvbmUKLy8gdGhlbiB3ZSBjYW5ub3QgZGVsZXRlIGl0IChvdGhlcndpc2UgdGhlIG9yaWdpbmFsIDE5NzAgd2lsbCByZWFwcGVhcikKLy8gc28gd2Ugc2V0IGl0IHRvIHN0YXJ0PWVuZAovLyB0aGlzIG1heWJlIGEgQlVHIGFuZCBjYXVzZSBUUk9VQkxFIC8vIFRPRE8KLy8gb3RoZXdpc2Ugd2UgY2FuIGRlbGV0ZSBpdCAtIHRoZSBwZXJkYXkgLSBhcyBpdHMgYSBuZXcgcGVyZGF5IGFuZCBub3QgInJlcGxhY2luZyIgYSAxOTcwIG9uZQoKaWYgKHNlbGVjdGVkRXZlbnQubGltaXRfaWQgIT0gbnVsbCkgLy8gdGhpcyBpcyB0aGUgcGVyZGF5IHRoYXQgcmVwbGFjZXMgYSAxOTcwIG9uZSAtIHdlIHNldCBpdCB0byBzdGFydD1lbmQKewpsb2dEZWJ1ZygicmVtb3ZpbmcgZXZlbnQgbGltaXRhdGlvbiBwZXIgZGF5IHJlbGF0ZWQgdG8gMTk3MCAodXBkYXRpbmcgaXQgdG8gc3RhcnQ9ZW5kKSIpOwoKdGhlZGF0YT0gewpzdGFydF9kYXRlOiBzZWxlY3RlZEV2ZW50LnN0YXJ0LAplbmRfZGF0ZTogc2VsZWN0ZWRFdmVudC5zdGFydCwKdGVtcF9kYXlfbGltaXRfaWQ6IHNlbGVjdGVkRXZlbnQudGVtcF9saW1pdF9pZCwKZGF5X2xpbWl0X2lkOiBzZWxlY3RlZEV2ZW50LmRheV9saW1pdF9pZAp9Owp1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXkoJGh0dHAsJHNjb3BlLHRoZWRhdGEsdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5X3N1Y2Nlcyk7CgpmdW5jdGlvbiB1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXlfc3VjY2VzKCkKewokc2NvcGUuZGVsZXRlQ2FsZW5kYXJKU0V2ZW50KGNhbGVuZGFyLCBzZWxlY3RlZEV2ZW50LmlkKTsKfQp9CmVsc2UgIC8vIHRoaXMgaXMgdGhlIGNhc2Ugd2hlcmUgdGhlIHBlcmRheSBkb2VzbnQgcmVwbGFjZSBhIDE5NzAgb25lLCB3ZSBjYW4gc2ltcGx5IGRlbGV0ZSBpdAp7CmxvZ0RlYnVnKCJyZW1vdmluZyBldmVudCBsaW1pdGF0aW9uIHBlciBkYXkgcmVsYXRlZCBub3QgcmVsYXRlZCB0byAxOTcwIChzbyB3ZSdyZSBkZWxldGluZyBpdCkiKTsKdGhlZGF0YSA9IHsKdGVtcF9saW1pdF9pZDogc2VsZWN0ZWRFdmVudC50ZW1wX2xpbWl0X2lkCn07CmRlbGV0ZUNhbGVuZGFyTGltaXRhdGlvblBlckRheSgkaHR0cCwkc2NvcGUsdGhlZGF0YSxzZWxlY3RlZEV2ZW50LmRheV9saW1pdF9pZCwgZGVsZXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5X3N1Y2Nlc3MpOwpmdW5jdGlvbiBkZWxldGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXlfc3VjY2VzcygpCnsKJHNjb3BlLmRlbGV0ZUNhbGVuZGFySlNFdmVudChjYWxlbmRhciwgc2VsZWN0ZWRFdmVudC5pZCk7Cn0KfQp9CmxvZ0RlYnVnKCJhZnRlciByZW1vdmUgZXZlbnQiKTsKCn07CgoKJHNjb3BlLnN0YXJ0TWludXRlcyA9IGZ1bmN0aW9uKCkKewpsb2dEZWJ1Zygic3RhcnRNaW51dGVzICIrKCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcykpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXM9bWludXRlc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKTsKY2FsY3VsYXRlU3RhcnRUaW1lKCk7Cn0KJHNjb3BlLnN0YXJ0SG91cnMgPSBmdW5jdGlvbigpCnsKbG9nRGVidWcoInN0YXJ0SG91cnMgIitob3Vyc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzPWhvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKTsKY2FsY3VsYXRlU3RhcnRUaW1lKCk7Cn0KJHNjb3BlLmVuZE1pbnV0ZXMgPSBmdW5jdGlvbigpCnsKbG9nRGVidWcoImVuZE1pbnV0ZXMgIisoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcykpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzPW1pbnV0ZXNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpOwpjYWxjdWxhdGVFbmRUaW1lKCk7Cn0KJHNjb3BlLmVuZEhvdXJzID0gZnVuY3Rpb24oKQp7CmxvZ0RlYnVnKCJlbmRIb3VycyAiK2hvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycykpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vycz1ob3Vyc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMpOwpjYWxjdWxhdGVFbmRUaW1lKCk7Cn0KCgpmdW5jdGlvbiBjYWxjdWxhdGVTdGFydFRpbWUoKQp7CmV2ZW50WWVhcj0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXI7CmV2ZW50TW9udGg9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aDExMjsKZXZlbnREYXk9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXlvZm1vbnRoOwppZiAocGFyc2VJbnQoZXZlbnRNb250aCk8MTApCnsKZXZlbnRNb250aD0iMCIrZXZlbnRNb250aDsKfQppZiAocGFyc2VJbnQoZXZlbnREYXkpPDEwKQp7CmV2ZW50RGF5PSIwIitldmVudERheTsKfQoKbmV3X3N0YXJ0PW1vbWVudC51dGMoZXZlbnRZZWFyKyItIitldmVudE1vbnRoKyItIitldmVudERheSsiVDAwOjAwOjAwIikuYWRkKCgocGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykqNjApK3BhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcykpLCAnbWludXRlcycpOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWU9bmV3X3N0YXJ0Owpsb2dEZWJ1ZygibmV3X3N0YXJ0PSIrbmV3X3N0YXJ0KTsKfQpmdW5jdGlvbiBjYWxjdWxhdGVFbmRUaW1lKCkKewpldmVudFllYXI9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyOwpldmVudE1vbnRoPSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bW9udGgxMTI7CmV2ZW50RGF5PSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aDsKaWYgKHBhcnNlSW50KGV2ZW50TW9udGgpPDEwKQp7CmV2ZW50TW9udGg9IjAiK2V2ZW50TW9udGg7Cn0KaWYgKHBhcnNlSW50KGV2ZW50RGF5KTwxMCkKewpldmVudERheT0iMCIrZXZlbnREYXk7Cn0KCm5ld19lbmQ9bW9tZW50LnV0YyhldmVudFllYXIrIi0iK2V2ZW50TW9udGgrIi0iK2V2ZW50RGF5KyJUMDA6MDA6MDAiKS5hZGQoKChwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycykqNjApK3BhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpKSwgJ21pbnV0ZXMnKTsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmRfdGltZT1uZXdfZW5kOwpsb2dEZWJ1ZygibmV3X2VuZD0iK25ld19lbmQpOwp9CgpjYWxjdWxhdGVTdGFydFRpbWUoKTsKY2FsY3VsYXRlRW5kVGltZSgpOwoKZnVuY3Rpb24gbWludXRlc0NoYW5nZWQodGhlbWludXRlcykKewpsb2dEZWJ1ZygidGhlbWludXRlcz0iK3RoZW1pbnV0ZXMpOwppZiAodHlwZW9mIHRoZW1pbnV0ZXM9PSJ1bmRlZmluZWQiKQp7CnJldHVybiAiMDAiOwp9CnRoZW1pbnV0ZXM9cGFyc2VJbnQodGhlbWludXRlcyk7CmlmICh0aGVtaW51dGVzPjYwKQp7CnJldHVybiAiMDAiOwp9CmVsc2UgaWYgKHRoZW1pbnV0ZXM8MCkKewpyZXR1cm4gIjAwIjsKfQplbHNlIGlmICh0aGVtaW51dGVzPT0iIikKewpyZXR1cm4gIjAwIjsKfQplbHNlIGlmICh0aGVtaW51dGVzPDEwKQp7CnJldHVybiAiMCIrdGhlbWludXRlczsKfQplbHNlCnsKcmV0dXJuIHRoZW1pbnV0ZXM7Cn0KfQpmdW5jdGlvbiBob3Vyc0NoYW5nZWQodGhlaG91cnMpCnsKbG9nRGVidWcoInRoZWhvdXJzPSIrdGhlaG91cnMpOwppZiAodHlwZW9mIHRoZWhvdXJzPT0idW5kZWZpbmVkIikKewpyZXR1cm4gIjAiOwp9CnRoZWhvdXJzPXBhcnNlSW50KHRoZWhvdXJzKTsKaWYgKHRoZWhvdXJzPjI0KQp7CnJldHVybiAwOwp9CmVsc2UgaWYgKHRoZWhvdXJzPDApCnsKcmV0dXJuIDA7Cn0KZWxzZSBpZiAodGhlaG91cnM9PSIiKQp7CnJldHVybiAiMCI7Cn0KZWxzZQp7CnJldHVybiB0aGVob3VyczsKfQp9Cgp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ0V2ZW50VHlwZXNDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGNvbXBpbGUsIHVpQ2FsZW5kYXJDb25maWcsICR1aWJNb2RhbCwkbG9jYXRpb24pIHsKbG9nRGVidWcoJ0V2ZW50VHlwZXMgQ29udHJvbGxlcicpOwoKZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzKCRodHRwLCRzY29wZSwnZXZlbnRfdHlwZXMnKTsKJHNjb3BlLnNob3dFdmVudFR5cGUgPSBmdW5jdGlvbiAodGhlRXZlbnQpCnsKJGxvY2F0aW9uLnBhdGgoJy9ldmVudF90eXBlcy8nK3RoZUV2ZW50LmV2ZW50X3R5cGVfaWQpOwp9Cn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdFdmVudFR5cGVOZXdDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGNvbXBpbGUsIHVpQ2FsZW5kYXJDb25maWcsICR1aWJNb2RhbCwgJGxvY2F0aW9uKSB7CmxvZ0RlYnVnKCdFdmVudFR5cGVzIENvbnRyb2xsZXIgTmV3Jyk7Cgokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcyA9IHt9OyAvLyB0aGVzZSBhcmUgdGhlIGNvbXBsZXRlIGRldGFpbHMgZm9yIHRoZSBuZXcgZXZlbnQgLy8KJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuaXNfY2xhc3MgPSAwOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5ibG9ja0V4dHJhVGltZSA9IGZhbHNlOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5kdXJhdGlvbl9iZWZvcmVfZXZlbnQgPSAwOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5kdXJhdGlvbl9hZnRlcl9ldmVudCA9IDA7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmluaGVyaXRfbWFpbl9ob3VycyA9IDE7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF93YWl0aW5nX2xpc3QgPSAzOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5pc191cGRhdGUgPSBmYWxzZTsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMubWF4X3BhcnRpY2lwYW50cyA9IDE7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF9yZWdpc3RyYXRpb25zPTE7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmlzX3B1YmxpYz0xOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5pbnN0cnVjdG9yX2lkPTA7Cgokc2NvcGUuZXZlbnRDb2xvclN0eWxlID0ge307CmRlZmF1bHRDb2xvciA9ICcwMGE2NWEnOwokc2NvcGUuZXZlbnRDb2xvclN0eWxlW2RlZmF1bHRDb2xvcl0gPSB7Cid0cmFuc2Zvcm0nOiAncm90YXRlKDMwZGVnKScKfTsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXZlbnRDb2xvciA9ICIjIiArIGRlZmF1bHRDb2xvcjsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMgPSBbCnsiZmllbGRfbmFtZSI6Iteh15nXm9eV150g157XpNeS16kiLCJmaWVsZF9kYXRhdHlwZSI6IlRFWFRfQVJFQSIsImlzX21hbmRhdG9yeSI6MCwgImZyb21kYiI6IGZhbHNlLCAiZGJfaWRfdG9maXgiOiAwLCAiaXNfYWN0aXZlIjogMSwgIm1vZGlmaWVkIjogZmFsc2V9LAp7ImZpZWxkX25hbWUiOiLXqdeZ16LXldeo15kg15HXmdeqIiwiZmllbGRfZGF0YXR5cGUiOiJURVhUX0FSRUEiLCJpc19tYW5kYXRvcnkiOjAsICJmcm9tZGIiOiBmYWxzZSwgImRiX2lkX3RvZml4IjogMCwgImlzX2FjdGl2ZSI6IDEsICJtb2RpZmllZCI6IGZhbHNlfQpdOwoKZ2V0QWxsSW5zdHJ1Y3RvcnMoJGh0dHAsJHNjb3BlLCdpbnN0cnVjdG9ycycsZ2V0QWxsSW5zdHJ1Y3RvcnNfc3VjY2Vzcyk7CmZ1bmN0aW9uIGdldEFsbEluc3RydWN0b3JzX3N1Y2Nlc3MoKQp7Ci8vICRzY29wZS5pbnN0cnVjdG9ycy51bnNoaWZ0KHtidXNpbmVzc191c2VyX2lkOjAsIGJ1c2VyX2ZpcnN0X25hbWU6IiIsIGJ1c2VyX2xhc3RfbmFtZToiIn0pOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5pbnN0cnVjdG9yX2lkPSRzY29wZS5pbnN0cnVjdG9yc1swXS5idXNpbmVzc191c2VyX2lkOwp9Cgokc2NvcGUuZXZlbnRUeXBlRXh0cmFGaWVsZHNQb3AgPSBmdW5jdGlvbihldmVudFR5cGVQcm9wZXJ0aWVzKSB7CiAgICAgICAgbG9nRGVidWcoImV2ZW50VHlwZUV4dHJhRmllbGRzUG9wMSIpOwoKdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CmFuaW1hdGlvbjogZmFsc2UsCnRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2V2ZW50X3R5cGVfZXh0cmFfZmllbGRzLnBocCcsCmNvbnRyb2xsZXI6ICdldmVudFR5cGVFeHRyYUZpZWxkc01vZGFsQ29udHJvbGxlcicsCnNpemU6ICdsJywKcmVzb2x2ZTogewpldmVudFR5cGVQcm9wZXJ0aWVzOiBmdW5jdGlvbigpIHsKcmV0dXJuIGV2ZW50VHlwZVByb3BlcnRpZXM7Cn0KfQp9KTsKCm1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24oc2VsZWN0ZWRJdGVtKSB7CmxvZ0RlYnVnKHNlbGVjdGVkSXRlbSk7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzID0gc2VsZWN0ZWRJdGVtOwp9LCBmdW5jdGlvbigpIHsKbG9nRGVidWcoJ01vZGFsIGRpc21pc3NlZCBhdDogJyArIG5ldyBEYXRlKCkpOwp9KTsKfTsKCiRzY29wZS5jaGFuZ2VFdmVudENvbG9yID0gZnVuY3Rpb24obmV3Q29sb3IpIHsKbG9nRGVidWcoImNob29zaW5nIGNvbG9yICIgKyBuZXdDb2xvcik7CiRzY29wZS5ldmVudENvbG9yID0gbmV3Q29sb3I7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV2ZW50Q29sb3IgPSAiIyIgKyBuZXdDb2xvcjsKJHNjb3BlLmV2ZW50Q29sb3JTdHlsZSA9IHsKJ2JhY2tncm91bmQtY29sb3InOiAiIyIgKyBuZXdDb2xvcgp9Owokc2NvcGUuZXZlbnRDb2xvclN0eWxlW25ld0NvbG9yXSA9IHsKJ3RyYW5zZm9ybSc6ICdyb3RhdGUoMzBkZWcpJwp9OwoKfQoKJHNjb3BlLmFkZEV2ZW50VHlwZUNhbmNlbCA9IGZ1bmN0aW9uKCkgewokbG9jYXRpb24ucGF0aCgnL2V2ZW50X3R5cGVzJyk7Cn07CgogICAgJHNjb3BlLmR1cGxpY2F0ZUZpZWxkTmFtZXM9IiI7CiRzY29wZS5hZGRFdmVudFR5cGUgPSBmdW5jdGlvbigpIHsKICAgICAgICAvLyBjaGVjayBleHRyYSBmaWVsZHMgZHVwbGljYXRlIG5hbWVzIC0gc3RhcnQKICAgICAgICBsb2dEZWJ1ZygiYWRkRXZlbnRUeXBlOiBjaGVjayBleHRyYSBmaWVsZHMgZHVwbGljYXRlIG5hbWVzIC0gc3RhcnQiKTsKICAgICAgICB2YXIgZXh0cmFGaWVsZHNOYW1lcyA9IFtdOwogICAgICAgIGZvciAodmFyIGk9MTsgaTwkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcy5sZW5ndGg7IGkrKykKICAgICAgICB7CiAgICAgICAgICBleHRyYUZpZWxkc05hbWVzLnB1c2goJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHNbaV0uZmllbGRfbmFtZSk7CiAgICAgICAgfQogICAgICAgIGV4dHJhRmllbGRzTmFtZXMuc29ydCgpOwogICAgICAgIHZhciBsYXN0ID0gZXh0cmFGaWVsZHNOYW1lc1swXTsKICAgICAgICBmb3IgKHZhciBpPTE7IGk8ZXh0cmFGaWVsZHNOYW1lcy5sZW5ndGg7IGkrKykKICAgICAgICB7CiAgICAgICAgICAgaWYgKGV4dHJhRmllbGRzTmFtZXNbaV0gPT0gbGFzdCkKICAgICAgICAgICB7CiAgICAgICAgICAgIC8vICBhbGVydCgnRHVwbGljYXRlIDogJytsYXN0KTsKICAgICAgICAgICAgICRzY29wZS5kdXBsaWNhdGVGaWVsZE5hbWVzPSfXp9eZ15nXnSDXqdeT15Qg16rXmdei15XXkyDXqNek15XXkNeZINeb16TXldecINeR16nXnSAiJytsYXN0KyciLi4uJzsKICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICB9CiAgICAgICAgICAgbGFzdCA9IGV4dHJhRmllbGRzTmFtZXNbaV07CiAgICAgICAgfQogICAgICAgIC8vIGNoZWNrIGV4dHJhIGZpZWxkcyBkdXBsaWNhdGUgbmFtZXMgLSBlbmQKCmxvZ0RlYnVnKCJhZGQgRXZlbnQgVHlwZSIgKyAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcyArICJleHRyYSBmaWVsZHM9IiArJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMpOwppZiAoKCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF9yZWdpc3RyYXRpb25zPT0nJykgfHwgKCEkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5tYXhfcmVnaXN0cmF0aW9ucykpCnsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMubWF4X3JlZ2lzdHJhdGlvbnM9MDsKfQphZGRFdmVudFR5cGUoJGh0dHAsJHNjb3BlLCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLGFkZEV2ZW50VHlwZV9zdWNjZXNzKTsKZnVuY3Rpb24gYWRkRXZlbnRUeXBlX3N1Y2Nlc3MoKQp7CiRsb2NhdGlvbi5wYXRoKCcvZXZlbnRfdHlwZXMnKTsKfQp9Owp9KTsKCmt1emVBcHAuY29udHJvbGxlcignRXZlbnRUeXBlVXBkYXRlQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRjb21waWxlLCAkcm91dGVQYXJhbXMsIHVpQ2FsZW5kYXJDb25maWcsICR1aWJNb2RhbCwgJGxvY2F0aW9uKSB7CmV2ZW50X3R5cGVfaWQ9JHJvdXRlUGFyYW1zLmV2ZW50X3R5cGVfaWQ7CmxvZ0RlYnVnKCdFdmVudFR5cGVzIENvbnRyb2xsZXIgVXBkYXRlICcrZXZlbnRfdHlwZV9pZCk7Cgokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcyA9IHt9OyAvLyB0aGVzZSBhcmUgdGhlIGNvbXBsZXRlIGRldGFpbHMgZm9yIHRoZSBuZXcgZXZlbnQgLy8KJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuaXNfdXBkYXRlID0gdHJ1ZTsKCiRzY29wZS5ldmVudENvbG9yU3R5bGUgPSB7fTsKZ2V0QWxsSW5zdHJ1Y3RvcnMoJGh0dHAsJHNjb3BlLCdpbnN0cnVjdG9ycycsZ2V0QWxsSW5zdHJ1Y3RvcnNfc3VjY2Vzcyk7CmZ1bmN0aW9uIGdldEFsbEluc3RydWN0b3JzX3N1Y2Nlc3MoKQp7CiRzY29wZS5pbnN0cnVjdG9ycy51bnNoaWZ0KHtidXNpbmVzc191c2VyX2lkOm51bGwsIGJ1c2VyX2ZpcnN0X25hbWU6IiIsIGJ1c2VyX2xhc3RfbmFtZToiIn0pOwp9CgpnZXRCdXNpbmVzc0V2ZW50VHlwZSgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmV2ZW50X3R5cGVfaWQsJ2V2ZW50VHlwZVByb3BlcnRpZXMnLGdldEJ1c2luZXNzRXZlbnRUeXBlX3N1Y2Nlc3MpOwoKZnVuY3Rpb24gZ2V0QnVzaW5lc3NFdmVudFR5cGVfc3VjY2VzcygpCnsKaWYgKCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF9yZWdpc3RyYXRpb25zPT1udWxsKQp7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF9yZWdpc3RyYXRpb25zPTE7Cn0KaWYgKCgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5kdXJhdGlvbl9iZWZvcmVfZXZlbnQ+MCkgfCAoJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZHVyYXRpb25fYWZ0ZXJfZXZlbnQ+MCkpCnsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuYmxvY2tFeHRyYVRpbWUgPSAxOwp9CmVsc2UKewokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5ibG9ja0V4dHJhVGltZSA9IDA7Cn0KLy8gJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuaW5oZXJpdF9tYWluX2hvdXJzID0gcmVzcG9uc2UuZGF0YVswXS5pbmhlcml0X21haW5faG91cnM7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmlzX3VwZGF0ZSA9IHRydWU7CmxvZ0RlYnVnKCIkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5jb2xvcj0iKyRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmNvbG9yKTsKJHNjb3BlLmV2ZW50Q29sb3JTdHlsZVskc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5jb2xvcl0gPSB7Cid0cmFuc2Zvcm0nOiAncm90YXRlKDMwZGVnKScKfTsKJHNjb3BlLmNoYW5nZUV2ZW50Q29sb3IoKCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmNvbG9yKS5zdWJzdHIoMSkpOwpsb2dEZWJ1ZygiJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuaW5zdHJ1Y3Rvcl9pZD0iKyRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmluc3RydWN0b3JfaWQpOwovLyBzYXZpbmcgZXZlbnQgdHlwZSBkZXRhaWxzIGFzaWRlIHRvIGxhdGVyIGNoZWNrIGlmIGFueXRoaW5nIGNoYW5nZWQKbG9nRGVidWcoImR1cGxpY2F0aW5nIG9iamVjdCBvZiBldmVudCB0eXBlIHRvIGxhdGVyIGNvbXBhcmUgIit0eXBlb2YgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMpOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllc0R1cGxpY2F0ZSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMpKTsKbG9nRGVidWcoIiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzRHVwbGljYXRlID0iKyRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzRHVwbGljYXRlLmV2ZW50X3R5cGVfbmFtZSk7Cn07CgovLyBldmVudCB0eXBlIGNoYW5nZWQgcG9wdXAKJHNjb3BlLmV2ZW50VHlwZUNoYW5nZWRQb3B1cCA9IGZ1bmN0aW9uKGV2ZW50VHlwZVByb3BlcnRpZXMpIHsKICAgICAgICBsb2dEZWJ1ZygiZXZlbnRUeXBlQ2hhbmdlZFBvcHVwIik7Cgp2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKYW5pbWF0aW9uOiBmYWxzZSwKdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfZXZlbnRfdHlwZV9jaGFuZ2VkLnBocCcsCmNvbnRyb2xsZXI6ICdldmVudFR5cGVDaGFuZ2VkUG9wdXBDb250cm9sbGVyJywKc2l6ZTogJ2wnLApyZXNvbHZlOiB7CmV2ZW50VHlwZVByb3BlcnRpZXM6IGZ1bmN0aW9uKCkgewpyZXR1cm4gJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXM7Cn0KfQp9KTsKCm1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24oc2VsZWN0ZWRJdGVtKQp7CmxvZ0RlYnVnKHNlbGVjdGVkSXRlbSk7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzID0gc2VsZWN0ZWRJdGVtOwp9LCBmdW5jdGlvbigpIHsKbG9nRGVidWcoJ01vZGFsIGRpc21pc3NlZCBhdDogJyArIG5ldyBEYXRlKCkpOwp9KTsKfTsKCi8vIGV2ZW50IHR5cGUgZXh0cmEgZmllbGQgcG9wdXAKJHNjb3BlLmV2ZW50VHlwZUV4dHJhRmllbGRzUG9wID0gZnVuY3Rpb24oZXZlbnRUeXBlUHJvcGVydGllcykgewogICAgICAgIGxvZ0RlYnVnKCJldmVudFR5cGVFeHRyYUZpZWxkc1BvcDIiKTsKCnZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewphbmltYXRpb246IGZhbHNlLAp0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9ldmVudF90eXBlX2V4dHJhX2ZpZWxkcy5waHAnLApjb250cm9sbGVyOiAnZXZlbnRUeXBlRXh0cmFGaWVsZHNNb2RhbENvbnRyb2xsZXInLApzaXplOiAnbCcsCnJlc29sdmU6IHsKZXZlbnRUeXBlUHJvcGVydGllczogZnVuY3Rpb24oKSB7CnJldHVybiBldmVudFR5cGVQcm9wZXJ0aWVzOwp9Cn0KfSk7Cgptb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHNlbGVjdGVkSXRlbSkgewpsb2dEZWJ1ZyhzZWxlY3RlZEl0ZW0pOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyA9IHNlbGVjdGVkSXRlbTsKfSwgZnVuY3Rpb24oKSB7CmxvZ0RlYnVnKCdNb2RhbCBkaXNtaXNzZWQgYXQ6ICcgKyBuZXcgRGF0ZSgpKTsKfSk7Cn07CgoKJHNjb3BlLmNoYW5nZUV2ZW50Q29sb3IgPSBmdW5jdGlvbihuZXdDb2xvcikgewpsb2dEZWJ1ZygiY2hvb3NpbmcgY29sb3IgIiArIG5ld0NvbG9yKTsKJHNjb3BlLmV2ZW50Q29sb3IgPSBuZXdDb2xvcjsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXZlbnRDb2xvciA9ICIjIiArIG5ld0NvbG9yOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5jb2xvciA9ICIjIiArIG5ld0NvbG9yOwokc2NvcGUuZXZlbnRDb2xvclN0eWxlID0gewonYmFja2dyb3VuZC1jb2xvcic6ICIjIiArIG5ld0NvbG9yCn07CiRzY29wZS5ldmVudENvbG9yU3R5bGVbbmV3Q29sb3JdID0gewondHJhbnNmb3JtJzogJ3JvdGF0ZSgzMGRlZyknCn07Cgp9Cgokc2NvcGUuYWRkRXZlbnRUeXBlQ2FuY2VsID0gZnVuY3Rpb24oKSB7CiRsb2NhdGlvbi5wYXRoKCcvZXZlbnRfdHlwZXMnKTsKfTsKCiRzY29wZS5hZGRFdmVudFR5cGUgPSBmdW5jdGlvbigpIHsgLy8gdGhpcyBmdW5jdGlvbiBVUERBVEVTIGV2ZW50IHR5cGUgKG5vdCBhZGRzKQovLyBjaGVja2luZyBpZiBhbnl0aGluZyBjaGFuZ2VkIHJlYWxseQovLyBhbmQgYXNraW5nIGlmIHdlIHNob3VsZCB1cGRhdGUgYWxsIGV2ZW50cyBmcm9tIG5vdyAob3Igb25seSBuZXdseSBjcmVhdGVkIGV2ZW50cykKLy8gY2hlY2tpbmcKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXNEdXBsaWNhdGUuZXh0cmFGaWVsZHM9JHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHM7CiAgICAgIC8vIGlmIChhbmd1bGFyLmVxdWFscygkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllc0R1cGxpY2F0ZSwkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcykpCiAgICAgIGlmICh0cnVlKSAvLyBpZ25vcmluZyB0cnlpbmcgdG8gbWFrZSBjaGFuZ2VzIHRvIGV2ZW50cwp7Ci8vICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzRHVwbGljYXRlLmV4dHJhRmllbGRzID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcykpOwoKbG9nRGVidWcoIm5vdGhpbmcgY2hhbmdlZCBpbiBldmVudCB0eXBlLCBvciBvbmx5IGV4dHJhIGZpZWxkcyIpOwokc2NvcGUudXBkYXRlRXZlbnRUeXBlKCk7Cn0KZWxzZQp7CmxvZ0RlYnVnKCJldmVudCB0eXBlIGNoYW5nZWQiKTsKJHNjb3BlLmV2ZW50VHlwZUNoYW5nZWRQb3B1cCgpOwp9Ci8vICRzY29wZS51cGRhdGVFdmVudFR5cGUoKTsKfQokc2NvcGUudXBkYXRlRXZlbnRUeXBlID0gZnVuY3Rpb24oKQp7CiAgICAgIC8vIGNoZWNrIGV4dHJhIGZpZWxkcyBkdXBsaWNhdGUgbmFtZXMgLSBzdGFydAogICAgICBsb2dEZWJ1ZygiYWRkRXZlbnRUeXBlOiBjaGVjayBleHRyYSBmaWVsZHMgZHVwbGljYXRlIG5hbWVzIC0gc3RhcnQiKTsKICAgICAgdmFyIGV4dHJhRmllbGRzTmFtZXMgPSBbXTsKICAgICAgZm9yICh2YXIgaT0xOyBpPCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzLmxlbmd0aDsgaSsrKQogICAgICB7CiAgICAgICAgZXh0cmFGaWVsZHNOYW1lcy5wdXNoKCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzW2ldLmZpZWxkX25hbWUpOwogICAgICB9CiAgICAgIGV4dHJhRmllbGRzTmFtZXMuc29ydCgpOwogICAgICB2YXIgbGFzdCA9IGV4dHJhRmllbGRzTmFtZXNbMF07CiAgICAgIGZvciAodmFyIGk9MTsgaTxleHRyYUZpZWxkc05hbWVzLmxlbmd0aDsgaSsrKQogICAgICB7CiAgICAgICAgIGlmIChleHRyYUZpZWxkc05hbWVzW2ldID09IGxhc3QpCiAgICAgICAgIHsKICAgICAgICAgIC8vICBhbGVydCgnRHVwbGljYXRlIDogJytsYXN0KTsKICAgICAgICAgICAgbG9nRGVidWcoJ9en15nXmdedINep15PXlCDXqteZ16LXldeTINeo16TXldeQ15kg15vXpNeV15wg15HXqdedICInK2xhc3QrJyIuLi4nKTsKICAgICAgICAgICAkc2NvcGUuZHVwbGljYXRlRmllbGROYW1lcz0n16fXmdeZ150g16nXk9eUINeq15nXoteV15Mg16jXpNeV15DXmSDXm9ek15XXnCDXkdep150gIicrbGFzdCsnIi4uLic7CiAgICAgICAgICAgcmV0dXJuOwogICAgICAgICB9CiAgICAgICAgIGxhc3QgPSBleHRyYUZpZWxkc05hbWVzW2ldOwogICAgICB9CiAgICAgIC8vIGNoZWNrIGV4dHJhIGZpZWxkcyBkdXBsaWNhdGUgbmFtZXMgLSBlbmQKCiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLnVwZGF0ZV9leGlzdGluZ19ldmVudHM9ZmFsc2U7CgogICAgICBsb2dEZWJ1ZygidXBkYXRlRXZlbnRUeXBlOiB1cGRhdGUgRXZlbnQgVHlwZSAiICsgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXZlbnRfdHlwZV9pZCk7CmlmICgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5tYXhfcmVnaXN0cmF0aW9ucz09JycpCnsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMubWF4X3JlZ2lzdHJhdGlvbnM9MDsKfQp1cGRhdGVFdmVudFR5cGUoJGh0dHAsJHNjb3BlLCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV2ZW50X3R5cGVfaWQsJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMsdXBkYXRlRXZlbnRUeXBlX3N1Y2Nlc3MpOwpmdW5jdGlvbiB1cGRhdGVFdmVudFR5cGVfc3VjY2VzcygpCnsKJGxvY2F0aW9uLnBhdGgoJy9ldmVudF90eXBlcycpOwp9Cn0KfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdldmVudENyZWF0ZU1vZGFsQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRyb290U2NvcGUsIHNoYXJlZFByb3BlcnRpZXMsIGV2ZW50X3R5cGVfaWQsIGxvY2F0aW9uX2lkLCBlbXBfaWQsICRodHRwLCBzdGFydERhdGUsIHJlc2NoZWR1bGVfZXZlbnQsIHVpQ2FsZW5kYXJDb25maWcpIHsKc3RhcnREYXRlPW5ldyBtb21lbnQoc3RhcnREYXRlKTsKbG9nRGVidWcoImV2ZW50Q3JlYXRlTW9kYWxDb250cm9sbGVyLCBzdGFydERhdGU9IitzdGFydERhdGUrIiB0eXBlICIrdHlwZW9mIHN0YXJ0RGF0ZSk7CmxvZ0RlYnVnKCJldmVudENyZWF0ZU1vZGFsQ29udHJvbGxlciwgcmVzY2hlZHVsZV9ldmVudD0iK3Jlc2NoZWR1bGVfZXZlbnQpOwoKJHNjb3BlLmV2ZW50VHlwZVRpdGxlID0gIteR15fXqCDXodeV15Ig157XpNeS16kiOwokc2NvcGUuc2hvd0V2ZW50VHlwZVNlbGVjdGVkID0gZmFsc2U7CiRzY29wZS5zaG93RXZlbnRDbGllbnRTZWxlY3RlZCA9IGZhbHNlOwokc2NvcGUubmV3RXZlbnREZXRhaWxzID0ge307IC8vIHRoZXNlIGFyZSB0aGUgY29tcGxldGUgZGV0YWlscyBmb3IgdGhlIG5ldyBldmVudCAvLwokc2NvcGUubmV3RXZlbnREZXRhaWxzLnJlcGVhdFR5cGUgPSAiZm9yZXZlciI7CiRzY29wZS5uZXdFdmVudERldGFpbHMucmVwZWF0Rml4ZWRUaW1lcyA9ICI0IjsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5tYXhfcGFydGljaXBhbnRzID0gMTsKCmxvZ0RlYnVnKCJYWFggPSAiK0pTT04uc3RyaW5naWZ5KHJlc2NoZWR1bGVfZXZlbnQpKTsKCiRzY29wZS5yZXNjaGVkdWxlX2V2ZW50PWZhbHNlOwokc2NvcGUucmVzY2hlZHVsZV9ldmVudF9kZXRhaWxzPXJlc2NoZWR1bGVfZXZlbnQ7CmlmICgkc2NvcGUucmVzY2hlZHVsZV9ldmVudF9kZXRhaWxzIT1udWxsKQp7CmxvZ0RlYnVnKCJyZXNjaGVkdWxlX2V2ZW50X2RldGFpbHM9Iiskc2NvcGUucmVzY2hlZHVsZV9ldmVudF9kZXRhaWxzLmV2ZW50X2lkKTsKbG9nRGVidWcoSlNPTi5zdHJpbmdpZnkoJHNjb3BlLnJlc2NoZWR1bGVfZXZlbnRfZGV0YWlscykpOwokc2NvcGUucmVzY2hlZHVsZV9ldmVudD10cnVlOwokc2NvcGUuZ2l2ZW5fZXZlbnRfdHlwZV9pZCA9ICRzY29wZS5yZXNjaGVkdWxlX2V2ZW50X2RldGFpbHMuZXZlbnRfdHlwZV9pZDsKLy8gc3RpbGwgcHJlZmVyaW5nIGVtcF9pZCBmcm9tIHNjaGVkdWxlciBzdWdnZXN0aW9uIGlzIGl0IHdhcyBzZWxlY3RlZAppZiAoZW1wX2lkIT0wKQp7CiRzY29wZS5naXZlbl9lbXBfaWQgPSBlbXBfaWQ7Cn0KZWxzZQp7CiRzY29wZS5naXZlbl9lbXBfaWQgPSAkc2NvcGUucmVzY2hlZHVsZV9ldmVudF9kZXRhaWxzLmluc3RydWN0b3JfaWQ7Cn0KLy8gc3RpbGwgcHJlZmVyaW5nIGxvY2F0aW9uX2lkIGZyb20gc2NoZWR1bGVyIHN1Z2dlc3Rpb24gb3ZlciB0aGUgb3JpZ2luYWwgbG9jYXRpb24gZnJvbSBldmVudAppZiAobG9jYXRpb25faWQhPTApCnsKJHNjb3BlLmdpdmVuX2xvY2F0aW9uX2lkID0gbG9jYXRpb25faWQ7Cn0KZWxzZQp7CiRzY29wZS5naXZlbl9sb2NhdGlvbl9pZCA9ICRzY29wZS5yZXNjaGVkdWxlX2V2ZW50X2RldGFpbHMubG9jYXRpb25faWQ7Cn0KfQplbHNlCnsKJHNjb3BlLmdpdmVuX2V2ZW50X3R5cGVfaWQgPSBldmVudF90eXBlX2lkOwokc2NvcGUuZ2l2ZW5fbG9jYXRpb25faWQgPSBsb2NhdGlvbl9pZDsKJHNjb3BlLmdpdmVuX2VtcF9pZCA9IGVtcF9pZDsKfQppZiAoJHNjb3BlLmdpdmVuX2V2ZW50X3R5cGVfaWQ+MCkKewokc2NvcGUucHJldmlvdXNseV9zZWxlY3RlZF9ldmVudF90eXBlPXRydWU7Cn0KZWxzZQp7CiRzY29wZS5wcmV2aW91c2x5X3NlbGVjdGVkX2V2ZW50X3R5cGU9ZmFsc2U7Cn0KbG9nRGVidWcoIiRzY29wZS5naXZlbl9ldmVudF90eXBlX2lkPSIrJHNjb3BlLmdpdmVuX2V2ZW50X3R5cGVfaWQpOwoKc2VsZWN0ZWREYXRlU3RhcnQgPSBuZXcgRGF0ZShzdGFydERhdGUpOwpsb2dEZWJ1Zygic2VsZWN0ZWREYXRlU3RhcnQgPSAiK3NlbGVjdGVkRGF0ZVN0YXJ0KTsKdmFyIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZSgpICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKCi8vIGxvZ0RlYnVnKCJkYXRlPSIgKyBzZWxlY3RlZERhdGVTdGFydCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50ID0gW107CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRIb3VycygpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBzZWxlY3RlZERhdGVTdGFydC5nZXRNaW51dGVzKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZG93ID0gZGF5TmFtZXNbc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RGF5KCldOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRhdGUgPSBzZWxlY3RlZERhdGVTdGFydDsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aCA9IG1vbnRoTmFtZXNbc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TW9udGgoKV07CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bW9udGgxMTIgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRNb250aCgpKzE7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aCA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldERhdGUoKTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RnVsbFllYXIoKTsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5zdGFydF90aW1lX2lucHV0X2Zvcm1hdD0gbmV3IERhdGUoMTk3MCwgMCwgMSwgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycywgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzLCAwKTsKCiRzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZCA9ICRzY29wZS5naXZlbl9lbXBfaWQ7CiRzY29wZS5uZXdFdmVudERldGFpbHMubG9jYXRpb25faWQgPSAkc2NvcGUuZ2l2ZW5fbG9jYXRpb25faWQ7CgpnZXRCdXNpbmVzc0xvY2F0aW9ucygkaHR0cCwkc2NvcGUsJ2J1c2luZXNzX2xvY2F0aW9ucycsZ2V0QnVzaW5lc3NMb2NhdGlvbnNfZmluaXNoKTsKZnVuY3Rpb24gZ2V0QnVzaW5lc3NMb2NhdGlvbnNfZmluaXNoKCkKewppZiAoJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5sb2NhdGlvbl9pZD09MCkKewokc2NvcGUubmV3RXZlbnREZXRhaWxzLmxvY2F0aW9uX2lkPSRzY29wZS5idXNpbmVzc19sb2NhdGlvbnNbMF0ubG9jYXRpb25faWQ7Cn0KfQoKY29uc29sZS5sb2coIiRzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZD0iKyRzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZCk7Ci8vIGlmIGNsaWVudCB3YXMgcHJldmlvdXNseSBzZWxlY3RlZAokc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcj1mYWxzZTsKbG9nRGVidWcoInNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXI9IitzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKTsKaWYgKHNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKSE9bnVsbCkKewovLyBjb25zb2xlLmxvZygiZ290IHByZXZpb3VzIHNlbGVjdGVkIHVzZXIgIitzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfZmlyc3RfbmFtZSk7CiRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VybmFtZT1zaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfZmlyc3RfbmFtZSsiICIrc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2VyX2xhc3RfbmFtZTsKJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXI9dHJ1ZTsKCiRzY29wZS5zaG93RXZlbnRDbGllbnRTZWxlY3RlZCA9IHRydWU7CiRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kdXNlcl9pZCA9IHNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKS5idXNpbmVzc191c2VyX2lkOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZHVzZXJfZmlyc3RfbmFtZSA9IHNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKS5idXNlcl9maXJzdF9uYW1lOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZHVzZXJfbGFzdF9uYW1lID0gc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2VyX2xhc3RfbmFtZTsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5idXNpbmVzc191c2VyX2lkID0gc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2luZXNzX3VzZXJfaWQ7Cgp9CiRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZSA9IHN0YXJ0RGF0ZTsKbG9nRGVidWcoIiRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZTE9Iiskc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWUpOwokc2NvcGUuc3RhcnRNaW51dGVzID0gZnVuY3Rpb24oKQp7CmxvZ0RlYnVnKCJzdGFydE1pbnV0ZXMgIisoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKSk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcz1taW51dGVzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpOwpjYWxjdWxhdGVTdGFydFRpbWUoKTsKY2FsY3VsYXRlRW5kVGltZUR5bmFtaWMoKTsKfQokc2NvcGUuc3RhcnRIb3VycyA9IGZ1bmN0aW9uKCkKewpsb2dEZWJ1Zygic3RhcnRIb3VycyAiK2hvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKSk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnM9aG91cnNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMpOwpjYWxjdWxhdGVTdGFydFRpbWUoKTsKY2FsY3VsYXRlRW5kVGltZUR5bmFtaWMoKTsKfQoKJHNjb3BlLmVuZE1pbnV0ZXMgPSBmdW5jdGlvbigpCnsKbG9nRGVidWcoImVuZE1pbnV0ZXMgIisoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcykpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzPW1pbnV0ZXNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpOwpjYWxjdWxhdGVTdGFydFRpbWUoKTsKY2FsY3VsYXRlRW5kVGltZUR5bmFtaWMoKTsKfQokc2NvcGUuZW5kSG91cnMgPSBmdW5jdGlvbigpCnsKbG9nRGVidWcoImVuZEhvdXJzICIraG91cnNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzKSk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzPWhvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vycyk7CmNhbGN1bGF0ZVN0YXJ0VGltZSgpOwpjYWxjdWxhdGVFbmRUaW1lRHluYW1pYygpOwp9CgpmdW5jdGlvbiBjYWxjdWxhdGVTdGFydFRpbWUoKQp7CmV2ZW50WWVhcj0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXI7CmV2ZW50TW9udGg9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aDExMjsKZXZlbnREYXk9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXlvZm1vbnRoOwppZiAocGFyc2VJbnQoZXZlbnRNb250aCk8MTApCnsKZXZlbnRNb250aD0iMCIrZXZlbnRNb250aDsKfQppZiAocGFyc2VJbnQoZXZlbnREYXkpPDEwKQp7CmV2ZW50RGF5PSIwIitldmVudERheTsKfQpsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyPSIrZXZlbnRZZWFyKTsKbG9nRGVidWcoIiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aD0iK2V2ZW50TW9udGgpOwpsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aD0iK2V2ZW50RGF5KTsKbmV3X3N0YXJ0PW1vbWVudC51dGMoZXZlbnRZZWFyKyItIitldmVudE1vbnRoKyItIitldmVudERheSsiVDAwOjAwOjAwIikuYWRkKCgocGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykqNjApK3BhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcykpLCAnbWludXRlcycpOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWU9bmV3X3N0YXJ0Owpsb2dEZWJ1ZygibmV3X3N0YXJ0PSIrbmV3X3N0YXJ0KTsKfQpmdW5jdGlvbiBtaW51dGVzQ2hhbmdlZCh0aGVtaW51dGVzKQp7CmxvZ0RlYnVnKCJ0aGVtaW51dGVzPSIrdGhlbWludXRlcyk7CmlmICh0eXBlb2YgdGhlbWludXRlcz09InVuZGVmaW5lZCIpCnsKcmV0dXJuICIwMCI7Cn0KaWYgKGlzTmFOKHRoZW1pbnV0ZXMpKQp7CnJldHVybiAiMDAiOwp9CmlmICh0aGVtaW51dGVzPT0nJykKewpyZXR1cm4gIjAwIjsKfQp0aGVtaW51dGVzPXBhcnNlSW50KHRoZW1pbnV0ZXMpOwppZiAodGhlbWludXRlcz42MCkKewpyZXR1cm4gIjAwIjsKfQplbHNlIGlmICh0aGVtaW51dGVzPDApCnsKcmV0dXJuICIwMCI7Cn0KZWxzZSBpZiAodGhlbWludXRlcz09IiIpCnsKcmV0dXJuICIwMCI7Cn0KZWxzZSBpZiAodGhlbWludXRlczwxMCkKewpyZXR1cm4gIjAiK3RoZW1pbnV0ZXM7Cn0KZWxzZQp7CnJldHVybiB0aGVtaW51dGVzOwp9Cn0KZnVuY3Rpb24gaG91cnNDaGFuZ2VkKHRoZWhvdXJzKQp7CmxvZ0RlYnVnKCJ0aGVob3Vycz0iK3RoZWhvdXJzKTsKaWYgKHR5cGVvZiB0aGVob3Vycz09InVuZGVmaW5lZCIpCnsKcmV0dXJuICIwIjsKfQppZiAoaXNOYU4odGhlaG91cnMpKQp7CnJldHVybiAiMCI7Cn0KaWYgKHRoZWhvdXJzPT0nJykKewpyZXR1cm4gIjAiOwp9CnRoZWhvdXJzPXBhcnNlSW50KHRoZWhvdXJzKTsKaWYgKHRoZWhvdXJzPjI0KQp7CnJldHVybiAwOwp9CmVsc2UgaWYgKHRoZWhvdXJzPDApCnsKcmV0dXJuIDA7Cn0KZWxzZSBpZiAodGhlaG91cnM9PSIiKQp7CnJldHVybiAiMCI7Cn0KZWxzZQp7CnJldHVybiB0aGVob3VyczsKfQp9CmdldEFsbEluc3RydWN0b3JzKCRodHRwLCRzY29wZSwnaW5zdHJ1Y3RvcnMnLGdldEFsbEluc3RydWN0b3JzX3N1Y2Nlc3MpOwpmdW5jdGlvbiBnZXRBbGxJbnN0cnVjdG9yc19zdWNjZXNzKCkKewovLyAkc2NvcGUuaW5zdHJ1Y3RvcnMudW5zaGlmdCh7YnVzaW5lc3NfdXNlcl9pZDpudWxsLCBidXNlcl9maXJzdF9uYW1lOiIiLCBidXNlcl9sYXN0X25hbWU6IiJ9KTsKaWYgKCEkc2NvcGUubmV3RXZlbnREZXRhaWxzLmluc3RydWN0b3JfaWQ+MCkKewokc2NvcGUubmV3RXZlbnREZXRhaWxzLmluc3RydWN0b3JfaWQ9JHNjb3BlLmluc3RydWN0b3JzWzBdLmJ1c2luZXNzX3VzZXJfaWQ7Cn0KfQoKJHNjb3BlLnNlbGVjdEV2ZW50VHlwZSA9IGZ1bmN0aW9uKCkgewovLyByZW1vdmluZyBldmVudCB0eXBlINeR15fXqCDXodeV15Ig157XpNeS16kKaWYgKCRzY29wZS5ldmVudFR5cGVPcHRpb25zWzBdLmV2ZW50X3R5cGVfaWQ9PTApCnsKJHNjb3BlLmV2ZW50VHlwZU9wdGlvbnMuc3BsaWNlKDAsIDEpOwp9CiRzY29wZS5hamF4X2Vycm9yPScnOwpjaG9pY2U9JHNjb3BlLnNlbGVjdEV2ZW50VHlwZVNlbGVjdGVkOwpsb2dEZWJ1Zygic2VsZWN0RXZlbnRUeXBlIik7CmxvZ0RlYnVnKEpTT04uc3RyaW5naWZ5KCRzY29wZS5zZWxlY3RFdmVudFR5cGVTZWxlY3RlZCkpOwokc2NvcGUuZXZlbnRUeXBlVGl0bGUgPSBjaG9pY2UuZXZlbnRfdHlwZV9uYW1lOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLmV2ZW50X3R5cGVfaWQgPSBjaG9pY2UuZXZlbnRfdHlwZV9pZDsKCiRzY29wZS5uZXdFdmVudERldGFpbHMuZXZlbnRfbmFtZSA9IGNob2ljZS5ldmVudF90eXBlX25hbWU7CiRzY29wZS5uZXdFdmVudERldGFpbHMub3JpZ2luYWxfZXZlbnRfbmFtZSA9IGNob2ljZS5ldmVudF90eXBlX25hbWU7CiRzY29wZS5uZXdFdmVudERldGFpbHMuZXZlbnRfZGVzY3JpcHRpb24gPSBjaG9pY2UuZXZlbnRfdHlwZV9kZXNjcmlwdGlvbjsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pc19jbGFzcyA9IGNob2ljZS5pc19jbGFzczsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5vcmlnaW5hbF9wcmljZSA9IGNob2ljZS5vcmlnaW5hbF9wcmljZTsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pc19nZW5lcmljX2V0eXBlID0gY2hvaWNlLmlzX2dlbmVyaWNfZXR5cGU7Ci8vICRzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZCA9IGNob2ljZS5pbnN0cnVjdG9yX2lkOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50ID0gY2hvaWNlLmR1cmF0aW9uX2V2ZW50OwovLyBsb2dEZWJ1Zygic2NvcGUubmV3RXZlbnREZXRhaWxzLmlzX2NsYXNzPSIrJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pc19jbGFzcyk7Ci8vIGxvZ0RlYnVnKCJzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZD0iKyRzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZCk7Ci8vIGxvZ0RlYnVnKCJzdGFydERhdGU9IitzdGFydERhdGUpOwovLyAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWUgPSBzdGFydERhdGU7CiRzY29wZS5uZXdFdmVudERldGFpbHMuZXZlbnR0eXBlID0gY2hvaWNlOwpjYWxjdWxhdGVFbmRUaW1lKCk7CgovLyAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWVfaW5wdXRfZm9ybWF0PSBuZXcgRGF0ZSgxOTcwLCAwLCAxLCAxNCwgNTcsIDApOwoKbG9nRGVidWcoIm5ld0V2ZW50IHN0YXJ0PSIgKyAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWUpOwpsb2dEZWJ1ZygibmV3RXZlbnQgZW5kPSIgKyAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZF90aW1lKTsKCiRzY29wZS5zaG93RXZlbnRUeXBlU2VsZWN0ZWQgPSB0cnVlOwp9CgovLyB0aGlzIGZ1bmN0aW9uIGNhbGN1bGF0ZXMgZW5kIHRpbWUgYWNjb3JkaW5nIHRvIHRoZSBsZW5ndGggb2YgdGhlIGV2ZW50dHlwZQpmdW5jdGlvbiBjYWxjdWxhdGVFbmRUaW1lKCkKewpjb25zb2xlLmxvZygiJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5zdGFydF90aW1lPSIrJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5zdGFydF90aW1lKTsKZW5kID0gbW9tZW50KCRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZSkuYWRkKCRzY29wZS5uZXdFdmVudERldGFpbHMuZHVyYXRpb25fZXZlbnQsICdtaW51dGVzJyk7CnNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKGVuZCk7CnNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKHNlbGVjdGVkRGF0ZUVuZC5nZXRUaW1lKCkgKyBzZWxlY3RlZERhdGVFbmQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMgPSBzZWxlY3RlZERhdGVFbmQuZ2V0SG91cnMoKTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kZG93ID0gZGF5TmFtZXNbc2VsZWN0ZWREYXRlRW5kLmdldERheSgpXTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcyA9IChzZWxlY3RlZERhdGVFbmQuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBzZWxlY3RlZERhdGVFbmQuZ2V0TWludXRlcygpOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZF90aW1lID0gZW5kOwovLyBjYWxjdWxhdGluZyBkdXJhdGlvbgokc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50PXBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpLXBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcyk7CiRzY29wZS5uZXdFdmVudERldGFpbHMuZHVyYXRpb25fZXZlbnQ9JHNjb3BlLm5ld0V2ZW50RGV0YWlscy5kdXJhdGlvbl9ldmVudCsocGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMpLXBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMpKSo2MDsKaWYgKCRzY29wZS5uZXdFdmVudERldGFpbHMuZHVyYXRpb25fZXZlbnQ8MCkKewokc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50PTA7Cn0KfQoKLy8gdGhpcyBmdW5jdGlvbiBjYWxjdWxhdGVzIGVuZCB0aW1lIGFjY29yZGluZyB0byB0aGUgaW5wdXQgZnJvbSBtb2RhbCB3aW5kb3cKLy8gYW5kIG5vdCBhY2NvcmRpbmcgdG8gZXZlbnQgdHlwZSBsZW5ndGgKZnVuY3Rpb24gY2FsY3VsYXRlRW5kVGltZUR5bmFtaWMoKQp7CmV2ZW50WWVhcj0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXI7CmV2ZW50TW9udGg9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aDExMjsKZXZlbnREYXk9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXlvZm1vbnRoOwppZiAocGFyc2VJbnQoZXZlbnRNb250aCk8MTApCnsKZXZlbnRNb250aD0iMCIrZXZlbnRNb250aDsKfQppZiAocGFyc2VJbnQoZXZlbnREYXkpPDEwKQp7CmV2ZW50RGF5PSIwIitldmVudERheTsKfQpsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyPSIrZXZlbnRZZWFyKTsKbG9nRGVidWcoIiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aD0iK2V2ZW50TW9udGgpOwpsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aD0iK2V2ZW50RGF5KTsKbmV3X2VuZD1tb21lbnQudXRjKGV2ZW50WWVhcisiLSIrZXZlbnRNb250aCsiLSIrZXZlbnREYXkrIlQwMDowMDowMCIpLmFkZCgoKHBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzKSo2MCkrcGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcykpLCAnbWludXRlcycpOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZF90aW1lPW5ld19lbmQ7CmxvZ0RlYnVnKCJuZXdfZW5kPSIrbmV3X2VuZCk7Ci8vIGNhbGN1bGF0aW5nIGR1cmF0aW9uCiRzY29wZS5uZXdFdmVudERldGFpbHMuZHVyYXRpb25fZXZlbnQ9cGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcyktcGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKTsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5kdXJhdGlvbl9ldmVudD0kc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50KyhwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycyktcGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykpKjYwOwppZiAoJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5kdXJhdGlvbl9ldmVudDwwKQp7CiRzY29wZS5uZXdFdmVudERldGFpbHMuZHVyYXRpb25fZXZlbnQ9MDsKfQp9CmdldEFsbEJ1c2luZXNzRXZlbnRUeXBlcygkaHR0cCwkc2NvcGUsJ2V2ZW50VHlwZU9wdGlvbnMnLGdldEFsbEJ1c2luZXNzRXZlbnRUeXBlc19zdWNjZXNzKTsKZnVuY3Rpb24gZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzX3N1Y2Nlc3MoKQp7Ci8vIGFmdGVyIGxvYWRpbmcgZXZlbnQgdHlwZXMsIGlmIHRoZSBnaXZlbiBldmVudCB0eXBlIGlzICE9IDAgd2UgInNlbGVjdCIgaXQKY29uc29sZS5sb2coImdldEFsbEJ1c2luZXNzRXZlbnRUeXBlc19zdWNjZXNzIik7CmlmICgkc2NvcGUuZ2l2ZW5fZXZlbnRfdHlwZV9pZD4wKQp7CmZvcih2YXIgaSA9IDA7IGkgPCAkc2NvcGUuZXZlbnRUeXBlT3B0aW9ucy5sZW5ndGg7IGkrKykKewppZiAoJHNjb3BlLmV2ZW50VHlwZU9wdGlvbnNbaV0uZXZlbnRfdHlwZV9pZD09JHNjb3BlLmdpdmVuX2V2ZW50X3R5cGVfaWQpCnsKY29uc29sZS5sb2coImdpdmVuX2V2ZW50X3R5cGVfaWQgZm91bmQiKTsKLy8gJHNjb3BlLmNhbGN1bGF0ZVN0YXJ0VGltZSgpOwokc2NvcGUuc2VsZWN0RXZlbnRUeXBlU2VsZWN0ZWQ9JHNjb3BlLmV2ZW50VHlwZU9wdGlvbnNbaV07Ci8vICRzY29wZS5zZWxlY3RFdmVudFR5cGUoJHNjb3BlLmV2ZW50VHlwZU9wdGlvbnNbaV0pOwokc2NvcGUuc2VsZWN0RXZlbnRUeXBlKCk7Cn0KfQp9CmVsc2Ugewokc2NvcGUuZXZlbnRUeXBlT3B0aW9ucy51bnNoaWZ0KHsiZXZlbnRfdHlwZV9pZCI6MCwgImV2ZW50X3R5cGVfbmFtZSI6IteR15fXqCDXodeV15Ig157XpNeS16kiLCBpc192YWNhdGlvbjogMH0pOwokc2NvcGUuc2VsZWN0RXZlbnRUeXBlU2VsZWN0ZWQ9JHNjb3BlLmV2ZW50VHlwZU9wdGlvbnNbMF07Cn0KfQpnZXRBbGxDbGllbnRzKCRodHRwLCRzY29wZSwnZXZlbnRUeXBlVXNlcnMnKTsKCiRzY29wZS5ldmVudENsaWVudFNlbGVjdGVkID0gZnVuY3Rpb24oc2VsZWN0ZWQpIHsKaWYgKHNlbGVjdGVkKSB7Ci8vIGFsZXJ0KEpTT04uc3RyaW5naWZ5KCBzZWxlY3RlZCwgbnVsbCwgMiApKTsKbG9nRGVidWcoJ2NsaWVudCBzZWxlY3RlZCAnICsgc2VsZWN0ZWQub3JpZ2luYWxPYmplY3QuYnVzZXJfZmlyc3RfbmFtZSk7CiRzY29wZS5zaG93RXZlbnRDbGllbnRTZWxlY3RlZCA9IHRydWU7CiRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kdXNlcl9pZCA9IHNlbGVjdGVkLm9yaWdpbmFsT2JqZWN0LmJ1c2luZXNzX3VzZXJfaWQ7CiRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kdXNlcl9maXJzdF9uYW1lID0gc2VsZWN0ZWQub3JpZ2luYWxPYmplY3QuYnVzZXJfZmlyc3RfbmFtZTsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmR1c2VyX2xhc3RfbmFtZSA9IHNlbGVjdGVkLm9yaWdpbmFsT2JqZWN0LmJ1c2VyX2xhc3RfbmFtZTsKfSBlbHNlIHsKbG9nRGVidWcoJ25vdCBzZWxlY3RlZCcpOwovLyAkc2NvcGUuZXZlbnRDbGllbnREZVNlbGVjdGVkKCk7Cn0KfTsKJHNjb3BlLmV2ZW50Q2xpZW50RGVTZWxlY3RlZCA9IGZ1bmN0aW9uKCkgewokc2NvcGUuc2hvd0V2ZW50Q2xpZW50U2VsZWN0ZWQgPSBmYWxzZTsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmR1c2VyX2lkID0gbnVsbDsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmR1c2VyX2ZpcnN0X25hbWUgPSBudWxsOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZHVzZXJfbGFzdF9uYW1lID0gbnVsbDsKJHNjb3BlLmNsZWFyQ2xpZW50SW5wdXQoJ2NsaWVudF9hbmd1Y29tcGxldGUnKTsKfQoKJHNjb3BlLmNsZWFyQ2xpZW50SW5wdXQgPSBmdW5jdGlvbihpZCkgewppZiAoaWQpIHsKJHNjb3BlLiRicm9hZGNhc3QoJ2FuZ3Vjb21wbGV0ZS1hbHQ6Y2xlYXJJbnB1dCcsIGlkKTsKfQovLyBlbHNlewovLyAgICRzY29wZS4kYnJvYWRjYXN0KCdhbmd1Y29tcGxldGUtYWx0OmNsZWFySW5wdXQnKTsKLy8gfQp9Cgokc2NvcGUuY2FuY2VsID0gZnVuY3Rpb24oKSB7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKfTsKCiRzY29wZS51cGRhdGVFdmVudE5hbWVDaGVjayA9IGZ1bmN0aW9uKG5ld1ZhbHVlKQp7CmxvZ0RlYnVnKCJ1cGRhdGVFdmVudE5hbWU9IituZXdWYWx1ZSk7CmlmIChuZXdWYWx1ZT09IiIpCnsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5ldmVudF9uYW1lID0gJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5vcmlnaW5hbF9ldmVudF9uYW1lOwp9Cn0KLy8gcmVzY2hlZHVsZUV2ZW50CiRzY29wZS5yZXNjaGVkdWxlRXZlbnQgPSBmdW5jdGlvbigpIHsKbG9nRGVidWcoImZ1bmN0aW9uOiByZXNjaGVkdWxlRXZlbnQiKTsKCi8vIG5ld0V2ZW50SlNPTkRldGFpbHMgPSBKU09OLnN0cmluZ2lmeSgkc2NvcGUubmV3RXZlbnREZXRhaWxzLCBudWxsLCA0KTsgLy8gKE9wdGlvbmFsKSBiZWF1dGlmdWwgaW5kZW50ZWQgb3V0cHV0Lgpsb2dEZWJ1ZygicmVzY2hlZHVsZUV2ZW50LCAiICsgSlNPTi5zdHJpbmdpZnkoJHNjb3BlLm5ld0V2ZW50RGV0YWlscywgbnVsbCwgNCkpOwovLyBpZiAoJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5ldmVudFJlY3VycmluZykgewovLyAgIGNyZWF0ZVJlY3VycmluZ0V2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUubmV3RXZlbnREZXRhaWxzLGNyZWF0ZVJlY3VycmluZ0V2ZW50X3N1Y2Nlc3MpOwovLyAgIGZ1bmN0aW9uIGNyZWF0ZVJlY3VycmluZ0V2ZW50X3N1Y2Nlc3MoKQovLyAgIHsKLy8gICAgIGNhbGVuZGFyID0gImNhbGVuZGFyX2J1c2luZXNzIjsKLy8gICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKLy8gICAgICR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoKTsKLy8gICAgIC8vIGVycm9yIHdhcwovLyAgICAgLy8gbG9nRGVidWcoImVycm9yICIgKyBkYXRhLk1lc3NhZ2UpOwovLyAgICAgLy8gJHNjb3BlLmFqYXhfZXJyb3IgPSBkYXRhLk1lc3NhZ2U7Ci8vICAgfQovLyB9Ci8vIGVsc2UKewovLyBpZiBldmVudCBpcyBub3QgY2xhc3MsIGEgY2xpZW50IG11c3QgYmUgc2VsZWN0ZWQKLy8gaWYgKCghJHNjb3BlLnNob3dFdmVudENsaWVudFNlbGVjdGVkKSAmJiAoISRzY29wZS5uZXdFdmVudERldGFpbHMuaXNfY2xhc3MpKQovLyB7Ci8vICAgLy8gYWxlcnQoJ2NsaWVudCBtdXN0IGJlIHNlbGVjdGVkJyk7Ci8vICAgJHNjb3BlLmFqYXhfZXJyb3I9IteQ16DXkCDXlNeV16HXoyDXntep16rXqtejINec157XpNeS16kiOwovLyAgIHJldHVybjsKLy8gfQpyZXNjaGVkdWxlRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5yZXNjaGVkdWxlX2V2ZW50X2RldGFpbHMuZXZlbnRfaWQsJHNjb3BlLm5ld0V2ZW50RGV0YWlscyxyZXNjaGVkdWxlRXZlbnRfc3VjY2Vzcyk7CmZ1bmN0aW9uIHJlc2NoZWR1bGVFdmVudF9zdWNjZXNzKCkKewpjYWxlbmRhciA9ICJjYWxlbmRhcl9idXNpbmVzcyI7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjYWxlbmRhckV2ZW50UmVzY2hlZHVsZURlc2VsZWN0Jyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCiR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoJ2FkZGVkJyk7Cn0KLy8gb24gZmFpbHVyZSB3YXMKLy8gJHNjb3BlLmFqYXhfZXJyb3IgPSBkYXRhLk1lc3NhZ2U7Cn0KfTsKCiRzY29wZS5jcmVhdGVOZXdFdmVudCA9IGZ1bmN0aW9uKCkgewpsb2dEZWJ1ZygiY3JlYXRlTmV3RXZlbnQgc3RhcnRfdGltZT0iKyB0eXBlb2YgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5zdGFydF90aW1lKTsKCm5ld0V2ZW50SlNPTkRldGFpbHMgPSBKU09OLnN0cmluZ2lmeSgkc2NvcGUubmV3RXZlbnREZXRhaWxzLCBudWxsLCA0KTsgLy8gKE9wdGlvbmFsKSBiZWF1dGlmdWwgaW5kZW50ZWQgb3V0cHV0Lgpsb2dEZWJ1ZygiY3JlYXRlTmV3RXZlbnQsICIgKyBuZXdFdmVudEpTT05EZXRhaWxzKTsKaWYgKCRzY29wZS5uZXdFdmVudERldGFpbHMuZXZlbnRSZWN1cnJpbmcpIHsKY3JlYXRlUmVjdXJyaW5nRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5uZXdFdmVudERldGFpbHMsY3JlYXRlUmVjdXJyaW5nRXZlbnRfc3VjY2Vzcyk7CmZ1bmN0aW9uIGNyZWF0ZVJlY3VycmluZ0V2ZW50X3N1Y2Nlc3MoKQp7CmNhbGVuZGFyID0gImNhbGVuZGFyX2J1c2luZXNzIjsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwokdWliTW9kYWxJbnN0YW5jZS5kaXNtaXNzKCk7Ci8vIGVycm9yIHdhcwovLyBsb2dEZWJ1ZygiZXJyb3IgIiArIGRhdGEuTWVzc2FnZSk7Ci8vICRzY29wZS5hamF4X2Vycm9yID0gZGF0YS5NZXNzYWdlOwp9Cn0KZWxzZQp7Ci8vIGNoZWNraW5nIGV2ZW50IHRpbWUgbG9naWMKaWYgKCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnM+JHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMpCnsKJHNjb3BlLmFqYXhfZXJyb3I9IteW157XnyDXlNeU16rXl9ec15Qg16nXnCDXlNee16TXktepINeQ15fXqNeZINeW157XnyDXlNeh15nXldedINep15zXlSI7CnJldHVybjsKfQovLyBjaGVja2luZyBldmVudCB0aW1lIGxvZ2ljCmlmIChwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKT09cGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMpKQp7CmlmIChwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpPj1wYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzKSkKewokc2NvcGUuYWpheF9lcnJvcj0i15bXntefINeU15TXqteX15zXlCDXqdecINeU157XpNeS16kg15DXl9eo15kg15bXntefINeU16HXmdeV150g16nXnNeVIjsKcmV0dXJuOwp9CmxvZ0RlYnVnKCIkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXM9Iiskc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpOwpsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcz0iKyRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpOwppZiAoKHBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcykrNSk+PXBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpKQp7CiRzY29wZS5hamF4X2Vycm9yPSLXkNeV16jXmiDXlNee16TXktepINeX15nXmdeRINec15TXmdeV16og15zXpNeX15XXqiA1INeT16fXldeqIjsKcmV0dXJuOwp9Cn0KLy8gaWYgZXZlbnQgaXMgbm90IGNsYXNzLCBhIGNsaWVudCBtdXN0IGJlIHNlbGVjdGVkCmlmICgoISRzY29wZS5zaG93RXZlbnRDbGllbnRTZWxlY3RlZCkgJiYgKCEkc2NvcGUubmV3RXZlbnREZXRhaWxzLmlzX2NsYXNzKSAmJiAoJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pc19nZW5lcmljX2V0eXBlPT0wKSkKewovLyBhbGVydCgnY2xpZW50IG11c3QgYmUgc2VsZWN0ZWQnKTsKJHNjb3BlLmFqYXhfZXJyb3I9IteQ16DXkCDXlNeV16HXoyDXntep16rXqtejINec157XpNeS16kiOwpyZXR1cm47Cn0KaWYgKCRzY29wZS5zZWxlY3RFdmVudFR5cGVTZWxlY3RlZC5ldmVudF90eXBlX2lkPT0wKQp7Ci8vIGFsZXJ0KCdjbGllbnQgbXVzdCBiZSBzZWxlY3RlZCcpOwokc2NvcGUuYWpheF9lcnJvcj0i15DXoNeQINeR15fXqCDXodeV15Ig157XpNeS16kgIjsKcmV0dXJuOwp9CmNyZWF0ZUV2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUubmV3RXZlbnREZXRhaWxzLGNyZWF0ZUV2ZW50X3N1Y2Nlc3MpOwpmdW5jdGlvbiBjcmVhdGVFdmVudF9zdWNjZXNzKCkKewpjYWxlbmRhciA9ICJjYWxlbmRhcl9idXNpbmVzcyI7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKJHVpYk1vZGFsSW5zdGFuY2UuZGlzbWlzcygnYWRkZWQnKTsKfQovLyBvbiBmYWlsdXJlIHdhcwovLyAkc2NvcGUuYWpheF9lcnJvciA9IGRhdGEuTWVzc2FnZTsKfQp9Cn0pOwovLy8vIGZmZmZmZmYKa3V6ZUFwcC5jb250cm9sbGVyKCdCdXNpbmVzc0NhbGVuZGFyQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsIHNoYXJlZFByb3BlcnRpZXMsICRjb21waWxlLCAkbG9jYXRpb24sIHVpQ2FsZW5kYXJDb25maWcsICR1aWJNb2RhbCwgc2hhcmVkRGF0YSkgewppbml0aWFsRW5kVXNlciA9IHNoYXJlZERhdGEuZ2V0U2VsZWN0ZWRFbmRVc2VyKCk7CmxvZ0RlYnVnKCdCdXNpbmVzc0NhbGVuZGFyIENvbnRyb2xsZXIsIHNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKT0nICsgc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpKTsKCmdldEJ1c2luZXNzTG9jYXRpb25zKCRodHRwLCRzY29wZSwnYnVzaW5lc3NfbG9jYXRpb25zJyk7CgogICAgJHNjb3BlLnN0YXR1c2VzID0gWyB7InN0YXR1c19pZCI6IjAiLCJzdGF0dXNfbmFtZSI6Itek16rXldeXIn0sIHsic3RhdHVzX2lkIjoiMSIsInN0YXR1c19uYW1lIjoi16HXkteV16gifV07CiAgICAkc2NvcGUudGhlZGF0YV9yZXBvcnQgPSB7fTsKCiAgICAkc2NvcGUudGhlZGF0YV9yZXBvcnQuc291cmNlID0gImNhbGVuZGFyIjsKICAgICRzY29wZS50aGVkYXRhX3JlcG9ydC5maWx0ZXJzID0gewogICAgICBpc19jYW5jZWxlZDogIjAiCiAgICB9OwoKICAgICRzY29wZS51cGRhdGVFdmVudHMgPSBmdW5jdGlvbigpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJ1cGRhdGVFdmVudHMiKTsKICAgICAgaW5zdHJ1Y3Rvcl9pZF9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuY2FsZW5kYXJJbnN0cnVjdG9yRmlsdGVyLCAiYnVzaW5lc3NfdXNlcl9pZCIgKTsKICAgICAgZXZlbnRfdHlwZV9pZF9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuY2FsZW5kYXJFdmVudFR5cGVGaWx0ZXIsICJldmVudF90eXBlX2lkIiApOwogICAgICBzdGF0dXNfZmlsdGVyID0gbGlzdF90b19zdHJpbmdfYnlfdmFsdWUoJHNjb3BlLmNhbGVuZGFyU3RhdHVzRmlsdGVyLCAic3RhdHVzX2lkIiApOwoKICAgICAgJHNjb3BlLnRoZWRhdGFfcmVwb3J0LmZpbHRlcnMgPSB7CiAgICAgICAgaW5zdHJ1Y3Rvcl9pZDogaW5zdHJ1Y3Rvcl9pZF9maWx0ZXIsCiAgICAgICAgZXZlbnRfdHlwZV9pZDogZXZlbnRfdHlwZV9pZF9maWx0ZXIsCiAgICAgICAgc3RhdHVzOiBzdGF0dXNfZmlsdGVyLAogICAgICAgIGlzX2NhbmNlbGVkOiAiMCIKICAgICAgfTsKCiAgICAgIC8vIGNvbnNvbGUubG9nKCRzY29wZS5jYWxlbmRhcik7CiAgICAgIGxvZ0RlYnVnKCJiZWZvcmUgcmVmZXRjaEV2ZW50cyIpOwogICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwogICAgICBsb2dEZWJ1ZygiYWZ0ZXIgcmVmZXRjaEV2ZW50cyIpOwogICAgICAvLyB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwoKICAgIH0KCiRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyPWZhbHNlOwoKaWYgKHNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKSE9bnVsbCkKewpjb25zb2xlLmxvZygiZ290IHByZXZpb3VzIHNlbGVjdGVkIHVzZXIgIitzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfZmlyc3RfbmFtZSk7CiRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VybmFtZT1zaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfZmlyc3RfbmFtZSsiICIrc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2VyX2xhc3RfbmFtZTsKJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJfaWQ9c2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2luZXNzX3VzZXJfaWQ7CmxvZ0RlYnVnKCIkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcl9pZD0iKyRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyX2lkKTsKCiRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyPXRydWU7Cn0KCi8vIGNoZWNraW5nIGlmIGNhbGVuZGFyIHNob3VsZCBzdGFydCB3aXRoIGEgc3BlY2lmaWMgZGF0ZSAoZnJvbSB1cmwgb3IgZnJvbSBwcmV2aW91c2x5IHNlbGVjdGVkIGRhdGUpCmxvZ0RlYnVnKCIkbG9jYXRpb24uc2VhcmNoKCkuc3RhcnQ9IiArICRsb2NhdGlvbi5zZWFyY2goKS5zdGFydCk7CmlmICh0eXBlb2YgJGxvY2F0aW9uLnNlYXJjaCgpLnN0YXJ0ICE9ICd1bmRlZmluZWQnKQp7CmN1cnJEZWZhdWx0RGF0ZSA9ICRsb2NhdGlvbi5zZWFyY2goKS5zdGFydDsKfQplbHNlIGlmIChzaGFyZWRQcm9wZXJ0aWVzLmdldF9jYWxlbmRhcl9kYXRlKCkhPW51bGwpCnsKY29uc29sZS5sb2coImdvdCBwcmV2aW91cyBkYXRlICAiK3NoYXJlZFByb3BlcnRpZXMuZ2V0X2NhbGVuZGFyX2RhdGUoKSk7CmN1cnJEZWZhdWx0RGF0ZSA9IHNoYXJlZFByb3BlcnRpZXMuZ2V0X2NhbGVuZGFyX2RhdGUoKTsKfQplbHNlCnsKY3VyckRlZmF1bHREYXRlID0gbmV3IERhdGUoKTsKfQpnZXRBbGxJbnN0cnVjdG9ycygkaHR0cCwkc2NvcGUsJ2J1c2luZXNzX2luc3RydWN0b3JzJyxnZXRBbGxJbnN0cnVjdG9yc19maW5pc2gpOwogICAgZ2V0QWxsSW5zdHJ1Y3RvcnMoJGh0dHAsJHNjb3BlLCdpbnN0cnVjdG9ycycpOwpmdW5jdGlvbiBnZXRBbGxJbnN0cnVjdG9yc19maW5pc2goKQp7Ci8vIGNvbnNvbGUubG9nKCRzY29wZS5idXNpbmVzc19pbnN0cnVjdG9ycyk7CiRzY29wZS5idXNpbmVzc19pbnN0cnVjdG9ycy51bnNoaWZ0KHsiYnVzZXJfZnVsbF9uYW1lIjoi15vXnCDXlNem15XXldeqIiwgImJ1c2VyX2ZpcnN0X25hbWUiOiLXm9eV15zXnSIsImJ1c2VyX2xhc3RfbmFtZSI6IiIsICJ1c2VyX2lkIjogMCwgImJ1c2luZXNzX3VzZXJfaWQiOiAwfSk7CgovLyBzZXR0aW5nIHNlbGVjdGVkIGdldF9zZWxlY3RlZF9pbnN0cnVjdG9yCiRzY29wZS5wcmV2aW91c19zZWxlY3RlZF9pbnN0cnVjdG9yPWZhbHNlOwppZiAoc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfaW5zdHJ1Y3RvcigpPj0wKQp7Ci8vIGNvbnNvbGUubG9nKCJnb3QgcHJldmlvdXMgc2VsZWN0ZWQgaW5zdHJ1Y3RvciAiK3NoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX2luc3RydWN0b3IoKSk7CiRzY29wZS5wcmV2aW91c19zZWxlY3RlZF9pbnN0cnVjdG9yX2lkPXNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX2luc3RydWN0b3IoKTsKJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX2luc3RydWN0b3I9dHJ1ZTsKJHNjb3BlLnNlbGVjdGVkX2J1c2luZXNzX3VzZXJfaWQ9c2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfaW5zdHJ1Y3RvcigpOwp9Cn0KICAgIGdldEFsbEJ1c2luZXNzRXZlbnRUeXBlcygkaHR0cCwkc2NvcGUsJ2V2ZW50X3R5cGVzX2NhbHMnKTsKZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzTm9TeXN0ZW0oJGh0dHAsJHNjb3BlLCdldmVudF90eXBlcycpOwoKLy8gc2V0dGluZyBzZWxlY3RlZCB1c2VyIGlkCiRzY29wZS5wcmV2aW91c19ldmVudF9yZXNjaGVkdWxlPWZhbHNlOwokc2NvcGUucHJldmlvdXNfZXZlbnRfcmVzY2hlZHVsZV9ldmVudD1udWxsOwoKJHNjb3BlLiRvbigiY2FsZW5kYXJFdmVudFJlc2NoZWR1bGVEZXNlbGVjdCIsZnVuY3Rpb24oZSxhKQp7CiRzY29wZS5jYWxlbmRhckV2ZW50UmVzY2hlZHVsZURlc2VsZWN0KCk7Cn0pOwoKLy8gZGVzZWxlY3RpbmcgZXZlbnQgZnJvbSBiZWluZyByZXNjaGVkdWxlZAokc2NvcGUuY2FsZW5kYXJFdmVudFJlc2NoZWR1bGVEZXNlbGVjdD1mdW5jdGlvbigpCnsKc2hhcmVkUHJvcGVydGllcy5zZXRfZXZlbnRfcmVzY2hlZHVsZShudWxsKTsKJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGU9ZmFsc2U7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZWZldGNoRXZlbnRzJyk7Cn0KLy8gZGVsZXRpbmcgY2xpZW50IHNlbGVjdGlvbiBpbiBjYWxlbmRhcgokc2NvcGUuY2FsZW5kYXJDbGllbnREZXNlbGVjdD1mdW5jdGlvbigpIC8vIHJlbG9hZCBjbGFzcy9ldmVudCBzdWdnZXN0aW9ucwp7CiRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyPWZhbHNlOwpzaGFyZWRQcm9wZXJ0aWVzLnNldF9zZWxlY3RlZF91c2VyKG51bGwpOwokc2NvcGUuZXZlbnRUeXBlU2VsZWN0ZWQoKTsKfQppZiAoaW5pdGlhbEVuZFVzZXIgIT0gbnVsbCkgewokc2NvcGUuYnVzaW5lc3NDYWxlbmRhckluaXRpYWxOYW1lID0gdHJ1ZTsKc2hhcmVkRGF0YS5zZXRTZWxlY3RlZEVuZFVzZXIobnVsbCk7CiRzY29wZS5idXNpbmVzc0NhbGVuZGFySW5pdGlhbHMgPSB7Cm5hbWU6IGluaXRpYWxFbmRVc2VyLmZpcnN0X25hbWUgKyAiICIgKyBpbml0aWFsRW5kVXNlci5sYXN0X25hbWUKfTsKfSBlbHNlIHsKJHNjb3BlLmJ1c2luZXNzQ2FsZW5kYXJJbml0aWFsTmFtZSA9IGZhbHNlOwp9Ci8qIGNvbmZpZyBvYmplY3QgKi8KJHNjb3BlLmNhbGVuZGFyX25hbWUgPSAiY2FsZW5kYXJfYnVzaW5lc3MiOwokc2NvcGUuY2FsZW5kYXIgPSAiY2FsZW5kYXJfYnVzaW5lc3MiOwovKiBldmVudCBzb3VyY2VzIGFycmF5Ki8KCiAgICAvLyB0aGVkYXRhID0geyBzb3VyY2U6ICJjYWxlbmRhciIgfQogICAgLy8gdGhlZGF0YVsnZmlsdGVycyddID0geyBpbnN0cnVjdG9yX2lkOiAiMTk1In07CgogICAgLy8gY29uc29sZS5sb2codGhlZGF0YSk7Cgokc2NvcGUuYnVzaW5lc3NDYWxlbmRhckV2ZW50U291cmNlcyA9IFt7CiAgICAgIC8vIHVybDogJy9hcGkvYWRtaW4vZXZlbnRzL2dldHBvc3QnLAogICAgICB1cmw6ICcvYXBpL2FkbWluL3JlcG9ydHMvZXZlbnRzMicsCiAgICAgIGRhdGE6ICRzY29wZS50aGVkYXRhX3JlcG9ydCAsCnR5cGU6ICdQT1NUJwp9LCB7CnVybDogJy9hcGkvYWRtaW4vY2FsZW5kYXIvbGltaXRhdGlvbnMvYmFja2dyb3VuZC9nZXRwb3N0JywKICAgICAgZGF0YTogJHNjb3BlLnRoZWRhdGFfcmVwb3J0ICwKICAgICAgdHlwZTogJ1BPU1QnICAgIC8vIH0sIHsKLy8gICAgIHVybDogJy9hcGkvYWRtaW4vcmVjdXJyaW5nL2dldHBvc3QnLAovLyAgICAgdHlwZTogJ1BPU1QnCn1dOwoKJHNjb3BlLmdvdG9Ub2RheSA9IGZ1bmN0aW9uKCkgewokc2NvcGUuZ290b0RhdGUobmV3IERhdGUoKSk7CnZpc2libGVEYXRlU3RhcnQgPSBuZXcgRGF0ZSh1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ2V0VmlldycpLnN0YXJ0KTsKZGF0ZVRvR29UbyA9IHZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSArICItIiArICgnMCcgKyAodmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpICsgMSkpLnNsaWNlKC0yKSArICItIiArICgnMCcgKyB2aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSkuc2xpY2UoLTIpOwpzaGFyZWRQcm9wZXJ0aWVzLnNldF9jYWxlbmRhcl9kYXRlKGRhdGVUb0dvVG8pOwokc2NvcGUudmlzaWJsZURhdGVTdGFydD12aXNpYmxlRGF0ZVN0YXJ0OwokbG9jYXRpb24uc2VhcmNoKCdzdGFydCcsZGF0ZVRvR29Ubyk7Cn0KCiRzY29wZS5pbnN0cnVjdG9yU2VsZWN0ZWQ9ZnVuY3Rpb24odGhpc3RoaXMpCnsKdXBkYXRlU3VnZ2VzdGlvbnMoKTsKfQokc2NvcGUuZXZlbnRUeXBlU2VsZWN0ZWQ9ZnVuY3Rpb24odGhpc3RoaXMpCnsKdXBkYXRlU3VnZ2VzdGlvbnMoKTsKfQpmdW5jdGlvbiB1cGRhdGVTdWdnZXN0aW9ucygpCnsKbG9nRGVidWcoImZ1bmN0aW9uOiB1cGRhdGVTdWdnZXN0aW9ucyIpOwpzaGFyZWRQcm9wZXJ0aWVzLnNldF9ldmVudF90eXBlX2Zvcl9zdWdnZXN0aW9ucygkc2NvcGUuc2VsZWN0ZWRfZXZlbnRfdHlwZV9pZCk7CnNoYXJlZFByb3BlcnRpZXMuc2V0X3NlbGVjdGVkX2luc3RydWN0b3IoJHNjb3BlLnNlbGVjdGVkX2J1c2luZXNzX3VzZXJfaWQpOwpmb3IgKGk9MDtpPCRzY29wZS5ldmVudF90eXBlcy5sZW5ndGg7aSsrKQp7Ci8vIGNvbnNvbGUubG9nKCRzY29wZS5ldmVudF90eXBlc1tpXS5ldmVudF90eXBlX2lkKTsKaWYgKCRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkPT0kc2NvcGUuZXZlbnRfdHlwZXNbaV0uZXZlbnRfdHlwZV9pZCkKewovLyBjb25zb2xlLmxvZygiZm91bmQgZXZlbnQgdHlwZSBpZCIpOwppZiAoJHNjb3BlLmV2ZW50X3R5cGVzW2ldLmlzX2NsYXNzKSAvLyBpcyBjbGFzcwp7CmxvZ0RlYnVnKCIkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcj0iKyRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyKTsKaWYgKCRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyKQp7CmNvbnNvbGUubG9nKCJpcyBjbGFzcyBzdWdnZXN0aW9uZCIpOwokaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3RjbGFzcy8iKyRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkKyIvIiskc2NvcGUuc2VsZWN0ZWRfYnVzaW5lc3NfdXNlcl9pZCsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSsiLyIrKCRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkrMSkrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0SG91cnMoKSArICIvIiArICRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKSArICIvIiArICRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyX2lkKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKQp7CiRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkX2lzX2NsYXNzPXRydWU7CiRzY29wZS5ldmVudHNTdWdnZXN0ZWQgPSByZXNwb25zZS5kYXRhOwp9KTsKfQplbHNlCnsKY29uc29sZS5sb2coIm5vdCBpcyBjbGFzcyBzdWdnZXN0aW9uZCIpOwokaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3RjbGFzcy8iKyRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkKyIvIiskc2NvcGUuc2VsZWN0ZWRfYnVzaW5lc3NfdXNlcl9pZCsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSsiLyIrKCRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkrMSkrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0SG91cnMoKSArICIvIiArICRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKSArICIvMCIpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpCnsKJHNjb3BlLnNlbGVjdGVkX2V2ZW50X3R5cGVfaWRfaXNfY2xhc3M9dHJ1ZTsKJHNjb3BlLmV2ZW50c1N1Z2dlc3RlZCA9IHJlc3BvbnNlLmRhdGE7Cn0pOwp9Cn0KZWxzZSAvLyBpcyBub3QgY2xhc3MKewokaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3QvIiskc2NvcGUuc2VsZWN0ZWRfZXZlbnRfdHlwZV9pZCsiLyIrJHNjb3BlLnNlbGVjdGVkX2J1c2luZXNzX3VzZXJfaWQrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCkrIi8iKygkc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpKzEpKyIvIiskc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXREYXRlKCkrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldEhvdXJzKCkgKyAiLyIgKyAkc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXRNaW51dGVzKCkpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpCnsKJHNjb3BlLnNlbGVjdGVkX2V2ZW50X3R5cGVfaWRfaXNfY2xhc3M9ZmFsc2U7CiRzY29wZS5ldmVudHNTdWdnZXN0ZWQgPSByZXNwb25zZS5kYXRhOwp9KTsKfQp9Cn0KfQoKJHNjb3BlLmdvdG9OZXh0ID0gZnVuY3Rpb24oKSB7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZW1vdmVFdmVudHMnKTsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ25leHQnKTsKJHNjb3BlLnVwZGF0ZUNhbGVuZGFyQ2VudGVyVGl0bGUoKTsKLy8gYWRkaW5nIHRoZSBmb2xsb3dpbmcgdG8gbWFrZSB0aGUgdXJsCi8vIHBvaW50IHRvIHRoZSByaWdodCB3ZWVrLCBpZiBnb2luZyB0byBhIGRpZmZlcmVudCBVUkwgYW5kIHRoZW4gZ29pbmcgYmFjawp2aXNpYmxlRGF0ZVN0YXJ0ID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5zdGFydCk7CmRhdGVUb0dvVG8gPSB2aXNpYmxlRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCkgKyAiLSIgKyAoJzAnICsgKHZpc2libGVEYXRlU3RhcnQuZ2V0TW9udGgoKSArIDEpKS5zbGljZSgtMikgKyAiLSIgKyAoJzAnICsgdmlzaWJsZURhdGVTdGFydC5nZXREYXRlKCkpLnNsaWNlKC0yKTsKc2hhcmVkUHJvcGVydGllcy5zZXRfY2FsZW5kYXJfZGF0ZShkYXRlVG9Hb1RvKTsKJHNjb3BlLnZpc2libGVEYXRlU3RhcnQ9dmlzaWJsZURhdGVTdGFydDsKJGxvY2F0aW9uLnNlYXJjaCgnc3RhcnQnLGRhdGVUb0dvVG8pOwp9CiRzY29wZS5nb3RvUHJldiA9IGZ1bmN0aW9uKCkgewp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVtb3ZlRXZlbnRzJyk7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdwcmV2Jyk7CiRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlKCk7Ci8vIGFkZGluZyB0aGUgZm9sbG93aW5nIHRvIG1ha2UgdGhlIHVybAovLyBwb2ludCB0byB0aGUgcmlnaHQgd2VlaywgaWYgZ29pbmcgdG8gYSBkaWZmZXJlbnQgVVJMIGFuZCB0aGVuIGdvaW5nIGJhY2sKdmlzaWJsZURhdGVTdGFydCA9IG5ldyBEYXRlKHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3Jykuc3RhcnQpOwpkYXRlVG9Hb1RvID0gdmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpICsgIi0iICsgKCcwJyArICh2aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkgKyAxKSkuc2xpY2UoLTIpICsgIi0iICsgKCcwJyArIHZpc2libGVEYXRlU3RhcnQuZ2V0RGF0ZSgpKS5zbGljZSgtMik7CnNoYXJlZFByb3BlcnRpZXMuc2V0X2NhbGVuZGFyX2RhdGUoZGF0ZVRvR29Ubyk7CiRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0PXZpc2libGVEYXRlU3RhcnQ7CiRsb2NhdGlvbi5zZWFyY2goJ3N0YXJ0JyxkYXRlVG9Hb1RvKTsKCn0KJHNjb3BlLmdvdG9EYXRlID0gZnVuY3Rpb24obmV3ZGF0ZSkgewp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ290b0RhdGUnLCBuZXdkYXRlKTsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlbW92ZUV2ZW50cycpOwp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwokc2NvcGUudXBkYXRlQ2FsZW5kYXJDZW50ZXJUaXRsZSgpOwp9Cgokc2NvcGUuZWRpdEhvdXJzT2ZXb3JrID0gZnVuY3Rpb24oKSB7Ci8vIHBhcmFtIHNob3VsZCBsb29rIGxpa2UgIjIwMTYtMDctMDEiCnZpc2libGVEYXRlU3RhcnQgPSBuZXcgRGF0ZSh1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ2V0VmlldycpLnN0YXJ0KTsKZGF0ZVRvR29UbyA9IHZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSArICItIiArICgnMCcgKyAodmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpICsgMSkpLnNsaWNlKC0yKSArICItIiArICgnMCcgKyB2aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSkuc2xpY2UoLTIpOwokbG9jYXRpb24ucGF0aCgnL2hvdXJzX29mX3dvcmsnKS5zZWFyY2goewpzdGFydDogZGF0ZVRvR29Ubwp9KTsKfTsKCiRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlID0gZnVuY3Rpb24oKSB7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3Jyk7Cgp2aXNpYmxlRGF0ZVN0YXJ0ID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5zdGFydCk7CnZpc2libGVEYXRlRW5kID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5lbmQpOwoKJHNjb3BlLmNhbGVuZGFyVGl0bGVDZW50ZXIgPSB2aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSArICIgIiArIG1vbnRoTmFtZXNbdmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpXSArCiIg4oCUICIgKyB2aXNpYmxlRGF0ZUVuZC5nZXREYXRlKCkgKyAiICIgKyBtb250aE5hbWVzW3Zpc2libGVEYXRlRW5kLmdldE1vbnRoKCldICsKIiAiICsgdmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpOwp9OwoKJHNjb3BlLnNob3dFdmVudFBvcHVwID0gZnVuY3Rpb24oc2VsZWN0ZWRFdmVudCkgewpzaG93RXZlbnRQb3B1cChzZWxlY3RlZEV2ZW50LCAkdWliTW9kYWwpCn07Cgokc2NvcGUuZXZlbnRDcmVhdGVNb2RhbEZyb21TY2hlZHVsZXIgPSBmdW5jdGlvbihlc3VnZ2VzdCkKewovLyBpZiBjbGFzcyAtIGdvIHRvIGV2ZW50IGNsYXNzCmNvbnNvbGUubG9nKGVzdWdnZXN0KTsKZm9yIChpPTA7aTwkc2NvcGUuZXZlbnRfdHlwZXMubGVuZ3RoO2krKykKewppZiAoZXN1Z2dlc3QuZXZlbnRfdHlwZV9pZD09JHNjb3BlLmV2ZW50X3R5cGVzW2ldLmV2ZW50X3R5cGVfaWQpCnsKaWYgKCRzY29wZS5ldmVudF90eXBlc1tpXS5pc19jbGFzcykKewpjb25zb2xlLmxvZygiaXMgY2xhc3MiKTsKd2luZG93LmxvY2F0aW9uLmhyZWY9Jy8jL2V2ZW50X2NsYXNzLycgKyBlc3VnZ2VzdC5ldmVudF9pZDsKcmV0dXJuOwp9Cn0KfQpsb2dEZWJ1ZyhKU09OLnN0cmluZ2lmeShlc3VnZ2VzdCkpOwpsb2dEZWJ1Zyhlc3VnZ2VzdC5zdGFydF9lcG9jaCk7CnN0YXJ0RGF0ZT1lc3VnZ2VzdC5zdGFydF9lcG9jaCoxMDAwOwoKdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CmFuaW1hdGlvbjogZmFsc2UsCnRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2V2ZW50X2NyZWF0ZS5waHAnLApjb250cm9sbGVyOiAnZXZlbnRDcmVhdGVNb2RhbENvbnRyb2xsZXInLApzaXplOiAnbCcsCnJlc29sdmU6IHsKc3RhcnREYXRlOiBmdW5jdGlvbigpIHsKcmV0dXJuIHN0YXJ0RGF0ZTsKfSwKZXZlbnRfdHlwZV9pZDogZnVuY3Rpb24oKSB7CnJldHVybiAkc2NvcGUuc2VsZWN0ZWRfZXZlbnRfdHlwZV9pZDsKfSwKbG9jYXRpb25faWQ6IGZ1bmN0aW9uKCkgewpyZXR1cm4gZXN1Z2dlc3QubG9jYXRpb25faWQ7Cn0sCmVtcF9pZDogZnVuY3Rpb24oKSB7CnJldHVybiBlc3VnZ2VzdC5lbXBfaWQ7Cn0sCnJlc2NoZWR1bGVfZXZlbnQ6IGZ1bmN0aW9uKCkKewppZiAoJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGUpCnsKcmV0dXJuICRzY29wZS5wcmV2aW91c19ldmVudF9yZXNjaGVkdWxlX2V2ZW50Owp9CmVsc2UKewpyZXR1cm4gbnVsbDsKfQp9Cgp9Cn0pOwoKfQokc2NvcGUuZXZlbnRDcmVhdGVNb2RhbCA9IGZ1bmN0aW9uKHN0YXJ0RGF0ZSwgc2l6ZSkgewogICAgICAgIGxvZ0RlYnVnKCJldmVudENyZWF0ZU1vZGFsIHN0YXJ0RGF0ZT0iK3N0YXJ0RGF0ZSk7Cgp2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKYW5pbWF0aW9uOiBmYWxzZSwKdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfZXZlbnRfY3JlYXRlLnBocCcsCmNvbnRyb2xsZXI6ICdldmVudENyZWF0ZU1vZGFsQ29udHJvbGxlcicsCnNpemU6IHNpemUsCnJlc29sdmU6IHsKc3RhcnREYXRlOiBmdW5jdGlvbigpIHsKcmV0dXJuIHN0YXJ0RGF0ZTsKfSwKZXZlbnRfdHlwZV9pZDogZnVuY3Rpb24oKSB7CnJldHVybiAwOwp9LApsb2NhdGlvbl9pZDogZnVuY3Rpb24oKSB7CnJldHVybiAwOwp9LAplbXBfaWQ6IGZ1bmN0aW9uKCkgewpyZXR1cm4gMDsKfSwKcmVzY2hlZHVsZV9ldmVudDogZnVuY3Rpb24oKQp7CmlmICgkc2NvcGUucHJldmlvdXNfZXZlbnRfcmVzY2hlZHVsZSkKewpyZXR1cm4gJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGVfZXZlbnQ7Cn0KZWxzZQp7CnJldHVybiBudWxsOwp9ICAgICAgICAgICAgICAgIH0KCn0KfSk7Cgptb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHNlbGVjdGVkSXRlbSkgewokc2NvcGUuc2VsZWN0ZWQgPSBzZWxlY3RlZEl0ZW07Cn0sIGZ1bmN0aW9uKCkgewpsb2dEZWJ1ZygnTW9kYWwgZGlzbWlzc2VkIGF0OiAnICsgbmV3IERhdGUoKSk7Cn0pOwp9OwoKLy8vCiRzY29wZS51cGRhdGVFdmVudERhdGFiYXNlID0gZnVuY3Rpb24oc3RhcnRfcGFyYW0sIGVuZF9wYXJhbSwgZXZlbnRfaWQsIHRoZWV2ZW50KQp7Cgpsb2dEZWJ1ZygidXBkYXRlRXZlbnREYXRhYmFzZSBzdGFydD0iICsgc3RhcnRfcGFyYW0gKyAiLCBlbmQ9IiArIGVuZF9wYXJhbSArICIsIGV2ZW50X2lkPSIgKyBldmVudF9pZCk7CnRoZXVybCA9ICcvYXBpL2FkbWluL2V2ZW50cy9zZXQvJyArIGV2ZW50X2lkOwoKJGh0dHAoewptZXRob2Q6ICdQT1NUJywKdXJsOiB0aGV1cmwsCmRhdGE6IHsKc3RhcnRfZGF0ZTogc3RhcnRfcGFyYW0sCmVuZF9kYXRlOiBlbmRfcGFyYW0sCmV2ZW50X2lkOiBldmVudF9pZAp9LApoZWFkZXJzOiB7CidDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbjtjaGFyc2V0PXV0Zi04Jwp9Cn0pLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkgewoKbG9nRGVidWcoZGF0YSk7CmlmIChkYXRhLkVycm9yKSB7CmxvZ0RlYnVnKCJlcnJvciAiICsgZGF0YS5NZXNzYWdlKTsKYWxlcnQoJ2Vycm9yJyk7CmNhbGVuZGFyID0gImNhbGVuZGFyX2J1c2luZXNzIjsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwp9IGVsc2Ugewpsb2dEZWJ1Zygic3VjY2VzcyIpOwpjYWxlbmRhciA9ICJjYWxlbmRhcl9idXNpbmVzcyI7Ci8vIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKLy8gJHVpYk1vZGFsSW5zdGFuY2UuZGlzbWlzcygnYWRkZWQgYW5kIHJlZmV0Y2hFdmVudHMnKTsKfQp9KTsKCn07Ci8vLwoKJHNjb3BlLmNsYXNzRXZlbnRBZGRVc2VyID0gZnVuY3Rpb24oZXN1Z2dlc3QpCnsKY29uc29sZS5sb2coImNsYXNzRXZlbnRBZGRVc2VyIG9yIFJlbW92ZSIpOwppZiAoKGVzdWdnZXN0LmlzX3JlZ2lzdGVyZWQ9PTEpIHwgKChlc3VnZ2VzdC5pc193YWl0aW5nbGlzdD09MSkgJiYgKGVzdWdnZXN0LmlzX2NhbmNlbGVkPT0wKSkpCnsKY29uc29sZS5sb2coIm5lZWQgdG8gdW5yZWdpc3RlciIpOwpyZW1vdmVFbmRVc2VyRnJvbUV2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcl9pZCxlc3VnZ2VzdC5ldmVudF9pZCxyZW1vdmVFbmRVc2VyRnJvbUV2ZW50X2NhbGxiYWNrLCByZW1vdmVFbmRVc2VyRnJvbUV2ZW50X2NhbGxiYWNrKTsKZnVuY3Rpb24gcmVtb3ZlRW5kVXNlckZyb21FdmVudF9jYWxsYmFjaygpCnsKJHNjb3BlLmV2ZW50VHlwZVNlbGVjdGVkKCk7CmNhbGVuZGFyID0gImNhbGVuZGFyX2J1c2luZXNzIjsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwoKfQp9CmVsc2UKewovLyBjb25zb2xlLmxvZyhlc3VnZ2VzdC5ldmVudF9pZCk7Ci8vIGNvbnNvbGUubG9nKCRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyX2lkKTsKLy8gaWYgc2VsZWN0ZWQgdXNlciAtIGFkZGluZyBoaW0vaGVyIHRvIGNsYXNzCmlmICgkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcikKewphZGRFbmRVc2VyVG9FdmVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJfaWQsZXN1Z2dlc3QuZXZlbnRfaWQsYWRkRW5kVXNlclRvRXZlbnRfY2FsbGJhY2ssIGFkZEVuZFVzZXJUb0V2ZW50X2NhbGxiYWNrKTsKZnVuY3Rpb24gYWRkRW5kVXNlclRvRXZlbnRfY2FsbGJhY2soKQp7CmNhbGVuZGFyID0gImNhbGVuZGFyX2J1c2luZXNzIjsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwokc2NvcGUuZXZlbnRUeXBlU2VsZWN0ZWQoKTsKfQp9CmVsc2UgLy8gZWxzZSAtIGdvaW5nIHRvIGNsYXNzIHBhZ2UKewp3aW5kb3cubG9jYXRpb24uaHJlZj0nLyMvZXZlbnRfY2xhc3MvJyArIGVzdWdnZXN0LmV2ZW50X2lkOwp9Cn0KfQokc2NvcGUuY2FsZW5kYXJfYnVzaW5lc3NfY29uZmlnID0gewpjYWxlbmRhcjogewpoZWlnaHQ6ICdhdXRvJywKZWRpdGFibGU6IHRydWUsCi8vIGhlYWRlcjogewovLyAgICAgbGVmdDogJycsCi8vICAgICBjZW50ZXI6ICcnLAovLyAgICAgcmlnaHQ6ICcnCi8vIH0sCi8vIGhlYWRlcjogewovLyAgICAgbGVmdDogJ3RpdGxlJywKLy8gICAgIGNlbnRlcjogJycsCi8vICAgICByaWdodDogJ3RvZGF5IHByZXYsbmV4dCcKLy8gfSwKdGl0bGVGb3JtYXQ6IHsKLy8gd2VlazogICJkIFtNTU1deyAnJiM4MjExOycgZCBNTU19Igp9LAovLyB0aXRsZUZvcm1hdDogewovLyAgICAgbW9udGg6ICdNTU1NIHl5eXknLAovLyAgICAgd2VlazogIk1NTSBkWyB5eXl5XXsgJyYjODIxMjsnWyBNTU1dIGQgeXl5eX0iLAovLyAgICAgZGF5OiAnTU0vZGQnCi8vIH0sCmhlYWRlcjogJycsCi8vIGRlZmF1bHRWaWV3OiAnYWdlbmRhV2VlaycsCi8vIHZpZXdzOiB7Ci8vICAgICBkb250U2hvd0RhdGU6IHsKLy8gICAgICAgICB0eXBlOiAnYWdlbmRhV2VlaycsCi8vICAgICAgICAgZHVyYXRpb246IHsKLy8gICAgICAgICAgICAgZGF5czogNwovLyAgICAgICAgIH0sCi8vICAgICAgICAgdGl0bGU6ICdBcGVydHVyYScsCi8vICAgICAgICAgY29sdW1uRm9ybWF0OiAnZGRkZCcgLy8gRm9ybWF0IHRoZSBkYXkgdG8gb25seSBzaG93IGxpa2UgJ01vbmRheScKLy8gICAgICAgICAgICAgLy8gaGlkZGVuRGF5czogWzAsIDZdIC8vIEhpZGUgU3VuZGF5IGFuZCBTYXR1cmRheT8KLy8gICAgIH0KLy8gfSwKLy8gc2xvdER1cmF0aW9uOiAnMDA6MTU6MDAnLApldmVudERyb3A6IGZ1bmN0aW9uKGV2ZW50LCBkYXlEZWx0YSwgbWludXRlRGVsdGEsIGFsbERheSwgcmV2ZXJ0RnVuYywgdWlDYWxlbmRhckNvbmZpZykgewpsb2dEZWJ1ZygiZXZlbnQgZHJvcCIgKyBldmVudC50aXRsZSArICIoIiArIGV2ZW50LmlkICsgIikgbW92ZWQgIiArIG1pbnV0ZURlbHRhICsgIiBtaW51dGVzIik7CmxvZ0RlYnVnKCJvbGQgc3RhcnQ9IiArIGV2ZW50LnN0YXJ0ICsgIiwgb2xkIGVuZD0iICsgZXZlbnQuZW5kKTsKJHNjb3BlLnVwZGF0ZUV2ZW50RGF0YWJhc2UoZXZlbnQuc3RhcnQsIGV2ZW50LmVuZCwgZXZlbnQuaWQsIGV2ZW50KTsKfSwKZXZlbnRSZXNpemU6IGZ1bmN0aW9uKGV2ZW50LCBkZWx0YSwgcmV2ZXJ0RnVuYykgewpsb2dEZWJ1ZygiZXZlbnQgcmVzaXplIiArIGV2ZW50LnRpdGxlICsgIigiICsgZXZlbnQuaWQgKyAiKSBtb3ZlZCAiKTsKbG9nRGVidWcoIm9sZCBzdGFydD0iICsgZXZlbnQuc3RhcnQgKyAiLCBvbGQgZW5kPSIgKyBldmVudC5lbmQpOwokc2NvcGUudXBkYXRlRXZlbnREYXRhYmFzZShldmVudC5zdGFydCwgZXZlbnQuZW5kLCBldmVudC5pZCwgZXZlbnQpOwp9LApkZWZhdWx0VmlldzogJ2FnZW5kYVdlZWsnLApldmVudFN0YXJ0RWRpdGFibGU6ZmFsc2UsCmV2ZW50RHVyYXRpb25FZGl0YWJsZTpmYWxzZSwKZGVmYXVsdERhdGU6IG1vbWVudChjdXJyRGVmYXVsdERhdGUpLAoKLy8gZGVmYXVsdFZpZXc6ICdkb250U2hvd0RhdGUnLApldmVudENsaWNrOiBmdW5jdGlvbihjYWxFdmVudCwganNFdmVudCwgdmlldykgewpsb2dEZWJ1ZygiY2FsZW5kYXIgZXZlbnQgY2xpY2tlZCAiICsgY2FsRXZlbnQudGl0bGUgKyAiKCIgKyBjYWxFdmVudC5pZCArICIpICIgKyBjYWxFdmVudC5zdGFydCArICIgIiArIGNhbEV2ZW50LmVuZCk7Ci8vIGxvZ0RlYnVnKEpTT04uc3RyaW5naWZ5KGNhbEV2ZW50KSk7Ci8vIGlmIGl0J3MgYSBnZW5lcmljIGV2ZW50ICh2YWNhdGlvbiBldGMpCi8vIHNob3cgcG9wdXAgd2l0aCBvcHRpb24gdG8gZGVsZXRlCmlmIChjYWxFdmVudC5pc19nZW5lcmljX2V0eXBlPT0xKQp7Ci8vICRzY29wZS5zaG93R2VuZXJpY0V2ZW50KGNhbEV2ZW50KTsKJHNjb3BlLnNob3dFdmVudFBvcHVwKGNhbEV2ZW50KTsKCn0KZWxzZQp7CiRzY29wZS5zaG93RXZlbnRQb3B1cChjYWxFdmVudCk7Cn0KLy8gY2hhbmdlIHRoZSBib3JkZXIgY29sb3IganVzdCBmb3IgZnVuCi8vICQodGhpcykuY3NzKCdib3JkZXItY29sb3InLCAncmVkJyk7Cgp9LApkYXlDbGljazogZnVuY3Rpb24oZGF0ZSwganNFdmVudCwgdmlldykgewovLyBsb2dEZWJ1ZygibmV3IGV2ZW50IGNyZWF0aW9uIGNsaWNrZWQgIiArIGNhbEV2ZW50LnRpdGxlICsgIigiICsgY2FsRXZlbnQuaWQgKyAiKSAiICsgY2FsRXZlbnQuc3RhcnQgKyAiICIgKyBjYWxFdmVudC5lbmQpOwovLyAgICAgc3RhcnQgPSBkYXRlOwovLyAgICAgZW5kID0gbW9tZW50KHN0YXJ0KS5hZGQoNDUsICdtaW51dGVzJyk7CmlmICh2aWV3Lm5hbWUgPT09ICJtb250aCIpIHsKY2FsZW5kYXIgPSAiY2FsZW5kYXJfYnVzaW5lc3MiOwp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdjaGFuZ2VWaWV3JywgImFnZW5kYVdlZWsiKTsKfSBlbHNlIHsKJHNjb3BlLmV2ZW50Q3JlYXRlTW9kYWwoZGF0ZSk7Cn0KLy8gY2hhbmdlIHRoZSBib3JkZXIgY29sb3IganVzdCBmb3IgZnVuCi8vICQodGhpcykuY3NzKCdib3JkZXItY29sb3InLCAncmVkJyk7Cgp9LApldmVudFJlbmRlcjogZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpCnsKaWYgKCFldmVudC5ldmVudF9pZD4wKQp7Ci8vIG5vdCBhIHJlYWwgZXZlbnQgLSBwcm9iYWJseSBibG9jayAvIGJhY2tncm91bmQKLy8gaWdub3JpbmcgaXQKcmV0dXJuOwp9Ci8vIGNoYW5naW5nIGxvb2sgYW5kIGZlZWwgb2YgZXZlbiB0aGF0IGlzIHRvIHJlc2NoZWR1bGUKaWYgKHNoYXJlZFByb3BlcnRpZXMuZ2V0X2V2ZW50X3Jlc2NoZWR1bGUoKSE9bnVsbCkKewppZiAoZXZlbnQuZXZlbnRfaWQ9PXNoYXJlZFByb3BlcnRpZXMuZ2V0X2V2ZW50X3Jlc2NoZWR1bGUoKS5ldmVudF9pZCkKewplbGVtZW50LmNzcygnYmFja2dyb3VuZC1jb2xvcicsICcjQTlBOUE5CScpOwplbGVtZW50LmNzcygnYm9yZGVyLWNvbG9yJywgJyNBOUE5QTkJJyk7CnJldHVybjsKfQp9CiAgICAgICAgICAgICAgICBpZiAoZXZlbnQuaXNfZ2VuZXJpY19ldHlwZT09MSkKICAgICAgICAgICAgICAgIHsKCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIGlmIChldmVudC5pc19jbGFzcz09MSkKewovLyBpZiBjbGFzcyBhZGRpbmcgbnVtYmVyIG9mIHBhcnRpY2lwYW50cwppZiAoZXZlbnQubm9fb2Zfd2FpdGluZ191c2Vycz4wKQp7CmVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZChldmVudC5ub19vZl91c2VycysiLyIrZXZlbnQubWF4X3BhcnRpY2lwYW50cysgIiAoIitldmVudC5ub19vZl93YWl0aW5nX3VzZXJzKyIpIisiIC0gIik7Cn0KZWxzZQp7CmVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZChldmVudC5ub19vZl91c2VycysiLyIrZXZlbnQubWF4X3BhcnRpY2lwYW50cysiIC0gIik7Cn0KfQplbHNlCnsKLy8gaWYgbm90IGNsYXNzIC0gd3JpdGluZyB0aGUgZW5kdXNlciBuYW1lCmlmIChldmVudC5kdXJhdGlvbl9ldmVudCE9MCkgLy8gYWxzbyBpZiBub3QgaG91cnMgb2Ygd29yawp7Ci8vIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykuYXBwZW5kKCIgKCIrZXZlbnQuZXZlbnRVc2Vyc1swXS5idXNlcl9maXJzdF9uYW1lKyIgIitldmVudC5ldmVudFVzZXJzWzBdLmJ1c2VyX2xhc3RfbmFtZSsiKSIpOwovLyBjb25zb2xlLmxvZyhldmVudC5ldmVudFVzZXJzKTsKLy8gY29uc29sZS5sb2coZXZlbnQuZXZlbnRVc2Vycy5sZW5ndGgpOwogICAgICAgICAgICAgICAgICAgIC8vIGlmIChldmVudC5ldmVudFVzZXJzLmxlbmd0aD4wKQp7CiAgICAgICAgICAgICAgICAgICAgICAvLyBlbGVtZW50LmZpbmQoJy5mYy10aXRsZScpLnByZXBlbmQoIiIrZXZlbnQuZXZlbnRVc2Vyc1swXS5idXNlcl9maXJzdF9uYW1lKyIgIitldmVudC5ldmVudFVzZXJzWzBdLmJ1c2VyX2xhc3RfbmFtZSsiICgiKTsKICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZCgiIitldmVudC5ldmVudF91c2VyX2NsaWVudHMrIiAoIik7CmVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykuYXBwZW5kKCIpIik7Cn0KfQovLyBsb2dEZWJ1ZygiaGVyZTQiKTsKfQppZiAoZXZlbnQuaXNfcmVwZWF0aW5nID09IDEpIHsKZWxlbWVudC5maW5kKCIuZmMtdGl0bGUiKS5hcHBlbmQoIiZuYnNwOzxpIGNsYXNzPSdmYSBmYS1yZXBlYXQnPjwvaT4mbmJzcDsiKTsKLy8gIGVsZW1lbnQuZmluZCgiLmZjLXRpdGxlIikuYXBwZW5kKCImbmJzcDs8aW1nIHNyYz0nL3B1YmxpYy9pbWFnZXMvcmVjdXJyaW5nLWljb24ucG5nJyB3aWR0aD0nMTBweCcgaGVpZ2h0PScxMHB4Jy8+Iik7Cn0KfSwKbWluVGltZTogJGdDYWxlbmRhckRpc3BsYXlNaW5UaW1lLAptYXhUaW1lOiAkZ0NhbGVuZGFyRGlzcGxheU1heFRpbWUsCnNlbGVjdGFibGU6IGZhbHNlLApzZWxlY3RIZWxwZXI6IGZhbHNlLAp0aW1lem9uZTogZmFsc2UsCmlzUlRMOiB0cnVlLApsYW5nOiAiaGUiLCAvLyBrawphbGxEYXlTbG90OiBmYWxzZSwKbG9hZGluZzogZnVuY3Rpb24oYm9vbCkgewppZiAoYm9vbCkgewogICAgICAgICAgICAgICAgICAgIGxvZ0RlYnVnKCdsb2FkaW5nIGNhbGVuZGFyMSAnICsgJHNjb3BlLmNhbGVuZGFyKTsKLy8gJCgnI2xvYWRpbmcnKS5zaG93KCk7Cn0gZWxzZSB7Ci8vICQoJyNsb2FkaW5nJykuaGlkZSgpOwpsb2dEZWJ1ZygnZmluaXNoZWQgbG9hZGluZyBjYWxlbmRhciB4JyArICRzY29wZS5jYWxlbmRhcik7CiRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlKCk7CmxvZ0RlYnVnKCJhZnRlciBjYWxlbmRhciBsb2FkIHZpc2libGVEYXRlU3RhcnQ9Iit1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ2V0VmlldycpLnN0YXJ0KTsKdmlzaWJsZURhdGVTdGFydCA9IG5ldyBEYXRlKHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3Jykuc3RhcnQpOwpkYXRlVG9Hb1RvID0gdmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpICsgIi0iICsgKCcwJyArICh2aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkgKyAxKSkuc2xpY2UoLTIpICsgIi0iICsgKCcwJyArIHZpc2libGVEYXRlU3RhcnQuZ2V0RGF0ZSgpKS5zbGljZSgtMik7Ci8vIGNvbnNvbGUubG9nKCJkYXRlVG9Hb1RvIitkYXRlVG9Hb1RvKTsKLy8gJGh0dHAuZ2V0KCRnQXBpVVJMUHJlZml4ICsgIi9lbmR1c2VyL2V2ZW50cy9zdWdnZXN0LyIrdmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpKyIvIit0aGlzX3dlZWtfZnVsbF95ZWFyKyIvIit0aGlzX3dlZWtfbW9udGgrIi8iK3RoaXNfd2Vla19kYXlfb2ZfbW9udGgrIi8iKyB0aGlzX3dlZWtfaG91cnMrICIvIiArIHRoaXNfd2Vla19taW51dGVzKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKQokc2NvcGUuZXZlbnRfdHlwZV9pZD0kc2NvcGUuc2VsZWN0ZWRfZXZlbnRfdHlwZV9pZDsKJHNjb3BlLnZpc2libGVEYXRlU3RhcnQ9dmlzaWJsZURhdGVTdGFydDsKLy8xMjEyMTIKLy8gaWYgKCRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkX2lzX2NsYXNzKQovLyB7Ci8vICAgJGh0dHAuZ2V0KCRnQXBpVVJMUHJlZml4ICsgIi9lbmR1c2VyL2V2ZW50cy9zdWdnZXN0Y2xhc3MvIiskc2NvcGUuZXZlbnRfdHlwZV9pZCsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSsiLyIrKCRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkrMSkrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0SG91cnMoKSArICIvIiArICRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKSsgIi8iICsgJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJfaWQpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpCi8vICAgewovLyAgICAgICAvLwkgICAgJHNjb3BlLm15RGF0YSA9IHJlc3BvbnNlLmRhdGE7Ci8vICAgICAgIC8vCQlsb2dEZWJ1ZygiZ3JpZG9wdGlvbnM9Iiskc2NvcGUuZ3JpZE9wdGlvbnMpOwovLyAgICAgICAkc2NvcGUuZXZlbnRzU3VnZ2VzdGVkID0gcmVzcG9uc2UuZGF0YTsKLy8gICAgICAgLy8gJHNjb3BlLmRhdGVUb0dvVG89ZGF0ZVRvR29UbzsKLy8gICB9KTsKLy8gfQovLyBlbHNlCi8vIHsKLy8gICAkaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3QvIiskc2NvcGUuZXZlbnRfdHlwZV9pZCsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSsiLyIrKCRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkrMSkrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0SG91cnMoKSArICIvIiArICRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkKLy8gICB7Ci8vICAgICAgIC8vCSAgICAkc2NvcGUubXlEYXRhID0gcmVzcG9uc2UuZGF0YTsKLy8gICAgICAgLy8JCWxvZ0RlYnVnKCJncmlkb3B0aW9ucz0iKyRzY29wZS5ncmlkT3B0aW9ucyk7Ci8vICAgICAgICRzY29wZS5ldmVudHNTdWdnZXN0ZWQgPSByZXNwb25zZS5kYXRhOwovLyAgICAgICAvLyAkc2NvcGUuZGF0ZVRvR29Ubz1kYXRlVG9Hb1RvOwovLyAgIH0pOwovLyB9CgovLyBhZnRlciBjYWxlbmRhciBpcyBsb2FkZWQgLSBsb2FkaW5nIGV2ZW50IHR5cGVzIGFuZCBzdWdnZXN0aW9uIGZvciBxdWV1ZXMKLy8gd2UgaGFuZGxlIHRoaW5ncyByZWxhdGVkIHRvIHRoZSBldmVudCB0eXBlcyBvbmx5IGFmdGVyIGxvYWRpbmcgdGhlbSAoYW5kIHRoZSBjYWxlbmRhcikKZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzTm9TeXN0ZW0oJGh0dHAsJHNjb3BlLCdldmVudF90eXBlcycsZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzTm9TeXN0ZW1fY2FsbGJhY2spOwoKZnVuY3Rpb24gZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzTm9TeXN0ZW1fY2FsbGJhY2soKQp7ICAgIC8vIGNoZWNraW5nIGlmIGNhbGVuZGFyIHNob3VsZCBzdGFydCB3aXRoIGEgc3BlY2lmaWMgZXZlbnQgdHlwZSBmb3Igc3VnZ2VzdGlvbnMKLy8gbG9nRGVidWcoIlggc2hhcmVkUHJvcGVydGllcy5nZXRfZXZlbnRfdHlwZV9mb3Jfc3VnZ2VzdGlvbnM9IitzaGFyZWRQcm9wZXJ0aWVzLmdldF9ldmVudF90eXBlX2Zvcl9zdWdnZXN0aW9ucygpKTsKaWYgKHNoYXJlZFByb3BlcnRpZXMuZ2V0X2V2ZW50X3R5cGVfZm9yX3N1Z2dlc3Rpb25zKCkhPW51bGwpCnsKJHNjb3BlLnNlbGVjdGVkX2V2ZW50X3R5cGVfaWQ9c2hhcmVkUHJvcGVydGllcy5nZXRfZXZlbnRfdHlwZV9mb3Jfc3VnZ2VzdGlvbnMoKTsKJHNjb3BlLmV2ZW50VHlwZVNlbGVjdGVkKCRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkKTsKfQoKLy8gZmlyc3QgY2hlY2tpbmcgaWYgdGhlcmUncyBhbiBldmVudCB0byByZXNjaGVkdWxlCmlmIChzaGFyZWRQcm9wZXJ0aWVzLmdldF9ldmVudF9yZXNjaGVkdWxlKCkhPW51bGwpCnsKJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGU9dHJ1ZTsKJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGVfZXZlbnQ9c2hhcmVkUHJvcGVydGllcy5nZXRfZXZlbnRfcmVzY2hlZHVsZSgpOwpzaGFyZWRQcm9wZXJ0aWVzLnNldF9ldmVudF9yZXNjaGVkdWxlKG51bGwpOwpsb2dEZWJ1ZygiZ290IGV2ZW50IHRvIHJlc2NoZWR1bGUgIitKU09OLnN0cmluZ2lmeSgkc2NvcGUucHJldmlvdXNfZXZlbnRfcmVzY2hlZHVsZV9ldmVudCkpOwpsb2dEZWJ1ZygicmVzY2hlZHVsZSBldmVudF90eXBlX2lkPSIrJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGVfZXZlbnQuZXZlbnRfdHlwZV9pZCk7CiRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkPSRzY29wZS5wcmV2aW91c19ldmVudF9yZXNjaGVkdWxlX2V2ZW50LmV2ZW50X3R5cGVfaWQ7CiRzY29wZS5ldmVudFR5cGVTZWxlY3RlZCgpOwp9Ci8vIGNoZWNraW5nIHNlbGVjdGVkIHVzZXIgb25seSBpZiB0aGVyZSdzIG5vIHNlbGVjdGVkIGV2ZW50IHRvIG1vdmUKZWxzZSBpZiAoc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpIT1udWxsKQp7CmNvbnNvbGUubG9nKCJnb3QgcHJldmlvdXMgc2VsZWN0ZWQgdXNlciAiK3NoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKS5idXNlcl9maXJzdF9uYW1lKTsKJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJuYW1lPXNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKS5idXNlcl9maXJzdF9uYW1lKyIgIitzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfbGFzdF9uYW1lOwokc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcl9pZD1zaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzaW5lc3NfdXNlcl9pZDsKbG9nRGVidWcoIiRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyX2lkPSIrJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJfaWQpOwoKJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXI9dHJ1ZTsKfQp9Cn0KCn0sCi8vIHNlbGVjdDogZnVuY3Rpb24oc3RhcnQsIGVuZCwgYWxsRGF5KSB7Ci8vICAgICAvLyB2YXIgdGl0bGUgPSBwcm9tcHQoJ0V2ZW50IFRpdGxlOicgKyAoc3RhcnQgKyAzNTI4MDAwMDApIC8gKDYwICogMTAwMCkgKyAiICIgKyBlbmQgKyAiICIgKyBhbGxEYXkpOwovLyAgICAgdGl0bGUgPSAi16nXoteV16og16TXoteZ15zXldeqIjsKLy8gICAgIGlmICh0aXRsZSkgewovLyAgICAgICAgIGxvZ0RlYnVnKCJjcmVhdGluZyBkZXZlbnQgc3RhcnQiKTsKLy8gICAgICAgICBsb2dEZWJ1Zygic3RhcnQ9IiArIHN0YXJ0KTsKLy8gICAgICAgICBjaGVja0RhdGUgPSBuZXcgRGF0ZShzdGFydCk7Ci8vICAgICAgICAgbG9nRGVidWcoImNoZWNrIGRhdGUgPSAiICsgY2hlY2tEYXRlKQovLyAgICAgICAgIGxvZ0RlYnVnKCJlbmQ9IiArIGVuZCk7Ci8vICAgICAgICAgZWNvbG9yID0gIiMiICsgJHNjb3BlLmV2ZW50Q29sb3I7IC8vZ2V0UmFuZG9tQ29sb3IoKTsKLy8KLy8KLy8gICAgICAgICAvLyB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tdLmZ1bGxDYWxlbmRhcigncmVyZW5kZXJFdmVudHMnKTsKLy8KLy8gICAgICAgICBjYWxlbmRhciA9ICRzY29wZS5jYWxlbmRhcl9uYW1lOwovLyAgICAgICAgIHRlbXBfbGltaXRfaWQgPSAkZ0NhbGVuZGFyVGVtcEVudklEMSAtIGdldFJhbmRvbUludCgxMCwgODApOwovLyAgICAgICAgIG5ld0V2ZW50ID0gewovLyAgICAgICAgICAgICBpZDogdGVtcF9saW1pdF9pZCwKLy8gICAgICAgICAgICAgdGl0bGU6IHRpdGxlLAovLyAgICAgICAgICAgICBzdGFydDogc3RhcnQsCi8vICAgICAgICAgICAgIGNvbG9yOiBlY29sb3IsCi8vICAgICAgICAgICAgIGVuZDogZW5kLAovLyAgICAgICAgICAgICBhbGxEYXk6IGZhbHNlLAovLyAgICAgICAgICAgICBjbGFzc05hbWU6IFsnb3BlblNlc2FtZSddCi8vICAgICAgICAgICAgICAgICAvLyBjb2xvcjogcmVzb3VyY2UuZXZlbnRDb2xvcgovLyAgICAgICAgIH07Ci8vICAgICAgICAgY2FsZW5kYXIgPSAkc2NvcGUuY2FsZW5kYXJfbmFtZTsKLy8KLy8gICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZW5kZXJFdmVudCcsIG5ld0V2ZW50LCB0cnVlKTsKLy8gICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCd1bnNlbGVjdCcpOwovLwovLyAgICAgICAgIGxvZ0RlYnVnKCJjcmVhdGluZyBkZXZlbnQgZW5kIik7Ci8vICAgICAgICAgJHNjb3BlLmFkZEV2ZW50VG9EYXRhYmFzZShzdGFydCwgZW5kLCB0aXRsZSwgZWNvbG9yLCB0ZW1wX2xpbWl0X2lkKTsKLy8KLy8gICAgIH0KLy8gfQp9Cn07Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignSG91cnNPZldvcmtDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGNvbXBpbGUsICRsb2NhdGlvbiwgdWlDYWxlbmRhckNvbmZpZywgJHVpYk1vZGFsKSB7CmxvZ0RlYnVnKCdIb3Vyc09mV29yayBDb250cm9sbGVyJyk7Cgpsb2dEZWJ1ZygiJGxvY2F0aW9uLnNlYXJjaCgpLnN0YXJ0PSIgKyAkbG9jYXRpb24uc2VhcmNoKCkuc3RhcnQpOwppZiAodHlwZW9mICRsb2NhdGlvbi5zZWFyY2goKS5zdGFydCA9PSAndW5kZWZpbmVkJykgewpjdXJyRGVmYXVsdERhdGUgPSAkZ0hvdXIwZGF0ZTsKJHNjb3BlLmZpeGVkU2NoZWR1bGUgPSB0cnVlOwokc2NvcGUuY2FsZW5kYXJUaXRsZUNlbnRlciA9ICLXqdei15XXqiDXpNei15nXnNeV16og16fXkdeV16LXldeqIjsKbG9nRGVidWcoItep16LXldeqINek16LXmdec15XXqiDXp9eR15XXoteV16oiKTsKaG91cnNPZldvcmtEZWZhdWx0Vmlldz0nZG9udFNob3dEYXRlJzsKfSBlbHNlIHsKY3VyckRlZmF1bHREYXRlID0gJGxvY2F0aW9uLnNlYXJjaCgpLnN0YXJ0Owokc2NvcGUuZml4ZWRTY2hlZHVsZSA9IGZhbHNlOwovLyAkc2NvcGUuY2FsZW5kYXJUaXRsZUNlbnRlciA9ICLXqdei15XXqiDXpNei15nXnNeV16og16fXkdeV16LXldeqIjsKaG91cnNPZldvcmtEZWZhdWx0Vmlldz0nYWdlbmRhV2Vlayc7Cn0KCgokc2NvcGUudmlzaWJsZURhdGUgPSBbXTsKJHNjb3BlLmNhbGVuZGFyID0gJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnOwokc2NvcGUuc2VsZWN0ZWRFdmVudFR5cGUgPSBbXTsKCmdldEFsbEJ1c2luZXNzRXZlbnRUeXBlcygkaHR0cCwkc2NvcGUsJ2V2ZW50X3R5cGVzJyxnZXRBbGxCdXNpbmVzc0V2ZW50VHlwZXNfY2FsbGJhY2spOwoKZnVuY3Rpb24gZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzX2NhbGxiYWNrKCkKewokc2NvcGUuc2VsZWN0RXZlbnRUeXBlKCRzY29wZS5ldmVudF90eXBlc1swXSk7Cn0KJHNjb3BlLmJhY2tUb0NhbGVuZGFyID0gZnVuY3Rpb24oKSB7CnZpc2libGVEYXRlU3RhcnQgPSBuZXcgRGF0ZSh1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ2V0VmlldycpLnN0YXJ0KTsKZGF0ZVRvR29UbyA9IHZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSArICItIiArICgnMCcgKyAodmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpICsgMSkpLnNsaWNlKC0yKSArICItIiArICgnMCcgKyB2aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSkuc2xpY2UoLTIpOwokbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2NhbGVuZGFyJykuc2VhcmNoKHsKc3RhcnQ6IGRhdGVUb0dvVG8KfSk7Cn0KJHNjb3BlLnNlbGVjdEV2ZW50VHlwZSA9IGZ1bmN0aW9uKGV2ZW50VHlwZSkgewokc2NvcGUuc2VsZWN0ZWRFdmVudFR5cGUgPSBldmVudFR5cGU7CmxvZ0RlYnVnKCJzZWxlY3RlZCBFdmVudCBUeXBlID0gIiArICRzY29wZS5zZWxlY3RlZEV2ZW50VHlwZS5ldmVudF90eXBlX2lkICsgIiwgIiArICRzY29wZS5zZWxlY3RlZEV2ZW50VHlwZS5ldmVudF90eXBlX25hbWUpOwprdXplSXNDYWxlbmRhckRyYWdnYmxlID0gJHNjb3BlLnNlbGVjdGVkRXZlbnRUeXBlLmRpZmZfcmFuZ2U7Cn07Cgokc2NvcGUuY2hhbmdlRXZlbnRDb2xvciA9IGZ1bmN0aW9uKG5ld0NvbG9yKSB7CiRzY29wZS5ldmVudENvbG9yID0gbmV3Q29sb3I7CmFsbGxFdmVudHNBcnJheSA9IHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2NsaWVudEV2ZW50cycpOwpmb3IgKGkgaW4gYWxsbEV2ZW50c0FycmF5KSB7CmFsbGxFdmVudHNBcnJheVtpXS5jb2xvciA9ICIjIiArIG5ld0NvbG9yOwp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCd1cGRhdGVFdmVudCcsIGFsbGxFdmVudHNBcnJheVtpXSk7Cn0KfTsKCiRzY29wZS5ldmVudENsaWNrTW9kdWxlID0gZnVuY3Rpb24oc2VsZWN0ZWRFdmVudCwgc2l6ZSkgewpsb2dEZWJ1Zygic2VsZWN0ZWQgRXZlbnQgdGl0bGU9IiArIHNlbGVjdGVkRXZlbnQudGl0bGUpOwoKCnZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewphbmltYXRpb246IGZhbHNlLAp0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9saW1pdGF0aW9uX2RldGFpbHMuaHRtbCcsCmNvbnRyb2xsZXI6ICdldmVudERldGFpbHNIb3Vyc09mV29ya01vZGFsQ29udHJvbGxlcicsCnNpemU6IHNpemUsCnJlc29sdmU6IHsKc2VsZWN0ZWRFdmVudDogZnVuY3Rpb24oKSB7CnJldHVybiBzZWxlY3RlZEV2ZW50Owp9LApmaXhlZFNjaGVkdWxlOiBmdW5jdGlvbiAoKQp7CnJldHVybiAkc2NvcGUuZml4ZWRTY2hlZHVsZTsKfQp9Cn0pOwoKbW9kYWxJbnN0YW5jZS5yZXN1bHQudGhlbihmdW5jdGlvbihzZWxlY3RlZEl0ZW0pIHsKJHNjb3BlLnNlbGVjdGVkID0gc2VsZWN0ZWRJdGVtOwp9LCBmdW5jdGlvbigpIHsKbG9nRGVidWcoJ01vZGFsIGRpc21pc3NlZCBhdDogJyArIG5ldyBEYXRlKCkpOwp9KTsKfTsKCgp2YXIgZGF0ZSA9IG5ldyBEYXRlKCk7CnZhciBkID0gZGF0ZS5nZXREYXRlKCk7CnZhciBtID0gZGF0ZS5nZXRNb250aCgpOwp2YXIgeSA9IGRhdGUuZ2V0RnVsbFllYXIoKTsKCgpmdW5jdGlvbiBnZXRUaW1lU3RhbXAobm93KSB7CnJldHVybiAoKG5vdy5nZXRNb250aCgpICsgMSkgKyAnLycgKyAobm93LmdldERhdGUoKSkgKyAnLycgKyBub3cuZ2V0RnVsbFllYXIoKSArICIgIiArIG5vdy5nZXRIb3VycygpICsgJzonICsgKChub3cuZ2V0TWludXRlcygpIDwgMTApID8gKCIwIiArIG5vdy5nZXRNaW51dGVzKCkpIDogKG5vdy5nZXRNaW51dGVzKCkpKSArICc6JyArICgobm93LmdldFNlY29uZHMoKSA8IDEwKSA/ICgiMCIgKyBub3cKLmdldFNlY29uZHMoKSkgOiAobm93LmdldFNlY29uZHMoKSkpKTsKfQoKCi8qIENoYW5nZSBWaWV3ICovCiRzY29wZS5jaGFuZ2VWaWV3ID0gZnVuY3Rpb24odmlldywgY2FsZW5kYXIpIHsKbG9nRGVidWcoImNoYW5nZSB2aWV3ICIgKyB2aWV3KTsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignY2hhbmdlVmlldycsIHZpZXcpOwp9OwovKiBDaGFuZ2UgVmlldyAqLwoKJHNjb3BlLnJlbmRlckNhbGVuZGVyID0gZnVuY3Rpb24oY2FsZW5kYXIpIHsKJHRpbWVvdXQoZnVuY3Rpb24oKSB7CmlmICh1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0pIHsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVuZGVyJyk7Cn0KfSk7Cn07Cgokc2NvcGUuY2hhbmdlU2VsZWN0YWJsZSA9IGZ1bmN0aW9uKCkgewprdXplSXNDYWxlbmRhckRyYWdnYmxlID0gIWt1emVJc0NhbGVuZGFyRHJhZ2dibGU7CmNhbGVuZGFyID0gJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnOwovLyB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3JykuY2FsZW5kYXIub3B0aW9ucy5zZWxlY3RhYmxlID0gZmFsc2U7CnZpZXcgPSB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdvcHRpb24nLCAnc2VsZWN0YWJsZScsIGZhbHNlKTsKLy8gdmlldy5jYWxlbmRhci5vcHRpb25zLnNlbGVjdGFibGUgPSBmYWxzZTsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVuZGVyJyk7Cgp9Ci8qIGNvbmZpZyBvYmplY3QgKi8KCiRzY29wZS5jYWxlbmRhcl9ob3Vyc19vZl93b3JrX2NvbmZpZyA9IHsKY2FsZW5kYXI6IHsKaGVpZ2h0OiAnYXV0bycsCmVkaXRhYmxlOiB0cnVlLAovLyBoZWFkZXI6IHsKLy8gICAgIGxlZnQ6ICcnLAovLyAgICAgY2VudGVyOiAnJywKLy8gICAgIHJpZ2h0OiAnJwovLyB9LApoZWFkZXI6ICcnLAovLyBoZWFkZXI6IHsKLy8gICAgIGxlZnQ6ICd0aXRsZScsCi8vICAgICBjZW50ZXI6ICcnLAovLyAgICAgcmlnaHQ6ICd0b2RheSBwcmV2LG5leHQnCi8vIH0sCi8vIGRlZmF1bHRWaWV3OiAnYWdlbmRhV2VlaycsCnZpZXdzOiB7CmRvbnRTaG93RGF0ZTogewp0eXBlOiAnYWdlbmRhV2VlaycsCmR1cmF0aW9uOiB7CmRheXM6IDcKfSwKdGl0bGU6ICdBcGVydHVyYScsCmNvbHVtbkZvcm1hdDogJ2RkZGQnIC8vIEZvcm1hdCB0aGUgZGF5IHRvIG9ubHkgc2hvdyBsaWtlICdNb25kYXknCi8vIGhpZGRlbkRheXM6IFswLCA2XSAvLyBIaWRlIFN1bmRheSBhbmQgU2F0dXJkYXk/Cn0sCmRvU2hvd0RhdGU6IHsKdHlwZTogJ2FnZW5kYVdlZWsnLApkdXJhdGlvbjogewpkYXlzOiA3Cn0sCnRpdGxlOiAnQXBlcnR1cmEnLAoKLy8gaGlkZGVuRGF5czogWzAsIDZdIC8vIEhpZGUgU3VuZGF5IGFuZCBTYXR1cmRheT8KfQp9LApldmVudERyb3A6IGZ1bmN0aW9uKGV2ZW50LCBkYXlEZWx0YSwgbWludXRlRGVsdGEsIGFsbERheSwgcmV2ZXJ0RnVuYywgdWlDYWxlbmRhckNvbmZpZykgewpsb2dEZWJ1ZygiZXZlbnRkcm9wIiArIGV2ZW50LnRpdGxlICsgIigiICsgZXZlbnQuaWQgKyAiKSBtb3ZlZCAiICsgbWludXRlRGVsdGEgKyAiIG1pbnV0ZXMiKTsKbG9nRGVidWcoIm9sZCBzdGFydD0iICsgZXZlbnQuc3RhcnQgKyAiLCBvbGQgZW5kPSIgKyBldmVudC5lbmQpOwokc2NvcGUudXBkYXRlTGltaXRhdGlvbkRhdGFiYXNlKGV2ZW50LnN0YXJ0LCBldmVudC5lbmQsIGV2ZW50LmlkLCBldmVudC50ZW1wX2xpbWl0X2lkLCBldmVudCk7Cn0sCmV2ZW50UmVzaXplOiBmdW5jdGlvbihldmVudCwgZGVsdGEsIHJldmVydEZ1bmMpIHsKbG9nRGVidWcoImV2ZW50cmVzaXplLCBldmVudC5lbmQ9IiArIGV2ZW50LmVuZCk7CiRzY29wZS51cGRhdGVMaW1pdGF0aW9uRGF0YWJhc2UoZXZlbnQuc3RhcnQsIGV2ZW50LmVuZCwgZXZlbnQuaWQsIGV2ZW50LnRlbXBfbGltaXRfaWQsIGV2ZW50KTsKfSwKZGVmYXVsdFZpZXc6IGhvdXJzT2ZXb3JrRGVmYXVsdFZpZXcsCmV2ZW50Q2xpY2s6IGZ1bmN0aW9uKGNhbEV2ZW50LCBqc0V2ZW50LCB2aWV3KSB7CmxvZ0RlYnVnKCJldmVudCBjbGlja2VkICIgKyBjYWxFdmVudC50aXRsZSArICIoaWQ9IiArIGNhbEV2ZW50LmlkICsgIiwgZGF5X2xpbWl0X2lkPSIgKyBjYWxFdmVudC5kYXlfbGltaXRfaWQgKyAiLCB0ZW1wX2xpbWl0X2lkPSIgKyBjYWxFdmVudC50ZW1wX2xpbWl0X2lkICsgIiwgbGltaXRfaWQ9IiArIGNhbEV2ZW50LmxpbWl0X2lkICsgIikgc3RhcnQ9IiArIGNhbEV2ZW50LnN0YXJ0ICsgIiwgZW5kPSIgKyBjYWxFdmVudC5lbmQpOwokc2NvcGUuZXZlbnRDbGlja01vZHVsZShjYWxFdmVudCk7Ci8vIGNoYW5nZSB0aGUgYm9yZGVyIGNvbG9yIGp1c3QgZm9yIGZ1bgovLyAkKHRoaXMpLmNzcygnYm9yZGVyLWNvbG9yJywgJ3JlZCcpOwoKfSwKZXZlbnRSZW5kZXI6IGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KQp7CmNvbnNvbGUubG9nKGV2ZW50KTsKZWxlbWVudC5maW5kKCcuZmMtdGl0bGUnKS5wcmVwZW5kKGV2ZW50LmxvY2F0aW9uX25hbWUrIiAvIDxici8+Iik7CmVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZChldmVudC5pbnN0cnVjdG9yX25hbWUrIiAvIDxici8+Iik7Ci8vIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZCgiIitldmVudC5ldmVudFVzZXJzWzBdLmJ1c2VyX2ZpcnN0X25hbWUrIiAiK2V2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfbGFzdF9uYW1lKyIgKCIpOwoKLy8gY29uc29sZS5sb2coInJlbmRlciBsaW1pdGF0aW9uICIrSlNPTi5zdHJpbmdpZnkoZXZlbnQpKTsKLy8gaWYgKGV2ZW50LmlzX2NsYXNzPT0xKQovLyB7Ci8vICAgLy8gaWYgY2xhc3MgYWRkaW5nIG51bWJlciBvZiBwYXJ0aWNpcGFudHMKLy8gICBpZiAoZXZlbnQubm9fb2Zfd2FpdGluZ191c2Vycz4wKQovLyAgIHsKLy8gICAgIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZChldmVudC5ub19vZl91c2VycysiLyIrZXZlbnQubWF4X3BhcnRpY2lwYW50cysgIiAoIitldmVudC5ub19vZl93YWl0aW5nX3VzZXJzKyIpIisiIC0gIik7Ci8vICAgfQovLyAgIGVsc2UKLy8gICB7Ci8vICAgICBlbGVtZW50LmZpbmQoJy5mYy10aXRsZScpLnByZXBlbmQoZXZlbnQubm9fb2ZfdXNlcnMrIi8iK2V2ZW50Lm1heF9wYXJ0aWNpcGFudHMrIiAtICIpOwovLyAgIH0KLy8gfQovLyBlbHNlCi8vIHsKLy8gICAvLyBpZiBub3QgY2xhc3MgLSB3cml0aW5nIHRoZSBlbmR1c2VyIG5hbWUKLy8gICBpZiAoZXZlbnQuZHVyYXRpb25fZXZlbnQhPTApIC8vIGFsc28gaWYgbm90IGhvdXJzIG9mIHdvcmsKLy8gICB7Ci8vICAgICAvLyBlbGVtZW50LmZpbmQoJy5mYy10aXRsZScpLmFwcGVuZCgiICgiK2V2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfZmlyc3RfbmFtZSsiICIrZXZlbnQuZXZlbnRVc2Vyc1swXS5idXNlcl9sYXN0X25hbWUrIikiKTsKLy8gICAgIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZCgiIitldmVudC5ldmVudFVzZXJzWzBdLmJ1c2VyX2ZpcnN0X25hbWUrIiAiK2V2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfbGFzdF9uYW1lKyIgKCIpOwovLyAgICAgZWxlbWVudC5maW5kKCcuZmMtdGl0bGUnKS5hcHBlbmQoIikiKTsKLy8gICB9Ci8vICAgLy8gbG9nRGVidWcoImhlcmU0Iik7Ci8vIH0KLy8gaWYgKGV2ZW50LmlzX3JlcGVhdGluZyA9PSAxKSB7Ci8vICAgICBlbGVtZW50LmZpbmQoIi5mYy10aXRsZSIpLnByZXBlbmQoIiZuYnNwOzxpIGNsYXNzPSdmYSBmYS1yZXBlYXQnPjwvaT4mbmJzcDsiKTsKLy8gICAgIC8vICBlbGVtZW50LmZpbmQoIi5mYy10aXRsZSIpLmFwcGVuZCgiJm5ic3A7PGltZyBzcmM9Jy9wdWJsaWMvaW1hZ2VzL3JlY3VycmluZy1pY29uLnBuZycgd2lkdGg9JzEwcHgnIGhlaWdodD0nMTBweCcvPiIpOwovLyB9Cn0sCm1pblRpbWU6ICRnQ2FsZW5kYXJEaXNwbGF5TWluVGltZSwKbWF4VGltZTogJGdDYWxlbmRhckRpc3BsYXlNYXhUaW1lLApzZWxlY3RhYmxlOiB0cnVlLApzZWxlY3RIZWxwZXI6IGZhbHNlLAp0aW1lem9uZTogZmFsc2UsCmlzUlRMOiB0cnVlLApsYW5nOiAiaGUiLApzZWxlY3RDb25zdHJhaW50OiB7CnN0YXJ0OiAnMDA6MDEnLAplbmQ6ICcyMzo1OScsCn0sCmRlZmF1bHREYXRlOiBtb21lbnQoY3VyckRlZmF1bHREYXRlKSwKYWxsRGF5U2xvdDogZmFsc2UsCmxvYWRpbmc6IGZ1bmN0aW9uKGJvb2wpIHsKaWYgKGJvb2wpIHsKICAgICAgICAgICAgICAgICAgICBsb2dEZWJ1ZygnbG9hZGluZyBjYWxlbmRhcjIgJyArICRzY29wZS5jYWxlbmRhcik7CgovLyAkKCcjbG9hZGluZycpLnNob3coKTsKfSBlbHNlIHsKLy8gJCgnI2xvYWRpbmcnKS5oaWRlKCk7CmxvZ0RlYnVnKCdmaW5pc2hlZCBsb2FkaW5nIGNhbGVuZGFyICcgKyAkc2NvcGUuY2FsZW5kYXIpOwppZiAoISRzY29wZS5maXhlZFNjaGVkdWxlKSB7CiRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlKCk7Cn0KLy8gJHNjb3BlLmJhY2tUb0ZpeGVkKCk7Cn0KfSwKc2VsZWN0OiBmdW5jdGlvbihzdGFydCwgZW5kLCBhbGxEYXkpIHsKLy8gdGhpcyBpcyBjYWxsZWQgd2hlbiBjcmVhdGluZyBhIG5ldyBibG9jawokc2NvcGUuY3JlYXRlTGltaXRhdGlvbkJsb2NrKHN0YXJ0LCBlbmQpOwp9Cn0KfTsKCi8vIGNyZWF0ZSBsaW1pdGF0aW9uIGJsb2NrCiRzY29wZS5jcmVhdGVMaW1pdGF0aW9uQmxvY2sgPSBmdW5jdGlvbihzdGFydCwgZW5kKQp7CmxvZ0RlYnVnKCJmdW5jdGlvbjogY3JlYXRlTGltaXRhdGlvbkJsb2NrIik7CnZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewphbmltYXRpb246IGZhbHNlLAp0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9saW1pdGF0aW9uX2NyZWF0ZS5waHAnLApzaXplOiAneHMnLApjb250cm9sbGVyOiAnYnVzaW5lc3NfbW9kYWxfbGltaXRhdGlvbl9jcmVhdGUnLApyZXNvbHZlOiB7CnN0YXJ0OiBmdW5jdGlvbigpCnsKcmV0dXJuIHN0YXJ0Owp9LAplbmQ6IGZ1bmN0aW9uKCkKewpyZXR1cm4gZW5kOwp9LApmaXhlZFNjaGVkdWxlOiBmdW5jdGlvbiAoKQp7CnJldHVybiAkc2NvcGUuZml4ZWRTY2hlZHVsZTsKfQp9Cn0pOwp9CiRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlID0gZnVuY3Rpb24oKSB7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3Jyk7Cgp2aXNpYmxlRGF0ZVN0YXJ0ID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5zdGFydCk7CnZpc2libGVEYXRlRW5kID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5lbmQpOwoKJHNjb3BlLmNhbGVuZGFyVGl0bGVDZW50ZXIgPSB2aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSArICIgIiArIG1vbnRoTmFtZXNbdmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpXSArCiIg4oCUICIgKyB2aXNpYmxlRGF0ZUVuZC5nZXREYXRlKCkgKyAiICIgKyBtb250aE5hbWVzW3Zpc2libGVEYXRlRW5kLmdldE1vbnRoKCldICsKIiAiICsgdmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpOwp9OwovKiBldmVudCBzb3VyY2VzIGFycmF5Ki8KJHNjb3BlLmV2ZW50U291cmNlcyA9IFt7CnVybDogJy9hcGkvYWRtaW4vY2FsZW5kYXIvbGltaXRhdGlvbnMvcGVyZGF5L2dldHBvc3QnLAp0eXBlOiAnUE9TVCcKfV07CgovLyAkc2NvcGUuZ2V0RXZlbnRzID0gZnVuY3Rpb24oKSB7Ci8vICAgICBjYWxlbmRhciA9ICdjYWxlbmRhcl9ob3Vyc19vZl93b3JrJzsKLy8gICAgIGFsbGxFdmVudHNBcnJheSA9IHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2NsaWVudEV2ZW50cycpOwovLyAgICAgZm9yIChpIGluIGFsbGxFdmVudHNBcnJheSkgewovLyAgICAgICAgIGxvZ0RlYnVnKGFsbGxFdmVudHNBcnJheVtpXSk7Ci8vICAgICB9Ci8vCi8vIH0KCiRzY29wZS5nb3RvVG9kYXkgPSBmdW5jdGlvbigpIHsKJHNjb3BlLmdvdG9EYXRlKG5ldyBEYXRlKCkpOwp9CiRzY29wZS5nb3RvTmV4dCA9IGZ1bmN0aW9uKCkgewp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignbmV4dCcpOwp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVtb3ZlRXZlbnRzJyk7CiRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlKCk7Cn0KJHNjb3BlLmdvdG9QcmV2ID0gZnVuY3Rpb24oKSB7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZW1vdmVFdmVudHMnKTsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3ByZXYnKTsKJHNjb3BlLnVwZGF0ZUNhbGVuZGFyQ2VudGVyVGl0bGUoKTsKfQokc2NvcGUuZ290b0RhdGUgPSBmdW5jdGlvbihuZXdkYXRlKSB7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnb3RvRGF0ZScsIG5ld2RhdGUpOwp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignY2hhbmdlVmlldycsICdhZ2VuZGFXZWVrJyk7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZW1vdmVFdmVudHMnKTsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKCiRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlKCk7CiRzY29wZS5maXhlZFNjaGVkdWxlID0gZmFsc2U7Cn0KCiRzY29wZS5iYWNrVG9GaXhlZCA9IGZ1bmN0aW9uKCkgewokc2NvcGUuZml4ZWRTY2hlZHVsZSA9IHRydWU7CiRzY29wZS5jYWxlbmRhclRpdGxlQ2VudGVyID0gItep16LXldeqINek16LXmdec15XXqiDXp9eR15XXoteV16oiOwp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignY2hhbmdlVmlldycsICdkb250U2hvd0RhdGUnKTsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dvdG9EYXRlJywgbW9tZW50KCRnSG91cjBkYXRlKSk7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZW1vdmVFdmVudHMnKTsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKCn0KCi8vICRzY29wZS5kZWxldGVBbGxFdmVudHMgPSBmdW5jdGlvbigpIHsKLy8gICAgIGNhbGVuZGFyID0gJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnOwovLyAgICAgYWxsbEV2ZW50c0FycmF5ID0gdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignY2xpZW50RXZlbnRzJyk7Ci8vICAgICBmb3IgKGkgaW4gYWxsbEV2ZW50c0FycmF5KSB7Ci8vICAgICAgICAgbG9nRGVidWcoYWxsbEV2ZW50c0FycmF5W2ldKTsKLy8gICAgICAgICAkc2NvcGUuZGVsZXRlQ2FsZW5kYXJKU0V2ZW50KGNhbGVuZGFyLCBhbGxsRXZlbnRzQXJyYXlbaV0uaWQpOwovLyAgICAgICAgICRzY29wZS5kZWxldGVDYWxlbmRhckRCRXZlbnQoYWxsbEV2ZW50c0FycmF5W2ldLmlkKTsKLy8gICAgIH0KLy8KLy8gfQokc2NvcGUudXBkYXRlTGltaXRhdGlvbkRhdGFiYXNlID0gZnVuY3Rpb24oc3RhcnRfcGFyYW0sIGVuZF9wYXJhbSwgZXZlbnRfaWQsIHRlbXBfbGltaXRfaWQsIHRoZWV2ZW50KSB7Cgpsb2dEZWJ1ZygidXBkYXRlTGltaXRhdGlvbkRhdGFiYXNlIHN0YXJ0PSIgKyBzdGFydF9wYXJhbSArICIsIGVuZD0iICsgZW5kX3BhcmFtICsgIixldmVudF9pZD0iICsgZXZlbnRfaWQpOwoKZnVuY3Rpb24gdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uX2ZhaWx1cmUoKQp7CmNhbGVuZGFyID0gImNhbGVuZGFyX2hvdXJzX29mX3dvcmsiOwp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZWZldGNoRXZlbnRzJyk7Cn0KLy8gaWYgdGhlIGV2ZW50IHRoYXQgaXMgZ2V0dGluZyB1cGRhdGVkIGlzIGFuIGV2ZW50IGZyb20gMTk3MCAobm90IHBlcmRheSkKLy8gdGhlbiB3ZSBhZGQgYSBuZXcgcGVyZGF5IGxpbWl0YXRpb24gd2l0aCBsaW1pdF9pZCBvZiB0aGUgMTk3MCBsaW1pdGF0aW9ucyAtIHdpdGggdGhlIG5ldyB0aW1lcy4KCi8vIG90aGVyd2lzZSB3ZSBqdXN0IHVwZGF0ZSB0aGUgcGVyZGF5IGxpbWl0YXRpb24KCmlmICgkc2NvcGUuZml4ZWRTY2hlZHVsZSkgLy8gZml4ZWQgc2NoZWR1bGUgdnMgc3BlY2lmaWMgd2VlZC9kYXkgbGltaXRhdGlvbgp7CnRoZWRhdGEgPSB7CnN0YXJ0X2RhdGU6IHN0YXJ0X3BhcmFtLAplbmRfZGF0ZTogZW5kX3BhcmFtLAp0ZW1wX2xpbWl0X2lkOiB0ZW1wX2xpbWl0X2lkLApsaW1pdF9pZDogZXZlbnRfaWQKfTsKCnVwZGF0ZUNhbGVuZGFyTGltaXRhdGlvbigkaHR0cCwkc2NvcGUsdGhlZGF0YSxldmVudF9pZCwgbnVsbCwgdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uX2ZhaWx1cmUpOwp9CmVsc2UgLy8gbm90IGZpeGVkIHNjaGVkdWxlIC0gZGFpbHkvd2Vla2x5IGxpbWl0YXRpb25zCnsKaWYgKCh0aGVldmVudC5saW1pdF9pZCAhPSBudWxsKSAmICh0aGVldmVudC5kYXlfbGltaXRfaWQgPT0gLTEpKSAvLyBldmVudCBsaW1pdGF0aW9uIGhhcyBsaW1pdF9pZCBzbyBpdHMgYW4gMTk3MCBldmVudAovLyBuZWVkIHRvIGFkZCBhIG5ldyBwZXJkYXkgbGltaXRhdGlvbiB0aGF0IHBvaW50IChsaW1pdF9pZCkgdG8gdGhlIG9sZCAxOTcwIGV2ZW50IHRvIGNhbmNlbCBpdAp7CnRlbXBfbGltaXRfaWQgPSBjYWxjX3RlbXBfbGltaXRfaWQoKTsKdGhlZXZlbnQudGVtcF9saW1pdF9pZCA9IHRlbXBfbGltaXRfaWQ7CnRoZWV2ZW50LmRheV9saW1pdF9pZCA9IHRlbXBfbGltaXRfaWQ7Ci8vIHRoZSBtb3ZlZCBldmVudCBpbiB0aGUgY2FsZW5kYXIgbm93IGhhcyBkYXlfbGltaXRfaWQgYW5kIHRlbXBfbGltaXRfaWQKLy8gaWYgaXRzIGxvYWRlZCBmcm9tIHRoZSBkYiwgaXQgd2lsbCBvbmx5IGhhdmUgZGF5X2xpbWl0X2lkIChhbmQgbm90IHRoZSB0ZW1wIG9uZSkKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnXS5mdWxsQ2FsZW5kYXIoJ3VwZGF0ZUV2ZW50JywgdGhlZXZlbnQpOwoKdGhlZGF0YSA9IHsKc3RhcnRfZGF0ZTogc3RhcnRfcGFyYW0sCmVuZF9kYXRlOiBlbmRfcGFyYW0sCmNvbG9yOiB0aGVldmVudC5jb2xvciwKdGVtcF9saW1pdF9pZDogdGVtcF9saW1pdF9pZCwKZXZlbnRfdHlwZV9pZDogdGhlZXZlbnQuZXZlbnRfdHlwZV9pZCwKZXZlbnRfdHlwZXM6IHRoZWV2ZW50LmV2ZW50X3R5cGVzLApsb2NhdGlvbl9pZDogdGhlZXZlbnQubG9jYXRpb25faWQsCmVtcF9pZDogdGhlZXZlbnQuZW1wX2lkLApsaW1pdF9pZDogdGhlZXZlbnQuaWQsCnRpdGxlOiB0aGVldmVudC50aXRsZQp9OwpjcmVhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXkoJGh0dHAsJHNjb3BlLHRoZWRhdGEsbnVsbCwgdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uX2ZhaWx1cmUpOwoKfQplbHNlIC8vIGV2ZW50IGxpbWl0YXRpb24gdG8gbW92ZS91cGRhdGUgaGFzIG5vIGxpbWl0X2lkIC0gc28gdGhpcyBpcyBuZXcgcGVyZGF5IGV2ZW50IC0gd2UganVzdCB1cGRhdGUgaXQKewp0aGVkYXRhPSB7CnN0YXJ0X2RhdGU6IHN0YXJ0X3BhcmFtLAplbmRfZGF0ZTogZW5kX3BhcmFtLAp0ZW1wX2RheV9saW1pdF9pZDogdGhlZXZlbnQudGVtcF9saW1pdF9pZCwKbG9jYXRpb25faWQ6IHRoZWV2ZW50LmxvY2F0aW9uX2lkLApkYXlfbGltaXRfaWQ6IHRoZWV2ZW50LmRheV9saW1pdF9pZAp9Owp1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXkoJGh0dHAsJHNjb3BlLHRoZWRhdGEsbnVsbCwgdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uX2ZhaWx1cmUpOwp9Cn0KfTsKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ0V2ZW50Q2xhc3NQYWdlQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHRpbWVvdXQsICRodHRwLCAkcm9vdFNjb3BlLCAkcm91dGVQYXJhbXMsICRsb2NhdGlvbiwgJHJvdXRlLCBzaGFyZWREYXRhLCAkdWliTW9kYWwpCnsKZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkKTsKZ2V0QWxsQ2xpZW50cygkaHR0cCwkc2NvcGUsJ2V2ZW50VHlwZVVzZXJzJyk7CmdldEJ1c2luZXNzTG9jYXRpb25zKCRodHRwLCRzY29wZSwnYnVzaW5lc3NfbG9jYXRpb25zJyk7CmdldEFsbEluc3RydWN0b3JzKCRodHRwLCRzY29wZSwnaW5zdHJ1Y3RvcnMnKTsKCiRzY29wZS51cGRhdGVFdmVudFRpdGxlID0gZnVuY3Rpb24obmV3VmFsdWUsY3VycmVudEV2ZW50KQp7Cm5ld190aXRsZT1uZXdWYWx1ZTsKc2V0RXZlbnRUaXRsZSgkaHR0cCwkc2NvcGUsY3VycmVudEV2ZW50LmV2ZW50X2lkLCBuZXdfdGl0bGUsIHVwZGF0ZUV2ZW50X2NhbGxiYWNrLCB1cGRhdGVFdmVudF9jYWxsYmFjayk7CgpmdW5jdGlvbiB1cGRhdGVFdmVudF9jYWxsYmFjaygpCnsKZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCk7Cn0KCn07Cgokc2NvcGUudXBkYXRlRXZlbnRNYXhQYXJ0aWNpcGFudHMgPSBmdW5jdGlvbihuZXdWYWx1ZSxjdXJyZW50RXZlbnQpCnsKbmV3X21heF9wYXJ0aWNpcGFudHM9bmV3VmFsdWU7CmlmICggbmV3X21heF9wYXJ0aWNpcGFudHMgPCBjdXJyZW50RXZlbnQubm9fb2ZfdXNlcnMgKXsKc2V0RXZlbnRNYXhQYXJ0aWNpcGFudHMoJGh0dHAsJHNjb3BlLGN1cnJlbnRFdmVudC5ldmVudF9pZCwgY3VycmVudEV2ZW50Lm5vX29mX3VzZXJzLCBjdXJyZW50RXZlbnQubm9fb2ZfdXNlcnMsIHVwZGF0ZUV2ZW50X2NhbGxiYWNrLCB1cGRhdGVFdmVudF9jYWxsYmFjayk7Cn0gZWxzZSB7CnNldEV2ZW50TWF4UGFydGljaXBhbnRzKCRodHRwLCRzY29wZSxjdXJyZW50RXZlbnQuZXZlbnRfaWQsIG5ld19tYXhfcGFydGljaXBhbnRzLCBjdXJyZW50RXZlbnQubm9fb2ZfdXNlcnMsIHVwZGF0ZUV2ZW50X2NhbGxiYWNrLCB1cGRhdGVFdmVudF9jYWxsYmFjayk7Cn0KCmZ1bmN0aW9uIHVwZGF0ZUV2ZW50X2NhbGxiYWNrKCkKewpnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkKTsKfQoKfTsKCiRzY29wZS51cGRhdGVVc2VyRXZlbnRQcmljZSA9IGZ1bmN0aW9uKG5ld3ZhbHVlLCB0aGVldmVudCwgZXVzZXIpCnsKbmV3X3ByaWNlPW5ld3ZhbHVlOwpzZXRDbGllbnRFdmVudFByaWNlKCRodHRwLCRzY29wZSxldXNlci5idXNpbmVzc191c2VyX2lkLHRoZWV2ZW50LmV2ZW50X2lkLCBuZXdfcHJpY2Usc2V0Q2xpZW50RXZlbnRQcmljZV9jYWxsYmFjaywgc2V0Q2xpZW50RXZlbnRQcmljZV9jYWxsYmFjayk7CmZ1bmN0aW9uIHNldENsaWVudEV2ZW50UHJpY2VfY2FsbGJhY2soKQp7CmdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQpOwp9Cn07Cgokc2NvcGUudXBkYXRlTG9jYXRpb25FdmVudCA9IGZ1bmN0aW9uKCkKewpjb25zb2xlLmxvZygiZnVuY3Rpb246IHVwZGF0ZUxvY2F0aW9uRXZlbnQiKTsKdXBkYXRlRXZlbnRMb2NhdGlvbigkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLCRzY29wZS5jdXJyZW50RXZlbnQubG9jYXRpb25faWQsdXBkYXRlRXZlbnRMb2NhdGlvbl9jYWxsYmFjaywgdXBkYXRlRXZlbnRMb2NhdGlvbl9jYWxsYmFjayk7CiRzY29wZS51cGRhdGVMb2NhdGlvbkFsZXJ0TWVzc2FnZT0i157XoteT15vXnyDXodeY15jXldehLi4uIjsKZnVuY3Rpb24gdXBkYXRlRXZlbnRMb2NhdGlvbl9jYWxsYmFjaygpCnsKJHNjb3BlLnVwZGF0ZUxvY2F0aW9uQWxlcnRNZXNzYWdlPSLXoteV15PXm9efINeR15TXptec15fXlCEiOwokdGltZW91dChmdW5jdGlvbigpCnsKJHNjb3BlLnVwZGF0ZUxvY2F0aW9uQWxlcnRNZXNzYWdlPW51bGw7Cn0sIDE1MDApOwp9Cn07Cgokc2NvcGUudXBkYXRlSW5zdHJ1Y3RvckNsYXNzRXZlbnQgPSBmdW5jdGlvbigpCnsKY29uc29sZS5sb2coImZ1bmN0aW9uOiB1cGRhdGVJbnN0cnVjdG9yQ2xhc3NFdmVudCIpOwp1cGRhdGVFdmVudEluc3RydWN0b3IoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCwkc2NvcGUuY3VycmVudEV2ZW50Lmluc3RydWN0b3JfaWQsdXBkYXRlRXZlbnRJbnN0cnVjdG9yX2NhbGxiYWNrLCB1cGRhdGVFdmVudEluc3RydWN0b3JfY2FsbGJhY2spOwokc2NvcGUudXBkYXRlSW5zdHJ1Y3RvckFsZXJ0TWVzc2FnZT0i157XoteT15vXnyDXodeY15jXldehLi4uIjsKZnVuY3Rpb24gdXBkYXRlRXZlbnRJbnN0cnVjdG9yX2NhbGxiYWNrKCkKewokc2NvcGUudXBkYXRlSW5zdHJ1Y3RvckFsZXJ0TWVzc2FnZT0i16LXldeT15vXnyDXkdeU16bXnNeX15QhIjsKJHRpbWVvdXQoZnVuY3Rpb24oKQp7CiRzY29wZS51cGRhdGVJbnN0cnVjdG9yQWxlcnRNZXNzYWdlPW51bGw7Cn0sIDE1MDApOwp9Cn0KCgokc2NvcGUuYWN0aXZhdGVFdmVudENsYXNzID0gZnVuY3Rpb24oKQp7CnsKbG9nRGVidWcoInJlb3BlbkV2ZW50Iik7CnJlb3BlbkV2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkLCRzY29wZS5zZWxlY3RlZEV2ZW50LGFmdGVyUmVvcGVuRXZlbnQsYWZ0ZXJSZW9wZW5FdmVudCk7CmZ1bmN0aW9uIGFmdGVyUmVvcGVuRXZlbnQoKQp7CmdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQpOwp9Owp9Cn0KCi8vIGNsb3NlIGV2ZW50IGNsYXNzCiRzY29wZS5jbG9zZUV2ZW50Q2xhc3MgPSBmdW5jdGlvbigpIHsKICAgICAgbG9nRGVidWcoImNsb3NlRXZlbnRDbGFzcyIpOwoKdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CmFuaW1hdGlvbjogZmFsc2UsCnRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2V2ZW50X2NsYXNzX2Nsb3NlLnBocCcsCnNpemU6ICd4cycsCmNvbnRyb2xsZXI6ICdjbGFzc0Nsb3NlTW9kYWxDb250cm9sbGVyJywKcmVzb2x2ZTogewpldmVudF9pZDogZnVuY3Rpb24oKSB7CnJldHVybiAkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkOwp9Cn0KfSk7Cn07CgovLyBkZWxldGUgcmVwZWF0aW5nL2NsYXNzIGV2ZW50CiRzY29wZS5kZWxldGVDbGFzc0V2ZW50ID0gZnVuY3Rpb24oKQp7CmlmICgkc2NvcGUuY3VycmVudEV2ZW50LmlzX3JlcGVhdGluZz09MCkKewpsb2dEZWJ1ZygiY2xhc3MgZXZlbnQgbm90IHJlcGVhdGluZyIpOwokc2NvcGUuZGVsZXRlQ2xhc3NFdmVudFNpbmdsZSgpOwp9CmVsc2UKewpsb2dEZWJ1ZygiY2xhc3MgZXZlbnQgaXMgcmVwZWF0aW5nIik7CnZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewphbmltYXRpb246IGZhbHNlLAp0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9yZXBlYXRpbmdfZXZlbnRfZGVsZXRlX2FsbC5waHAnLApzaXplOiAneHMnLApjb250cm9sbGVyOiAnY2xhc3NEZWxldGVBbGxNb2RhbENvbnRyb2xsZXInLApyZXNvbHZlOiB7CmN1cnJlbnRFdmVudDogZnVuY3Rpb24oKSB7CnJldHVybiAkc2NvcGUuY3VycmVudEV2ZW50Owp9Cn0KfSk7Cn0KfTsKCiRzY29wZS5kZWxldGVDbGFzc0V2ZW50U2luZ2xlPWZ1bmN0aW9uICgpIC8vIGRlbGV0ZSBvbmx5IG9uZS9jdXJyZW50IGNsYXNzIGV2ZWh0CnsKY2FuY2VsQ2xhc3NFdmVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCxjYW5jZWxDbGFzc0V2ZW50X2NhbGxiYWNrLCBjYW5jZWxDbGFzc0V2ZW50X2NhbGxiYWNrKTsKZnVuY3Rpb24gY2FuY2VsQ2xhc3NFdmVudF9jYWxsYmFjaygpCnsKZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCk7Cn0KfQoKJHNjb3BlLiRvbigicmVsb2FkRXZlbnQiLGZ1bmN0aW9uKGUsYSl7Ci8vIFBvc3QgeW91ciBjb2RlCmxvZ0RlYnVnKCJicm9hZGNhc3RlZCAtIHJlbG9hZGluZyBldmVudCAiK2EuZXZlbnRfaWQpOwpnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkcm91dGVQYXJhbXMuZXZlbnRfaWQpOwp9KTsKCi8vIHJlbW92ZSBlbmQgdXNlciBmcm9tIGV2ZW50CiRzY29wZS5ldmVudFJlbW92ZUVuZFVzZXIgPSBmdW5jdGlvbihlbmR1c2VyX2lkKQp7CmNvbnNvbGUubG9nKCJldmVudFJlbW92ZUVuZFVzZXIiKTsKcmVtb3ZlRW5kVXNlckZyb21FdmVudCgkaHR0cCwkc2NvcGUsZW5kdXNlcl9pZCwkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkLHJlbW92ZUVuZFVzZXJGcm9tRXZlbnRfZmluaXNoLCByZW1vdmVFbmRVc2VyRnJvbUV2ZW50X2ZpbmlzaCk7CmZ1bmN0aW9uIHJlbW92ZUVuZFVzZXJGcm9tRXZlbnRfZmluaXNoKCkKewpnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkcm91dGVQYXJhbXMuZXZlbnRfaWQpOwp9Cn07Cgokc2NvcGUuZXZlbnRDbGllbnRTZWxlY3RlZCA9IGZ1bmN0aW9uKHNlbGVjdGVkKSB7CmlmIChzZWxlY3RlZCkgewovLyBhbGVydChKU09OLnN0cmluZ2lmeSggc2VsZWN0ZWQsIG51bGwsIDIgKSk7CmxvZ0RlYnVnKCdldmVudENsaWVudFNlbGVjdGVkMiB5ZXMgc2VsZWN0ZWQgJyArIHNlbGVjdGVkLm9yaWdpbmFsT2JqZWN0LmZpcnN0X25hbWUpOwokc2NvcGUuZXZlbnRBZGRFbmRVc2VyKHNlbGVjdGVkLm9yaWdpbmFsT2JqZWN0LmJ1c2luZXNzX3VzZXJfaWQpOwokcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2FuZ3Vjb21wbGV0ZS1hbHQ6Y2xlYXJJbnB1dCcsICdjbGllbnRfYW5ndWNvbXBsZXRlJyk7Cgp9IGVsc2Ugewpsb2dEZWJ1Zygnbm90IHNlbGVjdGVkJyk7Cn0KfTsKCiRzY29wZS5ldmVudEFkZEVuZFVzZXIgPSBmdW5jdGlvbihlbmR1c2VyX2lkKQp7CmFkZEVuZFVzZXJUb0V2ZW50KCRodHRwLCRzY29wZSxlbmR1c2VyX2lkLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQsYWRkRW5kVXNlclRvRXZlbnRfZmluaXNoLCBhZGRFbmRVc2VyVG9FdmVudF9maW5pc2gpOwpmdW5jdGlvbiBhZGRFbmRVc2VyVG9FdmVudF9maW5pc2goKQp7CmdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCk7Cn0KfTsKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ0V2ZW50UGFnZUNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICR0aW1lb3V0LCAkaHR0cCwgJHVpYk1vZGFsICxzaGFyZWRQcm9wZXJ0aWVzLCAkcm91dGVQYXJhbXMsICRyb290U2NvcGUsICRsb2NhdGlvbiwgJHJvdXRlLCBzaGFyZWREYXRhKQp7CmxvZ0RlYnVnKCJFdmVudFBhZ2VDb250cm9sbGVyIik7CgpnZXRBbGxJbnN0cnVjdG9yc0luY0luYWN0aXZlKCRodHRwLCRzY29wZSwnaW5zdHJ1Y3RvcnMnLGdldEFsbEluc3RydWN0b3JzSW5jSW5hY3RpdmVfc3VjY2Vzcyk7CmdldEJ1c2luZXNzTG9jYXRpb25zKCRodHRwLCRzY29wZSwnYnVzaW5lc3NfbG9jYXRpb25zJyk7CgpmdW5jdGlvbiBnZXRBbGxJbnN0cnVjdG9yc0luY0luYWN0aXZlX3N1Y2Nlc3MoKQp7CmdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCxzZXRQYXJ0aWNpcGF0ZWQpOwp9CgogIHZhciBpbml0aWFsaXppbmcgPSB0cnVlIDsKCiAgJHNjb3BlLiR3YXRjaCgiY3VycmVudEV2ZW50IiwgZnVuY3Rpb24obmV3VmFsdWUsIG9sZFZhbHVlKSB7CiAgICBpZiAoaW5pdGlhbGl6aW5nKSB7CiAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkgeyBpbml0aWFsaXppbmcgPSBmYWxzZTsgfSk7CiAgICB9IGVsc2UgewogICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgdmFyIHRpbWVvdXRJZDsKICAgICAgJCgnI2RvY3MgOmlucHV0LCB0ZXh0YXJlYScpLm9uKCdpbnB1dCBwcm9wZXJ0eWNoYW5nZSBjaGFuZ2UnLCBmdW5jdGlvbigpIHsKICAgICAgLy8gIGNvbnNvbGUubG9nKCdUZXh0YXJlYSBDaGFuZ2UnKTsKICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0SWQpOwogICAgICAgLy8gUnVucyBYIHNlY29uZCAoWCoxMDAwIG1zKSBhZnRlciB0aGUgbGFzdCBjaGFuZ2UKICAgICAgIHRpbWVvdXRJZCA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgJHNjb3BlLnVwZGF0ZUV2ZW50RXh0cmFGaWVsZHMoKQogICAgICAgfSwgNzAwKTsKICAgICAgIH0pOwogICAgfSwgMTAwMCk7CiAgICB9CiAgfSk7Cgokc2NvcGUuZXh0cmFGaWVsZHNBbGVydE1lc3NhZ2U9bnVsbDsKCiRzY29wZS51cGRhdGVFdmVudFRpdGxlID0gZnVuY3Rpb24obmV3VmFsdWUsY3VycmVudEV2ZW50KQp7Cm5ld190aXRsZT1uZXdWYWx1ZTsKc2V0RXZlbnRUaXRsZSgkaHR0cCwkc2NvcGUsY3VycmVudEV2ZW50LmV2ZW50X2lkLCBuZXdfdGl0bGUsIHVwZGF0ZUV2ZW50X2NhbGxiYWNrLCB1cGRhdGVFdmVudF9jYWxsYmFjayk7CgpmdW5jdGlvbiB1cGRhdGVFdmVudF9jYWxsYmFjaygpCnsKZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCk7Cn0KCn07CgoKJHNjb3BlLnVwZGF0ZUV2ZW50RXh0cmFGaWVsZHMgPSBmdW5jdGlvbigpCnsKICAgIGxvZ0RlYnVnKCJzYXZlIHVwZGF0ZUV2ZW50RXh0cmFGaWVsZHMiKTsKdGhlZGF0YSA9IHsKZXh0cmFGaWVsZHM6JHNjb3BlLmN1cnJlbnRFdmVudC5leHRyYUZpZWxkcwp9OwogICAgJHNjb3BlLmV4dHJhRmllbGRzQWxlcnRNZXNzYWdlPSLXqdeV157XqC4uLiI7CnVwZGF0ZUV2ZW50RXh0cmFGaWVsZHMoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCx0aGVkYXRhLHVwZGF0ZUV2ZW50RXh0cmFGaWVsZHNfY2FsbGJhY2ssIHVwZGF0ZUV2ZW50RXh0cmFGaWVsZHNfY2FsbGJhY2spOwoKZnVuY3Rpb24gdXBkYXRlRXZlbnRFeHRyYUZpZWxkc19jYWxsYmFjaygpCnsKICAgICAgLy8gZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLHNldFBhcnRpY2lwYXRlZCk7CgogICAgICAkc2NvcGUuZXh0cmFGaWVsZHNBbGVydE1lc3NhZ2U9Iteg16nXnteoISI7CiR0aW1lb3V0KGZ1bmN0aW9uKCkKewokc2NvcGUuZXh0cmFGaWVsZHNBbGVydE1lc3NhZ2U9bnVsbDsKICAgICAgfSwgMjMwMCk7Cn0KfTsKCiRzY29wZS5yZXNjaGVkdWxlRXZlbnQgPSBmdW5jdGlvbigpCnsKbG9nRGVidWcoInNlZXRpbmcgZXZlbnQgdG8gbW92ZSAgIiskc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0pOwpzaGFyZWRQcm9wZXJ0aWVzLnNldF9ldmVudF9yZXNjaGVkdWxlKCRzY29wZS5jdXJyZW50RXZlbnQpOwogICAgc2hhcmVkUHJvcGVydGllcy5zZXRfc2VsZWN0ZWRfdXNlcihudWxsKTsKCi8vIHVzZXJfaW5mbz0gewovLyAgICAgdXNlcl9pZDogJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudFVzZXJzWzBdLnVzZXJfaWQsCi8vICAgICBidXNlcl9maXJzdF9uYW1lOiAkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfZmlyc3RfbmFtZSwKLy8gICAgIGJ1c2VyX2xhc3RfbmFtZTogJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudFVzZXJzWzBdLmJ1c2VyX2xhc3RfbmFtZQovLyB9OwovLyBzaGFyZWRQcm9wZXJ0aWVzLnNldF9zZWxlY3RlZF91c2VyKHVzZXJfaW5mbyk7CiRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfY2FsZW5kYXInKTsKfQoKJHNjb3BlLnVwZGF0ZUxvY2F0aW9uRXZlbnQgPSBmdW5jdGlvbigpCnsKY29uc29sZS5sb2coImZ1bmN0aW9uOiB1cGRhdGVMb2NhdGlvbkV2ZW50Iik7CnVwZGF0ZUV2ZW50TG9jYXRpb24oJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCwkc2NvcGUuY3VycmVudEV2ZW50LmxvY2F0aW9uX2lkLHVwZGF0ZUV2ZW50TG9jYXRpb25fY2FsbGJhY2ssIHVwZGF0ZUV2ZW50TG9jYXRpb25fY2FsbGJhY2spOwokc2NvcGUudXBkYXRlTG9jYXRpb25BbGVydE1lc3NhZ2U9Itee16LXk9eb158g16HXmNeY15XXoS4uLiI7CmZ1bmN0aW9uIHVwZGF0ZUV2ZW50TG9jYXRpb25fY2FsbGJhY2soKQp7CiRzY29wZS51cGRhdGVMb2NhdGlvbkFsZXJ0TWVzc2FnZT0i16LXldeT15vXnyDXkdeU16bXnNeX15QhIjsKJHRpbWVvdXQoZnVuY3Rpb24oKQp7CiRzY29wZS51cGRhdGVMb2NhdGlvbkFsZXJ0TWVzc2FnZT1udWxsOwp9LCAxNTAwKTsKfQp9OwoKJHNjb3BlLnVwZGF0ZUluc3RydWN0b3JFdmVudCA9IGZ1bmN0aW9uKCkKewpjb25zb2xlLmxvZygiZnVuY3Rpb246IHVwZGF0ZUluc3RydWN0b3JFdmVudCIpOwp1cGRhdGVFdmVudEluc3RydWN0b3IoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCwkc2NvcGUuY3VycmVudEV2ZW50Lmluc3RydWN0b3JfaWQsdXBkYXRlRXZlbnRJbnN0cnVjdG9yX2NhbGxiYWNrLCB1cGRhdGVFdmVudEluc3RydWN0b3JfY2FsbGJhY2spOwokc2NvcGUudXBkYXRlSW5zdHJ1Y3RvckFsZXJ0TWVzc2FnZT0i157XoteT15vXnyDXodeY15jXldehLi4uIjsKZnVuY3Rpb24gdXBkYXRlRXZlbnRJbnN0cnVjdG9yX2NhbGxiYWNrKCkKewokc2NvcGUudXBkYXRlSW5zdHJ1Y3RvckFsZXJ0TWVzc2FnZT0i16LXldeT15vXnyDXkdeU16bXnNeX15QhIjsKJHRpbWVvdXQoZnVuY3Rpb24oKQp7CiRzY29wZS51cGRhdGVJbnN0cnVjdG9yQWxlcnRNZXNzYWdlPW51bGw7Cn0sIDE1MDApOwp9Cn07Cgokc2NvcGUuaW5pdGlhdGVQYXltZW50ID0gZnVuY3Rpb24oaXNwbHVzKQp7CnZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewphbmltYXRpb246IGZhbHNlLAp0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9jbGllbnRfcGF5bWVudC5waHAnLApjb250cm9sbGVyOiAnYnVzaW5lc3NDbGllbmRDYXJkUGF5bWVudCcsCi8vIHNpemU6IHNpemUsCnJlc29sdmU6IHsKY3VycmVudENsaWVudDogZnVuY3Rpb24oKSB7CnJldHVybiAkc2NvcGUuY3VycmVudEV2ZW50Q2xpZW50c1swXTsKfSwKaXNwbHVzOiBmdW5jdGlvbigpIHsKcmV0dXJuIGlzcGx1czsKfQp9Cn0pOwp9Cgokc2NvcGUuZGVsZXRlRXZlbnQ9ZnVuY3Rpb24gKCkKewovLyBjaGVja2luZyBpZiBjYW5jZWxpbmcgYSBnZW5lcmNfdHlwZSBldmVudCAtIHRoZW4gdGhlcmUncyBubyB1c2VyCmlmICgkc2NvcGUuY3VycmVudEV2ZW50LmlzX2dlbmVyaWNfZXR5cGU9PTEpCnsKY2FuY2VsU2luZ2xlRXZlbnQoJGh0dHAsJHNjb3BlLDAsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLGNhbmNlbFNpbmdsZUV2ZW50X2NhbGxiYWNrLCBjYW5jZWxTaW5nbGVFdmVudF9jYWxsYmFjayk7Cn0KZWxzZQp7CmNhbmNlbFNpbmdsZUV2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50VXNlcnNbMF0uYnVzaW5lc3NfdXNlcl9pZCwkcm91dGVQYXJhbXMuZXZlbnRfaWQsY2FuY2VsU2luZ2xlRXZlbnRfY2FsbGJhY2ssIGNhbmNlbFNpbmdsZUV2ZW50X2NhbGxiYWNrKTsKfQpmdW5jdGlvbiBjYW5jZWxTaW5nbGVFdmVudF9jYWxsYmFjaygpCnsKZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLHNldFBhcnRpY2lwYXRlZCk7Cn0KfQoKJHNjb3BlLnNldFBhcnRpY2lwYXRpb25TdGF0dXMgPSBmdW5jdGlvbigpCnsKc2V0RXZlbnRVc2VyUGFydGljaXBhdGlvblN0YXR1cygkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRVc2Vyc1swXS5idXNpbmVzc191c2VyX2lkLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRVc2Vyc1swXS5ldmVudF91c2VyX3N0YXR1c19pZCxzZXRQYXJ0aWNpcGF0aW9uU3RhdHVzX2NhbGxiYWNrLCBzZXRQYXJ0aWNpcGF0aW9uU3RhdHVzX2NhbGxiYWNrKTsKJHNjb3BlLnVwZGF0ZVN0YXR1c0FsZXJ0TWVzc2FnZT0i157XoteT15vXnyDXodeY15jXldehLi4uIjsKZnVuY3Rpb24gc2V0UGFydGljaXBhdGlvblN0YXR1c19jYWxsYmFjaygpCnsKLy8gZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLHNldFBhcnRpY2lwYXRlZCk7CnNldFBhcnRpY2lwYXRlZCgpOwokc2NvcGUudXBkYXRlU3RhdHVzQWxlcnRNZXNzYWdlPSLXoteV15PXm9efINeR15TXptec15fXlCEiOwokdGltZW91dChmdW5jdGlvbigpCnsKJHNjb3BlLnVwZGF0ZVN0YXR1c0FsZXJ0TWVzc2FnZT1udWxsOwp9LCAyNTAwKTsKfQp9CgpmdW5jdGlvbiBzZXRQYXJ0aWNpcGF0ZWQoKQp7CmxvZ0RlYnVnKCJnZXQgY2xpZW50IGluZm8iKTsKZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Q2xpZW50cycsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudFVzZXJzWzBdLmJ1c2luZXNzX3VzZXJfaWQpOwpsb2dEZWJ1Zygic2V0dGluZyBzZXRQYXJ0aWNpcGF0ZWQiKTsKaWYgKCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRVc2Vyc1swXS5zdGF0dXNfbmFtZSE9JGdVc2VyX3N0YXR1c19hYnNlbnRlZCkKewokc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50VXNlcnNbMF0ucGFydGljaXBhdGVkPXRydWU7Cn0KZWxzZQp7CiRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRVc2Vyc1swXS5wYXJ0aWNpcGF0ZWQ9ZmFsc2U7Cn0KCi8vIHRoaXMgbG9vcCBpcyBmb3IgZml4aW5nIHRoZSBkYXRlIGZvcm1hdCB0byBhcHBlYXIgcHJvcGVybHkgaW4gdGhlIGlucHV0IGRhdGUgaHRtbCBvYmplY3QKZm9yIChpID0gMDsgaTwgKCRzY29wZS5jdXJyZW50RXZlbnQuZXh0cmFGaWVsZHMpLmxlbmd0aDsgaSsrKQp7CmxvZ0RlYnVnKCRzY29wZS5jdXJyZW50RXZlbnQuZXh0cmFGaWVsZHNbaV0pOwppZiAoJHNjb3BlLmN1cnJlbnRFdmVudC5leHRyYUZpZWxkc1tpXS5maWVsZF9kYXRhdHlwZT09IkRBVEUiKQp7Ci8vIGxvZ0RlYnVnKCJkYXRlIik7CiRzY29wZS5jdXJyZW50RXZlbnQuZXh0cmFGaWVsZHNbaV0uZmllbGRfdmFsdWU9bmV3IERhdGUoJHNjb3BlLmN1cnJlbnRFdmVudC5leHRyYUZpZWxkc1tpXS5maWVsZF92YWx1ZSk7Cn0KfQoKbG9nRGVidWcoIiRzY29wZS5jdXJyZW50RXZlbnQuaW5zdHJ1Y3Rvcl9pZDs9Iiskc2NvcGUuY3VycmVudEV2ZW50Lmluc3RydWN0b3JfaWQpOwpmb3IodmFyIGkgPSAwOyBpIDwgJHNjb3BlLmluc3RydWN0b3JzLmxlbmd0aDsgaSsrKQp7CmxvZ0RlYnVnKCRzY29wZS5pbnN0cnVjdG9yc1tpXS5pc19hY3RpdmUpOwppZiAoJHNjb3BlLmluc3RydWN0b3JzW2ldLmJ1c2luZXNzX3VzZXJfaWQ9PSRzY29wZS5jdXJyZW50RXZlbnQuaW5zdHJ1Y3Rvcl9pZCkKewpsb2dEZWJ1ZygieWVzaCIpOwokc2NvcGUuaW5zdHJ1Y3RvcnNbaV0uaXNfYWN0aXZlPTE7Cn0KfQp9Cgokc2NvcGUudXBkYXRlVXNlckV2ZW50UHJpY2UgPSBmdW5jdGlvbihuZXd2YWx1ZSwgdGhlZXZlbnQpCnsKbmV3X3ByaWNlPW5ld3ZhbHVlOwpzZXRDbGllbnRFdmVudFByaWNlKCRodHRwLCRzY29wZSwkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50VXNlcnNbMF0uYnVzaW5lc3NfdXNlcl9pZCx0aGVldmVudC5ldmVudF9pZCwgbmV3X3ByaWNlLHNldENsaWVudEV2ZW50UHJpY2VfY2FsbGJhY2ssIHNldENsaWVudEV2ZW50UHJpY2VfY2FsbGJhY2spOwpmdW5jdGlvbiBzZXRDbGllbnRFdmVudFByaWNlX2NhbGxiYWNrKCkKewpnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkcm91dGVQYXJhbXMuZXZlbnRfaWQsc2V0UGFydGljaXBhdGVkKTsKfQp9OwoKJHNjb3BlLiRvbigiZXZlbnRQYWdlUmVsb2FkRGF0YSIsZnVuY3Rpb24oZSxhKQp7CmdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCxzZXRQYXJ0aWNpcGF0ZWQpOwp9KTsKCgoKCiRzY29wZS5jbG9zZUV2ZW50ID0gZnVuY3Rpb24oKQp7CmxvZ0RlYnVnKCJjaGVja2luZyBpZiBldmVudCBoYXMgZXh0cmEgZmllbGRzIHRoYXQgYXJlIHJlcXVpcmVkIGJlZm9yZSBjbG9zaW5nIGl0Iik7CmNoZWNrRXZlbnRFeHRyYUZpZWxkcygkaHR0cCwkc2NvcGUsJ2NoZWNrRXZlbnRFeHRyYUZpZWxkcycsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLGNoZWNrRXZlbnRFeHRyYUZpZWxkc19zdWNjZXNzKTsKZnVuY3Rpb24gY2hlY2tFdmVudEV4dHJhRmllbGRzX3N1Y2Nlc3MoKQp7CmlmICgkc2NvcGUuY2hlY2tFdmVudEV4dHJhRmllbGRzPT10cnVlKQp7CmxvZ0RlYnVnKCJldmVudCBoYXMgYWxsIGV4dHJhIGZpZWxkcyBvaywgY2xvc2luZyBldmVudCIpOwovLyAkc2NvcGUuY3VycmVudEV2ZW50Lmlnbm9yZUV4dHJhRmllbGRzVmFsaWRhdGlvbj10cnVlOwpjbG9zZUV2ZW50KCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuZXZlbnRfaWQsJHNjb3BlLmN1cnJlbnRFdmVudCxhZnRlckNsb3NlRXZlbnQsYWZ0ZXJDbG9zZUV2ZW50KTsKZnVuY3Rpb24gYWZ0ZXJDbG9zZUV2ZW50KCkKewpnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkcm91dGVQYXJhbXMuZXZlbnRfaWQsc2V0UGFydGljaXBhdGVkKTsKfTsKfQplbHNlCnsKbG9nRGVidWcoImV2ZW50IGhhcyBleHRyYSBmaWVsZHMgcmVxdWlyZWQgdGhhdCBhcmUgbm90IGZpbGxlZCIpOwp2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKYW5pbWF0aW9uOiBmYWxzZSwKdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfZXZlbnRfY2xvc2VfaWdub3JlX21hbmRhdG9yeV9maWVsZHMucGhwJywKY29udHJvbGxlcjogJ2V2ZW50Q2xvc2VJZ25vcmVNYW5kYXRvcnlGaWVsZHNNb2RhbENvbnRyb2xsZXInLApzaXplOiAnbScsCnJlc29sdmU6IHsKY3VycmVudEV2ZW50OiBmdW5jdGlvbigpIHsKcmV0dXJuICRzY29wZS5jdXJyZW50RXZlbnQ7Cn0KfQp9KTsKfQp9Cn0KJHNjb3BlLnJlb3BlbkV2ZW50ID0gZnVuY3Rpb24oKQp7CmxvZ0RlYnVnKCJyZW9wZW5FdmVudCIpOwpyZW9wZW5FdmVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCwkc2NvcGUuY3VycmVudEV2ZW50LGFmdGVyUmVvcGVuRXZlbnQsYWZ0ZXJSZW9wZW5FdmVudCk7CmZ1bmN0aW9uIGFmdGVyUmVvcGVuRXZlbnQoKQp7CmdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQsc2V0UGFydGljaXBhdGVkKTsKfTsKfQoKfSk7CgprdXplQXBwLmZpbHRlcignc3RhcnRGcm9tJywgZnVuY3Rpb24oKQp7CnJldHVybiBmdW5jdGlvbihpbnB1dCwgc3RhcnQpCnsKaWYoIWlucHV0KSByZXR1cm4gW107Ci8vIGNvbnNvbGUubG9nKCJoZXJlcmVlZSAiK2lucHV0KTsKc3RhcnQgPSArc3RhcnQ7IC8vcGFyc2UgdG8gaW50CnJldHVybiBpbnB1dC5zbGljZShzdGFydCk7Cn0KfSk7Ci8vIGFuZ3VsYXIgZmlsdGVyIGZvciBldmVudHMgYmVmb3JlL2FmdGVyIHRvZGF5Cmt1emVBcHAuZmlsdGVyKCdiZWZvcmVOb3cnLCBmdW5jdGlvbigpIHsKLy8gQ3JlYXRlIHRoZSByZXR1cm4gZnVuY3Rpb24gYW5kIHNldCB0aGUgcmVxdWlyZWQgcGFyYW1ldGVyIG5hbWUgdG8gKippbnB1dCoqCnJldHVybiBmdW5jdGlvbihpbnB1dCkgewp2YXIgb3V0ID0gW107CgovLyBVc2luZyB0aGUgYW5ndWxhci5mb3JFYWNoIG1ldGhvZCwgZ28gdGhyb3VnaCB0aGUgYXJyYXkgb2YgZGF0YSBhbmQgcGVyZm9ybSB0aGUgb3BlcmF0aW9uIG9mIGZpZ3VyaW5nIG91dCBpZiB0aGUgbGFuZ3VhZ2UgaXMgc3RhdGljYWxseSBvciBkeW5hbWljYWxseSB0eXBlZC4KdmFyIGJyb3dzZXJfZXBvY2ggPSAobmV3IERhdGUpLmdldFRpbWUoKTsKCmFuZ3VsYXIuZm9yRWFjaChpbnB1dCwgZnVuY3Rpb24oZXZlbnQpCnsKLy8gIGxvZ0RlYnVnKCJmaWx0ZXJpbmcsIGV2ZW50LmV2ZW50X3VzZXJfc3RhdHVzX2lkPSIrZXZlbnQuZXZlbnRfdXNlcl9zdGF0dXNfaWQpOwppZiAoZXZlbnQuc3RhcnRfZXBvY2ggPD0gKGJyb3dzZXJfZXBvY2gvMTAwMCkpCnsKb3V0LnB1c2goZXZlbnQpCn0KfSkKcmV0dXJuIG91dDsKfQp9KTsKa3V6ZUFwcC5maWx0ZXIoJ2FmdGVyTm93JywgZnVuY3Rpb24oKSB7Ci8vIENyZWF0ZSB0aGUgcmV0dXJuIGZ1bmN0aW9uIGFuZCBzZXQgdGhlIHJlcXVpcmVkIHBhcmFtZXRlciBuYW1lIHRvICoqaW5wdXQqKgpyZXR1cm4gZnVuY3Rpb24oaW5wdXQpIHsKdmFyIG91dCA9IFtdOwoKLy8gVXNpbmcgdGhlIGFuZ3VsYXIuZm9yRWFjaCBtZXRob2QsIGdvIHRocm91Z2ggdGhlIGFycmF5IG9mIGRhdGEgYW5kIHBlcmZvcm0gdGhlIG9wZXJhdGlvbiBvZiBmaWd1cmluZyBvdXQgaWYgdGhlIGxhbmd1YWdlIGlzIHN0YXRpY2FsbHkgb3IgZHluYW1pY2FsbHkgdHlwZWQuCnZhciBicm93c2VyX2Vwb2NoID0gKG5ldyBEYXRlKS5nZXRUaW1lKCk7Cgphbmd1bGFyLmZvckVhY2goaW5wdXQsIGZ1bmN0aW9uKGV2ZW50KQp7Ci8vICBsb2dEZWJ1ZygiZmlsdGVyaW5nLCBldmVudC5ldmVudF91c2VyX3N0YXR1c19pZD0iK2V2ZW50LmV2ZW50X3VzZXJfc3RhdHVzX2lkKTsKaWYgKGV2ZW50LnN0YXJ0X2Vwb2NoID4gKGJyb3dzZXJfZXBvY2gvMTAwMCkpCnsKb3V0LnB1c2goZXZlbnQpCn0KfSkKcmV0dXJuIG91dDsKfQp9KTsKCmt1emVBcHAuZmlsdGVyKCdpc0FjdGl2ZScsIGZ1bmN0aW9uKCkgewovLyBDcmVhdGUgdGhlIHJldHVybiBmdW5jdGlvbiBhbmQgc2V0IHRoZSByZXF1aXJlZCBwYXJhbWV0ZXIgbmFtZSB0byAqKmlucHV0KioKcmV0dXJuIGZ1bmN0aW9uKGlucHV0KSB7CnZhciBvdXQgPSBbXTsKCi8vIFVzaW5nIHRoZSBhbmd1bGFyLmZvckVhY2ggbWV0aG9kLCBnbyB0aHJvdWdoIHRoZSBhcnJheSBvZiBkYXRhIGFuZCBwZXJmb3JtIHRoZSBvcGVyYXRpb24gb2YgZmlndXJpbmcgb3V0IGlmIHRoZSBsYW5ndWFnZSBpcyBzdGF0aWNhbGx5IG9yIGR5bmFtaWNhbGx5IHR5cGVkLgoKYW5ndWxhci5mb3JFYWNoKGlucHV0LCBmdW5jdGlvbihldmVudCkKewovLyAgbG9nRGVidWcoImZpbHRlcmluZywgZXZlbnQuZXZlbnRfdXNlcl9zdGF0dXNfaWQ9IitldmVudC5ldmVudF91c2VyX3N0YXR1c19pZCk7CmlmIChldmVudC5pc19hY3RpdmU9PTEpCnsKb3V0LnB1c2goZXZlbnQpCn0KfSkKcmV0dXJuIG91dDsKfQp9KTsKCmt1emVBcHAuZmlsdGVyKCdzaG91bGRfYmVfZGlzcGxheWVkJywgZnVuY3Rpb24oKSB7Ci8vIENyZWF0ZSB0aGUgcmV0dXJuIGZ1bmN0aW9uIGFuZCBzZXQgdGhlIHJlcXVpcmVkIHBhcmFtZXRlciBuYW1lIHRvICoqaW5wdXQqKgpyZXR1cm4gZnVuY3Rpb24oaW5wdXQpIHsKdmFyIG91dCA9IFtdOwoKLy8gVXNpbmcgdGhlIGFuZ3VsYXIuZm9yRWFjaCBtZXRob2QsIGdvIHRocm91Z2ggdGhlIGFycmF5IG9mIGRhdGEgYW5kIHBlcmZvcm0gdGhlIG9wZXJhdGlvbiBvZiBmaWd1cmluZyBvdXQgaWYgdGhlIGxhbmd1YWdlIGlzIHN0YXRpY2FsbHkgb3IgZHluYW1pY2FsbHkgdHlwZWQuCgphbmd1bGFyLmZvckVhY2goaW5wdXQsIGZ1bmN0aW9uKGV2ZW50KQp7Ci8vICBsb2dEZWJ1ZygiZmlsdGVyaW5nLCBldmVudC5ldmVudF91c2VyX3N0YXR1c19pZD0iK2V2ZW50LmV2ZW50X3VzZXJfc3RhdHVzX2lkKTsKaWYgKGV2ZW50LnNob3VsZF9iZV9kaXNwbGF5ZWQ9PTEpCnsKb3V0LnB1c2goZXZlbnQpCn0KfSkKcmV0dXJuIG91dDsKfQp9KTsKCmt1emVBcHAuY29udHJvbGxlcignSW5zdHJ1Y3RvclNob3cxQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHRpbWVvdXQsICRodHRwLCBzaGFyZWRQcm9wZXJ0aWVzLCAkcm9vdFNjb3BlLCAkcm91dGVQYXJhbXMsICRsb2NhdGlvbiwgJHJvdXRlLCBzaGFyZWREYXRhLCAkdWliTW9kYWwpCnsKZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLGdldEJ1c2luZXNzQ2xpZW50SW5mb19zdWNjZXNzKTsKICBnZXRzZWN1cml0eVByb2ZpbGVzKCRodHRwLCRzY29wZSwnc2VjX3Byb2ZpbGVzJyk7CgpmdW5jdGlvbiBnZXRCdXNpbmVzc0NsaWVudEluZm9fc3VjY2VzcygpCnsKZ2V0Q2xpZW50RXh0cmFGaWVsZHMoJGh0dHAsJHNjb3BlLCRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5idXNpbmVzc191c2VyX2lkLCdjbGllbnRFeHRyYUZpZWxkcycsZ2V0Q2xpZW50RXh0cmFGaWVsZHNfc3VjY2Vzcyk7CgpmdW5jdGlvbiBnZXRDbGllbnRFeHRyYUZpZWxkc19zdWNjZXNzKCkKewpmb3IgKGkgPSAwOyBpPCAoJHNjb3BlLmNsaWVudEV4dHJhRmllbGRzKS5sZW5ndGg7IGkrKykKewpsb2dEZWJ1Zygkc2NvcGUuY2xpZW50RXh0cmFGaWVsZHNbaV0pOwppZiAoJHNjb3BlLmNsaWVudEV4dHJhRmllbGRzW2ldLmZpZWxkX2RhdGF0eXBlPT0iREFURSIpCnsKLy8gbG9nRGVidWcoImRhdGUiKTsKJHNjb3BlLmNsaWVudEV4dHJhRmllbGRzW2ldLmZpZWxkX3ZhbHVlPW5ldyBEYXRlKCRzY29wZS5jbGllbnRFeHRyYUZpZWxkc1tpXS5maWVsZF92YWx1ZSk7Cn0KfQp9Cn0KCiAgJHNjb3BlLnVwZGF0ZV9zZWNfcHJvZmlsZSA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1ZygidXBkYXRlX3NlY19wcm9maWxlIGZvciBidWlkPSIrJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLmJ1c2luZXNzX3VzZXJfaWQrICIsIHByb2ZpbGVfaWQiKyRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5zZWNfcHJvZmlsZV9pZCk7CiAgICB1cGRhdGVfc2VjX3Byb2ZpbGUoJGh0dHAsJHNjb3BlLCRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5idXNpbmVzc191c2VyX2lkLCRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5zZWNfcHJvZmlsZV9pZCx1cGRhdGVfc2VjX3Byb2ZpbGVfc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiB1cGRhdGVfc2VjX3Byb2ZpbGVfc3VjY2VzcygpCiAgICB7CiAgICAgIGdldHNlY3VyaXR5UHJvZmlsZXMoJGh0dHAsJHNjb3BlLCdzZWNfcHJvZmlsZXMnKTsKICAgIH0KICB9CiRzY29wZS5hcmNoaXZlQ2xpZW50TW9kYWwgPSBmdW5jdGlvbigpCnsKLy8gYXJjaGl2ZS9kZWxldGUgY2xpZW50IC0gYXNrIGlmIHN1cmUKdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CmFuaW1hdGlvbjogZmFsc2UsCnRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2FyY2hpdmVfY2xpZW50X21vZGFsLnBocCcsCnNpemU6ICd4cycsCmNvbnRyb2xsZXI6ICdhcmNoaXZlX2NsaWVudF9tb2RhbCcsICAvLyAncGF5bWVueURldGFpbHNNb2RhbENvbnRyb2xsZXInLApyZXNvbHZlOiB7CmJ1c2luZXNzX3VzZXJfaWQ6IGZ1bmN0aW9uKCkgewpyZXR1cm4gJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLmJ1c2luZXNzX3VzZXJfaWQ7Cn0sCmJ1c2VyX2xhc3RfbmFtZTogZnVuY3Rpb24oKSB7CnJldHVybiAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYnVzZXJfbGFzdF9uYW1lOwp9LApidXNlcl9maXJzdF9uYW1lOiBmdW5jdGlvbigpIHsKcmV0dXJuICRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5idXNlcl9maXJzdF9uYW1lOwp9LAppc19pbnN0cnVjdG9yOiBmdW5jdGlvbigpIHsKcmV0dXJuIHRydWU7Cn0KfQp9KTsKfQoKJHNjb3BlLnVwZGF0ZVVzZXJGaXJzdE5hbWUgPSBmdW5jdGlvbihuZXdWYWx1ZSkKewpzZXRDbGllbnRGaXJzdE5hbWUoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLG5ld1ZhbHVlLGFmdGVyQ2xpZW50U2V0LGFmdGVyQ2xpZW50U2V0KTsKZnVuY3Rpb24gYWZ0ZXJDbGllbnRTZXQoKQp7CmdldEJ1c2luZXNzQ2xpZW50SW5mbygkaHR0cCwkc2NvcGUsJ2Zvcm1VcGRhdGVDbGllbnRBbmd1bGFyJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7Cn0KfQokc2NvcGUudXBkYXRlVXNlckxhc3ROYW1lID0gZnVuY3Rpb24obmV3VmFsdWUpCnsKc2V0Q2xpZW50TGFzdE5hbWUoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLG5ld1ZhbHVlLGFmdGVyQ2xpZW50U2V0LGFmdGVyQ2xpZW50U2V0KTsKZnVuY3Rpb24gYWZ0ZXJDbGllbnRTZXQoKQp7CmdldEJ1c2luZXNzQ2xpZW50SW5mbygkaHR0cCwkc2NvcGUsJ2Zvcm1VcGRhdGVDbGllbnRBbmd1bGFyJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7Cn0KfQokc2NvcGUudXBkYXRlVXNlclBob25lTnVtYmVyID0gZnVuY3Rpb24obmV3VmFsdWUpCnsKbmV3VmFsdWUgPSBuZXdWYWx1ZS5yZXBsYWNlKCctJywnJyk7CmlmIChpc05hTihuZXdWYWx1ZSkpCnsKYWxlcnQoIteQ16DXkCDXlNeW158g157Xodek16gg15jXnNek15XXnyDXqten15nXnyIpOwpnZXRCdXNpbmVzc0NsaWVudEluZm8oJGh0dHAsJHNjb3BlLCdmb3JtVXBkYXRlQ2xpZW50QW5ndWxhcicsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwp9CmVsc2UKewpzZXRDbGllbnRQaG9uZU51bWJlcigkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsbmV3VmFsdWUsc2V0Q2xpZW50UGhvbmVOdW1iZXJfY2FsbGJhY2ssc2V0Q2xpZW50UGhvbmVOdW1iZXJfY2FsbGJhY2spOwpmdW5jdGlvbiBzZXRDbGllbnRQaG9uZU51bWJlcl9jYWxsYmFjaygpCnsKZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKfQp9Cn0KCn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignQ2xpZW50c1Nob3cxQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHRpbWVvdXQsICRodHRwLCBzaGFyZWRQcm9wZXJ0aWVzLCAkcm9vdFNjb3BlLCAkcm91dGVQYXJhbXMsICRsb2NhdGlvbiwgJHJvdXRlLCBzaGFyZWREYXRhLCAkdWliTW9kYWwpCnsKZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLGdldEJ1c2luZXNzQ2xpZW50SW5mb19zdWNjZXNzKTsKCmZ1bmN0aW9uIGdldEJ1c2luZXNzQ2xpZW50SW5mb19zdWNjZXNzKCkKewpnZXRDbGllbnRFeHRyYUZpZWxkcygkaHR0cCwkc2NvcGUsJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLmJ1c2luZXNzX3VzZXJfaWQsJ2NsaWVudEV4dHJhRmllbGRzJyxnZXRDbGllbnRFeHRyYUZpZWxkc19zdWNjZXNzKTsKCmZ1bmN0aW9uIGdldENsaWVudEV4dHJhRmllbGRzX3N1Y2Nlc3MoKQp7CmZvciAoaSA9IDA7IGk8ICgkc2NvcGUuY2xpZW50RXh0cmFGaWVsZHMpLmxlbmd0aDsgaSsrKQp7CmxvZ0RlYnVnKCRzY29wZS5jbGllbnRFeHRyYUZpZWxkc1tpXSk7CmlmICgkc2NvcGUuY2xpZW50RXh0cmFGaWVsZHNbaV0uZmllbGRfZGF0YXR5cGU9PSJEQVRFIikKewovLyBsb2dEZWJ1ZygiZGF0ZSIpOwokc2NvcGUuY2xpZW50RXh0cmFGaWVsZHNbaV0uZmllbGRfdmFsdWU9bmV3IERhdGUoJHNjb3BlLmNsaWVudEV4dHJhRmllbGRzW2ldLmZpZWxkX3ZhbHVlKTsKfQp9Cn0KfQp7CmdldENsaWVudEV2ZW50cygkaHR0cCwkc2NvcGUsJ2N1cnJlbnRDbGllbnRFdmVudHMnLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKCmdldENsaWVudFBheW1lbnRzKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCwnY3VycmVudENsaWVudFBheW1lbnRzJyk7Cgokc2NvcGUuYXJjaGl2ZUNsaWVudE1vZGFsID0gZnVuY3Rpb24oKQp7Ci8vIGFyY2hpdmUvZGVsZXRlIGNsaWVudCAtIGFzayBpZiBzdXJlCnZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewphbmltYXRpb246IGZhbHNlLAp0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdhcmNoaXZlX2NsaWVudF9tb2RhbC5waHAnLApzaXplOiAneHMnLApjb250cm9sbGVyOiAnYXJjaGl2ZV9jbGllbnRfbW9kYWwnLCAgLy8gJ3BheW1lbnlEZXRhaWxzTW9kYWxDb250cm9sbGVyJywKcmVzb2x2ZTogewpidXNpbmVzc191c2VyX2lkOiBmdW5jdGlvbigpIHsKcmV0dXJuICRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5idXNpbmVzc191c2VyX2lkOwp9LApidXNlcl9sYXN0X25hbWU6IGZ1bmN0aW9uKCkgewpyZXR1cm4gJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLmJ1c2VyX2xhc3RfbmFtZTsKfSwKYnVzZXJfZmlyc3RfbmFtZTogZnVuY3Rpb24oKSB7CnJldHVybiAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYnVzZXJfZmlyc3RfbmFtZTsKfSwKaXNfaW5zdHJ1Y3RvcjogZnVuY3Rpb24oKSB7CnJldHVybiBmYWxzZTsKfQp9Cn0pOwp9CiRzY29wZS5wYWNrYWdlRGVsZXRlID0gZnVuY3Rpb24ocGFja2FnZSkKewpsb2dEZWJ1ZygicGFja2FnZSBkZWxldGUgIitKU09OLnN0cmluZ2lmeShwYWNrYWdlKSk7CmRlbGV0ZVBhY2thZ2UoJGh0dHAsJHNjb3BlLHBhY2thZ2UucGFja2FnZV91c2VyX2lkLCRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5idXNpbmVzc191c2VyX2lkLHN1Y2Nlc3NfY2FsbGJhY2ssIHN1Y2Nlc3NfY2FsbGJhY2spOwpmdW5jdGlvbiBzdWNjZXNzX2NhbGxiYWNrKCkKewokcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NsaWVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCn0KfQoKJHNjb3BlLnVwZGF0ZUNsaWVudEV4dHJhRmllbGRzID0gZnVuY3Rpb24oKQp7CiAgICAgIGxvZ0RlYnVnKCJ1cGRhdGVDbGllbnRFeHRyYUZpZWxkcyIpOwp0aGVkYXRhID0gewpleHRyYUZpZWxkczokc2NvcGUuY2xpZW50RXh0cmFGaWVsZHMKfTsKICAgICAgJHNjb3BlLmV4dHJhRmllbGRzQWxlcnRNZXNzYWdlPSLXqdeV157XqC4uLiI7CiAgICAgIHVwZGF0ZUNsaWVudEV4dHJhRmllbGRzKCRodHRwLCRzY29wZSwkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYnVzaW5lc3NfdXNlcl9pZCx0aGVkYXRhLHVwZGF0ZUV2ZW50Q2xpZW50RmllbGRzX2NhbGxiYWNrLCB1cGRhdGVFdmVudENsaWVudEZpZWxkc19jYWxsYmFjayk7CgogICAgICBmdW5jdGlvbiB1cGRhdGVFdmVudENsaWVudEZpZWxkc19jYWxsYmFjaygpCnsKLy8gZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLHNldFBhcnRpY2lwYXRlZCk7CiAgICAgICAgJHNjb3BlLmV4dHJhRmllbGRzQWxlcnRNZXNzYWdlPSLXoNep157XqCEiOwokdGltZW91dChmdW5jdGlvbigpCnsKJHNjb3BlLmV4dHJhRmllbGRzQWxlcnRNZXNzYWdlPW51bGw7Cn0sIDMwMDApOwp9Cn07Cgokc2NvcGUuc2NoZWR1bGVFdmVudEZvckNsaWVudCA9IGZ1bmN0aW9uKCkKewpsb2dEZWJ1Zygic2VldGluZyBzaGFyZSBwcm9wZXJ0eSB1c2VyX2lkICIrJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdKTsKc2hhcmVkUHJvcGVydGllcy5zZXRfc2VsZWN0ZWRfdXNlcigkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0pOwokbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2NhbGVuZGFyJyk7Cn0KJHNjb3BlLmludm9pY2VHZW5lcmF0ZUNoZWNrYm94ID0gZnVuY3Rpb24oZnBheW1lbnQpCnsKbG9nRGVidWcoImludm9pY2VHZW5lcmF0ZUNoZWNrYm94IGZvciAiK0pTT04uc3RyaW5naWZ5KGZwYXltZW50KSk7CnNldENsaWVudFBheW1lbnRJbnZvaWNlR2VuZXJhdGVkKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCxmcGF5bWVudC51c2VyX3BheW1lbnRfaWQsZnBheW1lbnQuaW52b2ljZV9nZW5lcmF0ZWQsc2V0Q2xpZW50UGF5bWVudEludm9pY2VHZW5lcmF0ZWRfY2FsbGJhY2ssIHNldENsaWVudFBheW1lbnRJbnZvaWNlR2VuZXJhdGVkX2NhbGxiYWNrKTsKZnVuY3Rpb24gc2V0Q2xpZW50UGF5bWVudEludm9pY2VHZW5lcmF0ZWRfY2FsbGJhY2soKQp7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKfQp9OwoKJHNjb3BlLnJlY2FsY1VzZXJCYWxhbmNlID0gZnVuY3Rpb24oKQp7CmxvZ0RlYnVnKCJyZWNhbGNVc2VyQmFsYW5jZSIpOwpyZWNhbGNVc2VyQmFsYW5jZSgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsIHJlY2FsY1VzZXJCYWxhbmNlX2NhbGxiYWNrKTsKZnVuY3Rpb24gcmVjYWxjVXNlckJhbGFuY2VfY2FsbGJhY2soKQp7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKfSAgICB9CiRzY29wZS51cGRhdGVFdmVudFBhY2thZ2VSZWZlcmVuY2UgPSBmdW5jdGlvbih1c2VyX2lkLCBmbWVldGluZykKewpsb2dEZWJ1ZygidXBkYXRlRXZlbnRQYWNrYWdlUmVmZXJlbmNlLCB1c2VyPSIrdXNlcl9pZCsiLCBmbWVldGluZz0iK0pTT04uc3RyaW5naWZ5KGZtZWV0aW5nKSk7CnZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewphbmltYXRpb246IGZhbHNlLAp0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9jbGllbnRfZXZlbnRfcGFja2FnZV9hc3NvY2lhdGlvbi5waHAnLApzaXplOiAneHMnLApjb250cm9sbGVyOiAnZXZlbnRQYWNrYWdlQXNzb2NpYXRpb25Nb2RhbENvbnRyb2xsZXInLCAgLy8gJ3BheW1lbnlEZXRhaWxzTW9kYWxDb250cm9sbGVyJywKcmVzb2x2ZTogewpmbWVldGluZzogZnVuY3Rpb24oKSB7CnJldHVybiBmbWVldGluZzsKfSwKYmFsYW5jZTogZnVuY3Rpb24oKSB7CnJldHVybiAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYmFsYW5jZTsKfSwKYnVzaW5lc3NfdXNlcl9pZDogZnVuY3Rpb24oKSB7CnJldHVybiAkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZDsKfQp9Cn0pOwp9OwoKJHNjb3BlLnVwZGF0ZVBhY2thZ2VQYXltZW50UmVmZXJlbmNlID0gZnVuY3Rpb24odXNlcl9pZCwgZnBhY2thZ2UpCnsKbG9nRGVidWcoInVwZGF0ZVBhY2thZ2VQYXltZW50UmVmZXJlbmNlLCB1c2VyPSIrdXNlcl9pZCsiLCBmcGFja2FnZT0iK0pTT04uc3RyaW5naWZ5KGZwYWNrYWdlKSk7CnZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewphbmltYXRpb246IGZhbHNlLAp0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9jbGllbnRfcGFja2FnZV9wYXltZW50X2Fzc29jaWF0aW9uLnBocCcsCnNpemU6ICd4cycsCmNvbnRyb2xsZXI6ICdwYWNrYWdlUGF5bWVudEFzc29jaWF0aW9uTW9kYWxDb250cm9sbGVyJywgIC8vICdwYXltZW55RGV0YWlsc01vZGFsQ29udHJvbGxlcicsCnJlc29sdmU6IHsKZnBhY2thZ2U6IGZ1bmN0aW9uKCkgewpyZXR1cm4gZnBhY2thZ2U7Cn0sCmJhbGFuY2U6IGZ1bmN0aW9uKCkgewpyZXR1cm4gJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLmJhbGFuY2U7Cn0sCmJ1c2luZXNzX3VzZXJfaWQ6IGZ1bmN0aW9uKCkgewpyZXR1cm4gJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQ7Cn0KfQp9KTsKfTsKCi8vIHNob3cgcGF5bWVudCBwb3B1cAokc2NvcGUuc2hvd1BheW1lbnREZXRhaWxzID0gZnVuY3Rpb24oZnBheW1lbnQpCnsKbG9nRGVidWcoInNob3dQYXltZW50RGV0YWlscyIpOwp2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKYW5pbWF0aW9uOiBmYWxzZSwKdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfY2xpZW50X3BheW1lbnRfZGV0YWlscy5waHAnLApzaXplOiAneHMnLApjb250cm9sbGVyOiAncGF5bWVueURldGFpbHNNb2RhbENvbnRyb2xsZXInLApyZXNvbHZlOiB7CmZwYXltZW50OiBmdW5jdGlvbigpIHsKcmV0dXJuIGZwYXltZW50Owp9Cn0KfSk7Cn0KJHNjb3BlLmludm9pY2VOdW1iZXJDaGFuZ2VkID0gZnVuY3Rpb24obmV3X2ludm9pY2VfbnVtYmVyLGZwYXltZW50KQp7CmxvZ0RlYnVnKCJpbnZvaWNlTnVtYmVyQ2hhbmdlZCAiKyBuZXdfaW52b2ljZV9udW1iZXIgKyJmb3IgIitKU09OLnN0cmluZ2lmeShmcGF5bWVudCkpOwpzZXRDbGllbnRQYXltZW50SW52b2ljZU51bWJlcigkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsZnBheW1lbnQudXNlcl9wYXltZW50X2lkLG5ld19pbnZvaWNlX251bWJlcixzZXRDbGllbnRQYXltZW50SW52b2ljZU51bWJlcl9jYWxsYmFjaywgc2V0Q2xpZW50UGF5bWVudEludm9pY2VOdW1iZXJfY2FsbGJhY2spOwpmdW5jdGlvbiBzZXRDbGllbnRQYXltZW50SW52b2ljZU51bWJlcl9jYWxsYmFjaygpCnsKLy8gJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwp9Cn07Cgokc2NvcGUuJG9uKCJjbGllbnRQYWdlUmVsb2FkRGF0YSIsZnVuY3Rpb24oZSxhKQp7CmxvZ0RlYnVnKCJjbGllbnRQYWdlUmVsb2FkRGF0YSIpOwpnZXRCdXNpbmVzc1VzZXJQYWNrYWdlcygkaHR0cCwkc2NvcGUsJ3VzZXJfcGFja2FnZXMnLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKZ2V0Q2xpZW50UGF5bWVudHMoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLCdjdXJyZW50Q2xpZW50UGF5bWVudHMnKTsKZ2V0Q2xpZW50RXZlbnRzKCRodHRwLCRzY29wZSwnY3VycmVudENsaWVudEV2ZW50cycsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwpnZXRCdXNpbmVzc0NsaWVudEluZm8oJGh0dHAsJHNjb3BlLCdmb3JtVXBkYXRlQ2xpZW50QW5ndWxhcicsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwoKICAgICAgLy8gJHRpbWVvdXQoZnVuY3Rpb24oKQogICAgICAvLyB7CiAgICAgIC8vICAgJHNjb3BlLmN1cnNvcmRlbGV0ZT0iIjsKICAgICAgLy8gICBkb2N1bWVudC5ib2R5LnN0eWxlLmN1cnNvcj0nJzsKICAgICAgLy8gfSwgMjAwMCk7Cgp9KTsKCiRzY29wZS5pc0NvbmZpcm1lZE9yQ2xvc2VkID0gZnVuY3Rpb24oZXZlbnQpCnsKaWYgKCRzY29wZS5zaG93QWxsRXZlbnRzKQp7CnJldHVybiB0cnVlOwp9CgppZiAoKGV2ZW50LmlzX2NvbmZpcm1lZCA9PSAxKSB8fCAoZXZlbnQuaXNfZmluYWxfc3RhdHVzID09IDEpIHx8ICgoZXZlbnQuaXNfd2FpdGluZ19saXN0ID09IDEpICYmIChldmVudC5pc19jYW5jZWxlZCA9PSAwKSkpCnsKcmV0dXJuIHRydWU7Cn0KZWxzZQp7CnJldHVybiBmYWxzZTsKfQp9CiRzY29wZS5nb3RvQ2xpZW50RWRpdFBhZ2U9Z290b0NsaWVudEVkaXRQYWdlOwokc2NvcGUuZ290b0JhY2s9ZnVuY3Rpb24oKQp7CmxvZ0RlYnVnKCdnbyBiYWNrJyk7CndpbmRvdy5oaXN0b3J5LmJhY2soKTsKfTsKCiRzY29wZS5nb3RvRXZlbnRQYWdlID0gZnVuY3Rpb24gKHRoZWV2ZW50KQp7CmdvdG9FdmVudFBhZ2UodGhlZXZlbnQpOwp9Cn0KJHNjb3BlLmluaXRpYXRlUGF5bWVudCA9IGZ1bmN0aW9uKGlzcGx1cykKewpsb2dEZWJ1ZygiaW5pdGlhdGVQYXltZW50IGlzcGx1cyIraXNwbHVzKTsKdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CmFuaW1hdGlvbjogZmFsc2UsCnRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2NsaWVudF9wYXltZW50LnBocCcsCmNvbnRyb2xsZXI6ICdidXNpbmVzc0NsaWVuZENhcmRQYXltZW50JywKLy8gc2l6ZTogc2l6ZSwKcmVzb2x2ZTogewpjdXJyZW50Q2xpZW50OiBmdW5jdGlvbigpIHsKcmV0dXJuICRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXTsKfSwKaXNwbHVzOiBmdW5jdGlvbigpIHsKcmV0dXJuIGlzcGx1czsKfQp9Cn0pOwp9Cgokc2NvcGUudXBkYXRlVXNlckZpcnN0TmFtZSA9IGZ1bmN0aW9uKG5ld1ZhbHVlKQp7CnNldENsaWVudEZpcnN0TmFtZSgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsbmV3VmFsdWUsYWZ0ZXJDbGllbnRTZXQsYWZ0ZXJDbGllbnRTZXQpOwpmdW5jdGlvbiBhZnRlckNsaWVudFNldCgpCnsKZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKfQp9CiRzY29wZS51cGRhdGVVc2VyTGFzdE5hbWUgPSBmdW5jdGlvbihuZXdWYWx1ZSkKewpzZXRDbGllbnRMYXN0TmFtZSgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsbmV3VmFsdWUsYWZ0ZXJDbGllbnRTZXQsYWZ0ZXJDbGllbnRTZXQpOwpmdW5jdGlvbiBhZnRlckNsaWVudFNldCgpCnsKZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKfQp9CiRzY29wZS51cGRhdGVVc2VyRW1haWwgPSBmdW5jdGlvbihuZXdWYWx1ZSkKewpzZXRDbGllbnRFbWFpbCgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsbmV3VmFsdWUsYWZ0ZXJzZXRDbGllbnRFbWFpbCxhZnRlcnNldENsaWVudEVtYWlsKTsKZnVuY3Rpb24gYWZ0ZXJzZXRDbGllbnRFbWFpbCgpCnsKZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKfQp9CgoKJHNjb3BlLnVwZGF0ZVVzZXJQaG9uZU51bWJlciA9IGZ1bmN0aW9uKG5ld1ZhbHVlKQp7Cm5ld1ZhbHVlID0gbmV3VmFsdWUucmVwbGFjZSgnLScsJycpOwppZiAoaXNOYU4obmV3VmFsdWUpKQp7CmFsZXJ0KCLXkNeg15Ag15TXltefINee16HXpNeoINeY15zXpNeV158g16rXp9eZ158iKTsKZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKfQplbHNlCnsKc2V0Q2xpZW50UGhvbmVOdW1iZXIoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLG5ld1ZhbHVlLHNldENsaWVudFBob25lTnVtYmVyX2NhbGxiYWNrLHNldENsaWVudFBob25lTnVtYmVyX2NhbGxiYWNrKTsKZnVuY3Rpb24gc2V0Q2xpZW50UGhvbmVOdW1iZXJfY2FsbGJhY2soKQp7CmdldEJ1c2luZXNzQ2xpZW50SW5mbygkaHR0cCwkc2NvcGUsJ2Zvcm1VcGRhdGVDbGllbnRBbmd1bGFyJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7Cn0KfQp9CiRzY29wZS51cGRhdGVVc2VyRXZlbnRQcmljZSA9IGZ1bmN0aW9uKG5ld3ZhbHVlLCB0aGVldmVudCkKewpuZXdfcHJpY2U9bmV3dmFsdWU7CnNldENsaWVudEV2ZW50UHJpY2UoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLHRoZWV2ZW50LmV2ZW50X2lkLCBuZXdfcHJpY2Usc2V0Q2xpZW50RXZlbnRQcmljZV9jYWxsYmFjaywgc2V0Q2xpZW50RXZlbnRQcmljZV9jYWxsYmFjayk7CmZ1bmN0aW9uIHNldENsaWVudEV2ZW50UHJpY2VfY2FsbGJhY2soKQp7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKfQp9OwoKJHNjb3BlLnVwZGF0ZVVzZXJQYWNrYWdlRXZlbnRzQ291bnRlciA9IGZ1bmN0aW9uKG5ld3ZhbHVlLCB0aGVwYWNrYWdlKQp7CmV2ZW50c19jb3VudGVyPW5ld3ZhbHVlOwpzZXRVc2VyUGFja2FnZUV2ZW50c0NvdW50ZXIoJGh0dHAsJHNjb3BlLHRoZXBhY2thZ2UucGFja2FnZV91c2VyX2lkLGV2ZW50c19jb3VudGVyLHNldFVzZXJQYWNrYWdlRXZlbnRzQ291bnRlcl9jYWxsYmFjaywgc2V0VXNlclBhY2thZ2VFdmVudHNDb3VudGVyX2NhbGxiYWNrKQpmdW5jdGlvbiBzZXRVc2VyUGFja2FnZUV2ZW50c0NvdW50ZXJfY2FsbGJhY2soKQp7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKfQp9Owokc2NvcGUudXBkYXRlVXNlclBhY2thZ2VQYWNrYWdlUHJpY2UgPSBmdW5jdGlvbihuZXd2YWx1ZSwgdGhlcGFja2FnZSkKewpwYWNrYWdlX3ByaWNlPW5ld3ZhbHVlOwpzZXRVc2VyUGFja2FnZVBhY2thZ2VQcmljZSgkaHR0cCwkc2NvcGUsdGhlcGFja2FnZS5wYWNrYWdlX3VzZXJfaWQscGFja2FnZV9wcmljZSxzZXRVc2VyUGFja2FnZVBhY2thZ2VQcmljZV9jYWxsYmFjaywgc2V0VXNlclBhY2thZ2VQYWNrYWdlUHJpY2VfY2FsbGJhY2spCmZ1bmN0aW9uIHNldFVzZXJQYWNrYWdlUGFja2FnZVByaWNlX2NhbGxiYWNrKCkKewovLyBnZXRCdXNpbmVzc1VzZXJQYWNrYWdlcygkaHR0cCwkc2NvcGUsJ3VzZXJfcGFja2FnZXMnLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwp9Cn07Cgokc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXIgPSB7fTsKbG9nRGVidWcoJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwokc2NvcGUuc2hvd19jbGllbnRfdXBkYXRlX2NsaWVudCA9IHRydWU7CiRzY29wZS5zaG93X2NsaWVudF91cGRhdGVfc2F2ZSA9IGZhbHNlOwokc2NvcGUuc2hvd19jbGllbnRfZGVsZXRlX2NsaWVudCA9IHRydWU7CiRzY29wZS5zaG93X2NsaWVudF91cGRhdGVfY2FuY2VsID0gZmFsc2U7Cgokc2NvcGUudXBkYXRlQ2xpZW50RW5hYmxlID0gZnVuY3Rpb24oKSB7CmxvZ0RlYnVnKCJlbmFibGluZyBlZGl0aW5nICgkc2NvcGUuY2xpZW50c1VwZGF0ZURpc2FibGVkIHdhcyAiICsgJHNjb3BlLmNsaWVudHNVcGRhdGVEaXNhYmxlZCArICIpIik7CiRzY29wZS5jbGllbnRzVXBkYXRlRGlzYWJsZWQgPSBmYWxzZTsKJHNjb3BlLnNob3dfY2xpZW50X3VwZGF0ZV9jbGllbnQgPSBmYWxzZTsKJHNjb3BlLnNob3dfY2xpZW50X3VwZGF0ZV9zYXZlID0gdHJ1ZTsKJHNjb3BlLnNob3dfY2xpZW50X2RlbGV0ZV9jbGllbnQgPSBmYWxzZTsKJHNjb3BlLnNob3dfY2xpZW50X3VwZGF0ZV9jYW5jZWwgPSB0cnVlOwp9CiRzY29wZS51cGRhdGVDbGllbnREaXNhYmxlID0gZnVuY3Rpb24oKSB7CmxvZ0RlYnVnKCJkaXNhYmxlIGVkaXRpbmciKTsKLy8JCSRsb2NhdGlvbi5wYXRoKCcvQ2xpZW50cy8nKyRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKJHJvdXRlLnJlbG9hZCgpOwp9CiRzY29wZS5zY2hlZHVsZUV2ZW50RnJvbUVuZFVzZXIgPSBmdW5jdGlvbigpIHsKc2hhcmVkRGF0YS5zZXRTZWxlY3RlZEVuZFVzZXIoewppZDogJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsCmZpcnN0X25hbWU6ICRzY29wZS5jdXJyZW50Q2xpZW50LnVzZXJzWzBdLmZpcnN0X25hbWUsCmxhc3RfbmFtZTogJHNjb3BlLmN1cnJlbnRDbGllbnQudXNlcnNbMF0ubGFzdF9uYW1lCn0pOwpsb2dEZWJ1Zygic2NoZWR1bGUgZXZlbnQgZm9yIHVzZXIgIiArICRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKLy8JCSRsb2NhdGlvbi5wYXRoKCcvQ2xpZW50cy8nKyRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jYWxlbmRhcicpOwp9CgogICAgJHNjb3BlLnVzZXJEZWxldGVQYXltZW50ID0gZnVuY3Rpb24gKGZwYXltZW50KQogICAgewogICAgICAvLyAkc2NvcGUuY3Vyc29yZGVsZXRlPSJ3YWl0IjsKICAgICAgbG9nRGVidWcoInVzZXJEZWxldGVQYXltZW50Iik7CiAgICAgIC8vIGRvY3VtZW50LmJvZHkuc3R5bGUuY3Vyc29yPSd3YWl0JzsKCiAgICAgIGRlbGV0ZUNsaWVudFBheW1lbnRzKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCxmcGF5bWVudC51c2VyX3BheW1lbnRfaWQsZGVsZXRlQ2xpZW50UGF5bWVudHNfc3VjY2Vzc19jYWxsYmFjayk7CiAgICAgIGZ1bmN0aW9uIGRlbGV0ZUNsaWVudFBheW1lbnRzX3N1Y2Nlc3NfY2FsbGJhY2soKQogICAgICB7CiAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgICAgIGxvZ0RlYnVnKCJ1c2VyRGVsZXRlUGF5bWVudCIpOwogICAgICAgIC8vICRzY29wZS5jdXJzb3JkZWxldGU9IiI7CiAgICAgICAgLy8gZG9jdW1lbnQuYm9keS5zdHlsZS5jdXJzb3I9Jyc7CiAgICAgIH0KICAgIH0KLy8gcmVtb3ZlIGVuZCB1c2VyIGZyb20gZXZlbnQKJHNjb3BlLnVzZXJEZWxldGVFdmVudCA9IGZ1bmN0aW9uKGVuZHVzZXJfaWQsIHRoZWV2ZW50KQp7Ci8vIGlmIGl0J3MgYSBjbGFzcyAtIHdlIHNpbXBseSByZW1vdmUgdGhlIHVzZXIgZnJvbSB0aGUgZXZlbnQKaWYgKHRoZWV2ZW50LmlzX2NsYXNzPT0xKQp7CmxvZ0RlYnVnKCJzY29wZS51c2VyRGVsZXRlRXZlbnQiKTsKcmVtb3ZlRW5kVXNlckZyb21FdmVudCgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsdGhlZXZlbnQuZXZlbnRfaWQscmVtb3ZlRW5kVXNlckZyb21FdmVudF9maW5pc2gsIHJlbW92ZUVuZFVzZXJGcm9tRXZlbnRfZmluaXNoKTsKZnVuY3Rpb24gcmVtb3ZlRW5kVXNlckZyb21FdmVudF9maW5pc2goKQp7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKfQp9Ci8vIGlmIGl0cyBub3QgYSBjbGFzcyAtIHdlIG5lZWQgdG8gcmVtb3ZlIHRoZSBldmVudCBpdHNlbGYKZWxzZQp7Ci8vIGFsZXJ0KCJub3QgY2xhc3MgZXZlbnQsIFRPRE8iKTsKfQp9OwoKLy8gcmV0cmV2aW5nIHBhY2thZ2VzIGZvciB0aGUgYnVzaW5lc3MKZ2V0QnVzaW5lc3NQYWNrYWdlcygkaHR0cCwkc2NvcGUsJ3BhY2thZ2VzJyk7CgovLyBnZXQgcGFja2FnZXMgZm9yIHRoaXMgc3BlY2lmaWMgdXNlcgpnZXRCdXNpbmVzc1VzZXJQYWNrYWdlcygkaHR0cCwkc2NvcGUsJ3VzZXJfcGFja2FnZXMnLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKLy8gYWRkaW5nIHBhY2thZ2UgdG8gdXNlciAtIGNhbGxlZCB3aGVuIGEgcGFja2FnZSBpcyBzZWxlY3RlZAokc2NvcGUucGFja2FnZUZvckNsaWVudFNlbGVjdGVkID0gZnVuY3Rpb24oc2VsZWN0ZWRQYWNrYWdlKSB7CmlmIChzZWxlY3RlZFBhY2thZ2UpIHsKLy8gbG9nRGVidWcoJ3llcyBzZWxlY3RlZCAnICsgSlNPTi5zdHJpbmdpZnkoc2VsZWN0ZWRQYWNrYWdlKSk7CmFkZEJ1c2luZXNzUGFja2FnZVRvVXNlcigkaHR0cCwkc2NvcGUsc2VsZWN0ZWRQYWNrYWdlLm9yaWdpbmFsT2JqZWN0LCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLGFkZEJ1c2luZXNzUGFja2FnZVN1Y2Nlc3MpOwpmdW5jdGlvbiBhZGRCdXNpbmVzc1BhY2thZ2VTdWNjZXNzKCkKewpsb2dEZWJ1ZygiYWRkQnVzaW5lc3NQYWNrYWdlU3VjY2VzczIiKTsKLy8gZ2V0QnVzaW5lc3NQYWNrYWdlcygkaHR0cCwkc2NvcGUsJ3BhY2thZ2VzJyk7Ci8vIGdldEJ1c2luZXNzVXNlclBhY2thZ2VzKCRodHRwLCRzY29wZSwndXNlcl9wYWNrYWdlcycsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwokcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NsaWVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCn0KJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdhbmd1Y29tcGxldGUtYWx0OmNsZWFySW5wdXQnLCAnY2xpZW50X2FuZ3Vjb21wbGV0ZScpOwp9CmVsc2UKewovLyBsb2dEZWJ1Zygnbm90IHNlbGVjdGVkLCBkbyBub3RoaW5nJyk7Cn0KfTsKfSk7CgoKLy8gTmVlZCB0byBkaXN0aW5ndWlzaCBiZXR3ZWVuIGVuZCB1c2VyIChjbGllbnQpIGFuZCBidXNpbmVzcyBvd25lci4KLy8gY3VycmVudGx5IGNhbGxzIG9ubHkgZW5kIHVzZXIKa3V6ZUFwcC5jb250cm9sbGVyKCdIb21lQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICR1aWJNb2RhbCkKewoKZ2V0QWxsQ2xpZW50cygkaHR0cCwkc2NvcGUsJ2FsbENsaWVudHMnKTsKCiRzY29wZS5ob21lcGFnZUxpbWl0PTY7CmdldE9wZW5lZEV2ZW50cygkaHR0cCwkc2NvcGUsJHNjb3BlLmhvbWVwYWdlTGltaXQsJ29wZW5lZF9ldmVudHMnKTsKCnZhciB0b2RheWRhdGUgPSBuZXcgRGF0ZSgpOwp2YXIgaG93bWFueWRheXNhaGVhZD0zMDsKdmFyIHN0YXJ0ZGF0ZT10b2RheWRhdGUuZ2V0RnVsbFllYXIoKSsiLSIrKDErdG9kYXlkYXRlLmdldE1vbnRoKCkpKyItIit0b2RheWRhdGUuZ2V0RGF0ZSgpOwp0b2RheWRhdGUuc2V0RGF0ZSh0b2RheWRhdGUuZ2V0RGF0ZSgpICsgaG93bWFueWRheXNhaGVhZCk7CnZhciBlbmRkYXRlPXRvZGF5ZGF0ZS5nZXRGdWxsWWVhcigpKyItIisoMSt0b2RheWRhdGUuZ2V0TW9udGgoKSkrIi0iK3RvZGF5ZGF0ZS5nZXREYXRlKCk7CgovLyBmaWx0ZXIgZm9yIHVzZXJzIHdobyBoYXZlIGRlYnQKJHNjb3BlLmhhdmVEZWJ0ID0gZnVuY3Rpb24oZXVzZXIpCnsKaWYgKGV1c2VyLnVzZXJfYmFsYW5jZSA8IDApCnsKcmV0dXJuIHRydWU7Cn0KZWxzZQp7CnJldHVybiBmYWxzZTsKfQp9OwoKJHNjb3BlLmdvdG9DbGllbnRQYWdlID0gZnVuY3Rpb24oYnVzaW5lc3NfdXNlcl9pZCkKewovLyBsb2dEZWJ1ZyhldXNlcik7CndpbmRvdy5sb2NhdGlvbi5ocmVmPScvIy9idXNpbmVzc19jbGllbnRzLycgKyBidXNpbmVzc191c2VyX2lkOwp9Cgp2YXIgcGF5bG9hZCA9ICdzdGFydD0nICsgc3RhcnRkYXRlICsgJyZlbmQ9JyArIGVuZGRhdGU7CnZhciBjb25maWcgPSB7CmhlYWRlcnM6IHsnQ29udGVudC1UeXBlJzonYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkOyBjaGFyc2V0PVVURi04J30KfQogICAgdmFyIHBvc3R1cmwgPSAiL2FwaS9hZG1pbi9yZXBvcnRzL2V2ZW50czIiOwoKICAgICRzY29wZS5ldmVudFJlcG9ydENvbmZpZyA9IHt9OwogICAgJHNjb3BlLmV2ZW50UmVwb3J0Q29uZmlnLnNvdXJjZSA9ICJkb2NzIjsKICAgICRzY29wZS5ldmVudFJlcG9ydENvbmZpZy5maWx0ZXJzID0gewogICAgICBzdGFydF9kYXRlOiBzdGFydGRhdGUsCiAgICAgIGlzX2NhbmNlbGVkOiAnMCcsCiAgICAgIGVuZF9kYXRlOiBlbmRkYXRlCiAgICB9OwoKICAgIGdldEV2ZW50c1JlcG9ydCgkaHR0cCwkc2NvcGUsICRzY29wZS5ldmVudFJlcG9ydENvbmZpZywgZ2V0RXZlbnRzUmVwb3J0QWdncmVnYXRlZF9zdWNjZXNzKTsKCiAgICBmdW5jdGlvbiBnZXRFdmVudHNSZXBvcnRBZ2dyZWdhdGVkX3N1Y2Nlc3MocmVzcG9uc2UpewogICAgICAkc2NvcGUuYWRtaW5fZXZlbnRzID0gcmVzcG9uc2UuanNvbjsKICAgICAgICB9CiAgICAvLyAkaHR0cC5wb3N0KHBvc3R1cmwsIHBheWxvYWQsIGNvbmZpZykuc3VjY2VzcyhmdW5jdGlvbihkYXRhKQogICAgLy8gewogICAgLy8gICBsb2dEZWJ1ZygiZG9uZSIpOwogICAgLy8gICAkc2NvcGUuYWRtaW5fZXZlbnRzID0gZGF0YTsKICAgIC8vIH0pOwoKJHNjb3BlLnNob3dFdmVudFBvcHVwID0gZnVuY3Rpb24oc2VsZWN0ZWRFdmVudCkgewpzaG93RXZlbnRQb3B1cChzZWxlY3RlZEV2ZW50LCAkdWliTW9kYWwpCn07CiRzY29wZS5lZGl0RXZlbnQ9IGZ1bmN0aW9uICh0aGVldmVudCkKewpnb3RvRXZlbnRQYWdlKHRoZWV2ZW50KTsKfQp9KTsKCi8vIGt1emVBcHAuY29udHJvbGxlcignQnVzaW5lc3NDb25maWdDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJHJvdXRlUGFyYW1zLCAkbG9jYXRpb24sICRyb3V0ZSwgc2hhcmVkRGF0YSkgewoKa3V6ZUFwcC5jb250cm9sbGVyKCdDb25maWdVc2VyQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHVpYk1vZGFsLCAkaHR0cCwgJHRpbWVvdXQpCnsKJHNjb3BlLmluVGhlTWlkZGxlT2ZTYXZlPWZhbHNlOwoKbG9nRGVidWcoIkNvbmZpZ1VzZXJDb250cm9sbGVyIik7Ci8vICRzY29wZS5hamF4X2luZm89IteU16nXmdeg15XXmdeZ150g16DXqdee16jXlSI7CgogIGdldEJ1c2luZXNzVXNlclJlbGF0aW9ucygkaHR0cCwkc2NvcGUsJ2J1c2luZXNzX3VzZXJfcmVsYXRpb25zJyxnZXRMb2dnZWRVc2VySW5mb19zdWNjZXNzLGdldExvZ2dlZFVzZXJJbmZvX2ZhaWx1cmUpOwoKZ2V0TG9nZ2VkVXNlckluZm8oJGh0dHAsJHNjb3BlLCd1c2VyUHJvcGVydGllcycsZ2V0TG9nZ2VkVXNlckluZm9fc3VjY2VzcyxnZXRMb2dnZWRVc2VySW5mb19mYWlsdXJlKTsKZnVuY3Rpb24gZ2V0TG9nZ2VkVXNlckluZm9fc3VjY2VzcygpCnsKbG9nRGVidWcoImdldExvZ2dlZFVzZXJJbmZvX3N1Y2Nlc3MiKTsKICAgIC8vICRzY29wZS51c2VyUHJvcGVydGllc0R1cGxpY2F0ZSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoJHNjb3BlLnVzZXJQcm9wZXJ0aWVzKSk7Cn0KZnVuY3Rpb24gZ2V0TG9nZ2VkVXNlckluZm9fZmFpbHVyZSgpCnsKbG9nRGVidWcoImdldExvZ2dlZFVzZXJJbmZvX2ZhaWx1cmUiKTsKfQoKJHNjb3BlLmJhY2sgPSBmdW5jdGlvbigpIHsKd2luZG93Lmhpc3RvcnkuYmFjaygpOwp9OwoKJHNjb3BlLmNoYW5nZVBhc3N3b3JkTW9kYWwgPSBmdW5jdGlvbigpCnsKICAgIGxvZ0RlYnVnKCJjaGFuZ2VQYXNzd29yZE1vZGFsIiskc2NvcGUudXNlclByb3BlcnRpZXNEdXBsaWNhdGVbMF0pOwokc2NvcGUuaW5UaGVNaWRkbGVPZlNhdmU9dHJ1ZTsKZnVuY3Rpb24gc21zUmVzZXRQYXNzd29yZF9zdWNjZXNzKCkKewpjb25zb2xlLmxvZygic21zUmVzZXRQYXNzd29yZF9zdWNjZXNzIik7CnZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewphbmltYXRpb246IGZhbHNlLAp0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdtb2RhbF9jaGFuZ2VfcGFzc3dvcmQucGhwJywKY29udHJvbGxlcjogJ21vZGFsX2NoYW5nZV9wYXNzd29yZCcsCnNpemU6ICdsJywKcmVzb2x2ZTogewp1c2VyX3Bob25lX251bWJlcjogZnVuY3Rpb24oKSB7Ci8vIHBhc3Npbmcgb3JpZ2luYWwgcGhvbmUgbnVtYmVyCnJldHVybiAkc2NvcGUudXNlclByb3BlcnRpZXNEdXBsaWNhdGVbMF0ucGhvbmVfbnVtYmVyOwp9Cn0KfSk7Cgptb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHJlc3VsdCkgewokc2NvcGUuaW5UaGVNaWRkbGVPZlNhdmU9ZmFsc2U7CmxvZ0RlYnVnKCdzbXNSZXNldFBhc3N3b3JkIE1vZGFsIGZpbmlzZWhkIHJlc3VsdDogJyArIHJlc3VsdCk7CiRzY29wZS5hamF4X2luZm89IteU16HXmdeh157XkCDXoteV15PXm9eg15Qg15HXlNem15zXl9eUISI7Ci8vIGdldExvZ2dlZFVzZXJJbmZvKCRodHRwLCRzY29wZSwndXNlclByb3BlcnRpZXMnLGdldExvZ2dlZFVzZXJJbmZvX3N1Y2Nlc3MsZ2V0TG9nZ2VkVXNlckluZm9fZmFpbHVyZSk7CiR0aW1lb3V0KGZ1bmN0aW9uKCkKewokc2NvcGUuYWpheF9pbmZvPW51bGw7Cn0sIDIwMDApOwpsb2dEZWJ1Zygnc21zUmVzZXRQYXNzd29yZCBNb2RhbCBkaXNtaXNzZWQgYXQ6ICcgKyBuZXcgRGF0ZSgpKTsKfSwgZnVuY3Rpb24oKSB7CiRzY29wZS5pblRoZU1pZGRsZU9mU2F2ZT1mYWxzZTsKbG9nRGVidWcoJ21vZGFsX2NoYW5nZV9wYXNzd29yZCBNb2RhbCBkaXNtaXNzZWQgYXQ6ICcgKyBuZXcgRGF0ZSgpKTsKfSk7Cn0KCgpjaGFuZ2VQYXNzd29yZFNNUygkaHR0cCwkc2NvcGUsJHNjb3BlLnVzZXJQcm9wZXJ0aWVzRHVwbGljYXRlWzBdLnBob25lX251bWJlcixzbXNSZXNldFBhc3N3b3JkX3N1Y2Nlc3MpOwp9CiRzY29wZS51cGRhdGVVc2VyQ29uZmlnPWZ1bmN0aW9uKCkKewokc2NvcGUuaW5UaGVNaWRkbGVPZlNhdmU9dHJ1ZTsKbG9nRGVidWcoInVwZGF0ZVVzZXJDb25maWcsIGluVGhlTWlkZGxlT2ZTYXZlPSIrJHNjb3BlLmluVGhlTWlkZGxlT2ZTYXZlKTsKLy8gbG9nRGVidWcoJHNjb3BlLnVzZXJQcm9wZXJ0aWVzRHVwbGljYXRlKTsKLy8gbG9nRGVidWcoJHNjb3BlLnVzZXJQcm9wZXJ0aWVzKTsKaWYgKGFuZ3VsYXIuZXF1YWxzKCRzY29wZS51c2VyUHJvcGVydGllc0R1cGxpY2F0ZVswXS5waG9uZV9udW1iZXIsJHNjb3BlLnVzZXJQcm9wZXJ0aWVzWzBdLnBob25lX251bWJlcikpCnsKbG9nRGVidWcoIm5vdGhpbmcgY2hhbmdlZCBpbiBwaG9uZSBudW1iZXIsIGNoZWNraW5nIG90aGVyIGRhdGEgb3RoZXIgZGF0YSIpOwppZiAoYW5ndWxhci5lcXVhbHMoJHNjb3BlLnVzZXJQcm9wZXJ0aWVzRHVwbGljYXRlWzBdLCRzY29wZS51c2VyUHJvcGVydGllc1swXSkpCnsKJHNjb3BlLmluVGhlTWlkZGxlT2ZTYXZlPWZhbHNlOwpsb2dEZWJ1Zygibm90aGluZyBjaGFuZ2VkIGluIGRldGFpbHMsIG5vdGhpbmcgdG8gc2F2ZSIpOwokc2NvcGUuYWpheF9pbmZvPSLXnNeQINeR15XXptei15Ug16nXmdeg15XXmdeZ150g15zXqdee15nXqNeULi4uIjsKJHRpbWVvdXQoZnVuY3Rpb24oKQp7CiRzY29wZS5hamF4X2luZm89bnVsbDsKfSwgMTUwMCk7Cn0KZWxzZQp7CmNoYW5nZVVzZXJEZXRhaWxzKCRodHRwLCRzY29wZSwkc2NvcGUudXNlclByb3BlcnRpZXNbMF0uZmlyc3RfbmFtZSwkc2NvcGUudXNlclByb3BlcnRpZXNbMF0ubGFzdF9uYW1lLCAkc2NvcGUudXNlclByb3BlcnRpZXNbMF0uZW1haWxfYWRkcmVzcyxjaGFuZ2VVc2VyRGV0YWlsc19zdWNjZXNzLCBjaGFuZ2VVc2VyRGV0YWlsc19mYWlsdXJlKTsKJHNjb3BlLmFqYXhfaW5mbz0i157XoteT15vXnyDXqdeZ16DXldeZ15nXnS4uLiI7Cn0KCmZ1bmN0aW9uIGNoYW5nZVVzZXJEZXRhaWxzX3N1Y2Nlc3MoKQp7CmxvZ0RlYnVnKCJjaGFuZ2VVc2VyRGV0YWlsc19zdWNjZXNzIik7CiRzY29wZS5hamF4X2luZm89IteU16nXmdeg15XXmdeZ150g16DXqdee16jXlSDXkdeU16bXnNeX15QhIjsKJHNjb3BlLmluVGhlTWlkZGxlT2ZTYXZlPWZhbHNlOwokdGltZW91dChmdW5jdGlvbigpCnsKJHNjb3BlLmFqYXhfaW5mbz1udWxsOwp9LCAxNTAwKTsKZ2V0TG9nZ2VkVXNlckluZm8oJGh0dHAsJHNjb3BlLCd1c2VyUHJvcGVydGllcycsZ2V0TG9nZ2VkVXNlckluZm9fc3VjY2VzcyxnZXRMb2dnZWRVc2VySW5mb19mYWlsdXJlKTsKfQpmdW5jdGlvbiBjaGFuZ2VVc2VyRGV0YWlsc19mYWlsdXJlKCkKewpsb2dEZWJ1ZygiY2hhbmdlVXNlckRldGFpbHNfZmFpbHVyZSIpOwp9Cgp9CmVsc2UKewovLyB1cGRhdGUgdXNlciBpbmZvIC0gYWZ0ZXIgdmVyaWZ5aW5nIHBhc3N3b3JkCmNvbnNvbGUubG9nKCJwaG9uZSBjaGFuZ2VkLCBjaGVja2luZyBpZiBuZXcgcGhvbmUgaXMgaW4gZGVzY2VudCBmb3JtYXQiKTsKaWYgKCFjaGVja1Bob25lTnVtYmVyKCRzY29wZS51c2VyUHJvcGVydGllc1swXS5waG9uZV9udW1iZXIpKQp7CiRzY29wZS5hamF4X2luZm89IteQ16DXkCDXlNeW158g157Xodek16gg15jXnNek15XXnyDXodec15XXnNeo15kg16rXp9eZ158g15zXp9eR15zXqiDXlNeV15PXoteV16og157Xp9eZ15XXli4iOwokdGltZW91dChmdW5jdGlvbigpCnsKJHNjb3BlLmFqYXhfaW5mbz1udWxsOwp9LCAzMDAwKTsKcmV0dXJuOwp9CmNvbnNvbGUubG9nKCJwaG9uZSBjaGFuZ2VkLCBjaGVja2luZyBpZiBuZXcgcGhvbmUgaXMgbm90IHVzZWQgYWxyZWFkeSIpOwppc05ld1Bob25lVXNlZElmTm90U2VuZFNNUygkaHR0cCwkc2NvcGUsJHNjb3BlLnVzZXJQcm9wZXJ0aWVzWzBdLnBob25lX251bWJlciwgaXNOZXdQaG9uZVVzZWRfc3VjY2VzcywgaXNOZXdQaG9uZVVzZWRfZmFpbHVyZSxmYWxzZSk7CmZ1bmN0aW9uIGlzTmV3UGhvbmVVc2VkX3N1Y2Nlc3MocmVzcG9uc2UpCnsKY29uc29sZS5sb2coInBob25lIG5vdCB1c2VkIC0gcHJvbXB0aW5nIGZvciBwYXNzd29yZCIpOwp2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKYW5pbWF0aW9uOiBmYWxzZSwKdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnbW9kYWxfY2hlY2tfcGFzc3dvcmRfdXBkYXRlX2NvbmZpZy5waHAnLApjb250cm9sbGVyOiAnbW9kYWxfY2hlY2tfcGFzc3dvcmRfdXBkYXRlX2NvbmZpZycsCnNpemU6ICdsJywKcmVzb2x2ZTogewpuZXdfdXNlcl9wcm9lcnRpZXM6IGZ1bmN0aW9uKCkgewpyZXR1cm4gJHNjb3BlLnVzZXJQcm9wZXJ0aWVzWzBdOwp9Cn0KfSk7Cgptb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHJlc3VsdCkgewpsb2dEZWJ1ZygnbW9kYWxfY2hlY2tfcGFzc3dvcmRfdXBkYXRlX2NvbmZpZyBNb2RhbCBmaW5pc2hlZCByZXN1bHQ6ICcgKyByZXN1bHQpOwokc2NvcGUuYWpheF9pbmZvPSLXlNep15nXoNeV15nXmdedINeg16nXnteo15Ug15HXlNem15zXl9eUISI7CiRzY29wZS5pblRoZU1pZGRsZU9mU2F2ZT1mYWxzZTsKZ2V0TG9nZ2VkVXNlckluZm8oJGh0dHAsJHNjb3BlLCd1c2VyUHJvcGVydGllcycsZ2V0TG9nZ2VkVXNlckluZm9fc3VjY2VzcyxnZXRMb2dnZWRVc2VySW5mb19mYWlsdXJlKTsKJHRpbWVvdXQoZnVuY3Rpb24oKQp7CiRzY29wZS5hamF4X2luZm89bnVsbDsKfSwgMzAwMCk7Cn0sIGZ1bmN0aW9uKCkgewokc2NvcGUuaW5UaGVNaWRkbGVPZlNhdmU9ZmFsc2U7CmxvZ0RlYnVnKCdtb2RhbF9jaGVja19wYXNzd29yZF91cGRhdGVfY29uZmlnIE1vZGFsIGRpc21pc3NlZCBhdDogJyArIG5ldyBEYXRlKCkpOwp9KTsKfQoKZnVuY3Rpb24gaXNOZXdQaG9uZVVzZWRfZmFpbHVyZShyZXNwb25zZSkKewokc2NvcGUuYWpheF9pbmZvPXJlc3BvbnNlLm1lc3NhZ2U7CiR0aW1lb3V0KGZ1bmN0aW9uKCkKewokc2NvcGUuYWpheF9pbmZvPW51bGw7Cn0sIDIwMDApOwp9Cn0KfTsKfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdtb2RhbF9jaGVja19wYXNzd29yZF91cGRhdGVfY29uZmlnJywgZnVuY3Rpb24oJHNjb3BlLCAkdGltZW91dCwgJHVpYk1vZGFsSW5zdGFuY2UsIG5ld191c2VyX3Byb2VydGllcywgJGh0dHApCnsKJHNjb3BlLm5ld191c2VyX3Byb2VydGllcz1uZXdfdXNlcl9wcm9lcnRpZXM7CmxvZ0RlYnVnKCJtb2RhbF9jaGVja19wYXNzd29yZF91cGRhdGVfY29uZmlnIGNvbnRyb2xsZXIiKTsKLy8gJHNjb3BlLnBob25lX3ZlcmlmaWNhdGlvbiA9IHt9OyAvLyB0aGVzZSBhcmUgdGhlIGNvbXBsZXRlIGRldGFpbHMgZm9yIHRoZSBuZXcgZXZlbnQgLy8KLy8gJHNjb3BlLnBob25lX3ZlcmlmaWNhdGlvbi5waG9uZV9udW1iZXI9bmV3X3VzZXJfcHJvZXJ0aWVzLnBob25lX251bWJlcjsKJHNjb3BlLmNsb3NlID0gZnVuY3Rpb24oKSB7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCdkaXNtaXNzJyk7Cn07Cgokc2NvcGUuY2hhbmdlUGhvbmVOdW1iZXIgPSBmdW5jdGlvbigpCnsKY2hhbmdlVXNlckRldGFpbHNWZXJpZnkoJGh0dHAsJHNjb3BlLCRzY29wZS5uZXdfdXNlcl9wcm9lcnRpZXMucGhvbmVfbnVtYmVyLCRzY29wZS5uZXdfdXNlcl9wcm9lcnRpZXMuZmlyc3RfbmFtZSwkc2NvcGUubmV3X3VzZXJfcHJvZXJ0aWVzLmxhc3RfbmFtZSwgJHNjb3BlLm5ld191c2VyX3Byb2VydGllcy5lbWFpbF9hZGRyZXNzLCRzY29wZS52ZXJpZnlfdXNlcl9wYXNzd29yZCwkc2NvcGUucGhvbmVfdmVyaWZpY2F0aW9uLGNoYW5nZVVzZXJEZXRhaWxzVmVyaWZ5X3N1Y2Nlc3MsIGNoYW5nZVVzZXJEZXRhaWxzVmVyaWZ5X2ZhaWx1cmUsZmFsc2UpOwpmdW5jdGlvbiBjaGFuZ2VVc2VyRGV0YWlsc1ZlcmlmeV9zdWNjZXNzKCkKewpsb2dEZWJ1ZygiY2hhbmdlVXNlckRldGFpbHNWZXJpZnlfc3VjY2VzcyIpOwovLyBhbGVydCgn15TXqdeZ16DXldeZ15nXnSDXoteV15PXm9eg15Ug15HXlNem15zXl9eUJyk7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKHRydWUpOwp9CmZ1bmN0aW9uIGNoYW5nZVVzZXJEZXRhaWxzVmVyaWZ5X2ZhaWx1cmUocmVzcG9uc2UpCnsKbG9nRGVidWcoImNoYW5nZVVzZXJEZXRhaWxzVmVyaWZ5X2ZhaWx1cmUgIityZXNwb25zZS5tZXNzYWdlKTsKJHNjb3BlLmFqYXhfZXJyb3I9cmVzcG9uc2UubWVzc2FnZSsiLiI7CiR0aW1lb3V0KGZ1bmN0aW9uKCkKewokc2NvcGUuYWpheF9lcnJvcj1udWxsOwp9LCA0MDAwKTsKfQp9Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignbW9kYWxfY2hhbmdlX3Bhc3N3b3JkJywgZnVuY3Rpb24oJHNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgdXNlcl9waG9uZV9udW1iZXIsICRodHRwKQp7CmxvZ0RlYnVnKCJtb2RhbF9jaGFuZ2VfcGFzc3dvcmQgY29udHJvbGxlciIpOwokc2NvcGUucGhvbmVfdmVyaWZpY2F0aW9uID0ge307IC8vIHRoZXNlIGFyZSB0aGUgY29tcGxldGUgZGV0YWlscyBmb3IgdGhlIG5ldyBldmVudCAvLwokc2NvcGUucGhvbmVfdmVyaWZpY2F0aW9uLnBob25lX251bWJlcj11c2VyX3Bob25lX251bWJlcjsKJHNjb3BlLnBob25lX3ZlcmlmaWNhdGlvbi5zbXNfZXJyb3I9IiI7CiRzY29wZS5jbG9zZSA9IGZ1bmN0aW9uKCkgewokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnZGlzbWlzcycpOwp9OwoKJHNjb3BlLmNoYW5nZVBhc3N3b3JkID0gZnVuY3Rpb24oKQp7CmNoYW5nZVBhc3N3b3JkKCRodHRwLCRzY29wZSwkc2NvcGUucGhvbmVfdmVyaWZpY2F0aW9uLnVzZXJfcGFzc3dvcmQsJHNjb3BlLnBob25lX3ZlcmlmaWNhdGlvbi51c2VyX3Bhc3N3b3JkMiwkc2NvcGUucGhvbmVfdmVyaWZpY2F0aW9uLnZlcmlmaWNhdGlvbl9jb2RlLCBjaGFuZ2VQYXNzd29yZF9zdWNjZXNzLCBjaGFuZ2VQYXNzd29yZF9mYWlsdXJlLGZhbHNlKTsKJHNjb3BlLmFqYXhfZXJyb3I9IiI7CmZ1bmN0aW9uIGNoYW5nZVBhc3N3b3JkX3N1Y2Nlc3MoKQp7CmxvZ0RlYnVnKCJjaGFuZ2VQYXNzd29yZF9zdWNjZXNzIik7CnN0YXR1cz0iZmZmZmYiOwovLyBhbGVydCgn15TXodeZ16HXnteQINei15XXk9eb16DXlCDXkdeU16bXnNeX15QnKTsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UodHJ1ZSk7Cn0KZnVuY3Rpb24gY2hhbmdlUGFzc3dvcmRfZmFpbHVyZShyZXNwb25zZSkKewpsb2dEZWJ1ZygiY2hhbmdlUGFzc3dvcmRfZmFpbHVyZSAiK3Jlc3BvbnNlLm1lc3NhZ2UpOwokc2NvcGUuYWpheF9lcnJvcj1yZXNwb25zZS5tZXNzYWdlOwp9Cn0KfSk7CgprdXplQXBwLmZhY3RvcnkoJ0J1c2luZXNzQ29uZmlnJywgZnVuY3Rpb24oJGh0dHApIHsKcmV0dXJuIHsKZ2V0OiBmdW5jdGlvbiAoKSB7CmxvZ0RlYnVnKCJsb2FkIGdldF9idXNpbmVzc19jb25maWciKTsKcmV0dXJuICRodHRwLmdldCgiL2FwaS9hZG1pbi9idXNpbmVzc19jb25maWciKQoudGhlbihmdW5jdGlvbihyZXNwb25zZSkgewpyZXN1bHQgPSByZXNwb25zZS5kYXRhWzBdOwpyZXN1bHQudXNlX2hvbGlkYXlzPSEhcGFyc2VJbnQocmVzcG9uc2UuZGF0YVswXS51c2VfaG9saWRheXMpOwpyZXN1bHQuc21zX25vdGlmaWNhdGlvbnM9ISFwYXJzZUludChyZXNwb25zZS5kYXRhWzBdLnNtc19ub3RpZmljYXRpb25zKTsKcmVzdWx0LnN0YXJ0X2ludm9pY2VfbnVtYmVyID0gcGFyc2VJbnQocmVzcG9uc2UuZGF0YVswXS5zdGFydF9pbnZvaWNlX251bWJlcik7CnZhciBkID0gbmV3IERhdGUoKTsKZC5zZXRIb3VycyggcmVzdWx0LmNhbGVuZGFyX2Rpc3BsYXlfc3RhcnRfaG91cnMgKTsKZC5zZXRNaW51dGVzKCByZXN1bHQuY2FsZW5kYXJfZGlzcGxheV9zdGFydF9taW51dGVzICk7CnJlc3VsdC5teXRpbWUgPSBkOwpyZXN1bHQuY2FsZW5kYXJfZGlzcGxheV9zdGFydCA9IGQ7CnZhciBkID0gbmV3IERhdGUoKTsKZC5zZXRIb3VycyggcmVzdWx0LmNhbGVuZGFyX2Rpc3BsYXlfZW5kX2hvdXJzICk7CmQuc2V0TWludXRlcyggcmVzdWx0LmNhbGVuZGFyX2Rpc3BsYXlfZW5kX21pbnV0ZXMgKTsKcmVzdWx0Lm15dGltZSA9IGQ7CnJlc3VsdC5jYWxlbmRhcl9kaXNwbGF5X2VuZCA9IGQ7CnJlc3VsdC52YXRfcmF0ZSA9IE51bWJlcihyZXN1bHQudmF0X3JhdGUpOwpyZXR1cm4gcmVzdWx0Owp9KTsKfQp9Owp9KTsKCmt1emVBcHAuY29udHJvbGxlcignQ29uZmlnQnVzaW5lc3NDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJHRpbWVvdXQsIEJ1c2luZXNzQ29uZmlnKQp7CmxvZ0RlYnVnKCJteSBidXNpbmVzcyBjb25maWciKTsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXM9W107CgpmdW5jdGlvbiBnZXRfYnVzaW5lc3NfY29uZmlnKCkgewpsb2dEZWJ1ZygiZ2V0X2J1c2luZXNzX2NvbmZpZyIpOwpsb2dEZWJ1ZygiQnVzaW5lc3NDb25maWc6ICIsIEJ1c2luZXNzQ29uZmlnKTsKQnVzaW5lc3NDb25maWcuZ2V0KCkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7ICRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMgPSByZXN1bHQ7IH0pOwp9CmdldF9idXNpbmVzc19jb25maWcoKTsKCgokc2NvcGUuaHN0ZXAgPSAxOwokc2NvcGUubXN0ZXAgPSAxNTsKCiRzY29wZS5idXNpbmVzc0NvbmZpZ0NhbmNlbCA9IGZ1bmN0aW9uKCkgewp3aW5kb3cuaGlzdG9yeS5iYWNrKCk7Cn07Cgokc2NvcGUudXBkYXRlQnVzaW5lc3NDb25maWcgPSBmdW5jdGlvbigpIHsKbG9nRGVidWcoInVwZGF0aW5nIGJ1c2luZXNzIGNvbmZpZyIgKyBKU09OLnN0cmluZ2lmeSgkc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzKSk7Cgokc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzX2FqYXhfZXJyb3I9IiI7CiRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMuY2FsZW5kYXJfZGlzcGxheV9zdGFydF9ob3Vycz0kc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzLmNhbGVuZGFyX2Rpc3BsYXlfc3RhcnQuZ2V0SG91cnMoKTsKJHNjb3BlLmJ1c2luZXNzUHJvcGVydGllcy5jYWxlbmRhcl9kaXNwbGF5X3N0YXJ0X21pbnV0ZXM9JHNjb3BlLmJ1c2luZXNzUHJvcGVydGllcy5jYWxlbmRhcl9kaXNwbGF5X3N0YXJ0LmdldE1pbnV0ZXMoKTsKJHNjb3BlLmJ1c2luZXNzUHJvcGVydGllcy5jYWxlbmRhcl9kaXNwbGF5X2VuZF9ob3Vycz0kc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzLmNhbGVuZGFyX2Rpc3BsYXlfZW5kLmdldEhvdXJzKCk7CiRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMuY2FsZW5kYXJfZGlzcGxheV9lbmRfbWludXRlcz0kc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzLmNhbGVuZGFyX2Rpc3BsYXlfZW5kLmdldE1pbnV0ZXMoKTsKaWYgKCRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMuY2FsZW5kYXJfZGlzcGxheV9zdGFydF9ob3Vycz4kc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzLmNhbGVuZGFyX2Rpc3BsYXlfZW5kX2hvdXJzKQp7CmFsZXJ0KCfXltee158g16HXmdeV150g15zXkCDXmdeb15XXnCDXnNeU15nXldeqINec16TXoNeZINeW157XnyDXlNeq15fXnNeUJyk7CnJldHVybjsKfQokc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzX2FqYXhfZXJyb3I9Itee16LXk9eb158g16DXqteV16DXmdedLi4uIjsKCiRodHRwKHsKbWV0aG9kOiAnUE9TVCcsCnVybDogJy9hcGkvYWRtaW4vYnVzaW5lc3NfY29uZmlnL3NldCcsCmRhdGE6ICRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMsIC8vIHBhc3MgaW4gZGF0YSBhcyBzdHJpbmdzCmhlYWRlcnM6IHsKJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uO2NoYXJzZXQ9dXRmLTgnCn0KfSkuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7Cgpsb2dEZWJ1ZyhkYXRhKTsKaWYgKCFkYXRhLnN1Y2Nlc3MpIHsKbG9nRGVidWcoImVycm9yICIgKyBkYXRhLk1lc3NhZ2UpOwokc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzX2FqYXhfZXJyb3IgPSBkYXRhLk1lc3NhZ2U7Cn0gZWxzZSB7CiRnQ2FsZW5kYXJEaXNwbGF5TWluVGltZT1kYXRhLmpzb24ubmV3U3RhcnRUaW1lOwokZ0NhbGVuZGFyRGlzcGxheU1heFRpbWU9ZGF0YS5qc29uLm5ld0VuZFRpbWU7CmNvbnNvbGUubG9nKCJ1cGRhdGVkIGdDYWxlbmRhckRpc3BsYXlNaW5UaW1lPSIrJGdDYWxlbmRhckRpc3BsYXlNaW5UaW1lKTsKY29uc29sZS5sb2coInVwZGF0ZWQgZ0NhbGVuZGFyRGlzcGxheU1heFRpbWU9IiskZ0NhbGVuZGFyRGlzcGxheU1heFRpbWUpOwokc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzX2FqYXhfZXJyb3I9Itei15XXk9eb158g15HXlNem15zXl9eUISI7CiR0aW1lb3V0KGZ1bmN0aW9uKCkKewokc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzX2FqYXhfZXJyb3I9bnVsbDsKfSwgMjAwMCk7CmdldF9idXNpbmVzc19jb25maWcoKTsKLy8gd2luZG93Lmhpc3RvcnkuYmFjaygpOwovLyAkc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzX2FqYXhfZXJyb3IgPSAi16TXqNeY15kg15TXoteh16cg16DXqdee16jXlSDXkdeU16bXnNeX15QuIjsKCn0KfSk7Cn07Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignY2xpZW50Q2FyZENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUpIHsKbG9nRGVidWcoImNsaWVudENhcmRDb250cm9sbGVyIik7CiRzY29wZS5mdXR1cmVNZWV0aW5ncyA9IFt7CmRhdGV0aW1lOiAi16jXkNep15XXnywgMjUuMS4yMDE2IiwKaG91cjogIjE0OjAwIiwKdHlwZTogIten15HXldem15QiLApwcmljZTogIjEwMCIsCmxhYmVsczogW3sKbGFiZWw6ICJzdWNjZXNzIiwKdGV4dDogItep15XXnNedIgp9LCB7CmxhYmVsOiAid2FybmluZyIsCnRleHQ6ICLXnNeQINeq15XXoteTIgp9XQp9LCB7CmRhdGV0aW1lOiAi16jXkNep15XXnywgMjUuMS4yMDE2IiwKaG91cjogIjE0OjAwIiwKdHlwZTogIten15HXldem15QiLApwcmljZTogIjEwMCIsCmxhYmVsczogW3sKbGFiZWw6ICJkYW5nZXIiLAp0ZXh0OiAi15zXkCDXqdeV15zXnSIKfSwgewpsYWJlbDogImluZm8iLAp0ZXh0OiAi16rXldei15MiCn1dCn0sIHsKZGF0ZXRpbWU6ICLXqdec15nXqdeZLCAyNS4xLjIwMTYiLApob3VyOiAiMTQ6MDAiLAp0eXBlOiAi16fXkdeV16bXlCIsCnByaWNlOiAiMTAwIiwKbGFiZWxzOiBbewpsYWJlbDogImRhbmdlciIsCnRleHQ6ICLXnNeQINep15XXnNedIgp9LCB7CmxhYmVsOiAiaW5mbyIsCnRleHQ6ICLXqteV16LXkyIKfV0KfSwgewpkYXRldGltZTogIteo15DXqdeV158sIDI1LjEuMjAxNiIsCmhvdXI6ICIxNDowMCIsCnR5cGU6ICLXp9eR15XXpteUIiwKcHJpY2U6ICIxMDAiCn0sIF0KCiRzY29wZS5oaXN0b3J5TWVldGluZ3MgPSBbewpkYXRldGltZTogIteo15DXqdeV158sIDI1LjEuMjAxNiIsCmhvdXI6ICIxNDowMCIsCnR5cGU6ICLXp9eR15XXpteUIiwKcHJpY2U6ICIxMDAiCn0sIHsKZGF0ZXRpbWU6ICLXqNeQ16nXldefLCAyNS4xLjIwMTYiLApob3VyOiAiMTQ6MDAiLAp0eXBlOiAi16fXkdeV16bXlCIsCnByaWNlOiAiMTAwIgp9LCB7CmRhdGV0aW1lOiAi16nXnNeZ16nXmSwgMjUuMS4yMDE2IiwKaG91cjogIjE0OjAwIiwKdHlwZTogIten15HXldem15QiLApwcmljZTogIjEwMCIKfSwgewpkYXRldGltZTogIteo15DXqdeV158sIDI1LjEuMjAxNiIsCmhvdXI6ICIxNDowMCIsCnR5cGU6ICLXp9eR15XXpteUIiwKcHJpY2U6ICIxMDAiCn0sIF0KCiRzY29wZS5jY1BheW1lbnRzID0gW3sKZGF0ZXRpbWU6ICLXqNeQ16nXldefLCAyNS4xLjIwMTYiLApyZWNpcHRfbnVtOiAiNzY3IiwKYW1vdW50OiAiMzAwIiwKbGFiZWxzOiBbewpsYWJlbDogImRhbmdlciIsCnRleHQ6ICLXnNeQINep15XXmdeZ15oiCn0sIHsKbGFiZWw6ICJpbmZvIiwKdGV4dDogIteU15XXpNen15MiCn1dCn0sIF0KCgp9KTsKCmt1emVBcHAuY29udHJvbGxlcigna3V6ZUNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkbG9jYXRpb24pIHsKCi8vIG1haW4ga3V6ZSBjb250cm9sbGVyCgovLyBNVVNUIFNFVCBMQU5HVUFHRSBCRUZPUkUgQU5ZIE9USEVSIE9QRVJBVElPTiAhISEKdXBkYXRlR2xvYmFsTGFuZ3VhZ2UoJHNjb3BlLCAkZ0RlZmF1bHRMYW5nKTsKLy8gTVVTVCBTRVQgTEFOR1VBR0UgQkVGT1JFIEFOWSBPVEhFUiBPUEVSQVRJT04gISEhCgovLyBsb2dEZWJ1ZygieHh4eHh4eHgiICsgJHNjb3BlLmxhbmdmaWxlWydzaG93X2FsbF9jbGllbnRzJ10pOwoKJHNjb3BlLnNob3dDbGllbnRzQ29sdW1ucyA9IFt7CmZpZWxkOiAndXNlcl9pZCcsCm5hbWU6ICRzY29wZS5sYW5nZmlsZVsnc2hvd19hbGxfY2xpZW50c191c2VyaWQnXQp9LCB7CmZpZWxkOiAnYnVzZXJfZmlyc3RfbmFtZScsCm5hbWU6ICRzY29wZS5sYW5nZmlsZVsnc2hvd19hbGxfY2xpZW50c19maXJzdF9uYW1lJ10KfSwgewpmaWVsZDogJ2J1c2VyX2xhc3RfbmFtZScsCm5hbWU6ICRzY29wZS5sYW5nZmlsZVsnc2hvd19hbGxfY2xpZW50c19sYXN0X25hbWUnXQp9LCB7CmZpZWxkOiAncm9sZV9uYW1lJywKbmFtZTogJHNjb3BlLmxhbmdmaWxlWydzaG93X2FsbF9jbGllbnRzX2FwcHJvdmVkJ10KfV07CgoKJHNjb3BlLmdyaWRDbGllbnRDbGljayA9IGZ1bmN0aW9uKHJvdykgewovL2xvZ0RlYnVnKHJvdyk7CnZhciByb3dfdXNlcmlkID0gcm93LmVudGl0eS51c2VyX2lkOwpsb2dEZWJ1Zygic2VsZWN0ZWQgcm93IHVzZXJfaWQgPSIgKyByb3dfdXNlcmlkKTsKJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jbGllbnRzLycgKyByb3dfdXNlcmlkKTsKfTsKCiRzY29wZS5zaG93Q2xpZW50c0dyaWRPcHRpb25zID0gewplbmFibGVGaWx0ZXJpbmc6IGZhbHNlLAplbmFibGVTb3J0aW5nOiB0cnVlLApjb2x1bW5EZWZzOiAkc2NvcGUuc2hvd0NsaWVudHNDb2x1bW5zLApyb3dUZW1wbGF0ZTogJy9wdWJsaWMvY29tcG9uZW50cy9jbGllbnRzLWdyaWQtcm93Lmh0bWwnLApvblJlZ2lzdGVyQXBpOiBmdW5jdGlvbihncmlkQXBpKSB7CiRzY29wZS5ncmlkQXBpID0gZ3JpZEFwaTsKJHNjb3BlLmdyaWRBcGkuZ3JpZC5yZWdpc3RlclJvd3NQcm9jZXNzb3IoJHNjb3BlLnNpbmdsZUZpbHRlciwgMjAwKTsKfSwKfTsKCiRzY29wZS5pc0FjdGl2ZSA9IGZ1bmN0aW9uKHZpZXdMb2NhdGlvbikgewpsb2dEZWJ1Zygidmlld0xvY2F0aW9uID0gIiArIHZpZXdMb2NhdGlvbik7CnZhciBhY3RpdmUgPSAodmlld0xvY2F0aW9uID09PSAkbG9jYXRpb24ucGF0aCgpKTsKcmV0dXJuIGFjdGl2ZTsKfTsKCiRzY29wZS5maWx0ZXIgPSBmdW5jdGlvbigpIHsKbG9nRGVidWcoInNpbmdsZSBmaWx0ZXIiKTsKJHNjb3BlLmdyaWRBcGkuZ3JpZC5yZWZyZXNoKCk7CmlmICgkc2NvcGUuZmlsdGVyLlZhbHVlICE9ICIiKSB7CiRzY29wZS5maWx0ZXIuYnV0dG9uVmFsdWUgPSAiJyIgKyAkc2NvcGUuZmlsdGVyLlZhbHVlICsgIiciOwp9IGVsc2Ugewokc2NvcGUuZmlsdGVyLmJ1dHRvblZhbHVlID0gIiI7Cn0KfTsKCiRzY29wZS5zaW5nbGVGaWx0ZXIgPSBmdW5jdGlvbihyZW5kZXJhYmxlUm93cykgewp2YXIgbWF0Y2hlciA9IG5ldyBSZWdFeHAoJHNjb3BlLmZpbHRlci5WYWx1ZSk7CmxvZ0RlYnVnKCJzY29wZT0iICsgJHNjb3BlKTsKbG9nRGVidWcoInNjb3BlLmZpbHRlci5WYWx1ZT0iICsgJHNjb3BlLmZpbHRlci5WYWx1ZSk7CmlmICgoJHNjb3BlLmZpbHRlci5WYWx1ZSA9PSBudWxsKSB8fCAoJHNjb3BlLmZpbHRlci5WYWx1ZSA9PSAiIikpIHsKbG9nRGVidWcoImVtcHR5IGZpbHRlciIpOwpyZXR1cm4gcmVuZGVyYWJsZVJvd3M7Cn0KcmVuZGVyYWJsZVJvd3MuZm9yRWFjaChmdW5jdGlvbihyb3cpIHsKLy8JCQlsb2dEZWJ1Zygicm93PSIrcm93KTsKcm93LnZpc2libGUgPSBmYWxzZTsKdmFyICRjdXJyRmlyc3ROYW1lID0gcm93LmVudGl0eVsnZmlyc3RfbmFtZSddOwp2YXIgJGN1cnJMYXN0TmFtZSA9IHJvdy5lbnRpdHlbJ2xhc3RfbmFtZSddOwpsb2dEZWJ1ZygiY3VyckZpcnN0TmFtZT0iICsgJGN1cnJGaXJzdE5hbWUpOwoKaWYgKCRjdXJyRmlyc3ROYW1lICE9IG51bGwpIHsKaWYgKCRjdXJyRmlyc3ROYW1lLmluZGV4T2YoJHNjb3BlLmZpbHRlci5WYWx1ZSkgPiAtMSkgewpyb3cudmlzaWJsZSA9IHRydWU7Cn0KfSBlbHNlIC8vIHJvdyBpcyBudWxsCnsKcm93LnZpc2libGUgPSBmYWxzZTsKfQoKaWYgKCRjdXJyTGFzdE5hbWUgIT0gbnVsbCkgewppZiAoJGN1cnJMYXN0TmFtZS5pbmRleE9mKCRzY29wZS5maWx0ZXIuVmFsdWUpID4gLTEpIHsKcm93LnZpc2libGUgPSB0cnVlOwp9Cn0gZWxzZSAvLyByb3cgaXMgbnVsbAp7CnJvdy52aXNpYmxlID0gZmFsc2U7Cn0KfSk7CnJldHVybiByZW5kZXJhYmxlUm93czsKfTsKCi8vIGltcG9ydGFudCEhIGluaXRpYWxpemluZyBhbmd1bGFyIGZvcm1zIGFzIGFycmF5cwokc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIgPSB7fTsKJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyID0ge307CgovLyBsb2dEZWJ1ZygibG9jYXRpb249IiArICRsb2NhdGlvbik7Ci8vIGxvZ0RlYnVnKCRsb2NhdGlvbik7Cgokc2NvcGUuY2hhbmdlTGFuZyA9IGZ1bmN0aW9uKCRuZXdsYW5nKSB7CmxvZ0RlYnVnKCRuZXdsYW5nKTsKLy8kc2NvcGUuc3BDbGFzcyA9ICdyaWdodCc7CnVwZGF0ZUdsb2JhbExhbmd1YWdlKCRzY29wZSwgJG5ld2xhbmcpCn0KCiRzY29wZS5hZGROZXdDbGllbnQgPSBmdW5jdGlvbigpIHsKJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jbGllbnRzL2FkZCcpOwp9CiRzY29wZS5hZGROZXdJbnN0cnVjdG9yID0gZnVuY3Rpb24oKSB7CiRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfaW5zdHJ1Y3RvcnMvYWRkJyk7Cn0KfSk7CgovLy8vLy8gYmVmb3JlIGZvcm1zCmt1emVBcHAuY29udHJvbGxlcignRGVtb0NvbnRyb2xsZXInLCBbCickc2NvcGUnLCAnJGJ1aWxkZXInLCAnJHZhbGlkYXRvcicsCmZ1bmN0aW9uKCRzY29wZSwgJGJ1aWxkZXIsICR2YWxpZGF0b3IpIHsKdmFyIGNoZWNrYm94LCB0ZXh0Ym94Owp0ZXh0Ym94ID0gJGJ1aWxkZXIuYWRkRm9ybU9iamVjdCgnZGVmYXVsdCcsIHsKaWQ6ICd0ZXh0Ym94JywKY29tcG9uZW50OiAndGV4dElucHV0JywKbGFiZWw6ICdOYW1lJywKZGVzY3JpcHRpb246ICdZb3VyIG5hbWUnLApwbGFjZWhvbGRlcjogJ1lvdXIgbmFtZScsCnJlcXVpcmVkOiB0cnVlLAplZGl0YWJsZTogZmFsc2UKfSk7CmNoZWNrYm94ID0gJGJ1aWxkZXIuYWRkRm9ybU9iamVjdCgnZGVmYXVsdCcsIHsKaWQ6ICdjaGVja2JveCcsCmNvbXBvbmVudDogJ2NoZWNrYm94JywKbGFiZWw6ICdQZXRzJywKZGVzY3JpcHRpb246ICdEbyB5b3UgaGF2ZSBhbnkgcGV0cz8nLApvcHRpb25zOiBbJ0RvZycsICdDYXQnXQp9KTsKJGJ1aWxkZXIuYWRkRm9ybU9iamVjdCgnZGVmYXVsdCcsIHsKY29tcG9uZW50OiAnc2FtcGxlSW5wdXQnCn0pOwokc2NvcGUuZm9ybSA9ICRidWlsZGVyLmZvcm1zWydkZWZhdWx0J107CiRzY29wZS5pbnB1dCA9IFtdOwokc2NvcGUuZGVmYXVsdFZhbHVlID0ge307CiRzY29wZS5kZWZhdWx0VmFsdWVbdGV4dGJveC5pZF0gPSAnZGVmYXVsdCB2YWx1ZSc7CiRzY29wZS5kZWZhdWx0VmFsdWVbY2hlY2tib3guaWRdID0gW3RydWUsIHRydWVdOwpyZXR1cm4gJHNjb3BlLnN1Ym1pdCA9IGZ1bmN0aW9uKCkgewpyZXR1cm4gJHZhbGlkYXRvci52YWxpZGF0ZSgkc2NvcGUsICdkZWZhdWx0Jykuc3VjY2VzcyhmdW5jdGlvbigpIHsKcmV0dXJuIGxvZ0RlYnVnKCdzdWNjZXNzJyk7Cn0pLmVycm9yKGZ1bmN0aW9uKCkgewpyZXR1cm4gbG9nRGVidWcoJ2Vycm9yJyk7Cn0pOwp9Owp9Cl0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdBbGVydERlbW9DdHJsJywgZnVuY3Rpb24oJHNjb3BlKSB7CiRzY29wZS5hbGVydHMgPSBbewp0eXBlOiAnZGFuZ2VyJywKbXNnOiAnT2ggc25hcCEgQ2hhbmdlIGEgZmV3IHRoaW5ncyB1cCBhbmQgdHJ5IHN1Ym1pdHRpbmcgYWdhaW4uJwp9LCB7CnR5cGU6ICdzdWNjZXNzJywKbXNnOiAnV2VsbCBkb25lISBZb3Ugc3VjY2Vzc2Z1bGx5IHJlYWQgdGhpcyBpbXBvcnRhbnQgYWxlcnQgbWVzc2FnZS4nCn1dOwoKJHNjb3BlLmFkZEFsZXJ0ID0gZnVuY3Rpb24oKSB7CiRzY29wZS5hbGVydHMucHVzaCh7Cm1zZzogJ0Fub3RoZXIgYWxlcnQhJwp9KTsKfTsKCiRzY29wZS5jbG9zZUFsZXJ0ID0gZnVuY3Rpb24oaW5kZXgpIHsKJHNjb3BlLmFsZXJ0cy5zcGxpY2UoaW5kZXgsIDEpOwp9Owp9KTsKCgpmdW5jdGlvbiBpc051bWJlcktleShldnQpewp2YXIgY2hhckNvZGUgPSAoZXZ0LndoaWNoKSA/IGV2dC53aGljaCA6IGV2ZW50LmtleUNvZGU7CnJldHVybiAhKGNoYXJDb2RlID4gMzEgJiYgKGNoYXJDb2RlIDwgNDggfHwgY2hhckNvZGUgPiA1NykpOwp9Cgo=</text>
      </register>
      <register name="-" type="4">
        <text>get_included_files()</text>
      </register>
      <register name="/" type="4">
        <text encoding="base64">XDxjdXJyZW50Q2xpZW50XD4=</text>
      </register>
      <register name="0" type="2">
        <text encoding="base64">Ly8gdjExIC0gMjMgbWFyY2ggMjAxNwovL0RlZmluZSBhbiBhbmd1bGFyIG1vZHVsZSBmb3Igb3VyIGFwcAoKdmFyIGt1emVJc0NhbGVuZGFyRHJhZ2dibGU7Cmt1emVJc0NhbGVuZGFyRHJhZ2dibGUgPSB0cnVlOwoKLy8gYW5ndWxhciBtb2R1bGVzCi8vJGFuZ3VsYXJNb2R1bGVzPVsnbmdSb3V0ZScsJ3VpLmJvb3RzdHJhcCcsJ3VpLmdyaWQnXTsKJGFuZ3VsYXJNb2R1bGVzID0gWyduZ1JvdXRlJywgJ3VpLmJvb3RzdHJhcCcsICd1aS5ncmlkJywgJ2J1aWxkZXInLCAnYnVpbGRlci5jb21wb25lbnRzJywgJ3ZhbGlkYXRvci5ydWxlcycsICd1aS5jYWxlbmRhcicsICdjaGVja2xpc3QtbW9kZWwnLCAndWkuYm9vdHN0cmFwLmRhdGV0aW1lcGlja2VyJywgJ2FuZ3Vjb21wbGV0ZS1hbHQnLCAnbXVsdGlwbGVTZWxlY3QnLCdhbmd1bGFySW5saW5lRWRpdCcsJ3RleHRBbmd1bGFyJywnbmdDc3YnXTsKCnZhciBkYXlOYW1lcyA9IFsn16jXkNep15XXnycsICfXqdeg15knLCAn16nXnNeZ16nXmScsICfXqNeR15nXoteZJywgJ9eX157Xmdep15knLCAn16nXmdep15knLCAn16nXkdeqJ107CnZhciBtb250aE5hbWVzID0gWyLXmdeg15XXkNeoIiwgItek15HXqNeV15DXqCIsICLXnteo16UiLCAi15DXpNeo15nXnCIsICLXnteQ15kiLCAi15nXldeg15kiLAogICAgIteZ15XXnNeZIiwgIteQ15XXkteV16HXmCIsICLXodek15jXnteR16giLCAi15DXlden15jXldeR16giLCAi16DXldeR157XkdeoIiwgIteT16bXnteR16giCl07Cgp2YXIgbG9naW5OZXh0U2NyZWVuPSIiOwoKKGZ1bmN0aW9uKCl7RGF0ZS5zaG9ydE1vbnRocz1bIkphbiIsIkZlYiIsIk1hciIsIkFwciIsIk1heSIsIkp1biIsIkp1bCIsIkF1ZyIsIlNlcCIsIk9jdCIsIk5vdiIsIkRlYyJdLERhdGUubG9uZ01vbnRocz1bIkphbnVhcnkiLCJGZWJydWFyeSIsIk1hcmNoIiwiQXByaWwiLCJNYXkiLCJKdW5lIiwiSnVseSIsIkF1Z3VzdCIsIlNlcHRlbWJlciIsIk9jdG9iZXIiLCJOb3ZlbWJlciIsIkRlY2VtYmVyIl0sRGF0ZS5zaG9ydERheXM9WyJTdW4iLCJNb24iLCJUdWUiLCJXZWQiLCJUaHUiLCJGcmkiLCJTYXQiXSxEYXRlLmxvbmdEYXlzPVsiU3VuZGF5IiwiTW9uZGF5IiwiVHVlc2RheSIsIldlZG5lc2RheSIsIlRodXJzZGF5IiwiRnJpZGF5IiwiU2F0dXJkYXkiXTt2YXIgdD17ZDpmdW5jdGlvbigpe3JldHVybih0aGlzLmdldERhdGUoKTwxMD8iMCI6IiIpK3RoaXMuZ2V0RGF0ZSgpfSxEOmZ1bmN0aW9uKCl7cmV0dXJuIERhdGUuc2hvcnREYXlzW3RoaXMuZ2V0RGF5KCldfSxqOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZ2V0RGF0ZSgpfSxsOmZ1bmN0aW9uKCl7cmV0dXJuIERhdGUubG9uZ0RheXNbdGhpcy5nZXREYXkoKV19LE46ZnVuY3Rpb24oKXtyZXR1cm4gMD09dGhpcy5nZXREYXkoKT83OnRoaXMuZ2V0RGF5KCl9LFM6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5nZXREYXRlKCklMTA9PTEmJjExIT10aGlzLmdldERhdGUoKT8ic3QiOnRoaXMuZ2V0RGF0ZSgpJTEwPT0yJiYxMiE9dGhpcy5nZXREYXRlKCk/Im5kIjp0aGlzLmdldERhdGUoKSUxMD09MyYmMTMhPXRoaXMuZ2V0RGF0ZSgpPyJyZCI6InRoIn0sdzpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldERheSgpfSx6OmZ1bmN0aW9uKCl7dmFyIHQ9bmV3IERhdGUodGhpcy5nZXRGdWxsWWVhcigpLDAsMSk7cmV0dXJuIE1hdGguY2VpbCgodGhpcy10KS84NjRlNSl9LFc6ZnVuY3Rpb24oKXt2YXIgdD1uZXcgRGF0ZSh0aGlzLnZhbHVlT2YoKSksZT0odGhpcy5nZXREYXkoKSs2KSU3O3Quc2V0RGF0ZSh0LmdldERhdGUoKS1lKzMpO3ZhciBuPXQudmFsdWVPZigpO3JldHVybiB0LnNldE1vbnRoKDAsMSksNCE9PXQuZ2V0RGF5KCkmJnQuc2V0TW9udGgoMCwxKyg0LXQuZ2V0RGF5KCkrNyklNyksMStNYXRoLmNlaWwoKG4tdCkvNjA0OGU1KX0sRjpmdW5jdGlvbigpe3JldHVybiBEYXRlLmxvbmdNb250aHNbdGhpcy5nZXRNb250aCgpXX0sbTpmdW5jdGlvbigpe3JldHVybih0aGlzLmdldE1vbnRoKCk8OT8iMCI6IiIpKyh0aGlzLmdldE1vbnRoKCkrMSl9LE06ZnVuY3Rpb24oKXtyZXR1cm4gRGF0ZS5zaG9ydE1vbnRoc1t0aGlzLmdldE1vbnRoKCldfSxuOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZ2V0TW9udGgoKSsxfSx0OmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5nZXRGdWxsWWVhcigpLGU9dGhpcy5nZXRNb250aCgpKzE7cmV0dXJuIDEyPT09ZSYmKHQ9dCsrLGU9MCksbmV3IERhdGUodCxlLDApLmdldERhdGUoKX0sTDpmdW5jdGlvbigpe3ZhciB0PXRoaXMuZ2V0RnVsbFllYXIoKTtyZXR1cm4gdCU0MDA9PTB8fHQlMTAwIT0wJiZ0JTQ9PTB9LG86ZnVuY3Rpb24oKXt2YXIgdD1uZXcgRGF0ZSh0aGlzLnZhbHVlT2YoKSk7cmV0dXJuIHQuc2V0RGF0ZSh0LmdldERhdGUoKS0odGhpcy5nZXREYXkoKSs2KSU3KzMpLHQuZ2V0RnVsbFllYXIoKX0sWTpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldEZ1bGxZZWFyKCl9LHk6ZnVuY3Rpb24oKXtyZXR1cm4oIiIrdGhpcy5nZXRGdWxsWWVhcigpKS5zdWJzdHIoMil9LGE6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5nZXRIb3VycygpPDEyPyJhbSI6InBtIn0sQTpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldEhvdXJzKCk8MTI/IkFNIjoiUE0ifSxCOmZ1bmN0aW9uKCl7cmV0dXJuIE1hdGguZmxvb3IoMWUzKigodGhpcy5nZXRVVENIb3VycygpKzEpJTI0K3RoaXMuZ2V0VVRDTWludXRlcygpLzYwK3RoaXMuZ2V0VVRDU2Vjb25kcygpLzM2MDApLzI0KX0sZzpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldEhvdXJzKCklMTJ8fDEyfSxHOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZ2V0SG91cnMoKX0saDpmdW5jdGlvbigpe3JldHVybigodGhpcy5nZXRIb3VycygpJTEyfHwxMik8MTA/IjAiOiIiKSsodGhpcy5nZXRIb3VycygpJTEyfHwxMil9LEg6ZnVuY3Rpb24oKXtyZXR1cm4odGhpcy5nZXRIb3VycygpPDEwPyIwIjoiIikrdGhpcy5nZXRIb3VycygpfSxpOmZ1bmN0aW9uKCl7cmV0dXJuKHRoaXMuZ2V0TWludXRlcygpPDEwPyIwIjoiIikrdGhpcy5nZXRNaW51dGVzKCl9LHM6ZnVuY3Rpb24oKXtyZXR1cm4odGhpcy5nZXRTZWNvbmRzKCk8MTA/IjAiOiIiKSt0aGlzLmdldFNlY29uZHMoKX0sdTpmdW5jdGlvbigpe3ZhciB0PXRoaXMuZ2V0TWlsbGlzZWNvbmRzKCk7cmV0dXJuKDEwPnQ/IjAwIjoxMDA+dD8iMCI6IiIpK3R9LGU6ZnVuY3Rpb24oKXtyZXR1cm4vXCgoLiopXCkvLmV4ZWMoKG5ldyBEYXRlKS50b1N0cmluZygpKVsxXX0sSTpmdW5jdGlvbigpe2Zvcih2YXIgdD1udWxsLGU9MDsxMj5lOysrZSl7dmFyIG49bmV3IERhdGUodGhpcy5nZXRGdWxsWWVhcigpLGUsMSksaT1uLmdldFRpbWV6b25lT2Zmc2V0KCk7aWYobnVsbD09PXQpdD1pO2Vsc2V7aWYodD5pKXt0PWk7YnJlYWt9aWYoaT50KWJyZWFrfX1yZXR1cm4gdGhpcy5nZXRUaW1lem9uZU9mZnNldCgpPT10fDB9LE86ZnVuY3Rpb24oKXtyZXR1cm4oLXRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKTwwPyItIjoiKyIpKyhNYXRoLmFicyh0aGlzLmdldFRpbWV6b25lT2Zmc2V0KCkvNjApPDEwPyIwIjoiIikrTWF0aC5mbG9vcihNYXRoLmFicyh0aGlzLmdldFRpbWV6b25lT2Zmc2V0KCkvNjApKSsoMD09TWF0aC5hYnModGhpcy5nZXRUaW1lem9uZU9mZnNldCgpJTYwKT8iMDAiOihNYXRoLmFicyh0aGlzLmdldFRpbWV6b25lT2Zmc2V0KCklNjApPDEwPyIwIjoiIikrTWF0aC5hYnModGhpcy5nZXRUaW1lem9uZU9mZnNldCgpJTYwKSl9LFA6ZnVuY3Rpb24oKXtyZXR1cm4oLXRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKTwwPyItIjoiKyIpKyhNYXRoLmFicyh0aGlzLmdldFRpbWV6b25lT2Zmc2V0KCkvNjApPDEwPyIwIjoiIikrTWF0aC5mbG9vcihNYXRoLmFicyh0aGlzLmdldFRpbWV6b25lT2Zmc2V0KCkvNjApKSsiOiIrKDA9PU1hdGguYWJzKHRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKSU2MCk/IjAwIjooTWF0aC5hYnModGhpcy5nZXRUaW1lem9uZU9mZnNldCgpJTYwKTwxMD8iMCI6IiIpK01hdGguYWJzKHRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKSU2MCkpfSxUOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMudG9UaW1lU3RyaW5nKCkucmVwbGFjZSgvXi4rIFwoPyhbXlwpXSspXCk/JC8sIiQxIil9LFo6ZnVuY3Rpb24oKXtyZXR1cm4gNjAqLXRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKX0sYzpmdW5jdGlvbigpe3JldHVybiB0aGlzLmZvcm1hdCgiWS1tLWRcXFRIOmk6c1AiKX0scjpmdW5jdGlvbigpe3JldHVybiB0aGlzLnRvU3RyaW5nKCl9LFU6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5nZXRUaW1lKCkvMWUzfX07RGF0ZS5wcm90b3R5cGUuZm9ybWF0PWZ1bmN0aW9uKGUpe3ZhciBuPXRoaXM7cmV0dXJuIGUucmVwbGFjZSgvKFxcPykoLikvZyxmdW5jdGlvbihlLGkscil7cmV0dXJuIiI9PT1pJiZ0W3JdP3Rbcl0uY2FsbChuKTpyfSl9fSkuY2FsbCh0aGlzKTsKCmZ1bmN0aW9uIGdvdG9DbGllbnRQYWdlKGJ1c2luZXNzX3VzZXJfaWQpCnsKICB3aW5kb3cubG9jYXRpb24uaHJlZj0nLyMvYnVzaW5lc3NfY2xpZW50cy8nICsgYnVzaW5lc3NfdXNlcl9pZDsKfQpmdW5jdGlvbiBnb3RvSW5zdHJ1Y3RvclBhZ2UoYnVzaW5lc3NfdXNlcl9pZCkKewogIHdpbmRvdy5sb2NhdGlvbi5ocmVmPScvIy9idXNpbmVzc19pbnN0cnVjdG9ycy8nICsgYnVzaW5lc3NfdXNlcl9pZDsKfQoKZnVuY3Rpb24gZ290b0V2ZW50UGFnZSh0aGVldmVudCkKewogIGxvZ0RlYnVnKCJnb3RvRXZlbnRQYWdlICIrdGhlZXZlbnQpOwogIGlmICh0aGVldmVudC5pc19jbGFzcz09MSkKICB7CiAgICB3aW5kb3cubG9jYXRpb24uaHJlZj0nLyMvZXZlbnRfY2xhc3MvJyArIHRoZWV2ZW50LmV2ZW50X2lkOwogIH0KICBlbHNlCiAgewogICAgd2luZG93LmxvY2F0aW9uLmhyZWY9Jy8jL2V2ZW50LycgKyB0aGVldmVudC5ldmVudF9pZDsKICB9Cn0KCmZ1bmN0aW9uIGdvdG9Mb2NhdGlvblBhZ2UobG9jYXRpb25faWQpCnsKICBsb2dEZWJ1ZygiZ290b0xvY2F0aW9uUGFnZSAiK2xvY2F0aW9uX2lkKTsKICB3aW5kb3cubG9jYXRpb24uaHJlZj0nLyMvYnVzaW5lc3NfbG9jYXRpb25zLycgKyBsb2NhdGlvbl9pZDsKCn0KCmZ1bmN0aW9uIGdvdG9DbGllbnRFZGl0UGFnZSh1c2VyX2lkKQp7CiAgd2luZG93LmxvY2F0aW9uLmhyZWY9Jy8jL2J1c2luZXNzX2NsaWVudHMvJyArIHVzZXJfaWQgKyAnL2VkaXQnOwp9CgpmdW5jdGlvbiBnb3RvQmFjaygpCnsKICB3aW5kb3cuaGlzdG9yeS5iYWNrKCk7Cn0KCmZ1bmN0aW9uIHNob3dFdmVudFBvcHVwKHNlbGVjdGVkRXZlbnQsICR1aWJNb2RhbCkKewogIC8vIHRoaXMgZnVuY3Rpb24gdXNlZCB0byBicmluZyBhIHBvcHVwCiAgLy8gbm93IGl0IGdvZXMgdG8gdGhlIGV2ZW50IHBhZ2UKICBnb3RvRXZlbnRQYWdlKHNlbGVjdGVkRXZlbnQpOwoKICAvLyBpZiAoc2VsZWN0ZWRFdmVudC5pc19yZXBlYXRpbmcgPT0gMSkgewogIC8vICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAvLyAgICAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgLy8gICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9jbGFzc19zaW5nbGUucGhwJywKICAvLyAgICAgICAgIGNvbnRyb2xsZXI6ICdldmVudFJlY3VycmluZ0RldGFpbHNCdXNpbmVzc0NhbGVuZGFyTW9kYWxDb250cm9sbGVyJywKICAvLyAgICAgICAgIC8vIHNpemU6IHNpemUsCiAgLy8gICAgICAgICByZXNvbHZlOiB7CiAgLy8gICAgICAgICAgICAgc2VsZWN0ZWRFdmVudDogZnVuY3Rpb24oKSB7CiAgLy8gICAgICAgICAgICAgICAgIHJldHVybiBzZWxlY3RlZEV2ZW50OwogIC8vICAgICAgICAgICAgIH0KICAvLyAgICAgICAgIH0KICAvLyAgICAgfSk7CiAgLy8gfSBlbHNlIHsKICAvLyAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgLy8gICAgICAgICBhbmltYXRpb246IGZhbHNlLAogIC8vICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfZXZlbnRfc2luZ2xlLnBocCcsCiAgLy8gICAgICAgICBjb250cm9sbGVyOiAnZXZlbnREZXRhaWxzQnVzaW5lc3NDYWxlbmRhck1vZGFsQ29udHJvbGxlcicsCiAgLy8gICAgICAgICAvLyBzaXplOiBzaXplLAogIC8vICAgICAgICAgcmVzb2x2ZTogewogIC8vICAgICAgICAgICAgIHNlbGVjdGVkRXZlbnQ6IGZ1bmN0aW9uKCkgewogIC8vICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZWN0ZWRFdmVudDsKICAvLyAgICAgICAgICAgICB9CiAgLy8gICAgICAgICB9CiAgLy8gICAgIH0pOwogIC8vIH0KfQpmdW5jdGlvbiB1cGRhdGVHbG9iYWxMYW5ndWFnZSgkc2NvcGUsICRuZXdsYW5nKSB7CgogICAgLy8JdmFyIGdMYW5nPWdMYW5nQmFzZVtnTGFuZ0N1cnJdOwogICAgJGdMYW5nID0gZ0xhbmdCYXNlWyRuZXdsYW5nXTsKICAgIC8vIGxvZ0RlYnVnKCJnTGFuZ0Jhc2VbJG5ld2xhbmddWyd0aXRsZTEnXT0iICsgZ0xhbmdCYXNlWyRuZXdsYW5nXVsndGl0bGUxJ10pOwogICAgLy8gbG9nRGVidWcoImxhbmd1Z2FnZToiICsgJGdMYW5nWydsYW5ndWFnZSddKTsKICAgIC8vCWxvZ0RlYnVnKCJsYW5ndWdhZ2UgZGlyOiAiKyRnTGFuZ1snZGlyJ10pOwogICAgLy8JbG9nRGVidWcoImNoYW5naW5nIGxhbmd1YWdlIHRvICIrJG5ld2xhbmcpCiAgICAkc2NvcGUuc3BDbGFzcyA9ICRnTGFuZ1snY2xhc3MnXTsKICAgIC8vCWxvZ0RlYnVnKCJpcyBhcnJheT8gIithbmd1bGFyLmlzQXJyYXkoJGdMYW5nKSk7CiAgICAvLwlsb2dEZWJ1ZygiJGdMYW5nWydkaXInXT0iKyRnTGFuZ1snZGlyJ10pOwogICAgLy8JbG9nRGVidWcoIiRnTGFuZ1sndGl0bGUxJ109IiskZ0xhbmdbJ3RpdGxlMSddKTsKICAgICRzY29wZS5sYW5nZmlsZSA9ICRnTGFuZzsKICAgIC8vIGxvZ0RlYnVnKCJpcyBhcnJheT8gIiArIGFuZ3VsYXIuaXNBcnJheSgkc2NvcGUubGFuZ2ZpbGUpKTsKICAgIC8vIGxvZ0RlYnVnKCIkc2NvcGUubGFuZ2ZpbGU9IiArICRzY29wZS5sYW5nZmlsZSk7CiAgICAvLyBsb2dEZWJ1ZygiJHNjb3BlLmxhbmdmaWxlWyd0aXRsZTEnXT0iICsgJHNjb3BlLmxhbmdmaWxlWyd0aXRsZTEnXSk7CgogICAgJHNjb3BlLnRlc3RuZXd2YXIgPSAkc2NvcGUubGFuZ2ZpbGVbJ3RpdGxlMSddOwogICAgLy8JJHNjb3BlLm1lc3NhZ2U9JHNjb3BlLmxhbmdmaWxlWyd0aXRsZTEnXTsKfQoKZnVuY3Rpb24gZ2V0UmFuZG9tQ29sb3IoKSB7CiAgICB2YXIgbGV0dGVycyA9ICcwMTIzNDU2Nzg5QUJDREVGJy5zcGxpdCgnJyk7CiAgICB2YXIgY29sb3IgPSAnIyc7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IDY7IGkrKykgewogICAgICAgIGNvbG9yICs9IGxldHRlcnNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTYpXTsKICAgIH0KICAgIHJldHVybiBjb2xvcjsKfQoKZnVuY3Rpb24gZ2V0UmFuZG9tSW50KG1pbiwgbWF4KSB7CiAgICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKG1heCAtIG1pbiArIDEpKSArIG1pbjsKfQoKZnVuY3Rpb24gY2FsY190ZW1wX2xpbWl0X2lkKCkgewogICAgdmFyIGQgPSBuZXcgRGF0ZSgpOwogICAgdmFyIHJhbmRvbWxpbWl0ID0gZC5nZXRUaW1lKCk7CiAgICBsb2dEZWJ1ZygiY2FsY190ZW1wX2xpbWl0X2lkPSIgKyByYW5kb21saW1pdCk7CiAgICByZXR1cm4gcmFuZG9tbGltaXQ7Cn0KCnZhciAkZ0xvZ0xldmVsID0gJ2RlYnVnJzsKCi8vIHN0YXJ0aW5nCmxvZ0RlYnVnKCJtYWluICRnTG9nTGV2ZWw9IiArICRnTG9nTGV2ZWwpOwpsb2dEZWJ1ZygiaW5pdGlhbGl6ZSBhbmd1bGFyIik7CmxvZ0RlYnVnKCJpbml0aWFsaXppbmcgbW9kdWxlcyAiICsgJGFuZ3VsYXJNb2R1bGVzKTsKCnZhciBrdXplQXBwID0gYW5ndWxhci5tb2R1bGUoJ2t1emVBcHAnLCAkYW5ndWxhck1vZHVsZXMpCgovLyRyb290U2NvcGUuc3BDbGFzcyA9ICdyaWdodCc7Cmt1emVSdW4gPSBmdW5jdGlvbigpIHsKCn0Ka3V6ZUFwcC5ydW4oWwogICAgJyRidWlsZGVyJywKICAgIGZ1bmN0aW9uKCRidWlsZGVyKSB7CiAgICAgICAgLy8gbG9nRGVidWcoImluc2lkZSBrdXplQXBwLnJ1biIpOwogICAgICAgICRidWlsZGVyLnJlZ2lzdGVyQ29tcG9uZW50KCdzYW1wbGVJbnB1dCcsIHsKICAgICAgICAgICAgZ3JvdXA6ICdmcm9tIGh0bWwnLAogICAgICAgICAgICBsYWJlbDogJ1NhbXBsZScsCiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnRnJvbSBodG1sIHRlbXBsYXRlJywKICAgICAgICAgICAgcGxhY2Vob2xkZXI6ICdwbGFjZWhvbGRlcicsCiAgICAgICAgICAgIHJlcXVpcmVkOiBmYWxzZSwKICAgICAgICAgICAgdmFsaWRhdGlvbk9wdGlvbnM6IFt7CiAgICAgICAgICAgICAgICBsYWJlbDogJ25vbmUnLAogICAgICAgICAgICAgICAgcnVsZTogJy8uKi8nCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgIGxhYmVsOiAnbnVtYmVyJywKICAgICAgICAgICAgICAgIHJ1bGU6ICdbbnVtYmVyXScKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgbGFiZWw6ICdlbWFpbCcsCiAgICAgICAgICAgICAgICBydWxlOiAnW2VtYWlsXScKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgbGFiZWw6ICd1cmwnLAogICAgICAgICAgICAgICAgcnVsZTogJ1t1cmxdJwogICAgICAgICAgICB9XSwKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYW5ndWxhci1mb3JtLWJ1aWxkZXIvZXhhbXBsZS90ZW1wbGF0ZS5odG1sJywKICAgICAgICAgICAgcG9wb3ZlclRlbXBsYXRlVXJsOiAnL2FuZ3VsYXItZm9ybS1idWlsZGVyL2V4YW1wbGUvcG9wb3ZlclRlbXBsYXRlLmh0bWwnCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuICRidWlsZGVyLnJlZ2lzdGVyQ29tcG9uZW50KCduYW1lJywgewogICAgICAgICAgICBncm91cDogJ0RlZmF1bHQnLAogICAgICAgICAgICBsYWJlbDogJ05hbWUnLAogICAgICAgICAgICByZXF1aXJlZDogZmFsc2UsCiAgICAgICAgICAgIGFycmF5VG9UZXh0OiB0cnVlLAogICAgICAgICAgICB0ZW1wbGF0ZTogIjxkaXYgY2xhc3M9XCJmb3JtLWdyb3VwXCI+XG4gICAgPGxhYmVsIGZvcj1cInt7Zm9ybU5hbWUraW5kZXh9fVwiIGNsYXNzPVwiY29sLW1kLTQgY29udHJvbC1sYWJlbFwiIG5nLWNsYXNzPVwieydmYi1yZXF1aXJlZCc6cmVxdWlyZWR9XCI+e3tsYWJlbH19PC9sYWJlbD5cbiAgICA8ZGl2IGNsYXNzPVwiY29sLW1kLThcIj5cbiAgICAgICAgPGlucHV0IHR5cGU9J2hpZGRlbicgbmctbW9kZWw9XCJpbnB1dFRleHRcIiB2YWxpZGF0b3ItcmVxdWlyZWQ9XCJ7e3JlcXVpcmVkfX1cIiB2YWxpZGF0b3ItZ3JvdXA9XCJ7e2Zvcm1OYW1lfX1cIi8+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJjb2wtc20tNlwiIHN0eWxlPVwicGFkZGluZy1sZWZ0OiAwO1wiPlxuICAgICAgICAgICAgPGlucHV0IHR5cGU9XCJ0ZXh0XCJcbiAgICAgICAgICAgICAgICBuZy1tb2RlbD1cImlucHV0QXJyYXlbMF1cIlxuICAgICAgICAgICAgICAgIGNsYXNzPVwiZm9ybS1jb250cm9sXCIgaWQ9XCJ7e2Zvcm1OYW1lK2luZGV4fX0tMFwiLz5cbiAgICAgICAgICAgIDxwIGNsYXNzPSdoZWxwLWJsb2NrJz5GaXJzdCBuYW1lPC9wPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImNvbC1zbS02XCIgc3R5bGU9XCJwYWRkaW5nLWxlZnQ6IDA7XCI+XG4gICAgICAgICAgICA8aW5wdXQgdHlwZT1cInRleHRcIlxuICAgICAgICAgICAgICAgIG5nLW1vZGVsPVwiaW5wdXRBcnJheVsxXVwiXG4gICAgICAgICAgICAgICAgY2xhc3M9XCJmb3JtLWNvbnRyb2xcIiBpZD1cInt7Zm9ybU5hbWUraW5kZXh9fS0xXCIvPlxuICAgICAgICAgICAgPHAgY2xhc3M9J2hlbHAtYmxvY2snPkxhc3QgbmFtZTwvcD5cbiAgICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG48L2Rpdj4iLAogICAgICAgICAgICBwb3BvdmVyVGVtcGxhdGU6ICI8Zm9ybT5cbiAgICA8ZGl2IGNsYXNzPVwiZm9ybS1ncm91cFwiPlxuICAgICAgICA8bGFiZWwgY2xhc3M9J2NvbnRyb2wtbGFiZWwnPkxhYmVsPC9sYWJlbD5cbiAgICAgICAgPGlucHV0IHR5cGU9J3RleHQnIG5nLW1vZGVsPVwibGFiZWxcIiB2YWxpZGF0b3I9XCJbcmVxdWlyZWRdXCIgY2xhc3M9J2Zvcm0tY29udHJvbCcvPlxuICAgIDwvZGl2PlxuICAgIDxkaXYgY2xhc3M9XCJjaGVja2JveFwiPlxuICAgICAgICA8bGFiZWw+XG4gICAgICAgICAgICA8aW5wdXQgdHlwZT0nY2hlY2tib3gnIG5nLW1vZGVsPVwicmVxdWlyZWRcIiAvPlxuICAgICAgICAgICAgUmVxdWlyZWRcbiAgICAgICAgPC9sYWJlbD5cbiAgICA8L2Rpdj5cblxuICAgIDxoci8+XG4gICAgPGRpdiBjbGFzcz0nZm9ybS1ncm91cCc+XG4gICAgICAgIDxpbnB1dCB0eXBlPSdzdWJtaXQnIG5nLWNsaWNrPVwicG9wb3Zlci5zYXZlKCRldmVudClcIiBjbGFzcz0nYnRuIGJ0bi1wcmltYXJ5JyB2YWx1ZT0nU2F2ZScvPlxuICAgICAgICA8aW5wdXQgdHlwZT0nYnV0dG9uJyBuZy1jbGljaz1cInBvcG92ZXIuY2FuY2VsKCRldmVudClcIiBjbGFzcz0nYnRuIGJ0bi1kZWZhdWx0JyB2YWx1ZT0nQ2FuY2VsJy8+XG4gICAgICAgIDxpbnB1dCB0eXBlPSdidXR0b24nIG5nLWNsaWNrPVwicG9wb3Zlci5yZW1vdmUoJGV2ZW50KVwiIGNsYXNzPSdidG4gYnRuLWRhbmdlcicgdmFsdWU9J0RlbGV0ZScvPlxuICAgIDwvZGl2PlxuPC9mb3JtPiIKICAgICAgICB9KTsKICAgIH0KXSkKCmt1emVBcHAucnVuKGZ1bmN0aW9uKCRyb290U2NvcGUpIHsKICBsb2dEZWJ1ZygicnVuICRyb290U2NvcGUiKTsKICAkcm9vdFNjb3BlLiRvbignbG9hZGluZzpwcm9ncmVzcycsIGZ1bmN0aW9uICgpewogICAgICAvLyBzaG93IGxvYWRpbmcgZ2lmCiAgICAgIC8vICRzY29wZS5jdXJzb3JkZWxldGU9IndhaXQiOwogICAgICAvLyBkb2N1bWVudC5ib2R5LnN0eWxlLmN1cnNvcj0nd2FpdCc7CiAgfSk7CgogICRyb290U2NvcGUuJG9uKCdsb2FkaW5nOmZpbmlzaCcsIGZ1bmN0aW9uICgpewogICAgLy8gJHNjb3BlLmN1cnNvcmRlbGV0ZT0iIjsKICAgIC8vIGRvY3VtZW50LmJvZHkuc3R5bGUuY3Vyc29yPScnOwogIH0pOwp9KTsKCi8vIERFTEVURUQgLSB4ZWRpdGFibGUgc3R1ZmYKLy8ga3V6ZUFwcC5ydW4oZnVuY3Rpb24oZWRpdGFibGVPcHRpb25zLCBlZGl0YWJsZVRoZW1lcykgewovLyAgICAgbG9nRGVidWcoImluaXRpYWxpemluZyB4ZWRpdGFibGUgZWRpdGFibGVPcHRpb25zIik7Ci8vICAgICBlZGl0YWJsZU9wdGlvbnMudGhlbWUgPSAnYnMzJzsgLy8gYm9vdHN0cmFwMyB0aGVtZS4gQ2FuIGJlIGFsc28gJ2JzMicsICdkZWZhdWx0JwovLyAgICAgLy8gZWRpdGFibGVPcHRpb25zLmRlZmF1bHRzLm1vZGUgPSAnaW5saW5lJzsKLy8gICAgIGxvZ0RlYnVnKGVkaXRhYmxlT3B0aW9ucyk7Ci8vICAgICAvLyBlZGl0YWJsZU9wdGlvbnMubW9kZSA9ICdpbmxpbmUnOwovLyAgICAgZWRpdGFibGVUaGVtZXMuYnMzLmlucHV0Q2xhc3MgPSAnaW5wdXQtc20nOwovLyAgICAgZWRpdGFibGVUaGVtZXMuYnMzLmJ1dHRvbnNDbGFzcyA9ICdidG4tc20nOwovLyB9KTsKCi8vIGFmdGVyIGZvcm1zCi8vRGVmaW5lIFJvdXRpbmcgZm9yIGFwcAovL1VyaSAvQWRkTmV3T3JkZXIgLT4gdGVtcGxhdGUgYWRkX29yZGVyLmh0bWwgYW5kIENvbnRyb2xsZXIgQ2xpZW50c0FkZENvbnRyb2xsZXIKLy9VcmkgL1Nob3dPcmRlcnMgLT4gdGVtcGxhdGUgc2hvd19vcmRlcnMuaHRtbCBhbmQgQ29udHJvbGxlciBDbGllbnRzQWRkQ29udHJvbGxlcgprdXplQXBwLmNvbmZpZyhbJyRyb3V0ZVByb3ZpZGVyJywKICAgIGZ1bmN0aW9uKCRyb3V0ZVByb3ZpZGVyKSB7CiAgICAgICAgLy8gbG9nRGVidWcoJHJvdXRlUHJvdmlkZXIpOwogICAgICAgICRyb3V0ZVByb3ZpZGVyLgogICAgICAgIC8vIHdoZW4oJy9jbGllbnRjYXJkJywgewogICAgICAgIC8vICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19jbGllbnRfY2FyZC5odG1sJywKICAgICAgICAvLyAgICAgY29udHJvbGxlcjogJ2NsaWVudENhcmRDb250cm9sbGVyJwogICAgICAgIC8vIH0pLgogICAgICAgIHdoZW4oJy9jb250YWN0JywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdjb250YWN0LnBocCcsCiAgICAgICAgICAgIC8vIGNvbnRyb2xsZXI6ICdlbmRVc2VySG9tZUNvbnRyb2xsZXInCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdjb250YWN0Q29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvZXZlbnRfdHlwZXMnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2V2ZW50X3R5cGVzLmh0bWwnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnRXZlbnRUeXBlc0NvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2V2ZW50X3R5cGVzL2FkZCcsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfZXZlbnRfdHlwZV9hZGQucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0V2ZW50VHlwZU5ld0NvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2V2ZW50X3R5cGVzLzpldmVudF90eXBlX2lkJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19ldmVudF90eXBlX2FkZC5waHAnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnRXZlbnRUeXBlVXBkYXRlQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvaG91cnNfb2Zfd29yaycsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfaG91cnNfb2Zfd29yay5odG1sJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0hvdXJzT2ZXb3JrQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvYnVzaW5lc3NfY2FsZW5kYXInLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2NhbGVuZGFyLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdCdXNpbmVzc0NhbGVuZGFyQ29udHJvbGxlcicsCiAgICAgICAgICAgIHJlbG9hZE9uU2VhcmNoOiBmYWxzZQogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9hbmd1bGFyLWZvcm0tYnVpbGRlcicsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYW5ndWxhci1mb3JtLWJ1aWxkZXIvaW5kZXguaHRtbCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdEZW1vQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvYnVzaW5lc3NfY2xpZW50cy9hZGQnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2NsaWVudHNfYWRkLmh0bWwnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnQ2xpZW50c0FkZENvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2J1c2luZXNzX2NsaWVudHMnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2NsaWVudHMucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0NsaWVudHNTaG93Q29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvYnVzaW5lc3NfY2xpZW50cy86YnVzaW5lc3NfdXNlcl9pZCcsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6IGZ1bmN0aW9uKHBhcmFtcykgewogICAgICAgICAgICAgICAgcmV0dXJuICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfY2xpZW50X2NhcmQucGhwP2J1c2luZXNzX3VzZXJfaWQ9JyArIHBhcmFtcy5idXNpbmVzc191c2VyX2lkIDsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgY29udHJvbGxlcjogJ0NsaWVudHNTaG93MUNvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2J1c2luZXNzX3JlcG9ydHMnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX3JlcG9ydHMuaHRtbCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdCdXNpbmVzc1JlcG9ydHNDb250cm9sbGVyJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9idXNpbmVzc19pbnN0cnVjdG9ycycsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfaW5zdHJ1Y3RvcnMucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0luc3RydWN0b3JzU2hvd0NvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2J1c2luZXNzX2luc3RydWN0b3JzL2FkZCcsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfY2xpZW50c19hZGQuaHRtbCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdJbnN0cnVjdG9yc0FkZENvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2J1c2luZXNzX2xvY2F0aW9ucycsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbG9jYXRpb25zLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdidXNpbmVzc19sb2NhdGlvbnMnCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2J1c2luZXNzX2xvY2F0aW9ucy9hZGQnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2xvY2F0aW9uc19hZGQucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ2J1c2luZXNzX2xvY2F0aW9uc19hZGQnCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2J1c2luZXNzX2xvY2F0aW9ucy86bG9jYXRpb25faWQnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2xvY2F0aW9uc19hZGQucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ2J1c2luZXNzX2xvY2F0aW9uc191cGRhdGUnCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2J1c2luZXNzX2luc3RydWN0b3JzLzpidXNpbmVzc191c2VyX2lkJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19pbnN0cnVjdG9yX2NhcmQucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0luc3RydWN0b3JTaG93MUNvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2V2ZW50LzpldmVudF9pZCcsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6IGZ1bmN0aW9uKHBhcmFtcykgewogICAgICAgICAgICAgICAgcmV0dXJuICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfZXZlbnRfY2FyZC5waHA/ZXZlbnRfaWQ9JyArIHBhcmFtcy5ldmVudF9pZCA7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdFdmVudFBhZ2VDb250cm9sbGVyJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9ldmVudF9jbGFzcy86ZXZlbnRfaWQnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBmdW5jdGlvbihwYXJhbXMpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2V2ZW50X2NsYXNzX2NhcmQucGhwP2V2ZW50X2lkPScgKyBwYXJhbXMuZXZlbnRfaWQgOwogICAgICAgICAgICB9LAogICAgICAgICAgICBjb250cm9sbGVyOiAnRXZlbnRDbGFzc1BhZ2VDb250cm9sbGVyJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9wYWNrYWdlcycsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfcGFja2FnZXNfc2hvdy5waHAnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnUGFja2FnZXNDb250cm9sbGVyJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9wYWNrYWdlcy9hZGQnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX3BhY2thZ2VzX2NyZWF0ZS5waHAnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnYnVzaW5lc3NfcGFja2FnZXNfYWRkX2NudGwnCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL3BhY2thZ2VzLzpwYWNrYWdlX2lkJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19wYWNrYWdlc19jcmVhdGUucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ2J1c2luZXNzX3BhY2thZ2VzX3VwZGF0ZV9jbnRsJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9idXNpbmVzc19jb25maWcnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2NvbmZpZy5waHAnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnQ29uZmlnQnVzaW5lc3NDb250cm9sbGVyJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy91c2VyX2NvbmZpZycsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAndXNlcl9jb25maWcucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0NvbmZpZ1VzZXJDb250cm9sbGVyJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9idXNpbmVzc19kb2NzJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19kb2NzLmh0bWwnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnQnVzaW5lc3NEb2NzQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdob21lLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdIb21lQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICBvdGhlcndpc2UoewogICAgICAgICAgICAvLyAgICByZWRpcmVjdFRvOiAnLycKICAgICAgICB9KTsKICAgIH0KXSk7CgprdXplQXBwLmZhY3RvcnkoJ2h0dHBJbnRlcmNlcHRvcicsIFsnJHEnLCAnJHJvb3RTY29wZScsCiAgICBmdW5jdGlvbiAoJHEsICRyb290U2NvcGUpIHsKICAgICAgICB2YXIgbG9hZGluZ0NvdW50ID0gMDsKCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgcmVxdWVzdDogZnVuY3Rpb24gKGNvbmZpZykgewogICAgICAgICAgICAgICAgaWYoKytsb2FkaW5nQ291bnQgPT09IDEpICRyb290U2NvcGUuJGJyb2FkY2FzdCgnbG9hZGluZzpwcm9ncmVzcycpOwogICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpZyB8fCAkcS53aGVuKGNvbmZpZyk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICByZXNwb25zZTogZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICBpZigtLWxvYWRpbmdDb3VudCA9PT0gMCkgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdsb2FkaW5nOmZpbmlzaCcpOwogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlIHx8ICRxLndoZW4ocmVzcG9uc2UpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgcmVzcG9uc2VFcnJvcjogZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICBpZigtLWxvYWRpbmdDb3VudCA9PT0gMCkgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdsb2FkaW5nOmZpbmlzaCcpOwogICAgICAgICAgICAgICAgcmV0dXJuICRxLnJlamVjdChyZXNwb25zZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgfQpdKS5jb25maWcoWyckaHR0cFByb3ZpZGVyJywgZnVuY3Rpb24gKCRodHRwUHJvdmlkZXIpIHsKICAgICRodHRwUHJvdmlkZXIuaW50ZXJjZXB0b3JzLnB1c2goJ2h0dHBJbnRlcmNlcHRvcicpOwp9XSk7CgprdXplQXBwLmZhY3RvcnkoJ3NoYXJlZERhdGEnLCBmdW5jdGlvbigpIHsKICAgIHZhciBzZWxlY3RlZEVuZFVzZXIgPSBudWxsOwoKICAgIHJldHVybiB7CiAgICAgICAgZ2V0U2VsZWN0ZWRFbmRVc2VyOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgLy9Zb3UgY291bGQgYWxzbyByZXR1cm4gc3BlY2lmaWMgYXR0cmlidXRlIG9mIHRoZSBmb3JtIGRhdGEgaW5zdGVhZAogICAgICAgICAgICAvL29mIHRoZSBlbnRpcmUgZGF0YQogICAgICAgICAgICByZXR1cm4gc2VsZWN0ZWRFbmRVc2VyOwogICAgICAgIH0sCiAgICAgICAgc2V0U2VsZWN0ZWRFbmRVc2VyOiBmdW5jdGlvbihuZXdTZWxlY3RlZEVuZFVzZXIpIHsKICAgICAgICAgICAgLy9Zb3UgY291bGQgYWxzbyBzZXQgc3BlY2lmaWMgYXR0cmlidXRlIG9mIHRoZSBmb3JtIGRhdGEgaW5zdGVhZAogICAgICAgICAgICBzZWxlY3RlZEVuZFVzZXIgPSBuZXdTZWxlY3RlZEVuZFVzZXI7CiAgICAgICAgfSwKICAgIH07Cn0pOwoKa3V6ZUFwcC5kaXJlY3RpdmUoJ2NvbnZlcnRUb051bWJlcicsIGZ1bmN0aW9uKCkgewogIHJldHVybiB7CiAgICByZXF1aXJlOiAnbmdNb2RlbCcsCiAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWxlbWVudCwgYXR0cnMsIG5nTW9kZWwpIHsKICAgICAgbmdNb2RlbC4kcGFyc2Vycy5wdXNoKGZ1bmN0aW9uKHZhbCkgewogICAgICAgIHJldHVybiB2YWwgIT0gbnVsbCA/IHBhcnNlSW50KHZhbCwgMTApIDogbnVsbDsKICAgICAgfSk7CiAgICAgIG5nTW9kZWwuJGZvcm1hdHRlcnMucHVzaChmdW5jdGlvbih2YWwpIHsKICAgICAgICByZXR1cm4gdmFsICE9IG51bGwgPyAnJyArIHZhbCA6IG51bGw7CiAgICAgIH0pOwogICAgfQogIH07Cn0pOwoKa3V6ZUFwcC5kaXJlY3RpdmUoJ2VsYXN0aWMnLCBbCiAgICAnJHRpbWVvdXQnLAogICAgZnVuY3Rpb24oJHRpbWVvdXQpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICByZXN0cmljdDogJ0EnLAogICAgICAgICAgICBsaW5rOiBmdW5jdGlvbigkc2NvcGUsIGVsZW1lbnQpIHsKICAgICAgICAgICAgICAgICRzY29wZS5pbml0aWFsSGVpZ2h0ID0gJHNjb3BlLmluaXRpYWxIZWlnaHQgfHwgZWxlbWVudFswXS5zdHlsZS5oZWlnaHQ7CiAgICAgICAgICAgICAgICB2YXIgcmVzaXplID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgZWxlbWVudFswXS5zdHlsZS5oZWlnaHQgPSAkc2NvcGUuaW5pdGlhbEhlaWdodDsKICAgICAgICAgICAgICAgICAgICBlbGVtZW50WzBdLnN0eWxlLmhlaWdodCA9ICIiICsgZWxlbWVudFswXS5zY3JvbGxIZWlnaHQgKyAicHgiOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIGVsZW1lbnQub24oImlucHV0IGNoYW5nZSIsIHJlc2l6ZSk7CiAgICAgICAgICAgICAgICAvLyBlbGVtZW50Lm9uKCJpbnB1dCBjaGFuZ2UiLCByZXNpemUpOwogICAgICAgICAgICAgICAgJHRpbWVvdXQocmVzaXplLCAwKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICB9Cl0pOwoKa3V6ZUFwcC5zZXJ2aWNlKCdzaGFyZWRQcm9wZXJ0aWVzJywgZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBzZWxlY3RlZF91c2VyID0gbnVsbDsKICAgICAgICB2YXIgY2FsZW5kYXJfZGF0ZSA9IG51bGw7CiAgICAgICAgdmFyIGV2ZW50X3Jlc2NoZWR1bGUgPSBudWxsOwogICAgICAgIHZhciBzZWxlY3RlZF9pbnN0cnVjdG9yID0gMDsKICAgICAgICB2YXIgZXZlbnRfdHlwZV9mb3Jfc3VnZ2VzdGlvbnMgPSBudWxsOwogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGdldF9zZWxlY3RlZF9pbnN0cnVjdG9yOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZWN0ZWRfaW5zdHJ1Y3RvcjsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2V0X3NlbGVjdGVkX2luc3RydWN0b3I6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgICAgICAgICBzZWxlY3RlZF9pbnN0cnVjdG9yID0gdmFsdWU7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGdldF9zZWxlY3RlZF91c2VyOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZWN0ZWRfdXNlcjsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2V0X3NlbGVjdGVkX3VzZXI6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgICAgICAgICBzZWxlY3RlZF91c2VyID0gdmFsdWU7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNldF9ldmVudF9yZXNjaGVkdWxlOiBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgICAgICAgICAgZXZlbnRfcmVzY2hlZHVsZSA9IHZhbHVlOwogICAgICAgICAgICB9LAogICAgICAgICAgICBnZXRfZXZlbnRfcmVzY2hlZHVsZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGV2ZW50X3Jlc2NoZWR1bGU7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGdldF9jYWxlbmRhcl9kYXRlOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gY2FsZW5kYXJfZGF0ZTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2V0X2NhbGVuZGFyX2RhdGU6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgICAgICAgICBjYWxlbmRhcl9kYXRlID0gdmFsdWU7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGdldF9ldmVudF90eXBlX2Zvcl9zdWdnZXN0aW9uczogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGV2ZW50X3R5cGVfZm9yX3N1Z2dlc3Rpb25zOwogICAgICAgICAgICB9LAogICAgICAgICAgICBzZXRfZXZlbnRfdHlwZV9mb3Jfc3VnZ2VzdGlvbnM6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgICAgICAgICAvLyBsb2dEZWJ1Zygic2V0X2V2ZW50X3R5cGVfZm9yX3N1Z2dlc3Rpb25zPSIrdmFsdWUpOwogICAgICAgICAgICAgICAgZXZlbnRfdHlwZV9mb3Jfc3VnZ2VzdGlvbnMgPSB2YWx1ZTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICB9KTsKCmt1emVBcHAuY29udHJvbGxlcignbWVudUNvbnRyb2xsZXInLCBbJyRzY29wZScsICckbG9jYXRpb24nLCBmdW5jdGlvbigkc2NvcGUsICRsb2NhdGlvbikgewogICAgcmV0dXJuIHRydWU7CiAgICBsb2dEZWJ1ZygiJHNjb3BlLmlzQ3VycmVudFBhdGg9IiArICRzY29wZS5pc0N1cnJlbnRQYXRoKTsKICAgICRzY29wZS5pc0N1cnJlbnRQYXRoID0gZnVuY3Rpb24ocGF0aCkgewogICAgICAgIHJldHVybiAkbG9jYXRpb24ucGF0aCgpID09IHBhdGg7CiAgICB9Owp9XSk7CgoKCmt1emVBcHAuY29udHJvbGxlcignQnVzaW5lc3NSZXBvcnRzQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbiwkcm91dGVQYXJhbXMpCnsKCiAgbG9nRGVidWcoImNvbnRyb2xsZXI6IEJ1c2luZXNzUmVwb3J0c0NvbnRyb2xsZXIiKTsKCiAgJHNjb3BlLm9yZGVyQnlGaWVsZCA9ICdzdGFydF9lcG9jaCc7CiAgJHNjb3BlLnJldmVyc2VTb3J0PXRydWU7CiAgJHNjb3BlLmV2ZW50TW9kZWw9dHJ1ZTsKCiAgZ2V0QnVzaW5lc3NMb2NhdGlvbnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19sb2NhdGlvbnMnKTsKICBnZXRBbGxCdXNpbmVzc0V2ZW50VHlwZXMoJGh0dHAsJHNjb3BlLCdldmVudF90eXBlcycpOwogIGdldEFsbEluc3RydWN0b3JzKCRodHRwLCRzY29wZSwnaW5zdHJ1Y3RvcnMnKTsKICBnZXRBbGxDbGllbnRzQW5kQXJjaGl2ZSgkaHR0cCwkc2NvcGUsJ2NsaWVudHMnKTsKICAkc2NvcGUuc3RhdHVzZXMgPSBbIHsic3RhdHVzX2lkIjoiMCIsInN0YXR1c19uYW1lIjoi16TXqteV15cifSwgeyJzdGF0dXNfaWQiOiIxIiwic3RhdHVzX25hbWUiOiLXodeS15XXqCJ9XTsKICAkc2NvcGUuY2FuY2VsbGF0aW9ucyA9IFsgeyJpc19jYW5jZWxlZCI6IjAiLCJjYW5jZWxsYXRpb25fbmFtZSI6Itec15Ag15HXldeY15wifSx7ImlzX2NhbmNlbGVkIjoiMSIsImNhbmNlbGxhdGlvbl9uYW1lIjoi15HXldeY15wifV07CiAgJHNjb3BlLm1vbnRocyA9IFsgeyJtb250aCI6IjEifSx7Im1vbnRoIjoiMiJ9LHsibW9udGgiOiIzIn0seyJtb250aCI6IjQifSx7Im1vbnRoIjoiNSJ9LHsibW9udGgiOiI2In0seyJtb250aCI6IjcifSx7Im1vbnRoIjoiOCJ9LHsibW9udGgiOiI5In0seyJtb250aCI6IjEwIn0seyJtb250aCI6IjExIn0seyJtb250aCI6IjEyIn1dOwogICRzY29wZS55ZWFycyA9IFsgeyJ5ZWFyIjoiMjAxNiJ9LHsieWVhciI6IjIwMTcifV07CiAgJHNjb3BlLnBlcmlvZHMgPSBbCiAgICAgIHsicGVyaW9kX25hbWUiOiLXlNeZ16HXmNeV16jXmSIsICJwZXJpb2Rfc2lnbiI6Ii0xIn0sCiAgICAgIHsicGVyaW9kX25hbWUiOiLXlNeZ15XXnSIsICJwZXJpb2Rfc2lnbiI6IjAifSwKICAgICAgeyJwZXJpb2RfbmFtZSI6Itei16rXmdeT15kiLCAicGVyaW9kX3NpZ24iOiIxIn0sCiAgICBdCgogICRzY29wZS5jc3ZfY29sdW1uc19vcmRlciA9IFsnZXZlbnRfdHlwZV9uYW1lJywgJ3N0YXJ0X3RpbWUnLCAnZXZlbnRfdXNlcl9jbGllbnRzJywgJ2luc3RydWN0b3JfbmFtZScsICdpc19jYW5jZWxlZCcsICdpc19jb21wbGV0ZWQnLCAnYWN0dWFsX3ByaWNlJywgJ3BhcnRpY2lwYXRlZCddOwogICRzY29wZS5jc3ZfY29sdW1uc19oZWFkZXIgPSBbJ9eh15XXkiDXntek15LXqScsICfXqteQ16jXmdeaINeV16nXoteUJywgJ9ee16nXqteq16TXmdedJywgJ9ee15PXqNeZ15onLCfXnteR15XXmNecJywgJ9eh15LXldeoJywgJ9ee15fXmdeoJywgJ9ee16nXqteq16TXmdedJ107CgoKCiAgJHNjb3BlLmdvdG9DbGllbnRQYWdlPSBmdW5jdGlvbiAoYnVzaW5lc3NVc2VyaWQpIHsKICAgIGdvdG9DbGllbnRQYWdlKGJ1c2luZXNzVXNlcmlkKTsKICB9CgogIGZ1bmN0aW9uIGxpc3RfdG9fc3RyaW5nX2J5X3ZhbHVlKHgsdmFsdWUpewogICAgaWYgKCB4ICE9IHVuZGVmaW5lZCApewogICAgICB2YXIgeDEgPSBuZXcgQXJyYXkoKTsKICAgICAgZm9yIChpID0gMDsgaSA8IHgubGVuZ3RoOyBpKyspewogICAgICAgIHgxW2ldID0geFtpXVt2YWx1ZV07CiAgICAgIH0KICAgICAgeDEgPSB4MS5qb2luKCk7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICByZXR1cm4geDE7CiAgfQoKICAkc2NvcGUucmVwb3J0X2lzX2xvYWRpbmcgPSBmYWxzZTsKCiRzY29wZS5ldmVudHNSZXBvcnQgPSBmdW5jdGlvbigpewpsb2dEZWJ1ZygiZXZlbnRzUmVwb3J0Iik7Cgokc2NvcGUuc2hvd0FnZyA9ICgkc2NvcGUuZXZlbnRUeXBlTW9kZWwpIHx8Cigkc2NvcGUuaW5zdHJ1Y3Rvck1vZGVsKSB8fCAoJHNjb3BlLm1vbnRoTW9kZWwpIHx8ICgkc2NvcGUuY2xpZW50c01vZGVsKSB8fCAoJHNjb3BlLnllYXJNb2RlbCkgOwoKZXZlbnRfdHlwZV9pZF9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuc2VsZWN0ZWRFdmVudFR5cGVGaWx0ZXIsICJldmVudF90eXBlX2lkIiApOwppbnN0cnVjdG9yX2lkX2ZpbHRlciA9IGxpc3RfdG9fc3RyaW5nX2J5X3ZhbHVlKCRzY29wZS5zZWxlY3RlZEluc3RydWN0b3JGaWx0ZXIsICJidXNpbmVzc191c2VyX2lkIiApOwptb250aF9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuc2VsZWN0ZWRNb250aEZpbHRlciwgIm1vbnRoIiApOwpjbGllbnRfZmlsdGVyID0gbGlzdF90b19zdHJpbmdfYnlfdmFsdWUoJHNjb3BlLnNlbGVjdGVkQ2xpZW50RmlsdGVyLCAiYnVzaW5lc3NfdXNlcl9pZCIgKTsKeWVhcl9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuc2VsZWN0ZWRZZWFyRmlsdGVyLCAieWVhciIgKTsKc3RhdHVzX2ZpbHRlciA9IGxpc3RfdG9fc3RyaW5nX2J5X3ZhbHVlKCRzY29wZS5zZWxlY3RlZFN0YXR1c0ZpbHRlciwgInN0YXR1c19pZCIgKTsKaXNfY2FuY2VsZWRfZmlsdGVyID0gbGlzdF90b19zdHJpbmdfYnlfdmFsdWUoJHNjb3BlLnNlbGVjdGVkSXNfY2FuY2VsZWRGaWx0ZXIsICJpc19jYW5jZWxlZCIgKTsKcGVyaW9kX2ZpbHRlciA9IGxpc3RfdG9fc3RyaW5nX2J5X3ZhbHVlKCRzY29wZS5zZWxlY3RlZFBlcmlvZEZpbHRlciwgInBlcmlvZF9zaWduIiApOwoKJHNjb3BlLmV2ZW50UmVwb3J0Q29uZmlnID0ge307CgogICAgJHNjb3BlLmV2ZW50UmVwb3J0Q29uZmlnLnNvdXJjZSA9ICJkb2NzIjsKCiRzY29wZS5ldmVudFJlcG9ydENvbmZpZy5maWx0ZXJzID0gewpldmVudF90eXBlX2lkOiBldmVudF90eXBlX2lkX2ZpbHRlciwKaW5zdHJ1Y3Rvcl9pZDogaW5zdHJ1Y3Rvcl9pZF9maWx0ZXIsCm1vbnRoOiBtb250aF9maWx0ZXIsCnllYXI6IHllYXJfZmlsdGVyLApjbGllbnQ6IGNsaWVudF9maWx0ZXIsCnN0YXR1czogc3RhdHVzX2ZpbHRlciwKcGVyaW9kOiBwZXJpb2RfZmlsdGVyLAppc19jYW5jZWxlZDogaXNfY2FuY2VsZWRfZmlsdGVyCn07Cgokc2NvcGUuZXZlbnRSZXBvcnRDb25maWcuYWdncmVnYXRpb25zID0gewpldmVudF90eXBlX2lkOiAkc2NvcGUuZXZlbnRUeXBlTW9kZWwsCmluc3RydWN0b3JfaWQ6ICRzY29wZS5pbnN0cnVjdG9yTW9kZWwsCm1vbnRoOiAkc2NvcGUubW9udGhNb2RlbCwKeWVhcjogJHNjb3BlLnllYXJNb2RlbCwKY2xpZW50OiAkc2NvcGUuY2xpZW50TW9kZWwsCn07CgppZiAoICRzY29wZS5zaG93QWdnICkgewogICAgICBnZXRFdmVudHNSZXBvcnQoJGh0dHAsJHNjb3BlLCAkc2NvcGUuZXZlbnRSZXBvcnRDb25maWcsIGdldEV2ZW50c1JlcG9ydEFnZ3JlZ2F0ZWRfc3VjY2Vzcyk7CiRzY29wZS5yZXBvcnRfaXNfbG9hZGluZyA9IHRydWU7Cn0gZWxzZSB7CiAgICAgIGdldEV2ZW50c1JlcG9ydCgkaHR0cCwkc2NvcGUsICRzY29wZS5ldmVudFJlcG9ydENvbmZpZywgZ2V0RXZlbnRzUmVwb3J0TGlzdF9zdWNjZXNzKTsKJHNjb3BlLnJlcG9ydF9pc19sb2FkaW5nID0gdHJ1ZTsKfQoKZnVuY3Rpb24gZ2V0RXZlbnRzUmVwb3J0TGlzdF9zdWNjZXNzKHJlc3BvbnNlKXsKJHNjb3BlLkV2ZW50UmVwb3J0TGlzdCA9IHJlc3BvbnNlLmpzb247CiRzY29wZS5kb3dubG9hZF9yZXBvcnQgPSAkc2NvcGVbICdFdmVudFJlcG9ydExpc3QnIF07CiRzY29wZS5yZXBvcnRfaXNfbG9hZGluZyA9IGZhbHNlOwp9CgpmdW5jdGlvbiBnZXRFdmVudHNSZXBvcnRBZ2dyZWdhdGVkX3N1Y2Nlc3MocmVzcG9uc2Upewokc2NvcGUuRXZlbnRSZXBvcnRBZ2dyZWdhdGVkID0gcmVzcG9uc2UuanNvbjsKJHNjb3BlLmRvd25sb2FkX3JlcG9ydCA9ICRzY29wZVsgJ0V2ZW50UmVwb3J0QWdncmVnYXRlZCcgXTsKJHNjb3BlLnJlcG9ydF9pc19sb2FkaW5nID0gZmFsc2U7Cn0KCmZ1bmN0aW9uIGdldENsaWVudHNSZXBvcnRMaXN0X3N1Y2Nlc3MocmVzcG9uc2Upewokc2NvcGUuQ2xpZW50c1JlcG9ydExpc3QgPSByZXNwb25zZS5qc29uOwpjb25zb2xlLmxvZygiLS0tLS0tLS0tLS0tIikKY29uc29sZS5sb2coJHNjb3BlLkNsaWVudHNSZXBvcnRMaXN0KQpjb25zb2xlLmxvZygiLS0tLS0tLS0tLS0tIikKJHNjb3BlLnJlcG9ydF9pc19sb2FkaW5nID0gZmFsc2U7Cn0KCgp9Cgokc2NvcGUuY2xpZW50c1JlcG9ydCA9IGZ1bmN0aW9uKCl7CmxvZ0RlYnVnKCJjbGllbnRzUmVwb3J0Iik7CgpjbGllbnRfZmlsdGVyID0gbGlzdF90b19zdHJpbmdfYnlfdmFsdWUoJHNjb3BlLnNlbGVjdGVkQ2xpZW50RmlsdGVyLCAiY2xpZW50IiApOwoKJHNjb3BlLmV2ZW50UmVwb3J0Q29uZmlnID0ge307Cgokc2NvcGUuZXZlbnRSZXBvcnRDb25maWcuZmlsdGVycyA9IHsKY2xpZW50OiBjbGllbnRfZmlsdGVyLAp9OwoKJHNjb3BlLmV2ZW50UmVwb3J0Q29uZmlnLmFnZ3JlZ2F0aW9ucyA9IHsKfTsKCmdldENsaWVudHNSZXBvcnQoJGh0dHAsJHNjb3BlLCBnZXRDbGllbnRzUmVwb3J0X3N1Y2Nlc3MpOwokc2NvcGUucmVwb3J0X2lzX2xvYWRpbmcgPSB0cnVlOwpmdW5jdGlvbiBnZXRDbGllbnRzUmVwb3J0X3N1Y2Nlc3MocmVzcG9uc2Upewokc2NvcGUuY2xpZW50UmVwb3J0ID0gcmVzcG9uc2UuanNvbjsKJHNjb3BlLmRvd25sb2FkX3JlcG9ydCA9ICRzY29wZVsgJ2NsaWVudFJlcG9ydCcgXTsKJHNjb3BlLnJlcG9ydF9pc19sb2FkaW5nID0gZmFsc2U7Cn0KfQoKJHNjb3BlLmVkaXRFdmVudD0gZnVuY3Rpb24gKHRoZWV2ZW50KQp7CmdvdG9FdmVudFBhZ2UodGhlZXZlbnQpOwp9Cgokc2NvcGUuZXZlbnRzUmVwb3J0KCk7CiRzY29wZS5zZWxlY3RlZFJlcG9ydD0iZXZlbnRzIjsKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2J1c2luZXNzX3BhY2thZ2VzX3VwZGF0ZV9jbnRsJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uLCRyb3V0ZVBhcmFtcykKewokc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyID0ge307IC8vIHRoZXNlIGFyZSB0aGUgY29tcGxldGUgZGV0YWlscyBmb3IgdGhlIG5ldyBldmVudCAvLwokc2NvcGUucGFja2FnZV9pc191cGRhdGUgPSB0cnVlOwokc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLnBhY2thZ2VfbGltaXRfdHlwZT0xOwoKLy8gZ2V0dHRpbmcgdGhlIHBhY2thZ2UgYW5kIGl0cyBldmVudCB0eXBlcwpnZXRCdXNpbmVzc1BhY2thZ2UoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5wYWNrYWdlX2lkLCdmb3JtQWRkUGFja2FnZUFuZ3VsYXInLGZ1bmN0aW9uKHJlc3BvbnNlKQp7CiRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuaXNfdXBkYXRlID0gdHJ1ZTsKJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5vcmlnRXZlbnRUeXBlcz1hbmd1bGFyLmNvcHkoJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5zZWxlY3RlZEV2ZW50VHlwZXMpOwokc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLnBhY2thZ2VfbGltaXRfdHlwZT0xOwovLyB0aGVuIGdldHRpbmcgYWxsIHRoZSBldmVudCB0eXBlcwpnZXRFdmVudFR5cGVzTm9BZG1pbigkaHR0cCwkc2NvcGUsJ3JlbGF0ZWRFdmVudFR5cGVzJyxnZXRFdmVudFR5cGVzTm9BZG1pbl9zdWNjZXNzKTsKZnVuY3Rpb24gZ2V0RXZlbnRUeXBlc05vQWRtaW5fc3VjY2VzcygpCnsKLy8gdGhlbiByZW1vdmluZyBleGlzdGluZyBldmVudCB0eXBlcyBvZiBwYWNrYWdlIGZyb20gbGlzdAovLyBjb25zb2xlLmxvZygkc2NvcGUucmVsYXRlZEV2ZW50VHlwZXNbMF0pOwovLyBjb25zb2xlLmxvZygkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLnNlbGVjdGVkRXZlbnRUeXBlc1swXSk7CmZvcih2YXIgaSA9IDA7IGkgPCAkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLnNlbGVjdGVkRXZlbnRUeXBlcy5sZW5ndGg7IGkrKykKewovLyBjb3B5aW5nIHRoZSBhY3R1YWwgb2JqZWN0IG9mICRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuc2VsZWN0ZWRFdmVudFR5cGVzW2ldCmZvcih2YXIgaiA9IDA7IGogPCAkc2NvcGUucmVsYXRlZEV2ZW50VHlwZXMubGVuZ3RoOyBqKyspCnsKaWYgKCRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuc2VsZWN0ZWRFdmVudFR5cGVzW2ldLmV2ZW50X3R5cGVfaWQ9PSRzY29wZS5yZWxhdGVkRXZlbnRUeXBlc1tqXS5ldmVudF90eXBlX2lkKQp7CiRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuc2VsZWN0ZWRFdmVudFR5cGVzW2ldPWFuZ3VsYXIuY29weSgkc2NvcGUucmVsYXRlZEV2ZW50VHlwZXNbal0pOwp9Cn0KfQp9Cn0pOwokc2NvcGUuZ290b0JhY2sgPSBnb3RvQmFjazsKJHNjb3BlLmNyZWF0ZVBhY2thZ2UgPSBmdW5jdGlvbigpCnsKY29uc29sZS5sb2coInVwZGF0ZVBhY2thZ2VEZXRhaWxzIik7CnVwZGF0ZVBhY2thZ2VEZXRhaWxzKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMucGFja2FnZV9pZCwkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLHN1Y2Nlc3NfY2FsbGJhY2ssIGZhaWx1cmVfY2FsbGJhY2spOwpmdW5jdGlvbiBzdWNjZXNzX2NhbGxiYWNrKCkKewpnb3RvQmFjaygpOwp9CmZ1bmN0aW9uIGZhaWx1cmVfY2FsbGJhY2soKQp7CmdvdG9CYWNrKCk7Cn0KfTsKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2J1c2luZXNzX3BhY2thZ2VzX2FkZF9jbnRsJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uKSB7CmxvZ0RlYnVnKCdidXNpbmVzc19wYWNrYWdlc19hZGRfY250bCcpOwokc2NvcGUucGFja2FnZV9pc191cGRhdGUgPSBmYWxzZTsKJHNjb3BlLmdvdG9CYWNrID0gZ290b0JhY2s7CiRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIgPSB7fTsKJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5ldmVudHNfY291bnRlciA9IDE7CiRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuZXZlbnRzX3Blcl93ZWVrID0gMTsKJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5wYWNrYWdlX2R1cmF0aW9uX21vbnRocyA9IDM7CiRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIucGFja2FnZV9saW1pdF90eXBlPTE7CmdldEV2ZW50VHlwZXNOb0FkbWluKCRodHRwLCRzY29wZSwncmVsYXRlZEV2ZW50VHlwZXMnKTsKCiRzY29wZS5jcmVhdGVQYWNrYWdlID0gZnVuY3Rpb24oKQp7CmNyZWF0ZVBhY2thZ2UoJGh0dHAsJHNjb3BlLCRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIsY3JlYXRlUGFja2FnZV9zdWNjZXNzLCBjcmVhdGVQYWNrYWdlX2ZhaWx1cmUpOwpmdW5jdGlvbiBjcmVhdGVQYWNrYWdlX3N1Y2Nlc3MoKQp7CiRsb2NhdGlvbi5wYXRoKCcvcGFja2FnZXMnKTsKfQpmdW5jdGlvbiBjcmVhdGVQYWNrYWdlX2ZhaWx1cmUoKQp7Ci8vIGxvZ0Vycm9yKCJlcnJvciAiICsgZGF0YS5tZXNzYWdlKTsKLy8gJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5hamF4X2Vycm9yID0gZGF0YS5tZXNzYWdlOwp9Cn0KfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2J1c2luZXNzX2xvY2F0aW9ucycsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikgewpsb2dEZWJ1ZygnYnVzaW5lc3NfbG9jYXRpb25zIGNvbnRyb2xsZXInKTsKZ2V0QnVzaW5lc3NMb2NhdGlvbnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19sb2NhdGlvbnMnKTsKJHNjb3BlLmFkZE5ld0xvY2F0aW9uID0gZnVuY3Rpb24gKCkKewokbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2xvY2F0aW9ucy9hZGQnKTsKfQokc2NvcGUuZ290b0xvY2F0aW9uUGFnZSA9IGZ1bmN0aW9uKGxvY2F0aW9uX2lkKQp7CmdvdG9Mb2NhdGlvblBhZ2UobG9jYXRpb25faWQpOwp9Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignQnVzaW5lc3NEb2NzQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikgewpsb2dEZWJ1ZygnQnVzaW5lc3NEb2NzQ29udHJvbGxlcicpOwp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ2J1c2luZXNzX2xvY2F0aW9uc191cGRhdGUnLCBmdW5jdGlvbigkc2NvcGUsICRyb3V0ZVBhcmFtcywgJGh0dHAsICRsb2NhdGlvbikgewpsb2dEZWJ1ZygnYnVzaW5lc3NfbG9jYXRpb25zX3VwZGF0ZSBjb250cm9sbGVyJyk7CiRzY29wZS5pc191cGRhdGU9dHJ1ZTsKLy8gZ2V0QnVzaW5lc3NMb2NhdGlvbnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19sb2NhdGlvbnMnKTsKZ2V0QnVzaW5lc3NMb2NhdGlvbigkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmxvY2F0aW9uX2lkLCdjdXJyX2xvY2F0aW9uJyxnZXRCdXNpbmVzc0xvY2F0aW9uX3N1Y2Nlc3MpOwpmdW5jdGlvbiBnZXRCdXNpbmVzc0xvY2F0aW9uX3N1Y2Nlc3MoKQp7CiRzY29wZS5mb3JtQWRkTG9jYXRpb25Bbmd1bGFyPSRzY29wZS5jdXJyX2xvY2F0aW9uWzBdOwp9CgoKJHNjb3BlLmFkZExvY2F0aW9uID0gZnVuY3Rpb24oKQp7Ci8vIGluIHRoaXMgY2FzZSAtIHVwZGF0ZSBsb2NhdGlvbgp0aGVkYXRhID0gJHNjb3BlLmZvcm1BZGRMb2NhdGlvbkFuZ3VsYXI7CgpmdW5jdGlvbiBhZGRMb2NhdGlvbl9zdWNjZXNzKCkKewokbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2xvY2F0aW9ucycpOwp9CmZ1bmN0aW9uIGFkZExvY2F0aW9uX2ZhaWx1cmUoKQp7CiRzY29wZS5mb3JtQWRkTG9jYXRpb25Bbmd1bGFyLmFqYXhfZXJyb3IgPSByZXNwb25zZS5tZXNzYWdlOwp9CnVwZGF0ZUxvY2F0aW9uKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMubG9jYXRpb25faWQsIHRoZWRhdGEsYWRkTG9jYXRpb25fc3VjY2VzcyxhZGRMb2NhdGlvbl9mYWlsdXJlKTsKfQp9KTsKCmt1emVBcHAuY29udHJvbGxlcignYnVzaW5lc3NfbG9jYXRpb25zX2FkZCcsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikgewpsb2dEZWJ1ZygnYnVzaW5lc3NfbG9jYXRpb25zX2FkZCBjb250cm9sbGVyJyk7CmdldEJ1c2luZXNzTG9jYXRpb25zKCRodHRwLCRzY29wZSwnYnVzaW5lc3NfbG9jYXRpb25zJyk7CiRzY29wZS5pc191cGRhdGU9ZmFsc2U7Cgokc2NvcGUuYWRkTG9jYXRpb24gPSBmdW5jdGlvbigpCnsKdGhlZGF0YSA9ICRzY29wZS5mb3JtQWRkTG9jYXRpb25Bbmd1bGFyOwoKZnVuY3Rpb24gYWRkTG9jYXRpb25fc3VjY2VzcygpCnsKJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19sb2NhdGlvbnMnKTsKfQpmdW5jdGlvbiBhZGRMb2NhdGlvbl9mYWlsdXJlKCkKewokc2NvcGUuZm9ybUFkZExvY2F0aW9uQW5ndWxhci5hamF4X2Vycm9yID0gcmVzcG9uc2UubWVzc2FnZTsKfQphZGRMb2NhdGlvbigkaHR0cCwkc2NvcGUsdGhlZGF0YSxhZGRMb2NhdGlvbl9zdWNjZXNzLGFkZExvY2F0aW9uX2ZhaWx1cmUpOwp9Cn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdJbnN0cnVjdG9yc0FkZENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkbG9jYXRpb24pIHsKbG9nRGVidWcoJ0luc3RydWN0b3JzQWRkQ29udHJvbGxlcicpOwokc2NvcGUuaXNJbnN0cnVjdG9yPXRydWU7CiRzY29wZS51c2VydHlwZT0iaW5zdHJ1Y3RvciI7CiRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhciA9IHt9Owokc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIuaXNfdXBkYXRlPWZhbHNlOwokc2NvcGUuYWRkQ2xpZW50ID0gZnVuY3Rpb24oKSAvLyBhZGQgaW5zdHJ1Y3RvciwgdXNpbmcgdGhlIHNhbWUgZnVuY3Rpb24gbmFtZSBhcyB3ZSB1c2UgdGhlIHNhbWUgc2NyZWVuCnsKdGhlZGF0YSA9ICRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhcjsKCmZ1bmN0aW9uIGFkZEluc3RydWN0b3Jfc3VjY2VzcygpCnsKJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19pbnN0cnVjdG9ycycpOwp9CmZ1bmN0aW9uIGFkZENsaWVudF9mYWlsdXJlKCkKewokc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIuYWpheF9lcnJvciA9IHJlc3BvbnNlLm1lc3NhZ2U7Cn0KYWRkSW5zdHJ1Y3RvcigkaHR0cCwkc2NvcGUsdGhlZGF0YSxhZGRJbnN0cnVjdG9yX3N1Y2Nlc3MpOwp9Cn0pOwprdXplQXBwLmNvbnRyb2xsZXIoJ0NsaWVudHNBZGRDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJHRpbWVvdXQsICRsb2NhdGlvbiwgc2hhcmVkUHJvcGVydGllcykgewpsb2dEZWJ1ZygnQ2xpZW50c0FkZENvbnRyb2xsZXIgLSBUaGlzIGlzIEFkZCBuZXcgY2xpZW50IHNjcmVlbicpOwokc2NvcGUuaXNJbnN0cnVjdG9yPWZhbHNlOwoKJHNjb3BlLnVzZXJ0eXBlPSJlbmR1c2VyIjsKJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyID0ge307CiRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5pc191cGRhdGU9ZmFsc2U7CiRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5kaXNhYmxlX3Bob25lX2VkaXRpbmc9ZmFsc2U7CgppZiAoKCRzY29wZS5maWx0ZXIuVmFsdWUgIT0gIiIpICYmICh0eXBlb2YgJHNjb3BlLmZpbHRlci5WYWx1ZSAhPSAndW5kZWZpbmVkJykpIHsKbG9nRGVidWcoImNsaWVudHMgZmlsdGVyIGlzIG5vdCBlbXB0eSIpOwp2YXIgZmlsdGVyID0gU3RyaW5nKCRzY29wZS5maWx0ZXIuVmFsdWUpOwppZiAoZmlsdGVyLmluZGV4T2YoIiAiKSA+IDApIHsKJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyLmZpcnN0X25hbWUgPSBmaWx0ZXIuc3Vic3RyKDAsIGZpbHRlci5pbmRleE9mKCIgIikpOwokc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIubGFzdF9uYW1lID0gZmlsdGVyLnN1YnN0cigxICsgZmlsdGVyLmluZGV4T2YoIiAiKSk7Cn0gZWxzZSB7CiRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5maXJzdF9uYW1lID0gZmlsdGVyOwokc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIubGFzdF9uYW1lID0gIiI7Cn0KJHNjb3BlLmZpbHRlci5WYWx1ZSA9ICIiOwokc2NvcGUuZmlsdGVyLmJ1dHRvblZhbHVlID0gIiI7Cn0gZWxzZSB7Cn0KCiRzY29wZS5nb3RvQmFjayA9IGZ1bmN0aW9uKCkKewokbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2NsaWVudHMnKTsKfQoKJHNjb3BlLmFkZENsaWVudCA9IGZ1bmN0aW9uKCkKewp0aGVkYXRhID0gJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyOwoKZnVuY3Rpb24gYWRkQ2xpZW50X3N1Y2Nlc3ModXNlcl9pZCkKewppZiAoJHNjb3BlLnNhdmVfYW5kX3NjaGVkdWxlKQp7Ci8vICRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfY2xpZW50cy8nK3VzZXJfaWQuanNvbik7CmxvZ0RlYnVnKCJORVcgdXNlciB1c2VyX2lkPSIrdXNlcl9pZC5qc29uKTsKCnVzZXJfaW5mbz0gewpidXNpbmVzc191c2VyX2lkOiB1c2VyX2lkLmpzb24sCmJ1c2VyX2ZpcnN0X25hbWU6ICRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5idXNlcl9maXJzdF9uYW1lLApidXNlcl9sYXN0X25hbWU6ICRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5idXNlcl9sYXN0X25hbWUKfTsKCnNoYXJlZFByb3BlcnRpZXMuc2V0X3NlbGVjdGVkX3VzZXIodXNlcl9pbmZvKTsKJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jYWxlbmRhcicpOwoKfQplbHNlCnsKJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jbGllbnRzLycpOwp9CmNvbnNvbGUubG9nKCJuZXcgdXNlciBpZCA9ICIrdXNlcl9pZC5qc29uKTsKfQpmdW5jdGlvbiBhZGRDbGllbnRfZmFpbHVyZShyZXNwb25zZSkKewokc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIuYWpheF9lcnJvciA9IHJlc3BvbnNlLm1lc3NhZ2U7CiR0aW1lb3V0KGZ1bmN0aW9uKCkKewokc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIuYWpheF9lcnJvcj1udWxsOwp9LCAyNTAwKTsKfQphZGRDbGllbnQoJGh0dHAsJHNjb3BlLHRoZWRhdGEsYWRkQ2xpZW50X3N1Y2Nlc3MsIGFkZENsaWVudF9mYWlsdXJlLGZhbHNlKTsKfQp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ1BhY2thZ2VzQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikgewpsb2dEZWJ1ZygnUGFja2FnZXNDb250cm9sbGVyJyk7CmdldEJ1c2luZXNzUGFja2FnZXMoJGh0dHAsJHNjb3BlLCdwYWNrYWdlcycpOwoKJHNjb3BlLnNob3dQYWNrYWdlID0gZnVuY3Rpb24gKHRoZXBhY2thZ2UpCnsKJGxvY2F0aW9uLnBhdGgoJy9wYWNrYWdlcy8nK3RoZXBhY2thZ2UucGFja2FnZV9pZCk7Cn0KfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdJbnN0cnVjdG9yc1Nob3dDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uKSB7CmxvZ0RlYnVnKCdJbnN0cnVjdG9yc1Nob3dDb250cm9sbGVyJyk7CiRzY29wZS5vcmRlckJ5RmllbGQgPSAnYnVzZXJfc3RhcnRfZGF0ZSc7CiRzY29wZS5yZXZlcnNlU29ydD10cnVlOwoKZ2V0QWxsSW5zdHJ1Y3RvcnMoJGh0dHAsJHNjb3BlLCdhbGxDbGllbnRzJyxnZXRBbGxJbnN0cnVjdG9yc19zdWNjZXNzKTsKZnVuY3Rpb24gZ2V0QWxsSW5zdHJ1Y3RvcnNfc3VjY2VzcygpCnsKJHNjb3BlLnNob3dDbGllbnRzR3JpZE9wdGlvbnMuZGF0YT0kc2NvcGUuYWxsQ2xpZW50czsKfQoKJHNjb3BlLmdvdG9JbnN0cnVjdG9yUGFnZT0gZnVuY3Rpb24gKGJ1c2luZXNzX3VzZXJfaWQpCnsKZ290b0luc3RydWN0b3JQYWdlKGJ1c2luZXNzX3VzZXJfaWQpOwp9Cgokc2NvcGUuY2xpZW50TmFtZUZpbHRlcj0iIjsKJHNjb3BlLmlucHV0RmlsdGVyID0gZnVuY3Rpb24gKGl0ZW0pCnsKLy8gY29uc29sZS5sb2coaXRlbS5idXNlcl9waG9uZV9udW1iZXIpOwpyZXR1cm4gZmlsdGVyX2ZpcnN0bGFzdF9uYW1lKGl0ZW0uYnVzZXJfZmlyc3RfbmFtZSxpdGVtLmJ1c2VyX2xhc3RfbmFtZSxpdGVtLmJ1c2VyX3Bob25lX251bWJlciwkc2NvcGUuY2xpZW50TmFtZUZpbHRlcik7Cn07Cn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdDbGllbnRzU2hvd0NvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICR1aWJNb2RhbCwgJGh0dHAsICRsb2NhdGlvbikgewpsb2dEZWJ1ZygnQ2xpZW50c1Nob3dDb250cm9sbGVyJyk7CiRzY29wZS5vcmRlckJ5RmllbGQgPSAnYnVzZXJfc3RhcnRfZGF0ZSc7CiRzY29wZS5yZXZlcnNlU29ydD10cnVlOwoKZ2V0QWxsQ2xpZW50cygkaHR0cCwkc2NvcGUsJ2FsbENsaWVudHMnLGdldENsaWVudF9zdWNjZXNzKTsKZnVuY3Rpb24gZ2V0Q2xpZW50X3N1Y2Nlc3MoKQp7CiRzY29wZS5zaG93Q2xpZW50c0dyaWRPcHRpb25zLmRhdGE9JHNjb3BlLmFsbENsaWVudHM7Cn0KCiRzY29wZS5nb3RvQ2xpZW50UGFnZT0gZnVuY3Rpb24gKGJ1c2luZXNzVXNlcmlkKQp7CmdvdG9DbGllbnRQYWdlKGJ1c2luZXNzVXNlcmlkKTsKfQoKLy8gZmlsdGVyIGFyY2hpdmVkIGNsaWVudHMKJHNjb3BlLnNob3dBcmNoaXZlZENoZWNrYm94PWZhbHNlOwokc2NvcGUuc2hvd0FyY2hpdmVkID0gZnVuY3Rpb24gKGVjbGllbnQpCnsKaWYgKGVjbGllbnQuaXNfYWN0aXZlPT0wKQp7CmxvZ0RlYnVnKGVjbGllbnQpOwppZiAoJHNjb3BlLnNob3dBcmNoaXZlZENoZWNrYm94KQp7CnJldHVybiBlY2xpZW50Owp9Cn0KZWxzZSB7CnJldHVybiBlY2xpZW50Owp9Cn07Cgokc2NvcGUuY2xpZW50TmFtZUZpbHRlcj0iIjsKJHNjb3BlLmlucHV0RmlsdGVyID0gZnVuY3Rpb24gKGl0ZW0pCnsKICAgICAgLy8gY29uc29sZS5sb2coImNsaWVudE5hbWVGaWx0ZXIiKTsKcmV0dXJuIGZpbHRlcl9maXJzdGxhc3RfbmFtZShpdGVtLmJ1c2VyX2ZpcnN0X25hbWUsaXRlbS5idXNlcl9sYXN0X25hbWUsaXRlbS5idXNlcl9waG9uZV9udW1iZXIsJHNjb3BlLmNsaWVudE5hbWVGaWx0ZXIpOwp9OwoKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXM9W107Ci8vICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzID0gWwovLyAgIHsiZmllbGRfaWQiOjAsImZpZWxkX25hbWUiOiLXqteQ16jXmdeaINec15nXk9eUIiwiZmllbGRfZGF0YXR5cGUiOiJEQVRFIiwiaXNfbWFuZGF0b3J5IjowLCAiZnJvbWRiIjogZmFsc2UsICJkYl9pZF90b2ZpeCI6IDAsICJpc19hY3RpdmUiOiAxLCAibW9kaWZpZWQiOiBmYWxzZX0sCi8vICAgeyJmaWVsZF9pZCI6MCwiZmllbGRfbmFtZSI6IteU16LXqNeV16oiLCJmaWVsZF9kYXRhdHlwZSI6IlRFWFRfQVJFQSIsImlzX21hbmRhdG9yeSI6MCwgImZyb21kYiI6IGZhbHNlLCAiZGJfaWRfdG9maXgiOiAwLCAiaXNfYWN0aXZlIjogMSwgIm1vZGlmaWVkIjogZmFsc2V9Ci8vIF07CgpmdW5jdGlvbiBnZXRDbGllbnRzRXh0cmFGaWVsZHNfc3VjY2VzcygpCnsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMgPSAkc2NvcGUuZXh0cmFGaWVsZHM7Cn0KZ2V0Q2xpZW50c0V4dHJhRmllbGRzKCRodHRwLCRzY29wZSwnZXh0cmFGaWVsZHMnLGdldENsaWVudHNFeHRyYUZpZWxkc19zdWNjZXNzKTsKCiRzY29wZS5ldmVudFR5cGVFeHRyYUZpZWxkc1BvcCA9IGZ1bmN0aW9uKGV2ZW50VHlwZVByb3BlcnRpZXMpIHsKICAgICAgICBsb2dEZWJ1ZygiZXZlbnRUeXBlRXh0cmFGaWVsZHNQb3AzIik7Cgp2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKYW5pbWF0aW9uOiBmYWxzZSwKdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfY2xpZW50X2V4dHJhX2ZpZWxkcy5waHAnLApjb250cm9sbGVyOiAnZXZlbnRUeXBlRXh0cmFGaWVsZHNNb2RhbENvbnRyb2xsZXInLApzaXplOiAnbCcsCnJlc29sdmU6IHsKZXZlbnRUeXBlUHJvcGVydGllczogZnVuY3Rpb24oKSB7CnJldHVybiBldmVudFR5cGVQcm9wZXJ0aWVzOwp9Cn0KfSk7Cgptb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHNlbGVjdGVkSXRlbSkgewpsb2dEZWJ1ZyhzZWxlY3RlZEl0ZW0pOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyA9IHNlbGVjdGVkSXRlbTsKfSwgZnVuY3Rpb24oKSB7CmxvZ0RlYnVnKCdNb2RhbCBkaXNtaXNzZWQgYXQ6ICcgKyBuZXcgRGF0ZSgpKTsKfSk7Cn07Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignc2NoZWR1bGVyQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRyb3V0ZVBhcmFtcykgewpldmVudF90eXBlX2lkPSRyb3V0ZVBhcmFtcy5ldmVudF90eXBlX2lkOwoKJHNjb3BlLnN1Z2dlc3Rpb25EYXRlID0gW107CiRzY29wZS5zdWdnZXN0aW9uRGF0ZS5kYXRlID0gbmV3IERhdGUoKTsKJHNjb3BlLnN1Z2dlc3Rpb25EYXRlLm9wdGlvbnMgPSB7Ci8vIG1pbkRhdGU6IG5ldyBEYXRlKCksCi8vIHNob3dXZWVrczogdHJ1ZSwKbWluVmlldzonZGF5JywKc3RhcnRWaWV3OiAnZGF5JwoKfTsKdmFyIHRoZXRpbWUgPSBuZXcgRGF0ZSgpOwokc2NvcGUuZmlsdGVyQWxsRGF5c0NoZWNrYm94PXRydWU7CiRzY29wZS5maWx0ZXJEYXlJdGVtcyA9IHsKCifXqNeQ16nXldefJzogdHJ1ZSwKJ9ep16DXmSc6IHRydWUsCifXqdec15nXqdeZJzogdHJ1ZSwKJ9eo15HXmdei15knOiB0cnVlLAon15fXnteZ16nXmSc6IHRydWUsCifXqdeZ16nXmSc6IHRydWUsCifXqdeR16onOiB0cnVlCn07Cgokc2NvcGUub25UaW1lU2V0ID0gZnVuY3Rpb24gKG5ld0RhdGUsIG9sZERhdGUpIHsKbG9nRGVidWcoIm5ldyBkYXRlICIrbmV3RGF0ZS5nZXRUaW1lKCkgKyAiIG9sZCBkYXRlICIrb2xkRGF0ZS5nZXRUaW1lKCkpOwpkaWZmPW5ld0RhdGUuZ2V0VGltZSgpLW9sZERhdGUuZ2V0VGltZSgpOwovLyBpZiBuZXcgZGF0ZSBpcyBpbiBhIGRpZmZlcmVudCB3ZWVrCi8vIHdlIHJlZmV0Y2ggc3VnZ2VzdGlvbnMgZm9yIHRoZSBjdXJyZW50IHdlZWsKdmFyIG5ld0RhdGVXID0gbmV3IERhdGUobmV3RGF0ZSk7CnZhciBvbGREYXRlVyA9IG5ldyBEYXRlKG9sZERhdGUpOwovLyBhbGVydChuZXdEYXRlVy5mb3JtYXQoJ1cnKSk7Ci8vIGFsZXJ0KG9sZERhdGVXLmZvcm1hdCgnVycpKTsKaWYgKG5ld0RhdGVXLmZvcm1hdCgnVycpIT1vbGREYXRlVy5mb3JtYXQoJ1cnKSkKewpsb2dEZWJ1ZygiZGlmZiBpcyBhIHdlZWsgb3IgbW9yZSwgcmVmZXRjaGluZyBzdWdnZXN0aW9ucyIpOwokaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3QvIitldmVudF90eXBlX2lkKyIvIituZXdEYXRlLmdldEZ1bGxZZWFyKCkrIi8iKyhuZXdEYXRlLmdldE1vbnRoKCkrMSkrIi8iK25ld0RhdGUuZ2V0RGF0ZSgpKyIvIituZXdEYXRlLmdldEhvdXJzKCkgKyAiLyIgKyBuZXdEYXRlLmdldE1pbnV0ZXMoKSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkgewovLwkgICAgJHNjb3BlLm15RGF0YSA9IHJlc3BvbnNlLmRhdGE7Ci8vCQlsb2dEZWJ1ZygiZ3JpZG9wdGlvbnM9Iiskc2NvcGUuZ3JpZE9wdGlvbnMpOwokc2NvcGUuZXZlbnRzU3VnZ2VzdGVkID0gcmVzcG9uc2UuZGF0YTsKfSk7Cgp9Cn0KCiRzY29wZS5vcHRpb25zID0gewpjdXN0b21DbGFzczogZ2V0RGF5Q2xhc3MsCm1pbkRhdGU6IG5ldyBEYXRlKCksCnNob3dXZWVrczogdHJ1ZQp9Owokc2NvcGUuZHQgPSBuZXcgRGF0ZSgpOwoKCmZ1bmN0aW9uIGdldERheUNsYXNzKGRhdGEpIHsKcmV0dXJuICcnOwp9Cgokc2NvcGUuZGF5c0l0ZW1zID0gWwp7bmFtZTon16jXkNep15XXnyd9LAp7bmFtZTon16nXoNeZJ30sCntuYW1lOifXqdec15nXqdeZJ30sCntuYW1lOifXqNeR15nXoteZJ30sCntuYW1lOifXl9ee15nXqdeZJ30sCntuYW1lOifXqdeZ16nXmSd9LAp7bmFtZTon16nXkdeqJ30KXTsKCiRzY29wZS5maWx0ZXJBbGxEYXlJdGVtc1NldCA9IGZ1bmN0aW9uICgpCnsKJHNjb3BlLmZpbHRlckRheUl0ZW1zWyfXqNeQ16nXldefJ109JHNjb3BlLmZpbHRlckFsbERheXNDaGVja2JveDsKJHNjb3BlLmZpbHRlckRheUl0ZW1zWyfXqdeg15knXT0kc2NvcGUuZmlsdGVyQWxsRGF5c0NoZWNrYm94Owokc2NvcGUuZmlsdGVyRGF5SXRlbXNbJ9ep15zXmdep15knXT0kc2NvcGUuZmlsdGVyQWxsRGF5c0NoZWNrYm94Owokc2NvcGUuZmlsdGVyRGF5SXRlbXNbJ9eo15HXmdei15knXT0kc2NvcGUuZmlsdGVyQWxsRGF5c0NoZWNrYm94Owokc2NvcGUuZmlsdGVyRGF5SXRlbXNbJ9eX157Xmdep15knXT0kc2NvcGUuZmlsdGVyQWxsRGF5c0NoZWNrYm94Owokc2NvcGUuZmlsdGVyRGF5SXRlbXNbJ9ep15nXqdeZJ109JHNjb3BlLmZpbHRlckFsbERheXNDaGVja2JveDsKJHNjb3BlLmZpbHRlckRheUl0ZW1zWyfXqdeR16onXT0kc2NvcGUuZmlsdGVyQWxsRGF5c0NoZWNrYm94Owp9Cgokc2NvcGUuc3VnZ2VzdEZpbHRlckRheXMgPSBmdW5jdGlvbiAoZXN1Z2dlc3QpCnsKLy8gbG9nRGVidWcoZXN1Z2dlc3QpOwppZiAoKCRzY29wZS5maWx0ZXJEYXlJdGVtc1tlc3VnZ2VzdC5zdGFydF9mb3JtYXRfZG93XSkgJiAoKCRzY29wZS5zdWdnZXN0aW9uRGF0ZS5kYXRlLmdldFRpbWUoKS8xMDAwKTxlc3VnZ2VzdC5zdGFydF9lcG9jaCkpCnsKcmV0dXJuIGVzdWdnZXN0Owp9Cn07Cgpsb2dEZWJ1Zygnc2NoZWR1bGVyQ29udHJvbGxlciBmb3IgZXZlbnQgdHlwZSBpZCAnK2V2ZW50X3R5cGVfaWQrIiAiK3RoZXRpbWUuZ2V0SG91cnMoKSArICI6IiArIHRoZXRpbWUuZ2V0TWludXRlcygpICsgIjoiICsgdGhldGltZS5nZXRTZWNvbmRzKCkpOwokaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3QvIitldmVudF90eXBlX2lkKyIvIit0aGV0aW1lLmdldEZ1bGxZZWFyKCkrIi8iKyh0aGV0aW1lLmdldE1vbnRoKCkrMSkrIi8iK3RoZXRpbWUuZ2V0RGF0ZSgpKyIvIit0aGV0aW1lLmdldEhvdXJzKCkgKyAiLyIgKyB0aGV0aW1lLmdldE1pbnV0ZXMoKSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkgewovLwkgICAgJHNjb3BlLm15RGF0YSA9IHJlc3BvbnNlLmRhdGE7Ci8vCQlsb2dEZWJ1ZygiZ3JpZG9wdGlvbnM9Iiskc2NvcGUuZ3JpZE9wdGlvbnMpOwokc2NvcGUuZXZlbnRzU3VnZ2VzdGVkID0gcmVzcG9uc2UuZGF0YTsKfSk7CgokaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRfdHlwZXMvIitldmVudF90eXBlX2lkKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7Ci8vCSAgICAkc2NvcGUubXlEYXRhID0gcmVzcG9uc2UuZGF0YTsKLy8JCWxvZ0RlYnVnKCJncmlkb3B0aW9ucz0iKyRzY29wZS5ncmlkT3B0aW9ucyk7CiRzY29wZS5ldmVudFR5cGVEZXRhaWxzID0gcmVzcG9uc2UuZGF0YTsKfSk7Cn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdjb250YWN0Q29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHApIHsKbG9nRGVidWcoJ2NvbnRhY3RDb250cm9sbGVyJyk7Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcigncGFja2FnZVBheW1lbnRBc3NvY2lhdGlvbk1vZGFsQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHJvdXRlUGFyYW1zLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIGZwYWNrYWdlLCBiYWxhbmNlLCBidXNpbmVzc191c2VyX2lkLCB1aUNhbGVuZGFyQ29uZmlnKQp7CmxvZ0RlYnVnKCJwYWNrYWdlUGF5bWVudEFzc29jaWF0aW9uTW9kYWxDb250cm9sbGVyIik7Cgokc2NvcGUuZnBhY2thZ2U9ZnBhY2thZ2U7CiRzY29wZS5iYWxhbmNlPWJhbGFuY2U7CiRzY29wZS5wYWNrYWdlX3BheW1lbnRzPSRzY29wZS5mcGFja2FnZS5wYWNrYWdlX3BheW1lbnRzOwokc2NvcGUucHJldmlvdXNfaXNfYWxsX3BhaWQ9JHNjb3BlLmZwYWNrYWdlLmlzX2FsbF9wYWlkOwokc2NvcGUuYnVzaW5lc3NfdXNlcl9pZD1idXNpbmVzc191c2VyX2lkOwoKLy8gJ2NhbGN1bGF0aW5nJyBwcmV2aW91cyBzdGF0dXMgb2YgcGF5bWVudAppZiAoJHNjb3BlLnBhY2thZ2VfcGF5bWVudHM+MCkKewppZiAoJHNjb3BlLnByZXZpb3VzX2lzX2FsbF9wYWlkPT0xKQp7CiRzY29wZS5wcmV2aW91c19zdGF0dXM9ImlzX2FsbF9wYWlkIjsKJHNjb3BlLnBhY2thZ2Vfc3RhdHVzX2lkPS0xOwokc2NvcGUucHJldmlvdXNfcGFja2FnZV9zdGF0dXNfaWQ9LTE7Cn0KZWxzZQp7CiRzY29wZS5wcmV2aW91c19zdGF0dXM9ImlzX3BhcnRseV9wYWlkIjsKJHNjb3BlLnBhY2thZ2Vfc3RhdHVzX2lkPS0xOwokc2NvcGUucHJldmlvdXNfcGFja2FnZV9zdGF0dXNfaWQ9LTE7Cn0KfQplbHNlCnsKJHNjb3BlLnByZXZpb3VzX3N0YXR1cz0ibm90X3BhaWQiOwokc2NvcGUucGFja2FnZV9zdGF0dXNfaWQ9MDsKJHNjb3BlLnByZXZpb3VzX3BhY2thZ2Vfc3RhdHVzX2lkPTA7Cgp9CmxvZ0RlYnVnKCJwcmV2aW91c19zdGF0dXM9Iiskc2NvcGUucHJldmlvdXNfc3RhdHVzKTsKCiRzY29wZS5jbG9zZU1vZGFsID0gZnVuY3Rpb24oKQp7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKfTsKJHNjb3BlLnVwZGF0ZVBhY2thZ2VQYXltZW50ID0gZnVuY3Rpb24oKQp7Ci8vIGNvbnNvbGUubG9nKCJwcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ9Iiskc2NvcGUuZm1lZXRpbmcucHJldmlvdXNfcGFja2FnZV91c2VyX2lkKTsKLy8gY29uc29sZS5sb2coInBhY2thZ2VfdXNlcl9pZD0iKyRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQpOwpsb2dEZWJ1ZygidXBkYXRlUGFja2FnZVBheW1lbnQiKQovLyBpZiBzZWxlY3RlZCBwYWNrYWdlIGlzIGxpa2UgcHJldmlvdXMgcGFja2FnZSAtIGRvIG5vdGhpbmcKaWYgKCgkc2NvcGUucHJldmlvdXNfcGFja2FnZV9zdGF0dXNfaWQ9PSRzY29wZS5wYWNrYWdlX3N0YXR1c19pZCkpCnsKbG9nRGVidWcoInNlbGVjdGVkIG9wdGlvbiBpcyBsaWtlIHByZXZpb3VzIG9wdGlvbiAtIGRvIG5vdGhpbmciKTsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwp9CgovLyBwcmV2aW91cyBwYWNrYWdlIHdhcyBwYWlkL3BhcnRseS1wYWlkIC0gbm93IG5vdGhpbmdzIGlzIHNlbGVjdGVkCmVsc2UgaWYgKCgkc2NvcGUucHJldmlvdXNfcGFja2FnZV9zdGF0dXNfaWQ9PS0xKSAmJiAoJHNjb3BlLnBhY2thZ2Vfc3RhdHVzX2lkPT0wKSkKewpsb2dEZWJ1Zygid2FzIHBhaWQvcGFydGx5IHBhaWQsIHJlbW92aW5nIHBheW1lbnQiKTsKcmVtb3ZlUGFja2FnZVBheW1lbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5mcGFja2FnZS5wYWNrYWdlX3VzZXJfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwp9Ci8vIHByZXZpb3VzIHBhY2thZ2Ugd2FzIHNlbGVjdGVkIC0gbm93IGEgZGlmZmVyZW50IHBhY2thZ2UgaXMgc2VsZWN0ZWQKZWxzZSBpZiAoKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3N0YXR1c19pZD09MCkgJiYgKCRzY29wZS5wYWNrYWdlX3N0YXR1c19pZD09LTEpKQp7CmxvZ0RlYnVnKCJ3YXMgbm90IHBhaWQgLSBub3cgcGF5IGZ1bGx5L3BhcnRpYWxseSIpOwpwYXlGb3JQYWNrYWdlKCRodHRwLCRzY29wZSwkc2NvcGUuZnBhY2thZ2UucGFja2FnZV91c2VyX2lkLCRzY29wZS5idXNpbmVzc191c2VyX2lkLHVwZGF0ZUV2ZW50UGFja2FnZV9zdWNjZXNzKTsKCi8vIHJlYXNzaWduRXZlbnRQYWNrYWdlQXNzb2NpYXRpb24oJGh0dHAsJHNjb3BlLCRzY29wZS5mbWVldGluZy5ldmVudF9pZCwkc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkLCRzY29wZS5idXNpbmVzc191c2VyX2lkLHVwZGF0ZUV2ZW50UGFja2FnZV9zdWNjZXNzKTsKfQp9CgpmdW5jdGlvbiB1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2VzcygpCnsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwpsb2dEZWJ1ZygiYnJvYWRjYXN0aW5nIGNsaWVudFBhZ2VSZWxvYWREYXRhIik7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKfQoKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2V2ZW50UGFja2FnZUFzc29jaWF0aW9uTW9kYWxDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkcm91dGVQYXJhbXMsICRyb290U2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgZm1lZXRpbmcsIGJhbGFuY2UsIGJ1c2luZXNzX3VzZXJfaWQsIHVpQ2FsZW5kYXJDb25maWcpCnsKJHNjb3BlLmZtZWV0aW5nPWFuZ3VsYXIuY29weShmbWVldGluZyk7CiRzY29wZS5iYWxhbmNlPWJhbGFuY2U7CiRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ9JHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZDsKJHNjb3BlLnByZXZpb3VzX2V2ZW50X3BheW1lbnRzPSRzY29wZS5mbWVldGluZy5ldmVudF9wYXltZW50czsKJHNjb3BlLnByZXZpb3VzX2lzX2FsbF9wYWlkPSRzY29wZS5mbWVldGluZy5pc19hbGxfcGFpZDsKJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQ9YnVzaW5lc3NfdXNlcl9pZDsKCi8vICdjYWxjdWxhdGluZycgcHJldmlvdXMgc3RhdHVzIG9mIHBheW1lbnQKaWYgKCRzY29wZS5wcmV2aW91c19ldmVudF9wYXltZW50cz4wKQp7CmlmICgkc2NvcGUucHJldmlvdXNfaXNfYWxsX3BhaWQ9PTEpCnsKJHNjb3BlLnByZXZpb3VzX3N0YXR1cz0iaXNfYWxsX3BhaWQiOwp9CmVsc2UKewokc2NvcGUucHJldmlvdXNfc3RhdHVzPSJpc19wYXJ0bHlfcGFpZCI7Cn0KfQplbHNlCnsKaWYgKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ+MCkKewokc2NvcGUucHJldmlvdXNfc3RhdHVzPSJpc19wYWNrYWdlX3BhaWQiOwp9CmVsc2UKewokc2NvcGUucHJldmlvdXNfc3RhdHVzPSJub3RfcGFpZCI7Cn0KfQpsb2dEZWJ1ZygicHJldmlvdXNfc3RhdHVzPSIrJHNjb3BlLnByZXZpb3VzX3N0YXR1cyk7CgppZiAoKCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQ9PTApICYmICgkc2NvcGUuZm1lZXRpbmcuZXZlbnRfcGF5bWVudHM+MCkpCnsKLy8gdGhpcyBpcyBhIGNhc2Ugd2hlcmUgcGF5bWVudCB3YXMgcGFydGx5IG9yIGZ1bGx5IG1hZGUgZnJvbSBiYWxhbmNlCiRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQ9LTE7CiRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ9LTE7Cn0KCmxvZ0RlYnVnKCJldmVudFBhY2thZ2VBc3NvY2lhdGlvbk1vZGFsQ29udHJvbGxlciIpOwpnZXRQYWNrYWdlc0ZvckV2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJ3JlbGF0ZWRQYWNrYWdlcycsZ2V0UGFja2FnZXNGb3JFdmVudF9zdWNjZXNzKTsgLy8gd2FzIGdldEJ1c2luZXNzUGFja2FnZQpmdW5jdGlvbiBnZXRQYWNrYWdlc0ZvckV2ZW50X3N1Y2Nlc3MoKQp7Cn0KCiRzY29wZS5jbG9zZU1vZGFsID0gZnVuY3Rpb24oKQp7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKfTsKJHNjb3BlLnVwZGF0ZUV2ZW50UGFja2FnZSA9IGZ1bmN0aW9uKCkKewpjb25zb2xlLmxvZygicHJldmlvdXNfcGFja2FnZV91c2VyX2lkPSIrJHNjb3BlLmZtZWV0aW5nLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZCk7CmNvbnNvbGUubG9nKCJwYWNrYWdlX3VzZXJfaWQ9Iiskc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkKTsKLy8gaWYgc2VsZWN0ZWQgcGFja2FnZSBpcyBsaWtlIHByZXZpb3VzIHBhY2thZ2UgLSBkbyBub3RoaW5nCmlmICgoJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD09JHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZCkpCnsKbG9nRGVidWcoInNlbGVjdGVkIG9wdGlvbiBpcyBsaWtlIHByZXZpb3VzIG9wdGlvbiAtIGRvIG5vdGhpbmciKTsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwp9Ci8vIGlmIHNlbGVjdGVkIHBhY2thZ2UgaXMgbGlrZSBwcmV2aW91cyBwYWNrYWdlIC0gZG8gbm90aGluZwppZiAoKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ9PSRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQpICYmICgkc2NvcGUucHJldmlvdXNfcGFja2FnZV91c2VyX2lkPjApKQp7CmxvZ0RlYnVnKCJzZWxlY3RlZCBwYWNrYWdlIGlzIGxpa2UgcHJldmlvdXMgcGFja2FnZSAtIGRvIG5vdGhpbmciKTsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwp9Ci8vIHByZXZpb3VzIHBhY2thZ2Ugd2FzIHNlbGVjdCAtIG5vdyBub3RoaW5ncyBpcyBzZWxlY3RlZAplbHNlIGlmICgoJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD4wKSAmJiAoJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZD09MCkpCnsKbG9nRGVidWcoIm5vIHBhY2thZ2Ugc2VsZWN0ZWQsIHJlbW92ZSBwYWNrYWdlLWV2ZW50IGFzc29jaWF0aW9uIik7CnJlbW92ZUV2ZW50UGFja2FnZUFzc29jaWF0aW9uKCRodHRwLCRzY29wZSwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwp9Ci8vIHByZXZpb3VzIHBhY2thZ2Ugd2FzIHNlbGVjdGVkIC0gbm93IGEgZGlmZmVyZW50IHBhY2thZ2UgaXMgc2VsZWN0ZWQKZWxzZSBpZiAoKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ+MCkgJiYgKCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQ+MCkpCnsKbG9nRGVidWcoInVwZGF0aW5nIG5ldyBwYWNrYWdlIHRvIHBhY2thZ2VfdXNlcl9pZD0gIiskc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkKTsKcmVhc3NpZ25FdmVudFBhY2thZ2VBc3NvY2lhdGlvbigkaHR0cCwkc2NvcGUsJHNjb3BlLmZtZWV0aW5nLmV2ZW50X2lkLCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwp9Ci8vIHByZXZpb3VzIHBhY2thZ2Ugd2FzIG5vbmUgLSBub3cgYSBwYWNrYWdlIGlzIHNlbGVjdGVkCmVsc2UgaWYgKCgkc2NvcGUucHJldmlvdXNfcGFja2FnZV91c2VyX2lkPT0wKSAmJiAoJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZD4wKSkKewpsb2dEZWJ1ZygidXBkYXRpbmcgbmV3IHBhY2thZ2UgdG8gcGFja2FnZV91c2VyX2lkPSAiKyRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQpOwpyZWFzc2lnbkV2ZW50UGFja2FnZUFzc29jaWF0aW9uKCRodHRwLCRzY29wZSwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZCwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCx1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2Vzcyk7Cn0KLy8gcHJldmlvdXMgYXNzb2NpYXRpb24gd2FzIHBhaWQgb3IgaGFsZiBwYWlkIC0gbm93IGl0cyBub25lCmVsc2UgaWYgKCgkc2NvcGUucHJldmlvdXNfZXZlbnRfcGF5bWVudHM+MCkgJiYgKCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQ9PTApKQp7CmxvZ0RlYnVnKCJyZW1vdmluZyBwYXltZW50IGZyb20gZXZlbnQsIHBhY2thZ2VfdXNlcl9pZD0gIiskc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkKTsKcmVtb3ZlRXZlbnRQYXltZW50QXNzb2NpYXRpb24oJGh0dHAsJHNjb3BlLCRzY29wZS5mbWVldGluZy5ldmVudF9pZCwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCx1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2Vzcyk7CgovLyByZWFzc2lnbkV2ZW50UGFja2FnZUFzc29jaWF0aW9uKCRodHRwLCRzY29wZSwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZCwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCx1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2Vzcyk7Ci8vIHRvZG8KfQovLyB3YXMgcGFja2FnZSBwYXltZW50IC0+IG5vdyBiYWxhbmNlIHBheW1lbnQKZWxzZSBpZiAoKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ+MCkgJiYgKCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQ9PS0xKSkKewpsb2dEZWJ1ZygibW92aW5nIHBheW1lbnQgZnJvbSBwYWNrYWdlIHRvIGJhbGFuY2UiKTsKYWRkRXZlbnRQYXltZW50UmVtb3ZlUGFja2FnZSgkaHR0cCwkc2NvcGUsJHNjb3BlLmZtZWV0aW5nLmV2ZW50X2lkLCRzY29wZS5idXNpbmVzc191c2VyX2lkLHVwZGF0ZUV2ZW50UGFja2FnZV9zdWNjZXNzKTsKfQovLyB3YXMgYmFsYW5jZSBwYXltZW50IC0+IG5vdyBwYWNrYWdlIHBheW1lbnQKZWxzZSBpZiAoKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ9PS0xKSAmJiAoJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZD4wKSkKewpsb2dEZWJ1ZygibW92aW5nIHBheW1lbnQgZnJvbSBiYWxhbmNlIHRvIHBhY2thZ2UiKTsKYWRkRXZlbnRQYWNrYWdlUmVtb3ZlUGF5bWVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLmZtZWV0aW5nLmV2ZW50X2lkLCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwoKfQovLyB3YXMgbm90IHBhaWQgYXQgYWxsIC0+IG5vdyBiYWxhbmNlIHBheQplbHNlIGlmICgoJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD09MCkgJiYgKCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQ9PS0xKSkKewpsb2dEZWJ1ZygibW92aW5nIHBheW1lbnQgZnJvbSBub25lIHRvIGJhbGFuY2UiKTsKYWRkRXZlbnRQYXltZW50QXNzb2NpYXRpb24oJGh0dHAsJHNjb3BlLCRzY29wZS5mbWVldGluZy5ldmVudF9pZCwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCx1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2Vzcyk7Cn0KfQoKZnVuY3Rpb24gdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MoKQp7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKbG9nRGVidWcoImJyb2FkY2FzdGluZyBjbGllbnRQYWdlUmVsb2FkRGF0YSIpOwokcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NsaWVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCn0KCn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignYXJjaGl2ZV9jbGllbnRfbW9kYWwnLCBmdW5jdGlvbigkc2NvcGUsICRsb2NhdGlvbiwgaXNfaW5zdHJ1Y3RvciwgYnVzaW5lc3NfdXNlcl9pZCwgYnVzZXJfZmlyc3RfbmFtZSwgYnVzZXJfbGFzdF9uYW1lLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIHVpQ2FsZW5kYXJDb25maWcpIHsKJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQ9YnVzaW5lc3NfdXNlcl9pZDsKJHNjb3BlLmJ1c2VyX2ZpcnN0X25hbWU9YnVzZXJfZmlyc3RfbmFtZTsKJHNjb3BlLmJ1c2VyX2xhc3RfbmFtZT1idXNlcl9sYXN0X25hbWU7CiRzY29wZS5pc19pbnN0cnVjdG9yPWlzX2luc3RydWN0b3I7Cgpsb2dEZWJ1ZygiYXJjaGl2ZV9jbGllbnRfbW9kYWwgY29udHJvbGxlciIpOwoKJHNjb3BlLmNsb3NlTW9kYWwgPSBmdW5jdGlvbigpIHsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwp9OwoKJHNjb3BlLmFyY2hpdmVDbGllbnQgPSBmdW5jdGlvbigpCnsKYXJjaGl2ZUNsaWVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsYXJjaGl2ZUNsaWVudF9zdWNjZXNzKTsKZnVuY3Rpb24gYXJjaGl2ZUNsaWVudF9zdWNjZXNzKCkKewokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CmlmICgkc2NvcGUuaXNfaW5zdHJ1Y3RvcikKewokbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2luc3RydWN0b3JzJyk7Cn0KZWxzZSB7CiRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfY2xpZW50cycpOwp9Cn0KfQoKfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdwYXltZW55RGV0YWlsc01vZGFsQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHJvdXRlUGFyYW1zLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIGZwYXltZW50LCB1aUNhbGVuZGFyQ29uZmlnKSB7CiRzY29wZS5mcGF5bWVudD17fTsKJHNjb3BlLmZwYXltZW50LnBheW1lbnRfZGF0ZT1mcGF5bWVudC5wYXltZW50X2RhdGU7CiRzY29wZS5mcGF5bWVudC5wYXltZW50X2Ftb3VudD1mcGF5bWVudC5wYXltZW50X2Ftb3VudDsKJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZ2VuZXJhdGVkPWZwYXltZW50Lmludm9pY2VfZ2VuZXJhdGVkOwokc2NvcGUuZnBheW1lbnQuaW52b2ljZV9udW1iZXI9ZnBheW1lbnQuaW52b2ljZV9udW1iZXI7CmlmIChmcGF5bWVudC5pbnZvaWNlX2RhdGU9PW51bGwpCnsKJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZV9mb3JtYXQ9bmV3IERhdGUoKTsKfQplbHNlCnsKJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZV9mb3JtYXQ9ZnBheW1lbnQuaW52b2ljZV9kYXRlX2Zvcm1hdDsKfQokc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlPWZwYXltZW50Lmludm9pY2VfZGF0ZTsKJHNjb3BlLnNlbGVjdGVkUGF5bWVudE1ldGhvZD17Cm5hbWU6IGZwYXltZW50LnBheW1lbnRfbWV0aG9kX25hbWVfdHh0LAptZXRob2Q6IGZwYXltZW50LnBheW1lbnRfbWV0aG9kX25hbWUKfTsKJHNjb3BlLmlzUGF5bWVudE1ldGhvZFNlbGVjdGVkPXRydWU7Cgpsb2dEZWJ1Zygib2xkIGRhdGUgIiskc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlKTsKaWYgKCRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2RhdGUhPW51bGwpCnsKJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZV9mb3JtYXQgPSBuZXcgRGF0ZSgkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlKTsKfQokc2NvcGUucGF5bWVudE1ldGhvZHMgPSBwYXltZW50TWV0aG9kczsKJHNjb3BlLnBheW1lbnRUeXBlVGl0bGU9ZnBheW1lbnQucGF5bWVudF9tZXRob2RfbmFtZV90eHQ7CiRzY29wZS5mcGF5bWVudC5pbnZvaWNlX3NvdXJjZT0iRVhURVJOQUwiOwoKbG9nRGVidWcoJHNjb3BlLnBheW1lbnRNZXRob2RzKTsKbG9nRGVidWcoInBheW1lbnlEZXRhaWxzTW9kYWxDb250cm9sbGVyIGZvciBwYXltZW50ICIrSlNPTi5zdHJpbmdpZnkoZnBheW1lbnQsIG51bGwsIDQpKTsKCiRzY29wZS5zZWxlY3RQYXltZW50TWV0aG9kID0gZnVuY3Rpb24ocGF5bWVudCkgewokc2NvcGUucGF5bWVudFR5cGVUaXRsZT1wYXltZW50Lm5hbWU7CmxvZ0RlYnVnKCJwYXltZW50PSIrcGF5bWVudCk7Cgokc2NvcGUuc2VsZWN0ZWRQYXltZW50TWV0aG9kPXBheW1lbnQ7CiRzY29wZS5pc1BheW1lbnRNZXRob2RTZWxlY3RlZD10cnVlOwp9OwoKJHNjb3BlLmNsb3NlTW9kYWwgPSBmdW5jdGlvbigpIHsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwp9OwoKJHNjb3BlLnVwZGF0ZVBheW1lbnQgPSBmdW5jdGlvbigpCnsKLy8gbG9nRGVidWcoY3VycmVudENsaWVudCk7CmxvZ0RlYnVnKCJwYXltZW50IG1ldGhvZCIpOwpsb2dEZWJ1Zygkc2NvcGUuc2VsZWN0ZWRQYXltZW50TWV0aG9kKTsKbG9nRGVidWcoIiRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2dlbmVyYXRlZD08Iiskc2NvcGUuZnBheW1lbnQuaW52b2ljZV9nZW5lcmF0ZWQrIj4sICRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2RhdGVfZm9ybWF0PSIrJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZV9mb3JtYXQpOwpsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkUGF5bWVudE1ldGhvZC5tZXRob2Q9Iiskc2NvcGUuc2VsZWN0ZWRQYXltZW50TWV0aG9kLm1ldGhvZCk7CmlmICgoJHNjb3BlLmZwYXltZW50LnBheW1lbnRfYW1vdW50PT0wKSB8fCAoJHNjb3BlLmZwYXltZW50LnBheW1lbnRfYW1vdW50PT0nJykgfHwgKCRzY29wZS5mcGF5bWVudC5wYXltZW50X2Ftb3VudD09bnVsbCkpCnsKJHNjb3BlLnVzZXJFcnJvcj0i15DXoNeQINeU15bXnyDXodeb15XXnSDXm9ec16nXlNeVIjsKLy8gYWxlcnQoJ3NzJyk7Cn0KZWxzZSBpZiAoISRzY29wZS5pc1BheW1lbnRNZXRob2RTZWxlY3RlZCkKewokc2NvcGUudXNlckVycm9yPSLXkNeg15Ag15HXl9eoINeQ157Xptei15kg16rXqdec15XXnSI7Ci8vIGFsZXJ0KCdzcycpOwp9CmVsc2UKewppZiAoKCRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2dlbmVyYXRlZCE9MSkgfHwgKCRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2RhdGVfZm9ybWF0PT1udWxsKSkKewp2YXIgaW52b2ljZV9kYXRlX2Zvcm1hdCA9ICJudWxsIjsKfQplbHNlCnsKdmFyIGludm9pY2VfZGF0ZV9mb3JtYXQgPSAkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlX2Zvcm1hdC5nZXREYXRlKCkgICsgIi0iICsgKCRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2RhdGVfZm9ybWF0LmdldE1vbnRoKCkrMSkgKyAiLSIgKyAkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlX2Zvcm1hdC5nZXRGdWxsWWVhcigpOwp9CnRoZWRhdGE9IHsKYmFsYW5jZVRvUGF5OiAkc2NvcGUuZnBheW1lbnQucGF5bWVudF9hbW91bnQsCnBheW1lbnRfbWV0aG9kX25hbWU6ICRzY29wZS5zZWxlY3RlZFBheW1lbnRNZXRob2QubWV0aG9kLAppbnZvaWNlX251bWJlcjogJHNjb3BlLmZwYXltZW50Lmludm9pY2VfbnVtYmVyLAppbnZvaWNlX2dlbmVyYXRlZDogJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZ2VuZXJhdGVkLAppbnZvaWNlX2RhdGU6IGludm9pY2VfZGF0ZV9mb3JtYXQsCmludm9pY2Vfc291cmNlOiAkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9zb3VyY2UKfTsKdXBkYXRlUGF5bWVudEZvckNsaWVudCgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsZnBheW1lbnQudXNlcl9wYXltZW50X2lkLHRoZWRhdGEsY3JlYXRlUGF5bWVudEZvckNsaWVudF9jYWxsYmFjaywgY3JlYXRlUGF5bWVudEZvckNsaWVudF9mYWlsdXJlKTsKZnVuY3Rpb24gY3JlYXRlUGF5bWVudEZvckNsaWVudF9jYWxsYmFjaygpCnsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwpsb2dEZWJ1ZygiYnJvYWRjYXN0aW5nIGNsaWVudFBhZ2VSZWxvYWREYXRhIik7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKfQpmdW5jdGlvbiBjcmVhdGVQYXltZW50Rm9yQ2xpZW50X2ZhaWx1cmUoKQp7CmxvZ0RlYnVnKCJicm9hZGNhc3RpbmcgY2xpZW50UGFnZVJlbG9hZERhdGEiKTsKLy8gJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwp9Cn0KfQp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ2V2ZW50VHlwZUV4dHJhRmllbGRzTW9kYWxDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIGV2ZW50VHlwZVByb3BlcnRpZXMsIHVpQ2FsZW5kYXJDb25maWcpIHsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXM9ZXZlbnRUeXBlUHJvcGVydGllczsKICBsb2dEZWJ1ZygiZXZlbnRUeXBlRXh0cmFGaWVsZHNNb2RhbENvbnRyb2xsZXI9IitKU09OLnN0cmluZ2lmeShldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzLCBudWxsLCA0KSk7CmlmIChldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzPT1udWxsKQp7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzT3JpZz1bXTsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHM9W107Cn0KZWxzZSBpZiAoZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcy5sZW5ndGg+MCkKewokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllc09yaWc9KGV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMpLnNsaWNlKDApOwp9CmVsc2UKewokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllc09yaWc9W107CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzPVtdOwp9CiRzY29wZS5va0xpbWl0YXRpb25Nb2RhbCA9IGZ1bmN0aW9uKCkgewokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7Cn07Cgokc2NvcGUuY2FuY2VsID0gZnVuY3Rpb24oKQp7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzPSRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzT3JpZzsKbG9nRGVidWcoImNsb3NlIik7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzT3JpZyk7Cn0KJHNjb3BlLnNhdmVBbmRDbG9zZSA9IGZ1bmN0aW9uKCkKewpsb2dEZWJ1Zygic2F2ZSBhbmQgY2xvc2UiKTsKZnVuY3Rpb24gc2V0Q2xpZW50c0V4dHJhRmllbGRzX3N1Y2Nlc3MoKQp7Cgp9CiRzY29wZS5DbGllbnRzRGV0YWlscz17fTsKJHNjb3BlLkNsaWVudHNEZXRhaWxzLmV4dHJhRmllbGRzPSRzY29wZS5leHRyYUZpZWxkczsKc2V0Q2xpZW50c0V4dHJhRmllbGRzKCRodHRwLCRzY29wZSwkc2NvcGUuQ2xpZW50c0RldGFpbHMsc2V0Q2xpZW50c0V4dHJhRmllbGRzX3N1Y2Nlc3MpOwokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyk7Cn0KCiAgJHNjb3BlLmR1cGxpY2F0ZUZpZWxkTmFtZXM9IiI7CiRzY29wZS5hZGRFeHRyYUZpZWxkcyA9IGZ1bmN0aW9uKCkKewogICAgbG9nRGVidWcoImFkZEV4dHJhRmllbGRzIHZhbGlkYXRpbmciKTsKICAgIC8vIGNoZWNraW5nIGZvciBkdXBsaWNhdGUgbmFtZXMKICAgIHZhciBleHRyYUZpZWxkc05hbWVzID0gW107CiAgICBmb3IgKHZhciBpPTE7IGk8JHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMubGVuZ3RoOyBpKyspCiAgICB7CiAgICAgIGV4dHJhRmllbGRzTmFtZXMucHVzaCgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkc1tpXS5maWVsZF9uYW1lKTsKICAgIH0KICAgIGV4dHJhRmllbGRzTmFtZXMuc29ydCgpOwogICAgdmFyIGxhc3QgPSBleHRyYUZpZWxkc05hbWVzWzBdOwogICAgZm9yICh2YXIgaT0xOyBpPGV4dHJhRmllbGRzTmFtZXMubGVuZ3RoOyBpKyspCiAgICB7CiAgICAgICBpZiAoZXh0cmFGaWVsZHNOYW1lc1tpXSA9PSBsYXN0KQogICAgICAgewogICAgICAgIC8vICBhbGVydCgnRHVwbGljYXRlIDogJytsYXN0KTsKICAgICAgICAgJHNjb3BlLmR1cGxpY2F0ZUZpZWxkTmFtZXM9J9en15nXmdedINep15PXlCDXm9ek15XXnCDXkdep150gIicrbGFzdCsnIi4uLic7CiAgICAgICAgIHJldHVybjsKICAgICAgIH0KICAgICAgIGxhc3QgPSBleHRyYUZpZWxkc05hbWVzW2ldOwogICAgfQokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyk7Cn0KCiRzY29wZS5leHRyYUZpZWxkcyA9IGV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHM7CiRzY29wZS5maWVsZFR5cGVzID0gW3tmaWVsZF9kYXRhdHlwZTogIlRFWFRfQVJFQSIsIG5hbWU6J9eq15nXkdeqINeY16fXodeYJ30sIHtmaWVsZF9kYXRhdHlwZTogIk5VTUJFUiIsIG5hbWU6J9ee16HXpNeoJ30gLCB7ZmllbGRfZGF0YXR5cGU6ICJTVFJJTkciLCBuYW1lOifXmNen16HXmCDXp9em16gnfSAsIHtmaWVsZF9kYXRhdHlwZTogIkJPT0xFQU4iLCBuYW1lOifXqteZ15HXqiDXodeZ157XldefJ30gLCB7ZmllbGRfZGF0YXR5cGU6ICJEQVRFIiwgbmFtZTon16rXkNeo15nXmid9XTsKCiRzY29wZS5hZGROZXdGaWVsZCA9IGZ1bmN0aW9uKCkgewp2YXIgbmV3SXRlbU5vID0gJHNjb3BlLmV4dHJhRmllbGRzLmxlbmd0aCsxOwokc2NvcGUuZXh0cmFGaWVsZHMucHVzaCh7ImZpZWxkX2RhdGF0eXBlIjoiU1RSSU5HIiwiaXNfbWFuZGF0b3J5IjowLCAiZnJvbWRiIjogZmFsc2UsICJmaWVsZF9pZCI6IDAsICJpc19hY3RpdmUiOiAxLCAibW9kaWZpZWQiOiAwfSk7CgogICAgbG9nRGVidWcoImV4dHJhIGZpZWxkczogIiArIEpTT04uc3RyaW5naWZ5KCRzY29wZS5leHRyYUZpZWxkcywgbnVsbCwgMikpOwoKfTsKCiRzY29wZS5yZW1vdmVGaWVsZCA9IGZ1bmN0aW9uKGNob2ljZSkKewovLyByZW1vdmluZyBmaWVsZAovLyBpZiBpdHMgbm90IG9yaWdpbmF0ZWQgZnJvbSBkYXRhYmFzZSAtIHRoZW4gd2Ugc2ltcGx5IGRlbGV0ZSBpdCBmcm9tIHRoZSBhcnJheQovLyBvdGhlcndpc2Ugd2UgbWFyayBpdCBhcyBhY3RpdmU9ZmFsc2UKbG9nRGVidWcoY2hvaWNlKTsKLy8gdmFyIGxhc3RJdGVtID0gKGNob2ljZS5pZCktMTsvLyRzY29wZS5jaG9pY2VzLmxlbmd0aC0xOwovLyAkc2NvcGUuY2hvaWNlcy5zcGxpY2UobGFzdEl0ZW0sMSk7CmZvcih2YXIgaSA9IDA7IGkgPCAkc2NvcGUuZXh0cmFGaWVsZHMubGVuZ3RoOyBpKyspCnsKaWYgKCRzY29wZS5leHRyYUZpZWxkc1tpXSA9PSBjaG9pY2UpCnsKaWYgKGNob2ljZS5mcm9tZGI9PWZhbHNlKQp7Ci8vIGlmIG5vdCBmcm9tIGRiIC0gcmVtb3ZpbmcgaXQgZnJvbSB0aGUgYXJyYXkgb2YgZXh0cmEtZmllbGRzCiRzY29wZS5leHRyYUZpZWxkcy5zcGxpY2UoaSwgMSk7Cn0KZWxzZQp7Ci8vIGlmIGZpZWxkIG9yaWdpbmF0ZWQgZnJvbSBkYiAtIHRoYW4gd2UgZG9udCByZW1vdmUgaXQgZnJvbSB0aGUgYXJyYXkKLy8gYW5kIG1hcmsgaXQgYXMgYWN0aXZlPWZhbHNlIHNvIHRoYXQgaXQgY2FuIGJlIGhhbmRlbGVkIG9uIHRoZSBzZXJ2ZXIKY2hvaWNlLmlzX2FjdGl2ZT0wOwpjaG9pY2UubW9kaWZpZWQ9dHJ1ZTsKfQpicmVhazsKfQp9Cn07Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignZXZlbnRDbG9zZUlnbm9yZU1hbmRhdG9yeUZpZWxkc01vZGFsQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHJvdXRlUGFyYW1zLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIGN1cnJlbnRFdmVudCwgdWlDYWxlbmRhckNvbmZpZykgewokc2NvcGUuY3VycmVudEV2ZW50PWN1cnJlbnRFdmVudDsKCiRzY29wZS5va0NhbmNlbCA9IGZ1bmN0aW9uKCkgewokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7Cn07Cgokc2NvcGUuY2xvc2VFdmVudElnbm9yZU1hbmRhdG9yeUZpZWxkcyA9IGZ1bmN0aW9uKCkKewpsb2dEZWJ1ZygiaWdub3JlIG1hbmRhdG9yeSBleHRyYSBmaWVsZHMgYW5kIGNsb3NlIGV2ZW50Iik7CiRzY29wZS5jdXJyZW50RXZlbnQuaWdub3JlRXh0cmFGaWVsZHNWYWxpZGF0aW9uPXRydWU7CmNsb3NlRXZlbnQoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCwkc2NvcGUuY3VycmVudEV2ZW50LGFmdGVyQ2xvc2VFdmVudCxhZnRlckNsb3NlRXZlbnQpOwpmdW5jdGlvbiBhZnRlckNsb3NlRXZlbnQoKQp7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgnZXZlbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7Cn07Cn0KfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdldmVudFR5cGVDaGFuZ2VkUG9wdXBDb250cm9sbGVyJywgZnVuY3Rpb24oJGxvY2F0aW9uLCAkc2NvcGUsICRyb3V0ZVBhcmFtcywgJHJvb3RTY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRodHRwLCBldmVudFR5cGVQcm9wZXJ0aWVzLCB1aUNhbGVuZGFyQ29uZmlnKSB7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzPWV2ZW50VHlwZVByb3BlcnRpZXM7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLnVwZGF0ZWRfZnJvbV9kYXRlPW5ldyBEYXRlKCk7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLnVwZGF0ZV9leGlzdGluZ19ldmVudHM9ZmFsc2U7Cgokc2NvcGUuY2xvc2VNb2RhbCA9IGZ1bmN0aW9uKCkgewokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7Cn07Cgokc2NvcGUudXBkYXRlRXZlbnRUeXBlID0gZnVuY3Rpb24oKQp7CmxvZ0RlYnVnKCJ1cGRhdGUgRXZlbnQgVHlwZSAiICsgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXZlbnRfdHlwZV9pZCk7CmlmICgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5tYXhfcmVnaXN0cmF0aW9ucz09JycpCnsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMubWF4X3JlZ2lzdHJhdGlvbnM9MDsKfQp1cGRhdGVFdmVudFR5cGUoJGh0dHAsJHNjb3BlLCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV2ZW50X3R5cGVfaWQsJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMsdXBkYXRlRXZlbnRUeXBlX3N1Y2Nlc3MpOwpmdW5jdGlvbiB1cGRhdGVFdmVudFR5cGVfc3VjY2VzcygpCnsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwokbG9jYXRpb24ucGF0aCgnL2V2ZW50X3R5cGVzJyk7Cn0KfQoKfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdjbGFzc0RlbGV0ZUFsbE1vZGFsQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHJvb3RTY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRodHRwLCBjdXJyZW50RXZlbnQsIHVpQ2FsZW5kYXJDb25maWcpCnsKbG9nRGVidWcoImNvbnRyb2xsZXI6IGNsYXNzRGVsZXRlQWxsTW9kYWxDb250cm9sbGVyIik7CiRzY29wZS5jdXJyZW50RXZlbnQ9Y3VycmVudEV2ZW50Owokc2NvcGUuY2xvc2VNb2RhbCA9IGZ1bmN0aW9uKCkKewokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7Cn07CgoKJHNjb3BlLmRlbGV0ZUNsYXNzRXZlbnRTaW5nbGU9ZnVuY3Rpb24gKCkgLy8gZGVsZXRlIG9ubHkgb25lL2N1cnJlbnQgY2xhc3MgZXZlaHQKewpjYW5jZWxDbGFzc0V2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkLGNhbmNlbENsYXNzRXZlbnRfY2FsbGJhY2ssIGNhbmNlbENsYXNzRXZlbnRfY2FsbGJhY2spOwpmdW5jdGlvbiBjYW5jZWxDbGFzc0V2ZW50X2NhbGxiYWNrKCkKewpnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkKTsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwokcm9vdFNjb3BlLiRicm9hZGNhc3QoJ3JlbG9hZEV2ZW50Jyx7ZXZlbnRfaWQgOiAkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkfSk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCn0KfQokc2NvcGUuZGVsZXRlQ2xhc3NFdmVudHNBbGw9ZnVuY3Rpb24gKCkgLy8gZGVsZXRlIGFsbCByZXBlYXRpbmcgZXZlbnRzCnsKY2FuY2VsQ2xhc3NSZXBlYXRpbmdFdmVudCgkaHR0cCwkc2NvcGUsMCwkc2NvcGUuY3VycmVudEV2ZW50LnJlcGVhdF9ldmVudF9pZCxjYW5jZWxDbGFzc0V2ZW50X2NhbGxiYWNrLCBjYW5jZWxDbGFzc0V2ZW50X2NhbGxiYWNrKTsKZnVuY3Rpb24gY2FuY2VsQ2xhc3NFdmVudF9jYWxsYmFjaygpCnsKZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCk7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdyZWxvYWRFdmVudCcse2V2ZW50X2lkIDogJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZH0pOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwp9Cn0KJHNjb3BlLmRlbGV0ZUNsYXNzRXZlbnRzQWxsU3RhcnRpbmdFdmVudElEPWZ1bmN0aW9uICgpIC8vIGRlbGV0ZSBhbGwgcmVwZWF0aW5nIGV2ZW50cyBzdGFydGluZyBldmVudF9pZAp7CmNhbmNlbENsYXNzUmVwZWF0aW5nRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQsJHNjb3BlLmN1cnJlbnRFdmVudC5yZXBlYXRfZXZlbnRfaWQsY2FuY2VsQ2xhc3NFdmVudF9jYWxsYmFjaywgY2FuY2VsQ2xhc3NFdmVudF9jYWxsYmFjayk7CmZ1bmN0aW9uIGNhbmNlbENsYXNzRXZlbnRfY2FsbGJhY2soKQp7Ci8vIGdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQpOwokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgncmVsb2FkRXZlbnQnLHtldmVudF9pZCA6ICRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWR9KTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKfQp9Cgp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ2J1c2luZXNzX21vZGFsX2xpbWl0YXRpb25fY3JlYXRlJywgZnVuY3Rpb24oJHNjb3BlLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIHN0YXJ0LGVuZCwgZml4ZWRTY2hlZHVsZSwgdWlDYWxlbmRhckNvbmZpZykgewoKJHNjb3BlLmZpeGVkU2NoZWR1bGU9Zml4ZWRTY2hlZHVsZTsKJHNjb3BlLm9yaWdpbmFsX3N0YXJ0PXN0YXJ0Owokc2NvcGUub3JpZ2luYWxfZW5kPWVuZDsKCiRzY29wZS5zdGFydD1uZXcgbW9tZW50KHN0YXJ0KSoxMDAwOwokc2NvcGUuZW5kPW5ldyBtb21lbnQoZW5kKSoxMDAwOwpjb25zb2xlLmxvZygnc3RhcnQ9JytzdGFydCk7CmNvbnNvbGUubG9nKCdlbmQ9JytlbmQpOwoKZ2V0QnVzaW5lc3NMb2NhdGlvbnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19sb2NhdGlvbnMnLGdldEJ1c2luZXNzTG9jYXRpb25zX3N1Y2Nlc3MpOwpmdW5jdGlvbiBnZXRCdXNpbmVzc0xvY2F0aW9uc19zdWNjZXNzKCkKewokc2NvcGUubmV3RXZlbnREZXRhaWxzLmxvY2F0aW9uX2lkPSRzY29wZS5idXNpbmVzc19sb2NhdGlvbnNbMF0ubG9jYXRpb25faWQ7Cn0KCnNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc3RhcnQpOwpzZWxlY3RlZERhdGVFbmQgPSBuZXcgRGF0ZShlbmQpOwpsb2dEZWJ1Zygic2VsZWN0ZWREYXRlU3RhcnQgPSAiK3NlbGVjdGVkRGF0ZVN0YXJ0KTsKdmFyIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZSgpICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKdmFyIHNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKHNlbGVjdGVkRGF0ZUVuZC5nZXRUaW1lKCkgKyBzZWxlY3RlZERhdGVFbmQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKCi8vIGxvZ0RlYnVnKCJkYXRlPSIgKyBzZWxlY3RlZERhdGVTdGFydCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50ID0gW107CiRzY29wZS5uZXdFdmVudERldGFpbHMgPSBbXTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycyA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldEhvdXJzKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcyA9IChzZWxlY3RlZERhdGVTdGFydC5nZXRNaW51dGVzKCkgPCAxMCA/ICcwJyA6ICcnKSArIHNlbGVjdGVkRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkb3cgPSBkYXlOYW1lc1tzZWxlY3RlZERhdGVTdGFydC5nZXREYXkoKV07CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF0ZSA9IHNlbGVjdGVkRGF0ZVN0YXJ0Owokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoID0gbW9udGhOYW1lc1tzZWxlY3RlZERhdGVTdGFydC5nZXRNb250aCgpXTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aDExMiA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldE1vbnRoKCkrMTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXlvZm1vbnRoID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RGF0ZSgpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXIgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRGdWxsWWVhcigpOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWVfaW5wdXRfZm9ybWF0PSBuZXcgRGF0ZSgxOTcwLCAwLCAxLCAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzLCAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMsIDApOwoKJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMgPSBzZWxlY3RlZERhdGVFbmQuZ2V0SG91cnMoKTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcyA9IChzZWxlY3RlZERhdGVFbmQuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBzZWxlY3RlZERhdGVFbmQuZ2V0TWludXRlcygpOwoKCiRzY29wZS5jYW5jZWwgPSBmdW5jdGlvbigpIHsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwp9OwoKZ2V0QWxsSW5zdHJ1Y3RvcnMoJGh0dHAsJHNjb3BlLCdpbnN0cnVjdG9ycycsZ2V0QWxsSW5zdHJ1Y3RvcnNfc3VjY2Vzcyk7CmZ1bmN0aW9uIGdldEFsbEluc3RydWN0b3JzX3N1Y2Nlc3MoKQp7CiRzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZD0kc2NvcGUuaW5zdHJ1Y3RvcnNbMF0uYnVzaW5lc3NfdXNlcl9pZDsKfQpnZXROb0NsYXNzRXZlbnRUeXBlc05vQWRtaW4oJGh0dHAsJHNjb3BlLCdyZWxhdGVkRXZlbnRUeXBlcycpOwoKJHNjb3BlLmNyZWF0ZU5ld0xpbWl0YXRpb24gPSBmdW5jdGlvbigpCnsKbG9nRGVidWcoImZ1bmN0aW9uOiBjcmVhdGVOZXdMaW1pdGF0aW9uIik7CmNhbGVuZGFyID0gJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnOwoKaWYgKCRzY29wZS5zZWxlY3RlZEV2ZW50VHlwZXMubGVuZ3RoPDEpCnsKcmV0dXJuIGZhbHNlOwp9CmlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vyczwkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKQp7CmFsZXJ0KCLXltee158g16HXmdeV150g15zXpNeg15kg15bXntefINeU16rXl9ec15QiKTsKcmV0dXJuIGZhbHNlOwp9CmlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vycz09JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykKewppZiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlczw9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKQp7CmFsZXJ0KCLXltee158g16HXmdeV150g15zXpNeg15kg15bXntefINeU16rXl9ec15QiKTsKcmV0dXJuIGZhbHNlOwp9CmlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzPCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMrMTApKQp7CmFsZXJ0KCLXkdec15XXpyDXp9eY158g154tMTAg15PXp9eV16oiKTsKcmV0dXJuIGZhbHNlOwp9Cn0KaWYgKCFrdXplSXNDYWxlbmRhckRyYWdnYmxlKSB7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3Vuc2VsZWN0Jyk7Cn0KbG9nRGVidWcoInN0YXJ0PSIgKyBzdGFydCk7CmNoZWNrRGF0ZSA9IG5ldyBEYXRlKHN0YXJ0KTsKbG9nRGVidWcoImNoZWNrIGRhdGUgPSAiICsgY2hlY2tEYXRlKQpsb2dEZWJ1ZygiZW5kPSIgKyBlbmQpOwplY29sb3I9IiMwMGE2NWEiOwoKaWYgKGNoZWNrRGF0ZS5nZXRGdWxsWWVhcigpID09IDE5NzApIHsKZGF5X2xpbWl0X2lkID0gLTE7Cn0gZWxzZSB7CmRheV9saW1pdF9pZCA9IDE7Cn0KCi8vIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW10uZnVsbENhbGVuZGFyKCdyZXJlbmRlckV2ZW50cycpOwoKdGVtcF9saW1pdF9pZCA9IGNhbGNfdGVtcF9saW1pdF9pZCgpOwoKbG9nRGVidWcoJHNjb3BlLnNlbGVjdGVkRXZlbnRUeXBlc1swXSk7CmxvZ0RlYnVnKCRzY29wZS5zZWxlY3RlZEV2ZW50VHlwZXNbMF0uZXZlbnRfdHlwZV9pZCk7CgpzdGFydF9wYXJhbT1zdGFydDsKZW5kX3BhcmFtPWVuZDsKdGl0bGVfcGFyYW09Jyc7CmxvZ0RlYnVnKCJhZGRMaW1pdGF0aW9uVG9EYXRhYmFzZSBzdGFydD0iICsgc3RhcnRfcGFyYW0gKyAiLCBlbmQ9IiArICIsIHRpdGxlPSIgKyB0aXRsZV9wYXJhbSApOwoKdGhlZGF0YSA9IHsKc3RhcnRfZGF0ZTogJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5zdGFydF90aW1lLAplbmRfZGF0ZTogJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmRfdGltZSwKY29sb3I6IGVjb2xvciwKdGVtcF9saW1pdF9pZDogdGVtcF9saW1pdF9pZCwKZW1wX2lkOiAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmluc3RydWN0b3JfaWQsCmxvY2F0aW9uX2lkOiAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmxvY2F0aW9uX2lkLApldmVudF90eXBlX2lkOiAkc2NvcGUuc2VsZWN0ZWRFdmVudFR5cGVzWzBdLmV2ZW50X3R5cGVfaWQsCmV2ZW50X3R5cGVzOiAkc2NvcGUuc2VsZWN0ZWRFdmVudFR5cGVzLAp0aXRsZTogdGl0bGVfcGFyYW0KfTsKCmlmICgkc2NvcGUuZml4ZWRTY2hlZHVsZSkgLy8gZml4ZWQgc2NoZWR1bGUgdnMgc3BlY2lmaWMgd2VlZC9kYXkgbGltaXRhdGlvbgp7CmNyZWF0ZUNhbGVuZGFyTGltaXRhdGlvbigkaHR0cCwkc2NvcGUsdGhlZGF0YSxsaW1pdGF0aW9uX3N1Y2Nlc3NfY2FsbGJhY2spOwp9CmVsc2UKewpjcmVhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXkoJGh0dHAsJHNjb3BlLHRoZWRhdGEsbGltaXRhdGlvbl9zdWNjZXNzX2NhbGxiYWNrKTsKfQpmdW5jdGlvbiBsaW1pdGF0aW9uX3N1Y2Nlc3NfY2FsbGJhY2soKQp7CmxvZ0RlYnVnKCJzdWNjZXNzIik7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKJHVpYk1vZGFsSW5zdGFuY2UuZGlzbWlzcygpOwp9Cgp9Cgokc2NvcGUuc3RhcnRNaW51dGVzID0gZnVuY3Rpb24oKQp7CmxvZ0RlYnVnKCJzdGFydE1pbnV0ZXMgIisoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKSk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcz1taW51dGVzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpOwpjYWxjdWxhdGVTdGFydFRpbWUoKTsKfQokc2NvcGUuc3RhcnRIb3VycyA9IGZ1bmN0aW9uKCkKewpsb2dEZWJ1Zygic3RhcnRIb3VycyAiK2hvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKSk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnM9aG91cnNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMpOwpjYWxjdWxhdGVTdGFydFRpbWUoKTsKfQokc2NvcGUuZW5kTWludXRlcyA9IGZ1bmN0aW9uKCkKewpsb2dEZWJ1ZygiZW5kTWludXRlcyAiKygkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzKSk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXM9bWludXRlc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcyk7CmNhbGN1bGF0ZUVuZFRpbWUoKTsKfQokc2NvcGUuZW5kSG91cnMgPSBmdW5jdGlvbigpCnsKbG9nRGVidWcoImVuZEhvdXJzICIraG91cnNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzKSk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzPWhvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vycyk7CmNhbGN1bGF0ZUVuZFRpbWUoKTsKfQoKCmZ1bmN0aW9uIGNhbGN1bGF0ZVN0YXJ0VGltZSgpCnsKZXZlbnRZZWFyPSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0eWVhcjsKZXZlbnRNb250aD0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoMTEyOwpldmVudERheT0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRheW9mbW9udGg7CmlmIChwYXJzZUludChldmVudE1vbnRoKTwxMCkKewpldmVudE1vbnRoPSIwIitldmVudE1vbnRoOwp9CmlmIChwYXJzZUludChldmVudERheSk8MTApCnsKZXZlbnREYXk9IjAiK2V2ZW50RGF5Owp9CmxvZ0RlYnVnKCIkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXI9IitldmVudFllYXIpOwpsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXlvZm1vbnRoPSIrZXZlbnRNb250aCk7CmxvZ0RlYnVnKCIkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoPSIrZXZlbnREYXkpOwpuZXdfc3RhcnQ9bW9tZW50LnV0YyhldmVudFllYXIrIi0iK2V2ZW50TW9udGgrIi0iK2V2ZW50RGF5KyJUMDA6MDA6MDAiKS5hZGQoKChwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKSo2MCkrcGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKSksICdtaW51dGVzJyk7CiRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZT1uZXdfc3RhcnQ7CmxvZ0RlYnVnKCJuZXdfc3RhcnQ9IituZXdfc3RhcnQpOwp9CmZ1bmN0aW9uIGNhbGN1bGF0ZUVuZFRpbWUoKQp7CmV2ZW50WWVhcj0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXI7CmV2ZW50TW9udGg9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aDExMjsKZXZlbnREYXk9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXlvZm1vbnRoOwppZiAocGFyc2VJbnQoZXZlbnRNb250aCk8MTApCnsKZXZlbnRNb250aD0iMCIrZXZlbnRNb250aDsKfQppZiAocGFyc2VJbnQoZXZlbnREYXkpPDEwKQp7CmV2ZW50RGF5PSIwIitldmVudERheTsKfQpsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyPSIrZXZlbnRZZWFyKTsKbG9nRGVidWcoIiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aD0iK2V2ZW50TW9udGgpOwpsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aD0iK2V2ZW50RGF5KTsKbmV3X2VuZD1tb21lbnQudXRjKGV2ZW50WWVhcisiLSIrZXZlbnRNb250aCsiLSIrZXZlbnREYXkrIlQwMDowMDowMCIpLmFkZCgoKHBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzKSo2MCkrcGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcykpLCAnbWludXRlcycpOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZF90aW1lPW5ld19lbmQ7CmxvZ0RlYnVnKCJuZXdfZW5kPSIrbmV3X2VuZCk7Cn0KCmNhbGN1bGF0ZVN0YXJ0VGltZSgpOwpjYWxjdWxhdGVFbmRUaW1lKCk7CgpmdW5jdGlvbiBtaW51dGVzQ2hhbmdlZCh0aGVtaW51dGVzKQp7CmxvZ0RlYnVnKCJ0aGVtaW51dGVzPSIrdGhlbWludXRlcyk7CmlmICh0eXBlb2YgdGhlbWludXRlcz09InVuZGVmaW5lZCIpCnsKcmV0dXJuICIwMCI7Cn0KdGhlbWludXRlcz1wYXJzZUludCh0aGVtaW51dGVzKTsKaWYgKHRoZW1pbnV0ZXM+NjApCnsKcmV0dXJuICIwMCI7Cn0KZWxzZSBpZiAodGhlbWludXRlczwwKQp7CnJldHVybiAiMDAiOwp9CmVsc2UgaWYgKHRoZW1pbnV0ZXM9PSIiKQp7CnJldHVybiAiMDAiOwp9CmVsc2UgaWYgKHRoZW1pbnV0ZXM8MTApCnsKcmV0dXJuICIwIit0aGVtaW51dGVzOwp9CmVsc2UKewpyZXR1cm4gdGhlbWludXRlczsKfQp9CmZ1bmN0aW9uIGhvdXJzQ2hhbmdlZCh0aGVob3VycykKewpsb2dEZWJ1ZygidGhlaG91cnM9Iit0aGVob3Vycyk7CmlmICh0eXBlb2YgdGhlaG91cnM9PSJ1bmRlZmluZWQiKQp7CnJldHVybiAiMCI7Cn0KdGhlaG91cnM9cGFyc2VJbnQodGhlaG91cnMpOwppZiAodGhlaG91cnM+MjQpCnsKcmV0dXJuIDA7Cn0KZWxzZSBpZiAodGhlaG91cnM8MCkKewpyZXR1cm4gMDsKfQplbHNlIGlmICh0aGVob3Vycz09IiIpCnsKcmV0dXJuICIwIjsKfQplbHNlCnsKcmV0dXJuIHRoZWhvdXJzOwp9Cn0KfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2NsYXNzQ2xvc2VNb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRyb290U2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgZXZlbnRfaWQsIHVpQ2FsZW5kYXJDb25maWcpIHsKZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ3NlbGVjdGVkRXZlbnQnLGV2ZW50X2lkLGFmdGVyR2V0Q2xpZW50U3BlY2lmaWNFdmVudCk7CmZ1bmN0aW9uIGFmdGVyR2V0Q2xpZW50U3BlY2lmaWNFdmVudCgpCnsKZm9yIChpID0gMDsgaSA8ICRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50VXNlcnMubGVuZ3RoOyBpKyspCnsKaWYgKCRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50VXNlcnNbaV0uc3RhdHVzX25hbWUhPSRnVXNlcl9zdGF0dXNfYWJzZW50ZWQpCnsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRVc2Vyc1tpXS5wYXJ0aWNpcGF0ZWQ9dHJ1ZTsKfQppZiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRVc2Vyc1tpXS5pc193YWl0aW5nX2xpc3Q9PTEpCnsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRVc2Vyc1tpXS5wYXJ0aWNpcGF0ZWQ9ZmFsc2U7Cn0KfQpsb2dEZWJ1Zygkc2NvcGUuc2VsZWN0ZWRFdmVudCk7Cn0KCi8vIGNsaWNrZWQgcm93IC0gY2hlY2svdW5jaGVjayB0aGUgY2hlY2tib3ggb2YgYSB1c2VyCiRzY29wZS5yb3dDbGlja2VkID0gZnVuY3Rpb24ob2JqKQp7CmxvZ0RlYnVnKCdyb3cgY2xpY2tlZCcpOwpvYmoucGFydGljaXBhdGVkID0gIW9iai5wYXJ0aWNpcGF0ZWQ7Cn07Cgokc2NvcGUub2tMaW1pdGF0aW9uTW9kYWwgPSBmdW5jdGlvbigpIHsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwp9OwoKJHNjb3BlLmNsb3NlQ2xhc3MgPSBmdW5jdGlvbigpCnsKY2xvc2VDbGFzc0V2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUuc2VsZWN0ZWRFdmVudC5ldmVudF9pZCwkc2NvcGUuc2VsZWN0ZWRFdmVudCxhZnRlckNsb3NlRXZlbnQsYWZ0ZXJDbG9zZUV2ZW50KTsKZnVuY3Rpb24gYWZ0ZXJDbG9zZUV2ZW50KCkKewokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgncmVsb2FkRXZlbnQnLHtldmVudF9pZCA6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50X2lkfSk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCn07Cn0KfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2J1c2luZXNzQ2xpZW5kQ2FyZFBheW1lbnQnLCBmdW5jdGlvbigkc2NvcGUsICRyb3V0ZVBhcmFtcywgJHJvb3RTY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRodHRwLCBjdXJyZW50Q2xpZW50LCBpc3BsdXMsIHVpQ2FsZW5kYXJDb25maWcpCnsKJHNjb3BlLmlzcGx1cz1pc3BsdXM7CmxvZ0RlYnVnKCdidXNpbmVzc0NsaWVuZENhcmRQYXltZW50IGlzcGx1cz0nICtpc3BsdXMrIiBjdXJyZW50Q2xpZW50PSIrIEpTT04uc3RyaW5naWZ5KGN1cnJlbnRDbGllbnQsIG51bGwsIDIpKTsKJHNjb3BlLmt1emVJc0xvYWRpbmc9ZmFsc2U7CmxvZ0RlYnVnKCdjdXJyZW50Q2xpZW50LnBheW1lbnRfYmFsYW5jZT0nK2N1cnJlbnRDbGllbnQucGF5bWVudF9iYWxhbmNlKyIsY3VycmVudENsaWVudC51bnBhaWRfYmFsYW5jZSA9IitjdXJyZW50Q2xpZW50LnVucGFpZF9iYWxhbmNlKTsKdGhlYmFsYW5jZSA9IGN1cnJlbnRDbGllbnQucGF5bWVudF9iYWxhbmNlLWN1cnJlbnRDbGllbnQudW5wYWlkX2JhbGFuY2U7CmxvZ0RlYnVnKCd0aGViYWxhbmNlPScrdGhlYmFsYW5jZSk7CmlmICh0aGViYWxhbmNlPDApCnsKJHNjb3BlLmJhbGFuY2VUb1BheT1NYXRoLmFicyh0aGViYWxhbmNlKTsKfQogIC8vIGVsc2UgaWYgKChjdXJyZW50Q2xpZW50LmJhbGFuY2U+MCkgJiYgKGN1cnJlbnRDbGllbnQudW5wYWlkX2JhbGFuY2U+MCkpCiAgLy8gewogIC8vICAgY29uc29sZS5sb2coImN1cnJlbnRDbGllbnQuYmFsYW5jZT0iK2N1cnJlbnRDbGllbnQuYmFsYW5jZSsiLCBjdXJyZW50Q2xpZW50LnVucGFpZF9iYWxhbmNlPSIrY3VycmVudENsaWVudC51bnBhaWRfYmFsYW5jZSk7CiAgLy8gICBpZiAoY3VycmVudENsaWVudC51bnBhaWRfYmFsYW5jZT5jdXJyZW50Q2xpZW50LmJhbGFuY2UpCiAgLy8gICB7CiAgLy8gICAgICRzY29wZS5iYWxhbmNlVG9QYXk9Y3VycmVudENsaWVudC51bnBhaWRfYmFsYW5jZS1jdXJyZW50Q2xpZW50LmJhbGFuY2U7CiAgLy8gICB9CiAgLy8gICBlbHNlIHsKICAvLyAgICAgJHNjb3BlLmJhbGFuY2VUb1BheT0wOwogIC8vICAgfQogIC8vIH0KZWxzZQp7CiRzY29wZS5iYWxhbmNlVG9QYXk9MDsKfQokc2NvcGUucGF5bWVudFR5cGVUaXRsZT0i15HXl9eoIjsKJHNjb3BlLmN1cnJlbnRDbGllbnQ9Y3VycmVudENsaWVudDsKbG9nRGVidWcoJHNjb3BlLmN1cnJlbnRDbGllbnQpOwokc2NvcGUuYnVzaW5lc3NDb25maWcgPSBCdXNpbmVzc0NvbmZpZy5nZXQoKTsKJHNjb3BlLmJ1c2luZXNzQ29uZmlnLnRoZW4oZnVuY3Rpb24gKGNvbmZpZykgewokc2NvcGUuaW52b2ljZV9zb3VyY2VfaWQgPSBjb25maWcuaW52b2ljZV9zb3VyY2VfaWQ7CiRzY29wZS5oYXNWYXQgPSBjb25maWcudmF0X3JhdGUgPiAwOwp9KTsKCiRzY29wZS5jbG9zZU1vZGFsID0gZnVuY3Rpb24oKSB7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKfTsKCiRzY29wZS5leHRlcm5hbF9pbnZvaWNlX2dlbmVyYXRlZD1mYWxzZTsKJHNjb3BlLmludm9pY2VfZGF0ZV9mb3JtYXQ9bmV3IERhdGUoKTsKCmdldE5leHRJbnZvaWNlTnVtYmVyKCRodHRwLCRzY29wZSwkc2NvcGUuY3VycmVudENsaWVudC5idXNpbmVzc191c2VyX2lkLCdpbnZvaWNlX251bWJlcicpOwoKJHNjb3BlLnBheW1lbnRNZXRob2RzID0gcGF5bWVudE1ldGhvZHM7CiRzY29wZS5jcmVkaXRDYXJkVHlwZXMgPSBjcmVkaXRDYXJkVHlwZXM7CiRzY29wZS5jcmVkaXRUcmFuc2FjdGlvblR5cGVzID0gY3JlZGl0VHJhbnNhY3Rpb25UeXBlczsKJHNjb3BlLmJhbmtzID0gYmFua3M7CgovLyBpbmRpY2F0aW9uIHdoZXRoZXIgcGF5bWVudCBtZXRob2Qgd2FzIHNlbGVjdGVkCiRzY29wZS5pc1BheW1lbnRNZXRob2RTZWxlY3RlZD1mYWxzZTsKJHNjb3BlLnNlbGVjdFBheW1lbnRNZXRob2QgPSBmdW5jdGlvbihwYXltZW50KSB7CiRzY29wZS5wYXltZW50VHlwZVRpdGxlPXBheW1lbnQubmFtZTsKJHNjb3BlLnNlbGVjdGVkUGF5bWVudE1ldGhvZD1wYXltZW50Owokc2NvcGUuaXNQYXltZW50TWV0aG9kU2VsZWN0ZWQ9dHJ1ZTsKfTsKCiRzY29wZS51cGRhdGVCYWxhbmNlID0gZnVuY3Rpb24gdXBkYXRlQmFsYW5jZSAoaXNTb3VyY2VXaXRoVmF0KSB7CiRzY29wZS5idXNpbmVzc0NvbmZpZy50aGVuKGZ1bmN0aW9uIChjb25maWcpIHsKaWYgKGlzU291cmNlV2l0aFZhdCkgewokc2NvcGUuYmFsYW5jZVRvUGF5Tm9WYXQgPSBOdW1iZXIoKCRzY29wZS5iYWxhbmNlVG9QYXkgLyAoMSArIGNvbmZpZy52YXRfcmF0ZSkpLnRvRml4ZWQoMikpOwp9IGVsc2Ugewokc2NvcGUuYmFsYW5jZVRvUGF5ID0gTnVtYmVyKCgkc2NvcGUuYmFsYW5jZVRvUGF5Tm9WYXQgKiAoMSArIGNvbmZpZy52YXRfcmF0ZSkpLnRvRml4ZWQoMikpOwp9Cn0pCn07Cgokc2NvcGUubWFrZVBheW1lbnQgPSBmdW5jdGlvbigpCnsKbG9nRGVidWcoY3VycmVudENsaWVudCk7CmxvZ0RlYnVnKCJwYXltZW50IG1ldGhvZCIpOwpsb2dEZWJ1Zygkc2NvcGUuc2VsZWN0ZWRQYXltZW50TWV0aG9kKTsKbG9nRGVidWcoIiRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2dlbmVyYXRlZD08Iiskc2NvcGUuaW52b2ljZV9nZW5lcmF0ZWQrIj4iKTsKCmlmICgoJHNjb3BlLmJhbGFuY2VUb1BheT09MCkgfHwgKCRzY29wZS5iYWxhbmNlVG9QYXk9PScnKXx8ICgkc2NvcGUuYmFsYW5jZVRvUGF5PT1udWxsKSkKewokc2NvcGUudXNlckVycm9yPSLXkNeg15Ag15TXltefINeh15vXldedINeb15zXqdeU15UiOwp9CmVsc2UgaWYgKCEkc2NvcGUuaXNQYXltZW50TWV0aG9kU2VsZWN0ZWQpCnsKJHNjb3BlLnVzZXJFcnJvcj0i15DXoNeQINeR15fXqCDXkNee16bXoteZINeq16nXnNeV150iOwovLyBhbGVydCgnc3MnKTsKfQplbHNlCnsKaWYgKCgkc2NvcGUuaW52b2ljZV9nZW5lcmF0ZWQhPTEpIHx8ICgkc2NvcGUuaW52b2ljZV9kYXRlX2Zvcm1hdD09bnVsbCkpCnsKdmFyIGludm9pY2VfZGF0ZV9mb3JtYXQgPSAibnVsbCI7Cn0KZWxzZQp7CnZhciBpbnZvaWNlX2RhdGVfZm9ybWF0ID0gJHNjb3BlLmludm9pY2VfZGF0ZV9mb3JtYXQuZ2V0RGF0ZSgpICArICItIiArICgkc2NvcGUuaW52b2ljZV9kYXRlX2Zvcm1hdC5nZXRNb250aCgpKzEpICsgIi0iICsgJHNjb3BlLmludm9pY2VfZGF0ZV9mb3JtYXQuZ2V0RnVsbFllYXIoKTsKfQppZiAoaXNwbHVzKQp7CndoYXRUb1BheT0kc2NvcGUuYmFsYW5jZVRvUGF5Owp9CmVsc2Ugewp3aGF0VG9QYXk9LSRzY29wZS5iYWxhbmNlVG9QYXk7Cn0KdGhlZGF0YT0gewpiYWxhbmNlVG9QYXk6IHdoYXRUb1BheSwKYmFsYW5jZVRvUGF5Tm9WYXQ6ICRzY29wZS5iYWxhbmNlVG9QYXlOb1ZhdCAqIChpc3BsdXMgPyArMSA6IC0xKSwKcGF5bWVudF9tZXRob2RfbmFtZTogJHNjb3BlLnNlbGVjdGVkUGF5bWVudE1ldGhvZC5tZXRob2QsCmludm9pY2VfbnVtYmVyOiAkc2NvcGUuaW52b2ljZV9udW1iZXIsCmludm9pY2VfZ2VuZXJhdGVkOiAkc2NvcGUuaW52b2ljZV9nZW5lcmF0ZWQsCmludm9pY2VfZGF0ZTogaW52b2ljZV9kYXRlX2Zvcm1hdCwKYmFua19jb21wYW55X2NvZGU6ICRzY29wZS5iYW5rX2NvbXBhbnlfY29kZSwKYmFua19icmFuY2hfbnVtYmVyOiAkc2NvcGUuYmFua19icmFuY2hfbnVtYmVyLApjaGVja19udW1iZXI6ICRzY29wZS5jaGVja19udW1iZXIsCmFjY291bnRfbnVtYmVyOiAkc2NvcGUuYWNjb3VudF9udW1iZXIsCmNyZWRpdF9jYXJkX251bWJlcjogJHNjb3BlLmNyZWRpdF9jYXJkX251bWJlciwKY3JlZGl0X2NhcmRfdHlwZTogJHNjb3BlLmNyZWRpdF9jYXJkX3R5cGUsCmNyZWRpdF9jYXJkX3RyYW5zYWN0aW9uX3R5cGU6ICRzY29wZS5jcmVkaXRfY2FyZF90cmFuc2FjdGlvbl90eXBlLAppbnZvaWNlX2NvbW1lbnRzOiAkc2NvcGUuaW52b2ljZV9jb21tZW50cwp9Owokc2NvcGUua3V6ZUlzTG9hZGluZz10cnVlOwpjcmVhdGVQYXltZW50Rm9yQ2xpZW50KCRodHRwLCRzY29wZSxjdXJyZW50Q2xpZW50LmJ1c2luZXNzX3VzZXJfaWQsdGhlZGF0YSxjcmVhdGVQYXltZW50Rm9yQ2xpZW50X3N1Y2Nlc3MsIGNyZWF0ZVBheW1lbnRGb3JDbGllbnRfZmFpbHVyZSk7CmZ1bmN0aW9uIGNyZWF0ZVBheW1lbnRGb3JDbGllbnRfc3VjY2VzcygpCnsKJHNjb3BlLmt1emVJc0xvYWRpbmc9ZmFsc2U7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKbG9nRGVidWcoImJyb2FkY2FzdGluZyBjbGllbnRQYWdlUmVsb2FkRGF0YSIpOwokcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NsaWVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCmxvZ0RlYnVnKCJicm9hZGNhc3RpbmcgZXZlbnRQYWdlUmVsb2FkRGF0YSIpOwokcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2V2ZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKLy8gbG9nRGVidWcoImJyb2FkY2FzdGluZyByZWxvYWRFdmVudCIpOwovLyAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ3JlbG9hZEV2ZW50Jyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCn0KZnVuY3Rpb24gY3JlYXRlUGF5bWVudEZvckNsaWVudF9mYWlsdXJlKCkKewokc2NvcGUua3V6ZUlzTG9hZGluZz1mYWxzZTsKfQp9Cn0KfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdldmVudERldGFpbHNCdXNpbmVzc0NhbGVuZGFyTW9kYWxDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIHNlbGVjdGVkRXZlbnQsIHVpQ2FsZW5kYXJDb25maWcpIHsKdmFyIGRheU5hbWVzID0gWyfXqNeQ16nXldefJywgJ9ep16DXmScsICfXqdec15nXqdeZJywgJ9eo15HXmdei15knLCAn15fXnteZ16nXmScsICfXqdeZ16nXmScsICfXqdeR16onXTsKCiRzY29wZS5nb3RvQ2xpZW50UGFnZT0gZnVuY3Rpb24gKGJ1c2luZXNVc2VyaWQpCnsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwpnb3RvQ2xpZW50UGFnZShidXNpbmVzVXNlcmlkKTsKfQokc2NvcGUuZWRpdEV2ZW50PSBmdW5jdGlvbiAodGhlZXZlbnQpCnsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwpnb3RvRXZlbnRQYWdlKHRoZWV2ZW50KTsKfQoKbG9nRGVidWcoInNlbGVjdGVkIEV2ZW50IGluZm8gPSIgKyBKU09OLnN0cmluZ2lmeShzZWxlY3RlZEV2ZW50LCBudWxsLCAyKSk7CiRzY29wZS5zZWxlY3RlZEV2ZW50ID0gc2VsZWN0ZWRFdmVudDsKc2VsZWN0ZWREYXRlU3RhcnQgPSBuZXcgRGF0ZShzZWxlY3RlZEV2ZW50LnN0YXJ0KTsKdmFyIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZSgpICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKCiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRIb3VycygpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBzZWxlY3RlZERhdGVTdGFydC5nZXRNaW51dGVzKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZG93ID0gZGF5TmFtZXNbc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RGF5KCldOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRhdGUgPSBzZWxlY3RlZERhdGVTdGFydDsKCiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0RGF5ID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RGF0ZSgpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydE1vbnRoID0gMSArIHNlbGVjdGVkRGF0ZVN0YXJ0LmdldE1vbnRoKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0TW9udGhUeHQgPSBtb250aE5hbWVzWyRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0TW9udGggLSAxXTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRZZWFyID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RnVsbFllYXIoKTsKCnNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKHNlbGVjdGVkRXZlbnQuZW5kKTsKdmFyIHNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKHNlbGVjdGVkRGF0ZUVuZC5nZXRUaW1lKCkgKyBzZWxlY3RlZERhdGVFbmQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKCiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzID0gc2VsZWN0ZWREYXRlRW5kLmdldEhvdXJzKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGRvdyA9IGRheU5hbWVzW3NlbGVjdGVkRGF0ZUVuZC5nZXREYXkoKV07CiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKSA8IDEwID8gJzAnIDogJycpICsgc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKTsKJHNjb3BlLm9rTGltaXRhdGlvbk1vZGFsID0gZnVuY3Rpb24oKSB7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKfTsKCiRzY29wZS5kZWxldGVMaW1pdGF0aW9uTW9kYWwgPSBmdW5jdGlvbigpIHsKJHVpYk1vZGFsSW5zdGFuY2UuZGlzbWlzcygnZGVsZXRlJyk7CmNhbGVuZGFyID0gJ2NhbGVuZGFyX2J1c2luZXNzJzsKCiRzY29wZS5kZWxldGVDYWxlbmRhckRCRXZlbnQoc2VsZWN0ZWRFdmVudCwgY2FsZW5kYXIpOwp9Owokc2NvcGUuZGVsZXRlQ2FsZW5kYXJKU0V2ZW50ID0gZnVuY3Rpb24oY2FsZW5kYXIsIHNlbGVjdGVkRXZlbnRpZCkgewoKbG9nRGVidWcoImNhbGVuZGFyX2hvdXJzX29mX3dvcmtfY29uZmlnPSIgKyB1aUNhbGVuZGFyQ29uZmlnKTsKbG9nRGVidWcoInVpQ2FsZW5kYXJDb25maWdbY2FsZW5kYXJdPSIgKyB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1snY2FsZW5kYXJfYnVzaW5lc3MnXSk7CmxvZ0RlYnVnKCJkZWxldGUganMgZXZlbnQgIiArIHNlbGVjdGVkRXZlbnRpZCk7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlbW92ZUV2ZW50cycsIFtzZWxlY3RlZEV2ZW50aWRdKTsgLy8gZ28gdG8gZGF0ZSBpbiBjYWxlbmRhciBnb3RvCn07CiRzY29wZS5kZWxldGVDYWxlbmRhckRCRXZlbnQgPSBmdW5jdGlvbihzZWxlY3RlZEV2ZW50LCBjYWxlbmRhcikgewpsb2dEZWJ1ZygiZGVsZXRlIGV2ZW50ICIgKyBzZWxlY3RlZEV2ZW50LmlkKTsKJGh0dHAoewptZXRob2Q6ICdQT1NUJywKdXJsOiAnL2FwaS9hZG1pbi9ldmVudHMvZGVsZXRlLycgKyBzZWxlY3RlZEV2ZW50LmlkLApkYXRhOiB7CnRlbXBfbGltaXRfaWQ6IHNlbGVjdGVkRXZlbnQudGVtcF9saW1pdF9pZAp9LApoZWFkZXJzOiB7CidDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbjtjaGFyc2V0PXV0Zi04Jwp9Cn0pLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkgewoKbG9nRGVidWcoZGF0YSk7CmlmICghZGF0YS5zdWNjZXNzKSB7CmxvZ0RlYnVnKCJkZWxldGUgbGltaXRfaWQgZXJyb3IgKyIgKyBkYXRhLm1lc3NhZ2UpOwovLyBpZiBub3Qgc3VjY2Vzc2Z1bCwgYmluZCBlcnJvcnMgdG8gZXJyb3IgdmFyaWFibGVzCi8vCQkJICAkc2NvcGUuZXJyb3JOYW1lID0gZGF0YS5lcnJvcnMubmFtZTsKLy8JCQkgICRzY29wZS5lcnJvclN1cGVyaGVybyA9IGRhdGEuZXJyb3JzLnN1cGVyaGVyb0FsaWFzOwp9IGVsc2Ugewpsb2dEZWJ1ZygiZGVsZXRlIGxpbWl0X2lkIHN1Y2Nlc3MiKTsKLy8gaWYgc3VjY2Vzc2Z1bCwgYmluZCBzdWNjZXNzIG1lc3NhZ2UgdG8gbWVzc2FnZQovLwkJCSAgJHNjb3BlLm1lc3NhZ2UgPSBkYXRhLm1lc3NhZ2U7CiRzY29wZS5kZWxldGVDYWxlbmRhckpTRXZlbnQoY2FsZW5kYXIsIHNlbGVjdGVkRXZlbnQuaWQpOwoKfQp9KTsKCmxvZ0RlYnVnKCJhZnRlciByZW1vdmUgZXZlbnQiKTsKfTsKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2V2ZW50UmVjdXJyaW5nRGV0YWlsc0J1c2luZXNzQ2FsZW5kYXJNb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgc2VsZWN0ZWRFdmVudCwgdWlDYWxlbmRhckNvbmZpZykgewp2YXIgZGF5TmFtZXMgPSBbJ9eo15DXqdeV158nLCAn16nXoNeZJywgJ9ep15zXmdep15knLCAn16jXkdeZ16LXmScsICfXl9ee15nXqdeZJywgJ9ep15nXqdeZJywgJ9ep15HXqiddOwoKJHNjb3BlLmdvdG9DbGllbnRQYWdlPSBmdW5jdGlvbiAoYnVzaW5lc3NVc2VyaWQpCnsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwpnb3RvQ2xpZW50UGFnZShidXNpbmVzc1VzZXJpZCk7Cn0KJHNjb3BlLmVkaXRFdmVudD0gZnVuY3Rpb24gKHRoZWV2ZW50KQp7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKZ290b0V2ZW50UGFnZSh0aGVldmVudCk7Cn0KCgpsb2dEZWJ1Zygic2VsZWN0ZWQgUmVjdXJyaW5nIEV2ZW50IGluZm8gPSIgKyBKU09OLnN0cmluZ2lmeShzZWxlY3RlZEV2ZW50LCBudWxsLCAyKSk7CiRzY29wZS5zZWxlY3RlZEV2ZW50ID0gc2VsZWN0ZWRFdmVudDsKc2VsZWN0ZWREYXRlU3RhcnQgPSBuZXcgRGF0ZShzZWxlY3RlZEV2ZW50LnN0YXJ0KTsKdmFyIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZSgpICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKCi8vIGxvZ0RlYnVnKCJzZWxlY3RlZEV2ZW50LnN0YXJ0PSIgKyBzZWxlY3RlZEV2ZW50LnN0YXJ0KTsKLy8gbG9nRGVidWcoImRhdGU9IiArIHNlbGVjdGVkRGF0ZVN0YXJ0KTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycyA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldEhvdXJzKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcyA9IChzZWxlY3RlZERhdGVTdGFydC5nZXRNaW51dGVzKCkgPCAxMCA/ICcwJyA6ICcnKSArIHNlbGVjdGVkRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkb3cgPSBkYXlOYW1lc1tzZWxlY3RlZERhdGVTdGFydC5nZXREYXkoKV07CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF0ZSA9IHNlbGVjdGVkRGF0ZVN0YXJ0OwoKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnREYXkgPSBzZWxlY3RlZERhdGVTdGFydC5nZXREYXRlKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0TW9udGggPSAxICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TW9udGgoKTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRNb250aFR4dCA9IG1vbnRoTmFtZXNbJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRNb250aCAtIDFdOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydFllYXIgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRGdWxsWWVhcigpOwoKc2VsZWN0ZWREYXRlRW5kID0gbmV3IERhdGUoc2VsZWN0ZWRFdmVudC5lbmQpOwp2YXIgc2VsZWN0ZWREYXRlRW5kID0gbmV3IERhdGUoc2VsZWN0ZWREYXRlRW5kLmdldFRpbWUoKSArIHNlbGVjdGVkRGF0ZUVuZC5nZXRUaW1lem9uZU9mZnNldCgpICogNjAwMDApOwoKLy8gbG9nRGVidWcoInNlbGVjdGVkRXZlbnQuZW5kPSIgKyBzZWxlY3RlZEV2ZW50LmVuZCk7Ci8vIGxvZ0RlYnVnKCJkYXRlPSIgKyBzZWxlY3RlZERhdGVFbmQpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycyA9IHNlbGVjdGVkRGF0ZUVuZC5nZXRIb3VycygpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRkb3cgPSBkYXlOYW1lc1tzZWxlY3RlZERhdGVFbmQuZ2V0RGF5KCldOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzID0gKHNlbGVjdGVkRGF0ZUVuZC5nZXRNaW51dGVzKCkgPCAxMCA/ICcwJyA6ICcnKSArIHNlbGVjdGVkRGF0ZUVuZC5nZXRNaW51dGVzKCk7CiRzY29wZS5va0xpbWl0YXRpb25Nb2RhbCA9IGZ1bmN0aW9uKCkgewokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7Cn07Cgp9KTsKCmt1emVBcHAuY29udHJvbGxlcignZXZlbnREZXRhaWxzSG91cnNPZldvcmtNb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgc2VsZWN0ZWRFdmVudCwgZml4ZWRTY2hlZHVsZSwgdWlDYWxlbmRhckNvbmZpZykgewp2YXIgZGF5TmFtZXMgPSBbJ9eo15DXqdeV158nLCAn16nXoNeZJywgJ9ep15zXmdep15knLCAn16jXkdeZ16LXmScsICfXl9ee15nXqdeZJywgJ9ep15nXqdeZJywgJ9ep15HXqiddOwoKLy8gbG9nRGVidWcoInNlbGVjdGVkIEV2ZW50ID0iICsgSlNPTi5zdHJpbmdpZnkoc2VsZWN0ZWRFdmVudCwgbnVsbCwgNCkpOwokc2NvcGUuZml4ZWRTY2hlZHVsZT1maXhlZFNjaGVkdWxlOwokc2NvcGUuc2VsZWN0ZWRFdmVudCA9IHNlbGVjdGVkRXZlbnQ7CiRzY29wZS5zZWxlY3RlZEV2ZW50Lm9yaWdfZXZlbnRfdHlwZXMgPSBhbmd1bGFyLmNvcHkoc2VsZWN0ZWRFdmVudC5ldmVudF90eXBlcyk7CiRzY29wZS5uZXdFdmVudERldGFpbHMgPSBbXTsKCmdldEJ1c2luZXNzTG9jYXRpb25zKCRodHRwLCRzY29wZSwnYnVzaW5lc3NfbG9jYXRpb25zJyk7Cgpsb2dEZWJ1ZygiaG91cnMgb2Ygd29yayBibG9jay9ldmVudCBjbGlja2VkICIrSlNPTi5zdHJpbmdpZnkoJHNjb3BlLnNlbGVjdGVkRXZlbnQpKTsKCnNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc2VsZWN0ZWRFdmVudC5zdGFydCk7CnZhciBzZWxlY3RlZERhdGVTdGFydCA9IG5ldyBEYXRlKHNlbGVjdGVkRGF0ZVN0YXJ0LmdldFRpbWUoKSArIHNlbGVjdGVkRGF0ZVN0YXJ0LmdldFRpbWV6b25lT2Zmc2V0KCkgKiA2MDAwMCk7CmdldEFsbEluc3RydWN0b3JzKCRodHRwLCRzY29wZSwnaW5zdHJ1Y3RvcnMnKTsKZ2V0Tm9DbGFzc0V2ZW50VHlwZXNOb0FkbWluKCRodHRwLCRzY29wZSwncmVsYXRlZEV2ZW50VHlwZXMnLGdldE5vQ2xhc3NFdmVudFR5cGVzTm9BZG1pbl9zdWNjZXNzKTsKZnVuY3Rpb24gZ2V0Tm9DbGFzc0V2ZW50VHlwZXNOb0FkbWluX3N1Y2Nlc3MoKQp7CmZvcih2YXIgaSA9IDA7IGkgPCAkc2NvcGUuc2VsZWN0ZWRFdmVudC5ldmVudF90eXBlcy5sZW5ndGg7IGkrKykKewovLyBjb3B5aW5nIHRoZSBhY3R1YWwgb2JqZWN0IG9mICRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50X3R5cGVzW2ldCmZvcih2YXIgaiA9IDA7IGogPCAkc2NvcGUucmVsYXRlZEV2ZW50VHlwZXMubGVuZ3RoOyBqKyspCnsKaWYgKCRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50X3R5cGVzW2ldLmV2ZW50X3R5cGVfaWQ9PSRzY29wZS5yZWxhdGVkRXZlbnRUeXBlc1tqXS5ldmVudF90eXBlX2lkKQp7CiRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50X3R5cGVzW2ldPWFuZ3VsYXIuY29weSgkc2NvcGUucmVsYXRlZEV2ZW50VHlwZXNbal0pOwp9Cn0KfQp9CgovLyBsb2dEZWJ1Zygic2VsZWN0ZWRFdmVudC5zdGFydD0iICsgc2VsZWN0ZWRFdmVudC5zdGFydCk7Ci8vIGxvZ0RlYnVnKCJkYXRlPSIgKyBzZWxlY3RlZERhdGVTdGFydCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRIb3VycygpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBzZWxlY3RlZERhdGVTdGFydC5nZXRNaW51dGVzKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZG93ID0gZGF5TmFtZXNbc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RGF5KCldOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRhdGUgPSBzZWxlY3RlZERhdGVTdGFydDsKCnNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKHNlbGVjdGVkRXZlbnQuZW5kKTsKdmFyIHNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKHNlbGVjdGVkRGF0ZUVuZC5nZXRUaW1lKCkgKyBzZWxlY3RlZERhdGVFbmQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKCiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bW9udGggPSBtb250aE5hbWVzW3NlbGVjdGVkRGF0ZVN0YXJ0LmdldE1vbnRoKCldOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoMTEyID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TW9udGgoKSsxOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRheW9mbW9udGggPSBzZWxlY3RlZERhdGVTdGFydC5nZXREYXRlKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0eWVhciA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCk7Ci8vICRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZV9pbnB1dF9mb3JtYXQ9IG5ldyBEYXRlKDE5NzAsIDAsIDEsICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMsICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcywgMCk7CgovLyBsb2dEZWJ1Zygic2VsZWN0ZWRFdmVudC5lbmQ9IiArIHNlbGVjdGVkRXZlbnQuZW5kKTsKLy8gbG9nRGVidWcoImRhdGU9IiArIHNlbGVjdGVkRGF0ZUVuZCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzID0gc2VsZWN0ZWREYXRlRW5kLmdldEhvdXJzKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGRvdyA9IGRheU5hbWVzW3NlbGVjdGVkRGF0ZUVuZC5nZXREYXkoKV07CiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKSA8IDEwID8gJzAnIDogJycpICsgc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKTsKCgokc2NvcGUub2tMaW1pdGF0aW9uTW9kYWwgPSBmdW5jdGlvbigpIHsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwp9OwoKJHNjb3BlLnVwZGF0ZUxpbWl0YXRpb25Nb2RhbCA9IGZ1bmN0aW9uKCkKewpsb2dEZWJ1ZygiZnVuY3Rpb246IHVwZGF0ZUxpbWl0YXRpb25Nb2RhbCIpOwppZiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRfdHlwZXMubGVuZ3RoPDEpCnsKcmV0dXJuIGZhbHNlOwp9CmlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vyczwkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKQp7CmFsZXJ0KCLXltee158g16HXmdeV150g15zXpNeg15kg15bXntefINeU16rXl9ec15QiKTsKcmV0dXJuIGZhbHNlOwp9CmlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vycz09JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykKewppZiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlczw9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKQp7CmFsZXJ0KCLXltee158g16HXmdeV150g15zXpNeg15kg15bXntefINeU16rXl9ec15QiKTsKcmV0dXJuIGZhbHNlOwp9CmlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzPCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMrMTApKQp7CmFsZXJ0KCLXkdec15XXpyDXp9eY158g154tMTAg15PXp9eV16oiKTsKcmV0dXJuIGZhbHNlOwp9Cn0KCgpmdW5jdGlvbiB1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25fc3VjY2VzcygpCnsKY2FsZW5kYXIgPSAnY2FsZW5kYXJfaG91cnNfb2Zfd29yayc7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsgLy8gZ28gdG8gZGF0ZSBpbiBjYWxlbmRhciBnb3RvCiR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoJ2RlbGV0ZScpOwp9CgppZiAoJHNjb3BlLmZpeGVkU2NoZWR1bGUpCnsKLy8gZml4ZWQgc2NoZWR1bGUgLSB1cGFkdGluZyBsaW1pdGF0aW9uIDE5NzAKdGhlZGF0YSA9IHsKc3RhcnRfZGF0ZTogbmV3X3N0YXJ0LAplbmRfZGF0ZTogbmV3X2VuZCwKdGVtcF9saW1pdF9pZDogbnVsbCwKbGltaXRfaWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmxpbWl0X2lkLApldmVudF90eXBlczogJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRfdHlwZXMsCmxvY2F0aW9uX2lkOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5sb2NhdGlvbl9pZCwKb3JpZ19ldmVudF90eXBlczogJHNjb3BlLnNlbGVjdGVkRXZlbnQub3JpZ19ldmVudF90eXBlcywKZW1wX2lkOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbXBfaWQKfTsKdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uKCRodHRwLCRzY29wZSx0aGVkYXRhLCRzY29wZS5zZWxlY3RlZEV2ZW50LmxpbWl0X2lkLCB1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25fc3VjY2Vzcyk7Cn0KZWxzZQovLyBub3QgZml4ZWQgc2NoZWR1bGUgLSBwZXJkYXkgYmxvY2sKewovLy8vLy8vLy8vLwppZiAoKCRzY29wZS5zZWxlY3RlZEV2ZW50LmxpbWl0X2lkICE9IG51bGwpICYgKCRzY29wZS5zZWxlY3RlZEV2ZW50LmRheV9saW1pdF9pZCA9PSAtMSkpIC8vIGV2ZW50IGxpbWl0YXRpb24gaGFzIGxpbWl0X2lkIHNvIGl0cyBhbiAxOTcwIGV2ZW50Ci8vIG5lZWQgdG8gYWRkIGEgbmV3IHBlcmRheSBsaW1pdGF0aW9uIHRoYXQgcG9pbnQgKGxpbWl0X2lkKSB0byB0aGUgb2xkIDE5NzAgZXZlbnQgdG8gcmVwbGFjdGUgaXQKewp0ZW1wX2xpbWl0X2lkID0gY2FsY190ZW1wX2xpbWl0X2lkKCk7Ci8vIHRoZWV2ZW50LnRlbXBfbGltaXRfaWQgPSB0ZW1wX2xpbWl0X2lkOwovLyB0aGVldmVudC5kYXlfbGltaXRfaWQgPSB0ZW1wX2xpbWl0X2lkOwovLyB0aGUgbW92ZWQgZXZlbnQgaW4gdGhlIGNhbGVuZGFyIG5vdyBoYXMgZGF5X2xpbWl0X2lkIGFuZCB0ZW1wX2xpbWl0X2lkCi8vIGlmIGl0cyBsb2FkZWQgZnJvbSB0aGUgZGIsIGl0IHdpbGwgb25seSBoYXZlIGRheV9saW1pdF9pZCAoYW5kIG5vdCB0aGUgdGVtcCBvbmUpCi8vIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWydjYWxlbmRhcl9ob3Vyc19vZl93b3JrJ10uZnVsbENhbGVuZGFyKCd1cGRhdGVFdmVudCcsIHRoZWV2ZW50KTsKLy8gY29uc29sZS5sb2coIlhYWFhYWFhYWFhYWFgiKTsKdGhlZGF0YSA9IHsKc3RhcnRfZGF0ZTogbmV3X3N0YXJ0LAplbmRfZGF0ZTogbmV3X2VuZCwKY29sb3I6ICcnLAp0ZW1wX2xpbWl0X2lkOiAwLApldmVudF90eXBlX2lkOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5ldmVudF90eXBlX2lkLApldmVudF90eXBlczogJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRfdHlwZXMsCmxpbWl0X2lkOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5pZCwKbG9jYXRpb25faWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmxvY2F0aW9uX2lkLAplbXBfaWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmVtcF9pZAovLyB0aXRsZTogdGhlZXZlbnQudGl0bGUKfTsKY3JlYXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5KCRodHRwLCRzY29wZSx0aGVkYXRhLHVwZGF0ZUNhbGVuZGFyTGltaXRhdGlvbl9zdWNjZXNzKTsKCn0KZWxzZQp7CnRoZWRhdGE9IHsKc3RhcnRfZGF0ZTogbmV3X3N0YXJ0LAplbmRfZGF0ZTogbmV3X2VuZCwKdGVtcF9kYXlfbGltaXRfaWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LnRlbXBfbGltaXRfaWQsCm9yaWdfZXZlbnRfdHlwZXM6ICRzY29wZS5zZWxlY3RlZEV2ZW50Lm9yaWdfZXZlbnRfdHlwZXMsCmV2ZW50X3R5cGVzOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5ldmVudF90eXBlcywKbG9jYXRpb25faWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmxvY2F0aW9uX2lkLApkYXlfbGltaXRfaWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmRheV9saW1pdF9pZCwKZW1wX2lkOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbXBfaWQKfTsKdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5KCRodHRwLCRzY29wZSx0aGVkYXRhLHVwZGF0ZUNhbGVuZGFyTGltaXRhdGlvbl9zdWNjZXNzKTsKfQp9Cn0KJHNjb3BlLmRlbGV0ZUxpbWl0YXRpb25Nb2RhbCA9IGZ1bmN0aW9uKCkgewpjYWxlbmRhciA9ICdjYWxlbmRhcl9ob3Vyc19vZl93b3JrJzsKCi8vIHJlbW92aW5nIGxpbWl0YXRpb24gZnJvbSBkYXRhYmFzZSwgaWYgdHJ1ZSAtIHJlbW92aW5nIGZyb20gZGlzcGxheSBhbHNvCmlmICgkc2NvcGUuZGVsZXRlQ2FsZW5kYXJEQkxpbWl0YXRpb25FdmVudChzZWxlY3RlZEV2ZW50KSkKewovLyAkc2NvcGUuZGVsZXRlQ2FsZW5kYXJKU0V2ZW50KGNhbGVuZGFyLCBzZWxlY3RlZEV2ZW50LmlkKTsKfQokdWliTW9kYWxJbnN0YW5jZS5kaXNtaXNzKCdkZWxldGUnKTsKfTsKJHNjb3BlLmRlbGV0ZUNhbGVuZGFySlNFdmVudCA9IGZ1bmN0aW9uKGNhbGVuZGFyLCBzZWxlY3RlZEV2ZW50aWQpIHsKCmxvZ0RlYnVnKCJjYWxlbmRhcl9ob3Vyc19vZl93b3JrX2NvbmZpZz0iICsgdWlDYWxlbmRhckNvbmZpZyk7CmxvZ0RlYnVnKCJ1aUNhbGVuZGFyQ29uZmlnW2NhbGVuZGFyXT0iICsgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnXSk7CmxvZ0RlYnVnKCJkZWxldGUganMgZXZlbnQgIiArIHNlbGVjdGVkRXZlbnRpZCk7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlbW92ZUV2ZW50cycsIFtzZWxlY3RlZEV2ZW50aWRdKTsgLy8gZ28gdG8gZGF0ZSBpbiBjYWxlbmRhciBnb3RvCn07CiRzY29wZS5kZWxldGVDYWxlbmRhckRCTGltaXRhdGlvbkV2ZW50ID0gZnVuY3Rpb24oc2VsZWN0ZWRFdmVudCkgewpjYWxlbmRhciA9ICdjYWxlbmRhcl9ob3Vyc19vZl93b3JrJzsKLy8gcmV0dXJuIGZhbHNlOwoKLy8gZGVsZXRpbmcgZXZlbnQgbGltaXRhdGlvbiAobm90IHBlciBkYXkpCi8vIGVpdGhlciBmcm9tIDE5NzAgKGhvdXJzX29mX3dvcmsgcGFnZSkKLy8gb3IgZnJvbSB0aGVpciBpbnN0YW5jZSBpbiB0aGUgY3VycmVudCB3ZWVrJ3MgbGltaXRhdGlvbi4KLy8gZWl0aGVyIHdheSBkYXlfbGltaXRfaWQgaXMgLTEgZm9yIGxpbWl0YXRpb25zIGZyb20gMTk3MAppZiAoc2VsZWN0ZWRFdmVudC5kYXlfbGltaXRfaWQgPT0gLTEpCnsKbG9nRGVidWcoInJlbW92aW5nIGV2ZW50IGxpbWl0YXRpb24sIGNoZWNraWduIGlmIGl0cyBpbiAxOTcwICh0aGUgb3JpZ2luYWwpIG9yIGFuIGluc3RhbmNlIGluIHByZXNlbnQiKTsKc2VsZWN0ZWREYXRlU3RhcnQgPSBuZXcgRGF0ZShzZWxlY3RlZEV2ZW50LnN0YXJ0KTsKLy8gaWYgaXRzIDE5NzAgdGhpcyBtZWFucyB3ZSdyZSBpbiB0aGUgaG91cnNfb2Zfd29yayBnZW5lcmFsIHBhZ2UKLy8gc28gd2Ugc2ltcGx5IGRlbGV0ZSBpdAppZiAoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSA9PSAxOTcwKQp7CmxvZ0RlYnVnKCJyZW1vdmluZyBldmVudCBsaW1pdGF0aW9uIGZyb20gMTk3MCIpOwp0aGVkYXRhPSB7CnRlbXBfbGltaXRfaWQ6IHNlbGVjdGVkRXZlbnQudGVtcF9saW1pdF9pZAp9OwpkZWxldGVDYWxlbmRhckxpbWl0YXRpb24oJGh0dHAsJHNjb3BlLHRoZWRhdGEsc2VsZWN0ZWRFdmVudC5saW1pdF9pZCwgZGVsZXRlQ2FsZW5kYXJMaW1pdGF0aW9uX3N1Y2Nlc3MpOwpmdW5jdGlvbiBkZWxldGVDYWxlbmRhckxpbWl0YXRpb25fc3VjY2VzcygpCnsKJHNjb3BlLmRlbGV0ZUNhbGVuZGFySlNFdmVudChjYWxlbmRhciwgc2VsZWN0ZWRFdmVudC5pZCk7Cn0KfQplbHNlCnsKLy8gcmVtb3ZpbmcgZXZlbnQgbGltaXRhdGlvbiBmcm9tIHRoZSBhIHNwZWNpZmljIHdlZWsKLy8gdGhpcyBtZWFucyBhZGRpbmcgZXZlbnQgbGltaXRhdGlvbiBwZXIgZGF5IHdpdGggcmFuZ2UgZW5kPXN0YXJ0Ci8vIG1heWJlIEJVRyBCVUdHWT8KbG9nRGVidWcoInggcmVtb3ZpbmcgZXZlbnQgbGltaXRhdGlvbiBmcm9tIGEgc3BlY2lmaWMgd2VlaywgdGhpcyBtZWFucyBhZGRpbmcgZXZlbnQgbGltaXRhdGlvbiBwZXIgZGF5IHdpdGggcmFuZ2UgMC0wIik7Ci8vIGxvZ0RlYnVnKEpTT04uc3RyaW5naWZ5KHNlbGVjdGVkRXZlbnQpKTsKCnRoZWRhdGEgPSB7CnN0YXJ0X2RhdGU6IHNlbGVjdGVkRXZlbnQuc3RhcnQsCmVuZF9kYXRlOiBzZWxlY3RlZEV2ZW50LnN0YXJ0LApjb2xvcjogIiMwMDAwMDAiLAp0ZW1wX2xpbWl0X2lkOiAxLApldmVudF90eXBlX2lkOiBzZWxlY3RlZEV2ZW50LmV2ZW50X3R5cGVfaWQsCmxvY2F0aW9uX2lkOiBzZWxlY3RlZEV2ZW50LmxvY2F0aW9uX2lkLApsaW1pdF9pZDogc2VsZWN0ZWRFdmVudC5saW1pdF9pZCwKdGl0bGU6IHNlbGVjdGVkRXZlbnQudGl0bGUKfTsKCmNyZWF0ZUNhbGVuZGFyTGltaXRhdGlvblBlckRheSgkaHR0cCwkc2NvcGUsdGhlZGF0YSxjcmVhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXlfc3VjY2Vzcyk7CmZ1bmN0aW9uIGNyZWF0ZUNhbGVuZGFyTGltaXRhdGlvblBlckRheV9zdWNjZXNzKCkKewokc2NvcGUuZGVsZXRlQ2FsZW5kYXJKU0V2ZW50KGNhbGVuZGFyLCBzZWxlY3RlZEV2ZW50LmlkKTsKfQp9Cn0KZWxzZQp7Ci8vIGRlbGV0aW5nIGEgcGVyZGF5IGxpbWl0YXRpb24uCi8vIGlmIGl0J3MgYSBwZXJkYXkgdGhhdCAicmVwbGFjZWQiIGEgMTk3MCBvbmUKLy8gdGhlbiB3ZSBjYW5ub3QgZGVsZXRlIGl0IChvdGhlcndpc2UgdGhlIG9yaWdpbmFsIDE5NzAgd2lsbCByZWFwcGVhcikKLy8gc28gd2Ugc2V0IGl0IHRvIHN0YXJ0PWVuZAovLyB0aGlzIG1heWJlIGEgQlVHIGFuZCBjYXVzZSBUUk9VQkxFIC8vIFRPRE8KLy8gb3RoZXdpc2Ugd2UgY2FuIGRlbGV0ZSBpdCAtIHRoZSBwZXJkYXkgLSBhcyBpdHMgYSBuZXcgcGVyZGF5IGFuZCBub3QgInJlcGxhY2luZyIgYSAxOTcwIG9uZQoKaWYgKHNlbGVjdGVkRXZlbnQubGltaXRfaWQgIT0gbnVsbCkgLy8gdGhpcyBpcyB0aGUgcGVyZGF5IHRoYXQgcmVwbGFjZXMgYSAxOTcwIG9uZSAtIHdlIHNldCBpdCB0byBzdGFydD1lbmQKewpsb2dEZWJ1ZygicmVtb3ZpbmcgZXZlbnQgbGltaXRhdGlvbiBwZXIgZGF5IHJlbGF0ZWQgdG8gMTk3MCAodXBkYXRpbmcgaXQgdG8gc3RhcnQ9ZW5kKSIpOwoKdGhlZGF0YT0gewpzdGFydF9kYXRlOiBzZWxlY3RlZEV2ZW50LnN0YXJ0LAplbmRfZGF0ZTogc2VsZWN0ZWRFdmVudC5zdGFydCwKdGVtcF9kYXlfbGltaXRfaWQ6IHNlbGVjdGVkRXZlbnQudGVtcF9saW1pdF9pZCwKZGF5X2xpbWl0X2lkOiBzZWxlY3RlZEV2ZW50LmRheV9saW1pdF9pZAp9Owp1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXkoJGh0dHAsJHNjb3BlLHRoZWRhdGEsdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5X3N1Y2Nlcyk7CgpmdW5jdGlvbiB1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXlfc3VjY2VzKCkKewokc2NvcGUuZGVsZXRlQ2FsZW5kYXJKU0V2ZW50KGNhbGVuZGFyLCBzZWxlY3RlZEV2ZW50LmlkKTsKfQp9CmVsc2UgIC8vIHRoaXMgaXMgdGhlIGNhc2Ugd2hlcmUgdGhlIHBlcmRheSBkb2VzbnQgcmVwbGFjZSBhIDE5NzAgb25lLCB3ZSBjYW4gc2ltcGx5IGRlbGV0ZSBpdAp7CmxvZ0RlYnVnKCJyZW1vdmluZyBldmVudCBsaW1pdGF0aW9uIHBlciBkYXkgcmVsYXRlZCBub3QgcmVsYXRlZCB0byAxOTcwIChzbyB3ZSdyZSBkZWxldGluZyBpdCkiKTsKdGhlZGF0YSA9IHsKdGVtcF9saW1pdF9pZDogc2VsZWN0ZWRFdmVudC50ZW1wX2xpbWl0X2lkCn07CmRlbGV0ZUNhbGVuZGFyTGltaXRhdGlvblBlckRheSgkaHR0cCwkc2NvcGUsdGhlZGF0YSxzZWxlY3RlZEV2ZW50LmRheV9saW1pdF9pZCwgZGVsZXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5X3N1Y2Nlc3MpOwpmdW5jdGlvbiBkZWxldGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXlfc3VjY2VzcygpCnsKJHNjb3BlLmRlbGV0ZUNhbGVuZGFySlNFdmVudChjYWxlbmRhciwgc2VsZWN0ZWRFdmVudC5pZCk7Cn0KfQp9CmxvZ0RlYnVnKCJhZnRlciByZW1vdmUgZXZlbnQiKTsKCn07CgoKJHNjb3BlLnN0YXJ0TWludXRlcyA9IGZ1bmN0aW9uKCkKewpsb2dEZWJ1Zygic3RhcnRNaW51dGVzICIrKCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcykpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXM9bWludXRlc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKTsKY2FsY3VsYXRlU3RhcnRUaW1lKCk7Cn0KJHNjb3BlLnN0YXJ0SG91cnMgPSBmdW5jdGlvbigpCnsKbG9nRGVidWcoInN0YXJ0SG91cnMgIitob3Vyc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzPWhvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKTsKY2FsY3VsYXRlU3RhcnRUaW1lKCk7Cn0KJHNjb3BlLmVuZE1pbnV0ZXMgPSBmdW5jdGlvbigpCnsKbG9nRGVidWcoImVuZE1pbnV0ZXMgIisoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcykpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzPW1pbnV0ZXNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpOwpjYWxjdWxhdGVFbmRUaW1lKCk7Cn0KJHNjb3BlLmVuZEhvdXJzID0gZnVuY3Rpb24oKQp7CmxvZ0RlYnVnKCJlbmRIb3VycyAiK2hvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycykpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vycz1ob3Vyc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMpOwpjYWxjdWxhdGVFbmRUaW1lKCk7Cn0KCgpmdW5jdGlvbiBjYWxjdWxhdGVTdGFydFRpbWUoKQp7CmV2ZW50WWVhcj0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXI7CmV2ZW50TW9udGg9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aDExMjsKZXZlbnREYXk9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXlvZm1vbnRoOwppZiAocGFyc2VJbnQoZXZlbnRNb250aCk8MTApCnsKZXZlbnRNb250aD0iMCIrZXZlbnRNb250aDsKfQppZiAocGFyc2VJbnQoZXZlbnREYXkpPDEwKQp7CmV2ZW50RGF5PSIwIitldmVudERheTsKfQoKbmV3X3N0YXJ0PW1vbWVudC51dGMoZXZlbnRZZWFyKyItIitldmVudE1vbnRoKyItIitldmVudERheSsiVDAwOjAwOjAwIikuYWRkKCgocGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykqNjApK3BhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcykpLCAnbWludXRlcycpOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWU9bmV3X3N0YXJ0Owpsb2dEZWJ1ZygibmV3X3N0YXJ0PSIrbmV3X3N0YXJ0KTsKfQpmdW5jdGlvbiBjYWxjdWxhdGVFbmRUaW1lKCkKewpldmVudFllYXI9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyOwpldmVudE1vbnRoPSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bW9udGgxMTI7CmV2ZW50RGF5PSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aDsKaWYgKHBhcnNlSW50KGV2ZW50TW9udGgpPDEwKQp7CmV2ZW50TW9udGg9IjAiK2V2ZW50TW9udGg7Cn0KaWYgKHBhcnNlSW50KGV2ZW50RGF5KTwxMCkKewpldmVudERheT0iMCIrZXZlbnREYXk7Cn0KCm5ld19lbmQ9bW9tZW50LnV0YyhldmVudFllYXIrIi0iK2V2ZW50TW9udGgrIi0iK2V2ZW50RGF5KyJUMDA6MDA6MDAiKS5hZGQoKChwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycykqNjApK3BhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpKSwgJ21pbnV0ZXMnKTsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmRfdGltZT1uZXdfZW5kOwpsb2dEZWJ1ZygibmV3X2VuZD0iK25ld19lbmQpOwp9CgpjYWxjdWxhdGVTdGFydFRpbWUoKTsKY2FsY3VsYXRlRW5kVGltZSgpOwoKZnVuY3Rpb24gbWludXRlc0NoYW5nZWQodGhlbWludXRlcykKewpsb2dEZWJ1ZygidGhlbWludXRlcz0iK3RoZW1pbnV0ZXMpOwppZiAodHlwZW9mIHRoZW1pbnV0ZXM9PSJ1bmRlZmluZWQiKQp7CnJldHVybiAiMDAiOwp9CnRoZW1pbnV0ZXM9cGFyc2VJbnQodGhlbWludXRlcyk7CmlmICh0aGVtaW51dGVzPjYwKQp7CnJldHVybiAiMDAiOwp9CmVsc2UgaWYgKHRoZW1pbnV0ZXM8MCkKewpyZXR1cm4gIjAwIjsKfQplbHNlIGlmICh0aGVtaW51dGVzPT0iIikKewpyZXR1cm4gIjAwIjsKfQplbHNlIGlmICh0aGVtaW51dGVzPDEwKQp7CnJldHVybiAiMCIrdGhlbWludXRlczsKfQplbHNlCnsKcmV0dXJuIHRoZW1pbnV0ZXM7Cn0KfQpmdW5jdGlvbiBob3Vyc0NoYW5nZWQodGhlaG91cnMpCnsKbG9nRGVidWcoInRoZWhvdXJzPSIrdGhlaG91cnMpOwppZiAodHlwZW9mIHRoZWhvdXJzPT0idW5kZWZpbmVkIikKewpyZXR1cm4gIjAiOwp9CnRoZWhvdXJzPXBhcnNlSW50KHRoZWhvdXJzKTsKaWYgKHRoZWhvdXJzPjI0KQp7CnJldHVybiAwOwp9CmVsc2UgaWYgKHRoZWhvdXJzPDApCnsKcmV0dXJuIDA7Cn0KZWxzZSBpZiAodGhlaG91cnM9PSIiKQp7CnJldHVybiAiMCI7Cn0KZWxzZQp7CnJldHVybiB0aGVob3VyczsKfQp9Cgp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ0V2ZW50VHlwZXNDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGNvbXBpbGUsIHVpQ2FsZW5kYXJDb25maWcsICR1aWJNb2RhbCwkbG9jYXRpb24pIHsKbG9nRGVidWcoJ0V2ZW50VHlwZXMgQ29udHJvbGxlcicpOwoKZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzKCRodHRwLCRzY29wZSwnZXZlbnRfdHlwZXMnKTsKJHNjb3BlLnNob3dFdmVudFR5cGUgPSBmdW5jdGlvbiAodGhlRXZlbnQpCnsKJGxvY2F0aW9uLnBhdGgoJy9ldmVudF90eXBlcy8nK3RoZUV2ZW50LmV2ZW50X3R5cGVfaWQpOwp9Cn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdFdmVudFR5cGVOZXdDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGNvbXBpbGUsIHVpQ2FsZW5kYXJDb25maWcsICR1aWJNb2RhbCwgJGxvY2F0aW9uKSB7CmxvZ0RlYnVnKCdFdmVudFR5cGVzIENvbnRyb2xsZXIgTmV3Jyk7Cgokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcyA9IHt9OyAvLyB0aGVzZSBhcmUgdGhlIGNvbXBsZXRlIGRldGFpbHMgZm9yIHRoZSBuZXcgZXZlbnQgLy8KJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuaXNfY2xhc3MgPSAwOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5ibG9ja0V4dHJhVGltZSA9IGZhbHNlOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5kdXJhdGlvbl9iZWZvcmVfZXZlbnQgPSAwOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5kdXJhdGlvbl9hZnRlcl9ldmVudCA9IDA7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmluaGVyaXRfbWFpbl9ob3VycyA9IDE7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF93YWl0aW5nX2xpc3QgPSAzOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5pc191cGRhdGUgPSBmYWxzZTsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMubWF4X3BhcnRpY2lwYW50cyA9IDE7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF9yZWdpc3RyYXRpb25zPTE7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmlzX3B1YmxpYz0xOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5pbnN0cnVjdG9yX2lkPTA7Cgokc2NvcGUuZXZlbnRDb2xvclN0eWxlID0ge307CmRlZmF1bHRDb2xvciA9ICcwMGE2NWEnOwokc2NvcGUuZXZlbnRDb2xvclN0eWxlW2RlZmF1bHRDb2xvcl0gPSB7Cid0cmFuc2Zvcm0nOiAncm90YXRlKDMwZGVnKScKfTsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXZlbnRDb2xvciA9ICIjIiArIGRlZmF1bHRDb2xvcjsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMgPSBbCnsiZmllbGRfbmFtZSI6Iteh15nXm9eV150g157XpNeS16kiLCJmaWVsZF9kYXRhdHlwZSI6IlRFWFRfQVJFQSIsImlzX21hbmRhdG9yeSI6MCwgImZyb21kYiI6IGZhbHNlLCAiZGJfaWRfdG9maXgiOiAwLCAiaXNfYWN0aXZlIjogMSwgIm1vZGlmaWVkIjogZmFsc2V9LAp7ImZpZWxkX25hbWUiOiLXqdeZ16LXldeo15kg15HXmdeqIiwiZmllbGRfZGF0YXR5cGUiOiJURVhUX0FSRUEiLCJpc19tYW5kYXRvcnkiOjAsICJmcm9tZGIiOiBmYWxzZSwgImRiX2lkX3RvZml4IjogMCwgImlzX2FjdGl2ZSI6IDEsICJtb2RpZmllZCI6IGZhbHNlfQpdOwoKZ2V0QWxsSW5zdHJ1Y3RvcnMoJGh0dHAsJHNjb3BlLCdpbnN0cnVjdG9ycycsZ2V0QWxsSW5zdHJ1Y3RvcnNfc3VjY2Vzcyk7CmZ1bmN0aW9uIGdldEFsbEluc3RydWN0b3JzX3N1Y2Nlc3MoKQp7Ci8vICRzY29wZS5pbnN0cnVjdG9ycy51bnNoaWZ0KHtidXNpbmVzc191c2VyX2lkOjAsIGJ1c2VyX2ZpcnN0X25hbWU6IiIsIGJ1c2VyX2xhc3RfbmFtZToiIn0pOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5pbnN0cnVjdG9yX2lkPSRzY29wZS5pbnN0cnVjdG9yc1swXS5idXNpbmVzc191c2VyX2lkOwp9Cgokc2NvcGUuZXZlbnRUeXBlRXh0cmFGaWVsZHNQb3AgPSBmdW5jdGlvbihldmVudFR5cGVQcm9wZXJ0aWVzKSB7CiAgICAgICAgbG9nRGVidWcoImV2ZW50VHlwZUV4dHJhRmllbGRzUG9wMSIpOwoKdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CmFuaW1hdGlvbjogZmFsc2UsCnRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2V2ZW50X3R5cGVfZXh0cmFfZmllbGRzLnBocCcsCmNvbnRyb2xsZXI6ICdldmVudFR5cGVFeHRyYUZpZWxkc01vZGFsQ29udHJvbGxlcicsCnNpemU6ICdsJywKcmVzb2x2ZTogewpldmVudFR5cGVQcm9wZXJ0aWVzOiBmdW5jdGlvbigpIHsKcmV0dXJuIGV2ZW50VHlwZVByb3BlcnRpZXM7Cn0KfQp9KTsKCm1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24oc2VsZWN0ZWRJdGVtKSB7CmxvZ0RlYnVnKHNlbGVjdGVkSXRlbSk7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzID0gc2VsZWN0ZWRJdGVtOwp9LCBmdW5jdGlvbigpIHsKbG9nRGVidWcoJ01vZGFsIGRpc21pc3NlZCBhdDogJyArIG5ldyBEYXRlKCkpOwp9KTsKfTsKCiRzY29wZS5jaGFuZ2VFdmVudENvbG9yID0gZnVuY3Rpb24obmV3Q29sb3IpIHsKbG9nRGVidWcoImNob29zaW5nIGNvbG9yICIgKyBuZXdDb2xvcik7CiRzY29wZS5ldmVudENvbG9yID0gbmV3Q29sb3I7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV2ZW50Q29sb3IgPSAiIyIgKyBuZXdDb2xvcjsKJHNjb3BlLmV2ZW50Q29sb3JTdHlsZSA9IHsKJ2JhY2tncm91bmQtY29sb3InOiAiIyIgKyBuZXdDb2xvcgp9Owokc2NvcGUuZXZlbnRDb2xvclN0eWxlW25ld0NvbG9yXSA9IHsKJ3RyYW5zZm9ybSc6ICdyb3RhdGUoMzBkZWcpJwp9OwoKfQoKJHNjb3BlLmFkZEV2ZW50VHlwZUNhbmNlbCA9IGZ1bmN0aW9uKCkgewokbG9jYXRpb24ucGF0aCgnL2V2ZW50X3R5cGVzJyk7Cn07CgogICAgJHNjb3BlLmR1cGxpY2F0ZUZpZWxkTmFtZXM9IiI7CiRzY29wZS5hZGRFdmVudFR5cGUgPSBmdW5jdGlvbigpIHsKICAgICAgICAvLyBjaGVjayBleHRyYSBmaWVsZHMgZHVwbGljYXRlIG5hbWVzIC0gc3RhcnQKICAgICAgICBsb2dEZWJ1ZygiYWRkRXZlbnRUeXBlOiBjaGVjayBleHRyYSBmaWVsZHMgZHVwbGljYXRlIG5hbWVzIC0gc3RhcnQiKTsKICAgICAgICB2YXIgZXh0cmFGaWVsZHNOYW1lcyA9IFtdOwogICAgICAgIGZvciAodmFyIGk9MTsgaTwkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcy5sZW5ndGg7IGkrKykKICAgICAgICB7CiAgICAgICAgICBleHRyYUZpZWxkc05hbWVzLnB1c2goJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHNbaV0uZmllbGRfbmFtZSk7CiAgICAgICAgfQogICAgICAgIGV4dHJhRmllbGRzTmFtZXMuc29ydCgpOwogICAgICAgIHZhciBsYXN0ID0gZXh0cmFGaWVsZHNOYW1lc1swXTsKICAgICAgICBmb3IgKHZhciBpPTE7IGk8ZXh0cmFGaWVsZHNOYW1lcy5sZW5ndGg7IGkrKykKICAgICAgICB7CiAgICAgICAgICAgaWYgKGV4dHJhRmllbGRzTmFtZXNbaV0gPT0gbGFzdCkKICAgICAgICAgICB7CiAgICAgICAgICAgIC8vICBhbGVydCgnRHVwbGljYXRlIDogJytsYXN0KTsKICAgICAgICAgICAgICRzY29wZS5kdXBsaWNhdGVGaWVsZE5hbWVzPSfXp9eZ15nXnSDXqdeT15Qg16rXmdei15XXkyDXqNek15XXkNeZINeb16TXldecINeR16nXnSAiJytsYXN0KyciLi4uJzsKICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICB9CiAgICAgICAgICAgbGFzdCA9IGV4dHJhRmllbGRzTmFtZXNbaV07CiAgICAgICAgfQogICAgICAgIC8vIGNoZWNrIGV4dHJhIGZpZWxkcyBkdXBsaWNhdGUgbmFtZXMgLSBlbmQKCmxvZ0RlYnVnKCJhZGQgRXZlbnQgVHlwZSIgKyAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcyArICJleHRyYSBmaWVsZHM9IiArJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMpOwppZiAoKCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF9yZWdpc3RyYXRpb25zPT0nJykgfHwgKCEkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5tYXhfcmVnaXN0cmF0aW9ucykpCnsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMubWF4X3JlZ2lzdHJhdGlvbnM9MDsKfQphZGRFdmVudFR5cGUoJGh0dHAsJHNjb3BlLCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLGFkZEV2ZW50VHlwZV9zdWNjZXNzKTsKZnVuY3Rpb24gYWRkRXZlbnRUeXBlX3N1Y2Nlc3MoKQp7CiRsb2NhdGlvbi5wYXRoKCcvZXZlbnRfdHlwZXMnKTsKfQp9Owp9KTsKCmt1emVBcHAuY29udHJvbGxlcignRXZlbnRUeXBlVXBkYXRlQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRjb21waWxlLCAkcm91dGVQYXJhbXMsIHVpQ2FsZW5kYXJDb25maWcsICR1aWJNb2RhbCwgJGxvY2F0aW9uKSB7CmV2ZW50X3R5cGVfaWQ9JHJvdXRlUGFyYW1zLmV2ZW50X3R5cGVfaWQ7CmxvZ0RlYnVnKCdFdmVudFR5cGVzIENvbnRyb2xsZXIgVXBkYXRlICcrZXZlbnRfdHlwZV9pZCk7Cgokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcyA9IHt9OyAvLyB0aGVzZSBhcmUgdGhlIGNvbXBsZXRlIGRldGFpbHMgZm9yIHRoZSBuZXcgZXZlbnQgLy8KJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuaXNfdXBkYXRlID0gdHJ1ZTsKCiRzY29wZS5ldmVudENvbG9yU3R5bGUgPSB7fTsKZ2V0QWxsSW5zdHJ1Y3RvcnMoJGh0dHAsJHNjb3BlLCdpbnN0cnVjdG9ycycsZ2V0QWxsSW5zdHJ1Y3RvcnNfc3VjY2Vzcyk7CmZ1bmN0aW9uIGdldEFsbEluc3RydWN0b3JzX3N1Y2Nlc3MoKQp7CiRzY29wZS5pbnN0cnVjdG9ycy51bnNoaWZ0KHtidXNpbmVzc191c2VyX2lkOm51bGwsIGJ1c2VyX2ZpcnN0X25hbWU6IiIsIGJ1c2VyX2xhc3RfbmFtZToiIn0pOwp9CgpnZXRCdXNpbmVzc0V2ZW50VHlwZSgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmV2ZW50X3R5cGVfaWQsJ2V2ZW50VHlwZVByb3BlcnRpZXMnLGdldEJ1c2luZXNzRXZlbnRUeXBlX3N1Y2Nlc3MpOwoKZnVuY3Rpb24gZ2V0QnVzaW5lc3NFdmVudFR5cGVfc3VjY2VzcygpCnsKaWYgKCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF9yZWdpc3RyYXRpb25zPT1udWxsKQp7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF9yZWdpc3RyYXRpb25zPTE7Cn0KaWYgKCgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5kdXJhdGlvbl9iZWZvcmVfZXZlbnQ+MCkgfCAoJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZHVyYXRpb25fYWZ0ZXJfZXZlbnQ+MCkpCnsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuYmxvY2tFeHRyYVRpbWUgPSAxOwp9CmVsc2UKewokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5ibG9ja0V4dHJhVGltZSA9IDA7Cn0KLy8gJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuaW5oZXJpdF9tYWluX2hvdXJzID0gcmVzcG9uc2UuZGF0YVswXS5pbmhlcml0X21haW5faG91cnM7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmlzX3VwZGF0ZSA9IHRydWU7CmxvZ0RlYnVnKCIkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5jb2xvcj0iKyRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmNvbG9yKTsKJHNjb3BlLmV2ZW50Q29sb3JTdHlsZVskc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5jb2xvcl0gPSB7Cid0cmFuc2Zvcm0nOiAncm90YXRlKDMwZGVnKScKfTsKJHNjb3BlLmNoYW5nZUV2ZW50Q29sb3IoKCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmNvbG9yKS5zdWJzdHIoMSkpOwpsb2dEZWJ1ZygiJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuaW5zdHJ1Y3Rvcl9pZD0iKyRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmluc3RydWN0b3JfaWQpOwovLyBzYXZpbmcgZXZlbnQgdHlwZSBkZXRhaWxzIGFzaWRlIHRvIGxhdGVyIGNoZWNrIGlmIGFueXRoaW5nIGNoYW5nZWQKbG9nRGVidWcoImR1cGxpY2F0aW5nIG9iamVjdCBvZiBldmVudCB0eXBlIHRvIGxhdGVyIGNvbXBhcmUgIit0eXBlb2YgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMpOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllc0R1cGxpY2F0ZSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMpKTsKbG9nRGVidWcoIiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzRHVwbGljYXRlID0iKyRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzRHVwbGljYXRlLmV2ZW50X3R5cGVfbmFtZSk7Cn07CgovLyBldmVudCB0eXBlIGNoYW5nZWQgcG9wdXAKJHNjb3BlLmV2ZW50VHlwZUNoYW5nZWRQb3B1cCA9IGZ1bmN0aW9uKGV2ZW50VHlwZVByb3BlcnRpZXMpIHsKICAgICAgICBsb2dEZWJ1ZygiZXZlbnRUeXBlQ2hhbmdlZFBvcHVwIik7Cgp2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKYW5pbWF0aW9uOiBmYWxzZSwKdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfZXZlbnRfdHlwZV9jaGFuZ2VkLnBocCcsCmNvbnRyb2xsZXI6ICdldmVudFR5cGVDaGFuZ2VkUG9wdXBDb250cm9sbGVyJywKc2l6ZTogJ2wnLApyZXNvbHZlOiB7CmV2ZW50VHlwZVByb3BlcnRpZXM6IGZ1bmN0aW9uKCkgewpyZXR1cm4gJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXM7Cn0KfQp9KTsKCm1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24oc2VsZWN0ZWRJdGVtKQp7CmxvZ0RlYnVnKHNlbGVjdGVkSXRlbSk7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzID0gc2VsZWN0ZWRJdGVtOwp9LCBmdW5jdGlvbigpIHsKbG9nRGVidWcoJ01vZGFsIGRpc21pc3NlZCBhdDogJyArIG5ldyBEYXRlKCkpOwp9KTsKfTsKCi8vIGV2ZW50IHR5cGUgZXh0cmEgZmllbGQgcG9wdXAKJHNjb3BlLmV2ZW50VHlwZUV4dHJhRmllbGRzUG9wID0gZnVuY3Rpb24oZXZlbnRUeXBlUHJvcGVydGllcykgewogICAgICAgIGxvZ0RlYnVnKCJldmVudFR5cGVFeHRyYUZpZWxkc1BvcDIiKTsKCnZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewphbmltYXRpb246IGZhbHNlLAp0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9ldmVudF90eXBlX2V4dHJhX2ZpZWxkcy5waHAnLApjb250cm9sbGVyOiAnZXZlbnRUeXBlRXh0cmFGaWVsZHNNb2RhbENvbnRyb2xsZXInLApzaXplOiAnbCcsCnJlc29sdmU6IHsKZXZlbnRUeXBlUHJvcGVydGllczogZnVuY3Rpb24oKSB7CnJldHVybiBldmVudFR5cGVQcm9wZXJ0aWVzOwp9Cn0KfSk7Cgptb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHNlbGVjdGVkSXRlbSkgewpsb2dEZWJ1ZyhzZWxlY3RlZEl0ZW0pOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyA9IHNlbGVjdGVkSXRlbTsKfSwgZnVuY3Rpb24oKSB7CmxvZ0RlYnVnKCdNb2RhbCBkaXNtaXNzZWQgYXQ6ICcgKyBuZXcgRGF0ZSgpKTsKfSk7Cn07CgoKJHNjb3BlLmNoYW5nZUV2ZW50Q29sb3IgPSBmdW5jdGlvbihuZXdDb2xvcikgewpsb2dEZWJ1ZygiY2hvb3NpbmcgY29sb3IgIiArIG5ld0NvbG9yKTsKJHNjb3BlLmV2ZW50Q29sb3IgPSBuZXdDb2xvcjsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXZlbnRDb2xvciA9ICIjIiArIG5ld0NvbG9yOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5jb2xvciA9ICIjIiArIG5ld0NvbG9yOwokc2NvcGUuZXZlbnRDb2xvclN0eWxlID0gewonYmFja2dyb3VuZC1jb2xvcic6ICIjIiArIG5ld0NvbG9yCn07CiRzY29wZS5ldmVudENvbG9yU3R5bGVbbmV3Q29sb3JdID0gewondHJhbnNmb3JtJzogJ3JvdGF0ZSgzMGRlZyknCn07Cgp9Cgokc2NvcGUuYWRkRXZlbnRUeXBlQ2FuY2VsID0gZnVuY3Rpb24oKSB7CiRsb2NhdGlvbi5wYXRoKCcvZXZlbnRfdHlwZXMnKTsKfTsKCiRzY29wZS5hZGRFdmVudFR5cGUgPSBmdW5jdGlvbigpIHsgLy8gdGhpcyBmdW5jdGlvbiBVUERBVEVTIGV2ZW50IHR5cGUgKG5vdCBhZGRzKQovLyBjaGVja2luZyBpZiBhbnl0aGluZyBjaGFuZ2VkIHJlYWxseQovLyBhbmQgYXNraW5nIGlmIHdlIHNob3VsZCB1cGRhdGUgYWxsIGV2ZW50cyBmcm9tIG5vdyAob3Igb25seSBuZXdseSBjcmVhdGVkIGV2ZW50cykKLy8gY2hlY2tpbmcKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXNEdXBsaWNhdGUuZXh0cmFGaWVsZHM9JHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHM7CiAgICAgIC8vIGlmIChhbmd1bGFyLmVxdWFscygkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllc0R1cGxpY2F0ZSwkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcykpCiAgICAgIGlmICh0cnVlKSAvLyBpZ25vcmluZyB0cnlpbmcgdG8gbWFrZSBjaGFuZ2VzIHRvIGV2ZW50cwp7Ci8vICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzRHVwbGljYXRlLmV4dHJhRmllbGRzID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcykpOwoKbG9nRGVidWcoIm5vdGhpbmcgY2hhbmdlZCBpbiBldmVudCB0eXBlLCBvciBvbmx5IGV4dHJhIGZpZWxkcyIpOwokc2NvcGUudXBkYXRlRXZlbnRUeXBlKCk7Cn0KZWxzZQp7CmxvZ0RlYnVnKCJldmVudCB0eXBlIGNoYW5nZWQiKTsKJHNjb3BlLmV2ZW50VHlwZUNoYW5nZWRQb3B1cCgpOwp9Ci8vICRzY29wZS51cGRhdGVFdmVudFR5cGUoKTsKfQokc2NvcGUudXBkYXRlRXZlbnRUeXBlID0gZnVuY3Rpb24oKQp7CiAgICAgIC8vIGNoZWNrIGV4dHJhIGZpZWxkcyBkdXBsaWNhdGUgbmFtZXMgLSBzdGFydAogICAgICBsb2dEZWJ1ZygiYWRkRXZlbnRUeXBlOiBjaGVjayBleHRyYSBmaWVsZHMgZHVwbGljYXRlIG5hbWVzIC0gc3RhcnQiKTsKICAgICAgdmFyIGV4dHJhRmllbGRzTmFtZXMgPSBbXTsKICAgICAgZm9yICh2YXIgaT0xOyBpPCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzLmxlbmd0aDsgaSsrKQogICAgICB7CiAgICAgICAgZXh0cmFGaWVsZHNOYW1lcy5wdXNoKCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzW2ldLmZpZWxkX25hbWUpOwogICAgICB9CiAgICAgIGV4dHJhRmllbGRzTmFtZXMuc29ydCgpOwogICAgICB2YXIgbGFzdCA9IGV4dHJhRmllbGRzTmFtZXNbMF07CiAgICAgIGZvciAodmFyIGk9MTsgaTxleHRyYUZpZWxkc05hbWVzLmxlbmd0aDsgaSsrKQogICAgICB7CiAgICAgICAgIGlmIChleHRyYUZpZWxkc05hbWVzW2ldID09IGxhc3QpCiAgICAgICAgIHsKICAgICAgICAgIC8vICBhbGVydCgnRHVwbGljYXRlIDogJytsYXN0KTsKICAgICAgICAgICAgbG9nRGVidWcoJ9en15nXmdedINep15PXlCDXqteZ16LXldeTINeo16TXldeQ15kg15vXpNeV15wg15HXqdedICInK2xhc3QrJyIuLi4nKTsKICAgICAgICAgICAkc2NvcGUuZHVwbGljYXRlRmllbGROYW1lcz0n16fXmdeZ150g16nXk9eUINeq15nXoteV15Mg16jXpNeV15DXmSDXm9ek15XXnCDXkdep150gIicrbGFzdCsnIi4uLic7CiAgICAgICAgICAgcmV0dXJuOwogICAgICAgICB9CiAgICAgICAgIGxhc3QgPSBleHRyYUZpZWxkc05hbWVzW2ldOwogICAgICB9CiAgICAgIC8vIGNoZWNrIGV4dHJhIGZpZWxkcyBkdXBsaWNhdGUgbmFtZXMgLSBlbmQKCiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLnVwZGF0ZV9leGlzdGluZ19ldmVudHM9ZmFsc2U7CgogICAgICBsb2dEZWJ1ZygidXBkYXRlRXZlbnRUeXBlOiB1cGRhdGUgRXZlbnQgVHlwZSAiICsgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXZlbnRfdHlwZV9pZCk7CmlmICgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5tYXhfcmVnaXN0cmF0aW9ucz09JycpCnsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMubWF4X3JlZ2lzdHJhdGlvbnM9MDsKfQp1cGRhdGVFdmVudFR5cGUoJGh0dHAsJHNjb3BlLCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV2ZW50X3R5cGVfaWQsJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMsdXBkYXRlRXZlbnRUeXBlX3N1Y2Nlc3MpOwpmdW5jdGlvbiB1cGRhdGVFdmVudFR5cGVfc3VjY2VzcygpCnsKJGxvY2F0aW9uLnBhdGgoJy9ldmVudF90eXBlcycpOwp9Cn0KfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdldmVudENyZWF0ZU1vZGFsQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRyb290U2NvcGUsIHNoYXJlZFByb3BlcnRpZXMsIGV2ZW50X3R5cGVfaWQsIGxvY2F0aW9uX2lkLCBlbXBfaWQsICRodHRwLCBzdGFydERhdGUsIHJlc2NoZWR1bGVfZXZlbnQsIHVpQ2FsZW5kYXJDb25maWcpIHsKc3RhcnREYXRlPW5ldyBtb21lbnQoc3RhcnREYXRlKTsKbG9nRGVidWcoImV2ZW50Q3JlYXRlTW9kYWxDb250cm9sbGVyLCBzdGFydERhdGU9IitzdGFydERhdGUrIiB0eXBlICIrdHlwZW9mIHN0YXJ0RGF0ZSk7CmxvZ0RlYnVnKCJldmVudENyZWF0ZU1vZGFsQ29udHJvbGxlciwgcmVzY2hlZHVsZV9ldmVudD0iK3Jlc2NoZWR1bGVfZXZlbnQpOwoKJHNjb3BlLmV2ZW50VHlwZVRpdGxlID0gIteR15fXqCDXodeV15Ig157XpNeS16kiOwokc2NvcGUuc2hvd0V2ZW50VHlwZVNlbGVjdGVkID0gZmFsc2U7CiRzY29wZS5zaG93RXZlbnRDbGllbnRTZWxlY3RlZCA9IGZhbHNlOwokc2NvcGUubmV3RXZlbnREZXRhaWxzID0ge307IC8vIHRoZXNlIGFyZSB0aGUgY29tcGxldGUgZGV0YWlscyBmb3IgdGhlIG5ldyBldmVudCAvLwokc2NvcGUubmV3RXZlbnREZXRhaWxzLnJlcGVhdFR5cGUgPSAiZm9yZXZlciI7CiRzY29wZS5uZXdFdmVudERldGFpbHMucmVwZWF0Rml4ZWRUaW1lcyA9ICI0IjsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5tYXhfcGFydGljaXBhbnRzID0gMTsKCmxvZ0RlYnVnKCJYWFggPSAiK0pTT04uc3RyaW5naWZ5KHJlc2NoZWR1bGVfZXZlbnQpKTsKCiRzY29wZS5yZXNjaGVkdWxlX2V2ZW50PWZhbHNlOwokc2NvcGUucmVzY2hlZHVsZV9ldmVudF9kZXRhaWxzPXJlc2NoZWR1bGVfZXZlbnQ7CmlmICgkc2NvcGUucmVzY2hlZHVsZV9ldmVudF9kZXRhaWxzIT1udWxsKQp7CmxvZ0RlYnVnKCJyZXNjaGVkdWxlX2V2ZW50X2RldGFpbHM9Iiskc2NvcGUucmVzY2hlZHVsZV9ldmVudF9kZXRhaWxzLmV2ZW50X2lkKTsKbG9nRGVidWcoSlNPTi5zdHJpbmdpZnkoJHNjb3BlLnJlc2NoZWR1bGVfZXZlbnRfZGV0YWlscykpOwokc2NvcGUucmVzY2hlZHVsZV9ldmVudD10cnVlOwokc2NvcGUuZ2l2ZW5fZXZlbnRfdHlwZV9pZCA9ICRzY29wZS5yZXNjaGVkdWxlX2V2ZW50X2RldGFpbHMuZXZlbnRfdHlwZV9pZDsKLy8gc3RpbGwgcHJlZmVyaW5nIGVtcF9pZCBmcm9tIHNjaGVkdWxlciBzdWdnZXN0aW9uIGlzIGl0IHdhcyBzZWxlY3RlZAppZiAoZW1wX2lkIT0wKQp7CiRzY29wZS5naXZlbl9lbXBfaWQgPSBlbXBfaWQ7Cn0KZWxzZQp7CiRzY29wZS5naXZlbl9lbXBfaWQgPSAkc2NvcGUucmVzY2hlZHVsZV9ldmVudF9kZXRhaWxzLmluc3RydWN0b3JfaWQ7Cn0KLy8gc3RpbGwgcHJlZmVyaW5nIGxvY2F0aW9uX2lkIGZyb20gc2NoZWR1bGVyIHN1Z2dlc3Rpb24gb3ZlciB0aGUgb3JpZ2luYWwgbG9jYXRpb24gZnJvbSBldmVudAppZiAobG9jYXRpb25faWQhPTApCnsKJHNjb3BlLmdpdmVuX2xvY2F0aW9uX2lkID0gbG9jYXRpb25faWQ7Cn0KZWxzZQp7CiRzY29wZS5naXZlbl9sb2NhdGlvbl9pZCA9ICRzY29wZS5yZXNjaGVkdWxlX2V2ZW50X2RldGFpbHMubG9jYXRpb25faWQ7Cn0KfQplbHNlCnsKJHNjb3BlLmdpdmVuX2V2ZW50X3R5cGVfaWQgPSBldmVudF90eXBlX2lkOwokc2NvcGUuZ2l2ZW5fbG9jYXRpb25faWQgPSBsb2NhdGlvbl9pZDsKJHNjb3BlLmdpdmVuX2VtcF9pZCA9IGVtcF9pZDsKfQppZiAoJHNjb3BlLmdpdmVuX2V2ZW50X3R5cGVfaWQ+MCkKewokc2NvcGUucHJldmlvdXNseV9zZWxlY3RlZF9ldmVudF90eXBlPXRydWU7Cn0KZWxzZQp7CiRzY29wZS5wcmV2aW91c2x5X3NlbGVjdGVkX2V2ZW50X3R5cGU9ZmFsc2U7Cn0KbG9nRGVidWcoIiRzY29wZS5naXZlbl9ldmVudF90eXBlX2lkPSIrJHNjb3BlLmdpdmVuX2V2ZW50X3R5cGVfaWQpOwoKc2VsZWN0ZWREYXRlU3RhcnQgPSBuZXcgRGF0ZShzdGFydERhdGUpOwpsb2dEZWJ1Zygic2VsZWN0ZWREYXRlU3RhcnQgPSAiK3NlbGVjdGVkRGF0ZVN0YXJ0KTsKdmFyIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZSgpICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKCi8vIGxvZ0RlYnVnKCJkYXRlPSIgKyBzZWxlY3RlZERhdGVTdGFydCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50ID0gW107CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRIb3VycygpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBzZWxlY3RlZERhdGVTdGFydC5nZXRNaW51dGVzKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZG93ID0gZGF5TmFtZXNbc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RGF5KCldOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRhdGUgPSBzZWxlY3RlZERhdGVTdGFydDsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aCA9IG1vbnRoTmFtZXNbc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TW9udGgoKV07CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bW9udGgxMTIgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRNb250aCgpKzE7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aCA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldERhdGUoKTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RnVsbFllYXIoKTsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5zdGFydF90aW1lX2lucHV0X2Zvcm1hdD0gbmV3IERhdGUoMTk3MCwgMCwgMSwgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycywgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzLCAwKTsKCiRzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZCA9ICRzY29wZS5naXZlbl9lbXBfaWQ7CiRzY29wZS5uZXdFdmVudERldGFpbHMubG9jYXRpb25faWQgPSAkc2NvcGUuZ2l2ZW5fbG9jYXRpb25faWQ7CgpnZXRCdXNpbmVzc0xvY2F0aW9ucygkaHR0cCwkc2NvcGUsJ2J1c2luZXNzX2xvY2F0aW9ucycsZ2V0QnVzaW5lc3NMb2NhdGlvbnNfZmluaXNoKTsKZnVuY3Rpb24gZ2V0QnVzaW5lc3NMb2NhdGlvbnNfZmluaXNoKCkKewppZiAoJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5sb2NhdGlvbl9pZD09MCkKewokc2NvcGUubmV3RXZlbnREZXRhaWxzLmxvY2F0aW9uX2lkPSRzY29wZS5idXNpbmVzc19sb2NhdGlvbnNbMF0ubG9jYXRpb25faWQ7Cn0KfQoKY29uc29sZS5sb2coIiRzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZD0iKyRzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZCk7Ci8vIGlmIGNsaWVudCB3YXMgcHJldmlvdXNseSBzZWxlY3RlZAokc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcj1mYWxzZTsKbG9nRGVidWcoInNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXI9IitzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKTsKaWYgKHNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKSE9bnVsbCkKewovLyBjb25zb2xlLmxvZygiZ290IHByZXZpb3VzIHNlbGVjdGVkIHVzZXIgIitzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfZmlyc3RfbmFtZSk7CiRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VybmFtZT1zaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfZmlyc3RfbmFtZSsiICIrc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2VyX2xhc3RfbmFtZTsKJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXI9dHJ1ZTsKCiRzY29wZS5zaG93RXZlbnRDbGllbnRTZWxlY3RlZCA9IHRydWU7CiRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kdXNlcl9pZCA9IHNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKS5idXNpbmVzc191c2VyX2lkOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZHVzZXJfZmlyc3RfbmFtZSA9IHNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKS5idXNlcl9maXJzdF9uYW1lOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZHVzZXJfbGFzdF9uYW1lID0gc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2VyX2xhc3RfbmFtZTsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5idXNpbmVzc191c2VyX2lkID0gc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2luZXNzX3VzZXJfaWQ7Cgp9CiRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZSA9IHN0YXJ0RGF0ZTsKbG9nRGVidWcoIiRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZTE9Iiskc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWUpOwokc2NvcGUuc3RhcnRNaW51dGVzID0gZnVuY3Rpb24oKQp7CmxvZ0RlYnVnKCJzdGFydE1pbnV0ZXMgIisoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKSk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcz1taW51dGVzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpOwpjYWxjdWxhdGVTdGFydFRpbWUoKTsKY2FsY3VsYXRlRW5kVGltZUR5bmFtaWMoKTsKfQokc2NvcGUuc3RhcnRIb3VycyA9IGZ1bmN0aW9uKCkKewpsb2dEZWJ1Zygic3RhcnRIb3VycyAiK2hvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKSk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnM9aG91cnNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMpOwpjYWxjdWxhdGVTdGFydFRpbWUoKTsKY2FsY3VsYXRlRW5kVGltZUR5bmFtaWMoKTsKfQoKJHNjb3BlLmVuZE1pbnV0ZXMgPSBmdW5jdGlvbigpCnsKbG9nRGVidWcoImVuZE1pbnV0ZXMgIisoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcykpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzPW1pbnV0ZXNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpOwpjYWxjdWxhdGVTdGFydFRpbWUoKTsKY2FsY3VsYXRlRW5kVGltZUR5bmFtaWMoKTsKfQokc2NvcGUuZW5kSG91cnMgPSBmdW5jdGlvbigpCnsKbG9nRGVidWcoImVuZEhvdXJzICIraG91cnNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzKSk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzPWhvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vycyk7CmNhbGN1bGF0ZVN0YXJ0VGltZSgpOwpjYWxjdWxhdGVFbmRUaW1lRHluYW1pYygpOwp9CgpmdW5jdGlvbiBjYWxjdWxhdGVTdGFydFRpbWUoKQp7CmV2ZW50WWVhcj0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXI7CmV2ZW50TW9udGg9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aDExMjsKZXZlbnREYXk9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXlvZm1vbnRoOwppZiAocGFyc2VJbnQoZXZlbnRNb250aCk8MTApCnsKZXZlbnRNb250aD0iMCIrZXZlbnRNb250aDsKfQppZiAocGFyc2VJbnQoZXZlbnREYXkpPDEwKQp7CmV2ZW50RGF5PSIwIitldmVudERheTsKfQpsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyPSIrZXZlbnRZZWFyKTsKbG9nRGVidWcoIiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aD0iK2V2ZW50TW9udGgpOwpsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aD0iK2V2ZW50RGF5KTsKbmV3X3N0YXJ0PW1vbWVudC51dGMoZXZlbnRZZWFyKyItIitldmVudE1vbnRoKyItIitldmVudERheSsiVDAwOjAwOjAwIikuYWRkKCgocGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykqNjApK3BhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcykpLCAnbWludXRlcycpOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWU9bmV3X3N0YXJ0Owpsb2dEZWJ1ZygibmV3X3N0YXJ0PSIrbmV3X3N0YXJ0KTsKfQpmdW5jdGlvbiBtaW51dGVzQ2hhbmdlZCh0aGVtaW51dGVzKQp7CmxvZ0RlYnVnKCJ0aGVtaW51dGVzPSIrdGhlbWludXRlcyk7CmlmICh0eXBlb2YgdGhlbWludXRlcz09InVuZGVmaW5lZCIpCnsKcmV0dXJuICIwMCI7Cn0KaWYgKGlzTmFOKHRoZW1pbnV0ZXMpKQp7CnJldHVybiAiMDAiOwp9CmlmICh0aGVtaW51dGVzPT0nJykKewpyZXR1cm4gIjAwIjsKfQp0aGVtaW51dGVzPXBhcnNlSW50KHRoZW1pbnV0ZXMpOwppZiAodGhlbWludXRlcz42MCkKewpyZXR1cm4gIjAwIjsKfQplbHNlIGlmICh0aGVtaW51dGVzPDApCnsKcmV0dXJuICIwMCI7Cn0KZWxzZSBpZiAodGhlbWludXRlcz09IiIpCnsKcmV0dXJuICIwMCI7Cn0KZWxzZSBpZiAodGhlbWludXRlczwxMCkKewpyZXR1cm4gIjAiK3RoZW1pbnV0ZXM7Cn0KZWxzZQp7CnJldHVybiB0aGVtaW51dGVzOwp9Cn0KZnVuY3Rpb24gaG91cnNDaGFuZ2VkKHRoZWhvdXJzKQp7CmxvZ0RlYnVnKCJ0aGVob3Vycz0iK3RoZWhvdXJzKTsKaWYgKHR5cGVvZiB0aGVob3Vycz09InVuZGVmaW5lZCIpCnsKcmV0dXJuICIwIjsKfQppZiAoaXNOYU4odGhlaG91cnMpKQp7CnJldHVybiAiMCI7Cn0KaWYgKHRoZWhvdXJzPT0nJykKewpyZXR1cm4gIjAiOwp9CnRoZWhvdXJzPXBhcnNlSW50KHRoZWhvdXJzKTsKaWYgKHRoZWhvdXJzPjI0KQp7CnJldHVybiAwOwp9CmVsc2UgaWYgKHRoZWhvdXJzPDApCnsKcmV0dXJuIDA7Cn0KZWxzZSBpZiAodGhlaG91cnM9PSIiKQp7CnJldHVybiAiMCI7Cn0KZWxzZQp7CnJldHVybiB0aGVob3VyczsKfQp9CmdldEFsbEluc3RydWN0b3JzKCRodHRwLCRzY29wZSwnaW5zdHJ1Y3RvcnMnLGdldEFsbEluc3RydWN0b3JzX3N1Y2Nlc3MpOwpmdW5jdGlvbiBnZXRBbGxJbnN0cnVjdG9yc19zdWNjZXNzKCkKewovLyAkc2NvcGUuaW5zdHJ1Y3RvcnMudW5zaGlmdCh7YnVzaW5lc3NfdXNlcl9pZDpudWxsLCBidXNlcl9maXJzdF9uYW1lOiIiLCBidXNlcl9sYXN0X25hbWU6IiJ9KTsKaWYgKCEkc2NvcGUubmV3RXZlbnREZXRhaWxzLmluc3RydWN0b3JfaWQ+MCkKewokc2NvcGUubmV3RXZlbnREZXRhaWxzLmluc3RydWN0b3JfaWQ9JHNjb3BlLmluc3RydWN0b3JzWzBdLmJ1c2luZXNzX3VzZXJfaWQ7Cn0KfQoKJHNjb3BlLnNlbGVjdEV2ZW50VHlwZSA9IGZ1bmN0aW9uKCkgewovLyByZW1vdmluZyBldmVudCB0eXBlINeR15fXqCDXodeV15Ig157XpNeS16kKaWYgKCRzY29wZS5ldmVudFR5cGVPcHRpb25zWzBdLmV2ZW50X3R5cGVfaWQ9PTApCnsKJHNjb3BlLmV2ZW50VHlwZU9wdGlvbnMuc3BsaWNlKDAsIDEpOwp9CiRzY29wZS5hamF4X2Vycm9yPScnOwpjaG9pY2U9JHNjb3BlLnNlbGVjdEV2ZW50VHlwZVNlbGVjdGVkOwpsb2dEZWJ1Zygic2VsZWN0RXZlbnRUeXBlIik7CmxvZ0RlYnVnKEpTT04uc3RyaW5naWZ5KCRzY29wZS5zZWxlY3RFdmVudFR5cGVTZWxlY3RlZCkpOwokc2NvcGUuZXZlbnRUeXBlVGl0bGUgPSBjaG9pY2UuZXZlbnRfdHlwZV9uYW1lOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLmV2ZW50X3R5cGVfaWQgPSBjaG9pY2UuZXZlbnRfdHlwZV9pZDsKCiRzY29wZS5uZXdFdmVudERldGFpbHMuZXZlbnRfbmFtZSA9IGNob2ljZS5ldmVudF90eXBlX25hbWU7CiRzY29wZS5uZXdFdmVudERldGFpbHMub3JpZ2luYWxfZXZlbnRfbmFtZSA9IGNob2ljZS5ldmVudF90eXBlX25hbWU7CiRzY29wZS5uZXdFdmVudERldGFpbHMuZXZlbnRfZGVzY3JpcHRpb24gPSBjaG9pY2UuZXZlbnRfdHlwZV9kZXNjcmlwdGlvbjsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pc19jbGFzcyA9IGNob2ljZS5pc19jbGFzczsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5vcmlnaW5hbF9wcmljZSA9IGNob2ljZS5vcmlnaW5hbF9wcmljZTsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pc19nZW5lcmljX2V0eXBlID0gY2hvaWNlLmlzX2dlbmVyaWNfZXR5cGU7Ci8vICRzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZCA9IGNob2ljZS5pbnN0cnVjdG9yX2lkOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50ID0gY2hvaWNlLmR1cmF0aW9uX2V2ZW50OwovLyBsb2dEZWJ1Zygic2NvcGUubmV3RXZlbnREZXRhaWxzLmlzX2NsYXNzPSIrJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pc19jbGFzcyk7Ci8vIGxvZ0RlYnVnKCJzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZD0iKyRzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZCk7Ci8vIGxvZ0RlYnVnKCJzdGFydERhdGU9IitzdGFydERhdGUpOwovLyAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWUgPSBzdGFydERhdGU7CiRzY29wZS5uZXdFdmVudERldGFpbHMuZXZlbnR0eXBlID0gY2hvaWNlOwpjYWxjdWxhdGVFbmRUaW1lKCk7CgovLyAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWVfaW5wdXRfZm9ybWF0PSBuZXcgRGF0ZSgxOTcwLCAwLCAxLCAxNCwgNTcsIDApOwoKbG9nRGVidWcoIm5ld0V2ZW50IHN0YXJ0PSIgKyAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWUpOwpsb2dEZWJ1ZygibmV3RXZlbnQgZW5kPSIgKyAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZF90aW1lKTsKCiRzY29wZS5zaG93RXZlbnRUeXBlU2VsZWN0ZWQgPSB0cnVlOwp9CgovLyB0aGlzIGZ1bmN0aW9uIGNhbGN1bGF0ZXMgZW5kIHRpbWUgYWNjb3JkaW5nIHRvIHRoZSBsZW5ndGggb2YgdGhlIGV2ZW50dHlwZQpmdW5jdGlvbiBjYWxjdWxhdGVFbmRUaW1lKCkKewpjb25zb2xlLmxvZygiJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5zdGFydF90aW1lPSIrJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5zdGFydF90aW1lKTsKZW5kID0gbW9tZW50KCRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZSkuYWRkKCRzY29wZS5uZXdFdmVudERldGFpbHMuZHVyYXRpb25fZXZlbnQsICdtaW51dGVzJyk7CnNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKGVuZCk7CnNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKHNlbGVjdGVkRGF0ZUVuZC5nZXRUaW1lKCkgKyBzZWxlY3RlZERhdGVFbmQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMgPSBzZWxlY3RlZERhdGVFbmQuZ2V0SG91cnMoKTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kZG93ID0gZGF5TmFtZXNbc2VsZWN0ZWREYXRlRW5kLmdldERheSgpXTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcyA9IChzZWxlY3RlZERhdGVFbmQuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBzZWxlY3RlZERhdGVFbmQuZ2V0TWludXRlcygpOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZF90aW1lID0gZW5kOwovLyBjYWxjdWxhdGluZyBkdXJhdGlvbgokc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50PXBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpLXBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcyk7CiRzY29wZS5uZXdFdmVudERldGFpbHMuZHVyYXRpb25fZXZlbnQ9JHNjb3BlLm5ld0V2ZW50RGV0YWlscy5kdXJhdGlvbl9ldmVudCsocGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMpLXBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMpKSo2MDsKaWYgKCRzY29wZS5uZXdFdmVudERldGFpbHMuZHVyYXRpb25fZXZlbnQ8MCkKewokc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50PTA7Cn0KfQoKLy8gdGhpcyBmdW5jdGlvbiBjYWxjdWxhdGVzIGVuZCB0aW1lIGFjY29yZGluZyB0byB0aGUgaW5wdXQgZnJvbSBtb2RhbCB3aW5kb3cKLy8gYW5kIG5vdCBhY2NvcmRpbmcgdG8gZXZlbnQgdHlwZSBsZW5ndGgKZnVuY3Rpb24gY2FsY3VsYXRlRW5kVGltZUR5bmFtaWMoKQp7CmV2ZW50WWVhcj0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXI7CmV2ZW50TW9udGg9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aDExMjsKZXZlbnREYXk9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXlvZm1vbnRoOwppZiAocGFyc2VJbnQoZXZlbnRNb250aCk8MTApCnsKZXZlbnRNb250aD0iMCIrZXZlbnRNb250aDsKfQppZiAocGFyc2VJbnQoZXZlbnREYXkpPDEwKQp7CmV2ZW50RGF5PSIwIitldmVudERheTsKfQpsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyPSIrZXZlbnRZZWFyKTsKbG9nRGVidWcoIiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aD0iK2V2ZW50TW9udGgpOwpsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aD0iK2V2ZW50RGF5KTsKbmV3X2VuZD1tb21lbnQudXRjKGV2ZW50WWVhcisiLSIrZXZlbnRNb250aCsiLSIrZXZlbnREYXkrIlQwMDowMDowMCIpLmFkZCgoKHBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzKSo2MCkrcGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcykpLCAnbWludXRlcycpOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZF90aW1lPW5ld19lbmQ7CmxvZ0RlYnVnKCJuZXdfZW5kPSIrbmV3X2VuZCk7Ci8vIGNhbGN1bGF0aW5nIGR1cmF0aW9uCiRzY29wZS5uZXdFdmVudERldGFpbHMuZHVyYXRpb25fZXZlbnQ9cGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcyktcGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKTsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5kdXJhdGlvbl9ldmVudD0kc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50KyhwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycyktcGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykpKjYwOwppZiAoJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5kdXJhdGlvbl9ldmVudDwwKQp7CiRzY29wZS5uZXdFdmVudERldGFpbHMuZHVyYXRpb25fZXZlbnQ9MDsKfQp9CmdldEFsbEJ1c2luZXNzRXZlbnRUeXBlcygkaHR0cCwkc2NvcGUsJ2V2ZW50VHlwZU9wdGlvbnMnLGdldEFsbEJ1c2luZXNzRXZlbnRUeXBlc19zdWNjZXNzKTsKZnVuY3Rpb24gZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzX3N1Y2Nlc3MoKQp7Ci8vIGFmdGVyIGxvYWRpbmcgZXZlbnQgdHlwZXMsIGlmIHRoZSBnaXZlbiBldmVudCB0eXBlIGlzICE9IDAgd2UgInNlbGVjdCIgaXQKY29uc29sZS5sb2coImdldEFsbEJ1c2luZXNzRXZlbnRUeXBlc19zdWNjZXNzIik7CmlmICgkc2NvcGUuZ2l2ZW5fZXZlbnRfdHlwZV9pZD4wKQp7CmZvcih2YXIgaSA9IDA7IGkgPCAkc2NvcGUuZXZlbnRUeXBlT3B0aW9ucy5sZW5ndGg7IGkrKykKewppZiAoJHNjb3BlLmV2ZW50VHlwZU9wdGlvbnNbaV0uZXZlbnRfdHlwZV9pZD09JHNjb3BlLmdpdmVuX2V2ZW50X3R5cGVfaWQpCnsKY29uc29sZS5sb2coImdpdmVuX2V2ZW50X3R5cGVfaWQgZm91bmQiKTsKLy8gJHNjb3BlLmNhbGN1bGF0ZVN0YXJ0VGltZSgpOwokc2NvcGUuc2VsZWN0RXZlbnRUeXBlU2VsZWN0ZWQ9JHNjb3BlLmV2ZW50VHlwZU9wdGlvbnNbaV07Ci8vICRzY29wZS5zZWxlY3RFdmVudFR5cGUoJHNjb3BlLmV2ZW50VHlwZU9wdGlvbnNbaV0pOwokc2NvcGUuc2VsZWN0RXZlbnRUeXBlKCk7Cn0KfQp9CmVsc2Ugewokc2NvcGUuZXZlbnRUeXBlT3B0aW9ucy51bnNoaWZ0KHsiZXZlbnRfdHlwZV9pZCI6MCwgImV2ZW50X3R5cGVfbmFtZSI6IteR15fXqCDXodeV15Ig157XpNeS16kiLCBpc192YWNhdGlvbjogMH0pOwokc2NvcGUuc2VsZWN0RXZlbnRUeXBlU2VsZWN0ZWQ9JHNjb3BlLmV2ZW50VHlwZU9wdGlvbnNbMF07Cn0KfQpnZXRBbGxDbGllbnRzKCRodHRwLCRzY29wZSwnZXZlbnRUeXBlVXNlcnMnKTsKCiRzY29wZS5ldmVudENsaWVudFNlbGVjdGVkID0gZnVuY3Rpb24oc2VsZWN0ZWQpIHsKaWYgKHNlbGVjdGVkKSB7Ci8vIGFsZXJ0KEpTT04uc3RyaW5naWZ5KCBzZWxlY3RlZCwgbnVsbCwgMiApKTsKbG9nRGVidWcoJ2NsaWVudCBzZWxlY3RlZCAnICsgc2VsZWN0ZWQub3JpZ2luYWxPYmplY3QuYnVzZXJfZmlyc3RfbmFtZSk7CiRzY29wZS5zaG93RXZlbnRDbGllbnRTZWxlY3RlZCA9IHRydWU7CiRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kdXNlcl9pZCA9IHNlbGVjdGVkLm9yaWdpbmFsT2JqZWN0LmJ1c2luZXNzX3VzZXJfaWQ7CiRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kdXNlcl9maXJzdF9uYW1lID0gc2VsZWN0ZWQub3JpZ2luYWxPYmplY3QuYnVzZXJfZmlyc3RfbmFtZTsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmR1c2VyX2xhc3RfbmFtZSA9IHNlbGVjdGVkLm9yaWdpbmFsT2JqZWN0LmJ1c2VyX2xhc3RfbmFtZTsKfSBlbHNlIHsKbG9nRGVidWcoJ25vdCBzZWxlY3RlZCcpOwovLyAkc2NvcGUuZXZlbnRDbGllbnREZVNlbGVjdGVkKCk7Cn0KfTsKJHNjb3BlLmV2ZW50Q2xpZW50RGVTZWxlY3RlZCA9IGZ1bmN0aW9uKCkgewokc2NvcGUuc2hvd0V2ZW50Q2xpZW50U2VsZWN0ZWQgPSBmYWxzZTsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmR1c2VyX2lkID0gbnVsbDsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmR1c2VyX2ZpcnN0X25hbWUgPSBudWxsOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZHVzZXJfbGFzdF9uYW1lID0gbnVsbDsKJHNjb3BlLmNsZWFyQ2xpZW50SW5wdXQoJ2NsaWVudF9hbmd1Y29tcGxldGUnKTsKfQoKJHNjb3BlLmNsZWFyQ2xpZW50SW5wdXQgPSBmdW5jdGlvbihpZCkgewppZiAoaWQpIHsKJHNjb3BlLiRicm9hZGNhc3QoJ2FuZ3Vjb21wbGV0ZS1hbHQ6Y2xlYXJJbnB1dCcsIGlkKTsKfQovLyBlbHNlewovLyAgICRzY29wZS4kYnJvYWRjYXN0KCdhbmd1Y29tcGxldGUtYWx0OmNsZWFySW5wdXQnKTsKLy8gfQp9Cgokc2NvcGUuY2FuY2VsID0gZnVuY3Rpb24oKSB7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKfTsKCiRzY29wZS51cGRhdGVFdmVudE5hbWVDaGVjayA9IGZ1bmN0aW9uKG5ld1ZhbHVlKQp7CmxvZ0RlYnVnKCJ1cGRhdGVFdmVudE5hbWU9IituZXdWYWx1ZSk7CmlmIChuZXdWYWx1ZT09IiIpCnsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5ldmVudF9uYW1lID0gJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5vcmlnaW5hbF9ldmVudF9uYW1lOwp9Cn0KLy8gcmVzY2hlZHVsZUV2ZW50CiRzY29wZS5yZXNjaGVkdWxlRXZlbnQgPSBmdW5jdGlvbigpIHsKbG9nRGVidWcoImZ1bmN0aW9uOiByZXNjaGVkdWxlRXZlbnQiKTsKCi8vIG5ld0V2ZW50SlNPTkRldGFpbHMgPSBKU09OLnN0cmluZ2lmeSgkc2NvcGUubmV3RXZlbnREZXRhaWxzLCBudWxsLCA0KTsgLy8gKE9wdGlvbmFsKSBiZWF1dGlmdWwgaW5kZW50ZWQgb3V0cHV0Lgpsb2dEZWJ1ZygicmVzY2hlZHVsZUV2ZW50LCAiICsgSlNPTi5zdHJpbmdpZnkoJHNjb3BlLm5ld0V2ZW50RGV0YWlscywgbnVsbCwgNCkpOwovLyBpZiAoJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5ldmVudFJlY3VycmluZykgewovLyAgIGNyZWF0ZVJlY3VycmluZ0V2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUubmV3RXZlbnREZXRhaWxzLGNyZWF0ZVJlY3VycmluZ0V2ZW50X3N1Y2Nlc3MpOwovLyAgIGZ1bmN0aW9uIGNyZWF0ZVJlY3VycmluZ0V2ZW50X3N1Y2Nlc3MoKQovLyAgIHsKLy8gICAgIGNhbGVuZGFyID0gImNhbGVuZGFyX2J1c2luZXNzIjsKLy8gICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKLy8gICAgICR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoKTsKLy8gICAgIC8vIGVycm9yIHdhcwovLyAgICAgLy8gbG9nRGVidWcoImVycm9yICIgKyBkYXRhLk1lc3NhZ2UpOwovLyAgICAgLy8gJHNjb3BlLmFqYXhfZXJyb3IgPSBkYXRhLk1lc3NhZ2U7Ci8vICAgfQovLyB9Ci8vIGVsc2UKewovLyBpZiBldmVudCBpcyBub3QgY2xhc3MsIGEgY2xpZW50IG11c3QgYmUgc2VsZWN0ZWQKLy8gaWYgKCghJHNjb3BlLnNob3dFdmVudENsaWVudFNlbGVjdGVkKSAmJiAoISRzY29wZS5uZXdFdmVudERldGFpbHMuaXNfY2xhc3MpKQovLyB7Ci8vICAgLy8gYWxlcnQoJ2NsaWVudCBtdXN0IGJlIHNlbGVjdGVkJyk7Ci8vICAgJHNjb3BlLmFqYXhfZXJyb3I9IteQ16DXkCDXlNeV16HXoyDXntep16rXqtejINec157XpNeS16kiOwovLyAgIHJldHVybjsKLy8gfQpyZXNjaGVkdWxlRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5yZXNjaGVkdWxlX2V2ZW50X2RldGFpbHMuZXZlbnRfaWQsJHNjb3BlLm5ld0V2ZW50RGV0YWlscyxyZXNjaGVkdWxlRXZlbnRfc3VjY2Vzcyk7CmZ1bmN0aW9uIHJlc2NoZWR1bGVFdmVudF9zdWNjZXNzKCkKewpjYWxlbmRhciA9ICJjYWxlbmRhcl9idXNpbmVzcyI7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjYWxlbmRhckV2ZW50UmVzY2hlZHVsZURlc2VsZWN0Jyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCiR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoJ2FkZGVkJyk7Cn0KLy8gb24gZmFpbHVyZSB3YXMKLy8gJHNjb3BlLmFqYXhfZXJyb3IgPSBkYXRhLk1lc3NhZ2U7Cn0KfTsKCiRzY29wZS5jcmVhdGVOZXdFdmVudCA9IGZ1bmN0aW9uKCkgewpsb2dEZWJ1ZygiY3JlYXRlTmV3RXZlbnQgc3RhcnRfdGltZT0iKyB0eXBlb2YgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5zdGFydF90aW1lKTsKCm5ld0V2ZW50SlNPTkRldGFpbHMgPSBKU09OLnN0cmluZ2lmeSgkc2NvcGUubmV3RXZlbnREZXRhaWxzLCBudWxsLCA0KTsgLy8gKE9wdGlvbmFsKSBiZWF1dGlmdWwgaW5kZW50ZWQgb3V0cHV0Lgpsb2dEZWJ1ZygiY3JlYXRlTmV3RXZlbnQsICIgKyBuZXdFdmVudEpTT05EZXRhaWxzKTsKaWYgKCRzY29wZS5uZXdFdmVudERldGFpbHMuZXZlbnRSZWN1cnJpbmcpIHsKY3JlYXRlUmVjdXJyaW5nRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5uZXdFdmVudERldGFpbHMsY3JlYXRlUmVjdXJyaW5nRXZlbnRfc3VjY2Vzcyk7CmZ1bmN0aW9uIGNyZWF0ZVJlY3VycmluZ0V2ZW50X3N1Y2Nlc3MoKQp7CmNhbGVuZGFyID0gImNhbGVuZGFyX2J1c2luZXNzIjsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwokdWliTW9kYWxJbnN0YW5jZS5kaXNtaXNzKCk7Ci8vIGVycm9yIHdhcwovLyBsb2dEZWJ1ZygiZXJyb3IgIiArIGRhdGEuTWVzc2FnZSk7Ci8vICRzY29wZS5hamF4X2Vycm9yID0gZGF0YS5NZXNzYWdlOwp9Cn0KZWxzZQp7Ci8vIGNoZWNraW5nIGV2ZW50IHRpbWUgbG9naWMKaWYgKCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnM+JHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMpCnsKJHNjb3BlLmFqYXhfZXJyb3I9IteW157XnyDXlNeU16rXl9ec15Qg16nXnCDXlNee16TXktepINeQ15fXqNeZINeW157XnyDXlNeh15nXldedINep15zXlSI7CnJldHVybjsKfQovLyBjaGVja2luZyBldmVudCB0aW1lIGxvZ2ljCmlmIChwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKT09cGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMpKQp7CmlmIChwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpPj1wYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzKSkKewokc2NvcGUuYWpheF9lcnJvcj0i15bXntefINeU15TXqteX15zXlCDXqdecINeU157XpNeS16kg15DXl9eo15kg15bXntefINeU16HXmdeV150g16nXnNeVIjsKcmV0dXJuOwp9CmxvZ0RlYnVnKCIkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXM9Iiskc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpOwpsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcz0iKyRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpOwppZiAoKHBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcykrNSk+PXBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpKQp7CiRzY29wZS5hamF4X2Vycm9yPSLXkNeV16jXmiDXlNee16TXktepINeX15nXmdeRINec15TXmdeV16og15zXpNeX15XXqiA1INeT16fXldeqIjsKcmV0dXJuOwp9Cn0KLy8gaWYgZXZlbnQgaXMgbm90IGNsYXNzLCBhIGNsaWVudCBtdXN0IGJlIHNlbGVjdGVkCmlmICgoISRzY29wZS5zaG93RXZlbnRDbGllbnRTZWxlY3RlZCkgJiYgKCEkc2NvcGUubmV3RXZlbnREZXRhaWxzLmlzX2NsYXNzKSAmJiAoJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pc19nZW5lcmljX2V0eXBlPT0wKSkKewovLyBhbGVydCgnY2xpZW50IG11c3QgYmUgc2VsZWN0ZWQnKTsKJHNjb3BlLmFqYXhfZXJyb3I9IteQ16DXkCDXlNeV16HXoyDXntep16rXqtejINec157XpNeS16kiOwpyZXR1cm47Cn0KaWYgKCRzY29wZS5zZWxlY3RFdmVudFR5cGVTZWxlY3RlZC5ldmVudF90eXBlX2lkPT0wKQp7Ci8vIGFsZXJ0KCdjbGllbnQgbXVzdCBiZSBzZWxlY3RlZCcpOwokc2NvcGUuYWpheF9lcnJvcj0i15DXoNeQINeR15fXqCDXodeV15Ig157XpNeS16kgIjsKcmV0dXJuOwp9CmNyZWF0ZUV2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUubmV3RXZlbnREZXRhaWxzLGNyZWF0ZUV2ZW50X3N1Y2Nlc3MpOwpmdW5jdGlvbiBjcmVhdGVFdmVudF9zdWNjZXNzKCkKewpjYWxlbmRhciA9ICJjYWxlbmRhcl9idXNpbmVzcyI7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKJHVpYk1vZGFsSW5zdGFuY2UuZGlzbWlzcygnYWRkZWQnKTsKfQovLyBvbiBmYWlsdXJlIHdhcwovLyAkc2NvcGUuYWpheF9lcnJvciA9IGRhdGEuTWVzc2FnZTsKfQp9Cn0pOwovLy8vIGZmZmZmZmYKa3V6ZUFwcC5jb250cm9sbGVyKCdCdXNpbmVzc0NhbGVuZGFyQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsIHNoYXJlZFByb3BlcnRpZXMsICRjb21waWxlLCAkbG9jYXRpb24sIHVpQ2FsZW5kYXJDb25maWcsICR1aWJNb2RhbCwgc2hhcmVkRGF0YSkgewppbml0aWFsRW5kVXNlciA9IHNoYXJlZERhdGEuZ2V0U2VsZWN0ZWRFbmRVc2VyKCk7CmxvZ0RlYnVnKCdCdXNpbmVzc0NhbGVuZGFyIENvbnRyb2xsZXIsIHNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKT0nICsgc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpKTsKCmdldEJ1c2luZXNzTG9jYXRpb25zKCRodHRwLCRzY29wZSwnYnVzaW5lc3NfbG9jYXRpb25zJyk7CgogICAgJHNjb3BlLnN0YXR1c2VzID0gWyB7InN0YXR1c19pZCI6IjAiLCJzdGF0dXNfbmFtZSI6Itek16rXldeXIn0sIHsic3RhdHVzX2lkIjoiMSIsInN0YXR1c19uYW1lIjoi16HXkteV16gifV07CiAgICAkc2NvcGUudGhlZGF0YV9yZXBvcnQgPSB7fTsKCiAgICAkc2NvcGUudGhlZGF0YV9yZXBvcnQuc291cmNlID0gImNhbGVuZGFyIjsKICAgICRzY29wZS50aGVkYXRhX3JlcG9ydC5maWx0ZXJzID0gewogICAgICBpc19jYW5jZWxlZDogIjAiCiAgICB9OwoKICAgICRzY29wZS51cGRhdGVFdmVudHMgPSBmdW5jdGlvbigpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJ1cGRhdGVFdmVudHMiKTsKICAgICAgaW5zdHJ1Y3Rvcl9pZF9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuY2FsZW5kYXJJbnN0cnVjdG9yRmlsdGVyLCAiYnVzaW5lc3NfdXNlcl9pZCIgKTsKICAgICAgZXZlbnRfdHlwZV9pZF9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuY2FsZW5kYXJFdmVudFR5cGVGaWx0ZXIsICJldmVudF90eXBlX2lkIiApOwogICAgICBzdGF0dXNfZmlsdGVyID0gbGlzdF90b19zdHJpbmdfYnlfdmFsdWUoJHNjb3BlLmNhbGVuZGFyU3RhdHVzRmlsdGVyLCAic3RhdHVzX2lkIiApOwoKICAgICAgJHNjb3BlLnRoZWRhdGFfcmVwb3J0LmZpbHRlcnMgPSB7CiAgICAgICAgaW5zdHJ1Y3Rvcl9pZDogaW5zdHJ1Y3Rvcl9pZF9maWx0ZXIsCiAgICAgICAgZXZlbnRfdHlwZV9pZDogZXZlbnRfdHlwZV9pZF9maWx0ZXIsCiAgICAgICAgc3RhdHVzOiBzdGF0dXNfZmlsdGVyLAogICAgICAgIGlzX2NhbmNlbGVkOiAiMCIKICAgICAgfTsKCiAgICAgIC8vIGNvbnNvbGUubG9nKCRzY29wZS5jYWxlbmRhcik7CiAgICAgIGxvZ0RlYnVnKCJiZWZvcmUgcmVmZXRjaEV2ZW50cyIpOwogICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwogICAgICBsb2dEZWJ1ZygiYWZ0ZXIgcmVmZXRjaEV2ZW50cyIpOwogICAgICAvLyB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwoKICAgIH0KCiRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyPWZhbHNlOwoKaWYgKHNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKSE9bnVsbCkKewpjb25zb2xlLmxvZygiZ290IHByZXZpb3VzIHNlbGVjdGVkIHVzZXIgIitzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfZmlyc3RfbmFtZSk7CiRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VybmFtZT1zaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfZmlyc3RfbmFtZSsiICIrc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2VyX2xhc3RfbmFtZTsKJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJfaWQ9c2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2luZXNzX3VzZXJfaWQ7CmxvZ0RlYnVnKCIkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcl9pZD0iKyRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyX2lkKTsKCiRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyPXRydWU7Cn0KCi8vIGNoZWNraW5nIGlmIGNhbGVuZGFyIHNob3VsZCBzdGFydCB3aXRoIGEgc3BlY2lmaWMgZGF0ZSAoZnJvbSB1cmwgb3IgZnJvbSBwcmV2aW91c2x5IHNlbGVjdGVkIGRhdGUpCmxvZ0RlYnVnKCIkbG9jYXRpb24uc2VhcmNoKCkuc3RhcnQ9IiArICRsb2NhdGlvbi5zZWFyY2goKS5zdGFydCk7CmlmICh0eXBlb2YgJGxvY2F0aW9uLnNlYXJjaCgpLnN0YXJ0ICE9ICd1bmRlZmluZWQnKQp7CmN1cnJEZWZhdWx0RGF0ZSA9ICRsb2NhdGlvbi5zZWFyY2goKS5zdGFydDsKfQplbHNlIGlmIChzaGFyZWRQcm9wZXJ0aWVzLmdldF9jYWxlbmRhcl9kYXRlKCkhPW51bGwpCnsKY29uc29sZS5sb2coImdvdCBwcmV2aW91cyBkYXRlICAiK3NoYXJlZFByb3BlcnRpZXMuZ2V0X2NhbGVuZGFyX2RhdGUoKSk7CmN1cnJEZWZhdWx0RGF0ZSA9IHNoYXJlZFByb3BlcnRpZXMuZ2V0X2NhbGVuZGFyX2RhdGUoKTsKfQplbHNlCnsKY3VyckRlZmF1bHREYXRlID0gbmV3IERhdGUoKTsKfQpnZXRBbGxJbnN0cnVjdG9ycygkaHR0cCwkc2NvcGUsJ2J1c2luZXNzX2luc3RydWN0b3JzJyxnZXRBbGxJbnN0cnVjdG9yc19maW5pc2gpOwogICAgZ2V0QWxsSW5zdHJ1Y3RvcnMoJGh0dHAsJHNjb3BlLCdpbnN0cnVjdG9ycycpOwpmdW5jdGlvbiBnZXRBbGxJbnN0cnVjdG9yc19maW5pc2goKQp7Ci8vIGNvbnNvbGUubG9nKCRzY29wZS5idXNpbmVzc19pbnN0cnVjdG9ycyk7CiRzY29wZS5idXNpbmVzc19pbnN0cnVjdG9ycy51bnNoaWZ0KHsiYnVzZXJfZnVsbF9uYW1lIjoi15vXnCDXlNem15XXldeqIiwgImJ1c2VyX2ZpcnN0X25hbWUiOiLXm9eV15zXnSIsImJ1c2VyX2xhc3RfbmFtZSI6IiIsICJ1c2VyX2lkIjogMCwgImJ1c2luZXNzX3VzZXJfaWQiOiAwfSk7CgovLyBzZXR0aW5nIHNlbGVjdGVkIGdldF9zZWxlY3RlZF9pbnN0cnVjdG9yCiRzY29wZS5wcmV2aW91c19zZWxlY3RlZF9pbnN0cnVjdG9yPWZhbHNlOwppZiAoc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfaW5zdHJ1Y3RvcigpPj0wKQp7Ci8vIGNvbnNvbGUubG9nKCJnb3QgcHJldmlvdXMgc2VsZWN0ZWQgaW5zdHJ1Y3RvciAiK3NoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX2luc3RydWN0b3IoKSk7CiRzY29wZS5wcmV2aW91c19zZWxlY3RlZF9pbnN0cnVjdG9yX2lkPXNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX2luc3RydWN0b3IoKTsKJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX2luc3RydWN0b3I9dHJ1ZTsKJHNjb3BlLnNlbGVjdGVkX2J1c2luZXNzX3VzZXJfaWQ9c2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfaW5zdHJ1Y3RvcigpOwp9Cn0KICAgIGdldEFsbEJ1c2luZXNzRXZlbnRUeXBlcygkaHR0cCwkc2NvcGUsJ2V2ZW50X3R5cGVzX2NhbHMnKTsKZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzTm9TeXN0ZW0oJGh0dHAsJHNjb3BlLCdldmVudF90eXBlcycpOwoKLy8gc2V0dGluZyBzZWxlY3RlZCB1c2VyIGlkCiRzY29wZS5wcmV2aW91c19ldmVudF9yZXNjaGVkdWxlPWZhbHNlOwokc2NvcGUucHJldmlvdXNfZXZlbnRfcmVzY2hlZHVsZV9ldmVudD1udWxsOwoKJHNjb3BlLiRvbigiY2FsZW5kYXJFdmVudFJlc2NoZWR1bGVEZXNlbGVjdCIsZnVuY3Rpb24oZSxhKQp7CiRzY29wZS5jYWxlbmRhckV2ZW50UmVzY2hlZHVsZURlc2VsZWN0KCk7Cn0pOwoKLy8gZGVzZWxlY3RpbmcgZXZlbnQgZnJvbSBiZWluZyByZXNjaGVkdWxlZAokc2NvcGUuY2FsZW5kYXJFdmVudFJlc2NoZWR1bGVEZXNlbGVjdD1mdW5jdGlvbigpCnsKc2hhcmVkUHJvcGVydGllcy5zZXRfZXZlbnRfcmVzY2hlZHVsZShudWxsKTsKJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGU9ZmFsc2U7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZWZldGNoRXZlbnRzJyk7Cn0KLy8gZGVsZXRpbmcgY2xpZW50IHNlbGVjdGlvbiBpbiBjYWxlbmRhcgokc2NvcGUuY2FsZW5kYXJDbGllbnREZXNlbGVjdD1mdW5jdGlvbigpIC8vIHJlbG9hZCBjbGFzcy9ldmVudCBzdWdnZXN0aW9ucwp7CiRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyPWZhbHNlOwpzaGFyZWRQcm9wZXJ0aWVzLnNldF9zZWxlY3RlZF91c2VyKG51bGwpOwokc2NvcGUuZXZlbnRUeXBlU2VsZWN0ZWQoKTsKfQppZiAoaW5pdGlhbEVuZFVzZXIgIT0gbnVsbCkgewokc2NvcGUuYnVzaW5lc3NDYWxlbmRhckluaXRpYWxOYW1lID0gdHJ1ZTsKc2hhcmVkRGF0YS5zZXRTZWxlY3RlZEVuZFVzZXIobnVsbCk7CiRzY29wZS5idXNpbmVzc0NhbGVuZGFySW5pdGlhbHMgPSB7Cm5hbWU6IGluaXRpYWxFbmRVc2VyLmZpcnN0X25hbWUgKyAiICIgKyBpbml0aWFsRW5kVXNlci5sYXN0X25hbWUKfTsKfSBlbHNlIHsKJHNjb3BlLmJ1c2luZXNzQ2FsZW5kYXJJbml0aWFsTmFtZSA9IGZhbHNlOwp9Ci8qIGNvbmZpZyBvYmplY3QgKi8KJHNjb3BlLmNhbGVuZGFyX25hbWUgPSAiY2FsZW5kYXJfYnVzaW5lc3MiOwokc2NvcGUuY2FsZW5kYXIgPSAiY2FsZW5kYXJfYnVzaW5lc3MiOwovKiBldmVudCBzb3VyY2VzIGFycmF5Ki8KCiAgICAvLyB0aGVkYXRhID0geyBzb3VyY2U6ICJjYWxlbmRhciIgfQogICAgLy8gdGhlZGF0YVsnZmlsdGVycyddID0geyBpbnN0cnVjdG9yX2lkOiAiMTk1In07CgogICAgLy8gY29uc29sZS5sb2codGhlZGF0YSk7Cgokc2NvcGUuYnVzaW5lc3NDYWxlbmRhckV2ZW50U291cmNlcyA9IFt7CiAgICAgIC8vIHVybDogJy9hcGkvYWRtaW4vZXZlbnRzL2dldHBvc3QnLAogICAgICB1cmw6ICcvYXBpL2FkbWluL3JlcG9ydHMvZXZlbnRzMicsCiAgICAgIGRhdGE6ICRzY29wZS50aGVkYXRhX3JlcG9ydCAsCnR5cGU6ICdQT1NUJwp9LCB7CnVybDogJy9hcGkvYWRtaW4vY2FsZW5kYXIvbGltaXRhdGlvbnMvYmFja2dyb3VuZC9nZXRwb3N0JywKICAgICAgZGF0YTogJHNjb3BlLnRoZWRhdGFfcmVwb3J0ICwKICAgICAgdHlwZTogJ1BPU1QnICAgIC8vIH0sIHsKLy8gICAgIHVybDogJy9hcGkvYWRtaW4vcmVjdXJyaW5nL2dldHBvc3QnLAovLyAgICAgdHlwZTogJ1BPU1QnCn1dOwoKJHNjb3BlLmdvdG9Ub2RheSA9IGZ1bmN0aW9uKCkgewokc2NvcGUuZ290b0RhdGUobmV3IERhdGUoKSk7CnZpc2libGVEYXRlU3RhcnQgPSBuZXcgRGF0ZSh1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ2V0VmlldycpLnN0YXJ0KTsKZGF0ZVRvR29UbyA9IHZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSArICItIiArICgnMCcgKyAodmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpICsgMSkpLnNsaWNlKC0yKSArICItIiArICgnMCcgKyB2aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSkuc2xpY2UoLTIpOwpzaGFyZWRQcm9wZXJ0aWVzLnNldF9jYWxlbmRhcl9kYXRlKGRhdGVUb0dvVG8pOwokc2NvcGUudmlzaWJsZURhdGVTdGFydD12aXNpYmxlRGF0ZVN0YXJ0OwokbG9jYXRpb24uc2VhcmNoKCdzdGFydCcsZGF0ZVRvR29Ubyk7Cn0KCiRzY29wZS5pbnN0cnVjdG9yU2VsZWN0ZWQ9ZnVuY3Rpb24odGhpc3RoaXMpCnsKdXBkYXRlU3VnZ2VzdGlvbnMoKTsKfQokc2NvcGUuZXZlbnRUeXBlU2VsZWN0ZWQ9ZnVuY3Rpb24odGhpc3RoaXMpCnsKdXBkYXRlU3VnZ2VzdGlvbnMoKTsKfQpmdW5jdGlvbiB1cGRhdGVTdWdnZXN0aW9ucygpCnsKbG9nRGVidWcoImZ1bmN0aW9uOiB1cGRhdGVTdWdnZXN0aW9ucyIpOwpzaGFyZWRQcm9wZXJ0aWVzLnNldF9ldmVudF90eXBlX2Zvcl9zdWdnZXN0aW9ucygkc2NvcGUuc2VsZWN0ZWRfZXZlbnRfdHlwZV9pZCk7CnNoYXJlZFByb3BlcnRpZXMuc2V0X3NlbGVjdGVkX2luc3RydWN0b3IoJHNjb3BlLnNlbGVjdGVkX2J1c2luZXNzX3VzZXJfaWQpOwpmb3IgKGk9MDtpPCRzY29wZS5ldmVudF90eXBlcy5sZW5ndGg7aSsrKQp7Ci8vIGNvbnNvbGUubG9nKCRzY29wZS5ldmVudF90eXBlc1tpXS5ldmVudF90eXBlX2lkKTsKaWYgKCRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkPT0kc2NvcGUuZXZlbnRfdHlwZXNbaV0uZXZlbnRfdHlwZV9pZCkKewovLyBjb25zb2xlLmxvZygiZm91bmQgZXZlbnQgdHlwZSBpZCIpOwppZiAoJHNjb3BlLmV2ZW50X3R5cGVzW2ldLmlzX2NsYXNzKSAvLyBpcyBjbGFzcwp7CmxvZ0RlYnVnKCIkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcj0iKyRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyKTsKaWYgKCRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyKQp7CmNvbnNvbGUubG9nKCJpcyBjbGFzcyBzdWdnZXN0aW9uZCIpOwokaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3RjbGFzcy8iKyRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkKyIvIiskc2NvcGUuc2VsZWN0ZWRfYnVzaW5lc3NfdXNlcl9pZCsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSsiLyIrKCRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkrMSkrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0SG91cnMoKSArICIvIiArICRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKSArICIvIiArICRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyX2lkKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKQp7CiRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkX2lzX2NsYXNzPXRydWU7CiRzY29wZS5ldmVudHNTdWdnZXN0ZWQgPSByZXNwb25zZS5kYXRhOwp9KTsKfQplbHNlCnsKY29uc29sZS5sb2coIm5vdCBpcyBjbGFzcyBzdWdnZXN0aW9uZCIpOwokaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3RjbGFzcy8iKyRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkKyIvIiskc2NvcGUuc2VsZWN0ZWRfYnVzaW5lc3NfdXNlcl9pZCsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSsiLyIrKCRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkrMSkrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0SG91cnMoKSArICIvIiArICRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKSArICIvMCIpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpCnsKJHNjb3BlLnNlbGVjdGVkX2V2ZW50X3R5cGVfaWRfaXNfY2xhc3M9dHJ1ZTsKJHNjb3BlLmV2ZW50c1N1Z2dlc3RlZCA9IHJlc3BvbnNlLmRhdGE7Cn0pOwp9Cn0KZWxzZSAvLyBpcyBub3QgY2xhc3MKewokaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3QvIiskc2NvcGUuc2VsZWN0ZWRfZXZlbnRfdHlwZV9pZCsiLyIrJHNjb3BlLnNlbGVjdGVkX2J1c2luZXNzX3VzZXJfaWQrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCkrIi8iKygkc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpKzEpKyIvIiskc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXREYXRlKCkrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldEhvdXJzKCkgKyAiLyIgKyAkc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXRNaW51dGVzKCkpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpCnsKJHNjb3BlLnNlbGVjdGVkX2V2ZW50X3R5cGVfaWRfaXNfY2xhc3M9ZmFsc2U7CiRzY29wZS5ldmVudHNTdWdnZXN0ZWQgPSByZXNwb25zZS5kYXRhOwp9KTsKfQp9Cn0KfQoKJHNjb3BlLmdvdG9OZXh0ID0gZnVuY3Rpb24oKSB7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZW1vdmVFdmVudHMnKTsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ25leHQnKTsKJHNjb3BlLnVwZGF0ZUNhbGVuZGFyQ2VudGVyVGl0bGUoKTsKLy8gYWRkaW5nIHRoZSBmb2xsb3dpbmcgdG8gbWFrZSB0aGUgdXJsCi8vIHBvaW50IHRvIHRoZSByaWdodCB3ZWVrLCBpZiBnb2luZyB0byBhIGRpZmZlcmVudCBVUkwgYW5kIHRoZW4gZ29pbmcgYmFjawp2aXNpYmxlRGF0ZVN0YXJ0ID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5zdGFydCk7CmRhdGVUb0dvVG8gPSB2aXNpYmxlRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCkgKyAiLSIgKyAoJzAnICsgKHZpc2libGVEYXRlU3RhcnQuZ2V0TW9udGgoKSArIDEpKS5zbGljZSgtMikgKyAiLSIgKyAoJzAnICsgdmlzaWJsZURhdGVTdGFydC5nZXREYXRlKCkpLnNsaWNlKC0yKTsKc2hhcmVkUHJvcGVydGllcy5zZXRfY2FsZW5kYXJfZGF0ZShkYXRlVG9Hb1RvKTsKJHNjb3BlLnZpc2libGVEYXRlU3RhcnQ9dmlzaWJsZURhdGVTdGFydDsKJGxvY2F0aW9uLnNlYXJjaCgnc3RhcnQnLGRhdGVUb0dvVG8pOwp9CiRzY29wZS5nb3RvUHJldiA9IGZ1bmN0aW9uKCkgewp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVtb3ZlRXZlbnRzJyk7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdwcmV2Jyk7CiRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlKCk7Ci8vIGFkZGluZyB0aGUgZm9sbG93aW5nIHRvIG1ha2UgdGhlIHVybAovLyBwb2ludCB0byB0aGUgcmlnaHQgd2VlaywgaWYgZ29pbmcgdG8gYSBkaWZmZXJlbnQgVVJMIGFuZCB0aGVuIGdvaW5nIGJhY2sKdmlzaWJsZURhdGVTdGFydCA9IG5ldyBEYXRlKHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3Jykuc3RhcnQpOwpkYXRlVG9Hb1RvID0gdmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpICsgIi0iICsgKCcwJyArICh2aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkgKyAxKSkuc2xpY2UoLTIpICsgIi0iICsgKCcwJyArIHZpc2libGVEYXRlU3RhcnQuZ2V0RGF0ZSgpKS5zbGljZSgtMik7CnNoYXJlZFByb3BlcnRpZXMuc2V0X2NhbGVuZGFyX2RhdGUoZGF0ZVRvR29Ubyk7CiRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0PXZpc2libGVEYXRlU3RhcnQ7CiRsb2NhdGlvbi5zZWFyY2goJ3N0YXJ0JyxkYXRlVG9Hb1RvKTsKCn0KJHNjb3BlLmdvdG9EYXRlID0gZnVuY3Rpb24obmV3ZGF0ZSkgewp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ290b0RhdGUnLCBuZXdkYXRlKTsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlbW92ZUV2ZW50cycpOwp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwokc2NvcGUudXBkYXRlQ2FsZW5kYXJDZW50ZXJUaXRsZSgpOwp9Cgokc2NvcGUuZWRpdEhvdXJzT2ZXb3JrID0gZnVuY3Rpb24oKSB7Ci8vIHBhcmFtIHNob3VsZCBsb29rIGxpa2UgIjIwMTYtMDctMDEiCnZpc2libGVEYXRlU3RhcnQgPSBuZXcgRGF0ZSh1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ2V0VmlldycpLnN0YXJ0KTsKZGF0ZVRvR29UbyA9IHZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSArICItIiArICgnMCcgKyAodmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpICsgMSkpLnNsaWNlKC0yKSArICItIiArICgnMCcgKyB2aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSkuc2xpY2UoLTIpOwokbG9jYXRpb24ucGF0aCgnL2hvdXJzX29mX3dvcmsnKS5zZWFyY2goewpzdGFydDogZGF0ZVRvR29Ubwp9KTsKfTsKCiRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlID0gZnVuY3Rpb24oKSB7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3Jyk7Cgp2aXNpYmxlRGF0ZVN0YXJ0ID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5zdGFydCk7CnZpc2libGVEYXRlRW5kID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5lbmQpOwoKJHNjb3BlLmNhbGVuZGFyVGl0bGVDZW50ZXIgPSB2aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSArICIgIiArIG1vbnRoTmFtZXNbdmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpXSArCiIg4oCUICIgKyB2aXNpYmxlRGF0ZUVuZC5nZXREYXRlKCkgKyAiICIgKyBtb250aE5hbWVzW3Zpc2libGVEYXRlRW5kLmdldE1vbnRoKCldICsKIiAiICsgdmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpOwp9OwoKJHNjb3BlLnNob3dFdmVudFBvcHVwID0gZnVuY3Rpb24oc2VsZWN0ZWRFdmVudCkgewpzaG93RXZlbnRQb3B1cChzZWxlY3RlZEV2ZW50LCAkdWliTW9kYWwpCn07Cgokc2NvcGUuZXZlbnRDcmVhdGVNb2RhbEZyb21TY2hlZHVsZXIgPSBmdW5jdGlvbihlc3VnZ2VzdCkKewovLyBpZiBjbGFzcyAtIGdvIHRvIGV2ZW50IGNsYXNzCmNvbnNvbGUubG9nKGVzdWdnZXN0KTsKZm9yIChpPTA7aTwkc2NvcGUuZXZlbnRfdHlwZXMubGVuZ3RoO2krKykKewppZiAoZXN1Z2dlc3QuZXZlbnRfdHlwZV9pZD09JHNjb3BlLmV2ZW50X3R5cGVzW2ldLmV2ZW50X3R5cGVfaWQpCnsKaWYgKCRzY29wZS5ldmVudF90eXBlc1tpXS5pc19jbGFzcykKewpjb25zb2xlLmxvZygiaXMgY2xhc3MiKTsKd2luZG93LmxvY2F0aW9uLmhyZWY9Jy8jL2V2ZW50X2NsYXNzLycgKyBlc3VnZ2VzdC5ldmVudF9pZDsKcmV0dXJuOwp9Cn0KfQpsb2dEZWJ1ZyhKU09OLnN0cmluZ2lmeShlc3VnZ2VzdCkpOwpsb2dEZWJ1Zyhlc3VnZ2VzdC5zdGFydF9lcG9jaCk7CnN0YXJ0RGF0ZT1lc3VnZ2VzdC5zdGFydF9lcG9jaCoxMDAwOwoKdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CmFuaW1hdGlvbjogZmFsc2UsCnRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2V2ZW50X2NyZWF0ZS5waHAnLApjb250cm9sbGVyOiAnZXZlbnRDcmVhdGVNb2RhbENvbnRyb2xsZXInLApzaXplOiAnbCcsCnJlc29sdmU6IHsKc3RhcnREYXRlOiBmdW5jdGlvbigpIHsKcmV0dXJuIHN0YXJ0RGF0ZTsKfSwKZXZlbnRfdHlwZV9pZDogZnVuY3Rpb24oKSB7CnJldHVybiAkc2NvcGUuc2VsZWN0ZWRfZXZlbnRfdHlwZV9pZDsKfSwKbG9jYXRpb25faWQ6IGZ1bmN0aW9uKCkgewpyZXR1cm4gZXN1Z2dlc3QubG9jYXRpb25faWQ7Cn0sCmVtcF9pZDogZnVuY3Rpb24oKSB7CnJldHVybiBlc3VnZ2VzdC5lbXBfaWQ7Cn0sCnJlc2NoZWR1bGVfZXZlbnQ6IGZ1bmN0aW9uKCkKewppZiAoJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGUpCnsKcmV0dXJuICRzY29wZS5wcmV2aW91c19ldmVudF9yZXNjaGVkdWxlX2V2ZW50Owp9CmVsc2UKewpyZXR1cm4gbnVsbDsKfQp9Cgp9Cn0pOwoKfQokc2NvcGUuZXZlbnRDcmVhdGVNb2RhbCA9IGZ1bmN0aW9uKHN0YXJ0RGF0ZSwgc2l6ZSkgewogICAgICAgIGxvZ0RlYnVnKCJldmVudENyZWF0ZU1vZGFsIHN0YXJ0RGF0ZT0iK3N0YXJ0RGF0ZSk7Cgp2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKYW5pbWF0aW9uOiBmYWxzZSwKdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfZXZlbnRfY3JlYXRlLnBocCcsCmNvbnRyb2xsZXI6ICdldmVudENyZWF0ZU1vZGFsQ29udHJvbGxlcicsCnNpemU6IHNpemUsCnJlc29sdmU6IHsKc3RhcnREYXRlOiBmdW5jdGlvbigpIHsKcmV0dXJuIHN0YXJ0RGF0ZTsKfSwKZXZlbnRfdHlwZV9pZDogZnVuY3Rpb24oKSB7CnJldHVybiAwOwp9LApsb2NhdGlvbl9pZDogZnVuY3Rpb24oKSB7CnJldHVybiAwOwp9LAplbXBfaWQ6IGZ1bmN0aW9uKCkgewpyZXR1cm4gMDsKfSwKcmVzY2hlZHVsZV9ldmVudDogZnVuY3Rpb24oKQp7CmlmICgkc2NvcGUucHJldmlvdXNfZXZlbnRfcmVzY2hlZHVsZSkKewpyZXR1cm4gJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGVfZXZlbnQ7Cn0KZWxzZQp7CnJldHVybiBudWxsOwp9ICAgICAgICAgICAgICAgIH0KCn0KfSk7Cgptb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHNlbGVjdGVkSXRlbSkgewokc2NvcGUuc2VsZWN0ZWQgPSBzZWxlY3RlZEl0ZW07Cn0sIGZ1bmN0aW9uKCkgewpsb2dEZWJ1ZygnTW9kYWwgZGlzbWlzc2VkIGF0OiAnICsgbmV3IERhdGUoKSk7Cn0pOwp9OwoKLy8vCiRzY29wZS51cGRhdGVFdmVudERhdGFiYXNlID0gZnVuY3Rpb24oc3RhcnRfcGFyYW0sIGVuZF9wYXJhbSwgZXZlbnRfaWQsIHRoZWV2ZW50KQp7Cgpsb2dEZWJ1ZygidXBkYXRlRXZlbnREYXRhYmFzZSBzdGFydD0iICsgc3RhcnRfcGFyYW0gKyAiLCBlbmQ9IiArIGVuZF9wYXJhbSArICIsIGV2ZW50X2lkPSIgKyBldmVudF9pZCk7CnRoZXVybCA9ICcvYXBpL2FkbWluL2V2ZW50cy9zZXQvJyArIGV2ZW50X2lkOwoKJGh0dHAoewptZXRob2Q6ICdQT1NUJywKdXJsOiB0aGV1cmwsCmRhdGE6IHsKc3RhcnRfZGF0ZTogc3RhcnRfcGFyYW0sCmVuZF9kYXRlOiBlbmRfcGFyYW0sCmV2ZW50X2lkOiBldmVudF9pZAp9LApoZWFkZXJzOiB7CidDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbjtjaGFyc2V0PXV0Zi04Jwp9Cn0pLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkgewoKbG9nRGVidWcoZGF0YSk7CmlmIChkYXRhLkVycm9yKSB7CmxvZ0RlYnVnKCJlcnJvciAiICsgZGF0YS5NZXNzYWdlKTsKYWxlcnQoJ2Vycm9yJyk7CmNhbGVuZGFyID0gImNhbGVuZGFyX2J1c2luZXNzIjsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwp9IGVsc2Ugewpsb2dEZWJ1Zygic3VjY2VzcyIpOwpjYWxlbmRhciA9ICJjYWxlbmRhcl9idXNpbmVzcyI7Ci8vIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKLy8gJHVpYk1vZGFsSW5zdGFuY2UuZGlzbWlzcygnYWRkZWQgYW5kIHJlZmV0Y2hFdmVudHMnKTsKfQp9KTsKCn07Ci8vLwoKJHNjb3BlLmNsYXNzRXZlbnRBZGRVc2VyID0gZnVuY3Rpb24oZXN1Z2dlc3QpCnsKY29uc29sZS5sb2coImNsYXNzRXZlbnRBZGRVc2VyIG9yIFJlbW92ZSIpOwppZiAoKGVzdWdnZXN0LmlzX3JlZ2lzdGVyZWQ9PTEpIHwgKChlc3VnZ2VzdC5pc193YWl0aW5nbGlzdD09MSkgJiYgKGVzdWdnZXN0LmlzX2NhbmNlbGVkPT0wKSkpCnsKY29uc29sZS5sb2coIm5lZWQgdG8gdW5yZWdpc3RlciIpOwpyZW1vdmVFbmRVc2VyRnJvbUV2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcl9pZCxlc3VnZ2VzdC5ldmVudF9pZCxyZW1vdmVFbmRVc2VyRnJvbUV2ZW50X2NhbGxiYWNrLCByZW1vdmVFbmRVc2VyRnJvbUV2ZW50X2NhbGxiYWNrKTsKZnVuY3Rpb24gcmVtb3ZlRW5kVXNlckZyb21FdmVudF9jYWxsYmFjaygpCnsKJHNjb3BlLmV2ZW50VHlwZVNlbGVjdGVkKCk7CmNhbGVuZGFyID0gImNhbGVuZGFyX2J1c2luZXNzIjsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwoKfQp9CmVsc2UKewovLyBjb25zb2xlLmxvZyhlc3VnZ2VzdC5ldmVudF9pZCk7Ci8vIGNvbnNvbGUubG9nKCRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyX2lkKTsKLy8gaWYgc2VsZWN0ZWQgdXNlciAtIGFkZGluZyBoaW0vaGVyIHRvIGNsYXNzCmlmICgkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcikKewphZGRFbmRVc2VyVG9FdmVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJfaWQsZXN1Z2dlc3QuZXZlbnRfaWQsYWRkRW5kVXNlclRvRXZlbnRfY2FsbGJhY2ssIGFkZEVuZFVzZXJUb0V2ZW50X2NhbGxiYWNrKTsKZnVuY3Rpb24gYWRkRW5kVXNlclRvRXZlbnRfY2FsbGJhY2soKQp7CmNhbGVuZGFyID0gImNhbGVuZGFyX2J1c2luZXNzIjsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwokc2NvcGUuZXZlbnRUeXBlU2VsZWN0ZWQoKTsKfQp9CmVsc2UgLy8gZWxzZSAtIGdvaW5nIHRvIGNsYXNzIHBhZ2UKewp3aW5kb3cubG9jYXRpb24uaHJlZj0nLyMvZXZlbnRfY2xhc3MvJyArIGVzdWdnZXN0LmV2ZW50X2lkOwp9Cn0KfQokc2NvcGUuY2FsZW5kYXJfYnVzaW5lc3NfY29uZmlnID0gewpjYWxlbmRhcjogewpoZWlnaHQ6ICdhdXRvJywKZWRpdGFibGU6IHRydWUsCi8vIGhlYWRlcjogewovLyAgICAgbGVmdDogJycsCi8vICAgICBjZW50ZXI6ICcnLAovLyAgICAgcmlnaHQ6ICcnCi8vIH0sCi8vIGhlYWRlcjogewovLyAgICAgbGVmdDogJ3RpdGxlJywKLy8gICAgIGNlbnRlcjogJycsCi8vICAgICByaWdodDogJ3RvZGF5IHByZXYsbmV4dCcKLy8gfSwKdGl0bGVGb3JtYXQ6IHsKLy8gd2VlazogICJkIFtNTU1deyAnJiM4MjExOycgZCBNTU19Igp9LAovLyB0aXRsZUZvcm1hdDogewovLyAgICAgbW9udGg6ICdNTU1NIHl5eXknLAovLyAgICAgd2VlazogIk1NTSBkWyB5eXl5XXsgJyYjODIxMjsnWyBNTU1dIGQgeXl5eX0iLAovLyAgICAgZGF5OiAnTU0vZGQnCi8vIH0sCmhlYWRlcjogJycsCi8vIGRlZmF1bHRWaWV3OiAnYWdlbmRhV2VlaycsCi8vIHZpZXdzOiB7Ci8vICAgICBkb250U2hvd0RhdGU6IHsKLy8gICAgICAgICB0eXBlOiAnYWdlbmRhV2VlaycsCi8vICAgICAgICAgZHVyYXRpb246IHsKLy8gICAgICAgICAgICAgZGF5czogNwovLyAgICAgICAgIH0sCi8vICAgICAgICAgdGl0bGU6ICdBcGVydHVyYScsCi8vICAgICAgICAgY29sdW1uRm9ybWF0OiAnZGRkZCcgLy8gRm9ybWF0IHRoZSBkYXkgdG8gb25seSBzaG93IGxpa2UgJ01vbmRheScKLy8gICAgICAgICAgICAgLy8gaGlkZGVuRGF5czogWzAsIDZdIC8vIEhpZGUgU3VuZGF5IGFuZCBTYXR1cmRheT8KLy8gICAgIH0KLy8gfSwKLy8gc2xvdER1cmF0aW9uOiAnMDA6MTU6MDAnLApldmVudERyb3A6IGZ1bmN0aW9uKGV2ZW50LCBkYXlEZWx0YSwgbWludXRlRGVsdGEsIGFsbERheSwgcmV2ZXJ0RnVuYywgdWlDYWxlbmRhckNvbmZpZykgewpsb2dEZWJ1ZygiZXZlbnQgZHJvcCIgKyBldmVudC50aXRsZSArICIoIiArIGV2ZW50LmlkICsgIikgbW92ZWQgIiArIG1pbnV0ZURlbHRhICsgIiBtaW51dGVzIik7CmxvZ0RlYnVnKCJvbGQgc3RhcnQ9IiArIGV2ZW50LnN0YXJ0ICsgIiwgb2xkIGVuZD0iICsgZXZlbnQuZW5kKTsKJHNjb3BlLnVwZGF0ZUV2ZW50RGF0YWJhc2UoZXZlbnQuc3RhcnQsIGV2ZW50LmVuZCwgZXZlbnQuaWQsIGV2ZW50KTsKfSwKZXZlbnRSZXNpemU6IGZ1bmN0aW9uKGV2ZW50LCBkZWx0YSwgcmV2ZXJ0RnVuYykgewpsb2dEZWJ1ZygiZXZlbnQgcmVzaXplIiArIGV2ZW50LnRpdGxlICsgIigiICsgZXZlbnQuaWQgKyAiKSBtb3ZlZCAiKTsKbG9nRGVidWcoIm9sZCBzdGFydD0iICsgZXZlbnQuc3RhcnQgKyAiLCBvbGQgZW5kPSIgKyBldmVudC5lbmQpOwokc2NvcGUudXBkYXRlRXZlbnREYXRhYmFzZShldmVudC5zdGFydCwgZXZlbnQuZW5kLCBldmVudC5pZCwgZXZlbnQpOwp9LApkZWZhdWx0VmlldzogJ2FnZW5kYVdlZWsnLApldmVudFN0YXJ0RWRpdGFibGU6ZmFsc2UsCmV2ZW50RHVyYXRpb25FZGl0YWJsZTpmYWxzZSwKZGVmYXVsdERhdGU6IG1vbWVudChjdXJyRGVmYXVsdERhdGUpLAoKLy8gZGVmYXVsdFZpZXc6ICdkb250U2hvd0RhdGUnLApldmVudENsaWNrOiBmdW5jdGlvbihjYWxFdmVudCwganNFdmVudCwgdmlldykgewpsb2dEZWJ1ZygiY2FsZW5kYXIgZXZlbnQgY2xpY2tlZCAiICsgY2FsRXZlbnQudGl0bGUgKyAiKCIgKyBjYWxFdmVudC5pZCArICIpICIgKyBjYWxFdmVudC5zdGFydCArICIgIiArIGNhbEV2ZW50LmVuZCk7Ci8vIGxvZ0RlYnVnKEpTT04uc3RyaW5naWZ5KGNhbEV2ZW50KSk7Ci8vIGlmIGl0J3MgYSBnZW5lcmljIGV2ZW50ICh2YWNhdGlvbiBldGMpCi8vIHNob3cgcG9wdXAgd2l0aCBvcHRpb24gdG8gZGVsZXRlCmlmIChjYWxFdmVudC5pc19nZW5lcmljX2V0eXBlPT0xKQp7Ci8vICRzY29wZS5zaG93R2VuZXJpY0V2ZW50KGNhbEV2ZW50KTsKJHNjb3BlLnNob3dFdmVudFBvcHVwKGNhbEV2ZW50KTsKCn0KZWxzZQp7CiRzY29wZS5zaG93RXZlbnRQb3B1cChjYWxFdmVudCk7Cn0KLy8gY2hhbmdlIHRoZSBib3JkZXIgY29sb3IganVzdCBmb3IgZnVuCi8vICQodGhpcykuY3NzKCdib3JkZXItY29sb3InLCAncmVkJyk7Cgp9LApkYXlDbGljazogZnVuY3Rpb24oZGF0ZSwganNFdmVudCwgdmlldykgewovLyBsb2dEZWJ1ZygibmV3IGV2ZW50IGNyZWF0aW9uIGNsaWNrZWQgIiArIGNhbEV2ZW50LnRpdGxlICsgIigiICsgY2FsRXZlbnQuaWQgKyAiKSAiICsgY2FsRXZlbnQuc3RhcnQgKyAiICIgKyBjYWxFdmVudC5lbmQpOwovLyAgICAgc3RhcnQgPSBkYXRlOwovLyAgICAgZW5kID0gbW9tZW50KHN0YXJ0KS5hZGQoNDUsICdtaW51dGVzJyk7CmlmICh2aWV3Lm5hbWUgPT09ICJtb250aCIpIHsKY2FsZW5kYXIgPSAiY2FsZW5kYXJfYnVzaW5lc3MiOwp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdjaGFuZ2VWaWV3JywgImFnZW5kYVdlZWsiKTsKfSBlbHNlIHsKJHNjb3BlLmV2ZW50Q3JlYXRlTW9kYWwoZGF0ZSk7Cn0KLy8gY2hhbmdlIHRoZSBib3JkZXIgY29sb3IganVzdCBmb3IgZnVuCi8vICQodGhpcykuY3NzKCdib3JkZXItY29sb3InLCAncmVkJyk7Cgp9LApldmVudFJlbmRlcjogZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpCnsKaWYgKCFldmVudC5ldmVudF9pZD4wKQp7Ci8vIG5vdCBhIHJlYWwgZXZlbnQgLSBwcm9iYWJseSBibG9jayAvIGJhY2tncm91bmQKLy8gaWdub3JpbmcgaXQKcmV0dXJuOwp9Ci8vIGNoYW5naW5nIGxvb2sgYW5kIGZlZWwgb2YgZXZlbiB0aGF0IGlzIHRvIHJlc2NoZWR1bGUKaWYgKHNoYXJlZFByb3BlcnRpZXMuZ2V0X2V2ZW50X3Jlc2NoZWR1bGUoKSE9bnVsbCkKewppZiAoZXZlbnQuZXZlbnRfaWQ9PXNoYXJlZFByb3BlcnRpZXMuZ2V0X2V2ZW50X3Jlc2NoZWR1bGUoKS5ldmVudF9pZCkKewplbGVtZW50LmNzcygnYmFja2dyb3VuZC1jb2xvcicsICcjQTlBOUE5CScpOwplbGVtZW50LmNzcygnYm9yZGVyLWNvbG9yJywgJyNBOUE5QTkJJyk7CnJldHVybjsKfQp9CiAgICAgICAgICAgICAgICBpZiAoZXZlbnQuaXNfZ2VuZXJpY19ldHlwZT09MSkKICAgICAgICAgICAgICAgIHsKCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIGlmIChldmVudC5pc19jbGFzcz09MSkKewovLyBpZiBjbGFzcyBhZGRpbmcgbnVtYmVyIG9mIHBhcnRpY2lwYW50cwppZiAoZXZlbnQubm9fb2Zfd2FpdGluZ191c2Vycz4wKQp7CmVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZChldmVudC5ub19vZl91c2VycysiLyIrZXZlbnQubWF4X3BhcnRpY2lwYW50cysgIiAoIitldmVudC5ub19vZl93YWl0aW5nX3VzZXJzKyIpIisiIC0gIik7Cn0KZWxzZQp7CmVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZChldmVudC5ub19vZl91c2VycysiLyIrZXZlbnQubWF4X3BhcnRpY2lwYW50cysiIC0gIik7Cn0KfQplbHNlCnsKLy8gaWYgbm90IGNsYXNzIC0gd3JpdGluZyB0aGUgZW5kdXNlciBuYW1lCmlmIChldmVudC5kdXJhdGlvbl9ldmVudCE9MCkgLy8gYWxzbyBpZiBub3QgaG91cnMgb2Ygd29yawp7Ci8vIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykuYXBwZW5kKCIgKCIrZXZlbnQuZXZlbnRVc2Vyc1swXS5idXNlcl9maXJzdF9uYW1lKyIgIitldmVudC5ldmVudFVzZXJzWzBdLmJ1c2VyX2xhc3RfbmFtZSsiKSIpOwovLyBjb25zb2xlLmxvZyhldmVudC5ldmVudFVzZXJzKTsKLy8gY29uc29sZS5sb2coZXZlbnQuZXZlbnRVc2Vycy5sZW5ndGgpOwogICAgICAgICAgICAgICAgICAgIC8vIGlmIChldmVudC5ldmVudFVzZXJzLmxlbmd0aD4wKQp7CiAgICAgICAgICAgICAgICAgICAgICAvLyBlbGVtZW50LmZpbmQoJy5mYy10aXRsZScpLnByZXBlbmQoIiIrZXZlbnQuZXZlbnRVc2Vyc1swXS5idXNlcl9maXJzdF9uYW1lKyIgIitldmVudC5ldmVudFVzZXJzWzBdLmJ1c2VyX2xhc3RfbmFtZSsiICgiKTsKICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZCgiIitldmVudC5ldmVudF91c2VyX2NsaWVudHMrIiAoIik7CmVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykuYXBwZW5kKCIpIik7Cn0KfQovLyBsb2dEZWJ1ZygiaGVyZTQiKTsKfQppZiAoZXZlbnQuaXNfcmVwZWF0aW5nID09IDEpIHsKZWxlbWVudC5maW5kKCIuZmMtdGl0bGUiKS5hcHBlbmQoIiZuYnNwOzxpIGNsYXNzPSdmYSBmYS1yZXBlYXQnPjwvaT4mbmJzcDsiKTsKLy8gIGVsZW1lbnQuZmluZCgiLmZjLXRpdGxlIikuYXBwZW5kKCImbmJzcDs8aW1nIHNyYz0nL3B1YmxpYy9pbWFnZXMvcmVjdXJyaW5nLWljb24ucG5nJyB3aWR0aD0nMTBweCcgaGVpZ2h0PScxMHB4Jy8+Iik7Cn0KfSwKbWluVGltZTogJGdDYWxlbmRhckRpc3BsYXlNaW5UaW1lLAptYXhUaW1lOiAkZ0NhbGVuZGFyRGlzcGxheU1heFRpbWUsCnNlbGVjdGFibGU6IGZhbHNlLApzZWxlY3RIZWxwZXI6IGZhbHNlLAp0aW1lem9uZTogZmFsc2UsCmlzUlRMOiB0cnVlLApsYW5nOiAiaGUiLCAvLyBrawphbGxEYXlTbG90OiBmYWxzZSwKbG9hZGluZzogZnVuY3Rpb24oYm9vbCkgewppZiAoYm9vbCkgewogICAgICAgICAgICAgICAgICAgIGxvZ0RlYnVnKCdsb2FkaW5nIGNhbGVuZGFyMSAnICsgJHNjb3BlLmNhbGVuZGFyKTsKLy8gJCgnI2xvYWRpbmcnKS5zaG93KCk7Cn0gZWxzZSB7Ci8vICQoJyNsb2FkaW5nJykuaGlkZSgpOwpsb2dEZWJ1ZygnZmluaXNoZWQgbG9hZGluZyBjYWxlbmRhciB4JyArICRzY29wZS5jYWxlbmRhcik7CiRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlKCk7CmxvZ0RlYnVnKCJhZnRlciBjYWxlbmRhciBsb2FkIHZpc2libGVEYXRlU3RhcnQ9Iit1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ2V0VmlldycpLnN0YXJ0KTsKdmlzaWJsZURhdGVTdGFydCA9IG5ldyBEYXRlKHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3Jykuc3RhcnQpOwpkYXRlVG9Hb1RvID0gdmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpICsgIi0iICsgKCcwJyArICh2aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkgKyAxKSkuc2xpY2UoLTIpICsgIi0iICsgKCcwJyArIHZpc2libGVEYXRlU3RhcnQuZ2V0RGF0ZSgpKS5zbGljZSgtMik7Ci8vIGNvbnNvbGUubG9nKCJkYXRlVG9Hb1RvIitkYXRlVG9Hb1RvKTsKLy8gJGh0dHAuZ2V0KCRnQXBpVVJMUHJlZml4ICsgIi9lbmR1c2VyL2V2ZW50cy9zdWdnZXN0LyIrdmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpKyIvIit0aGlzX3dlZWtfZnVsbF95ZWFyKyIvIit0aGlzX3dlZWtfbW9udGgrIi8iK3RoaXNfd2Vla19kYXlfb2ZfbW9udGgrIi8iKyB0aGlzX3dlZWtfaG91cnMrICIvIiArIHRoaXNfd2Vla19taW51dGVzKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKQokc2NvcGUuZXZlbnRfdHlwZV9pZD0kc2NvcGUuc2VsZWN0ZWRfZXZlbnRfdHlwZV9pZDsKJHNjb3BlLnZpc2libGVEYXRlU3RhcnQ9dmlzaWJsZURhdGVTdGFydDsKLy8xMjEyMTIKLy8gaWYgKCRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkX2lzX2NsYXNzKQovLyB7Ci8vICAgJGh0dHAuZ2V0KCRnQXBpVVJMUHJlZml4ICsgIi9lbmR1c2VyL2V2ZW50cy9zdWdnZXN0Y2xhc3MvIiskc2NvcGUuZXZlbnRfdHlwZV9pZCsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSsiLyIrKCRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkrMSkrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0SG91cnMoKSArICIvIiArICRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKSsgIi8iICsgJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJfaWQpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpCi8vICAgewovLyAgICAgICAvLwkgICAgJHNjb3BlLm15RGF0YSA9IHJlc3BvbnNlLmRhdGE7Ci8vICAgICAgIC8vCQlsb2dEZWJ1ZygiZ3JpZG9wdGlvbnM9Iiskc2NvcGUuZ3JpZE9wdGlvbnMpOwovLyAgICAgICAkc2NvcGUuZXZlbnRzU3VnZ2VzdGVkID0gcmVzcG9uc2UuZGF0YTsKLy8gICAgICAgLy8gJHNjb3BlLmRhdGVUb0dvVG89ZGF0ZVRvR29UbzsKLy8gICB9KTsKLy8gfQovLyBlbHNlCi8vIHsKLy8gICAkaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3QvIiskc2NvcGUuZXZlbnRfdHlwZV9pZCsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSsiLyIrKCRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkrMSkrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0SG91cnMoKSArICIvIiArICRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkKLy8gICB7Ci8vICAgICAgIC8vCSAgICAkc2NvcGUubXlEYXRhID0gcmVzcG9uc2UuZGF0YTsKLy8gICAgICAgLy8JCWxvZ0RlYnVnKCJncmlkb3B0aW9ucz0iKyRzY29wZS5ncmlkT3B0aW9ucyk7Ci8vICAgICAgICRzY29wZS5ldmVudHNTdWdnZXN0ZWQgPSByZXNwb25zZS5kYXRhOwovLyAgICAgICAvLyAkc2NvcGUuZGF0ZVRvR29Ubz1kYXRlVG9Hb1RvOwovLyAgIH0pOwovLyB9CgovLyBhZnRlciBjYWxlbmRhciBpcyBsb2FkZWQgLSBsb2FkaW5nIGV2ZW50IHR5cGVzIGFuZCBzdWdnZXN0aW9uIGZvciBxdWV1ZXMKLy8gd2UgaGFuZGxlIHRoaW5ncyByZWxhdGVkIHRvIHRoZSBldmVudCB0eXBlcyBvbmx5IGFmdGVyIGxvYWRpbmcgdGhlbSAoYW5kIHRoZSBjYWxlbmRhcikKZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzTm9TeXN0ZW0oJGh0dHAsJHNjb3BlLCdldmVudF90eXBlcycsZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzTm9TeXN0ZW1fY2FsbGJhY2spOwoKZnVuY3Rpb24gZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzTm9TeXN0ZW1fY2FsbGJhY2soKQp7ICAgIC8vIGNoZWNraW5nIGlmIGNhbGVuZGFyIHNob3VsZCBzdGFydCB3aXRoIGEgc3BlY2lmaWMgZXZlbnQgdHlwZSBmb3Igc3VnZ2VzdGlvbnMKLy8gbG9nRGVidWcoIlggc2hhcmVkUHJvcGVydGllcy5nZXRfZXZlbnRfdHlwZV9mb3Jfc3VnZ2VzdGlvbnM9IitzaGFyZWRQcm9wZXJ0aWVzLmdldF9ldmVudF90eXBlX2Zvcl9zdWdnZXN0aW9ucygpKTsKaWYgKHNoYXJlZFByb3BlcnRpZXMuZ2V0X2V2ZW50X3R5cGVfZm9yX3N1Z2dlc3Rpb25zKCkhPW51bGwpCnsKJHNjb3BlLnNlbGVjdGVkX2V2ZW50X3R5cGVfaWQ9c2hhcmVkUHJvcGVydGllcy5nZXRfZXZlbnRfdHlwZV9mb3Jfc3VnZ2VzdGlvbnMoKTsKJHNjb3BlLmV2ZW50VHlwZVNlbGVjdGVkKCRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkKTsKfQoKLy8gZmlyc3QgY2hlY2tpbmcgaWYgdGhlcmUncyBhbiBldmVudCB0byByZXNjaGVkdWxlCmlmIChzaGFyZWRQcm9wZXJ0aWVzLmdldF9ldmVudF9yZXNjaGVkdWxlKCkhPW51bGwpCnsKJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGU9dHJ1ZTsKJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGVfZXZlbnQ9c2hhcmVkUHJvcGVydGllcy5nZXRfZXZlbnRfcmVzY2hlZHVsZSgpOwpzaGFyZWRQcm9wZXJ0aWVzLnNldF9ldmVudF9yZXNjaGVkdWxlKG51bGwpOwpsb2dEZWJ1ZygiZ290IGV2ZW50IHRvIHJlc2NoZWR1bGUgIitKU09OLnN0cmluZ2lmeSgkc2NvcGUucHJldmlvdXNfZXZlbnRfcmVzY2hlZHVsZV9ldmVudCkpOwpsb2dEZWJ1ZygicmVzY2hlZHVsZSBldmVudF90eXBlX2lkPSIrJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGVfZXZlbnQuZXZlbnRfdHlwZV9pZCk7CiRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkPSRzY29wZS5wcmV2aW91c19ldmVudF9yZXNjaGVkdWxlX2V2ZW50LmV2ZW50X3R5cGVfaWQ7CiRzY29wZS5ldmVudFR5cGVTZWxlY3RlZCgpOwp9Ci8vIGNoZWNraW5nIHNlbGVjdGVkIHVzZXIgb25seSBpZiB0aGVyZSdzIG5vIHNlbGVjdGVkIGV2ZW50IHRvIG1vdmUKZWxzZSBpZiAoc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpIT1udWxsKQp7CmNvbnNvbGUubG9nKCJnb3QgcHJldmlvdXMgc2VsZWN0ZWQgdXNlciAiK3NoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKS5idXNlcl9maXJzdF9uYW1lKTsKJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJuYW1lPXNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKS5idXNlcl9maXJzdF9uYW1lKyIgIitzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfbGFzdF9uYW1lOwokc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcl9pZD1zaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzaW5lc3NfdXNlcl9pZDsKbG9nRGVidWcoIiRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyX2lkPSIrJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJfaWQpOwoKJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXI9dHJ1ZTsKfQp9Cn0KCn0sCi8vIHNlbGVjdDogZnVuY3Rpb24oc3RhcnQsIGVuZCwgYWxsRGF5KSB7Ci8vICAgICAvLyB2YXIgdGl0bGUgPSBwcm9tcHQoJ0V2ZW50IFRpdGxlOicgKyAoc3RhcnQgKyAzNTI4MDAwMDApIC8gKDYwICogMTAwMCkgKyAiICIgKyBlbmQgKyAiICIgKyBhbGxEYXkpOwovLyAgICAgdGl0bGUgPSAi16nXoteV16og16TXoteZ15zXldeqIjsKLy8gICAgIGlmICh0aXRsZSkgewovLyAgICAgICAgIGxvZ0RlYnVnKCJjcmVhdGluZyBkZXZlbnQgc3RhcnQiKTsKLy8gICAgICAgICBsb2dEZWJ1Zygic3RhcnQ9IiArIHN0YXJ0KTsKLy8gICAgICAgICBjaGVja0RhdGUgPSBuZXcgRGF0ZShzdGFydCk7Ci8vICAgICAgICAgbG9nRGVidWcoImNoZWNrIGRhdGUgPSAiICsgY2hlY2tEYXRlKQovLyAgICAgICAgIGxvZ0RlYnVnKCJlbmQ9IiArIGVuZCk7Ci8vICAgICAgICAgZWNvbG9yID0gIiMiICsgJHNjb3BlLmV2ZW50Q29sb3I7IC8vZ2V0UmFuZG9tQ29sb3IoKTsKLy8KLy8KLy8gICAgICAgICAvLyB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tdLmZ1bGxDYWxlbmRhcigncmVyZW5kZXJFdmVudHMnKTsKLy8KLy8gICAgICAgICBjYWxlbmRhciA9ICRzY29wZS5jYWxlbmRhcl9uYW1lOwovLyAgICAgICAgIHRlbXBfbGltaXRfaWQgPSAkZ0NhbGVuZGFyVGVtcEVudklEMSAtIGdldFJhbmRvbUludCgxMCwgODApOwovLyAgICAgICAgIG5ld0V2ZW50ID0gewovLyAgICAgICAgICAgICBpZDogdGVtcF9saW1pdF9pZCwKLy8gICAgICAgICAgICAgdGl0bGU6IHRpdGxlLAovLyAgICAgICAgICAgICBzdGFydDogc3RhcnQsCi8vICAgICAgICAgICAgIGNvbG9yOiBlY29sb3IsCi8vICAgICAgICAgICAgIGVuZDogZW5kLAovLyAgICAgICAgICAgICBhbGxEYXk6IGZhbHNlLAovLyAgICAgICAgICAgICBjbGFzc05hbWU6IFsnb3BlblNlc2FtZSddCi8vICAgICAgICAgICAgICAgICAvLyBjb2xvcjogcmVzb3VyY2UuZXZlbnRDb2xvcgovLyAgICAgICAgIH07Ci8vICAgICAgICAgY2FsZW5kYXIgPSAkc2NvcGUuY2FsZW5kYXJfbmFtZTsKLy8KLy8gICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZW5kZXJFdmVudCcsIG5ld0V2ZW50LCB0cnVlKTsKLy8gICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCd1bnNlbGVjdCcpOwovLwovLyAgICAgICAgIGxvZ0RlYnVnKCJjcmVhdGluZyBkZXZlbnQgZW5kIik7Ci8vICAgICAgICAgJHNjb3BlLmFkZEV2ZW50VG9EYXRhYmFzZShzdGFydCwgZW5kLCB0aXRsZSwgZWNvbG9yLCB0ZW1wX2xpbWl0X2lkKTsKLy8KLy8gICAgIH0KLy8gfQp9Cn07Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignSG91cnNPZldvcmtDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGNvbXBpbGUsICRsb2NhdGlvbiwgdWlDYWxlbmRhckNvbmZpZywgJHVpYk1vZGFsKSB7CmxvZ0RlYnVnKCdIb3Vyc09mV29yayBDb250cm9sbGVyJyk7Cgpsb2dEZWJ1ZygiJGxvY2F0aW9uLnNlYXJjaCgpLnN0YXJ0PSIgKyAkbG9jYXRpb24uc2VhcmNoKCkuc3RhcnQpOwppZiAodHlwZW9mICRsb2NhdGlvbi5zZWFyY2goKS5zdGFydCA9PSAndW5kZWZpbmVkJykgewpjdXJyRGVmYXVsdERhdGUgPSAkZ0hvdXIwZGF0ZTsKJHNjb3BlLmZpeGVkU2NoZWR1bGUgPSB0cnVlOwokc2NvcGUuY2FsZW5kYXJUaXRsZUNlbnRlciA9ICLXqdei15XXqiDXpNei15nXnNeV16og16fXkdeV16LXldeqIjsKbG9nRGVidWcoItep16LXldeqINek16LXmdec15XXqiDXp9eR15XXoteV16oiKTsKaG91cnNPZldvcmtEZWZhdWx0Vmlldz0nZG9udFNob3dEYXRlJzsKfSBlbHNlIHsKY3VyckRlZmF1bHREYXRlID0gJGxvY2F0aW9uLnNlYXJjaCgpLnN0YXJ0Owokc2NvcGUuZml4ZWRTY2hlZHVsZSA9IGZhbHNlOwovLyAkc2NvcGUuY2FsZW5kYXJUaXRsZUNlbnRlciA9ICLXqdei15XXqiDXpNei15nXnNeV16og16fXkdeV16LXldeqIjsKaG91cnNPZldvcmtEZWZhdWx0Vmlldz0nYWdlbmRhV2Vlayc7Cn0KCgokc2NvcGUudmlzaWJsZURhdGUgPSBbXTsKJHNjb3BlLmNhbGVuZGFyID0gJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnOwokc2NvcGUuc2VsZWN0ZWRFdmVudFR5cGUgPSBbXTsKCmdldEFsbEJ1c2luZXNzRXZlbnRUeXBlcygkaHR0cCwkc2NvcGUsJ2V2ZW50X3R5cGVzJyxnZXRBbGxCdXNpbmVzc0V2ZW50VHlwZXNfY2FsbGJhY2spOwoKZnVuY3Rpb24gZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzX2NhbGxiYWNrKCkKewokc2NvcGUuc2VsZWN0RXZlbnRUeXBlKCRzY29wZS5ldmVudF90eXBlc1swXSk7Cn0KJHNjb3BlLmJhY2tUb0NhbGVuZGFyID0gZnVuY3Rpb24oKSB7CnZpc2libGVEYXRlU3RhcnQgPSBuZXcgRGF0ZSh1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ2V0VmlldycpLnN0YXJ0KTsKZGF0ZVRvR29UbyA9IHZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSArICItIiArICgnMCcgKyAodmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpICsgMSkpLnNsaWNlKC0yKSArICItIiArICgnMCcgKyB2aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSkuc2xpY2UoLTIpOwokbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2NhbGVuZGFyJykuc2VhcmNoKHsKc3RhcnQ6IGRhdGVUb0dvVG8KfSk7Cn0KJHNjb3BlLnNlbGVjdEV2ZW50VHlwZSA9IGZ1bmN0aW9uKGV2ZW50VHlwZSkgewokc2NvcGUuc2VsZWN0ZWRFdmVudFR5cGUgPSBldmVudFR5cGU7CmxvZ0RlYnVnKCJzZWxlY3RlZCBFdmVudCBUeXBlID0gIiArICRzY29wZS5zZWxlY3RlZEV2ZW50VHlwZS5ldmVudF90eXBlX2lkICsgIiwgIiArICRzY29wZS5zZWxlY3RlZEV2ZW50VHlwZS5ldmVudF90eXBlX25hbWUpOwprdXplSXNDYWxlbmRhckRyYWdnYmxlID0gJHNjb3BlLnNlbGVjdGVkRXZlbnRUeXBlLmRpZmZfcmFuZ2U7Cn07Cgokc2NvcGUuY2hhbmdlRXZlbnRDb2xvciA9IGZ1bmN0aW9uKG5ld0NvbG9yKSB7CiRzY29wZS5ldmVudENvbG9yID0gbmV3Q29sb3I7CmFsbGxFdmVudHNBcnJheSA9IHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2NsaWVudEV2ZW50cycpOwpmb3IgKGkgaW4gYWxsbEV2ZW50c0FycmF5KSB7CmFsbGxFdmVudHNBcnJheVtpXS5jb2xvciA9ICIjIiArIG5ld0NvbG9yOwp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCd1cGRhdGVFdmVudCcsIGFsbGxFdmVudHNBcnJheVtpXSk7Cn0KfTsKCiRzY29wZS5ldmVudENsaWNrTW9kdWxlID0gZnVuY3Rpb24oc2VsZWN0ZWRFdmVudCwgc2l6ZSkgewpsb2dEZWJ1Zygic2VsZWN0ZWQgRXZlbnQgdGl0bGU9IiArIHNlbGVjdGVkRXZlbnQudGl0bGUpOwoKCnZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewphbmltYXRpb246IGZhbHNlLAp0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9saW1pdGF0aW9uX2RldGFpbHMuaHRtbCcsCmNvbnRyb2xsZXI6ICdldmVudERldGFpbHNIb3Vyc09mV29ya01vZGFsQ29udHJvbGxlcicsCnNpemU6IHNpemUsCnJlc29sdmU6IHsKc2VsZWN0ZWRFdmVudDogZnVuY3Rpb24oKSB7CnJldHVybiBzZWxlY3RlZEV2ZW50Owp9LApmaXhlZFNjaGVkdWxlOiBmdW5jdGlvbiAoKQp7CnJldHVybiAkc2NvcGUuZml4ZWRTY2hlZHVsZTsKfQp9Cn0pOwoKbW9kYWxJbnN0YW5jZS5yZXN1bHQudGhlbihmdW5jdGlvbihzZWxlY3RlZEl0ZW0pIHsKJHNjb3BlLnNlbGVjdGVkID0gc2VsZWN0ZWRJdGVtOwp9LCBmdW5jdGlvbigpIHsKbG9nRGVidWcoJ01vZGFsIGRpc21pc3NlZCBhdDogJyArIG5ldyBEYXRlKCkpOwp9KTsKfTsKCgp2YXIgZGF0ZSA9IG5ldyBEYXRlKCk7CnZhciBkID0gZGF0ZS5nZXREYXRlKCk7CnZhciBtID0gZGF0ZS5nZXRNb250aCgpOwp2YXIgeSA9IGRhdGUuZ2V0RnVsbFllYXIoKTsKCgpmdW5jdGlvbiBnZXRUaW1lU3RhbXAobm93KSB7CnJldHVybiAoKG5vdy5nZXRNb250aCgpICsgMSkgKyAnLycgKyAobm93LmdldERhdGUoKSkgKyAnLycgKyBub3cuZ2V0RnVsbFllYXIoKSArICIgIiArIG5vdy5nZXRIb3VycygpICsgJzonICsgKChub3cuZ2V0TWludXRlcygpIDwgMTApID8gKCIwIiArIG5vdy5nZXRNaW51dGVzKCkpIDogKG5vdy5nZXRNaW51dGVzKCkpKSArICc6JyArICgobm93LmdldFNlY29uZHMoKSA8IDEwKSA/ICgiMCIgKyBub3cKLmdldFNlY29uZHMoKSkgOiAobm93LmdldFNlY29uZHMoKSkpKTsKfQoKCi8qIENoYW5nZSBWaWV3ICovCiRzY29wZS5jaGFuZ2VWaWV3ID0gZnVuY3Rpb24odmlldywgY2FsZW5kYXIpIHsKbG9nRGVidWcoImNoYW5nZSB2aWV3ICIgKyB2aWV3KTsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignY2hhbmdlVmlldycsIHZpZXcpOwp9OwovKiBDaGFuZ2UgVmlldyAqLwoKJHNjb3BlLnJlbmRlckNhbGVuZGVyID0gZnVuY3Rpb24oY2FsZW5kYXIpIHsKJHRpbWVvdXQoZnVuY3Rpb24oKSB7CmlmICh1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0pIHsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVuZGVyJyk7Cn0KfSk7Cn07Cgokc2NvcGUuY2hhbmdlU2VsZWN0YWJsZSA9IGZ1bmN0aW9uKCkgewprdXplSXNDYWxlbmRhckRyYWdnYmxlID0gIWt1emVJc0NhbGVuZGFyRHJhZ2dibGU7CmNhbGVuZGFyID0gJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnOwovLyB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3JykuY2FsZW5kYXIub3B0aW9ucy5zZWxlY3RhYmxlID0gZmFsc2U7CnZpZXcgPSB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdvcHRpb24nLCAnc2VsZWN0YWJsZScsIGZhbHNlKTsKLy8gdmlldy5jYWxlbmRhci5vcHRpb25zLnNlbGVjdGFibGUgPSBmYWxzZTsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVuZGVyJyk7Cgp9Ci8qIGNvbmZpZyBvYmplY3QgKi8KCiRzY29wZS5jYWxlbmRhcl9ob3Vyc19vZl93b3JrX2NvbmZpZyA9IHsKY2FsZW5kYXI6IHsKaGVpZ2h0OiAnYXV0bycsCmVkaXRhYmxlOiB0cnVlLAovLyBoZWFkZXI6IHsKLy8gICAgIGxlZnQ6ICcnLAovLyAgICAgY2VudGVyOiAnJywKLy8gICAgIHJpZ2h0OiAnJwovLyB9LApoZWFkZXI6ICcnLAovLyBoZWFkZXI6IHsKLy8gICAgIGxlZnQ6ICd0aXRsZScsCi8vICAgICBjZW50ZXI6ICcnLAovLyAgICAgcmlnaHQ6ICd0b2RheSBwcmV2LG5leHQnCi8vIH0sCi8vIGRlZmF1bHRWaWV3OiAnYWdlbmRhV2VlaycsCnZpZXdzOiB7CmRvbnRTaG93RGF0ZTogewp0eXBlOiAnYWdlbmRhV2VlaycsCmR1cmF0aW9uOiB7CmRheXM6IDcKfSwKdGl0bGU6ICdBcGVydHVyYScsCmNvbHVtbkZvcm1hdDogJ2RkZGQnIC8vIEZvcm1hdCB0aGUgZGF5IHRvIG9ubHkgc2hvdyBsaWtlICdNb25kYXknCi8vIGhpZGRlbkRheXM6IFswLCA2XSAvLyBIaWRlIFN1bmRheSBhbmQgU2F0dXJkYXk/Cn0sCmRvU2hvd0RhdGU6IHsKdHlwZTogJ2FnZW5kYVdlZWsnLApkdXJhdGlvbjogewpkYXlzOiA3Cn0sCnRpdGxlOiAnQXBlcnR1cmEnLAoKLy8gaGlkZGVuRGF5czogWzAsIDZdIC8vIEhpZGUgU3VuZGF5IGFuZCBTYXR1cmRheT8KfQp9LApldmVudERyb3A6IGZ1bmN0aW9uKGV2ZW50LCBkYXlEZWx0YSwgbWludXRlRGVsdGEsIGFsbERheSwgcmV2ZXJ0RnVuYywgdWlDYWxlbmRhckNvbmZpZykgewpsb2dEZWJ1ZygiZXZlbnRkcm9wIiArIGV2ZW50LnRpdGxlICsgIigiICsgZXZlbnQuaWQgKyAiKSBtb3ZlZCAiICsgbWludXRlRGVsdGEgKyAiIG1pbnV0ZXMiKTsKbG9nRGVidWcoIm9sZCBzdGFydD0iICsgZXZlbnQuc3RhcnQgKyAiLCBvbGQgZW5kPSIgKyBldmVudC5lbmQpOwokc2NvcGUudXBkYXRlTGltaXRhdGlvbkRhdGFiYXNlKGV2ZW50LnN0YXJ0LCBldmVudC5lbmQsIGV2ZW50LmlkLCBldmVudC50ZW1wX2xpbWl0X2lkLCBldmVudCk7Cn0sCmV2ZW50UmVzaXplOiBmdW5jdGlvbihldmVudCwgZGVsdGEsIHJldmVydEZ1bmMpIHsKbG9nRGVidWcoImV2ZW50cmVzaXplLCBldmVudC5lbmQ9IiArIGV2ZW50LmVuZCk7CiRzY29wZS51cGRhdGVMaW1pdGF0aW9uRGF0YWJhc2UoZXZlbnQuc3RhcnQsIGV2ZW50LmVuZCwgZXZlbnQuaWQsIGV2ZW50LnRlbXBfbGltaXRfaWQsIGV2ZW50KTsKfSwKZGVmYXVsdFZpZXc6IGhvdXJzT2ZXb3JrRGVmYXVsdFZpZXcsCmV2ZW50Q2xpY2s6IGZ1bmN0aW9uKGNhbEV2ZW50LCBqc0V2ZW50LCB2aWV3KSB7CmxvZ0RlYnVnKCJldmVudCBjbGlja2VkICIgKyBjYWxFdmVudC50aXRsZSArICIoaWQ9IiArIGNhbEV2ZW50LmlkICsgIiwgZGF5X2xpbWl0X2lkPSIgKyBjYWxFdmVudC5kYXlfbGltaXRfaWQgKyAiLCB0ZW1wX2xpbWl0X2lkPSIgKyBjYWxFdmVudC50ZW1wX2xpbWl0X2lkICsgIiwgbGltaXRfaWQ9IiArIGNhbEV2ZW50LmxpbWl0X2lkICsgIikgc3RhcnQ9IiArIGNhbEV2ZW50LnN0YXJ0ICsgIiwgZW5kPSIgKyBjYWxFdmVudC5lbmQpOwokc2NvcGUuZXZlbnRDbGlja01vZHVsZShjYWxFdmVudCk7Ci8vIGNoYW5nZSB0aGUgYm9yZGVyIGNvbG9yIGp1c3QgZm9yIGZ1bgovLyAkKHRoaXMpLmNzcygnYm9yZGVyLWNvbG9yJywgJ3JlZCcpOwoKfSwKZXZlbnRSZW5kZXI6IGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KQp7CmNvbnNvbGUubG9nKGV2ZW50KTsKZWxlbWVudC5maW5kKCcuZmMtdGl0bGUnKS5wcmVwZW5kKGV2ZW50LmxvY2F0aW9uX25hbWUrIiAvIDxici8+Iik7CmVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZChldmVudC5pbnN0cnVjdG9yX25hbWUrIiAvIDxici8+Iik7Ci8vIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZCgiIitldmVudC5ldmVudFVzZXJzWzBdLmJ1c2VyX2ZpcnN0X25hbWUrIiAiK2V2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfbGFzdF9uYW1lKyIgKCIpOwoKLy8gY29uc29sZS5sb2coInJlbmRlciBsaW1pdGF0aW9uICIrSlNPTi5zdHJpbmdpZnkoZXZlbnQpKTsKLy8gaWYgKGV2ZW50LmlzX2NsYXNzPT0xKQovLyB7Ci8vICAgLy8gaWYgY2xhc3MgYWRkaW5nIG51bWJlciBvZiBwYXJ0aWNpcGFudHMKLy8gICBpZiAoZXZlbnQubm9fb2Zfd2FpdGluZ191c2Vycz4wKQovLyAgIHsKLy8gICAgIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZChldmVudC5ub19vZl91c2VycysiLyIrZXZlbnQubWF4X3BhcnRpY2lwYW50cysgIiAoIitldmVudC5ub19vZl93YWl0aW5nX3VzZXJzKyIpIisiIC0gIik7Ci8vICAgfQovLyAgIGVsc2UKLy8gICB7Ci8vICAgICBlbGVtZW50LmZpbmQoJy5mYy10aXRsZScpLnByZXBlbmQoZXZlbnQubm9fb2ZfdXNlcnMrIi8iK2V2ZW50Lm1heF9wYXJ0aWNpcGFudHMrIiAtICIpOwovLyAgIH0KLy8gfQovLyBlbHNlCi8vIHsKLy8gICAvLyBpZiBub3QgY2xhc3MgLSB3cml0aW5nIHRoZSBlbmR1c2VyIG5hbWUKLy8gICBpZiAoZXZlbnQuZHVyYXRpb25fZXZlbnQhPTApIC8vIGFsc28gaWYgbm90IGhvdXJzIG9mIHdvcmsKLy8gICB7Ci8vICAgICAvLyBlbGVtZW50LmZpbmQoJy5mYy10aXRsZScpLmFwcGVuZCgiICgiK2V2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfZmlyc3RfbmFtZSsiICIrZXZlbnQuZXZlbnRVc2Vyc1swXS5idXNlcl9sYXN0X25hbWUrIikiKTsKLy8gICAgIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZCgiIitldmVudC5ldmVudFVzZXJzWzBdLmJ1c2VyX2ZpcnN0X25hbWUrIiAiK2V2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfbGFzdF9uYW1lKyIgKCIpOwovLyAgICAgZWxlbWVudC5maW5kKCcuZmMtdGl0bGUnKS5hcHBlbmQoIikiKTsKLy8gICB9Ci8vICAgLy8gbG9nRGVidWcoImhlcmU0Iik7Ci8vIH0KLy8gaWYgKGV2ZW50LmlzX3JlcGVhdGluZyA9PSAxKSB7Ci8vICAgICBlbGVtZW50LmZpbmQoIi5mYy10aXRsZSIpLnByZXBlbmQoIiZuYnNwOzxpIGNsYXNzPSdmYSBmYS1yZXBlYXQnPjwvaT4mbmJzcDsiKTsKLy8gICAgIC8vICBlbGVtZW50LmZpbmQoIi5mYy10aXRsZSIpLmFwcGVuZCgiJm5ic3A7PGltZyBzcmM9Jy9wdWJsaWMvaW1hZ2VzL3JlY3VycmluZy1pY29uLnBuZycgd2lkdGg9JzEwcHgnIGhlaWdodD0nMTBweCcvPiIpOwovLyB9Cn0sCm1pblRpbWU6ICRnQ2FsZW5kYXJEaXNwbGF5TWluVGltZSwKbWF4VGltZTogJGdDYWxlbmRhckRpc3BsYXlNYXhUaW1lLApzZWxlY3RhYmxlOiB0cnVlLApzZWxlY3RIZWxwZXI6IGZhbHNlLAp0aW1lem9uZTogZmFsc2UsCmlzUlRMOiB0cnVlLApsYW5nOiAiaGUiLApzZWxlY3RDb25zdHJhaW50OiB7CnN0YXJ0OiAnMDA6MDEnLAplbmQ6ICcyMzo1OScsCn0sCmRlZmF1bHREYXRlOiBtb21lbnQoY3VyckRlZmF1bHREYXRlKSwKYWxsRGF5U2xvdDogZmFsc2UsCmxvYWRpbmc6IGZ1bmN0aW9uKGJvb2wpIHsKaWYgKGJvb2wpIHsKICAgICAgICAgICAgICAgICAgICBsb2dEZWJ1ZygnbG9hZGluZyBjYWxlbmRhcjIgJyArICRzY29wZS5jYWxlbmRhcik7CgovLyAkKCcjbG9hZGluZycpLnNob3coKTsKfSBlbHNlIHsKLy8gJCgnI2xvYWRpbmcnKS5oaWRlKCk7CmxvZ0RlYnVnKCdmaW5pc2hlZCBsb2FkaW5nIGNhbGVuZGFyICcgKyAkc2NvcGUuY2FsZW5kYXIpOwppZiAoISRzY29wZS5maXhlZFNjaGVkdWxlKSB7CiRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlKCk7Cn0KLy8gJHNjb3BlLmJhY2tUb0ZpeGVkKCk7Cn0KfSwKc2VsZWN0OiBmdW5jdGlvbihzdGFydCwgZW5kLCBhbGxEYXkpIHsKLy8gdGhpcyBpcyBjYWxsZWQgd2hlbiBjcmVhdGluZyBhIG5ldyBibG9jawokc2NvcGUuY3JlYXRlTGltaXRhdGlvbkJsb2NrKHN0YXJ0LCBlbmQpOwp9Cn0KfTsKCi8vIGNyZWF0ZSBsaW1pdGF0aW9uIGJsb2NrCiRzY29wZS5jcmVhdGVMaW1pdGF0aW9uQmxvY2sgPSBmdW5jdGlvbihzdGFydCwgZW5kKQp7CmxvZ0RlYnVnKCJmdW5jdGlvbjogY3JlYXRlTGltaXRhdGlvbkJsb2NrIik7CnZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewphbmltYXRpb246IGZhbHNlLAp0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9saW1pdGF0aW9uX2NyZWF0ZS5waHAnLApzaXplOiAneHMnLApjb250cm9sbGVyOiAnYnVzaW5lc3NfbW9kYWxfbGltaXRhdGlvbl9jcmVhdGUnLApyZXNvbHZlOiB7CnN0YXJ0OiBmdW5jdGlvbigpCnsKcmV0dXJuIHN0YXJ0Owp9LAplbmQ6IGZ1bmN0aW9uKCkKewpyZXR1cm4gZW5kOwp9LApmaXhlZFNjaGVkdWxlOiBmdW5jdGlvbiAoKQp7CnJldHVybiAkc2NvcGUuZml4ZWRTY2hlZHVsZTsKfQp9Cn0pOwp9CiRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlID0gZnVuY3Rpb24oKSB7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3Jyk7Cgp2aXNpYmxlRGF0ZVN0YXJ0ID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5zdGFydCk7CnZpc2libGVEYXRlRW5kID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5lbmQpOwoKJHNjb3BlLmNhbGVuZGFyVGl0bGVDZW50ZXIgPSB2aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSArICIgIiArIG1vbnRoTmFtZXNbdmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpXSArCiIg4oCUICIgKyB2aXNpYmxlRGF0ZUVuZC5nZXREYXRlKCkgKyAiICIgKyBtb250aE5hbWVzW3Zpc2libGVEYXRlRW5kLmdldE1vbnRoKCldICsKIiAiICsgdmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpOwp9OwovKiBldmVudCBzb3VyY2VzIGFycmF5Ki8KJHNjb3BlLmV2ZW50U291cmNlcyA9IFt7CnVybDogJy9hcGkvYWRtaW4vY2FsZW5kYXIvbGltaXRhdGlvbnMvcGVyZGF5L2dldHBvc3QnLAp0eXBlOiAnUE9TVCcKfV07CgovLyAkc2NvcGUuZ2V0RXZlbnRzID0gZnVuY3Rpb24oKSB7Ci8vICAgICBjYWxlbmRhciA9ICdjYWxlbmRhcl9ob3Vyc19vZl93b3JrJzsKLy8gICAgIGFsbGxFdmVudHNBcnJheSA9IHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2NsaWVudEV2ZW50cycpOwovLyAgICAgZm9yIChpIGluIGFsbGxFdmVudHNBcnJheSkgewovLyAgICAgICAgIGxvZ0RlYnVnKGFsbGxFdmVudHNBcnJheVtpXSk7Ci8vICAgICB9Ci8vCi8vIH0KCiRzY29wZS5nb3RvVG9kYXkgPSBmdW5jdGlvbigpIHsKJHNjb3BlLmdvdG9EYXRlKG5ldyBEYXRlKCkpOwp9CiRzY29wZS5nb3RvTmV4dCA9IGZ1bmN0aW9uKCkgewp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignbmV4dCcpOwp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVtb3ZlRXZlbnRzJyk7CiRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlKCk7Cn0KJHNjb3BlLmdvdG9QcmV2ID0gZnVuY3Rpb24oKSB7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZW1vdmVFdmVudHMnKTsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3ByZXYnKTsKJHNjb3BlLnVwZGF0ZUNhbGVuZGFyQ2VudGVyVGl0bGUoKTsKfQokc2NvcGUuZ290b0RhdGUgPSBmdW5jdGlvbihuZXdkYXRlKSB7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnb3RvRGF0ZScsIG5ld2RhdGUpOwp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignY2hhbmdlVmlldycsICdhZ2VuZGFXZWVrJyk7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZW1vdmVFdmVudHMnKTsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKCiRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlKCk7CiRzY29wZS5maXhlZFNjaGVkdWxlID0gZmFsc2U7Cn0KCiRzY29wZS5iYWNrVG9GaXhlZCA9IGZ1bmN0aW9uKCkgewokc2NvcGUuZml4ZWRTY2hlZHVsZSA9IHRydWU7CiRzY29wZS5jYWxlbmRhclRpdGxlQ2VudGVyID0gItep16LXldeqINek16LXmdec15XXqiDXp9eR15XXoteV16oiOwp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignY2hhbmdlVmlldycsICdkb250U2hvd0RhdGUnKTsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dvdG9EYXRlJywgbW9tZW50KCRnSG91cjBkYXRlKSk7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZW1vdmVFdmVudHMnKTsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKCn0KCi8vICRzY29wZS5kZWxldGVBbGxFdmVudHMgPSBmdW5jdGlvbigpIHsKLy8gICAgIGNhbGVuZGFyID0gJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnOwovLyAgICAgYWxsbEV2ZW50c0FycmF5ID0gdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignY2xpZW50RXZlbnRzJyk7Ci8vICAgICBmb3IgKGkgaW4gYWxsbEV2ZW50c0FycmF5KSB7Ci8vICAgICAgICAgbG9nRGVidWcoYWxsbEV2ZW50c0FycmF5W2ldKTsKLy8gICAgICAgICAkc2NvcGUuZGVsZXRlQ2FsZW5kYXJKU0V2ZW50KGNhbGVuZGFyLCBhbGxsRXZlbnRzQXJyYXlbaV0uaWQpOwovLyAgICAgICAgICRzY29wZS5kZWxldGVDYWxlbmRhckRCRXZlbnQoYWxsbEV2ZW50c0FycmF5W2ldLmlkKTsKLy8gICAgIH0KLy8KLy8gfQokc2NvcGUudXBkYXRlTGltaXRhdGlvbkRhdGFiYXNlID0gZnVuY3Rpb24oc3RhcnRfcGFyYW0sIGVuZF9wYXJhbSwgZXZlbnRfaWQsIHRlbXBfbGltaXRfaWQsIHRoZWV2ZW50KSB7Cgpsb2dEZWJ1ZygidXBkYXRlTGltaXRhdGlvbkRhdGFiYXNlIHN0YXJ0PSIgKyBzdGFydF9wYXJhbSArICIsIGVuZD0iICsgZW5kX3BhcmFtICsgIixldmVudF9pZD0iICsgZXZlbnRfaWQpOwoKZnVuY3Rpb24gdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uX2ZhaWx1cmUoKQp7CmNhbGVuZGFyID0gImNhbGVuZGFyX2hvdXJzX29mX3dvcmsiOwp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZWZldGNoRXZlbnRzJyk7Cn0KLy8gaWYgdGhlIGV2ZW50IHRoYXQgaXMgZ2V0dGluZyB1cGRhdGVkIGlzIGFuIGV2ZW50IGZyb20gMTk3MCAobm90IHBlcmRheSkKLy8gdGhlbiB3ZSBhZGQgYSBuZXcgcGVyZGF5IGxpbWl0YXRpb24gd2l0aCBsaW1pdF9pZCBvZiB0aGUgMTk3MCBsaW1pdGF0aW9ucyAtIHdpdGggdGhlIG5ldyB0aW1lcy4KCi8vIG90aGVyd2lzZSB3ZSBqdXN0IHVwZGF0ZSB0aGUgcGVyZGF5IGxpbWl0YXRpb24KCmlmICgkc2NvcGUuZml4ZWRTY2hlZHVsZSkgLy8gZml4ZWQgc2NoZWR1bGUgdnMgc3BlY2lmaWMgd2VlZC9kYXkgbGltaXRhdGlvbgp7CnRoZWRhdGEgPSB7CnN0YXJ0X2RhdGU6IHN0YXJ0X3BhcmFtLAplbmRfZGF0ZTogZW5kX3BhcmFtLAp0ZW1wX2xpbWl0X2lkOiB0ZW1wX2xpbWl0X2lkLApsaW1pdF9pZDogZXZlbnRfaWQKfTsKCnVwZGF0ZUNhbGVuZGFyTGltaXRhdGlvbigkaHR0cCwkc2NvcGUsdGhlZGF0YSxldmVudF9pZCwgbnVsbCwgdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uX2ZhaWx1cmUpOwp9CmVsc2UgLy8gbm90IGZpeGVkIHNjaGVkdWxlIC0gZGFpbHkvd2Vla2x5IGxpbWl0YXRpb25zCnsKaWYgKCh0aGVldmVudC5saW1pdF9pZCAhPSBudWxsKSAmICh0aGVldmVudC5kYXlfbGltaXRfaWQgPT0gLTEpKSAvLyBldmVudCBsaW1pdGF0aW9uIGhhcyBsaW1pdF9pZCBzbyBpdHMgYW4gMTk3MCBldmVudAovLyBuZWVkIHRvIGFkZCBhIG5ldyBwZXJkYXkgbGltaXRhdGlvbiB0aGF0IHBvaW50IChsaW1pdF9pZCkgdG8gdGhlIG9sZCAxOTcwIGV2ZW50IHRvIGNhbmNlbCBpdAp7CnRlbXBfbGltaXRfaWQgPSBjYWxjX3RlbXBfbGltaXRfaWQoKTsKdGhlZXZlbnQudGVtcF9saW1pdF9pZCA9IHRlbXBfbGltaXRfaWQ7CnRoZWV2ZW50LmRheV9saW1pdF9pZCA9IHRlbXBfbGltaXRfaWQ7Ci8vIHRoZSBtb3ZlZCBldmVudCBpbiB0aGUgY2FsZW5kYXIgbm93IGhhcyBkYXlfbGltaXRfaWQgYW5kIHRlbXBfbGltaXRfaWQKLy8gaWYgaXRzIGxvYWRlZCBmcm9tIHRoZSBkYiwgaXQgd2lsbCBvbmx5IGhhdmUgZGF5X2xpbWl0X2lkIChhbmQgbm90IHRoZSB0ZW1wIG9uZSkKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnXS5mdWxsQ2FsZW5kYXIoJ3VwZGF0ZUV2ZW50JywgdGhlZXZlbnQpOwoKdGhlZGF0YSA9IHsKc3RhcnRfZGF0ZTogc3RhcnRfcGFyYW0sCmVuZF9kYXRlOiBlbmRfcGFyYW0sCmNvbG9yOiB0aGVldmVudC5jb2xvciwKdGVtcF9saW1pdF9pZDogdGVtcF9saW1pdF9pZCwKZXZlbnRfdHlwZV9pZDogdGhlZXZlbnQuZXZlbnRfdHlwZV9pZCwKZXZlbnRfdHlwZXM6IHRoZWV2ZW50LmV2ZW50X3R5cGVzLApsb2NhdGlvbl9pZDogdGhlZXZlbnQubG9jYXRpb25faWQsCmVtcF9pZDogdGhlZXZlbnQuZW1wX2lkLApsaW1pdF9pZDogdGhlZXZlbnQuaWQsCnRpdGxlOiB0aGVldmVudC50aXRsZQp9OwpjcmVhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXkoJGh0dHAsJHNjb3BlLHRoZWRhdGEsbnVsbCwgdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uX2ZhaWx1cmUpOwoKfQplbHNlIC8vIGV2ZW50IGxpbWl0YXRpb24gdG8gbW92ZS91cGRhdGUgaGFzIG5vIGxpbWl0X2lkIC0gc28gdGhpcyBpcyBuZXcgcGVyZGF5IGV2ZW50IC0gd2UganVzdCB1cGRhdGUgaXQKewp0aGVkYXRhPSB7CnN0YXJ0X2RhdGU6IHN0YXJ0X3BhcmFtLAplbmRfZGF0ZTogZW5kX3BhcmFtLAp0ZW1wX2RheV9saW1pdF9pZDogdGhlZXZlbnQudGVtcF9saW1pdF9pZCwKbG9jYXRpb25faWQ6IHRoZWV2ZW50LmxvY2F0aW9uX2lkLApkYXlfbGltaXRfaWQ6IHRoZWV2ZW50LmRheV9saW1pdF9pZAp9Owp1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXkoJGh0dHAsJHNjb3BlLHRoZWRhdGEsbnVsbCwgdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uX2ZhaWx1cmUpOwp9Cn0KfTsKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ0V2ZW50Q2xhc3NQYWdlQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHRpbWVvdXQsICRodHRwLCAkcm9vdFNjb3BlLCAkcm91dGVQYXJhbXMsICRsb2NhdGlvbiwgJHJvdXRlLCBzaGFyZWREYXRhLCAkdWliTW9kYWwpCnsKZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkKTsKZ2V0QWxsQ2xpZW50cygkaHR0cCwkc2NvcGUsJ2V2ZW50VHlwZVVzZXJzJyk7CmdldEJ1c2luZXNzTG9jYXRpb25zKCRodHRwLCRzY29wZSwnYnVzaW5lc3NfbG9jYXRpb25zJyk7CmdldEFsbEluc3RydWN0b3JzKCRodHRwLCRzY29wZSwnaW5zdHJ1Y3RvcnMnKTsKCiRzY29wZS51cGRhdGVFdmVudFRpdGxlID0gZnVuY3Rpb24obmV3VmFsdWUsY3VycmVudEV2ZW50KQp7Cm5ld190aXRsZT1uZXdWYWx1ZTsKc2V0RXZlbnRUaXRsZSgkaHR0cCwkc2NvcGUsY3VycmVudEV2ZW50LmV2ZW50X2lkLCBuZXdfdGl0bGUsIHVwZGF0ZUV2ZW50X2NhbGxiYWNrLCB1cGRhdGVFdmVudF9jYWxsYmFjayk7CgpmdW5jdGlvbiB1cGRhdGVFdmVudF9jYWxsYmFjaygpCnsKZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCk7Cn0KCn07Cgokc2NvcGUudXBkYXRlRXZlbnRNYXhQYXJ0aWNpcGFudHMgPSBmdW5jdGlvbihuZXdWYWx1ZSxjdXJyZW50RXZlbnQpCnsKbmV3X21heF9wYXJ0aWNpcGFudHM9bmV3VmFsdWU7CmlmICggbmV3X21heF9wYXJ0aWNpcGFudHMgPCBjdXJyZW50RXZlbnQubm9fb2ZfdXNlcnMgKXsKc2V0RXZlbnRNYXhQYXJ0aWNpcGFudHMoJGh0dHAsJHNjb3BlLGN1cnJlbnRFdmVudC5ldmVudF9pZCwgY3VycmVudEV2ZW50Lm5vX29mX3VzZXJzLCBjdXJyZW50RXZlbnQubm9fb2ZfdXNlcnMsIHVwZGF0ZUV2ZW50X2NhbGxiYWNrLCB1cGRhdGVFdmVudF9jYWxsYmFjayk7Cn0gZWxzZSB7CnNldEV2ZW50TWF4UGFydGljaXBhbnRzKCRodHRwLCRzY29wZSxjdXJyZW50RXZlbnQuZXZlbnRfaWQsIG5ld19tYXhfcGFydGljaXBhbnRzLCBjdXJyZW50RXZlbnQubm9fb2ZfdXNlcnMsIHVwZGF0ZUV2ZW50X2NhbGxiYWNrLCB1cGRhdGVFdmVudF9jYWxsYmFjayk7Cn0KCmZ1bmN0aW9uIHVwZGF0ZUV2ZW50X2NhbGxiYWNrKCkKewpnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkKTsKfQoKfTsKCiRzY29wZS51cGRhdGVVc2VyRXZlbnRQcmljZSA9IGZ1bmN0aW9uKG5ld3ZhbHVlLCB0aGVldmVudCwgZXVzZXIpCnsKbmV3X3ByaWNlPW5ld3ZhbHVlOwpzZXRDbGllbnRFdmVudFByaWNlKCRodHRwLCRzY29wZSxldXNlci5idXNpbmVzc191c2VyX2lkLHRoZWV2ZW50LmV2ZW50X2lkLCBuZXdfcHJpY2Usc2V0Q2xpZW50RXZlbnRQcmljZV9jYWxsYmFjaywgc2V0Q2xpZW50RXZlbnRQcmljZV9jYWxsYmFjayk7CmZ1bmN0aW9uIHNldENsaWVudEV2ZW50UHJpY2VfY2FsbGJhY2soKQp7CmdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQpOwp9Cn07Cgokc2NvcGUudXBkYXRlTG9jYXRpb25FdmVudCA9IGZ1bmN0aW9uKCkKewpjb25zb2xlLmxvZygiZnVuY3Rpb246IHVwZGF0ZUxvY2F0aW9uRXZlbnQiKTsKdXBkYXRlRXZlbnRMb2NhdGlvbigkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLCRzY29wZS5jdXJyZW50RXZlbnQubG9jYXRpb25faWQsdXBkYXRlRXZlbnRMb2NhdGlvbl9jYWxsYmFjaywgdXBkYXRlRXZlbnRMb2NhdGlvbl9jYWxsYmFjayk7CiRzY29wZS51cGRhdGVMb2NhdGlvbkFsZXJ0TWVzc2FnZT0i157XoteT15vXnyDXodeY15jXldehLi4uIjsKZnVuY3Rpb24gdXBkYXRlRXZlbnRMb2NhdGlvbl9jYWxsYmFjaygpCnsKJHNjb3BlLnVwZGF0ZUxvY2F0aW9uQWxlcnRNZXNzYWdlPSLXoteV15PXm9efINeR15TXptec15fXlCEiOwokdGltZW91dChmdW5jdGlvbigpCnsKJHNjb3BlLnVwZGF0ZUxvY2F0aW9uQWxlcnRNZXNzYWdlPW51bGw7Cn0sIDE1MDApOwp9Cn07Cgokc2NvcGUudXBkYXRlSW5zdHJ1Y3RvckNsYXNzRXZlbnQgPSBmdW5jdGlvbigpCnsKY29uc29sZS5sb2coImZ1bmN0aW9uOiB1cGRhdGVJbnN0cnVjdG9yQ2xhc3NFdmVudCIpOwp1cGRhdGVFdmVudEluc3RydWN0b3IoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCwkc2NvcGUuY3VycmVudEV2ZW50Lmluc3RydWN0b3JfaWQsdXBkYXRlRXZlbnRJbnN0cnVjdG9yX2NhbGxiYWNrLCB1cGRhdGVFdmVudEluc3RydWN0b3JfY2FsbGJhY2spOwokc2NvcGUudXBkYXRlSW5zdHJ1Y3RvckFsZXJ0TWVzc2FnZT0i157XoteT15vXnyDXodeY15jXldehLi4uIjsKZnVuY3Rpb24gdXBkYXRlRXZlbnRJbnN0cnVjdG9yX2NhbGxiYWNrKCkKewokc2NvcGUudXBkYXRlSW5zdHJ1Y3RvckFsZXJ0TWVzc2FnZT0i16LXldeT15vXnyDXkdeU16bXnNeX15QhIjsKJHRpbWVvdXQoZnVuY3Rpb24oKQp7CiRzY29wZS51cGRhdGVJbnN0cnVjdG9yQWxlcnRNZXNzYWdlPW51bGw7Cn0sIDE1MDApOwp9Cn0KCgokc2NvcGUuYWN0aXZhdGVFdmVudENsYXNzID0gZnVuY3Rpb24oKQp7CnsKbG9nRGVidWcoInJlb3BlbkV2ZW50Iik7CnJlb3BlbkV2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkLCRzY29wZS5zZWxlY3RlZEV2ZW50LGFmdGVyUmVvcGVuRXZlbnQsYWZ0ZXJSZW9wZW5FdmVudCk7CmZ1bmN0aW9uIGFmdGVyUmVvcGVuRXZlbnQoKQp7CmdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQpOwp9Owp9Cn0KCi8vIGNsb3NlIGV2ZW50IGNsYXNzCiRzY29wZS5jbG9zZUV2ZW50Q2xhc3MgPSBmdW5jdGlvbigpIHsKICAgICAgbG9nRGVidWcoImNsb3NlRXZlbnRDbGFzcyIpOwoKdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CmFuaW1hdGlvbjogZmFsc2UsCnRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2V2ZW50X2NsYXNzX2Nsb3NlLnBocCcsCnNpemU6ICd4cycsCmNvbnRyb2xsZXI6ICdjbGFzc0Nsb3NlTW9kYWxDb250cm9sbGVyJywKcmVzb2x2ZTogewpldmVudF9pZDogZnVuY3Rpb24oKSB7CnJldHVybiAkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkOwp9Cn0KfSk7Cn07CgovLyBkZWxldGUgcmVwZWF0aW5nL2NsYXNzIGV2ZW50CiRzY29wZS5kZWxldGVDbGFzc0V2ZW50ID0gZnVuY3Rpb24oKQp7CmlmICgkc2NvcGUuY3VycmVudEV2ZW50LmlzX3JlcGVhdGluZz09MCkKewpsb2dEZWJ1ZygiY2xhc3MgZXZlbnQgbm90IHJlcGVhdGluZyIpOwokc2NvcGUuZGVsZXRlQ2xhc3NFdmVudFNpbmdsZSgpOwp9CmVsc2UKewpsb2dEZWJ1ZygiY2xhc3MgZXZlbnQgaXMgcmVwZWF0aW5nIik7CnZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewphbmltYXRpb246IGZhbHNlLAp0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9yZXBlYXRpbmdfZXZlbnRfZGVsZXRlX2FsbC5waHAnLApzaXplOiAneHMnLApjb250cm9sbGVyOiAnY2xhc3NEZWxldGVBbGxNb2RhbENvbnRyb2xsZXInLApyZXNvbHZlOiB7CmN1cnJlbnRFdmVudDogZnVuY3Rpb24oKSB7CnJldHVybiAkc2NvcGUuY3VycmVudEV2ZW50Owp9Cn0KfSk7Cn0KfTsKCiRzY29wZS5kZWxldGVDbGFzc0V2ZW50U2luZ2xlPWZ1bmN0aW9uICgpIC8vIGRlbGV0ZSBvbmx5IG9uZS9jdXJyZW50IGNsYXNzIGV2ZWh0CnsKY2FuY2VsQ2xhc3NFdmVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCxjYW5jZWxDbGFzc0V2ZW50X2NhbGxiYWNrLCBjYW5jZWxDbGFzc0V2ZW50X2NhbGxiYWNrKTsKZnVuY3Rpb24gY2FuY2VsQ2xhc3NFdmVudF9jYWxsYmFjaygpCnsKZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCk7Cn0KfQoKJHNjb3BlLiRvbigicmVsb2FkRXZlbnQiLGZ1bmN0aW9uKGUsYSl7Ci8vIFBvc3QgeW91ciBjb2RlCmxvZ0RlYnVnKCJicm9hZGNhc3RlZCAtIHJlbG9hZGluZyBldmVudCAiK2EuZXZlbnRfaWQpOwpnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkcm91dGVQYXJhbXMuZXZlbnRfaWQpOwp9KTsKCi8vIHJlbW92ZSBlbmQgdXNlciBmcm9tIGV2ZW50CiRzY29wZS5ldmVudFJlbW92ZUVuZFVzZXIgPSBmdW5jdGlvbihlbmR1c2VyX2lkKQp7CmNvbnNvbGUubG9nKCJldmVudFJlbW92ZUVuZFVzZXIiKTsKcmVtb3ZlRW5kVXNlckZyb21FdmVudCgkaHR0cCwkc2NvcGUsZW5kdXNlcl9pZCwkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkLHJlbW92ZUVuZFVzZXJGcm9tRXZlbnRfZmluaXNoLCByZW1vdmVFbmRVc2VyRnJvbUV2ZW50X2ZpbmlzaCk7CmZ1bmN0aW9uIHJlbW92ZUVuZFVzZXJGcm9tRXZlbnRfZmluaXNoKCkKewpnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkcm91dGVQYXJhbXMuZXZlbnRfaWQpOwp9Cn07Cgokc2NvcGUuZXZlbnRDbGllbnRTZWxlY3RlZCA9IGZ1bmN0aW9uKHNlbGVjdGVkKSB7CmlmIChzZWxlY3RlZCkgewovLyBhbGVydChKU09OLnN0cmluZ2lmeSggc2VsZWN0ZWQsIG51bGwsIDIgKSk7CmxvZ0RlYnVnKCdldmVudENsaWVudFNlbGVjdGVkMiB5ZXMgc2VsZWN0ZWQgJyArIHNlbGVjdGVkLm9yaWdpbmFsT2JqZWN0LmZpcnN0X25hbWUpOwokc2NvcGUuZXZlbnRBZGRFbmRVc2VyKHNlbGVjdGVkLm9yaWdpbmFsT2JqZWN0LmJ1c2luZXNzX3VzZXJfaWQpOwokcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2FuZ3Vjb21wbGV0ZS1hbHQ6Y2xlYXJJbnB1dCcsICdjbGllbnRfYW5ndWNvbXBsZXRlJyk7Cgp9IGVsc2Ugewpsb2dEZWJ1Zygnbm90IHNlbGVjdGVkJyk7Cn0KfTsKCiRzY29wZS5ldmVudEFkZEVuZFVzZXIgPSBmdW5jdGlvbihlbmR1c2VyX2lkKQp7CmFkZEVuZFVzZXJUb0V2ZW50KCRodHRwLCRzY29wZSxlbmR1c2VyX2lkLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQsYWRkRW5kVXNlclRvRXZlbnRfZmluaXNoLCBhZGRFbmRVc2VyVG9FdmVudF9maW5pc2gpOwpmdW5jdGlvbiBhZGRFbmRVc2VyVG9FdmVudF9maW5pc2goKQp7CmdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCk7Cn0KfTsKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ0V2ZW50UGFnZUNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICR0aW1lb3V0LCAkaHR0cCwgJHVpYk1vZGFsICxzaGFyZWRQcm9wZXJ0aWVzLCAkcm91dGVQYXJhbXMsICRyb290U2NvcGUsICRsb2NhdGlvbiwgJHJvdXRlLCBzaGFyZWREYXRhKQp7CmxvZ0RlYnVnKCJFdmVudFBhZ2VDb250cm9sbGVyIik7CgpnZXRBbGxJbnN0cnVjdG9yc0luY0luYWN0aXZlKCRodHRwLCRzY29wZSwnaW5zdHJ1Y3RvcnMnLGdldEFsbEluc3RydWN0b3JzSW5jSW5hY3RpdmVfc3VjY2Vzcyk7CmdldEJ1c2luZXNzTG9jYXRpb25zKCRodHRwLCRzY29wZSwnYnVzaW5lc3NfbG9jYXRpb25zJyk7CgpmdW5jdGlvbiBnZXRBbGxJbnN0cnVjdG9yc0luY0luYWN0aXZlX3N1Y2Nlc3MoKQp7CmdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCxzZXRQYXJ0aWNpcGF0ZWQpOwp9CgogIHZhciBpbml0aWFsaXppbmcgPSB0cnVlIDsKCiAgJHNjb3BlLiR3YXRjaCgiY3VycmVudEV2ZW50IiwgZnVuY3Rpb24obmV3VmFsdWUsIG9sZFZhbHVlKSB7CiAgICBpZiAoaW5pdGlhbGl6aW5nKSB7CiAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkgeyBpbml0aWFsaXppbmcgPSBmYWxzZTsgfSk7CiAgICB9IGVsc2UgewogICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgdmFyIHRpbWVvdXRJZDsKICAgICAgJCgnI2RvY3MgOmlucHV0LCB0ZXh0YXJlYScpLm9uKCdpbnB1dCBwcm9wZXJ0eWNoYW5nZSBjaGFuZ2UnLCBmdW5jdGlvbigpIHsKICAgICAgLy8gIGNvbnNvbGUubG9nKCdUZXh0YXJlYSBDaGFuZ2UnKTsKICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0SWQpOwogICAgICAgLy8gUnVucyBYIHNlY29uZCAoWCoxMDAwIG1zKSBhZnRlciB0aGUgbGFzdCBjaGFuZ2UKICAgICAgIHRpbWVvdXRJZCA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgJHNjb3BlLnVwZGF0ZUV2ZW50RXh0cmFGaWVsZHMoKQogICAgICAgfSwgNzAwKTsKICAgICAgIH0pOwogICAgfSwgMTAwMCk7CiAgICB9CiAgfSk7Cgokc2NvcGUuZXh0cmFGaWVsZHNBbGVydE1lc3NhZ2U9bnVsbDsKCiRzY29wZS51cGRhdGVFdmVudFRpdGxlID0gZnVuY3Rpb24obmV3VmFsdWUsY3VycmVudEV2ZW50KQp7Cm5ld190aXRsZT1uZXdWYWx1ZTsKc2V0RXZlbnRUaXRsZSgkaHR0cCwkc2NvcGUsY3VycmVudEV2ZW50LmV2ZW50X2lkLCBuZXdfdGl0bGUsIHVwZGF0ZUV2ZW50X2NhbGxiYWNrLCB1cGRhdGVFdmVudF9jYWxsYmFjayk7CgpmdW5jdGlvbiB1cGRhdGVFdmVudF9jYWxsYmFjaygpCnsKZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCk7Cn0KCn07CgoKJHNjb3BlLnVwZGF0ZUV2ZW50RXh0cmFGaWVsZHMgPSBmdW5jdGlvbigpCnsKICAgIGxvZ0RlYnVnKCJzYXZlIHVwZGF0ZUV2ZW50RXh0cmFGaWVsZHMiKTsKdGhlZGF0YSA9IHsKZXh0cmFGaWVsZHM6JHNjb3BlLmN1cnJlbnRFdmVudC5leHRyYUZpZWxkcwp9OwogICAgJHNjb3BlLmV4dHJhRmllbGRzQWxlcnRNZXNzYWdlPSLXqdeV157XqC4uLiI7CnVwZGF0ZUV2ZW50RXh0cmFGaWVsZHMoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCx0aGVkYXRhLHVwZGF0ZUV2ZW50RXh0cmFGaWVsZHNfY2FsbGJhY2ssIHVwZGF0ZUV2ZW50RXh0cmFGaWVsZHNfY2FsbGJhY2spOwoKZnVuY3Rpb24gdXBkYXRlRXZlbnRFeHRyYUZpZWxkc19jYWxsYmFjaygpCnsKICAgICAgLy8gZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLHNldFBhcnRpY2lwYXRlZCk7CgogICAgICAkc2NvcGUuZXh0cmFGaWVsZHNBbGVydE1lc3NhZ2U9Iteg16nXnteoISI7CiR0aW1lb3V0KGZ1bmN0aW9uKCkKewokc2NvcGUuZXh0cmFGaWVsZHNBbGVydE1lc3NhZ2U9bnVsbDsKICAgICAgfSwgMjMwMCk7Cn0KfTsKCiRzY29wZS5yZXNjaGVkdWxlRXZlbnQgPSBmdW5jdGlvbigpCnsKbG9nRGVidWcoInNlZXRpbmcgZXZlbnQgdG8gbW92ZSAgIiskc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0pOwpzaGFyZWRQcm9wZXJ0aWVzLnNldF9ldmVudF9yZXNjaGVkdWxlKCRzY29wZS5jdXJyZW50RXZlbnQpOwogICAgc2hhcmVkUHJvcGVydGllcy5zZXRfc2VsZWN0ZWRfdXNlcihudWxsKTsKCi8vIHVzZXJfaW5mbz0gewovLyAgICAgdXNlcl9pZDogJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudFVzZXJzWzBdLnVzZXJfaWQsCi8vICAgICBidXNlcl9maXJzdF9uYW1lOiAkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfZmlyc3RfbmFtZSwKLy8gICAgIGJ1c2VyX2xhc3RfbmFtZTogJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudFVzZXJzWzBdLmJ1c2VyX2xhc3RfbmFtZQovLyB9OwovLyBzaGFyZWRQcm9wZXJ0aWVzLnNldF9zZWxlY3RlZF91c2VyKHVzZXJfaW5mbyk7CiRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfY2FsZW5kYXInKTsKfQoKJHNjb3BlLnVwZGF0ZUxvY2F0aW9uRXZlbnQgPSBmdW5jdGlvbigpCnsKY29uc29sZS5sb2coImZ1bmN0aW9uOiB1cGRhdGVMb2NhdGlvbkV2ZW50Iik7CnVwZGF0ZUV2ZW50TG9jYXRpb24oJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCwkc2NvcGUuY3VycmVudEV2ZW50LmxvY2F0aW9uX2lkLHVwZGF0ZUV2ZW50TG9jYXRpb25fY2FsbGJhY2ssIHVwZGF0ZUV2ZW50TG9jYXRpb25fY2FsbGJhY2spOwokc2NvcGUudXBkYXRlTG9jYXRpb25BbGVydE1lc3NhZ2U9Itee16LXk9eb158g16HXmNeY15XXoS4uLiI7CmZ1bmN0aW9uIHVwZGF0ZUV2ZW50TG9jYXRpb25fY2FsbGJhY2soKQp7CiRzY29wZS51cGRhdGVMb2NhdGlvbkFsZXJ0TWVzc2FnZT0i16LXldeT15vXnyDXkdeU16bXnNeX15QhIjsKJHRpbWVvdXQoZnVuY3Rpb24oKQp7CiRzY29wZS51cGRhdGVMb2NhdGlvbkFsZXJ0TWVzc2FnZT1udWxsOwp9LCAxNTAwKTsKfQp9OwoKJHNjb3BlLnVwZGF0ZUluc3RydWN0b3JFdmVudCA9IGZ1bmN0aW9uKCkKewpjb25zb2xlLmxvZygiZnVuY3Rpb246IHVwZGF0ZUluc3RydWN0b3JFdmVudCIpOwp1cGRhdGVFdmVudEluc3RydWN0b3IoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCwkc2NvcGUuY3VycmVudEV2ZW50Lmluc3RydWN0b3JfaWQsdXBkYXRlRXZlbnRJbnN0cnVjdG9yX2NhbGxiYWNrLCB1cGRhdGVFdmVudEluc3RydWN0b3JfY2FsbGJhY2spOwokc2NvcGUudXBkYXRlSW5zdHJ1Y3RvckFsZXJ0TWVzc2FnZT0i157XoteT15vXnyDXodeY15jXldehLi4uIjsKZnVuY3Rpb24gdXBkYXRlRXZlbnRJbnN0cnVjdG9yX2NhbGxiYWNrKCkKewokc2NvcGUudXBkYXRlSW5zdHJ1Y3RvckFsZXJ0TWVzc2FnZT0i16LXldeT15vXnyDXkdeU16bXnNeX15QhIjsKJHRpbWVvdXQoZnVuY3Rpb24oKQp7CiRzY29wZS51cGRhdGVJbnN0cnVjdG9yQWxlcnRNZXNzYWdlPW51bGw7Cn0sIDE1MDApOwp9Cn07Cgokc2NvcGUuaW5pdGlhdGVQYXltZW50ID0gZnVuY3Rpb24oaXNwbHVzKQp7CnZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewphbmltYXRpb246IGZhbHNlLAp0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9jbGllbnRfcGF5bWVudC5waHAnLApjb250cm9sbGVyOiAnYnVzaW5lc3NDbGllbmRDYXJkUGF5bWVudCcsCi8vIHNpemU6IHNpemUsCnJlc29sdmU6IHsKY3VycmVudENsaWVudDogZnVuY3Rpb24oKSB7CnJldHVybiAkc2NvcGUuY3VycmVudEV2ZW50Q2xpZW50c1swXTsKfSwKaXNwbHVzOiBmdW5jdGlvbigpIHsKcmV0dXJuIGlzcGx1czsKfQp9Cn0pOwp9Cgokc2NvcGUuZGVsZXRlRXZlbnQ9ZnVuY3Rpb24gKCkKewovLyBjaGVja2luZyBpZiBjYW5jZWxpbmcgYSBnZW5lcmNfdHlwZSBldmVudCAtIHRoZW4gdGhlcmUncyBubyB1c2VyCmlmICgkc2NvcGUuY3VycmVudEV2ZW50LmlzX2dlbmVyaWNfZXR5cGU9PTEpCnsKY2FuY2VsU2luZ2xlRXZlbnQoJGh0dHAsJHNjb3BlLDAsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLGNhbmNlbFNpbmdsZUV2ZW50X2NhbGxiYWNrLCBjYW5jZWxTaW5nbGVFdmVudF9jYWxsYmFjayk7Cn0KZWxzZQp7CmNhbmNlbFNpbmdsZUV2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50VXNlcnNbMF0uYnVzaW5lc3NfdXNlcl9pZCwkcm91dGVQYXJhbXMuZXZlbnRfaWQsY2FuY2VsU2luZ2xlRXZlbnRfY2FsbGJhY2ssIGNhbmNlbFNpbmdsZUV2ZW50X2NhbGxiYWNrKTsKfQpmdW5jdGlvbiBjYW5jZWxTaW5nbGVFdmVudF9jYWxsYmFjaygpCnsKZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLHNldFBhcnRpY2lwYXRlZCk7Cn0KfQoKJHNjb3BlLnNldFBhcnRpY2lwYXRpb25TdGF0dXMgPSBmdW5jdGlvbigpCnsKc2V0RXZlbnRVc2VyUGFydGljaXBhdGlvblN0YXR1cygkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRVc2Vyc1swXS5idXNpbmVzc191c2VyX2lkLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRVc2Vyc1swXS5ldmVudF91c2VyX3N0YXR1c19pZCxzZXRQYXJ0aWNpcGF0aW9uU3RhdHVzX2NhbGxiYWNrLCBzZXRQYXJ0aWNpcGF0aW9uU3RhdHVzX2NhbGxiYWNrKTsKJHNjb3BlLnVwZGF0ZVN0YXR1c0FsZXJ0TWVzc2FnZT0i157XoteT15vXnyDXodeY15jXldehLi4uIjsKZnVuY3Rpb24gc2V0UGFydGljaXBhdGlvblN0YXR1c19jYWxsYmFjaygpCnsKLy8gZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLHNldFBhcnRpY2lwYXRlZCk7CnNldFBhcnRpY2lwYXRlZCgpOwokc2NvcGUudXBkYXRlU3RhdHVzQWxlcnRNZXNzYWdlPSLXoteV15PXm9efINeR15TXptec15fXlCEiOwokdGltZW91dChmdW5jdGlvbigpCnsKJHNjb3BlLnVwZGF0ZVN0YXR1c0FsZXJ0TWVzc2FnZT1udWxsOwp9LCAyNTAwKTsKfQp9CgpmdW5jdGlvbiBzZXRQYXJ0aWNpcGF0ZWQoKQp7CmxvZ0RlYnVnKCJnZXQgY2xpZW50IGluZm8iKTsKZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Q2xpZW50cycsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudFVzZXJzWzBdLmJ1c2luZXNzX3VzZXJfaWQpOwpsb2dEZWJ1Zygic2V0dGluZyBzZXRQYXJ0aWNpcGF0ZWQiKTsKaWYgKCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRVc2Vyc1swXS5zdGF0dXNfbmFtZSE9JGdVc2VyX3N0YXR1c19hYnNlbnRlZCkKewokc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50VXNlcnNbMF0ucGFydGljaXBhdGVkPXRydWU7Cn0KZWxzZQp7CiRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRVc2Vyc1swXS5wYXJ0aWNpcGF0ZWQ9ZmFsc2U7Cn0KCi8vIHRoaXMgbG9vcCBpcyBmb3IgZml4aW5nIHRoZSBkYXRlIGZvcm1hdCB0byBhcHBlYXIgcHJvcGVybHkgaW4gdGhlIGlucHV0IGRhdGUgaHRtbCBvYmplY3QKZm9yIChpID0gMDsgaTwgKCRzY29wZS5jdXJyZW50RXZlbnQuZXh0cmFGaWVsZHMpLmxlbmd0aDsgaSsrKQp7CmxvZ0RlYnVnKCRzY29wZS5jdXJyZW50RXZlbnQuZXh0cmFGaWVsZHNbaV0pOwppZiAoJHNjb3BlLmN1cnJlbnRFdmVudC5leHRyYUZpZWxkc1tpXS5maWVsZF9kYXRhdHlwZT09IkRBVEUiKQp7Ci8vIGxvZ0RlYnVnKCJkYXRlIik7CiRzY29wZS5jdXJyZW50RXZlbnQuZXh0cmFGaWVsZHNbaV0uZmllbGRfdmFsdWU9bmV3IERhdGUoJHNjb3BlLmN1cnJlbnRFdmVudC5leHRyYUZpZWxkc1tpXS5maWVsZF92YWx1ZSk7Cn0KfQoKbG9nRGVidWcoIiRzY29wZS5jdXJyZW50RXZlbnQuaW5zdHJ1Y3Rvcl9pZDs9Iiskc2NvcGUuY3VycmVudEV2ZW50Lmluc3RydWN0b3JfaWQpOwpmb3IodmFyIGkgPSAwOyBpIDwgJHNjb3BlLmluc3RydWN0b3JzLmxlbmd0aDsgaSsrKQp7CmxvZ0RlYnVnKCRzY29wZS5pbnN0cnVjdG9yc1tpXS5pc19hY3RpdmUpOwppZiAoJHNjb3BlLmluc3RydWN0b3JzW2ldLmJ1c2luZXNzX3VzZXJfaWQ9PSRzY29wZS5jdXJyZW50RXZlbnQuaW5zdHJ1Y3Rvcl9pZCkKewpsb2dEZWJ1ZygieWVzaCIpOwokc2NvcGUuaW5zdHJ1Y3RvcnNbaV0uaXNfYWN0aXZlPTE7Cn0KfQp9Cgokc2NvcGUudXBkYXRlVXNlckV2ZW50UHJpY2UgPSBmdW5jdGlvbihuZXd2YWx1ZSwgdGhlZXZlbnQpCnsKbmV3X3ByaWNlPW5ld3ZhbHVlOwpzZXRDbGllbnRFdmVudFByaWNlKCRodHRwLCRzY29wZSwkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50VXNlcnNbMF0uYnVzaW5lc3NfdXNlcl9pZCx0aGVldmVudC5ldmVudF9pZCwgbmV3X3ByaWNlLHNldENsaWVudEV2ZW50UHJpY2VfY2FsbGJhY2ssIHNldENsaWVudEV2ZW50UHJpY2VfY2FsbGJhY2spOwpmdW5jdGlvbiBzZXRDbGllbnRFdmVudFByaWNlX2NhbGxiYWNrKCkKewpnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkcm91dGVQYXJhbXMuZXZlbnRfaWQsc2V0UGFydGljaXBhdGVkKTsKfQp9OwoKJHNjb3BlLiRvbigiZXZlbnRQYWdlUmVsb2FkRGF0YSIsZnVuY3Rpb24oZSxhKQp7CmdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCxzZXRQYXJ0aWNpcGF0ZWQpOwp9KTsKCgoKCiRzY29wZS5jbG9zZUV2ZW50ID0gZnVuY3Rpb24oKQp7CmxvZ0RlYnVnKCJjaGVja2luZyBpZiBldmVudCBoYXMgZXh0cmEgZmllbGRzIHRoYXQgYXJlIHJlcXVpcmVkIGJlZm9yZSBjbG9zaW5nIGl0Iik7CmNoZWNrRXZlbnRFeHRyYUZpZWxkcygkaHR0cCwkc2NvcGUsJ2NoZWNrRXZlbnRFeHRyYUZpZWxkcycsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLGNoZWNrRXZlbnRFeHRyYUZpZWxkc19zdWNjZXNzKTsKZnVuY3Rpb24gY2hlY2tFdmVudEV4dHJhRmllbGRzX3N1Y2Nlc3MoKQp7CmlmICgkc2NvcGUuY2hlY2tFdmVudEV4dHJhRmllbGRzPT10cnVlKQp7CmxvZ0RlYnVnKCJldmVudCBoYXMgYWxsIGV4dHJhIGZpZWxkcyBvaywgY2xvc2luZyBldmVudCIpOwovLyAkc2NvcGUuY3VycmVudEV2ZW50Lmlnbm9yZUV4dHJhRmllbGRzVmFsaWRhdGlvbj10cnVlOwpjbG9zZUV2ZW50KCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuZXZlbnRfaWQsJHNjb3BlLmN1cnJlbnRFdmVudCxhZnRlckNsb3NlRXZlbnQsYWZ0ZXJDbG9zZUV2ZW50KTsKZnVuY3Rpb24gYWZ0ZXJDbG9zZUV2ZW50KCkKewpnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkcm91dGVQYXJhbXMuZXZlbnRfaWQsc2V0UGFydGljaXBhdGVkKTsKfTsKfQplbHNlCnsKbG9nRGVidWcoImV2ZW50IGhhcyBleHRyYSBmaWVsZHMgcmVxdWlyZWQgdGhhdCBhcmUgbm90IGZpbGxlZCIpOwp2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKYW5pbWF0aW9uOiBmYWxzZSwKdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfZXZlbnRfY2xvc2VfaWdub3JlX21hbmRhdG9yeV9maWVsZHMucGhwJywKY29udHJvbGxlcjogJ2V2ZW50Q2xvc2VJZ25vcmVNYW5kYXRvcnlGaWVsZHNNb2RhbENvbnRyb2xsZXInLApzaXplOiAnbScsCnJlc29sdmU6IHsKY3VycmVudEV2ZW50OiBmdW5jdGlvbigpIHsKcmV0dXJuICRzY29wZS5jdXJyZW50RXZlbnQ7Cn0KfQp9KTsKfQp9Cn0KJHNjb3BlLnJlb3BlbkV2ZW50ID0gZnVuY3Rpb24oKQp7CmxvZ0RlYnVnKCJyZW9wZW5FdmVudCIpOwpyZW9wZW5FdmVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCwkc2NvcGUuY3VycmVudEV2ZW50LGFmdGVyUmVvcGVuRXZlbnQsYWZ0ZXJSZW9wZW5FdmVudCk7CmZ1bmN0aW9uIGFmdGVyUmVvcGVuRXZlbnQoKQp7CmdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQsc2V0UGFydGljaXBhdGVkKTsKfTsKfQoKfSk7CgprdXplQXBwLmZpbHRlcignc3RhcnRGcm9tJywgZnVuY3Rpb24oKQp7CnJldHVybiBmdW5jdGlvbihpbnB1dCwgc3RhcnQpCnsKaWYoIWlucHV0KSByZXR1cm4gW107Ci8vIGNvbnNvbGUubG9nKCJoZXJlcmVlZSAiK2lucHV0KTsKc3RhcnQgPSArc3RhcnQ7IC8vcGFyc2UgdG8gaW50CnJldHVybiBpbnB1dC5zbGljZShzdGFydCk7Cn0KfSk7Ci8vIGFuZ3VsYXIgZmlsdGVyIGZvciBldmVudHMgYmVmb3JlL2FmdGVyIHRvZGF5Cmt1emVBcHAuZmlsdGVyKCdiZWZvcmVOb3cnLCBmdW5jdGlvbigpIHsKLy8gQ3JlYXRlIHRoZSByZXR1cm4gZnVuY3Rpb24gYW5kIHNldCB0aGUgcmVxdWlyZWQgcGFyYW1ldGVyIG5hbWUgdG8gKippbnB1dCoqCnJldHVybiBmdW5jdGlvbihpbnB1dCkgewp2YXIgb3V0ID0gW107CgovLyBVc2luZyB0aGUgYW5ndWxhci5mb3JFYWNoIG1ldGhvZCwgZ28gdGhyb3VnaCB0aGUgYXJyYXkgb2YgZGF0YSBhbmQgcGVyZm9ybSB0aGUgb3BlcmF0aW9uIG9mIGZpZ3VyaW5nIG91dCBpZiB0aGUgbGFuZ3VhZ2UgaXMgc3RhdGljYWxseSBvciBkeW5hbWljYWxseSB0eXBlZC4KdmFyIGJyb3dzZXJfZXBvY2ggPSAobmV3IERhdGUpLmdldFRpbWUoKTsKCmFuZ3VsYXIuZm9yRWFjaChpbnB1dCwgZnVuY3Rpb24oZXZlbnQpCnsKLy8gIGxvZ0RlYnVnKCJmaWx0ZXJpbmcsIGV2ZW50LmV2ZW50X3VzZXJfc3RhdHVzX2lkPSIrZXZlbnQuZXZlbnRfdXNlcl9zdGF0dXNfaWQpOwppZiAoZXZlbnQuc3RhcnRfZXBvY2ggPD0gKGJyb3dzZXJfZXBvY2gvMTAwMCkpCnsKb3V0LnB1c2goZXZlbnQpCn0KfSkKcmV0dXJuIG91dDsKfQp9KTsKa3V6ZUFwcC5maWx0ZXIoJ2FmdGVyTm93JywgZnVuY3Rpb24oKSB7Ci8vIENyZWF0ZSB0aGUgcmV0dXJuIGZ1bmN0aW9uIGFuZCBzZXQgdGhlIHJlcXVpcmVkIHBhcmFtZXRlciBuYW1lIHRvICoqaW5wdXQqKgpyZXR1cm4gZnVuY3Rpb24oaW5wdXQpIHsKdmFyIG91dCA9IFtdOwoKLy8gVXNpbmcgdGhlIGFuZ3VsYXIuZm9yRWFjaCBtZXRob2QsIGdvIHRocm91Z2ggdGhlIGFycmF5IG9mIGRhdGEgYW5kIHBlcmZvcm0gdGhlIG9wZXJhdGlvbiBvZiBmaWd1cmluZyBvdXQgaWYgdGhlIGxhbmd1YWdlIGlzIHN0YXRpY2FsbHkgb3IgZHluYW1pY2FsbHkgdHlwZWQuCnZhciBicm93c2VyX2Vwb2NoID0gKG5ldyBEYXRlKS5nZXRUaW1lKCk7Cgphbmd1bGFyLmZvckVhY2goaW5wdXQsIGZ1bmN0aW9uKGV2ZW50KQp7Ci8vICBsb2dEZWJ1ZygiZmlsdGVyaW5nLCBldmVudC5ldmVudF91c2VyX3N0YXR1c19pZD0iK2V2ZW50LmV2ZW50X3VzZXJfc3RhdHVzX2lkKTsKaWYgKGV2ZW50LnN0YXJ0X2Vwb2NoID4gKGJyb3dzZXJfZXBvY2gvMTAwMCkpCnsKb3V0LnB1c2goZXZlbnQpCn0KfSkKcmV0dXJuIG91dDsKfQp9KTsKCmt1emVBcHAuZmlsdGVyKCdpc0FjdGl2ZScsIGZ1bmN0aW9uKCkgewovLyBDcmVhdGUgdGhlIHJldHVybiBmdW5jdGlvbiBhbmQgc2V0IHRoZSByZXF1aXJlZCBwYXJhbWV0ZXIgbmFtZSB0byAqKmlucHV0KioKcmV0dXJuIGZ1bmN0aW9uKGlucHV0KSB7CnZhciBvdXQgPSBbXTsKCi8vIFVzaW5nIHRoZSBhbmd1bGFyLmZvckVhY2ggbWV0aG9kLCBnbyB0aHJvdWdoIHRoZSBhcnJheSBvZiBkYXRhIGFuZCBwZXJmb3JtIHRoZSBvcGVyYXRpb24gb2YgZmlndXJpbmcgb3V0IGlmIHRoZSBsYW5ndWFnZSBpcyBzdGF0aWNhbGx5IG9yIGR5bmFtaWNhbGx5IHR5cGVkLgoKYW5ndWxhci5mb3JFYWNoKGlucHV0LCBmdW5jdGlvbihldmVudCkKewovLyAgbG9nRGVidWcoImZpbHRlcmluZywgZXZlbnQuZXZlbnRfdXNlcl9zdGF0dXNfaWQ9IitldmVudC5ldmVudF91c2VyX3N0YXR1c19pZCk7CmlmIChldmVudC5pc19hY3RpdmU9PTEpCnsKb3V0LnB1c2goZXZlbnQpCn0KfSkKcmV0dXJuIG91dDsKfQp9KTsKCmt1emVBcHAuZmlsdGVyKCdzaG91bGRfYmVfZGlzcGxheWVkJywgZnVuY3Rpb24oKSB7Ci8vIENyZWF0ZSB0aGUgcmV0dXJuIGZ1bmN0aW9uIGFuZCBzZXQgdGhlIHJlcXVpcmVkIHBhcmFtZXRlciBuYW1lIHRvICoqaW5wdXQqKgpyZXR1cm4gZnVuY3Rpb24oaW5wdXQpIHsKdmFyIG91dCA9IFtdOwoKLy8gVXNpbmcgdGhlIGFuZ3VsYXIuZm9yRWFjaCBtZXRob2QsIGdvIHRocm91Z2ggdGhlIGFycmF5IG9mIGRhdGEgYW5kIHBlcmZvcm0gdGhlIG9wZXJhdGlvbiBvZiBmaWd1cmluZyBvdXQgaWYgdGhlIGxhbmd1YWdlIGlzIHN0YXRpY2FsbHkgb3IgZHluYW1pY2FsbHkgdHlwZWQuCgphbmd1bGFyLmZvckVhY2goaW5wdXQsIGZ1bmN0aW9uKGV2ZW50KQp7Ci8vICBsb2dEZWJ1ZygiZmlsdGVyaW5nLCBldmVudC5ldmVudF91c2VyX3N0YXR1c19pZD0iK2V2ZW50LmV2ZW50X3VzZXJfc3RhdHVzX2lkKTsKaWYgKGV2ZW50LnNob3VsZF9iZV9kaXNwbGF5ZWQ9PTEpCnsKb3V0LnB1c2goZXZlbnQpCn0KfSkKcmV0dXJuIG91dDsKfQp9KTsKCmt1emVBcHAuY29udHJvbGxlcignSW5zdHJ1Y3RvclNob3cxQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHRpbWVvdXQsICRodHRwLCBzaGFyZWRQcm9wZXJ0aWVzLCAkcm9vdFNjb3BlLCAkcm91dGVQYXJhbXMsICRsb2NhdGlvbiwgJHJvdXRlLCBzaGFyZWREYXRhLCAkdWliTW9kYWwpCnsKZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLGdldEJ1c2luZXNzQ2xpZW50SW5mb19zdWNjZXNzKTsKICBnZXRzZWN1cml0eVByb2ZpbGVzKCRodHRwLCRzY29wZSwnc2VjX3Byb2ZpbGVzJyk7CgpmdW5jdGlvbiBnZXRCdXNpbmVzc0NsaWVudEluZm9fc3VjY2VzcygpCnsKZ2V0Q2xpZW50RXh0cmFGaWVsZHMoJGh0dHAsJHNjb3BlLCRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5idXNpbmVzc191c2VyX2lkLCdjbGllbnRFeHRyYUZpZWxkcycsZ2V0Q2xpZW50RXh0cmFGaWVsZHNfc3VjY2Vzcyk7CgpmdW5jdGlvbiBnZXRDbGllbnRFeHRyYUZpZWxkc19zdWNjZXNzKCkKewpmb3IgKGkgPSAwOyBpPCAoJHNjb3BlLmNsaWVudEV4dHJhRmllbGRzKS5sZW5ndGg7IGkrKykKewpsb2dEZWJ1Zygkc2NvcGUuY2xpZW50RXh0cmFGaWVsZHNbaV0pOwppZiAoJHNjb3BlLmNsaWVudEV4dHJhRmllbGRzW2ldLmZpZWxkX2RhdGF0eXBlPT0iREFURSIpCnsKLy8gbG9nRGVidWcoImRhdGUiKTsKJHNjb3BlLmNsaWVudEV4dHJhRmllbGRzW2ldLmZpZWxkX3ZhbHVlPW5ldyBEYXRlKCRzY29wZS5jbGllbnRFeHRyYUZpZWxkc1tpXS5maWVsZF92YWx1ZSk7Cn0KfQp9Cn0KCiAgJHNjb3BlLnVwZGF0ZV9zZWNfcHJvZmlsZSA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1ZygidXBkYXRlX3NlY19wcm9maWxlIGZvciBidWlkPSIrJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLmJ1c2luZXNzX3VzZXJfaWQrICIsIHByb2ZpbGVfaWQiKyRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5zZWNfcHJvZmlsZV9pZCk7CiAgICB1cGRhdGVfc2VjX3Byb2ZpbGUoJGh0dHAsJHNjb3BlLCRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5idXNpbmVzc191c2VyX2lkLCRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5zZWNfcHJvZmlsZV9pZCx1cGRhdGVfc2VjX3Byb2ZpbGVfc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiB1cGRhdGVfc2VjX3Byb2ZpbGVfc3VjY2VzcygpCiAgICB7CiAgICAgIGdldHNlY3VyaXR5UHJvZmlsZXMoJGh0dHAsJHNjb3BlLCdzZWNfcHJvZmlsZXMnKTsKICAgIH0KICB9CiRzY29wZS5hcmNoaXZlQ2xpZW50TW9kYWwgPSBmdW5jdGlvbigpCnsKLy8gYXJjaGl2ZS9kZWxldGUgY2xpZW50IC0gYXNrIGlmIHN1cmUKdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CmFuaW1hdGlvbjogZmFsc2UsCnRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2FyY2hpdmVfY2xpZW50X21vZGFsLnBocCcsCnNpemU6ICd4cycsCmNvbnRyb2xsZXI6ICdhcmNoaXZlX2NsaWVudF9tb2RhbCcsICAvLyAncGF5bWVueURldGFpbHNNb2RhbENvbnRyb2xsZXInLApyZXNvbHZlOiB7CmJ1c2luZXNzX3VzZXJfaWQ6IGZ1bmN0aW9uKCkgewpyZXR1cm4gJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLmJ1c2luZXNzX3VzZXJfaWQ7Cn0sCmJ1c2VyX2xhc3RfbmFtZTogZnVuY3Rpb24oKSB7CnJldHVybiAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYnVzZXJfbGFzdF9uYW1lOwp9LApidXNlcl9maXJzdF9uYW1lOiBmdW5jdGlvbigpIHsKcmV0dXJuICRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5idXNlcl9maXJzdF9uYW1lOwp9LAppc19pbnN0cnVjdG9yOiBmdW5jdGlvbigpIHsKcmV0dXJuIHRydWU7Cn0KfQp9KTsKfQoKJHNjb3BlLnVwZGF0ZVVzZXJGaXJzdE5hbWUgPSBmdW5jdGlvbihuZXdWYWx1ZSkKewpzZXRDbGllbnRGaXJzdE5hbWUoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLG5ld1ZhbHVlLGFmdGVyQ2xpZW50U2V0LGFmdGVyQ2xpZW50U2V0KTsKZnVuY3Rpb24gYWZ0ZXJDbGllbnRTZXQoKQp7CmdldEJ1c2luZXNzQ2xpZW50SW5mbygkaHR0cCwkc2NvcGUsJ2Zvcm1VcGRhdGVDbGllbnRBbmd1bGFyJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7Cn0KfQokc2NvcGUudXBkYXRlVXNlckxhc3ROYW1lID0gZnVuY3Rpb24obmV3VmFsdWUpCnsKc2V0Q2xpZW50TGFzdE5hbWUoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLG5ld1ZhbHVlLGFmdGVyQ2xpZW50U2V0LGFmdGVyQ2xpZW50U2V0KTsKZnVuY3Rpb24gYWZ0ZXJDbGllbnRTZXQoKQp7CmdldEJ1c2luZXNzQ2xpZW50SW5mbygkaHR0cCwkc2NvcGUsJ2Zvcm1VcGRhdGVDbGllbnRBbmd1bGFyJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7Cn0KfQokc2NvcGUudXBkYXRlVXNlclBob25lTnVtYmVyID0gZnVuY3Rpb24obmV3VmFsdWUpCnsKbmV3VmFsdWUgPSBuZXdWYWx1ZS5yZXBsYWNlKCctJywnJyk7CmlmIChpc05hTihuZXdWYWx1ZSkpCnsKYWxlcnQoIteQ16DXkCDXlNeW158g157Xodek16gg15jXnNek15XXnyDXqten15nXnyIpOwpnZXRCdXNpbmVzc0NsaWVudEluZm8oJGh0dHAsJHNjb3BlLCdmb3JtVXBkYXRlQ2xpZW50QW5ndWxhcicsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwp9CmVsc2UKewpzZXRDbGllbnRQaG9uZU51bWJlcigkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsbmV3VmFsdWUsc2V0Q2xpZW50UGhvbmVOdW1iZXJfY2FsbGJhY2ssc2V0Q2xpZW50UGhvbmVOdW1iZXJfY2FsbGJhY2spOwpmdW5jdGlvbiBzZXRDbGllbnRQaG9uZU51bWJlcl9jYWxsYmFjaygpCnsKZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKfQp9Cn0KCn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignQ2xpZW50c1Nob3cxQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHRpbWVvdXQsICRodHRwLCBzaGFyZWRQcm9wZXJ0aWVzLCAkcm9vdFNjb3BlLCAkcm91dGVQYXJhbXMsICRsb2NhdGlvbiwgJHJvdXRlLCBzaGFyZWREYXRhLCAkdWliTW9kYWwpCnsKZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLGdldEJ1c2luZXNzQ2xpZW50SW5mb19zdWNjZXNzKTsKCmZ1bmN0aW9uIGdldEJ1c2luZXNzQ2xpZW50SW5mb19zdWNjZXNzKCkKewpnZXRDbGllbnRFeHRyYUZpZWxkcygkaHR0cCwkc2NvcGUsJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLmJ1c2luZXNzX3VzZXJfaWQsJ2NsaWVudEV4dHJhRmllbGRzJyxnZXRDbGllbnRFeHRyYUZpZWxkc19zdWNjZXNzKTsKCmZ1bmN0aW9uIGdldENsaWVudEV4dHJhRmllbGRzX3N1Y2Nlc3MoKQp7CmZvciAoaSA9IDA7IGk8ICgkc2NvcGUuY2xpZW50RXh0cmFGaWVsZHMpLmxlbmd0aDsgaSsrKQp7CmxvZ0RlYnVnKCRzY29wZS5jbGllbnRFeHRyYUZpZWxkc1tpXSk7CmlmICgkc2NvcGUuY2xpZW50RXh0cmFGaWVsZHNbaV0uZmllbGRfZGF0YXR5cGU9PSJEQVRFIikKewovLyBsb2dEZWJ1ZygiZGF0ZSIpOwokc2NvcGUuY2xpZW50RXh0cmFGaWVsZHNbaV0uZmllbGRfdmFsdWU9bmV3IERhdGUoJHNjb3BlLmNsaWVudEV4dHJhRmllbGRzW2ldLmZpZWxkX3ZhbHVlKTsKfQp9Cn0KfQp7CmdldENsaWVudEV2ZW50cygkaHR0cCwkc2NvcGUsJ2N1cnJlbnRDbGllbnRFdmVudHMnLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKCmdldENsaWVudFBheW1lbnRzKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCwnY3VycmVudENsaWVudFBheW1lbnRzJyk7Cgokc2NvcGUuYXJjaGl2ZUNsaWVudE1vZGFsID0gZnVuY3Rpb24oKQp7Ci8vIGFyY2hpdmUvZGVsZXRlIGNsaWVudCAtIGFzayBpZiBzdXJlCnZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewphbmltYXRpb246IGZhbHNlLAp0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdhcmNoaXZlX2NsaWVudF9tb2RhbC5waHAnLApzaXplOiAneHMnLApjb250cm9sbGVyOiAnYXJjaGl2ZV9jbGllbnRfbW9kYWwnLCAgLy8gJ3BheW1lbnlEZXRhaWxzTW9kYWxDb250cm9sbGVyJywKcmVzb2x2ZTogewpidXNpbmVzc191c2VyX2lkOiBmdW5jdGlvbigpIHsKcmV0dXJuICRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5idXNpbmVzc191c2VyX2lkOwp9LApidXNlcl9sYXN0X25hbWU6IGZ1bmN0aW9uKCkgewpyZXR1cm4gJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLmJ1c2VyX2xhc3RfbmFtZTsKfSwKYnVzZXJfZmlyc3RfbmFtZTogZnVuY3Rpb24oKSB7CnJldHVybiAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYnVzZXJfZmlyc3RfbmFtZTsKfSwKaXNfaW5zdHJ1Y3RvcjogZnVuY3Rpb24oKSB7CnJldHVybiBmYWxzZTsKfQp9Cn0pOwp9CiRzY29wZS5wYWNrYWdlRGVsZXRlID0gZnVuY3Rpb24ocGFja2FnZSkKewpsb2dEZWJ1ZygicGFja2FnZSBkZWxldGUgIitKU09OLnN0cmluZ2lmeShwYWNrYWdlKSk7CmRlbGV0ZVBhY2thZ2UoJGh0dHAsJHNjb3BlLHBhY2thZ2UucGFja2FnZV91c2VyX2lkLCRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5idXNpbmVzc191c2VyX2lkLHN1Y2Nlc3NfY2FsbGJhY2ssIHN1Y2Nlc3NfY2FsbGJhY2spOwpmdW5jdGlvbiBzdWNjZXNzX2NhbGxiYWNrKCkKewokcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NsaWVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCn0KfQoKJHNjb3BlLnVwZGF0ZUNsaWVudEV4dHJhRmllbGRzID0gZnVuY3Rpb24oKQp7CiAgICAgIGxvZ0RlYnVnKCJ1cGRhdGVDbGllbnRFeHRyYUZpZWxkcyIpOwp0aGVkYXRhID0gewpleHRyYUZpZWxkczokc2NvcGUuY2xpZW50RXh0cmFGaWVsZHMKfTsKICAgICAgJHNjb3BlLmV4dHJhRmllbGRzQWxlcnRNZXNzYWdlPSLXqdeV157XqC4uLiI7CiAgICAgIHVwZGF0ZUNsaWVudEV4dHJhRmllbGRzKCRodHRwLCRzY29wZSwkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYnVzaW5lc3NfdXNlcl9pZCx0aGVkYXRhLHVwZGF0ZUV2ZW50Q2xpZW50RmllbGRzX2NhbGxiYWNrLCB1cGRhdGVFdmVudENsaWVudEZpZWxkc19jYWxsYmFjayk7CgogICAgICBmdW5jdGlvbiB1cGRhdGVFdmVudENsaWVudEZpZWxkc19jYWxsYmFjaygpCnsKLy8gZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLHNldFBhcnRpY2lwYXRlZCk7CiAgICAgICAgJHNjb3BlLmV4dHJhRmllbGRzQWxlcnRNZXNzYWdlPSLXoNep157XqCEiOwokdGltZW91dChmdW5jdGlvbigpCnsKJHNjb3BlLmV4dHJhRmllbGRzQWxlcnRNZXNzYWdlPW51bGw7Cn0sIDMwMDApOwp9Cn07Cgokc2NvcGUuc2NoZWR1bGVFdmVudEZvckNsaWVudCA9IGZ1bmN0aW9uKCkKewpsb2dEZWJ1Zygic2VldGluZyBzaGFyZSBwcm9wZXJ0eSB1c2VyX2lkICIrJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdKTsKc2hhcmVkUHJvcGVydGllcy5zZXRfc2VsZWN0ZWRfdXNlcigkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0pOwokbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2NhbGVuZGFyJyk7Cn0KJHNjb3BlLmludm9pY2VHZW5lcmF0ZUNoZWNrYm94ID0gZnVuY3Rpb24oZnBheW1lbnQpCnsKbG9nRGVidWcoImludm9pY2VHZW5lcmF0ZUNoZWNrYm94IGZvciAiK0pTT04uc3RyaW5naWZ5KGZwYXltZW50KSk7CnNldENsaWVudFBheW1lbnRJbnZvaWNlR2VuZXJhdGVkKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCxmcGF5bWVudC51c2VyX3BheW1lbnRfaWQsZnBheW1lbnQuaW52b2ljZV9nZW5lcmF0ZWQsc2V0Q2xpZW50UGF5bWVudEludm9pY2VHZW5lcmF0ZWRfY2FsbGJhY2ssIHNldENsaWVudFBheW1lbnRJbnZvaWNlR2VuZXJhdGVkX2NhbGxiYWNrKTsKZnVuY3Rpb24gc2V0Q2xpZW50UGF5bWVudEludm9pY2VHZW5lcmF0ZWRfY2FsbGJhY2soKQp7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKfQp9OwoKJHNjb3BlLnJlY2FsY1VzZXJCYWxhbmNlID0gZnVuY3Rpb24oKQp7CmxvZ0RlYnVnKCJyZWNhbGNVc2VyQmFsYW5jZSIpOwpyZWNhbGNVc2VyQmFsYW5jZSgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsIHJlY2FsY1VzZXJCYWxhbmNlX2NhbGxiYWNrKTsKZnVuY3Rpb24gcmVjYWxjVXNlckJhbGFuY2VfY2FsbGJhY2soKQp7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKfSAgICB9CiRzY29wZS51cGRhdGVFdmVudFBhY2thZ2VSZWZlcmVuY2UgPSBmdW5jdGlvbih1c2VyX2lkLCBmbWVldGluZykKewpsb2dEZWJ1ZygidXBkYXRlRXZlbnRQYWNrYWdlUmVmZXJlbmNlLCB1c2VyPSIrdXNlcl9pZCsiLCBmbWVldGluZz0iK0pTT04uc3RyaW5naWZ5KGZtZWV0aW5nKSk7CnZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewphbmltYXRpb246IGZhbHNlLAp0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9jbGllbnRfZXZlbnRfcGFja2FnZV9hc3NvY2lhdGlvbi5waHAnLApzaXplOiAneHMnLApjb250cm9sbGVyOiAnZXZlbnRQYWNrYWdlQXNzb2NpYXRpb25Nb2RhbENvbnRyb2xsZXInLCAgLy8gJ3BheW1lbnlEZXRhaWxzTW9kYWxDb250cm9sbGVyJywKcmVzb2x2ZTogewpmbWVldGluZzogZnVuY3Rpb24oKSB7CnJldHVybiBmbWVldGluZzsKfSwKYmFsYW5jZTogZnVuY3Rpb24oKSB7CnJldHVybiAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYmFsYW5jZTsKfSwKYnVzaW5lc3NfdXNlcl9pZDogZnVuY3Rpb24oKSB7CnJldHVybiAkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZDsKfQp9Cn0pOwp9OwoKJHNjb3BlLnVwZGF0ZVBhY2thZ2VQYXltZW50UmVmZXJlbmNlID0gZnVuY3Rpb24odXNlcl9pZCwgZnBhY2thZ2UpCnsKbG9nRGVidWcoInVwZGF0ZVBhY2thZ2VQYXltZW50UmVmZXJlbmNlLCB1c2VyPSIrdXNlcl9pZCsiLCBmcGFja2FnZT0iK0pTT04uc3RyaW5naWZ5KGZwYWNrYWdlKSk7CnZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewphbmltYXRpb246IGZhbHNlLAp0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9jbGllbnRfcGFja2FnZV9wYXltZW50X2Fzc29jaWF0aW9uLnBocCcsCnNpemU6ICd4cycsCmNvbnRyb2xsZXI6ICdwYWNrYWdlUGF5bWVudEFzc29jaWF0aW9uTW9kYWxDb250cm9sbGVyJywgIC8vICdwYXltZW55RGV0YWlsc01vZGFsQ29udHJvbGxlcicsCnJlc29sdmU6IHsKZnBhY2thZ2U6IGZ1bmN0aW9uKCkgewpyZXR1cm4gZnBhY2thZ2U7Cn0sCmJhbGFuY2U6IGZ1bmN0aW9uKCkgewpyZXR1cm4gJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLmJhbGFuY2U7Cn0sCmJ1c2luZXNzX3VzZXJfaWQ6IGZ1bmN0aW9uKCkgewpyZXR1cm4gJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQ7Cn0KfQp9KTsKfTsKCi8vIHNob3cgcGF5bWVudCBwb3B1cAokc2NvcGUuc2hvd1BheW1lbnREZXRhaWxzID0gZnVuY3Rpb24oZnBheW1lbnQpCnsKbG9nRGVidWcoInNob3dQYXltZW50RGV0YWlscyIpOwp2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKYW5pbWF0aW9uOiBmYWxzZSwKdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfY2xpZW50X3BheW1lbnRfZGV0YWlscy5waHAnLApzaXplOiAneHMnLApjb250cm9sbGVyOiAncGF5bWVueURldGFpbHNNb2RhbENvbnRyb2xsZXInLApyZXNvbHZlOiB7CmZwYXltZW50OiBmdW5jdGlvbigpIHsKcmV0dXJuIGZwYXltZW50Owp9Cn0KfSk7Cn0KJHNjb3BlLmludm9pY2VOdW1iZXJDaGFuZ2VkID0gZnVuY3Rpb24obmV3X2ludm9pY2VfbnVtYmVyLGZwYXltZW50KQp7CmxvZ0RlYnVnKCJpbnZvaWNlTnVtYmVyQ2hhbmdlZCAiKyBuZXdfaW52b2ljZV9udW1iZXIgKyJmb3IgIitKU09OLnN0cmluZ2lmeShmcGF5bWVudCkpOwpzZXRDbGllbnRQYXltZW50SW52b2ljZU51bWJlcigkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsZnBheW1lbnQudXNlcl9wYXltZW50X2lkLG5ld19pbnZvaWNlX251bWJlcixzZXRDbGllbnRQYXltZW50SW52b2ljZU51bWJlcl9jYWxsYmFjaywgc2V0Q2xpZW50UGF5bWVudEludm9pY2VOdW1iZXJfY2FsbGJhY2spOwpmdW5jdGlvbiBzZXRDbGllbnRQYXltZW50SW52b2ljZU51bWJlcl9jYWxsYmFjaygpCnsKLy8gJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwp9Cn07Cgokc2NvcGUuJG9uKCJjbGllbnRQYWdlUmVsb2FkRGF0YSIsZnVuY3Rpb24oZSxhKQp7CmxvZ0RlYnVnKCJjbGllbnRQYWdlUmVsb2FkRGF0YSIpOwpnZXRCdXNpbmVzc1VzZXJQYWNrYWdlcygkaHR0cCwkc2NvcGUsJ3VzZXJfcGFja2FnZXMnLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKZ2V0Q2xpZW50UGF5bWVudHMoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLCdjdXJyZW50Q2xpZW50UGF5bWVudHMnKTsKZ2V0Q2xpZW50RXZlbnRzKCRodHRwLCRzY29wZSwnY3VycmVudENsaWVudEV2ZW50cycsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwpnZXRCdXNpbmVzc0NsaWVudEluZm8oJGh0dHAsJHNjb3BlLCdmb3JtVXBkYXRlQ2xpZW50QW5ndWxhcicsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwoKICAgICAgLy8gJHRpbWVvdXQoZnVuY3Rpb24oKQogICAgICAvLyB7CiAgICAgIC8vICAgJHNjb3BlLmN1cnNvcmRlbGV0ZT0iIjsKICAgICAgLy8gICBkb2N1bWVudC5ib2R5LnN0eWxlLmN1cnNvcj0nJzsKICAgICAgLy8gfSwgMjAwMCk7Cgp9KTsKCiRzY29wZS5pc0NvbmZpcm1lZE9yQ2xvc2VkID0gZnVuY3Rpb24oZXZlbnQpCnsKaWYgKCRzY29wZS5zaG93QWxsRXZlbnRzKQp7CnJldHVybiB0cnVlOwp9CgppZiAoKGV2ZW50LmlzX2NvbmZpcm1lZCA9PSAxKSB8fCAoZXZlbnQuaXNfZmluYWxfc3RhdHVzID09IDEpIHx8ICgoZXZlbnQuaXNfd2FpdGluZ19saXN0ID09IDEpICYmIChldmVudC5pc19jYW5jZWxlZCA9PSAwKSkpCnsKcmV0dXJuIHRydWU7Cn0KZWxzZQp7CnJldHVybiBmYWxzZTsKfQp9CiRzY29wZS5nb3RvQ2xpZW50RWRpdFBhZ2U9Z290b0NsaWVudEVkaXRQYWdlOwokc2NvcGUuZ290b0JhY2s9ZnVuY3Rpb24oKQp7CmxvZ0RlYnVnKCdnbyBiYWNrJyk7CndpbmRvdy5oaXN0b3J5LmJhY2soKTsKfTsKCiRzY29wZS5nb3RvRXZlbnRQYWdlID0gZnVuY3Rpb24gKHRoZWV2ZW50KQp7CmdvdG9FdmVudFBhZ2UodGhlZXZlbnQpOwp9Cn0KJHNjb3BlLmluaXRpYXRlUGF5bWVudCA9IGZ1bmN0aW9uKGlzcGx1cykKewpsb2dEZWJ1ZygiaW5pdGlhdGVQYXltZW50IGlzcGx1cyIraXNwbHVzKTsKdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CmFuaW1hdGlvbjogZmFsc2UsCnRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2NsaWVudF9wYXltZW50LnBocCcsCmNvbnRyb2xsZXI6ICdidXNpbmVzc0NsaWVuZENhcmRQYXltZW50JywKLy8gc2l6ZTogc2l6ZSwKcmVzb2x2ZTogewpjdXJyZW50Q2xpZW50OiBmdW5jdGlvbigpIHsKcmV0dXJuICRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXTsKfSwKaXNwbHVzOiBmdW5jdGlvbigpIHsKcmV0dXJuIGlzcGx1czsKfQp9Cn0pOwp9Cgokc2NvcGUudXBkYXRlVXNlckZpcnN0TmFtZSA9IGZ1bmN0aW9uKG5ld1ZhbHVlKQp7CnNldENsaWVudEZpcnN0TmFtZSgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsbmV3VmFsdWUsYWZ0ZXJDbGllbnRTZXQsYWZ0ZXJDbGllbnRTZXQpOwpmdW5jdGlvbiBhZnRlckNsaWVudFNldCgpCnsKZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKfQp9CiRzY29wZS51cGRhdGVVc2VyTGFzdE5hbWUgPSBmdW5jdGlvbihuZXdWYWx1ZSkKewpzZXRDbGllbnRMYXN0TmFtZSgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsbmV3VmFsdWUsYWZ0ZXJDbGllbnRTZXQsYWZ0ZXJDbGllbnRTZXQpOwpmdW5jdGlvbiBhZnRlckNsaWVudFNldCgpCnsKZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKfQp9CiRzY29wZS51cGRhdGVVc2VyRW1haWwgPSBmdW5jdGlvbihuZXdWYWx1ZSkKewpzZXRDbGllbnRFbWFpbCgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsbmV3VmFsdWUsYWZ0ZXJzZXRDbGllbnRFbWFpbCxhZnRlcnNldENsaWVudEVtYWlsKTsKZnVuY3Rpb24gYWZ0ZXJzZXRDbGllbnRFbWFpbCgpCnsKZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKfQp9CgoKJHNjb3BlLnVwZGF0ZVVzZXJQaG9uZU51bWJlciA9IGZ1bmN0aW9uKG5ld1ZhbHVlKQp7Cm5ld1ZhbHVlID0gbmV3VmFsdWUucmVwbGFjZSgnLScsJycpOwppZiAoaXNOYU4obmV3VmFsdWUpKQp7CmFsZXJ0KCLXkNeg15Ag15TXltefINee16HXpNeoINeY15zXpNeV158g16rXp9eZ158iKTsKZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKfQplbHNlCnsKc2V0Q2xpZW50UGhvbmVOdW1iZXIoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLG5ld1ZhbHVlLHNldENsaWVudFBob25lTnVtYmVyX2NhbGxiYWNrLHNldENsaWVudFBob25lTnVtYmVyX2NhbGxiYWNrKTsKZnVuY3Rpb24gc2V0Q2xpZW50UGhvbmVOdW1iZXJfY2FsbGJhY2soKQp7CmdldEJ1c2luZXNzQ2xpZW50SW5mbygkaHR0cCwkc2NvcGUsJ2Zvcm1VcGRhdGVDbGllbnRBbmd1bGFyJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7Cn0KfQp9CiRzY29wZS51cGRhdGVVc2VyRXZlbnRQcmljZSA9IGZ1bmN0aW9uKG5ld3ZhbHVlLCB0aGVldmVudCkKewpuZXdfcHJpY2U9bmV3dmFsdWU7CnNldENsaWVudEV2ZW50UHJpY2UoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLHRoZWV2ZW50LmV2ZW50X2lkLCBuZXdfcHJpY2Usc2V0Q2xpZW50RXZlbnRQcmljZV9jYWxsYmFjaywgc2V0Q2xpZW50RXZlbnRQcmljZV9jYWxsYmFjayk7CmZ1bmN0aW9uIHNldENsaWVudEV2ZW50UHJpY2VfY2FsbGJhY2soKQp7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKfQp9OwoKJHNjb3BlLnVwZGF0ZVVzZXJQYWNrYWdlRXZlbnRzQ291bnRlciA9IGZ1bmN0aW9uKG5ld3ZhbHVlLCB0aGVwYWNrYWdlKQp7CmV2ZW50c19jb3VudGVyPW5ld3ZhbHVlOwpzZXRVc2VyUGFja2FnZUV2ZW50c0NvdW50ZXIoJGh0dHAsJHNjb3BlLHRoZXBhY2thZ2UucGFja2FnZV91c2VyX2lkLGV2ZW50c19jb3VudGVyLHNldFVzZXJQYWNrYWdlRXZlbnRzQ291bnRlcl9jYWxsYmFjaywgc2V0VXNlclBhY2thZ2VFdmVudHNDb3VudGVyX2NhbGxiYWNrKQpmdW5jdGlvbiBzZXRVc2VyUGFja2FnZUV2ZW50c0NvdW50ZXJfY2FsbGJhY2soKQp7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKfQp9Owokc2NvcGUudXBkYXRlVXNlclBhY2thZ2VQYWNrYWdlUHJpY2UgPSBmdW5jdGlvbihuZXd2YWx1ZSwgdGhlcGFja2FnZSkKewpwYWNrYWdlX3ByaWNlPW5ld3ZhbHVlOwpzZXRVc2VyUGFja2FnZVBhY2thZ2VQcmljZSgkaHR0cCwkc2NvcGUsdGhlcGFja2FnZS5wYWNrYWdlX3VzZXJfaWQscGFja2FnZV9wcmljZSxzZXRVc2VyUGFja2FnZVBhY2thZ2VQcmljZV9jYWxsYmFjaywgc2V0VXNlclBhY2thZ2VQYWNrYWdlUHJpY2VfY2FsbGJhY2spCmZ1bmN0aW9uIHNldFVzZXJQYWNrYWdlUGFja2FnZVByaWNlX2NhbGxiYWNrKCkKewovLyBnZXRCdXNpbmVzc1VzZXJQYWNrYWdlcygkaHR0cCwkc2NvcGUsJ3VzZXJfcGFja2FnZXMnLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwp9Cn07Cgokc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXIgPSB7fTsKbG9nRGVidWcoJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwokc2NvcGUuc2hvd19jbGllbnRfdXBkYXRlX2NsaWVudCA9IHRydWU7CiRzY29wZS5zaG93X2NsaWVudF91cGRhdGVfc2F2ZSA9IGZhbHNlOwokc2NvcGUuc2hvd19jbGllbnRfZGVsZXRlX2NsaWVudCA9IHRydWU7CiRzY29wZS5zaG93X2NsaWVudF91cGRhdGVfY2FuY2VsID0gZmFsc2U7Cgokc2NvcGUudXBkYXRlQ2xpZW50RW5hYmxlID0gZnVuY3Rpb24oKSB7CmxvZ0RlYnVnKCJlbmFibGluZyBlZGl0aW5nICgkc2NvcGUuY2xpZW50c1VwZGF0ZURpc2FibGVkIHdhcyAiICsgJHNjb3BlLmNsaWVudHNVcGRhdGVEaXNhYmxlZCArICIpIik7CiRzY29wZS5jbGllbnRzVXBkYXRlRGlzYWJsZWQgPSBmYWxzZTsKJHNjb3BlLnNob3dfY2xpZW50X3VwZGF0ZV9jbGllbnQgPSBmYWxzZTsKJHNjb3BlLnNob3dfY2xpZW50X3VwZGF0ZV9zYXZlID0gdHJ1ZTsKJHNjb3BlLnNob3dfY2xpZW50X2RlbGV0ZV9jbGllbnQgPSBmYWxzZTsKJHNjb3BlLnNob3dfY2xpZW50X3VwZGF0ZV9jYW5jZWwgPSB0cnVlOwp9CiRzY29wZS51cGRhdGVDbGllbnREaXNhYmxlID0gZnVuY3Rpb24oKSB7CmxvZ0RlYnVnKCJkaXNhYmxlIGVkaXRpbmciKTsKLy8JCSRsb2NhdGlvbi5wYXRoKCcvQ2xpZW50cy8nKyRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKJHJvdXRlLnJlbG9hZCgpOwp9CiRzY29wZS5zY2hlZHVsZUV2ZW50RnJvbUVuZFVzZXIgPSBmdW5jdGlvbigpIHsKc2hhcmVkRGF0YS5zZXRTZWxlY3RlZEVuZFVzZXIoewppZDogJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsCmZpcnN0X25hbWU6ICRzY29wZS5jdXJyZW50Q2xpZW50LnVzZXJzWzBdLmZpcnN0X25hbWUsCmxhc3RfbmFtZTogJHNjb3BlLmN1cnJlbnRDbGllbnQudXNlcnNbMF0ubGFzdF9uYW1lCn0pOwpsb2dEZWJ1Zygic2NoZWR1bGUgZXZlbnQgZm9yIHVzZXIgIiArICRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKLy8JCSRsb2NhdGlvbi5wYXRoKCcvQ2xpZW50cy8nKyRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jYWxlbmRhcicpOwp9CgogICAgJHNjb3BlLnVzZXJEZWxldGVQYXltZW50ID0gZnVuY3Rpb24gKGZwYXltZW50KQogICAgewogICAgICAvLyAkc2NvcGUuY3Vyc29yZGVsZXRlPSJ3YWl0IjsKICAgICAgbG9nRGVidWcoInVzZXJEZWxldGVQYXltZW50Iik7CiAgICAgIC8vIGRvY3VtZW50LmJvZHkuc3R5bGUuY3Vyc29yPSd3YWl0JzsKCiAgICAgIGRlbGV0ZUNsaWVudFBheW1lbnRzKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCxmcGF5bWVudC51c2VyX3BheW1lbnRfaWQsZGVsZXRlQ2xpZW50UGF5bWVudHNfc3VjY2Vzc19jYWxsYmFjayk7CiAgICAgIGZ1bmN0aW9uIGRlbGV0ZUNsaWVudFBheW1lbnRzX3N1Y2Nlc3NfY2FsbGJhY2soKQogICAgICB7CiAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgICAgIGxvZ0RlYnVnKCJ1c2VyRGVsZXRlUGF5bWVudCIpOwogICAgICAgIC8vICRzY29wZS5jdXJzb3JkZWxldGU9IiI7CiAgICAgICAgLy8gZG9jdW1lbnQuYm9keS5zdHlsZS5jdXJzb3I9Jyc7CiAgICAgIH0KICAgIH0KLy8gcmVtb3ZlIGVuZCB1c2VyIGZyb20gZXZlbnQKJHNjb3BlLnVzZXJEZWxldGVFdmVudCA9IGZ1bmN0aW9uKGVuZHVzZXJfaWQsIHRoZWV2ZW50KQp7Ci8vIGlmIGl0J3MgYSBjbGFzcyAtIHdlIHNpbXBseSByZW1vdmUgdGhlIHVzZXIgZnJvbSB0aGUgZXZlbnQKaWYgKHRoZWV2ZW50LmlzX2NsYXNzPT0xKQp7CmxvZ0RlYnVnKCJzY29wZS51c2VyRGVsZXRlRXZlbnQiKTsKcmVtb3ZlRW5kVXNlckZyb21FdmVudCgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsdGhlZXZlbnQuZXZlbnRfaWQscmVtb3ZlRW5kVXNlckZyb21FdmVudF9maW5pc2gsIHJlbW92ZUVuZFVzZXJGcm9tRXZlbnRfZmluaXNoKTsKZnVuY3Rpb24gcmVtb3ZlRW5kVXNlckZyb21FdmVudF9maW5pc2goKQp7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKfQp9Ci8vIGlmIGl0cyBub3QgYSBjbGFzcyAtIHdlIG5lZWQgdG8gcmVtb3ZlIHRoZSBldmVudCBpdHNlbGYKZWxzZQp7Ci8vIGFsZXJ0KCJub3QgY2xhc3MgZXZlbnQsIFRPRE8iKTsKfQp9OwoKLy8gcmV0cmV2aW5nIHBhY2thZ2VzIGZvciB0aGUgYnVzaW5lc3MKZ2V0QnVzaW5lc3NQYWNrYWdlcygkaHR0cCwkc2NvcGUsJ3BhY2thZ2VzJyk7CgovLyBnZXQgcGFja2FnZXMgZm9yIHRoaXMgc3BlY2lmaWMgdXNlcgpnZXRCdXNpbmVzc1VzZXJQYWNrYWdlcygkaHR0cCwkc2NvcGUsJ3VzZXJfcGFja2FnZXMnLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKLy8gYWRkaW5nIHBhY2thZ2UgdG8gdXNlciAtIGNhbGxlZCB3aGVuIGEgcGFja2FnZSBpcyBzZWxlY3RlZAokc2NvcGUucGFja2FnZUZvckNsaWVudFNlbGVjdGVkID0gZnVuY3Rpb24oc2VsZWN0ZWRQYWNrYWdlKSB7CmlmIChzZWxlY3RlZFBhY2thZ2UpIHsKLy8gbG9nRGVidWcoJ3llcyBzZWxlY3RlZCAnICsgSlNPTi5zdHJpbmdpZnkoc2VsZWN0ZWRQYWNrYWdlKSk7CmFkZEJ1c2luZXNzUGFja2FnZVRvVXNlcigkaHR0cCwkc2NvcGUsc2VsZWN0ZWRQYWNrYWdlLm9yaWdpbmFsT2JqZWN0LCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLGFkZEJ1c2luZXNzUGFja2FnZVN1Y2Nlc3MpOwpmdW5jdGlvbiBhZGRCdXNpbmVzc1BhY2thZ2VTdWNjZXNzKCkKewpsb2dEZWJ1ZygiYWRkQnVzaW5lc3NQYWNrYWdlU3VjY2VzczIiKTsKLy8gZ2V0QnVzaW5lc3NQYWNrYWdlcygkaHR0cCwkc2NvcGUsJ3BhY2thZ2VzJyk7Ci8vIGdldEJ1c2luZXNzVXNlclBhY2thZ2VzKCRodHRwLCRzY29wZSwndXNlcl9wYWNrYWdlcycsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwokcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NsaWVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCn0KJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdhbmd1Y29tcGxldGUtYWx0OmNsZWFySW5wdXQnLCAnY2xpZW50X2FuZ3Vjb21wbGV0ZScpOwp9CmVsc2UKewovLyBsb2dEZWJ1Zygnbm90IHNlbGVjdGVkLCBkbyBub3RoaW5nJyk7Cn0KfTsKfSk7CgoKLy8gTmVlZCB0byBkaXN0aW5ndWlzaCBiZXR3ZWVuIGVuZCB1c2VyIChjbGllbnQpIGFuZCBidXNpbmVzcyBvd25lci4KLy8gY3VycmVudGx5IGNhbGxzIG9ubHkgZW5kIHVzZXIKa3V6ZUFwcC5jb250cm9sbGVyKCdIb21lQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICR1aWJNb2RhbCkKewoKZ2V0QWxsQ2xpZW50cygkaHR0cCwkc2NvcGUsJ2FsbENsaWVudHMnKTsKCiRzY29wZS5ob21lcGFnZUxpbWl0PTY7CmdldE9wZW5lZEV2ZW50cygkaHR0cCwkc2NvcGUsJHNjb3BlLmhvbWVwYWdlTGltaXQsJ29wZW5lZF9ldmVudHMnKTsKCnZhciB0b2RheWRhdGUgPSBuZXcgRGF0ZSgpOwp2YXIgaG93bWFueWRheXNhaGVhZD0zMDsKdmFyIHN0YXJ0ZGF0ZT10b2RheWRhdGUuZ2V0RnVsbFllYXIoKSsiLSIrKDErdG9kYXlkYXRlLmdldE1vbnRoKCkpKyItIit0b2RheWRhdGUuZ2V0RGF0ZSgpOwp0b2RheWRhdGUuc2V0RGF0ZSh0b2RheWRhdGUuZ2V0RGF0ZSgpICsgaG93bWFueWRheXNhaGVhZCk7CnZhciBlbmRkYXRlPXRvZGF5ZGF0ZS5nZXRGdWxsWWVhcigpKyItIisoMSt0b2RheWRhdGUuZ2V0TW9udGgoKSkrIi0iK3RvZGF5ZGF0ZS5nZXREYXRlKCk7CgovLyBmaWx0ZXIgZm9yIHVzZXJzIHdobyBoYXZlIGRlYnQKJHNjb3BlLmhhdmVEZWJ0ID0gZnVuY3Rpb24oZXVzZXIpCnsKaWYgKGV1c2VyLnVzZXJfYmFsYW5jZSA8IDApCnsKcmV0dXJuIHRydWU7Cn0KZWxzZQp7CnJldHVybiBmYWxzZTsKfQp9OwoKJHNjb3BlLmdvdG9DbGllbnRQYWdlID0gZnVuY3Rpb24oYnVzaW5lc3NfdXNlcl9pZCkKewovLyBsb2dEZWJ1ZyhldXNlcik7CndpbmRvdy5sb2NhdGlvbi5ocmVmPScvIy9idXNpbmVzc19jbGllbnRzLycgKyBidXNpbmVzc191c2VyX2lkOwp9Cgp2YXIgcGF5bG9hZCA9ICdzdGFydD0nICsgc3RhcnRkYXRlICsgJyZlbmQ9JyArIGVuZGRhdGU7CnZhciBjb25maWcgPSB7CmhlYWRlcnM6IHsnQ29udGVudC1UeXBlJzonYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkOyBjaGFyc2V0PVVURi04J30KfQogICAgdmFyIHBvc3R1cmwgPSAiL2FwaS9hZG1pbi9yZXBvcnRzL2V2ZW50czIiOwoKICAgICRzY29wZS5ldmVudFJlcG9ydENvbmZpZyA9IHt9OwogICAgJHNjb3BlLmV2ZW50UmVwb3J0Q29uZmlnLnNvdXJjZSA9ICJkb2NzIjsKICAgICRzY29wZS5ldmVudFJlcG9ydENvbmZpZy5maWx0ZXJzID0gewogICAgICBzdGFydF9kYXRlOiBzdGFydGRhdGUsCiAgICAgIGlzX2NhbmNlbGVkOiAnMCcsCiAgICAgIGVuZF9kYXRlOiBlbmRkYXRlCiAgICB9OwoKICAgIGdldEV2ZW50c1JlcG9ydCgkaHR0cCwkc2NvcGUsICRzY29wZS5ldmVudFJlcG9ydENvbmZpZywgZ2V0RXZlbnRzUmVwb3J0QWdncmVnYXRlZF9zdWNjZXNzKTsKCiAgICBmdW5jdGlvbiBnZXRFdmVudHNSZXBvcnRBZ2dyZWdhdGVkX3N1Y2Nlc3MocmVzcG9uc2UpewogICAgICAkc2NvcGUuYWRtaW5fZXZlbnRzID0gcmVzcG9uc2UuanNvbjsKICAgICAgICB9CiAgICAvLyAkaHR0cC5wb3N0KHBvc3R1cmwsIHBheWxvYWQsIGNvbmZpZykuc3VjY2VzcyhmdW5jdGlvbihkYXRhKQogICAgLy8gewogICAgLy8gICBsb2dEZWJ1ZygiZG9uZSIpOwogICAgLy8gICAkc2NvcGUuYWRtaW5fZXZlbnRzID0gZGF0YTsKICAgIC8vIH0pOwoKJHNjb3BlLnNob3dFdmVudFBvcHVwID0gZnVuY3Rpb24oc2VsZWN0ZWRFdmVudCkgewpzaG93RXZlbnRQb3B1cChzZWxlY3RlZEV2ZW50LCAkdWliTW9kYWwpCn07CiRzY29wZS5lZGl0RXZlbnQ9IGZ1bmN0aW9uICh0aGVldmVudCkKewpnb3RvRXZlbnRQYWdlKHRoZWV2ZW50KTsKfQp9KTsKCi8vIGt1emVBcHAuY29udHJvbGxlcignQnVzaW5lc3NDb25maWdDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJHJvdXRlUGFyYW1zLCAkbG9jYXRpb24sICRyb3V0ZSwgc2hhcmVkRGF0YSkgewoKa3V6ZUFwcC5jb250cm9sbGVyKCdDb25maWdVc2VyQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHVpYk1vZGFsLCAkaHR0cCwgJHRpbWVvdXQpCnsKJHNjb3BlLmluVGhlTWlkZGxlT2ZTYXZlPWZhbHNlOwoKbG9nRGVidWcoIkNvbmZpZ1VzZXJDb250cm9sbGVyIik7Ci8vICRzY29wZS5hamF4X2luZm89IteU16nXmdeg15XXmdeZ150g16DXqdee16jXlSI7CgogIGdldEJ1c2luZXNzVXNlclJlbGF0aW9ucygkaHR0cCwkc2NvcGUsJ2J1c2luZXNzX3VzZXJfcmVsYXRpb25zJyxnZXRMb2dnZWRVc2VySW5mb19zdWNjZXNzLGdldExvZ2dlZFVzZXJJbmZvX2ZhaWx1cmUpOwoKZ2V0TG9nZ2VkVXNlckluZm8oJGh0dHAsJHNjb3BlLCd1c2VyUHJvcGVydGllcycsZ2V0TG9nZ2VkVXNlckluZm9fc3VjY2VzcyxnZXRMb2dnZWRVc2VySW5mb19mYWlsdXJlKTsKZnVuY3Rpb24gZ2V0TG9nZ2VkVXNlckluZm9fc3VjY2VzcygpCnsKbG9nRGVidWcoImdldExvZ2dlZFVzZXJJbmZvX3N1Y2Nlc3MiKTsKICAgIC8vICRzY29wZS51c2VyUHJvcGVydGllc0R1cGxpY2F0ZSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoJHNjb3BlLnVzZXJQcm9wZXJ0aWVzKSk7Cn0KZnVuY3Rpb24gZ2V0TG9nZ2VkVXNlckluZm9fZmFpbHVyZSgpCnsKbG9nRGVidWcoImdldExvZ2dlZFVzZXJJbmZvX2ZhaWx1cmUiKTsKfQoKJHNjb3BlLmJhY2sgPSBmdW5jdGlvbigpIHsKd2luZG93Lmhpc3RvcnkuYmFjaygpOwp9OwoKJHNjb3BlLmNoYW5nZVBhc3N3b3JkTW9kYWwgPSBmdW5jdGlvbigpCnsKICAgIGxvZ0RlYnVnKCJjaGFuZ2VQYXNzd29yZE1vZGFsIiskc2NvcGUudXNlclByb3BlcnRpZXNEdXBsaWNhdGVbMF0pOwokc2NvcGUuaW5UaGVNaWRkbGVPZlNhdmU9dHJ1ZTsKZnVuY3Rpb24gc21zUmVzZXRQYXNzd29yZF9zdWNjZXNzKCkKewpjb25zb2xlLmxvZygic21zUmVzZXRQYXNzd29yZF9zdWNjZXNzIik7CnZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewphbmltYXRpb246IGZhbHNlLAp0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdtb2RhbF9jaGFuZ2VfcGFzc3dvcmQucGhwJywKY29udHJvbGxlcjogJ21vZGFsX2NoYW5nZV9wYXNzd29yZCcsCnNpemU6ICdsJywKcmVzb2x2ZTogewp1c2VyX3Bob25lX251bWJlcjogZnVuY3Rpb24oKSB7Ci8vIHBhc3Npbmcgb3JpZ2luYWwgcGhvbmUgbnVtYmVyCnJldHVybiAkc2NvcGUudXNlclByb3BlcnRpZXNEdXBsaWNhdGVbMF0ucGhvbmVfbnVtYmVyOwp9Cn0KfSk7Cgptb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHJlc3VsdCkgewokc2NvcGUuaW5UaGVNaWRkbGVPZlNhdmU9ZmFsc2U7CmxvZ0RlYnVnKCdzbXNSZXNldFBhc3N3b3JkIE1vZGFsIGZpbmlzZWhkIHJlc3VsdDogJyArIHJlc3VsdCk7CiRzY29wZS5hamF4X2luZm89IteU16HXmdeh157XkCDXoteV15PXm9eg15Qg15HXlNem15zXl9eUISI7Ci8vIGdldExvZ2dlZFVzZXJJbmZvKCRodHRwLCRzY29wZSwndXNlclByb3BlcnRpZXMnLGdldExvZ2dlZFVzZXJJbmZvX3N1Y2Nlc3MsZ2V0TG9nZ2VkVXNlckluZm9fZmFpbHVyZSk7CiR0aW1lb3V0KGZ1bmN0aW9uKCkKewokc2NvcGUuYWpheF9pbmZvPW51bGw7Cn0sIDIwMDApOwpsb2dEZWJ1Zygnc21zUmVzZXRQYXNzd29yZCBNb2RhbCBkaXNtaXNzZWQgYXQ6ICcgKyBuZXcgRGF0ZSgpKTsKfSwgZnVuY3Rpb24oKSB7CiRzY29wZS5pblRoZU1pZGRsZU9mU2F2ZT1mYWxzZTsKbG9nRGVidWcoJ21vZGFsX2NoYW5nZV9wYXNzd29yZCBNb2RhbCBkaXNtaXNzZWQgYXQ6ICcgKyBuZXcgRGF0ZSgpKTsKfSk7Cn0KCgpjaGFuZ2VQYXNzd29yZFNNUygkaHR0cCwkc2NvcGUsJHNjb3BlLnVzZXJQcm9wZXJ0aWVzRHVwbGljYXRlWzBdLnBob25lX251bWJlcixzbXNSZXNldFBhc3N3b3JkX3N1Y2Nlc3MpOwp9CiRzY29wZS51cGRhdGVVc2VyQ29uZmlnPWZ1bmN0aW9uKCkKewokc2NvcGUuaW5UaGVNaWRkbGVPZlNhdmU9dHJ1ZTsKbG9nRGVidWcoInVwZGF0ZVVzZXJDb25maWcsIGluVGhlTWlkZGxlT2ZTYXZlPSIrJHNjb3BlLmluVGhlTWlkZGxlT2ZTYXZlKTsKLy8gbG9nRGVidWcoJHNjb3BlLnVzZXJQcm9wZXJ0aWVzRHVwbGljYXRlKTsKLy8gbG9nRGVidWcoJHNjb3BlLnVzZXJQcm9wZXJ0aWVzKTsKaWYgKGFuZ3VsYXIuZXF1YWxzKCRzY29wZS51c2VyUHJvcGVydGllc0R1cGxpY2F0ZVswXS5waG9uZV9udW1iZXIsJHNjb3BlLnVzZXJQcm9wZXJ0aWVzWzBdLnBob25lX251bWJlcikpCnsKbG9nRGVidWcoIm5vdGhpbmcgY2hhbmdlZCBpbiBwaG9uZSBudW1iZXIsIGNoZWNraW5nIG90aGVyIGRhdGEgb3RoZXIgZGF0YSIpOwppZiAoYW5ndWxhci5lcXVhbHMoJHNjb3BlLnVzZXJQcm9wZXJ0aWVzRHVwbGljYXRlWzBdLCRzY29wZS51c2VyUHJvcGVydGllc1swXSkpCnsKJHNjb3BlLmluVGhlTWlkZGxlT2ZTYXZlPWZhbHNlOwpsb2dEZWJ1Zygibm90aGluZyBjaGFuZ2VkIGluIGRldGFpbHMsIG5vdGhpbmcgdG8gc2F2ZSIpOwokc2NvcGUuYWpheF9pbmZvPSLXnNeQINeR15XXptei15Ug16nXmdeg15XXmdeZ150g15zXqdee15nXqNeULi4uIjsKJHRpbWVvdXQoZnVuY3Rpb24oKQp7CiRzY29wZS5hamF4X2luZm89bnVsbDsKfSwgMTUwMCk7Cn0KZWxzZQp7CmNoYW5nZVVzZXJEZXRhaWxzKCRodHRwLCRzY29wZSwkc2NvcGUudXNlclByb3BlcnRpZXNbMF0uZmlyc3RfbmFtZSwkc2NvcGUudXNlclByb3BlcnRpZXNbMF0ubGFzdF9uYW1lLCAkc2NvcGUudXNlclByb3BlcnRpZXNbMF0uZW1haWxfYWRkcmVzcyxjaGFuZ2VVc2VyRGV0YWlsc19zdWNjZXNzLCBjaGFuZ2VVc2VyRGV0YWlsc19mYWlsdXJlKTsKJHNjb3BlLmFqYXhfaW5mbz0i157XoteT15vXnyDXqdeZ16DXldeZ15nXnS4uLiI7Cn0KCmZ1bmN0aW9uIGNoYW5nZVVzZXJEZXRhaWxzX3N1Y2Nlc3MoKQp7CmxvZ0RlYnVnKCJjaGFuZ2VVc2VyRGV0YWlsc19zdWNjZXNzIik7CiRzY29wZS5hamF4X2luZm89IteU16nXmdeg15XXmdeZ150g16DXqdee16jXlSDXkdeU16bXnNeX15QhIjsKJHNjb3BlLmluVGhlTWlkZGxlT2ZTYXZlPWZhbHNlOwokdGltZW91dChmdW5jdGlvbigpCnsKJHNjb3BlLmFqYXhfaW5mbz1udWxsOwp9LCAxNTAwKTsKZ2V0TG9nZ2VkVXNlckluZm8oJGh0dHAsJHNjb3BlLCd1c2VyUHJvcGVydGllcycsZ2V0TG9nZ2VkVXNlckluZm9fc3VjY2VzcyxnZXRMb2dnZWRVc2VySW5mb19mYWlsdXJlKTsKfQpmdW5jdGlvbiBjaGFuZ2VVc2VyRGV0YWlsc19mYWlsdXJlKCkKewpsb2dEZWJ1ZygiY2hhbmdlVXNlckRldGFpbHNfZmFpbHVyZSIpOwp9Cgp9CmVsc2UKewovLyB1cGRhdGUgdXNlciBpbmZvIC0gYWZ0ZXIgdmVyaWZ5aW5nIHBhc3N3b3JkCmNvbnNvbGUubG9nKCJwaG9uZSBjaGFuZ2VkLCBjaGVja2luZyBpZiBuZXcgcGhvbmUgaXMgaW4gZGVzY2VudCBmb3JtYXQiKTsKaWYgKCFjaGVja1Bob25lTnVtYmVyKCRzY29wZS51c2VyUHJvcGVydGllc1swXS5waG9uZV9udW1iZXIpKQp7CiRzY29wZS5hamF4X2luZm89IteQ16DXkCDXlNeW158g157Xodek16gg15jXnNek15XXnyDXodec15XXnNeo15kg16rXp9eZ158g15zXp9eR15zXqiDXlNeV15PXoteV16og157Xp9eZ15XXli4iOwokdGltZW91dChmdW5jdGlvbigpCnsKJHNjb3BlLmFqYXhfaW5mbz1udWxsOwp9LCAzMDAwKTsKcmV0dXJuOwp9CmNvbnNvbGUubG9nKCJwaG9uZSBjaGFuZ2VkLCBjaGVja2luZyBpZiBuZXcgcGhvbmUgaXMgbm90IHVzZWQgYWxyZWFkeSIpOwppc05ld1Bob25lVXNlZElmTm90U2VuZFNNUygkaHR0cCwkc2NvcGUsJHNjb3BlLnVzZXJQcm9wZXJ0aWVzWzBdLnBob25lX251bWJlciwgaXNOZXdQaG9uZVVzZWRfc3VjY2VzcywgaXNOZXdQaG9uZVVzZWRfZmFpbHVyZSxmYWxzZSk7CmZ1bmN0aW9uIGlzTmV3UGhvbmVVc2VkX3N1Y2Nlc3MocmVzcG9uc2UpCnsKY29uc29sZS5sb2coInBob25lIG5vdCB1c2VkIC0gcHJvbXB0aW5nIGZvciBwYXNzd29yZCIpOwp2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKYW5pbWF0aW9uOiBmYWxzZSwKdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnbW9kYWxfY2hlY2tfcGFzc3dvcmRfdXBkYXRlX2NvbmZpZy5waHAnLApjb250cm9sbGVyOiAnbW9kYWxfY2hlY2tfcGFzc3dvcmRfdXBkYXRlX2NvbmZpZycsCnNpemU6ICdsJywKcmVzb2x2ZTogewpuZXdfdXNlcl9wcm9lcnRpZXM6IGZ1bmN0aW9uKCkgewpyZXR1cm4gJHNjb3BlLnVzZXJQcm9wZXJ0aWVzWzBdOwp9Cn0KfSk7Cgptb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHJlc3VsdCkgewpsb2dEZWJ1ZygnbW9kYWxfY2hlY2tfcGFzc3dvcmRfdXBkYXRlX2NvbmZpZyBNb2RhbCBmaW5pc2hlZCByZXN1bHQ6ICcgKyByZXN1bHQpOwokc2NvcGUuYWpheF9pbmZvPSLXlNep15nXoNeV15nXmdedINeg16nXnteo15Ug15HXlNem15zXl9eUISI7CiRzY29wZS5pblRoZU1pZGRsZU9mU2F2ZT1mYWxzZTsKZ2V0TG9nZ2VkVXNlckluZm8oJGh0dHAsJHNjb3BlLCd1c2VyUHJvcGVydGllcycsZ2V0TG9nZ2VkVXNlckluZm9fc3VjY2VzcyxnZXRMb2dnZWRVc2VySW5mb19mYWlsdXJlKTsKJHRpbWVvdXQoZnVuY3Rpb24oKQp7CiRzY29wZS5hamF4X2luZm89bnVsbDsKfSwgMzAwMCk7Cn0sIGZ1bmN0aW9uKCkgewokc2NvcGUuaW5UaGVNaWRkbGVPZlNhdmU9ZmFsc2U7CmxvZ0RlYnVnKCdtb2RhbF9jaGVja19wYXNzd29yZF91cGRhdGVfY29uZmlnIE1vZGFsIGRpc21pc3NlZCBhdDogJyArIG5ldyBEYXRlKCkpOwp9KTsKfQoKZnVuY3Rpb24gaXNOZXdQaG9uZVVzZWRfZmFpbHVyZShyZXNwb25zZSkKewokc2NvcGUuYWpheF9pbmZvPXJlc3BvbnNlLm1lc3NhZ2U7CiR0aW1lb3V0KGZ1bmN0aW9uKCkKewokc2NvcGUuYWpheF9pbmZvPW51bGw7Cn0sIDIwMDApOwp9Cn0KfTsKfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdtb2RhbF9jaGVja19wYXNzd29yZF91cGRhdGVfY29uZmlnJywgZnVuY3Rpb24oJHNjb3BlLCAkdGltZW91dCwgJHVpYk1vZGFsSW5zdGFuY2UsIG5ld191c2VyX3Byb2VydGllcywgJGh0dHApCnsKJHNjb3BlLm5ld191c2VyX3Byb2VydGllcz1uZXdfdXNlcl9wcm9lcnRpZXM7CmxvZ0RlYnVnKCJtb2RhbF9jaGVja19wYXNzd29yZF91cGRhdGVfY29uZmlnIGNvbnRyb2xsZXIiKTsKLy8gJHNjb3BlLnBob25lX3ZlcmlmaWNhdGlvbiA9IHt9OyAvLyB0aGVzZSBhcmUgdGhlIGNvbXBsZXRlIGRldGFpbHMgZm9yIHRoZSBuZXcgZXZlbnQgLy8KLy8gJHNjb3BlLnBob25lX3ZlcmlmaWNhdGlvbi5waG9uZV9udW1iZXI9bmV3X3VzZXJfcHJvZXJ0aWVzLnBob25lX251bWJlcjsKJHNjb3BlLmNsb3NlID0gZnVuY3Rpb24oKSB7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCdkaXNtaXNzJyk7Cn07Cgokc2NvcGUuY2hhbmdlUGhvbmVOdW1iZXIgPSBmdW5jdGlvbigpCnsKY2hhbmdlVXNlckRldGFpbHNWZXJpZnkoJGh0dHAsJHNjb3BlLCRzY29wZS5uZXdfdXNlcl9wcm9lcnRpZXMucGhvbmVfbnVtYmVyLCRzY29wZS5uZXdfdXNlcl9wcm9lcnRpZXMuZmlyc3RfbmFtZSwkc2NvcGUubmV3X3VzZXJfcHJvZXJ0aWVzLmxhc3RfbmFtZSwgJHNjb3BlLm5ld191c2VyX3Byb2VydGllcy5lbWFpbF9hZGRyZXNzLCRzY29wZS52ZXJpZnlfdXNlcl9wYXNzd29yZCwkc2NvcGUucGhvbmVfdmVyaWZpY2F0aW9uLGNoYW5nZVVzZXJEZXRhaWxzVmVyaWZ5X3N1Y2Nlc3MsIGNoYW5nZVVzZXJEZXRhaWxzVmVyaWZ5X2ZhaWx1cmUsZmFsc2UpOwpmdW5jdGlvbiBjaGFuZ2VVc2VyRGV0YWlsc1ZlcmlmeV9zdWNjZXNzKCkKewpsb2dEZWJ1ZygiY2hhbmdlVXNlckRldGFpbHNWZXJpZnlfc3VjY2VzcyIpOwovLyBhbGVydCgn15TXqdeZ16DXldeZ15nXnSDXoteV15PXm9eg15Ug15HXlNem15zXl9eUJyk7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKHRydWUpOwp9CmZ1bmN0aW9uIGNoYW5nZVVzZXJEZXRhaWxzVmVyaWZ5X2ZhaWx1cmUocmVzcG9uc2UpCnsKbG9nRGVidWcoImNoYW5nZVVzZXJEZXRhaWxzVmVyaWZ5X2ZhaWx1cmUgIityZXNwb25zZS5tZXNzYWdlKTsKJHNjb3BlLmFqYXhfZXJyb3I9cmVzcG9uc2UubWVzc2FnZSsiLiI7CiR0aW1lb3V0KGZ1bmN0aW9uKCkKewokc2NvcGUuYWpheF9lcnJvcj1udWxsOwp9LCA0MDAwKTsKfQp9Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignbW9kYWxfY2hhbmdlX3Bhc3N3b3JkJywgZnVuY3Rpb24oJHNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgdXNlcl9waG9uZV9udW1iZXIsICRodHRwKQp7CmxvZ0RlYnVnKCJtb2RhbF9jaGFuZ2VfcGFzc3dvcmQgY29udHJvbGxlciIpOwokc2NvcGUucGhvbmVfdmVyaWZpY2F0aW9uID0ge307IC8vIHRoZXNlIGFyZSB0aGUgY29tcGxldGUgZGV0YWlscyBmb3IgdGhlIG5ldyBldmVudCAvLwokc2NvcGUucGhvbmVfdmVyaWZpY2F0aW9uLnBob25lX251bWJlcj11c2VyX3Bob25lX251bWJlcjsKJHNjb3BlLnBob25lX3ZlcmlmaWNhdGlvbi5zbXNfZXJyb3I9IiI7CiRzY29wZS5jbG9zZSA9IGZ1bmN0aW9uKCkgewokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnZGlzbWlzcycpOwp9OwoKJHNjb3BlLmNoYW5nZVBhc3N3b3JkID0gZnVuY3Rpb24oKQp7CmNoYW5nZVBhc3N3b3JkKCRodHRwLCRzY29wZSwkc2NvcGUucGhvbmVfdmVyaWZpY2F0aW9uLnVzZXJfcGFzc3dvcmQsJHNjb3BlLnBob25lX3ZlcmlmaWNhdGlvbi51c2VyX3Bhc3N3b3JkMiwkc2NvcGUucGhvbmVfdmVyaWZpY2F0aW9uLnZlcmlmaWNhdGlvbl9jb2RlLCBjaGFuZ2VQYXNzd29yZF9zdWNjZXNzLCBjaGFuZ2VQYXNzd29yZF9mYWlsdXJlLGZhbHNlKTsKJHNjb3BlLmFqYXhfZXJyb3I9IiI7CmZ1bmN0aW9uIGNoYW5nZVBhc3N3b3JkX3N1Y2Nlc3MoKQp7CmxvZ0RlYnVnKCJjaGFuZ2VQYXNzd29yZF9zdWNjZXNzIik7CnN0YXR1cz0iZmZmZmYiOwovLyBhbGVydCgn15TXodeZ16HXnteQINei15XXk9eb16DXlCDXkdeU16bXnNeX15QnKTsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UodHJ1ZSk7Cn0KZnVuY3Rpb24gY2hhbmdlUGFzc3dvcmRfZmFpbHVyZShyZXNwb25zZSkKewpsb2dEZWJ1ZygiY2hhbmdlUGFzc3dvcmRfZmFpbHVyZSAiK3Jlc3BvbnNlLm1lc3NhZ2UpOwokc2NvcGUuYWpheF9lcnJvcj1yZXNwb25zZS5tZXNzYWdlOwp9Cn0KfSk7CgprdXplQXBwLmZhY3RvcnkoJ0J1c2luZXNzQ29uZmlnJywgZnVuY3Rpb24oJGh0dHApIHsKcmV0dXJuIHsKZ2V0OiBmdW5jdGlvbiAoKSB7CmxvZ0RlYnVnKCJsb2FkIGdldF9idXNpbmVzc19jb25maWciKTsKcmV0dXJuICRodHRwLmdldCgiL2FwaS9hZG1pbi9idXNpbmVzc19jb25maWciKQoudGhlbihmdW5jdGlvbihyZXNwb25zZSkgewpyZXN1bHQgPSByZXNwb25zZS5kYXRhWzBdOwpyZXN1bHQudXNlX2hvbGlkYXlzPSEhcGFyc2VJbnQocmVzcG9uc2UuZGF0YVswXS51c2VfaG9saWRheXMpOwpyZXN1bHQuc21zX25vdGlmaWNhdGlvbnM9ISFwYXJzZUludChyZXNwb25zZS5kYXRhWzBdLnNtc19ub3RpZmljYXRpb25zKTsKcmVzdWx0LnN0YXJ0X2ludm9pY2VfbnVtYmVyID0gcGFyc2VJbnQocmVzcG9uc2UuZGF0YVswXS5zdGFydF9pbnZvaWNlX251bWJlcik7CnZhciBkID0gbmV3IERhdGUoKTsKZC5zZXRIb3VycyggcmVzdWx0LmNhbGVuZGFyX2Rpc3BsYXlfc3RhcnRfaG91cnMgKTsKZC5zZXRNaW51dGVzKCByZXN1bHQuY2FsZW5kYXJfZGlzcGxheV9zdGFydF9taW51dGVzICk7CnJlc3VsdC5teXRpbWUgPSBkOwpyZXN1bHQuY2FsZW5kYXJfZGlzcGxheV9zdGFydCA9IGQ7CnZhciBkID0gbmV3IERhdGUoKTsKZC5zZXRIb3VycyggcmVzdWx0LmNhbGVuZGFyX2Rpc3BsYXlfZW5kX2hvdXJzICk7CmQuc2V0TWludXRlcyggcmVzdWx0LmNhbGVuZGFyX2Rpc3BsYXlfZW5kX21pbnV0ZXMgKTsKcmVzdWx0Lm15dGltZSA9IGQ7CnJlc3VsdC5jYWxlbmRhcl9kaXNwbGF5X2VuZCA9IGQ7CnJlc3VsdC52YXRfcmF0ZSA9IE51bWJlcihyZXN1bHQudmF0X3JhdGUpOwpyZXR1cm4gcmVzdWx0Owp9KTsKfQp9Owp9KTsKCmt1emVBcHAuY29udHJvbGxlcignQ29uZmlnQnVzaW5lc3NDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJHRpbWVvdXQsIEJ1c2luZXNzQ29uZmlnKQp7CmxvZ0RlYnVnKCJteSBidXNpbmVzcyBjb25maWciKTsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXM9W107CgpmdW5jdGlvbiBnZXRfYnVzaW5lc3NfY29uZmlnKCkgewpsb2dEZWJ1ZygiZ2V0X2J1c2luZXNzX2NvbmZpZyIpOwpsb2dEZWJ1ZygiQnVzaW5lc3NDb25maWc6ICIsIEJ1c2luZXNzQ29uZmlnKTsKQnVzaW5lc3NDb25maWcuZ2V0KCkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7ICRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMgPSByZXN1bHQ7IH0pOwp9CmdldF9idXNpbmVzc19jb25maWcoKTsKCgokc2NvcGUuaHN0ZXAgPSAxOwokc2NvcGUubXN0ZXAgPSAxNTsKCiRzY29wZS5idXNpbmVzc0NvbmZpZ0NhbmNlbCA9IGZ1bmN0aW9uKCkgewp3aW5kb3cuaGlzdG9yeS5iYWNrKCk7Cn07Cgokc2NvcGUudXBkYXRlQnVzaW5lc3NDb25maWcgPSBmdW5jdGlvbigpIHsKbG9nRGVidWcoInVwZGF0aW5nIGJ1c2luZXNzIGNvbmZpZyIgKyBKU09OLnN0cmluZ2lmeSgkc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzKSk7Cgokc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzX2FqYXhfZXJyb3I9IiI7CiRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMuY2FsZW5kYXJfZGlzcGxheV9zdGFydF9ob3Vycz0kc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzLmNhbGVuZGFyX2Rpc3BsYXlfc3RhcnQuZ2V0SG91cnMoKTsKJHNjb3BlLmJ1c2luZXNzUHJvcGVydGllcy5jYWxlbmRhcl9kaXNwbGF5X3N0YXJ0X21pbnV0ZXM9JHNjb3BlLmJ1c2luZXNzUHJvcGVydGllcy5jYWxlbmRhcl9kaXNwbGF5X3N0YXJ0LmdldE1pbnV0ZXMoKTsKJHNjb3BlLmJ1c2luZXNzUHJvcGVydGllcy5jYWxlbmRhcl9kaXNwbGF5X2VuZF9ob3Vycz0kc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzLmNhbGVuZGFyX2Rpc3BsYXlfZW5kLmdldEhvdXJzKCk7CiRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMuY2FsZW5kYXJfZGlzcGxheV9lbmRfbWludXRlcz0kc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzLmNhbGVuZGFyX2Rpc3BsYXlfZW5kLmdldE1pbnV0ZXMoKTsKaWYgKCRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMuY2FsZW5kYXJfZGlzcGxheV9zdGFydF9ob3Vycz4kc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzLmNhbGVuZGFyX2Rpc3BsYXlfZW5kX2hvdXJzKQp7CmFsZXJ0KCfXltee158g16HXmdeV150g15zXkCDXmdeb15XXnCDXnNeU15nXldeqINec16TXoNeZINeW157XnyDXlNeq15fXnNeUJyk7CnJldHVybjsKfQokc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzX2FqYXhfZXJyb3I9Itee16LXk9eb158g16DXqteV16DXmdedLi4uIjsKCiRodHRwKHsKbWV0aG9kOiAnUE9TVCcsCnVybDogJy9hcGkvYWRtaW4vYnVzaW5lc3NfY29uZmlnL3NldCcsCmRhdGE6ICRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMsIC8vIHBhc3MgaW4gZGF0YSBhcyBzdHJpbmdzCmhlYWRlcnM6IHsKJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uO2NoYXJzZXQ9dXRmLTgnCn0KfSkuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7Cgpsb2dEZWJ1ZyhkYXRhKTsKaWYgKCFkYXRhLnN1Y2Nlc3MpIHsKbG9nRGVidWcoImVycm9yICIgKyBkYXRhLk1lc3NhZ2UpOwokc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzX2FqYXhfZXJyb3IgPSBkYXRhLk1lc3NhZ2U7Cn0gZWxzZSB7CiRnQ2FsZW5kYXJEaXNwbGF5TWluVGltZT1kYXRhLmpzb24ubmV3U3RhcnRUaW1lOwokZ0NhbGVuZGFyRGlzcGxheU1heFRpbWU9ZGF0YS5qc29uLm5ld0VuZFRpbWU7CmNvbnNvbGUubG9nKCJ1cGRhdGVkIGdDYWxlbmRhckRpc3BsYXlNaW5UaW1lPSIrJGdDYWxlbmRhckRpc3BsYXlNaW5UaW1lKTsKY29uc29sZS5sb2coInVwZGF0ZWQgZ0NhbGVuZGFyRGlzcGxheU1heFRpbWU9IiskZ0NhbGVuZGFyRGlzcGxheU1heFRpbWUpOwokc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzX2FqYXhfZXJyb3I9Itei15XXk9eb158g15HXlNem15zXl9eUISI7CiR0aW1lb3V0KGZ1bmN0aW9uKCkKewokc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzX2FqYXhfZXJyb3I9bnVsbDsKfSwgMjAwMCk7CmdldF9idXNpbmVzc19jb25maWcoKTsKLy8gd2luZG93Lmhpc3RvcnkuYmFjaygpOwovLyAkc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzX2FqYXhfZXJyb3IgPSAi16TXqNeY15kg15TXoteh16cg16DXqdee16jXlSDXkdeU16bXnNeX15QuIjsKCn0KfSk7Cn07Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignY2xpZW50Q2FyZENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUpIHsKbG9nRGVidWcoImNsaWVudENhcmRDb250cm9sbGVyIik7CiRzY29wZS5mdXR1cmVNZWV0aW5ncyA9IFt7CmRhdGV0aW1lOiAi16jXkNep15XXnywgMjUuMS4yMDE2IiwKaG91cjogIjE0OjAwIiwKdHlwZTogIten15HXldem15QiLApwcmljZTogIjEwMCIsCmxhYmVsczogW3sKbGFiZWw6ICJzdWNjZXNzIiwKdGV4dDogItep15XXnNedIgp9LCB7CmxhYmVsOiAid2FybmluZyIsCnRleHQ6ICLXnNeQINeq15XXoteTIgp9XQp9LCB7CmRhdGV0aW1lOiAi16jXkNep15XXnywgMjUuMS4yMDE2IiwKaG91cjogIjE0OjAwIiwKdHlwZTogIten15HXldem15QiLApwcmljZTogIjEwMCIsCmxhYmVsczogW3sKbGFiZWw6ICJkYW5nZXIiLAp0ZXh0OiAi15zXkCDXqdeV15zXnSIKfSwgewpsYWJlbDogImluZm8iLAp0ZXh0OiAi16rXldei15MiCn1dCn0sIHsKZGF0ZXRpbWU6ICLXqdec15nXqdeZLCAyNS4xLjIwMTYiLApob3VyOiAiMTQ6MDAiLAp0eXBlOiAi16fXkdeV16bXlCIsCnByaWNlOiAiMTAwIiwKbGFiZWxzOiBbewpsYWJlbDogImRhbmdlciIsCnRleHQ6ICLXnNeQINep15XXnNedIgp9LCB7CmxhYmVsOiAiaW5mbyIsCnRleHQ6ICLXqteV16LXkyIKfV0KfSwgewpkYXRldGltZTogIteo15DXqdeV158sIDI1LjEuMjAxNiIsCmhvdXI6ICIxNDowMCIsCnR5cGU6ICLXp9eR15XXpteUIiwKcHJpY2U6ICIxMDAiCn0sIF0KCiRzY29wZS5oaXN0b3J5TWVldGluZ3MgPSBbewpkYXRldGltZTogIteo15DXqdeV158sIDI1LjEuMjAxNiIsCmhvdXI6ICIxNDowMCIsCnR5cGU6ICLXp9eR15XXpteUIiwKcHJpY2U6ICIxMDAiCn0sIHsKZGF0ZXRpbWU6ICLXqNeQ16nXldefLCAyNS4xLjIwMTYiLApob3VyOiAiMTQ6MDAiLAp0eXBlOiAi16fXkdeV16bXlCIsCnByaWNlOiAiMTAwIgp9LCB7CmRhdGV0aW1lOiAi16nXnNeZ16nXmSwgMjUuMS4yMDE2IiwKaG91cjogIjE0OjAwIiwKdHlwZTogIten15HXldem15QiLApwcmljZTogIjEwMCIKfSwgewpkYXRldGltZTogIteo15DXqdeV158sIDI1LjEuMjAxNiIsCmhvdXI6ICIxNDowMCIsCnR5cGU6ICLXp9eR15XXpteUIiwKcHJpY2U6ICIxMDAiCn0sIF0KCiRzY29wZS5jY1BheW1lbnRzID0gW3sKZGF0ZXRpbWU6ICLXqNeQ16nXldefLCAyNS4xLjIwMTYiLApyZWNpcHRfbnVtOiAiNzY3IiwKYW1vdW50OiAiMzAwIiwKbGFiZWxzOiBbewpsYWJlbDogImRhbmdlciIsCnRleHQ6ICLXnNeQINep15XXmdeZ15oiCn0sIHsKbGFiZWw6ICJpbmZvIiwKdGV4dDogIteU15XXpNen15MiCn1dCn0sIF0KCgp9KTsKCmt1emVBcHAuY29udHJvbGxlcigna3V6ZUNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkbG9jYXRpb24pIHsKCi8vIG1haW4ga3V6ZSBjb250cm9sbGVyCgovLyBNVVNUIFNFVCBMQU5HVUFHRSBCRUZPUkUgQU5ZIE9USEVSIE9QRVJBVElPTiAhISEKdXBkYXRlR2xvYmFsTGFuZ3VhZ2UoJHNjb3BlLCAkZ0RlZmF1bHRMYW5nKTsKLy8gTVVTVCBTRVQgTEFOR1VBR0UgQkVGT1JFIEFOWSBPVEhFUiBPUEVSQVRJT04gISEhCgovLyBsb2dEZWJ1ZygieHh4eHh4eHgiICsgJHNjb3BlLmxhbmdmaWxlWydzaG93X2FsbF9jbGllbnRzJ10pOwoKJHNjb3BlLnNob3dDbGllbnRzQ29sdW1ucyA9IFt7CmZpZWxkOiAndXNlcl9pZCcsCm5hbWU6ICRzY29wZS5sYW5nZmlsZVsnc2hvd19hbGxfY2xpZW50c191c2VyaWQnXQp9LCB7CmZpZWxkOiAnYnVzZXJfZmlyc3RfbmFtZScsCm5hbWU6ICRzY29wZS5sYW5nZmlsZVsnc2hvd19hbGxfY2xpZW50c19maXJzdF9uYW1lJ10KfSwgewpmaWVsZDogJ2J1c2VyX2xhc3RfbmFtZScsCm5hbWU6ICRzY29wZS5sYW5nZmlsZVsnc2hvd19hbGxfY2xpZW50c19sYXN0X25hbWUnXQp9LCB7CmZpZWxkOiAncm9sZV9uYW1lJywKbmFtZTogJHNjb3BlLmxhbmdmaWxlWydzaG93X2FsbF9jbGllbnRzX2FwcHJvdmVkJ10KfV07CgoKJHNjb3BlLmdyaWRDbGllbnRDbGljayA9IGZ1bmN0aW9uKHJvdykgewovL2xvZ0RlYnVnKHJvdyk7CnZhciByb3dfdXNlcmlkID0gcm93LmVudGl0eS51c2VyX2lkOwpsb2dEZWJ1Zygic2VsZWN0ZWQgcm93IHVzZXJfaWQgPSIgKyByb3dfdXNlcmlkKTsKJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jbGllbnRzLycgKyByb3dfdXNlcmlkKTsKfTsKCiRzY29wZS5zaG93Q2xpZW50c0dyaWRPcHRpb25zID0gewplbmFibGVGaWx0ZXJpbmc6IGZhbHNlLAplbmFibGVTb3J0aW5nOiB0cnVlLApjb2x1bW5EZWZzOiAkc2NvcGUuc2hvd0NsaWVudHNDb2x1bW5zLApyb3dUZW1wbGF0ZTogJy9wdWJsaWMvY29tcG9uZW50cy9jbGllbnRzLWdyaWQtcm93Lmh0bWwnLApvblJlZ2lzdGVyQXBpOiBmdW5jdGlvbihncmlkQXBpKSB7CiRzY29wZS5ncmlkQXBpID0gZ3JpZEFwaTsKJHNjb3BlLmdyaWRBcGkuZ3JpZC5yZWdpc3RlclJvd3NQcm9jZXNzb3IoJHNjb3BlLnNpbmdsZUZpbHRlciwgMjAwKTsKfSwKfTsKCiRzY29wZS5pc0FjdGl2ZSA9IGZ1bmN0aW9uKHZpZXdMb2NhdGlvbikgewpsb2dEZWJ1Zygidmlld0xvY2F0aW9uID0gIiArIHZpZXdMb2NhdGlvbik7CnZhciBhY3RpdmUgPSAodmlld0xvY2F0aW9uID09PSAkbG9jYXRpb24ucGF0aCgpKTsKcmV0dXJuIGFjdGl2ZTsKfTsKCiRzY29wZS5maWx0ZXIgPSBmdW5jdGlvbigpIHsKbG9nRGVidWcoInNpbmdsZSBmaWx0ZXIiKTsKJHNjb3BlLmdyaWRBcGkuZ3JpZC5yZWZyZXNoKCk7CmlmICgkc2NvcGUuZmlsdGVyLlZhbHVlICE9ICIiKSB7CiRzY29wZS5maWx0ZXIuYnV0dG9uVmFsdWUgPSAiJyIgKyAkc2NvcGUuZmlsdGVyLlZhbHVlICsgIiciOwp9IGVsc2Ugewokc2NvcGUuZmlsdGVyLmJ1dHRvblZhbHVlID0gIiI7Cn0KfTsKCiRzY29wZS5zaW5nbGVGaWx0ZXIgPSBmdW5jdGlvbihyZW5kZXJhYmxlUm93cykgewp2YXIgbWF0Y2hlciA9IG5ldyBSZWdFeHAoJHNjb3BlLmZpbHRlci5WYWx1ZSk7CmxvZ0RlYnVnKCJzY29wZT0iICsgJHNjb3BlKTsKbG9nRGVidWcoInNjb3BlLmZpbHRlci5WYWx1ZT0iICsgJHNjb3BlLmZpbHRlci5WYWx1ZSk7CmlmICgoJHNjb3BlLmZpbHRlci5WYWx1ZSA9PSBudWxsKSB8fCAoJHNjb3BlLmZpbHRlci5WYWx1ZSA9PSAiIikpIHsKbG9nRGVidWcoImVtcHR5IGZpbHRlciIpOwpyZXR1cm4gcmVuZGVyYWJsZVJvd3M7Cn0KcmVuZGVyYWJsZVJvd3MuZm9yRWFjaChmdW5jdGlvbihyb3cpIHsKLy8JCQlsb2dEZWJ1Zygicm93PSIrcm93KTsKcm93LnZpc2libGUgPSBmYWxzZTsKdmFyICRjdXJyRmlyc3ROYW1lID0gcm93LmVudGl0eVsnZmlyc3RfbmFtZSddOwp2YXIgJGN1cnJMYXN0TmFtZSA9IHJvdy5lbnRpdHlbJ2xhc3RfbmFtZSddOwpsb2dEZWJ1ZygiY3VyckZpcnN0TmFtZT0iICsgJGN1cnJGaXJzdE5hbWUpOwoKaWYgKCRjdXJyRmlyc3ROYW1lICE9IG51bGwpIHsKaWYgKCRjdXJyRmlyc3ROYW1lLmluZGV4T2YoJHNjb3BlLmZpbHRlci5WYWx1ZSkgPiAtMSkgewpyb3cudmlzaWJsZSA9IHRydWU7Cn0KfSBlbHNlIC8vIHJvdyBpcyBudWxsCnsKcm93LnZpc2libGUgPSBmYWxzZTsKfQoKaWYgKCRjdXJyTGFzdE5hbWUgIT0gbnVsbCkgewppZiAoJGN1cnJMYXN0TmFtZS5pbmRleE9mKCRzY29wZS5maWx0ZXIuVmFsdWUpID4gLTEpIHsKcm93LnZpc2libGUgPSB0cnVlOwp9Cn0gZWxzZSAvLyByb3cgaXMgbnVsbAp7CnJvdy52aXNpYmxlID0gZmFsc2U7Cn0KfSk7CnJldHVybiByZW5kZXJhYmxlUm93czsKfTsKCi8vIGltcG9ydGFudCEhIGluaXRpYWxpemluZyBhbmd1bGFyIGZvcm1zIGFzIGFycmF5cwokc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIgPSB7fTsKJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyID0ge307CgovLyBsb2dEZWJ1ZygibG9jYXRpb249IiArICRsb2NhdGlvbik7Ci8vIGxvZ0RlYnVnKCRsb2NhdGlvbik7Cgokc2NvcGUuY2hhbmdlTGFuZyA9IGZ1bmN0aW9uKCRuZXdsYW5nKSB7CmxvZ0RlYnVnKCRuZXdsYW5nKTsKLy8kc2NvcGUuc3BDbGFzcyA9ICdyaWdodCc7CnVwZGF0ZUdsb2JhbExhbmd1YWdlKCRzY29wZSwgJG5ld2xhbmcpCn0KCiRzY29wZS5hZGROZXdDbGllbnQgPSBmdW5jdGlvbigpIHsKJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jbGllbnRzL2FkZCcpOwp9CiRzY29wZS5hZGROZXdJbnN0cnVjdG9yID0gZnVuY3Rpb24oKSB7CiRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfaW5zdHJ1Y3RvcnMvYWRkJyk7Cn0KfSk7CgovLy8vLy8gYmVmb3JlIGZvcm1zCmt1emVBcHAuY29udHJvbGxlcignRGVtb0NvbnRyb2xsZXInLCBbCickc2NvcGUnLCAnJGJ1aWxkZXInLCAnJHZhbGlkYXRvcicsCmZ1bmN0aW9uKCRzY29wZSwgJGJ1aWxkZXIsICR2YWxpZGF0b3IpIHsKdmFyIGNoZWNrYm94LCB0ZXh0Ym94Owp0ZXh0Ym94ID0gJGJ1aWxkZXIuYWRkRm9ybU9iamVjdCgnZGVmYXVsdCcsIHsKaWQ6ICd0ZXh0Ym94JywKY29tcG9uZW50OiAndGV4dElucHV0JywKbGFiZWw6ICdOYW1lJywKZGVzY3JpcHRpb246ICdZb3VyIG5hbWUnLApwbGFjZWhvbGRlcjogJ1lvdXIgbmFtZScsCnJlcXVpcmVkOiB0cnVlLAplZGl0YWJsZTogZmFsc2UKfSk7CmNoZWNrYm94ID0gJGJ1aWxkZXIuYWRkRm9ybU9iamVjdCgnZGVmYXVsdCcsIHsKaWQ6ICdjaGVja2JveCcsCmNvbXBvbmVudDogJ2NoZWNrYm94JywKbGFiZWw6ICdQZXRzJywKZGVzY3JpcHRpb246ICdEbyB5b3UgaGF2ZSBhbnkgcGV0cz8nLApvcHRpb25zOiBbJ0RvZycsICdDYXQnXQp9KTsKJGJ1aWxkZXIuYWRkRm9ybU9iamVjdCgnZGVmYXVsdCcsIHsKY29tcG9uZW50OiAnc2FtcGxlSW5wdXQnCn0pOwokc2NvcGUuZm9ybSA9ICRidWlsZGVyLmZvcm1zWydkZWZhdWx0J107CiRzY29wZS5pbnB1dCA9IFtdOwokc2NvcGUuZGVmYXVsdFZhbHVlID0ge307CiRzY29wZS5kZWZhdWx0VmFsdWVbdGV4dGJveC5pZF0gPSAnZGVmYXVsdCB2YWx1ZSc7CiRzY29wZS5kZWZhdWx0VmFsdWVbY2hlY2tib3guaWRdID0gW3RydWUsIHRydWVdOwpyZXR1cm4gJHNjb3BlLnN1Ym1pdCA9IGZ1bmN0aW9uKCkgewpyZXR1cm4gJHZhbGlkYXRvci52YWxpZGF0ZSgkc2NvcGUsICdkZWZhdWx0Jykuc3VjY2VzcyhmdW5jdGlvbigpIHsKcmV0dXJuIGxvZ0RlYnVnKCdzdWNjZXNzJyk7Cn0pLmVycm9yKGZ1bmN0aW9uKCkgewpyZXR1cm4gbG9nRGVidWcoJ2Vycm9yJyk7Cn0pOwp9Owp9Cl0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdBbGVydERlbW9DdHJsJywgZnVuY3Rpb24oJHNjb3BlKSB7CiRzY29wZS5hbGVydHMgPSBbewp0eXBlOiAnZGFuZ2VyJywKbXNnOiAnT2ggc25hcCEgQ2hhbmdlIGEgZmV3IHRoaW5ncyB1cCBhbmQgdHJ5IHN1Ym1pdHRpbmcgYWdhaW4uJwp9LCB7CnR5cGU6ICdzdWNjZXNzJywKbXNnOiAnV2VsbCBkb25lISBZb3Ugc3VjY2Vzc2Z1bGx5IHJlYWQgdGhpcyBpbXBvcnRhbnQgYWxlcnQgbWVzc2FnZS4nCn1dOwoKJHNjb3BlLmFkZEFsZXJ0ID0gZnVuY3Rpb24oKSB7CiRzY29wZS5hbGVydHMucHVzaCh7Cm1zZzogJ0Fub3RoZXIgYWxlcnQhJwp9KTsKfTsKCiRzY29wZS5jbG9zZUFsZXJ0ID0gZnVuY3Rpb24oaW5kZXgpIHsKJHNjb3BlLmFsZXJ0cy5zcGxpY2UoaW5kZXgsIDEpOwp9Owp9KTsKCgpmdW5jdGlvbiBpc051bWJlcktleShldnQpewp2YXIgY2hhckNvZGUgPSAoZXZ0LndoaWNoKSA/IGV2dC53aGljaCA6IGV2ZW50LmtleUNvZGU7CnJldHVybiAhKGNoYXJDb2RlID4gMzEgJiYgKGNoYXJDb2RlIDwgNDggfHwgY2hhckNvZGUgPiA1NykpOwp9Cg==</text>
      </register>
      <register name="1" type="2">
        <text encoding="base64">Ly8gdjExIC0gMjMgbWFyY2ggMjAxNwovL0RlZmluZSBhbiBhbmd1bGFyIG1vZHVsZSBmb3Igb3VyIGFwcAoKdmFyIGt1emVJc0NhbGVuZGFyRHJhZ2dibGU7Cmt1emVJc0NhbGVuZGFyRHJhZ2dibGUgPSB0cnVlOwoKLy8gYW5ndWxhciBtb2R1bGVzCi8vJGFuZ3VsYXJNb2R1bGVzPVsnbmdSb3V0ZScsJ3VpLmJvb3RzdHJhcCcsJ3VpLmdyaWQnXTsKJGFuZ3VsYXJNb2R1bGVzID0gWyduZ1JvdXRlJywgJ3VpLmJvb3RzdHJhcCcsICd1aS5ncmlkJywgJ2J1aWxkZXInLCAnYnVpbGRlci5jb21wb25lbnRzJywgJ3ZhbGlkYXRvci5ydWxlcycsICd1aS5jYWxlbmRhcicsICdjaGVja2xpc3QtbW9kZWwnLCAndWkuYm9vdHN0cmFwLmRhdGV0aW1lcGlja2VyJywgJ2FuZ3Vjb21wbGV0ZS1hbHQnLCAnbXVsdGlwbGVTZWxlY3QnLCdhbmd1bGFySW5saW5lRWRpdCcsJ3RleHRBbmd1bGFyJywnbmdDc3YnXTsKCnZhciBkYXlOYW1lcyA9IFsn16jXkNep15XXnycsICfXqdeg15knLCAn16nXnNeZ16nXmScsICfXqNeR15nXoteZJywgJ9eX157Xmdep15knLCAn16nXmdep15knLCAn16nXkdeqJ107CnZhciBtb250aE5hbWVzID0gWyLXmdeg15XXkNeoIiwgItek15HXqNeV15DXqCIsICLXnteo16UiLCAi15DXpNeo15nXnCIsICLXnteQ15kiLCAi15nXldeg15kiLAogICAgIteZ15XXnNeZIiwgIteQ15XXkteV16HXmCIsICLXodek15jXnteR16giLCAi15DXlden15jXldeR16giLCAi16DXldeR157XkdeoIiwgIteT16bXnteR16giCl07Cgp2YXIgbG9naW5OZXh0U2NyZWVuPSIiOwoKKGZ1bmN0aW9uKCl7RGF0ZS5zaG9ydE1vbnRocz1bIkphbiIsIkZlYiIsIk1hciIsIkFwciIsIk1heSIsIkp1biIsIkp1bCIsIkF1ZyIsIlNlcCIsIk9jdCIsIk5vdiIsIkRlYyJdLERhdGUubG9uZ01vbnRocz1bIkphbnVhcnkiLCJGZWJydWFyeSIsIk1hcmNoIiwiQXByaWwiLCJNYXkiLCJKdW5lIiwiSnVseSIsIkF1Z3VzdCIsIlNlcHRlbWJlciIsIk9jdG9iZXIiLCJOb3ZlbWJlciIsIkRlY2VtYmVyIl0sRGF0ZS5zaG9ydERheXM9WyJTdW4iLCJNb24iLCJUdWUiLCJXZWQiLCJUaHUiLCJGcmkiLCJTYXQiXSxEYXRlLmxvbmdEYXlzPVsiU3VuZGF5IiwiTW9uZGF5IiwiVHVlc2RheSIsIldlZG5lc2RheSIsIlRodXJzZGF5IiwiRnJpZGF5IiwiU2F0dXJkYXkiXTt2YXIgdD17ZDpmdW5jdGlvbigpe3JldHVybih0aGlzLmdldERhdGUoKTwxMD8iMCI6IiIpK3RoaXMuZ2V0RGF0ZSgpfSxEOmZ1bmN0aW9uKCl7cmV0dXJuIERhdGUuc2hvcnREYXlzW3RoaXMuZ2V0RGF5KCldfSxqOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZ2V0RGF0ZSgpfSxsOmZ1bmN0aW9uKCl7cmV0dXJuIERhdGUubG9uZ0RheXNbdGhpcy5nZXREYXkoKV19LE46ZnVuY3Rpb24oKXtyZXR1cm4gMD09dGhpcy5nZXREYXkoKT83OnRoaXMuZ2V0RGF5KCl9LFM6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5nZXREYXRlKCklMTA9PTEmJjExIT10aGlzLmdldERhdGUoKT8ic3QiOnRoaXMuZ2V0RGF0ZSgpJTEwPT0yJiYxMiE9dGhpcy5nZXREYXRlKCk/Im5kIjp0aGlzLmdldERhdGUoKSUxMD09MyYmMTMhPXRoaXMuZ2V0RGF0ZSgpPyJyZCI6InRoIn0sdzpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldERheSgpfSx6OmZ1bmN0aW9uKCl7dmFyIHQ9bmV3IERhdGUodGhpcy5nZXRGdWxsWWVhcigpLDAsMSk7cmV0dXJuIE1hdGguY2VpbCgodGhpcy10KS84NjRlNSl9LFc6ZnVuY3Rpb24oKXt2YXIgdD1uZXcgRGF0ZSh0aGlzLnZhbHVlT2YoKSksZT0odGhpcy5nZXREYXkoKSs2KSU3O3Quc2V0RGF0ZSh0LmdldERhdGUoKS1lKzMpO3ZhciBuPXQudmFsdWVPZigpO3JldHVybiB0LnNldE1vbnRoKDAsMSksNCE9PXQuZ2V0RGF5KCkmJnQuc2V0TW9udGgoMCwxKyg0LXQuZ2V0RGF5KCkrNyklNyksMStNYXRoLmNlaWwoKG4tdCkvNjA0OGU1KX0sRjpmdW5jdGlvbigpe3JldHVybiBEYXRlLmxvbmdNb250aHNbdGhpcy5nZXRNb250aCgpXX0sbTpmdW5jdGlvbigpe3JldHVybih0aGlzLmdldE1vbnRoKCk8OT8iMCI6IiIpKyh0aGlzLmdldE1vbnRoKCkrMSl9LE06ZnVuY3Rpb24oKXtyZXR1cm4gRGF0ZS5zaG9ydE1vbnRoc1t0aGlzLmdldE1vbnRoKCldfSxuOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZ2V0TW9udGgoKSsxfSx0OmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5nZXRGdWxsWWVhcigpLGU9dGhpcy5nZXRNb250aCgpKzE7cmV0dXJuIDEyPT09ZSYmKHQ9dCsrLGU9MCksbmV3IERhdGUodCxlLDApLmdldERhdGUoKX0sTDpmdW5jdGlvbigpe3ZhciB0PXRoaXMuZ2V0RnVsbFllYXIoKTtyZXR1cm4gdCU0MDA9PTB8fHQlMTAwIT0wJiZ0JTQ9PTB9LG86ZnVuY3Rpb24oKXt2YXIgdD1uZXcgRGF0ZSh0aGlzLnZhbHVlT2YoKSk7cmV0dXJuIHQuc2V0RGF0ZSh0LmdldERhdGUoKS0odGhpcy5nZXREYXkoKSs2KSU3KzMpLHQuZ2V0RnVsbFllYXIoKX0sWTpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldEZ1bGxZZWFyKCl9LHk6ZnVuY3Rpb24oKXtyZXR1cm4oIiIrdGhpcy5nZXRGdWxsWWVhcigpKS5zdWJzdHIoMil9LGE6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5nZXRIb3VycygpPDEyPyJhbSI6InBtIn0sQTpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldEhvdXJzKCk8MTI/IkFNIjoiUE0ifSxCOmZ1bmN0aW9uKCl7cmV0dXJuIE1hdGguZmxvb3IoMWUzKigodGhpcy5nZXRVVENIb3VycygpKzEpJTI0K3RoaXMuZ2V0VVRDTWludXRlcygpLzYwK3RoaXMuZ2V0VVRDU2Vjb25kcygpLzM2MDApLzI0KX0sZzpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldEhvdXJzKCklMTJ8fDEyfSxHOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZ2V0SG91cnMoKX0saDpmdW5jdGlvbigpe3JldHVybigodGhpcy5nZXRIb3VycygpJTEyfHwxMik8MTA/IjAiOiIiKSsodGhpcy5nZXRIb3VycygpJTEyfHwxMil9LEg6ZnVuY3Rpb24oKXtyZXR1cm4odGhpcy5nZXRIb3VycygpPDEwPyIwIjoiIikrdGhpcy5nZXRIb3VycygpfSxpOmZ1bmN0aW9uKCl7cmV0dXJuKHRoaXMuZ2V0TWludXRlcygpPDEwPyIwIjoiIikrdGhpcy5nZXRNaW51dGVzKCl9LHM6ZnVuY3Rpb24oKXtyZXR1cm4odGhpcy5nZXRTZWNvbmRzKCk8MTA/IjAiOiIiKSt0aGlzLmdldFNlY29uZHMoKX0sdTpmdW5jdGlvbigpe3ZhciB0PXRoaXMuZ2V0TWlsbGlzZWNvbmRzKCk7cmV0dXJuKDEwPnQ/IjAwIjoxMDA+dD8iMCI6IiIpK3R9LGU6ZnVuY3Rpb24oKXtyZXR1cm4vXCgoLiopXCkvLmV4ZWMoKG5ldyBEYXRlKS50b1N0cmluZygpKVsxXX0sSTpmdW5jdGlvbigpe2Zvcih2YXIgdD1udWxsLGU9MDsxMj5lOysrZSl7dmFyIG49bmV3IERhdGUodGhpcy5nZXRGdWxsWWVhcigpLGUsMSksaT1uLmdldFRpbWV6b25lT2Zmc2V0KCk7aWYobnVsbD09PXQpdD1pO2Vsc2V7aWYodD5pKXt0PWk7YnJlYWt9aWYoaT50KWJyZWFrfX1yZXR1cm4gdGhpcy5nZXRUaW1lem9uZU9mZnNldCgpPT10fDB9LE86ZnVuY3Rpb24oKXtyZXR1cm4oLXRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKTwwPyItIjoiKyIpKyhNYXRoLmFicyh0aGlzLmdldFRpbWV6b25lT2Zmc2V0KCkvNjApPDEwPyIwIjoiIikrTWF0aC5mbG9vcihNYXRoLmFicyh0aGlzLmdldFRpbWV6b25lT2Zmc2V0KCkvNjApKSsoMD09TWF0aC5hYnModGhpcy5nZXRUaW1lem9uZU9mZnNldCgpJTYwKT8iMDAiOihNYXRoLmFicyh0aGlzLmdldFRpbWV6b25lT2Zmc2V0KCklNjApPDEwPyIwIjoiIikrTWF0aC5hYnModGhpcy5nZXRUaW1lem9uZU9mZnNldCgpJTYwKSl9LFA6ZnVuY3Rpb24oKXtyZXR1cm4oLXRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKTwwPyItIjoiKyIpKyhNYXRoLmFicyh0aGlzLmdldFRpbWV6b25lT2Zmc2V0KCkvNjApPDEwPyIwIjoiIikrTWF0aC5mbG9vcihNYXRoLmFicyh0aGlzLmdldFRpbWV6b25lT2Zmc2V0KCkvNjApKSsiOiIrKDA9PU1hdGguYWJzKHRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKSU2MCk/IjAwIjooTWF0aC5hYnModGhpcy5nZXRUaW1lem9uZU9mZnNldCgpJTYwKTwxMD8iMCI6IiIpK01hdGguYWJzKHRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKSU2MCkpfSxUOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMudG9UaW1lU3RyaW5nKCkucmVwbGFjZSgvXi4rIFwoPyhbXlwpXSspXCk/JC8sIiQxIil9LFo6ZnVuY3Rpb24oKXtyZXR1cm4gNjAqLXRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKX0sYzpmdW5jdGlvbigpe3JldHVybiB0aGlzLmZvcm1hdCgiWS1tLWRcXFRIOmk6c1AiKX0scjpmdW5jdGlvbigpe3JldHVybiB0aGlzLnRvU3RyaW5nKCl9LFU6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5nZXRUaW1lKCkvMWUzfX07RGF0ZS5wcm90b3R5cGUuZm9ybWF0PWZ1bmN0aW9uKGUpe3ZhciBuPXRoaXM7cmV0dXJuIGUucmVwbGFjZSgvKFxcPykoLikvZyxmdW5jdGlvbihlLGkscil7cmV0dXJuIiI9PT1pJiZ0W3JdP3Rbcl0uY2FsbChuKTpyfSl9fSkuY2FsbCh0aGlzKTsKCmZ1bmN0aW9uIGdvdG9DbGllbnRQYWdlKGJ1c2luZXNzX3VzZXJfaWQpCnsKICB3aW5kb3cubG9jYXRpb24uaHJlZj0nLyMvYnVzaW5lc3NfY2xpZW50cy8nICsgYnVzaW5lc3NfdXNlcl9pZDsKfQpmdW5jdGlvbiBnb3RvSW5zdHJ1Y3RvclBhZ2UoYnVzaW5lc3NfdXNlcl9pZCkKewogIHdpbmRvdy5sb2NhdGlvbi5ocmVmPScvIy9idXNpbmVzc19pbnN0cnVjdG9ycy8nICsgYnVzaW5lc3NfdXNlcl9pZDsKfQoKZnVuY3Rpb24gZ290b0V2ZW50UGFnZSh0aGVldmVudCkKewogIGxvZ0RlYnVnKCJnb3RvRXZlbnRQYWdlICIrdGhlZXZlbnQpOwogIGlmICh0aGVldmVudC5pc19jbGFzcz09MSkKICB7CiAgICB3aW5kb3cubG9jYXRpb24uaHJlZj0nLyMvZXZlbnRfY2xhc3MvJyArIHRoZWV2ZW50LmV2ZW50X2lkOwogIH0KICBlbHNlCiAgewogICAgd2luZG93LmxvY2F0aW9uLmhyZWY9Jy8jL2V2ZW50LycgKyB0aGVldmVudC5ldmVudF9pZDsKICB9Cn0KCmZ1bmN0aW9uIGdvdG9Mb2NhdGlvblBhZ2UobG9jYXRpb25faWQpCnsKICBsb2dEZWJ1ZygiZ290b0xvY2F0aW9uUGFnZSAiK2xvY2F0aW9uX2lkKTsKICB3aW5kb3cubG9jYXRpb24uaHJlZj0nLyMvYnVzaW5lc3NfbG9jYXRpb25zLycgKyBsb2NhdGlvbl9pZDsKCn0KCmZ1bmN0aW9uIGdvdG9DbGllbnRFZGl0UGFnZSh1c2VyX2lkKQp7CiAgd2luZG93LmxvY2F0aW9uLmhyZWY9Jy8jL2J1c2luZXNzX2NsaWVudHMvJyArIHVzZXJfaWQgKyAnL2VkaXQnOwp9CgpmdW5jdGlvbiBnb3RvQmFjaygpCnsKICB3aW5kb3cuaGlzdG9yeS5iYWNrKCk7Cn0KCmZ1bmN0aW9uIHNob3dFdmVudFBvcHVwKHNlbGVjdGVkRXZlbnQsICR1aWJNb2RhbCkKewogIC8vIHRoaXMgZnVuY3Rpb24gdXNlZCB0byBicmluZyBhIHBvcHVwCiAgLy8gbm93IGl0IGdvZXMgdG8gdGhlIGV2ZW50IHBhZ2UKICBnb3RvRXZlbnRQYWdlKHNlbGVjdGVkRXZlbnQpOwoKICAvLyBpZiAoc2VsZWN0ZWRFdmVudC5pc19yZXBlYXRpbmcgPT0gMSkgewogIC8vICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAvLyAgICAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgLy8gICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9jbGFzc19zaW5nbGUucGhwJywKICAvLyAgICAgICAgIGNvbnRyb2xsZXI6ICdldmVudFJlY3VycmluZ0RldGFpbHNCdXNpbmVzc0NhbGVuZGFyTW9kYWxDb250cm9sbGVyJywKICAvLyAgICAgICAgIC8vIHNpemU6IHNpemUsCiAgLy8gICAgICAgICByZXNvbHZlOiB7CiAgLy8gICAgICAgICAgICAgc2VsZWN0ZWRFdmVudDogZnVuY3Rpb24oKSB7CiAgLy8gICAgICAgICAgICAgICAgIHJldHVybiBzZWxlY3RlZEV2ZW50OwogIC8vICAgICAgICAgICAgIH0KICAvLyAgICAgICAgIH0KICAvLyAgICAgfSk7CiAgLy8gfSBlbHNlIHsKICAvLyAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgLy8gICAgICAgICBhbmltYXRpb246IGZhbHNlLAogIC8vICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfZXZlbnRfc2luZ2xlLnBocCcsCiAgLy8gICAgICAgICBjb250cm9sbGVyOiAnZXZlbnREZXRhaWxzQnVzaW5lc3NDYWxlbmRhck1vZGFsQ29udHJvbGxlcicsCiAgLy8gICAgICAgICAvLyBzaXplOiBzaXplLAogIC8vICAgICAgICAgcmVzb2x2ZTogewogIC8vICAgICAgICAgICAgIHNlbGVjdGVkRXZlbnQ6IGZ1bmN0aW9uKCkgewogIC8vICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZWN0ZWRFdmVudDsKICAvLyAgICAgICAgICAgICB9CiAgLy8gICAgICAgICB9CiAgLy8gICAgIH0pOwogIC8vIH0KfQpmdW5jdGlvbiB1cGRhdGVHbG9iYWxMYW5ndWFnZSgkc2NvcGUsICRuZXdsYW5nKSB7CgogICAgLy8JdmFyIGdMYW5nPWdMYW5nQmFzZVtnTGFuZ0N1cnJdOwogICAgJGdMYW5nID0gZ0xhbmdCYXNlWyRuZXdsYW5nXTsKICAgIC8vIGxvZ0RlYnVnKCJnTGFuZ0Jhc2VbJG5ld2xhbmddWyd0aXRsZTEnXT0iICsgZ0xhbmdCYXNlWyRuZXdsYW5nXVsndGl0bGUxJ10pOwogICAgLy8gbG9nRGVidWcoImxhbmd1Z2FnZToiICsgJGdMYW5nWydsYW5ndWFnZSddKTsKICAgIC8vCWxvZ0RlYnVnKCJsYW5ndWdhZ2UgZGlyOiAiKyRnTGFuZ1snZGlyJ10pOwogICAgLy8JbG9nRGVidWcoImNoYW5naW5nIGxhbmd1YWdlIHRvICIrJG5ld2xhbmcpCiAgICAkc2NvcGUuc3BDbGFzcyA9ICRnTGFuZ1snY2xhc3MnXTsKICAgIC8vCWxvZ0RlYnVnKCJpcyBhcnJheT8gIithbmd1bGFyLmlzQXJyYXkoJGdMYW5nKSk7CiAgICAvLwlsb2dEZWJ1ZygiJGdMYW5nWydkaXInXT0iKyRnTGFuZ1snZGlyJ10pOwogICAgLy8JbG9nRGVidWcoIiRnTGFuZ1sndGl0bGUxJ109IiskZ0xhbmdbJ3RpdGxlMSddKTsKICAgICRzY29wZS5sYW5nZmlsZSA9ICRnTGFuZzsKICAgIC8vIGxvZ0RlYnVnKCJpcyBhcnJheT8gIiArIGFuZ3VsYXIuaXNBcnJheSgkc2NvcGUubGFuZ2ZpbGUpKTsKICAgIC8vIGxvZ0RlYnVnKCIkc2NvcGUubGFuZ2ZpbGU9IiArICRzY29wZS5sYW5nZmlsZSk7CiAgICAvLyBsb2dEZWJ1ZygiJHNjb3BlLmxhbmdmaWxlWyd0aXRsZTEnXT0iICsgJHNjb3BlLmxhbmdmaWxlWyd0aXRsZTEnXSk7CgogICAgJHNjb3BlLnRlc3RuZXd2YXIgPSAkc2NvcGUubGFuZ2ZpbGVbJ3RpdGxlMSddOwogICAgLy8JJHNjb3BlLm1lc3NhZ2U9JHNjb3BlLmxhbmdmaWxlWyd0aXRsZTEnXTsKfQoKZnVuY3Rpb24gZ2V0UmFuZG9tQ29sb3IoKSB7CiAgICB2YXIgbGV0dGVycyA9ICcwMTIzNDU2Nzg5QUJDREVGJy5zcGxpdCgnJyk7CiAgICB2YXIgY29sb3IgPSAnIyc7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IDY7IGkrKykgewogICAgICAgIGNvbG9yICs9IGxldHRlcnNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTYpXTsKICAgIH0KICAgIHJldHVybiBjb2xvcjsKfQoKZnVuY3Rpb24gZ2V0UmFuZG9tSW50KG1pbiwgbWF4KSB7CiAgICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKG1heCAtIG1pbiArIDEpKSArIG1pbjsKfQoKZnVuY3Rpb24gY2FsY190ZW1wX2xpbWl0X2lkKCkgewogICAgdmFyIGQgPSBuZXcgRGF0ZSgpOwogICAgdmFyIHJhbmRvbWxpbWl0ID0gZC5nZXRUaW1lKCk7CiAgICBsb2dEZWJ1ZygiY2FsY190ZW1wX2xpbWl0X2lkPSIgKyByYW5kb21saW1pdCk7CiAgICByZXR1cm4gcmFuZG9tbGltaXQ7Cn0KCnZhciAkZ0xvZ0xldmVsID0gJ2RlYnVnJzsKCi8vIHN0YXJ0aW5nCmxvZ0RlYnVnKCJtYWluICRnTG9nTGV2ZWw9IiArICRnTG9nTGV2ZWwpOwpsb2dEZWJ1ZygiaW5pdGlhbGl6ZSBhbmd1bGFyIik7CmxvZ0RlYnVnKCJpbml0aWFsaXppbmcgbW9kdWxlcyAiICsgJGFuZ3VsYXJNb2R1bGVzKTsKCnZhciBrdXplQXBwID0gYW5ndWxhci5tb2R1bGUoJ2t1emVBcHAnLCAkYW5ndWxhck1vZHVsZXMpCgovLyRyb290U2NvcGUuc3BDbGFzcyA9ICdyaWdodCc7Cmt1emVSdW4gPSBmdW5jdGlvbigpIHsKCn0Ka3V6ZUFwcC5ydW4oWwogICAgJyRidWlsZGVyJywKICAgIGZ1bmN0aW9uKCRidWlsZGVyKSB7CiAgICAgICAgLy8gbG9nRGVidWcoImluc2lkZSBrdXplQXBwLnJ1biIpOwogICAgICAgICRidWlsZGVyLnJlZ2lzdGVyQ29tcG9uZW50KCdzYW1wbGVJbnB1dCcsIHsKICAgICAgICAgICAgZ3JvdXA6ICdmcm9tIGh0bWwnLAogICAgICAgICAgICBsYWJlbDogJ1NhbXBsZScsCiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnRnJvbSBodG1sIHRlbXBsYXRlJywKICAgICAgICAgICAgcGxhY2Vob2xkZXI6ICdwbGFjZWhvbGRlcicsCiAgICAgICAgICAgIHJlcXVpcmVkOiBmYWxzZSwKICAgICAgICAgICAgdmFsaWRhdGlvbk9wdGlvbnM6IFt7CiAgICAgICAgICAgICAgICBsYWJlbDogJ25vbmUnLAogICAgICAgICAgICAgICAgcnVsZTogJy8uKi8nCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgIGxhYmVsOiAnbnVtYmVyJywKICAgICAgICAgICAgICAgIHJ1bGU6ICdbbnVtYmVyXScKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgbGFiZWw6ICdlbWFpbCcsCiAgICAgICAgICAgICAgICBydWxlOiAnW2VtYWlsXScKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgbGFiZWw6ICd1cmwnLAogICAgICAgICAgICAgICAgcnVsZTogJ1t1cmxdJwogICAgICAgICAgICB9XSwKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYW5ndWxhci1mb3JtLWJ1aWxkZXIvZXhhbXBsZS90ZW1wbGF0ZS5odG1sJywKICAgICAgICAgICAgcG9wb3ZlclRlbXBsYXRlVXJsOiAnL2FuZ3VsYXItZm9ybS1idWlsZGVyL2V4YW1wbGUvcG9wb3ZlclRlbXBsYXRlLmh0bWwnCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuICRidWlsZGVyLnJlZ2lzdGVyQ29tcG9uZW50KCduYW1lJywgewogICAgICAgICAgICBncm91cDogJ0RlZmF1bHQnLAogICAgICAgICAgICBsYWJlbDogJ05hbWUnLAogICAgICAgICAgICByZXF1aXJlZDogZmFsc2UsCiAgICAgICAgICAgIGFycmF5VG9UZXh0OiB0cnVlLAogICAgICAgICAgICB0ZW1wbGF0ZTogIjxkaXYgY2xhc3M9XCJmb3JtLWdyb3VwXCI+XG4gICAgPGxhYmVsIGZvcj1cInt7Zm9ybU5hbWUraW5kZXh9fVwiIGNsYXNzPVwiY29sLW1kLTQgY29udHJvbC1sYWJlbFwiIG5nLWNsYXNzPVwieydmYi1yZXF1aXJlZCc6cmVxdWlyZWR9XCI+e3tsYWJlbH19PC9sYWJlbD5cbiAgICA8ZGl2IGNsYXNzPVwiY29sLW1kLThcIj5cbiAgICAgICAgPGlucHV0IHR5cGU9J2hpZGRlbicgbmctbW9kZWw9XCJpbnB1dFRleHRcIiB2YWxpZGF0b3ItcmVxdWlyZWQ9XCJ7e3JlcXVpcmVkfX1cIiB2YWxpZGF0b3ItZ3JvdXA9XCJ7e2Zvcm1OYW1lfX1cIi8+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJjb2wtc20tNlwiIHN0eWxlPVwicGFkZGluZy1sZWZ0OiAwO1wiPlxuICAgICAgICAgICAgPGlucHV0IHR5cGU9XCJ0ZXh0XCJcbiAgICAgICAgICAgICAgICBuZy1tb2RlbD1cImlucHV0QXJyYXlbMF1cIlxuICAgICAgICAgICAgICAgIGNsYXNzPVwiZm9ybS1jb250cm9sXCIgaWQ9XCJ7e2Zvcm1OYW1lK2luZGV4fX0tMFwiLz5cbiAgICAgICAgICAgIDxwIGNsYXNzPSdoZWxwLWJsb2NrJz5GaXJzdCBuYW1lPC9wPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImNvbC1zbS02XCIgc3R5bGU9XCJwYWRkaW5nLWxlZnQ6IDA7XCI+XG4gICAgICAgICAgICA8aW5wdXQgdHlwZT1cInRleHRcIlxuICAgICAgICAgICAgICAgIG5nLW1vZGVsPVwiaW5wdXRBcnJheVsxXVwiXG4gICAgICAgICAgICAgICAgY2xhc3M9XCJmb3JtLWNvbnRyb2xcIiBpZD1cInt7Zm9ybU5hbWUraW5kZXh9fS0xXCIvPlxuICAgICAgICAgICAgPHAgY2xhc3M9J2hlbHAtYmxvY2snPkxhc3QgbmFtZTwvcD5cbiAgICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG48L2Rpdj4iLAogICAgICAgICAgICBwb3BvdmVyVGVtcGxhdGU6ICI8Zm9ybT5cbiAgICA8ZGl2IGNsYXNzPVwiZm9ybS1ncm91cFwiPlxuICAgICAgICA8bGFiZWwgY2xhc3M9J2NvbnRyb2wtbGFiZWwnPkxhYmVsPC9sYWJlbD5cbiAgICAgICAgPGlucHV0IHR5cGU9J3RleHQnIG5nLW1vZGVsPVwibGFiZWxcIiB2YWxpZGF0b3I9XCJbcmVxdWlyZWRdXCIgY2xhc3M9J2Zvcm0tY29udHJvbCcvPlxuICAgIDwvZGl2PlxuICAgIDxkaXYgY2xhc3M9XCJjaGVja2JveFwiPlxuICAgICAgICA8bGFiZWw+XG4gICAgICAgICAgICA8aW5wdXQgdHlwZT0nY2hlY2tib3gnIG5nLW1vZGVsPVwicmVxdWlyZWRcIiAvPlxuICAgICAgICAgICAgUmVxdWlyZWRcbiAgICAgICAgPC9sYWJlbD5cbiAgICA8L2Rpdj5cblxuICAgIDxoci8+XG4gICAgPGRpdiBjbGFzcz0nZm9ybS1ncm91cCc+XG4gICAgICAgIDxpbnB1dCB0eXBlPSdzdWJtaXQnIG5nLWNsaWNrPVwicG9wb3Zlci5zYXZlKCRldmVudClcIiBjbGFzcz0nYnRuIGJ0bi1wcmltYXJ5JyB2YWx1ZT0nU2F2ZScvPlxuICAgICAgICA8aW5wdXQgdHlwZT0nYnV0dG9uJyBuZy1jbGljaz1cInBvcG92ZXIuY2FuY2VsKCRldmVudClcIiBjbGFzcz0nYnRuIGJ0bi1kZWZhdWx0JyB2YWx1ZT0nQ2FuY2VsJy8+XG4gICAgICAgIDxpbnB1dCB0eXBlPSdidXR0b24nIG5nLWNsaWNrPVwicG9wb3Zlci5yZW1vdmUoJGV2ZW50KVwiIGNsYXNzPSdidG4gYnRuLWRhbmdlcicgdmFsdWU9J0RlbGV0ZScvPlxuICAgIDwvZGl2PlxuPC9mb3JtPiIKICAgICAgICB9KTsKICAgIH0KXSkKCmt1emVBcHAucnVuKGZ1bmN0aW9uKCRyb290U2NvcGUpIHsKICBsb2dEZWJ1ZygicnVuICRyb290U2NvcGUiKTsKICAkcm9vdFNjb3BlLiRvbignbG9hZGluZzpwcm9ncmVzcycsIGZ1bmN0aW9uICgpewogICAgICAvLyBzaG93IGxvYWRpbmcgZ2lmCiAgICAgIC8vICRzY29wZS5jdXJzb3JkZWxldGU9IndhaXQiOwogICAgICAvLyBkb2N1bWVudC5ib2R5LnN0eWxlLmN1cnNvcj0nd2FpdCc7CiAgfSk7CgogICRyb290U2NvcGUuJG9uKCdsb2FkaW5nOmZpbmlzaCcsIGZ1bmN0aW9uICgpewogICAgLy8gJHNjb3BlLmN1cnNvcmRlbGV0ZT0iIjsKICAgIC8vIGRvY3VtZW50LmJvZHkuc3R5bGUuY3Vyc29yPScnOwogIH0pOwp9KTsKCi8vIERFTEVURUQgLSB4ZWRpdGFibGUgc3R1ZmYKLy8ga3V6ZUFwcC5ydW4oZnVuY3Rpb24oZWRpdGFibGVPcHRpb25zLCBlZGl0YWJsZVRoZW1lcykgewovLyAgICAgbG9nRGVidWcoImluaXRpYWxpemluZyB4ZWRpdGFibGUgZWRpdGFibGVPcHRpb25zIik7Ci8vICAgICBlZGl0YWJsZU9wdGlvbnMudGhlbWUgPSAnYnMzJzsgLy8gYm9vdHN0cmFwMyB0aGVtZS4gQ2FuIGJlIGFsc28gJ2JzMicsICdkZWZhdWx0JwovLyAgICAgLy8gZWRpdGFibGVPcHRpb25zLmRlZmF1bHRzLm1vZGUgPSAnaW5saW5lJzsKLy8gICAgIGxvZ0RlYnVnKGVkaXRhYmxlT3B0aW9ucyk7Ci8vICAgICAvLyBlZGl0YWJsZU9wdGlvbnMubW9kZSA9ICdpbmxpbmUnOwovLyAgICAgZWRpdGFibGVUaGVtZXMuYnMzLmlucHV0Q2xhc3MgPSAnaW5wdXQtc20nOwovLyAgICAgZWRpdGFibGVUaGVtZXMuYnMzLmJ1dHRvbnNDbGFzcyA9ICdidG4tc20nOwovLyB9KTsKCi8vIGFmdGVyIGZvcm1zCi8vRGVmaW5lIFJvdXRpbmcgZm9yIGFwcAovL1VyaSAvQWRkTmV3T3JkZXIgLT4gdGVtcGxhdGUgYWRkX29yZGVyLmh0bWwgYW5kIENvbnRyb2xsZXIgQ2xpZW50c0FkZENvbnRyb2xsZXIKLy9VcmkgL1Nob3dPcmRlcnMgLT4gdGVtcGxhdGUgc2hvd19vcmRlcnMuaHRtbCBhbmQgQ29udHJvbGxlciBDbGllbnRzQWRkQ29udHJvbGxlcgprdXplQXBwLmNvbmZpZyhbJyRyb3V0ZVByb3ZpZGVyJywKICAgIGZ1bmN0aW9uKCRyb3V0ZVByb3ZpZGVyKSB7CiAgICAgICAgLy8gbG9nRGVidWcoJHJvdXRlUHJvdmlkZXIpOwogICAgICAgICRyb3V0ZVByb3ZpZGVyLgogICAgICAgIC8vIHdoZW4oJy9jbGllbnRjYXJkJywgewogICAgICAgIC8vICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19jbGllbnRfY2FyZC5odG1sJywKICAgICAgICAvLyAgICAgY29udHJvbGxlcjogJ2NsaWVudENhcmRDb250cm9sbGVyJwogICAgICAgIC8vIH0pLgogICAgICAgIHdoZW4oJy9jb250YWN0JywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdjb250YWN0LnBocCcsCiAgICAgICAgICAgIC8vIGNvbnRyb2xsZXI6ICdlbmRVc2VySG9tZUNvbnRyb2xsZXInCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdjb250YWN0Q29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvZXZlbnRfdHlwZXMnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2V2ZW50X3R5cGVzLmh0bWwnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnRXZlbnRUeXBlc0NvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2V2ZW50X3R5cGVzL2FkZCcsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfZXZlbnRfdHlwZV9hZGQucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0V2ZW50VHlwZU5ld0NvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2V2ZW50X3R5cGVzLzpldmVudF90eXBlX2lkJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19ldmVudF90eXBlX2FkZC5waHAnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnRXZlbnRUeXBlVXBkYXRlQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvaG91cnNfb2Zfd29yaycsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfaG91cnNfb2Zfd29yay5odG1sJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0hvdXJzT2ZXb3JrQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvYnVzaW5lc3NfY2FsZW5kYXInLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2NhbGVuZGFyLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdCdXNpbmVzc0NhbGVuZGFyQ29udHJvbGxlcicsCiAgICAgICAgICAgIHJlbG9hZE9uU2VhcmNoOiBmYWxzZQogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9hbmd1bGFyLWZvcm0tYnVpbGRlcicsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYW5ndWxhci1mb3JtLWJ1aWxkZXIvaW5kZXguaHRtbCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdEZW1vQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvYnVzaW5lc3NfY2xpZW50cy9hZGQnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2NsaWVudHNfYWRkLmh0bWwnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnQ2xpZW50c0FkZENvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2J1c2luZXNzX2NsaWVudHMnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2NsaWVudHMucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0NsaWVudHNTaG93Q29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvYnVzaW5lc3NfY2xpZW50cy86YnVzaW5lc3NfdXNlcl9pZCcsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6IGZ1bmN0aW9uKHBhcmFtcykgewogICAgICAgICAgICAgICAgcmV0dXJuICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfY2xpZW50X2NhcmQucGhwP2J1c2luZXNzX3VzZXJfaWQ9JyArIHBhcmFtcy5idXNpbmVzc191c2VyX2lkIDsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgY29udHJvbGxlcjogJ0NsaWVudHNTaG93MUNvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2J1c2luZXNzX3JlcG9ydHMnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX3JlcG9ydHMuaHRtbCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdCdXNpbmVzc1JlcG9ydHNDb250cm9sbGVyJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9idXNpbmVzc19pbnN0cnVjdG9ycycsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfaW5zdHJ1Y3RvcnMucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0luc3RydWN0b3JzU2hvd0NvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2J1c2luZXNzX2luc3RydWN0b3JzL2FkZCcsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfY2xpZW50c19hZGQuaHRtbCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdJbnN0cnVjdG9yc0FkZENvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2J1c2luZXNzX2xvY2F0aW9ucycsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbG9jYXRpb25zLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdidXNpbmVzc19sb2NhdGlvbnMnCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2J1c2luZXNzX2xvY2F0aW9ucy9hZGQnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2xvY2F0aW9uc19hZGQucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ2J1c2luZXNzX2xvY2F0aW9uc19hZGQnCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2J1c2luZXNzX2xvY2F0aW9ucy86bG9jYXRpb25faWQnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2xvY2F0aW9uc19hZGQucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ2J1c2luZXNzX2xvY2F0aW9uc191cGRhdGUnCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2J1c2luZXNzX2luc3RydWN0b3JzLzpidXNpbmVzc191c2VyX2lkJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19pbnN0cnVjdG9yX2NhcmQucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0luc3RydWN0b3JTaG93MUNvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2V2ZW50LzpldmVudF9pZCcsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6IGZ1bmN0aW9uKHBhcmFtcykgewogICAgICAgICAgICAgICAgcmV0dXJuICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfZXZlbnRfY2FyZC5waHA/ZXZlbnRfaWQ9JyArIHBhcmFtcy5ldmVudF9pZCA7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdFdmVudFBhZ2VDb250cm9sbGVyJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9ldmVudF9jbGFzcy86ZXZlbnRfaWQnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBmdW5jdGlvbihwYXJhbXMpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2V2ZW50X2NsYXNzX2NhcmQucGhwP2V2ZW50X2lkPScgKyBwYXJhbXMuZXZlbnRfaWQgOwogICAgICAgICAgICB9LAogICAgICAgICAgICBjb250cm9sbGVyOiAnRXZlbnRDbGFzc1BhZ2VDb250cm9sbGVyJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9wYWNrYWdlcycsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfcGFja2FnZXNfc2hvdy5waHAnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnUGFja2FnZXNDb250cm9sbGVyJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9wYWNrYWdlcy9hZGQnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX3BhY2thZ2VzX2NyZWF0ZS5waHAnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnYnVzaW5lc3NfcGFja2FnZXNfYWRkX2NudGwnCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL3BhY2thZ2VzLzpwYWNrYWdlX2lkJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19wYWNrYWdlc19jcmVhdGUucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ2J1c2luZXNzX3BhY2thZ2VzX3VwZGF0ZV9jbnRsJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9idXNpbmVzc19jb25maWcnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2NvbmZpZy5waHAnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnQ29uZmlnQnVzaW5lc3NDb250cm9sbGVyJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy91c2VyX2NvbmZpZycsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAndXNlcl9jb25maWcucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0NvbmZpZ1VzZXJDb250cm9sbGVyJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9idXNpbmVzc19kb2NzJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19kb2NzLmh0bWwnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnQnVzaW5lc3NEb2NzQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdob21lLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdIb21lQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICBvdGhlcndpc2UoewogICAgICAgICAgICAvLyAgICByZWRpcmVjdFRvOiAnLycKICAgICAgICB9KTsKICAgIH0KXSk7CgprdXplQXBwLmZhY3RvcnkoJ2h0dHBJbnRlcmNlcHRvcicsIFsnJHEnLCAnJHJvb3RTY29wZScsCiAgICBmdW5jdGlvbiAoJHEsICRyb290U2NvcGUpIHsKICAgICAgICB2YXIgbG9hZGluZ0NvdW50ID0gMDsKCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgcmVxdWVzdDogZnVuY3Rpb24gKGNvbmZpZykgewogICAgICAgICAgICAgICAgaWYoKytsb2FkaW5nQ291bnQgPT09IDEpICRyb290U2NvcGUuJGJyb2FkY2FzdCgnbG9hZGluZzpwcm9ncmVzcycpOwogICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpZyB8fCAkcS53aGVuKGNvbmZpZyk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICByZXNwb25zZTogZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICBpZigtLWxvYWRpbmdDb3VudCA9PT0gMCkgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdsb2FkaW5nOmZpbmlzaCcpOwogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlIHx8ICRxLndoZW4ocmVzcG9uc2UpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgcmVzcG9uc2VFcnJvcjogZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICBpZigtLWxvYWRpbmdDb3VudCA9PT0gMCkgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdsb2FkaW5nOmZpbmlzaCcpOwogICAgICAgICAgICAgICAgcmV0dXJuICRxLnJlamVjdChyZXNwb25zZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgfQpdKS5jb25maWcoWyckaHR0cFByb3ZpZGVyJywgZnVuY3Rpb24gKCRodHRwUHJvdmlkZXIpIHsKICAgICRodHRwUHJvdmlkZXIuaW50ZXJjZXB0b3JzLnB1c2goJ2h0dHBJbnRlcmNlcHRvcicpOwp9XSk7CgprdXplQXBwLmZhY3RvcnkoJ3NoYXJlZERhdGEnLCBmdW5jdGlvbigpIHsKICAgIHZhciBzZWxlY3RlZEVuZFVzZXIgPSBudWxsOwoKICAgIHJldHVybiB7CiAgICAgICAgZ2V0U2VsZWN0ZWRFbmRVc2VyOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgLy9Zb3UgY291bGQgYWxzbyByZXR1cm4gc3BlY2lmaWMgYXR0cmlidXRlIG9mIHRoZSBmb3JtIGRhdGEgaW5zdGVhZAogICAgICAgICAgICAvL29mIHRoZSBlbnRpcmUgZGF0YQogICAgICAgICAgICByZXR1cm4gc2VsZWN0ZWRFbmRVc2VyOwogICAgICAgIH0sCiAgICAgICAgc2V0U2VsZWN0ZWRFbmRVc2VyOiBmdW5jdGlvbihuZXdTZWxlY3RlZEVuZFVzZXIpIHsKICAgICAgICAgICAgLy9Zb3UgY291bGQgYWxzbyBzZXQgc3BlY2lmaWMgYXR0cmlidXRlIG9mIHRoZSBmb3JtIGRhdGEgaW5zdGVhZAogICAgICAgICAgICBzZWxlY3RlZEVuZFVzZXIgPSBuZXdTZWxlY3RlZEVuZFVzZXI7CiAgICAgICAgfSwKICAgIH07Cn0pOwoKa3V6ZUFwcC5kaXJlY3RpdmUoJ2NvbnZlcnRUb051bWJlcicsIGZ1bmN0aW9uKCkgewogIHJldHVybiB7CiAgICByZXF1aXJlOiAnbmdNb2RlbCcsCiAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWxlbWVudCwgYXR0cnMsIG5nTW9kZWwpIHsKICAgICAgbmdNb2RlbC4kcGFyc2Vycy5wdXNoKGZ1bmN0aW9uKHZhbCkgewogICAgICAgIHJldHVybiB2YWwgIT0gbnVsbCA/IHBhcnNlSW50KHZhbCwgMTApIDogbnVsbDsKICAgICAgfSk7CiAgICAgIG5nTW9kZWwuJGZvcm1hdHRlcnMucHVzaChmdW5jdGlvbih2YWwpIHsKICAgICAgICByZXR1cm4gdmFsICE9IG51bGwgPyAnJyArIHZhbCA6IG51bGw7CiAgICAgIH0pOwogICAgfQogIH07Cn0pOwoKa3V6ZUFwcC5kaXJlY3RpdmUoJ2VsYXN0aWMnLCBbCiAgICAnJHRpbWVvdXQnLAogICAgZnVuY3Rpb24oJHRpbWVvdXQpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICByZXN0cmljdDogJ0EnLAogICAgICAgICAgICBsaW5rOiBmdW5jdGlvbigkc2NvcGUsIGVsZW1lbnQpIHsKICAgICAgICAgICAgICAgICRzY29wZS5pbml0aWFsSGVpZ2h0ID0gJHNjb3BlLmluaXRpYWxIZWlnaHQgfHwgZWxlbWVudFswXS5zdHlsZS5oZWlnaHQ7CiAgICAgICAgICAgICAgICB2YXIgcmVzaXplID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgZWxlbWVudFswXS5zdHlsZS5oZWlnaHQgPSAkc2NvcGUuaW5pdGlhbEhlaWdodDsKICAgICAgICAgICAgICAgICAgICBlbGVtZW50WzBdLnN0eWxlLmhlaWdodCA9ICIiICsgZWxlbWVudFswXS5zY3JvbGxIZWlnaHQgKyAicHgiOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIGVsZW1lbnQub24oImlucHV0IGNoYW5nZSIsIHJlc2l6ZSk7CiAgICAgICAgICAgICAgICAvLyBlbGVtZW50Lm9uKCJpbnB1dCBjaGFuZ2UiLCByZXNpemUpOwogICAgICAgICAgICAgICAgJHRpbWVvdXQocmVzaXplLCAwKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICB9Cl0pOwoKa3V6ZUFwcC5zZXJ2aWNlKCdzaGFyZWRQcm9wZXJ0aWVzJywgZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBzZWxlY3RlZF91c2VyID0gbnVsbDsKICAgICAgICB2YXIgY2FsZW5kYXJfZGF0ZSA9IG51bGw7CiAgICAgICAgdmFyIGV2ZW50X3Jlc2NoZWR1bGUgPSBudWxsOwogICAgICAgIHZhciBzZWxlY3RlZF9pbnN0cnVjdG9yID0gMDsKICAgICAgICB2YXIgZXZlbnRfdHlwZV9mb3Jfc3VnZ2VzdGlvbnMgPSBudWxsOwogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGdldF9zZWxlY3RlZF9pbnN0cnVjdG9yOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZWN0ZWRfaW5zdHJ1Y3RvcjsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2V0X3NlbGVjdGVkX2luc3RydWN0b3I6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgICAgICAgICBzZWxlY3RlZF9pbnN0cnVjdG9yID0gdmFsdWU7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGdldF9zZWxlY3RlZF91c2VyOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZWN0ZWRfdXNlcjsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2V0X3NlbGVjdGVkX3VzZXI6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgICAgICAgICBzZWxlY3RlZF91c2VyID0gdmFsdWU7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNldF9ldmVudF9yZXNjaGVkdWxlOiBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgICAgICAgICAgZXZlbnRfcmVzY2hlZHVsZSA9IHZhbHVlOwogICAgICAgICAgICB9LAogICAgICAgICAgICBnZXRfZXZlbnRfcmVzY2hlZHVsZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGV2ZW50X3Jlc2NoZWR1bGU7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGdldF9jYWxlbmRhcl9kYXRlOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gY2FsZW5kYXJfZGF0ZTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2V0X2NhbGVuZGFyX2RhdGU6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgICAgICAgICBjYWxlbmRhcl9kYXRlID0gdmFsdWU7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGdldF9ldmVudF90eXBlX2Zvcl9zdWdnZXN0aW9uczogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGV2ZW50X3R5cGVfZm9yX3N1Z2dlc3Rpb25zOwogICAgICAgICAgICB9LAogICAgICAgICAgICBzZXRfZXZlbnRfdHlwZV9mb3Jfc3VnZ2VzdGlvbnM6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgICAgICAgICAvLyBsb2dEZWJ1Zygic2V0X2V2ZW50X3R5cGVfZm9yX3N1Z2dlc3Rpb25zPSIrdmFsdWUpOwogICAgICAgICAgICAgICAgZXZlbnRfdHlwZV9mb3Jfc3VnZ2VzdGlvbnMgPSB2YWx1ZTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICB9KTsKCmt1emVBcHAuY29udHJvbGxlcignbWVudUNvbnRyb2xsZXInLCBbJyRzY29wZScsICckbG9jYXRpb24nLCBmdW5jdGlvbigkc2NvcGUsICRsb2NhdGlvbikgewogICAgcmV0dXJuIHRydWU7CiAgICBsb2dEZWJ1ZygiJHNjb3BlLmlzQ3VycmVudFBhdGg9IiArICRzY29wZS5pc0N1cnJlbnRQYXRoKTsKICAgICRzY29wZS5pc0N1cnJlbnRQYXRoID0gZnVuY3Rpb24ocGF0aCkgewogICAgICAgIHJldHVybiAkbG9jYXRpb24ucGF0aCgpID09IHBhdGg7CiAgICB9Owp9XSk7CgoKCmt1emVBcHAuY29udHJvbGxlcignQnVzaW5lc3NSZXBvcnRzQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbiwkcm91dGVQYXJhbXMpCnsKCiAgbG9nRGVidWcoImNvbnRyb2xsZXI6IEJ1c2luZXNzUmVwb3J0c0NvbnRyb2xsZXIiKTsKCiAgJHNjb3BlLm9yZGVyQnlGaWVsZCA9ICdzdGFydF9lcG9jaCc7CiAgJHNjb3BlLnJldmVyc2VTb3J0PXRydWU7CiAgJHNjb3BlLmV2ZW50TW9kZWw9dHJ1ZTsKCiAgZ2V0QnVzaW5lc3NMb2NhdGlvbnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19sb2NhdGlvbnMnKTsKICBnZXRBbGxCdXNpbmVzc0V2ZW50VHlwZXMoJGh0dHAsJHNjb3BlLCdldmVudF90eXBlcycpOwogIGdldEFsbEluc3RydWN0b3JzKCRodHRwLCRzY29wZSwnaW5zdHJ1Y3RvcnMnKTsKICBnZXRBbGxDbGllbnRzQW5kQXJjaGl2ZSgkaHR0cCwkc2NvcGUsJ2NsaWVudHMnKTsKICAkc2NvcGUuc3RhdHVzZXMgPSBbIHsic3RhdHVzX2lkIjoiMCIsInN0YXR1c19uYW1lIjoi16TXqteV15cifSwgeyJzdGF0dXNfaWQiOiIxIiwic3RhdHVzX25hbWUiOiLXodeS15XXqCJ9XTsKICAkc2NvcGUuY2FuY2VsbGF0aW9ucyA9IFsgeyJpc19jYW5jZWxlZCI6IjAiLCJjYW5jZWxsYXRpb25fbmFtZSI6Itec15Ag15HXldeY15wifSx7ImlzX2NhbmNlbGVkIjoiMSIsImNhbmNlbGxhdGlvbl9uYW1lIjoi15HXldeY15wifV07CiAgJHNjb3BlLm1vbnRocyA9IFsgeyJtb250aCI6IjEifSx7Im1vbnRoIjoiMiJ9LHsibW9udGgiOiIzIn0seyJtb250aCI6IjQifSx7Im1vbnRoIjoiNSJ9LHsibW9udGgiOiI2In0seyJtb250aCI6IjcifSx7Im1vbnRoIjoiOCJ9LHsibW9udGgiOiI5In0seyJtb250aCI6IjEwIn0seyJtb250aCI6IjExIn0seyJtb250aCI6IjEyIn1dOwogICRzY29wZS55ZWFycyA9IFsgeyJ5ZWFyIjoiMjAxNiJ9LHsieWVhciI6IjIwMTcifV07CiAgJHNjb3BlLnBlcmlvZHMgPSBbCiAgICAgIHsicGVyaW9kX25hbWUiOiLXlNeZ16HXmNeV16jXmSIsICJwZXJpb2Rfc2lnbiI6Ii0xIn0sCiAgICAgIHsicGVyaW9kX25hbWUiOiLXlNeZ15XXnSIsICJwZXJpb2Rfc2lnbiI6IjAifSwKICAgICAgeyJwZXJpb2RfbmFtZSI6Itei16rXmdeT15kiLCAicGVyaW9kX3NpZ24iOiIxIn0sCiAgICBdCgogICRzY29wZS5jc3ZfY29sdW1uc19vcmRlciA9IFsnZXZlbnRfdHlwZV9uYW1lJywgJ3N0YXJ0X3RpbWUnLCAnZXZlbnRfdXNlcl9jbGllbnRzJywgJ2luc3RydWN0b3JfbmFtZScsICdpc19jYW5jZWxlZCcsICdpc19jb21wbGV0ZWQnLCAnYWN0dWFsX3ByaWNlJywgJ3BhcnRpY2lwYXRlZCddOwogICRzY29wZS5jc3ZfY29sdW1uc19oZWFkZXIgPSBbJ9eh15XXkiDXntek15LXqScsICfXqteQ16jXmdeaINeV16nXoteUJywgJ9ee16nXqteq16TXmdedJywgJ9ee15PXqNeZ15onLCfXnteR15XXmNecJywgJ9eh15LXldeoJywgJ9ee15fXmdeoJywgJ9ee16nXqteq16TXmdedJ107CgoKCiAgJHNjb3BlLmdvdG9DbGllbnRQYWdlPSBmdW5jdGlvbiAoYnVzaW5lc3NVc2VyaWQpIHsKICAgIGdvdG9DbGllbnRQYWdlKGJ1c2luZXNzVXNlcmlkKTsKICB9CgogIGZ1bmN0aW9uIGxpc3RfdG9fc3RyaW5nX2J5X3ZhbHVlKHgsdmFsdWUpewogICAgaWYgKCB4ICE9IHVuZGVmaW5lZCApewogICAgICB2YXIgeDEgPSBuZXcgQXJyYXkoKTsKICAgICAgZm9yIChpID0gMDsgaSA8IHgubGVuZ3RoOyBpKyspewogICAgICAgIHgxW2ldID0geFtpXVt2YWx1ZV07CiAgICAgIH0KICAgICAgeDEgPSB4MS5qb2luKCk7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICByZXR1cm4geDE7CiAgfQoKICAkc2NvcGUucmVwb3J0X2lzX2xvYWRpbmcgPSBmYWxzZTsKCiRzY29wZS5ldmVudHNSZXBvcnQgPSBmdW5jdGlvbigpewpsb2dEZWJ1ZygiZXZlbnRzUmVwb3J0Iik7Cgokc2NvcGUuc2hvd0FnZyA9ICgkc2NvcGUuZXZlbnRUeXBlTW9kZWwpIHx8Cigkc2NvcGUuaW5zdHJ1Y3Rvck1vZGVsKSB8fCAoJHNjb3BlLm1vbnRoTW9kZWwpIHx8ICgkc2NvcGUuY2xpZW50c01vZGVsKSB8fCAoJHNjb3BlLnllYXJNb2RlbCkgOwoKZXZlbnRfdHlwZV9pZF9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuc2VsZWN0ZWRFdmVudFR5cGVGaWx0ZXIsICJldmVudF90eXBlX2lkIiApOwppbnN0cnVjdG9yX2lkX2ZpbHRlciA9IGxpc3RfdG9fc3RyaW5nX2J5X3ZhbHVlKCRzY29wZS5zZWxlY3RlZEluc3RydWN0b3JGaWx0ZXIsICJidXNpbmVzc191c2VyX2lkIiApOwptb250aF9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuc2VsZWN0ZWRNb250aEZpbHRlciwgIm1vbnRoIiApOwpjbGllbnRfZmlsdGVyID0gbGlzdF90b19zdHJpbmdfYnlfdmFsdWUoJHNjb3BlLnNlbGVjdGVkQ2xpZW50RmlsdGVyLCAiYnVzaW5lc3NfdXNlcl9pZCIgKTsKeWVhcl9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuc2VsZWN0ZWRZZWFyRmlsdGVyLCAieWVhciIgKTsKc3RhdHVzX2ZpbHRlciA9IGxpc3RfdG9fc3RyaW5nX2J5X3ZhbHVlKCRzY29wZS5zZWxlY3RlZFN0YXR1c0ZpbHRlciwgInN0YXR1c19pZCIgKTsKaXNfY2FuY2VsZWRfZmlsdGVyID0gbGlzdF90b19zdHJpbmdfYnlfdmFsdWUoJHNjb3BlLnNlbGVjdGVkSXNfY2FuY2VsZWRGaWx0ZXIsICJpc19jYW5jZWxlZCIgKTsKcGVyaW9kX2ZpbHRlciA9IGxpc3RfdG9fc3RyaW5nX2J5X3ZhbHVlKCRzY29wZS5zZWxlY3RlZFBlcmlvZEZpbHRlciwgInBlcmlvZF9zaWduIiApOwoKJHNjb3BlLmV2ZW50UmVwb3J0Q29uZmlnID0ge307CgogICAgJHNjb3BlLmV2ZW50UmVwb3J0Q29uZmlnLnNvdXJjZSA9ICJkb2NzIjsKCiRzY29wZS5ldmVudFJlcG9ydENvbmZpZy5maWx0ZXJzID0gewpldmVudF90eXBlX2lkOiBldmVudF90eXBlX2lkX2ZpbHRlciwKaW5zdHJ1Y3Rvcl9pZDogaW5zdHJ1Y3Rvcl9pZF9maWx0ZXIsCm1vbnRoOiBtb250aF9maWx0ZXIsCnllYXI6IHllYXJfZmlsdGVyLApjbGllbnQ6IGNsaWVudF9maWx0ZXIsCnN0YXR1czogc3RhdHVzX2ZpbHRlciwKcGVyaW9kOiBwZXJpb2RfZmlsdGVyLAppc19jYW5jZWxlZDogaXNfY2FuY2VsZWRfZmlsdGVyCn07Cgokc2NvcGUuZXZlbnRSZXBvcnRDb25maWcuYWdncmVnYXRpb25zID0gewpldmVudF90eXBlX2lkOiAkc2NvcGUuZXZlbnRUeXBlTW9kZWwsCmluc3RydWN0b3JfaWQ6ICRzY29wZS5pbnN0cnVjdG9yTW9kZWwsCm1vbnRoOiAkc2NvcGUubW9udGhNb2RlbCwKeWVhcjogJHNjb3BlLnllYXJNb2RlbCwKY2xpZW50OiAkc2NvcGUuY2xpZW50TW9kZWwsCn07CgppZiAoICRzY29wZS5zaG93QWdnICkgewogICAgICBnZXRFdmVudHNSZXBvcnQoJGh0dHAsJHNjb3BlLCAkc2NvcGUuZXZlbnRSZXBvcnRDb25maWcsIGdldEV2ZW50c1JlcG9ydEFnZ3JlZ2F0ZWRfc3VjY2Vzcyk7CiRzY29wZS5yZXBvcnRfaXNfbG9hZGluZyA9IHRydWU7Cn0gZWxzZSB7CiAgICAgIGdldEV2ZW50c1JlcG9ydCgkaHR0cCwkc2NvcGUsICRzY29wZS5ldmVudFJlcG9ydENvbmZpZywgZ2V0RXZlbnRzUmVwb3J0TGlzdF9zdWNjZXNzKTsKJHNjb3BlLnJlcG9ydF9pc19sb2FkaW5nID0gdHJ1ZTsKfQoKZnVuY3Rpb24gZ2V0RXZlbnRzUmVwb3J0TGlzdF9zdWNjZXNzKHJlc3BvbnNlKXsKJHNjb3BlLkV2ZW50UmVwb3J0TGlzdCA9IHJlc3BvbnNlLmpzb247CiRzY29wZS5kb3dubG9hZF9yZXBvcnQgPSAkc2NvcGVbICdFdmVudFJlcG9ydExpc3QnIF07CiRzY29wZS5yZXBvcnRfaXNfbG9hZGluZyA9IGZhbHNlOwp9CgpmdW5jdGlvbiBnZXRFdmVudHNSZXBvcnRBZ2dyZWdhdGVkX3N1Y2Nlc3MocmVzcG9uc2Upewokc2NvcGUuRXZlbnRSZXBvcnRBZ2dyZWdhdGVkID0gcmVzcG9uc2UuanNvbjsKJHNjb3BlLmRvd25sb2FkX3JlcG9ydCA9ICRzY29wZVsgJ0V2ZW50UmVwb3J0QWdncmVnYXRlZCcgXTsKJHNjb3BlLnJlcG9ydF9pc19sb2FkaW5nID0gZmFsc2U7Cn0KCmZ1bmN0aW9uIGdldENsaWVudHNSZXBvcnRMaXN0X3N1Y2Nlc3MocmVzcG9uc2Upewokc2NvcGUuQ2xpZW50c1JlcG9ydExpc3QgPSByZXNwb25zZS5qc29uOwpjb25zb2xlLmxvZygiLS0tLS0tLS0tLS0tIikKY29uc29sZS5sb2coJHNjb3BlLkNsaWVudHNSZXBvcnRMaXN0KQpjb25zb2xlLmxvZygiLS0tLS0tLS0tLS0tIikKJHNjb3BlLnJlcG9ydF9pc19sb2FkaW5nID0gZmFsc2U7Cn0KCgp9Cgokc2NvcGUuY2xpZW50c1JlcG9ydCA9IGZ1bmN0aW9uKCl7CmxvZ0RlYnVnKCJjbGllbnRzUmVwb3J0Iik7CgpjbGllbnRfZmlsdGVyID0gbGlzdF90b19zdHJpbmdfYnlfdmFsdWUoJHNjb3BlLnNlbGVjdGVkQ2xpZW50RmlsdGVyLCAiY2xpZW50IiApOwoKJHNjb3BlLmV2ZW50UmVwb3J0Q29uZmlnID0ge307Cgokc2NvcGUuZXZlbnRSZXBvcnRDb25maWcuZmlsdGVycyA9IHsKY2xpZW50OiBjbGllbnRfZmlsdGVyLAp9OwoKJHNjb3BlLmV2ZW50UmVwb3J0Q29uZmlnLmFnZ3JlZ2F0aW9ucyA9IHsKfTsKCmdldENsaWVudHNSZXBvcnQoJGh0dHAsJHNjb3BlLCBnZXRDbGllbnRzUmVwb3J0X3N1Y2Nlc3MpOwokc2NvcGUucmVwb3J0X2lzX2xvYWRpbmcgPSB0cnVlOwpmdW5jdGlvbiBnZXRDbGllbnRzUmVwb3J0X3N1Y2Nlc3MocmVzcG9uc2Upewokc2NvcGUuY2xpZW50UmVwb3J0ID0gcmVzcG9uc2UuanNvbjsKJHNjb3BlLmRvd25sb2FkX3JlcG9ydCA9ICRzY29wZVsgJ2NsaWVudFJlcG9ydCcgXTsKJHNjb3BlLnJlcG9ydF9pc19sb2FkaW5nID0gZmFsc2U7Cn0KfQoKJHNjb3BlLmVkaXRFdmVudD0gZnVuY3Rpb24gKHRoZWV2ZW50KQp7CmdvdG9FdmVudFBhZ2UodGhlZXZlbnQpOwp9Cgokc2NvcGUuZXZlbnRzUmVwb3J0KCk7CiRzY29wZS5zZWxlY3RlZFJlcG9ydD0iZXZlbnRzIjsKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2J1c2luZXNzX3BhY2thZ2VzX3VwZGF0ZV9jbnRsJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uLCRyb3V0ZVBhcmFtcykKewokc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyID0ge307IC8vIHRoZXNlIGFyZSB0aGUgY29tcGxldGUgZGV0YWlscyBmb3IgdGhlIG5ldyBldmVudCAvLwokc2NvcGUucGFja2FnZV9pc191cGRhdGUgPSB0cnVlOwokc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLnBhY2thZ2VfbGltaXRfdHlwZT0xOwoKLy8gZ2V0dHRpbmcgdGhlIHBhY2thZ2UgYW5kIGl0cyBldmVudCB0eXBlcwpnZXRCdXNpbmVzc1BhY2thZ2UoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5wYWNrYWdlX2lkLCdmb3JtQWRkUGFja2FnZUFuZ3VsYXInLGZ1bmN0aW9uKHJlc3BvbnNlKQp7CiRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuaXNfdXBkYXRlID0gdHJ1ZTsKJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5vcmlnRXZlbnRUeXBlcz1hbmd1bGFyLmNvcHkoJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5zZWxlY3RlZEV2ZW50VHlwZXMpOwokc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLnBhY2thZ2VfbGltaXRfdHlwZT0xOwovLyB0aGVuIGdldHRpbmcgYWxsIHRoZSBldmVudCB0eXBlcwpnZXRFdmVudFR5cGVzTm9BZG1pbigkaHR0cCwkc2NvcGUsJ3JlbGF0ZWRFdmVudFR5cGVzJyxnZXRFdmVudFR5cGVzTm9BZG1pbl9zdWNjZXNzKTsKZnVuY3Rpb24gZ2V0RXZlbnRUeXBlc05vQWRtaW5fc3VjY2VzcygpCnsKLy8gdGhlbiByZW1vdmluZyBleGlzdGluZyBldmVudCB0eXBlcyBvZiBwYWNrYWdlIGZyb20gbGlzdAovLyBjb25zb2xlLmxvZygkc2NvcGUucmVsYXRlZEV2ZW50VHlwZXNbMF0pOwovLyBjb25zb2xlLmxvZygkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLnNlbGVjdGVkRXZlbnRUeXBlc1swXSk7CmZvcih2YXIgaSA9IDA7IGkgPCAkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLnNlbGVjdGVkRXZlbnRUeXBlcy5sZW5ndGg7IGkrKykKewovLyBjb3B5aW5nIHRoZSBhY3R1YWwgb2JqZWN0IG9mICRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuc2VsZWN0ZWRFdmVudFR5cGVzW2ldCmZvcih2YXIgaiA9IDA7IGogPCAkc2NvcGUucmVsYXRlZEV2ZW50VHlwZXMubGVuZ3RoOyBqKyspCnsKaWYgKCRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuc2VsZWN0ZWRFdmVudFR5cGVzW2ldLmV2ZW50X3R5cGVfaWQ9PSRzY29wZS5yZWxhdGVkRXZlbnRUeXBlc1tqXS5ldmVudF90eXBlX2lkKQp7CiRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuc2VsZWN0ZWRFdmVudFR5cGVzW2ldPWFuZ3VsYXIuY29weSgkc2NvcGUucmVsYXRlZEV2ZW50VHlwZXNbal0pOwp9Cn0KfQp9Cn0pOwokc2NvcGUuZ290b0JhY2sgPSBnb3RvQmFjazsKJHNjb3BlLmNyZWF0ZVBhY2thZ2UgPSBmdW5jdGlvbigpCnsKY29uc29sZS5sb2coInVwZGF0ZVBhY2thZ2VEZXRhaWxzIik7CnVwZGF0ZVBhY2thZ2VEZXRhaWxzKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMucGFja2FnZV9pZCwkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLHN1Y2Nlc3NfY2FsbGJhY2ssIGZhaWx1cmVfY2FsbGJhY2spOwpmdW5jdGlvbiBzdWNjZXNzX2NhbGxiYWNrKCkKewpnb3RvQmFjaygpOwp9CmZ1bmN0aW9uIGZhaWx1cmVfY2FsbGJhY2soKQp7CmdvdG9CYWNrKCk7Cn0KfTsKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2J1c2luZXNzX3BhY2thZ2VzX2FkZF9jbnRsJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uKSB7CmxvZ0RlYnVnKCdidXNpbmVzc19wYWNrYWdlc19hZGRfY250bCcpOwokc2NvcGUucGFja2FnZV9pc191cGRhdGUgPSBmYWxzZTsKJHNjb3BlLmdvdG9CYWNrID0gZ290b0JhY2s7CiRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIgPSB7fTsKJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5ldmVudHNfY291bnRlciA9IDE7CiRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuZXZlbnRzX3Blcl93ZWVrID0gMTsKJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5wYWNrYWdlX2R1cmF0aW9uX21vbnRocyA9IDM7CiRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIucGFja2FnZV9saW1pdF90eXBlPTE7CmdldEV2ZW50VHlwZXNOb0FkbWluKCRodHRwLCRzY29wZSwncmVsYXRlZEV2ZW50VHlwZXMnKTsKCiRzY29wZS5jcmVhdGVQYWNrYWdlID0gZnVuY3Rpb24oKQp7CmNyZWF0ZVBhY2thZ2UoJGh0dHAsJHNjb3BlLCRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIsY3JlYXRlUGFja2FnZV9zdWNjZXNzLCBjcmVhdGVQYWNrYWdlX2ZhaWx1cmUpOwpmdW5jdGlvbiBjcmVhdGVQYWNrYWdlX3N1Y2Nlc3MoKQp7CiRsb2NhdGlvbi5wYXRoKCcvcGFja2FnZXMnKTsKfQpmdW5jdGlvbiBjcmVhdGVQYWNrYWdlX2ZhaWx1cmUoKQp7Ci8vIGxvZ0Vycm9yKCJlcnJvciAiICsgZGF0YS5tZXNzYWdlKTsKLy8gJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5hamF4X2Vycm9yID0gZGF0YS5tZXNzYWdlOwp9Cn0KfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2J1c2luZXNzX2xvY2F0aW9ucycsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikgewpsb2dEZWJ1ZygnYnVzaW5lc3NfbG9jYXRpb25zIGNvbnRyb2xsZXInKTsKZ2V0QnVzaW5lc3NMb2NhdGlvbnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19sb2NhdGlvbnMnKTsKJHNjb3BlLmFkZE5ld0xvY2F0aW9uID0gZnVuY3Rpb24gKCkKewokbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2xvY2F0aW9ucy9hZGQnKTsKfQokc2NvcGUuZ290b0xvY2F0aW9uUGFnZSA9IGZ1bmN0aW9uKGxvY2F0aW9uX2lkKQp7CmdvdG9Mb2NhdGlvblBhZ2UobG9jYXRpb25faWQpOwp9Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignQnVzaW5lc3NEb2NzQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikgewpsb2dEZWJ1ZygnQnVzaW5lc3NEb2NzQ29udHJvbGxlcicpOwp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ2J1c2luZXNzX2xvY2F0aW9uc191cGRhdGUnLCBmdW5jdGlvbigkc2NvcGUsICRyb3V0ZVBhcmFtcywgJGh0dHAsICRsb2NhdGlvbikgewpsb2dEZWJ1ZygnYnVzaW5lc3NfbG9jYXRpb25zX3VwZGF0ZSBjb250cm9sbGVyJyk7CiRzY29wZS5pc191cGRhdGU9dHJ1ZTsKLy8gZ2V0QnVzaW5lc3NMb2NhdGlvbnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19sb2NhdGlvbnMnKTsKZ2V0QnVzaW5lc3NMb2NhdGlvbigkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmxvY2F0aW9uX2lkLCdjdXJyX2xvY2F0aW9uJyxnZXRCdXNpbmVzc0xvY2F0aW9uX3N1Y2Nlc3MpOwpmdW5jdGlvbiBnZXRCdXNpbmVzc0xvY2F0aW9uX3N1Y2Nlc3MoKQp7CiRzY29wZS5mb3JtQWRkTG9jYXRpb25Bbmd1bGFyPSRzY29wZS5jdXJyX2xvY2F0aW9uWzBdOwp9CgoKJHNjb3BlLmFkZExvY2F0aW9uID0gZnVuY3Rpb24oKQp7Ci8vIGluIHRoaXMgY2FzZSAtIHVwZGF0ZSBsb2NhdGlvbgp0aGVkYXRhID0gJHNjb3BlLmZvcm1BZGRMb2NhdGlvbkFuZ3VsYXI7CgpmdW5jdGlvbiBhZGRMb2NhdGlvbl9zdWNjZXNzKCkKewokbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2xvY2F0aW9ucycpOwp9CmZ1bmN0aW9uIGFkZExvY2F0aW9uX2ZhaWx1cmUoKQp7CiRzY29wZS5mb3JtQWRkTG9jYXRpb25Bbmd1bGFyLmFqYXhfZXJyb3IgPSByZXNwb25zZS5tZXNzYWdlOwp9CnVwZGF0ZUxvY2F0aW9uKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMubG9jYXRpb25faWQsIHRoZWRhdGEsYWRkTG9jYXRpb25fc3VjY2VzcyxhZGRMb2NhdGlvbl9mYWlsdXJlKTsKfQp9KTsKCmt1emVBcHAuY29udHJvbGxlcignYnVzaW5lc3NfbG9jYXRpb25zX2FkZCcsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikgewpsb2dEZWJ1ZygnYnVzaW5lc3NfbG9jYXRpb25zX2FkZCBjb250cm9sbGVyJyk7CmdldEJ1c2luZXNzTG9jYXRpb25zKCRodHRwLCRzY29wZSwnYnVzaW5lc3NfbG9jYXRpb25zJyk7CiRzY29wZS5pc191cGRhdGU9ZmFsc2U7Cgokc2NvcGUuYWRkTG9jYXRpb24gPSBmdW5jdGlvbigpCnsKdGhlZGF0YSA9ICRzY29wZS5mb3JtQWRkTG9jYXRpb25Bbmd1bGFyOwoKZnVuY3Rpb24gYWRkTG9jYXRpb25fc3VjY2VzcygpCnsKJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19sb2NhdGlvbnMnKTsKfQpmdW5jdGlvbiBhZGRMb2NhdGlvbl9mYWlsdXJlKCkKewokc2NvcGUuZm9ybUFkZExvY2F0aW9uQW5ndWxhci5hamF4X2Vycm9yID0gcmVzcG9uc2UubWVzc2FnZTsKfQphZGRMb2NhdGlvbigkaHR0cCwkc2NvcGUsdGhlZGF0YSxhZGRMb2NhdGlvbl9zdWNjZXNzLGFkZExvY2F0aW9uX2ZhaWx1cmUpOwp9Cn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdJbnN0cnVjdG9yc0FkZENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkbG9jYXRpb24pIHsKbG9nRGVidWcoJ0luc3RydWN0b3JzQWRkQ29udHJvbGxlcicpOwokc2NvcGUuaXNJbnN0cnVjdG9yPXRydWU7CiRzY29wZS51c2VydHlwZT0iaW5zdHJ1Y3RvciI7CiRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhciA9IHt9Owokc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIuaXNfdXBkYXRlPWZhbHNlOwokc2NvcGUuYWRkQ2xpZW50ID0gZnVuY3Rpb24oKSAvLyBhZGQgaW5zdHJ1Y3RvciwgdXNpbmcgdGhlIHNhbWUgZnVuY3Rpb24gbmFtZSBhcyB3ZSB1c2UgdGhlIHNhbWUgc2NyZWVuCnsKdGhlZGF0YSA9ICRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhcjsKCmZ1bmN0aW9uIGFkZEluc3RydWN0b3Jfc3VjY2VzcygpCnsKJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19pbnN0cnVjdG9ycycpOwp9CmZ1bmN0aW9uIGFkZENsaWVudF9mYWlsdXJlKCkKewokc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIuYWpheF9lcnJvciA9IHJlc3BvbnNlLm1lc3NhZ2U7Cn0KYWRkSW5zdHJ1Y3RvcigkaHR0cCwkc2NvcGUsdGhlZGF0YSxhZGRJbnN0cnVjdG9yX3N1Y2Nlc3MpOwp9Cn0pOwprdXplQXBwLmNvbnRyb2xsZXIoJ0NsaWVudHNBZGRDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJHRpbWVvdXQsICRsb2NhdGlvbiwgc2hhcmVkUHJvcGVydGllcykgewpsb2dEZWJ1ZygnQ2xpZW50c0FkZENvbnRyb2xsZXIgLSBUaGlzIGlzIEFkZCBuZXcgY2xpZW50IHNjcmVlbicpOwokc2NvcGUuaXNJbnN0cnVjdG9yPWZhbHNlOwoKJHNjb3BlLnVzZXJ0eXBlPSJlbmR1c2VyIjsKJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyID0ge307CiRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5pc191cGRhdGU9ZmFsc2U7CiRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5kaXNhYmxlX3Bob25lX2VkaXRpbmc9ZmFsc2U7CgppZiAoKCRzY29wZS5maWx0ZXIuVmFsdWUgIT0gIiIpICYmICh0eXBlb2YgJHNjb3BlLmZpbHRlci5WYWx1ZSAhPSAndW5kZWZpbmVkJykpIHsKbG9nRGVidWcoImNsaWVudHMgZmlsdGVyIGlzIG5vdCBlbXB0eSIpOwp2YXIgZmlsdGVyID0gU3RyaW5nKCRzY29wZS5maWx0ZXIuVmFsdWUpOwppZiAoZmlsdGVyLmluZGV4T2YoIiAiKSA+IDApIHsKJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyLmZpcnN0X25hbWUgPSBmaWx0ZXIuc3Vic3RyKDAsIGZpbHRlci5pbmRleE9mKCIgIikpOwokc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIubGFzdF9uYW1lID0gZmlsdGVyLnN1YnN0cigxICsgZmlsdGVyLmluZGV4T2YoIiAiKSk7Cn0gZWxzZSB7CiRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5maXJzdF9uYW1lID0gZmlsdGVyOwokc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIubGFzdF9uYW1lID0gIiI7Cn0KJHNjb3BlLmZpbHRlci5WYWx1ZSA9ICIiOwokc2NvcGUuZmlsdGVyLmJ1dHRvblZhbHVlID0gIiI7Cn0gZWxzZSB7Cn0KCiRzY29wZS5nb3RvQmFjayA9IGZ1bmN0aW9uKCkKewokbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2NsaWVudHMnKTsKfQoKJHNjb3BlLmFkZENsaWVudCA9IGZ1bmN0aW9uKCkKewp0aGVkYXRhID0gJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyOwoKZnVuY3Rpb24gYWRkQ2xpZW50X3N1Y2Nlc3ModXNlcl9pZCkKewppZiAoJHNjb3BlLnNhdmVfYW5kX3NjaGVkdWxlKQp7Ci8vICRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfY2xpZW50cy8nK3VzZXJfaWQuanNvbik7CmxvZ0RlYnVnKCJORVcgdXNlciB1c2VyX2lkPSIrdXNlcl9pZC5qc29uKTsKCnVzZXJfaW5mbz0gewpidXNpbmVzc191c2VyX2lkOiB1c2VyX2lkLmpzb24sCmJ1c2VyX2ZpcnN0X25hbWU6ICRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5idXNlcl9maXJzdF9uYW1lLApidXNlcl9sYXN0X25hbWU6ICRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5idXNlcl9sYXN0X25hbWUKfTsKCnNoYXJlZFByb3BlcnRpZXMuc2V0X3NlbGVjdGVkX3VzZXIodXNlcl9pbmZvKTsKJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jYWxlbmRhcicpOwoKfQplbHNlCnsKJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jbGllbnRzLycpOwp9CmNvbnNvbGUubG9nKCJuZXcgdXNlciBpZCA9ICIrdXNlcl9pZC5qc29uKTsKfQpmdW5jdGlvbiBhZGRDbGllbnRfZmFpbHVyZShyZXNwb25zZSkKewokc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIuYWpheF9lcnJvciA9IHJlc3BvbnNlLm1lc3NhZ2U7CiR0aW1lb3V0KGZ1bmN0aW9uKCkKewokc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIuYWpheF9lcnJvcj1udWxsOwp9LCAyNTAwKTsKfQphZGRDbGllbnQoJGh0dHAsJHNjb3BlLHRoZWRhdGEsYWRkQ2xpZW50X3N1Y2Nlc3MsIGFkZENsaWVudF9mYWlsdXJlLGZhbHNlKTsKfQp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ1BhY2thZ2VzQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikgewpsb2dEZWJ1ZygnUGFja2FnZXNDb250cm9sbGVyJyk7CmdldEJ1c2luZXNzUGFja2FnZXMoJGh0dHAsJHNjb3BlLCdwYWNrYWdlcycpOwoKJHNjb3BlLnNob3dQYWNrYWdlID0gZnVuY3Rpb24gKHRoZXBhY2thZ2UpCnsKJGxvY2F0aW9uLnBhdGgoJy9wYWNrYWdlcy8nK3RoZXBhY2thZ2UucGFja2FnZV9pZCk7Cn0KfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdJbnN0cnVjdG9yc1Nob3dDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uKSB7CmxvZ0RlYnVnKCdJbnN0cnVjdG9yc1Nob3dDb250cm9sbGVyJyk7CiRzY29wZS5vcmRlckJ5RmllbGQgPSAnYnVzZXJfc3RhcnRfZGF0ZSc7CiRzY29wZS5yZXZlcnNlU29ydD10cnVlOwoKZ2V0QWxsSW5zdHJ1Y3RvcnMoJGh0dHAsJHNjb3BlLCdhbGxDbGllbnRzJyxnZXRBbGxJbnN0cnVjdG9yc19zdWNjZXNzKTsKZnVuY3Rpb24gZ2V0QWxsSW5zdHJ1Y3RvcnNfc3VjY2VzcygpCnsKJHNjb3BlLnNob3dDbGllbnRzR3JpZE9wdGlvbnMuZGF0YT0kc2NvcGUuYWxsQ2xpZW50czsKfQoKJHNjb3BlLmdvdG9JbnN0cnVjdG9yUGFnZT0gZnVuY3Rpb24gKGJ1c2luZXNzX3VzZXJfaWQpCnsKZ290b0luc3RydWN0b3JQYWdlKGJ1c2luZXNzX3VzZXJfaWQpOwp9Cgokc2NvcGUuY2xpZW50TmFtZUZpbHRlcj0iIjsKJHNjb3BlLmlucHV0RmlsdGVyID0gZnVuY3Rpb24gKGl0ZW0pCnsKLy8gY29uc29sZS5sb2coaXRlbS5idXNlcl9waG9uZV9udW1iZXIpOwpyZXR1cm4gZmlsdGVyX2ZpcnN0bGFzdF9uYW1lKGl0ZW0uYnVzZXJfZmlyc3RfbmFtZSxpdGVtLmJ1c2VyX2xhc3RfbmFtZSxpdGVtLmJ1c2VyX3Bob25lX251bWJlciwkc2NvcGUuY2xpZW50TmFtZUZpbHRlcik7Cn07Cn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdDbGllbnRzU2hvd0NvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICR1aWJNb2RhbCwgJGh0dHAsICRsb2NhdGlvbikgewpsb2dEZWJ1ZygnQ2xpZW50c1Nob3dDb250cm9sbGVyJyk7CiRzY29wZS5vcmRlckJ5RmllbGQgPSAnYnVzZXJfc3RhcnRfZGF0ZSc7CiRzY29wZS5yZXZlcnNlU29ydD10cnVlOwoKZ2V0QWxsQ2xpZW50cygkaHR0cCwkc2NvcGUsJ2FsbENsaWVudHMnLGdldENsaWVudF9zdWNjZXNzKTsKZnVuY3Rpb24gZ2V0Q2xpZW50X3N1Y2Nlc3MoKQp7CiRzY29wZS5zaG93Q2xpZW50c0dyaWRPcHRpb25zLmRhdGE9JHNjb3BlLmFsbENsaWVudHM7Cn0KCiRzY29wZS5nb3RvQ2xpZW50UGFnZT0gZnVuY3Rpb24gKGJ1c2luZXNzVXNlcmlkKQp7CmdvdG9DbGllbnRQYWdlKGJ1c2luZXNzVXNlcmlkKTsKfQoKLy8gZmlsdGVyIGFyY2hpdmVkIGNsaWVudHMKJHNjb3BlLnNob3dBcmNoaXZlZENoZWNrYm94PWZhbHNlOwokc2NvcGUuc2hvd0FyY2hpdmVkID0gZnVuY3Rpb24gKGVjbGllbnQpCnsKaWYgKGVjbGllbnQuaXNfYWN0aXZlPT0wKQp7CmxvZ0RlYnVnKGVjbGllbnQpOwppZiAoJHNjb3BlLnNob3dBcmNoaXZlZENoZWNrYm94KQp7CnJldHVybiBlY2xpZW50Owp9Cn0KZWxzZSB7CnJldHVybiBlY2xpZW50Owp9Cn07Cgokc2NvcGUuY2xpZW50TmFtZUZpbHRlcj0iIjsKJHNjb3BlLmlucHV0RmlsdGVyID0gZnVuY3Rpb24gKGl0ZW0pCnsKICAgICAgLy8gY29uc29sZS5sb2coImNsaWVudE5hbWVGaWx0ZXIiKTsKcmV0dXJuIGZpbHRlcl9maXJzdGxhc3RfbmFtZShpdGVtLmJ1c2VyX2ZpcnN0X25hbWUsaXRlbS5idXNlcl9sYXN0X25hbWUsaXRlbS5idXNlcl9waG9uZV9udW1iZXIsJHNjb3BlLmNsaWVudE5hbWVGaWx0ZXIpOwp9OwoKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXM9W107Ci8vICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzID0gWwovLyAgIHsiZmllbGRfaWQiOjAsImZpZWxkX25hbWUiOiLXqteQ16jXmdeaINec15nXk9eUIiwiZmllbGRfZGF0YXR5cGUiOiJEQVRFIiwiaXNfbWFuZGF0b3J5IjowLCAiZnJvbWRiIjogZmFsc2UsICJkYl9pZF90b2ZpeCI6IDAsICJpc19hY3RpdmUiOiAxLCAibW9kaWZpZWQiOiBmYWxzZX0sCi8vICAgeyJmaWVsZF9pZCI6MCwiZmllbGRfbmFtZSI6IteU16LXqNeV16oiLCJmaWVsZF9kYXRhdHlwZSI6IlRFWFRfQVJFQSIsImlzX21hbmRhdG9yeSI6MCwgImZyb21kYiI6IGZhbHNlLCAiZGJfaWRfdG9maXgiOiAwLCAiaXNfYWN0aXZlIjogMSwgIm1vZGlmaWVkIjogZmFsc2V9Ci8vIF07CgpmdW5jdGlvbiBnZXRDbGllbnRzRXh0cmFGaWVsZHNfc3VjY2VzcygpCnsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMgPSAkc2NvcGUuZXh0cmFGaWVsZHM7Cn0KZ2V0Q2xpZW50c0V4dHJhRmllbGRzKCRodHRwLCRzY29wZSwnZXh0cmFGaWVsZHMnLGdldENsaWVudHNFeHRyYUZpZWxkc19zdWNjZXNzKTsKCiRzY29wZS5ldmVudFR5cGVFeHRyYUZpZWxkc1BvcCA9IGZ1bmN0aW9uKGV2ZW50VHlwZVByb3BlcnRpZXMpIHsKICAgICAgICBsb2dEZWJ1ZygiZXZlbnRUeXBlRXh0cmFGaWVsZHNQb3AzIik7Cgp2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKYW5pbWF0aW9uOiBmYWxzZSwKdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfY2xpZW50X2V4dHJhX2ZpZWxkcy5waHAnLApjb250cm9sbGVyOiAnZXZlbnRUeXBlRXh0cmFGaWVsZHNNb2RhbENvbnRyb2xsZXInLApzaXplOiAnbCcsCnJlc29sdmU6IHsKZXZlbnRUeXBlUHJvcGVydGllczogZnVuY3Rpb24oKSB7CnJldHVybiBldmVudFR5cGVQcm9wZXJ0aWVzOwp9Cn0KfSk7Cgptb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHNlbGVjdGVkSXRlbSkgewpsb2dEZWJ1ZyhzZWxlY3RlZEl0ZW0pOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyA9IHNlbGVjdGVkSXRlbTsKfSwgZnVuY3Rpb24oKSB7CmxvZ0RlYnVnKCdNb2RhbCBkaXNtaXNzZWQgYXQ6ICcgKyBuZXcgRGF0ZSgpKTsKfSk7Cn07Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignc2NoZWR1bGVyQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRyb3V0ZVBhcmFtcykgewpldmVudF90eXBlX2lkPSRyb3V0ZVBhcmFtcy5ldmVudF90eXBlX2lkOwoKJHNjb3BlLnN1Z2dlc3Rpb25EYXRlID0gW107CiRzY29wZS5zdWdnZXN0aW9uRGF0ZS5kYXRlID0gbmV3IERhdGUoKTsKJHNjb3BlLnN1Z2dlc3Rpb25EYXRlLm9wdGlvbnMgPSB7Ci8vIG1pbkRhdGU6IG5ldyBEYXRlKCksCi8vIHNob3dXZWVrczogdHJ1ZSwKbWluVmlldzonZGF5JywKc3RhcnRWaWV3OiAnZGF5JwoKfTsKdmFyIHRoZXRpbWUgPSBuZXcgRGF0ZSgpOwokc2NvcGUuZmlsdGVyQWxsRGF5c0NoZWNrYm94PXRydWU7CiRzY29wZS5maWx0ZXJEYXlJdGVtcyA9IHsKCifXqNeQ16nXldefJzogdHJ1ZSwKJ9ep16DXmSc6IHRydWUsCifXqdec15nXqdeZJzogdHJ1ZSwKJ9eo15HXmdei15knOiB0cnVlLAon15fXnteZ16nXmSc6IHRydWUsCifXqdeZ16nXmSc6IHRydWUsCifXqdeR16onOiB0cnVlCn07Cgokc2NvcGUub25UaW1lU2V0ID0gZnVuY3Rpb24gKG5ld0RhdGUsIG9sZERhdGUpIHsKbG9nRGVidWcoIm5ldyBkYXRlICIrbmV3RGF0ZS5nZXRUaW1lKCkgKyAiIG9sZCBkYXRlICIrb2xkRGF0ZS5nZXRUaW1lKCkpOwpkaWZmPW5ld0RhdGUuZ2V0VGltZSgpLW9sZERhdGUuZ2V0VGltZSgpOwovLyBpZiBuZXcgZGF0ZSBpcyBpbiBhIGRpZmZlcmVudCB3ZWVrCi8vIHdlIHJlZmV0Y2ggc3VnZ2VzdGlvbnMgZm9yIHRoZSBjdXJyZW50IHdlZWsKdmFyIG5ld0RhdGVXID0gbmV3IERhdGUobmV3RGF0ZSk7CnZhciBvbGREYXRlVyA9IG5ldyBEYXRlKG9sZERhdGUpOwovLyBhbGVydChuZXdEYXRlVy5mb3JtYXQoJ1cnKSk7Ci8vIGFsZXJ0KG9sZERhdGVXLmZvcm1hdCgnVycpKTsKaWYgKG5ld0RhdGVXLmZvcm1hdCgnVycpIT1vbGREYXRlVy5mb3JtYXQoJ1cnKSkKewpsb2dEZWJ1ZygiZGlmZiBpcyBhIHdlZWsgb3IgbW9yZSwgcmVmZXRjaGluZyBzdWdnZXN0aW9ucyIpOwokaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3QvIitldmVudF90eXBlX2lkKyIvIituZXdEYXRlLmdldEZ1bGxZZWFyKCkrIi8iKyhuZXdEYXRlLmdldE1vbnRoKCkrMSkrIi8iK25ld0RhdGUuZ2V0RGF0ZSgpKyIvIituZXdEYXRlLmdldEhvdXJzKCkgKyAiLyIgKyBuZXdEYXRlLmdldE1pbnV0ZXMoKSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkgewovLwkgICAgJHNjb3BlLm15RGF0YSA9IHJlc3BvbnNlLmRhdGE7Ci8vCQlsb2dEZWJ1ZygiZ3JpZG9wdGlvbnM9Iiskc2NvcGUuZ3JpZE9wdGlvbnMpOwokc2NvcGUuZXZlbnRzU3VnZ2VzdGVkID0gcmVzcG9uc2UuZGF0YTsKfSk7Cgp9Cn0KCiRzY29wZS5vcHRpb25zID0gewpjdXN0b21DbGFzczogZ2V0RGF5Q2xhc3MsCm1pbkRhdGU6IG5ldyBEYXRlKCksCnNob3dXZWVrczogdHJ1ZQp9Owokc2NvcGUuZHQgPSBuZXcgRGF0ZSgpOwoKCmZ1bmN0aW9uIGdldERheUNsYXNzKGRhdGEpIHsKcmV0dXJuICcnOwp9Cgokc2NvcGUuZGF5c0l0ZW1zID0gWwp7bmFtZTon16jXkNep15XXnyd9LAp7bmFtZTon16nXoNeZJ30sCntuYW1lOifXqdec15nXqdeZJ30sCntuYW1lOifXqNeR15nXoteZJ30sCntuYW1lOifXl9ee15nXqdeZJ30sCntuYW1lOifXqdeZ16nXmSd9LAp7bmFtZTon16nXkdeqJ30KXTsKCiRzY29wZS5maWx0ZXJBbGxEYXlJdGVtc1NldCA9IGZ1bmN0aW9uICgpCnsKJHNjb3BlLmZpbHRlckRheUl0ZW1zWyfXqNeQ16nXldefJ109JHNjb3BlLmZpbHRlckFsbERheXNDaGVja2JveDsKJHNjb3BlLmZpbHRlckRheUl0ZW1zWyfXqdeg15knXT0kc2NvcGUuZmlsdGVyQWxsRGF5c0NoZWNrYm94Owokc2NvcGUuZmlsdGVyRGF5SXRlbXNbJ9ep15zXmdep15knXT0kc2NvcGUuZmlsdGVyQWxsRGF5c0NoZWNrYm94Owokc2NvcGUuZmlsdGVyRGF5SXRlbXNbJ9eo15HXmdei15knXT0kc2NvcGUuZmlsdGVyQWxsRGF5c0NoZWNrYm94Owokc2NvcGUuZmlsdGVyRGF5SXRlbXNbJ9eX157Xmdep15knXT0kc2NvcGUuZmlsdGVyQWxsRGF5c0NoZWNrYm94Owokc2NvcGUuZmlsdGVyRGF5SXRlbXNbJ9ep15nXqdeZJ109JHNjb3BlLmZpbHRlckFsbERheXNDaGVja2JveDsKJHNjb3BlLmZpbHRlckRheUl0ZW1zWyfXqdeR16onXT0kc2NvcGUuZmlsdGVyQWxsRGF5c0NoZWNrYm94Owp9Cgokc2NvcGUuc3VnZ2VzdEZpbHRlckRheXMgPSBmdW5jdGlvbiAoZXN1Z2dlc3QpCnsKLy8gbG9nRGVidWcoZXN1Z2dlc3QpOwppZiAoKCRzY29wZS5maWx0ZXJEYXlJdGVtc1tlc3VnZ2VzdC5zdGFydF9mb3JtYXRfZG93XSkgJiAoKCRzY29wZS5zdWdnZXN0aW9uRGF0ZS5kYXRlLmdldFRpbWUoKS8xMDAwKTxlc3VnZ2VzdC5zdGFydF9lcG9jaCkpCnsKcmV0dXJuIGVzdWdnZXN0Owp9Cn07Cgpsb2dEZWJ1Zygnc2NoZWR1bGVyQ29udHJvbGxlciBmb3IgZXZlbnQgdHlwZSBpZCAnK2V2ZW50X3R5cGVfaWQrIiAiK3RoZXRpbWUuZ2V0SG91cnMoKSArICI6IiArIHRoZXRpbWUuZ2V0TWludXRlcygpICsgIjoiICsgdGhldGltZS5nZXRTZWNvbmRzKCkpOwokaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3QvIitldmVudF90eXBlX2lkKyIvIit0aGV0aW1lLmdldEZ1bGxZZWFyKCkrIi8iKyh0aGV0aW1lLmdldE1vbnRoKCkrMSkrIi8iK3RoZXRpbWUuZ2V0RGF0ZSgpKyIvIit0aGV0aW1lLmdldEhvdXJzKCkgKyAiLyIgKyB0aGV0aW1lLmdldE1pbnV0ZXMoKSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkgewovLwkgICAgJHNjb3BlLm15RGF0YSA9IHJlc3BvbnNlLmRhdGE7Ci8vCQlsb2dEZWJ1ZygiZ3JpZG9wdGlvbnM9Iiskc2NvcGUuZ3JpZE9wdGlvbnMpOwokc2NvcGUuZXZlbnRzU3VnZ2VzdGVkID0gcmVzcG9uc2UuZGF0YTsKfSk7CgokaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRfdHlwZXMvIitldmVudF90eXBlX2lkKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7Ci8vCSAgICAkc2NvcGUubXlEYXRhID0gcmVzcG9uc2UuZGF0YTsKLy8JCWxvZ0RlYnVnKCJncmlkb3B0aW9ucz0iKyRzY29wZS5ncmlkT3B0aW9ucyk7CiRzY29wZS5ldmVudFR5cGVEZXRhaWxzID0gcmVzcG9uc2UuZGF0YTsKfSk7Cn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdjb250YWN0Q29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHApIHsKbG9nRGVidWcoJ2NvbnRhY3RDb250cm9sbGVyJyk7Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcigncGFja2FnZVBheW1lbnRBc3NvY2lhdGlvbk1vZGFsQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHJvdXRlUGFyYW1zLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIGZwYWNrYWdlLCBiYWxhbmNlLCBidXNpbmVzc191c2VyX2lkLCB1aUNhbGVuZGFyQ29uZmlnKQp7CmxvZ0RlYnVnKCJwYWNrYWdlUGF5bWVudEFzc29jaWF0aW9uTW9kYWxDb250cm9sbGVyIik7Cgokc2NvcGUuZnBhY2thZ2U9ZnBhY2thZ2U7CiRzY29wZS5iYWxhbmNlPWJhbGFuY2U7CiRzY29wZS5wYWNrYWdlX3BheW1lbnRzPSRzY29wZS5mcGFja2FnZS5wYWNrYWdlX3BheW1lbnRzOwokc2NvcGUucHJldmlvdXNfaXNfYWxsX3BhaWQ9JHNjb3BlLmZwYWNrYWdlLmlzX2FsbF9wYWlkOwokc2NvcGUuYnVzaW5lc3NfdXNlcl9pZD1idXNpbmVzc191c2VyX2lkOwoKLy8gJ2NhbGN1bGF0aW5nJyBwcmV2aW91cyBzdGF0dXMgb2YgcGF5bWVudAppZiAoJHNjb3BlLnBhY2thZ2VfcGF5bWVudHM+MCkKewppZiAoJHNjb3BlLnByZXZpb3VzX2lzX2FsbF9wYWlkPT0xKQp7CiRzY29wZS5wcmV2aW91c19zdGF0dXM9ImlzX2FsbF9wYWlkIjsKJHNjb3BlLnBhY2thZ2Vfc3RhdHVzX2lkPS0xOwokc2NvcGUucHJldmlvdXNfcGFja2FnZV9zdGF0dXNfaWQ9LTE7Cn0KZWxzZQp7CiRzY29wZS5wcmV2aW91c19zdGF0dXM9ImlzX3BhcnRseV9wYWlkIjsKJHNjb3BlLnBhY2thZ2Vfc3RhdHVzX2lkPS0xOwokc2NvcGUucHJldmlvdXNfcGFja2FnZV9zdGF0dXNfaWQ9LTE7Cn0KfQplbHNlCnsKJHNjb3BlLnByZXZpb3VzX3N0YXR1cz0ibm90X3BhaWQiOwokc2NvcGUucGFja2FnZV9zdGF0dXNfaWQ9MDsKJHNjb3BlLnByZXZpb3VzX3BhY2thZ2Vfc3RhdHVzX2lkPTA7Cgp9CmxvZ0RlYnVnKCJwcmV2aW91c19zdGF0dXM9Iiskc2NvcGUucHJldmlvdXNfc3RhdHVzKTsKCiRzY29wZS5jbG9zZU1vZGFsID0gZnVuY3Rpb24oKQp7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKfTsKJHNjb3BlLnVwZGF0ZVBhY2thZ2VQYXltZW50ID0gZnVuY3Rpb24oKQp7Ci8vIGNvbnNvbGUubG9nKCJwcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ9Iiskc2NvcGUuZm1lZXRpbmcucHJldmlvdXNfcGFja2FnZV91c2VyX2lkKTsKLy8gY29uc29sZS5sb2coInBhY2thZ2VfdXNlcl9pZD0iKyRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQpOwpsb2dEZWJ1ZygidXBkYXRlUGFja2FnZVBheW1lbnQiKQovLyBpZiBzZWxlY3RlZCBwYWNrYWdlIGlzIGxpa2UgcHJldmlvdXMgcGFja2FnZSAtIGRvIG5vdGhpbmcKaWYgKCgkc2NvcGUucHJldmlvdXNfcGFja2FnZV9zdGF0dXNfaWQ9PSRzY29wZS5wYWNrYWdlX3N0YXR1c19pZCkpCnsKbG9nRGVidWcoInNlbGVjdGVkIG9wdGlvbiBpcyBsaWtlIHByZXZpb3VzIG9wdGlvbiAtIGRvIG5vdGhpbmciKTsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwp9CgovLyBwcmV2aW91cyBwYWNrYWdlIHdhcyBwYWlkL3BhcnRseS1wYWlkIC0gbm93IG5vdGhpbmdzIGlzIHNlbGVjdGVkCmVsc2UgaWYgKCgkc2NvcGUucHJldmlvdXNfcGFja2FnZV9zdGF0dXNfaWQ9PS0xKSAmJiAoJHNjb3BlLnBhY2thZ2Vfc3RhdHVzX2lkPT0wKSkKewpsb2dEZWJ1Zygid2FzIHBhaWQvcGFydGx5IHBhaWQsIHJlbW92aW5nIHBheW1lbnQiKTsKcmVtb3ZlUGFja2FnZVBheW1lbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5mcGFja2FnZS5wYWNrYWdlX3VzZXJfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwp9Ci8vIHByZXZpb3VzIHBhY2thZ2Ugd2FzIHNlbGVjdGVkIC0gbm93IGEgZGlmZmVyZW50IHBhY2thZ2UgaXMgc2VsZWN0ZWQKZWxzZSBpZiAoKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3N0YXR1c19pZD09MCkgJiYgKCRzY29wZS5wYWNrYWdlX3N0YXR1c19pZD09LTEpKQp7CmxvZ0RlYnVnKCJ3YXMgbm90IHBhaWQgLSBub3cgcGF5IGZ1bGx5L3BhcnRpYWxseSIpOwpwYXlGb3JQYWNrYWdlKCRodHRwLCRzY29wZSwkc2NvcGUuZnBhY2thZ2UucGFja2FnZV91c2VyX2lkLCRzY29wZS5idXNpbmVzc191c2VyX2lkLHVwZGF0ZUV2ZW50UGFja2FnZV9zdWNjZXNzKTsKCi8vIHJlYXNzaWduRXZlbnRQYWNrYWdlQXNzb2NpYXRpb24oJGh0dHAsJHNjb3BlLCRzY29wZS5mbWVldGluZy5ldmVudF9pZCwkc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkLCRzY29wZS5idXNpbmVzc191c2VyX2lkLHVwZGF0ZUV2ZW50UGFja2FnZV9zdWNjZXNzKTsKfQp9CgpmdW5jdGlvbiB1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2VzcygpCnsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwpsb2dEZWJ1ZygiYnJvYWRjYXN0aW5nIGNsaWVudFBhZ2VSZWxvYWREYXRhIik7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKfQoKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2V2ZW50UGFja2FnZUFzc29jaWF0aW9uTW9kYWxDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkcm91dGVQYXJhbXMsICRyb290U2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgZm1lZXRpbmcsIGJhbGFuY2UsIGJ1c2luZXNzX3VzZXJfaWQsIHVpQ2FsZW5kYXJDb25maWcpCnsKJHNjb3BlLmZtZWV0aW5nPWFuZ3VsYXIuY29weShmbWVldGluZyk7CiRzY29wZS5iYWxhbmNlPWJhbGFuY2U7CiRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ9JHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZDsKJHNjb3BlLnByZXZpb3VzX2V2ZW50X3BheW1lbnRzPSRzY29wZS5mbWVldGluZy5ldmVudF9wYXltZW50czsKJHNjb3BlLnByZXZpb3VzX2lzX2FsbF9wYWlkPSRzY29wZS5mbWVldGluZy5pc19hbGxfcGFpZDsKJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQ9YnVzaW5lc3NfdXNlcl9pZDsKCi8vICdjYWxjdWxhdGluZycgcHJldmlvdXMgc3RhdHVzIG9mIHBheW1lbnQKaWYgKCRzY29wZS5wcmV2aW91c19ldmVudF9wYXltZW50cz4wKQp7CmlmICgkc2NvcGUucHJldmlvdXNfaXNfYWxsX3BhaWQ9PTEpCnsKJHNjb3BlLnByZXZpb3VzX3N0YXR1cz0iaXNfYWxsX3BhaWQiOwp9CmVsc2UKewokc2NvcGUucHJldmlvdXNfc3RhdHVzPSJpc19wYXJ0bHlfcGFpZCI7Cn0KfQplbHNlCnsKaWYgKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ+MCkKewokc2NvcGUucHJldmlvdXNfc3RhdHVzPSJpc19wYWNrYWdlX3BhaWQiOwp9CmVsc2UKewokc2NvcGUucHJldmlvdXNfc3RhdHVzPSJub3RfcGFpZCI7Cn0KfQpsb2dEZWJ1ZygicHJldmlvdXNfc3RhdHVzPSIrJHNjb3BlLnByZXZpb3VzX3N0YXR1cyk7CgppZiAoKCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQ9PTApICYmICgkc2NvcGUuZm1lZXRpbmcuZXZlbnRfcGF5bWVudHM+MCkpCnsKLy8gdGhpcyBpcyBhIGNhc2Ugd2hlcmUgcGF5bWVudCB3YXMgcGFydGx5IG9yIGZ1bGx5IG1hZGUgZnJvbSBiYWxhbmNlCiRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQ9LTE7CiRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ9LTE7Cn0KCmxvZ0RlYnVnKCJldmVudFBhY2thZ2VBc3NvY2lhdGlvbk1vZGFsQ29udHJvbGxlciIpOwpnZXRQYWNrYWdlc0ZvckV2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJ3JlbGF0ZWRQYWNrYWdlcycsZ2V0UGFja2FnZXNGb3JFdmVudF9zdWNjZXNzKTsgLy8gd2FzIGdldEJ1c2luZXNzUGFja2FnZQpmdW5jdGlvbiBnZXRQYWNrYWdlc0ZvckV2ZW50X3N1Y2Nlc3MoKQp7Cn0KCiRzY29wZS5jbG9zZU1vZGFsID0gZnVuY3Rpb24oKQp7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKfTsKJHNjb3BlLnVwZGF0ZUV2ZW50UGFja2FnZSA9IGZ1bmN0aW9uKCkKewpjb25zb2xlLmxvZygicHJldmlvdXNfcGFja2FnZV91c2VyX2lkPSIrJHNjb3BlLmZtZWV0aW5nLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZCk7CmNvbnNvbGUubG9nKCJwYWNrYWdlX3VzZXJfaWQ9Iiskc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkKTsKLy8gaWYgc2VsZWN0ZWQgcGFja2FnZSBpcyBsaWtlIHByZXZpb3VzIHBhY2thZ2UgLSBkbyBub3RoaW5nCmlmICgoJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD09JHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZCkpCnsKbG9nRGVidWcoInNlbGVjdGVkIG9wdGlvbiBpcyBsaWtlIHByZXZpb3VzIG9wdGlvbiAtIGRvIG5vdGhpbmciKTsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwp9Ci8vIGlmIHNlbGVjdGVkIHBhY2thZ2UgaXMgbGlrZSBwcmV2aW91cyBwYWNrYWdlIC0gZG8gbm90aGluZwppZiAoKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ9PSRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQpICYmICgkc2NvcGUucHJldmlvdXNfcGFja2FnZV91c2VyX2lkPjApKQp7CmxvZ0RlYnVnKCJzZWxlY3RlZCBwYWNrYWdlIGlzIGxpa2UgcHJldmlvdXMgcGFja2FnZSAtIGRvIG5vdGhpbmciKTsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwp9Ci8vIHByZXZpb3VzIHBhY2thZ2Ugd2FzIHNlbGVjdCAtIG5vdyBub3RoaW5ncyBpcyBzZWxlY3RlZAplbHNlIGlmICgoJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD4wKSAmJiAoJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZD09MCkpCnsKbG9nRGVidWcoIm5vIHBhY2thZ2Ugc2VsZWN0ZWQsIHJlbW92ZSBwYWNrYWdlLWV2ZW50IGFzc29jaWF0aW9uIik7CnJlbW92ZUV2ZW50UGFja2FnZUFzc29jaWF0aW9uKCRodHRwLCRzY29wZSwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwp9Ci8vIHByZXZpb3VzIHBhY2thZ2Ugd2FzIHNlbGVjdGVkIC0gbm93IGEgZGlmZmVyZW50IHBhY2thZ2UgaXMgc2VsZWN0ZWQKZWxzZSBpZiAoKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ+MCkgJiYgKCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQ+MCkpCnsKbG9nRGVidWcoInVwZGF0aW5nIG5ldyBwYWNrYWdlIHRvIHBhY2thZ2VfdXNlcl9pZD0gIiskc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkKTsKcmVhc3NpZ25FdmVudFBhY2thZ2VBc3NvY2lhdGlvbigkaHR0cCwkc2NvcGUsJHNjb3BlLmZtZWV0aW5nLmV2ZW50X2lkLCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwp9Ci8vIHByZXZpb3VzIHBhY2thZ2Ugd2FzIG5vbmUgLSBub3cgYSBwYWNrYWdlIGlzIHNlbGVjdGVkCmVsc2UgaWYgKCgkc2NvcGUucHJldmlvdXNfcGFja2FnZV91c2VyX2lkPT0wKSAmJiAoJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZD4wKSkKewpsb2dEZWJ1ZygidXBkYXRpbmcgbmV3IHBhY2thZ2UgdG8gcGFja2FnZV91c2VyX2lkPSAiKyRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQpOwpyZWFzc2lnbkV2ZW50UGFja2FnZUFzc29jaWF0aW9uKCRodHRwLCRzY29wZSwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZCwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCx1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2Vzcyk7Cn0KLy8gcHJldmlvdXMgYXNzb2NpYXRpb24gd2FzIHBhaWQgb3IgaGFsZiBwYWlkIC0gbm93IGl0cyBub25lCmVsc2UgaWYgKCgkc2NvcGUucHJldmlvdXNfZXZlbnRfcGF5bWVudHM+MCkgJiYgKCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQ9PTApKQp7CmxvZ0RlYnVnKCJyZW1vdmluZyBwYXltZW50IGZyb20gZXZlbnQsIHBhY2thZ2VfdXNlcl9pZD0gIiskc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkKTsKcmVtb3ZlRXZlbnRQYXltZW50QXNzb2NpYXRpb24oJGh0dHAsJHNjb3BlLCRzY29wZS5mbWVldGluZy5ldmVudF9pZCwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCx1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2Vzcyk7CgovLyByZWFzc2lnbkV2ZW50UGFja2FnZUFzc29jaWF0aW9uKCRodHRwLCRzY29wZSwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZCwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCx1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2Vzcyk7Ci8vIHRvZG8KfQovLyB3YXMgcGFja2FnZSBwYXltZW50IC0+IG5vdyBiYWxhbmNlIHBheW1lbnQKZWxzZSBpZiAoKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ+MCkgJiYgKCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQ9PS0xKSkKewpsb2dEZWJ1ZygibW92aW5nIHBheW1lbnQgZnJvbSBwYWNrYWdlIHRvIGJhbGFuY2UiKTsKYWRkRXZlbnRQYXltZW50UmVtb3ZlUGFja2FnZSgkaHR0cCwkc2NvcGUsJHNjb3BlLmZtZWV0aW5nLmV2ZW50X2lkLCRzY29wZS5idXNpbmVzc191c2VyX2lkLHVwZGF0ZUV2ZW50UGFja2FnZV9zdWNjZXNzKTsKfQovLyB3YXMgYmFsYW5jZSBwYXltZW50IC0+IG5vdyBwYWNrYWdlIHBheW1lbnQKZWxzZSBpZiAoKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ9PS0xKSAmJiAoJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZD4wKSkKewpsb2dEZWJ1ZygibW92aW5nIHBheW1lbnQgZnJvbSBiYWxhbmNlIHRvIHBhY2thZ2UiKTsKYWRkRXZlbnRQYWNrYWdlUmVtb3ZlUGF5bWVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLmZtZWV0aW5nLmV2ZW50X2lkLCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwoKfQovLyB3YXMgbm90IHBhaWQgYXQgYWxsIC0+IG5vdyBiYWxhbmNlIHBheQplbHNlIGlmICgoJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD09MCkgJiYgKCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQ9PS0xKSkKewpsb2dEZWJ1ZygibW92aW5nIHBheW1lbnQgZnJvbSBub25lIHRvIGJhbGFuY2UiKTsKYWRkRXZlbnRQYXltZW50QXNzb2NpYXRpb24oJGh0dHAsJHNjb3BlLCRzY29wZS5mbWVldGluZy5ldmVudF9pZCwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCx1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2Vzcyk7Cn0KfQoKZnVuY3Rpb24gdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MoKQp7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKbG9nRGVidWcoImJyb2FkY2FzdGluZyBjbGllbnRQYWdlUmVsb2FkRGF0YSIpOwokcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NsaWVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCn0KCn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignYXJjaGl2ZV9jbGllbnRfbW9kYWwnLCBmdW5jdGlvbigkc2NvcGUsICRsb2NhdGlvbiwgaXNfaW5zdHJ1Y3RvciwgYnVzaW5lc3NfdXNlcl9pZCwgYnVzZXJfZmlyc3RfbmFtZSwgYnVzZXJfbGFzdF9uYW1lLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIHVpQ2FsZW5kYXJDb25maWcpIHsKJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQ9YnVzaW5lc3NfdXNlcl9pZDsKJHNjb3BlLmJ1c2VyX2ZpcnN0X25hbWU9YnVzZXJfZmlyc3RfbmFtZTsKJHNjb3BlLmJ1c2VyX2xhc3RfbmFtZT1idXNlcl9sYXN0X25hbWU7CiRzY29wZS5pc19pbnN0cnVjdG9yPWlzX2luc3RydWN0b3I7Cgpsb2dEZWJ1ZygiYXJjaGl2ZV9jbGllbnRfbW9kYWwgY29udHJvbGxlciIpOwoKJHNjb3BlLmNsb3NlTW9kYWwgPSBmdW5jdGlvbigpIHsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwp9OwoKJHNjb3BlLmFyY2hpdmVDbGllbnQgPSBmdW5jdGlvbigpCnsKYXJjaGl2ZUNsaWVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsYXJjaGl2ZUNsaWVudF9zdWNjZXNzKTsKZnVuY3Rpb24gYXJjaGl2ZUNsaWVudF9zdWNjZXNzKCkKewokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CmlmICgkc2NvcGUuaXNfaW5zdHJ1Y3RvcikKewokbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2luc3RydWN0b3JzJyk7Cn0KZWxzZSB7CiRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfY2xpZW50cycpOwp9Cn0KfQoKfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdwYXltZW55RGV0YWlsc01vZGFsQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHJvdXRlUGFyYW1zLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIGZwYXltZW50LCB1aUNhbGVuZGFyQ29uZmlnKSB7CiRzY29wZS5mcGF5bWVudD17fTsKJHNjb3BlLmZwYXltZW50LnBheW1lbnRfZGF0ZT1mcGF5bWVudC5wYXltZW50X2RhdGU7CiRzY29wZS5mcGF5bWVudC5wYXltZW50X2Ftb3VudD1mcGF5bWVudC5wYXltZW50X2Ftb3VudDsKJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZ2VuZXJhdGVkPWZwYXltZW50Lmludm9pY2VfZ2VuZXJhdGVkOwokc2NvcGUuZnBheW1lbnQuaW52b2ljZV9udW1iZXI9ZnBheW1lbnQuaW52b2ljZV9udW1iZXI7CmlmIChmcGF5bWVudC5pbnZvaWNlX2RhdGU9PW51bGwpCnsKJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZV9mb3JtYXQ9bmV3IERhdGUoKTsKfQplbHNlCnsKJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZV9mb3JtYXQ9ZnBheW1lbnQuaW52b2ljZV9kYXRlX2Zvcm1hdDsKfQokc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlPWZwYXltZW50Lmludm9pY2VfZGF0ZTsKJHNjb3BlLnNlbGVjdGVkUGF5bWVudE1ldGhvZD17Cm5hbWU6IGZwYXltZW50LnBheW1lbnRfbWV0aG9kX25hbWVfdHh0LAptZXRob2Q6IGZwYXltZW50LnBheW1lbnRfbWV0aG9kX25hbWUKfTsKJHNjb3BlLmlzUGF5bWVudE1ldGhvZFNlbGVjdGVkPXRydWU7Cgpsb2dEZWJ1Zygib2xkIGRhdGUgIiskc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlKTsKaWYgKCRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2RhdGUhPW51bGwpCnsKJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZV9mb3JtYXQgPSBuZXcgRGF0ZSgkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlKTsKfQokc2NvcGUucGF5bWVudE1ldGhvZHMgPSBwYXltZW50TWV0aG9kczsKJHNjb3BlLnBheW1lbnRUeXBlVGl0bGU9ZnBheW1lbnQucGF5bWVudF9tZXRob2RfbmFtZV90eHQ7CiRzY29wZS5mcGF5bWVudC5pbnZvaWNlX3NvdXJjZT0iRVhURVJOQUwiOwoKbG9nRGVidWcoJHNjb3BlLnBheW1lbnRNZXRob2RzKTsKbG9nRGVidWcoInBheW1lbnlEZXRhaWxzTW9kYWxDb250cm9sbGVyIGZvciBwYXltZW50ICIrSlNPTi5zdHJpbmdpZnkoZnBheW1lbnQsIG51bGwsIDQpKTsKCiRzY29wZS5zZWxlY3RQYXltZW50TWV0aG9kID0gZnVuY3Rpb24ocGF5bWVudCkgewokc2NvcGUucGF5bWVudFR5cGVUaXRsZT1wYXltZW50Lm5hbWU7CmxvZ0RlYnVnKCJwYXltZW50PSIrcGF5bWVudCk7Cgokc2NvcGUuc2VsZWN0ZWRQYXltZW50TWV0aG9kPXBheW1lbnQ7CiRzY29wZS5pc1BheW1lbnRNZXRob2RTZWxlY3RlZD10cnVlOwp9OwoKJHNjb3BlLmNsb3NlTW9kYWwgPSBmdW5jdGlvbigpIHsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwp9OwoKJHNjb3BlLnVwZGF0ZVBheW1lbnQgPSBmdW5jdGlvbigpCnsKLy8gbG9nRGVidWcoY3VycmVudENsaWVudCk7CmxvZ0RlYnVnKCJwYXltZW50IG1ldGhvZCIpOwpsb2dEZWJ1Zygkc2NvcGUuc2VsZWN0ZWRQYXltZW50TWV0aG9kKTsKbG9nRGVidWcoIiRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2dlbmVyYXRlZD08Iiskc2NvcGUuZnBheW1lbnQuaW52b2ljZV9nZW5lcmF0ZWQrIj4sICRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2RhdGVfZm9ybWF0PSIrJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZV9mb3JtYXQpOwpsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkUGF5bWVudE1ldGhvZC5tZXRob2Q9Iiskc2NvcGUuc2VsZWN0ZWRQYXltZW50TWV0aG9kLm1ldGhvZCk7CmlmICgoJHNjb3BlLmZwYXltZW50LnBheW1lbnRfYW1vdW50PT0wKSB8fCAoJHNjb3BlLmZwYXltZW50LnBheW1lbnRfYW1vdW50PT0nJykgfHwgKCRzY29wZS5mcGF5bWVudC5wYXltZW50X2Ftb3VudD09bnVsbCkpCnsKJHNjb3BlLnVzZXJFcnJvcj0i15DXoNeQINeU15bXnyDXodeb15XXnSDXm9ec16nXlNeVIjsKLy8gYWxlcnQoJ3NzJyk7Cn0KZWxzZSBpZiAoISRzY29wZS5pc1BheW1lbnRNZXRob2RTZWxlY3RlZCkKewokc2NvcGUudXNlckVycm9yPSLXkNeg15Ag15HXl9eoINeQ157Xptei15kg16rXqdec15XXnSI7Ci8vIGFsZXJ0KCdzcycpOwp9CmVsc2UKewppZiAoKCRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2dlbmVyYXRlZCE9MSkgfHwgKCRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2RhdGVfZm9ybWF0PT1udWxsKSkKewp2YXIgaW52b2ljZV9kYXRlX2Zvcm1hdCA9ICJudWxsIjsKfQplbHNlCnsKdmFyIGludm9pY2VfZGF0ZV9mb3JtYXQgPSAkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlX2Zvcm1hdC5nZXREYXRlKCkgICsgIi0iICsgKCRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2RhdGVfZm9ybWF0LmdldE1vbnRoKCkrMSkgKyAiLSIgKyAkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlX2Zvcm1hdC5nZXRGdWxsWWVhcigpOwp9CnRoZWRhdGE9IHsKYmFsYW5jZVRvUGF5OiAkc2NvcGUuZnBheW1lbnQucGF5bWVudF9hbW91bnQsCnBheW1lbnRfbWV0aG9kX25hbWU6ICRzY29wZS5zZWxlY3RlZFBheW1lbnRNZXRob2QubWV0aG9kLAppbnZvaWNlX251bWJlcjogJHNjb3BlLmZwYXltZW50Lmludm9pY2VfbnVtYmVyLAppbnZvaWNlX2dlbmVyYXRlZDogJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZ2VuZXJhdGVkLAppbnZvaWNlX2RhdGU6IGludm9pY2VfZGF0ZV9mb3JtYXQsCmludm9pY2Vfc291cmNlOiAkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9zb3VyY2UKfTsKdXBkYXRlUGF5bWVudEZvckNsaWVudCgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsZnBheW1lbnQudXNlcl9wYXltZW50X2lkLHRoZWRhdGEsY3JlYXRlUGF5bWVudEZvckNsaWVudF9jYWxsYmFjaywgY3JlYXRlUGF5bWVudEZvckNsaWVudF9mYWlsdXJlKTsKZnVuY3Rpb24gY3JlYXRlUGF5bWVudEZvckNsaWVudF9jYWxsYmFjaygpCnsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwpsb2dEZWJ1ZygiYnJvYWRjYXN0aW5nIGNsaWVudFBhZ2VSZWxvYWREYXRhIik7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKfQpmdW5jdGlvbiBjcmVhdGVQYXltZW50Rm9yQ2xpZW50X2ZhaWx1cmUoKQp7CmxvZ0RlYnVnKCJicm9hZGNhc3RpbmcgY2xpZW50UGFnZVJlbG9hZERhdGEiKTsKLy8gJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwp9Cn0KfQp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ2V2ZW50VHlwZUV4dHJhRmllbGRzTW9kYWxDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIGV2ZW50VHlwZVByb3BlcnRpZXMsIHVpQ2FsZW5kYXJDb25maWcpIHsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXM9ZXZlbnRUeXBlUHJvcGVydGllczsKICBsb2dEZWJ1ZygiZXZlbnRUeXBlRXh0cmFGaWVsZHNNb2RhbENvbnRyb2xsZXI9IitKU09OLnN0cmluZ2lmeShldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzLCBudWxsLCA0KSk7CmlmIChldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzPT1udWxsKQp7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzT3JpZz1bXTsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHM9W107Cn0KZWxzZSBpZiAoZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcy5sZW5ndGg+MCkKewokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllc09yaWc9KGV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMpLnNsaWNlKDApOwp9CmVsc2UKewokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllc09yaWc9W107CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzPVtdOwp9CiRzY29wZS5va0xpbWl0YXRpb25Nb2RhbCA9IGZ1bmN0aW9uKCkgewokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7Cn07Cgokc2NvcGUuY2FuY2VsID0gZnVuY3Rpb24oKQp7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzPSRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzT3JpZzsKbG9nRGVidWcoImNsb3NlIik7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzT3JpZyk7Cn0KJHNjb3BlLnNhdmVBbmRDbG9zZSA9IGZ1bmN0aW9uKCkKewpsb2dEZWJ1Zygic2F2ZSBhbmQgY2xvc2UiKTsKZnVuY3Rpb24gc2V0Q2xpZW50c0V4dHJhRmllbGRzX3N1Y2Nlc3MoKQp7Cgp9CiRzY29wZS5DbGllbnRzRGV0YWlscz17fTsKJHNjb3BlLkNsaWVudHNEZXRhaWxzLmV4dHJhRmllbGRzPSRzY29wZS5leHRyYUZpZWxkczsKc2V0Q2xpZW50c0V4dHJhRmllbGRzKCRodHRwLCRzY29wZSwkc2NvcGUuQ2xpZW50c0RldGFpbHMsc2V0Q2xpZW50c0V4dHJhRmllbGRzX3N1Y2Nlc3MpOwokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyk7Cn0KCiAgJHNjb3BlLmR1cGxpY2F0ZUZpZWxkTmFtZXM9IiI7CiRzY29wZS5hZGRFeHRyYUZpZWxkcyA9IGZ1bmN0aW9uKCkKewogICAgbG9nRGVidWcoImFkZEV4dHJhRmllbGRzIHZhbGlkYXRpbmciKTsKICAgIC8vIGNoZWNraW5nIGZvciBkdXBsaWNhdGUgbmFtZXMKICAgIHZhciBleHRyYUZpZWxkc05hbWVzID0gW107CiAgICBmb3IgKHZhciBpPTE7IGk8JHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMubGVuZ3RoOyBpKyspCiAgICB7CiAgICAgIGV4dHJhRmllbGRzTmFtZXMucHVzaCgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkc1tpXS5maWVsZF9uYW1lKTsKICAgIH0KICAgIGV4dHJhRmllbGRzTmFtZXMuc29ydCgpOwogICAgdmFyIGxhc3QgPSBleHRyYUZpZWxkc05hbWVzWzBdOwogICAgZm9yICh2YXIgaT0xOyBpPGV4dHJhRmllbGRzTmFtZXMubGVuZ3RoOyBpKyspCiAgICB7CiAgICAgICBpZiAoZXh0cmFGaWVsZHNOYW1lc1tpXSA9PSBsYXN0KQogICAgICAgewogICAgICAgIC8vICBhbGVydCgnRHVwbGljYXRlIDogJytsYXN0KTsKICAgICAgICAgJHNjb3BlLmR1cGxpY2F0ZUZpZWxkTmFtZXM9J9en15nXmdedINep15PXlCDXm9ek15XXnCDXkdep150gIicrbGFzdCsnIi4uLic7CiAgICAgICAgIHJldHVybjsKICAgICAgIH0KICAgICAgIGxhc3QgPSBleHRyYUZpZWxkc05hbWVzW2ldOwogICAgfQokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyk7Cn0KCiRzY29wZS5leHRyYUZpZWxkcyA9IGV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHM7CiRzY29wZS5maWVsZFR5cGVzID0gW3tmaWVsZF9kYXRhdHlwZTogIlRFWFRfQVJFQSIsIG5hbWU6J9eq15nXkdeqINeY16fXodeYJ30sIHtmaWVsZF9kYXRhdHlwZTogIk5VTUJFUiIsIG5hbWU6J9ee16HXpNeoJ30gLCB7ZmllbGRfZGF0YXR5cGU6ICJTVFJJTkciLCBuYW1lOifXmNen16HXmCDXp9em16gnfSAsIHtmaWVsZF9kYXRhdHlwZTogIkJPT0xFQU4iLCBuYW1lOifXqteZ15HXqiDXodeZ157XldefJ30gLCB7ZmllbGRfZGF0YXR5cGU6ICJEQVRFIiwgbmFtZTon16rXkNeo15nXmid9XTsKCiRzY29wZS5hZGROZXdGaWVsZCA9IGZ1bmN0aW9uKCkgewp2YXIgbmV3SXRlbU5vID0gJHNjb3BlLmV4dHJhRmllbGRzLmxlbmd0aCsxOwokc2NvcGUuZXh0cmFGaWVsZHMucHVzaCh7ImZpZWxkX2RhdGF0eXBlIjoiU1RSSU5HIiwiaXNfbWFuZGF0b3J5IjowLCAiZnJvbWRiIjogZmFsc2UsICJmaWVsZF9pZCI6IDAsICJpc19hY3RpdmUiOiAxLCAibW9kaWZpZWQiOiAwfSk7CgogICAgbG9nRGVidWcoImV4dHJhIGZpZWxkczogIiArIEpTT04uc3RyaW5naWZ5KCRzY29wZS5leHRyYUZpZWxkcywgbnVsbCwgMikpOwoKfTsKCiRzY29wZS5yZW1vdmVGaWVsZCA9IGZ1bmN0aW9uKGNob2ljZSkKewovLyByZW1vdmluZyBmaWVsZAovLyBpZiBpdHMgbm90IG9yaWdpbmF0ZWQgZnJvbSBkYXRhYmFzZSAtIHRoZW4gd2Ugc2ltcGx5IGRlbGV0ZSBpdCBmcm9tIHRoZSBhcnJheQovLyBvdGhlcndpc2Ugd2UgbWFyayBpdCBhcyBhY3RpdmU9ZmFsc2UKbG9nRGVidWcoY2hvaWNlKTsKLy8gdmFyIGxhc3RJdGVtID0gKGNob2ljZS5pZCktMTsvLyRzY29wZS5jaG9pY2VzLmxlbmd0aC0xOwovLyAkc2NvcGUuY2hvaWNlcy5zcGxpY2UobGFzdEl0ZW0sMSk7CmZvcih2YXIgaSA9IDA7IGkgPCAkc2NvcGUuZXh0cmFGaWVsZHMubGVuZ3RoOyBpKyspCnsKaWYgKCRzY29wZS5leHRyYUZpZWxkc1tpXSA9PSBjaG9pY2UpCnsKaWYgKGNob2ljZS5mcm9tZGI9PWZhbHNlKQp7Ci8vIGlmIG5vdCBmcm9tIGRiIC0gcmVtb3ZpbmcgaXQgZnJvbSB0aGUgYXJyYXkgb2YgZXh0cmEtZmllbGRzCiRzY29wZS5leHRyYUZpZWxkcy5zcGxpY2UoaSwgMSk7Cn0KZWxzZQp7Ci8vIGlmIGZpZWxkIG9yaWdpbmF0ZWQgZnJvbSBkYiAtIHRoYW4gd2UgZG9udCByZW1vdmUgaXQgZnJvbSB0aGUgYXJyYXkKLy8gYW5kIG1hcmsgaXQgYXMgYWN0aXZlPWZhbHNlIHNvIHRoYXQgaXQgY2FuIGJlIGhhbmRlbGVkIG9uIHRoZSBzZXJ2ZXIKY2hvaWNlLmlzX2FjdGl2ZT0wOwpjaG9pY2UubW9kaWZpZWQ9dHJ1ZTsKfQpicmVhazsKfQp9Cn07Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignZXZlbnRDbG9zZUlnbm9yZU1hbmRhdG9yeUZpZWxkc01vZGFsQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHJvdXRlUGFyYW1zLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIGN1cnJlbnRFdmVudCwgdWlDYWxlbmRhckNvbmZpZykgewokc2NvcGUuY3VycmVudEV2ZW50PWN1cnJlbnRFdmVudDsKCiRzY29wZS5va0NhbmNlbCA9IGZ1bmN0aW9uKCkgewokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7Cn07Cgokc2NvcGUuY2xvc2VFdmVudElnbm9yZU1hbmRhdG9yeUZpZWxkcyA9IGZ1bmN0aW9uKCkKewpsb2dEZWJ1ZygiaWdub3JlIG1hbmRhdG9yeSBleHRyYSBmaWVsZHMgYW5kIGNsb3NlIGV2ZW50Iik7CiRzY29wZS5jdXJyZW50RXZlbnQuaWdub3JlRXh0cmFGaWVsZHNWYWxpZGF0aW9uPXRydWU7CmNsb3NlRXZlbnQoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCwkc2NvcGUuY3VycmVudEV2ZW50LGFmdGVyQ2xvc2VFdmVudCxhZnRlckNsb3NlRXZlbnQpOwpmdW5jdGlvbiBhZnRlckNsb3NlRXZlbnQoKQp7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgnZXZlbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7Cn07Cn0KfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdldmVudFR5cGVDaGFuZ2VkUG9wdXBDb250cm9sbGVyJywgZnVuY3Rpb24oJGxvY2F0aW9uLCAkc2NvcGUsICRyb3V0ZVBhcmFtcywgJHJvb3RTY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRodHRwLCBldmVudFR5cGVQcm9wZXJ0aWVzLCB1aUNhbGVuZGFyQ29uZmlnKSB7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzPWV2ZW50VHlwZVByb3BlcnRpZXM7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLnVwZGF0ZWRfZnJvbV9kYXRlPW5ldyBEYXRlKCk7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLnVwZGF0ZV9leGlzdGluZ19ldmVudHM9ZmFsc2U7Cgokc2NvcGUuY2xvc2VNb2RhbCA9IGZ1bmN0aW9uKCkgewokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7Cn07Cgokc2NvcGUudXBkYXRlRXZlbnRUeXBlID0gZnVuY3Rpb24oKQp7CmxvZ0RlYnVnKCJ1cGRhdGUgRXZlbnQgVHlwZSAiICsgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXZlbnRfdHlwZV9pZCk7CmlmICgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5tYXhfcmVnaXN0cmF0aW9ucz09JycpCnsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMubWF4X3JlZ2lzdHJhdGlvbnM9MDsKfQp1cGRhdGVFdmVudFR5cGUoJGh0dHAsJHNjb3BlLCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV2ZW50X3R5cGVfaWQsJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMsdXBkYXRlRXZlbnRUeXBlX3N1Y2Nlc3MpOwpmdW5jdGlvbiB1cGRhdGVFdmVudFR5cGVfc3VjY2VzcygpCnsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwokbG9jYXRpb24ucGF0aCgnL2V2ZW50X3R5cGVzJyk7Cn0KfQoKfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdjbGFzc0RlbGV0ZUFsbE1vZGFsQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHJvb3RTY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRodHRwLCBjdXJyZW50RXZlbnQsIHVpQ2FsZW5kYXJDb25maWcpCnsKbG9nRGVidWcoImNvbnRyb2xsZXI6IGNsYXNzRGVsZXRlQWxsTW9kYWxDb250cm9sbGVyIik7CiRzY29wZS5jdXJyZW50RXZlbnQ9Y3VycmVudEV2ZW50Owokc2NvcGUuY2xvc2VNb2RhbCA9IGZ1bmN0aW9uKCkKewokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7Cn07CgoKJHNjb3BlLmRlbGV0ZUNsYXNzRXZlbnRTaW5nbGU9ZnVuY3Rpb24gKCkgLy8gZGVsZXRlIG9ubHkgb25lL2N1cnJlbnQgY2xhc3MgZXZlaHQKewpjYW5jZWxDbGFzc0V2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkLGNhbmNlbENsYXNzRXZlbnRfY2FsbGJhY2ssIGNhbmNlbENsYXNzRXZlbnRfY2FsbGJhY2spOwpmdW5jdGlvbiBjYW5jZWxDbGFzc0V2ZW50X2NhbGxiYWNrKCkKewpnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkKTsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwokcm9vdFNjb3BlLiRicm9hZGNhc3QoJ3JlbG9hZEV2ZW50Jyx7ZXZlbnRfaWQgOiAkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkfSk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCn0KfQokc2NvcGUuZGVsZXRlQ2xhc3NFdmVudHNBbGw9ZnVuY3Rpb24gKCkgLy8gZGVsZXRlIGFsbCByZXBlYXRpbmcgZXZlbnRzCnsKY2FuY2VsQ2xhc3NSZXBlYXRpbmdFdmVudCgkaHR0cCwkc2NvcGUsMCwkc2NvcGUuY3VycmVudEV2ZW50LnJlcGVhdF9ldmVudF9pZCxjYW5jZWxDbGFzc0V2ZW50X2NhbGxiYWNrLCBjYW5jZWxDbGFzc0V2ZW50X2NhbGxiYWNrKTsKZnVuY3Rpb24gY2FuY2VsQ2xhc3NFdmVudF9jYWxsYmFjaygpCnsKZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCk7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdyZWxvYWRFdmVudCcse2V2ZW50X2lkIDogJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZH0pOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwp9Cn0KJHNjb3BlLmRlbGV0ZUNsYXNzRXZlbnRzQWxsU3RhcnRpbmdFdmVudElEPWZ1bmN0aW9uICgpIC8vIGRlbGV0ZSBhbGwgcmVwZWF0aW5nIGV2ZW50cyBzdGFydGluZyBldmVudF9pZAp7CmNhbmNlbENsYXNzUmVwZWF0aW5nRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQsJHNjb3BlLmN1cnJlbnRFdmVudC5yZXBlYXRfZXZlbnRfaWQsY2FuY2VsQ2xhc3NFdmVudF9jYWxsYmFjaywgY2FuY2VsQ2xhc3NFdmVudF9jYWxsYmFjayk7CmZ1bmN0aW9uIGNhbmNlbENsYXNzRXZlbnRfY2FsbGJhY2soKQp7Ci8vIGdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQpOwokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgncmVsb2FkRXZlbnQnLHtldmVudF9pZCA6ICRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWR9KTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKfQp9Cgp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ2J1c2luZXNzX21vZGFsX2xpbWl0YXRpb25fY3JlYXRlJywgZnVuY3Rpb24oJHNjb3BlLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIHN0YXJ0LGVuZCwgZml4ZWRTY2hlZHVsZSwgdWlDYWxlbmRhckNvbmZpZykgewoKJHNjb3BlLmZpeGVkU2NoZWR1bGU9Zml4ZWRTY2hlZHVsZTsKJHNjb3BlLm9yaWdpbmFsX3N0YXJ0PXN0YXJ0Owokc2NvcGUub3JpZ2luYWxfZW5kPWVuZDsKCiRzY29wZS5zdGFydD1uZXcgbW9tZW50KHN0YXJ0KSoxMDAwOwokc2NvcGUuZW5kPW5ldyBtb21lbnQoZW5kKSoxMDAwOwpjb25zb2xlLmxvZygnc3RhcnQ9JytzdGFydCk7CmNvbnNvbGUubG9nKCdlbmQ9JytlbmQpOwoKZ2V0QnVzaW5lc3NMb2NhdGlvbnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19sb2NhdGlvbnMnLGdldEJ1c2luZXNzTG9jYXRpb25zX3N1Y2Nlc3MpOwpmdW5jdGlvbiBnZXRCdXNpbmVzc0xvY2F0aW9uc19zdWNjZXNzKCkKewokc2NvcGUubmV3RXZlbnREZXRhaWxzLmxvY2F0aW9uX2lkPSRzY29wZS5idXNpbmVzc19sb2NhdGlvbnNbMF0ubG9jYXRpb25faWQ7Cn0KCnNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc3RhcnQpOwpzZWxlY3RlZERhdGVFbmQgPSBuZXcgRGF0ZShlbmQpOwpsb2dEZWJ1Zygic2VsZWN0ZWREYXRlU3RhcnQgPSAiK3NlbGVjdGVkRGF0ZVN0YXJ0KTsKdmFyIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZSgpICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKdmFyIHNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKHNlbGVjdGVkRGF0ZUVuZC5nZXRUaW1lKCkgKyBzZWxlY3RlZERhdGVFbmQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKCi8vIGxvZ0RlYnVnKCJkYXRlPSIgKyBzZWxlY3RlZERhdGVTdGFydCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50ID0gW107CiRzY29wZS5uZXdFdmVudERldGFpbHMgPSBbXTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycyA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldEhvdXJzKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcyA9IChzZWxlY3RlZERhdGVTdGFydC5nZXRNaW51dGVzKCkgPCAxMCA/ICcwJyA6ICcnKSArIHNlbGVjdGVkRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkb3cgPSBkYXlOYW1lc1tzZWxlY3RlZERhdGVTdGFydC5nZXREYXkoKV07CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF0ZSA9IHNlbGVjdGVkRGF0ZVN0YXJ0Owokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoID0gbW9udGhOYW1lc1tzZWxlY3RlZERhdGVTdGFydC5nZXRNb250aCgpXTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aDExMiA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldE1vbnRoKCkrMTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXlvZm1vbnRoID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RGF0ZSgpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXIgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRGdWxsWWVhcigpOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWVfaW5wdXRfZm9ybWF0PSBuZXcgRGF0ZSgxOTcwLCAwLCAxLCAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzLCAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMsIDApOwoKJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMgPSBzZWxlY3RlZERhdGVFbmQuZ2V0SG91cnMoKTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcyA9IChzZWxlY3RlZERhdGVFbmQuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBzZWxlY3RlZERhdGVFbmQuZ2V0TWludXRlcygpOwoKCiRzY29wZS5jYW5jZWwgPSBmdW5jdGlvbigpIHsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwp9OwoKZ2V0QWxsSW5zdHJ1Y3RvcnMoJGh0dHAsJHNjb3BlLCdpbnN0cnVjdG9ycycsZ2V0QWxsSW5zdHJ1Y3RvcnNfc3VjY2Vzcyk7CmZ1bmN0aW9uIGdldEFsbEluc3RydWN0b3JzX3N1Y2Nlc3MoKQp7CiRzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZD0kc2NvcGUuaW5zdHJ1Y3RvcnNbMF0uYnVzaW5lc3NfdXNlcl9pZDsKfQpnZXROb0NsYXNzRXZlbnRUeXBlc05vQWRtaW4oJGh0dHAsJHNjb3BlLCdyZWxhdGVkRXZlbnRUeXBlcycpOwoKJHNjb3BlLmNyZWF0ZU5ld0xpbWl0YXRpb24gPSBmdW5jdGlvbigpCnsKbG9nRGVidWcoImZ1bmN0aW9uOiBjcmVhdGVOZXdMaW1pdGF0aW9uIik7CmNhbGVuZGFyID0gJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnOwoKaWYgKCRzY29wZS5zZWxlY3RlZEV2ZW50VHlwZXMubGVuZ3RoPDEpCnsKcmV0dXJuIGZhbHNlOwp9CmlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vyczwkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKQp7CmFsZXJ0KCLXltee158g16HXmdeV150g15zXpNeg15kg15bXntefINeU16rXl9ec15QiKTsKcmV0dXJuIGZhbHNlOwp9CmlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vycz09JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykKewppZiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlczw9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKQp7CmFsZXJ0KCLXltee158g16HXmdeV150g15zXpNeg15kg15bXntefINeU16rXl9ec15QiKTsKcmV0dXJuIGZhbHNlOwp9CmlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzPCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMrMTApKQp7CmFsZXJ0KCLXkdec15XXpyDXp9eY158g154tMTAg15PXp9eV16oiKTsKcmV0dXJuIGZhbHNlOwp9Cn0KaWYgKCFrdXplSXNDYWxlbmRhckRyYWdnYmxlKSB7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3Vuc2VsZWN0Jyk7Cn0KbG9nRGVidWcoInN0YXJ0PSIgKyBzdGFydCk7CmNoZWNrRGF0ZSA9IG5ldyBEYXRlKHN0YXJ0KTsKbG9nRGVidWcoImNoZWNrIGRhdGUgPSAiICsgY2hlY2tEYXRlKQpsb2dEZWJ1ZygiZW5kPSIgKyBlbmQpOwplY29sb3I9IiMwMGE2NWEiOwoKaWYgKGNoZWNrRGF0ZS5nZXRGdWxsWWVhcigpID09IDE5NzApIHsKZGF5X2xpbWl0X2lkID0gLTE7Cn0gZWxzZSB7CmRheV9saW1pdF9pZCA9IDE7Cn0KCi8vIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW10uZnVsbENhbGVuZGFyKCdyZXJlbmRlckV2ZW50cycpOwoKdGVtcF9saW1pdF9pZCA9IGNhbGNfdGVtcF9saW1pdF9pZCgpOwoKbG9nRGVidWcoJHNjb3BlLnNlbGVjdGVkRXZlbnRUeXBlc1swXSk7CmxvZ0RlYnVnKCRzY29wZS5zZWxlY3RlZEV2ZW50VHlwZXNbMF0uZXZlbnRfdHlwZV9pZCk7CgpzdGFydF9wYXJhbT1zdGFydDsKZW5kX3BhcmFtPWVuZDsKdGl0bGVfcGFyYW09Jyc7CmxvZ0RlYnVnKCJhZGRMaW1pdGF0aW9uVG9EYXRhYmFzZSBzdGFydD0iICsgc3RhcnRfcGFyYW0gKyAiLCBlbmQ9IiArICIsIHRpdGxlPSIgKyB0aXRsZV9wYXJhbSApOwoKdGhlZGF0YSA9IHsKc3RhcnRfZGF0ZTogJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5zdGFydF90aW1lLAplbmRfZGF0ZTogJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmRfdGltZSwKY29sb3I6IGVjb2xvciwKdGVtcF9saW1pdF9pZDogdGVtcF9saW1pdF9pZCwKZW1wX2lkOiAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmluc3RydWN0b3JfaWQsCmxvY2F0aW9uX2lkOiAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmxvY2F0aW9uX2lkLApldmVudF90eXBlX2lkOiAkc2NvcGUuc2VsZWN0ZWRFdmVudFR5cGVzWzBdLmV2ZW50X3R5cGVfaWQsCmV2ZW50X3R5cGVzOiAkc2NvcGUuc2VsZWN0ZWRFdmVudFR5cGVzLAp0aXRsZTogdGl0bGVfcGFyYW0KfTsKCmlmICgkc2NvcGUuZml4ZWRTY2hlZHVsZSkgLy8gZml4ZWQgc2NoZWR1bGUgdnMgc3BlY2lmaWMgd2VlZC9kYXkgbGltaXRhdGlvbgp7CmNyZWF0ZUNhbGVuZGFyTGltaXRhdGlvbigkaHR0cCwkc2NvcGUsdGhlZGF0YSxsaW1pdGF0aW9uX3N1Y2Nlc3NfY2FsbGJhY2spOwp9CmVsc2UKewpjcmVhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXkoJGh0dHAsJHNjb3BlLHRoZWRhdGEsbGltaXRhdGlvbl9zdWNjZXNzX2NhbGxiYWNrKTsKfQpmdW5jdGlvbiBsaW1pdGF0aW9uX3N1Y2Nlc3NfY2FsbGJhY2soKQp7CmxvZ0RlYnVnKCJzdWNjZXNzIik7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKJHVpYk1vZGFsSW5zdGFuY2UuZGlzbWlzcygpOwp9Cgp9Cgokc2NvcGUuc3RhcnRNaW51dGVzID0gZnVuY3Rpb24oKQp7CmxvZ0RlYnVnKCJzdGFydE1pbnV0ZXMgIisoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKSk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcz1taW51dGVzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpOwpjYWxjdWxhdGVTdGFydFRpbWUoKTsKfQokc2NvcGUuc3RhcnRIb3VycyA9IGZ1bmN0aW9uKCkKewpsb2dEZWJ1Zygic3RhcnRIb3VycyAiK2hvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKSk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnM9aG91cnNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMpOwpjYWxjdWxhdGVTdGFydFRpbWUoKTsKfQokc2NvcGUuZW5kTWludXRlcyA9IGZ1bmN0aW9uKCkKewpsb2dEZWJ1ZygiZW5kTWludXRlcyAiKygkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzKSk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXM9bWludXRlc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcyk7CmNhbGN1bGF0ZUVuZFRpbWUoKTsKfQokc2NvcGUuZW5kSG91cnMgPSBmdW5jdGlvbigpCnsKbG9nRGVidWcoImVuZEhvdXJzICIraG91cnNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzKSk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzPWhvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vycyk7CmNhbGN1bGF0ZUVuZFRpbWUoKTsKfQoKCmZ1bmN0aW9uIGNhbGN1bGF0ZVN0YXJ0VGltZSgpCnsKZXZlbnRZZWFyPSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0eWVhcjsKZXZlbnRNb250aD0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoMTEyOwpldmVudERheT0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRheW9mbW9udGg7CmlmIChwYXJzZUludChldmVudE1vbnRoKTwxMCkKewpldmVudE1vbnRoPSIwIitldmVudE1vbnRoOwp9CmlmIChwYXJzZUludChldmVudERheSk8MTApCnsKZXZlbnREYXk9IjAiK2V2ZW50RGF5Owp9CmxvZ0RlYnVnKCIkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXI9IitldmVudFllYXIpOwpsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXlvZm1vbnRoPSIrZXZlbnRNb250aCk7CmxvZ0RlYnVnKCIkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoPSIrZXZlbnREYXkpOwpuZXdfc3RhcnQ9bW9tZW50LnV0YyhldmVudFllYXIrIi0iK2V2ZW50TW9udGgrIi0iK2V2ZW50RGF5KyJUMDA6MDA6MDAiKS5hZGQoKChwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKSo2MCkrcGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKSksICdtaW51dGVzJyk7CiRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZT1uZXdfc3RhcnQ7CmxvZ0RlYnVnKCJuZXdfc3RhcnQ9IituZXdfc3RhcnQpOwp9CmZ1bmN0aW9uIGNhbGN1bGF0ZUVuZFRpbWUoKQp7CmV2ZW50WWVhcj0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXI7CmV2ZW50TW9udGg9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aDExMjsKZXZlbnREYXk9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXlvZm1vbnRoOwppZiAocGFyc2VJbnQoZXZlbnRNb250aCk8MTApCnsKZXZlbnRNb250aD0iMCIrZXZlbnRNb250aDsKfQppZiAocGFyc2VJbnQoZXZlbnREYXkpPDEwKQp7CmV2ZW50RGF5PSIwIitldmVudERheTsKfQpsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyPSIrZXZlbnRZZWFyKTsKbG9nRGVidWcoIiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aD0iK2V2ZW50TW9udGgpOwpsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aD0iK2V2ZW50RGF5KTsKbmV3X2VuZD1tb21lbnQudXRjKGV2ZW50WWVhcisiLSIrZXZlbnRNb250aCsiLSIrZXZlbnREYXkrIlQwMDowMDowMCIpLmFkZCgoKHBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzKSo2MCkrcGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcykpLCAnbWludXRlcycpOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZF90aW1lPW5ld19lbmQ7CmxvZ0RlYnVnKCJuZXdfZW5kPSIrbmV3X2VuZCk7Cn0KCmNhbGN1bGF0ZVN0YXJ0VGltZSgpOwpjYWxjdWxhdGVFbmRUaW1lKCk7CgpmdW5jdGlvbiBtaW51dGVzQ2hhbmdlZCh0aGVtaW51dGVzKQp7CmxvZ0RlYnVnKCJ0aGVtaW51dGVzPSIrdGhlbWludXRlcyk7CmlmICh0eXBlb2YgdGhlbWludXRlcz09InVuZGVmaW5lZCIpCnsKcmV0dXJuICIwMCI7Cn0KdGhlbWludXRlcz1wYXJzZUludCh0aGVtaW51dGVzKTsKaWYgKHRoZW1pbnV0ZXM+NjApCnsKcmV0dXJuICIwMCI7Cn0KZWxzZSBpZiAodGhlbWludXRlczwwKQp7CnJldHVybiAiMDAiOwp9CmVsc2UgaWYgKHRoZW1pbnV0ZXM9PSIiKQp7CnJldHVybiAiMDAiOwp9CmVsc2UgaWYgKHRoZW1pbnV0ZXM8MTApCnsKcmV0dXJuICIwIit0aGVtaW51dGVzOwp9CmVsc2UKewpyZXR1cm4gdGhlbWludXRlczsKfQp9CmZ1bmN0aW9uIGhvdXJzQ2hhbmdlZCh0aGVob3VycykKewpsb2dEZWJ1ZygidGhlaG91cnM9Iit0aGVob3Vycyk7CmlmICh0eXBlb2YgdGhlaG91cnM9PSJ1bmRlZmluZWQiKQp7CnJldHVybiAiMCI7Cn0KdGhlaG91cnM9cGFyc2VJbnQodGhlaG91cnMpOwppZiAodGhlaG91cnM+MjQpCnsKcmV0dXJuIDA7Cn0KZWxzZSBpZiAodGhlaG91cnM8MCkKewpyZXR1cm4gMDsKfQplbHNlIGlmICh0aGVob3Vycz09IiIpCnsKcmV0dXJuICIwIjsKfQplbHNlCnsKcmV0dXJuIHRoZWhvdXJzOwp9Cn0KfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2NsYXNzQ2xvc2VNb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRyb290U2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgZXZlbnRfaWQsIHVpQ2FsZW5kYXJDb25maWcpIHsKZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ3NlbGVjdGVkRXZlbnQnLGV2ZW50X2lkLGFmdGVyR2V0Q2xpZW50U3BlY2lmaWNFdmVudCk7CmZ1bmN0aW9uIGFmdGVyR2V0Q2xpZW50U3BlY2lmaWNFdmVudCgpCnsKZm9yIChpID0gMDsgaSA8ICRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50VXNlcnMubGVuZ3RoOyBpKyspCnsKaWYgKCRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50VXNlcnNbaV0uc3RhdHVzX25hbWUhPSRnVXNlcl9zdGF0dXNfYWJzZW50ZWQpCnsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRVc2Vyc1tpXS5wYXJ0aWNpcGF0ZWQ9dHJ1ZTsKfQppZiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRVc2Vyc1tpXS5pc193YWl0aW5nX2xpc3Q9PTEpCnsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRVc2Vyc1tpXS5wYXJ0aWNpcGF0ZWQ9ZmFsc2U7Cn0KfQpsb2dEZWJ1Zygkc2NvcGUuc2VsZWN0ZWRFdmVudCk7Cn0KCi8vIGNsaWNrZWQgcm93IC0gY2hlY2svdW5jaGVjayB0aGUgY2hlY2tib3ggb2YgYSB1c2VyCiRzY29wZS5yb3dDbGlja2VkID0gZnVuY3Rpb24ob2JqKQp7CmxvZ0RlYnVnKCdyb3cgY2xpY2tlZCcpOwpvYmoucGFydGljaXBhdGVkID0gIW9iai5wYXJ0aWNpcGF0ZWQ7Cn07Cgokc2NvcGUub2tMaW1pdGF0aW9uTW9kYWwgPSBmdW5jdGlvbigpIHsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwp9OwoKJHNjb3BlLmNsb3NlQ2xhc3MgPSBmdW5jdGlvbigpCnsKY2xvc2VDbGFzc0V2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUuc2VsZWN0ZWRFdmVudC5ldmVudF9pZCwkc2NvcGUuc2VsZWN0ZWRFdmVudCxhZnRlckNsb3NlRXZlbnQsYWZ0ZXJDbG9zZUV2ZW50KTsKZnVuY3Rpb24gYWZ0ZXJDbG9zZUV2ZW50KCkKewokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgncmVsb2FkRXZlbnQnLHtldmVudF9pZCA6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50X2lkfSk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCn07Cn0KfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2J1c2luZXNzQ2xpZW5kQ2FyZFBheW1lbnQnLCBmdW5jdGlvbigkc2NvcGUsICRyb3V0ZVBhcmFtcywgJHJvb3RTY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRodHRwLCBjdXJyZW50Q2xpZW50LCBpc3BsdXMsIHVpQ2FsZW5kYXJDb25maWcpCnsKJHNjb3BlLmlzcGx1cz1pc3BsdXM7CmxvZ0RlYnVnKCdidXNpbmVzc0NsaWVuZENhcmRQYXltZW50IGlzcGx1cz0nICtpc3BsdXMrIiBjdXJyZW50Q2xpZW50PSIrIEpTT04uc3RyaW5naWZ5KGN1cnJlbnRDbGllbnQsIG51bGwsIDIpKTsKJHNjb3BlLmt1emVJc0xvYWRpbmc9ZmFsc2U7CmxvZ0RlYnVnKCdjdXJyZW50Q2xpZW50LnBheW1lbnRfYmFsYW5jZT0nK2N1cnJlbnRDbGllbnQucGF5bWVudF9iYWxhbmNlKyIsY3VycmVudENsaWVudC51bnBhaWRfYmFsYW5jZSA9IitjdXJyZW50Q2xpZW50LnVucGFpZF9iYWxhbmNlKTsKdGhlYmFsYW5jZSA9IGN1cnJlbnRDbGllbnQucGF5bWVudF9iYWxhbmNlLWN1cnJlbnRDbGllbnQudW5wYWlkX2JhbGFuY2U7CmxvZ0RlYnVnKCd0aGViYWxhbmNlPScrdGhlYmFsYW5jZSk7CmlmICh0aGViYWxhbmNlPDApCnsKJHNjb3BlLmJhbGFuY2VUb1BheT1NYXRoLmFicyh0aGViYWxhbmNlKTsKfQogIC8vIGVsc2UgaWYgKChjdXJyZW50Q2xpZW50LmJhbGFuY2U+MCkgJiYgKGN1cnJlbnRDbGllbnQudW5wYWlkX2JhbGFuY2U+MCkpCiAgLy8gewogIC8vICAgY29uc29sZS5sb2coImN1cnJlbnRDbGllbnQuYmFsYW5jZT0iK2N1cnJlbnRDbGllbnQuYmFsYW5jZSsiLCBjdXJyZW50Q2xpZW50LnVucGFpZF9iYWxhbmNlPSIrY3VycmVudENsaWVudC51bnBhaWRfYmFsYW5jZSk7CiAgLy8gICBpZiAoY3VycmVudENsaWVudC51bnBhaWRfYmFsYW5jZT5jdXJyZW50Q2xpZW50LmJhbGFuY2UpCiAgLy8gICB7CiAgLy8gICAgICRzY29wZS5iYWxhbmNlVG9QYXk9Y3VycmVudENsaWVudC51bnBhaWRfYmFsYW5jZS1jdXJyZW50Q2xpZW50LmJhbGFuY2U7CiAgLy8gICB9CiAgLy8gICBlbHNlIHsKICAvLyAgICAgJHNjb3BlLmJhbGFuY2VUb1BheT0wOwogIC8vICAgfQogIC8vIH0KZWxzZQp7CiRzY29wZS5iYWxhbmNlVG9QYXk9MDsKfQokc2NvcGUucGF5bWVudFR5cGVUaXRsZT0i15HXl9eoIjsKJHNjb3BlLmN1cnJlbnRDbGllbnQ9Y3VycmVudENsaWVudDsKbG9nRGVidWcoJHNjb3BlLmN1cnJlbnRDbGllbnQpOwokc2NvcGUuYnVzaW5lc3NDb25maWcgPSBCdXNpbmVzc0NvbmZpZy5nZXQoKTsKJHNjb3BlLmJ1c2luZXNzQ29uZmlnLnRoZW4oZnVuY3Rpb24gKGNvbmZpZykgewokc2NvcGUuaW52b2ljZV9zb3VyY2VfaWQgPSBjb25maWcuaW52b2ljZV9zb3VyY2VfaWQ7CiRzY29wZS5oYXNWYXQgPSBjb25maWcudmF0X3JhdGUgPiAwOwp9KTsKCiRzY29wZS5jbG9zZU1vZGFsID0gZnVuY3Rpb24oKSB7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKfTsKCiRzY29wZS5leHRlcm5hbF9pbnZvaWNlX2dlbmVyYXRlZD1mYWxzZTsKJHNjb3BlLmludm9pY2VfZGF0ZV9mb3JtYXQ9bmV3IERhdGUoKTsKCmdldE5leHRJbnZvaWNlTnVtYmVyKCRodHRwLCRzY29wZSwkc2NvcGUuY3VycmVudENsaWVudC5idXNpbmVzc191c2VyX2lkLCdpbnZvaWNlX251bWJlcicpOwoKJHNjb3BlLnBheW1lbnRNZXRob2RzID0gcGF5bWVudE1ldGhvZHM7CiRzY29wZS5jcmVkaXRDYXJkVHlwZXMgPSBjcmVkaXRDYXJkVHlwZXM7CiRzY29wZS5jcmVkaXRUcmFuc2FjdGlvblR5cGVzID0gY3JlZGl0VHJhbnNhY3Rpb25UeXBlczsKJHNjb3BlLmJhbmtzID0gYmFua3M7CgovLyBpbmRpY2F0aW9uIHdoZXRoZXIgcGF5bWVudCBtZXRob2Qgd2FzIHNlbGVjdGVkCiRzY29wZS5pc1BheW1lbnRNZXRob2RTZWxlY3RlZD1mYWxzZTsKJHNjb3BlLnNlbGVjdFBheW1lbnRNZXRob2QgPSBmdW5jdGlvbihwYXltZW50KSB7CiRzY29wZS5wYXltZW50VHlwZVRpdGxlPXBheW1lbnQubmFtZTsKJHNjb3BlLnNlbGVjdGVkUGF5bWVudE1ldGhvZD1wYXltZW50Owokc2NvcGUuaXNQYXltZW50TWV0aG9kU2VsZWN0ZWQ9dHJ1ZTsKfTsKCiRzY29wZS51cGRhdGVCYWxhbmNlID0gZnVuY3Rpb24gdXBkYXRlQmFsYW5jZSAoaXNTb3VyY2VXaXRoVmF0KSB7CiRzY29wZS5idXNpbmVzc0NvbmZpZy50aGVuKGZ1bmN0aW9uIChjb25maWcpIHsKaWYgKGlzU291cmNlV2l0aFZhdCkgewokc2NvcGUuYmFsYW5jZVRvUGF5Tm9WYXQgPSBOdW1iZXIoKCRzY29wZS5iYWxhbmNlVG9QYXkgLyAoMSArIGNvbmZpZy52YXRfcmF0ZSkpLnRvRml4ZWQoMikpOwp9IGVsc2Ugewokc2NvcGUuYmFsYW5jZVRvUGF5ID0gTnVtYmVyKCgkc2NvcGUuYmFsYW5jZVRvUGF5Tm9WYXQgKiAoMSArIGNvbmZpZy52YXRfcmF0ZSkpLnRvRml4ZWQoMikpOwp9Cn0pCn07Cgokc2NvcGUubWFrZVBheW1lbnQgPSBmdW5jdGlvbigpCnsKbG9nRGVidWcoY3VycmVudENsaWVudCk7CmxvZ0RlYnVnKCJwYXltZW50IG1ldGhvZCIpOwpsb2dEZWJ1Zygkc2NvcGUuc2VsZWN0ZWRQYXltZW50TWV0aG9kKTsKbG9nRGVidWcoIiRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2dlbmVyYXRlZD08Iiskc2NvcGUuaW52b2ljZV9nZW5lcmF0ZWQrIj4iKTsKCmlmICgoJHNjb3BlLmJhbGFuY2VUb1BheT09MCkgfHwgKCRzY29wZS5iYWxhbmNlVG9QYXk9PScnKXx8ICgkc2NvcGUuYmFsYW5jZVRvUGF5PT1udWxsKSkKewokc2NvcGUudXNlckVycm9yPSLXkNeg15Ag15TXltefINeh15vXldedINeb15zXqdeU15UiOwp9CmVsc2UgaWYgKCEkc2NvcGUuaXNQYXltZW50TWV0aG9kU2VsZWN0ZWQpCnsKJHNjb3BlLnVzZXJFcnJvcj0i15DXoNeQINeR15fXqCDXkNee16bXoteZINeq16nXnNeV150iOwovLyBhbGVydCgnc3MnKTsKfQplbHNlCnsKaWYgKCgkc2NvcGUuaW52b2ljZV9nZW5lcmF0ZWQhPTEpIHx8ICgkc2NvcGUuaW52b2ljZV9kYXRlX2Zvcm1hdD09bnVsbCkpCnsKdmFyIGludm9pY2VfZGF0ZV9mb3JtYXQgPSAibnVsbCI7Cn0KZWxzZQp7CnZhciBpbnZvaWNlX2RhdGVfZm9ybWF0ID0gJHNjb3BlLmludm9pY2VfZGF0ZV9mb3JtYXQuZ2V0RGF0ZSgpICArICItIiArICgkc2NvcGUuaW52b2ljZV9kYXRlX2Zvcm1hdC5nZXRNb250aCgpKzEpICsgIi0iICsgJHNjb3BlLmludm9pY2VfZGF0ZV9mb3JtYXQuZ2V0RnVsbFllYXIoKTsKfQppZiAoaXNwbHVzKQp7CndoYXRUb1BheT0kc2NvcGUuYmFsYW5jZVRvUGF5Owp9CmVsc2Ugewp3aGF0VG9QYXk9LSRzY29wZS5iYWxhbmNlVG9QYXk7Cn0KdGhlZGF0YT0gewpiYWxhbmNlVG9QYXk6IHdoYXRUb1BheSwKYmFsYW5jZVRvUGF5Tm9WYXQ6ICRzY29wZS5iYWxhbmNlVG9QYXlOb1ZhdCAqIChpc3BsdXMgPyArMSA6IC0xKSwKcGF5bWVudF9tZXRob2RfbmFtZTogJHNjb3BlLnNlbGVjdGVkUGF5bWVudE1ldGhvZC5tZXRob2QsCmludm9pY2VfbnVtYmVyOiAkc2NvcGUuaW52b2ljZV9udW1iZXIsCmludm9pY2VfZ2VuZXJhdGVkOiAkc2NvcGUuaW52b2ljZV9nZW5lcmF0ZWQsCmludm9pY2VfZGF0ZTogaW52b2ljZV9kYXRlX2Zvcm1hdCwKYmFua19jb21wYW55X2NvZGU6ICRzY29wZS5iYW5rX2NvbXBhbnlfY29kZSwKYmFua19icmFuY2hfbnVtYmVyOiAkc2NvcGUuYmFua19icmFuY2hfbnVtYmVyLApjaGVja19udW1iZXI6ICRzY29wZS5jaGVja19udW1iZXIsCmFjY291bnRfbnVtYmVyOiAkc2NvcGUuYWNjb3VudF9udW1iZXIsCmNyZWRpdF9jYXJkX251bWJlcjogJHNjb3BlLmNyZWRpdF9jYXJkX251bWJlciwKY3JlZGl0X2NhcmRfdHlwZTogJHNjb3BlLmNyZWRpdF9jYXJkX3R5cGUsCmNyZWRpdF9jYXJkX3RyYW5zYWN0aW9uX3R5cGU6ICRzY29wZS5jcmVkaXRfY2FyZF90cmFuc2FjdGlvbl90eXBlLAppbnZvaWNlX2NvbW1lbnRzOiAkc2NvcGUuaW52b2ljZV9jb21tZW50cwp9Owokc2NvcGUua3V6ZUlzTG9hZGluZz10cnVlOwpjcmVhdGVQYXltZW50Rm9yQ2xpZW50KCRodHRwLCRzY29wZSxjdXJyZW50Q2xpZW50LmJ1c2luZXNzX3VzZXJfaWQsdGhlZGF0YSxjcmVhdGVQYXltZW50Rm9yQ2xpZW50X3N1Y2Nlc3MsIGNyZWF0ZVBheW1lbnRGb3JDbGllbnRfZmFpbHVyZSk7CmZ1bmN0aW9uIGNyZWF0ZVBheW1lbnRGb3JDbGllbnRfc3VjY2VzcygpCnsKJHNjb3BlLmt1emVJc0xvYWRpbmc9ZmFsc2U7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKbG9nRGVidWcoImJyb2FkY2FzdGluZyBjbGllbnRQYWdlUmVsb2FkRGF0YSIpOwokcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NsaWVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCmxvZ0RlYnVnKCJicm9hZGNhc3RpbmcgZXZlbnRQYWdlUmVsb2FkRGF0YSIpOwokcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2V2ZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKLy8gbG9nRGVidWcoImJyb2FkY2FzdGluZyByZWxvYWRFdmVudCIpOwovLyAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ3JlbG9hZEV2ZW50Jyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCn0KZnVuY3Rpb24gY3JlYXRlUGF5bWVudEZvckNsaWVudF9mYWlsdXJlKCkKewokc2NvcGUua3V6ZUlzTG9hZGluZz1mYWxzZTsKfQp9Cn0KfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdldmVudERldGFpbHNCdXNpbmVzc0NhbGVuZGFyTW9kYWxDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIHNlbGVjdGVkRXZlbnQsIHVpQ2FsZW5kYXJDb25maWcpIHsKdmFyIGRheU5hbWVzID0gWyfXqNeQ16nXldefJywgJ9ep16DXmScsICfXqdec15nXqdeZJywgJ9eo15HXmdei15knLCAn15fXnteZ16nXmScsICfXqdeZ16nXmScsICfXqdeR16onXTsKCiRzY29wZS5nb3RvQ2xpZW50UGFnZT0gZnVuY3Rpb24gKGJ1c2luZXNVc2VyaWQpCnsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwpnb3RvQ2xpZW50UGFnZShidXNpbmVzVXNlcmlkKTsKfQokc2NvcGUuZWRpdEV2ZW50PSBmdW5jdGlvbiAodGhlZXZlbnQpCnsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwpnb3RvRXZlbnRQYWdlKHRoZWV2ZW50KTsKfQoKbG9nRGVidWcoInNlbGVjdGVkIEV2ZW50IGluZm8gPSIgKyBKU09OLnN0cmluZ2lmeShzZWxlY3RlZEV2ZW50LCBudWxsLCAyKSk7CiRzY29wZS5zZWxlY3RlZEV2ZW50ID0gc2VsZWN0ZWRFdmVudDsKc2VsZWN0ZWREYXRlU3RhcnQgPSBuZXcgRGF0ZShzZWxlY3RlZEV2ZW50LnN0YXJ0KTsKdmFyIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZSgpICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKCiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRIb3VycygpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBzZWxlY3RlZERhdGVTdGFydC5nZXRNaW51dGVzKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZG93ID0gZGF5TmFtZXNbc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RGF5KCldOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRhdGUgPSBzZWxlY3RlZERhdGVTdGFydDsKCiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0RGF5ID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RGF0ZSgpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydE1vbnRoID0gMSArIHNlbGVjdGVkRGF0ZVN0YXJ0LmdldE1vbnRoKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0TW9udGhUeHQgPSBtb250aE5hbWVzWyRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0TW9udGggLSAxXTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRZZWFyID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RnVsbFllYXIoKTsKCnNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKHNlbGVjdGVkRXZlbnQuZW5kKTsKdmFyIHNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKHNlbGVjdGVkRGF0ZUVuZC5nZXRUaW1lKCkgKyBzZWxlY3RlZERhdGVFbmQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKCiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzID0gc2VsZWN0ZWREYXRlRW5kLmdldEhvdXJzKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGRvdyA9IGRheU5hbWVzW3NlbGVjdGVkRGF0ZUVuZC5nZXREYXkoKV07CiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKSA8IDEwID8gJzAnIDogJycpICsgc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKTsKJHNjb3BlLm9rTGltaXRhdGlvbk1vZGFsID0gZnVuY3Rpb24oKSB7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKfTsKCiRzY29wZS5kZWxldGVMaW1pdGF0aW9uTW9kYWwgPSBmdW5jdGlvbigpIHsKJHVpYk1vZGFsSW5zdGFuY2UuZGlzbWlzcygnZGVsZXRlJyk7CmNhbGVuZGFyID0gJ2NhbGVuZGFyX2J1c2luZXNzJzsKCiRzY29wZS5kZWxldGVDYWxlbmRhckRCRXZlbnQoc2VsZWN0ZWRFdmVudCwgY2FsZW5kYXIpOwp9Owokc2NvcGUuZGVsZXRlQ2FsZW5kYXJKU0V2ZW50ID0gZnVuY3Rpb24oY2FsZW5kYXIsIHNlbGVjdGVkRXZlbnRpZCkgewoKbG9nRGVidWcoImNhbGVuZGFyX2hvdXJzX29mX3dvcmtfY29uZmlnPSIgKyB1aUNhbGVuZGFyQ29uZmlnKTsKbG9nRGVidWcoInVpQ2FsZW5kYXJDb25maWdbY2FsZW5kYXJdPSIgKyB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1snY2FsZW5kYXJfYnVzaW5lc3MnXSk7CmxvZ0RlYnVnKCJkZWxldGUganMgZXZlbnQgIiArIHNlbGVjdGVkRXZlbnRpZCk7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlbW92ZUV2ZW50cycsIFtzZWxlY3RlZEV2ZW50aWRdKTsgLy8gZ28gdG8gZGF0ZSBpbiBjYWxlbmRhciBnb3RvCn07CiRzY29wZS5kZWxldGVDYWxlbmRhckRCRXZlbnQgPSBmdW5jdGlvbihzZWxlY3RlZEV2ZW50LCBjYWxlbmRhcikgewpsb2dEZWJ1ZygiZGVsZXRlIGV2ZW50ICIgKyBzZWxlY3RlZEV2ZW50LmlkKTsKJGh0dHAoewptZXRob2Q6ICdQT1NUJywKdXJsOiAnL2FwaS9hZG1pbi9ldmVudHMvZGVsZXRlLycgKyBzZWxlY3RlZEV2ZW50LmlkLApkYXRhOiB7CnRlbXBfbGltaXRfaWQ6IHNlbGVjdGVkRXZlbnQudGVtcF9saW1pdF9pZAp9LApoZWFkZXJzOiB7CidDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbjtjaGFyc2V0PXV0Zi04Jwp9Cn0pLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkgewoKbG9nRGVidWcoZGF0YSk7CmlmICghZGF0YS5zdWNjZXNzKSB7CmxvZ0RlYnVnKCJkZWxldGUgbGltaXRfaWQgZXJyb3IgKyIgKyBkYXRhLm1lc3NhZ2UpOwovLyBpZiBub3Qgc3VjY2Vzc2Z1bCwgYmluZCBlcnJvcnMgdG8gZXJyb3IgdmFyaWFibGVzCi8vCQkJICAkc2NvcGUuZXJyb3JOYW1lID0gZGF0YS5lcnJvcnMubmFtZTsKLy8JCQkgICRzY29wZS5lcnJvclN1cGVyaGVybyA9IGRhdGEuZXJyb3JzLnN1cGVyaGVyb0FsaWFzOwp9IGVsc2Ugewpsb2dEZWJ1ZygiZGVsZXRlIGxpbWl0X2lkIHN1Y2Nlc3MiKTsKLy8gaWYgc3VjY2Vzc2Z1bCwgYmluZCBzdWNjZXNzIG1lc3NhZ2UgdG8gbWVzc2FnZQovLwkJCSAgJHNjb3BlLm1lc3NhZ2UgPSBkYXRhLm1lc3NhZ2U7CiRzY29wZS5kZWxldGVDYWxlbmRhckpTRXZlbnQoY2FsZW5kYXIsIHNlbGVjdGVkRXZlbnQuaWQpOwoKfQp9KTsKCmxvZ0RlYnVnKCJhZnRlciByZW1vdmUgZXZlbnQiKTsKfTsKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2V2ZW50UmVjdXJyaW5nRGV0YWlsc0J1c2luZXNzQ2FsZW5kYXJNb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgc2VsZWN0ZWRFdmVudCwgdWlDYWxlbmRhckNvbmZpZykgewp2YXIgZGF5TmFtZXMgPSBbJ9eo15DXqdeV158nLCAn16nXoNeZJywgJ9ep15zXmdep15knLCAn16jXkdeZ16LXmScsICfXl9ee15nXqdeZJywgJ9ep15nXqdeZJywgJ9ep15HXqiddOwoKJHNjb3BlLmdvdG9DbGllbnRQYWdlPSBmdW5jdGlvbiAoYnVzaW5lc3NVc2VyaWQpCnsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwpnb3RvQ2xpZW50UGFnZShidXNpbmVzc1VzZXJpZCk7Cn0KJHNjb3BlLmVkaXRFdmVudD0gZnVuY3Rpb24gKHRoZWV2ZW50KQp7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKZ290b0V2ZW50UGFnZSh0aGVldmVudCk7Cn0KCgpsb2dEZWJ1Zygic2VsZWN0ZWQgUmVjdXJyaW5nIEV2ZW50IGluZm8gPSIgKyBKU09OLnN0cmluZ2lmeShzZWxlY3RlZEV2ZW50LCBudWxsLCAyKSk7CiRzY29wZS5zZWxlY3RlZEV2ZW50ID0gc2VsZWN0ZWRFdmVudDsKc2VsZWN0ZWREYXRlU3RhcnQgPSBuZXcgRGF0ZShzZWxlY3RlZEV2ZW50LnN0YXJ0KTsKdmFyIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZSgpICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKCi8vIGxvZ0RlYnVnKCJzZWxlY3RlZEV2ZW50LnN0YXJ0PSIgKyBzZWxlY3RlZEV2ZW50LnN0YXJ0KTsKLy8gbG9nRGVidWcoImRhdGU9IiArIHNlbGVjdGVkRGF0ZVN0YXJ0KTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycyA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldEhvdXJzKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcyA9IChzZWxlY3RlZERhdGVTdGFydC5nZXRNaW51dGVzKCkgPCAxMCA/ICcwJyA6ICcnKSArIHNlbGVjdGVkRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkb3cgPSBkYXlOYW1lc1tzZWxlY3RlZERhdGVTdGFydC5nZXREYXkoKV07CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF0ZSA9IHNlbGVjdGVkRGF0ZVN0YXJ0OwoKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnREYXkgPSBzZWxlY3RlZERhdGVTdGFydC5nZXREYXRlKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0TW9udGggPSAxICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TW9udGgoKTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRNb250aFR4dCA9IG1vbnRoTmFtZXNbJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRNb250aCAtIDFdOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydFllYXIgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRGdWxsWWVhcigpOwoKc2VsZWN0ZWREYXRlRW5kID0gbmV3IERhdGUoc2VsZWN0ZWRFdmVudC5lbmQpOwp2YXIgc2VsZWN0ZWREYXRlRW5kID0gbmV3IERhdGUoc2VsZWN0ZWREYXRlRW5kLmdldFRpbWUoKSArIHNlbGVjdGVkRGF0ZUVuZC5nZXRUaW1lem9uZU9mZnNldCgpICogNjAwMDApOwoKLy8gbG9nRGVidWcoInNlbGVjdGVkRXZlbnQuZW5kPSIgKyBzZWxlY3RlZEV2ZW50LmVuZCk7Ci8vIGxvZ0RlYnVnKCJkYXRlPSIgKyBzZWxlY3RlZERhdGVFbmQpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycyA9IHNlbGVjdGVkRGF0ZUVuZC5nZXRIb3VycygpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRkb3cgPSBkYXlOYW1lc1tzZWxlY3RlZERhdGVFbmQuZ2V0RGF5KCldOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzID0gKHNlbGVjdGVkRGF0ZUVuZC5nZXRNaW51dGVzKCkgPCAxMCA/ICcwJyA6ICcnKSArIHNlbGVjdGVkRGF0ZUVuZC5nZXRNaW51dGVzKCk7CiRzY29wZS5va0xpbWl0YXRpb25Nb2RhbCA9IGZ1bmN0aW9uKCkgewokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7Cn07Cgp9KTsKCmt1emVBcHAuY29udHJvbGxlcignZXZlbnREZXRhaWxzSG91cnNPZldvcmtNb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgc2VsZWN0ZWRFdmVudCwgZml4ZWRTY2hlZHVsZSwgdWlDYWxlbmRhckNvbmZpZykgewp2YXIgZGF5TmFtZXMgPSBbJ9eo15DXqdeV158nLCAn16nXoNeZJywgJ9ep15zXmdep15knLCAn16jXkdeZ16LXmScsICfXl9ee15nXqdeZJywgJ9ep15nXqdeZJywgJ9ep15HXqiddOwoKLy8gbG9nRGVidWcoInNlbGVjdGVkIEV2ZW50ID0iICsgSlNPTi5zdHJpbmdpZnkoc2VsZWN0ZWRFdmVudCwgbnVsbCwgNCkpOwokc2NvcGUuZml4ZWRTY2hlZHVsZT1maXhlZFNjaGVkdWxlOwokc2NvcGUuc2VsZWN0ZWRFdmVudCA9IHNlbGVjdGVkRXZlbnQ7CiRzY29wZS5zZWxlY3RlZEV2ZW50Lm9yaWdfZXZlbnRfdHlwZXMgPSBhbmd1bGFyLmNvcHkoc2VsZWN0ZWRFdmVudC5ldmVudF90eXBlcyk7CiRzY29wZS5uZXdFdmVudERldGFpbHMgPSBbXTsKCmdldEJ1c2luZXNzTG9jYXRpb25zKCRodHRwLCRzY29wZSwnYnVzaW5lc3NfbG9jYXRpb25zJyk7Cgpsb2dEZWJ1ZygiaG91cnMgb2Ygd29yayBibG9jay9ldmVudCBjbGlja2VkICIrSlNPTi5zdHJpbmdpZnkoJHNjb3BlLnNlbGVjdGVkRXZlbnQpKTsKCnNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc2VsZWN0ZWRFdmVudC5zdGFydCk7CnZhciBzZWxlY3RlZERhdGVTdGFydCA9IG5ldyBEYXRlKHNlbGVjdGVkRGF0ZVN0YXJ0LmdldFRpbWUoKSArIHNlbGVjdGVkRGF0ZVN0YXJ0LmdldFRpbWV6b25lT2Zmc2V0KCkgKiA2MDAwMCk7CmdldEFsbEluc3RydWN0b3JzKCRodHRwLCRzY29wZSwnaW5zdHJ1Y3RvcnMnKTsKZ2V0Tm9DbGFzc0V2ZW50VHlwZXNOb0FkbWluKCRodHRwLCRzY29wZSwncmVsYXRlZEV2ZW50VHlwZXMnLGdldE5vQ2xhc3NFdmVudFR5cGVzTm9BZG1pbl9zdWNjZXNzKTsKZnVuY3Rpb24gZ2V0Tm9DbGFzc0V2ZW50VHlwZXNOb0FkbWluX3N1Y2Nlc3MoKQp7CmZvcih2YXIgaSA9IDA7IGkgPCAkc2NvcGUuc2VsZWN0ZWRFdmVudC5ldmVudF90eXBlcy5sZW5ndGg7IGkrKykKewovLyBjb3B5aW5nIHRoZSBhY3R1YWwgb2JqZWN0IG9mICRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50X3R5cGVzW2ldCmZvcih2YXIgaiA9IDA7IGogPCAkc2NvcGUucmVsYXRlZEV2ZW50VHlwZXMubGVuZ3RoOyBqKyspCnsKaWYgKCRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50X3R5cGVzW2ldLmV2ZW50X3R5cGVfaWQ9PSRzY29wZS5yZWxhdGVkRXZlbnRUeXBlc1tqXS5ldmVudF90eXBlX2lkKQp7CiRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50X3R5cGVzW2ldPWFuZ3VsYXIuY29weSgkc2NvcGUucmVsYXRlZEV2ZW50VHlwZXNbal0pOwp9Cn0KfQp9CgovLyBsb2dEZWJ1Zygic2VsZWN0ZWRFdmVudC5zdGFydD0iICsgc2VsZWN0ZWRFdmVudC5zdGFydCk7Ci8vIGxvZ0RlYnVnKCJkYXRlPSIgKyBzZWxlY3RlZERhdGVTdGFydCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRIb3VycygpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBzZWxlY3RlZERhdGVTdGFydC5nZXRNaW51dGVzKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZG93ID0gZGF5TmFtZXNbc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RGF5KCldOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRhdGUgPSBzZWxlY3RlZERhdGVTdGFydDsKCnNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKHNlbGVjdGVkRXZlbnQuZW5kKTsKdmFyIHNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKHNlbGVjdGVkRGF0ZUVuZC5nZXRUaW1lKCkgKyBzZWxlY3RlZERhdGVFbmQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKCiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bW9udGggPSBtb250aE5hbWVzW3NlbGVjdGVkRGF0ZVN0YXJ0LmdldE1vbnRoKCldOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoMTEyID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TW9udGgoKSsxOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRheW9mbW9udGggPSBzZWxlY3RlZERhdGVTdGFydC5nZXREYXRlKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0eWVhciA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCk7Ci8vICRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZV9pbnB1dF9mb3JtYXQ9IG5ldyBEYXRlKDE5NzAsIDAsIDEsICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMsICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcywgMCk7CgovLyBsb2dEZWJ1Zygic2VsZWN0ZWRFdmVudC5lbmQ9IiArIHNlbGVjdGVkRXZlbnQuZW5kKTsKLy8gbG9nRGVidWcoImRhdGU9IiArIHNlbGVjdGVkRGF0ZUVuZCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzID0gc2VsZWN0ZWREYXRlRW5kLmdldEhvdXJzKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGRvdyA9IGRheU5hbWVzW3NlbGVjdGVkRGF0ZUVuZC5nZXREYXkoKV07CiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKSA8IDEwID8gJzAnIDogJycpICsgc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKTsKCgokc2NvcGUub2tMaW1pdGF0aW9uTW9kYWwgPSBmdW5jdGlvbigpIHsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwp9OwoKJHNjb3BlLnVwZGF0ZUxpbWl0YXRpb25Nb2RhbCA9IGZ1bmN0aW9uKCkKewpsb2dEZWJ1ZygiZnVuY3Rpb246IHVwZGF0ZUxpbWl0YXRpb25Nb2RhbCIpOwppZiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRfdHlwZXMubGVuZ3RoPDEpCnsKcmV0dXJuIGZhbHNlOwp9CmlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vyczwkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKQp7CmFsZXJ0KCLXltee158g16HXmdeV150g15zXpNeg15kg15bXntefINeU16rXl9ec15QiKTsKcmV0dXJuIGZhbHNlOwp9CmlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vycz09JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykKewppZiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlczw9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKQp7CmFsZXJ0KCLXltee158g16HXmdeV150g15zXpNeg15kg15bXntefINeU16rXl9ec15QiKTsKcmV0dXJuIGZhbHNlOwp9CmlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzPCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMrMTApKQp7CmFsZXJ0KCLXkdec15XXpyDXp9eY158g154tMTAg15PXp9eV16oiKTsKcmV0dXJuIGZhbHNlOwp9Cn0KCgpmdW5jdGlvbiB1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25fc3VjY2VzcygpCnsKY2FsZW5kYXIgPSAnY2FsZW5kYXJfaG91cnNfb2Zfd29yayc7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsgLy8gZ28gdG8gZGF0ZSBpbiBjYWxlbmRhciBnb3RvCiR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoJ2RlbGV0ZScpOwp9CgppZiAoJHNjb3BlLmZpeGVkU2NoZWR1bGUpCnsKLy8gZml4ZWQgc2NoZWR1bGUgLSB1cGFkdGluZyBsaW1pdGF0aW9uIDE5NzAKdGhlZGF0YSA9IHsKc3RhcnRfZGF0ZTogbmV3X3N0YXJ0LAplbmRfZGF0ZTogbmV3X2VuZCwKdGVtcF9saW1pdF9pZDogbnVsbCwKbGltaXRfaWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmxpbWl0X2lkLApldmVudF90eXBlczogJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRfdHlwZXMsCmxvY2F0aW9uX2lkOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5sb2NhdGlvbl9pZCwKb3JpZ19ldmVudF90eXBlczogJHNjb3BlLnNlbGVjdGVkRXZlbnQub3JpZ19ldmVudF90eXBlcywKZW1wX2lkOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbXBfaWQKfTsKdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uKCRodHRwLCRzY29wZSx0aGVkYXRhLCRzY29wZS5zZWxlY3RlZEV2ZW50LmxpbWl0X2lkLCB1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25fc3VjY2Vzcyk7Cn0KZWxzZQovLyBub3QgZml4ZWQgc2NoZWR1bGUgLSBwZXJkYXkgYmxvY2sKewovLy8vLy8vLy8vLwppZiAoKCRzY29wZS5zZWxlY3RlZEV2ZW50LmxpbWl0X2lkICE9IG51bGwpICYgKCRzY29wZS5zZWxlY3RlZEV2ZW50LmRheV9saW1pdF9pZCA9PSAtMSkpIC8vIGV2ZW50IGxpbWl0YXRpb24gaGFzIGxpbWl0X2lkIHNvIGl0cyBhbiAxOTcwIGV2ZW50Ci8vIG5lZWQgdG8gYWRkIGEgbmV3IHBlcmRheSBsaW1pdGF0aW9uIHRoYXQgcG9pbnQgKGxpbWl0X2lkKSB0byB0aGUgb2xkIDE5NzAgZXZlbnQgdG8gcmVwbGFjdGUgaXQKewp0ZW1wX2xpbWl0X2lkID0gY2FsY190ZW1wX2xpbWl0X2lkKCk7Ci8vIHRoZWV2ZW50LnRlbXBfbGltaXRfaWQgPSB0ZW1wX2xpbWl0X2lkOwovLyB0aGVldmVudC5kYXlfbGltaXRfaWQgPSB0ZW1wX2xpbWl0X2lkOwovLyB0aGUgbW92ZWQgZXZlbnQgaW4gdGhlIGNhbGVuZGFyIG5vdyBoYXMgZGF5X2xpbWl0X2lkIGFuZCB0ZW1wX2xpbWl0X2lkCi8vIGlmIGl0cyBsb2FkZWQgZnJvbSB0aGUgZGIsIGl0IHdpbGwgb25seSBoYXZlIGRheV9saW1pdF9pZCAoYW5kIG5vdCB0aGUgdGVtcCBvbmUpCi8vIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWydjYWxlbmRhcl9ob3Vyc19vZl93b3JrJ10uZnVsbENhbGVuZGFyKCd1cGRhdGVFdmVudCcsIHRoZWV2ZW50KTsKLy8gY29uc29sZS5sb2coIlhYWFhYWFhYWFhYWFgiKTsKdGhlZGF0YSA9IHsKc3RhcnRfZGF0ZTogbmV3X3N0YXJ0LAplbmRfZGF0ZTogbmV3X2VuZCwKY29sb3I6ICcnLAp0ZW1wX2xpbWl0X2lkOiAwLApldmVudF90eXBlX2lkOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5ldmVudF90eXBlX2lkLApldmVudF90eXBlczogJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRfdHlwZXMsCmxpbWl0X2lkOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5pZCwKbG9jYXRpb25faWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmxvY2F0aW9uX2lkLAplbXBfaWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmVtcF9pZAovLyB0aXRsZTogdGhlZXZlbnQudGl0bGUKfTsKY3JlYXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5KCRodHRwLCRzY29wZSx0aGVkYXRhLHVwZGF0ZUNhbGVuZGFyTGltaXRhdGlvbl9zdWNjZXNzKTsKCn0KZWxzZQp7CnRoZWRhdGE9IHsKc3RhcnRfZGF0ZTogbmV3X3N0YXJ0LAplbmRfZGF0ZTogbmV3X2VuZCwKdGVtcF9kYXlfbGltaXRfaWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LnRlbXBfbGltaXRfaWQsCm9yaWdfZXZlbnRfdHlwZXM6ICRzY29wZS5zZWxlY3RlZEV2ZW50Lm9yaWdfZXZlbnRfdHlwZXMsCmV2ZW50X3R5cGVzOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5ldmVudF90eXBlcywKbG9jYXRpb25faWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmxvY2F0aW9uX2lkLApkYXlfbGltaXRfaWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmRheV9saW1pdF9pZCwKZW1wX2lkOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbXBfaWQKfTsKdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5KCRodHRwLCRzY29wZSx0aGVkYXRhLHVwZGF0ZUNhbGVuZGFyTGltaXRhdGlvbl9zdWNjZXNzKTsKfQp9Cn0KJHNjb3BlLmRlbGV0ZUxpbWl0YXRpb25Nb2RhbCA9IGZ1bmN0aW9uKCkgewpjYWxlbmRhciA9ICdjYWxlbmRhcl9ob3Vyc19vZl93b3JrJzsKCi8vIHJlbW92aW5nIGxpbWl0YXRpb24gZnJvbSBkYXRhYmFzZSwgaWYgdHJ1ZSAtIHJlbW92aW5nIGZyb20gZGlzcGxheSBhbHNvCmlmICgkc2NvcGUuZGVsZXRlQ2FsZW5kYXJEQkxpbWl0YXRpb25FdmVudChzZWxlY3RlZEV2ZW50KSkKewovLyAkc2NvcGUuZGVsZXRlQ2FsZW5kYXJKU0V2ZW50KGNhbGVuZGFyLCBzZWxlY3RlZEV2ZW50LmlkKTsKfQokdWliTW9kYWxJbnN0YW5jZS5kaXNtaXNzKCdkZWxldGUnKTsKfTsKJHNjb3BlLmRlbGV0ZUNhbGVuZGFySlNFdmVudCA9IGZ1bmN0aW9uKGNhbGVuZGFyLCBzZWxlY3RlZEV2ZW50aWQpIHsKCmxvZ0RlYnVnKCJjYWxlbmRhcl9ob3Vyc19vZl93b3JrX2NvbmZpZz0iICsgdWlDYWxlbmRhckNvbmZpZyk7CmxvZ0RlYnVnKCJ1aUNhbGVuZGFyQ29uZmlnW2NhbGVuZGFyXT0iICsgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnXSk7CmxvZ0RlYnVnKCJkZWxldGUganMgZXZlbnQgIiArIHNlbGVjdGVkRXZlbnRpZCk7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlbW92ZUV2ZW50cycsIFtzZWxlY3RlZEV2ZW50aWRdKTsgLy8gZ28gdG8gZGF0ZSBpbiBjYWxlbmRhciBnb3RvCn07CiRzY29wZS5kZWxldGVDYWxlbmRhckRCTGltaXRhdGlvbkV2ZW50ID0gZnVuY3Rpb24oc2VsZWN0ZWRFdmVudCkgewpjYWxlbmRhciA9ICdjYWxlbmRhcl9ob3Vyc19vZl93b3JrJzsKLy8gcmV0dXJuIGZhbHNlOwoKLy8gZGVsZXRpbmcgZXZlbnQgbGltaXRhdGlvbiAobm90IHBlciBkYXkpCi8vIGVpdGhlciBmcm9tIDE5NzAgKGhvdXJzX29mX3dvcmsgcGFnZSkKLy8gb3IgZnJvbSB0aGVpciBpbnN0YW5jZSBpbiB0aGUgY3VycmVudCB3ZWVrJ3MgbGltaXRhdGlvbi4KLy8gZWl0aGVyIHdheSBkYXlfbGltaXRfaWQgaXMgLTEgZm9yIGxpbWl0YXRpb25zIGZyb20gMTk3MAppZiAoc2VsZWN0ZWRFdmVudC5kYXlfbGltaXRfaWQgPT0gLTEpCnsKbG9nRGVidWcoInJlbW92aW5nIGV2ZW50IGxpbWl0YXRpb24sIGNoZWNraWduIGlmIGl0cyBpbiAxOTcwICh0aGUgb3JpZ2luYWwpIG9yIGFuIGluc3RhbmNlIGluIHByZXNlbnQiKTsKc2VsZWN0ZWREYXRlU3RhcnQgPSBuZXcgRGF0ZShzZWxlY3RlZEV2ZW50LnN0YXJ0KTsKLy8gaWYgaXRzIDE5NzAgdGhpcyBtZWFucyB3ZSdyZSBpbiB0aGUgaG91cnNfb2Zfd29yayBnZW5lcmFsIHBhZ2UKLy8gc28gd2Ugc2ltcGx5IGRlbGV0ZSBpdAppZiAoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSA9PSAxOTcwKQp7CmxvZ0RlYnVnKCJyZW1vdmluZyBldmVudCBsaW1pdGF0aW9uIGZyb20gMTk3MCIpOwp0aGVkYXRhPSB7CnRlbXBfbGltaXRfaWQ6IHNlbGVjdGVkRXZlbnQudGVtcF9saW1pdF9pZAp9OwpkZWxldGVDYWxlbmRhckxpbWl0YXRpb24oJGh0dHAsJHNjb3BlLHRoZWRhdGEsc2VsZWN0ZWRFdmVudC5saW1pdF9pZCwgZGVsZXRlQ2FsZW5kYXJMaW1pdGF0aW9uX3N1Y2Nlc3MpOwpmdW5jdGlvbiBkZWxldGVDYWxlbmRhckxpbWl0YXRpb25fc3VjY2VzcygpCnsKJHNjb3BlLmRlbGV0ZUNhbGVuZGFySlNFdmVudChjYWxlbmRhciwgc2VsZWN0ZWRFdmVudC5pZCk7Cn0KfQplbHNlCnsKLy8gcmVtb3ZpbmcgZXZlbnQgbGltaXRhdGlvbiBmcm9tIHRoZSBhIHNwZWNpZmljIHdlZWsKLy8gdGhpcyBtZWFucyBhZGRpbmcgZXZlbnQgbGltaXRhdGlvbiBwZXIgZGF5IHdpdGggcmFuZ2UgZW5kPXN0YXJ0Ci8vIG1heWJlIEJVRyBCVUdHWT8KbG9nRGVidWcoInggcmVtb3ZpbmcgZXZlbnQgbGltaXRhdGlvbiBmcm9tIGEgc3BlY2lmaWMgd2VlaywgdGhpcyBtZWFucyBhZGRpbmcgZXZlbnQgbGltaXRhdGlvbiBwZXIgZGF5IHdpdGggcmFuZ2UgMC0wIik7Ci8vIGxvZ0RlYnVnKEpTT04uc3RyaW5naWZ5KHNlbGVjdGVkRXZlbnQpKTsKCnRoZWRhdGEgPSB7CnN0YXJ0X2RhdGU6IHNlbGVjdGVkRXZlbnQuc3RhcnQsCmVuZF9kYXRlOiBzZWxlY3RlZEV2ZW50LnN0YXJ0LApjb2xvcjogIiMwMDAwMDAiLAp0ZW1wX2xpbWl0X2lkOiAxLApldmVudF90eXBlX2lkOiBzZWxlY3RlZEV2ZW50LmV2ZW50X3R5cGVfaWQsCmxvY2F0aW9uX2lkOiBzZWxlY3RlZEV2ZW50LmxvY2F0aW9uX2lkLApsaW1pdF9pZDogc2VsZWN0ZWRFdmVudC5saW1pdF9pZCwKdGl0bGU6IHNlbGVjdGVkRXZlbnQudGl0bGUKfTsKCmNyZWF0ZUNhbGVuZGFyTGltaXRhdGlvblBlckRheSgkaHR0cCwkc2NvcGUsdGhlZGF0YSxjcmVhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXlfc3VjY2Vzcyk7CmZ1bmN0aW9uIGNyZWF0ZUNhbGVuZGFyTGltaXRhdGlvblBlckRheV9zdWNjZXNzKCkKewokc2NvcGUuZGVsZXRlQ2FsZW5kYXJKU0V2ZW50KGNhbGVuZGFyLCBzZWxlY3RlZEV2ZW50LmlkKTsKfQp9Cn0KZWxzZQp7Ci8vIGRlbGV0aW5nIGEgcGVyZGF5IGxpbWl0YXRpb24uCi8vIGlmIGl0J3MgYSBwZXJkYXkgdGhhdCAicmVwbGFjZWQiIGEgMTk3MCBvbmUKLy8gdGhlbiB3ZSBjYW5ub3QgZGVsZXRlIGl0IChvdGhlcndpc2UgdGhlIG9yaWdpbmFsIDE5NzAgd2lsbCByZWFwcGVhcikKLy8gc28gd2Ugc2V0IGl0IHRvIHN0YXJ0PWVuZAovLyB0aGlzIG1heWJlIGEgQlVHIGFuZCBjYXVzZSBUUk9VQkxFIC8vIFRPRE8KLy8gb3RoZXdpc2Ugd2UgY2FuIGRlbGV0ZSBpdCAtIHRoZSBwZXJkYXkgLSBhcyBpdHMgYSBuZXcgcGVyZGF5IGFuZCBub3QgInJlcGxhY2luZyIgYSAxOTcwIG9uZQoKaWYgKHNlbGVjdGVkRXZlbnQubGltaXRfaWQgIT0gbnVsbCkgLy8gdGhpcyBpcyB0aGUgcGVyZGF5IHRoYXQgcmVwbGFjZXMgYSAxOTcwIG9uZSAtIHdlIHNldCBpdCB0byBzdGFydD1lbmQKewpsb2dEZWJ1ZygicmVtb3ZpbmcgZXZlbnQgbGltaXRhdGlvbiBwZXIgZGF5IHJlbGF0ZWQgdG8gMTk3MCAodXBkYXRpbmcgaXQgdG8gc3RhcnQ9ZW5kKSIpOwoKdGhlZGF0YT0gewpzdGFydF9kYXRlOiBzZWxlY3RlZEV2ZW50LnN0YXJ0LAplbmRfZGF0ZTogc2VsZWN0ZWRFdmVudC5zdGFydCwKdGVtcF9kYXlfbGltaXRfaWQ6IHNlbGVjdGVkRXZlbnQudGVtcF9saW1pdF9pZCwKZGF5X2xpbWl0X2lkOiBzZWxlY3RlZEV2ZW50LmRheV9saW1pdF9pZAp9Owp1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXkoJGh0dHAsJHNjb3BlLHRoZWRhdGEsdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5X3N1Y2Nlcyk7CgpmdW5jdGlvbiB1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXlfc3VjY2VzKCkKewokc2NvcGUuZGVsZXRlQ2FsZW5kYXJKU0V2ZW50KGNhbGVuZGFyLCBzZWxlY3RlZEV2ZW50LmlkKTsKfQp9CmVsc2UgIC8vIHRoaXMgaXMgdGhlIGNhc2Ugd2hlcmUgdGhlIHBlcmRheSBkb2VzbnQgcmVwbGFjZSBhIDE5NzAgb25lLCB3ZSBjYW4gc2ltcGx5IGRlbGV0ZSBpdAp7CmxvZ0RlYnVnKCJyZW1vdmluZyBldmVudCBsaW1pdGF0aW9uIHBlciBkYXkgcmVsYXRlZCBub3QgcmVsYXRlZCB0byAxOTcwIChzbyB3ZSdyZSBkZWxldGluZyBpdCkiKTsKdGhlZGF0YSA9IHsKdGVtcF9saW1pdF9pZDogc2VsZWN0ZWRFdmVudC50ZW1wX2xpbWl0X2lkCn07CmRlbGV0ZUNhbGVuZGFyTGltaXRhdGlvblBlckRheSgkaHR0cCwkc2NvcGUsdGhlZGF0YSxzZWxlY3RlZEV2ZW50LmRheV9saW1pdF9pZCwgZGVsZXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5X3N1Y2Nlc3MpOwpmdW5jdGlvbiBkZWxldGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXlfc3VjY2VzcygpCnsKJHNjb3BlLmRlbGV0ZUNhbGVuZGFySlNFdmVudChjYWxlbmRhciwgc2VsZWN0ZWRFdmVudC5pZCk7Cn0KfQp9CmxvZ0RlYnVnKCJhZnRlciByZW1vdmUgZXZlbnQiKTsKCn07CgoKJHNjb3BlLnN0YXJ0TWludXRlcyA9IGZ1bmN0aW9uKCkKewpsb2dEZWJ1Zygic3RhcnRNaW51dGVzICIrKCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcykpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXM9bWludXRlc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKTsKY2FsY3VsYXRlU3RhcnRUaW1lKCk7Cn0KJHNjb3BlLnN0YXJ0SG91cnMgPSBmdW5jdGlvbigpCnsKbG9nRGVidWcoInN0YXJ0SG91cnMgIitob3Vyc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzPWhvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKTsKY2FsY3VsYXRlU3RhcnRUaW1lKCk7Cn0KJHNjb3BlLmVuZE1pbnV0ZXMgPSBmdW5jdGlvbigpCnsKbG9nRGVidWcoImVuZE1pbnV0ZXMgIisoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcykpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzPW1pbnV0ZXNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpOwpjYWxjdWxhdGVFbmRUaW1lKCk7Cn0KJHNjb3BlLmVuZEhvdXJzID0gZnVuY3Rpb24oKQp7CmxvZ0RlYnVnKCJlbmRIb3VycyAiK2hvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycykpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vycz1ob3Vyc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMpOwpjYWxjdWxhdGVFbmRUaW1lKCk7Cn0KCgpmdW5jdGlvbiBjYWxjdWxhdGVTdGFydFRpbWUoKQp7CmV2ZW50WWVhcj0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXI7CmV2ZW50TW9udGg9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aDExMjsKZXZlbnREYXk9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXlvZm1vbnRoOwppZiAocGFyc2VJbnQoZXZlbnRNb250aCk8MTApCnsKZXZlbnRNb250aD0iMCIrZXZlbnRNb250aDsKfQppZiAocGFyc2VJbnQoZXZlbnREYXkpPDEwKQp7CmV2ZW50RGF5PSIwIitldmVudERheTsKfQoKbmV3X3N0YXJ0PW1vbWVudC51dGMoZXZlbnRZZWFyKyItIitldmVudE1vbnRoKyItIitldmVudERheSsiVDAwOjAwOjAwIikuYWRkKCgocGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykqNjApK3BhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcykpLCAnbWludXRlcycpOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWU9bmV3X3N0YXJ0Owpsb2dEZWJ1ZygibmV3X3N0YXJ0PSIrbmV3X3N0YXJ0KTsKfQpmdW5jdGlvbiBjYWxjdWxhdGVFbmRUaW1lKCkKewpldmVudFllYXI9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyOwpldmVudE1vbnRoPSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bW9udGgxMTI7CmV2ZW50RGF5PSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aDsKaWYgKHBhcnNlSW50KGV2ZW50TW9udGgpPDEwKQp7CmV2ZW50TW9udGg9IjAiK2V2ZW50TW9udGg7Cn0KaWYgKHBhcnNlSW50KGV2ZW50RGF5KTwxMCkKewpldmVudERheT0iMCIrZXZlbnREYXk7Cn0KCm5ld19lbmQ9bW9tZW50LnV0YyhldmVudFllYXIrIi0iK2V2ZW50TW9udGgrIi0iK2V2ZW50RGF5KyJUMDA6MDA6MDAiKS5hZGQoKChwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycykqNjApK3BhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpKSwgJ21pbnV0ZXMnKTsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmRfdGltZT1uZXdfZW5kOwpsb2dEZWJ1ZygibmV3X2VuZD0iK25ld19lbmQpOwp9CgpjYWxjdWxhdGVTdGFydFRpbWUoKTsKY2FsY3VsYXRlRW5kVGltZSgpOwoKZnVuY3Rpb24gbWludXRlc0NoYW5nZWQodGhlbWludXRlcykKewpsb2dEZWJ1ZygidGhlbWludXRlcz0iK3RoZW1pbnV0ZXMpOwppZiAodHlwZW9mIHRoZW1pbnV0ZXM9PSJ1bmRlZmluZWQiKQp7CnJldHVybiAiMDAiOwp9CnRoZW1pbnV0ZXM9cGFyc2VJbnQodGhlbWludXRlcyk7CmlmICh0aGVtaW51dGVzPjYwKQp7CnJldHVybiAiMDAiOwp9CmVsc2UgaWYgKHRoZW1pbnV0ZXM8MCkKewpyZXR1cm4gIjAwIjsKfQplbHNlIGlmICh0aGVtaW51dGVzPT0iIikKewpyZXR1cm4gIjAwIjsKfQplbHNlIGlmICh0aGVtaW51dGVzPDEwKQp7CnJldHVybiAiMCIrdGhlbWludXRlczsKfQplbHNlCnsKcmV0dXJuIHRoZW1pbnV0ZXM7Cn0KfQpmdW5jdGlvbiBob3Vyc0NoYW5nZWQodGhlaG91cnMpCnsKbG9nRGVidWcoInRoZWhvdXJzPSIrdGhlaG91cnMpOwppZiAodHlwZW9mIHRoZWhvdXJzPT0idW5kZWZpbmVkIikKewpyZXR1cm4gIjAiOwp9CnRoZWhvdXJzPXBhcnNlSW50KHRoZWhvdXJzKTsKaWYgKHRoZWhvdXJzPjI0KQp7CnJldHVybiAwOwp9CmVsc2UgaWYgKHRoZWhvdXJzPDApCnsKcmV0dXJuIDA7Cn0KZWxzZSBpZiAodGhlaG91cnM9PSIiKQp7CnJldHVybiAiMCI7Cn0KZWxzZQp7CnJldHVybiB0aGVob3VyczsKfQp9Cgp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ0V2ZW50VHlwZXNDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGNvbXBpbGUsIHVpQ2FsZW5kYXJDb25maWcsICR1aWJNb2RhbCwkbG9jYXRpb24pIHsKbG9nRGVidWcoJ0V2ZW50VHlwZXMgQ29udHJvbGxlcicpOwoKZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzKCRodHRwLCRzY29wZSwnZXZlbnRfdHlwZXMnKTsKJHNjb3BlLnNob3dFdmVudFR5cGUgPSBmdW5jdGlvbiAodGhlRXZlbnQpCnsKJGxvY2F0aW9uLnBhdGgoJy9ldmVudF90eXBlcy8nK3RoZUV2ZW50LmV2ZW50X3R5cGVfaWQpOwp9Cn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdFdmVudFR5cGVOZXdDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGNvbXBpbGUsIHVpQ2FsZW5kYXJDb25maWcsICR1aWJNb2RhbCwgJGxvY2F0aW9uKSB7CmxvZ0RlYnVnKCdFdmVudFR5cGVzIENvbnRyb2xsZXIgTmV3Jyk7Cgokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcyA9IHt9OyAvLyB0aGVzZSBhcmUgdGhlIGNvbXBsZXRlIGRldGFpbHMgZm9yIHRoZSBuZXcgZXZlbnQgLy8KJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuaXNfY2xhc3MgPSAwOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5ibG9ja0V4dHJhVGltZSA9IGZhbHNlOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5kdXJhdGlvbl9iZWZvcmVfZXZlbnQgPSAwOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5kdXJhdGlvbl9hZnRlcl9ldmVudCA9IDA7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmluaGVyaXRfbWFpbl9ob3VycyA9IDE7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF93YWl0aW5nX2xpc3QgPSAzOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5pc191cGRhdGUgPSBmYWxzZTsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMubWF4X3BhcnRpY2lwYW50cyA9IDE7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF9yZWdpc3RyYXRpb25zPTE7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmlzX3B1YmxpYz0xOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5pbnN0cnVjdG9yX2lkPTA7Cgokc2NvcGUuZXZlbnRDb2xvclN0eWxlID0ge307CmRlZmF1bHRDb2xvciA9ICcwMGE2NWEnOwokc2NvcGUuZXZlbnRDb2xvclN0eWxlW2RlZmF1bHRDb2xvcl0gPSB7Cid0cmFuc2Zvcm0nOiAncm90YXRlKDMwZGVnKScKfTsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXZlbnRDb2xvciA9ICIjIiArIGRlZmF1bHRDb2xvcjsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMgPSBbCnsiZmllbGRfbmFtZSI6Iteh15nXm9eV150g157XpNeS16kiLCJmaWVsZF9kYXRhdHlwZSI6IlRFWFRfQVJFQSIsImlzX21hbmRhdG9yeSI6MCwgImZyb21kYiI6IGZhbHNlLCAiZGJfaWRfdG9maXgiOiAwLCAiaXNfYWN0aXZlIjogMSwgIm1vZGlmaWVkIjogZmFsc2V9LAp7ImZpZWxkX25hbWUiOiLXqdeZ16LXldeo15kg15HXmdeqIiwiZmllbGRfZGF0YXR5cGUiOiJURVhUX0FSRUEiLCJpc19tYW5kYXRvcnkiOjAsICJmcm9tZGIiOiBmYWxzZSwgImRiX2lkX3RvZml4IjogMCwgImlzX2FjdGl2ZSI6IDEsICJtb2RpZmllZCI6IGZhbHNlfQpdOwoKZ2V0QWxsSW5zdHJ1Y3RvcnMoJGh0dHAsJHNjb3BlLCdpbnN0cnVjdG9ycycsZ2V0QWxsSW5zdHJ1Y3RvcnNfc3VjY2Vzcyk7CmZ1bmN0aW9uIGdldEFsbEluc3RydWN0b3JzX3N1Y2Nlc3MoKQp7Ci8vICRzY29wZS5pbnN0cnVjdG9ycy51bnNoaWZ0KHtidXNpbmVzc191c2VyX2lkOjAsIGJ1c2VyX2ZpcnN0X25hbWU6IiIsIGJ1c2VyX2xhc3RfbmFtZToiIn0pOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5pbnN0cnVjdG9yX2lkPSRzY29wZS5pbnN0cnVjdG9yc1swXS5idXNpbmVzc191c2VyX2lkOwp9Cgokc2NvcGUuZXZlbnRUeXBlRXh0cmFGaWVsZHNQb3AgPSBmdW5jdGlvbihldmVudFR5cGVQcm9wZXJ0aWVzKSB7CiAgICAgICAgbG9nRGVidWcoImV2ZW50VHlwZUV4dHJhRmllbGRzUG9wMSIpOwoKdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CmFuaW1hdGlvbjogZmFsc2UsCnRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2V2ZW50X3R5cGVfZXh0cmFfZmllbGRzLnBocCcsCmNvbnRyb2xsZXI6ICdldmVudFR5cGVFeHRyYUZpZWxkc01vZGFsQ29udHJvbGxlcicsCnNpemU6ICdsJywKcmVzb2x2ZTogewpldmVudFR5cGVQcm9wZXJ0aWVzOiBmdW5jdGlvbigpIHsKcmV0dXJuIGV2ZW50VHlwZVByb3BlcnRpZXM7Cn0KfQp9KTsKCm1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24oc2VsZWN0ZWRJdGVtKSB7CmxvZ0RlYnVnKHNlbGVjdGVkSXRlbSk7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzID0gc2VsZWN0ZWRJdGVtOwp9LCBmdW5jdGlvbigpIHsKbG9nRGVidWcoJ01vZGFsIGRpc21pc3NlZCBhdDogJyArIG5ldyBEYXRlKCkpOwp9KTsKfTsKCiRzY29wZS5jaGFuZ2VFdmVudENvbG9yID0gZnVuY3Rpb24obmV3Q29sb3IpIHsKbG9nRGVidWcoImNob29zaW5nIGNvbG9yICIgKyBuZXdDb2xvcik7CiRzY29wZS5ldmVudENvbG9yID0gbmV3Q29sb3I7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV2ZW50Q29sb3IgPSAiIyIgKyBuZXdDb2xvcjsKJHNjb3BlLmV2ZW50Q29sb3JTdHlsZSA9IHsKJ2JhY2tncm91bmQtY29sb3InOiAiIyIgKyBuZXdDb2xvcgp9Owokc2NvcGUuZXZlbnRDb2xvclN0eWxlW25ld0NvbG9yXSA9IHsKJ3RyYW5zZm9ybSc6ICdyb3RhdGUoMzBkZWcpJwp9OwoKfQoKJHNjb3BlLmFkZEV2ZW50VHlwZUNhbmNlbCA9IGZ1bmN0aW9uKCkgewokbG9jYXRpb24ucGF0aCgnL2V2ZW50X3R5cGVzJyk7Cn07CgogICAgJHNjb3BlLmR1cGxpY2F0ZUZpZWxkTmFtZXM9IiI7CiRzY29wZS5hZGRFdmVudFR5cGUgPSBmdW5jdGlvbigpIHsKICAgICAgICAvLyBjaGVjayBleHRyYSBmaWVsZHMgZHVwbGljYXRlIG5hbWVzIC0gc3RhcnQKICAgICAgICBsb2dEZWJ1ZygiYWRkRXZlbnRUeXBlOiBjaGVjayBleHRyYSBmaWVsZHMgZHVwbGljYXRlIG5hbWVzIC0gc3RhcnQiKTsKICAgICAgICB2YXIgZXh0cmFGaWVsZHNOYW1lcyA9IFtdOwogICAgICAgIGZvciAodmFyIGk9MTsgaTwkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcy5sZW5ndGg7IGkrKykKICAgICAgICB7CiAgICAgICAgICBleHRyYUZpZWxkc05hbWVzLnB1c2goJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHNbaV0uZmllbGRfbmFtZSk7CiAgICAgICAgfQogICAgICAgIGV4dHJhRmllbGRzTmFtZXMuc29ydCgpOwogICAgICAgIHZhciBsYXN0ID0gZXh0cmFGaWVsZHNOYW1lc1swXTsKICAgICAgICBmb3IgKHZhciBpPTE7IGk8ZXh0cmFGaWVsZHNOYW1lcy5sZW5ndGg7IGkrKykKICAgICAgICB7CiAgICAgICAgICAgaWYgKGV4dHJhRmllbGRzTmFtZXNbaV0gPT0gbGFzdCkKICAgICAgICAgICB7CiAgICAgICAgICAgIC8vICBhbGVydCgnRHVwbGljYXRlIDogJytsYXN0KTsKICAgICAgICAgICAgICRzY29wZS5kdXBsaWNhdGVGaWVsZE5hbWVzPSfXp9eZ15nXnSDXqdeT15Qg16rXmdei15XXkyDXqNek15XXkNeZINeb16TXldecINeR16nXnSAiJytsYXN0KyciLi4uJzsKICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICB9CiAgICAgICAgICAgbGFzdCA9IGV4dHJhRmllbGRzTmFtZXNbaV07CiAgICAgICAgfQogICAgICAgIC8vIGNoZWNrIGV4dHJhIGZpZWxkcyBkdXBsaWNhdGUgbmFtZXMgLSBlbmQKCmxvZ0RlYnVnKCJhZGQgRXZlbnQgVHlwZSIgKyAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcyArICJleHRyYSBmaWVsZHM9IiArJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMpOwppZiAoKCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF9yZWdpc3RyYXRpb25zPT0nJykgfHwgKCEkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5tYXhfcmVnaXN0cmF0aW9ucykpCnsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMubWF4X3JlZ2lzdHJhdGlvbnM9MDsKfQphZGRFdmVudFR5cGUoJGh0dHAsJHNjb3BlLCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLGFkZEV2ZW50VHlwZV9zdWNjZXNzKTsKZnVuY3Rpb24gYWRkRXZlbnRUeXBlX3N1Y2Nlc3MoKQp7CiRsb2NhdGlvbi5wYXRoKCcvZXZlbnRfdHlwZXMnKTsKfQp9Owp9KTsKCmt1emVBcHAuY29udHJvbGxlcignRXZlbnRUeXBlVXBkYXRlQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRjb21waWxlLCAkcm91dGVQYXJhbXMsIHVpQ2FsZW5kYXJDb25maWcsICR1aWJNb2RhbCwgJGxvY2F0aW9uKSB7CmV2ZW50X3R5cGVfaWQ9JHJvdXRlUGFyYW1zLmV2ZW50X3R5cGVfaWQ7CmxvZ0RlYnVnKCdFdmVudFR5cGVzIENvbnRyb2xsZXIgVXBkYXRlICcrZXZlbnRfdHlwZV9pZCk7Cgokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcyA9IHt9OyAvLyB0aGVzZSBhcmUgdGhlIGNvbXBsZXRlIGRldGFpbHMgZm9yIHRoZSBuZXcgZXZlbnQgLy8KJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuaXNfdXBkYXRlID0gdHJ1ZTsKCiRzY29wZS5ldmVudENvbG9yU3R5bGUgPSB7fTsKZ2V0QWxsSW5zdHJ1Y3RvcnMoJGh0dHAsJHNjb3BlLCdpbnN0cnVjdG9ycycsZ2V0QWxsSW5zdHJ1Y3RvcnNfc3VjY2Vzcyk7CmZ1bmN0aW9uIGdldEFsbEluc3RydWN0b3JzX3N1Y2Nlc3MoKQp7CiRzY29wZS5pbnN0cnVjdG9ycy51bnNoaWZ0KHtidXNpbmVzc191c2VyX2lkOm51bGwsIGJ1c2VyX2ZpcnN0X25hbWU6IiIsIGJ1c2VyX2xhc3RfbmFtZToiIn0pOwp9CgpnZXRCdXNpbmVzc0V2ZW50VHlwZSgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmV2ZW50X3R5cGVfaWQsJ2V2ZW50VHlwZVByb3BlcnRpZXMnLGdldEJ1c2luZXNzRXZlbnRUeXBlX3N1Y2Nlc3MpOwoKZnVuY3Rpb24gZ2V0QnVzaW5lc3NFdmVudFR5cGVfc3VjY2VzcygpCnsKaWYgKCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF9yZWdpc3RyYXRpb25zPT1udWxsKQp7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF9yZWdpc3RyYXRpb25zPTE7Cn0KaWYgKCgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5kdXJhdGlvbl9iZWZvcmVfZXZlbnQ+MCkgfCAoJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZHVyYXRpb25fYWZ0ZXJfZXZlbnQ+MCkpCnsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuYmxvY2tFeHRyYVRpbWUgPSAxOwp9CmVsc2UKewokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5ibG9ja0V4dHJhVGltZSA9IDA7Cn0KLy8gJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuaW5oZXJpdF9tYWluX2hvdXJzID0gcmVzcG9uc2UuZGF0YVswXS5pbmhlcml0X21haW5faG91cnM7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmlzX3VwZGF0ZSA9IHRydWU7CmxvZ0RlYnVnKCIkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5jb2xvcj0iKyRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmNvbG9yKTsKJHNjb3BlLmV2ZW50Q29sb3JTdHlsZVskc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5jb2xvcl0gPSB7Cid0cmFuc2Zvcm0nOiAncm90YXRlKDMwZGVnKScKfTsKJHNjb3BlLmNoYW5nZUV2ZW50Q29sb3IoKCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmNvbG9yKS5zdWJzdHIoMSkpOwpsb2dEZWJ1ZygiJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuaW5zdHJ1Y3Rvcl9pZD0iKyRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmluc3RydWN0b3JfaWQpOwovLyBzYXZpbmcgZXZlbnQgdHlwZSBkZXRhaWxzIGFzaWRlIHRvIGxhdGVyIGNoZWNrIGlmIGFueXRoaW5nIGNoYW5nZWQKbG9nRGVidWcoImR1cGxpY2F0aW5nIG9iamVjdCBvZiBldmVudCB0eXBlIHRvIGxhdGVyIGNvbXBhcmUgIit0eXBlb2YgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMpOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllc0R1cGxpY2F0ZSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMpKTsKbG9nRGVidWcoIiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzRHVwbGljYXRlID0iKyRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzRHVwbGljYXRlLmV2ZW50X3R5cGVfbmFtZSk7Cn07CgovLyBldmVudCB0eXBlIGNoYW5nZWQgcG9wdXAKJHNjb3BlLmV2ZW50VHlwZUNoYW5nZWRQb3B1cCA9IGZ1bmN0aW9uKGV2ZW50VHlwZVByb3BlcnRpZXMpIHsKICAgICAgICBsb2dEZWJ1ZygiZXZlbnRUeXBlQ2hhbmdlZFBvcHVwIik7Cgp2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKYW5pbWF0aW9uOiBmYWxzZSwKdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfZXZlbnRfdHlwZV9jaGFuZ2VkLnBocCcsCmNvbnRyb2xsZXI6ICdldmVudFR5cGVDaGFuZ2VkUG9wdXBDb250cm9sbGVyJywKc2l6ZTogJ2wnLApyZXNvbHZlOiB7CmV2ZW50VHlwZVByb3BlcnRpZXM6IGZ1bmN0aW9uKCkgewpyZXR1cm4gJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXM7Cn0KfQp9KTsKCm1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24oc2VsZWN0ZWRJdGVtKQp7CmxvZ0RlYnVnKHNlbGVjdGVkSXRlbSk7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzID0gc2VsZWN0ZWRJdGVtOwp9LCBmdW5jdGlvbigpIHsKbG9nRGVidWcoJ01vZGFsIGRpc21pc3NlZCBhdDogJyArIG5ldyBEYXRlKCkpOwp9KTsKfTsKCi8vIGV2ZW50IHR5cGUgZXh0cmEgZmllbGQgcG9wdXAKJHNjb3BlLmV2ZW50VHlwZUV4dHJhRmllbGRzUG9wID0gZnVuY3Rpb24oZXZlbnRUeXBlUHJvcGVydGllcykgewogICAgICAgIGxvZ0RlYnVnKCJldmVudFR5cGVFeHRyYUZpZWxkc1BvcDIiKTsKCnZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewphbmltYXRpb246IGZhbHNlLAp0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9ldmVudF90eXBlX2V4dHJhX2ZpZWxkcy5waHAnLApjb250cm9sbGVyOiAnZXZlbnRUeXBlRXh0cmFGaWVsZHNNb2RhbENvbnRyb2xsZXInLApzaXplOiAnbCcsCnJlc29sdmU6IHsKZXZlbnRUeXBlUHJvcGVydGllczogZnVuY3Rpb24oKSB7CnJldHVybiBldmVudFR5cGVQcm9wZXJ0aWVzOwp9Cn0KfSk7Cgptb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHNlbGVjdGVkSXRlbSkgewpsb2dEZWJ1ZyhzZWxlY3RlZEl0ZW0pOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyA9IHNlbGVjdGVkSXRlbTsKfSwgZnVuY3Rpb24oKSB7CmxvZ0RlYnVnKCdNb2RhbCBkaXNtaXNzZWQgYXQ6ICcgKyBuZXcgRGF0ZSgpKTsKfSk7Cn07CgoKJHNjb3BlLmNoYW5nZUV2ZW50Q29sb3IgPSBmdW5jdGlvbihuZXdDb2xvcikgewpsb2dEZWJ1ZygiY2hvb3NpbmcgY29sb3IgIiArIG5ld0NvbG9yKTsKJHNjb3BlLmV2ZW50Q29sb3IgPSBuZXdDb2xvcjsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXZlbnRDb2xvciA9ICIjIiArIG5ld0NvbG9yOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5jb2xvciA9ICIjIiArIG5ld0NvbG9yOwokc2NvcGUuZXZlbnRDb2xvclN0eWxlID0gewonYmFja2dyb3VuZC1jb2xvcic6ICIjIiArIG5ld0NvbG9yCn07CiRzY29wZS5ldmVudENvbG9yU3R5bGVbbmV3Q29sb3JdID0gewondHJhbnNmb3JtJzogJ3JvdGF0ZSgzMGRlZyknCn07Cgp9Cgokc2NvcGUuYWRkRXZlbnRUeXBlQ2FuY2VsID0gZnVuY3Rpb24oKSB7CiRsb2NhdGlvbi5wYXRoKCcvZXZlbnRfdHlwZXMnKTsKfTsKCiRzY29wZS5hZGRFdmVudFR5cGUgPSBmdW5jdGlvbigpIHsgLy8gdGhpcyBmdW5jdGlvbiBVUERBVEVTIGV2ZW50IHR5cGUgKG5vdCBhZGRzKQovLyBjaGVja2luZyBpZiBhbnl0aGluZyBjaGFuZ2VkIHJlYWxseQovLyBhbmQgYXNraW5nIGlmIHdlIHNob3VsZCB1cGRhdGUgYWxsIGV2ZW50cyBmcm9tIG5vdyAob3Igb25seSBuZXdseSBjcmVhdGVkIGV2ZW50cykKLy8gY2hlY2tpbmcKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXNEdXBsaWNhdGUuZXh0cmFGaWVsZHM9JHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHM7CiAgICAgIC8vIGlmIChhbmd1bGFyLmVxdWFscygkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllc0R1cGxpY2F0ZSwkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcykpCiAgICAgIGlmICh0cnVlKSAvLyBpZ25vcmluZyB0cnlpbmcgdG8gbWFrZSBjaGFuZ2VzIHRvIGV2ZW50cwp7Ci8vICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzRHVwbGljYXRlLmV4dHJhRmllbGRzID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcykpOwoKbG9nRGVidWcoIm5vdGhpbmcgY2hhbmdlZCBpbiBldmVudCB0eXBlLCBvciBvbmx5IGV4dHJhIGZpZWxkcyIpOwokc2NvcGUudXBkYXRlRXZlbnRUeXBlKCk7Cn0KZWxzZQp7CmxvZ0RlYnVnKCJldmVudCB0eXBlIGNoYW5nZWQiKTsKJHNjb3BlLmV2ZW50VHlwZUNoYW5nZWRQb3B1cCgpOwp9Ci8vICRzY29wZS51cGRhdGVFdmVudFR5cGUoKTsKfQokc2NvcGUudXBkYXRlRXZlbnRUeXBlID0gZnVuY3Rpb24oKQp7CiAgICAgIC8vIGNoZWNrIGV4dHJhIGZpZWxkcyBkdXBsaWNhdGUgbmFtZXMgLSBzdGFydAogICAgICBsb2dEZWJ1ZygiYWRkRXZlbnRUeXBlOiBjaGVjayBleHRyYSBmaWVsZHMgZHVwbGljYXRlIG5hbWVzIC0gc3RhcnQiKTsKICAgICAgdmFyIGV4dHJhRmllbGRzTmFtZXMgPSBbXTsKICAgICAgZm9yICh2YXIgaT0xOyBpPCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzLmxlbmd0aDsgaSsrKQogICAgICB7CiAgICAgICAgZXh0cmFGaWVsZHNOYW1lcy5wdXNoKCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzW2ldLmZpZWxkX25hbWUpOwogICAgICB9CiAgICAgIGV4dHJhRmllbGRzTmFtZXMuc29ydCgpOwogICAgICB2YXIgbGFzdCA9IGV4dHJhRmllbGRzTmFtZXNbMF07CiAgICAgIGZvciAodmFyIGk9MTsgaTxleHRyYUZpZWxkc05hbWVzLmxlbmd0aDsgaSsrKQogICAgICB7CiAgICAgICAgIGlmIChleHRyYUZpZWxkc05hbWVzW2ldID09IGxhc3QpCiAgICAgICAgIHsKICAgICAgICAgIC8vICBhbGVydCgnRHVwbGljYXRlIDogJytsYXN0KTsKICAgICAgICAgICAgbG9nRGVidWcoJ9en15nXmdedINep15PXlCDXqteZ16LXldeTINeo16TXldeQ15kg15vXpNeV15wg15HXqdedICInK2xhc3QrJyIuLi4nKTsKICAgICAgICAgICAkc2NvcGUuZHVwbGljYXRlRmllbGROYW1lcz0n16fXmdeZ150g16nXk9eUINeq15nXoteV15Mg16jXpNeV15DXmSDXm9ek15XXnCDXkdep150gIicrbGFzdCsnIi4uLic7CiAgICAgICAgICAgcmV0dXJuOwogICAgICAgICB9CiAgICAgICAgIGxhc3QgPSBleHRyYUZpZWxkc05hbWVzW2ldOwogICAgICB9CiAgICAgIC8vIGNoZWNrIGV4dHJhIGZpZWxkcyBkdXBsaWNhdGUgbmFtZXMgLSBlbmQKCiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLnVwZGF0ZV9leGlzdGluZ19ldmVudHM9ZmFsc2U7CgogICAgICBsb2dEZWJ1ZygidXBkYXRlRXZlbnRUeXBlOiB1cGRhdGUgRXZlbnQgVHlwZSAiICsgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXZlbnRfdHlwZV9pZCk7CmlmICgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5tYXhfcmVnaXN0cmF0aW9ucz09JycpCnsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMubWF4X3JlZ2lzdHJhdGlvbnM9MDsKfQp1cGRhdGVFdmVudFR5cGUoJGh0dHAsJHNjb3BlLCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV2ZW50X3R5cGVfaWQsJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMsdXBkYXRlRXZlbnRUeXBlX3N1Y2Nlc3MpOwpmdW5jdGlvbiB1cGRhdGVFdmVudFR5cGVfc3VjY2VzcygpCnsKJGxvY2F0aW9uLnBhdGgoJy9ldmVudF90eXBlcycpOwp9Cn0KfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdldmVudENyZWF0ZU1vZGFsQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRyb290U2NvcGUsIHNoYXJlZFByb3BlcnRpZXMsIGV2ZW50X3R5cGVfaWQsIGxvY2F0aW9uX2lkLCBlbXBfaWQsICRodHRwLCBzdGFydERhdGUsIHJlc2NoZWR1bGVfZXZlbnQsIHVpQ2FsZW5kYXJDb25maWcpIHsKc3RhcnREYXRlPW5ldyBtb21lbnQoc3RhcnREYXRlKTsKbG9nRGVidWcoImV2ZW50Q3JlYXRlTW9kYWxDb250cm9sbGVyLCBzdGFydERhdGU9IitzdGFydERhdGUrIiB0eXBlICIrdHlwZW9mIHN0YXJ0RGF0ZSk7CmxvZ0RlYnVnKCJldmVudENyZWF0ZU1vZGFsQ29udHJvbGxlciwgcmVzY2hlZHVsZV9ldmVudD0iK3Jlc2NoZWR1bGVfZXZlbnQpOwoKJHNjb3BlLmV2ZW50VHlwZVRpdGxlID0gIteR15fXqCDXodeV15Ig157XpNeS16kiOwokc2NvcGUuc2hvd0V2ZW50VHlwZVNlbGVjdGVkID0gZmFsc2U7CiRzY29wZS5zaG93RXZlbnRDbGllbnRTZWxlY3RlZCA9IGZhbHNlOwokc2NvcGUubmV3RXZlbnREZXRhaWxzID0ge307IC8vIHRoZXNlIGFyZSB0aGUgY29tcGxldGUgZGV0YWlscyBmb3IgdGhlIG5ldyBldmVudCAvLwokc2NvcGUubmV3RXZlbnREZXRhaWxzLnJlcGVhdFR5cGUgPSAiZm9yZXZlciI7CiRzY29wZS5uZXdFdmVudERldGFpbHMucmVwZWF0Rml4ZWRUaW1lcyA9ICI0IjsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5tYXhfcGFydGljaXBhbnRzID0gMTsKCmxvZ0RlYnVnKCJYWFggPSAiK0pTT04uc3RyaW5naWZ5KHJlc2NoZWR1bGVfZXZlbnQpKTsKCiRzY29wZS5yZXNjaGVkdWxlX2V2ZW50PWZhbHNlOwokc2NvcGUucmVzY2hlZHVsZV9ldmVudF9kZXRhaWxzPXJlc2NoZWR1bGVfZXZlbnQ7CmlmICgkc2NvcGUucmVzY2hlZHVsZV9ldmVudF9kZXRhaWxzIT1udWxsKQp7CmxvZ0RlYnVnKCJyZXNjaGVkdWxlX2V2ZW50X2RldGFpbHM9Iiskc2NvcGUucmVzY2hlZHVsZV9ldmVudF9kZXRhaWxzLmV2ZW50X2lkKTsKbG9nRGVidWcoSlNPTi5zdHJpbmdpZnkoJHNjb3BlLnJlc2NoZWR1bGVfZXZlbnRfZGV0YWlscykpOwokc2NvcGUucmVzY2hlZHVsZV9ldmVudD10cnVlOwokc2NvcGUuZ2l2ZW5fZXZlbnRfdHlwZV9pZCA9ICRzY29wZS5yZXNjaGVkdWxlX2V2ZW50X2RldGFpbHMuZXZlbnRfdHlwZV9pZDsKLy8gc3RpbGwgcHJlZmVyaW5nIGVtcF9pZCBmcm9tIHNjaGVkdWxlciBzdWdnZXN0aW9uIGlzIGl0IHdhcyBzZWxlY3RlZAppZiAoZW1wX2lkIT0wKQp7CiRzY29wZS5naXZlbl9lbXBfaWQgPSBlbXBfaWQ7Cn0KZWxzZQp7CiRzY29wZS5naXZlbl9lbXBfaWQgPSAkc2NvcGUucmVzY2hlZHVsZV9ldmVudF9kZXRhaWxzLmluc3RydWN0b3JfaWQ7Cn0KLy8gc3RpbGwgcHJlZmVyaW5nIGxvY2F0aW9uX2lkIGZyb20gc2NoZWR1bGVyIHN1Z2dlc3Rpb24gb3ZlciB0aGUgb3JpZ2luYWwgbG9jYXRpb24gZnJvbSBldmVudAppZiAobG9jYXRpb25faWQhPTApCnsKJHNjb3BlLmdpdmVuX2xvY2F0aW9uX2lkID0gbG9jYXRpb25faWQ7Cn0KZWxzZQp7CiRzY29wZS5naXZlbl9sb2NhdGlvbl9pZCA9ICRzY29wZS5yZXNjaGVkdWxlX2V2ZW50X2RldGFpbHMubG9jYXRpb25faWQ7Cn0KfQplbHNlCnsKJHNjb3BlLmdpdmVuX2V2ZW50X3R5cGVfaWQgPSBldmVudF90eXBlX2lkOwokc2NvcGUuZ2l2ZW5fbG9jYXRpb25faWQgPSBsb2NhdGlvbl9pZDsKJHNjb3BlLmdpdmVuX2VtcF9pZCA9IGVtcF9pZDsKfQppZiAoJHNjb3BlLmdpdmVuX2V2ZW50X3R5cGVfaWQ+MCkKewokc2NvcGUucHJldmlvdXNseV9zZWxlY3RlZF9ldmVudF90eXBlPXRydWU7Cn0KZWxzZQp7CiRzY29wZS5wcmV2aW91c2x5X3NlbGVjdGVkX2V2ZW50X3R5cGU9ZmFsc2U7Cn0KbG9nRGVidWcoIiRzY29wZS5naXZlbl9ldmVudF90eXBlX2lkPSIrJHNjb3BlLmdpdmVuX2V2ZW50X3R5cGVfaWQpOwoKc2VsZWN0ZWREYXRlU3RhcnQgPSBuZXcgRGF0ZShzdGFydERhdGUpOwpsb2dEZWJ1Zygic2VsZWN0ZWREYXRlU3RhcnQgPSAiK3NlbGVjdGVkRGF0ZVN0YXJ0KTsKdmFyIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZSgpICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKCi8vIGxvZ0RlYnVnKCJkYXRlPSIgKyBzZWxlY3RlZERhdGVTdGFydCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50ID0gW107CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRIb3VycygpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBzZWxlY3RlZERhdGVTdGFydC5nZXRNaW51dGVzKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZG93ID0gZGF5TmFtZXNbc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RGF5KCldOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRhdGUgPSBzZWxlY3RlZERhdGVTdGFydDsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aCA9IG1vbnRoTmFtZXNbc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TW9udGgoKV07CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bW9udGgxMTIgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRNb250aCgpKzE7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aCA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldERhdGUoKTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RnVsbFllYXIoKTsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5zdGFydF90aW1lX2lucHV0X2Zvcm1hdD0gbmV3IERhdGUoMTk3MCwgMCwgMSwgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycywgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzLCAwKTsKCiRzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZCA9ICRzY29wZS5naXZlbl9lbXBfaWQ7CiRzY29wZS5uZXdFdmVudERldGFpbHMubG9jYXRpb25faWQgPSAkc2NvcGUuZ2l2ZW5fbG9jYXRpb25faWQ7CgpnZXRCdXNpbmVzc0xvY2F0aW9ucygkaHR0cCwkc2NvcGUsJ2J1c2luZXNzX2xvY2F0aW9ucycsZ2V0QnVzaW5lc3NMb2NhdGlvbnNfZmluaXNoKTsKZnVuY3Rpb24gZ2V0QnVzaW5lc3NMb2NhdGlvbnNfZmluaXNoKCkKewppZiAoJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5sb2NhdGlvbl9pZD09MCkKewokc2NvcGUubmV3RXZlbnREZXRhaWxzLmxvY2F0aW9uX2lkPSRzY29wZS5idXNpbmVzc19sb2NhdGlvbnNbMF0ubG9jYXRpb25faWQ7Cn0KfQoKY29uc29sZS5sb2coIiRzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZD0iKyRzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZCk7Ci8vIGlmIGNsaWVudCB3YXMgcHJldmlvdXNseSBzZWxlY3RlZAokc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcj1mYWxzZTsKbG9nRGVidWcoInNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXI9IitzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKTsKaWYgKHNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKSE9bnVsbCkKewovLyBjb25zb2xlLmxvZygiZ290IHByZXZpb3VzIHNlbGVjdGVkIHVzZXIgIitzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfZmlyc3RfbmFtZSk7CiRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VybmFtZT1zaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfZmlyc3RfbmFtZSsiICIrc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2VyX2xhc3RfbmFtZTsKJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXI9dHJ1ZTsKCiRzY29wZS5zaG93RXZlbnRDbGllbnRTZWxlY3RlZCA9IHRydWU7CiRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kdXNlcl9pZCA9IHNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKS5idXNpbmVzc191c2VyX2lkOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZHVzZXJfZmlyc3RfbmFtZSA9IHNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKS5idXNlcl9maXJzdF9uYW1lOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZHVzZXJfbGFzdF9uYW1lID0gc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2VyX2xhc3RfbmFtZTsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5idXNpbmVzc191c2VyX2lkID0gc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2luZXNzX3VzZXJfaWQ7Cgp9CiRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZSA9IHN0YXJ0RGF0ZTsKbG9nRGVidWcoIiRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZTE9Iiskc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWUpOwokc2NvcGUuc3RhcnRNaW51dGVzID0gZnVuY3Rpb24oKQp7CmxvZ0RlYnVnKCJzdGFydE1pbnV0ZXMgIisoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKSk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcz1taW51dGVzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpOwpjYWxjdWxhdGVTdGFydFRpbWUoKTsKY2FsY3VsYXRlRW5kVGltZUR5bmFtaWMoKTsKfQokc2NvcGUuc3RhcnRIb3VycyA9IGZ1bmN0aW9uKCkKewpsb2dEZWJ1Zygic3RhcnRIb3VycyAiK2hvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKSk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnM9aG91cnNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMpOwpjYWxjdWxhdGVTdGFydFRpbWUoKTsKY2FsY3VsYXRlRW5kVGltZUR5bmFtaWMoKTsKfQoKJHNjb3BlLmVuZE1pbnV0ZXMgPSBmdW5jdGlvbigpCnsKbG9nRGVidWcoImVuZE1pbnV0ZXMgIisoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcykpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzPW1pbnV0ZXNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpOwpjYWxjdWxhdGVTdGFydFRpbWUoKTsKY2FsY3VsYXRlRW5kVGltZUR5bmFtaWMoKTsKfQokc2NvcGUuZW5kSG91cnMgPSBmdW5jdGlvbigpCnsKbG9nRGVidWcoImVuZEhvdXJzICIraG91cnNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzKSk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzPWhvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vycyk7CmNhbGN1bGF0ZVN0YXJ0VGltZSgpOwpjYWxjdWxhdGVFbmRUaW1lRHluYW1pYygpOwp9CgpmdW5jdGlvbiBjYWxjdWxhdGVTdGFydFRpbWUoKQp7CmV2ZW50WWVhcj0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXI7CmV2ZW50TW9udGg9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aDExMjsKZXZlbnREYXk9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXlvZm1vbnRoOwppZiAocGFyc2VJbnQoZXZlbnRNb250aCk8MTApCnsKZXZlbnRNb250aD0iMCIrZXZlbnRNb250aDsKfQppZiAocGFyc2VJbnQoZXZlbnREYXkpPDEwKQp7CmV2ZW50RGF5PSIwIitldmVudERheTsKfQpsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyPSIrZXZlbnRZZWFyKTsKbG9nRGVidWcoIiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aD0iK2V2ZW50TW9udGgpOwpsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aD0iK2V2ZW50RGF5KTsKbmV3X3N0YXJ0PW1vbWVudC51dGMoZXZlbnRZZWFyKyItIitldmVudE1vbnRoKyItIitldmVudERheSsiVDAwOjAwOjAwIikuYWRkKCgocGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykqNjApK3BhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcykpLCAnbWludXRlcycpOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWU9bmV3X3N0YXJ0Owpsb2dEZWJ1ZygibmV3X3N0YXJ0PSIrbmV3X3N0YXJ0KTsKfQpmdW5jdGlvbiBtaW51dGVzQ2hhbmdlZCh0aGVtaW51dGVzKQp7CmxvZ0RlYnVnKCJ0aGVtaW51dGVzPSIrdGhlbWludXRlcyk7CmlmICh0eXBlb2YgdGhlbWludXRlcz09InVuZGVmaW5lZCIpCnsKcmV0dXJuICIwMCI7Cn0KaWYgKGlzTmFOKHRoZW1pbnV0ZXMpKQp7CnJldHVybiAiMDAiOwp9CmlmICh0aGVtaW51dGVzPT0nJykKewpyZXR1cm4gIjAwIjsKfQp0aGVtaW51dGVzPXBhcnNlSW50KHRoZW1pbnV0ZXMpOwppZiAodGhlbWludXRlcz42MCkKewpyZXR1cm4gIjAwIjsKfQplbHNlIGlmICh0aGVtaW51dGVzPDApCnsKcmV0dXJuICIwMCI7Cn0KZWxzZSBpZiAodGhlbWludXRlcz09IiIpCnsKcmV0dXJuICIwMCI7Cn0KZWxzZSBpZiAodGhlbWludXRlczwxMCkKewpyZXR1cm4gIjAiK3RoZW1pbnV0ZXM7Cn0KZWxzZQp7CnJldHVybiB0aGVtaW51dGVzOwp9Cn0KZnVuY3Rpb24gaG91cnNDaGFuZ2VkKHRoZWhvdXJzKQp7CmxvZ0RlYnVnKCJ0aGVob3Vycz0iK3RoZWhvdXJzKTsKaWYgKHR5cGVvZiB0aGVob3Vycz09InVuZGVmaW5lZCIpCnsKcmV0dXJuICIwIjsKfQppZiAoaXNOYU4odGhlaG91cnMpKQp7CnJldHVybiAiMCI7Cn0KaWYgKHRoZWhvdXJzPT0nJykKewpyZXR1cm4gIjAiOwp9CnRoZWhvdXJzPXBhcnNlSW50KHRoZWhvdXJzKTsKaWYgKHRoZWhvdXJzPjI0KQp7CnJldHVybiAwOwp9CmVsc2UgaWYgKHRoZWhvdXJzPDApCnsKcmV0dXJuIDA7Cn0KZWxzZSBpZiAodGhlaG91cnM9PSIiKQp7CnJldHVybiAiMCI7Cn0KZWxzZQp7CnJldHVybiB0aGVob3VyczsKfQp9CmdldEFsbEluc3RydWN0b3JzKCRodHRwLCRzY29wZSwnaW5zdHJ1Y3RvcnMnLGdldEFsbEluc3RydWN0b3JzX3N1Y2Nlc3MpOwpmdW5jdGlvbiBnZXRBbGxJbnN0cnVjdG9yc19zdWNjZXNzKCkKewovLyAkc2NvcGUuaW5zdHJ1Y3RvcnMudW5zaGlmdCh7YnVzaW5lc3NfdXNlcl9pZDpudWxsLCBidXNlcl9maXJzdF9uYW1lOiIiLCBidXNlcl9sYXN0X25hbWU6IiJ9KTsKaWYgKCEkc2NvcGUubmV3RXZlbnREZXRhaWxzLmluc3RydWN0b3JfaWQ+MCkKewokc2NvcGUubmV3RXZlbnREZXRhaWxzLmluc3RydWN0b3JfaWQ9JHNjb3BlLmluc3RydWN0b3JzWzBdLmJ1c2luZXNzX3VzZXJfaWQ7Cn0KfQoKJHNjb3BlLnNlbGVjdEV2ZW50VHlwZSA9IGZ1bmN0aW9uKCkgewovLyByZW1vdmluZyBldmVudCB0eXBlINeR15fXqCDXodeV15Ig157XpNeS16kKaWYgKCRzY29wZS5ldmVudFR5cGVPcHRpb25zWzBdLmV2ZW50X3R5cGVfaWQ9PTApCnsKJHNjb3BlLmV2ZW50VHlwZU9wdGlvbnMuc3BsaWNlKDAsIDEpOwp9CiRzY29wZS5hamF4X2Vycm9yPScnOwpjaG9pY2U9JHNjb3BlLnNlbGVjdEV2ZW50VHlwZVNlbGVjdGVkOwpsb2dEZWJ1Zygic2VsZWN0RXZlbnRUeXBlIik7CmxvZ0RlYnVnKEpTT04uc3RyaW5naWZ5KCRzY29wZS5zZWxlY3RFdmVudFR5cGVTZWxlY3RlZCkpOwokc2NvcGUuZXZlbnRUeXBlVGl0bGUgPSBjaG9pY2UuZXZlbnRfdHlwZV9uYW1lOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLmV2ZW50X3R5cGVfaWQgPSBjaG9pY2UuZXZlbnRfdHlwZV9pZDsKCiRzY29wZS5uZXdFdmVudERldGFpbHMuZXZlbnRfbmFtZSA9IGNob2ljZS5ldmVudF90eXBlX25hbWU7CiRzY29wZS5uZXdFdmVudERldGFpbHMub3JpZ2luYWxfZXZlbnRfbmFtZSA9IGNob2ljZS5ldmVudF90eXBlX25hbWU7CiRzY29wZS5uZXdFdmVudERldGFpbHMuZXZlbnRfZGVzY3JpcHRpb24gPSBjaG9pY2UuZXZlbnRfdHlwZV9kZXNjcmlwdGlvbjsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pc19jbGFzcyA9IGNob2ljZS5pc19jbGFzczsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5vcmlnaW5hbF9wcmljZSA9IGNob2ljZS5vcmlnaW5hbF9wcmljZTsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pc19nZW5lcmljX2V0eXBlID0gY2hvaWNlLmlzX2dlbmVyaWNfZXR5cGU7Ci8vICRzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZCA9IGNob2ljZS5pbnN0cnVjdG9yX2lkOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50ID0gY2hvaWNlLmR1cmF0aW9uX2V2ZW50OwovLyBsb2dEZWJ1Zygic2NvcGUubmV3RXZlbnREZXRhaWxzLmlzX2NsYXNzPSIrJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pc19jbGFzcyk7Ci8vIGxvZ0RlYnVnKCJzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZD0iKyRzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZCk7Ci8vIGxvZ0RlYnVnKCJzdGFydERhdGU9IitzdGFydERhdGUpOwovLyAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWUgPSBzdGFydERhdGU7CiRzY29wZS5uZXdFdmVudERldGFpbHMuZXZlbnR0eXBlID0gY2hvaWNlOwpjYWxjdWxhdGVFbmRUaW1lKCk7CgovLyAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWVfaW5wdXRfZm9ybWF0PSBuZXcgRGF0ZSgxOTcwLCAwLCAxLCAxNCwgNTcsIDApOwoKbG9nRGVidWcoIm5ld0V2ZW50IHN0YXJ0PSIgKyAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWUpOwpsb2dEZWJ1ZygibmV3RXZlbnQgZW5kPSIgKyAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZF90aW1lKTsKCiRzY29wZS5zaG93RXZlbnRUeXBlU2VsZWN0ZWQgPSB0cnVlOwp9CgovLyB0aGlzIGZ1bmN0aW9uIGNhbGN1bGF0ZXMgZW5kIHRpbWUgYWNjb3JkaW5nIHRvIHRoZSBsZW5ndGggb2YgdGhlIGV2ZW50dHlwZQpmdW5jdGlvbiBjYWxjdWxhdGVFbmRUaW1lKCkKewpjb25zb2xlLmxvZygiJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5zdGFydF90aW1lPSIrJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5zdGFydF90aW1lKTsKZW5kID0gbW9tZW50KCRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZSkuYWRkKCRzY29wZS5uZXdFdmVudERldGFpbHMuZHVyYXRpb25fZXZlbnQsICdtaW51dGVzJyk7CnNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKGVuZCk7CnNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKHNlbGVjdGVkRGF0ZUVuZC5nZXRUaW1lKCkgKyBzZWxlY3RlZERhdGVFbmQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMgPSBzZWxlY3RlZERhdGVFbmQuZ2V0SG91cnMoKTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kZG93ID0gZGF5TmFtZXNbc2VsZWN0ZWREYXRlRW5kLmdldERheSgpXTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcyA9IChzZWxlY3RlZERhdGVFbmQuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBzZWxlY3RlZERhdGVFbmQuZ2V0TWludXRlcygpOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZF90aW1lID0gZW5kOwovLyBjYWxjdWxhdGluZyBkdXJhdGlvbgokc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50PXBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpLXBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcyk7CiRzY29wZS5uZXdFdmVudERldGFpbHMuZHVyYXRpb25fZXZlbnQ9JHNjb3BlLm5ld0V2ZW50RGV0YWlscy5kdXJhdGlvbl9ldmVudCsocGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMpLXBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMpKSo2MDsKaWYgKCRzY29wZS5uZXdFdmVudERldGFpbHMuZHVyYXRpb25fZXZlbnQ8MCkKewokc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50PTA7Cn0KfQoKLy8gdGhpcyBmdW5jdGlvbiBjYWxjdWxhdGVzIGVuZCB0aW1lIGFjY29yZGluZyB0byB0aGUgaW5wdXQgZnJvbSBtb2RhbCB3aW5kb3cKLy8gYW5kIG5vdCBhY2NvcmRpbmcgdG8gZXZlbnQgdHlwZSBsZW5ndGgKZnVuY3Rpb24gY2FsY3VsYXRlRW5kVGltZUR5bmFtaWMoKQp7CmV2ZW50WWVhcj0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXI7CmV2ZW50TW9udGg9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aDExMjsKZXZlbnREYXk9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXlvZm1vbnRoOwppZiAocGFyc2VJbnQoZXZlbnRNb250aCk8MTApCnsKZXZlbnRNb250aD0iMCIrZXZlbnRNb250aDsKfQppZiAocGFyc2VJbnQoZXZlbnREYXkpPDEwKQp7CmV2ZW50RGF5PSIwIitldmVudERheTsKfQpsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyPSIrZXZlbnRZZWFyKTsKbG9nRGVidWcoIiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aD0iK2V2ZW50TW9udGgpOwpsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aD0iK2V2ZW50RGF5KTsKbmV3X2VuZD1tb21lbnQudXRjKGV2ZW50WWVhcisiLSIrZXZlbnRNb250aCsiLSIrZXZlbnREYXkrIlQwMDowMDowMCIpLmFkZCgoKHBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzKSo2MCkrcGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcykpLCAnbWludXRlcycpOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZF90aW1lPW5ld19lbmQ7CmxvZ0RlYnVnKCJuZXdfZW5kPSIrbmV3X2VuZCk7Ci8vIGNhbGN1bGF0aW5nIGR1cmF0aW9uCiRzY29wZS5uZXdFdmVudERldGFpbHMuZHVyYXRpb25fZXZlbnQ9cGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcyktcGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKTsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5kdXJhdGlvbl9ldmVudD0kc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50KyhwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycyktcGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykpKjYwOwppZiAoJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5kdXJhdGlvbl9ldmVudDwwKQp7CiRzY29wZS5uZXdFdmVudERldGFpbHMuZHVyYXRpb25fZXZlbnQ9MDsKfQp9CmdldEFsbEJ1c2luZXNzRXZlbnRUeXBlcygkaHR0cCwkc2NvcGUsJ2V2ZW50VHlwZU9wdGlvbnMnLGdldEFsbEJ1c2luZXNzRXZlbnRUeXBlc19zdWNjZXNzKTsKZnVuY3Rpb24gZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzX3N1Y2Nlc3MoKQp7Ci8vIGFmdGVyIGxvYWRpbmcgZXZlbnQgdHlwZXMsIGlmIHRoZSBnaXZlbiBldmVudCB0eXBlIGlzICE9IDAgd2UgInNlbGVjdCIgaXQKY29uc29sZS5sb2coImdldEFsbEJ1c2luZXNzRXZlbnRUeXBlc19zdWNjZXNzIik7CmlmICgkc2NvcGUuZ2l2ZW5fZXZlbnRfdHlwZV9pZD4wKQp7CmZvcih2YXIgaSA9IDA7IGkgPCAkc2NvcGUuZXZlbnRUeXBlT3B0aW9ucy5sZW5ndGg7IGkrKykKewppZiAoJHNjb3BlLmV2ZW50VHlwZU9wdGlvbnNbaV0uZXZlbnRfdHlwZV9pZD09JHNjb3BlLmdpdmVuX2V2ZW50X3R5cGVfaWQpCnsKY29uc29sZS5sb2coImdpdmVuX2V2ZW50X3R5cGVfaWQgZm91bmQiKTsKLy8gJHNjb3BlLmNhbGN1bGF0ZVN0YXJ0VGltZSgpOwokc2NvcGUuc2VsZWN0RXZlbnRUeXBlU2VsZWN0ZWQ9JHNjb3BlLmV2ZW50VHlwZU9wdGlvbnNbaV07Ci8vICRzY29wZS5zZWxlY3RFdmVudFR5cGUoJHNjb3BlLmV2ZW50VHlwZU9wdGlvbnNbaV0pOwokc2NvcGUuc2VsZWN0RXZlbnRUeXBlKCk7Cn0KfQp9CmVsc2Ugewokc2NvcGUuZXZlbnRUeXBlT3B0aW9ucy51bnNoaWZ0KHsiZXZlbnRfdHlwZV9pZCI6MCwgImV2ZW50X3R5cGVfbmFtZSI6IteR15fXqCDXodeV15Ig157XpNeS16kiLCBpc192YWNhdGlvbjogMH0pOwokc2NvcGUuc2VsZWN0RXZlbnRUeXBlU2VsZWN0ZWQ9JHNjb3BlLmV2ZW50VHlwZU9wdGlvbnNbMF07Cn0KfQpnZXRBbGxDbGllbnRzKCRodHRwLCRzY29wZSwnZXZlbnRUeXBlVXNlcnMnKTsKCiRzY29wZS5ldmVudENsaWVudFNlbGVjdGVkID0gZnVuY3Rpb24oc2VsZWN0ZWQpIHsKaWYgKHNlbGVjdGVkKSB7Ci8vIGFsZXJ0KEpTT04uc3RyaW5naWZ5KCBzZWxlY3RlZCwgbnVsbCwgMiApKTsKbG9nRGVidWcoJ2NsaWVudCBzZWxlY3RlZCAnICsgc2VsZWN0ZWQub3JpZ2luYWxPYmplY3QuYnVzZXJfZmlyc3RfbmFtZSk7CiRzY29wZS5zaG93RXZlbnRDbGllbnRTZWxlY3RlZCA9IHRydWU7CiRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kdXNlcl9pZCA9IHNlbGVjdGVkLm9yaWdpbmFsT2JqZWN0LmJ1c2luZXNzX3VzZXJfaWQ7CiRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kdXNlcl9maXJzdF9uYW1lID0gc2VsZWN0ZWQub3JpZ2luYWxPYmplY3QuYnVzZXJfZmlyc3RfbmFtZTsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmR1c2VyX2xhc3RfbmFtZSA9IHNlbGVjdGVkLm9yaWdpbmFsT2JqZWN0LmJ1c2VyX2xhc3RfbmFtZTsKfSBlbHNlIHsKbG9nRGVidWcoJ25vdCBzZWxlY3RlZCcpOwovLyAkc2NvcGUuZXZlbnRDbGllbnREZVNlbGVjdGVkKCk7Cn0KfTsKJHNjb3BlLmV2ZW50Q2xpZW50RGVTZWxlY3RlZCA9IGZ1bmN0aW9uKCkgewokc2NvcGUuc2hvd0V2ZW50Q2xpZW50U2VsZWN0ZWQgPSBmYWxzZTsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmR1c2VyX2lkID0gbnVsbDsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmR1c2VyX2ZpcnN0X25hbWUgPSBudWxsOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZHVzZXJfbGFzdF9uYW1lID0gbnVsbDsKJHNjb3BlLmNsZWFyQ2xpZW50SW5wdXQoJ2NsaWVudF9hbmd1Y29tcGxldGUnKTsKfQoKJHNjb3BlLmNsZWFyQ2xpZW50SW5wdXQgPSBmdW5jdGlvbihpZCkgewppZiAoaWQpIHsKJHNjb3BlLiRicm9hZGNhc3QoJ2FuZ3Vjb21wbGV0ZS1hbHQ6Y2xlYXJJbnB1dCcsIGlkKTsKfQovLyBlbHNlewovLyAgICRzY29wZS4kYnJvYWRjYXN0KCdhbmd1Y29tcGxldGUtYWx0OmNsZWFySW5wdXQnKTsKLy8gfQp9Cgokc2NvcGUuY2FuY2VsID0gZnVuY3Rpb24oKSB7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKfTsKCiRzY29wZS51cGRhdGVFdmVudE5hbWVDaGVjayA9IGZ1bmN0aW9uKG5ld1ZhbHVlKQp7CmxvZ0RlYnVnKCJ1cGRhdGVFdmVudE5hbWU9IituZXdWYWx1ZSk7CmlmIChuZXdWYWx1ZT09IiIpCnsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5ldmVudF9uYW1lID0gJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5vcmlnaW5hbF9ldmVudF9uYW1lOwp9Cn0KLy8gcmVzY2hlZHVsZUV2ZW50CiRzY29wZS5yZXNjaGVkdWxlRXZlbnQgPSBmdW5jdGlvbigpIHsKbG9nRGVidWcoImZ1bmN0aW9uOiByZXNjaGVkdWxlRXZlbnQiKTsKCi8vIG5ld0V2ZW50SlNPTkRldGFpbHMgPSBKU09OLnN0cmluZ2lmeSgkc2NvcGUubmV3RXZlbnREZXRhaWxzLCBudWxsLCA0KTsgLy8gKE9wdGlvbmFsKSBiZWF1dGlmdWwgaW5kZW50ZWQgb3V0cHV0Lgpsb2dEZWJ1ZygicmVzY2hlZHVsZUV2ZW50LCAiICsgSlNPTi5zdHJpbmdpZnkoJHNjb3BlLm5ld0V2ZW50RGV0YWlscywgbnVsbCwgNCkpOwovLyBpZiAoJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5ldmVudFJlY3VycmluZykgewovLyAgIGNyZWF0ZVJlY3VycmluZ0V2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUubmV3RXZlbnREZXRhaWxzLGNyZWF0ZVJlY3VycmluZ0V2ZW50X3N1Y2Nlc3MpOwovLyAgIGZ1bmN0aW9uIGNyZWF0ZVJlY3VycmluZ0V2ZW50X3N1Y2Nlc3MoKQovLyAgIHsKLy8gICAgIGNhbGVuZGFyID0gImNhbGVuZGFyX2J1c2luZXNzIjsKLy8gICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKLy8gICAgICR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoKTsKLy8gICAgIC8vIGVycm9yIHdhcwovLyAgICAgLy8gbG9nRGVidWcoImVycm9yICIgKyBkYXRhLk1lc3NhZ2UpOwovLyAgICAgLy8gJHNjb3BlLmFqYXhfZXJyb3IgPSBkYXRhLk1lc3NhZ2U7Ci8vICAgfQovLyB9Ci8vIGVsc2UKewovLyBpZiBldmVudCBpcyBub3QgY2xhc3MsIGEgY2xpZW50IG11c3QgYmUgc2VsZWN0ZWQKLy8gaWYgKCghJHNjb3BlLnNob3dFdmVudENsaWVudFNlbGVjdGVkKSAmJiAoISRzY29wZS5uZXdFdmVudERldGFpbHMuaXNfY2xhc3MpKQovLyB7Ci8vICAgLy8gYWxlcnQoJ2NsaWVudCBtdXN0IGJlIHNlbGVjdGVkJyk7Ci8vICAgJHNjb3BlLmFqYXhfZXJyb3I9IteQ16DXkCDXlNeV16HXoyDXntep16rXqtejINec157XpNeS16kiOwovLyAgIHJldHVybjsKLy8gfQpyZXNjaGVkdWxlRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5yZXNjaGVkdWxlX2V2ZW50X2RldGFpbHMuZXZlbnRfaWQsJHNjb3BlLm5ld0V2ZW50RGV0YWlscyxyZXNjaGVkdWxlRXZlbnRfc3VjY2Vzcyk7CmZ1bmN0aW9uIHJlc2NoZWR1bGVFdmVudF9zdWNjZXNzKCkKewpjYWxlbmRhciA9ICJjYWxlbmRhcl9idXNpbmVzcyI7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjYWxlbmRhckV2ZW50UmVzY2hlZHVsZURlc2VsZWN0Jyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCiR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoJ2FkZGVkJyk7Cn0KLy8gb24gZmFpbHVyZSB3YXMKLy8gJHNjb3BlLmFqYXhfZXJyb3IgPSBkYXRhLk1lc3NhZ2U7Cn0KfTsKCiRzY29wZS5jcmVhdGVOZXdFdmVudCA9IGZ1bmN0aW9uKCkgewpsb2dEZWJ1ZygiY3JlYXRlTmV3RXZlbnQgc3RhcnRfdGltZT0iKyB0eXBlb2YgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5zdGFydF90aW1lKTsKCm5ld0V2ZW50SlNPTkRldGFpbHMgPSBKU09OLnN0cmluZ2lmeSgkc2NvcGUubmV3RXZlbnREZXRhaWxzLCBudWxsLCA0KTsgLy8gKE9wdGlvbmFsKSBiZWF1dGlmdWwgaW5kZW50ZWQgb3V0cHV0Lgpsb2dEZWJ1ZygiY3JlYXRlTmV3RXZlbnQsICIgKyBuZXdFdmVudEpTT05EZXRhaWxzKTsKaWYgKCRzY29wZS5uZXdFdmVudERldGFpbHMuZXZlbnRSZWN1cnJpbmcpIHsKY3JlYXRlUmVjdXJyaW5nRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5uZXdFdmVudERldGFpbHMsY3JlYXRlUmVjdXJyaW5nRXZlbnRfc3VjY2Vzcyk7CmZ1bmN0aW9uIGNyZWF0ZVJlY3VycmluZ0V2ZW50X3N1Y2Nlc3MoKQp7CmNhbGVuZGFyID0gImNhbGVuZGFyX2J1c2luZXNzIjsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwokdWliTW9kYWxJbnN0YW5jZS5kaXNtaXNzKCk7Ci8vIGVycm9yIHdhcwovLyBsb2dEZWJ1ZygiZXJyb3IgIiArIGRhdGEuTWVzc2FnZSk7Ci8vICRzY29wZS5hamF4X2Vycm9yID0gZGF0YS5NZXNzYWdlOwp9Cn0KZWxzZQp7Ci8vIGNoZWNraW5nIGV2ZW50IHRpbWUgbG9naWMKaWYgKCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnM+JHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMpCnsKJHNjb3BlLmFqYXhfZXJyb3I9IteW157XnyDXlNeU16rXl9ec15Qg16nXnCDXlNee16TXktepINeQ15fXqNeZINeW157XnyDXlNeh15nXldedINep15zXlSI7CnJldHVybjsKfQovLyBjaGVja2luZyBldmVudCB0aW1lIGxvZ2ljCmlmIChwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKT09cGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMpKQp7CmlmIChwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpPj1wYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzKSkKewokc2NvcGUuYWpheF9lcnJvcj0i15bXntefINeU15TXqteX15zXlCDXqdecINeU157XpNeS16kg15DXl9eo15kg15bXntefINeU16HXmdeV150g16nXnNeVIjsKcmV0dXJuOwp9CmxvZ0RlYnVnKCIkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXM9Iiskc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpOwpsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcz0iKyRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpOwppZiAoKHBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcykrNSk+PXBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpKQp7CiRzY29wZS5hamF4X2Vycm9yPSLXkNeV16jXmiDXlNee16TXktepINeX15nXmdeRINec15TXmdeV16og15zXpNeX15XXqiA1INeT16fXldeqIjsKcmV0dXJuOwp9Cn0KLy8gaWYgZXZlbnQgaXMgbm90IGNsYXNzLCBhIGNsaWVudCBtdXN0IGJlIHNlbGVjdGVkCmlmICgoISRzY29wZS5zaG93RXZlbnRDbGllbnRTZWxlY3RlZCkgJiYgKCEkc2NvcGUubmV3RXZlbnREZXRhaWxzLmlzX2NsYXNzKSAmJiAoJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pc19nZW5lcmljX2V0eXBlPT0wKSkKewovLyBhbGVydCgnY2xpZW50IG11c3QgYmUgc2VsZWN0ZWQnKTsKJHNjb3BlLmFqYXhfZXJyb3I9IteQ16DXkCDXlNeV16HXoyDXntep16rXqtejINec157XpNeS16kiOwpyZXR1cm47Cn0KaWYgKCRzY29wZS5zZWxlY3RFdmVudFR5cGVTZWxlY3RlZC5ldmVudF90eXBlX2lkPT0wKQp7Ci8vIGFsZXJ0KCdjbGllbnQgbXVzdCBiZSBzZWxlY3RlZCcpOwokc2NvcGUuYWpheF9lcnJvcj0i15DXoNeQINeR15fXqCDXodeV15Ig157XpNeS16kgIjsKcmV0dXJuOwp9CmNyZWF0ZUV2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUubmV3RXZlbnREZXRhaWxzLGNyZWF0ZUV2ZW50X3N1Y2Nlc3MpOwpmdW5jdGlvbiBjcmVhdGVFdmVudF9zdWNjZXNzKCkKewpjYWxlbmRhciA9ICJjYWxlbmRhcl9idXNpbmVzcyI7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKJHVpYk1vZGFsSW5zdGFuY2UuZGlzbWlzcygnYWRkZWQnKTsKfQovLyBvbiBmYWlsdXJlIHdhcwovLyAkc2NvcGUuYWpheF9lcnJvciA9IGRhdGEuTWVzc2FnZTsKfQp9Cn0pOwovLy8vIGZmZmZmZmYKa3V6ZUFwcC5jb250cm9sbGVyKCdCdXNpbmVzc0NhbGVuZGFyQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsIHNoYXJlZFByb3BlcnRpZXMsICRjb21waWxlLCAkbG9jYXRpb24sIHVpQ2FsZW5kYXJDb25maWcsICR1aWJNb2RhbCwgc2hhcmVkRGF0YSkgewppbml0aWFsRW5kVXNlciA9IHNoYXJlZERhdGEuZ2V0U2VsZWN0ZWRFbmRVc2VyKCk7CmxvZ0RlYnVnKCdCdXNpbmVzc0NhbGVuZGFyIENvbnRyb2xsZXIsIHNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKT0nICsgc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpKTsKCmdldEJ1c2luZXNzTG9jYXRpb25zKCRodHRwLCRzY29wZSwnYnVzaW5lc3NfbG9jYXRpb25zJyk7CgogICAgJHNjb3BlLnN0YXR1c2VzID0gWyB7InN0YXR1c19pZCI6IjAiLCJzdGF0dXNfbmFtZSI6Itek16rXldeXIn0sIHsic3RhdHVzX2lkIjoiMSIsInN0YXR1c19uYW1lIjoi16HXkteV16gifV07CiAgICAkc2NvcGUudGhlZGF0YV9yZXBvcnQgPSB7fTsKCiAgICAkc2NvcGUudGhlZGF0YV9yZXBvcnQuc291cmNlID0gImNhbGVuZGFyIjsKICAgICRzY29wZS50aGVkYXRhX3JlcG9ydC5maWx0ZXJzID0gewogICAgICBpc19jYW5jZWxlZDogIjAiCiAgICB9OwoKICAgICRzY29wZS51cGRhdGVFdmVudHMgPSBmdW5jdGlvbigpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJ1cGRhdGVFdmVudHMiKTsKICAgICAgaW5zdHJ1Y3Rvcl9pZF9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuY2FsZW5kYXJJbnN0cnVjdG9yRmlsdGVyLCAiYnVzaW5lc3NfdXNlcl9pZCIgKTsKICAgICAgZXZlbnRfdHlwZV9pZF9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuY2FsZW5kYXJFdmVudFR5cGVGaWx0ZXIsICJldmVudF90eXBlX2lkIiApOwogICAgICBzdGF0dXNfZmlsdGVyID0gbGlzdF90b19zdHJpbmdfYnlfdmFsdWUoJHNjb3BlLmNhbGVuZGFyU3RhdHVzRmlsdGVyLCAic3RhdHVzX2lkIiApOwoKICAgICAgJHNjb3BlLnRoZWRhdGFfcmVwb3J0LmZpbHRlcnMgPSB7CiAgICAgICAgaW5zdHJ1Y3Rvcl9pZDogaW5zdHJ1Y3Rvcl9pZF9maWx0ZXIsCiAgICAgICAgZXZlbnRfdHlwZV9pZDogZXZlbnRfdHlwZV9pZF9maWx0ZXIsCiAgICAgICAgc3RhdHVzOiBzdGF0dXNfZmlsdGVyLAogICAgICAgIGlzX2NhbmNlbGVkOiAiMCIKICAgICAgfTsKCiAgICAgIC8vIGNvbnNvbGUubG9nKCRzY29wZS5jYWxlbmRhcik7CiAgICAgIGxvZ0RlYnVnKCJiZWZvcmUgcmVmZXRjaEV2ZW50cyIpOwogICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwogICAgICBsb2dEZWJ1ZygiYWZ0ZXIgcmVmZXRjaEV2ZW50cyIpOwogICAgICAvLyB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwoKICAgIH0KCiRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyPWZhbHNlOwoKaWYgKHNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKSE9bnVsbCkKewpjb25zb2xlLmxvZygiZ290IHByZXZpb3VzIHNlbGVjdGVkIHVzZXIgIitzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfZmlyc3RfbmFtZSk7CiRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VybmFtZT1zaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfZmlyc3RfbmFtZSsiICIrc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2VyX2xhc3RfbmFtZTsKJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJfaWQ9c2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2luZXNzX3VzZXJfaWQ7CmxvZ0RlYnVnKCIkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcl9pZD0iKyRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyX2lkKTsKCiRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyPXRydWU7Cn0KCi8vIGNoZWNraW5nIGlmIGNhbGVuZGFyIHNob3VsZCBzdGFydCB3aXRoIGEgc3BlY2lmaWMgZGF0ZSAoZnJvbSB1cmwgb3IgZnJvbSBwcmV2aW91c2x5IHNlbGVjdGVkIGRhdGUpCmxvZ0RlYnVnKCIkbG9jYXRpb24uc2VhcmNoKCkuc3RhcnQ9IiArICRsb2NhdGlvbi5zZWFyY2goKS5zdGFydCk7CmlmICh0eXBlb2YgJGxvY2F0aW9uLnNlYXJjaCgpLnN0YXJ0ICE9ICd1bmRlZmluZWQnKQp7CmN1cnJEZWZhdWx0RGF0ZSA9ICRsb2NhdGlvbi5zZWFyY2goKS5zdGFydDsKfQplbHNlIGlmIChzaGFyZWRQcm9wZXJ0aWVzLmdldF9jYWxlbmRhcl9kYXRlKCkhPW51bGwpCnsKY29uc29sZS5sb2coImdvdCBwcmV2aW91cyBkYXRlICAiK3NoYXJlZFByb3BlcnRpZXMuZ2V0X2NhbGVuZGFyX2RhdGUoKSk7CmN1cnJEZWZhdWx0RGF0ZSA9IHNoYXJlZFByb3BlcnRpZXMuZ2V0X2NhbGVuZGFyX2RhdGUoKTsKfQplbHNlCnsKY3VyckRlZmF1bHREYXRlID0gbmV3IERhdGUoKTsKfQpnZXRBbGxJbnN0cnVjdG9ycygkaHR0cCwkc2NvcGUsJ2J1c2luZXNzX2luc3RydWN0b3JzJyxnZXRBbGxJbnN0cnVjdG9yc19maW5pc2gpOwogICAgZ2V0QWxsSW5zdHJ1Y3RvcnMoJGh0dHAsJHNjb3BlLCdpbnN0cnVjdG9ycycpOwpmdW5jdGlvbiBnZXRBbGxJbnN0cnVjdG9yc19maW5pc2goKQp7Ci8vIGNvbnNvbGUubG9nKCRzY29wZS5idXNpbmVzc19pbnN0cnVjdG9ycyk7CiRzY29wZS5idXNpbmVzc19pbnN0cnVjdG9ycy51bnNoaWZ0KHsiYnVzZXJfZnVsbF9uYW1lIjoi15vXnCDXlNem15XXldeqIiwgImJ1c2VyX2ZpcnN0X25hbWUiOiLXm9eV15zXnSIsImJ1c2VyX2xhc3RfbmFtZSI6IiIsICJ1c2VyX2lkIjogMCwgImJ1c2luZXNzX3VzZXJfaWQiOiAwfSk7CgovLyBzZXR0aW5nIHNlbGVjdGVkIGdldF9zZWxlY3RlZF9pbnN0cnVjdG9yCiRzY29wZS5wcmV2aW91c19zZWxlY3RlZF9pbnN0cnVjdG9yPWZhbHNlOwppZiAoc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfaW5zdHJ1Y3RvcigpPj0wKQp7Ci8vIGNvbnNvbGUubG9nKCJnb3QgcHJldmlvdXMgc2VsZWN0ZWQgaW5zdHJ1Y3RvciAiK3NoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX2luc3RydWN0b3IoKSk7CiRzY29wZS5wcmV2aW91c19zZWxlY3RlZF9pbnN0cnVjdG9yX2lkPXNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX2luc3RydWN0b3IoKTsKJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX2luc3RydWN0b3I9dHJ1ZTsKJHNjb3BlLnNlbGVjdGVkX2J1c2luZXNzX3VzZXJfaWQ9c2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfaW5zdHJ1Y3RvcigpOwp9Cn0KICAgIGdldEFsbEJ1c2luZXNzRXZlbnRUeXBlcygkaHR0cCwkc2NvcGUsJ2V2ZW50X3R5cGVzX2NhbHMnKTsKZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzTm9TeXN0ZW0oJGh0dHAsJHNjb3BlLCdldmVudF90eXBlcycpOwoKLy8gc2V0dGluZyBzZWxlY3RlZCB1c2VyIGlkCiRzY29wZS5wcmV2aW91c19ldmVudF9yZXNjaGVkdWxlPWZhbHNlOwokc2NvcGUucHJldmlvdXNfZXZlbnRfcmVzY2hlZHVsZV9ldmVudD1udWxsOwoKJHNjb3BlLiRvbigiY2FsZW5kYXJFdmVudFJlc2NoZWR1bGVEZXNlbGVjdCIsZnVuY3Rpb24oZSxhKQp7CiRzY29wZS5jYWxlbmRhckV2ZW50UmVzY2hlZHVsZURlc2VsZWN0KCk7Cn0pOwoKLy8gZGVzZWxlY3RpbmcgZXZlbnQgZnJvbSBiZWluZyByZXNjaGVkdWxlZAokc2NvcGUuY2FsZW5kYXJFdmVudFJlc2NoZWR1bGVEZXNlbGVjdD1mdW5jdGlvbigpCnsKc2hhcmVkUHJvcGVydGllcy5zZXRfZXZlbnRfcmVzY2hlZHVsZShudWxsKTsKJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGU9ZmFsc2U7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZWZldGNoRXZlbnRzJyk7Cn0KLy8gZGVsZXRpbmcgY2xpZW50IHNlbGVjdGlvbiBpbiBjYWxlbmRhcgokc2NvcGUuY2FsZW5kYXJDbGllbnREZXNlbGVjdD1mdW5jdGlvbigpIC8vIHJlbG9hZCBjbGFzcy9ldmVudCBzdWdnZXN0aW9ucwp7CiRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyPWZhbHNlOwpzaGFyZWRQcm9wZXJ0aWVzLnNldF9zZWxlY3RlZF91c2VyKG51bGwpOwokc2NvcGUuZXZlbnRUeXBlU2VsZWN0ZWQoKTsKfQppZiAoaW5pdGlhbEVuZFVzZXIgIT0gbnVsbCkgewokc2NvcGUuYnVzaW5lc3NDYWxlbmRhckluaXRpYWxOYW1lID0gdHJ1ZTsKc2hhcmVkRGF0YS5zZXRTZWxlY3RlZEVuZFVzZXIobnVsbCk7CiRzY29wZS5idXNpbmVzc0NhbGVuZGFySW5pdGlhbHMgPSB7Cm5hbWU6IGluaXRpYWxFbmRVc2VyLmZpcnN0X25hbWUgKyAiICIgKyBpbml0aWFsRW5kVXNlci5sYXN0X25hbWUKfTsKfSBlbHNlIHsKJHNjb3BlLmJ1c2luZXNzQ2FsZW5kYXJJbml0aWFsTmFtZSA9IGZhbHNlOwp9Ci8qIGNvbmZpZyBvYmplY3QgKi8KJHNjb3BlLmNhbGVuZGFyX25hbWUgPSAiY2FsZW5kYXJfYnVzaW5lc3MiOwokc2NvcGUuY2FsZW5kYXIgPSAiY2FsZW5kYXJfYnVzaW5lc3MiOwovKiBldmVudCBzb3VyY2VzIGFycmF5Ki8KCiAgICAvLyB0aGVkYXRhID0geyBzb3VyY2U6ICJjYWxlbmRhciIgfQogICAgLy8gdGhlZGF0YVsnZmlsdGVycyddID0geyBpbnN0cnVjdG9yX2lkOiAiMTk1In07CgogICAgLy8gY29uc29sZS5sb2codGhlZGF0YSk7Cgokc2NvcGUuYnVzaW5lc3NDYWxlbmRhckV2ZW50U291cmNlcyA9IFt7CiAgICAgIC8vIHVybDogJy9hcGkvYWRtaW4vZXZlbnRzL2dldHBvc3QnLAogICAgICB1cmw6ICcvYXBpL2FkbWluL3JlcG9ydHMvZXZlbnRzMicsCiAgICAgIGRhdGE6ICRzY29wZS50aGVkYXRhX3JlcG9ydCAsCnR5cGU6ICdQT1NUJwp9LCB7CnVybDogJy9hcGkvYWRtaW4vY2FsZW5kYXIvbGltaXRhdGlvbnMvYmFja2dyb3VuZC9nZXRwb3N0JywKICAgICAgZGF0YTogJHNjb3BlLnRoZWRhdGFfcmVwb3J0ICwKICAgICAgdHlwZTogJ1BPU1QnICAgIC8vIH0sIHsKLy8gICAgIHVybDogJy9hcGkvYWRtaW4vcmVjdXJyaW5nL2dldHBvc3QnLAovLyAgICAgdHlwZTogJ1BPU1QnCn1dOwoKJHNjb3BlLmdvdG9Ub2RheSA9IGZ1bmN0aW9uKCkgewokc2NvcGUuZ290b0RhdGUobmV3IERhdGUoKSk7CnZpc2libGVEYXRlU3RhcnQgPSBuZXcgRGF0ZSh1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ2V0VmlldycpLnN0YXJ0KTsKZGF0ZVRvR29UbyA9IHZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSArICItIiArICgnMCcgKyAodmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpICsgMSkpLnNsaWNlKC0yKSArICItIiArICgnMCcgKyB2aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSkuc2xpY2UoLTIpOwpzaGFyZWRQcm9wZXJ0aWVzLnNldF9jYWxlbmRhcl9kYXRlKGRhdGVUb0dvVG8pOwokc2NvcGUudmlzaWJsZURhdGVTdGFydD12aXNpYmxlRGF0ZVN0YXJ0OwokbG9jYXRpb24uc2VhcmNoKCdzdGFydCcsZGF0ZVRvR29Ubyk7Cn0KCiRzY29wZS5pbnN0cnVjdG9yU2VsZWN0ZWQ9ZnVuY3Rpb24odGhpc3RoaXMpCnsKdXBkYXRlU3VnZ2VzdGlvbnMoKTsKfQokc2NvcGUuZXZlbnRUeXBlU2VsZWN0ZWQ9ZnVuY3Rpb24odGhpc3RoaXMpCnsKdXBkYXRlU3VnZ2VzdGlvbnMoKTsKfQpmdW5jdGlvbiB1cGRhdGVTdWdnZXN0aW9ucygpCnsKbG9nRGVidWcoImZ1bmN0aW9uOiB1cGRhdGVTdWdnZXN0aW9ucyIpOwpzaGFyZWRQcm9wZXJ0aWVzLnNldF9ldmVudF90eXBlX2Zvcl9zdWdnZXN0aW9ucygkc2NvcGUuc2VsZWN0ZWRfZXZlbnRfdHlwZV9pZCk7CnNoYXJlZFByb3BlcnRpZXMuc2V0X3NlbGVjdGVkX2luc3RydWN0b3IoJHNjb3BlLnNlbGVjdGVkX2J1c2luZXNzX3VzZXJfaWQpOwpmb3IgKGk9MDtpPCRzY29wZS5ldmVudF90eXBlcy5sZW5ndGg7aSsrKQp7Ci8vIGNvbnNvbGUubG9nKCRzY29wZS5ldmVudF90eXBlc1tpXS5ldmVudF90eXBlX2lkKTsKaWYgKCRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkPT0kc2NvcGUuZXZlbnRfdHlwZXNbaV0uZXZlbnRfdHlwZV9pZCkKewovLyBjb25zb2xlLmxvZygiZm91bmQgZXZlbnQgdHlwZSBpZCIpOwppZiAoJHNjb3BlLmV2ZW50X3R5cGVzW2ldLmlzX2NsYXNzKSAvLyBpcyBjbGFzcwp7CmxvZ0RlYnVnKCIkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcj0iKyRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyKTsKaWYgKCRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyKQp7CmNvbnNvbGUubG9nKCJpcyBjbGFzcyBzdWdnZXN0aW9uZCIpOwokaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3RjbGFzcy8iKyRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkKyIvIiskc2NvcGUuc2VsZWN0ZWRfYnVzaW5lc3NfdXNlcl9pZCsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSsiLyIrKCRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkrMSkrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0SG91cnMoKSArICIvIiArICRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKSArICIvIiArICRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyX2lkKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKQp7CiRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkX2lzX2NsYXNzPXRydWU7CiRzY29wZS5ldmVudHNTdWdnZXN0ZWQgPSByZXNwb25zZS5kYXRhOwp9KTsKfQplbHNlCnsKY29uc29sZS5sb2coIm5vdCBpcyBjbGFzcyBzdWdnZXN0aW9uZCIpOwokaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3RjbGFzcy8iKyRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkKyIvIiskc2NvcGUuc2VsZWN0ZWRfYnVzaW5lc3NfdXNlcl9pZCsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSsiLyIrKCRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkrMSkrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0SG91cnMoKSArICIvIiArICRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKSArICIvMCIpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpCnsKJHNjb3BlLnNlbGVjdGVkX2V2ZW50X3R5cGVfaWRfaXNfY2xhc3M9dHJ1ZTsKJHNjb3BlLmV2ZW50c1N1Z2dlc3RlZCA9IHJlc3BvbnNlLmRhdGE7Cn0pOwp9Cn0KZWxzZSAvLyBpcyBub3QgY2xhc3MKewokaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3QvIiskc2NvcGUuc2VsZWN0ZWRfZXZlbnRfdHlwZV9pZCsiLyIrJHNjb3BlLnNlbGVjdGVkX2J1c2luZXNzX3VzZXJfaWQrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCkrIi8iKygkc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpKzEpKyIvIiskc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXREYXRlKCkrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldEhvdXJzKCkgKyAiLyIgKyAkc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXRNaW51dGVzKCkpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpCnsKJHNjb3BlLnNlbGVjdGVkX2V2ZW50X3R5cGVfaWRfaXNfY2xhc3M9ZmFsc2U7CiRzY29wZS5ldmVudHNTdWdnZXN0ZWQgPSByZXNwb25zZS5kYXRhOwp9KTsKfQp9Cn0KfQoKJHNjb3BlLmdvdG9OZXh0ID0gZnVuY3Rpb24oKSB7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZW1vdmVFdmVudHMnKTsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ25leHQnKTsKJHNjb3BlLnVwZGF0ZUNhbGVuZGFyQ2VudGVyVGl0bGUoKTsKLy8gYWRkaW5nIHRoZSBmb2xsb3dpbmcgdG8gbWFrZSB0aGUgdXJsCi8vIHBvaW50IHRvIHRoZSByaWdodCB3ZWVrLCBpZiBnb2luZyB0byBhIGRpZmZlcmVudCBVUkwgYW5kIHRoZW4gZ29pbmcgYmFjawp2aXNpYmxlRGF0ZVN0YXJ0ID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5zdGFydCk7CmRhdGVUb0dvVG8gPSB2aXNpYmxlRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCkgKyAiLSIgKyAoJzAnICsgKHZpc2libGVEYXRlU3RhcnQuZ2V0TW9udGgoKSArIDEpKS5zbGljZSgtMikgKyAiLSIgKyAoJzAnICsgdmlzaWJsZURhdGVTdGFydC5nZXREYXRlKCkpLnNsaWNlKC0yKTsKc2hhcmVkUHJvcGVydGllcy5zZXRfY2FsZW5kYXJfZGF0ZShkYXRlVG9Hb1RvKTsKJHNjb3BlLnZpc2libGVEYXRlU3RhcnQ9dmlzaWJsZURhdGVTdGFydDsKJGxvY2F0aW9uLnNlYXJjaCgnc3RhcnQnLGRhdGVUb0dvVG8pOwp9CiRzY29wZS5nb3RvUHJldiA9IGZ1bmN0aW9uKCkgewp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVtb3ZlRXZlbnRzJyk7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdwcmV2Jyk7CiRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlKCk7Ci8vIGFkZGluZyB0aGUgZm9sbG93aW5nIHRvIG1ha2UgdGhlIHVybAovLyBwb2ludCB0byB0aGUgcmlnaHQgd2VlaywgaWYgZ29pbmcgdG8gYSBkaWZmZXJlbnQgVVJMIGFuZCB0aGVuIGdvaW5nIGJhY2sKdmlzaWJsZURhdGVTdGFydCA9IG5ldyBEYXRlKHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3Jykuc3RhcnQpOwpkYXRlVG9Hb1RvID0gdmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpICsgIi0iICsgKCcwJyArICh2aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkgKyAxKSkuc2xpY2UoLTIpICsgIi0iICsgKCcwJyArIHZpc2libGVEYXRlU3RhcnQuZ2V0RGF0ZSgpKS5zbGljZSgtMik7CnNoYXJlZFByb3BlcnRpZXMuc2V0X2NhbGVuZGFyX2RhdGUoZGF0ZVRvR29Ubyk7CiRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0PXZpc2libGVEYXRlU3RhcnQ7CiRsb2NhdGlvbi5zZWFyY2goJ3N0YXJ0JyxkYXRlVG9Hb1RvKTsKCn0KJHNjb3BlLmdvdG9EYXRlID0gZnVuY3Rpb24obmV3ZGF0ZSkgewp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ290b0RhdGUnLCBuZXdkYXRlKTsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlbW92ZUV2ZW50cycpOwp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwokc2NvcGUudXBkYXRlQ2FsZW5kYXJDZW50ZXJUaXRsZSgpOwp9Cgokc2NvcGUuZWRpdEhvdXJzT2ZXb3JrID0gZnVuY3Rpb24oKSB7Ci8vIHBhcmFtIHNob3VsZCBsb29rIGxpa2UgIjIwMTYtMDctMDEiCnZpc2libGVEYXRlU3RhcnQgPSBuZXcgRGF0ZSh1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ2V0VmlldycpLnN0YXJ0KTsKZGF0ZVRvR29UbyA9IHZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSArICItIiArICgnMCcgKyAodmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpICsgMSkpLnNsaWNlKC0yKSArICItIiArICgnMCcgKyB2aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSkuc2xpY2UoLTIpOwokbG9jYXRpb24ucGF0aCgnL2hvdXJzX29mX3dvcmsnKS5zZWFyY2goewpzdGFydDogZGF0ZVRvR29Ubwp9KTsKfTsKCiRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlID0gZnVuY3Rpb24oKSB7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3Jyk7Cgp2aXNpYmxlRGF0ZVN0YXJ0ID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5zdGFydCk7CnZpc2libGVEYXRlRW5kID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5lbmQpOwoKJHNjb3BlLmNhbGVuZGFyVGl0bGVDZW50ZXIgPSB2aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSArICIgIiArIG1vbnRoTmFtZXNbdmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpXSArCiIg4oCUICIgKyB2aXNpYmxlRGF0ZUVuZC5nZXREYXRlKCkgKyAiICIgKyBtb250aE5hbWVzW3Zpc2libGVEYXRlRW5kLmdldE1vbnRoKCldICsKIiAiICsgdmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpOwp9OwoKJHNjb3BlLnNob3dFdmVudFBvcHVwID0gZnVuY3Rpb24oc2VsZWN0ZWRFdmVudCkgewpzaG93RXZlbnRQb3B1cChzZWxlY3RlZEV2ZW50LCAkdWliTW9kYWwpCn07Cgokc2NvcGUuZXZlbnRDcmVhdGVNb2RhbEZyb21TY2hlZHVsZXIgPSBmdW5jdGlvbihlc3VnZ2VzdCkKewovLyBpZiBjbGFzcyAtIGdvIHRvIGV2ZW50IGNsYXNzCmNvbnNvbGUubG9nKGVzdWdnZXN0KTsKZm9yIChpPTA7aTwkc2NvcGUuZXZlbnRfdHlwZXMubGVuZ3RoO2krKykKewppZiAoZXN1Z2dlc3QuZXZlbnRfdHlwZV9pZD09JHNjb3BlLmV2ZW50X3R5cGVzW2ldLmV2ZW50X3R5cGVfaWQpCnsKaWYgKCRzY29wZS5ldmVudF90eXBlc1tpXS5pc19jbGFzcykKewpjb25zb2xlLmxvZygiaXMgY2xhc3MiKTsKd2luZG93LmxvY2F0aW9uLmhyZWY9Jy8jL2V2ZW50X2NsYXNzLycgKyBlc3VnZ2VzdC5ldmVudF9pZDsKcmV0dXJuOwp9Cn0KfQpsb2dEZWJ1ZyhKU09OLnN0cmluZ2lmeShlc3VnZ2VzdCkpOwpsb2dEZWJ1Zyhlc3VnZ2VzdC5zdGFydF9lcG9jaCk7CnN0YXJ0RGF0ZT1lc3VnZ2VzdC5zdGFydF9lcG9jaCoxMDAwOwoKdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CmFuaW1hdGlvbjogZmFsc2UsCnRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2V2ZW50X2NyZWF0ZS5waHAnLApjb250cm9sbGVyOiAnZXZlbnRDcmVhdGVNb2RhbENvbnRyb2xsZXInLApzaXplOiAnbCcsCnJlc29sdmU6IHsKc3RhcnREYXRlOiBmdW5jdGlvbigpIHsKcmV0dXJuIHN0YXJ0RGF0ZTsKfSwKZXZlbnRfdHlwZV9pZDogZnVuY3Rpb24oKSB7CnJldHVybiAkc2NvcGUuc2VsZWN0ZWRfZXZlbnRfdHlwZV9pZDsKfSwKbG9jYXRpb25faWQ6IGZ1bmN0aW9uKCkgewpyZXR1cm4gZXN1Z2dlc3QubG9jYXRpb25faWQ7Cn0sCmVtcF9pZDogZnVuY3Rpb24oKSB7CnJldHVybiBlc3VnZ2VzdC5lbXBfaWQ7Cn0sCnJlc2NoZWR1bGVfZXZlbnQ6IGZ1bmN0aW9uKCkKewppZiAoJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGUpCnsKcmV0dXJuICRzY29wZS5wcmV2aW91c19ldmVudF9yZXNjaGVkdWxlX2V2ZW50Owp9CmVsc2UKewpyZXR1cm4gbnVsbDsKfQp9Cgp9Cn0pOwoKfQokc2NvcGUuZXZlbnRDcmVhdGVNb2RhbCA9IGZ1bmN0aW9uKHN0YXJ0RGF0ZSwgc2l6ZSkgewogICAgICAgIGxvZ0RlYnVnKCJldmVudENyZWF0ZU1vZGFsIHN0YXJ0RGF0ZT0iK3N0YXJ0RGF0ZSk7Cgp2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKYW5pbWF0aW9uOiBmYWxzZSwKdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfZXZlbnRfY3JlYXRlLnBocCcsCmNvbnRyb2xsZXI6ICdldmVudENyZWF0ZU1vZGFsQ29udHJvbGxlcicsCnNpemU6IHNpemUsCnJlc29sdmU6IHsKc3RhcnREYXRlOiBmdW5jdGlvbigpIHsKcmV0dXJuIHN0YXJ0RGF0ZTsKfSwKZXZlbnRfdHlwZV9pZDogZnVuY3Rpb24oKSB7CnJldHVybiAwOwp9LApsb2NhdGlvbl9pZDogZnVuY3Rpb24oKSB7CnJldHVybiAwOwp9LAplbXBfaWQ6IGZ1bmN0aW9uKCkgewpyZXR1cm4gMDsKfSwKcmVzY2hlZHVsZV9ldmVudDogZnVuY3Rpb24oKQp7CmlmICgkc2NvcGUucHJldmlvdXNfZXZlbnRfcmVzY2hlZHVsZSkKewpyZXR1cm4gJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGVfZXZlbnQ7Cn0KZWxzZQp7CnJldHVybiBudWxsOwp9ICAgICAgICAgICAgICAgIH0KCn0KfSk7Cgptb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHNlbGVjdGVkSXRlbSkgewokc2NvcGUuc2VsZWN0ZWQgPSBzZWxlY3RlZEl0ZW07Cn0sIGZ1bmN0aW9uKCkgewpsb2dEZWJ1ZygnTW9kYWwgZGlzbWlzc2VkIGF0OiAnICsgbmV3IERhdGUoKSk7Cn0pOwp9OwoKLy8vCiRzY29wZS51cGRhdGVFdmVudERhdGFiYXNlID0gZnVuY3Rpb24oc3RhcnRfcGFyYW0sIGVuZF9wYXJhbSwgZXZlbnRfaWQsIHRoZWV2ZW50KQp7Cgpsb2dEZWJ1ZygidXBkYXRlRXZlbnREYXRhYmFzZSBzdGFydD0iICsgc3RhcnRfcGFyYW0gKyAiLCBlbmQ9IiArIGVuZF9wYXJhbSArICIsIGV2ZW50X2lkPSIgKyBldmVudF9pZCk7CnRoZXVybCA9ICcvYXBpL2FkbWluL2V2ZW50cy9zZXQvJyArIGV2ZW50X2lkOwoKJGh0dHAoewptZXRob2Q6ICdQT1NUJywKdXJsOiB0aGV1cmwsCmRhdGE6IHsKc3RhcnRfZGF0ZTogc3RhcnRfcGFyYW0sCmVuZF9kYXRlOiBlbmRfcGFyYW0sCmV2ZW50X2lkOiBldmVudF9pZAp9LApoZWFkZXJzOiB7CidDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbjtjaGFyc2V0PXV0Zi04Jwp9Cn0pLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkgewoKbG9nRGVidWcoZGF0YSk7CmlmIChkYXRhLkVycm9yKSB7CmxvZ0RlYnVnKCJlcnJvciAiICsgZGF0YS5NZXNzYWdlKTsKYWxlcnQoJ2Vycm9yJyk7CmNhbGVuZGFyID0gImNhbGVuZGFyX2J1c2luZXNzIjsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwp9IGVsc2Ugewpsb2dEZWJ1Zygic3VjY2VzcyIpOwpjYWxlbmRhciA9ICJjYWxlbmRhcl9idXNpbmVzcyI7Ci8vIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKLy8gJHVpYk1vZGFsSW5zdGFuY2UuZGlzbWlzcygnYWRkZWQgYW5kIHJlZmV0Y2hFdmVudHMnKTsKfQp9KTsKCn07Ci8vLwoKJHNjb3BlLmNsYXNzRXZlbnRBZGRVc2VyID0gZnVuY3Rpb24oZXN1Z2dlc3QpCnsKY29uc29sZS5sb2coImNsYXNzRXZlbnRBZGRVc2VyIG9yIFJlbW92ZSIpOwppZiAoKGVzdWdnZXN0LmlzX3JlZ2lzdGVyZWQ9PTEpIHwgKChlc3VnZ2VzdC5pc193YWl0aW5nbGlzdD09MSkgJiYgKGVzdWdnZXN0LmlzX2NhbmNlbGVkPT0wKSkpCnsKY29uc29sZS5sb2coIm5lZWQgdG8gdW5yZWdpc3RlciIpOwpyZW1vdmVFbmRVc2VyRnJvbUV2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcl9pZCxlc3VnZ2VzdC5ldmVudF9pZCxyZW1vdmVFbmRVc2VyRnJvbUV2ZW50X2NhbGxiYWNrLCByZW1vdmVFbmRVc2VyRnJvbUV2ZW50X2NhbGxiYWNrKTsKZnVuY3Rpb24gcmVtb3ZlRW5kVXNlckZyb21FdmVudF9jYWxsYmFjaygpCnsKJHNjb3BlLmV2ZW50VHlwZVNlbGVjdGVkKCk7CmNhbGVuZGFyID0gImNhbGVuZGFyX2J1c2luZXNzIjsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwoKfQp9CmVsc2UKewovLyBjb25zb2xlLmxvZyhlc3VnZ2VzdC5ldmVudF9pZCk7Ci8vIGNvbnNvbGUubG9nKCRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyX2lkKTsKLy8gaWYgc2VsZWN0ZWQgdXNlciAtIGFkZGluZyBoaW0vaGVyIHRvIGNsYXNzCmlmICgkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcikKewphZGRFbmRVc2VyVG9FdmVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJfaWQsZXN1Z2dlc3QuZXZlbnRfaWQsYWRkRW5kVXNlclRvRXZlbnRfY2FsbGJhY2ssIGFkZEVuZFVzZXJUb0V2ZW50X2NhbGxiYWNrKTsKZnVuY3Rpb24gYWRkRW5kVXNlclRvRXZlbnRfY2FsbGJhY2soKQp7CmNhbGVuZGFyID0gImNhbGVuZGFyX2J1c2luZXNzIjsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwokc2NvcGUuZXZlbnRUeXBlU2VsZWN0ZWQoKTsKfQp9CmVsc2UgLy8gZWxzZSAtIGdvaW5nIHRvIGNsYXNzIHBhZ2UKewp3aW5kb3cubG9jYXRpb24uaHJlZj0nLyMvZXZlbnRfY2xhc3MvJyArIGVzdWdnZXN0LmV2ZW50X2lkOwp9Cn0KfQokc2NvcGUuY2FsZW5kYXJfYnVzaW5lc3NfY29uZmlnID0gewpjYWxlbmRhcjogewpoZWlnaHQ6ICdhdXRvJywKZWRpdGFibGU6IHRydWUsCi8vIGhlYWRlcjogewovLyAgICAgbGVmdDogJycsCi8vICAgICBjZW50ZXI6ICcnLAovLyAgICAgcmlnaHQ6ICcnCi8vIH0sCi8vIGhlYWRlcjogewovLyAgICAgbGVmdDogJ3RpdGxlJywKLy8gICAgIGNlbnRlcjogJycsCi8vICAgICByaWdodDogJ3RvZGF5IHByZXYsbmV4dCcKLy8gfSwKdGl0bGVGb3JtYXQ6IHsKLy8gd2VlazogICJkIFtNTU1deyAnJiM4MjExOycgZCBNTU19Igp9LAovLyB0aXRsZUZvcm1hdDogewovLyAgICAgbW9udGg6ICdNTU1NIHl5eXknLAovLyAgICAgd2VlazogIk1NTSBkWyB5eXl5XXsgJyYjODIxMjsnWyBNTU1dIGQgeXl5eX0iLAovLyAgICAgZGF5OiAnTU0vZGQnCi8vIH0sCmhlYWRlcjogJycsCi8vIGRlZmF1bHRWaWV3OiAnYWdlbmRhV2VlaycsCi8vIHZpZXdzOiB7Ci8vICAgICBkb250U2hvd0RhdGU6IHsKLy8gICAgICAgICB0eXBlOiAnYWdlbmRhV2VlaycsCi8vICAgICAgICAgZHVyYXRpb246IHsKLy8gICAgICAgICAgICAgZGF5czogNwovLyAgICAgICAgIH0sCi8vICAgICAgICAgdGl0bGU6ICdBcGVydHVyYScsCi8vICAgICAgICAgY29sdW1uRm9ybWF0OiAnZGRkZCcgLy8gRm9ybWF0IHRoZSBkYXkgdG8gb25seSBzaG93IGxpa2UgJ01vbmRheScKLy8gICAgICAgICAgICAgLy8gaGlkZGVuRGF5czogWzAsIDZdIC8vIEhpZGUgU3VuZGF5IGFuZCBTYXR1cmRheT8KLy8gICAgIH0KLy8gfSwKLy8gc2xvdER1cmF0aW9uOiAnMDA6MTU6MDAnLApldmVudERyb3A6IGZ1bmN0aW9uKGV2ZW50LCBkYXlEZWx0YSwgbWludXRlRGVsdGEsIGFsbERheSwgcmV2ZXJ0RnVuYywgdWlDYWxlbmRhckNvbmZpZykgewpsb2dEZWJ1ZygiZXZlbnQgZHJvcCIgKyBldmVudC50aXRsZSArICIoIiArIGV2ZW50LmlkICsgIikgbW92ZWQgIiArIG1pbnV0ZURlbHRhICsgIiBtaW51dGVzIik7CmxvZ0RlYnVnKCJvbGQgc3RhcnQ9IiArIGV2ZW50LnN0YXJ0ICsgIiwgb2xkIGVuZD0iICsgZXZlbnQuZW5kKTsKJHNjb3BlLnVwZGF0ZUV2ZW50RGF0YWJhc2UoZXZlbnQuc3RhcnQsIGV2ZW50LmVuZCwgZXZlbnQuaWQsIGV2ZW50KTsKfSwKZXZlbnRSZXNpemU6IGZ1bmN0aW9uKGV2ZW50LCBkZWx0YSwgcmV2ZXJ0RnVuYykgewpsb2dEZWJ1ZygiZXZlbnQgcmVzaXplIiArIGV2ZW50LnRpdGxlICsgIigiICsgZXZlbnQuaWQgKyAiKSBtb3ZlZCAiKTsKbG9nRGVidWcoIm9sZCBzdGFydD0iICsgZXZlbnQuc3RhcnQgKyAiLCBvbGQgZW5kPSIgKyBldmVudC5lbmQpOwokc2NvcGUudXBkYXRlRXZlbnREYXRhYmFzZShldmVudC5zdGFydCwgZXZlbnQuZW5kLCBldmVudC5pZCwgZXZlbnQpOwp9LApkZWZhdWx0VmlldzogJ2FnZW5kYVdlZWsnLApldmVudFN0YXJ0RWRpdGFibGU6ZmFsc2UsCmV2ZW50RHVyYXRpb25FZGl0YWJsZTpmYWxzZSwKZGVmYXVsdERhdGU6IG1vbWVudChjdXJyRGVmYXVsdERhdGUpLAoKLy8gZGVmYXVsdFZpZXc6ICdkb250U2hvd0RhdGUnLApldmVudENsaWNrOiBmdW5jdGlvbihjYWxFdmVudCwganNFdmVudCwgdmlldykgewpsb2dEZWJ1ZygiY2FsZW5kYXIgZXZlbnQgY2xpY2tlZCAiICsgY2FsRXZlbnQudGl0bGUgKyAiKCIgKyBjYWxFdmVudC5pZCArICIpICIgKyBjYWxFdmVudC5zdGFydCArICIgIiArIGNhbEV2ZW50LmVuZCk7Ci8vIGxvZ0RlYnVnKEpTT04uc3RyaW5naWZ5KGNhbEV2ZW50KSk7Ci8vIGlmIGl0J3MgYSBnZW5lcmljIGV2ZW50ICh2YWNhdGlvbiBldGMpCi8vIHNob3cgcG9wdXAgd2l0aCBvcHRpb24gdG8gZGVsZXRlCmlmIChjYWxFdmVudC5pc19nZW5lcmljX2V0eXBlPT0xKQp7Ci8vICRzY29wZS5zaG93R2VuZXJpY0V2ZW50KGNhbEV2ZW50KTsKJHNjb3BlLnNob3dFdmVudFBvcHVwKGNhbEV2ZW50KTsKCn0KZWxzZQp7CiRzY29wZS5zaG93RXZlbnRQb3B1cChjYWxFdmVudCk7Cn0KLy8gY2hhbmdlIHRoZSBib3JkZXIgY29sb3IganVzdCBmb3IgZnVuCi8vICQodGhpcykuY3NzKCdib3JkZXItY29sb3InLCAncmVkJyk7Cgp9LApkYXlDbGljazogZnVuY3Rpb24oZGF0ZSwganNFdmVudCwgdmlldykgewovLyBsb2dEZWJ1ZygibmV3IGV2ZW50IGNyZWF0aW9uIGNsaWNrZWQgIiArIGNhbEV2ZW50LnRpdGxlICsgIigiICsgY2FsRXZlbnQuaWQgKyAiKSAiICsgY2FsRXZlbnQuc3RhcnQgKyAiICIgKyBjYWxFdmVudC5lbmQpOwovLyAgICAgc3RhcnQgPSBkYXRlOwovLyAgICAgZW5kID0gbW9tZW50KHN0YXJ0KS5hZGQoNDUsICdtaW51dGVzJyk7CmlmICh2aWV3Lm5hbWUgPT09ICJtb250aCIpIHsKY2FsZW5kYXIgPSAiY2FsZW5kYXJfYnVzaW5lc3MiOwp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdjaGFuZ2VWaWV3JywgImFnZW5kYVdlZWsiKTsKfSBlbHNlIHsKJHNjb3BlLmV2ZW50Q3JlYXRlTW9kYWwoZGF0ZSk7Cn0KLy8gY2hhbmdlIHRoZSBib3JkZXIgY29sb3IganVzdCBmb3IgZnVuCi8vICQodGhpcykuY3NzKCdib3JkZXItY29sb3InLCAncmVkJyk7Cgp9LApldmVudFJlbmRlcjogZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpCnsKaWYgKCFldmVudC5ldmVudF9pZD4wKQp7Ci8vIG5vdCBhIHJlYWwgZXZlbnQgLSBwcm9iYWJseSBibG9jayAvIGJhY2tncm91bmQKLy8gaWdub3JpbmcgaXQKcmV0dXJuOwp9Ci8vIGNoYW5naW5nIGxvb2sgYW5kIGZlZWwgb2YgZXZlbiB0aGF0IGlzIHRvIHJlc2NoZWR1bGUKaWYgKHNoYXJlZFByb3BlcnRpZXMuZ2V0X2V2ZW50X3Jlc2NoZWR1bGUoKSE9bnVsbCkKewppZiAoZXZlbnQuZXZlbnRfaWQ9PXNoYXJlZFByb3BlcnRpZXMuZ2V0X2V2ZW50X3Jlc2NoZWR1bGUoKS5ldmVudF9pZCkKewplbGVtZW50LmNzcygnYmFja2dyb3VuZC1jb2xvcicsICcjQTlBOUE5CScpOwplbGVtZW50LmNzcygnYm9yZGVyLWNvbG9yJywgJyNBOUE5QTkJJyk7CnJldHVybjsKfQp9CiAgICAgICAgICAgICAgICBpZiAoZXZlbnQuaXNfZ2VuZXJpY19ldHlwZT09MSkKICAgICAgICAgICAgICAgIHsKCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIGlmIChldmVudC5pc19jbGFzcz09MSkKewovLyBpZiBjbGFzcyBhZGRpbmcgbnVtYmVyIG9mIHBhcnRpY2lwYW50cwppZiAoZXZlbnQubm9fb2Zfd2FpdGluZ191c2Vycz4wKQp7CmVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZChldmVudC5ub19vZl91c2VycysiLyIrZXZlbnQubWF4X3BhcnRpY2lwYW50cysgIiAoIitldmVudC5ub19vZl93YWl0aW5nX3VzZXJzKyIpIisiIC0gIik7Cn0KZWxzZQp7CmVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZChldmVudC5ub19vZl91c2VycysiLyIrZXZlbnQubWF4X3BhcnRpY2lwYW50cysiIC0gIik7Cn0KfQplbHNlCnsKLy8gaWYgbm90IGNsYXNzIC0gd3JpdGluZyB0aGUgZW5kdXNlciBuYW1lCmlmIChldmVudC5kdXJhdGlvbl9ldmVudCE9MCkgLy8gYWxzbyBpZiBub3QgaG91cnMgb2Ygd29yawp7Ci8vIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykuYXBwZW5kKCIgKCIrZXZlbnQuZXZlbnRVc2Vyc1swXS5idXNlcl9maXJzdF9uYW1lKyIgIitldmVudC5ldmVudFVzZXJzWzBdLmJ1c2VyX2xhc3RfbmFtZSsiKSIpOwovLyBjb25zb2xlLmxvZyhldmVudC5ldmVudFVzZXJzKTsKLy8gY29uc29sZS5sb2coZXZlbnQuZXZlbnRVc2Vycy5sZW5ndGgpOwogICAgICAgICAgICAgICAgICAgIC8vIGlmIChldmVudC5ldmVudFVzZXJzLmxlbmd0aD4wKQp7CiAgICAgICAgICAgICAgICAgICAgICAvLyBlbGVtZW50LmZpbmQoJy5mYy10aXRsZScpLnByZXBlbmQoIiIrZXZlbnQuZXZlbnRVc2Vyc1swXS5idXNlcl9maXJzdF9uYW1lKyIgIitldmVudC5ldmVudFVzZXJzWzBdLmJ1c2VyX2xhc3RfbmFtZSsiICgiKTsKICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZCgiIitldmVudC5ldmVudF91c2VyX2NsaWVudHMrIiAoIik7CmVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykuYXBwZW5kKCIpIik7Cn0KfQovLyBsb2dEZWJ1ZygiaGVyZTQiKTsKfQppZiAoZXZlbnQuaXNfcmVwZWF0aW5nID09IDEpIHsKZWxlbWVudC5maW5kKCIuZmMtdGl0bGUiKS5hcHBlbmQoIiZuYnNwOzxpIGNsYXNzPSdmYSBmYS1yZXBlYXQnPjwvaT4mbmJzcDsiKTsKLy8gIGVsZW1lbnQuZmluZCgiLmZjLXRpdGxlIikuYXBwZW5kKCImbmJzcDs8aW1nIHNyYz0nL3B1YmxpYy9pbWFnZXMvcmVjdXJyaW5nLWljb24ucG5nJyB3aWR0aD0nMTBweCcgaGVpZ2h0PScxMHB4Jy8+Iik7Cn0KfSwKbWluVGltZTogJGdDYWxlbmRhckRpc3BsYXlNaW5UaW1lLAptYXhUaW1lOiAkZ0NhbGVuZGFyRGlzcGxheU1heFRpbWUsCnNlbGVjdGFibGU6IGZhbHNlLApzZWxlY3RIZWxwZXI6IGZhbHNlLAp0aW1lem9uZTogZmFsc2UsCmlzUlRMOiB0cnVlLApsYW5nOiAiaGUiLCAvLyBrawphbGxEYXlTbG90OiBmYWxzZSwKbG9hZGluZzogZnVuY3Rpb24oYm9vbCkgewppZiAoYm9vbCkgewogICAgICAgICAgICAgICAgICAgIGxvZ0RlYnVnKCdsb2FkaW5nIGNhbGVuZGFyMSAnICsgJHNjb3BlLmNhbGVuZGFyKTsKLy8gJCgnI2xvYWRpbmcnKS5zaG93KCk7Cn0gZWxzZSB7Ci8vICQoJyNsb2FkaW5nJykuaGlkZSgpOwpsb2dEZWJ1ZygnZmluaXNoZWQgbG9hZGluZyBjYWxlbmRhciB4JyArICRzY29wZS5jYWxlbmRhcik7CiRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlKCk7CmxvZ0RlYnVnKCJhZnRlciBjYWxlbmRhciBsb2FkIHZpc2libGVEYXRlU3RhcnQ9Iit1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ2V0VmlldycpLnN0YXJ0KTsKdmlzaWJsZURhdGVTdGFydCA9IG5ldyBEYXRlKHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3Jykuc3RhcnQpOwpkYXRlVG9Hb1RvID0gdmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpICsgIi0iICsgKCcwJyArICh2aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkgKyAxKSkuc2xpY2UoLTIpICsgIi0iICsgKCcwJyArIHZpc2libGVEYXRlU3RhcnQuZ2V0RGF0ZSgpKS5zbGljZSgtMik7Ci8vIGNvbnNvbGUubG9nKCJkYXRlVG9Hb1RvIitkYXRlVG9Hb1RvKTsKLy8gJGh0dHAuZ2V0KCRnQXBpVVJMUHJlZml4ICsgIi9lbmR1c2VyL2V2ZW50cy9zdWdnZXN0LyIrdmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpKyIvIit0aGlzX3dlZWtfZnVsbF95ZWFyKyIvIit0aGlzX3dlZWtfbW9udGgrIi8iK3RoaXNfd2Vla19kYXlfb2ZfbW9udGgrIi8iKyB0aGlzX3dlZWtfaG91cnMrICIvIiArIHRoaXNfd2Vla19taW51dGVzKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKQokc2NvcGUuZXZlbnRfdHlwZV9pZD0kc2NvcGUuc2VsZWN0ZWRfZXZlbnRfdHlwZV9pZDsKJHNjb3BlLnZpc2libGVEYXRlU3RhcnQ9dmlzaWJsZURhdGVTdGFydDsKLy8xMjEyMTIKLy8gaWYgKCRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkX2lzX2NsYXNzKQovLyB7Ci8vICAgJGh0dHAuZ2V0KCRnQXBpVVJMUHJlZml4ICsgIi9lbmR1c2VyL2V2ZW50cy9zdWdnZXN0Y2xhc3MvIiskc2NvcGUuZXZlbnRfdHlwZV9pZCsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSsiLyIrKCRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkrMSkrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0SG91cnMoKSArICIvIiArICRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKSsgIi8iICsgJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJfaWQpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpCi8vICAgewovLyAgICAgICAvLwkgICAgJHNjb3BlLm15RGF0YSA9IHJlc3BvbnNlLmRhdGE7Ci8vICAgICAgIC8vCQlsb2dEZWJ1ZygiZ3JpZG9wdGlvbnM9Iiskc2NvcGUuZ3JpZE9wdGlvbnMpOwovLyAgICAgICAkc2NvcGUuZXZlbnRzU3VnZ2VzdGVkID0gcmVzcG9uc2UuZGF0YTsKLy8gICAgICAgLy8gJHNjb3BlLmRhdGVUb0dvVG89ZGF0ZVRvR29UbzsKLy8gICB9KTsKLy8gfQovLyBlbHNlCi8vIHsKLy8gICAkaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3QvIiskc2NvcGUuZXZlbnRfdHlwZV9pZCsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSsiLyIrKCRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkrMSkrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0SG91cnMoKSArICIvIiArICRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkKLy8gICB7Ci8vICAgICAgIC8vCSAgICAkc2NvcGUubXlEYXRhID0gcmVzcG9uc2UuZGF0YTsKLy8gICAgICAgLy8JCWxvZ0RlYnVnKCJncmlkb3B0aW9ucz0iKyRzY29wZS5ncmlkT3B0aW9ucyk7Ci8vICAgICAgICRzY29wZS5ldmVudHNTdWdnZXN0ZWQgPSByZXNwb25zZS5kYXRhOwovLyAgICAgICAvLyAkc2NvcGUuZGF0ZVRvR29Ubz1kYXRlVG9Hb1RvOwovLyAgIH0pOwovLyB9CgovLyBhZnRlciBjYWxlbmRhciBpcyBsb2FkZWQgLSBsb2FkaW5nIGV2ZW50IHR5cGVzIGFuZCBzdWdnZXN0aW9uIGZvciBxdWV1ZXMKLy8gd2UgaGFuZGxlIHRoaW5ncyByZWxhdGVkIHRvIHRoZSBldmVudCB0eXBlcyBvbmx5IGFmdGVyIGxvYWRpbmcgdGhlbSAoYW5kIHRoZSBjYWxlbmRhcikKZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzTm9TeXN0ZW0oJGh0dHAsJHNjb3BlLCdldmVudF90eXBlcycsZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzTm9TeXN0ZW1fY2FsbGJhY2spOwoKZnVuY3Rpb24gZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzTm9TeXN0ZW1fY2FsbGJhY2soKQp7ICAgIC8vIGNoZWNraW5nIGlmIGNhbGVuZGFyIHNob3VsZCBzdGFydCB3aXRoIGEgc3BlY2lmaWMgZXZlbnQgdHlwZSBmb3Igc3VnZ2VzdGlvbnMKLy8gbG9nRGVidWcoIlggc2hhcmVkUHJvcGVydGllcy5nZXRfZXZlbnRfdHlwZV9mb3Jfc3VnZ2VzdGlvbnM9IitzaGFyZWRQcm9wZXJ0aWVzLmdldF9ldmVudF90eXBlX2Zvcl9zdWdnZXN0aW9ucygpKTsKaWYgKHNoYXJlZFByb3BlcnRpZXMuZ2V0X2V2ZW50X3R5cGVfZm9yX3N1Z2dlc3Rpb25zKCkhPW51bGwpCnsKJHNjb3BlLnNlbGVjdGVkX2V2ZW50X3R5cGVfaWQ9c2hhcmVkUHJvcGVydGllcy5nZXRfZXZlbnRfdHlwZV9mb3Jfc3VnZ2VzdGlvbnMoKTsKJHNjb3BlLmV2ZW50VHlwZVNlbGVjdGVkKCRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkKTsKfQoKLy8gZmlyc3QgY2hlY2tpbmcgaWYgdGhlcmUncyBhbiBldmVudCB0byByZXNjaGVkdWxlCmlmIChzaGFyZWRQcm9wZXJ0aWVzLmdldF9ldmVudF9yZXNjaGVkdWxlKCkhPW51bGwpCnsKJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGU9dHJ1ZTsKJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGVfZXZlbnQ9c2hhcmVkUHJvcGVydGllcy5nZXRfZXZlbnRfcmVzY2hlZHVsZSgpOwpzaGFyZWRQcm9wZXJ0aWVzLnNldF9ldmVudF9yZXNjaGVkdWxlKG51bGwpOwpsb2dEZWJ1ZygiZ290IGV2ZW50IHRvIHJlc2NoZWR1bGUgIitKU09OLnN0cmluZ2lmeSgkc2NvcGUucHJldmlvdXNfZXZlbnRfcmVzY2hlZHVsZV9ldmVudCkpOwpsb2dEZWJ1ZygicmVzY2hlZHVsZSBldmVudF90eXBlX2lkPSIrJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGVfZXZlbnQuZXZlbnRfdHlwZV9pZCk7CiRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkPSRzY29wZS5wcmV2aW91c19ldmVudF9yZXNjaGVkdWxlX2V2ZW50LmV2ZW50X3R5cGVfaWQ7CiRzY29wZS5ldmVudFR5cGVTZWxlY3RlZCgpOwp9Ci8vIGNoZWNraW5nIHNlbGVjdGVkIHVzZXIgb25seSBpZiB0aGVyZSdzIG5vIHNlbGVjdGVkIGV2ZW50IHRvIG1vdmUKZWxzZSBpZiAoc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpIT1udWxsKQp7CmNvbnNvbGUubG9nKCJnb3QgcHJldmlvdXMgc2VsZWN0ZWQgdXNlciAiK3NoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKS5idXNlcl9maXJzdF9uYW1lKTsKJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJuYW1lPXNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKS5idXNlcl9maXJzdF9uYW1lKyIgIitzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfbGFzdF9uYW1lOwokc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcl9pZD1zaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzaW5lc3NfdXNlcl9pZDsKbG9nRGVidWcoIiRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyX2lkPSIrJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJfaWQpOwoKJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXI9dHJ1ZTsKfQp9Cn0KCn0sCi8vIHNlbGVjdDogZnVuY3Rpb24oc3RhcnQsIGVuZCwgYWxsRGF5KSB7Ci8vICAgICAvLyB2YXIgdGl0bGUgPSBwcm9tcHQoJ0V2ZW50IFRpdGxlOicgKyAoc3RhcnQgKyAzNTI4MDAwMDApIC8gKDYwICogMTAwMCkgKyAiICIgKyBlbmQgKyAiICIgKyBhbGxEYXkpOwovLyAgICAgdGl0bGUgPSAi16nXoteV16og16TXoteZ15zXldeqIjsKLy8gICAgIGlmICh0aXRsZSkgewovLyAgICAgICAgIGxvZ0RlYnVnKCJjcmVhdGluZyBkZXZlbnQgc3RhcnQiKTsKLy8gICAgICAgICBsb2dEZWJ1Zygic3RhcnQ9IiArIHN0YXJ0KTsKLy8gICAgICAgICBjaGVja0RhdGUgPSBuZXcgRGF0ZShzdGFydCk7Ci8vICAgICAgICAgbG9nRGVidWcoImNoZWNrIGRhdGUgPSAiICsgY2hlY2tEYXRlKQovLyAgICAgICAgIGxvZ0RlYnVnKCJlbmQ9IiArIGVuZCk7Ci8vICAgICAgICAgZWNvbG9yID0gIiMiICsgJHNjb3BlLmV2ZW50Q29sb3I7IC8vZ2V0UmFuZG9tQ29sb3IoKTsKLy8KLy8KLy8gICAgICAgICAvLyB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tdLmZ1bGxDYWxlbmRhcigncmVyZW5kZXJFdmVudHMnKTsKLy8KLy8gICAgICAgICBjYWxlbmRhciA9ICRzY29wZS5jYWxlbmRhcl9uYW1lOwovLyAgICAgICAgIHRlbXBfbGltaXRfaWQgPSAkZ0NhbGVuZGFyVGVtcEVudklEMSAtIGdldFJhbmRvbUludCgxMCwgODApOwovLyAgICAgICAgIG5ld0V2ZW50ID0gewovLyAgICAgICAgICAgICBpZDogdGVtcF9saW1pdF9pZCwKLy8gICAgICAgICAgICAgdGl0bGU6IHRpdGxlLAovLyAgICAgICAgICAgICBzdGFydDogc3RhcnQsCi8vICAgICAgICAgICAgIGNvbG9yOiBlY29sb3IsCi8vICAgICAgICAgICAgIGVuZDogZW5kLAovLyAgICAgICAgICAgICBhbGxEYXk6IGZhbHNlLAovLyAgICAgICAgICAgICBjbGFzc05hbWU6IFsnb3BlblNlc2FtZSddCi8vICAgICAgICAgICAgICAgICAvLyBjb2xvcjogcmVzb3VyY2UuZXZlbnRDb2xvcgovLyAgICAgICAgIH07Ci8vICAgICAgICAgY2FsZW5kYXIgPSAkc2NvcGUuY2FsZW5kYXJfbmFtZTsKLy8KLy8gICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZW5kZXJFdmVudCcsIG5ld0V2ZW50LCB0cnVlKTsKLy8gICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCd1bnNlbGVjdCcpOwovLwovLyAgICAgICAgIGxvZ0RlYnVnKCJjcmVhdGluZyBkZXZlbnQgZW5kIik7Ci8vICAgICAgICAgJHNjb3BlLmFkZEV2ZW50VG9EYXRhYmFzZShzdGFydCwgZW5kLCB0aXRsZSwgZWNvbG9yLCB0ZW1wX2xpbWl0X2lkKTsKLy8KLy8gICAgIH0KLy8gfQp9Cn07Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignSG91cnNPZldvcmtDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGNvbXBpbGUsICRsb2NhdGlvbiwgdWlDYWxlbmRhckNvbmZpZywgJHVpYk1vZGFsKSB7CmxvZ0RlYnVnKCdIb3Vyc09mV29yayBDb250cm9sbGVyJyk7Cgpsb2dEZWJ1ZygiJGxvY2F0aW9uLnNlYXJjaCgpLnN0YXJ0PSIgKyAkbG9jYXRpb24uc2VhcmNoKCkuc3RhcnQpOwppZiAodHlwZW9mICRsb2NhdGlvbi5zZWFyY2goKS5zdGFydCA9PSAndW5kZWZpbmVkJykgewpjdXJyRGVmYXVsdERhdGUgPSAkZ0hvdXIwZGF0ZTsKJHNjb3BlLmZpeGVkU2NoZWR1bGUgPSB0cnVlOwokc2NvcGUuY2FsZW5kYXJUaXRsZUNlbnRlciA9ICLXqdei15XXqiDXpNei15nXnNeV16og16fXkdeV16LXldeqIjsKbG9nRGVidWcoItep16LXldeqINek16LXmdec15XXqiDXp9eR15XXoteV16oiKTsKaG91cnNPZldvcmtEZWZhdWx0Vmlldz0nZG9udFNob3dEYXRlJzsKfSBlbHNlIHsKY3VyckRlZmF1bHREYXRlID0gJGxvY2F0aW9uLnNlYXJjaCgpLnN0YXJ0Owokc2NvcGUuZml4ZWRTY2hlZHVsZSA9IGZhbHNlOwovLyAkc2NvcGUuY2FsZW5kYXJUaXRsZUNlbnRlciA9ICLXqdei15XXqiDXpNei15nXnNeV16og16fXkdeV16LXldeqIjsKaG91cnNPZldvcmtEZWZhdWx0Vmlldz0nYWdlbmRhV2Vlayc7Cn0KCgokc2NvcGUudmlzaWJsZURhdGUgPSBbXTsKJHNjb3BlLmNhbGVuZGFyID0gJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnOwokc2NvcGUuc2VsZWN0ZWRFdmVudFR5cGUgPSBbXTsKCmdldEFsbEJ1c2luZXNzRXZlbnRUeXBlcygkaHR0cCwkc2NvcGUsJ2V2ZW50X3R5cGVzJyxnZXRBbGxCdXNpbmVzc0V2ZW50VHlwZXNfY2FsbGJhY2spOwoKZnVuY3Rpb24gZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzX2NhbGxiYWNrKCkKewokc2NvcGUuc2VsZWN0RXZlbnRUeXBlKCRzY29wZS5ldmVudF90eXBlc1swXSk7Cn0KJHNjb3BlLmJhY2tUb0NhbGVuZGFyID0gZnVuY3Rpb24oKSB7CnZpc2libGVEYXRlU3RhcnQgPSBuZXcgRGF0ZSh1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ2V0VmlldycpLnN0YXJ0KTsKZGF0ZVRvR29UbyA9IHZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSArICItIiArICgnMCcgKyAodmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpICsgMSkpLnNsaWNlKC0yKSArICItIiArICgnMCcgKyB2aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSkuc2xpY2UoLTIpOwokbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2NhbGVuZGFyJykuc2VhcmNoKHsKc3RhcnQ6IGRhdGVUb0dvVG8KfSk7Cn0KJHNjb3BlLnNlbGVjdEV2ZW50VHlwZSA9IGZ1bmN0aW9uKGV2ZW50VHlwZSkgewokc2NvcGUuc2VsZWN0ZWRFdmVudFR5cGUgPSBldmVudFR5cGU7CmxvZ0RlYnVnKCJzZWxlY3RlZCBFdmVudCBUeXBlID0gIiArICRzY29wZS5zZWxlY3RlZEV2ZW50VHlwZS5ldmVudF90eXBlX2lkICsgIiwgIiArICRzY29wZS5zZWxlY3RlZEV2ZW50VHlwZS5ldmVudF90eXBlX25hbWUpOwprdXplSXNDYWxlbmRhckRyYWdnYmxlID0gJHNjb3BlLnNlbGVjdGVkRXZlbnRUeXBlLmRpZmZfcmFuZ2U7Cn07Cgokc2NvcGUuY2hhbmdlRXZlbnRDb2xvciA9IGZ1bmN0aW9uKG5ld0NvbG9yKSB7CiRzY29wZS5ldmVudENvbG9yID0gbmV3Q29sb3I7CmFsbGxFdmVudHNBcnJheSA9IHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2NsaWVudEV2ZW50cycpOwpmb3IgKGkgaW4gYWxsbEV2ZW50c0FycmF5KSB7CmFsbGxFdmVudHNBcnJheVtpXS5jb2xvciA9ICIjIiArIG5ld0NvbG9yOwp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCd1cGRhdGVFdmVudCcsIGFsbGxFdmVudHNBcnJheVtpXSk7Cn0KfTsKCiRzY29wZS5ldmVudENsaWNrTW9kdWxlID0gZnVuY3Rpb24oc2VsZWN0ZWRFdmVudCwgc2l6ZSkgewpsb2dEZWJ1Zygic2VsZWN0ZWQgRXZlbnQgdGl0bGU9IiArIHNlbGVjdGVkRXZlbnQudGl0bGUpOwoKCnZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewphbmltYXRpb246IGZhbHNlLAp0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9saW1pdGF0aW9uX2RldGFpbHMuaHRtbCcsCmNvbnRyb2xsZXI6ICdldmVudERldGFpbHNIb3Vyc09mV29ya01vZGFsQ29udHJvbGxlcicsCnNpemU6IHNpemUsCnJlc29sdmU6IHsKc2VsZWN0ZWRFdmVudDogZnVuY3Rpb24oKSB7CnJldHVybiBzZWxlY3RlZEV2ZW50Owp9LApmaXhlZFNjaGVkdWxlOiBmdW5jdGlvbiAoKQp7CnJldHVybiAkc2NvcGUuZml4ZWRTY2hlZHVsZTsKfQp9Cn0pOwoKbW9kYWxJbnN0YW5jZS5yZXN1bHQudGhlbihmdW5jdGlvbihzZWxlY3RlZEl0ZW0pIHsKJHNjb3BlLnNlbGVjdGVkID0gc2VsZWN0ZWRJdGVtOwp9LCBmdW5jdGlvbigpIHsKbG9nRGVidWcoJ01vZGFsIGRpc21pc3NlZCBhdDogJyArIG5ldyBEYXRlKCkpOwp9KTsKfTsKCgp2YXIgZGF0ZSA9IG5ldyBEYXRlKCk7CnZhciBkID0gZGF0ZS5nZXREYXRlKCk7CnZhciBtID0gZGF0ZS5nZXRNb250aCgpOwp2YXIgeSA9IGRhdGUuZ2V0RnVsbFllYXIoKTsKCgpmdW5jdGlvbiBnZXRUaW1lU3RhbXAobm93KSB7CnJldHVybiAoKG5vdy5nZXRNb250aCgpICsgMSkgKyAnLycgKyAobm93LmdldERhdGUoKSkgKyAnLycgKyBub3cuZ2V0RnVsbFllYXIoKSArICIgIiArIG5vdy5nZXRIb3VycygpICsgJzonICsgKChub3cuZ2V0TWludXRlcygpIDwgMTApID8gKCIwIiArIG5vdy5nZXRNaW51dGVzKCkpIDogKG5vdy5nZXRNaW51dGVzKCkpKSArICc6JyArICgobm93LmdldFNlY29uZHMoKSA8IDEwKSA/ICgiMCIgKyBub3cKLmdldFNlY29uZHMoKSkgOiAobm93LmdldFNlY29uZHMoKSkpKTsKfQoKCi8qIENoYW5nZSBWaWV3ICovCiRzY29wZS5jaGFuZ2VWaWV3ID0gZnVuY3Rpb24odmlldywgY2FsZW5kYXIpIHsKbG9nRGVidWcoImNoYW5nZSB2aWV3ICIgKyB2aWV3KTsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignY2hhbmdlVmlldycsIHZpZXcpOwp9OwovKiBDaGFuZ2UgVmlldyAqLwoKJHNjb3BlLnJlbmRlckNhbGVuZGVyID0gZnVuY3Rpb24oY2FsZW5kYXIpIHsKJHRpbWVvdXQoZnVuY3Rpb24oKSB7CmlmICh1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0pIHsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVuZGVyJyk7Cn0KfSk7Cn07Cgokc2NvcGUuY2hhbmdlU2VsZWN0YWJsZSA9IGZ1bmN0aW9uKCkgewprdXplSXNDYWxlbmRhckRyYWdnYmxlID0gIWt1emVJc0NhbGVuZGFyRHJhZ2dibGU7CmNhbGVuZGFyID0gJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnOwovLyB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3JykuY2FsZW5kYXIub3B0aW9ucy5zZWxlY3RhYmxlID0gZmFsc2U7CnZpZXcgPSB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdvcHRpb24nLCAnc2VsZWN0YWJsZScsIGZhbHNlKTsKLy8gdmlldy5jYWxlbmRhci5vcHRpb25zLnNlbGVjdGFibGUgPSBmYWxzZTsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVuZGVyJyk7Cgp9Ci8qIGNvbmZpZyBvYmplY3QgKi8KCiRzY29wZS5jYWxlbmRhcl9ob3Vyc19vZl93b3JrX2NvbmZpZyA9IHsKY2FsZW5kYXI6IHsKaGVpZ2h0OiAnYXV0bycsCmVkaXRhYmxlOiB0cnVlLAovLyBoZWFkZXI6IHsKLy8gICAgIGxlZnQ6ICcnLAovLyAgICAgY2VudGVyOiAnJywKLy8gICAgIHJpZ2h0OiAnJwovLyB9LApoZWFkZXI6ICcnLAovLyBoZWFkZXI6IHsKLy8gICAgIGxlZnQ6ICd0aXRsZScsCi8vICAgICBjZW50ZXI6ICcnLAovLyAgICAgcmlnaHQ6ICd0b2RheSBwcmV2LG5leHQnCi8vIH0sCi8vIGRlZmF1bHRWaWV3OiAnYWdlbmRhV2VlaycsCnZpZXdzOiB7CmRvbnRTaG93RGF0ZTogewp0eXBlOiAnYWdlbmRhV2VlaycsCmR1cmF0aW9uOiB7CmRheXM6IDcKfSwKdGl0bGU6ICdBcGVydHVyYScsCmNvbHVtbkZvcm1hdDogJ2RkZGQnIC8vIEZvcm1hdCB0aGUgZGF5IHRvIG9ubHkgc2hvdyBsaWtlICdNb25kYXknCi8vIGhpZGRlbkRheXM6IFswLCA2XSAvLyBIaWRlIFN1bmRheSBhbmQgU2F0dXJkYXk/Cn0sCmRvU2hvd0RhdGU6IHsKdHlwZTogJ2FnZW5kYVdlZWsnLApkdXJhdGlvbjogewpkYXlzOiA3Cn0sCnRpdGxlOiAnQXBlcnR1cmEnLAoKLy8gaGlkZGVuRGF5czogWzAsIDZdIC8vIEhpZGUgU3VuZGF5IGFuZCBTYXR1cmRheT8KfQp9LApldmVudERyb3A6IGZ1bmN0aW9uKGV2ZW50LCBkYXlEZWx0YSwgbWludXRlRGVsdGEsIGFsbERheSwgcmV2ZXJ0RnVuYywgdWlDYWxlbmRhckNvbmZpZykgewpsb2dEZWJ1ZygiZXZlbnRkcm9wIiArIGV2ZW50LnRpdGxlICsgIigiICsgZXZlbnQuaWQgKyAiKSBtb3ZlZCAiICsgbWludXRlRGVsdGEgKyAiIG1pbnV0ZXMiKTsKbG9nRGVidWcoIm9sZCBzdGFydD0iICsgZXZlbnQuc3RhcnQgKyAiLCBvbGQgZW5kPSIgKyBldmVudC5lbmQpOwokc2NvcGUudXBkYXRlTGltaXRhdGlvbkRhdGFiYXNlKGV2ZW50LnN0YXJ0LCBldmVudC5lbmQsIGV2ZW50LmlkLCBldmVudC50ZW1wX2xpbWl0X2lkLCBldmVudCk7Cn0sCmV2ZW50UmVzaXplOiBmdW5jdGlvbihldmVudCwgZGVsdGEsIHJldmVydEZ1bmMpIHsKbG9nRGVidWcoImV2ZW50cmVzaXplLCBldmVudC5lbmQ9IiArIGV2ZW50LmVuZCk7CiRzY29wZS51cGRhdGVMaW1pdGF0aW9uRGF0YWJhc2UoZXZlbnQuc3RhcnQsIGV2ZW50LmVuZCwgZXZlbnQuaWQsIGV2ZW50LnRlbXBfbGltaXRfaWQsIGV2ZW50KTsKfSwKZGVmYXVsdFZpZXc6IGhvdXJzT2ZXb3JrRGVmYXVsdFZpZXcsCmV2ZW50Q2xpY2s6IGZ1bmN0aW9uKGNhbEV2ZW50LCBqc0V2ZW50LCB2aWV3KSB7CmxvZ0RlYnVnKCJldmVudCBjbGlja2VkICIgKyBjYWxFdmVudC50aXRsZSArICIoaWQ9IiArIGNhbEV2ZW50LmlkICsgIiwgZGF5X2xpbWl0X2lkPSIgKyBjYWxFdmVudC5kYXlfbGltaXRfaWQgKyAiLCB0ZW1wX2xpbWl0X2lkPSIgKyBjYWxFdmVudC50ZW1wX2xpbWl0X2lkICsgIiwgbGltaXRfaWQ9IiArIGNhbEV2ZW50LmxpbWl0X2lkICsgIikgc3RhcnQ9IiArIGNhbEV2ZW50LnN0YXJ0ICsgIiwgZW5kPSIgKyBjYWxFdmVudC5lbmQpOwokc2NvcGUuZXZlbnRDbGlja01vZHVsZShjYWxFdmVudCk7Ci8vIGNoYW5nZSB0aGUgYm9yZGVyIGNvbG9yIGp1c3QgZm9yIGZ1bgovLyAkKHRoaXMpLmNzcygnYm9yZGVyLWNvbG9yJywgJ3JlZCcpOwoKfSwKZXZlbnRSZW5kZXI6IGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KQp7CmNvbnNvbGUubG9nKGV2ZW50KTsKZWxlbWVudC5maW5kKCcuZmMtdGl0bGUnKS5wcmVwZW5kKGV2ZW50LmxvY2F0aW9uX25hbWUrIiAvIDxici8+Iik7CmVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZChldmVudC5pbnN0cnVjdG9yX25hbWUrIiAvIDxici8+Iik7Ci8vIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZCgiIitldmVudC5ldmVudFVzZXJzWzBdLmJ1c2VyX2ZpcnN0X25hbWUrIiAiK2V2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfbGFzdF9uYW1lKyIgKCIpOwoKLy8gY29uc29sZS5sb2coInJlbmRlciBsaW1pdGF0aW9uICIrSlNPTi5zdHJpbmdpZnkoZXZlbnQpKTsKLy8gaWYgKGV2ZW50LmlzX2NsYXNzPT0xKQovLyB7Ci8vICAgLy8gaWYgY2xhc3MgYWRkaW5nIG51bWJlciBvZiBwYXJ0aWNpcGFudHMKLy8gICBpZiAoZXZlbnQubm9fb2Zfd2FpdGluZ191c2Vycz4wKQovLyAgIHsKLy8gICAgIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZChldmVudC5ub19vZl91c2VycysiLyIrZXZlbnQubWF4X3BhcnRpY2lwYW50cysgIiAoIitldmVudC5ub19vZl93YWl0aW5nX3VzZXJzKyIpIisiIC0gIik7Ci8vICAgfQovLyAgIGVsc2UKLy8gICB7Ci8vICAgICBlbGVtZW50LmZpbmQoJy5mYy10aXRsZScpLnByZXBlbmQoZXZlbnQubm9fb2ZfdXNlcnMrIi8iK2V2ZW50Lm1heF9wYXJ0aWNpcGFudHMrIiAtICIpOwovLyAgIH0KLy8gfQovLyBlbHNlCi8vIHsKLy8gICAvLyBpZiBub3QgY2xhc3MgLSB3cml0aW5nIHRoZSBlbmR1c2VyIG5hbWUKLy8gICBpZiAoZXZlbnQuZHVyYXRpb25fZXZlbnQhPTApIC8vIGFsc28gaWYgbm90IGhvdXJzIG9mIHdvcmsKLy8gICB7Ci8vICAgICAvLyBlbGVtZW50LmZpbmQoJy5mYy10aXRsZScpLmFwcGVuZCgiICgiK2V2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfZmlyc3RfbmFtZSsiICIrZXZlbnQuZXZlbnRVc2Vyc1swXS5idXNlcl9sYXN0X25hbWUrIikiKTsKLy8gICAgIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZCgiIitldmVudC5ldmVudFVzZXJzWzBdLmJ1c2VyX2ZpcnN0X25hbWUrIiAiK2V2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfbGFzdF9uYW1lKyIgKCIpOwovLyAgICAgZWxlbWVudC5maW5kKCcuZmMtdGl0bGUnKS5hcHBlbmQoIikiKTsKLy8gICB9Ci8vICAgLy8gbG9nRGVidWcoImhlcmU0Iik7Ci8vIH0KLy8gaWYgKGV2ZW50LmlzX3JlcGVhdGluZyA9PSAxKSB7Ci8vICAgICBlbGVtZW50LmZpbmQoIi5mYy10aXRsZSIpLnByZXBlbmQoIiZuYnNwOzxpIGNsYXNzPSdmYSBmYS1yZXBlYXQnPjwvaT4mbmJzcDsiKTsKLy8gICAgIC8vICBlbGVtZW50LmZpbmQoIi5mYy10aXRsZSIpLmFwcGVuZCgiJm5ic3A7PGltZyBzcmM9Jy9wdWJsaWMvaW1hZ2VzL3JlY3VycmluZy1pY29uLnBuZycgd2lkdGg9JzEwcHgnIGhlaWdodD0nMTBweCcvPiIpOwovLyB9Cn0sCm1pblRpbWU6ICRnQ2FsZW5kYXJEaXNwbGF5TWluVGltZSwKbWF4VGltZTogJGdDYWxlbmRhckRpc3BsYXlNYXhUaW1lLApzZWxlY3RhYmxlOiB0cnVlLApzZWxlY3RIZWxwZXI6IGZhbHNlLAp0aW1lem9uZTogZmFsc2UsCmlzUlRMOiB0cnVlLApsYW5nOiAiaGUiLApzZWxlY3RDb25zdHJhaW50OiB7CnN0YXJ0OiAnMDA6MDEnLAplbmQ6ICcyMzo1OScsCn0sCmRlZmF1bHREYXRlOiBtb21lbnQoY3VyckRlZmF1bHREYXRlKSwKYWxsRGF5U2xvdDogZmFsc2UsCmxvYWRpbmc6IGZ1bmN0aW9uKGJvb2wpIHsKaWYgKGJvb2wpIHsKICAgICAgICAgICAgICAgICAgICBsb2dEZWJ1ZygnbG9hZGluZyBjYWxlbmRhcjIgJyArICRzY29wZS5jYWxlbmRhcik7CgovLyAkKCcjbG9hZGluZycpLnNob3coKTsKfSBlbHNlIHsKLy8gJCgnI2xvYWRpbmcnKS5oaWRlKCk7CmxvZ0RlYnVnKCdmaW5pc2hlZCBsb2FkaW5nIGNhbGVuZGFyICcgKyAkc2NvcGUuY2FsZW5kYXIpOwppZiAoISRzY29wZS5maXhlZFNjaGVkdWxlKSB7CiRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlKCk7Cn0KLy8gJHNjb3BlLmJhY2tUb0ZpeGVkKCk7Cn0KfSwKc2VsZWN0OiBmdW5jdGlvbihzdGFydCwgZW5kLCBhbGxEYXkpIHsKLy8gdGhpcyBpcyBjYWxsZWQgd2hlbiBjcmVhdGluZyBhIG5ldyBibG9jawokc2NvcGUuY3JlYXRlTGltaXRhdGlvbkJsb2NrKHN0YXJ0LCBlbmQpOwp9Cn0KfTsKCi8vIGNyZWF0ZSBsaW1pdGF0aW9uIGJsb2NrCiRzY29wZS5jcmVhdGVMaW1pdGF0aW9uQmxvY2sgPSBmdW5jdGlvbihzdGFydCwgZW5kKQp7CmxvZ0RlYnVnKCJmdW5jdGlvbjogY3JlYXRlTGltaXRhdGlvbkJsb2NrIik7CnZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewphbmltYXRpb246IGZhbHNlLAp0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9saW1pdGF0aW9uX2NyZWF0ZS5waHAnLApzaXplOiAneHMnLApjb250cm9sbGVyOiAnYnVzaW5lc3NfbW9kYWxfbGltaXRhdGlvbl9jcmVhdGUnLApyZXNvbHZlOiB7CnN0YXJ0OiBmdW5jdGlvbigpCnsKcmV0dXJuIHN0YXJ0Owp9LAplbmQ6IGZ1bmN0aW9uKCkKewpyZXR1cm4gZW5kOwp9LApmaXhlZFNjaGVkdWxlOiBmdW5jdGlvbiAoKQp7CnJldHVybiAkc2NvcGUuZml4ZWRTY2hlZHVsZTsKfQp9Cn0pOwp9CiRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlID0gZnVuY3Rpb24oKSB7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3Jyk7Cgp2aXNpYmxlRGF0ZVN0YXJ0ID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5zdGFydCk7CnZpc2libGVEYXRlRW5kID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5lbmQpOwoKJHNjb3BlLmNhbGVuZGFyVGl0bGVDZW50ZXIgPSB2aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSArICIgIiArIG1vbnRoTmFtZXNbdmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpXSArCiIg4oCUICIgKyB2aXNpYmxlRGF0ZUVuZC5nZXREYXRlKCkgKyAiICIgKyBtb250aE5hbWVzW3Zpc2libGVEYXRlRW5kLmdldE1vbnRoKCldICsKIiAiICsgdmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpOwp9OwovKiBldmVudCBzb3VyY2VzIGFycmF5Ki8KJHNjb3BlLmV2ZW50U291cmNlcyA9IFt7CnVybDogJy9hcGkvYWRtaW4vY2FsZW5kYXIvbGltaXRhdGlvbnMvcGVyZGF5L2dldHBvc3QnLAp0eXBlOiAnUE9TVCcKfV07CgovLyAkc2NvcGUuZ2V0RXZlbnRzID0gZnVuY3Rpb24oKSB7Ci8vICAgICBjYWxlbmRhciA9ICdjYWxlbmRhcl9ob3Vyc19vZl93b3JrJzsKLy8gICAgIGFsbGxFdmVudHNBcnJheSA9IHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2NsaWVudEV2ZW50cycpOwovLyAgICAgZm9yIChpIGluIGFsbGxFdmVudHNBcnJheSkgewovLyAgICAgICAgIGxvZ0RlYnVnKGFsbGxFdmVudHNBcnJheVtpXSk7Ci8vICAgICB9Ci8vCi8vIH0KCiRzY29wZS5nb3RvVG9kYXkgPSBmdW5jdGlvbigpIHsKJHNjb3BlLmdvdG9EYXRlKG5ldyBEYXRlKCkpOwp9CiRzY29wZS5nb3RvTmV4dCA9IGZ1bmN0aW9uKCkgewp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignbmV4dCcpOwp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVtb3ZlRXZlbnRzJyk7CiRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlKCk7Cn0KJHNjb3BlLmdvdG9QcmV2ID0gZnVuY3Rpb24oKSB7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZW1vdmVFdmVudHMnKTsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3ByZXYnKTsKJHNjb3BlLnVwZGF0ZUNhbGVuZGFyQ2VudGVyVGl0bGUoKTsKfQokc2NvcGUuZ290b0RhdGUgPSBmdW5jdGlvbihuZXdkYXRlKSB7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnb3RvRGF0ZScsIG5ld2RhdGUpOwp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignY2hhbmdlVmlldycsICdhZ2VuZGFXZWVrJyk7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZW1vdmVFdmVudHMnKTsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKCiRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlKCk7CiRzY29wZS5maXhlZFNjaGVkdWxlID0gZmFsc2U7Cn0KCiRzY29wZS5iYWNrVG9GaXhlZCA9IGZ1bmN0aW9uKCkgewokc2NvcGUuZml4ZWRTY2hlZHVsZSA9IHRydWU7CiRzY29wZS5jYWxlbmRhclRpdGxlQ2VudGVyID0gItep16LXldeqINek16LXmdec15XXqiDXp9eR15XXoteV16oiOwp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignY2hhbmdlVmlldycsICdkb250U2hvd0RhdGUnKTsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dvdG9EYXRlJywgbW9tZW50KCRnSG91cjBkYXRlKSk7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZW1vdmVFdmVudHMnKTsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKCn0KCi8vICRzY29wZS5kZWxldGVBbGxFdmVudHMgPSBmdW5jdGlvbigpIHsKLy8gICAgIGNhbGVuZGFyID0gJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnOwovLyAgICAgYWxsbEV2ZW50c0FycmF5ID0gdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignY2xpZW50RXZlbnRzJyk7Ci8vICAgICBmb3IgKGkgaW4gYWxsbEV2ZW50c0FycmF5KSB7Ci8vICAgICAgICAgbG9nRGVidWcoYWxsbEV2ZW50c0FycmF5W2ldKTsKLy8gICAgICAgICAkc2NvcGUuZGVsZXRlQ2FsZW5kYXJKU0V2ZW50KGNhbGVuZGFyLCBhbGxsRXZlbnRzQXJyYXlbaV0uaWQpOwovLyAgICAgICAgICRzY29wZS5kZWxldGVDYWxlbmRhckRCRXZlbnQoYWxsbEV2ZW50c0FycmF5W2ldLmlkKTsKLy8gICAgIH0KLy8KLy8gfQokc2NvcGUudXBkYXRlTGltaXRhdGlvbkRhdGFiYXNlID0gZnVuY3Rpb24oc3RhcnRfcGFyYW0sIGVuZF9wYXJhbSwgZXZlbnRfaWQsIHRlbXBfbGltaXRfaWQsIHRoZWV2ZW50KSB7Cgpsb2dEZWJ1ZygidXBkYXRlTGltaXRhdGlvbkRhdGFiYXNlIHN0YXJ0PSIgKyBzdGFydF9wYXJhbSArICIsIGVuZD0iICsgZW5kX3BhcmFtICsgIixldmVudF9pZD0iICsgZXZlbnRfaWQpOwoKZnVuY3Rpb24gdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uX2ZhaWx1cmUoKQp7CmNhbGVuZGFyID0gImNhbGVuZGFyX2hvdXJzX29mX3dvcmsiOwp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZWZldGNoRXZlbnRzJyk7Cn0KLy8gaWYgdGhlIGV2ZW50IHRoYXQgaXMgZ2V0dGluZyB1cGRhdGVkIGlzIGFuIGV2ZW50IGZyb20gMTk3MCAobm90IHBlcmRheSkKLy8gdGhlbiB3ZSBhZGQgYSBuZXcgcGVyZGF5IGxpbWl0YXRpb24gd2l0aCBsaW1pdF9pZCBvZiB0aGUgMTk3MCBsaW1pdGF0aW9ucyAtIHdpdGggdGhlIG5ldyB0aW1lcy4KCi8vIG90aGVyd2lzZSB3ZSBqdXN0IHVwZGF0ZSB0aGUgcGVyZGF5IGxpbWl0YXRpb24KCmlmICgkc2NvcGUuZml4ZWRTY2hlZHVsZSkgLy8gZml4ZWQgc2NoZWR1bGUgdnMgc3BlY2lmaWMgd2VlZC9kYXkgbGltaXRhdGlvbgp7CnRoZWRhdGEgPSB7CnN0YXJ0X2RhdGU6IHN0YXJ0X3BhcmFtLAplbmRfZGF0ZTogZW5kX3BhcmFtLAp0ZW1wX2xpbWl0X2lkOiB0ZW1wX2xpbWl0X2lkLApsaW1pdF9pZDogZXZlbnRfaWQKfTsKCnVwZGF0ZUNhbGVuZGFyTGltaXRhdGlvbigkaHR0cCwkc2NvcGUsdGhlZGF0YSxldmVudF9pZCwgbnVsbCwgdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uX2ZhaWx1cmUpOwp9CmVsc2UgLy8gbm90IGZpeGVkIHNjaGVkdWxlIC0gZGFpbHkvd2Vla2x5IGxpbWl0YXRpb25zCnsKaWYgKCh0aGVldmVudC5saW1pdF9pZCAhPSBudWxsKSAmICh0aGVldmVudC5kYXlfbGltaXRfaWQgPT0gLTEpKSAvLyBldmVudCBsaW1pdGF0aW9uIGhhcyBsaW1pdF9pZCBzbyBpdHMgYW4gMTk3MCBldmVudAovLyBuZWVkIHRvIGFkZCBhIG5ldyBwZXJkYXkgbGltaXRhdGlvbiB0aGF0IHBvaW50IChsaW1pdF9pZCkgdG8gdGhlIG9sZCAxOTcwIGV2ZW50IHRvIGNhbmNlbCBpdAp7CnRlbXBfbGltaXRfaWQgPSBjYWxjX3RlbXBfbGltaXRfaWQoKTsKdGhlZXZlbnQudGVtcF9saW1pdF9pZCA9IHRlbXBfbGltaXRfaWQ7CnRoZWV2ZW50LmRheV9saW1pdF9pZCA9IHRlbXBfbGltaXRfaWQ7Ci8vIHRoZSBtb3ZlZCBldmVudCBpbiB0aGUgY2FsZW5kYXIgbm93IGhhcyBkYXlfbGltaXRfaWQgYW5kIHRlbXBfbGltaXRfaWQKLy8gaWYgaXRzIGxvYWRlZCBmcm9tIHRoZSBkYiwgaXQgd2lsbCBvbmx5IGhhdmUgZGF5X2xpbWl0X2lkIChhbmQgbm90IHRoZSB0ZW1wIG9uZSkKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnXS5mdWxsQ2FsZW5kYXIoJ3VwZGF0ZUV2ZW50JywgdGhlZXZlbnQpOwoKdGhlZGF0YSA9IHsKc3RhcnRfZGF0ZTogc3RhcnRfcGFyYW0sCmVuZF9kYXRlOiBlbmRfcGFyYW0sCmNvbG9yOiB0aGVldmVudC5jb2xvciwKdGVtcF9saW1pdF9pZDogdGVtcF9saW1pdF9pZCwKZXZlbnRfdHlwZV9pZDogdGhlZXZlbnQuZXZlbnRfdHlwZV9pZCwKZXZlbnRfdHlwZXM6IHRoZWV2ZW50LmV2ZW50X3R5cGVzLApsb2NhdGlvbl9pZDogdGhlZXZlbnQubG9jYXRpb25faWQsCmVtcF9pZDogdGhlZXZlbnQuZW1wX2lkLApsaW1pdF9pZDogdGhlZXZlbnQuaWQsCnRpdGxlOiB0aGVldmVudC50aXRsZQp9OwpjcmVhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXkoJGh0dHAsJHNjb3BlLHRoZWRhdGEsbnVsbCwgdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uX2ZhaWx1cmUpOwoKfQplbHNlIC8vIGV2ZW50IGxpbWl0YXRpb24gdG8gbW92ZS91cGRhdGUgaGFzIG5vIGxpbWl0X2lkIC0gc28gdGhpcyBpcyBuZXcgcGVyZGF5IGV2ZW50IC0gd2UganVzdCB1cGRhdGUgaXQKewp0aGVkYXRhPSB7CnN0YXJ0X2RhdGU6IHN0YXJ0X3BhcmFtLAplbmRfZGF0ZTogZW5kX3BhcmFtLAp0ZW1wX2RheV9saW1pdF9pZDogdGhlZXZlbnQudGVtcF9saW1pdF9pZCwKbG9jYXRpb25faWQ6IHRoZWV2ZW50LmxvY2F0aW9uX2lkLApkYXlfbGltaXRfaWQ6IHRoZWV2ZW50LmRheV9saW1pdF9pZAp9Owp1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXkoJGh0dHAsJHNjb3BlLHRoZWRhdGEsbnVsbCwgdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uX2ZhaWx1cmUpOwp9Cn0KfTsKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ0V2ZW50Q2xhc3NQYWdlQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHRpbWVvdXQsICRodHRwLCAkcm9vdFNjb3BlLCAkcm91dGVQYXJhbXMsICRsb2NhdGlvbiwgJHJvdXRlLCBzaGFyZWREYXRhLCAkdWliTW9kYWwpCnsKZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkKTsKZ2V0QWxsQ2xpZW50cygkaHR0cCwkc2NvcGUsJ2V2ZW50VHlwZVVzZXJzJyk7CmdldEJ1c2luZXNzTG9jYXRpb25zKCRodHRwLCRzY29wZSwnYnVzaW5lc3NfbG9jYXRpb25zJyk7CmdldEFsbEluc3RydWN0b3JzKCRodHRwLCRzY29wZSwnaW5zdHJ1Y3RvcnMnKTsKCiRzY29wZS51cGRhdGVFdmVudFRpdGxlID0gZnVuY3Rpb24obmV3VmFsdWUsY3VycmVudEV2ZW50KQp7Cm5ld190aXRsZT1uZXdWYWx1ZTsKc2V0RXZlbnRUaXRsZSgkaHR0cCwkc2NvcGUsY3VycmVudEV2ZW50LmV2ZW50X2lkLCBuZXdfdGl0bGUsIHVwZGF0ZUV2ZW50X2NhbGxiYWNrLCB1cGRhdGVFdmVudF9jYWxsYmFjayk7CgpmdW5jdGlvbiB1cGRhdGVFdmVudF9jYWxsYmFjaygpCnsKZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCk7Cn0KCn07Cgokc2NvcGUudXBkYXRlRXZlbnRNYXhQYXJ0aWNpcGFudHMgPSBmdW5jdGlvbihuZXdWYWx1ZSxjdXJyZW50RXZlbnQpCnsKbmV3X21heF9wYXJ0aWNpcGFudHM9bmV3VmFsdWU7CmlmICggbmV3X21heF9wYXJ0aWNpcGFudHMgPCBjdXJyZW50RXZlbnQubm9fb2ZfdXNlcnMgKXsKc2V0RXZlbnRNYXhQYXJ0aWNpcGFudHMoJGh0dHAsJHNjb3BlLGN1cnJlbnRFdmVudC5ldmVudF9pZCwgY3VycmVudEV2ZW50Lm5vX29mX3VzZXJzLCBjdXJyZW50RXZlbnQubm9fb2ZfdXNlcnMsIHVwZGF0ZUV2ZW50X2NhbGxiYWNrLCB1cGRhdGVFdmVudF9jYWxsYmFjayk7Cn0gZWxzZSB7CnNldEV2ZW50TWF4UGFydGljaXBhbnRzKCRodHRwLCRzY29wZSxjdXJyZW50RXZlbnQuZXZlbnRfaWQsIG5ld19tYXhfcGFydGljaXBhbnRzLCBjdXJyZW50RXZlbnQubm9fb2ZfdXNlcnMsIHVwZGF0ZUV2ZW50X2NhbGxiYWNrLCB1cGRhdGVFdmVudF9jYWxsYmFjayk7Cn0KCmZ1bmN0aW9uIHVwZGF0ZUV2ZW50X2NhbGxiYWNrKCkKewpnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkKTsKfQoKfTsKCiRzY29wZS51cGRhdGVVc2VyRXZlbnRQcmljZSA9IGZ1bmN0aW9uKG5ld3ZhbHVlLCB0aGVldmVudCwgZXVzZXIpCnsKbmV3X3ByaWNlPW5ld3ZhbHVlOwpzZXRDbGllbnRFdmVudFByaWNlKCRodHRwLCRzY29wZSxldXNlci5idXNpbmVzc191c2VyX2lkLHRoZWV2ZW50LmV2ZW50X2lkLCBuZXdfcHJpY2Usc2V0Q2xpZW50RXZlbnRQcmljZV9jYWxsYmFjaywgc2V0Q2xpZW50RXZlbnRQcmljZV9jYWxsYmFjayk7CmZ1bmN0aW9uIHNldENsaWVudEV2ZW50UHJpY2VfY2FsbGJhY2soKQp7CmdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQpOwp9Cn07Cgokc2NvcGUudXBkYXRlTG9jYXRpb25FdmVudCA9IGZ1bmN0aW9uKCkKewpjb25zb2xlLmxvZygiZnVuY3Rpb246IHVwZGF0ZUxvY2F0aW9uRXZlbnQiKTsKdXBkYXRlRXZlbnRMb2NhdGlvbigkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLCRzY29wZS5jdXJyZW50RXZlbnQubG9jYXRpb25faWQsdXBkYXRlRXZlbnRMb2NhdGlvbl9jYWxsYmFjaywgdXBkYXRlRXZlbnRMb2NhdGlvbl9jYWxsYmFjayk7CiRzY29wZS51cGRhdGVMb2NhdGlvbkFsZXJ0TWVzc2FnZT0i157XoteT15vXnyDXodeY15jXldehLi4uIjsKZnVuY3Rpb24gdXBkYXRlRXZlbnRMb2NhdGlvbl9jYWxsYmFjaygpCnsKJHNjb3BlLnVwZGF0ZUxvY2F0aW9uQWxlcnRNZXNzYWdlPSLXoteV15PXm9efINeR15TXptec15fXlCEiOwokdGltZW91dChmdW5jdGlvbigpCnsKJHNjb3BlLnVwZGF0ZUxvY2F0aW9uQWxlcnRNZXNzYWdlPW51bGw7Cn0sIDE1MDApOwp9Cn07Cgokc2NvcGUudXBkYXRlSW5zdHJ1Y3RvckNsYXNzRXZlbnQgPSBmdW5jdGlvbigpCnsKY29uc29sZS5sb2coImZ1bmN0aW9uOiB1cGRhdGVJbnN0cnVjdG9yQ2xhc3NFdmVudCIpOwp1cGRhdGVFdmVudEluc3RydWN0b3IoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCwkc2NvcGUuY3VycmVudEV2ZW50Lmluc3RydWN0b3JfaWQsdXBkYXRlRXZlbnRJbnN0cnVjdG9yX2NhbGxiYWNrLCB1cGRhdGVFdmVudEluc3RydWN0b3JfY2FsbGJhY2spOwokc2NvcGUudXBkYXRlSW5zdHJ1Y3RvckFsZXJ0TWVzc2FnZT0i157XoteT15vXnyDXodeY15jXldehLi4uIjsKZnVuY3Rpb24gdXBkYXRlRXZlbnRJbnN0cnVjdG9yX2NhbGxiYWNrKCkKewokc2NvcGUudXBkYXRlSW5zdHJ1Y3RvckFsZXJ0TWVzc2FnZT0i16LXldeT15vXnyDXkdeU16bXnNeX15QhIjsKJHRpbWVvdXQoZnVuY3Rpb24oKQp7CiRzY29wZS51cGRhdGVJbnN0cnVjdG9yQWxlcnRNZXNzYWdlPW51bGw7Cn0sIDE1MDApOwp9Cn0KCgokc2NvcGUuYWN0aXZhdGVFdmVudENsYXNzID0gZnVuY3Rpb24oKQp7CnsKbG9nRGVidWcoInJlb3BlbkV2ZW50Iik7CnJlb3BlbkV2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkLCRzY29wZS5zZWxlY3RlZEV2ZW50LGFmdGVyUmVvcGVuRXZlbnQsYWZ0ZXJSZW9wZW5FdmVudCk7CmZ1bmN0aW9uIGFmdGVyUmVvcGVuRXZlbnQoKQp7CmdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQpOwp9Owp9Cn0KCi8vIGNsb3NlIGV2ZW50IGNsYXNzCiRzY29wZS5jbG9zZUV2ZW50Q2xhc3MgPSBmdW5jdGlvbigpIHsKICAgICAgbG9nRGVidWcoImNsb3NlRXZlbnRDbGFzcyIpOwoKdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CmFuaW1hdGlvbjogZmFsc2UsCnRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2V2ZW50X2NsYXNzX2Nsb3NlLnBocCcsCnNpemU6ICd4cycsCmNvbnRyb2xsZXI6ICdjbGFzc0Nsb3NlTW9kYWxDb250cm9sbGVyJywKcmVzb2x2ZTogewpldmVudF9pZDogZnVuY3Rpb24oKSB7CnJldHVybiAkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkOwp9Cn0KfSk7Cn07CgovLyBkZWxldGUgcmVwZWF0aW5nL2NsYXNzIGV2ZW50CiRzY29wZS5kZWxldGVDbGFzc0V2ZW50ID0gZnVuY3Rpb24oKQp7CmlmICgkc2NvcGUuY3VycmVudEV2ZW50LmlzX3JlcGVhdGluZz09MCkKewpsb2dEZWJ1ZygiY2xhc3MgZXZlbnQgbm90IHJlcGVhdGluZyIpOwokc2NvcGUuZGVsZXRlQ2xhc3NFdmVudFNpbmdsZSgpOwp9CmVsc2UKewpsb2dEZWJ1ZygiY2xhc3MgZXZlbnQgaXMgcmVwZWF0aW5nIik7CnZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewphbmltYXRpb246IGZhbHNlLAp0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9yZXBlYXRpbmdfZXZlbnRfZGVsZXRlX2FsbC5waHAnLApzaXplOiAneHMnLApjb250cm9sbGVyOiAnY2xhc3NEZWxldGVBbGxNb2RhbENvbnRyb2xsZXInLApyZXNvbHZlOiB7CmN1cnJlbnRFdmVudDogZnVuY3Rpb24oKSB7CnJldHVybiAkc2NvcGUuY3VycmVudEV2ZW50Owp9Cn0KfSk7Cn0KfTsKCiRzY29wZS5kZWxldGVDbGFzc0V2ZW50U2luZ2xlPWZ1bmN0aW9uICgpIC8vIGRlbGV0ZSBvbmx5IG9uZS9jdXJyZW50IGNsYXNzIGV2ZWh0CnsKY2FuY2VsQ2xhc3NFdmVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCxjYW5jZWxDbGFzc0V2ZW50X2NhbGxiYWNrLCBjYW5jZWxDbGFzc0V2ZW50X2NhbGxiYWNrKTsKZnVuY3Rpb24gY2FuY2VsQ2xhc3NFdmVudF9jYWxsYmFjaygpCnsKZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCk7Cn0KfQoKJHNjb3BlLiRvbigicmVsb2FkRXZlbnQiLGZ1bmN0aW9uKGUsYSl7Ci8vIFBvc3QgeW91ciBjb2RlCmxvZ0RlYnVnKCJicm9hZGNhc3RlZCAtIHJlbG9hZGluZyBldmVudCAiK2EuZXZlbnRfaWQpOwpnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkcm91dGVQYXJhbXMuZXZlbnRfaWQpOwp9KTsKCi8vIHJlbW92ZSBlbmQgdXNlciBmcm9tIGV2ZW50CiRzY29wZS5ldmVudFJlbW92ZUVuZFVzZXIgPSBmdW5jdGlvbihlbmR1c2VyX2lkKQp7CmNvbnNvbGUubG9nKCJldmVudFJlbW92ZUVuZFVzZXIiKTsKcmVtb3ZlRW5kVXNlckZyb21FdmVudCgkaHR0cCwkc2NvcGUsZW5kdXNlcl9pZCwkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkLHJlbW92ZUVuZFVzZXJGcm9tRXZlbnRfZmluaXNoLCByZW1vdmVFbmRVc2VyRnJvbUV2ZW50X2ZpbmlzaCk7CmZ1bmN0aW9uIHJlbW92ZUVuZFVzZXJGcm9tRXZlbnRfZmluaXNoKCkKewpnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkcm91dGVQYXJhbXMuZXZlbnRfaWQpOwp9Cn07Cgokc2NvcGUuZXZlbnRDbGllbnRTZWxlY3RlZCA9IGZ1bmN0aW9uKHNlbGVjdGVkKSB7CmlmIChzZWxlY3RlZCkgewovLyBhbGVydChKU09OLnN0cmluZ2lmeSggc2VsZWN0ZWQsIG51bGwsIDIgKSk7CmxvZ0RlYnVnKCdldmVudENsaWVudFNlbGVjdGVkMiB5ZXMgc2VsZWN0ZWQgJyArIHNlbGVjdGVkLm9yaWdpbmFsT2JqZWN0LmZpcnN0X25hbWUpOwokc2NvcGUuZXZlbnRBZGRFbmRVc2VyKHNlbGVjdGVkLm9yaWdpbmFsT2JqZWN0LmJ1c2luZXNzX3VzZXJfaWQpOwokcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2FuZ3Vjb21wbGV0ZS1hbHQ6Y2xlYXJJbnB1dCcsICdjbGllbnRfYW5ndWNvbXBsZXRlJyk7Cgp9IGVsc2Ugewpsb2dEZWJ1Zygnbm90IHNlbGVjdGVkJyk7Cn0KfTsKCiRzY29wZS5ldmVudEFkZEVuZFVzZXIgPSBmdW5jdGlvbihlbmR1c2VyX2lkKQp7CmFkZEVuZFVzZXJUb0V2ZW50KCRodHRwLCRzY29wZSxlbmR1c2VyX2lkLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQsYWRkRW5kVXNlclRvRXZlbnRfZmluaXNoLCBhZGRFbmRVc2VyVG9FdmVudF9maW5pc2gpOwpmdW5jdGlvbiBhZGRFbmRVc2VyVG9FdmVudF9maW5pc2goKQp7CmdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCk7Cn0KfTsKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ0V2ZW50UGFnZUNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICR0aW1lb3V0LCAkaHR0cCwgJHVpYk1vZGFsICxzaGFyZWRQcm9wZXJ0aWVzLCAkcm91dGVQYXJhbXMsICRyb290U2NvcGUsICRsb2NhdGlvbiwgJHJvdXRlLCBzaGFyZWREYXRhKQp7CmxvZ0RlYnVnKCJFdmVudFBhZ2VDb250cm9sbGVyIik7CgpnZXRBbGxJbnN0cnVjdG9yc0luY0luYWN0aXZlKCRodHRwLCRzY29wZSwnaW5zdHJ1Y3RvcnMnLGdldEFsbEluc3RydWN0b3JzSW5jSW5hY3RpdmVfc3VjY2Vzcyk7CmdldEJ1c2luZXNzTG9jYXRpb25zKCRodHRwLCRzY29wZSwnYnVzaW5lc3NfbG9jYXRpb25zJyk7CgpmdW5jdGlvbiBnZXRBbGxJbnN0cnVjdG9yc0luY0luYWN0aXZlX3N1Y2Nlc3MoKQp7CmdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCxzZXRQYXJ0aWNpcGF0ZWQpOwp9CgogIHZhciBpbml0aWFsaXppbmcgPSB0cnVlIDsKCiAgJHNjb3BlLiR3YXRjaCgiY3VycmVudEV2ZW50IiwgZnVuY3Rpb24obmV3VmFsdWUsIG9sZFZhbHVlKSB7CiAgICBpZiAoaW5pdGlhbGl6aW5nKSB7CiAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkgeyBpbml0aWFsaXppbmcgPSBmYWxzZTsgfSk7CiAgICB9IGVsc2UgewogICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgdmFyIHRpbWVvdXRJZDsKICAgICAgJCgnI2RvY3MgOmlucHV0LCB0ZXh0YXJlYScpLm9uKCdpbnB1dCBwcm9wZXJ0eWNoYW5nZSBjaGFuZ2UnLCBmdW5jdGlvbigpIHsKICAgICAgLy8gIGNvbnNvbGUubG9nKCdUZXh0YXJlYSBDaGFuZ2UnKTsKICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0SWQpOwogICAgICAgLy8gUnVucyBYIHNlY29uZCAoWCoxMDAwIG1zKSBhZnRlciB0aGUgbGFzdCBjaGFuZ2UKICAgICAgIHRpbWVvdXRJZCA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgJHNjb3BlLnVwZGF0ZUV2ZW50RXh0cmFGaWVsZHMoKQogICAgICAgfSwgNzAwKTsKICAgICAgIH0pOwogICAgfSwgMTAwMCk7CiAgICB9CiAgfSk7Cgokc2NvcGUuZXh0cmFGaWVsZHNBbGVydE1lc3NhZ2U9bnVsbDsKCiRzY29wZS51cGRhdGVFdmVudFRpdGxlID0gZnVuY3Rpb24obmV3VmFsdWUsY3VycmVudEV2ZW50KQp7Cm5ld190aXRsZT1uZXdWYWx1ZTsKc2V0RXZlbnRUaXRsZSgkaHR0cCwkc2NvcGUsY3VycmVudEV2ZW50LmV2ZW50X2lkLCBuZXdfdGl0bGUsIHVwZGF0ZUV2ZW50X2NhbGxiYWNrLCB1cGRhdGVFdmVudF9jYWxsYmFjayk7CgpmdW5jdGlvbiB1cGRhdGVFdmVudF9jYWxsYmFjaygpCnsKZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCk7Cn0KCn07CgoKJHNjb3BlLnVwZGF0ZUV2ZW50RXh0cmFGaWVsZHMgPSBmdW5jdGlvbigpCnsKICAgIGxvZ0RlYnVnKCJzYXZlIHVwZGF0ZUV2ZW50RXh0cmFGaWVsZHMiKTsKdGhlZGF0YSA9IHsKZXh0cmFGaWVsZHM6JHNjb3BlLmN1cnJlbnRFdmVudC5leHRyYUZpZWxkcwp9OwogICAgJHNjb3BlLmV4dHJhRmllbGRzQWxlcnRNZXNzYWdlPSLXqdeV157XqC4uLiI7CnVwZGF0ZUV2ZW50RXh0cmFGaWVsZHMoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCx0aGVkYXRhLHVwZGF0ZUV2ZW50RXh0cmFGaWVsZHNfY2FsbGJhY2ssIHVwZGF0ZUV2ZW50RXh0cmFGaWVsZHNfY2FsbGJhY2spOwoKZnVuY3Rpb24gdXBkYXRlRXZlbnRFeHRyYUZpZWxkc19jYWxsYmFjaygpCnsKICAgICAgLy8gZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLHNldFBhcnRpY2lwYXRlZCk7CgogICAgICAkc2NvcGUuZXh0cmFGaWVsZHNBbGVydE1lc3NhZ2U9Iteg16nXnteoISI7CiR0aW1lb3V0KGZ1bmN0aW9uKCkKewokc2NvcGUuZXh0cmFGaWVsZHNBbGVydE1lc3NhZ2U9bnVsbDsKICAgICAgfSwgMjMwMCk7Cn0KfTsKCiRzY29wZS5yZXNjaGVkdWxlRXZlbnQgPSBmdW5jdGlvbigpCnsKbG9nRGVidWcoInNlZXRpbmcgZXZlbnQgdG8gbW92ZSAgIiskc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0pOwpzaGFyZWRQcm9wZXJ0aWVzLnNldF9ldmVudF9yZXNjaGVkdWxlKCRzY29wZS5jdXJyZW50RXZlbnQpOwogICAgc2hhcmVkUHJvcGVydGllcy5zZXRfc2VsZWN0ZWRfdXNlcihudWxsKTsKCi8vIHVzZXJfaW5mbz0gewovLyAgICAgdXNlcl9pZDogJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudFVzZXJzWzBdLnVzZXJfaWQsCi8vICAgICBidXNlcl9maXJzdF9uYW1lOiAkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfZmlyc3RfbmFtZSwKLy8gICAgIGJ1c2VyX2xhc3RfbmFtZTogJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudFVzZXJzWzBdLmJ1c2VyX2xhc3RfbmFtZQovLyB9OwovLyBzaGFyZWRQcm9wZXJ0aWVzLnNldF9zZWxlY3RlZF91c2VyKHVzZXJfaW5mbyk7CiRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfY2FsZW5kYXInKTsKfQoKJHNjb3BlLnVwZGF0ZUxvY2F0aW9uRXZlbnQgPSBmdW5jdGlvbigpCnsKY29uc29sZS5sb2coImZ1bmN0aW9uOiB1cGRhdGVMb2NhdGlvbkV2ZW50Iik7CnVwZGF0ZUV2ZW50TG9jYXRpb24oJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCwkc2NvcGUuY3VycmVudEV2ZW50LmxvY2F0aW9uX2lkLHVwZGF0ZUV2ZW50TG9jYXRpb25fY2FsbGJhY2ssIHVwZGF0ZUV2ZW50TG9jYXRpb25fY2FsbGJhY2spOwokc2NvcGUudXBkYXRlTG9jYXRpb25BbGVydE1lc3NhZ2U9Itee16LXk9eb158g16HXmNeY15XXoS4uLiI7CmZ1bmN0aW9uIHVwZGF0ZUV2ZW50TG9jYXRpb25fY2FsbGJhY2soKQp7CiRzY29wZS51cGRhdGVMb2NhdGlvbkFsZXJ0TWVzc2FnZT0i16LXldeT15vXnyDXkdeU16bXnNeX15QhIjsKJHRpbWVvdXQoZnVuY3Rpb24oKQp7CiRzY29wZS51cGRhdGVMb2NhdGlvbkFsZXJ0TWVzc2FnZT1udWxsOwp9LCAxNTAwKTsKfQp9OwoKJHNjb3BlLnVwZGF0ZUluc3RydWN0b3JFdmVudCA9IGZ1bmN0aW9uKCkKewpjb25zb2xlLmxvZygiZnVuY3Rpb246IHVwZGF0ZUluc3RydWN0b3JFdmVudCIpOwp1cGRhdGVFdmVudEluc3RydWN0b3IoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCwkc2NvcGUuY3VycmVudEV2ZW50Lmluc3RydWN0b3JfaWQsdXBkYXRlRXZlbnRJbnN0cnVjdG9yX2NhbGxiYWNrLCB1cGRhdGVFdmVudEluc3RydWN0b3JfY2FsbGJhY2spOwokc2NvcGUudXBkYXRlSW5zdHJ1Y3RvckFsZXJ0TWVzc2FnZT0i157XoteT15vXnyDXodeY15jXldehLi4uIjsKZnVuY3Rpb24gdXBkYXRlRXZlbnRJbnN0cnVjdG9yX2NhbGxiYWNrKCkKewokc2NvcGUudXBkYXRlSW5zdHJ1Y3RvckFsZXJ0TWVzc2FnZT0i16LXldeT15vXnyDXkdeU16bXnNeX15QhIjsKJHRpbWVvdXQoZnVuY3Rpb24oKQp7CiRzY29wZS51cGRhdGVJbnN0cnVjdG9yQWxlcnRNZXNzYWdlPW51bGw7Cn0sIDE1MDApOwp9Cn07Cgokc2NvcGUuaW5pdGlhdGVQYXltZW50ID0gZnVuY3Rpb24oaXNwbHVzKQp7CnZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewphbmltYXRpb246IGZhbHNlLAp0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9jbGllbnRfcGF5bWVudC5waHAnLApjb250cm9sbGVyOiAnYnVzaW5lc3NDbGllbmRDYXJkUGF5bWVudCcsCi8vIHNpemU6IHNpemUsCnJlc29sdmU6IHsKY3VycmVudENsaWVudDogZnVuY3Rpb24oKSB7CnJldHVybiAkc2NvcGUuY3VycmVudEV2ZW50Q2xpZW50c1swXTsKfSwKaXNwbHVzOiBmdW5jdGlvbigpIHsKcmV0dXJuIGlzcGx1czsKfQp9Cn0pOwp9Cgokc2NvcGUuZGVsZXRlRXZlbnQ9ZnVuY3Rpb24gKCkKewovLyBjaGVja2luZyBpZiBjYW5jZWxpbmcgYSBnZW5lcmNfdHlwZSBldmVudCAtIHRoZW4gdGhlcmUncyBubyB1c2VyCmlmICgkc2NvcGUuY3VycmVudEV2ZW50LmlzX2dlbmVyaWNfZXR5cGU9PTEpCnsKY2FuY2VsU2luZ2xlRXZlbnQoJGh0dHAsJHNjb3BlLDAsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLGNhbmNlbFNpbmdsZUV2ZW50X2NhbGxiYWNrLCBjYW5jZWxTaW5nbGVFdmVudF9jYWxsYmFjayk7Cn0KZWxzZQp7CmNhbmNlbFNpbmdsZUV2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50VXNlcnNbMF0uYnVzaW5lc3NfdXNlcl9pZCwkcm91dGVQYXJhbXMuZXZlbnRfaWQsY2FuY2VsU2luZ2xlRXZlbnRfY2FsbGJhY2ssIGNhbmNlbFNpbmdsZUV2ZW50X2NhbGxiYWNrKTsKfQpmdW5jdGlvbiBjYW5jZWxTaW5nbGVFdmVudF9jYWxsYmFjaygpCnsKZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLHNldFBhcnRpY2lwYXRlZCk7Cn0KfQoKJHNjb3BlLnNldFBhcnRpY2lwYXRpb25TdGF0dXMgPSBmdW5jdGlvbigpCnsKc2V0RXZlbnRVc2VyUGFydGljaXBhdGlvblN0YXR1cygkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRVc2Vyc1swXS5idXNpbmVzc191c2VyX2lkLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRVc2Vyc1swXS5ldmVudF91c2VyX3N0YXR1c19pZCxzZXRQYXJ0aWNpcGF0aW9uU3RhdHVzX2NhbGxiYWNrLCBzZXRQYXJ0aWNpcGF0aW9uU3RhdHVzX2NhbGxiYWNrKTsKJHNjb3BlLnVwZGF0ZVN0YXR1c0FsZXJ0TWVzc2FnZT0i157XoteT15vXnyDXodeY15jXldehLi4uIjsKZnVuY3Rpb24gc2V0UGFydGljaXBhdGlvblN0YXR1c19jYWxsYmFjaygpCnsKLy8gZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLHNldFBhcnRpY2lwYXRlZCk7CnNldFBhcnRpY2lwYXRlZCgpOwokc2NvcGUudXBkYXRlU3RhdHVzQWxlcnRNZXNzYWdlPSLXoteV15PXm9efINeR15TXptec15fXlCEiOwokdGltZW91dChmdW5jdGlvbigpCnsKJHNjb3BlLnVwZGF0ZVN0YXR1c0FsZXJ0TWVzc2FnZT1udWxsOwp9LCAyNTAwKTsKfQp9CgpmdW5jdGlvbiBzZXRQYXJ0aWNpcGF0ZWQoKQp7CmxvZ0RlYnVnKCJnZXQgY2xpZW50IGluZm8iKTsKZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Q2xpZW50cycsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudFVzZXJzWzBdLmJ1c2luZXNzX3VzZXJfaWQpOwpsb2dEZWJ1Zygic2V0dGluZyBzZXRQYXJ0aWNpcGF0ZWQiKTsKaWYgKCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRVc2Vyc1swXS5zdGF0dXNfbmFtZSE9JGdVc2VyX3N0YXR1c19hYnNlbnRlZCkKewokc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50VXNlcnNbMF0ucGFydGljaXBhdGVkPXRydWU7Cn0KZWxzZQp7CiRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRVc2Vyc1swXS5wYXJ0aWNpcGF0ZWQ9ZmFsc2U7Cn0KCi8vIHRoaXMgbG9vcCBpcyBmb3IgZml4aW5nIHRoZSBkYXRlIGZvcm1hdCB0byBhcHBlYXIgcHJvcGVybHkgaW4gdGhlIGlucHV0IGRhdGUgaHRtbCBvYmplY3QKZm9yIChpID0gMDsgaTwgKCRzY29wZS5jdXJyZW50RXZlbnQuZXh0cmFGaWVsZHMpLmxlbmd0aDsgaSsrKQp7CmxvZ0RlYnVnKCRzY29wZS5jdXJyZW50RXZlbnQuZXh0cmFGaWVsZHNbaV0pOwppZiAoJHNjb3BlLmN1cnJlbnRFdmVudC5leHRyYUZpZWxkc1tpXS5maWVsZF9kYXRhdHlwZT09IkRBVEUiKQp7Ci8vIGxvZ0RlYnVnKCJkYXRlIik7CiRzY29wZS5jdXJyZW50RXZlbnQuZXh0cmFGaWVsZHNbaV0uZmllbGRfdmFsdWU9bmV3IERhdGUoJHNjb3BlLmN1cnJlbnRFdmVudC5leHRyYUZpZWxkc1tpXS5maWVsZF92YWx1ZSk7Cn0KfQoKbG9nRGVidWcoIiRzY29wZS5jdXJyZW50RXZlbnQuaW5zdHJ1Y3Rvcl9pZDs9Iiskc2NvcGUuY3VycmVudEV2ZW50Lmluc3RydWN0b3JfaWQpOwpmb3IodmFyIGkgPSAwOyBpIDwgJHNjb3BlLmluc3RydWN0b3JzLmxlbmd0aDsgaSsrKQp7CmxvZ0RlYnVnKCRzY29wZS5pbnN0cnVjdG9yc1tpXS5pc19hY3RpdmUpOwppZiAoJHNjb3BlLmluc3RydWN0b3JzW2ldLmJ1c2luZXNzX3VzZXJfaWQ9PSRzY29wZS5jdXJyZW50RXZlbnQuaW5zdHJ1Y3Rvcl9pZCkKewpsb2dEZWJ1ZygieWVzaCIpOwokc2NvcGUuaW5zdHJ1Y3RvcnNbaV0uaXNfYWN0aXZlPTE7Cn0KfQp9Cgokc2NvcGUudXBkYXRlVXNlckV2ZW50UHJpY2UgPSBmdW5jdGlvbihuZXd2YWx1ZSwgdGhlZXZlbnQpCnsKbmV3X3ByaWNlPW5ld3ZhbHVlOwpzZXRDbGllbnRFdmVudFByaWNlKCRodHRwLCRzY29wZSwkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50VXNlcnNbMF0uYnVzaW5lc3NfdXNlcl9pZCx0aGVldmVudC5ldmVudF9pZCwgbmV3X3ByaWNlLHNldENsaWVudEV2ZW50UHJpY2VfY2FsbGJhY2ssIHNldENsaWVudEV2ZW50UHJpY2VfY2FsbGJhY2spOwpmdW5jdGlvbiBzZXRDbGllbnRFdmVudFByaWNlX2NhbGxiYWNrKCkKewpnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkcm91dGVQYXJhbXMuZXZlbnRfaWQsc2V0UGFydGljaXBhdGVkKTsKfQp9OwoKJHNjb3BlLiRvbigiZXZlbnRQYWdlUmVsb2FkRGF0YSIsZnVuY3Rpb24oZSxhKQp7CmdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCxzZXRQYXJ0aWNpcGF0ZWQpOwp9KTsKCgoKCiRzY29wZS5jbG9zZUV2ZW50ID0gZnVuY3Rpb24oKQp7CmxvZ0RlYnVnKCJjaGVja2luZyBpZiBldmVudCBoYXMgZXh0cmEgZmllbGRzIHRoYXQgYXJlIHJlcXVpcmVkIGJlZm9yZSBjbG9zaW5nIGl0Iik7CmNoZWNrRXZlbnRFeHRyYUZpZWxkcygkaHR0cCwkc2NvcGUsJ2NoZWNrRXZlbnRFeHRyYUZpZWxkcycsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLGNoZWNrRXZlbnRFeHRyYUZpZWxkc19zdWNjZXNzKTsKZnVuY3Rpb24gY2hlY2tFdmVudEV4dHJhRmllbGRzX3N1Y2Nlc3MoKQp7CmlmICgkc2NvcGUuY2hlY2tFdmVudEV4dHJhRmllbGRzPT10cnVlKQp7CmxvZ0RlYnVnKCJldmVudCBoYXMgYWxsIGV4dHJhIGZpZWxkcyBvaywgY2xvc2luZyBldmVudCIpOwovLyAkc2NvcGUuY3VycmVudEV2ZW50Lmlnbm9yZUV4dHJhRmllbGRzVmFsaWRhdGlvbj10cnVlOwpjbG9zZUV2ZW50KCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuZXZlbnRfaWQsJHNjb3BlLmN1cnJlbnRFdmVudCxhZnRlckNsb3NlRXZlbnQsYWZ0ZXJDbG9zZUV2ZW50KTsKZnVuY3Rpb24gYWZ0ZXJDbG9zZUV2ZW50KCkKewpnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkcm91dGVQYXJhbXMuZXZlbnRfaWQsc2V0UGFydGljaXBhdGVkKTsKfTsKfQplbHNlCnsKbG9nRGVidWcoImV2ZW50IGhhcyBleHRyYSBmaWVsZHMgcmVxdWlyZWQgdGhhdCBhcmUgbm90IGZpbGxlZCIpOwp2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKYW5pbWF0aW9uOiBmYWxzZSwKdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfZXZlbnRfY2xvc2VfaWdub3JlX21hbmRhdG9yeV9maWVsZHMucGhwJywKY29udHJvbGxlcjogJ2V2ZW50Q2xvc2VJZ25vcmVNYW5kYXRvcnlGaWVsZHNNb2RhbENvbnRyb2xsZXInLApzaXplOiAnbScsCnJlc29sdmU6IHsKY3VycmVudEV2ZW50OiBmdW5jdGlvbigpIHsKcmV0dXJuICRzY29wZS5jdXJyZW50RXZlbnQ7Cn0KfQp9KTsKfQp9Cn0KJHNjb3BlLnJlb3BlbkV2ZW50ID0gZnVuY3Rpb24oKQp7CmxvZ0RlYnVnKCJyZW9wZW5FdmVudCIpOwpyZW9wZW5FdmVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCwkc2NvcGUuY3VycmVudEV2ZW50LGFmdGVyUmVvcGVuRXZlbnQsYWZ0ZXJSZW9wZW5FdmVudCk7CmZ1bmN0aW9uIGFmdGVyUmVvcGVuRXZlbnQoKQp7CmdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQsc2V0UGFydGljaXBhdGVkKTsKfTsKfQoKfSk7CgprdXplQXBwLmZpbHRlcignc3RhcnRGcm9tJywgZnVuY3Rpb24oKQp7CnJldHVybiBmdW5jdGlvbihpbnB1dCwgc3RhcnQpCnsKaWYoIWlucHV0KSByZXR1cm4gW107Ci8vIGNvbnNvbGUubG9nKCJoZXJlcmVlZSAiK2lucHV0KTsKc3RhcnQgPSArc3RhcnQ7IC8vcGFyc2UgdG8gaW50CnJldHVybiBpbnB1dC5zbGljZShzdGFydCk7Cn0KfSk7Ci8vIGFuZ3VsYXIgZmlsdGVyIGZvciBldmVudHMgYmVmb3JlL2FmdGVyIHRvZGF5Cmt1emVBcHAuZmlsdGVyKCdiZWZvcmVOb3cnLCBmdW5jdGlvbigpIHsKLy8gQ3JlYXRlIHRoZSByZXR1cm4gZnVuY3Rpb24gYW5kIHNldCB0aGUgcmVxdWlyZWQgcGFyYW1ldGVyIG5hbWUgdG8gKippbnB1dCoqCnJldHVybiBmdW5jdGlvbihpbnB1dCkgewp2YXIgb3V0ID0gW107CgovLyBVc2luZyB0aGUgYW5ndWxhci5mb3JFYWNoIG1ldGhvZCwgZ28gdGhyb3VnaCB0aGUgYXJyYXkgb2YgZGF0YSBhbmQgcGVyZm9ybSB0aGUgb3BlcmF0aW9uIG9mIGZpZ3VyaW5nIG91dCBpZiB0aGUgbGFuZ3VhZ2UgaXMgc3RhdGljYWxseSBvciBkeW5hbWljYWxseSB0eXBlZC4KdmFyIGJyb3dzZXJfZXBvY2ggPSAobmV3IERhdGUpLmdldFRpbWUoKTsKCmFuZ3VsYXIuZm9yRWFjaChpbnB1dCwgZnVuY3Rpb24oZXZlbnQpCnsKLy8gIGxvZ0RlYnVnKCJmaWx0ZXJpbmcsIGV2ZW50LmV2ZW50X3VzZXJfc3RhdHVzX2lkPSIrZXZlbnQuZXZlbnRfdXNlcl9zdGF0dXNfaWQpOwppZiAoZXZlbnQuc3RhcnRfZXBvY2ggPD0gKGJyb3dzZXJfZXBvY2gvMTAwMCkpCnsKb3V0LnB1c2goZXZlbnQpCn0KfSkKcmV0dXJuIG91dDsKfQp9KTsKa3V6ZUFwcC5maWx0ZXIoJ2FmdGVyTm93JywgZnVuY3Rpb24oKSB7Ci8vIENyZWF0ZSB0aGUgcmV0dXJuIGZ1bmN0aW9uIGFuZCBzZXQgdGhlIHJlcXVpcmVkIHBhcmFtZXRlciBuYW1lIHRvICoqaW5wdXQqKgpyZXR1cm4gZnVuY3Rpb24oaW5wdXQpIHsKdmFyIG91dCA9IFtdOwoKLy8gVXNpbmcgdGhlIGFuZ3VsYXIuZm9yRWFjaCBtZXRob2QsIGdvIHRocm91Z2ggdGhlIGFycmF5IG9mIGRhdGEgYW5kIHBlcmZvcm0gdGhlIG9wZXJhdGlvbiBvZiBmaWd1cmluZyBvdXQgaWYgdGhlIGxhbmd1YWdlIGlzIHN0YXRpY2FsbHkgb3IgZHluYW1pY2FsbHkgdHlwZWQuCnZhciBicm93c2VyX2Vwb2NoID0gKG5ldyBEYXRlKS5nZXRUaW1lKCk7Cgphbmd1bGFyLmZvckVhY2goaW5wdXQsIGZ1bmN0aW9uKGV2ZW50KQp7Ci8vICBsb2dEZWJ1ZygiZmlsdGVyaW5nLCBldmVudC5ldmVudF91c2VyX3N0YXR1c19pZD0iK2V2ZW50LmV2ZW50X3VzZXJfc3RhdHVzX2lkKTsKaWYgKGV2ZW50LnN0YXJ0X2Vwb2NoID4gKGJyb3dzZXJfZXBvY2gvMTAwMCkpCnsKb3V0LnB1c2goZXZlbnQpCn0KfSkKcmV0dXJuIG91dDsKfQp9KTsKCmt1emVBcHAuZmlsdGVyKCdpc0FjdGl2ZScsIGZ1bmN0aW9uKCkgewovLyBDcmVhdGUgdGhlIHJldHVybiBmdW5jdGlvbiBhbmQgc2V0IHRoZSByZXF1aXJlZCBwYXJhbWV0ZXIgbmFtZSB0byAqKmlucHV0KioKcmV0dXJuIGZ1bmN0aW9uKGlucHV0KSB7CnZhciBvdXQgPSBbXTsKCi8vIFVzaW5nIHRoZSBhbmd1bGFyLmZvckVhY2ggbWV0aG9kLCBnbyB0aHJvdWdoIHRoZSBhcnJheSBvZiBkYXRhIGFuZCBwZXJmb3JtIHRoZSBvcGVyYXRpb24gb2YgZmlndXJpbmcgb3V0IGlmIHRoZSBsYW5ndWFnZSBpcyBzdGF0aWNhbGx5IG9yIGR5bmFtaWNhbGx5IHR5cGVkLgoKYW5ndWxhci5mb3JFYWNoKGlucHV0LCBmdW5jdGlvbihldmVudCkKewovLyAgbG9nRGVidWcoImZpbHRlcmluZywgZXZlbnQuZXZlbnRfdXNlcl9zdGF0dXNfaWQ9IitldmVudC5ldmVudF91c2VyX3N0YXR1c19pZCk7CmlmIChldmVudC5pc19hY3RpdmU9PTEpCnsKb3V0LnB1c2goZXZlbnQpCn0KfSkKcmV0dXJuIG91dDsKfQp9KTsKCmt1emVBcHAuZmlsdGVyKCdzaG91bGRfYmVfZGlzcGxheWVkJywgZnVuY3Rpb24oKSB7Ci8vIENyZWF0ZSB0aGUgcmV0dXJuIGZ1bmN0aW9uIGFuZCBzZXQgdGhlIHJlcXVpcmVkIHBhcmFtZXRlciBuYW1lIHRvICoqaW5wdXQqKgpyZXR1cm4gZnVuY3Rpb24oaW5wdXQpIHsKdmFyIG91dCA9IFtdOwoKLy8gVXNpbmcgdGhlIGFuZ3VsYXIuZm9yRWFjaCBtZXRob2QsIGdvIHRocm91Z2ggdGhlIGFycmF5IG9mIGRhdGEgYW5kIHBlcmZvcm0gdGhlIG9wZXJhdGlvbiBvZiBmaWd1cmluZyBvdXQgaWYgdGhlIGxhbmd1YWdlIGlzIHN0YXRpY2FsbHkgb3IgZHluYW1pY2FsbHkgdHlwZWQuCgphbmd1bGFyLmZvckVhY2goaW5wdXQsIGZ1bmN0aW9uKGV2ZW50KQp7Ci8vICBsb2dEZWJ1ZygiZmlsdGVyaW5nLCBldmVudC5ldmVudF91c2VyX3N0YXR1c19pZD0iK2V2ZW50LmV2ZW50X3VzZXJfc3RhdHVzX2lkKTsKaWYgKGV2ZW50LnNob3VsZF9iZV9kaXNwbGF5ZWQ9PTEpCnsKb3V0LnB1c2goZXZlbnQpCn0KfSkKcmV0dXJuIG91dDsKfQp9KTsKCmt1emVBcHAuY29udHJvbGxlcignSW5zdHJ1Y3RvclNob3cxQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHRpbWVvdXQsICRodHRwLCBzaGFyZWRQcm9wZXJ0aWVzLCAkcm9vdFNjb3BlLCAkcm91dGVQYXJhbXMsICRsb2NhdGlvbiwgJHJvdXRlLCBzaGFyZWREYXRhLCAkdWliTW9kYWwpCnsKZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLGdldEJ1c2luZXNzQ2xpZW50SW5mb19zdWNjZXNzKTsKICBnZXRzZWN1cml0eVByb2ZpbGVzKCRodHRwLCRzY29wZSwnc2VjX3Byb2ZpbGVzJyk7CgpmdW5jdGlvbiBnZXRCdXNpbmVzc0NsaWVudEluZm9fc3VjY2VzcygpCnsKZ2V0Q2xpZW50RXh0cmFGaWVsZHMoJGh0dHAsJHNjb3BlLCRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5idXNpbmVzc191c2VyX2lkLCdjbGllbnRFeHRyYUZpZWxkcycsZ2V0Q2xpZW50RXh0cmFGaWVsZHNfc3VjY2Vzcyk7CgpmdW5jdGlvbiBnZXRDbGllbnRFeHRyYUZpZWxkc19zdWNjZXNzKCkKewpmb3IgKGkgPSAwOyBpPCAoJHNjb3BlLmNsaWVudEV4dHJhRmllbGRzKS5sZW5ndGg7IGkrKykKewpsb2dEZWJ1Zygkc2NvcGUuY2xpZW50RXh0cmFGaWVsZHNbaV0pOwppZiAoJHNjb3BlLmNsaWVudEV4dHJhRmllbGRzW2ldLmZpZWxkX2RhdGF0eXBlPT0iREFURSIpCnsKLy8gbG9nRGVidWcoImRhdGUiKTsKJHNjb3BlLmNsaWVudEV4dHJhRmllbGRzW2ldLmZpZWxkX3ZhbHVlPW5ldyBEYXRlKCRzY29wZS5jbGllbnRFeHRyYUZpZWxkc1tpXS5maWVsZF92YWx1ZSk7Cn0KfQp9Cn0KCiAgJHNjb3BlLnVwZGF0ZV9zZWNfcHJvZmlsZSA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1ZygidXBkYXRlX3NlY19wcm9maWxlIGZvciBidWlkPSIrJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLmJ1c2luZXNzX3VzZXJfaWQrICIsIHByb2ZpbGVfaWQiKyRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5zZWNfcHJvZmlsZV9pZCk7CiAgICB1cGRhdGVfc2VjX3Byb2ZpbGUoJGh0dHAsJHNjb3BlLCRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5idXNpbmVzc191c2VyX2lkLCRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5zZWNfcHJvZmlsZV9pZCx1cGRhdGVfc2VjX3Byb2ZpbGVfc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiB1cGRhdGVfc2VjX3Byb2ZpbGVfc3VjY2VzcygpCiAgICB7CiAgICAgIGdldHNlY3VyaXR5UHJvZmlsZXMoJGh0dHAsJHNjb3BlLCdzZWNfcHJvZmlsZXMnKTsKICAgIH0KICB9CiRzY29wZS5hcmNoaXZlQ2xpZW50TW9kYWwgPSBmdW5jdGlvbigpCnsKLy8gYXJjaGl2ZS9kZWxldGUgY2xpZW50IC0gYXNrIGlmIHN1cmUKdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CmFuaW1hdGlvbjogZmFsc2UsCnRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2FyY2hpdmVfY2xpZW50X21vZGFsLnBocCcsCnNpemU6ICd4cycsCmNvbnRyb2xsZXI6ICdhcmNoaXZlX2NsaWVudF9tb2RhbCcsICAvLyAncGF5bWVueURldGFpbHNNb2RhbENvbnRyb2xsZXInLApyZXNvbHZlOiB7CmJ1c2luZXNzX3VzZXJfaWQ6IGZ1bmN0aW9uKCkgewpyZXR1cm4gJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLmJ1c2luZXNzX3VzZXJfaWQ7Cn0sCmJ1c2VyX2xhc3RfbmFtZTogZnVuY3Rpb24oKSB7CnJldHVybiAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYnVzZXJfbGFzdF9uYW1lOwp9LApidXNlcl9maXJzdF9uYW1lOiBmdW5jdGlvbigpIHsKcmV0dXJuICRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5idXNlcl9maXJzdF9uYW1lOwp9LAppc19pbnN0cnVjdG9yOiBmdW5jdGlvbigpIHsKcmV0dXJuIHRydWU7Cn0KfQp9KTsKfQoKJHNjb3BlLnVwZGF0ZVVzZXJGaXJzdE5hbWUgPSBmdW5jdGlvbihuZXdWYWx1ZSkKewpzZXRDbGllbnRGaXJzdE5hbWUoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLG5ld1ZhbHVlLGFmdGVyQ2xpZW50U2V0LGFmdGVyQ2xpZW50U2V0KTsKZnVuY3Rpb24gYWZ0ZXJDbGllbnRTZXQoKQp7CmdldEJ1c2luZXNzQ2xpZW50SW5mbygkaHR0cCwkc2NvcGUsJ2Zvcm1VcGRhdGVDbGllbnRBbmd1bGFyJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7Cn0KfQokc2NvcGUudXBkYXRlVXNlckxhc3ROYW1lID0gZnVuY3Rpb24obmV3VmFsdWUpCnsKc2V0Q2xpZW50TGFzdE5hbWUoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLG5ld1ZhbHVlLGFmdGVyQ2xpZW50U2V0LGFmdGVyQ2xpZW50U2V0KTsKZnVuY3Rpb24gYWZ0ZXJDbGllbnRTZXQoKQp7CmdldEJ1c2luZXNzQ2xpZW50SW5mbygkaHR0cCwkc2NvcGUsJ2Zvcm1VcGRhdGVDbGllbnRBbmd1bGFyJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7Cn0KfQokc2NvcGUudXBkYXRlVXNlclBob25lTnVtYmVyID0gZnVuY3Rpb24obmV3VmFsdWUpCnsKbmV3VmFsdWUgPSBuZXdWYWx1ZS5yZXBsYWNlKCctJywnJyk7CmlmIChpc05hTihuZXdWYWx1ZSkpCnsKYWxlcnQoIteQ16DXkCDXlNeW158g157Xodek16gg15jXnNek15XXnyDXqten15nXnyIpOwpnZXRCdXNpbmVzc0NsaWVudEluZm8oJGh0dHAsJHNjb3BlLCdmb3JtVXBkYXRlQ2xpZW50QW5ndWxhcicsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwp9CmVsc2UKewpzZXRDbGllbnRQaG9uZU51bWJlcigkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsbmV3VmFsdWUsc2V0Q2xpZW50UGhvbmVOdW1iZXJfY2FsbGJhY2ssc2V0Q2xpZW50UGhvbmVOdW1iZXJfY2FsbGJhY2spOwpmdW5jdGlvbiBzZXRDbGllbnRQaG9uZU51bWJlcl9jYWxsYmFjaygpCnsKZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKfQp9Cn0KCn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignQ2xpZW50c1Nob3cxQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHRpbWVvdXQsICRodHRwLCBzaGFyZWRQcm9wZXJ0aWVzLCAkcm9vdFNjb3BlLCAkcm91dGVQYXJhbXMsICRsb2NhdGlvbiwgJHJvdXRlLCBzaGFyZWREYXRhLCAkdWliTW9kYWwpCnsKZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLGdldEJ1c2luZXNzQ2xpZW50SW5mb19zdWNjZXNzKTsKCmZ1bmN0aW9uIGdldEJ1c2luZXNzQ2xpZW50SW5mb19zdWNjZXNzKCkKewpnZXRDbGllbnRFeHRyYUZpZWxkcygkaHR0cCwkc2NvcGUsJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLmJ1c2luZXNzX3VzZXJfaWQsJ2NsaWVudEV4dHJhRmllbGRzJyxnZXRDbGllbnRFeHRyYUZpZWxkc19zdWNjZXNzKTsKCmZ1bmN0aW9uIGdldENsaWVudEV4dHJhRmllbGRzX3N1Y2Nlc3MoKQp7CmZvciAoaSA9IDA7IGk8ICgkc2NvcGUuY2xpZW50RXh0cmFGaWVsZHMpLmxlbmd0aDsgaSsrKQp7CmxvZ0RlYnVnKCRzY29wZS5jbGllbnRFeHRyYUZpZWxkc1tpXSk7CmlmICgkc2NvcGUuY2xpZW50RXh0cmFGaWVsZHNbaV0uZmllbGRfZGF0YXR5cGU9PSJEQVRFIikKewovLyBsb2dEZWJ1ZygiZGF0ZSIpOwokc2NvcGUuY2xpZW50RXh0cmFGaWVsZHNbaV0uZmllbGRfdmFsdWU9bmV3IERhdGUoJHNjb3BlLmNsaWVudEV4dHJhRmllbGRzW2ldLmZpZWxkX3ZhbHVlKTsKfQp9Cn0KfQp7CmdldENsaWVudEV2ZW50cygkaHR0cCwkc2NvcGUsJ2N1cnJlbnRDbGllbnRFdmVudHMnLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKCmdldENsaWVudFBheW1lbnRzKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCwnY3VycmVudENsaWVudFBheW1lbnRzJyk7Cgokc2NvcGUuYXJjaGl2ZUNsaWVudE1vZGFsID0gZnVuY3Rpb24oKQp7Ci8vIGFyY2hpdmUvZGVsZXRlIGNsaWVudCAtIGFzayBpZiBzdXJlCnZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewphbmltYXRpb246IGZhbHNlLAp0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdhcmNoaXZlX2NsaWVudF9tb2RhbC5waHAnLApzaXplOiAneHMnLApjb250cm9sbGVyOiAnYXJjaGl2ZV9jbGllbnRfbW9kYWwnLCAgLy8gJ3BheW1lbnlEZXRhaWxzTW9kYWxDb250cm9sbGVyJywKcmVzb2x2ZTogewpidXNpbmVzc191c2VyX2lkOiBmdW5jdGlvbigpIHsKcmV0dXJuICRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5idXNpbmVzc191c2VyX2lkOwp9LApidXNlcl9sYXN0X25hbWU6IGZ1bmN0aW9uKCkgewpyZXR1cm4gJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLmJ1c2VyX2xhc3RfbmFtZTsKfSwKYnVzZXJfZmlyc3RfbmFtZTogZnVuY3Rpb24oKSB7CnJldHVybiAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYnVzZXJfZmlyc3RfbmFtZTsKfSwKaXNfaW5zdHJ1Y3RvcjogZnVuY3Rpb24oKSB7CnJldHVybiBmYWxzZTsKfQp9Cn0pOwp9CiRzY29wZS5wYWNrYWdlRGVsZXRlID0gZnVuY3Rpb24ocGFja2FnZSkKewpsb2dEZWJ1ZygicGFja2FnZSBkZWxldGUgIitKU09OLnN0cmluZ2lmeShwYWNrYWdlKSk7CmRlbGV0ZVBhY2thZ2UoJGh0dHAsJHNjb3BlLHBhY2thZ2UucGFja2FnZV91c2VyX2lkLCRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5idXNpbmVzc191c2VyX2lkLHN1Y2Nlc3NfY2FsbGJhY2ssIHN1Y2Nlc3NfY2FsbGJhY2spOwpmdW5jdGlvbiBzdWNjZXNzX2NhbGxiYWNrKCkKewokcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NsaWVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCn0KfQoKJHNjb3BlLnVwZGF0ZUNsaWVudEV4dHJhRmllbGRzID0gZnVuY3Rpb24oKQp7CiAgICAgIGxvZ0RlYnVnKCJ1cGRhdGVDbGllbnRFeHRyYUZpZWxkcyIpOwp0aGVkYXRhID0gewpleHRyYUZpZWxkczokc2NvcGUuY2xpZW50RXh0cmFGaWVsZHMKfTsKICAgICAgJHNjb3BlLmV4dHJhRmllbGRzQWxlcnRNZXNzYWdlPSLXqdeV157XqC4uLiI7CiAgICAgIHVwZGF0ZUNsaWVudEV4dHJhRmllbGRzKCRodHRwLCRzY29wZSwkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYnVzaW5lc3NfdXNlcl9pZCx0aGVkYXRhLHVwZGF0ZUV2ZW50Q2xpZW50RmllbGRzX2NhbGxiYWNrLCB1cGRhdGVFdmVudENsaWVudEZpZWxkc19jYWxsYmFjayk7CgogICAgICBmdW5jdGlvbiB1cGRhdGVFdmVudENsaWVudEZpZWxkc19jYWxsYmFjaygpCnsKLy8gZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLHNldFBhcnRpY2lwYXRlZCk7CiAgICAgICAgJHNjb3BlLmV4dHJhRmllbGRzQWxlcnRNZXNzYWdlPSLXoNep157XqCEiOwokdGltZW91dChmdW5jdGlvbigpCnsKJHNjb3BlLmV4dHJhRmllbGRzQWxlcnRNZXNzYWdlPW51bGw7Cn0sIDMwMDApOwp9Cn07Cgokc2NvcGUuc2NoZWR1bGVFdmVudEZvckNsaWVudCA9IGZ1bmN0aW9uKCkKewpsb2dEZWJ1Zygic2VldGluZyBzaGFyZSBwcm9wZXJ0eSB1c2VyX2lkICIrJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdKTsKc2hhcmVkUHJvcGVydGllcy5zZXRfc2VsZWN0ZWRfdXNlcigkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0pOwokbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2NhbGVuZGFyJyk7Cn0KJHNjb3BlLmludm9pY2VHZW5lcmF0ZUNoZWNrYm94ID0gZnVuY3Rpb24oZnBheW1lbnQpCnsKbG9nRGVidWcoImludm9pY2VHZW5lcmF0ZUNoZWNrYm94IGZvciAiK0pTT04uc3RyaW5naWZ5KGZwYXltZW50KSk7CnNldENsaWVudFBheW1lbnRJbnZvaWNlR2VuZXJhdGVkKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCxmcGF5bWVudC51c2VyX3BheW1lbnRfaWQsZnBheW1lbnQuaW52b2ljZV9nZW5lcmF0ZWQsc2V0Q2xpZW50UGF5bWVudEludm9pY2VHZW5lcmF0ZWRfY2FsbGJhY2ssIHNldENsaWVudFBheW1lbnRJbnZvaWNlR2VuZXJhdGVkX2NhbGxiYWNrKTsKZnVuY3Rpb24gc2V0Q2xpZW50UGF5bWVudEludm9pY2VHZW5lcmF0ZWRfY2FsbGJhY2soKQp7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKfQp9OwoKJHNjb3BlLnJlY2FsY1VzZXJCYWxhbmNlID0gZnVuY3Rpb24oKQp7CmxvZ0RlYnVnKCJyZWNhbGNVc2VyQmFsYW5jZSIpOwpyZWNhbGNVc2VyQmFsYW5jZSgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsIHJlY2FsY1VzZXJCYWxhbmNlX2NhbGxiYWNrKTsKZnVuY3Rpb24gcmVjYWxjVXNlckJhbGFuY2VfY2FsbGJhY2soKQp7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKfSAgICB9CiRzY29wZS51cGRhdGVFdmVudFBhY2thZ2VSZWZlcmVuY2UgPSBmdW5jdGlvbih1c2VyX2lkLCBmbWVldGluZykKewpsb2dEZWJ1ZygidXBkYXRlRXZlbnRQYWNrYWdlUmVmZXJlbmNlLCB1c2VyPSIrdXNlcl9pZCsiLCBmbWVldGluZz0iK0pTT04uc3RyaW5naWZ5KGZtZWV0aW5nKSk7CnZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewphbmltYXRpb246IGZhbHNlLAp0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9jbGllbnRfZXZlbnRfcGFja2FnZV9hc3NvY2lhdGlvbi5waHAnLApzaXplOiAneHMnLApjb250cm9sbGVyOiAnZXZlbnRQYWNrYWdlQXNzb2NpYXRpb25Nb2RhbENvbnRyb2xsZXInLCAgLy8gJ3BheW1lbnlEZXRhaWxzTW9kYWxDb250cm9sbGVyJywKcmVzb2x2ZTogewpmbWVldGluZzogZnVuY3Rpb24oKSB7CnJldHVybiBmbWVldGluZzsKfSwKYmFsYW5jZTogZnVuY3Rpb24oKSB7CnJldHVybiAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYmFsYW5jZTsKfSwKYnVzaW5lc3NfdXNlcl9pZDogZnVuY3Rpb24oKSB7CnJldHVybiAkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZDsKfQp9Cn0pOwp9OwoKJHNjb3BlLnVwZGF0ZVBhY2thZ2VQYXltZW50UmVmZXJlbmNlID0gZnVuY3Rpb24odXNlcl9pZCwgZnBhY2thZ2UpCnsKbG9nRGVidWcoInVwZGF0ZVBhY2thZ2VQYXltZW50UmVmZXJlbmNlLCB1c2VyPSIrdXNlcl9pZCsiLCBmcGFja2FnZT0iK0pTT04uc3RyaW5naWZ5KGZwYWNrYWdlKSk7CnZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewphbmltYXRpb246IGZhbHNlLAp0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9jbGllbnRfcGFja2FnZV9wYXltZW50X2Fzc29jaWF0aW9uLnBocCcsCnNpemU6ICd4cycsCmNvbnRyb2xsZXI6ICdwYWNrYWdlUGF5bWVudEFzc29jaWF0aW9uTW9kYWxDb250cm9sbGVyJywgIC8vICdwYXltZW55RGV0YWlsc01vZGFsQ29udHJvbGxlcicsCnJlc29sdmU6IHsKZnBhY2thZ2U6IGZ1bmN0aW9uKCkgewpyZXR1cm4gZnBhY2thZ2U7Cn0sCmJhbGFuY2U6IGZ1bmN0aW9uKCkgewpyZXR1cm4gJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLmJhbGFuY2U7Cn0sCmJ1c2luZXNzX3VzZXJfaWQ6IGZ1bmN0aW9uKCkgewpyZXR1cm4gJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQ7Cn0KfQp9KTsKfTsKCi8vIHNob3cgcGF5bWVudCBwb3B1cAokc2NvcGUuc2hvd1BheW1lbnREZXRhaWxzID0gZnVuY3Rpb24oZnBheW1lbnQpCnsKbG9nRGVidWcoInNob3dQYXltZW50RGV0YWlscyIpOwp2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKYW5pbWF0aW9uOiBmYWxzZSwKdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfY2xpZW50X3BheW1lbnRfZGV0YWlscy5waHAnLApzaXplOiAneHMnLApjb250cm9sbGVyOiAncGF5bWVueURldGFpbHNNb2RhbENvbnRyb2xsZXInLApyZXNvbHZlOiB7CmZwYXltZW50OiBmdW5jdGlvbigpIHsKcmV0dXJuIGZwYXltZW50Owp9Cn0KfSk7Cn0KJHNjb3BlLmludm9pY2VOdW1iZXJDaGFuZ2VkID0gZnVuY3Rpb24obmV3X2ludm9pY2VfbnVtYmVyLGZwYXltZW50KQp7CmxvZ0RlYnVnKCJpbnZvaWNlTnVtYmVyQ2hhbmdlZCAiKyBuZXdfaW52b2ljZV9udW1iZXIgKyJmb3IgIitKU09OLnN0cmluZ2lmeShmcGF5bWVudCkpOwpzZXRDbGllbnRQYXltZW50SW52b2ljZU51bWJlcigkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsZnBheW1lbnQudXNlcl9wYXltZW50X2lkLG5ld19pbnZvaWNlX251bWJlcixzZXRDbGllbnRQYXltZW50SW52b2ljZU51bWJlcl9jYWxsYmFjaywgc2V0Q2xpZW50UGF5bWVudEludm9pY2VOdW1iZXJfY2FsbGJhY2spOwpmdW5jdGlvbiBzZXRDbGllbnRQYXltZW50SW52b2ljZU51bWJlcl9jYWxsYmFjaygpCnsKLy8gJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwp9Cn07Cgokc2NvcGUuJG9uKCJjbGllbnRQYWdlUmVsb2FkRGF0YSIsZnVuY3Rpb24oZSxhKQp7CmxvZ0RlYnVnKCJjbGllbnRQYWdlUmVsb2FkRGF0YSIpOwpnZXRCdXNpbmVzc1VzZXJQYWNrYWdlcygkaHR0cCwkc2NvcGUsJ3VzZXJfcGFja2FnZXMnLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKZ2V0Q2xpZW50UGF5bWVudHMoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLCdjdXJyZW50Q2xpZW50UGF5bWVudHMnKTsKZ2V0Q2xpZW50RXZlbnRzKCRodHRwLCRzY29wZSwnY3VycmVudENsaWVudEV2ZW50cycsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwpnZXRCdXNpbmVzc0NsaWVudEluZm8oJGh0dHAsJHNjb3BlLCdmb3JtVXBkYXRlQ2xpZW50QW5ndWxhcicsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwoKICAgICAgLy8gJHRpbWVvdXQoZnVuY3Rpb24oKQogICAgICAvLyB7CiAgICAgIC8vICAgJHNjb3BlLmN1cnNvcmRlbGV0ZT0iIjsKICAgICAgLy8gICBkb2N1bWVudC5ib2R5LnN0eWxlLmN1cnNvcj0nJzsKICAgICAgLy8gfSwgMjAwMCk7Cgp9KTsKCiRzY29wZS5pc0NvbmZpcm1lZE9yQ2xvc2VkID0gZnVuY3Rpb24oZXZlbnQpCnsKaWYgKCRzY29wZS5zaG93QWxsRXZlbnRzKQp7CnJldHVybiB0cnVlOwp9CgppZiAoKGV2ZW50LmlzX2NvbmZpcm1lZCA9PSAxKSB8fCAoZXZlbnQuaXNfZmluYWxfc3RhdHVzID09IDEpIHx8ICgoZXZlbnQuaXNfd2FpdGluZ19saXN0ID09IDEpICYmIChldmVudC5pc19jYW5jZWxlZCA9PSAwKSkpCnsKcmV0dXJuIHRydWU7Cn0KZWxzZQp7CnJldHVybiBmYWxzZTsKfQp9CiRzY29wZS5nb3RvQ2xpZW50RWRpdFBhZ2U9Z290b0NsaWVudEVkaXRQYWdlOwokc2NvcGUuZ290b0JhY2s9ZnVuY3Rpb24oKQp7CmxvZ0RlYnVnKCdnbyBiYWNrJyk7CndpbmRvdy5oaXN0b3J5LmJhY2soKTsKfTsKCiRzY29wZS5nb3RvRXZlbnRQYWdlID0gZnVuY3Rpb24gKHRoZWV2ZW50KQp7CmdvdG9FdmVudFBhZ2UodGhlZXZlbnQpOwp9Cn0KJHNjb3BlLmluaXRpYXRlUGF5bWVudCA9IGZ1bmN0aW9uKGlzcGx1cykKewpsb2dEZWJ1ZygiaW5pdGlhdGVQYXltZW50IGlzcGx1cyIraXNwbHVzKTsKdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CmFuaW1hdGlvbjogZmFsc2UsCnRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2NsaWVudF9wYXltZW50LnBocCcsCmNvbnRyb2xsZXI6ICdidXNpbmVzc0NsaWVuZENhcmRQYXltZW50JywKLy8gc2l6ZTogc2l6ZSwKcmVzb2x2ZTogewpjdXJyZW50Q2xpZW50OiBmdW5jdGlvbigpIHsKcmV0dXJuICRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXTsKfSwKaXNwbHVzOiBmdW5jdGlvbigpIHsKcmV0dXJuIGlzcGx1czsKfQp9Cn0pOwp9Cgokc2NvcGUudXBkYXRlVXNlckZpcnN0TmFtZSA9IGZ1bmN0aW9uKG5ld1ZhbHVlKQp7CnNldENsaWVudEZpcnN0TmFtZSgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsbmV3VmFsdWUsYWZ0ZXJDbGllbnRTZXQsYWZ0ZXJDbGllbnRTZXQpOwpmdW5jdGlvbiBhZnRlckNsaWVudFNldCgpCnsKZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKfQp9CiRzY29wZS51cGRhdGVVc2VyTGFzdE5hbWUgPSBmdW5jdGlvbihuZXdWYWx1ZSkKewpzZXRDbGllbnRMYXN0TmFtZSgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsbmV3VmFsdWUsYWZ0ZXJDbGllbnRTZXQsYWZ0ZXJDbGllbnRTZXQpOwpmdW5jdGlvbiBhZnRlckNsaWVudFNldCgpCnsKZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKfQp9CiRzY29wZS51cGRhdGVVc2VyRW1haWwgPSBmdW5jdGlvbihuZXdWYWx1ZSkKewpzZXRDbGllbnRFbWFpbCgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsbmV3VmFsdWUsYWZ0ZXJzZXRDbGllbnRFbWFpbCxhZnRlcnNldENsaWVudEVtYWlsKTsKZnVuY3Rpb24gYWZ0ZXJzZXRDbGllbnRFbWFpbCgpCnsKZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKfQp9CgoKJHNjb3BlLnVwZGF0ZVVzZXJQaG9uZU51bWJlciA9IGZ1bmN0aW9uKG5ld1ZhbHVlKQp7Cm5ld1ZhbHVlID0gbmV3VmFsdWUucmVwbGFjZSgnLScsJycpOwppZiAoaXNOYU4obmV3VmFsdWUpKQp7CmFsZXJ0KCLXkNeg15Ag15TXltefINee16HXpNeoINeY15zXpNeV158g16rXp9eZ158iKTsKZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKfQplbHNlCnsKc2V0Q2xpZW50UGhvbmVOdW1iZXIoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLG5ld1ZhbHVlLHNldENsaWVudFBob25lTnVtYmVyX2NhbGxiYWNrLHNldENsaWVudFBob25lTnVtYmVyX2NhbGxiYWNrKTsKZnVuY3Rpb24gc2V0Q2xpZW50UGhvbmVOdW1iZXJfY2FsbGJhY2soKQp7CmdldEJ1c2luZXNzQ2xpZW50SW5mbygkaHR0cCwkc2NvcGUsJ2Zvcm1VcGRhdGVDbGllbnRBbmd1bGFyJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7Cn0KfQp9CiRzY29wZS51cGRhdGVVc2VyRXZlbnRQcmljZSA9IGZ1bmN0aW9uKG5ld3ZhbHVlLCB0aGVldmVudCkKewpuZXdfcHJpY2U9bmV3dmFsdWU7CnNldENsaWVudEV2ZW50UHJpY2UoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLHRoZWV2ZW50LmV2ZW50X2lkLCBuZXdfcHJpY2Usc2V0Q2xpZW50RXZlbnRQcmljZV9jYWxsYmFjaywgc2V0Q2xpZW50RXZlbnRQcmljZV9jYWxsYmFjayk7CmZ1bmN0aW9uIHNldENsaWVudEV2ZW50UHJpY2VfY2FsbGJhY2soKQp7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKfQp9OwoKJHNjb3BlLnVwZGF0ZVVzZXJQYWNrYWdlRXZlbnRzQ291bnRlciA9IGZ1bmN0aW9uKG5ld3ZhbHVlLCB0aGVwYWNrYWdlKQp7CmV2ZW50c19jb3VudGVyPW5ld3ZhbHVlOwpzZXRVc2VyUGFja2FnZUV2ZW50c0NvdW50ZXIoJGh0dHAsJHNjb3BlLHRoZXBhY2thZ2UucGFja2FnZV91c2VyX2lkLGV2ZW50c19jb3VudGVyLHNldFVzZXJQYWNrYWdlRXZlbnRzQ291bnRlcl9jYWxsYmFjaywgc2V0VXNlclBhY2thZ2VFdmVudHNDb3VudGVyX2NhbGxiYWNrKQpmdW5jdGlvbiBzZXRVc2VyUGFja2FnZUV2ZW50c0NvdW50ZXJfY2FsbGJhY2soKQp7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKfQp9Owokc2NvcGUudXBkYXRlVXNlclBhY2thZ2VQYWNrYWdlUHJpY2UgPSBmdW5jdGlvbihuZXd2YWx1ZSwgdGhlcGFja2FnZSkKewpwYWNrYWdlX3ByaWNlPW5ld3ZhbHVlOwpzZXRVc2VyUGFja2FnZVBhY2thZ2VQcmljZSgkaHR0cCwkc2NvcGUsdGhlcGFja2FnZS5wYWNrYWdlX3VzZXJfaWQscGFja2FnZV9wcmljZSxzZXRVc2VyUGFja2FnZVBhY2thZ2VQcmljZV9jYWxsYmFjaywgc2V0VXNlclBhY2thZ2VQYWNrYWdlUHJpY2VfY2FsbGJhY2spCmZ1bmN0aW9uIHNldFVzZXJQYWNrYWdlUGFja2FnZVByaWNlX2NhbGxiYWNrKCkKewovLyBnZXRCdXNpbmVzc1VzZXJQYWNrYWdlcygkaHR0cCwkc2NvcGUsJ3VzZXJfcGFja2FnZXMnLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwp9Cn07Cgokc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXIgPSB7fTsKbG9nRGVidWcoJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwokc2NvcGUuc2hvd19jbGllbnRfdXBkYXRlX2NsaWVudCA9IHRydWU7CiRzY29wZS5zaG93X2NsaWVudF91cGRhdGVfc2F2ZSA9IGZhbHNlOwokc2NvcGUuc2hvd19jbGllbnRfZGVsZXRlX2NsaWVudCA9IHRydWU7CiRzY29wZS5zaG93X2NsaWVudF91cGRhdGVfY2FuY2VsID0gZmFsc2U7Cgokc2NvcGUudXBkYXRlQ2xpZW50RW5hYmxlID0gZnVuY3Rpb24oKSB7CmxvZ0RlYnVnKCJlbmFibGluZyBlZGl0aW5nICgkc2NvcGUuY2xpZW50c1VwZGF0ZURpc2FibGVkIHdhcyAiICsgJHNjb3BlLmNsaWVudHNVcGRhdGVEaXNhYmxlZCArICIpIik7CiRzY29wZS5jbGllbnRzVXBkYXRlRGlzYWJsZWQgPSBmYWxzZTsKJHNjb3BlLnNob3dfY2xpZW50X3VwZGF0ZV9jbGllbnQgPSBmYWxzZTsKJHNjb3BlLnNob3dfY2xpZW50X3VwZGF0ZV9zYXZlID0gdHJ1ZTsKJHNjb3BlLnNob3dfY2xpZW50X2RlbGV0ZV9jbGllbnQgPSBmYWxzZTsKJHNjb3BlLnNob3dfY2xpZW50X3VwZGF0ZV9jYW5jZWwgPSB0cnVlOwp9CiRzY29wZS51cGRhdGVDbGllbnREaXNhYmxlID0gZnVuY3Rpb24oKSB7CmxvZ0RlYnVnKCJkaXNhYmxlIGVkaXRpbmciKTsKLy8JCSRsb2NhdGlvbi5wYXRoKCcvQ2xpZW50cy8nKyRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKJHJvdXRlLnJlbG9hZCgpOwp9CiRzY29wZS5zY2hlZHVsZUV2ZW50RnJvbUVuZFVzZXIgPSBmdW5jdGlvbigpIHsKc2hhcmVkRGF0YS5zZXRTZWxlY3RlZEVuZFVzZXIoewppZDogJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsCmZpcnN0X25hbWU6ICRzY29wZS5jdXJyZW50Q2xpZW50LnVzZXJzWzBdLmZpcnN0X25hbWUsCmxhc3RfbmFtZTogJHNjb3BlLmN1cnJlbnRDbGllbnQudXNlcnNbMF0ubGFzdF9uYW1lCn0pOwpsb2dEZWJ1Zygic2NoZWR1bGUgZXZlbnQgZm9yIHVzZXIgIiArICRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKLy8JCSRsb2NhdGlvbi5wYXRoKCcvQ2xpZW50cy8nKyRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jYWxlbmRhcicpOwp9CgogICAgJHNjb3BlLnVzZXJEZWxldGVQYXltZW50ID0gZnVuY3Rpb24gKGZwYXltZW50KQogICAgewogICAgICAvLyAkc2NvcGUuY3Vyc29yZGVsZXRlPSJ3YWl0IjsKICAgICAgbG9nRGVidWcoInVzZXJEZWxldGVQYXltZW50Iik7CiAgICAgIC8vIGRvY3VtZW50LmJvZHkuc3R5bGUuY3Vyc29yPSd3YWl0JzsKCiAgICAgIGRlbGV0ZUNsaWVudFBheW1lbnRzKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCxmcGF5bWVudC51c2VyX3BheW1lbnRfaWQsZGVsZXRlQ2xpZW50UGF5bWVudHNfc3VjY2Vzc19jYWxsYmFjayk7CiAgICAgIGZ1bmN0aW9uIGRlbGV0ZUNsaWVudFBheW1lbnRzX3N1Y2Nlc3NfY2FsbGJhY2soKQogICAgICB7CiAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgICAgIGxvZ0RlYnVnKCJ1c2VyRGVsZXRlUGF5bWVudCIpOwogICAgICAgIC8vICRzY29wZS5jdXJzb3JkZWxldGU9IiI7CiAgICAgICAgLy8gZG9jdW1lbnQuYm9keS5zdHlsZS5jdXJzb3I9Jyc7CiAgICAgIH0KICAgIH0KLy8gcmVtb3ZlIGVuZCB1c2VyIGZyb20gZXZlbnQKJHNjb3BlLnVzZXJEZWxldGVFdmVudCA9IGZ1bmN0aW9uKGVuZHVzZXJfaWQsIHRoZWV2ZW50KQp7Ci8vIGlmIGl0J3MgYSBjbGFzcyAtIHdlIHNpbXBseSByZW1vdmUgdGhlIHVzZXIgZnJvbSB0aGUgZXZlbnQKaWYgKHRoZWV2ZW50LmlzX2NsYXNzPT0xKQp7CmxvZ0RlYnVnKCJzY29wZS51c2VyRGVsZXRlRXZlbnQiKTsKcmVtb3ZlRW5kVXNlckZyb21FdmVudCgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsdGhlZXZlbnQuZXZlbnRfaWQscmVtb3ZlRW5kVXNlckZyb21FdmVudF9maW5pc2gsIHJlbW92ZUVuZFVzZXJGcm9tRXZlbnRfZmluaXNoKTsKZnVuY3Rpb24gcmVtb3ZlRW5kVXNlckZyb21FdmVudF9maW5pc2goKQp7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKfQp9Ci8vIGlmIGl0cyBub3QgYSBjbGFzcyAtIHdlIG5lZWQgdG8gcmVtb3ZlIHRoZSBldmVudCBpdHNlbGYKZWxzZQp7Ci8vIGFsZXJ0KCJub3QgY2xhc3MgZXZlbnQsIFRPRE8iKTsKfQp9OwoKLy8gcmV0cmV2aW5nIHBhY2thZ2VzIGZvciB0aGUgYnVzaW5lc3MKZ2V0QnVzaW5lc3NQYWNrYWdlcygkaHR0cCwkc2NvcGUsJ3BhY2thZ2VzJyk7CgovLyBnZXQgcGFja2FnZXMgZm9yIHRoaXMgc3BlY2lmaWMgdXNlcgpnZXRCdXNpbmVzc1VzZXJQYWNrYWdlcygkaHR0cCwkc2NvcGUsJ3VzZXJfcGFja2FnZXMnLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKLy8gYWRkaW5nIHBhY2thZ2UgdG8gdXNlciAtIGNhbGxlZCB3aGVuIGEgcGFja2FnZSBpcyBzZWxlY3RlZAokc2NvcGUucGFja2FnZUZvckNsaWVudFNlbGVjdGVkID0gZnVuY3Rpb24oc2VsZWN0ZWRQYWNrYWdlKSB7CmlmIChzZWxlY3RlZFBhY2thZ2UpIHsKLy8gbG9nRGVidWcoJ3llcyBzZWxlY3RlZCAnICsgSlNPTi5zdHJpbmdpZnkoc2VsZWN0ZWRQYWNrYWdlKSk7CmFkZEJ1c2luZXNzUGFja2FnZVRvVXNlcigkaHR0cCwkc2NvcGUsc2VsZWN0ZWRQYWNrYWdlLm9yaWdpbmFsT2JqZWN0LCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLGFkZEJ1c2luZXNzUGFja2FnZVN1Y2Nlc3MpOwpmdW5jdGlvbiBhZGRCdXNpbmVzc1BhY2thZ2VTdWNjZXNzKCkKewpsb2dEZWJ1ZygiYWRkQnVzaW5lc3NQYWNrYWdlU3VjY2VzczIiKTsKLy8gZ2V0QnVzaW5lc3NQYWNrYWdlcygkaHR0cCwkc2NvcGUsJ3BhY2thZ2VzJyk7Ci8vIGdldEJ1c2luZXNzVXNlclBhY2thZ2VzKCRodHRwLCRzY29wZSwndXNlcl9wYWNrYWdlcycsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwokcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NsaWVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCn0KJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdhbmd1Y29tcGxldGUtYWx0OmNsZWFySW5wdXQnLCAnY2xpZW50X2FuZ3Vjb21wbGV0ZScpOwp9CmVsc2UKewovLyBsb2dEZWJ1Zygnbm90IHNlbGVjdGVkLCBkbyBub3RoaW5nJyk7Cn0KfTsKfSk7CgoKLy8gTmVlZCB0byBkaXN0aW5ndWlzaCBiZXR3ZWVuIGVuZCB1c2VyIChjbGllbnQpIGFuZCBidXNpbmVzcyBvd25lci4KLy8gY3VycmVudGx5IGNhbGxzIG9ubHkgZW5kIHVzZXIKa3V6ZUFwcC5jb250cm9sbGVyKCdIb21lQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICR1aWJNb2RhbCkKewoKZ2V0QWxsQ2xpZW50cygkaHR0cCwkc2NvcGUsJ2FsbENsaWVudHMnKTsKCiRzY29wZS5ob21lcGFnZUxpbWl0PTY7CmdldE9wZW5lZEV2ZW50cygkaHR0cCwkc2NvcGUsJHNjb3BlLmhvbWVwYWdlTGltaXQsJ29wZW5lZF9ldmVudHMnKTsKCnZhciB0b2RheWRhdGUgPSBuZXcgRGF0ZSgpOwp2YXIgaG93bWFueWRheXNhaGVhZD0zMDsKdmFyIHN0YXJ0ZGF0ZT10b2RheWRhdGUuZ2V0RnVsbFllYXIoKSsiLSIrKDErdG9kYXlkYXRlLmdldE1vbnRoKCkpKyItIit0b2RheWRhdGUuZ2V0RGF0ZSgpOwp0b2RheWRhdGUuc2V0RGF0ZSh0b2RheWRhdGUuZ2V0RGF0ZSgpICsgaG93bWFueWRheXNhaGVhZCk7CnZhciBlbmRkYXRlPXRvZGF5ZGF0ZS5nZXRGdWxsWWVhcigpKyItIisoMSt0b2RheWRhdGUuZ2V0TW9udGgoKSkrIi0iK3RvZGF5ZGF0ZS5nZXREYXRlKCk7CgovLyBmaWx0ZXIgZm9yIHVzZXJzIHdobyBoYXZlIGRlYnQKJHNjb3BlLmhhdmVEZWJ0ID0gZnVuY3Rpb24oZXVzZXIpCnsKaWYgKGV1c2VyLnVzZXJfYmFsYW5jZSA8IDApCnsKcmV0dXJuIHRydWU7Cn0KZWxzZQp7CnJldHVybiBmYWxzZTsKfQp9OwoKJHNjb3BlLmdvdG9DbGllbnRQYWdlID0gZnVuY3Rpb24oYnVzaW5lc3NfdXNlcl9pZCkKewovLyBsb2dEZWJ1ZyhldXNlcik7CndpbmRvdy5sb2NhdGlvbi5ocmVmPScvIy9idXNpbmVzc19jbGllbnRzLycgKyBidXNpbmVzc191c2VyX2lkOwp9Cgp2YXIgcGF5bG9hZCA9ICdzdGFydD0nICsgc3RhcnRkYXRlICsgJyZlbmQ9JyArIGVuZGRhdGU7CnZhciBjb25maWcgPSB7CmhlYWRlcnM6IHsnQ29udGVudC1UeXBlJzonYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkOyBjaGFyc2V0PVVURi04J30KfQogICAgdmFyIHBvc3R1cmwgPSAiL2FwaS9hZG1pbi9yZXBvcnRzL2V2ZW50czIiOwoKICAgICRzY29wZS5ldmVudFJlcG9ydENvbmZpZyA9IHt9OwogICAgJHNjb3BlLmV2ZW50UmVwb3J0Q29uZmlnLnNvdXJjZSA9ICJkb2NzIjsKICAgICRzY29wZS5ldmVudFJlcG9ydENvbmZpZy5maWx0ZXJzID0gewogICAgICBzdGFydF9kYXRlOiBzdGFydGRhdGUsCiAgICAgIGlzX2NhbmNlbGVkOiAnMCcsCiAgICAgIGVuZF9kYXRlOiBlbmRkYXRlCiAgICB9OwoKICAgIGdldEV2ZW50c1JlcG9ydCgkaHR0cCwkc2NvcGUsICRzY29wZS5ldmVudFJlcG9ydENvbmZpZywgZ2V0RXZlbnRzUmVwb3J0QWdncmVnYXRlZF9zdWNjZXNzKTsKCiAgICBmdW5jdGlvbiBnZXRFdmVudHNSZXBvcnRBZ2dyZWdhdGVkX3N1Y2Nlc3MocmVzcG9uc2UpewogICAgICAkc2NvcGUuYWRtaW5fZXZlbnRzID0gcmVzcG9uc2UuanNvbjsKICAgICAgICB9CiAgICAvLyAkaHR0cC5wb3N0KHBvc3R1cmwsIHBheWxvYWQsIGNvbmZpZykuc3VjY2VzcyhmdW5jdGlvbihkYXRhKQogICAgLy8gewogICAgLy8gICBsb2dEZWJ1ZygiZG9uZSIpOwogICAgLy8gICAkc2NvcGUuYWRtaW5fZXZlbnRzID0gZGF0YTsKICAgIC8vIH0pOwoKJHNjb3BlLnNob3dFdmVudFBvcHVwID0gZnVuY3Rpb24oc2VsZWN0ZWRFdmVudCkgewpzaG93RXZlbnRQb3B1cChzZWxlY3RlZEV2ZW50LCAkdWliTW9kYWwpCn07CiRzY29wZS5lZGl0RXZlbnQ9IGZ1bmN0aW9uICh0aGVldmVudCkKewpnb3RvRXZlbnRQYWdlKHRoZWV2ZW50KTsKfQp9KTsKCi8vIGt1emVBcHAuY29udHJvbGxlcignQnVzaW5lc3NDb25maWdDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJHJvdXRlUGFyYW1zLCAkbG9jYXRpb24sICRyb3V0ZSwgc2hhcmVkRGF0YSkgewoKa3V6ZUFwcC5jb250cm9sbGVyKCdDb25maWdVc2VyQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHVpYk1vZGFsLCAkaHR0cCwgJHRpbWVvdXQpCnsKJHNjb3BlLmluVGhlTWlkZGxlT2ZTYXZlPWZhbHNlOwoKbG9nRGVidWcoIkNvbmZpZ1VzZXJDb250cm9sbGVyIik7Ci8vICRzY29wZS5hamF4X2luZm89IteU16nXmdeg15XXmdeZ150g16DXqdee16jXlSI7CgogIGdldEJ1c2luZXNzVXNlclJlbGF0aW9ucygkaHR0cCwkc2NvcGUsJ2J1c2luZXNzX3VzZXJfcmVsYXRpb25zJyxnZXRMb2dnZWRVc2VySW5mb19zdWNjZXNzLGdldExvZ2dlZFVzZXJJbmZvX2ZhaWx1cmUpOwoKZ2V0TG9nZ2VkVXNlckluZm8oJGh0dHAsJHNjb3BlLCd1c2VyUHJvcGVydGllcycsZ2V0TG9nZ2VkVXNlckluZm9fc3VjY2VzcyxnZXRMb2dnZWRVc2VySW5mb19mYWlsdXJlKTsKZnVuY3Rpb24gZ2V0TG9nZ2VkVXNlckluZm9fc3VjY2VzcygpCnsKbG9nRGVidWcoImdldExvZ2dlZFVzZXJJbmZvX3N1Y2Nlc3MiKTsKICAgIC8vICRzY29wZS51c2VyUHJvcGVydGllc0R1cGxpY2F0ZSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoJHNjb3BlLnVzZXJQcm9wZXJ0aWVzKSk7Cn0KZnVuY3Rpb24gZ2V0TG9nZ2VkVXNlckluZm9fZmFpbHVyZSgpCnsKbG9nRGVidWcoImdldExvZ2dlZFVzZXJJbmZvX2ZhaWx1cmUiKTsKfQoKJHNjb3BlLmJhY2sgPSBmdW5jdGlvbigpIHsKd2luZG93Lmhpc3RvcnkuYmFjaygpOwp9OwoKJHNjb3BlLmNoYW5nZVBhc3N3b3JkTW9kYWwgPSBmdW5jdGlvbigpCnsKICAgIGxvZ0RlYnVnKCJjaGFuZ2VQYXNzd29yZE1vZGFsIiskc2NvcGUudXNlclByb3BlcnRpZXNEdXBsaWNhdGVbMF0pOwokc2NvcGUuaW5UaGVNaWRkbGVPZlNhdmU9dHJ1ZTsKZnVuY3Rpb24gc21zUmVzZXRQYXNzd29yZF9zdWNjZXNzKCkKewpjb25zb2xlLmxvZygic21zUmVzZXRQYXNzd29yZF9zdWNjZXNzIik7CnZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewphbmltYXRpb246IGZhbHNlLAp0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdtb2RhbF9jaGFuZ2VfcGFzc3dvcmQucGhwJywKY29udHJvbGxlcjogJ21vZGFsX2NoYW5nZV9wYXNzd29yZCcsCnNpemU6ICdsJywKcmVzb2x2ZTogewp1c2VyX3Bob25lX251bWJlcjogZnVuY3Rpb24oKSB7Ci8vIHBhc3Npbmcgb3JpZ2luYWwgcGhvbmUgbnVtYmVyCnJldHVybiAkc2NvcGUudXNlclByb3BlcnRpZXNEdXBsaWNhdGVbMF0ucGhvbmVfbnVtYmVyOwp9Cn0KfSk7Cgptb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHJlc3VsdCkgewokc2NvcGUuaW5UaGVNaWRkbGVPZlNhdmU9ZmFsc2U7CmxvZ0RlYnVnKCdzbXNSZXNldFBhc3N3b3JkIE1vZGFsIGZpbmlzZWhkIHJlc3VsdDogJyArIHJlc3VsdCk7CiRzY29wZS5hamF4X2luZm89IteU16HXmdeh157XkCDXoteV15PXm9eg15Qg15HXlNem15zXl9eUISI7Ci8vIGdldExvZ2dlZFVzZXJJbmZvKCRodHRwLCRzY29wZSwndXNlclByb3BlcnRpZXMnLGdldExvZ2dlZFVzZXJJbmZvX3N1Y2Nlc3MsZ2V0TG9nZ2VkVXNlckluZm9fZmFpbHVyZSk7CiR0aW1lb3V0KGZ1bmN0aW9uKCkKewokc2NvcGUuYWpheF9pbmZvPW51bGw7Cn0sIDIwMDApOwpsb2dEZWJ1Zygnc21zUmVzZXRQYXNzd29yZCBNb2RhbCBkaXNtaXNzZWQgYXQ6ICcgKyBuZXcgRGF0ZSgpKTsKfSwgZnVuY3Rpb24oKSB7CiRzY29wZS5pblRoZU1pZGRsZU9mU2F2ZT1mYWxzZTsKbG9nRGVidWcoJ21vZGFsX2NoYW5nZV9wYXNzd29yZCBNb2RhbCBkaXNtaXNzZWQgYXQ6ICcgKyBuZXcgRGF0ZSgpKTsKfSk7Cn0KCgpjaGFuZ2VQYXNzd29yZFNNUygkaHR0cCwkc2NvcGUsJHNjb3BlLnVzZXJQcm9wZXJ0aWVzRHVwbGljYXRlWzBdLnBob25lX251bWJlcixzbXNSZXNldFBhc3N3b3JkX3N1Y2Nlc3MpOwp9CiRzY29wZS51cGRhdGVVc2VyQ29uZmlnPWZ1bmN0aW9uKCkKewokc2NvcGUuaW5UaGVNaWRkbGVPZlNhdmU9dHJ1ZTsKbG9nRGVidWcoInVwZGF0ZVVzZXJDb25maWcsIGluVGhlTWlkZGxlT2ZTYXZlPSIrJHNjb3BlLmluVGhlTWlkZGxlT2ZTYXZlKTsKLy8gbG9nRGVidWcoJHNjb3BlLnVzZXJQcm9wZXJ0aWVzRHVwbGljYXRlKTsKLy8gbG9nRGVidWcoJHNjb3BlLnVzZXJQcm9wZXJ0aWVzKTsKaWYgKGFuZ3VsYXIuZXF1YWxzKCRzY29wZS51c2VyUHJvcGVydGllc0R1cGxpY2F0ZVswXS5waG9uZV9udW1iZXIsJHNjb3BlLnVzZXJQcm9wZXJ0aWVzWzBdLnBob25lX251bWJlcikpCnsKbG9nRGVidWcoIm5vdGhpbmcgY2hhbmdlZCBpbiBwaG9uZSBudW1iZXIsIGNoZWNraW5nIG90aGVyIGRhdGEgb3RoZXIgZGF0YSIpOwppZiAoYW5ndWxhci5lcXVhbHMoJHNjb3BlLnVzZXJQcm9wZXJ0aWVzRHVwbGljYXRlWzBdLCRzY29wZS51c2VyUHJvcGVydGllc1swXSkpCnsKJHNjb3BlLmluVGhlTWlkZGxlT2ZTYXZlPWZhbHNlOwpsb2dEZWJ1Zygibm90aGluZyBjaGFuZ2VkIGluIGRldGFpbHMsIG5vdGhpbmcgdG8gc2F2ZSIpOwokc2NvcGUuYWpheF9pbmZvPSLXnNeQINeR15XXptei15Ug16nXmdeg15XXmdeZ150g15zXqdee15nXqNeULi4uIjsKJHRpbWVvdXQoZnVuY3Rpb24oKQp7CiRzY29wZS5hamF4X2luZm89bnVsbDsKfSwgMTUwMCk7Cn0KZWxzZQp7CmNoYW5nZVVzZXJEZXRhaWxzKCRodHRwLCRzY29wZSwkc2NvcGUudXNlclByb3BlcnRpZXNbMF0uZmlyc3RfbmFtZSwkc2NvcGUudXNlclByb3BlcnRpZXNbMF0ubGFzdF9uYW1lLCAkc2NvcGUudXNlclByb3BlcnRpZXNbMF0uZW1haWxfYWRkcmVzcyxjaGFuZ2VVc2VyRGV0YWlsc19zdWNjZXNzLCBjaGFuZ2VVc2VyRGV0YWlsc19mYWlsdXJlKTsKJHNjb3BlLmFqYXhfaW5mbz0i157XoteT15vXnyDXqdeZ16DXldeZ15nXnS4uLiI7Cn0KCmZ1bmN0aW9uIGNoYW5nZVVzZXJEZXRhaWxzX3N1Y2Nlc3MoKQp7CmxvZ0RlYnVnKCJjaGFuZ2VVc2VyRGV0YWlsc19zdWNjZXNzIik7CiRzY29wZS5hamF4X2luZm89IteU16nXmdeg15XXmdeZ150g16DXqdee16jXlSDXkdeU16bXnNeX15QhIjsKJHNjb3BlLmluVGhlTWlkZGxlT2ZTYXZlPWZhbHNlOwokdGltZW91dChmdW5jdGlvbigpCnsKJHNjb3BlLmFqYXhfaW5mbz1udWxsOwp9LCAxNTAwKTsKZ2V0TG9nZ2VkVXNlckluZm8oJGh0dHAsJHNjb3BlLCd1c2VyUHJvcGVydGllcycsZ2V0TG9nZ2VkVXNlckluZm9fc3VjY2VzcyxnZXRMb2dnZWRVc2VySW5mb19mYWlsdXJlKTsKfQpmdW5jdGlvbiBjaGFuZ2VVc2VyRGV0YWlsc19mYWlsdXJlKCkKewpsb2dEZWJ1ZygiY2hhbmdlVXNlckRldGFpbHNfZmFpbHVyZSIpOwp9Cgp9CmVsc2UKewovLyB1cGRhdGUgdXNlciBpbmZvIC0gYWZ0ZXIgdmVyaWZ5aW5nIHBhc3N3b3JkCmNvbnNvbGUubG9nKCJwaG9uZSBjaGFuZ2VkLCBjaGVja2luZyBpZiBuZXcgcGhvbmUgaXMgaW4gZGVzY2VudCBmb3JtYXQiKTsKaWYgKCFjaGVja1Bob25lTnVtYmVyKCRzY29wZS51c2VyUHJvcGVydGllc1swXS5waG9uZV9udW1iZXIpKQp7CiRzY29wZS5hamF4X2luZm89IteQ16DXkCDXlNeW158g157Xodek16gg15jXnNek15XXnyDXodec15XXnNeo15kg16rXp9eZ158g15zXp9eR15zXqiDXlNeV15PXoteV16og157Xp9eZ15XXli4iOwokdGltZW91dChmdW5jdGlvbigpCnsKJHNjb3BlLmFqYXhfaW5mbz1udWxsOwp9LCAzMDAwKTsKcmV0dXJuOwp9CmNvbnNvbGUubG9nKCJwaG9uZSBjaGFuZ2VkLCBjaGVja2luZyBpZiBuZXcgcGhvbmUgaXMgbm90IHVzZWQgYWxyZWFkeSIpOwppc05ld1Bob25lVXNlZElmTm90U2VuZFNNUygkaHR0cCwkc2NvcGUsJHNjb3BlLnVzZXJQcm9wZXJ0aWVzWzBdLnBob25lX251bWJlciwgaXNOZXdQaG9uZVVzZWRfc3VjY2VzcywgaXNOZXdQaG9uZVVzZWRfZmFpbHVyZSxmYWxzZSk7CmZ1bmN0aW9uIGlzTmV3UGhvbmVVc2VkX3N1Y2Nlc3MocmVzcG9uc2UpCnsKY29uc29sZS5sb2coInBob25lIG5vdCB1c2VkIC0gcHJvbXB0aW5nIGZvciBwYXNzd29yZCIpOwp2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKYW5pbWF0aW9uOiBmYWxzZSwKdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnbW9kYWxfY2hlY2tfcGFzc3dvcmRfdXBkYXRlX2NvbmZpZy5waHAnLApjb250cm9sbGVyOiAnbW9kYWxfY2hlY2tfcGFzc3dvcmRfdXBkYXRlX2NvbmZpZycsCnNpemU6ICdsJywKcmVzb2x2ZTogewpuZXdfdXNlcl9wcm9lcnRpZXM6IGZ1bmN0aW9uKCkgewpyZXR1cm4gJHNjb3BlLnVzZXJQcm9wZXJ0aWVzWzBdOwp9Cn0KfSk7Cgptb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHJlc3VsdCkgewpsb2dEZWJ1ZygnbW9kYWxfY2hlY2tfcGFzc3dvcmRfdXBkYXRlX2NvbmZpZyBNb2RhbCBmaW5pc2hlZCByZXN1bHQ6ICcgKyByZXN1bHQpOwokc2NvcGUuYWpheF9pbmZvPSLXlNep15nXoNeV15nXmdedINeg16nXnteo15Ug15HXlNem15zXl9eUISI7CiRzY29wZS5pblRoZU1pZGRsZU9mU2F2ZT1mYWxzZTsKZ2V0TG9nZ2VkVXNlckluZm8oJGh0dHAsJHNjb3BlLCd1c2VyUHJvcGVydGllcycsZ2V0TG9nZ2VkVXNlckluZm9fc3VjY2VzcyxnZXRMb2dnZWRVc2VySW5mb19mYWlsdXJlKTsKJHRpbWVvdXQoZnVuY3Rpb24oKQp7CiRzY29wZS5hamF4X2luZm89bnVsbDsKfSwgMzAwMCk7Cn0sIGZ1bmN0aW9uKCkgewokc2NvcGUuaW5UaGVNaWRkbGVPZlNhdmU9ZmFsc2U7CmxvZ0RlYnVnKCdtb2RhbF9jaGVja19wYXNzd29yZF91cGRhdGVfY29uZmlnIE1vZGFsIGRpc21pc3NlZCBhdDogJyArIG5ldyBEYXRlKCkpOwp9KTsKfQoKZnVuY3Rpb24gaXNOZXdQaG9uZVVzZWRfZmFpbHVyZShyZXNwb25zZSkKewokc2NvcGUuYWpheF9pbmZvPXJlc3BvbnNlLm1lc3NhZ2U7CiR0aW1lb3V0KGZ1bmN0aW9uKCkKewokc2NvcGUuYWpheF9pbmZvPW51bGw7Cn0sIDIwMDApOwp9Cn0KfTsKfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdtb2RhbF9jaGVja19wYXNzd29yZF91cGRhdGVfY29uZmlnJywgZnVuY3Rpb24oJHNjb3BlLCAkdGltZW91dCwgJHVpYk1vZGFsSW5zdGFuY2UsIG5ld191c2VyX3Byb2VydGllcywgJGh0dHApCnsKJHNjb3BlLm5ld191c2VyX3Byb2VydGllcz1uZXdfdXNlcl9wcm9lcnRpZXM7CmxvZ0RlYnVnKCJtb2RhbF9jaGVja19wYXNzd29yZF91cGRhdGVfY29uZmlnIGNvbnRyb2xsZXIiKTsKLy8gJHNjb3BlLnBob25lX3ZlcmlmaWNhdGlvbiA9IHt9OyAvLyB0aGVzZSBhcmUgdGhlIGNvbXBsZXRlIGRldGFpbHMgZm9yIHRoZSBuZXcgZXZlbnQgLy8KLy8gJHNjb3BlLnBob25lX3ZlcmlmaWNhdGlvbi5waG9uZV9udW1iZXI9bmV3X3VzZXJfcHJvZXJ0aWVzLnBob25lX251bWJlcjsKJHNjb3BlLmNsb3NlID0gZnVuY3Rpb24oKSB7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCdkaXNtaXNzJyk7Cn07Cgokc2NvcGUuY2hhbmdlUGhvbmVOdW1iZXIgPSBmdW5jdGlvbigpCnsKY2hhbmdlVXNlckRldGFpbHNWZXJpZnkoJGh0dHAsJHNjb3BlLCRzY29wZS5uZXdfdXNlcl9wcm9lcnRpZXMucGhvbmVfbnVtYmVyLCRzY29wZS5uZXdfdXNlcl9wcm9lcnRpZXMuZmlyc3RfbmFtZSwkc2NvcGUubmV3X3VzZXJfcHJvZXJ0aWVzLmxhc3RfbmFtZSwgJHNjb3BlLm5ld191c2VyX3Byb2VydGllcy5lbWFpbF9hZGRyZXNzLCRzY29wZS52ZXJpZnlfdXNlcl9wYXNzd29yZCwkc2NvcGUucGhvbmVfdmVyaWZpY2F0aW9uLGNoYW5nZVVzZXJEZXRhaWxzVmVyaWZ5X3N1Y2Nlc3MsIGNoYW5nZVVzZXJEZXRhaWxzVmVyaWZ5X2ZhaWx1cmUsZmFsc2UpOwpmdW5jdGlvbiBjaGFuZ2VVc2VyRGV0YWlsc1ZlcmlmeV9zdWNjZXNzKCkKewpsb2dEZWJ1ZygiY2hhbmdlVXNlckRldGFpbHNWZXJpZnlfc3VjY2VzcyIpOwovLyBhbGVydCgn15TXqdeZ16DXldeZ15nXnSDXoteV15PXm9eg15Ug15HXlNem15zXl9eUJyk7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKHRydWUpOwp9CmZ1bmN0aW9uIGNoYW5nZVVzZXJEZXRhaWxzVmVyaWZ5X2ZhaWx1cmUocmVzcG9uc2UpCnsKbG9nRGVidWcoImNoYW5nZVVzZXJEZXRhaWxzVmVyaWZ5X2ZhaWx1cmUgIityZXNwb25zZS5tZXNzYWdlKTsKJHNjb3BlLmFqYXhfZXJyb3I9cmVzcG9uc2UubWVzc2FnZSsiLiI7CiR0aW1lb3V0KGZ1bmN0aW9uKCkKewokc2NvcGUuYWpheF9lcnJvcj1udWxsOwp9LCA0MDAwKTsKfQp9Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignbW9kYWxfY2hhbmdlX3Bhc3N3b3JkJywgZnVuY3Rpb24oJHNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgdXNlcl9waG9uZV9udW1iZXIsICRodHRwKQp7CmxvZ0RlYnVnKCJtb2RhbF9jaGFuZ2VfcGFzc3dvcmQgY29udHJvbGxlciIpOwokc2NvcGUucGhvbmVfdmVyaWZpY2F0aW9uID0ge307IC8vIHRoZXNlIGFyZSB0aGUgY29tcGxldGUgZGV0YWlscyBmb3IgdGhlIG5ldyBldmVudCAvLwokc2NvcGUucGhvbmVfdmVyaWZpY2F0aW9uLnBob25lX251bWJlcj11c2VyX3Bob25lX251bWJlcjsKJHNjb3BlLnBob25lX3ZlcmlmaWNhdGlvbi5zbXNfZXJyb3I9IiI7CiRzY29wZS5jbG9zZSA9IGZ1bmN0aW9uKCkgewokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnZGlzbWlzcycpOwp9OwoKJHNjb3BlLmNoYW5nZVBhc3N3b3JkID0gZnVuY3Rpb24oKQp7CmNoYW5nZVBhc3N3b3JkKCRodHRwLCRzY29wZSwkc2NvcGUucGhvbmVfdmVyaWZpY2F0aW9uLnVzZXJfcGFzc3dvcmQsJHNjb3BlLnBob25lX3ZlcmlmaWNhdGlvbi51c2VyX3Bhc3N3b3JkMiwkc2NvcGUucGhvbmVfdmVyaWZpY2F0aW9uLnZlcmlmaWNhdGlvbl9jb2RlLCBjaGFuZ2VQYXNzd29yZF9zdWNjZXNzLCBjaGFuZ2VQYXNzd29yZF9mYWlsdXJlLGZhbHNlKTsKJHNjb3BlLmFqYXhfZXJyb3I9IiI7CmZ1bmN0aW9uIGNoYW5nZVBhc3N3b3JkX3N1Y2Nlc3MoKQp7CmxvZ0RlYnVnKCJjaGFuZ2VQYXNzd29yZF9zdWNjZXNzIik7CnN0YXR1cz0iZmZmZmYiOwovLyBhbGVydCgn15TXodeZ16HXnteQINei15XXk9eb16DXlCDXkdeU16bXnNeX15QnKTsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UodHJ1ZSk7Cn0KZnVuY3Rpb24gY2hhbmdlUGFzc3dvcmRfZmFpbHVyZShyZXNwb25zZSkKewpsb2dEZWJ1ZygiY2hhbmdlUGFzc3dvcmRfZmFpbHVyZSAiK3Jlc3BvbnNlLm1lc3NhZ2UpOwokc2NvcGUuYWpheF9lcnJvcj1yZXNwb25zZS5tZXNzYWdlOwp9Cn0KfSk7CgprdXplQXBwLmZhY3RvcnkoJ0J1c2luZXNzQ29uZmlnJywgZnVuY3Rpb24oJGh0dHApIHsKcmV0dXJuIHsKZ2V0OiBmdW5jdGlvbiAoKSB7CmxvZ0RlYnVnKCJsb2FkIGdldF9idXNpbmVzc19jb25maWciKTsKcmV0dXJuICRodHRwLmdldCgiL2FwaS9hZG1pbi9idXNpbmVzc19jb25maWciKQoudGhlbihmdW5jdGlvbihyZXNwb25zZSkgewpyZXN1bHQgPSByZXNwb25zZS5kYXRhWzBdOwpyZXN1bHQudXNlX2hvbGlkYXlzPSEhcGFyc2VJbnQocmVzcG9uc2UuZGF0YVswXS51c2VfaG9saWRheXMpOwpyZXN1bHQuc21zX25vdGlmaWNhdGlvbnM9ISFwYXJzZUludChyZXNwb25zZS5kYXRhWzBdLnNtc19ub3RpZmljYXRpb25zKTsKcmVzdWx0LnN0YXJ0X2ludm9pY2VfbnVtYmVyID0gcGFyc2VJbnQocmVzcG9uc2UuZGF0YVswXS5zdGFydF9pbnZvaWNlX251bWJlcik7CnZhciBkID0gbmV3IERhdGUoKTsKZC5zZXRIb3VycyggcmVzdWx0LmNhbGVuZGFyX2Rpc3BsYXlfc3RhcnRfaG91cnMgKTsKZC5zZXRNaW51dGVzKCByZXN1bHQuY2FsZW5kYXJfZGlzcGxheV9zdGFydF9taW51dGVzICk7CnJlc3VsdC5teXRpbWUgPSBkOwpyZXN1bHQuY2FsZW5kYXJfZGlzcGxheV9zdGFydCA9IGQ7CnZhciBkID0gbmV3IERhdGUoKTsKZC5zZXRIb3VycyggcmVzdWx0LmNhbGVuZGFyX2Rpc3BsYXlfZW5kX2hvdXJzICk7CmQuc2V0TWludXRlcyggcmVzdWx0LmNhbGVuZGFyX2Rpc3BsYXlfZW5kX21pbnV0ZXMgKTsKcmVzdWx0Lm15dGltZSA9IGQ7CnJlc3VsdC5jYWxlbmRhcl9kaXNwbGF5X2VuZCA9IGQ7CnJlc3VsdC52YXRfcmF0ZSA9IE51bWJlcihyZXN1bHQudmF0X3JhdGUpOwpyZXR1cm4gcmVzdWx0Owp9KTsKfQp9Owp9KTsKCmt1emVBcHAuY29udHJvbGxlcignQ29uZmlnQnVzaW5lc3NDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJHRpbWVvdXQsIEJ1c2luZXNzQ29uZmlnKQp7CmxvZ0RlYnVnKCJteSBidXNpbmVzcyBjb25maWciKTsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXM9W107CgpmdW5jdGlvbiBnZXRfYnVzaW5lc3NfY29uZmlnKCkgewpsb2dEZWJ1ZygiZ2V0X2J1c2luZXNzX2NvbmZpZyIpOwpsb2dEZWJ1ZygiQnVzaW5lc3NDb25maWc6ICIsIEJ1c2luZXNzQ29uZmlnKTsKQnVzaW5lc3NDb25maWcuZ2V0KCkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7ICRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMgPSByZXN1bHQ7IH0pOwp9CmdldF9idXNpbmVzc19jb25maWcoKTsKCgokc2NvcGUuaHN0ZXAgPSAxOwokc2NvcGUubXN0ZXAgPSAxNTsKCiRzY29wZS5idXNpbmVzc0NvbmZpZ0NhbmNlbCA9IGZ1bmN0aW9uKCkgewp3aW5kb3cuaGlzdG9yeS5iYWNrKCk7Cn07Cgokc2NvcGUudXBkYXRlQnVzaW5lc3NDb25maWcgPSBmdW5jdGlvbigpIHsKbG9nRGVidWcoInVwZGF0aW5nIGJ1c2luZXNzIGNvbmZpZyIgKyBKU09OLnN0cmluZ2lmeSgkc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzKSk7Cgokc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzX2FqYXhfZXJyb3I9IiI7CiRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMuY2FsZW5kYXJfZGlzcGxheV9zdGFydF9ob3Vycz0kc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzLmNhbGVuZGFyX2Rpc3BsYXlfc3RhcnQuZ2V0SG91cnMoKTsKJHNjb3BlLmJ1c2luZXNzUHJvcGVydGllcy5jYWxlbmRhcl9kaXNwbGF5X3N0YXJ0X21pbnV0ZXM9JHNjb3BlLmJ1c2luZXNzUHJvcGVydGllcy5jYWxlbmRhcl9kaXNwbGF5X3N0YXJ0LmdldE1pbnV0ZXMoKTsKJHNjb3BlLmJ1c2luZXNzUHJvcGVydGllcy5jYWxlbmRhcl9kaXNwbGF5X2VuZF9ob3Vycz0kc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzLmNhbGVuZGFyX2Rpc3BsYXlfZW5kLmdldEhvdXJzKCk7CiRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMuY2FsZW5kYXJfZGlzcGxheV9lbmRfbWludXRlcz0kc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzLmNhbGVuZGFyX2Rpc3BsYXlfZW5kLmdldE1pbnV0ZXMoKTsKaWYgKCRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMuY2FsZW5kYXJfZGlzcGxheV9zdGFydF9ob3Vycz4kc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzLmNhbGVuZGFyX2Rpc3BsYXlfZW5kX2hvdXJzKQp7CmFsZXJ0KCfXltee158g16HXmdeV150g15zXkCDXmdeb15XXnCDXnNeU15nXldeqINec16TXoNeZINeW157XnyDXlNeq15fXnNeUJyk7CnJldHVybjsKfQokc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzX2FqYXhfZXJyb3I9Itee16LXk9eb158g16DXqteV16DXmdedLi4uIjsKCiRodHRwKHsKbWV0aG9kOiAnUE9TVCcsCnVybDogJy9hcGkvYWRtaW4vYnVzaW5lc3NfY29uZmlnL3NldCcsCmRhdGE6ICRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMsIC8vIHBhc3MgaW4gZGF0YSBhcyBzdHJpbmdzCmhlYWRlcnM6IHsKJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uO2NoYXJzZXQ9dXRmLTgnCn0KfSkuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7Cgpsb2dEZWJ1ZyhkYXRhKTsKaWYgKCFkYXRhLnN1Y2Nlc3MpIHsKbG9nRGVidWcoImVycm9yICIgKyBkYXRhLk1lc3NhZ2UpOwokc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzX2FqYXhfZXJyb3IgPSBkYXRhLk1lc3NhZ2U7Cn0gZWxzZSB7CiRnQ2FsZW5kYXJEaXNwbGF5TWluVGltZT1kYXRhLmpzb24ubmV3U3RhcnRUaW1lOwokZ0NhbGVuZGFyRGlzcGxheU1heFRpbWU9ZGF0YS5qc29uLm5ld0VuZFRpbWU7CmNvbnNvbGUubG9nKCJ1cGRhdGVkIGdDYWxlbmRhckRpc3BsYXlNaW5UaW1lPSIrJGdDYWxlbmRhckRpc3BsYXlNaW5UaW1lKTsKY29uc29sZS5sb2coInVwZGF0ZWQgZ0NhbGVuZGFyRGlzcGxheU1heFRpbWU9IiskZ0NhbGVuZGFyRGlzcGxheU1heFRpbWUpOwokc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzX2FqYXhfZXJyb3I9Itei15XXk9eb158g15HXlNem15zXl9eUISI7CiR0aW1lb3V0KGZ1bmN0aW9uKCkKewokc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzX2FqYXhfZXJyb3I9bnVsbDsKfSwgMjAwMCk7CmdldF9idXNpbmVzc19jb25maWcoKTsKLy8gd2luZG93Lmhpc3RvcnkuYmFjaygpOwovLyAkc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzX2FqYXhfZXJyb3IgPSAi16TXqNeY15kg15TXoteh16cg16DXqdee16jXlSDXkdeU16bXnNeX15QuIjsKCn0KfSk7Cn07Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignY2xpZW50Q2FyZENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUpIHsKbG9nRGVidWcoImNsaWVudENhcmRDb250cm9sbGVyIik7CiRzY29wZS5mdXR1cmVNZWV0aW5ncyA9IFt7CmRhdGV0aW1lOiAi16jXkNep15XXnywgMjUuMS4yMDE2IiwKaG91cjogIjE0OjAwIiwKdHlwZTogIten15HXldem15QiLApwcmljZTogIjEwMCIsCmxhYmVsczogW3sKbGFiZWw6ICJzdWNjZXNzIiwKdGV4dDogItep15XXnNedIgp9LCB7CmxhYmVsOiAid2FybmluZyIsCnRleHQ6ICLXnNeQINeq15XXoteTIgp9XQp9LCB7CmRhdGV0aW1lOiAi16jXkNep15XXnywgMjUuMS4yMDE2IiwKaG91cjogIjE0OjAwIiwKdHlwZTogIten15HXldem15QiLApwcmljZTogIjEwMCIsCmxhYmVsczogW3sKbGFiZWw6ICJkYW5nZXIiLAp0ZXh0OiAi15zXkCDXqdeV15zXnSIKfSwgewpsYWJlbDogImluZm8iLAp0ZXh0OiAi16rXldei15MiCn1dCn0sIHsKZGF0ZXRpbWU6ICLXqdec15nXqdeZLCAyNS4xLjIwMTYiLApob3VyOiAiMTQ6MDAiLAp0eXBlOiAi16fXkdeV16bXlCIsCnByaWNlOiAiMTAwIiwKbGFiZWxzOiBbewpsYWJlbDogImRhbmdlciIsCnRleHQ6ICLXnNeQINep15XXnNedIgp9LCB7CmxhYmVsOiAiaW5mbyIsCnRleHQ6ICLXqteV16LXkyIKfV0KfSwgewpkYXRldGltZTogIteo15DXqdeV158sIDI1LjEuMjAxNiIsCmhvdXI6ICIxNDowMCIsCnR5cGU6ICLXp9eR15XXpteUIiwKcHJpY2U6ICIxMDAiCn0sIF0KCiRzY29wZS5oaXN0b3J5TWVldGluZ3MgPSBbewpkYXRldGltZTogIteo15DXqdeV158sIDI1LjEuMjAxNiIsCmhvdXI6ICIxNDowMCIsCnR5cGU6ICLXp9eR15XXpteUIiwKcHJpY2U6ICIxMDAiCn0sIHsKZGF0ZXRpbWU6ICLXqNeQ16nXldefLCAyNS4xLjIwMTYiLApob3VyOiAiMTQ6MDAiLAp0eXBlOiAi16fXkdeV16bXlCIsCnByaWNlOiAiMTAwIgp9LCB7CmRhdGV0aW1lOiAi16nXnNeZ16nXmSwgMjUuMS4yMDE2IiwKaG91cjogIjE0OjAwIiwKdHlwZTogIten15HXldem15QiLApwcmljZTogIjEwMCIKfSwgewpkYXRldGltZTogIteo15DXqdeV158sIDI1LjEuMjAxNiIsCmhvdXI6ICIxNDowMCIsCnR5cGU6ICLXp9eR15XXpteUIiwKcHJpY2U6ICIxMDAiCn0sIF0KCiRzY29wZS5jY1BheW1lbnRzID0gW3sKZGF0ZXRpbWU6ICLXqNeQ16nXldefLCAyNS4xLjIwMTYiLApyZWNpcHRfbnVtOiAiNzY3IiwKYW1vdW50OiAiMzAwIiwKbGFiZWxzOiBbewpsYWJlbDogImRhbmdlciIsCnRleHQ6ICLXnNeQINep15XXmdeZ15oiCn0sIHsKbGFiZWw6ICJpbmZvIiwKdGV4dDogIteU15XXpNen15MiCn1dCn0sIF0KCgp9KTsKCmt1emVBcHAuY29udHJvbGxlcigna3V6ZUNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkbG9jYXRpb24pIHsKCi8vIG1haW4ga3V6ZSBjb250cm9sbGVyCgovLyBNVVNUIFNFVCBMQU5HVUFHRSBCRUZPUkUgQU5ZIE9USEVSIE9QRVJBVElPTiAhISEKdXBkYXRlR2xvYmFsTGFuZ3VhZ2UoJHNjb3BlLCAkZ0RlZmF1bHRMYW5nKTsKLy8gTVVTVCBTRVQgTEFOR1VBR0UgQkVGT1JFIEFOWSBPVEhFUiBPUEVSQVRJT04gISEhCgovLyBsb2dEZWJ1ZygieHh4eHh4eHgiICsgJHNjb3BlLmxhbmdmaWxlWydzaG93X2FsbF9jbGllbnRzJ10pOwoKJHNjb3BlLnNob3dDbGllbnRzQ29sdW1ucyA9IFt7CmZpZWxkOiAndXNlcl9pZCcsCm5hbWU6ICRzY29wZS5sYW5nZmlsZVsnc2hvd19hbGxfY2xpZW50c191c2VyaWQnXQp9LCB7CmZpZWxkOiAnYnVzZXJfZmlyc3RfbmFtZScsCm5hbWU6ICRzY29wZS5sYW5nZmlsZVsnc2hvd19hbGxfY2xpZW50c19maXJzdF9uYW1lJ10KfSwgewpmaWVsZDogJ2J1c2VyX2xhc3RfbmFtZScsCm5hbWU6ICRzY29wZS5sYW5nZmlsZVsnc2hvd19hbGxfY2xpZW50c19sYXN0X25hbWUnXQp9LCB7CmZpZWxkOiAncm9sZV9uYW1lJywKbmFtZTogJHNjb3BlLmxhbmdmaWxlWydzaG93X2FsbF9jbGllbnRzX2FwcHJvdmVkJ10KfV07CgoKJHNjb3BlLmdyaWRDbGllbnRDbGljayA9IGZ1bmN0aW9uKHJvdykgewovL2xvZ0RlYnVnKHJvdyk7CnZhciByb3dfdXNlcmlkID0gcm93LmVudGl0eS51c2VyX2lkOwpsb2dEZWJ1Zygic2VsZWN0ZWQgcm93IHVzZXJfaWQgPSIgKyByb3dfdXNlcmlkKTsKJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jbGllbnRzLycgKyByb3dfdXNlcmlkKTsKfTsKCiRzY29wZS5zaG93Q2xpZW50c0dyaWRPcHRpb25zID0gewplbmFibGVGaWx0ZXJpbmc6IGZhbHNlLAplbmFibGVTb3J0aW5nOiB0cnVlLApjb2x1bW5EZWZzOiAkc2NvcGUuc2hvd0NsaWVudHNDb2x1bW5zLApyb3dUZW1wbGF0ZTogJy9wdWJsaWMvY29tcG9uZW50cy9jbGllbnRzLWdyaWQtcm93Lmh0bWwnLApvblJlZ2lzdGVyQXBpOiBmdW5jdGlvbihncmlkQXBpKSB7CiRzY29wZS5ncmlkQXBpID0gZ3JpZEFwaTsKJHNjb3BlLmdyaWRBcGkuZ3JpZC5yZWdpc3RlclJvd3NQcm9jZXNzb3IoJHNjb3BlLnNpbmdsZUZpbHRlciwgMjAwKTsKfSwKfTsKCiRzY29wZS5pc0FjdGl2ZSA9IGZ1bmN0aW9uKHZpZXdMb2NhdGlvbikgewpsb2dEZWJ1Zygidmlld0xvY2F0aW9uID0gIiArIHZpZXdMb2NhdGlvbik7CnZhciBhY3RpdmUgPSAodmlld0xvY2F0aW9uID09PSAkbG9jYXRpb24ucGF0aCgpKTsKcmV0dXJuIGFjdGl2ZTsKfTsKCiRzY29wZS5maWx0ZXIgPSBmdW5jdGlvbigpIHsKbG9nRGVidWcoInNpbmdsZSBmaWx0ZXIiKTsKJHNjb3BlLmdyaWRBcGkuZ3JpZC5yZWZyZXNoKCk7CmlmICgkc2NvcGUuZmlsdGVyLlZhbHVlICE9ICIiKSB7CiRzY29wZS5maWx0ZXIuYnV0dG9uVmFsdWUgPSAiJyIgKyAkc2NvcGUuZmlsdGVyLlZhbHVlICsgIiciOwp9IGVsc2Ugewokc2NvcGUuZmlsdGVyLmJ1dHRvblZhbHVlID0gIiI7Cn0KfTsKCiRzY29wZS5zaW5nbGVGaWx0ZXIgPSBmdW5jdGlvbihyZW5kZXJhYmxlUm93cykgewp2YXIgbWF0Y2hlciA9IG5ldyBSZWdFeHAoJHNjb3BlLmZpbHRlci5WYWx1ZSk7CmxvZ0RlYnVnKCJzY29wZT0iICsgJHNjb3BlKTsKbG9nRGVidWcoInNjb3BlLmZpbHRlci5WYWx1ZT0iICsgJHNjb3BlLmZpbHRlci5WYWx1ZSk7CmlmICgoJHNjb3BlLmZpbHRlci5WYWx1ZSA9PSBudWxsKSB8fCAoJHNjb3BlLmZpbHRlci5WYWx1ZSA9PSAiIikpIHsKbG9nRGVidWcoImVtcHR5IGZpbHRlciIpOwpyZXR1cm4gcmVuZGVyYWJsZVJvd3M7Cn0KcmVuZGVyYWJsZVJvd3MuZm9yRWFjaChmdW5jdGlvbihyb3cpIHsKLy8JCQlsb2dEZWJ1Zygicm93PSIrcm93KTsKcm93LnZpc2libGUgPSBmYWxzZTsKdmFyICRjdXJyRmlyc3ROYW1lID0gcm93LmVudGl0eVsnZmlyc3RfbmFtZSddOwp2YXIgJGN1cnJMYXN0TmFtZSA9IHJvdy5lbnRpdHlbJ2xhc3RfbmFtZSddOwpsb2dEZWJ1ZygiY3VyckZpcnN0TmFtZT0iICsgJGN1cnJGaXJzdE5hbWUpOwoKaWYgKCRjdXJyRmlyc3ROYW1lICE9IG51bGwpIHsKaWYgKCRjdXJyRmlyc3ROYW1lLmluZGV4T2YoJHNjb3BlLmZpbHRlci5WYWx1ZSkgPiAtMSkgewpyb3cudmlzaWJsZSA9IHRydWU7Cn0KfSBlbHNlIC8vIHJvdyBpcyBudWxsCnsKcm93LnZpc2libGUgPSBmYWxzZTsKfQoKaWYgKCRjdXJyTGFzdE5hbWUgIT0gbnVsbCkgewppZiAoJGN1cnJMYXN0TmFtZS5pbmRleE9mKCRzY29wZS5maWx0ZXIuVmFsdWUpID4gLTEpIHsKcm93LnZpc2libGUgPSB0cnVlOwp9Cn0gZWxzZSAvLyByb3cgaXMgbnVsbAp7CnJvdy52aXNpYmxlID0gZmFsc2U7Cn0KfSk7CnJldHVybiByZW5kZXJhYmxlUm93czsKfTsKCi8vIGltcG9ydGFudCEhIGluaXRpYWxpemluZyBhbmd1bGFyIGZvcm1zIGFzIGFycmF5cwokc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIgPSB7fTsKJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyID0ge307CgovLyBsb2dEZWJ1ZygibG9jYXRpb249IiArICRsb2NhdGlvbik7Ci8vIGxvZ0RlYnVnKCRsb2NhdGlvbik7Cgokc2NvcGUuY2hhbmdlTGFuZyA9IGZ1bmN0aW9uKCRuZXdsYW5nKSB7CmxvZ0RlYnVnKCRuZXdsYW5nKTsKLy8kc2NvcGUuc3BDbGFzcyA9ICdyaWdodCc7CnVwZGF0ZUdsb2JhbExhbmd1YWdlKCRzY29wZSwgJG5ld2xhbmcpCn0KCiRzY29wZS5hZGROZXdDbGllbnQgPSBmdW5jdGlvbigpIHsKJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jbGllbnRzL2FkZCcpOwp9CiRzY29wZS5hZGROZXdJbnN0cnVjdG9yID0gZnVuY3Rpb24oKSB7CiRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfaW5zdHJ1Y3RvcnMvYWRkJyk7Cn0KfSk7CgovLy8vLy8gYmVmb3JlIGZvcm1zCmt1emVBcHAuY29udHJvbGxlcignRGVtb0NvbnRyb2xsZXInLCBbCickc2NvcGUnLCAnJGJ1aWxkZXInLCAnJHZhbGlkYXRvcicsCmZ1bmN0aW9uKCRzY29wZSwgJGJ1aWxkZXIsICR2YWxpZGF0b3IpIHsKdmFyIGNoZWNrYm94LCB0ZXh0Ym94Owp0ZXh0Ym94ID0gJGJ1aWxkZXIuYWRkRm9ybU9iamVjdCgnZGVmYXVsdCcsIHsKaWQ6ICd0ZXh0Ym94JywKY29tcG9uZW50OiAndGV4dElucHV0JywKbGFiZWw6ICdOYW1lJywKZGVzY3JpcHRpb246ICdZb3VyIG5hbWUnLApwbGFjZWhvbGRlcjogJ1lvdXIgbmFtZScsCnJlcXVpcmVkOiB0cnVlLAplZGl0YWJsZTogZmFsc2UKfSk7CmNoZWNrYm94ID0gJGJ1aWxkZXIuYWRkRm9ybU9iamVjdCgnZGVmYXVsdCcsIHsKaWQ6ICdjaGVja2JveCcsCmNvbXBvbmVudDogJ2NoZWNrYm94JywKbGFiZWw6ICdQZXRzJywKZGVzY3JpcHRpb246ICdEbyB5b3UgaGF2ZSBhbnkgcGV0cz8nLApvcHRpb25zOiBbJ0RvZycsICdDYXQnXQp9KTsKJGJ1aWxkZXIuYWRkRm9ybU9iamVjdCgnZGVmYXVsdCcsIHsKY29tcG9uZW50OiAnc2FtcGxlSW5wdXQnCn0pOwokc2NvcGUuZm9ybSA9ICRidWlsZGVyLmZvcm1zWydkZWZhdWx0J107CiRzY29wZS5pbnB1dCA9IFtdOwokc2NvcGUuZGVmYXVsdFZhbHVlID0ge307CiRzY29wZS5kZWZhdWx0VmFsdWVbdGV4dGJveC5pZF0gPSAnZGVmYXVsdCB2YWx1ZSc7CiRzY29wZS5kZWZhdWx0VmFsdWVbY2hlY2tib3guaWRdID0gW3RydWUsIHRydWVdOwpyZXR1cm4gJHNjb3BlLnN1Ym1pdCA9IGZ1bmN0aW9uKCkgewpyZXR1cm4gJHZhbGlkYXRvci52YWxpZGF0ZSgkc2NvcGUsICdkZWZhdWx0Jykuc3VjY2VzcyhmdW5jdGlvbigpIHsKcmV0dXJuIGxvZ0RlYnVnKCdzdWNjZXNzJyk7Cn0pLmVycm9yKGZ1bmN0aW9uKCkgewpyZXR1cm4gbG9nRGVidWcoJ2Vycm9yJyk7Cn0pOwp9Owp9Cl0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdBbGVydERlbW9DdHJsJywgZnVuY3Rpb24oJHNjb3BlKSB7CiRzY29wZS5hbGVydHMgPSBbewp0eXBlOiAnZGFuZ2VyJywKbXNnOiAnT2ggc25hcCEgQ2hhbmdlIGEgZmV3IHRoaW5ncyB1cCBhbmQgdHJ5IHN1Ym1pdHRpbmcgYWdhaW4uJwp9LCB7CnR5cGU6ICdzdWNjZXNzJywKbXNnOiAnV2VsbCBkb25lISBZb3Ugc3VjY2Vzc2Z1bGx5IHJlYWQgdGhpcyBpbXBvcnRhbnQgYWxlcnQgbWVzc2FnZS4nCn1dOwoKJHNjb3BlLmFkZEFsZXJ0ID0gZnVuY3Rpb24oKSB7CiRzY29wZS5hbGVydHMucHVzaCh7Cm1zZzogJ0Fub3RoZXIgYWxlcnQhJwp9KTsKfTsKCiRzY29wZS5jbG9zZUFsZXJ0ID0gZnVuY3Rpb24oaW5kZXgpIHsKJHNjb3BlLmFsZXJ0cy5zcGxpY2UoaW5kZXgsIDEpOwp9Owp9KTsKCgpmdW5jdGlvbiBpc051bWJlcktleShldnQpewp2YXIgY2hhckNvZGUgPSAoZXZ0LndoaWNoKSA/IGV2dC53aGljaCA6IGV2ZW50LmtleUNvZGU7CnJldHVybiAhKGNoYXJDb2RlID4gMzEgJiYgKGNoYXJDb2RlIDwgNDggfHwgY2hhckNvZGUgPiA1NykpOwp9Cgo=</text>
      </register>
      <register name="2" type="2">
        <text encoding="base64">Ly8gdjExIC0gMjMgbWFyY2ggMjAxNwovL0RlZmluZSBhbiBhbmd1bGFyIG1vZHVsZSBmb3Igb3VyIGFwcAoKdmFyIGt1emVJc0NhbGVuZGFyRHJhZ2dibGU7Cmt1emVJc0NhbGVuZGFyRHJhZ2dibGUgPSB0cnVlOwoKLy8gYW5ndWxhciBtb2R1bGVzCi8vJGFuZ3VsYXJNb2R1bGVzPVsnbmdSb3V0ZScsJ3VpLmJvb3RzdHJhcCcsJ3VpLmdyaWQnXTsKJGFuZ3VsYXJNb2R1bGVzID0gWyduZ1JvdXRlJywgJ3VpLmJvb3RzdHJhcCcsICd1aS5ncmlkJywgJ2J1aWxkZXInLCAnYnVpbGRlci5jb21wb25lbnRzJywgJ3ZhbGlkYXRvci5ydWxlcycsICd1aS5jYWxlbmRhcicsICdjaGVja2xpc3QtbW9kZWwnLCAndWkuYm9vdHN0cmFwLmRhdGV0aW1lcGlja2VyJywgJ2FuZ3Vjb21wbGV0ZS1hbHQnLCAnbXVsdGlwbGVTZWxlY3QnLCdhbmd1bGFySW5saW5lRWRpdCcsJ3RleHRBbmd1bGFyJywnbmdDc3YnXTsKCnZhciBkYXlOYW1lcyA9IFsn16jXkNep15XXnycsICfXqdeg15knLCAn16nXnNeZ16nXmScsICfXqNeR15nXoteZJywgJ9eX157Xmdep15knLCAn16nXmdep15knLCAn16nXkdeqJ107CnZhciBtb250aE5hbWVzID0gWyLXmdeg15XXkNeoIiwgItek15HXqNeV15DXqCIsICLXnteo16UiLCAi15DXpNeo15nXnCIsICLXnteQ15kiLCAi15nXldeg15kiLAogICAgIteZ15XXnNeZIiwgIteQ15XXkteV16HXmCIsICLXodek15jXnteR16giLCAi15DXlden15jXldeR16giLCAi16DXldeR157XkdeoIiwgIteT16bXnteR16giCl07Cgp2YXIgbG9naW5OZXh0U2NyZWVuPSIiOwoKKGZ1bmN0aW9uKCl7RGF0ZS5zaG9ydE1vbnRocz1bIkphbiIsIkZlYiIsIk1hciIsIkFwciIsIk1heSIsIkp1biIsIkp1bCIsIkF1ZyIsIlNlcCIsIk9jdCIsIk5vdiIsIkRlYyJdLERhdGUubG9uZ01vbnRocz1bIkphbnVhcnkiLCJGZWJydWFyeSIsIk1hcmNoIiwiQXByaWwiLCJNYXkiLCJKdW5lIiwiSnVseSIsIkF1Z3VzdCIsIlNlcHRlbWJlciIsIk9jdG9iZXIiLCJOb3ZlbWJlciIsIkRlY2VtYmVyIl0sRGF0ZS5zaG9ydERheXM9WyJTdW4iLCJNb24iLCJUdWUiLCJXZWQiLCJUaHUiLCJGcmkiLCJTYXQiXSxEYXRlLmxvbmdEYXlzPVsiU3VuZGF5IiwiTW9uZGF5IiwiVHVlc2RheSIsIldlZG5lc2RheSIsIlRodXJzZGF5IiwiRnJpZGF5IiwiU2F0dXJkYXkiXTt2YXIgdD17ZDpmdW5jdGlvbigpe3JldHVybih0aGlzLmdldERhdGUoKTwxMD8iMCI6IiIpK3RoaXMuZ2V0RGF0ZSgpfSxEOmZ1bmN0aW9uKCl7cmV0dXJuIERhdGUuc2hvcnREYXlzW3RoaXMuZ2V0RGF5KCldfSxqOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZ2V0RGF0ZSgpfSxsOmZ1bmN0aW9uKCl7cmV0dXJuIERhdGUubG9uZ0RheXNbdGhpcy5nZXREYXkoKV19LE46ZnVuY3Rpb24oKXtyZXR1cm4gMD09dGhpcy5nZXREYXkoKT83OnRoaXMuZ2V0RGF5KCl9LFM6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5nZXREYXRlKCklMTA9PTEmJjExIT10aGlzLmdldERhdGUoKT8ic3QiOnRoaXMuZ2V0RGF0ZSgpJTEwPT0yJiYxMiE9dGhpcy5nZXREYXRlKCk/Im5kIjp0aGlzLmdldERhdGUoKSUxMD09MyYmMTMhPXRoaXMuZ2V0RGF0ZSgpPyJyZCI6InRoIn0sdzpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldERheSgpfSx6OmZ1bmN0aW9uKCl7dmFyIHQ9bmV3IERhdGUodGhpcy5nZXRGdWxsWWVhcigpLDAsMSk7cmV0dXJuIE1hdGguY2VpbCgodGhpcy10KS84NjRlNSl9LFc6ZnVuY3Rpb24oKXt2YXIgdD1uZXcgRGF0ZSh0aGlzLnZhbHVlT2YoKSksZT0odGhpcy5nZXREYXkoKSs2KSU3O3Quc2V0RGF0ZSh0LmdldERhdGUoKS1lKzMpO3ZhciBuPXQudmFsdWVPZigpO3JldHVybiB0LnNldE1vbnRoKDAsMSksNCE9PXQuZ2V0RGF5KCkmJnQuc2V0TW9udGgoMCwxKyg0LXQuZ2V0RGF5KCkrNyklNyksMStNYXRoLmNlaWwoKG4tdCkvNjA0OGU1KX0sRjpmdW5jdGlvbigpe3JldHVybiBEYXRlLmxvbmdNb250aHNbdGhpcy5nZXRNb250aCgpXX0sbTpmdW5jdGlvbigpe3JldHVybih0aGlzLmdldE1vbnRoKCk8OT8iMCI6IiIpKyh0aGlzLmdldE1vbnRoKCkrMSl9LE06ZnVuY3Rpb24oKXtyZXR1cm4gRGF0ZS5zaG9ydE1vbnRoc1t0aGlzLmdldE1vbnRoKCldfSxuOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZ2V0TW9udGgoKSsxfSx0OmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5nZXRGdWxsWWVhcigpLGU9dGhpcy5nZXRNb250aCgpKzE7cmV0dXJuIDEyPT09ZSYmKHQ9dCsrLGU9MCksbmV3IERhdGUodCxlLDApLmdldERhdGUoKX0sTDpmdW5jdGlvbigpe3ZhciB0PXRoaXMuZ2V0RnVsbFllYXIoKTtyZXR1cm4gdCU0MDA9PTB8fHQlMTAwIT0wJiZ0JTQ9PTB9LG86ZnVuY3Rpb24oKXt2YXIgdD1uZXcgRGF0ZSh0aGlzLnZhbHVlT2YoKSk7cmV0dXJuIHQuc2V0RGF0ZSh0LmdldERhdGUoKS0odGhpcy5nZXREYXkoKSs2KSU3KzMpLHQuZ2V0RnVsbFllYXIoKX0sWTpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldEZ1bGxZZWFyKCl9LHk6ZnVuY3Rpb24oKXtyZXR1cm4oIiIrdGhpcy5nZXRGdWxsWWVhcigpKS5zdWJzdHIoMil9LGE6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5nZXRIb3VycygpPDEyPyJhbSI6InBtIn0sQTpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldEhvdXJzKCk8MTI/IkFNIjoiUE0ifSxCOmZ1bmN0aW9uKCl7cmV0dXJuIE1hdGguZmxvb3IoMWUzKigodGhpcy5nZXRVVENIb3VycygpKzEpJTI0K3RoaXMuZ2V0VVRDTWludXRlcygpLzYwK3RoaXMuZ2V0VVRDU2Vjb25kcygpLzM2MDApLzI0KX0sZzpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldEhvdXJzKCklMTJ8fDEyfSxHOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZ2V0SG91cnMoKX0saDpmdW5jdGlvbigpe3JldHVybigodGhpcy5nZXRIb3VycygpJTEyfHwxMik8MTA/IjAiOiIiKSsodGhpcy5nZXRIb3VycygpJTEyfHwxMil9LEg6ZnVuY3Rpb24oKXtyZXR1cm4odGhpcy5nZXRIb3VycygpPDEwPyIwIjoiIikrdGhpcy5nZXRIb3VycygpfSxpOmZ1bmN0aW9uKCl7cmV0dXJuKHRoaXMuZ2V0TWludXRlcygpPDEwPyIwIjoiIikrdGhpcy5nZXRNaW51dGVzKCl9LHM6ZnVuY3Rpb24oKXtyZXR1cm4odGhpcy5nZXRTZWNvbmRzKCk8MTA/IjAiOiIiKSt0aGlzLmdldFNlY29uZHMoKX0sdTpmdW5jdGlvbigpe3ZhciB0PXRoaXMuZ2V0TWlsbGlzZWNvbmRzKCk7cmV0dXJuKDEwPnQ/IjAwIjoxMDA+dD8iMCI6IiIpK3R9LGU6ZnVuY3Rpb24oKXtyZXR1cm4vXCgoLiopXCkvLmV4ZWMoKG5ldyBEYXRlKS50b1N0cmluZygpKVsxXX0sSTpmdW5jdGlvbigpe2Zvcih2YXIgdD1udWxsLGU9MDsxMj5lOysrZSl7dmFyIG49bmV3IERhdGUodGhpcy5nZXRGdWxsWWVhcigpLGUsMSksaT1uLmdldFRpbWV6b25lT2Zmc2V0KCk7aWYobnVsbD09PXQpdD1pO2Vsc2V7aWYodD5pKXt0PWk7YnJlYWt9aWYoaT50KWJyZWFrfX1yZXR1cm4gdGhpcy5nZXRUaW1lem9uZU9mZnNldCgpPT10fDB9LE86ZnVuY3Rpb24oKXtyZXR1cm4oLXRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKTwwPyItIjoiKyIpKyhNYXRoLmFicyh0aGlzLmdldFRpbWV6b25lT2Zmc2V0KCkvNjApPDEwPyIwIjoiIikrTWF0aC5mbG9vcihNYXRoLmFicyh0aGlzLmdldFRpbWV6b25lT2Zmc2V0KCkvNjApKSsoMD09TWF0aC5hYnModGhpcy5nZXRUaW1lem9uZU9mZnNldCgpJTYwKT8iMDAiOihNYXRoLmFicyh0aGlzLmdldFRpbWV6b25lT2Zmc2V0KCklNjApPDEwPyIwIjoiIikrTWF0aC5hYnModGhpcy5nZXRUaW1lem9uZU9mZnNldCgpJTYwKSl9LFA6ZnVuY3Rpb24oKXtyZXR1cm4oLXRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKTwwPyItIjoiKyIpKyhNYXRoLmFicyh0aGlzLmdldFRpbWV6b25lT2Zmc2V0KCkvNjApPDEwPyIwIjoiIikrTWF0aC5mbG9vcihNYXRoLmFicyh0aGlzLmdldFRpbWV6b25lT2Zmc2V0KCkvNjApKSsiOiIrKDA9PU1hdGguYWJzKHRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKSU2MCk/IjAwIjooTWF0aC5hYnModGhpcy5nZXRUaW1lem9uZU9mZnNldCgpJTYwKTwxMD8iMCI6IiIpK01hdGguYWJzKHRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKSU2MCkpfSxUOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMudG9UaW1lU3RyaW5nKCkucmVwbGFjZSgvXi4rIFwoPyhbXlwpXSspXCk/JC8sIiQxIil9LFo6ZnVuY3Rpb24oKXtyZXR1cm4gNjAqLXRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKX0sYzpmdW5jdGlvbigpe3JldHVybiB0aGlzLmZvcm1hdCgiWS1tLWRcXFRIOmk6c1AiKX0scjpmdW5jdGlvbigpe3JldHVybiB0aGlzLnRvU3RyaW5nKCl9LFU6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5nZXRUaW1lKCkvMWUzfX07RGF0ZS5wcm90b3R5cGUuZm9ybWF0PWZ1bmN0aW9uKGUpe3ZhciBuPXRoaXM7cmV0dXJuIGUucmVwbGFjZSgvKFxcPykoLikvZyxmdW5jdGlvbihlLGkscil7cmV0dXJuIiI9PT1pJiZ0W3JdP3Rbcl0uY2FsbChuKTpyfSl9fSkuY2FsbCh0aGlzKTsKCmZ1bmN0aW9uIGdvdG9DbGllbnRQYWdlKGJ1c2luZXNzX3VzZXJfaWQpCnsKICB3aW5kb3cubG9jYXRpb24uaHJlZj0nLyMvYnVzaW5lc3NfY2xpZW50cy8nICsgYnVzaW5lc3NfdXNlcl9pZDsKfQpmdW5jdGlvbiBnb3RvSW5zdHJ1Y3RvclBhZ2UoYnVzaW5lc3NfdXNlcl9pZCkKewogIHdpbmRvdy5sb2NhdGlvbi5ocmVmPScvIy9idXNpbmVzc19pbnN0cnVjdG9ycy8nICsgYnVzaW5lc3NfdXNlcl9pZDsKfQoKZnVuY3Rpb24gZ290b0V2ZW50UGFnZSh0aGVldmVudCkKewogIGxvZ0RlYnVnKCJnb3RvRXZlbnRQYWdlICIrdGhlZXZlbnQpOwogIGlmICh0aGVldmVudC5pc19jbGFzcz09MSkKICB7CiAgICB3aW5kb3cubG9jYXRpb24uaHJlZj0nLyMvZXZlbnRfY2xhc3MvJyArIHRoZWV2ZW50LmV2ZW50X2lkOwogIH0KICBlbHNlCiAgewogICAgd2luZG93LmxvY2F0aW9uLmhyZWY9Jy8jL2V2ZW50LycgKyB0aGVldmVudC5ldmVudF9pZDsKICB9Cn0KCmZ1bmN0aW9uIGdvdG9Mb2NhdGlvblBhZ2UobG9jYXRpb25faWQpCnsKICBsb2dEZWJ1ZygiZ290b0xvY2F0aW9uUGFnZSAiK2xvY2F0aW9uX2lkKTsKICB3aW5kb3cubG9jYXRpb24uaHJlZj0nLyMvYnVzaW5lc3NfbG9jYXRpb25zLycgKyBsb2NhdGlvbl9pZDsKCn0KCmZ1bmN0aW9uIGdvdG9DbGllbnRFZGl0UGFnZSh1c2VyX2lkKQp7CiAgd2luZG93LmxvY2F0aW9uLmhyZWY9Jy8jL2J1c2luZXNzX2NsaWVudHMvJyArIHVzZXJfaWQgKyAnL2VkaXQnOwp9CgpmdW5jdGlvbiBnb3RvQmFjaygpCnsKICB3aW5kb3cuaGlzdG9yeS5iYWNrKCk7Cn0KCmZ1bmN0aW9uIHNob3dFdmVudFBvcHVwKHNlbGVjdGVkRXZlbnQsICR1aWJNb2RhbCkKewogIC8vIHRoaXMgZnVuY3Rpb24gdXNlZCB0byBicmluZyBhIHBvcHVwCiAgLy8gbm93IGl0IGdvZXMgdG8gdGhlIGV2ZW50IHBhZ2UKICBnb3RvRXZlbnRQYWdlKHNlbGVjdGVkRXZlbnQpOwoKICAvLyBpZiAoc2VsZWN0ZWRFdmVudC5pc19yZXBlYXRpbmcgPT0gMSkgewogIC8vICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAvLyAgICAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgLy8gICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9jbGFzc19zaW5nbGUucGhwJywKICAvLyAgICAgICAgIGNvbnRyb2xsZXI6ICdldmVudFJlY3VycmluZ0RldGFpbHNCdXNpbmVzc0NhbGVuZGFyTW9kYWxDb250cm9sbGVyJywKICAvLyAgICAgICAgIC8vIHNpemU6IHNpemUsCiAgLy8gICAgICAgICByZXNvbHZlOiB7CiAgLy8gICAgICAgICAgICAgc2VsZWN0ZWRFdmVudDogZnVuY3Rpb24oKSB7CiAgLy8gICAgICAgICAgICAgICAgIHJldHVybiBzZWxlY3RlZEV2ZW50OwogIC8vICAgICAgICAgICAgIH0KICAvLyAgICAgICAgIH0KICAvLyAgICAgfSk7CiAgLy8gfSBlbHNlIHsKICAvLyAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgLy8gICAgICAgICBhbmltYXRpb246IGZhbHNlLAogIC8vICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfZXZlbnRfc2luZ2xlLnBocCcsCiAgLy8gICAgICAgICBjb250cm9sbGVyOiAnZXZlbnREZXRhaWxzQnVzaW5lc3NDYWxlbmRhck1vZGFsQ29udHJvbGxlcicsCiAgLy8gICAgICAgICAvLyBzaXplOiBzaXplLAogIC8vICAgICAgICAgcmVzb2x2ZTogewogIC8vICAgICAgICAgICAgIHNlbGVjdGVkRXZlbnQ6IGZ1bmN0aW9uKCkgewogIC8vICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZWN0ZWRFdmVudDsKICAvLyAgICAgICAgICAgICB9CiAgLy8gICAgICAgICB9CiAgLy8gICAgIH0pOwogIC8vIH0KfQpmdW5jdGlvbiB1cGRhdGVHbG9iYWxMYW5ndWFnZSgkc2NvcGUsICRuZXdsYW5nKSB7CgogICAgLy8JdmFyIGdMYW5nPWdMYW5nQmFzZVtnTGFuZ0N1cnJdOwogICAgJGdMYW5nID0gZ0xhbmdCYXNlWyRuZXdsYW5nXTsKICAgIC8vIGxvZ0RlYnVnKCJnTGFuZ0Jhc2VbJG5ld2xhbmddWyd0aXRsZTEnXT0iICsgZ0xhbmdCYXNlWyRuZXdsYW5nXVsndGl0bGUxJ10pOwogICAgLy8gbG9nRGVidWcoImxhbmd1Z2FnZToiICsgJGdMYW5nWydsYW5ndWFnZSddKTsKICAgIC8vCWxvZ0RlYnVnKCJsYW5ndWdhZ2UgZGlyOiAiKyRnTGFuZ1snZGlyJ10pOwogICAgLy8JbG9nRGVidWcoImNoYW5naW5nIGxhbmd1YWdlIHRvICIrJG5ld2xhbmcpCiAgICAkc2NvcGUuc3BDbGFzcyA9ICRnTGFuZ1snY2xhc3MnXTsKICAgIC8vCWxvZ0RlYnVnKCJpcyBhcnJheT8gIithbmd1bGFyLmlzQXJyYXkoJGdMYW5nKSk7CiAgICAvLwlsb2dEZWJ1ZygiJGdMYW5nWydkaXInXT0iKyRnTGFuZ1snZGlyJ10pOwogICAgLy8JbG9nRGVidWcoIiRnTGFuZ1sndGl0bGUxJ109IiskZ0xhbmdbJ3RpdGxlMSddKTsKICAgICRzY29wZS5sYW5nZmlsZSA9ICRnTGFuZzsKICAgIC8vIGxvZ0RlYnVnKCJpcyBhcnJheT8gIiArIGFuZ3VsYXIuaXNBcnJheSgkc2NvcGUubGFuZ2ZpbGUpKTsKICAgIC8vIGxvZ0RlYnVnKCIkc2NvcGUubGFuZ2ZpbGU9IiArICRzY29wZS5sYW5nZmlsZSk7CiAgICAvLyBsb2dEZWJ1ZygiJHNjb3BlLmxhbmdmaWxlWyd0aXRsZTEnXT0iICsgJHNjb3BlLmxhbmdmaWxlWyd0aXRsZTEnXSk7CgogICAgJHNjb3BlLnRlc3RuZXd2YXIgPSAkc2NvcGUubGFuZ2ZpbGVbJ3RpdGxlMSddOwogICAgLy8JJHNjb3BlLm1lc3NhZ2U9JHNjb3BlLmxhbmdmaWxlWyd0aXRsZTEnXTsKfQoKZnVuY3Rpb24gZ2V0UmFuZG9tQ29sb3IoKSB7CiAgICB2YXIgbGV0dGVycyA9ICcwMTIzNDU2Nzg5QUJDREVGJy5zcGxpdCgnJyk7CiAgICB2YXIgY29sb3IgPSAnIyc7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IDY7IGkrKykgewogICAgICAgIGNvbG9yICs9IGxldHRlcnNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTYpXTsKICAgIH0KICAgIHJldHVybiBjb2xvcjsKfQoKZnVuY3Rpb24gZ2V0UmFuZG9tSW50KG1pbiwgbWF4KSB7CiAgICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKG1heCAtIG1pbiArIDEpKSArIG1pbjsKfQoKZnVuY3Rpb24gY2FsY190ZW1wX2xpbWl0X2lkKCkgewogICAgdmFyIGQgPSBuZXcgRGF0ZSgpOwogICAgdmFyIHJhbmRvbWxpbWl0ID0gZC5nZXRUaW1lKCk7CiAgICBsb2dEZWJ1ZygiY2FsY190ZW1wX2xpbWl0X2lkPSIgKyByYW5kb21saW1pdCk7CiAgICByZXR1cm4gcmFuZG9tbGltaXQ7Cn0KCnZhciAkZ0xvZ0xldmVsID0gJ2RlYnVnJzsKCi8vIHN0YXJ0aW5nCmxvZ0RlYnVnKCJtYWluICRnTG9nTGV2ZWw9IiArICRnTG9nTGV2ZWwpOwpsb2dEZWJ1ZygiaW5pdGlhbGl6ZSBhbmd1bGFyIik7CmxvZ0RlYnVnKCJpbml0aWFsaXppbmcgbW9kdWxlcyAiICsgJGFuZ3VsYXJNb2R1bGVzKTsKCnZhciBrdXplQXBwID0gYW5ndWxhci5tb2R1bGUoJ2t1emVBcHAnLCAkYW5ndWxhck1vZHVsZXMpCgovLyRyb290U2NvcGUuc3BDbGFzcyA9ICdyaWdodCc7Cmt1emVSdW4gPSBmdW5jdGlvbigpIHsKCn0Ka3V6ZUFwcC5ydW4oWwogICAgJyRidWlsZGVyJywKICAgIGZ1bmN0aW9uKCRidWlsZGVyKSB7CiAgICAgICAgLy8gbG9nRGVidWcoImluc2lkZSBrdXplQXBwLnJ1biIpOwogICAgICAgICRidWlsZGVyLnJlZ2lzdGVyQ29tcG9uZW50KCdzYW1wbGVJbnB1dCcsIHsKICAgICAgICAgICAgZ3JvdXA6ICdmcm9tIGh0bWwnLAogICAgICAgICAgICBsYWJlbDogJ1NhbXBsZScsCiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnRnJvbSBodG1sIHRlbXBsYXRlJywKICAgICAgICAgICAgcGxhY2Vob2xkZXI6ICdwbGFjZWhvbGRlcicsCiAgICAgICAgICAgIHJlcXVpcmVkOiBmYWxzZSwKICAgICAgICAgICAgdmFsaWRhdGlvbk9wdGlvbnM6IFt7CiAgICAgICAgICAgICAgICBsYWJlbDogJ25vbmUnLAogICAgICAgICAgICAgICAgcnVsZTogJy8uKi8nCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgIGxhYmVsOiAnbnVtYmVyJywKICAgICAgICAgICAgICAgIHJ1bGU6ICdbbnVtYmVyXScKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgbGFiZWw6ICdlbWFpbCcsCiAgICAgICAgICAgICAgICBydWxlOiAnW2VtYWlsXScKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgbGFiZWw6ICd1cmwnLAogICAgICAgICAgICAgICAgcnVsZTogJ1t1cmxdJwogICAgICAgICAgICB9XSwKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYW5ndWxhci1mb3JtLWJ1aWxkZXIvZXhhbXBsZS90ZW1wbGF0ZS5odG1sJywKICAgICAgICAgICAgcG9wb3ZlclRlbXBsYXRlVXJsOiAnL2FuZ3VsYXItZm9ybS1idWlsZGVyL2V4YW1wbGUvcG9wb3ZlclRlbXBsYXRlLmh0bWwnCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuICRidWlsZGVyLnJlZ2lzdGVyQ29tcG9uZW50KCduYW1lJywgewogICAgICAgICAgICBncm91cDogJ0RlZmF1bHQnLAogICAgICAgICAgICBsYWJlbDogJ05hbWUnLAogICAgICAgICAgICByZXF1aXJlZDogZmFsc2UsCiAgICAgICAgICAgIGFycmF5VG9UZXh0OiB0cnVlLAogICAgICAgICAgICB0ZW1wbGF0ZTogIjxkaXYgY2xhc3M9XCJmb3JtLWdyb3VwXCI+XG4gICAgPGxhYmVsIGZvcj1cInt7Zm9ybU5hbWUraW5kZXh9fVwiIGNsYXNzPVwiY29sLW1kLTQgY29udHJvbC1sYWJlbFwiIG5nLWNsYXNzPVwieydmYi1yZXF1aXJlZCc6cmVxdWlyZWR9XCI+e3tsYWJlbH19PC9sYWJlbD5cbiAgICA8ZGl2IGNsYXNzPVwiY29sLW1kLThcIj5cbiAgICAgICAgPGlucHV0IHR5cGU9J2hpZGRlbicgbmctbW9kZWw9XCJpbnB1dFRleHRcIiB2YWxpZGF0b3ItcmVxdWlyZWQ9XCJ7e3JlcXVpcmVkfX1cIiB2YWxpZGF0b3ItZ3JvdXA9XCJ7e2Zvcm1OYW1lfX1cIi8+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJjb2wtc20tNlwiIHN0eWxlPVwicGFkZGluZy1sZWZ0OiAwO1wiPlxuICAgICAgICAgICAgPGlucHV0IHR5cGU9XCJ0ZXh0XCJcbiAgICAgICAgICAgICAgICBuZy1tb2RlbD1cImlucHV0QXJyYXlbMF1cIlxuICAgICAgICAgICAgICAgIGNsYXNzPVwiZm9ybS1jb250cm9sXCIgaWQ9XCJ7e2Zvcm1OYW1lK2luZGV4fX0tMFwiLz5cbiAgICAgICAgICAgIDxwIGNsYXNzPSdoZWxwLWJsb2NrJz5GaXJzdCBuYW1lPC9wPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImNvbC1zbS02XCIgc3R5bGU9XCJwYWRkaW5nLWxlZnQ6IDA7XCI+XG4gICAgICAgICAgICA8aW5wdXQgdHlwZT1cInRleHRcIlxuICAgICAgICAgICAgICAgIG5nLW1vZGVsPVwiaW5wdXRBcnJheVsxXVwiXG4gICAgICAgICAgICAgICAgY2xhc3M9XCJmb3JtLWNvbnRyb2xcIiBpZD1cInt7Zm9ybU5hbWUraW5kZXh9fS0xXCIvPlxuICAgICAgICAgICAgPHAgY2xhc3M9J2hlbHAtYmxvY2snPkxhc3QgbmFtZTwvcD5cbiAgICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG48L2Rpdj4iLAogICAgICAgICAgICBwb3BvdmVyVGVtcGxhdGU6ICI8Zm9ybT5cbiAgICA8ZGl2IGNsYXNzPVwiZm9ybS1ncm91cFwiPlxuICAgICAgICA8bGFiZWwgY2xhc3M9J2NvbnRyb2wtbGFiZWwnPkxhYmVsPC9sYWJlbD5cbiAgICAgICAgPGlucHV0IHR5cGU9J3RleHQnIG5nLW1vZGVsPVwibGFiZWxcIiB2YWxpZGF0b3I9XCJbcmVxdWlyZWRdXCIgY2xhc3M9J2Zvcm0tY29udHJvbCcvPlxuICAgIDwvZGl2PlxuICAgIDxkaXYgY2xhc3M9XCJjaGVja2JveFwiPlxuICAgICAgICA8bGFiZWw+XG4gICAgICAgICAgICA8aW5wdXQgdHlwZT0nY2hlY2tib3gnIG5nLW1vZGVsPVwicmVxdWlyZWRcIiAvPlxuICAgICAgICAgICAgUmVxdWlyZWRcbiAgICAgICAgPC9sYWJlbD5cbiAgICA8L2Rpdj5cblxuICAgIDxoci8+XG4gICAgPGRpdiBjbGFzcz0nZm9ybS1ncm91cCc+XG4gICAgICAgIDxpbnB1dCB0eXBlPSdzdWJtaXQnIG5nLWNsaWNrPVwicG9wb3Zlci5zYXZlKCRldmVudClcIiBjbGFzcz0nYnRuIGJ0bi1wcmltYXJ5JyB2YWx1ZT0nU2F2ZScvPlxuICAgICAgICA8aW5wdXQgdHlwZT0nYnV0dG9uJyBuZy1jbGljaz1cInBvcG92ZXIuY2FuY2VsKCRldmVudClcIiBjbGFzcz0nYnRuIGJ0bi1kZWZhdWx0JyB2YWx1ZT0nQ2FuY2VsJy8+XG4gICAgICAgIDxpbnB1dCB0eXBlPSdidXR0b24nIG5nLWNsaWNrPVwicG9wb3Zlci5yZW1vdmUoJGV2ZW50KVwiIGNsYXNzPSdidG4gYnRuLWRhbmdlcicgdmFsdWU9J0RlbGV0ZScvPlxuICAgIDwvZGl2PlxuPC9mb3JtPiIKICAgICAgICB9KTsKICAgIH0KXSkKCmt1emVBcHAucnVuKGZ1bmN0aW9uKCRyb290U2NvcGUpIHsKICBsb2dEZWJ1ZygicnVuICRyb290U2NvcGUiKTsKICAkcm9vdFNjb3BlLiRvbignbG9hZGluZzpwcm9ncmVzcycsIGZ1bmN0aW9uICgpewogICAgICAvLyBzaG93IGxvYWRpbmcgZ2lmCiAgICAgIC8vICRzY29wZS5jdXJzb3JkZWxldGU9IndhaXQiOwogICAgICAvLyBkb2N1bWVudC5ib2R5LnN0eWxlLmN1cnNvcj0nd2FpdCc7CiAgfSk7CgogICRyb290U2NvcGUuJG9uKCdsb2FkaW5nOmZpbmlzaCcsIGZ1bmN0aW9uICgpewogICAgLy8gJHNjb3BlLmN1cnNvcmRlbGV0ZT0iIjsKICAgIC8vIGRvY3VtZW50LmJvZHkuc3R5bGUuY3Vyc29yPScnOwogIH0pOwp9KTsKCi8vIERFTEVURUQgLSB4ZWRpdGFibGUgc3R1ZmYKLy8ga3V6ZUFwcC5ydW4oZnVuY3Rpb24oZWRpdGFibGVPcHRpb25zLCBlZGl0YWJsZVRoZW1lcykgewovLyAgICAgbG9nRGVidWcoImluaXRpYWxpemluZyB4ZWRpdGFibGUgZWRpdGFibGVPcHRpb25zIik7Ci8vICAgICBlZGl0YWJsZU9wdGlvbnMudGhlbWUgPSAnYnMzJzsgLy8gYm9vdHN0cmFwMyB0aGVtZS4gQ2FuIGJlIGFsc28gJ2JzMicsICdkZWZhdWx0JwovLyAgICAgLy8gZWRpdGFibGVPcHRpb25zLmRlZmF1bHRzLm1vZGUgPSAnaW5saW5lJzsKLy8gICAgIGxvZ0RlYnVnKGVkaXRhYmxlT3B0aW9ucyk7Ci8vICAgICAvLyBlZGl0YWJsZU9wdGlvbnMubW9kZSA9ICdpbmxpbmUnOwovLyAgICAgZWRpdGFibGVUaGVtZXMuYnMzLmlucHV0Q2xhc3MgPSAnaW5wdXQtc20nOwovLyAgICAgZWRpdGFibGVUaGVtZXMuYnMzLmJ1dHRvbnNDbGFzcyA9ICdidG4tc20nOwovLyB9KTsKCi8vIGFmdGVyIGZvcm1zCi8vRGVmaW5lIFJvdXRpbmcgZm9yIGFwcAovL1VyaSAvQWRkTmV3T3JkZXIgLT4gdGVtcGxhdGUgYWRkX29yZGVyLmh0bWwgYW5kIENvbnRyb2xsZXIgQ2xpZW50c0FkZENvbnRyb2xsZXIKLy9VcmkgL1Nob3dPcmRlcnMgLT4gdGVtcGxhdGUgc2hvd19vcmRlcnMuaHRtbCBhbmQgQ29udHJvbGxlciBDbGllbnRzQWRkQ29udHJvbGxlcgprdXplQXBwLmNvbmZpZyhbJyRyb3V0ZVByb3ZpZGVyJywKICAgIGZ1bmN0aW9uKCRyb3V0ZVByb3ZpZGVyKSB7CiAgICAgICAgLy8gbG9nRGVidWcoJHJvdXRlUHJvdmlkZXIpOwogICAgICAgICRyb3V0ZVByb3ZpZGVyLgogICAgICAgIC8vIHdoZW4oJy9jbGllbnRjYXJkJywgewogICAgICAgIC8vICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19jbGllbnRfY2FyZC5odG1sJywKICAgICAgICAvLyAgICAgY29udHJvbGxlcjogJ2NsaWVudENhcmRDb250cm9sbGVyJwogICAgICAgIC8vIH0pLgogICAgICAgIHdoZW4oJy9jb250YWN0JywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdjb250YWN0LnBocCcsCiAgICAgICAgICAgIC8vIGNvbnRyb2xsZXI6ICdlbmRVc2VySG9tZUNvbnRyb2xsZXInCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdjb250YWN0Q29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvZXZlbnRfdHlwZXMnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2V2ZW50X3R5cGVzLmh0bWwnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnRXZlbnRUeXBlc0NvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2V2ZW50X3R5cGVzL2FkZCcsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfZXZlbnRfdHlwZV9hZGQucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0V2ZW50VHlwZU5ld0NvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2V2ZW50X3R5cGVzLzpldmVudF90eXBlX2lkJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19ldmVudF90eXBlX2FkZC5waHAnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnRXZlbnRUeXBlVXBkYXRlQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvaG91cnNfb2Zfd29yaycsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfaG91cnNfb2Zfd29yay5odG1sJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0hvdXJzT2ZXb3JrQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvYnVzaW5lc3NfY2FsZW5kYXInLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2NhbGVuZGFyLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdCdXNpbmVzc0NhbGVuZGFyQ29udHJvbGxlcicsCiAgICAgICAgICAgIHJlbG9hZE9uU2VhcmNoOiBmYWxzZQogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9hbmd1bGFyLWZvcm0tYnVpbGRlcicsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYW5ndWxhci1mb3JtLWJ1aWxkZXIvaW5kZXguaHRtbCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdEZW1vQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvYnVzaW5lc3NfY2xpZW50cy9hZGQnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2NsaWVudHNfYWRkLmh0bWwnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnQ2xpZW50c0FkZENvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2J1c2luZXNzX2NsaWVudHMnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2NsaWVudHMucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0NsaWVudHNTaG93Q29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvYnVzaW5lc3NfY2xpZW50cy86YnVzaW5lc3NfdXNlcl9pZCcsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6IGZ1bmN0aW9uKHBhcmFtcykgewogICAgICAgICAgICAgICAgcmV0dXJuICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfY2xpZW50X2NhcmQucGhwP2J1c2luZXNzX3VzZXJfaWQ9JyArIHBhcmFtcy5idXNpbmVzc191c2VyX2lkIDsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgY29udHJvbGxlcjogJ0NsaWVudHNTaG93MUNvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2J1c2luZXNzX3JlcG9ydHMnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX3JlcG9ydHMuaHRtbCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdCdXNpbmVzc1JlcG9ydHNDb250cm9sbGVyJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9idXNpbmVzc19pbnN0cnVjdG9ycycsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfaW5zdHJ1Y3RvcnMucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0luc3RydWN0b3JzU2hvd0NvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2J1c2luZXNzX2luc3RydWN0b3JzL2FkZCcsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfY2xpZW50c19hZGQuaHRtbCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdJbnN0cnVjdG9yc0FkZENvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2J1c2luZXNzX2xvY2F0aW9ucycsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbG9jYXRpb25zLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdidXNpbmVzc19sb2NhdGlvbnMnCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2J1c2luZXNzX2xvY2F0aW9ucy9hZGQnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2xvY2F0aW9uc19hZGQucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ2J1c2luZXNzX2xvY2F0aW9uc19hZGQnCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2J1c2luZXNzX2xvY2F0aW9ucy86bG9jYXRpb25faWQnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2xvY2F0aW9uc19hZGQucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ2J1c2luZXNzX2xvY2F0aW9uc191cGRhdGUnCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2J1c2luZXNzX2luc3RydWN0b3JzLzpidXNpbmVzc191c2VyX2lkJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19pbnN0cnVjdG9yX2NhcmQucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0luc3RydWN0b3JTaG93MUNvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2V2ZW50LzpldmVudF9pZCcsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6IGZ1bmN0aW9uKHBhcmFtcykgewogICAgICAgICAgICAgICAgcmV0dXJuICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfZXZlbnRfY2FyZC5waHA/ZXZlbnRfaWQ9JyArIHBhcmFtcy5ldmVudF9pZCA7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdFdmVudFBhZ2VDb250cm9sbGVyJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9ldmVudF9jbGFzcy86ZXZlbnRfaWQnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBmdW5jdGlvbihwYXJhbXMpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2V2ZW50X2NsYXNzX2NhcmQucGhwP2V2ZW50X2lkPScgKyBwYXJhbXMuZXZlbnRfaWQgOwogICAgICAgICAgICB9LAogICAgICAgICAgICBjb250cm9sbGVyOiAnRXZlbnRDbGFzc1BhZ2VDb250cm9sbGVyJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9wYWNrYWdlcycsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfcGFja2FnZXNfc2hvdy5waHAnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnUGFja2FnZXNDb250cm9sbGVyJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9wYWNrYWdlcy9hZGQnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX3BhY2thZ2VzX2NyZWF0ZS5waHAnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnYnVzaW5lc3NfcGFja2FnZXNfYWRkX2NudGwnCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL3BhY2thZ2VzLzpwYWNrYWdlX2lkJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19wYWNrYWdlc19jcmVhdGUucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ2J1c2luZXNzX3BhY2thZ2VzX3VwZGF0ZV9jbnRsJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9idXNpbmVzc19jb25maWcnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2NvbmZpZy5waHAnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnQ29uZmlnQnVzaW5lc3NDb250cm9sbGVyJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy91c2VyX2NvbmZpZycsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAndXNlcl9jb25maWcucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0NvbmZpZ1VzZXJDb250cm9sbGVyJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9idXNpbmVzc19kb2NzJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19kb2NzLmh0bWwnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnQnVzaW5lc3NEb2NzQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdob21lLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdIb21lQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICBvdGhlcndpc2UoewogICAgICAgICAgICAvLyAgICByZWRpcmVjdFRvOiAnLycKICAgICAgICB9KTsKICAgIH0KXSk7CgprdXplQXBwLmZhY3RvcnkoJ2h0dHBJbnRlcmNlcHRvcicsIFsnJHEnLCAnJHJvb3RTY29wZScsCiAgICBmdW5jdGlvbiAoJHEsICRyb290U2NvcGUpIHsKICAgICAgICB2YXIgbG9hZGluZ0NvdW50ID0gMDsKCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgcmVxdWVzdDogZnVuY3Rpb24gKGNvbmZpZykgewogICAgICAgICAgICAgICAgaWYoKytsb2FkaW5nQ291bnQgPT09IDEpICRyb290U2NvcGUuJGJyb2FkY2FzdCgnbG9hZGluZzpwcm9ncmVzcycpOwogICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpZyB8fCAkcS53aGVuKGNvbmZpZyk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICByZXNwb25zZTogZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICBpZigtLWxvYWRpbmdDb3VudCA9PT0gMCkgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdsb2FkaW5nOmZpbmlzaCcpOwogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlIHx8ICRxLndoZW4ocmVzcG9uc2UpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgcmVzcG9uc2VFcnJvcjogZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICBpZigtLWxvYWRpbmdDb3VudCA9PT0gMCkgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdsb2FkaW5nOmZpbmlzaCcpOwogICAgICAgICAgICAgICAgcmV0dXJuICRxLnJlamVjdChyZXNwb25zZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgfQpdKS5jb25maWcoWyckaHR0cFByb3ZpZGVyJywgZnVuY3Rpb24gKCRodHRwUHJvdmlkZXIpIHsKICAgICRodHRwUHJvdmlkZXIuaW50ZXJjZXB0b3JzLnB1c2goJ2h0dHBJbnRlcmNlcHRvcicpOwp9XSk7CgprdXplQXBwLmZhY3RvcnkoJ3NoYXJlZERhdGEnLCBmdW5jdGlvbigpIHsKICAgIHZhciBzZWxlY3RlZEVuZFVzZXIgPSBudWxsOwoKICAgIHJldHVybiB7CiAgICAgICAgZ2V0U2VsZWN0ZWRFbmRVc2VyOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgLy9Zb3UgY291bGQgYWxzbyByZXR1cm4gc3BlY2lmaWMgYXR0cmlidXRlIG9mIHRoZSBmb3JtIGRhdGEgaW5zdGVhZAogICAgICAgICAgICAvL29mIHRoZSBlbnRpcmUgZGF0YQogICAgICAgICAgICByZXR1cm4gc2VsZWN0ZWRFbmRVc2VyOwogICAgICAgIH0sCiAgICAgICAgc2V0U2VsZWN0ZWRFbmRVc2VyOiBmdW5jdGlvbihuZXdTZWxlY3RlZEVuZFVzZXIpIHsKICAgICAgICAgICAgLy9Zb3UgY291bGQgYWxzbyBzZXQgc3BlY2lmaWMgYXR0cmlidXRlIG9mIHRoZSBmb3JtIGRhdGEgaW5zdGVhZAogICAgICAgICAgICBzZWxlY3RlZEVuZFVzZXIgPSBuZXdTZWxlY3RlZEVuZFVzZXI7CiAgICAgICAgfSwKICAgIH07Cn0pOwoKa3V6ZUFwcC5kaXJlY3RpdmUoJ2NvbnZlcnRUb051bWJlcicsIGZ1bmN0aW9uKCkgewogIHJldHVybiB7CiAgICByZXF1aXJlOiAnbmdNb2RlbCcsCiAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWxlbWVudCwgYXR0cnMsIG5nTW9kZWwpIHsKICAgICAgbmdNb2RlbC4kcGFyc2Vycy5wdXNoKGZ1bmN0aW9uKHZhbCkgewogICAgICAgIHJldHVybiB2YWwgIT0gbnVsbCA/IHBhcnNlSW50KHZhbCwgMTApIDogbnVsbDsKICAgICAgfSk7CiAgICAgIG5nTW9kZWwuJGZvcm1hdHRlcnMucHVzaChmdW5jdGlvbih2YWwpIHsKICAgICAgICByZXR1cm4gdmFsICE9IG51bGwgPyAnJyArIHZhbCA6IG51bGw7CiAgICAgIH0pOwogICAgfQogIH07Cn0pOwoKa3V6ZUFwcC5kaXJlY3RpdmUoJ2VsYXN0aWMnLCBbCiAgICAnJHRpbWVvdXQnLAogICAgZnVuY3Rpb24oJHRpbWVvdXQpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICByZXN0cmljdDogJ0EnLAogICAgICAgICAgICBsaW5rOiBmdW5jdGlvbigkc2NvcGUsIGVsZW1lbnQpIHsKICAgICAgICAgICAgICAgICRzY29wZS5pbml0aWFsSGVpZ2h0ID0gJHNjb3BlLmluaXRpYWxIZWlnaHQgfHwgZWxlbWVudFswXS5zdHlsZS5oZWlnaHQ7CiAgICAgICAgICAgICAgICB2YXIgcmVzaXplID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgZWxlbWVudFswXS5zdHlsZS5oZWlnaHQgPSAkc2NvcGUuaW5pdGlhbEhlaWdodDsKICAgICAgICAgICAgICAgICAgICBlbGVtZW50WzBdLnN0eWxlLmhlaWdodCA9ICIiICsgZWxlbWVudFswXS5zY3JvbGxIZWlnaHQgKyAicHgiOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIGVsZW1lbnQub24oImlucHV0IGNoYW5nZSIsIHJlc2l6ZSk7CiAgICAgICAgICAgICAgICAvLyBlbGVtZW50Lm9uKCJpbnB1dCBjaGFuZ2UiLCByZXNpemUpOwogICAgICAgICAgICAgICAgJHRpbWVvdXQocmVzaXplLCAwKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICB9Cl0pOwoKa3V6ZUFwcC5zZXJ2aWNlKCdzaGFyZWRQcm9wZXJ0aWVzJywgZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBzZWxlY3RlZF91c2VyID0gbnVsbDsKICAgICAgICB2YXIgY2FsZW5kYXJfZGF0ZSA9IG51bGw7CiAgICAgICAgdmFyIGV2ZW50X3Jlc2NoZWR1bGUgPSBudWxsOwogICAgICAgIHZhciBzZWxlY3RlZF9pbnN0cnVjdG9yID0gMDsKICAgICAgICB2YXIgZXZlbnRfdHlwZV9mb3Jfc3VnZ2VzdGlvbnMgPSBudWxsOwogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGdldF9zZWxlY3RlZF9pbnN0cnVjdG9yOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZWN0ZWRfaW5zdHJ1Y3RvcjsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2V0X3NlbGVjdGVkX2luc3RydWN0b3I6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgICAgICAgICBzZWxlY3RlZF9pbnN0cnVjdG9yID0gdmFsdWU7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGdldF9zZWxlY3RlZF91c2VyOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZWN0ZWRfdXNlcjsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2V0X3NlbGVjdGVkX3VzZXI6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgICAgICAgICBzZWxlY3RlZF91c2VyID0gdmFsdWU7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNldF9ldmVudF9yZXNjaGVkdWxlOiBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgICAgICAgICAgZXZlbnRfcmVzY2hlZHVsZSA9IHZhbHVlOwogICAgICAgICAgICB9LAogICAgICAgICAgICBnZXRfZXZlbnRfcmVzY2hlZHVsZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGV2ZW50X3Jlc2NoZWR1bGU7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGdldF9jYWxlbmRhcl9kYXRlOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gY2FsZW5kYXJfZGF0ZTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2V0X2NhbGVuZGFyX2RhdGU6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgICAgICAgICBjYWxlbmRhcl9kYXRlID0gdmFsdWU7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGdldF9ldmVudF90eXBlX2Zvcl9zdWdnZXN0aW9uczogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGV2ZW50X3R5cGVfZm9yX3N1Z2dlc3Rpb25zOwogICAgICAgICAgICB9LAogICAgICAgICAgICBzZXRfZXZlbnRfdHlwZV9mb3Jfc3VnZ2VzdGlvbnM6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgICAgICAgICAvLyBsb2dEZWJ1Zygic2V0X2V2ZW50X3R5cGVfZm9yX3N1Z2dlc3Rpb25zPSIrdmFsdWUpOwogICAgICAgICAgICAgICAgZXZlbnRfdHlwZV9mb3Jfc3VnZ2VzdGlvbnMgPSB2YWx1ZTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICB9KTsKCmt1emVBcHAuY29udHJvbGxlcignbWVudUNvbnRyb2xsZXInLCBbJyRzY29wZScsICckbG9jYXRpb24nLCBmdW5jdGlvbigkc2NvcGUsICRsb2NhdGlvbikgewogICAgcmV0dXJuIHRydWU7CiAgICBsb2dEZWJ1ZygiJHNjb3BlLmlzQ3VycmVudFBhdGg9IiArICRzY29wZS5pc0N1cnJlbnRQYXRoKTsKICAgICRzY29wZS5pc0N1cnJlbnRQYXRoID0gZnVuY3Rpb24ocGF0aCkgewogICAgICAgIHJldHVybiAkbG9jYXRpb24ucGF0aCgpID09IHBhdGg7CiAgICB9Owp9XSk7CgoKCmt1emVBcHAuY29udHJvbGxlcignQnVzaW5lc3NSZXBvcnRzQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbiwkcm91dGVQYXJhbXMpCnsKCiAgbG9nRGVidWcoImNvbnRyb2xsZXI6IEJ1c2luZXNzUmVwb3J0c0NvbnRyb2xsZXIiKTsKCiAgJHNjb3BlLm9yZGVyQnlGaWVsZCA9ICdzdGFydF9lcG9jaCc7CiAgJHNjb3BlLnJldmVyc2VTb3J0PXRydWU7CiAgJHNjb3BlLmV2ZW50TW9kZWw9dHJ1ZTsKCiAgZ2V0QnVzaW5lc3NMb2NhdGlvbnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19sb2NhdGlvbnMnKTsKICBnZXRBbGxCdXNpbmVzc0V2ZW50VHlwZXMoJGh0dHAsJHNjb3BlLCdldmVudF90eXBlcycpOwogIGdldEFsbEluc3RydWN0b3JzKCRodHRwLCRzY29wZSwnaW5zdHJ1Y3RvcnMnKTsKICBnZXRBbGxDbGllbnRzQW5kQXJjaGl2ZSgkaHR0cCwkc2NvcGUsJ2NsaWVudHMnKTsKICAkc2NvcGUuc3RhdHVzZXMgPSBbIHsic3RhdHVzX2lkIjoiMCIsInN0YXR1c19uYW1lIjoi16TXqteV15cifSwgeyJzdGF0dXNfaWQiOiIxIiwic3RhdHVzX25hbWUiOiLXodeS15XXqCJ9XTsKICAkc2NvcGUuY2FuY2VsbGF0aW9ucyA9IFsgeyJpc19jYW5jZWxlZCI6IjAiLCJjYW5jZWxsYXRpb25fbmFtZSI6Itec15Ag15HXldeY15wifSx7ImlzX2NhbmNlbGVkIjoiMSIsImNhbmNlbGxhdGlvbl9uYW1lIjoi15HXldeY15wifV07CiAgJHNjb3BlLm1vbnRocyA9IFsgeyJtb250aCI6IjEifSx7Im1vbnRoIjoiMiJ9LHsibW9udGgiOiIzIn0seyJtb250aCI6IjQifSx7Im1vbnRoIjoiNSJ9LHsibW9udGgiOiI2In0seyJtb250aCI6IjcifSx7Im1vbnRoIjoiOCJ9LHsibW9udGgiOiI5In0seyJtb250aCI6IjEwIn0seyJtb250aCI6IjExIn0seyJtb250aCI6IjEyIn1dOwogICRzY29wZS55ZWFycyA9IFsgeyJ5ZWFyIjoiMjAxNiJ9LHsieWVhciI6IjIwMTcifV07CiAgJHNjb3BlLnBlcmlvZHMgPSBbCiAgICAgIHsicGVyaW9kX25hbWUiOiLXlNeZ16HXmNeV16jXmSIsICJwZXJpb2Rfc2lnbiI6Ii0xIn0sCiAgICAgIHsicGVyaW9kX25hbWUiOiLXlNeZ15XXnSIsICJwZXJpb2Rfc2lnbiI6IjAifSwKICAgICAgeyJwZXJpb2RfbmFtZSI6Itei16rXmdeT15kiLCAicGVyaW9kX3NpZ24iOiIxIn0sCiAgICBdCgogICRzY29wZS5jc3ZfY29sdW1uc19vcmRlciA9IFsnZXZlbnRfdHlwZV9uYW1lJywgJ3N0YXJ0X3RpbWUnLCAnZXZlbnRfdXNlcl9jbGllbnRzJywgJ2luc3RydWN0b3JfbmFtZScsICdpc19jYW5jZWxlZCcsICdpc19jb21wbGV0ZWQnLCAnYWN0dWFsX3ByaWNlJywgJ3BhcnRpY2lwYXRlZCddOwogICRzY29wZS5jc3ZfY29sdW1uc19oZWFkZXIgPSBbJ9eh15XXkiDXntek15LXqScsICfXqteQ16jXmdeaINeV16nXoteUJywgJ9ee16nXqteq16TXmdedJywgJ9ee15PXqNeZ15onLCfXnteR15XXmNecJywgJ9eh15LXldeoJywgJ9ee15fXmdeoJywgJ9ee16nXqteq16TXmdedJ107CgoKCiAgJHNjb3BlLmdvdG9DbGllbnRQYWdlPSBmdW5jdGlvbiAoYnVzaW5lc3NVc2VyaWQpIHsKICAgIGdvdG9DbGllbnRQYWdlKGJ1c2luZXNzVXNlcmlkKTsKICB9CgogIGZ1bmN0aW9uIGxpc3RfdG9fc3RyaW5nX2J5X3ZhbHVlKHgsdmFsdWUpewogICAgaWYgKCB4ICE9IHVuZGVmaW5lZCApewogICAgICB2YXIgeDEgPSBuZXcgQXJyYXkoKTsKICAgICAgZm9yIChpID0gMDsgaSA8IHgubGVuZ3RoOyBpKyspewogICAgICAgIHgxW2ldID0geFtpXVt2YWx1ZV07CiAgICAgIH0KICAgICAgeDEgPSB4MS5qb2luKCk7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICByZXR1cm4geDE7CiAgfQoKICAkc2NvcGUucmVwb3J0X2lzX2xvYWRpbmcgPSBmYWxzZTsKCiRzY29wZS5ldmVudHNSZXBvcnQgPSBmdW5jdGlvbigpewpsb2dEZWJ1ZygiZXZlbnRzUmVwb3J0Iik7Cgokc2NvcGUuc2hvd0FnZyA9ICgkc2NvcGUuZXZlbnRUeXBlTW9kZWwpIHx8Cigkc2NvcGUuaW5zdHJ1Y3Rvck1vZGVsKSB8fCAoJHNjb3BlLm1vbnRoTW9kZWwpIHx8ICgkc2NvcGUuY2xpZW50c01vZGVsKSB8fCAoJHNjb3BlLnllYXJNb2RlbCkgOwoKZXZlbnRfdHlwZV9pZF9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuc2VsZWN0ZWRFdmVudFR5cGVGaWx0ZXIsICJldmVudF90eXBlX2lkIiApOwppbnN0cnVjdG9yX2lkX2ZpbHRlciA9IGxpc3RfdG9fc3RyaW5nX2J5X3ZhbHVlKCRzY29wZS5zZWxlY3RlZEluc3RydWN0b3JGaWx0ZXIsICJidXNpbmVzc191c2VyX2lkIiApOwptb250aF9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuc2VsZWN0ZWRNb250aEZpbHRlciwgIm1vbnRoIiApOwpjbGllbnRfZmlsdGVyID0gbGlzdF90b19zdHJpbmdfYnlfdmFsdWUoJHNjb3BlLnNlbGVjdGVkQ2xpZW50RmlsdGVyLCAiYnVzaW5lc3NfdXNlcl9pZCIgKTsKeWVhcl9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuc2VsZWN0ZWRZZWFyRmlsdGVyLCAieWVhciIgKTsKc3RhdHVzX2ZpbHRlciA9IGxpc3RfdG9fc3RyaW5nX2J5X3ZhbHVlKCRzY29wZS5zZWxlY3RlZFN0YXR1c0ZpbHRlciwgInN0YXR1c19pZCIgKTsKaXNfY2FuY2VsZWRfZmlsdGVyID0gbGlzdF90b19zdHJpbmdfYnlfdmFsdWUoJHNjb3BlLnNlbGVjdGVkSXNfY2FuY2VsZWRGaWx0ZXIsICJpc19jYW5jZWxlZCIgKTsKcGVyaW9kX2ZpbHRlciA9IGxpc3RfdG9fc3RyaW5nX2J5X3ZhbHVlKCRzY29wZS5zZWxlY3RlZFBlcmlvZEZpbHRlciwgInBlcmlvZF9zaWduIiApOwoKJHNjb3BlLmV2ZW50UmVwb3J0Q29uZmlnID0ge307CgogICAgJHNjb3BlLmV2ZW50UmVwb3J0Q29uZmlnLnNvdXJjZSA9ICJkb2NzIjsKCiRzY29wZS5ldmVudFJlcG9ydENvbmZpZy5maWx0ZXJzID0gewpldmVudF90eXBlX2lkOiBldmVudF90eXBlX2lkX2ZpbHRlciwKaW5zdHJ1Y3Rvcl9pZDogaW5zdHJ1Y3Rvcl9pZF9maWx0ZXIsCm1vbnRoOiBtb250aF9maWx0ZXIsCnllYXI6IHllYXJfZmlsdGVyLApjbGllbnQ6IGNsaWVudF9maWx0ZXIsCnN0YXR1czogc3RhdHVzX2ZpbHRlciwKcGVyaW9kOiBwZXJpb2RfZmlsdGVyLAppc19jYW5jZWxlZDogaXNfY2FuY2VsZWRfZmlsdGVyCn07Cgokc2NvcGUuZXZlbnRSZXBvcnRDb25maWcuYWdncmVnYXRpb25zID0gewpldmVudF90eXBlX2lkOiAkc2NvcGUuZXZlbnRUeXBlTW9kZWwsCmluc3RydWN0b3JfaWQ6ICRzY29wZS5pbnN0cnVjdG9yTW9kZWwsCm1vbnRoOiAkc2NvcGUubW9udGhNb2RlbCwKeWVhcjogJHNjb3BlLnllYXJNb2RlbCwKY2xpZW50OiAkc2NvcGUuY2xpZW50TW9kZWwsCn07CgppZiAoICRzY29wZS5zaG93QWdnICkgewogICAgICBnZXRFdmVudHNSZXBvcnQoJGh0dHAsJHNjb3BlLCAkc2NvcGUuZXZlbnRSZXBvcnRDb25maWcsIGdldEV2ZW50c1JlcG9ydEFnZ3JlZ2F0ZWRfc3VjY2Vzcyk7CiRzY29wZS5yZXBvcnRfaXNfbG9hZGluZyA9IHRydWU7Cn0gZWxzZSB7CiAgICAgIGdldEV2ZW50c1JlcG9ydCgkaHR0cCwkc2NvcGUsICRzY29wZS5ldmVudFJlcG9ydENvbmZpZywgZ2V0RXZlbnRzUmVwb3J0TGlzdF9zdWNjZXNzKTsKJHNjb3BlLnJlcG9ydF9pc19sb2FkaW5nID0gdHJ1ZTsKfQoKZnVuY3Rpb24gZ2V0RXZlbnRzUmVwb3J0TGlzdF9zdWNjZXNzKHJlc3BvbnNlKXsKJHNjb3BlLkV2ZW50UmVwb3J0TGlzdCA9IHJlc3BvbnNlLmpzb247CiRzY29wZS5kb3dubG9hZF9yZXBvcnQgPSAkc2NvcGVbICdFdmVudFJlcG9ydExpc3QnIF07CiRzY29wZS5yZXBvcnRfaXNfbG9hZGluZyA9IGZhbHNlOwp9CgpmdW5jdGlvbiBnZXRFdmVudHNSZXBvcnRBZ2dyZWdhdGVkX3N1Y2Nlc3MocmVzcG9uc2Upewokc2NvcGUuRXZlbnRSZXBvcnRBZ2dyZWdhdGVkID0gcmVzcG9uc2UuanNvbjsKJHNjb3BlLmRvd25sb2FkX3JlcG9ydCA9ICRzY29wZVsgJ0V2ZW50UmVwb3J0QWdncmVnYXRlZCcgXTsKJHNjb3BlLnJlcG9ydF9pc19sb2FkaW5nID0gZmFsc2U7Cn0KCmZ1bmN0aW9uIGdldENsaWVudHNSZXBvcnRMaXN0X3N1Y2Nlc3MocmVzcG9uc2Upewokc2NvcGUuQ2xpZW50c1JlcG9ydExpc3QgPSByZXNwb25zZS5qc29uOwpjb25zb2xlLmxvZygiLS0tLS0tLS0tLS0tIikKY29uc29sZS5sb2coJHNjb3BlLkNsaWVudHNSZXBvcnRMaXN0KQpjb25zb2xlLmxvZygiLS0tLS0tLS0tLS0tIikKJHNjb3BlLnJlcG9ydF9pc19sb2FkaW5nID0gZmFsc2U7Cn0KCgp9Cgokc2NvcGUuY2xpZW50c1JlcG9ydCA9IGZ1bmN0aW9uKCl7CmxvZ0RlYnVnKCJjbGllbnRzUmVwb3J0Iik7CgpjbGllbnRfZmlsdGVyID0gbGlzdF90b19zdHJpbmdfYnlfdmFsdWUoJHNjb3BlLnNlbGVjdGVkQ2xpZW50RmlsdGVyLCAiY2xpZW50IiApOwoKJHNjb3BlLmV2ZW50UmVwb3J0Q29uZmlnID0ge307Cgokc2NvcGUuZXZlbnRSZXBvcnRDb25maWcuZmlsdGVycyA9IHsKY2xpZW50OiBjbGllbnRfZmlsdGVyLAp9OwoKJHNjb3BlLmV2ZW50UmVwb3J0Q29uZmlnLmFnZ3JlZ2F0aW9ucyA9IHsKfTsKCmdldENsaWVudHNSZXBvcnQoJGh0dHAsJHNjb3BlLCBnZXRDbGllbnRzUmVwb3J0X3N1Y2Nlc3MpOwokc2NvcGUucmVwb3J0X2lzX2xvYWRpbmcgPSB0cnVlOwpmdW5jdGlvbiBnZXRDbGllbnRzUmVwb3J0X3N1Y2Nlc3MocmVzcG9uc2Upewokc2NvcGUuY2xpZW50UmVwb3J0ID0gcmVzcG9uc2UuanNvbjsKJHNjb3BlLmRvd25sb2FkX3JlcG9ydCA9ICRzY29wZVsgJ2NsaWVudFJlcG9ydCcgXTsKJHNjb3BlLnJlcG9ydF9pc19sb2FkaW5nID0gZmFsc2U7Cn0KfQoKJHNjb3BlLmVkaXRFdmVudD0gZnVuY3Rpb24gKHRoZWV2ZW50KQp7CmdvdG9FdmVudFBhZ2UodGhlZXZlbnQpOwp9Cgokc2NvcGUuZXZlbnRzUmVwb3J0KCk7CiRzY29wZS5zZWxlY3RlZFJlcG9ydD0iZXZlbnRzIjsKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2J1c2luZXNzX3BhY2thZ2VzX3VwZGF0ZV9jbnRsJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uLCRyb3V0ZVBhcmFtcykKewokc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyID0ge307IC8vIHRoZXNlIGFyZSB0aGUgY29tcGxldGUgZGV0YWlscyBmb3IgdGhlIG5ldyBldmVudCAvLwokc2NvcGUucGFja2FnZV9pc191cGRhdGUgPSB0cnVlOwokc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLnBhY2thZ2VfbGltaXRfdHlwZT0xOwoKLy8gZ2V0dHRpbmcgdGhlIHBhY2thZ2UgYW5kIGl0cyBldmVudCB0eXBlcwpnZXRCdXNpbmVzc1BhY2thZ2UoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5wYWNrYWdlX2lkLCdmb3JtQWRkUGFja2FnZUFuZ3VsYXInLGZ1bmN0aW9uKHJlc3BvbnNlKQp7CiRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuaXNfdXBkYXRlID0gdHJ1ZTsKJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5vcmlnRXZlbnRUeXBlcz1hbmd1bGFyLmNvcHkoJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5zZWxlY3RlZEV2ZW50VHlwZXMpOwokc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLnBhY2thZ2VfbGltaXRfdHlwZT0xOwovLyB0aGVuIGdldHRpbmcgYWxsIHRoZSBldmVudCB0eXBlcwpnZXRFdmVudFR5cGVzTm9BZG1pbigkaHR0cCwkc2NvcGUsJ3JlbGF0ZWRFdmVudFR5cGVzJyxnZXRFdmVudFR5cGVzTm9BZG1pbl9zdWNjZXNzKTsKZnVuY3Rpb24gZ2V0RXZlbnRUeXBlc05vQWRtaW5fc3VjY2VzcygpCnsKLy8gdGhlbiByZW1vdmluZyBleGlzdGluZyBldmVudCB0eXBlcyBvZiBwYWNrYWdlIGZyb20gbGlzdAovLyBjb25zb2xlLmxvZygkc2NvcGUucmVsYXRlZEV2ZW50VHlwZXNbMF0pOwovLyBjb25zb2xlLmxvZygkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLnNlbGVjdGVkRXZlbnRUeXBlc1swXSk7CmZvcih2YXIgaSA9IDA7IGkgPCAkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLnNlbGVjdGVkRXZlbnRUeXBlcy5sZW5ndGg7IGkrKykKewovLyBjb3B5aW5nIHRoZSBhY3R1YWwgb2JqZWN0IG9mICRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuc2VsZWN0ZWRFdmVudFR5cGVzW2ldCmZvcih2YXIgaiA9IDA7IGogPCAkc2NvcGUucmVsYXRlZEV2ZW50VHlwZXMubGVuZ3RoOyBqKyspCnsKaWYgKCRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuc2VsZWN0ZWRFdmVudFR5cGVzW2ldLmV2ZW50X3R5cGVfaWQ9PSRzY29wZS5yZWxhdGVkRXZlbnRUeXBlc1tqXS5ldmVudF90eXBlX2lkKQp7CiRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuc2VsZWN0ZWRFdmVudFR5cGVzW2ldPWFuZ3VsYXIuY29weSgkc2NvcGUucmVsYXRlZEV2ZW50VHlwZXNbal0pOwp9Cn0KfQp9Cn0pOwokc2NvcGUuZ290b0JhY2sgPSBnb3RvQmFjazsKJHNjb3BlLmNyZWF0ZVBhY2thZ2UgPSBmdW5jdGlvbigpCnsKY29uc29sZS5sb2coInVwZGF0ZVBhY2thZ2VEZXRhaWxzIik7CnVwZGF0ZVBhY2thZ2VEZXRhaWxzKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMucGFja2FnZV9pZCwkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLHN1Y2Nlc3NfY2FsbGJhY2ssIGZhaWx1cmVfY2FsbGJhY2spOwpmdW5jdGlvbiBzdWNjZXNzX2NhbGxiYWNrKCkKewpnb3RvQmFjaygpOwp9CmZ1bmN0aW9uIGZhaWx1cmVfY2FsbGJhY2soKQp7CmdvdG9CYWNrKCk7Cn0KfTsKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2J1c2luZXNzX3BhY2thZ2VzX2FkZF9jbnRsJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uKSB7CmxvZ0RlYnVnKCdidXNpbmVzc19wYWNrYWdlc19hZGRfY250bCcpOwokc2NvcGUucGFja2FnZV9pc191cGRhdGUgPSBmYWxzZTsKJHNjb3BlLmdvdG9CYWNrID0gZ290b0JhY2s7CiRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIgPSB7fTsKJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5ldmVudHNfY291bnRlciA9IDE7CiRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuZXZlbnRzX3Blcl93ZWVrID0gMTsKJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5wYWNrYWdlX2R1cmF0aW9uX21vbnRocyA9IDM7CiRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIucGFja2FnZV9saW1pdF90eXBlPTE7CmdldEV2ZW50VHlwZXNOb0FkbWluKCRodHRwLCRzY29wZSwncmVsYXRlZEV2ZW50VHlwZXMnKTsKCiRzY29wZS5jcmVhdGVQYWNrYWdlID0gZnVuY3Rpb24oKQp7CmNyZWF0ZVBhY2thZ2UoJGh0dHAsJHNjb3BlLCRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIsY3JlYXRlUGFja2FnZV9zdWNjZXNzLCBjcmVhdGVQYWNrYWdlX2ZhaWx1cmUpOwpmdW5jdGlvbiBjcmVhdGVQYWNrYWdlX3N1Y2Nlc3MoKQp7CiRsb2NhdGlvbi5wYXRoKCcvcGFja2FnZXMnKTsKfQpmdW5jdGlvbiBjcmVhdGVQYWNrYWdlX2ZhaWx1cmUoKQp7Ci8vIGxvZ0Vycm9yKCJlcnJvciAiICsgZGF0YS5tZXNzYWdlKTsKLy8gJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5hamF4X2Vycm9yID0gZGF0YS5tZXNzYWdlOwp9Cn0KfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2J1c2luZXNzX2xvY2F0aW9ucycsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikgewpsb2dEZWJ1ZygnYnVzaW5lc3NfbG9jYXRpb25zIGNvbnRyb2xsZXInKTsKZ2V0QnVzaW5lc3NMb2NhdGlvbnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19sb2NhdGlvbnMnKTsKJHNjb3BlLmFkZE5ld0xvY2F0aW9uID0gZnVuY3Rpb24gKCkKewokbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2xvY2F0aW9ucy9hZGQnKTsKfQokc2NvcGUuZ290b0xvY2F0aW9uUGFnZSA9IGZ1bmN0aW9uKGxvY2F0aW9uX2lkKQp7CmdvdG9Mb2NhdGlvblBhZ2UobG9jYXRpb25faWQpOwp9Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignQnVzaW5lc3NEb2NzQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikgewpsb2dEZWJ1ZygnQnVzaW5lc3NEb2NzQ29udHJvbGxlcicpOwp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ2J1c2luZXNzX2xvY2F0aW9uc191cGRhdGUnLCBmdW5jdGlvbigkc2NvcGUsICRyb3V0ZVBhcmFtcywgJGh0dHAsICRsb2NhdGlvbikgewpsb2dEZWJ1ZygnYnVzaW5lc3NfbG9jYXRpb25zX3VwZGF0ZSBjb250cm9sbGVyJyk7CiRzY29wZS5pc191cGRhdGU9dHJ1ZTsKLy8gZ2V0QnVzaW5lc3NMb2NhdGlvbnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19sb2NhdGlvbnMnKTsKZ2V0QnVzaW5lc3NMb2NhdGlvbigkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmxvY2F0aW9uX2lkLCdjdXJyX2xvY2F0aW9uJyxnZXRCdXNpbmVzc0xvY2F0aW9uX3N1Y2Nlc3MpOwpmdW5jdGlvbiBnZXRCdXNpbmVzc0xvY2F0aW9uX3N1Y2Nlc3MoKQp7CiRzY29wZS5mb3JtQWRkTG9jYXRpb25Bbmd1bGFyPSRzY29wZS5jdXJyX2xvY2F0aW9uWzBdOwp9CgoKJHNjb3BlLmFkZExvY2F0aW9uID0gZnVuY3Rpb24oKQp7Ci8vIGluIHRoaXMgY2FzZSAtIHVwZGF0ZSBsb2NhdGlvbgp0aGVkYXRhID0gJHNjb3BlLmZvcm1BZGRMb2NhdGlvbkFuZ3VsYXI7CgpmdW5jdGlvbiBhZGRMb2NhdGlvbl9zdWNjZXNzKCkKewokbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2xvY2F0aW9ucycpOwp9CmZ1bmN0aW9uIGFkZExvY2F0aW9uX2ZhaWx1cmUoKQp7CiRzY29wZS5mb3JtQWRkTG9jYXRpb25Bbmd1bGFyLmFqYXhfZXJyb3IgPSByZXNwb25zZS5tZXNzYWdlOwp9CnVwZGF0ZUxvY2F0aW9uKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMubG9jYXRpb25faWQsIHRoZWRhdGEsYWRkTG9jYXRpb25fc3VjY2VzcyxhZGRMb2NhdGlvbl9mYWlsdXJlKTsKfQp9KTsKCmt1emVBcHAuY29udHJvbGxlcignYnVzaW5lc3NfbG9jYXRpb25zX2FkZCcsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikgewpsb2dEZWJ1ZygnYnVzaW5lc3NfbG9jYXRpb25zX2FkZCBjb250cm9sbGVyJyk7CmdldEJ1c2luZXNzTG9jYXRpb25zKCRodHRwLCRzY29wZSwnYnVzaW5lc3NfbG9jYXRpb25zJyk7CiRzY29wZS5pc191cGRhdGU9ZmFsc2U7Cgokc2NvcGUuYWRkTG9jYXRpb24gPSBmdW5jdGlvbigpCnsKdGhlZGF0YSA9ICRzY29wZS5mb3JtQWRkTG9jYXRpb25Bbmd1bGFyOwoKZnVuY3Rpb24gYWRkTG9jYXRpb25fc3VjY2VzcygpCnsKJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19sb2NhdGlvbnMnKTsKfQpmdW5jdGlvbiBhZGRMb2NhdGlvbl9mYWlsdXJlKCkKewokc2NvcGUuZm9ybUFkZExvY2F0aW9uQW5ndWxhci5hamF4X2Vycm9yID0gcmVzcG9uc2UubWVzc2FnZTsKfQphZGRMb2NhdGlvbigkaHR0cCwkc2NvcGUsdGhlZGF0YSxhZGRMb2NhdGlvbl9zdWNjZXNzLGFkZExvY2F0aW9uX2ZhaWx1cmUpOwp9Cn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdJbnN0cnVjdG9yc0FkZENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkbG9jYXRpb24pIHsKbG9nRGVidWcoJ0luc3RydWN0b3JzQWRkQ29udHJvbGxlcicpOwokc2NvcGUuaXNJbnN0cnVjdG9yPXRydWU7CiRzY29wZS51c2VydHlwZT0iaW5zdHJ1Y3RvciI7CiRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhciA9IHt9Owokc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIuaXNfdXBkYXRlPWZhbHNlOwokc2NvcGUuYWRkQ2xpZW50ID0gZnVuY3Rpb24oKSAvLyBhZGQgaW5zdHJ1Y3RvciwgdXNpbmcgdGhlIHNhbWUgZnVuY3Rpb24gbmFtZSBhcyB3ZSB1c2UgdGhlIHNhbWUgc2NyZWVuCnsKdGhlZGF0YSA9ICRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhcjsKCmZ1bmN0aW9uIGFkZEluc3RydWN0b3Jfc3VjY2VzcygpCnsKJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19pbnN0cnVjdG9ycycpOwp9CmZ1bmN0aW9uIGFkZENsaWVudF9mYWlsdXJlKCkKewokc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIuYWpheF9lcnJvciA9IHJlc3BvbnNlLm1lc3NhZ2U7Cn0KYWRkSW5zdHJ1Y3RvcigkaHR0cCwkc2NvcGUsdGhlZGF0YSxhZGRJbnN0cnVjdG9yX3N1Y2Nlc3MpOwp9Cn0pOwprdXplQXBwLmNvbnRyb2xsZXIoJ0NsaWVudHNBZGRDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJHRpbWVvdXQsICRsb2NhdGlvbiwgc2hhcmVkUHJvcGVydGllcykgewpsb2dEZWJ1ZygnQ2xpZW50c0FkZENvbnRyb2xsZXIgLSBUaGlzIGlzIEFkZCBuZXcgY2xpZW50IHNjcmVlbicpOwokc2NvcGUuaXNJbnN0cnVjdG9yPWZhbHNlOwoKJHNjb3BlLnVzZXJ0eXBlPSJlbmR1c2VyIjsKJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyID0ge307CiRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5pc191cGRhdGU9ZmFsc2U7CiRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5kaXNhYmxlX3Bob25lX2VkaXRpbmc9ZmFsc2U7CgppZiAoKCRzY29wZS5maWx0ZXIuVmFsdWUgIT0gIiIpICYmICh0eXBlb2YgJHNjb3BlLmZpbHRlci5WYWx1ZSAhPSAndW5kZWZpbmVkJykpIHsKbG9nRGVidWcoImNsaWVudHMgZmlsdGVyIGlzIG5vdCBlbXB0eSIpOwp2YXIgZmlsdGVyID0gU3RyaW5nKCRzY29wZS5maWx0ZXIuVmFsdWUpOwppZiAoZmlsdGVyLmluZGV4T2YoIiAiKSA+IDApIHsKJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyLmZpcnN0X25hbWUgPSBmaWx0ZXIuc3Vic3RyKDAsIGZpbHRlci5pbmRleE9mKCIgIikpOwokc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIubGFzdF9uYW1lID0gZmlsdGVyLnN1YnN0cigxICsgZmlsdGVyLmluZGV4T2YoIiAiKSk7Cn0gZWxzZSB7CiRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5maXJzdF9uYW1lID0gZmlsdGVyOwokc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIubGFzdF9uYW1lID0gIiI7Cn0KJHNjb3BlLmZpbHRlci5WYWx1ZSA9ICIiOwokc2NvcGUuZmlsdGVyLmJ1dHRvblZhbHVlID0gIiI7Cn0gZWxzZSB7Cn0KCiRzY29wZS5nb3RvQmFjayA9IGZ1bmN0aW9uKCkKewokbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2NsaWVudHMnKTsKfQoKJHNjb3BlLmFkZENsaWVudCA9IGZ1bmN0aW9uKCkKewp0aGVkYXRhID0gJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyOwoKZnVuY3Rpb24gYWRkQ2xpZW50X3N1Y2Nlc3ModXNlcl9pZCkKewppZiAoJHNjb3BlLnNhdmVfYW5kX3NjaGVkdWxlKQp7Ci8vICRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfY2xpZW50cy8nK3VzZXJfaWQuanNvbik7CmxvZ0RlYnVnKCJORVcgdXNlciB1c2VyX2lkPSIrdXNlcl9pZC5qc29uKTsKCnVzZXJfaW5mbz0gewpidXNpbmVzc191c2VyX2lkOiB1c2VyX2lkLmpzb24sCmJ1c2VyX2ZpcnN0X25hbWU6ICRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5idXNlcl9maXJzdF9uYW1lLApidXNlcl9sYXN0X25hbWU6ICRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5idXNlcl9sYXN0X25hbWUKfTsKCnNoYXJlZFByb3BlcnRpZXMuc2V0X3NlbGVjdGVkX3VzZXIodXNlcl9pbmZvKTsKJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jYWxlbmRhcicpOwoKfQplbHNlCnsKJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jbGllbnRzLycpOwp9CmNvbnNvbGUubG9nKCJuZXcgdXNlciBpZCA9ICIrdXNlcl9pZC5qc29uKTsKfQpmdW5jdGlvbiBhZGRDbGllbnRfZmFpbHVyZShyZXNwb25zZSkKewokc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIuYWpheF9lcnJvciA9IHJlc3BvbnNlLm1lc3NhZ2U7CiR0aW1lb3V0KGZ1bmN0aW9uKCkKewokc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIuYWpheF9lcnJvcj1udWxsOwp9LCAyNTAwKTsKfQphZGRDbGllbnQoJGh0dHAsJHNjb3BlLHRoZWRhdGEsYWRkQ2xpZW50X3N1Y2Nlc3MsIGFkZENsaWVudF9mYWlsdXJlLGZhbHNlKTsKfQp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ1BhY2thZ2VzQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikgewpsb2dEZWJ1ZygnUGFja2FnZXNDb250cm9sbGVyJyk7CmdldEJ1c2luZXNzUGFja2FnZXMoJGh0dHAsJHNjb3BlLCdwYWNrYWdlcycpOwoKJHNjb3BlLnNob3dQYWNrYWdlID0gZnVuY3Rpb24gKHRoZXBhY2thZ2UpCnsKJGxvY2F0aW9uLnBhdGgoJy9wYWNrYWdlcy8nK3RoZXBhY2thZ2UucGFja2FnZV9pZCk7Cn0KfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdJbnN0cnVjdG9yc1Nob3dDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uKSB7CmxvZ0RlYnVnKCdJbnN0cnVjdG9yc1Nob3dDb250cm9sbGVyJyk7CiRzY29wZS5vcmRlckJ5RmllbGQgPSAnYnVzZXJfc3RhcnRfZGF0ZSc7CiRzY29wZS5yZXZlcnNlU29ydD10cnVlOwoKZ2V0QWxsSW5zdHJ1Y3RvcnMoJGh0dHAsJHNjb3BlLCdhbGxDbGllbnRzJyxnZXRBbGxJbnN0cnVjdG9yc19zdWNjZXNzKTsKZnVuY3Rpb24gZ2V0QWxsSW5zdHJ1Y3RvcnNfc3VjY2VzcygpCnsKJHNjb3BlLnNob3dDbGllbnRzR3JpZE9wdGlvbnMuZGF0YT0kc2NvcGUuYWxsQ2xpZW50czsKfQoKJHNjb3BlLmdvdG9JbnN0cnVjdG9yUGFnZT0gZnVuY3Rpb24gKGJ1c2luZXNzX3VzZXJfaWQpCnsKZ290b0luc3RydWN0b3JQYWdlKGJ1c2luZXNzX3VzZXJfaWQpOwp9Cgokc2NvcGUuY2xpZW50TmFtZUZpbHRlcj0iIjsKJHNjb3BlLmlucHV0RmlsdGVyID0gZnVuY3Rpb24gKGl0ZW0pCnsKLy8gY29uc29sZS5sb2coaXRlbS5idXNlcl9waG9uZV9udW1iZXIpOwpyZXR1cm4gZmlsdGVyX2ZpcnN0bGFzdF9uYW1lKGl0ZW0uYnVzZXJfZmlyc3RfbmFtZSxpdGVtLmJ1c2VyX2xhc3RfbmFtZSxpdGVtLmJ1c2VyX3Bob25lX251bWJlciwkc2NvcGUuY2xpZW50TmFtZUZpbHRlcik7Cn07Cn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdDbGllbnRzU2hvd0NvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICR1aWJNb2RhbCwgJGh0dHAsICRsb2NhdGlvbikgewpsb2dEZWJ1ZygnQ2xpZW50c1Nob3dDb250cm9sbGVyJyk7CiRzY29wZS5vcmRlckJ5RmllbGQgPSAnYnVzZXJfc3RhcnRfZGF0ZSc7CiRzY29wZS5yZXZlcnNlU29ydD10cnVlOwoKZ2V0QWxsQ2xpZW50cygkaHR0cCwkc2NvcGUsJ2FsbENsaWVudHMnLGdldENsaWVudF9zdWNjZXNzKTsKZnVuY3Rpb24gZ2V0Q2xpZW50X3N1Y2Nlc3MoKQp7CiRzY29wZS5zaG93Q2xpZW50c0dyaWRPcHRpb25zLmRhdGE9JHNjb3BlLmFsbENsaWVudHM7Cn0KCiRzY29wZS5nb3RvQ2xpZW50UGFnZT0gZnVuY3Rpb24gKGJ1c2luZXNzVXNlcmlkKQp7CmdvdG9DbGllbnRQYWdlKGJ1c2luZXNzVXNlcmlkKTsKfQoKLy8gZmlsdGVyIGFyY2hpdmVkIGNsaWVudHMKJHNjb3BlLnNob3dBcmNoaXZlZENoZWNrYm94PWZhbHNlOwokc2NvcGUuc2hvd0FyY2hpdmVkID0gZnVuY3Rpb24gKGVjbGllbnQpCnsKaWYgKGVjbGllbnQuaXNfYWN0aXZlPT0wKQp7CmxvZ0RlYnVnKGVjbGllbnQpOwppZiAoJHNjb3BlLnNob3dBcmNoaXZlZENoZWNrYm94KQp7CnJldHVybiBlY2xpZW50Owp9Cn0KZWxzZSB7CnJldHVybiBlY2xpZW50Owp9Cn07Cgokc2NvcGUuY2xpZW50TmFtZUZpbHRlcj0iIjsKJHNjb3BlLmlucHV0RmlsdGVyID0gZnVuY3Rpb24gKGl0ZW0pCnsKICAgICAgLy8gY29uc29sZS5sb2coImNsaWVudE5hbWVGaWx0ZXIiKTsKcmV0dXJuIGZpbHRlcl9maXJzdGxhc3RfbmFtZShpdGVtLmJ1c2VyX2ZpcnN0X25hbWUsaXRlbS5idXNlcl9sYXN0X25hbWUsaXRlbS5idXNlcl9waG9uZV9udW1iZXIsJHNjb3BlLmNsaWVudE5hbWVGaWx0ZXIpOwp9OwoKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXM9W107Ci8vICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzID0gWwovLyAgIHsiZmllbGRfaWQiOjAsImZpZWxkX25hbWUiOiLXqteQ16jXmdeaINec15nXk9eUIiwiZmllbGRfZGF0YXR5cGUiOiJEQVRFIiwiaXNfbWFuZGF0b3J5IjowLCAiZnJvbWRiIjogZmFsc2UsICJkYl9pZF90b2ZpeCI6IDAsICJpc19hY3RpdmUiOiAxLCAibW9kaWZpZWQiOiBmYWxzZX0sCi8vICAgeyJmaWVsZF9pZCI6MCwiZmllbGRfbmFtZSI6IteU16LXqNeV16oiLCJmaWVsZF9kYXRhdHlwZSI6IlRFWFRfQVJFQSIsImlzX21hbmRhdG9yeSI6MCwgImZyb21kYiI6IGZhbHNlLCAiZGJfaWRfdG9maXgiOiAwLCAiaXNfYWN0aXZlIjogMSwgIm1vZGlmaWVkIjogZmFsc2V9Ci8vIF07CgpmdW5jdGlvbiBnZXRDbGllbnRzRXh0cmFGaWVsZHNfc3VjY2VzcygpCnsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMgPSAkc2NvcGUuZXh0cmFGaWVsZHM7Cn0KZ2V0Q2xpZW50c0V4dHJhRmllbGRzKCRodHRwLCRzY29wZSwnZXh0cmFGaWVsZHMnLGdldENsaWVudHNFeHRyYUZpZWxkc19zdWNjZXNzKTsKCiRzY29wZS5ldmVudFR5cGVFeHRyYUZpZWxkc1BvcCA9IGZ1bmN0aW9uKGV2ZW50VHlwZVByb3BlcnRpZXMpIHsKICAgICAgICBsb2dEZWJ1ZygiZXZlbnRUeXBlRXh0cmFGaWVsZHNQb3AzIik7Cgp2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKYW5pbWF0aW9uOiBmYWxzZSwKdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfY2xpZW50X2V4dHJhX2ZpZWxkcy5waHAnLApjb250cm9sbGVyOiAnZXZlbnRUeXBlRXh0cmFGaWVsZHNNb2RhbENvbnRyb2xsZXInLApzaXplOiAnbCcsCnJlc29sdmU6IHsKZXZlbnRUeXBlUHJvcGVydGllczogZnVuY3Rpb24oKSB7CnJldHVybiBldmVudFR5cGVQcm9wZXJ0aWVzOwp9Cn0KfSk7Cgptb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHNlbGVjdGVkSXRlbSkgewpsb2dEZWJ1ZyhzZWxlY3RlZEl0ZW0pOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyA9IHNlbGVjdGVkSXRlbTsKfSwgZnVuY3Rpb24oKSB7CmxvZ0RlYnVnKCdNb2RhbCBkaXNtaXNzZWQgYXQ6ICcgKyBuZXcgRGF0ZSgpKTsKfSk7Cn07Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignc2NoZWR1bGVyQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRyb3V0ZVBhcmFtcykgewpldmVudF90eXBlX2lkPSRyb3V0ZVBhcmFtcy5ldmVudF90eXBlX2lkOwoKJHNjb3BlLnN1Z2dlc3Rpb25EYXRlID0gW107CiRzY29wZS5zdWdnZXN0aW9uRGF0ZS5kYXRlID0gbmV3IERhdGUoKTsKJHNjb3BlLnN1Z2dlc3Rpb25EYXRlLm9wdGlvbnMgPSB7Ci8vIG1pbkRhdGU6IG5ldyBEYXRlKCksCi8vIHNob3dXZWVrczogdHJ1ZSwKbWluVmlldzonZGF5JywKc3RhcnRWaWV3OiAnZGF5JwoKfTsKdmFyIHRoZXRpbWUgPSBuZXcgRGF0ZSgpOwokc2NvcGUuZmlsdGVyQWxsRGF5c0NoZWNrYm94PXRydWU7CiRzY29wZS5maWx0ZXJEYXlJdGVtcyA9IHsKCifXqNeQ16nXldefJzogdHJ1ZSwKJ9ep16DXmSc6IHRydWUsCifXqdec15nXqdeZJzogdHJ1ZSwKJ9eo15HXmdei15knOiB0cnVlLAon15fXnteZ16nXmSc6IHRydWUsCifXqdeZ16nXmSc6IHRydWUsCifXqdeR16onOiB0cnVlCn07Cgokc2NvcGUub25UaW1lU2V0ID0gZnVuY3Rpb24gKG5ld0RhdGUsIG9sZERhdGUpIHsKbG9nRGVidWcoIm5ldyBkYXRlICIrbmV3RGF0ZS5nZXRUaW1lKCkgKyAiIG9sZCBkYXRlICIrb2xkRGF0ZS5nZXRUaW1lKCkpOwpkaWZmPW5ld0RhdGUuZ2V0VGltZSgpLW9sZERhdGUuZ2V0VGltZSgpOwovLyBpZiBuZXcgZGF0ZSBpcyBpbiBhIGRpZmZlcmVudCB3ZWVrCi8vIHdlIHJlZmV0Y2ggc3VnZ2VzdGlvbnMgZm9yIHRoZSBjdXJyZW50IHdlZWsKdmFyIG5ld0RhdGVXID0gbmV3IERhdGUobmV3RGF0ZSk7CnZhciBvbGREYXRlVyA9IG5ldyBEYXRlKG9sZERhdGUpOwovLyBhbGVydChuZXdEYXRlVy5mb3JtYXQoJ1cnKSk7Ci8vIGFsZXJ0KG9sZERhdGVXLmZvcm1hdCgnVycpKTsKaWYgKG5ld0RhdGVXLmZvcm1hdCgnVycpIT1vbGREYXRlVy5mb3JtYXQoJ1cnKSkKewpsb2dEZWJ1ZygiZGlmZiBpcyBhIHdlZWsgb3IgbW9yZSwgcmVmZXRjaGluZyBzdWdnZXN0aW9ucyIpOwokaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3QvIitldmVudF90eXBlX2lkKyIvIituZXdEYXRlLmdldEZ1bGxZZWFyKCkrIi8iKyhuZXdEYXRlLmdldE1vbnRoKCkrMSkrIi8iK25ld0RhdGUuZ2V0RGF0ZSgpKyIvIituZXdEYXRlLmdldEhvdXJzKCkgKyAiLyIgKyBuZXdEYXRlLmdldE1pbnV0ZXMoKSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkgewovLwkgICAgJHNjb3BlLm15RGF0YSA9IHJlc3BvbnNlLmRhdGE7Ci8vCQlsb2dEZWJ1ZygiZ3JpZG9wdGlvbnM9Iiskc2NvcGUuZ3JpZE9wdGlvbnMpOwokc2NvcGUuZXZlbnRzU3VnZ2VzdGVkID0gcmVzcG9uc2UuZGF0YTsKfSk7Cgp9Cn0KCiRzY29wZS5vcHRpb25zID0gewpjdXN0b21DbGFzczogZ2V0RGF5Q2xhc3MsCm1pbkRhdGU6IG5ldyBEYXRlKCksCnNob3dXZWVrczogdHJ1ZQp9Owokc2NvcGUuZHQgPSBuZXcgRGF0ZSgpOwoKCmZ1bmN0aW9uIGdldERheUNsYXNzKGRhdGEpIHsKcmV0dXJuICcnOwp9Cgokc2NvcGUuZGF5c0l0ZW1zID0gWwp7bmFtZTon16jXkNep15XXnyd9LAp7bmFtZTon16nXoNeZJ30sCntuYW1lOifXqdec15nXqdeZJ30sCntuYW1lOifXqNeR15nXoteZJ30sCntuYW1lOifXl9ee15nXqdeZJ30sCntuYW1lOifXqdeZ16nXmSd9LAp7bmFtZTon16nXkdeqJ30KXTsKCiRzY29wZS5maWx0ZXJBbGxEYXlJdGVtc1NldCA9IGZ1bmN0aW9uICgpCnsKJHNjb3BlLmZpbHRlckRheUl0ZW1zWyfXqNeQ16nXldefJ109JHNjb3BlLmZpbHRlckFsbERheXNDaGVja2JveDsKJHNjb3BlLmZpbHRlckRheUl0ZW1zWyfXqdeg15knXT0kc2NvcGUuZmlsdGVyQWxsRGF5c0NoZWNrYm94Owokc2NvcGUuZmlsdGVyRGF5SXRlbXNbJ9ep15zXmdep15knXT0kc2NvcGUuZmlsdGVyQWxsRGF5c0NoZWNrYm94Owokc2NvcGUuZmlsdGVyRGF5SXRlbXNbJ9eo15HXmdei15knXT0kc2NvcGUuZmlsdGVyQWxsRGF5c0NoZWNrYm94Owokc2NvcGUuZmlsdGVyRGF5SXRlbXNbJ9eX157Xmdep15knXT0kc2NvcGUuZmlsdGVyQWxsRGF5c0NoZWNrYm94Owokc2NvcGUuZmlsdGVyRGF5SXRlbXNbJ9ep15nXqdeZJ109JHNjb3BlLmZpbHRlckFsbERheXNDaGVja2JveDsKJHNjb3BlLmZpbHRlckRheUl0ZW1zWyfXqdeR16onXT0kc2NvcGUuZmlsdGVyQWxsRGF5c0NoZWNrYm94Owp9Cgokc2NvcGUuc3VnZ2VzdEZpbHRlckRheXMgPSBmdW5jdGlvbiAoZXN1Z2dlc3QpCnsKLy8gbG9nRGVidWcoZXN1Z2dlc3QpOwppZiAoKCRzY29wZS5maWx0ZXJEYXlJdGVtc1tlc3VnZ2VzdC5zdGFydF9mb3JtYXRfZG93XSkgJiAoKCRzY29wZS5zdWdnZXN0aW9uRGF0ZS5kYXRlLmdldFRpbWUoKS8xMDAwKTxlc3VnZ2VzdC5zdGFydF9lcG9jaCkpCnsKcmV0dXJuIGVzdWdnZXN0Owp9Cn07Cgpsb2dEZWJ1Zygnc2NoZWR1bGVyQ29udHJvbGxlciBmb3IgZXZlbnQgdHlwZSBpZCAnK2V2ZW50X3R5cGVfaWQrIiAiK3RoZXRpbWUuZ2V0SG91cnMoKSArICI6IiArIHRoZXRpbWUuZ2V0TWludXRlcygpICsgIjoiICsgdGhldGltZS5nZXRTZWNvbmRzKCkpOwokaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3QvIitldmVudF90eXBlX2lkKyIvIit0aGV0aW1lLmdldEZ1bGxZZWFyKCkrIi8iKyh0aGV0aW1lLmdldE1vbnRoKCkrMSkrIi8iK3RoZXRpbWUuZ2V0RGF0ZSgpKyIvIit0aGV0aW1lLmdldEhvdXJzKCkgKyAiLyIgKyB0aGV0aW1lLmdldE1pbnV0ZXMoKSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkgewovLwkgICAgJHNjb3BlLm15RGF0YSA9IHJlc3BvbnNlLmRhdGE7Ci8vCQlsb2dEZWJ1ZygiZ3JpZG9wdGlvbnM9Iiskc2NvcGUuZ3JpZE9wdGlvbnMpOwokc2NvcGUuZXZlbnRzU3VnZ2VzdGVkID0gcmVzcG9uc2UuZGF0YTsKfSk7CgokaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRfdHlwZXMvIitldmVudF90eXBlX2lkKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7Ci8vCSAgICAkc2NvcGUubXlEYXRhID0gcmVzcG9uc2UuZGF0YTsKLy8JCWxvZ0RlYnVnKCJncmlkb3B0aW9ucz0iKyRzY29wZS5ncmlkT3B0aW9ucyk7CiRzY29wZS5ldmVudFR5cGVEZXRhaWxzID0gcmVzcG9uc2UuZGF0YTsKfSk7Cn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdjb250YWN0Q29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHApIHsKbG9nRGVidWcoJ2NvbnRhY3RDb250cm9sbGVyJyk7Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcigncGFja2FnZVBheW1lbnRBc3NvY2lhdGlvbk1vZGFsQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHJvdXRlUGFyYW1zLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIGZwYWNrYWdlLCBiYWxhbmNlLCBidXNpbmVzc191c2VyX2lkLCB1aUNhbGVuZGFyQ29uZmlnKQp7CmxvZ0RlYnVnKCJwYWNrYWdlUGF5bWVudEFzc29jaWF0aW9uTW9kYWxDb250cm9sbGVyIik7Cgokc2NvcGUuZnBhY2thZ2U9ZnBhY2thZ2U7CiRzY29wZS5iYWxhbmNlPWJhbGFuY2U7CiRzY29wZS5wYWNrYWdlX3BheW1lbnRzPSRzY29wZS5mcGFja2FnZS5wYWNrYWdlX3BheW1lbnRzOwokc2NvcGUucHJldmlvdXNfaXNfYWxsX3BhaWQ9JHNjb3BlLmZwYWNrYWdlLmlzX2FsbF9wYWlkOwokc2NvcGUuYnVzaW5lc3NfdXNlcl9pZD1idXNpbmVzc191c2VyX2lkOwoKLy8gJ2NhbGN1bGF0aW5nJyBwcmV2aW91cyBzdGF0dXMgb2YgcGF5bWVudAppZiAoJHNjb3BlLnBhY2thZ2VfcGF5bWVudHM+MCkKewppZiAoJHNjb3BlLnByZXZpb3VzX2lzX2FsbF9wYWlkPT0xKQp7CiRzY29wZS5wcmV2aW91c19zdGF0dXM9ImlzX2FsbF9wYWlkIjsKJHNjb3BlLnBhY2thZ2Vfc3RhdHVzX2lkPS0xOwokc2NvcGUucHJldmlvdXNfcGFja2FnZV9zdGF0dXNfaWQ9LTE7Cn0KZWxzZQp7CiRzY29wZS5wcmV2aW91c19zdGF0dXM9ImlzX3BhcnRseV9wYWlkIjsKJHNjb3BlLnBhY2thZ2Vfc3RhdHVzX2lkPS0xOwokc2NvcGUucHJldmlvdXNfcGFja2FnZV9zdGF0dXNfaWQ9LTE7Cn0KfQplbHNlCnsKJHNjb3BlLnByZXZpb3VzX3N0YXR1cz0ibm90X3BhaWQiOwokc2NvcGUucGFja2FnZV9zdGF0dXNfaWQ9MDsKJHNjb3BlLnByZXZpb3VzX3BhY2thZ2Vfc3RhdHVzX2lkPTA7Cgp9CmxvZ0RlYnVnKCJwcmV2aW91c19zdGF0dXM9Iiskc2NvcGUucHJldmlvdXNfc3RhdHVzKTsKCiRzY29wZS5jbG9zZU1vZGFsID0gZnVuY3Rpb24oKQp7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKfTsKJHNjb3BlLnVwZGF0ZVBhY2thZ2VQYXltZW50ID0gZnVuY3Rpb24oKQp7Ci8vIGNvbnNvbGUubG9nKCJwcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ9Iiskc2NvcGUuZm1lZXRpbmcucHJldmlvdXNfcGFja2FnZV91c2VyX2lkKTsKLy8gY29uc29sZS5sb2coInBhY2thZ2VfdXNlcl9pZD0iKyRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQpOwpsb2dEZWJ1ZygidXBkYXRlUGFja2FnZVBheW1lbnQiKQovLyBpZiBzZWxlY3RlZCBwYWNrYWdlIGlzIGxpa2UgcHJldmlvdXMgcGFja2FnZSAtIGRvIG5vdGhpbmcKaWYgKCgkc2NvcGUucHJldmlvdXNfcGFja2FnZV9zdGF0dXNfaWQ9PSRzY29wZS5wYWNrYWdlX3N0YXR1c19pZCkpCnsKbG9nRGVidWcoInNlbGVjdGVkIG9wdGlvbiBpcyBsaWtlIHByZXZpb3VzIG9wdGlvbiAtIGRvIG5vdGhpbmciKTsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwp9CgovLyBwcmV2aW91cyBwYWNrYWdlIHdhcyBwYWlkL3BhcnRseS1wYWlkIC0gbm93IG5vdGhpbmdzIGlzIHNlbGVjdGVkCmVsc2UgaWYgKCgkc2NvcGUucHJldmlvdXNfcGFja2FnZV9zdGF0dXNfaWQ9PS0xKSAmJiAoJHNjb3BlLnBhY2thZ2Vfc3RhdHVzX2lkPT0wKSkKewpsb2dEZWJ1Zygid2FzIHBhaWQvcGFydGx5IHBhaWQsIHJlbW92aW5nIHBheW1lbnQiKTsKcmVtb3ZlUGFja2FnZVBheW1lbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5mcGFja2FnZS5wYWNrYWdlX3VzZXJfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwp9Ci8vIHByZXZpb3VzIHBhY2thZ2Ugd2FzIHNlbGVjdGVkIC0gbm93IGEgZGlmZmVyZW50IHBhY2thZ2UgaXMgc2VsZWN0ZWQKZWxzZSBpZiAoKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3N0YXR1c19pZD09MCkgJiYgKCRzY29wZS5wYWNrYWdlX3N0YXR1c19pZD09LTEpKQp7CmxvZ0RlYnVnKCJ3YXMgbm90IHBhaWQgLSBub3cgcGF5IGZ1bGx5L3BhcnRpYWxseSIpOwpwYXlGb3JQYWNrYWdlKCRodHRwLCRzY29wZSwkc2NvcGUuZnBhY2thZ2UucGFja2FnZV91c2VyX2lkLCRzY29wZS5idXNpbmVzc191c2VyX2lkLHVwZGF0ZUV2ZW50UGFja2FnZV9zdWNjZXNzKTsKCi8vIHJlYXNzaWduRXZlbnRQYWNrYWdlQXNzb2NpYXRpb24oJGh0dHAsJHNjb3BlLCRzY29wZS5mbWVldGluZy5ldmVudF9pZCwkc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkLCRzY29wZS5idXNpbmVzc191c2VyX2lkLHVwZGF0ZUV2ZW50UGFja2FnZV9zdWNjZXNzKTsKfQp9CgpmdW5jdGlvbiB1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2VzcygpCnsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwpsb2dEZWJ1ZygiYnJvYWRjYXN0aW5nIGNsaWVudFBhZ2VSZWxvYWREYXRhIik7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKfQoKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2V2ZW50UGFja2FnZUFzc29jaWF0aW9uTW9kYWxDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkcm91dGVQYXJhbXMsICRyb290U2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgZm1lZXRpbmcsIGJhbGFuY2UsIGJ1c2luZXNzX3VzZXJfaWQsIHVpQ2FsZW5kYXJDb25maWcpCnsKJHNjb3BlLmZtZWV0aW5nPWFuZ3VsYXIuY29weShmbWVldGluZyk7CiRzY29wZS5iYWxhbmNlPWJhbGFuY2U7CiRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ9JHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZDsKJHNjb3BlLnByZXZpb3VzX2V2ZW50X3BheW1lbnRzPSRzY29wZS5mbWVldGluZy5ldmVudF9wYXltZW50czsKJHNjb3BlLnByZXZpb3VzX2lzX2FsbF9wYWlkPSRzY29wZS5mbWVldGluZy5pc19hbGxfcGFpZDsKJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQ9YnVzaW5lc3NfdXNlcl9pZDsKCi8vICdjYWxjdWxhdGluZycgcHJldmlvdXMgc3RhdHVzIG9mIHBheW1lbnQKaWYgKCRzY29wZS5wcmV2aW91c19ldmVudF9wYXltZW50cz4wKQp7CmlmICgkc2NvcGUucHJldmlvdXNfaXNfYWxsX3BhaWQ9PTEpCnsKJHNjb3BlLnByZXZpb3VzX3N0YXR1cz0iaXNfYWxsX3BhaWQiOwp9CmVsc2UKewokc2NvcGUucHJldmlvdXNfc3RhdHVzPSJpc19wYXJ0bHlfcGFpZCI7Cn0KfQplbHNlCnsKaWYgKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ+MCkKewokc2NvcGUucHJldmlvdXNfc3RhdHVzPSJpc19wYWNrYWdlX3BhaWQiOwp9CmVsc2UKewokc2NvcGUucHJldmlvdXNfc3RhdHVzPSJub3RfcGFpZCI7Cn0KfQpsb2dEZWJ1ZygicHJldmlvdXNfc3RhdHVzPSIrJHNjb3BlLnByZXZpb3VzX3N0YXR1cyk7CgppZiAoKCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQ9PTApICYmICgkc2NvcGUuZm1lZXRpbmcuZXZlbnRfcGF5bWVudHM+MCkpCnsKLy8gdGhpcyBpcyBhIGNhc2Ugd2hlcmUgcGF5bWVudCB3YXMgcGFydGx5IG9yIGZ1bGx5IG1hZGUgZnJvbSBiYWxhbmNlCiRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQ9LTE7CiRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ9LTE7Cn0KCmxvZ0RlYnVnKCJldmVudFBhY2thZ2VBc3NvY2lhdGlvbk1vZGFsQ29udHJvbGxlciIpOwpnZXRQYWNrYWdlc0ZvckV2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJ3JlbGF0ZWRQYWNrYWdlcycsZ2V0UGFja2FnZXNGb3JFdmVudF9zdWNjZXNzKTsgLy8gd2FzIGdldEJ1c2luZXNzUGFja2FnZQpmdW5jdGlvbiBnZXRQYWNrYWdlc0ZvckV2ZW50X3N1Y2Nlc3MoKQp7Cn0KCiRzY29wZS5jbG9zZU1vZGFsID0gZnVuY3Rpb24oKQp7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKfTsKJHNjb3BlLnVwZGF0ZUV2ZW50UGFja2FnZSA9IGZ1bmN0aW9uKCkKewpjb25zb2xlLmxvZygicHJldmlvdXNfcGFja2FnZV91c2VyX2lkPSIrJHNjb3BlLmZtZWV0aW5nLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZCk7CmNvbnNvbGUubG9nKCJwYWNrYWdlX3VzZXJfaWQ9Iiskc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkKTsKLy8gaWYgc2VsZWN0ZWQgcGFja2FnZSBpcyBsaWtlIHByZXZpb3VzIHBhY2thZ2UgLSBkbyBub3RoaW5nCmlmICgoJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD09JHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZCkpCnsKbG9nRGVidWcoInNlbGVjdGVkIG9wdGlvbiBpcyBsaWtlIHByZXZpb3VzIG9wdGlvbiAtIGRvIG5vdGhpbmciKTsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwp9Ci8vIGlmIHNlbGVjdGVkIHBhY2thZ2UgaXMgbGlrZSBwcmV2aW91cyBwYWNrYWdlIC0gZG8gbm90aGluZwppZiAoKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ9PSRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQpICYmICgkc2NvcGUucHJldmlvdXNfcGFja2FnZV91c2VyX2lkPjApKQp7CmxvZ0RlYnVnKCJzZWxlY3RlZCBwYWNrYWdlIGlzIGxpa2UgcHJldmlvdXMgcGFja2FnZSAtIGRvIG5vdGhpbmciKTsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwp9Ci8vIHByZXZpb3VzIHBhY2thZ2Ugd2FzIHNlbGVjdCAtIG5vdyBub3RoaW5ncyBpcyBzZWxlY3RlZAplbHNlIGlmICgoJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD4wKSAmJiAoJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZD09MCkpCnsKbG9nRGVidWcoIm5vIHBhY2thZ2Ugc2VsZWN0ZWQsIHJlbW92ZSBwYWNrYWdlLWV2ZW50IGFzc29jaWF0aW9uIik7CnJlbW92ZUV2ZW50UGFja2FnZUFzc29jaWF0aW9uKCRodHRwLCRzY29wZSwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwp9Ci8vIHByZXZpb3VzIHBhY2thZ2Ugd2FzIHNlbGVjdGVkIC0gbm93IGEgZGlmZmVyZW50IHBhY2thZ2UgaXMgc2VsZWN0ZWQKZWxzZSBpZiAoKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ+MCkgJiYgKCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQ+MCkpCnsKbG9nRGVidWcoInVwZGF0aW5nIG5ldyBwYWNrYWdlIHRvIHBhY2thZ2VfdXNlcl9pZD0gIiskc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkKTsKcmVhc3NpZ25FdmVudFBhY2thZ2VBc3NvY2lhdGlvbigkaHR0cCwkc2NvcGUsJHNjb3BlLmZtZWV0aW5nLmV2ZW50X2lkLCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwp9Ci8vIHByZXZpb3VzIHBhY2thZ2Ugd2FzIG5vbmUgLSBub3cgYSBwYWNrYWdlIGlzIHNlbGVjdGVkCmVsc2UgaWYgKCgkc2NvcGUucHJldmlvdXNfcGFja2FnZV91c2VyX2lkPT0wKSAmJiAoJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZD4wKSkKewpsb2dEZWJ1ZygidXBkYXRpbmcgbmV3IHBhY2thZ2UgdG8gcGFja2FnZV91c2VyX2lkPSAiKyRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQpOwpyZWFzc2lnbkV2ZW50UGFja2FnZUFzc29jaWF0aW9uKCRodHRwLCRzY29wZSwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZCwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCx1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2Vzcyk7Cn0KLy8gcHJldmlvdXMgYXNzb2NpYXRpb24gd2FzIHBhaWQgb3IgaGFsZiBwYWlkIC0gbm93IGl0cyBub25lCmVsc2UgaWYgKCgkc2NvcGUucHJldmlvdXNfZXZlbnRfcGF5bWVudHM+MCkgJiYgKCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQ9PTApKQp7CmxvZ0RlYnVnKCJyZW1vdmluZyBwYXltZW50IGZyb20gZXZlbnQsIHBhY2thZ2VfdXNlcl9pZD0gIiskc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkKTsKcmVtb3ZlRXZlbnRQYXltZW50QXNzb2NpYXRpb24oJGh0dHAsJHNjb3BlLCRzY29wZS5mbWVldGluZy5ldmVudF9pZCwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCx1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2Vzcyk7CgovLyByZWFzc2lnbkV2ZW50UGFja2FnZUFzc29jaWF0aW9uKCRodHRwLCRzY29wZSwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZCwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCx1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2Vzcyk7Ci8vIHRvZG8KfQovLyB3YXMgcGFja2FnZSBwYXltZW50IC0+IG5vdyBiYWxhbmNlIHBheW1lbnQKZWxzZSBpZiAoKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ+MCkgJiYgKCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQ9PS0xKSkKewpsb2dEZWJ1ZygibW92aW5nIHBheW1lbnQgZnJvbSBwYWNrYWdlIHRvIGJhbGFuY2UiKTsKYWRkRXZlbnRQYXltZW50UmVtb3ZlUGFja2FnZSgkaHR0cCwkc2NvcGUsJHNjb3BlLmZtZWV0aW5nLmV2ZW50X2lkLCRzY29wZS5idXNpbmVzc191c2VyX2lkLHVwZGF0ZUV2ZW50UGFja2FnZV9zdWNjZXNzKTsKfQovLyB3YXMgYmFsYW5jZSBwYXltZW50IC0+IG5vdyBwYWNrYWdlIHBheW1lbnQKZWxzZSBpZiAoKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ9PS0xKSAmJiAoJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZD4wKSkKewpsb2dEZWJ1ZygibW92aW5nIHBheW1lbnQgZnJvbSBiYWxhbmNlIHRvIHBhY2thZ2UiKTsKYWRkRXZlbnRQYWNrYWdlUmVtb3ZlUGF5bWVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLmZtZWV0aW5nLmV2ZW50X2lkLCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwoKfQovLyB3YXMgbm90IHBhaWQgYXQgYWxsIC0+IG5vdyBiYWxhbmNlIHBheQplbHNlIGlmICgoJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD09MCkgJiYgKCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQ9PS0xKSkKewpsb2dEZWJ1ZygibW92aW5nIHBheW1lbnQgZnJvbSBub25lIHRvIGJhbGFuY2UiKTsKYWRkRXZlbnRQYXltZW50QXNzb2NpYXRpb24oJGh0dHAsJHNjb3BlLCRzY29wZS5mbWVldGluZy5ldmVudF9pZCwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCx1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2Vzcyk7Cn0KfQoKZnVuY3Rpb24gdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MoKQp7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKbG9nRGVidWcoImJyb2FkY2FzdGluZyBjbGllbnRQYWdlUmVsb2FkRGF0YSIpOwokcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NsaWVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCn0KCn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignYXJjaGl2ZV9jbGllbnRfbW9kYWwnLCBmdW5jdGlvbigkc2NvcGUsICRsb2NhdGlvbiwgaXNfaW5zdHJ1Y3RvciwgYnVzaW5lc3NfdXNlcl9pZCwgYnVzZXJfZmlyc3RfbmFtZSwgYnVzZXJfbGFzdF9uYW1lLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIHVpQ2FsZW5kYXJDb25maWcpIHsKJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQ9YnVzaW5lc3NfdXNlcl9pZDsKJHNjb3BlLmJ1c2VyX2ZpcnN0X25hbWU9YnVzZXJfZmlyc3RfbmFtZTsKJHNjb3BlLmJ1c2VyX2xhc3RfbmFtZT1idXNlcl9sYXN0X25hbWU7CiRzY29wZS5pc19pbnN0cnVjdG9yPWlzX2luc3RydWN0b3I7Cgpsb2dEZWJ1ZygiYXJjaGl2ZV9jbGllbnRfbW9kYWwgY29udHJvbGxlciIpOwoKJHNjb3BlLmNsb3NlTW9kYWwgPSBmdW5jdGlvbigpIHsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwp9OwoKJHNjb3BlLmFyY2hpdmVDbGllbnQgPSBmdW5jdGlvbigpCnsKYXJjaGl2ZUNsaWVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsYXJjaGl2ZUNsaWVudF9zdWNjZXNzKTsKZnVuY3Rpb24gYXJjaGl2ZUNsaWVudF9zdWNjZXNzKCkKewokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CmlmICgkc2NvcGUuaXNfaW5zdHJ1Y3RvcikKewokbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2luc3RydWN0b3JzJyk7Cn0KZWxzZSB7CiRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfY2xpZW50cycpOwp9Cn0KfQoKfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdwYXltZW55RGV0YWlsc01vZGFsQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHJvdXRlUGFyYW1zLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIGZwYXltZW50LCB1aUNhbGVuZGFyQ29uZmlnKSB7CiRzY29wZS5mcGF5bWVudD17fTsKJHNjb3BlLmZwYXltZW50LnBheW1lbnRfZGF0ZT1mcGF5bWVudC5wYXltZW50X2RhdGU7CiRzY29wZS5mcGF5bWVudC5wYXltZW50X2Ftb3VudD1mcGF5bWVudC5wYXltZW50X2Ftb3VudDsKJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZ2VuZXJhdGVkPWZwYXltZW50Lmludm9pY2VfZ2VuZXJhdGVkOwokc2NvcGUuZnBheW1lbnQuaW52b2ljZV9udW1iZXI9ZnBheW1lbnQuaW52b2ljZV9udW1iZXI7CmlmIChmcGF5bWVudC5pbnZvaWNlX2RhdGU9PW51bGwpCnsKJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZV9mb3JtYXQ9bmV3IERhdGUoKTsKfQplbHNlCnsKJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZV9mb3JtYXQ9ZnBheW1lbnQuaW52b2ljZV9kYXRlX2Zvcm1hdDsKfQokc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlPWZwYXltZW50Lmludm9pY2VfZGF0ZTsKJHNjb3BlLnNlbGVjdGVkUGF5bWVudE1ldGhvZD17Cm5hbWU6IGZwYXltZW50LnBheW1lbnRfbWV0aG9kX25hbWVfdHh0LAptZXRob2Q6IGZwYXltZW50LnBheW1lbnRfbWV0aG9kX25hbWUKfTsKJHNjb3BlLmlzUGF5bWVudE1ldGhvZFNlbGVjdGVkPXRydWU7Cgpsb2dEZWJ1Zygib2xkIGRhdGUgIiskc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlKTsKaWYgKCRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2RhdGUhPW51bGwpCnsKJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZV9mb3JtYXQgPSBuZXcgRGF0ZSgkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlKTsKfQokc2NvcGUucGF5bWVudE1ldGhvZHMgPSBwYXltZW50TWV0aG9kczsKJHNjb3BlLnBheW1lbnRUeXBlVGl0bGU9ZnBheW1lbnQucGF5bWVudF9tZXRob2RfbmFtZV90eHQ7CiRzY29wZS5mcGF5bWVudC5pbnZvaWNlX3NvdXJjZT0iRVhURVJOQUwiOwoKbG9nRGVidWcoJHNjb3BlLnBheW1lbnRNZXRob2RzKTsKbG9nRGVidWcoInBheW1lbnlEZXRhaWxzTW9kYWxDb250cm9sbGVyIGZvciBwYXltZW50ICIrSlNPTi5zdHJpbmdpZnkoZnBheW1lbnQsIG51bGwsIDQpKTsKCiRzY29wZS5zZWxlY3RQYXltZW50TWV0aG9kID0gZnVuY3Rpb24ocGF5bWVudCkgewokc2NvcGUucGF5bWVudFR5cGVUaXRsZT1wYXltZW50Lm5hbWU7CmxvZ0RlYnVnKCJwYXltZW50PSIrcGF5bWVudCk7Cgokc2NvcGUuc2VsZWN0ZWRQYXltZW50TWV0aG9kPXBheW1lbnQ7CiRzY29wZS5pc1BheW1lbnRNZXRob2RTZWxlY3RlZD10cnVlOwp9OwoKJHNjb3BlLmNsb3NlTW9kYWwgPSBmdW5jdGlvbigpIHsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwp9OwoKJHNjb3BlLnVwZGF0ZVBheW1lbnQgPSBmdW5jdGlvbigpCnsKLy8gbG9nRGVidWcoY3VycmVudENsaWVudCk7CmxvZ0RlYnVnKCJwYXltZW50IG1ldGhvZCIpOwpsb2dEZWJ1Zygkc2NvcGUuc2VsZWN0ZWRQYXltZW50TWV0aG9kKTsKbG9nRGVidWcoIiRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2dlbmVyYXRlZD08Iiskc2NvcGUuZnBheW1lbnQuaW52b2ljZV9nZW5lcmF0ZWQrIj4sICRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2RhdGVfZm9ybWF0PSIrJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZV9mb3JtYXQpOwpsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkUGF5bWVudE1ldGhvZC5tZXRob2Q9Iiskc2NvcGUuc2VsZWN0ZWRQYXltZW50TWV0aG9kLm1ldGhvZCk7CmlmICgoJHNjb3BlLmZwYXltZW50LnBheW1lbnRfYW1vdW50PT0wKSB8fCAoJHNjb3BlLmZwYXltZW50LnBheW1lbnRfYW1vdW50PT0nJykgfHwgKCRzY29wZS5mcGF5bWVudC5wYXltZW50X2Ftb3VudD09bnVsbCkpCnsKJHNjb3BlLnVzZXJFcnJvcj0i15DXoNeQINeU15bXnyDXodeb15XXnSDXm9ec16nXlNeVIjsKLy8gYWxlcnQoJ3NzJyk7Cn0KZWxzZSBpZiAoISRzY29wZS5pc1BheW1lbnRNZXRob2RTZWxlY3RlZCkKewokc2NvcGUudXNlckVycm9yPSLXkNeg15Ag15HXl9eoINeQ157Xptei15kg16rXqdec15XXnSI7Ci8vIGFsZXJ0KCdzcycpOwp9CmVsc2UKewppZiAoKCRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2dlbmVyYXRlZCE9MSkgfHwgKCRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2RhdGVfZm9ybWF0PT1udWxsKSkKewp2YXIgaW52b2ljZV9kYXRlX2Zvcm1hdCA9ICJudWxsIjsKfQplbHNlCnsKdmFyIGludm9pY2VfZGF0ZV9mb3JtYXQgPSAkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlX2Zvcm1hdC5nZXREYXRlKCkgICsgIi0iICsgKCRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2RhdGVfZm9ybWF0LmdldE1vbnRoKCkrMSkgKyAiLSIgKyAkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlX2Zvcm1hdC5nZXRGdWxsWWVhcigpOwp9CnRoZWRhdGE9IHsKYmFsYW5jZVRvUGF5OiAkc2NvcGUuZnBheW1lbnQucGF5bWVudF9hbW91bnQsCnBheW1lbnRfbWV0aG9kX25hbWU6ICRzY29wZS5zZWxlY3RlZFBheW1lbnRNZXRob2QubWV0aG9kLAppbnZvaWNlX251bWJlcjogJHNjb3BlLmZwYXltZW50Lmludm9pY2VfbnVtYmVyLAppbnZvaWNlX2dlbmVyYXRlZDogJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZ2VuZXJhdGVkLAppbnZvaWNlX2RhdGU6IGludm9pY2VfZGF0ZV9mb3JtYXQsCmludm9pY2Vfc291cmNlOiAkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9zb3VyY2UKfTsKdXBkYXRlUGF5bWVudEZvckNsaWVudCgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsZnBheW1lbnQudXNlcl9wYXltZW50X2lkLHRoZWRhdGEsY3JlYXRlUGF5bWVudEZvckNsaWVudF9jYWxsYmFjaywgY3JlYXRlUGF5bWVudEZvckNsaWVudF9mYWlsdXJlKTsKZnVuY3Rpb24gY3JlYXRlUGF5bWVudEZvckNsaWVudF9jYWxsYmFjaygpCnsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwpsb2dEZWJ1ZygiYnJvYWRjYXN0aW5nIGNsaWVudFBhZ2VSZWxvYWREYXRhIik7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKfQpmdW5jdGlvbiBjcmVhdGVQYXltZW50Rm9yQ2xpZW50X2ZhaWx1cmUoKQp7CmxvZ0RlYnVnKCJicm9hZGNhc3RpbmcgY2xpZW50UGFnZVJlbG9hZERhdGEiKTsKLy8gJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwp9Cn0KfQp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ2V2ZW50VHlwZUV4dHJhRmllbGRzTW9kYWxDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIGV2ZW50VHlwZVByb3BlcnRpZXMsIHVpQ2FsZW5kYXJDb25maWcpIHsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXM9ZXZlbnRUeXBlUHJvcGVydGllczsKICBsb2dEZWJ1ZygiZXZlbnRUeXBlRXh0cmFGaWVsZHNNb2RhbENvbnRyb2xsZXI9IitKU09OLnN0cmluZ2lmeShldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzLCBudWxsLCA0KSk7CmlmIChldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzPT1udWxsKQp7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzT3JpZz1bXTsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHM9W107Cn0KZWxzZSBpZiAoZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcy5sZW5ndGg+MCkKewokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllc09yaWc9KGV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMpLnNsaWNlKDApOwp9CmVsc2UKewokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllc09yaWc9W107CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzPVtdOwp9CiRzY29wZS5va0xpbWl0YXRpb25Nb2RhbCA9IGZ1bmN0aW9uKCkgewokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7Cn07Cgokc2NvcGUuY2FuY2VsID0gZnVuY3Rpb24oKQp7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzPSRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzT3JpZzsKbG9nRGVidWcoImNsb3NlIik7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzT3JpZyk7Cn0KJHNjb3BlLnNhdmVBbmRDbG9zZSA9IGZ1bmN0aW9uKCkKewpsb2dEZWJ1Zygic2F2ZSBhbmQgY2xvc2UiKTsKZnVuY3Rpb24gc2V0Q2xpZW50c0V4dHJhRmllbGRzX3N1Y2Nlc3MoKQp7Cgp9CiRzY29wZS5DbGllbnRzRGV0YWlscz17fTsKJHNjb3BlLkNsaWVudHNEZXRhaWxzLmV4dHJhRmllbGRzPSRzY29wZS5leHRyYUZpZWxkczsKc2V0Q2xpZW50c0V4dHJhRmllbGRzKCRodHRwLCRzY29wZSwkc2NvcGUuQ2xpZW50c0RldGFpbHMsc2V0Q2xpZW50c0V4dHJhRmllbGRzX3N1Y2Nlc3MpOwokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyk7Cn0KCiAgJHNjb3BlLmR1cGxpY2F0ZUZpZWxkTmFtZXM9IiI7CiRzY29wZS5hZGRFeHRyYUZpZWxkcyA9IGZ1bmN0aW9uKCkKewogICAgbG9nRGVidWcoImFkZEV4dHJhRmllbGRzIHZhbGlkYXRpbmciKTsKICAgIC8vIGNoZWNraW5nIGZvciBkdXBsaWNhdGUgbmFtZXMKICAgIHZhciBleHRyYUZpZWxkc05hbWVzID0gW107CiAgICBmb3IgKHZhciBpPTE7IGk8JHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMubGVuZ3RoOyBpKyspCiAgICB7CiAgICAgIGV4dHJhRmllbGRzTmFtZXMucHVzaCgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkc1tpXS5maWVsZF9uYW1lKTsKICAgIH0KICAgIGV4dHJhRmllbGRzTmFtZXMuc29ydCgpOwogICAgdmFyIGxhc3QgPSBleHRyYUZpZWxkc05hbWVzWzBdOwogICAgZm9yICh2YXIgaT0xOyBpPGV4dHJhRmllbGRzTmFtZXMubGVuZ3RoOyBpKyspCiAgICB7CiAgICAgICBpZiAoZXh0cmFGaWVsZHNOYW1lc1tpXSA9PSBsYXN0KQogICAgICAgewogICAgICAgIC8vICBhbGVydCgnRHVwbGljYXRlIDogJytsYXN0KTsKICAgICAgICAgJHNjb3BlLmR1cGxpY2F0ZUZpZWxkTmFtZXM9J9en15nXmdedINep15PXlCDXm9ek15XXnCDXkdep150gIicrbGFzdCsnIi4uLic7CiAgICAgICAgIHJldHVybjsKICAgICAgIH0KICAgICAgIGxhc3QgPSBleHRyYUZpZWxkc05hbWVzW2ldOwogICAgfQokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyk7Cn0KCiRzY29wZS5leHRyYUZpZWxkcyA9IGV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHM7CiRzY29wZS5maWVsZFR5cGVzID0gW3tmaWVsZF9kYXRhdHlwZTogIlRFWFRfQVJFQSIsIG5hbWU6J9eq15nXkdeqINeY16fXodeYJ30sIHtmaWVsZF9kYXRhdHlwZTogIk5VTUJFUiIsIG5hbWU6J9ee16HXpNeoJ30gLCB7ZmllbGRfZGF0YXR5cGU6ICJTVFJJTkciLCBuYW1lOifXmNen16HXmCDXp9em16gnfSAsIHtmaWVsZF9kYXRhdHlwZTogIkJPT0xFQU4iLCBuYW1lOifXqteZ15HXqiDXodeZ157XldefJ30gLCB7ZmllbGRfZGF0YXR5cGU6ICJEQVRFIiwgbmFtZTon16rXkNeo15nXmid9XTsKCiRzY29wZS5hZGROZXdGaWVsZCA9IGZ1bmN0aW9uKCkgewp2YXIgbmV3SXRlbU5vID0gJHNjb3BlLmV4dHJhRmllbGRzLmxlbmd0aCsxOwokc2NvcGUuZXh0cmFGaWVsZHMucHVzaCh7ImZpZWxkX2RhdGF0eXBlIjoiU1RSSU5HIiwiaXNfbWFuZGF0b3J5IjowLCAiZnJvbWRiIjogZmFsc2UsICJmaWVsZF9pZCI6IDAsICJpc19hY3RpdmUiOiAxLCAibW9kaWZpZWQiOiAwfSk7CgogICAgbG9nRGVidWcoImV4dHJhIGZpZWxkczogIiArIEpTT04uc3RyaW5naWZ5KCRzY29wZS5leHRyYUZpZWxkcywgbnVsbCwgMikpOwoKfTsKCiRzY29wZS5yZW1vdmVGaWVsZCA9IGZ1bmN0aW9uKGNob2ljZSkKewovLyByZW1vdmluZyBmaWVsZAovLyBpZiBpdHMgbm90IG9yaWdpbmF0ZWQgZnJvbSBkYXRhYmFzZSAtIHRoZW4gd2Ugc2ltcGx5IGRlbGV0ZSBpdCBmcm9tIHRoZSBhcnJheQovLyBvdGhlcndpc2Ugd2UgbWFyayBpdCBhcyBhY3RpdmU9ZmFsc2UKbG9nRGVidWcoY2hvaWNlKTsKLy8gdmFyIGxhc3RJdGVtID0gKGNob2ljZS5pZCktMTsvLyRzY29wZS5jaG9pY2VzLmxlbmd0aC0xOwovLyAkc2NvcGUuY2hvaWNlcy5zcGxpY2UobGFzdEl0ZW0sMSk7CmZvcih2YXIgaSA9IDA7IGkgPCAkc2NvcGUuZXh0cmFGaWVsZHMubGVuZ3RoOyBpKyspCnsKaWYgKCRzY29wZS5leHRyYUZpZWxkc1tpXSA9PSBjaG9pY2UpCnsKaWYgKGNob2ljZS5mcm9tZGI9PWZhbHNlKQp7Ci8vIGlmIG5vdCBmcm9tIGRiIC0gcmVtb3ZpbmcgaXQgZnJvbSB0aGUgYXJyYXkgb2YgZXh0cmEtZmllbGRzCiRzY29wZS5leHRyYUZpZWxkcy5zcGxpY2UoaSwgMSk7Cn0KZWxzZQp7Ci8vIGlmIGZpZWxkIG9yaWdpbmF0ZWQgZnJvbSBkYiAtIHRoYW4gd2UgZG9udCByZW1vdmUgaXQgZnJvbSB0aGUgYXJyYXkKLy8gYW5kIG1hcmsgaXQgYXMgYWN0aXZlPWZhbHNlIHNvIHRoYXQgaXQgY2FuIGJlIGhhbmRlbGVkIG9uIHRoZSBzZXJ2ZXIKY2hvaWNlLmlzX2FjdGl2ZT0wOwpjaG9pY2UubW9kaWZpZWQ9dHJ1ZTsKfQpicmVhazsKfQp9Cn07Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignZXZlbnRDbG9zZUlnbm9yZU1hbmRhdG9yeUZpZWxkc01vZGFsQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHJvdXRlUGFyYW1zLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIGN1cnJlbnRFdmVudCwgdWlDYWxlbmRhckNvbmZpZykgewokc2NvcGUuY3VycmVudEV2ZW50PWN1cnJlbnRFdmVudDsKCiRzY29wZS5va0NhbmNlbCA9IGZ1bmN0aW9uKCkgewokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7Cn07Cgokc2NvcGUuY2xvc2VFdmVudElnbm9yZU1hbmRhdG9yeUZpZWxkcyA9IGZ1bmN0aW9uKCkKewpsb2dEZWJ1ZygiaWdub3JlIG1hbmRhdG9yeSBleHRyYSBmaWVsZHMgYW5kIGNsb3NlIGV2ZW50Iik7CiRzY29wZS5jdXJyZW50RXZlbnQuaWdub3JlRXh0cmFGaWVsZHNWYWxpZGF0aW9uPXRydWU7CmNsb3NlRXZlbnQoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCwkc2NvcGUuY3VycmVudEV2ZW50LGFmdGVyQ2xvc2VFdmVudCxhZnRlckNsb3NlRXZlbnQpOwpmdW5jdGlvbiBhZnRlckNsb3NlRXZlbnQoKQp7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgnZXZlbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7Cn07Cn0KfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdldmVudFR5cGVDaGFuZ2VkUG9wdXBDb250cm9sbGVyJywgZnVuY3Rpb24oJGxvY2F0aW9uLCAkc2NvcGUsICRyb3V0ZVBhcmFtcywgJHJvb3RTY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRodHRwLCBldmVudFR5cGVQcm9wZXJ0aWVzLCB1aUNhbGVuZGFyQ29uZmlnKSB7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzPWV2ZW50VHlwZVByb3BlcnRpZXM7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLnVwZGF0ZWRfZnJvbV9kYXRlPW5ldyBEYXRlKCk7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLnVwZGF0ZV9leGlzdGluZ19ldmVudHM9ZmFsc2U7Cgokc2NvcGUuY2xvc2VNb2RhbCA9IGZ1bmN0aW9uKCkgewokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7Cn07Cgokc2NvcGUudXBkYXRlRXZlbnRUeXBlID0gZnVuY3Rpb24oKQp7CmxvZ0RlYnVnKCJ1cGRhdGUgRXZlbnQgVHlwZSAiICsgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXZlbnRfdHlwZV9pZCk7CmlmICgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5tYXhfcmVnaXN0cmF0aW9ucz09JycpCnsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMubWF4X3JlZ2lzdHJhdGlvbnM9MDsKfQp1cGRhdGVFdmVudFR5cGUoJGh0dHAsJHNjb3BlLCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV2ZW50X3R5cGVfaWQsJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMsdXBkYXRlRXZlbnRUeXBlX3N1Y2Nlc3MpOwpmdW5jdGlvbiB1cGRhdGVFdmVudFR5cGVfc3VjY2VzcygpCnsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwokbG9jYXRpb24ucGF0aCgnL2V2ZW50X3R5cGVzJyk7Cn0KfQoKfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdjbGFzc0RlbGV0ZUFsbE1vZGFsQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHJvb3RTY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRodHRwLCBjdXJyZW50RXZlbnQsIHVpQ2FsZW5kYXJDb25maWcpCnsKbG9nRGVidWcoImNvbnRyb2xsZXI6IGNsYXNzRGVsZXRlQWxsTW9kYWxDb250cm9sbGVyIik7CiRzY29wZS5jdXJyZW50RXZlbnQ9Y3VycmVudEV2ZW50Owokc2NvcGUuY2xvc2VNb2RhbCA9IGZ1bmN0aW9uKCkKewokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7Cn07CgoKJHNjb3BlLmRlbGV0ZUNsYXNzRXZlbnRTaW5nbGU9ZnVuY3Rpb24gKCkgLy8gZGVsZXRlIG9ubHkgb25lL2N1cnJlbnQgY2xhc3MgZXZlaHQKewpjYW5jZWxDbGFzc0V2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkLGNhbmNlbENsYXNzRXZlbnRfY2FsbGJhY2ssIGNhbmNlbENsYXNzRXZlbnRfY2FsbGJhY2spOwpmdW5jdGlvbiBjYW5jZWxDbGFzc0V2ZW50X2NhbGxiYWNrKCkKewpnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkKTsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwokcm9vdFNjb3BlLiRicm9hZGNhc3QoJ3JlbG9hZEV2ZW50Jyx7ZXZlbnRfaWQgOiAkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkfSk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCn0KfQokc2NvcGUuZGVsZXRlQ2xhc3NFdmVudHNBbGw9ZnVuY3Rpb24gKCkgLy8gZGVsZXRlIGFsbCByZXBlYXRpbmcgZXZlbnRzCnsKY2FuY2VsQ2xhc3NSZXBlYXRpbmdFdmVudCgkaHR0cCwkc2NvcGUsMCwkc2NvcGUuY3VycmVudEV2ZW50LnJlcGVhdF9ldmVudF9pZCxjYW5jZWxDbGFzc0V2ZW50X2NhbGxiYWNrLCBjYW5jZWxDbGFzc0V2ZW50X2NhbGxiYWNrKTsKZnVuY3Rpb24gY2FuY2VsQ2xhc3NFdmVudF9jYWxsYmFjaygpCnsKZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCk7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdyZWxvYWRFdmVudCcse2V2ZW50X2lkIDogJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZH0pOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwp9Cn0KJHNjb3BlLmRlbGV0ZUNsYXNzRXZlbnRzQWxsU3RhcnRpbmdFdmVudElEPWZ1bmN0aW9uICgpIC8vIGRlbGV0ZSBhbGwgcmVwZWF0aW5nIGV2ZW50cyBzdGFydGluZyBldmVudF9pZAp7CmNhbmNlbENsYXNzUmVwZWF0aW5nRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQsJHNjb3BlLmN1cnJlbnRFdmVudC5yZXBlYXRfZXZlbnRfaWQsY2FuY2VsQ2xhc3NFdmVudF9jYWxsYmFjaywgY2FuY2VsQ2xhc3NFdmVudF9jYWxsYmFjayk7CmZ1bmN0aW9uIGNhbmNlbENsYXNzRXZlbnRfY2FsbGJhY2soKQp7Ci8vIGdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQpOwokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgncmVsb2FkRXZlbnQnLHtldmVudF9pZCA6ICRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWR9KTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKfQp9Cgp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ2J1c2luZXNzX21vZGFsX2xpbWl0YXRpb25fY3JlYXRlJywgZnVuY3Rpb24oJHNjb3BlLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIHN0YXJ0LGVuZCwgZml4ZWRTY2hlZHVsZSwgdWlDYWxlbmRhckNvbmZpZykgewoKJHNjb3BlLmZpeGVkU2NoZWR1bGU9Zml4ZWRTY2hlZHVsZTsKJHNjb3BlLm9yaWdpbmFsX3N0YXJ0PXN0YXJ0Owokc2NvcGUub3JpZ2luYWxfZW5kPWVuZDsKCiRzY29wZS5zdGFydD1uZXcgbW9tZW50KHN0YXJ0KSoxMDAwOwokc2NvcGUuZW5kPW5ldyBtb21lbnQoZW5kKSoxMDAwOwpjb25zb2xlLmxvZygnc3RhcnQ9JytzdGFydCk7CmNvbnNvbGUubG9nKCdlbmQ9JytlbmQpOwoKZ2V0QnVzaW5lc3NMb2NhdGlvbnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19sb2NhdGlvbnMnLGdldEJ1c2luZXNzTG9jYXRpb25zX3N1Y2Nlc3MpOwpmdW5jdGlvbiBnZXRCdXNpbmVzc0xvY2F0aW9uc19zdWNjZXNzKCkKewokc2NvcGUubmV3RXZlbnREZXRhaWxzLmxvY2F0aW9uX2lkPSRzY29wZS5idXNpbmVzc19sb2NhdGlvbnNbMF0ubG9jYXRpb25faWQ7Cn0KCnNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc3RhcnQpOwpzZWxlY3RlZERhdGVFbmQgPSBuZXcgRGF0ZShlbmQpOwpsb2dEZWJ1Zygic2VsZWN0ZWREYXRlU3RhcnQgPSAiK3NlbGVjdGVkRGF0ZVN0YXJ0KTsKdmFyIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZSgpICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKdmFyIHNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKHNlbGVjdGVkRGF0ZUVuZC5nZXRUaW1lKCkgKyBzZWxlY3RlZERhdGVFbmQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKCi8vIGxvZ0RlYnVnKCJkYXRlPSIgKyBzZWxlY3RlZERhdGVTdGFydCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50ID0gW107CiRzY29wZS5uZXdFdmVudERldGFpbHMgPSBbXTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycyA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldEhvdXJzKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcyA9IChzZWxlY3RlZERhdGVTdGFydC5nZXRNaW51dGVzKCkgPCAxMCA/ICcwJyA6ICcnKSArIHNlbGVjdGVkRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkb3cgPSBkYXlOYW1lc1tzZWxlY3RlZERhdGVTdGFydC5nZXREYXkoKV07CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF0ZSA9IHNlbGVjdGVkRGF0ZVN0YXJ0Owokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoID0gbW9udGhOYW1lc1tzZWxlY3RlZERhdGVTdGFydC5nZXRNb250aCgpXTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aDExMiA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldE1vbnRoKCkrMTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXlvZm1vbnRoID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RGF0ZSgpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXIgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRGdWxsWWVhcigpOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWVfaW5wdXRfZm9ybWF0PSBuZXcgRGF0ZSgxOTcwLCAwLCAxLCAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzLCAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMsIDApOwoKJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMgPSBzZWxlY3RlZERhdGVFbmQuZ2V0SG91cnMoKTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcyA9IChzZWxlY3RlZERhdGVFbmQuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBzZWxlY3RlZERhdGVFbmQuZ2V0TWludXRlcygpOwoKCiRzY29wZS5jYW5jZWwgPSBmdW5jdGlvbigpIHsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwp9OwoKZ2V0QWxsSW5zdHJ1Y3RvcnMoJGh0dHAsJHNjb3BlLCdpbnN0cnVjdG9ycycsZ2V0QWxsSW5zdHJ1Y3RvcnNfc3VjY2Vzcyk7CmZ1bmN0aW9uIGdldEFsbEluc3RydWN0b3JzX3N1Y2Nlc3MoKQp7CiRzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZD0kc2NvcGUuaW5zdHJ1Y3RvcnNbMF0uYnVzaW5lc3NfdXNlcl9pZDsKfQpnZXROb0NsYXNzRXZlbnRUeXBlc05vQWRtaW4oJGh0dHAsJHNjb3BlLCdyZWxhdGVkRXZlbnRUeXBlcycpOwoKJHNjb3BlLmNyZWF0ZU5ld0xpbWl0YXRpb24gPSBmdW5jdGlvbigpCnsKbG9nRGVidWcoImZ1bmN0aW9uOiBjcmVhdGVOZXdMaW1pdGF0aW9uIik7CmNhbGVuZGFyID0gJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnOwoKaWYgKCRzY29wZS5zZWxlY3RlZEV2ZW50VHlwZXMubGVuZ3RoPDEpCnsKcmV0dXJuIGZhbHNlOwp9CmlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vyczwkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKQp7CmFsZXJ0KCLXltee158g16HXmdeV150g15zXpNeg15kg15bXntefINeU16rXl9ec15QiKTsKcmV0dXJuIGZhbHNlOwp9CmlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vycz09JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykKewppZiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlczw9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKQp7CmFsZXJ0KCLXltee158g16HXmdeV150g15zXpNeg15kg15bXntefINeU16rXl9ec15QiKTsKcmV0dXJuIGZhbHNlOwp9CmlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzPCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMrMTApKQp7CmFsZXJ0KCLXkdec15XXpyDXp9eY158g154tMTAg15PXp9eV16oiKTsKcmV0dXJuIGZhbHNlOwp9Cn0KaWYgKCFrdXplSXNDYWxlbmRhckRyYWdnYmxlKSB7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3Vuc2VsZWN0Jyk7Cn0KbG9nRGVidWcoInN0YXJ0PSIgKyBzdGFydCk7CmNoZWNrRGF0ZSA9IG5ldyBEYXRlKHN0YXJ0KTsKbG9nRGVidWcoImNoZWNrIGRhdGUgPSAiICsgY2hlY2tEYXRlKQpsb2dEZWJ1ZygiZW5kPSIgKyBlbmQpOwplY29sb3I9IiMwMGE2NWEiOwoKaWYgKGNoZWNrRGF0ZS5nZXRGdWxsWWVhcigpID09IDE5NzApIHsKZGF5X2xpbWl0X2lkID0gLTE7Cn0gZWxzZSB7CmRheV9saW1pdF9pZCA9IDE7Cn0KCi8vIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW10uZnVsbENhbGVuZGFyKCdyZXJlbmRlckV2ZW50cycpOwoKdGVtcF9saW1pdF9pZCA9IGNhbGNfdGVtcF9saW1pdF9pZCgpOwoKbG9nRGVidWcoJHNjb3BlLnNlbGVjdGVkRXZlbnRUeXBlc1swXSk7CmxvZ0RlYnVnKCRzY29wZS5zZWxlY3RlZEV2ZW50VHlwZXNbMF0uZXZlbnRfdHlwZV9pZCk7CgpzdGFydF9wYXJhbT1zdGFydDsKZW5kX3BhcmFtPWVuZDsKdGl0bGVfcGFyYW09Jyc7CmxvZ0RlYnVnKCJhZGRMaW1pdGF0aW9uVG9EYXRhYmFzZSBzdGFydD0iICsgc3RhcnRfcGFyYW0gKyAiLCBlbmQ9IiArICIsIHRpdGxlPSIgKyB0aXRsZV9wYXJhbSApOwoKdGhlZGF0YSA9IHsKc3RhcnRfZGF0ZTogJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5zdGFydF90aW1lLAplbmRfZGF0ZTogJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmRfdGltZSwKY29sb3I6IGVjb2xvciwKdGVtcF9saW1pdF9pZDogdGVtcF9saW1pdF9pZCwKZW1wX2lkOiAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmluc3RydWN0b3JfaWQsCmxvY2F0aW9uX2lkOiAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmxvY2F0aW9uX2lkLApldmVudF90eXBlX2lkOiAkc2NvcGUuc2VsZWN0ZWRFdmVudFR5cGVzWzBdLmV2ZW50X3R5cGVfaWQsCmV2ZW50X3R5cGVzOiAkc2NvcGUuc2VsZWN0ZWRFdmVudFR5cGVzLAp0aXRsZTogdGl0bGVfcGFyYW0KfTsKCmlmICgkc2NvcGUuZml4ZWRTY2hlZHVsZSkgLy8gZml4ZWQgc2NoZWR1bGUgdnMgc3BlY2lmaWMgd2VlZC9kYXkgbGltaXRhdGlvbgp7CmNyZWF0ZUNhbGVuZGFyTGltaXRhdGlvbigkaHR0cCwkc2NvcGUsdGhlZGF0YSxsaW1pdGF0aW9uX3N1Y2Nlc3NfY2FsbGJhY2spOwp9CmVsc2UKewpjcmVhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXkoJGh0dHAsJHNjb3BlLHRoZWRhdGEsbGltaXRhdGlvbl9zdWNjZXNzX2NhbGxiYWNrKTsKfQpmdW5jdGlvbiBsaW1pdGF0aW9uX3N1Y2Nlc3NfY2FsbGJhY2soKQp7CmxvZ0RlYnVnKCJzdWNjZXNzIik7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKJHVpYk1vZGFsSW5zdGFuY2UuZGlzbWlzcygpOwp9Cgp9Cgokc2NvcGUuc3RhcnRNaW51dGVzID0gZnVuY3Rpb24oKQp7CmxvZ0RlYnVnKCJzdGFydE1pbnV0ZXMgIisoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKSk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcz1taW51dGVzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpOwpjYWxjdWxhdGVTdGFydFRpbWUoKTsKfQokc2NvcGUuc3RhcnRIb3VycyA9IGZ1bmN0aW9uKCkKewpsb2dEZWJ1Zygic3RhcnRIb3VycyAiK2hvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKSk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnM9aG91cnNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMpOwpjYWxjdWxhdGVTdGFydFRpbWUoKTsKfQokc2NvcGUuZW5kTWludXRlcyA9IGZ1bmN0aW9uKCkKewpsb2dEZWJ1ZygiZW5kTWludXRlcyAiKygkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzKSk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXM9bWludXRlc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcyk7CmNhbGN1bGF0ZUVuZFRpbWUoKTsKfQokc2NvcGUuZW5kSG91cnMgPSBmdW5jdGlvbigpCnsKbG9nRGVidWcoImVuZEhvdXJzICIraG91cnNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzKSk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzPWhvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vycyk7CmNhbGN1bGF0ZUVuZFRpbWUoKTsKfQoKCmZ1bmN0aW9uIGNhbGN1bGF0ZVN0YXJ0VGltZSgpCnsKZXZlbnRZZWFyPSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0eWVhcjsKZXZlbnRNb250aD0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoMTEyOwpldmVudERheT0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRheW9mbW9udGg7CmlmIChwYXJzZUludChldmVudE1vbnRoKTwxMCkKewpldmVudE1vbnRoPSIwIitldmVudE1vbnRoOwp9CmlmIChwYXJzZUludChldmVudERheSk8MTApCnsKZXZlbnREYXk9IjAiK2V2ZW50RGF5Owp9CmxvZ0RlYnVnKCIkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXI9IitldmVudFllYXIpOwpsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXlvZm1vbnRoPSIrZXZlbnRNb250aCk7CmxvZ0RlYnVnKCIkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoPSIrZXZlbnREYXkpOwpuZXdfc3RhcnQ9bW9tZW50LnV0YyhldmVudFllYXIrIi0iK2V2ZW50TW9udGgrIi0iK2V2ZW50RGF5KyJUMDA6MDA6MDAiKS5hZGQoKChwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKSo2MCkrcGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKSksICdtaW51dGVzJyk7CiRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZT1uZXdfc3RhcnQ7CmxvZ0RlYnVnKCJuZXdfc3RhcnQ9IituZXdfc3RhcnQpOwp9CmZ1bmN0aW9uIGNhbGN1bGF0ZUVuZFRpbWUoKQp7CmV2ZW50WWVhcj0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXI7CmV2ZW50TW9udGg9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aDExMjsKZXZlbnREYXk9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXlvZm1vbnRoOwppZiAocGFyc2VJbnQoZXZlbnRNb250aCk8MTApCnsKZXZlbnRNb250aD0iMCIrZXZlbnRNb250aDsKfQppZiAocGFyc2VJbnQoZXZlbnREYXkpPDEwKQp7CmV2ZW50RGF5PSIwIitldmVudERheTsKfQpsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyPSIrZXZlbnRZZWFyKTsKbG9nRGVidWcoIiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aD0iK2V2ZW50TW9udGgpOwpsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aD0iK2V2ZW50RGF5KTsKbmV3X2VuZD1tb21lbnQudXRjKGV2ZW50WWVhcisiLSIrZXZlbnRNb250aCsiLSIrZXZlbnREYXkrIlQwMDowMDowMCIpLmFkZCgoKHBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzKSo2MCkrcGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcykpLCAnbWludXRlcycpOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZF90aW1lPW5ld19lbmQ7CmxvZ0RlYnVnKCJuZXdfZW5kPSIrbmV3X2VuZCk7Cn0KCmNhbGN1bGF0ZVN0YXJ0VGltZSgpOwpjYWxjdWxhdGVFbmRUaW1lKCk7CgpmdW5jdGlvbiBtaW51dGVzQ2hhbmdlZCh0aGVtaW51dGVzKQp7CmxvZ0RlYnVnKCJ0aGVtaW51dGVzPSIrdGhlbWludXRlcyk7CmlmICh0eXBlb2YgdGhlbWludXRlcz09InVuZGVmaW5lZCIpCnsKcmV0dXJuICIwMCI7Cn0KdGhlbWludXRlcz1wYXJzZUludCh0aGVtaW51dGVzKTsKaWYgKHRoZW1pbnV0ZXM+NjApCnsKcmV0dXJuICIwMCI7Cn0KZWxzZSBpZiAodGhlbWludXRlczwwKQp7CnJldHVybiAiMDAiOwp9CmVsc2UgaWYgKHRoZW1pbnV0ZXM9PSIiKQp7CnJldHVybiAiMDAiOwp9CmVsc2UgaWYgKHRoZW1pbnV0ZXM8MTApCnsKcmV0dXJuICIwIit0aGVtaW51dGVzOwp9CmVsc2UKewpyZXR1cm4gdGhlbWludXRlczsKfQp9CmZ1bmN0aW9uIGhvdXJzQ2hhbmdlZCh0aGVob3VycykKewpsb2dEZWJ1ZygidGhlaG91cnM9Iit0aGVob3Vycyk7CmlmICh0eXBlb2YgdGhlaG91cnM9PSJ1bmRlZmluZWQiKQp7CnJldHVybiAiMCI7Cn0KdGhlaG91cnM9cGFyc2VJbnQodGhlaG91cnMpOwppZiAodGhlaG91cnM+MjQpCnsKcmV0dXJuIDA7Cn0KZWxzZSBpZiAodGhlaG91cnM8MCkKewpyZXR1cm4gMDsKfQplbHNlIGlmICh0aGVob3Vycz09IiIpCnsKcmV0dXJuICIwIjsKfQplbHNlCnsKcmV0dXJuIHRoZWhvdXJzOwp9Cn0KfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2NsYXNzQ2xvc2VNb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRyb290U2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgZXZlbnRfaWQsIHVpQ2FsZW5kYXJDb25maWcpIHsKZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ3NlbGVjdGVkRXZlbnQnLGV2ZW50X2lkLGFmdGVyR2V0Q2xpZW50U3BlY2lmaWNFdmVudCk7CmZ1bmN0aW9uIGFmdGVyR2V0Q2xpZW50U3BlY2lmaWNFdmVudCgpCnsKZm9yIChpID0gMDsgaSA8ICRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50VXNlcnMubGVuZ3RoOyBpKyspCnsKaWYgKCRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50VXNlcnNbaV0uc3RhdHVzX25hbWUhPSRnVXNlcl9zdGF0dXNfYWJzZW50ZWQpCnsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRVc2Vyc1tpXS5wYXJ0aWNpcGF0ZWQ9dHJ1ZTsKfQppZiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRVc2Vyc1tpXS5pc193YWl0aW5nX2xpc3Q9PTEpCnsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRVc2Vyc1tpXS5wYXJ0aWNpcGF0ZWQ9ZmFsc2U7Cn0KfQpsb2dEZWJ1Zygkc2NvcGUuc2VsZWN0ZWRFdmVudCk7Cn0KCi8vIGNsaWNrZWQgcm93IC0gY2hlY2svdW5jaGVjayB0aGUgY2hlY2tib3ggb2YgYSB1c2VyCiRzY29wZS5yb3dDbGlja2VkID0gZnVuY3Rpb24ob2JqKQp7CmxvZ0RlYnVnKCdyb3cgY2xpY2tlZCcpOwpvYmoucGFydGljaXBhdGVkID0gIW9iai5wYXJ0aWNpcGF0ZWQ7Cn07Cgokc2NvcGUub2tMaW1pdGF0aW9uTW9kYWwgPSBmdW5jdGlvbigpIHsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwp9OwoKJHNjb3BlLmNsb3NlQ2xhc3MgPSBmdW5jdGlvbigpCnsKY2xvc2VDbGFzc0V2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUuc2VsZWN0ZWRFdmVudC5ldmVudF9pZCwkc2NvcGUuc2VsZWN0ZWRFdmVudCxhZnRlckNsb3NlRXZlbnQsYWZ0ZXJDbG9zZUV2ZW50KTsKZnVuY3Rpb24gYWZ0ZXJDbG9zZUV2ZW50KCkKewokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgncmVsb2FkRXZlbnQnLHtldmVudF9pZCA6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50X2lkfSk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCn07Cn0KfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2J1c2luZXNzQ2xpZW5kQ2FyZFBheW1lbnQnLCBmdW5jdGlvbigkc2NvcGUsICRyb3V0ZVBhcmFtcywgJHJvb3RTY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRodHRwLCBjdXJyZW50Q2xpZW50LCBpc3BsdXMsIHVpQ2FsZW5kYXJDb25maWcpCnsKJHNjb3BlLmlzcGx1cz1pc3BsdXM7CmxvZ0RlYnVnKCdidXNpbmVzc0NsaWVuZENhcmRQYXltZW50IGlzcGx1cz0nICtpc3BsdXMrIiBjdXJyZW50Q2xpZW50PSIrIEpTT04uc3RyaW5naWZ5KGN1cnJlbnRDbGllbnQsIG51bGwsIDIpKTsKJHNjb3BlLmt1emVJc0xvYWRpbmc9ZmFsc2U7CmxvZ0RlYnVnKCdjdXJyZW50Q2xpZW50LnBheW1lbnRfYmFsYW5jZT0nK2N1cnJlbnRDbGllbnQucGF5bWVudF9iYWxhbmNlKyIsY3VycmVudENsaWVudC51bnBhaWRfYmFsYW5jZSA9IitjdXJyZW50Q2xpZW50LnVucGFpZF9iYWxhbmNlKTsKdGhlYmFsYW5jZSA9IGN1cnJlbnRDbGllbnQucGF5bWVudF9iYWxhbmNlLWN1cnJlbnRDbGllbnQudW5wYWlkX2JhbGFuY2U7CmxvZ0RlYnVnKCd0aGViYWxhbmNlPScrdGhlYmFsYW5jZSk7CmlmICh0aGViYWxhbmNlPDApCnsKJHNjb3BlLmJhbGFuY2VUb1BheT1NYXRoLmFicyh0aGViYWxhbmNlKTsKfQogIC8vIGVsc2UgaWYgKChjdXJyZW50Q2xpZW50LmJhbGFuY2U+MCkgJiYgKGN1cnJlbnRDbGllbnQudW5wYWlkX2JhbGFuY2U+MCkpCiAgLy8gewogIC8vICAgY29uc29sZS5sb2coImN1cnJlbnRDbGllbnQuYmFsYW5jZT0iK2N1cnJlbnRDbGllbnQuYmFsYW5jZSsiLCBjdXJyZW50Q2xpZW50LnVucGFpZF9iYWxhbmNlPSIrY3VycmVudENsaWVudC51bnBhaWRfYmFsYW5jZSk7CiAgLy8gICBpZiAoY3VycmVudENsaWVudC51bnBhaWRfYmFsYW5jZT5jdXJyZW50Q2xpZW50LmJhbGFuY2UpCiAgLy8gICB7CiAgLy8gICAgICRzY29wZS5iYWxhbmNlVG9QYXk9Y3VycmVudENsaWVudC51bnBhaWRfYmFsYW5jZS1jdXJyZW50Q2xpZW50LmJhbGFuY2U7CiAgLy8gICB9CiAgLy8gICBlbHNlIHsKICAvLyAgICAgJHNjb3BlLmJhbGFuY2VUb1BheT0wOwogIC8vICAgfQogIC8vIH0KZWxzZQp7CiRzY29wZS5iYWxhbmNlVG9QYXk9MDsKfQokc2NvcGUucGF5bWVudFR5cGVUaXRsZT0i15HXl9eoIjsKJHNjb3BlLmN1cnJlbnRDbGllbnQ9Y3VycmVudENsaWVudDsKbG9nRGVidWcoJHNjb3BlLmN1cnJlbnRDbGllbnQpOwokc2NvcGUuYnVzaW5lc3NDb25maWcgPSBCdXNpbmVzc0NvbmZpZy5nZXQoKTsKJHNjb3BlLmJ1c2luZXNzQ29uZmlnLnRoZW4oZnVuY3Rpb24gKGNvbmZpZykgewokc2NvcGUuaW52b2ljZV9zb3VyY2VfaWQgPSBjb25maWcuaW52b2ljZV9zb3VyY2VfaWQ7CiRzY29wZS5oYXNWYXQgPSBjb25maWcudmF0X3JhdGUgPiAwOwp9KTsKCiRzY29wZS5jbG9zZU1vZGFsID0gZnVuY3Rpb24oKSB7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKfTsKCiRzY29wZS5leHRlcm5hbF9pbnZvaWNlX2dlbmVyYXRlZD1mYWxzZTsKJHNjb3BlLmludm9pY2VfZGF0ZV9mb3JtYXQ9bmV3IERhdGUoKTsKCmdldE5leHRJbnZvaWNlTnVtYmVyKCRodHRwLCRzY29wZSwkc2NvcGUuY3VycmVudENsaWVudC5idXNpbmVzc191c2VyX2lkLCdpbnZvaWNlX251bWJlcicpOwoKJHNjb3BlLnBheW1lbnRNZXRob2RzID0gcGF5bWVudE1ldGhvZHM7CiRzY29wZS5jcmVkaXRDYXJkVHlwZXMgPSBjcmVkaXRDYXJkVHlwZXM7CiRzY29wZS5jcmVkaXRUcmFuc2FjdGlvblR5cGVzID0gY3JlZGl0VHJhbnNhY3Rpb25UeXBlczsKJHNjb3BlLmJhbmtzID0gYmFua3M7CgovLyBpbmRpY2F0aW9uIHdoZXRoZXIgcGF5bWVudCBtZXRob2Qgd2FzIHNlbGVjdGVkCiRzY29wZS5pc1BheW1lbnRNZXRob2RTZWxlY3RlZD1mYWxzZTsKJHNjb3BlLnNlbGVjdFBheW1lbnRNZXRob2QgPSBmdW5jdGlvbihwYXltZW50KSB7CiRzY29wZS5wYXltZW50VHlwZVRpdGxlPXBheW1lbnQubmFtZTsKJHNjb3BlLnNlbGVjdGVkUGF5bWVudE1ldGhvZD1wYXltZW50Owokc2NvcGUuaXNQYXltZW50TWV0aG9kU2VsZWN0ZWQ9dHJ1ZTsKfTsKCiRzY29wZS51cGRhdGVCYWxhbmNlID0gZnVuY3Rpb24gdXBkYXRlQmFsYW5jZSAoaXNTb3VyY2VXaXRoVmF0KSB7CiRzY29wZS5idXNpbmVzc0NvbmZpZy50aGVuKGZ1bmN0aW9uIChjb25maWcpIHsKaWYgKGlzU291cmNlV2l0aFZhdCkgewokc2NvcGUuYmFsYW5jZVRvUGF5Tm9WYXQgPSBOdW1iZXIoKCRzY29wZS5iYWxhbmNlVG9QYXkgLyAoMSArIGNvbmZpZy52YXRfcmF0ZSkpLnRvRml4ZWQoMikpOwp9IGVsc2Ugewokc2NvcGUuYmFsYW5jZVRvUGF5ID0gTnVtYmVyKCgkc2NvcGUuYmFsYW5jZVRvUGF5Tm9WYXQgKiAoMSArIGNvbmZpZy52YXRfcmF0ZSkpLnRvRml4ZWQoMikpOwp9Cn0pCn07Cgokc2NvcGUubWFrZVBheW1lbnQgPSBmdW5jdGlvbigpCnsKbG9nRGVidWcoY3VycmVudENsaWVudCk7CmxvZ0RlYnVnKCJwYXltZW50IG1ldGhvZCIpOwpsb2dEZWJ1Zygkc2NvcGUuc2VsZWN0ZWRQYXltZW50TWV0aG9kKTsKbG9nRGVidWcoIiRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2dlbmVyYXRlZD08Iiskc2NvcGUuaW52b2ljZV9nZW5lcmF0ZWQrIj4iKTsKCmlmICgoJHNjb3BlLmJhbGFuY2VUb1BheT09MCkgfHwgKCRzY29wZS5iYWxhbmNlVG9QYXk9PScnKXx8ICgkc2NvcGUuYmFsYW5jZVRvUGF5PT1udWxsKSkKewokc2NvcGUudXNlckVycm9yPSLXkNeg15Ag15TXltefINeh15vXldedINeb15zXqdeU15UiOwp9CmVsc2UgaWYgKCEkc2NvcGUuaXNQYXltZW50TWV0aG9kU2VsZWN0ZWQpCnsKJHNjb3BlLnVzZXJFcnJvcj0i15DXoNeQINeR15fXqCDXkNee16bXoteZINeq16nXnNeV150iOwovLyBhbGVydCgnc3MnKTsKfQplbHNlCnsKaWYgKCgkc2NvcGUuaW52b2ljZV9nZW5lcmF0ZWQhPTEpIHx8ICgkc2NvcGUuaW52b2ljZV9kYXRlX2Zvcm1hdD09bnVsbCkpCnsKdmFyIGludm9pY2VfZGF0ZV9mb3JtYXQgPSAibnVsbCI7Cn0KZWxzZQp7CnZhciBpbnZvaWNlX2RhdGVfZm9ybWF0ID0gJHNjb3BlLmludm9pY2VfZGF0ZV9mb3JtYXQuZ2V0RGF0ZSgpICArICItIiArICgkc2NvcGUuaW52b2ljZV9kYXRlX2Zvcm1hdC5nZXRNb250aCgpKzEpICsgIi0iICsgJHNjb3BlLmludm9pY2VfZGF0ZV9mb3JtYXQuZ2V0RnVsbFllYXIoKTsKfQppZiAoaXNwbHVzKQp7CndoYXRUb1BheT0kc2NvcGUuYmFsYW5jZVRvUGF5Owp9CmVsc2Ugewp3aGF0VG9QYXk9LSRzY29wZS5iYWxhbmNlVG9QYXk7Cn0KdGhlZGF0YT0gewpiYWxhbmNlVG9QYXk6IHdoYXRUb1BheSwKYmFsYW5jZVRvUGF5Tm9WYXQ6ICRzY29wZS5iYWxhbmNlVG9QYXlOb1ZhdCAqIChpc3BsdXMgPyArMSA6IC0xKSwKcGF5bWVudF9tZXRob2RfbmFtZTogJHNjb3BlLnNlbGVjdGVkUGF5bWVudE1ldGhvZC5tZXRob2QsCmludm9pY2VfbnVtYmVyOiAkc2NvcGUuaW52b2ljZV9udW1iZXIsCmludm9pY2VfZ2VuZXJhdGVkOiAkc2NvcGUuaW52b2ljZV9nZW5lcmF0ZWQsCmludm9pY2VfZGF0ZTogaW52b2ljZV9kYXRlX2Zvcm1hdCwKYmFua19jb21wYW55X2NvZGU6ICRzY29wZS5iYW5rX2NvbXBhbnlfY29kZSwKYmFua19icmFuY2hfbnVtYmVyOiAkc2NvcGUuYmFua19icmFuY2hfbnVtYmVyLApjaGVja19udW1iZXI6ICRzY29wZS5jaGVja19udW1iZXIsCmFjY291bnRfbnVtYmVyOiAkc2NvcGUuYWNjb3VudF9udW1iZXIsCmNyZWRpdF9jYXJkX251bWJlcjogJHNjb3BlLmNyZWRpdF9jYXJkX251bWJlciwKY3JlZGl0X2NhcmRfdHlwZTogJHNjb3BlLmNyZWRpdF9jYXJkX3R5cGUsCmNyZWRpdF9jYXJkX3RyYW5zYWN0aW9uX3R5cGU6ICRzY29wZS5jcmVkaXRfY2FyZF90cmFuc2FjdGlvbl90eXBlLAppbnZvaWNlX2NvbW1lbnRzOiAkc2NvcGUuaW52b2ljZV9jb21tZW50cwp9Owokc2NvcGUua3V6ZUlzTG9hZGluZz10cnVlOwpjcmVhdGVQYXltZW50Rm9yQ2xpZW50KCRodHRwLCRzY29wZSxjdXJyZW50Q2xpZW50LmJ1c2luZXNzX3VzZXJfaWQsdGhlZGF0YSxjcmVhdGVQYXltZW50Rm9yQ2xpZW50X3N1Y2Nlc3MsIGNyZWF0ZVBheW1lbnRGb3JDbGllbnRfZmFpbHVyZSk7CmZ1bmN0aW9uIGNyZWF0ZVBheW1lbnRGb3JDbGllbnRfc3VjY2VzcygpCnsKJHNjb3BlLmt1emVJc0xvYWRpbmc9ZmFsc2U7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKbG9nRGVidWcoImJyb2FkY2FzdGluZyBjbGllbnRQYWdlUmVsb2FkRGF0YSIpOwokcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NsaWVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCmxvZ0RlYnVnKCJicm9hZGNhc3RpbmcgZXZlbnRQYWdlUmVsb2FkRGF0YSIpOwokcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2V2ZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKLy8gbG9nRGVidWcoImJyb2FkY2FzdGluZyByZWxvYWRFdmVudCIpOwovLyAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ3JlbG9hZEV2ZW50Jyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCn0KZnVuY3Rpb24gY3JlYXRlUGF5bWVudEZvckNsaWVudF9mYWlsdXJlKCkKewokc2NvcGUua3V6ZUlzTG9hZGluZz1mYWxzZTsKfQp9Cn0KfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdldmVudERldGFpbHNCdXNpbmVzc0NhbGVuZGFyTW9kYWxDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIHNlbGVjdGVkRXZlbnQsIHVpQ2FsZW5kYXJDb25maWcpIHsKdmFyIGRheU5hbWVzID0gWyfXqNeQ16nXldefJywgJ9ep16DXmScsICfXqdec15nXqdeZJywgJ9eo15HXmdei15knLCAn15fXnteZ16nXmScsICfXqdeZ16nXmScsICfXqdeR16onXTsKCiRzY29wZS5nb3RvQ2xpZW50UGFnZT0gZnVuY3Rpb24gKGJ1c2luZXNVc2VyaWQpCnsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwpnb3RvQ2xpZW50UGFnZShidXNpbmVzVXNlcmlkKTsKfQokc2NvcGUuZWRpdEV2ZW50PSBmdW5jdGlvbiAodGhlZXZlbnQpCnsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwpnb3RvRXZlbnRQYWdlKHRoZWV2ZW50KTsKfQoKbG9nRGVidWcoInNlbGVjdGVkIEV2ZW50IGluZm8gPSIgKyBKU09OLnN0cmluZ2lmeShzZWxlY3RlZEV2ZW50LCBudWxsLCAyKSk7CiRzY29wZS5zZWxlY3RlZEV2ZW50ID0gc2VsZWN0ZWRFdmVudDsKc2VsZWN0ZWREYXRlU3RhcnQgPSBuZXcgRGF0ZShzZWxlY3RlZEV2ZW50LnN0YXJ0KTsKdmFyIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZSgpICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKCiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRIb3VycygpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBzZWxlY3RlZERhdGVTdGFydC5nZXRNaW51dGVzKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZG93ID0gZGF5TmFtZXNbc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RGF5KCldOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRhdGUgPSBzZWxlY3RlZERhdGVTdGFydDsKCiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0RGF5ID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RGF0ZSgpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydE1vbnRoID0gMSArIHNlbGVjdGVkRGF0ZVN0YXJ0LmdldE1vbnRoKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0TW9udGhUeHQgPSBtb250aE5hbWVzWyRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0TW9udGggLSAxXTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRZZWFyID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RnVsbFllYXIoKTsKCnNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKHNlbGVjdGVkRXZlbnQuZW5kKTsKdmFyIHNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKHNlbGVjdGVkRGF0ZUVuZC5nZXRUaW1lKCkgKyBzZWxlY3RlZERhdGVFbmQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKCiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzID0gc2VsZWN0ZWREYXRlRW5kLmdldEhvdXJzKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGRvdyA9IGRheU5hbWVzW3NlbGVjdGVkRGF0ZUVuZC5nZXREYXkoKV07CiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKSA8IDEwID8gJzAnIDogJycpICsgc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKTsKJHNjb3BlLm9rTGltaXRhdGlvbk1vZGFsID0gZnVuY3Rpb24oKSB7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKfTsKCiRzY29wZS5kZWxldGVMaW1pdGF0aW9uTW9kYWwgPSBmdW5jdGlvbigpIHsKJHVpYk1vZGFsSW5zdGFuY2UuZGlzbWlzcygnZGVsZXRlJyk7CmNhbGVuZGFyID0gJ2NhbGVuZGFyX2J1c2luZXNzJzsKCiRzY29wZS5kZWxldGVDYWxlbmRhckRCRXZlbnQoc2VsZWN0ZWRFdmVudCwgY2FsZW5kYXIpOwp9Owokc2NvcGUuZGVsZXRlQ2FsZW5kYXJKU0V2ZW50ID0gZnVuY3Rpb24oY2FsZW5kYXIsIHNlbGVjdGVkRXZlbnRpZCkgewoKbG9nRGVidWcoImNhbGVuZGFyX2hvdXJzX29mX3dvcmtfY29uZmlnPSIgKyB1aUNhbGVuZGFyQ29uZmlnKTsKbG9nRGVidWcoInVpQ2FsZW5kYXJDb25maWdbY2FsZW5kYXJdPSIgKyB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1snY2FsZW5kYXJfYnVzaW5lc3MnXSk7CmxvZ0RlYnVnKCJkZWxldGUganMgZXZlbnQgIiArIHNlbGVjdGVkRXZlbnRpZCk7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlbW92ZUV2ZW50cycsIFtzZWxlY3RlZEV2ZW50aWRdKTsgLy8gZ28gdG8gZGF0ZSBpbiBjYWxlbmRhciBnb3RvCn07CiRzY29wZS5kZWxldGVDYWxlbmRhckRCRXZlbnQgPSBmdW5jdGlvbihzZWxlY3RlZEV2ZW50LCBjYWxlbmRhcikgewpsb2dEZWJ1ZygiZGVsZXRlIGV2ZW50ICIgKyBzZWxlY3RlZEV2ZW50LmlkKTsKJGh0dHAoewptZXRob2Q6ICdQT1NUJywKdXJsOiAnL2FwaS9hZG1pbi9ldmVudHMvZGVsZXRlLycgKyBzZWxlY3RlZEV2ZW50LmlkLApkYXRhOiB7CnRlbXBfbGltaXRfaWQ6IHNlbGVjdGVkRXZlbnQudGVtcF9saW1pdF9pZAp9LApoZWFkZXJzOiB7CidDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbjtjaGFyc2V0PXV0Zi04Jwp9Cn0pLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkgewoKbG9nRGVidWcoZGF0YSk7CmlmICghZGF0YS5zdWNjZXNzKSB7CmxvZ0RlYnVnKCJkZWxldGUgbGltaXRfaWQgZXJyb3IgKyIgKyBkYXRhLm1lc3NhZ2UpOwovLyBpZiBub3Qgc3VjY2Vzc2Z1bCwgYmluZCBlcnJvcnMgdG8gZXJyb3IgdmFyaWFibGVzCi8vCQkJICAkc2NvcGUuZXJyb3JOYW1lID0gZGF0YS5lcnJvcnMubmFtZTsKLy8JCQkgICRzY29wZS5lcnJvclN1cGVyaGVybyA9IGRhdGEuZXJyb3JzLnN1cGVyaGVyb0FsaWFzOwp9IGVsc2Ugewpsb2dEZWJ1ZygiZGVsZXRlIGxpbWl0X2lkIHN1Y2Nlc3MiKTsKLy8gaWYgc3VjY2Vzc2Z1bCwgYmluZCBzdWNjZXNzIG1lc3NhZ2UgdG8gbWVzc2FnZQovLwkJCSAgJHNjb3BlLm1lc3NhZ2UgPSBkYXRhLm1lc3NhZ2U7CiRzY29wZS5kZWxldGVDYWxlbmRhckpTRXZlbnQoY2FsZW5kYXIsIHNlbGVjdGVkRXZlbnQuaWQpOwoKfQp9KTsKCmxvZ0RlYnVnKCJhZnRlciByZW1vdmUgZXZlbnQiKTsKfTsKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2V2ZW50UmVjdXJyaW5nRGV0YWlsc0J1c2luZXNzQ2FsZW5kYXJNb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgc2VsZWN0ZWRFdmVudCwgdWlDYWxlbmRhckNvbmZpZykgewp2YXIgZGF5TmFtZXMgPSBbJ9eo15DXqdeV158nLCAn16nXoNeZJywgJ9ep15zXmdep15knLCAn16jXkdeZ16LXmScsICfXl9ee15nXqdeZJywgJ9ep15nXqdeZJywgJ9ep15HXqiddOwoKJHNjb3BlLmdvdG9DbGllbnRQYWdlPSBmdW5jdGlvbiAoYnVzaW5lc3NVc2VyaWQpCnsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwpnb3RvQ2xpZW50UGFnZShidXNpbmVzc1VzZXJpZCk7Cn0KJHNjb3BlLmVkaXRFdmVudD0gZnVuY3Rpb24gKHRoZWV2ZW50KQp7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKZ290b0V2ZW50UGFnZSh0aGVldmVudCk7Cn0KCgpsb2dEZWJ1Zygic2VsZWN0ZWQgUmVjdXJyaW5nIEV2ZW50IGluZm8gPSIgKyBKU09OLnN0cmluZ2lmeShzZWxlY3RlZEV2ZW50LCBudWxsLCAyKSk7CiRzY29wZS5zZWxlY3RlZEV2ZW50ID0gc2VsZWN0ZWRFdmVudDsKc2VsZWN0ZWREYXRlU3RhcnQgPSBuZXcgRGF0ZShzZWxlY3RlZEV2ZW50LnN0YXJ0KTsKdmFyIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZSgpICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKCi8vIGxvZ0RlYnVnKCJzZWxlY3RlZEV2ZW50LnN0YXJ0PSIgKyBzZWxlY3RlZEV2ZW50LnN0YXJ0KTsKLy8gbG9nRGVidWcoImRhdGU9IiArIHNlbGVjdGVkRGF0ZVN0YXJ0KTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycyA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldEhvdXJzKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcyA9IChzZWxlY3RlZERhdGVTdGFydC5nZXRNaW51dGVzKCkgPCAxMCA/ICcwJyA6ICcnKSArIHNlbGVjdGVkRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkb3cgPSBkYXlOYW1lc1tzZWxlY3RlZERhdGVTdGFydC5nZXREYXkoKV07CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF0ZSA9IHNlbGVjdGVkRGF0ZVN0YXJ0OwoKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnREYXkgPSBzZWxlY3RlZERhdGVTdGFydC5nZXREYXRlKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0TW9udGggPSAxICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TW9udGgoKTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRNb250aFR4dCA9IG1vbnRoTmFtZXNbJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRNb250aCAtIDFdOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydFllYXIgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRGdWxsWWVhcigpOwoKc2VsZWN0ZWREYXRlRW5kID0gbmV3IERhdGUoc2VsZWN0ZWRFdmVudC5lbmQpOwp2YXIgc2VsZWN0ZWREYXRlRW5kID0gbmV3IERhdGUoc2VsZWN0ZWREYXRlRW5kLmdldFRpbWUoKSArIHNlbGVjdGVkRGF0ZUVuZC5nZXRUaW1lem9uZU9mZnNldCgpICogNjAwMDApOwoKLy8gbG9nRGVidWcoInNlbGVjdGVkRXZlbnQuZW5kPSIgKyBzZWxlY3RlZEV2ZW50LmVuZCk7Ci8vIGxvZ0RlYnVnKCJkYXRlPSIgKyBzZWxlY3RlZERhdGVFbmQpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycyA9IHNlbGVjdGVkRGF0ZUVuZC5nZXRIb3VycygpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRkb3cgPSBkYXlOYW1lc1tzZWxlY3RlZERhdGVFbmQuZ2V0RGF5KCldOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzID0gKHNlbGVjdGVkRGF0ZUVuZC5nZXRNaW51dGVzKCkgPCAxMCA/ICcwJyA6ICcnKSArIHNlbGVjdGVkRGF0ZUVuZC5nZXRNaW51dGVzKCk7CiRzY29wZS5va0xpbWl0YXRpb25Nb2RhbCA9IGZ1bmN0aW9uKCkgewokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7Cn07Cgp9KTsKCmt1emVBcHAuY29udHJvbGxlcignZXZlbnREZXRhaWxzSG91cnNPZldvcmtNb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgc2VsZWN0ZWRFdmVudCwgZml4ZWRTY2hlZHVsZSwgdWlDYWxlbmRhckNvbmZpZykgewp2YXIgZGF5TmFtZXMgPSBbJ9eo15DXqdeV158nLCAn16nXoNeZJywgJ9ep15zXmdep15knLCAn16jXkdeZ16LXmScsICfXl9ee15nXqdeZJywgJ9ep15nXqdeZJywgJ9ep15HXqiddOwoKLy8gbG9nRGVidWcoInNlbGVjdGVkIEV2ZW50ID0iICsgSlNPTi5zdHJpbmdpZnkoc2VsZWN0ZWRFdmVudCwgbnVsbCwgNCkpOwokc2NvcGUuZml4ZWRTY2hlZHVsZT1maXhlZFNjaGVkdWxlOwokc2NvcGUuc2VsZWN0ZWRFdmVudCA9IHNlbGVjdGVkRXZlbnQ7CiRzY29wZS5zZWxlY3RlZEV2ZW50Lm9yaWdfZXZlbnRfdHlwZXMgPSBhbmd1bGFyLmNvcHkoc2VsZWN0ZWRFdmVudC5ldmVudF90eXBlcyk7CiRzY29wZS5uZXdFdmVudERldGFpbHMgPSBbXTsKCmdldEJ1c2luZXNzTG9jYXRpb25zKCRodHRwLCRzY29wZSwnYnVzaW5lc3NfbG9jYXRpb25zJyk7Cgpsb2dEZWJ1ZygiaG91cnMgb2Ygd29yayBibG9jay9ldmVudCBjbGlja2VkICIrSlNPTi5zdHJpbmdpZnkoJHNjb3BlLnNlbGVjdGVkRXZlbnQpKTsKCnNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc2VsZWN0ZWRFdmVudC5zdGFydCk7CnZhciBzZWxlY3RlZERhdGVTdGFydCA9IG5ldyBEYXRlKHNlbGVjdGVkRGF0ZVN0YXJ0LmdldFRpbWUoKSArIHNlbGVjdGVkRGF0ZVN0YXJ0LmdldFRpbWV6b25lT2Zmc2V0KCkgKiA2MDAwMCk7CmdldEFsbEluc3RydWN0b3JzKCRodHRwLCRzY29wZSwnaW5zdHJ1Y3RvcnMnKTsKZ2V0Tm9DbGFzc0V2ZW50VHlwZXNOb0FkbWluKCRodHRwLCRzY29wZSwncmVsYXRlZEV2ZW50VHlwZXMnLGdldE5vQ2xhc3NFdmVudFR5cGVzTm9BZG1pbl9zdWNjZXNzKTsKZnVuY3Rpb24gZ2V0Tm9DbGFzc0V2ZW50VHlwZXNOb0FkbWluX3N1Y2Nlc3MoKQp7CmZvcih2YXIgaSA9IDA7IGkgPCAkc2NvcGUuc2VsZWN0ZWRFdmVudC5ldmVudF90eXBlcy5sZW5ndGg7IGkrKykKewovLyBjb3B5aW5nIHRoZSBhY3R1YWwgb2JqZWN0IG9mICRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50X3R5cGVzW2ldCmZvcih2YXIgaiA9IDA7IGogPCAkc2NvcGUucmVsYXRlZEV2ZW50VHlwZXMubGVuZ3RoOyBqKyspCnsKaWYgKCRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50X3R5cGVzW2ldLmV2ZW50X3R5cGVfaWQ9PSRzY29wZS5yZWxhdGVkRXZlbnRUeXBlc1tqXS5ldmVudF90eXBlX2lkKQp7CiRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50X3R5cGVzW2ldPWFuZ3VsYXIuY29weSgkc2NvcGUucmVsYXRlZEV2ZW50VHlwZXNbal0pOwp9Cn0KfQp9CgovLyBsb2dEZWJ1Zygic2VsZWN0ZWRFdmVudC5zdGFydD0iICsgc2VsZWN0ZWRFdmVudC5zdGFydCk7Ci8vIGxvZ0RlYnVnKCJkYXRlPSIgKyBzZWxlY3RlZERhdGVTdGFydCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRIb3VycygpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBzZWxlY3RlZERhdGVTdGFydC5nZXRNaW51dGVzKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZG93ID0gZGF5TmFtZXNbc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RGF5KCldOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRhdGUgPSBzZWxlY3RlZERhdGVTdGFydDsKCnNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKHNlbGVjdGVkRXZlbnQuZW5kKTsKdmFyIHNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKHNlbGVjdGVkRGF0ZUVuZC5nZXRUaW1lKCkgKyBzZWxlY3RlZERhdGVFbmQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKCiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bW9udGggPSBtb250aE5hbWVzW3NlbGVjdGVkRGF0ZVN0YXJ0LmdldE1vbnRoKCldOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoMTEyID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TW9udGgoKSsxOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRheW9mbW9udGggPSBzZWxlY3RlZERhdGVTdGFydC5nZXREYXRlKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0eWVhciA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCk7Ci8vICRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZV9pbnB1dF9mb3JtYXQ9IG5ldyBEYXRlKDE5NzAsIDAsIDEsICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMsICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcywgMCk7CgovLyBsb2dEZWJ1Zygic2VsZWN0ZWRFdmVudC5lbmQ9IiArIHNlbGVjdGVkRXZlbnQuZW5kKTsKLy8gbG9nRGVidWcoImRhdGU9IiArIHNlbGVjdGVkRGF0ZUVuZCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzID0gc2VsZWN0ZWREYXRlRW5kLmdldEhvdXJzKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGRvdyA9IGRheU5hbWVzW3NlbGVjdGVkRGF0ZUVuZC5nZXREYXkoKV07CiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKSA8IDEwID8gJzAnIDogJycpICsgc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKTsKCgokc2NvcGUub2tMaW1pdGF0aW9uTW9kYWwgPSBmdW5jdGlvbigpIHsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwp9OwoKJHNjb3BlLnVwZGF0ZUxpbWl0YXRpb25Nb2RhbCA9IGZ1bmN0aW9uKCkKewpsb2dEZWJ1ZygiZnVuY3Rpb246IHVwZGF0ZUxpbWl0YXRpb25Nb2RhbCIpOwppZiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRfdHlwZXMubGVuZ3RoPDEpCnsKcmV0dXJuIGZhbHNlOwp9CmlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vyczwkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKQp7CmFsZXJ0KCLXltee158g16HXmdeV150g15zXpNeg15kg15bXntefINeU16rXl9ec15QiKTsKcmV0dXJuIGZhbHNlOwp9CmlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vycz09JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykKewppZiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlczw9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKQp7CmFsZXJ0KCLXltee158g16HXmdeV150g15zXpNeg15kg15bXntefINeU16rXl9ec15QiKTsKcmV0dXJuIGZhbHNlOwp9CmlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzPCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMrMTApKQp7CmFsZXJ0KCLXkdec15XXpyDXp9eY158g154tMTAg15PXp9eV16oiKTsKcmV0dXJuIGZhbHNlOwp9Cn0KCgpmdW5jdGlvbiB1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25fc3VjY2VzcygpCnsKY2FsZW5kYXIgPSAnY2FsZW5kYXJfaG91cnNfb2Zfd29yayc7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsgLy8gZ28gdG8gZGF0ZSBpbiBjYWxlbmRhciBnb3RvCiR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoJ2RlbGV0ZScpOwp9CgppZiAoJHNjb3BlLmZpeGVkU2NoZWR1bGUpCnsKLy8gZml4ZWQgc2NoZWR1bGUgLSB1cGFkdGluZyBsaW1pdGF0aW9uIDE5NzAKdGhlZGF0YSA9IHsKc3RhcnRfZGF0ZTogbmV3X3N0YXJ0LAplbmRfZGF0ZTogbmV3X2VuZCwKdGVtcF9saW1pdF9pZDogbnVsbCwKbGltaXRfaWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmxpbWl0X2lkLApldmVudF90eXBlczogJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRfdHlwZXMsCmxvY2F0aW9uX2lkOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5sb2NhdGlvbl9pZCwKb3JpZ19ldmVudF90eXBlczogJHNjb3BlLnNlbGVjdGVkRXZlbnQub3JpZ19ldmVudF90eXBlcywKZW1wX2lkOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbXBfaWQKfTsKdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uKCRodHRwLCRzY29wZSx0aGVkYXRhLCRzY29wZS5zZWxlY3RlZEV2ZW50LmxpbWl0X2lkLCB1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25fc3VjY2Vzcyk7Cn0KZWxzZQovLyBub3QgZml4ZWQgc2NoZWR1bGUgLSBwZXJkYXkgYmxvY2sKewovLy8vLy8vLy8vLwppZiAoKCRzY29wZS5zZWxlY3RlZEV2ZW50LmxpbWl0X2lkICE9IG51bGwpICYgKCRzY29wZS5zZWxlY3RlZEV2ZW50LmRheV9saW1pdF9pZCA9PSAtMSkpIC8vIGV2ZW50IGxpbWl0YXRpb24gaGFzIGxpbWl0X2lkIHNvIGl0cyBhbiAxOTcwIGV2ZW50Ci8vIG5lZWQgdG8gYWRkIGEgbmV3IHBlcmRheSBsaW1pdGF0aW9uIHRoYXQgcG9pbnQgKGxpbWl0X2lkKSB0byB0aGUgb2xkIDE5NzAgZXZlbnQgdG8gcmVwbGFjdGUgaXQKewp0ZW1wX2xpbWl0X2lkID0gY2FsY190ZW1wX2xpbWl0X2lkKCk7Ci8vIHRoZWV2ZW50LnRlbXBfbGltaXRfaWQgPSB0ZW1wX2xpbWl0X2lkOwovLyB0aGVldmVudC5kYXlfbGltaXRfaWQgPSB0ZW1wX2xpbWl0X2lkOwovLyB0aGUgbW92ZWQgZXZlbnQgaW4gdGhlIGNhbGVuZGFyIG5vdyBoYXMgZGF5X2xpbWl0X2lkIGFuZCB0ZW1wX2xpbWl0X2lkCi8vIGlmIGl0cyBsb2FkZWQgZnJvbSB0aGUgZGIsIGl0IHdpbGwgb25seSBoYXZlIGRheV9saW1pdF9pZCAoYW5kIG5vdCB0aGUgdGVtcCBvbmUpCi8vIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWydjYWxlbmRhcl9ob3Vyc19vZl93b3JrJ10uZnVsbENhbGVuZGFyKCd1cGRhdGVFdmVudCcsIHRoZWV2ZW50KTsKLy8gY29uc29sZS5sb2coIlhYWFhYWFhYWFhYWFgiKTsKdGhlZGF0YSA9IHsKc3RhcnRfZGF0ZTogbmV3X3N0YXJ0LAplbmRfZGF0ZTogbmV3X2VuZCwKY29sb3I6ICcnLAp0ZW1wX2xpbWl0X2lkOiAwLApldmVudF90eXBlX2lkOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5ldmVudF90eXBlX2lkLApldmVudF90eXBlczogJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRfdHlwZXMsCmxpbWl0X2lkOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5pZCwKbG9jYXRpb25faWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmxvY2F0aW9uX2lkLAplbXBfaWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmVtcF9pZAovLyB0aXRsZTogdGhlZXZlbnQudGl0bGUKfTsKY3JlYXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5KCRodHRwLCRzY29wZSx0aGVkYXRhLHVwZGF0ZUNhbGVuZGFyTGltaXRhdGlvbl9zdWNjZXNzKTsKCn0KZWxzZQp7CnRoZWRhdGE9IHsKc3RhcnRfZGF0ZTogbmV3X3N0YXJ0LAplbmRfZGF0ZTogbmV3X2VuZCwKdGVtcF9kYXlfbGltaXRfaWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LnRlbXBfbGltaXRfaWQsCm9yaWdfZXZlbnRfdHlwZXM6ICRzY29wZS5zZWxlY3RlZEV2ZW50Lm9yaWdfZXZlbnRfdHlwZXMsCmV2ZW50X3R5cGVzOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5ldmVudF90eXBlcywKbG9jYXRpb25faWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmxvY2F0aW9uX2lkLApkYXlfbGltaXRfaWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmRheV9saW1pdF9pZCwKZW1wX2lkOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbXBfaWQKfTsKdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5KCRodHRwLCRzY29wZSx0aGVkYXRhLHVwZGF0ZUNhbGVuZGFyTGltaXRhdGlvbl9zdWNjZXNzKTsKfQp9Cn0KJHNjb3BlLmRlbGV0ZUxpbWl0YXRpb25Nb2RhbCA9IGZ1bmN0aW9uKCkgewpjYWxlbmRhciA9ICdjYWxlbmRhcl9ob3Vyc19vZl93b3JrJzsKCi8vIHJlbW92aW5nIGxpbWl0YXRpb24gZnJvbSBkYXRhYmFzZSwgaWYgdHJ1ZSAtIHJlbW92aW5nIGZyb20gZGlzcGxheSBhbHNvCmlmICgkc2NvcGUuZGVsZXRlQ2FsZW5kYXJEQkxpbWl0YXRpb25FdmVudChzZWxlY3RlZEV2ZW50KSkKewovLyAkc2NvcGUuZGVsZXRlQ2FsZW5kYXJKU0V2ZW50KGNhbGVuZGFyLCBzZWxlY3RlZEV2ZW50LmlkKTsKfQokdWliTW9kYWxJbnN0YW5jZS5kaXNtaXNzKCdkZWxldGUnKTsKfTsKJHNjb3BlLmRlbGV0ZUNhbGVuZGFySlNFdmVudCA9IGZ1bmN0aW9uKGNhbGVuZGFyLCBzZWxlY3RlZEV2ZW50aWQpIHsKCmxvZ0RlYnVnKCJjYWxlbmRhcl9ob3Vyc19vZl93b3JrX2NvbmZpZz0iICsgdWlDYWxlbmRhckNvbmZpZyk7CmxvZ0RlYnVnKCJ1aUNhbGVuZGFyQ29uZmlnW2NhbGVuZGFyXT0iICsgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnXSk7CmxvZ0RlYnVnKCJkZWxldGUganMgZXZlbnQgIiArIHNlbGVjdGVkRXZlbnRpZCk7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlbW92ZUV2ZW50cycsIFtzZWxlY3RlZEV2ZW50aWRdKTsgLy8gZ28gdG8gZGF0ZSBpbiBjYWxlbmRhciBnb3RvCn07CiRzY29wZS5kZWxldGVDYWxlbmRhckRCTGltaXRhdGlvbkV2ZW50ID0gZnVuY3Rpb24oc2VsZWN0ZWRFdmVudCkgewpjYWxlbmRhciA9ICdjYWxlbmRhcl9ob3Vyc19vZl93b3JrJzsKLy8gcmV0dXJuIGZhbHNlOwoKLy8gZGVsZXRpbmcgZXZlbnQgbGltaXRhdGlvbiAobm90IHBlciBkYXkpCi8vIGVpdGhlciBmcm9tIDE5NzAgKGhvdXJzX29mX3dvcmsgcGFnZSkKLy8gb3IgZnJvbSB0aGVpciBpbnN0YW5jZSBpbiB0aGUgY3VycmVudCB3ZWVrJ3MgbGltaXRhdGlvbi4KLy8gZWl0aGVyIHdheSBkYXlfbGltaXRfaWQgaXMgLTEgZm9yIGxpbWl0YXRpb25zIGZyb20gMTk3MAppZiAoc2VsZWN0ZWRFdmVudC5kYXlfbGltaXRfaWQgPT0gLTEpCnsKbG9nRGVidWcoInJlbW92aW5nIGV2ZW50IGxpbWl0YXRpb24sIGNoZWNraWduIGlmIGl0cyBpbiAxOTcwICh0aGUgb3JpZ2luYWwpIG9yIGFuIGluc3RhbmNlIGluIHByZXNlbnQiKTsKc2VsZWN0ZWREYXRlU3RhcnQgPSBuZXcgRGF0ZShzZWxlY3RlZEV2ZW50LnN0YXJ0KTsKLy8gaWYgaXRzIDE5NzAgdGhpcyBtZWFucyB3ZSdyZSBpbiB0aGUgaG91cnNfb2Zfd29yayBnZW5lcmFsIHBhZ2UKLy8gc28gd2Ugc2ltcGx5IGRlbGV0ZSBpdAppZiAoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSA9PSAxOTcwKQp7CmxvZ0RlYnVnKCJyZW1vdmluZyBldmVudCBsaW1pdGF0aW9uIGZyb20gMTk3MCIpOwp0aGVkYXRhPSB7CnRlbXBfbGltaXRfaWQ6IHNlbGVjdGVkRXZlbnQudGVtcF9saW1pdF9pZAp9OwpkZWxldGVDYWxlbmRhckxpbWl0YXRpb24oJGh0dHAsJHNjb3BlLHRoZWRhdGEsc2VsZWN0ZWRFdmVudC5saW1pdF9pZCwgZGVsZXRlQ2FsZW5kYXJMaW1pdGF0aW9uX3N1Y2Nlc3MpOwpmdW5jdGlvbiBkZWxldGVDYWxlbmRhckxpbWl0YXRpb25fc3VjY2VzcygpCnsKJHNjb3BlLmRlbGV0ZUNhbGVuZGFySlNFdmVudChjYWxlbmRhciwgc2VsZWN0ZWRFdmVudC5pZCk7Cn0KfQplbHNlCnsKLy8gcmVtb3ZpbmcgZXZlbnQgbGltaXRhdGlvbiBmcm9tIHRoZSBhIHNwZWNpZmljIHdlZWsKLy8gdGhpcyBtZWFucyBhZGRpbmcgZXZlbnQgbGltaXRhdGlvbiBwZXIgZGF5IHdpdGggcmFuZ2UgZW5kPXN0YXJ0Ci8vIG1heWJlIEJVRyBCVUdHWT8KbG9nRGVidWcoInggcmVtb3ZpbmcgZXZlbnQgbGltaXRhdGlvbiBmcm9tIGEgc3BlY2lmaWMgd2VlaywgdGhpcyBtZWFucyBhZGRpbmcgZXZlbnQgbGltaXRhdGlvbiBwZXIgZGF5IHdpdGggcmFuZ2UgMC0wIik7Ci8vIGxvZ0RlYnVnKEpTT04uc3RyaW5naWZ5KHNlbGVjdGVkRXZlbnQpKTsKCnRoZWRhdGEgPSB7CnN0YXJ0X2RhdGU6IHNlbGVjdGVkRXZlbnQuc3RhcnQsCmVuZF9kYXRlOiBzZWxlY3RlZEV2ZW50LnN0YXJ0LApjb2xvcjogIiMwMDAwMDAiLAp0ZW1wX2xpbWl0X2lkOiAxLApldmVudF90eXBlX2lkOiBzZWxlY3RlZEV2ZW50LmV2ZW50X3R5cGVfaWQsCmxvY2F0aW9uX2lkOiBzZWxlY3RlZEV2ZW50LmxvY2F0aW9uX2lkLApsaW1pdF9pZDogc2VsZWN0ZWRFdmVudC5saW1pdF9pZCwKdGl0bGU6IHNlbGVjdGVkRXZlbnQudGl0bGUKfTsKCmNyZWF0ZUNhbGVuZGFyTGltaXRhdGlvblBlckRheSgkaHR0cCwkc2NvcGUsdGhlZGF0YSxjcmVhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXlfc3VjY2Vzcyk7CmZ1bmN0aW9uIGNyZWF0ZUNhbGVuZGFyTGltaXRhdGlvblBlckRheV9zdWNjZXNzKCkKewokc2NvcGUuZGVsZXRlQ2FsZW5kYXJKU0V2ZW50KGNhbGVuZGFyLCBzZWxlY3RlZEV2ZW50LmlkKTsKfQp9Cn0KZWxzZQp7Ci8vIGRlbGV0aW5nIGEgcGVyZGF5IGxpbWl0YXRpb24uCi8vIGlmIGl0J3MgYSBwZXJkYXkgdGhhdCAicmVwbGFjZWQiIGEgMTk3MCBvbmUKLy8gdGhlbiB3ZSBjYW5ub3QgZGVsZXRlIGl0IChvdGhlcndpc2UgdGhlIG9yaWdpbmFsIDE5NzAgd2lsbCByZWFwcGVhcikKLy8gc28gd2Ugc2V0IGl0IHRvIHN0YXJ0PWVuZAovLyB0aGlzIG1heWJlIGEgQlVHIGFuZCBjYXVzZSBUUk9VQkxFIC8vIFRPRE8KLy8gb3RoZXdpc2Ugd2UgY2FuIGRlbGV0ZSBpdCAtIHRoZSBwZXJkYXkgLSBhcyBpdHMgYSBuZXcgcGVyZGF5IGFuZCBub3QgInJlcGxhY2luZyIgYSAxOTcwIG9uZQoKaWYgKHNlbGVjdGVkRXZlbnQubGltaXRfaWQgIT0gbnVsbCkgLy8gdGhpcyBpcyB0aGUgcGVyZGF5IHRoYXQgcmVwbGFjZXMgYSAxOTcwIG9uZSAtIHdlIHNldCBpdCB0byBzdGFydD1lbmQKewpsb2dEZWJ1ZygicmVtb3ZpbmcgZXZlbnQgbGltaXRhdGlvbiBwZXIgZGF5IHJlbGF0ZWQgdG8gMTk3MCAodXBkYXRpbmcgaXQgdG8gc3RhcnQ9ZW5kKSIpOwoKdGhlZGF0YT0gewpzdGFydF9kYXRlOiBzZWxlY3RlZEV2ZW50LnN0YXJ0LAplbmRfZGF0ZTogc2VsZWN0ZWRFdmVudC5zdGFydCwKdGVtcF9kYXlfbGltaXRfaWQ6IHNlbGVjdGVkRXZlbnQudGVtcF9saW1pdF9pZCwKZGF5X2xpbWl0X2lkOiBzZWxlY3RlZEV2ZW50LmRheV9saW1pdF9pZAp9Owp1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXkoJGh0dHAsJHNjb3BlLHRoZWRhdGEsdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5X3N1Y2Nlcyk7CgpmdW5jdGlvbiB1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXlfc3VjY2VzKCkKewokc2NvcGUuZGVsZXRlQ2FsZW5kYXJKU0V2ZW50KGNhbGVuZGFyLCBzZWxlY3RlZEV2ZW50LmlkKTsKfQp9CmVsc2UgIC8vIHRoaXMgaXMgdGhlIGNhc2Ugd2hlcmUgdGhlIHBlcmRheSBkb2VzbnQgcmVwbGFjZSBhIDE5NzAgb25lLCB3ZSBjYW4gc2ltcGx5IGRlbGV0ZSBpdAp7CmxvZ0RlYnVnKCJyZW1vdmluZyBldmVudCBsaW1pdGF0aW9uIHBlciBkYXkgcmVsYXRlZCBub3QgcmVsYXRlZCB0byAxOTcwIChzbyB3ZSdyZSBkZWxldGluZyBpdCkiKTsKdGhlZGF0YSA9IHsKdGVtcF9saW1pdF9pZDogc2VsZWN0ZWRFdmVudC50ZW1wX2xpbWl0X2lkCn07CmRlbGV0ZUNhbGVuZGFyTGltaXRhdGlvblBlckRheSgkaHR0cCwkc2NvcGUsdGhlZGF0YSxzZWxlY3RlZEV2ZW50LmRheV9saW1pdF9pZCwgZGVsZXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5X3N1Y2Nlc3MpOwpmdW5jdGlvbiBkZWxldGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXlfc3VjY2VzcygpCnsKJHNjb3BlLmRlbGV0ZUNhbGVuZGFySlNFdmVudChjYWxlbmRhciwgc2VsZWN0ZWRFdmVudC5pZCk7Cn0KfQp9CmxvZ0RlYnVnKCJhZnRlciByZW1vdmUgZXZlbnQiKTsKCn07CgoKJHNjb3BlLnN0YXJ0TWludXRlcyA9IGZ1bmN0aW9uKCkKewpsb2dEZWJ1Zygic3RhcnRNaW51dGVzICIrKCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcykpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXM9bWludXRlc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKTsKY2FsY3VsYXRlU3RhcnRUaW1lKCk7Cn0KJHNjb3BlLnN0YXJ0SG91cnMgPSBmdW5jdGlvbigpCnsKbG9nRGVidWcoInN0YXJ0SG91cnMgIitob3Vyc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzPWhvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKTsKY2FsY3VsYXRlU3RhcnRUaW1lKCk7Cn0KJHNjb3BlLmVuZE1pbnV0ZXMgPSBmdW5jdGlvbigpCnsKbG9nRGVidWcoImVuZE1pbnV0ZXMgIisoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcykpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzPW1pbnV0ZXNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpOwpjYWxjdWxhdGVFbmRUaW1lKCk7Cn0KJHNjb3BlLmVuZEhvdXJzID0gZnVuY3Rpb24oKQp7CmxvZ0RlYnVnKCJlbmRIb3VycyAiK2hvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycykpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vycz1ob3Vyc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMpOwpjYWxjdWxhdGVFbmRUaW1lKCk7Cn0KCgpmdW5jdGlvbiBjYWxjdWxhdGVTdGFydFRpbWUoKQp7CmV2ZW50WWVhcj0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXI7CmV2ZW50TW9udGg9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aDExMjsKZXZlbnREYXk9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXlvZm1vbnRoOwppZiAocGFyc2VJbnQoZXZlbnRNb250aCk8MTApCnsKZXZlbnRNb250aD0iMCIrZXZlbnRNb250aDsKfQppZiAocGFyc2VJbnQoZXZlbnREYXkpPDEwKQp7CmV2ZW50RGF5PSIwIitldmVudERheTsKfQoKbmV3X3N0YXJ0PW1vbWVudC51dGMoZXZlbnRZZWFyKyItIitldmVudE1vbnRoKyItIitldmVudERheSsiVDAwOjAwOjAwIikuYWRkKCgocGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykqNjApK3BhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcykpLCAnbWludXRlcycpOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWU9bmV3X3N0YXJ0Owpsb2dEZWJ1ZygibmV3X3N0YXJ0PSIrbmV3X3N0YXJ0KTsKfQpmdW5jdGlvbiBjYWxjdWxhdGVFbmRUaW1lKCkKewpldmVudFllYXI9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyOwpldmVudE1vbnRoPSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bW9udGgxMTI7CmV2ZW50RGF5PSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aDsKaWYgKHBhcnNlSW50KGV2ZW50TW9udGgpPDEwKQp7CmV2ZW50TW9udGg9IjAiK2V2ZW50TW9udGg7Cn0KaWYgKHBhcnNlSW50KGV2ZW50RGF5KTwxMCkKewpldmVudERheT0iMCIrZXZlbnREYXk7Cn0KCm5ld19lbmQ9bW9tZW50LnV0YyhldmVudFllYXIrIi0iK2V2ZW50TW9udGgrIi0iK2V2ZW50RGF5KyJUMDA6MDA6MDAiKS5hZGQoKChwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycykqNjApK3BhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpKSwgJ21pbnV0ZXMnKTsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmRfdGltZT1uZXdfZW5kOwpsb2dEZWJ1ZygibmV3X2VuZD0iK25ld19lbmQpOwp9CgpjYWxjdWxhdGVTdGFydFRpbWUoKTsKY2FsY3VsYXRlRW5kVGltZSgpOwoKZnVuY3Rpb24gbWludXRlc0NoYW5nZWQodGhlbWludXRlcykKewpsb2dEZWJ1ZygidGhlbWludXRlcz0iK3RoZW1pbnV0ZXMpOwppZiAodHlwZW9mIHRoZW1pbnV0ZXM9PSJ1bmRlZmluZWQiKQp7CnJldHVybiAiMDAiOwp9CnRoZW1pbnV0ZXM9cGFyc2VJbnQodGhlbWludXRlcyk7CmlmICh0aGVtaW51dGVzPjYwKQp7CnJldHVybiAiMDAiOwp9CmVsc2UgaWYgKHRoZW1pbnV0ZXM8MCkKewpyZXR1cm4gIjAwIjsKfQplbHNlIGlmICh0aGVtaW51dGVzPT0iIikKewpyZXR1cm4gIjAwIjsKfQplbHNlIGlmICh0aGVtaW51dGVzPDEwKQp7CnJldHVybiAiMCIrdGhlbWludXRlczsKfQplbHNlCnsKcmV0dXJuIHRoZW1pbnV0ZXM7Cn0KfQpmdW5jdGlvbiBob3Vyc0NoYW5nZWQodGhlaG91cnMpCnsKbG9nRGVidWcoInRoZWhvdXJzPSIrdGhlaG91cnMpOwppZiAodHlwZW9mIHRoZWhvdXJzPT0idW5kZWZpbmVkIikKewpyZXR1cm4gIjAiOwp9CnRoZWhvdXJzPXBhcnNlSW50KHRoZWhvdXJzKTsKaWYgKHRoZWhvdXJzPjI0KQp7CnJldHVybiAwOwp9CmVsc2UgaWYgKHRoZWhvdXJzPDApCnsKcmV0dXJuIDA7Cn0KZWxzZSBpZiAodGhlaG91cnM9PSIiKQp7CnJldHVybiAiMCI7Cn0KZWxzZQp7CnJldHVybiB0aGVob3VyczsKfQp9Cgp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ0V2ZW50VHlwZXNDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGNvbXBpbGUsIHVpQ2FsZW5kYXJDb25maWcsICR1aWJNb2RhbCwkbG9jYXRpb24pIHsKbG9nRGVidWcoJ0V2ZW50VHlwZXMgQ29udHJvbGxlcicpOwoKZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzKCRodHRwLCRzY29wZSwnZXZlbnRfdHlwZXMnKTsKJHNjb3BlLnNob3dFdmVudFR5cGUgPSBmdW5jdGlvbiAodGhlRXZlbnQpCnsKJGxvY2F0aW9uLnBhdGgoJy9ldmVudF90eXBlcy8nK3RoZUV2ZW50LmV2ZW50X3R5cGVfaWQpOwp9Cn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdFdmVudFR5cGVOZXdDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGNvbXBpbGUsIHVpQ2FsZW5kYXJDb25maWcsICR1aWJNb2RhbCwgJGxvY2F0aW9uKSB7CmxvZ0RlYnVnKCdFdmVudFR5cGVzIENvbnRyb2xsZXIgTmV3Jyk7Cgokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcyA9IHt9OyAvLyB0aGVzZSBhcmUgdGhlIGNvbXBsZXRlIGRldGFpbHMgZm9yIHRoZSBuZXcgZXZlbnQgLy8KJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuaXNfY2xhc3MgPSAwOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5ibG9ja0V4dHJhVGltZSA9IGZhbHNlOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5kdXJhdGlvbl9iZWZvcmVfZXZlbnQgPSAwOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5kdXJhdGlvbl9hZnRlcl9ldmVudCA9IDA7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmluaGVyaXRfbWFpbl9ob3VycyA9IDE7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF93YWl0aW5nX2xpc3QgPSAzOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5pc191cGRhdGUgPSBmYWxzZTsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMubWF4X3BhcnRpY2lwYW50cyA9IDE7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF9yZWdpc3RyYXRpb25zPTE7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmlzX3B1YmxpYz0xOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5pbnN0cnVjdG9yX2lkPTA7Cgokc2NvcGUuZXZlbnRDb2xvclN0eWxlID0ge307CmRlZmF1bHRDb2xvciA9ICcwMGE2NWEnOwokc2NvcGUuZXZlbnRDb2xvclN0eWxlW2RlZmF1bHRDb2xvcl0gPSB7Cid0cmFuc2Zvcm0nOiAncm90YXRlKDMwZGVnKScKfTsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXZlbnRDb2xvciA9ICIjIiArIGRlZmF1bHRDb2xvcjsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMgPSBbCnsiZmllbGRfbmFtZSI6Iteh15nXm9eV150g157XpNeS16kiLCJmaWVsZF9kYXRhdHlwZSI6IlRFWFRfQVJFQSIsImlzX21hbmRhdG9yeSI6MCwgImZyb21kYiI6IGZhbHNlLCAiZGJfaWRfdG9maXgiOiAwLCAiaXNfYWN0aXZlIjogMSwgIm1vZGlmaWVkIjogZmFsc2V9LAp7ImZpZWxkX25hbWUiOiLXqdeZ16LXldeo15kg15HXmdeqIiwiZmllbGRfZGF0YXR5cGUiOiJURVhUX0FSRUEiLCJpc19tYW5kYXRvcnkiOjAsICJmcm9tZGIiOiBmYWxzZSwgImRiX2lkX3RvZml4IjogMCwgImlzX2FjdGl2ZSI6IDEsICJtb2RpZmllZCI6IGZhbHNlfQpdOwoKZ2V0QWxsSW5zdHJ1Y3RvcnMoJGh0dHAsJHNjb3BlLCdpbnN0cnVjdG9ycycsZ2V0QWxsSW5zdHJ1Y3RvcnNfc3VjY2Vzcyk7CmZ1bmN0aW9uIGdldEFsbEluc3RydWN0b3JzX3N1Y2Nlc3MoKQp7Ci8vICRzY29wZS5pbnN0cnVjdG9ycy51bnNoaWZ0KHtidXNpbmVzc191c2VyX2lkOjAsIGJ1c2VyX2ZpcnN0X25hbWU6IiIsIGJ1c2VyX2xhc3RfbmFtZToiIn0pOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5pbnN0cnVjdG9yX2lkPSRzY29wZS5pbnN0cnVjdG9yc1swXS5idXNpbmVzc191c2VyX2lkOwp9Cgokc2NvcGUuZXZlbnRUeXBlRXh0cmFGaWVsZHNQb3AgPSBmdW5jdGlvbihldmVudFR5cGVQcm9wZXJ0aWVzKSB7CiAgICAgICAgbG9nRGVidWcoImV2ZW50VHlwZUV4dHJhRmllbGRzUG9wMSIpOwoKdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CmFuaW1hdGlvbjogZmFsc2UsCnRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2V2ZW50X3R5cGVfZXh0cmFfZmllbGRzLnBocCcsCmNvbnRyb2xsZXI6ICdldmVudFR5cGVFeHRyYUZpZWxkc01vZGFsQ29udHJvbGxlcicsCnNpemU6ICdsJywKcmVzb2x2ZTogewpldmVudFR5cGVQcm9wZXJ0aWVzOiBmdW5jdGlvbigpIHsKcmV0dXJuIGV2ZW50VHlwZVByb3BlcnRpZXM7Cn0KfQp9KTsKCm1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24oc2VsZWN0ZWRJdGVtKSB7CmxvZ0RlYnVnKHNlbGVjdGVkSXRlbSk7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzID0gc2VsZWN0ZWRJdGVtOwp9LCBmdW5jdGlvbigpIHsKbG9nRGVidWcoJ01vZGFsIGRpc21pc3NlZCBhdDogJyArIG5ldyBEYXRlKCkpOwp9KTsKfTsKCiRzY29wZS5jaGFuZ2VFdmVudENvbG9yID0gZnVuY3Rpb24obmV3Q29sb3IpIHsKbG9nRGVidWcoImNob29zaW5nIGNvbG9yICIgKyBuZXdDb2xvcik7CiRzY29wZS5ldmVudENvbG9yID0gbmV3Q29sb3I7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV2ZW50Q29sb3IgPSAiIyIgKyBuZXdDb2xvcjsKJHNjb3BlLmV2ZW50Q29sb3JTdHlsZSA9IHsKJ2JhY2tncm91bmQtY29sb3InOiAiIyIgKyBuZXdDb2xvcgp9Owokc2NvcGUuZXZlbnRDb2xvclN0eWxlW25ld0NvbG9yXSA9IHsKJ3RyYW5zZm9ybSc6ICdyb3RhdGUoMzBkZWcpJwp9OwoKfQoKJHNjb3BlLmFkZEV2ZW50VHlwZUNhbmNlbCA9IGZ1bmN0aW9uKCkgewokbG9jYXRpb24ucGF0aCgnL2V2ZW50X3R5cGVzJyk7Cn07CgogICAgJHNjb3BlLmR1cGxpY2F0ZUZpZWxkTmFtZXM9IiI7CiRzY29wZS5hZGRFdmVudFR5cGUgPSBmdW5jdGlvbigpIHsKICAgICAgICAvLyBjaGVjayBleHRyYSBmaWVsZHMgZHVwbGljYXRlIG5hbWVzIC0gc3RhcnQKICAgICAgICBsb2dEZWJ1ZygiYWRkRXZlbnRUeXBlOiBjaGVjayBleHRyYSBmaWVsZHMgZHVwbGljYXRlIG5hbWVzIC0gc3RhcnQiKTsKICAgICAgICB2YXIgZXh0cmFGaWVsZHNOYW1lcyA9IFtdOwogICAgICAgIGZvciAodmFyIGk9MTsgaTwkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcy5sZW5ndGg7IGkrKykKICAgICAgICB7CiAgICAgICAgICBleHRyYUZpZWxkc05hbWVzLnB1c2goJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHNbaV0uZmllbGRfbmFtZSk7CiAgICAgICAgfQogICAgICAgIGV4dHJhRmllbGRzTmFtZXMuc29ydCgpOwogICAgICAgIHZhciBsYXN0ID0gZXh0cmFGaWVsZHNOYW1lc1swXTsKICAgICAgICBmb3IgKHZhciBpPTE7IGk8ZXh0cmFGaWVsZHNOYW1lcy5sZW5ndGg7IGkrKykKICAgICAgICB7CiAgICAgICAgICAgaWYgKGV4dHJhRmllbGRzTmFtZXNbaV0gPT0gbGFzdCkKICAgICAgICAgICB7CiAgICAgICAgICAgIC8vICBhbGVydCgnRHVwbGljYXRlIDogJytsYXN0KTsKICAgICAgICAgICAgICRzY29wZS5kdXBsaWNhdGVGaWVsZE5hbWVzPSfXp9eZ15nXnSDXqdeT15Qg16rXmdei15XXkyDXqNek15XXkNeZINeb16TXldecINeR16nXnSAiJytsYXN0KyciLi4uJzsKICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICB9CiAgICAgICAgICAgbGFzdCA9IGV4dHJhRmllbGRzTmFtZXNbaV07CiAgICAgICAgfQogICAgICAgIC8vIGNoZWNrIGV4dHJhIGZpZWxkcyBkdXBsaWNhdGUgbmFtZXMgLSBlbmQKCmxvZ0RlYnVnKCJhZGQgRXZlbnQgVHlwZSIgKyAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcyArICJleHRyYSBmaWVsZHM9IiArJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMpOwppZiAoKCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF9yZWdpc3RyYXRpb25zPT0nJykgfHwgKCEkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5tYXhfcmVnaXN0cmF0aW9ucykpCnsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMubWF4X3JlZ2lzdHJhdGlvbnM9MDsKfQphZGRFdmVudFR5cGUoJGh0dHAsJHNjb3BlLCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLGFkZEV2ZW50VHlwZV9zdWNjZXNzKTsKZnVuY3Rpb24gYWRkRXZlbnRUeXBlX3N1Y2Nlc3MoKQp7CiRsb2NhdGlvbi5wYXRoKCcvZXZlbnRfdHlwZXMnKTsKfQp9Owp9KTsKCmt1emVBcHAuY29udHJvbGxlcignRXZlbnRUeXBlVXBkYXRlQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRjb21waWxlLCAkcm91dGVQYXJhbXMsIHVpQ2FsZW5kYXJDb25maWcsICR1aWJNb2RhbCwgJGxvY2F0aW9uKSB7CmV2ZW50X3R5cGVfaWQ9JHJvdXRlUGFyYW1zLmV2ZW50X3R5cGVfaWQ7CmxvZ0RlYnVnKCdFdmVudFR5cGVzIENvbnRyb2xsZXIgVXBkYXRlICcrZXZlbnRfdHlwZV9pZCk7Cgokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcyA9IHt9OyAvLyB0aGVzZSBhcmUgdGhlIGNvbXBsZXRlIGRldGFpbHMgZm9yIHRoZSBuZXcgZXZlbnQgLy8KJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuaXNfdXBkYXRlID0gdHJ1ZTsKCiRzY29wZS5ldmVudENvbG9yU3R5bGUgPSB7fTsKZ2V0QWxsSW5zdHJ1Y3RvcnMoJGh0dHAsJHNjb3BlLCdpbnN0cnVjdG9ycycsZ2V0QWxsSW5zdHJ1Y3RvcnNfc3VjY2Vzcyk7CmZ1bmN0aW9uIGdldEFsbEluc3RydWN0b3JzX3N1Y2Nlc3MoKQp7CiRzY29wZS5pbnN0cnVjdG9ycy51bnNoaWZ0KHtidXNpbmVzc191c2VyX2lkOm51bGwsIGJ1c2VyX2ZpcnN0X25hbWU6IiIsIGJ1c2VyX2xhc3RfbmFtZToiIn0pOwp9CgpnZXRCdXNpbmVzc0V2ZW50VHlwZSgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmV2ZW50X3R5cGVfaWQsJ2V2ZW50VHlwZVByb3BlcnRpZXMnLGdldEJ1c2luZXNzRXZlbnRUeXBlX3N1Y2Nlc3MpOwoKZnVuY3Rpb24gZ2V0QnVzaW5lc3NFdmVudFR5cGVfc3VjY2VzcygpCnsKaWYgKCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF9yZWdpc3RyYXRpb25zPT1udWxsKQp7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF9yZWdpc3RyYXRpb25zPTE7Cn0KaWYgKCgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5kdXJhdGlvbl9iZWZvcmVfZXZlbnQ+MCkgfCAoJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZHVyYXRpb25fYWZ0ZXJfZXZlbnQ+MCkpCnsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuYmxvY2tFeHRyYVRpbWUgPSAxOwp9CmVsc2UKewokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5ibG9ja0V4dHJhVGltZSA9IDA7Cn0KLy8gJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuaW5oZXJpdF9tYWluX2hvdXJzID0gcmVzcG9uc2UuZGF0YVswXS5pbmhlcml0X21haW5faG91cnM7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmlzX3VwZGF0ZSA9IHRydWU7CmxvZ0RlYnVnKCIkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5jb2xvcj0iKyRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmNvbG9yKTsKJHNjb3BlLmV2ZW50Q29sb3JTdHlsZVskc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5jb2xvcl0gPSB7Cid0cmFuc2Zvcm0nOiAncm90YXRlKDMwZGVnKScKfTsKJHNjb3BlLmNoYW5nZUV2ZW50Q29sb3IoKCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmNvbG9yKS5zdWJzdHIoMSkpOwpsb2dEZWJ1ZygiJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuaW5zdHJ1Y3Rvcl9pZD0iKyRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmluc3RydWN0b3JfaWQpOwovLyBzYXZpbmcgZXZlbnQgdHlwZSBkZXRhaWxzIGFzaWRlIHRvIGxhdGVyIGNoZWNrIGlmIGFueXRoaW5nIGNoYW5nZWQKbG9nRGVidWcoImR1cGxpY2F0aW5nIG9iamVjdCBvZiBldmVudCB0eXBlIHRvIGxhdGVyIGNvbXBhcmUgIit0eXBlb2YgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMpOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllc0R1cGxpY2F0ZSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMpKTsKbG9nRGVidWcoIiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzRHVwbGljYXRlID0iKyRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzRHVwbGljYXRlLmV2ZW50X3R5cGVfbmFtZSk7Cn07CgovLyBldmVudCB0eXBlIGNoYW5nZWQgcG9wdXAKJHNjb3BlLmV2ZW50VHlwZUNoYW5nZWRQb3B1cCA9IGZ1bmN0aW9uKGV2ZW50VHlwZVByb3BlcnRpZXMpIHsKICAgICAgICBsb2dEZWJ1ZygiZXZlbnRUeXBlQ2hhbmdlZFBvcHVwIik7Cgp2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKYW5pbWF0aW9uOiBmYWxzZSwKdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfZXZlbnRfdHlwZV9jaGFuZ2VkLnBocCcsCmNvbnRyb2xsZXI6ICdldmVudFR5cGVDaGFuZ2VkUG9wdXBDb250cm9sbGVyJywKc2l6ZTogJ2wnLApyZXNvbHZlOiB7CmV2ZW50VHlwZVByb3BlcnRpZXM6IGZ1bmN0aW9uKCkgewpyZXR1cm4gJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXM7Cn0KfQp9KTsKCm1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24oc2VsZWN0ZWRJdGVtKQp7CmxvZ0RlYnVnKHNlbGVjdGVkSXRlbSk7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzID0gc2VsZWN0ZWRJdGVtOwp9LCBmdW5jdGlvbigpIHsKbG9nRGVidWcoJ01vZGFsIGRpc21pc3NlZCBhdDogJyArIG5ldyBEYXRlKCkpOwp9KTsKfTsKCi8vIGV2ZW50IHR5cGUgZXh0cmEgZmllbGQgcG9wdXAKJHNjb3BlLmV2ZW50VHlwZUV4dHJhRmllbGRzUG9wID0gZnVuY3Rpb24oZXZlbnRUeXBlUHJvcGVydGllcykgewogICAgICAgIGxvZ0RlYnVnKCJldmVudFR5cGVFeHRyYUZpZWxkc1BvcDIiKTsKCnZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewphbmltYXRpb246IGZhbHNlLAp0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9ldmVudF90eXBlX2V4dHJhX2ZpZWxkcy5waHAnLApjb250cm9sbGVyOiAnZXZlbnRUeXBlRXh0cmFGaWVsZHNNb2RhbENvbnRyb2xsZXInLApzaXplOiAnbCcsCnJlc29sdmU6IHsKZXZlbnRUeXBlUHJvcGVydGllczogZnVuY3Rpb24oKSB7CnJldHVybiBldmVudFR5cGVQcm9wZXJ0aWVzOwp9Cn0KfSk7Cgptb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHNlbGVjdGVkSXRlbSkgewpsb2dEZWJ1ZyhzZWxlY3RlZEl0ZW0pOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyA9IHNlbGVjdGVkSXRlbTsKfSwgZnVuY3Rpb24oKSB7CmxvZ0RlYnVnKCdNb2RhbCBkaXNtaXNzZWQgYXQ6ICcgKyBuZXcgRGF0ZSgpKTsKfSk7Cn07CgoKJHNjb3BlLmNoYW5nZUV2ZW50Q29sb3IgPSBmdW5jdGlvbihuZXdDb2xvcikgewpsb2dEZWJ1ZygiY2hvb3NpbmcgY29sb3IgIiArIG5ld0NvbG9yKTsKJHNjb3BlLmV2ZW50Q29sb3IgPSBuZXdDb2xvcjsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXZlbnRDb2xvciA9ICIjIiArIG5ld0NvbG9yOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5jb2xvciA9ICIjIiArIG5ld0NvbG9yOwokc2NvcGUuZXZlbnRDb2xvclN0eWxlID0gewonYmFja2dyb3VuZC1jb2xvcic6ICIjIiArIG5ld0NvbG9yCn07CiRzY29wZS5ldmVudENvbG9yU3R5bGVbbmV3Q29sb3JdID0gewondHJhbnNmb3JtJzogJ3JvdGF0ZSgzMGRlZyknCn07Cgp9Cgokc2NvcGUuYWRkRXZlbnRUeXBlQ2FuY2VsID0gZnVuY3Rpb24oKSB7CiRsb2NhdGlvbi5wYXRoKCcvZXZlbnRfdHlwZXMnKTsKfTsKCiRzY29wZS5hZGRFdmVudFR5cGUgPSBmdW5jdGlvbigpIHsgLy8gdGhpcyBmdW5jdGlvbiBVUERBVEVTIGV2ZW50IHR5cGUgKG5vdCBhZGRzKQovLyBjaGVja2luZyBpZiBhbnl0aGluZyBjaGFuZ2VkIHJlYWxseQovLyBhbmQgYXNraW5nIGlmIHdlIHNob3VsZCB1cGRhdGUgYWxsIGV2ZW50cyBmcm9tIG5vdyAob3Igb25seSBuZXdseSBjcmVhdGVkIGV2ZW50cykKLy8gY2hlY2tpbmcKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXNEdXBsaWNhdGUuZXh0cmFGaWVsZHM9JHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHM7CiAgICAgIC8vIGlmIChhbmd1bGFyLmVxdWFscygkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllc0R1cGxpY2F0ZSwkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcykpCiAgICAgIGlmICh0cnVlKSAvLyBpZ25vcmluZyB0cnlpbmcgdG8gbWFrZSBjaGFuZ2VzIHRvIGV2ZW50cwp7Ci8vICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzRHVwbGljYXRlLmV4dHJhRmllbGRzID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcykpOwoKbG9nRGVidWcoIm5vdGhpbmcgY2hhbmdlZCBpbiBldmVudCB0eXBlLCBvciBvbmx5IGV4dHJhIGZpZWxkcyIpOwokc2NvcGUudXBkYXRlRXZlbnRUeXBlKCk7Cn0KZWxzZQp7CmxvZ0RlYnVnKCJldmVudCB0eXBlIGNoYW5nZWQiKTsKJHNjb3BlLmV2ZW50VHlwZUNoYW5nZWRQb3B1cCgpOwp9Ci8vICRzY29wZS51cGRhdGVFdmVudFR5cGUoKTsKfQokc2NvcGUudXBkYXRlRXZlbnRUeXBlID0gZnVuY3Rpb24oKQp7CiAgICAgIC8vIGNoZWNrIGV4dHJhIGZpZWxkcyBkdXBsaWNhdGUgbmFtZXMgLSBzdGFydAogICAgICBsb2dEZWJ1ZygiYWRkRXZlbnRUeXBlOiBjaGVjayBleHRyYSBmaWVsZHMgZHVwbGljYXRlIG5hbWVzIC0gc3RhcnQiKTsKICAgICAgdmFyIGV4dHJhRmllbGRzTmFtZXMgPSBbXTsKICAgICAgZm9yICh2YXIgaT0xOyBpPCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzLmxlbmd0aDsgaSsrKQogICAgICB7CiAgICAgICAgZXh0cmFGaWVsZHNOYW1lcy5wdXNoKCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzW2ldLmZpZWxkX25hbWUpOwogICAgICB9CiAgICAgIGV4dHJhRmllbGRzTmFtZXMuc29ydCgpOwogICAgICB2YXIgbGFzdCA9IGV4dHJhRmllbGRzTmFtZXNbMF07CiAgICAgIGZvciAodmFyIGk9MTsgaTxleHRyYUZpZWxkc05hbWVzLmxlbmd0aDsgaSsrKQogICAgICB7CiAgICAgICAgIGlmIChleHRyYUZpZWxkc05hbWVzW2ldID09IGxhc3QpCiAgICAgICAgIHsKICAgICAgICAgIC8vICBhbGVydCgnRHVwbGljYXRlIDogJytsYXN0KTsKICAgICAgICAgICAgbG9nRGVidWcoJ9en15nXmdedINep15PXlCDXqteZ16LXldeTINeo16TXldeQ15kg15vXpNeV15wg15HXqdedICInK2xhc3QrJyIuLi4nKTsKICAgICAgICAgICAkc2NvcGUuZHVwbGljYXRlRmllbGROYW1lcz0n16fXmdeZ150g16nXk9eUINeq15nXoteV15Mg16jXpNeV15DXmSDXm9ek15XXnCDXkdep150gIicrbGFzdCsnIi4uLic7CiAgICAgICAgICAgcmV0dXJuOwogICAgICAgICB9CiAgICAgICAgIGxhc3QgPSBleHRyYUZpZWxkc05hbWVzW2ldOwogICAgICB9CiAgICAgIC8vIGNoZWNrIGV4dHJhIGZpZWxkcyBkdXBsaWNhdGUgbmFtZXMgLSBlbmQKCiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLnVwZGF0ZV9leGlzdGluZ19ldmVudHM9ZmFsc2U7CgogICAgICBsb2dEZWJ1ZygidXBkYXRlRXZlbnRUeXBlOiB1cGRhdGUgRXZlbnQgVHlwZSAiICsgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXZlbnRfdHlwZV9pZCk7CmlmICgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5tYXhfcmVnaXN0cmF0aW9ucz09JycpCnsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMubWF4X3JlZ2lzdHJhdGlvbnM9MDsKfQp1cGRhdGVFdmVudFR5cGUoJGh0dHAsJHNjb3BlLCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV2ZW50X3R5cGVfaWQsJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMsdXBkYXRlRXZlbnRUeXBlX3N1Y2Nlc3MpOwpmdW5jdGlvbiB1cGRhdGVFdmVudFR5cGVfc3VjY2VzcygpCnsKJGxvY2F0aW9uLnBhdGgoJy9ldmVudF90eXBlcycpOwp9Cn0KfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdldmVudENyZWF0ZU1vZGFsQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRyb290U2NvcGUsIHNoYXJlZFByb3BlcnRpZXMsIGV2ZW50X3R5cGVfaWQsIGxvY2F0aW9uX2lkLCBlbXBfaWQsICRodHRwLCBzdGFydERhdGUsIHJlc2NoZWR1bGVfZXZlbnQsIHVpQ2FsZW5kYXJDb25maWcpIHsKc3RhcnREYXRlPW5ldyBtb21lbnQoc3RhcnREYXRlKTsKbG9nRGVidWcoImV2ZW50Q3JlYXRlTW9kYWxDb250cm9sbGVyLCBzdGFydERhdGU9IitzdGFydERhdGUrIiB0eXBlICIrdHlwZW9mIHN0YXJ0RGF0ZSk7CmxvZ0RlYnVnKCJldmVudENyZWF0ZU1vZGFsQ29udHJvbGxlciwgcmVzY2hlZHVsZV9ldmVudD0iK3Jlc2NoZWR1bGVfZXZlbnQpOwoKJHNjb3BlLmV2ZW50VHlwZVRpdGxlID0gIteR15fXqCDXodeV15Ig157XpNeS16kiOwokc2NvcGUuc2hvd0V2ZW50VHlwZVNlbGVjdGVkID0gZmFsc2U7CiRzY29wZS5zaG93RXZlbnRDbGllbnRTZWxlY3RlZCA9IGZhbHNlOwokc2NvcGUubmV3RXZlbnREZXRhaWxzID0ge307IC8vIHRoZXNlIGFyZSB0aGUgY29tcGxldGUgZGV0YWlscyBmb3IgdGhlIG5ldyBldmVudCAvLwokc2NvcGUubmV3RXZlbnREZXRhaWxzLnJlcGVhdFR5cGUgPSAiZm9yZXZlciI7CiRzY29wZS5uZXdFdmVudERldGFpbHMucmVwZWF0Rml4ZWRUaW1lcyA9ICI0IjsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5tYXhfcGFydGljaXBhbnRzID0gMTsKCmxvZ0RlYnVnKCJYWFggPSAiK0pTT04uc3RyaW5naWZ5KHJlc2NoZWR1bGVfZXZlbnQpKTsKCiRzY29wZS5yZXNjaGVkdWxlX2V2ZW50PWZhbHNlOwokc2NvcGUucmVzY2hlZHVsZV9ldmVudF9kZXRhaWxzPXJlc2NoZWR1bGVfZXZlbnQ7CmlmICgkc2NvcGUucmVzY2hlZHVsZV9ldmVudF9kZXRhaWxzIT1udWxsKQp7CmxvZ0RlYnVnKCJyZXNjaGVkdWxlX2V2ZW50X2RldGFpbHM9Iiskc2NvcGUucmVzY2hlZHVsZV9ldmVudF9kZXRhaWxzLmV2ZW50X2lkKTsKbG9nRGVidWcoSlNPTi5zdHJpbmdpZnkoJHNjb3BlLnJlc2NoZWR1bGVfZXZlbnRfZGV0YWlscykpOwokc2NvcGUucmVzY2hlZHVsZV9ldmVudD10cnVlOwokc2NvcGUuZ2l2ZW5fZXZlbnRfdHlwZV9pZCA9ICRzY29wZS5yZXNjaGVkdWxlX2V2ZW50X2RldGFpbHMuZXZlbnRfdHlwZV9pZDsKLy8gc3RpbGwgcHJlZmVyaW5nIGVtcF9pZCBmcm9tIHNjaGVkdWxlciBzdWdnZXN0aW9uIGlzIGl0IHdhcyBzZWxlY3RlZAppZiAoZW1wX2lkIT0wKQp7CiRzY29wZS5naXZlbl9lbXBfaWQgPSBlbXBfaWQ7Cn0KZWxzZQp7CiRzY29wZS5naXZlbl9lbXBfaWQgPSAkc2NvcGUucmVzY2hlZHVsZV9ldmVudF9kZXRhaWxzLmluc3RydWN0b3JfaWQ7Cn0KLy8gc3RpbGwgcHJlZmVyaW5nIGxvY2F0aW9uX2lkIGZyb20gc2NoZWR1bGVyIHN1Z2dlc3Rpb24gb3ZlciB0aGUgb3JpZ2luYWwgbG9jYXRpb24gZnJvbSBldmVudAppZiAobG9jYXRpb25faWQhPTApCnsKJHNjb3BlLmdpdmVuX2xvY2F0aW9uX2lkID0gbG9jYXRpb25faWQ7Cn0KZWxzZQp7CiRzY29wZS5naXZlbl9sb2NhdGlvbl9pZCA9ICRzY29wZS5yZXNjaGVkdWxlX2V2ZW50X2RldGFpbHMubG9jYXRpb25faWQ7Cn0KfQplbHNlCnsKJHNjb3BlLmdpdmVuX2V2ZW50X3R5cGVfaWQgPSBldmVudF90eXBlX2lkOwokc2NvcGUuZ2l2ZW5fbG9jYXRpb25faWQgPSBsb2NhdGlvbl9pZDsKJHNjb3BlLmdpdmVuX2VtcF9pZCA9IGVtcF9pZDsKfQppZiAoJHNjb3BlLmdpdmVuX2V2ZW50X3R5cGVfaWQ+MCkKewokc2NvcGUucHJldmlvdXNseV9zZWxlY3RlZF9ldmVudF90eXBlPXRydWU7Cn0KZWxzZQp7CiRzY29wZS5wcmV2aW91c2x5X3NlbGVjdGVkX2V2ZW50X3R5cGU9ZmFsc2U7Cn0KbG9nRGVidWcoIiRzY29wZS5naXZlbl9ldmVudF90eXBlX2lkPSIrJHNjb3BlLmdpdmVuX2V2ZW50X3R5cGVfaWQpOwoKc2VsZWN0ZWREYXRlU3RhcnQgPSBuZXcgRGF0ZShzdGFydERhdGUpOwpsb2dEZWJ1Zygic2VsZWN0ZWREYXRlU3RhcnQgPSAiK3NlbGVjdGVkRGF0ZVN0YXJ0KTsKdmFyIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZSgpICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKCi8vIGxvZ0RlYnVnKCJkYXRlPSIgKyBzZWxlY3RlZERhdGVTdGFydCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50ID0gW107CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRIb3VycygpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBzZWxlY3RlZERhdGVTdGFydC5nZXRNaW51dGVzKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZG93ID0gZGF5TmFtZXNbc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RGF5KCldOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRhdGUgPSBzZWxlY3RlZERhdGVTdGFydDsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aCA9IG1vbnRoTmFtZXNbc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TW9udGgoKV07CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bW9udGgxMTIgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRNb250aCgpKzE7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aCA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldERhdGUoKTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RnVsbFllYXIoKTsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5zdGFydF90aW1lX2lucHV0X2Zvcm1hdD0gbmV3IERhdGUoMTk3MCwgMCwgMSwgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycywgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzLCAwKTsKCiRzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZCA9ICRzY29wZS5naXZlbl9lbXBfaWQ7CiRzY29wZS5uZXdFdmVudERldGFpbHMubG9jYXRpb25faWQgPSAkc2NvcGUuZ2l2ZW5fbG9jYXRpb25faWQ7CgpnZXRCdXNpbmVzc0xvY2F0aW9ucygkaHR0cCwkc2NvcGUsJ2J1c2luZXNzX2xvY2F0aW9ucycsZ2V0QnVzaW5lc3NMb2NhdGlvbnNfZmluaXNoKTsKZnVuY3Rpb24gZ2V0QnVzaW5lc3NMb2NhdGlvbnNfZmluaXNoKCkKewppZiAoJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5sb2NhdGlvbl9pZD09MCkKewokc2NvcGUubmV3RXZlbnREZXRhaWxzLmxvY2F0aW9uX2lkPSRzY29wZS5idXNpbmVzc19sb2NhdGlvbnNbMF0ubG9jYXRpb25faWQ7Cn0KfQoKY29uc29sZS5sb2coIiRzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZD0iKyRzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZCk7Ci8vIGlmIGNsaWVudCB3YXMgcHJldmlvdXNseSBzZWxlY3RlZAokc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcj1mYWxzZTsKbG9nRGVidWcoInNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXI9IitzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKTsKaWYgKHNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKSE9bnVsbCkKewovLyBjb25zb2xlLmxvZygiZ290IHByZXZpb3VzIHNlbGVjdGVkIHVzZXIgIitzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfZmlyc3RfbmFtZSk7CiRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VybmFtZT1zaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfZmlyc3RfbmFtZSsiICIrc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2VyX2xhc3RfbmFtZTsKJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXI9dHJ1ZTsKCiRzY29wZS5zaG93RXZlbnRDbGllbnRTZWxlY3RlZCA9IHRydWU7CiRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kdXNlcl9pZCA9IHNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKS5idXNpbmVzc191c2VyX2lkOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZHVzZXJfZmlyc3RfbmFtZSA9IHNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKS5idXNlcl9maXJzdF9uYW1lOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZHVzZXJfbGFzdF9uYW1lID0gc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2VyX2xhc3RfbmFtZTsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5idXNpbmVzc191c2VyX2lkID0gc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2luZXNzX3VzZXJfaWQ7Cgp9CiRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZSA9IHN0YXJ0RGF0ZTsKbG9nRGVidWcoIiRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZTE9Iiskc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWUpOwokc2NvcGUuc3RhcnRNaW51dGVzID0gZnVuY3Rpb24oKQp7CmxvZ0RlYnVnKCJzdGFydE1pbnV0ZXMgIisoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKSk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcz1taW51dGVzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpOwpjYWxjdWxhdGVTdGFydFRpbWUoKTsKY2FsY3VsYXRlRW5kVGltZUR5bmFtaWMoKTsKfQokc2NvcGUuc3RhcnRIb3VycyA9IGZ1bmN0aW9uKCkKewpsb2dEZWJ1Zygic3RhcnRIb3VycyAiK2hvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKSk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnM9aG91cnNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMpOwpjYWxjdWxhdGVTdGFydFRpbWUoKTsKY2FsY3VsYXRlRW5kVGltZUR5bmFtaWMoKTsKfQoKJHNjb3BlLmVuZE1pbnV0ZXMgPSBmdW5jdGlvbigpCnsKbG9nRGVidWcoImVuZE1pbnV0ZXMgIisoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcykpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzPW1pbnV0ZXNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpOwpjYWxjdWxhdGVTdGFydFRpbWUoKTsKY2FsY3VsYXRlRW5kVGltZUR5bmFtaWMoKTsKfQokc2NvcGUuZW5kSG91cnMgPSBmdW5jdGlvbigpCnsKbG9nRGVidWcoImVuZEhvdXJzICIraG91cnNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzKSk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzPWhvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vycyk7CmNhbGN1bGF0ZVN0YXJ0VGltZSgpOwpjYWxjdWxhdGVFbmRUaW1lRHluYW1pYygpOwp9CgpmdW5jdGlvbiBjYWxjdWxhdGVTdGFydFRpbWUoKQp7CmV2ZW50WWVhcj0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXI7CmV2ZW50TW9udGg9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aDExMjsKZXZlbnREYXk9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXlvZm1vbnRoOwppZiAocGFyc2VJbnQoZXZlbnRNb250aCk8MTApCnsKZXZlbnRNb250aD0iMCIrZXZlbnRNb250aDsKfQppZiAocGFyc2VJbnQoZXZlbnREYXkpPDEwKQp7CmV2ZW50RGF5PSIwIitldmVudERheTsKfQpsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyPSIrZXZlbnRZZWFyKTsKbG9nRGVidWcoIiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aD0iK2V2ZW50TW9udGgpOwpsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aD0iK2V2ZW50RGF5KTsKbmV3X3N0YXJ0PW1vbWVudC51dGMoZXZlbnRZZWFyKyItIitldmVudE1vbnRoKyItIitldmVudERheSsiVDAwOjAwOjAwIikuYWRkKCgocGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykqNjApK3BhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcykpLCAnbWludXRlcycpOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWU9bmV3X3N0YXJ0Owpsb2dEZWJ1ZygibmV3X3N0YXJ0PSIrbmV3X3N0YXJ0KTsKfQpmdW5jdGlvbiBtaW51dGVzQ2hhbmdlZCh0aGVtaW51dGVzKQp7CmxvZ0RlYnVnKCJ0aGVtaW51dGVzPSIrdGhlbWludXRlcyk7CmlmICh0eXBlb2YgdGhlbWludXRlcz09InVuZGVmaW5lZCIpCnsKcmV0dXJuICIwMCI7Cn0KaWYgKGlzTmFOKHRoZW1pbnV0ZXMpKQp7CnJldHVybiAiMDAiOwp9CmlmICh0aGVtaW51dGVzPT0nJykKewpyZXR1cm4gIjAwIjsKfQp0aGVtaW51dGVzPXBhcnNlSW50KHRoZW1pbnV0ZXMpOwppZiAodGhlbWludXRlcz42MCkKewpyZXR1cm4gIjAwIjsKfQplbHNlIGlmICh0aGVtaW51dGVzPDApCnsKcmV0dXJuICIwMCI7Cn0KZWxzZSBpZiAodGhlbWludXRlcz09IiIpCnsKcmV0dXJuICIwMCI7Cn0KZWxzZSBpZiAodGhlbWludXRlczwxMCkKewpyZXR1cm4gIjAiK3RoZW1pbnV0ZXM7Cn0KZWxzZQp7CnJldHVybiB0aGVtaW51dGVzOwp9Cn0KZnVuY3Rpb24gaG91cnNDaGFuZ2VkKHRoZWhvdXJzKQp7CmxvZ0RlYnVnKCJ0aGVob3Vycz0iK3RoZWhvdXJzKTsKaWYgKHR5cGVvZiB0aGVob3Vycz09InVuZGVmaW5lZCIpCnsKcmV0dXJuICIwIjsKfQppZiAoaXNOYU4odGhlaG91cnMpKQp7CnJldHVybiAiMCI7Cn0KaWYgKHRoZWhvdXJzPT0nJykKewpyZXR1cm4gIjAiOwp9CnRoZWhvdXJzPXBhcnNlSW50KHRoZWhvdXJzKTsKaWYgKHRoZWhvdXJzPjI0KQp7CnJldHVybiAwOwp9CmVsc2UgaWYgKHRoZWhvdXJzPDApCnsKcmV0dXJuIDA7Cn0KZWxzZSBpZiAodGhlaG91cnM9PSIiKQp7CnJldHVybiAiMCI7Cn0KZWxzZQp7CnJldHVybiB0aGVob3VyczsKfQp9CmdldEFsbEluc3RydWN0b3JzKCRodHRwLCRzY29wZSwnaW5zdHJ1Y3RvcnMnLGdldEFsbEluc3RydWN0b3JzX3N1Y2Nlc3MpOwpmdW5jdGlvbiBnZXRBbGxJbnN0cnVjdG9yc19zdWNjZXNzKCkKewovLyAkc2NvcGUuaW5zdHJ1Y3RvcnMudW5zaGlmdCh7YnVzaW5lc3NfdXNlcl9pZDpudWxsLCBidXNlcl9maXJzdF9uYW1lOiIiLCBidXNlcl9sYXN0X25hbWU6IiJ9KTsKaWYgKCEkc2NvcGUubmV3RXZlbnREZXRhaWxzLmluc3RydWN0b3JfaWQ+MCkKewokc2NvcGUubmV3RXZlbnREZXRhaWxzLmluc3RydWN0b3JfaWQ9JHNjb3BlLmluc3RydWN0b3JzWzBdLmJ1c2luZXNzX3VzZXJfaWQ7Cn0KfQoKJHNjb3BlLnNlbGVjdEV2ZW50VHlwZSA9IGZ1bmN0aW9uKCkgewovLyByZW1vdmluZyBldmVudCB0eXBlINeR15fXqCDXodeV15Ig157XpNeS16kKaWYgKCRzY29wZS5ldmVudFR5cGVPcHRpb25zWzBdLmV2ZW50X3R5cGVfaWQ9PTApCnsKJHNjb3BlLmV2ZW50VHlwZU9wdGlvbnMuc3BsaWNlKDAsIDEpOwp9CiRzY29wZS5hamF4X2Vycm9yPScnOwpjaG9pY2U9JHNjb3BlLnNlbGVjdEV2ZW50VHlwZVNlbGVjdGVkOwpsb2dEZWJ1Zygic2VsZWN0RXZlbnRUeXBlIik7CmxvZ0RlYnVnKEpTT04uc3RyaW5naWZ5KCRzY29wZS5zZWxlY3RFdmVudFR5cGVTZWxlY3RlZCkpOwokc2NvcGUuZXZlbnRUeXBlVGl0bGUgPSBjaG9pY2UuZXZlbnRfdHlwZV9uYW1lOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLmV2ZW50X3R5cGVfaWQgPSBjaG9pY2UuZXZlbnRfdHlwZV9pZDsKCiRzY29wZS5uZXdFdmVudERldGFpbHMuZXZlbnRfbmFtZSA9IGNob2ljZS5ldmVudF90eXBlX25hbWU7CiRzY29wZS5uZXdFdmVudERldGFpbHMub3JpZ2luYWxfZXZlbnRfbmFtZSA9IGNob2ljZS5ldmVudF90eXBlX25hbWU7CiRzY29wZS5uZXdFdmVudERldGFpbHMuZXZlbnRfZGVzY3JpcHRpb24gPSBjaG9pY2UuZXZlbnRfdHlwZV9kZXNjcmlwdGlvbjsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pc19jbGFzcyA9IGNob2ljZS5pc19jbGFzczsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5vcmlnaW5hbF9wcmljZSA9IGNob2ljZS5vcmlnaW5hbF9wcmljZTsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pc19nZW5lcmljX2V0eXBlID0gY2hvaWNlLmlzX2dlbmVyaWNfZXR5cGU7Ci8vICRzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZCA9IGNob2ljZS5pbnN0cnVjdG9yX2lkOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50ID0gY2hvaWNlLmR1cmF0aW9uX2V2ZW50OwovLyBsb2dEZWJ1Zygic2NvcGUubmV3RXZlbnREZXRhaWxzLmlzX2NsYXNzPSIrJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pc19jbGFzcyk7Ci8vIGxvZ0RlYnVnKCJzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZD0iKyRzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZCk7Ci8vIGxvZ0RlYnVnKCJzdGFydERhdGU9IitzdGFydERhdGUpOwovLyAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWUgPSBzdGFydERhdGU7CiRzY29wZS5uZXdFdmVudERldGFpbHMuZXZlbnR0eXBlID0gY2hvaWNlOwpjYWxjdWxhdGVFbmRUaW1lKCk7CgovLyAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWVfaW5wdXRfZm9ybWF0PSBuZXcgRGF0ZSgxOTcwLCAwLCAxLCAxNCwgNTcsIDApOwoKbG9nRGVidWcoIm5ld0V2ZW50IHN0YXJ0PSIgKyAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWUpOwpsb2dEZWJ1ZygibmV3RXZlbnQgZW5kPSIgKyAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZF90aW1lKTsKCiRzY29wZS5zaG93RXZlbnRUeXBlU2VsZWN0ZWQgPSB0cnVlOwp9CgovLyB0aGlzIGZ1bmN0aW9uIGNhbGN1bGF0ZXMgZW5kIHRpbWUgYWNjb3JkaW5nIHRvIHRoZSBsZW5ndGggb2YgdGhlIGV2ZW50dHlwZQpmdW5jdGlvbiBjYWxjdWxhdGVFbmRUaW1lKCkKewpjb25zb2xlLmxvZygiJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5zdGFydF90aW1lPSIrJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5zdGFydF90aW1lKTsKZW5kID0gbW9tZW50KCRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZSkuYWRkKCRzY29wZS5uZXdFdmVudERldGFpbHMuZHVyYXRpb25fZXZlbnQsICdtaW51dGVzJyk7CnNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKGVuZCk7CnNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKHNlbGVjdGVkRGF0ZUVuZC5nZXRUaW1lKCkgKyBzZWxlY3RlZERhdGVFbmQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMgPSBzZWxlY3RlZERhdGVFbmQuZ2V0SG91cnMoKTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kZG93ID0gZGF5TmFtZXNbc2VsZWN0ZWREYXRlRW5kLmdldERheSgpXTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcyA9IChzZWxlY3RlZERhdGVFbmQuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBzZWxlY3RlZERhdGVFbmQuZ2V0TWludXRlcygpOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZF90aW1lID0gZW5kOwovLyBjYWxjdWxhdGluZyBkdXJhdGlvbgokc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50PXBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpLXBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcyk7CiRzY29wZS5uZXdFdmVudERldGFpbHMuZHVyYXRpb25fZXZlbnQ9JHNjb3BlLm5ld0V2ZW50RGV0YWlscy5kdXJhdGlvbl9ldmVudCsocGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMpLXBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMpKSo2MDsKaWYgKCRzY29wZS5uZXdFdmVudERldGFpbHMuZHVyYXRpb25fZXZlbnQ8MCkKewokc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50PTA7Cn0KfQoKLy8gdGhpcyBmdW5jdGlvbiBjYWxjdWxhdGVzIGVuZCB0aW1lIGFjY29yZGluZyB0byB0aGUgaW5wdXQgZnJvbSBtb2RhbCB3aW5kb3cKLy8gYW5kIG5vdCBhY2NvcmRpbmcgdG8gZXZlbnQgdHlwZSBsZW5ndGgKZnVuY3Rpb24gY2FsY3VsYXRlRW5kVGltZUR5bmFtaWMoKQp7CmV2ZW50WWVhcj0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXI7CmV2ZW50TW9udGg9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aDExMjsKZXZlbnREYXk9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXlvZm1vbnRoOwppZiAocGFyc2VJbnQoZXZlbnRNb250aCk8MTApCnsKZXZlbnRNb250aD0iMCIrZXZlbnRNb250aDsKfQppZiAocGFyc2VJbnQoZXZlbnREYXkpPDEwKQp7CmV2ZW50RGF5PSIwIitldmVudERheTsKfQpsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyPSIrZXZlbnRZZWFyKTsKbG9nRGVidWcoIiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aD0iK2V2ZW50TW9udGgpOwpsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aD0iK2V2ZW50RGF5KTsKbmV3X2VuZD1tb21lbnQudXRjKGV2ZW50WWVhcisiLSIrZXZlbnRNb250aCsiLSIrZXZlbnREYXkrIlQwMDowMDowMCIpLmFkZCgoKHBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzKSo2MCkrcGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcykpLCAnbWludXRlcycpOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZF90aW1lPW5ld19lbmQ7CmxvZ0RlYnVnKCJuZXdfZW5kPSIrbmV3X2VuZCk7Ci8vIGNhbGN1bGF0aW5nIGR1cmF0aW9uCiRzY29wZS5uZXdFdmVudERldGFpbHMuZHVyYXRpb25fZXZlbnQ9cGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcyktcGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKTsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5kdXJhdGlvbl9ldmVudD0kc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50KyhwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycyktcGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykpKjYwOwppZiAoJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5kdXJhdGlvbl9ldmVudDwwKQp7CiRzY29wZS5uZXdFdmVudERldGFpbHMuZHVyYXRpb25fZXZlbnQ9MDsKfQp9CmdldEFsbEJ1c2luZXNzRXZlbnRUeXBlcygkaHR0cCwkc2NvcGUsJ2V2ZW50VHlwZU9wdGlvbnMnLGdldEFsbEJ1c2luZXNzRXZlbnRUeXBlc19zdWNjZXNzKTsKZnVuY3Rpb24gZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzX3N1Y2Nlc3MoKQp7Ci8vIGFmdGVyIGxvYWRpbmcgZXZlbnQgdHlwZXMsIGlmIHRoZSBnaXZlbiBldmVudCB0eXBlIGlzICE9IDAgd2UgInNlbGVjdCIgaXQKY29uc29sZS5sb2coImdldEFsbEJ1c2luZXNzRXZlbnRUeXBlc19zdWNjZXNzIik7CmlmICgkc2NvcGUuZ2l2ZW5fZXZlbnRfdHlwZV9pZD4wKQp7CmZvcih2YXIgaSA9IDA7IGkgPCAkc2NvcGUuZXZlbnRUeXBlT3B0aW9ucy5sZW5ndGg7IGkrKykKewppZiAoJHNjb3BlLmV2ZW50VHlwZU9wdGlvbnNbaV0uZXZlbnRfdHlwZV9pZD09JHNjb3BlLmdpdmVuX2V2ZW50X3R5cGVfaWQpCnsKY29uc29sZS5sb2coImdpdmVuX2V2ZW50X3R5cGVfaWQgZm91bmQiKTsKLy8gJHNjb3BlLmNhbGN1bGF0ZVN0YXJ0VGltZSgpOwokc2NvcGUuc2VsZWN0RXZlbnRUeXBlU2VsZWN0ZWQ9JHNjb3BlLmV2ZW50VHlwZU9wdGlvbnNbaV07Ci8vICRzY29wZS5zZWxlY3RFdmVudFR5cGUoJHNjb3BlLmV2ZW50VHlwZU9wdGlvbnNbaV0pOwokc2NvcGUuc2VsZWN0RXZlbnRUeXBlKCk7Cn0KfQp9CmVsc2Ugewokc2NvcGUuZXZlbnRUeXBlT3B0aW9ucy51bnNoaWZ0KHsiZXZlbnRfdHlwZV9pZCI6MCwgImV2ZW50X3R5cGVfbmFtZSI6IteR15fXqCDXodeV15Ig157XpNeS16kiLCBpc192YWNhdGlvbjogMH0pOwokc2NvcGUuc2VsZWN0RXZlbnRUeXBlU2VsZWN0ZWQ9JHNjb3BlLmV2ZW50VHlwZU9wdGlvbnNbMF07Cn0KfQpnZXRBbGxDbGllbnRzKCRodHRwLCRzY29wZSwnZXZlbnRUeXBlVXNlcnMnKTsKCiRzY29wZS5ldmVudENsaWVudFNlbGVjdGVkID0gZnVuY3Rpb24oc2VsZWN0ZWQpIHsKaWYgKHNlbGVjdGVkKSB7Ci8vIGFsZXJ0KEpTT04uc3RyaW5naWZ5KCBzZWxlY3RlZCwgbnVsbCwgMiApKTsKbG9nRGVidWcoJ2NsaWVudCBzZWxlY3RlZCAnICsgc2VsZWN0ZWQub3JpZ2luYWxPYmplY3QuYnVzZXJfZmlyc3RfbmFtZSk7CiRzY29wZS5zaG93RXZlbnRDbGllbnRTZWxlY3RlZCA9IHRydWU7CiRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kdXNlcl9pZCA9IHNlbGVjdGVkLm9yaWdpbmFsT2JqZWN0LmJ1c2luZXNzX3VzZXJfaWQ7CiRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kdXNlcl9maXJzdF9uYW1lID0gc2VsZWN0ZWQub3JpZ2luYWxPYmplY3QuYnVzZXJfZmlyc3RfbmFtZTsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmR1c2VyX2xhc3RfbmFtZSA9IHNlbGVjdGVkLm9yaWdpbmFsT2JqZWN0LmJ1c2VyX2xhc3RfbmFtZTsKfSBlbHNlIHsKbG9nRGVidWcoJ25vdCBzZWxlY3RlZCcpOwovLyAkc2NvcGUuZXZlbnRDbGllbnREZVNlbGVjdGVkKCk7Cn0KfTsKJHNjb3BlLmV2ZW50Q2xpZW50RGVTZWxlY3RlZCA9IGZ1bmN0aW9uKCkgewokc2NvcGUuc2hvd0V2ZW50Q2xpZW50U2VsZWN0ZWQgPSBmYWxzZTsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmR1c2VyX2lkID0gbnVsbDsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmR1c2VyX2ZpcnN0X25hbWUgPSBudWxsOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZHVzZXJfbGFzdF9uYW1lID0gbnVsbDsKJHNjb3BlLmNsZWFyQ2xpZW50SW5wdXQoJ2NsaWVudF9hbmd1Y29tcGxldGUnKTsKfQoKJHNjb3BlLmNsZWFyQ2xpZW50SW5wdXQgPSBmdW5jdGlvbihpZCkgewppZiAoaWQpIHsKJHNjb3BlLiRicm9hZGNhc3QoJ2FuZ3Vjb21wbGV0ZS1hbHQ6Y2xlYXJJbnB1dCcsIGlkKTsKfQovLyBlbHNlewovLyAgICRzY29wZS4kYnJvYWRjYXN0KCdhbmd1Y29tcGxldGUtYWx0OmNsZWFySW5wdXQnKTsKLy8gfQp9Cgokc2NvcGUuY2FuY2VsID0gZnVuY3Rpb24oKSB7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKfTsKCiRzY29wZS51cGRhdGVFdmVudE5hbWVDaGVjayA9IGZ1bmN0aW9uKG5ld1ZhbHVlKQp7CmxvZ0RlYnVnKCJ1cGRhdGVFdmVudE5hbWU9IituZXdWYWx1ZSk7CmlmIChuZXdWYWx1ZT09IiIpCnsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5ldmVudF9uYW1lID0gJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5vcmlnaW5hbF9ldmVudF9uYW1lOwp9Cn0KLy8gcmVzY2hlZHVsZUV2ZW50CiRzY29wZS5yZXNjaGVkdWxlRXZlbnQgPSBmdW5jdGlvbigpIHsKbG9nRGVidWcoImZ1bmN0aW9uOiByZXNjaGVkdWxlRXZlbnQiKTsKCi8vIG5ld0V2ZW50SlNPTkRldGFpbHMgPSBKU09OLnN0cmluZ2lmeSgkc2NvcGUubmV3RXZlbnREZXRhaWxzLCBudWxsLCA0KTsgLy8gKE9wdGlvbmFsKSBiZWF1dGlmdWwgaW5kZW50ZWQgb3V0cHV0Lgpsb2dEZWJ1ZygicmVzY2hlZHVsZUV2ZW50LCAiICsgSlNPTi5zdHJpbmdpZnkoJHNjb3BlLm5ld0V2ZW50RGV0YWlscywgbnVsbCwgNCkpOwovLyBpZiAoJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5ldmVudFJlY3VycmluZykgewovLyAgIGNyZWF0ZVJlY3VycmluZ0V2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUubmV3RXZlbnREZXRhaWxzLGNyZWF0ZVJlY3VycmluZ0V2ZW50X3N1Y2Nlc3MpOwovLyAgIGZ1bmN0aW9uIGNyZWF0ZVJlY3VycmluZ0V2ZW50X3N1Y2Nlc3MoKQovLyAgIHsKLy8gICAgIGNhbGVuZGFyID0gImNhbGVuZGFyX2J1c2luZXNzIjsKLy8gICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKLy8gICAgICR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoKTsKLy8gICAgIC8vIGVycm9yIHdhcwovLyAgICAgLy8gbG9nRGVidWcoImVycm9yICIgKyBkYXRhLk1lc3NhZ2UpOwovLyAgICAgLy8gJHNjb3BlLmFqYXhfZXJyb3IgPSBkYXRhLk1lc3NhZ2U7Ci8vICAgfQovLyB9Ci8vIGVsc2UKewovLyBpZiBldmVudCBpcyBub3QgY2xhc3MsIGEgY2xpZW50IG11c3QgYmUgc2VsZWN0ZWQKLy8gaWYgKCghJHNjb3BlLnNob3dFdmVudENsaWVudFNlbGVjdGVkKSAmJiAoISRzY29wZS5uZXdFdmVudERldGFpbHMuaXNfY2xhc3MpKQovLyB7Ci8vICAgLy8gYWxlcnQoJ2NsaWVudCBtdXN0IGJlIHNlbGVjdGVkJyk7Ci8vICAgJHNjb3BlLmFqYXhfZXJyb3I9IteQ16DXkCDXlNeV16HXoyDXntep16rXqtejINec157XpNeS16kiOwovLyAgIHJldHVybjsKLy8gfQpyZXNjaGVkdWxlRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5yZXNjaGVkdWxlX2V2ZW50X2RldGFpbHMuZXZlbnRfaWQsJHNjb3BlLm5ld0V2ZW50RGV0YWlscyxyZXNjaGVkdWxlRXZlbnRfc3VjY2Vzcyk7CmZ1bmN0aW9uIHJlc2NoZWR1bGVFdmVudF9zdWNjZXNzKCkKewpjYWxlbmRhciA9ICJjYWxlbmRhcl9idXNpbmVzcyI7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjYWxlbmRhckV2ZW50UmVzY2hlZHVsZURlc2VsZWN0Jyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCiR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoJ2FkZGVkJyk7Cn0KLy8gb24gZmFpbHVyZSB3YXMKLy8gJHNjb3BlLmFqYXhfZXJyb3IgPSBkYXRhLk1lc3NhZ2U7Cn0KfTsKCiRzY29wZS5jcmVhdGVOZXdFdmVudCA9IGZ1bmN0aW9uKCkgewpsb2dEZWJ1ZygiY3JlYXRlTmV3RXZlbnQgc3RhcnRfdGltZT0iKyB0eXBlb2YgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5zdGFydF90aW1lKTsKCm5ld0V2ZW50SlNPTkRldGFpbHMgPSBKU09OLnN0cmluZ2lmeSgkc2NvcGUubmV3RXZlbnREZXRhaWxzLCBudWxsLCA0KTsgLy8gKE9wdGlvbmFsKSBiZWF1dGlmdWwgaW5kZW50ZWQgb3V0cHV0Lgpsb2dEZWJ1ZygiY3JlYXRlTmV3RXZlbnQsICIgKyBuZXdFdmVudEpTT05EZXRhaWxzKTsKaWYgKCRzY29wZS5uZXdFdmVudERldGFpbHMuZXZlbnRSZWN1cnJpbmcpIHsKY3JlYXRlUmVjdXJyaW5nRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5uZXdFdmVudERldGFpbHMsY3JlYXRlUmVjdXJyaW5nRXZlbnRfc3VjY2Vzcyk7CmZ1bmN0aW9uIGNyZWF0ZVJlY3VycmluZ0V2ZW50X3N1Y2Nlc3MoKQp7CmNhbGVuZGFyID0gImNhbGVuZGFyX2J1c2luZXNzIjsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwokdWliTW9kYWxJbnN0YW5jZS5kaXNtaXNzKCk7Ci8vIGVycm9yIHdhcwovLyBsb2dEZWJ1ZygiZXJyb3IgIiArIGRhdGEuTWVzc2FnZSk7Ci8vICRzY29wZS5hamF4X2Vycm9yID0gZGF0YS5NZXNzYWdlOwp9Cn0KZWxzZQp7Ci8vIGNoZWNraW5nIGV2ZW50IHRpbWUgbG9naWMKaWYgKCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnM+JHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMpCnsKJHNjb3BlLmFqYXhfZXJyb3I9IteW157XnyDXlNeU16rXl9ec15Qg16nXnCDXlNee16TXktepINeQ15fXqNeZINeW157XnyDXlNeh15nXldedINep15zXlSI7CnJldHVybjsKfQovLyBjaGVja2luZyBldmVudCB0aW1lIGxvZ2ljCmlmIChwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKT09cGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMpKQp7CmlmIChwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpPj1wYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzKSkKewokc2NvcGUuYWpheF9lcnJvcj0i15bXntefINeU15TXqteX15zXlCDXqdecINeU157XpNeS16kg15DXl9eo15kg15bXntefINeU16HXmdeV150g16nXnNeVIjsKcmV0dXJuOwp9CmxvZ0RlYnVnKCIkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXM9Iiskc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpOwpsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcz0iKyRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpOwppZiAoKHBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcykrNSk+PXBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpKQp7CiRzY29wZS5hamF4X2Vycm9yPSLXkNeV16jXmiDXlNee16TXktepINeX15nXmdeRINec15TXmdeV16og15zXpNeX15XXqiA1INeT16fXldeqIjsKcmV0dXJuOwp9Cn0KLy8gaWYgZXZlbnQgaXMgbm90IGNsYXNzLCBhIGNsaWVudCBtdXN0IGJlIHNlbGVjdGVkCmlmICgoISRzY29wZS5zaG93RXZlbnRDbGllbnRTZWxlY3RlZCkgJiYgKCEkc2NvcGUubmV3RXZlbnREZXRhaWxzLmlzX2NsYXNzKSAmJiAoJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pc19nZW5lcmljX2V0eXBlPT0wKSkKewovLyBhbGVydCgnY2xpZW50IG11c3QgYmUgc2VsZWN0ZWQnKTsKJHNjb3BlLmFqYXhfZXJyb3I9IteQ16DXkCDXlNeV16HXoyDXntep16rXqtejINec157XpNeS16kiOwpyZXR1cm47Cn0KaWYgKCRzY29wZS5zZWxlY3RFdmVudFR5cGVTZWxlY3RlZC5ldmVudF90eXBlX2lkPT0wKQp7Ci8vIGFsZXJ0KCdjbGllbnQgbXVzdCBiZSBzZWxlY3RlZCcpOwokc2NvcGUuYWpheF9lcnJvcj0i15DXoNeQINeR15fXqCDXodeV15Ig157XpNeS16kgIjsKcmV0dXJuOwp9CmNyZWF0ZUV2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUubmV3RXZlbnREZXRhaWxzLGNyZWF0ZUV2ZW50X3N1Y2Nlc3MpOwpmdW5jdGlvbiBjcmVhdGVFdmVudF9zdWNjZXNzKCkKewpjYWxlbmRhciA9ICJjYWxlbmRhcl9idXNpbmVzcyI7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKJHVpYk1vZGFsSW5zdGFuY2UuZGlzbWlzcygnYWRkZWQnKTsKfQovLyBvbiBmYWlsdXJlIHdhcwovLyAkc2NvcGUuYWpheF9lcnJvciA9IGRhdGEuTWVzc2FnZTsKfQp9Cn0pOwovLy8vIGZmZmZmZmYKa3V6ZUFwcC5jb250cm9sbGVyKCdCdXNpbmVzc0NhbGVuZGFyQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsIHNoYXJlZFByb3BlcnRpZXMsICRjb21waWxlLCAkbG9jYXRpb24sIHVpQ2FsZW5kYXJDb25maWcsICR1aWJNb2RhbCwgc2hhcmVkRGF0YSkgewppbml0aWFsRW5kVXNlciA9IHNoYXJlZERhdGEuZ2V0U2VsZWN0ZWRFbmRVc2VyKCk7CmxvZ0RlYnVnKCdCdXNpbmVzc0NhbGVuZGFyIENvbnRyb2xsZXIsIHNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKT0nICsgc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpKTsKCmdldEJ1c2luZXNzTG9jYXRpb25zKCRodHRwLCRzY29wZSwnYnVzaW5lc3NfbG9jYXRpb25zJyk7CgogICAgJHNjb3BlLnN0YXR1c2VzID0gWyB7InN0YXR1c19pZCI6IjAiLCJzdGF0dXNfbmFtZSI6Itek16rXldeXIn0sIHsic3RhdHVzX2lkIjoiMSIsInN0YXR1c19uYW1lIjoi16HXkteV16gifV07CiAgICAkc2NvcGUudGhlZGF0YV9yZXBvcnQgPSB7fTsKCiAgICAkc2NvcGUudGhlZGF0YV9yZXBvcnQuc291cmNlID0gImNhbGVuZGFyIjsKICAgICRzY29wZS50aGVkYXRhX3JlcG9ydC5maWx0ZXJzID0gewogICAgICBpc19jYW5jZWxlZDogIjAiCiAgICB9OwoKICAgICRzY29wZS51cGRhdGVFdmVudHMgPSBmdW5jdGlvbigpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJ1cGRhdGVFdmVudHMiKTsKICAgICAgaW5zdHJ1Y3Rvcl9pZF9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuY2FsZW5kYXJJbnN0cnVjdG9yRmlsdGVyLCAiYnVzaW5lc3NfdXNlcl9pZCIgKTsKICAgICAgZXZlbnRfdHlwZV9pZF9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuY2FsZW5kYXJFdmVudFR5cGVGaWx0ZXIsICJldmVudF90eXBlX2lkIiApOwogICAgICBzdGF0dXNfZmlsdGVyID0gbGlzdF90b19zdHJpbmdfYnlfdmFsdWUoJHNjb3BlLmNhbGVuZGFyU3RhdHVzRmlsdGVyLCAic3RhdHVzX2lkIiApOwoKICAgICAgJHNjb3BlLnRoZWRhdGFfcmVwb3J0LmZpbHRlcnMgPSB7CiAgICAgICAgaW5zdHJ1Y3Rvcl9pZDogaW5zdHJ1Y3Rvcl9pZF9maWx0ZXIsCiAgICAgICAgZXZlbnRfdHlwZV9pZDogZXZlbnRfdHlwZV9pZF9maWx0ZXIsCiAgICAgICAgc3RhdHVzOiBzdGF0dXNfZmlsdGVyLAogICAgICAgIGlzX2NhbmNlbGVkOiAiMCIKICAgICAgfTsKCiAgICAgIC8vIGNvbnNvbGUubG9nKCRzY29wZS5jYWxlbmRhcik7CiAgICAgIGxvZ0RlYnVnKCJiZWZvcmUgcmVmZXRjaEV2ZW50cyIpOwogICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwogICAgICBsb2dEZWJ1ZygiYWZ0ZXIgcmVmZXRjaEV2ZW50cyIpOwogICAgICAvLyB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwoKICAgIH0KCiRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyPWZhbHNlOwoKaWYgKHNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKSE9bnVsbCkKewpjb25zb2xlLmxvZygiZ290IHByZXZpb3VzIHNlbGVjdGVkIHVzZXIgIitzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfZmlyc3RfbmFtZSk7CiRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VybmFtZT1zaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfZmlyc3RfbmFtZSsiICIrc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2VyX2xhc3RfbmFtZTsKJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJfaWQ9c2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2luZXNzX3VzZXJfaWQ7CmxvZ0RlYnVnKCIkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcl9pZD0iKyRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyX2lkKTsKCiRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyPXRydWU7Cn0KCi8vIGNoZWNraW5nIGlmIGNhbGVuZGFyIHNob3VsZCBzdGFydCB3aXRoIGEgc3BlY2lmaWMgZGF0ZSAoZnJvbSB1cmwgb3IgZnJvbSBwcmV2aW91c2x5IHNlbGVjdGVkIGRhdGUpCmxvZ0RlYnVnKCIkbG9jYXRpb24uc2VhcmNoKCkuc3RhcnQ9IiArICRsb2NhdGlvbi5zZWFyY2goKS5zdGFydCk7CmlmICh0eXBlb2YgJGxvY2F0aW9uLnNlYXJjaCgpLnN0YXJ0ICE9ICd1bmRlZmluZWQnKQp7CmN1cnJEZWZhdWx0RGF0ZSA9ICRsb2NhdGlvbi5zZWFyY2goKS5zdGFydDsKfQplbHNlIGlmIChzaGFyZWRQcm9wZXJ0aWVzLmdldF9jYWxlbmRhcl9kYXRlKCkhPW51bGwpCnsKY29uc29sZS5sb2coImdvdCBwcmV2aW91cyBkYXRlICAiK3NoYXJlZFByb3BlcnRpZXMuZ2V0X2NhbGVuZGFyX2RhdGUoKSk7CmN1cnJEZWZhdWx0RGF0ZSA9IHNoYXJlZFByb3BlcnRpZXMuZ2V0X2NhbGVuZGFyX2RhdGUoKTsKfQplbHNlCnsKY3VyckRlZmF1bHREYXRlID0gbmV3IERhdGUoKTsKfQpnZXRBbGxJbnN0cnVjdG9ycygkaHR0cCwkc2NvcGUsJ2J1c2luZXNzX2luc3RydWN0b3JzJyxnZXRBbGxJbnN0cnVjdG9yc19maW5pc2gpOwogICAgZ2V0QWxsSW5zdHJ1Y3RvcnMoJGh0dHAsJHNjb3BlLCdpbnN0cnVjdG9ycycpOwpmdW5jdGlvbiBnZXRBbGxJbnN0cnVjdG9yc19maW5pc2goKQp7Ci8vIGNvbnNvbGUubG9nKCRzY29wZS5idXNpbmVzc19pbnN0cnVjdG9ycyk7CiRzY29wZS5idXNpbmVzc19pbnN0cnVjdG9ycy51bnNoaWZ0KHsiYnVzZXJfZnVsbF9uYW1lIjoi15vXnCDXlNem15XXldeqIiwgImJ1c2VyX2ZpcnN0X25hbWUiOiLXm9eV15zXnSIsImJ1c2VyX2xhc3RfbmFtZSI6IiIsICJ1c2VyX2lkIjogMCwgImJ1c2luZXNzX3VzZXJfaWQiOiAwfSk7CgovLyBzZXR0aW5nIHNlbGVjdGVkIGdldF9zZWxlY3RlZF9pbnN0cnVjdG9yCiRzY29wZS5wcmV2aW91c19zZWxlY3RlZF9pbnN0cnVjdG9yPWZhbHNlOwppZiAoc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfaW5zdHJ1Y3RvcigpPj0wKQp7Ci8vIGNvbnNvbGUubG9nKCJnb3QgcHJldmlvdXMgc2VsZWN0ZWQgaW5zdHJ1Y3RvciAiK3NoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX2luc3RydWN0b3IoKSk7CiRzY29wZS5wcmV2aW91c19zZWxlY3RlZF9pbnN0cnVjdG9yX2lkPXNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX2luc3RydWN0b3IoKTsKJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX2luc3RydWN0b3I9dHJ1ZTsKJHNjb3BlLnNlbGVjdGVkX2J1c2luZXNzX3VzZXJfaWQ9c2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfaW5zdHJ1Y3RvcigpOwp9Cn0KICAgIGdldEFsbEJ1c2luZXNzRXZlbnRUeXBlcygkaHR0cCwkc2NvcGUsJ2V2ZW50X3R5cGVzX2NhbHMnKTsKZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzTm9TeXN0ZW0oJGh0dHAsJHNjb3BlLCdldmVudF90eXBlcycpOwoKLy8gc2V0dGluZyBzZWxlY3RlZCB1c2VyIGlkCiRzY29wZS5wcmV2aW91c19ldmVudF9yZXNjaGVkdWxlPWZhbHNlOwokc2NvcGUucHJldmlvdXNfZXZlbnRfcmVzY2hlZHVsZV9ldmVudD1udWxsOwoKJHNjb3BlLiRvbigiY2FsZW5kYXJFdmVudFJlc2NoZWR1bGVEZXNlbGVjdCIsZnVuY3Rpb24oZSxhKQp7CiRzY29wZS5jYWxlbmRhckV2ZW50UmVzY2hlZHVsZURlc2VsZWN0KCk7Cn0pOwoKLy8gZGVzZWxlY3RpbmcgZXZlbnQgZnJvbSBiZWluZyByZXNjaGVkdWxlZAokc2NvcGUuY2FsZW5kYXJFdmVudFJlc2NoZWR1bGVEZXNlbGVjdD1mdW5jdGlvbigpCnsKc2hhcmVkUHJvcGVydGllcy5zZXRfZXZlbnRfcmVzY2hlZHVsZShudWxsKTsKJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGU9ZmFsc2U7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZWZldGNoRXZlbnRzJyk7Cn0KLy8gZGVsZXRpbmcgY2xpZW50IHNlbGVjdGlvbiBpbiBjYWxlbmRhcgokc2NvcGUuY2FsZW5kYXJDbGllbnREZXNlbGVjdD1mdW5jdGlvbigpIC8vIHJlbG9hZCBjbGFzcy9ldmVudCBzdWdnZXN0aW9ucwp7CiRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyPWZhbHNlOwpzaGFyZWRQcm9wZXJ0aWVzLnNldF9zZWxlY3RlZF91c2VyKG51bGwpOwokc2NvcGUuZXZlbnRUeXBlU2VsZWN0ZWQoKTsKfQppZiAoaW5pdGlhbEVuZFVzZXIgIT0gbnVsbCkgewokc2NvcGUuYnVzaW5lc3NDYWxlbmRhckluaXRpYWxOYW1lID0gdHJ1ZTsKc2hhcmVkRGF0YS5zZXRTZWxlY3RlZEVuZFVzZXIobnVsbCk7CiRzY29wZS5idXNpbmVzc0NhbGVuZGFySW5pdGlhbHMgPSB7Cm5hbWU6IGluaXRpYWxFbmRVc2VyLmZpcnN0X25hbWUgKyAiICIgKyBpbml0aWFsRW5kVXNlci5sYXN0X25hbWUKfTsKfSBlbHNlIHsKJHNjb3BlLmJ1c2luZXNzQ2FsZW5kYXJJbml0aWFsTmFtZSA9IGZhbHNlOwp9Ci8qIGNvbmZpZyBvYmplY3QgKi8KJHNjb3BlLmNhbGVuZGFyX25hbWUgPSAiY2FsZW5kYXJfYnVzaW5lc3MiOwokc2NvcGUuY2FsZW5kYXIgPSAiY2FsZW5kYXJfYnVzaW5lc3MiOwovKiBldmVudCBzb3VyY2VzIGFycmF5Ki8KCiAgICAvLyB0aGVkYXRhID0geyBzb3VyY2U6ICJjYWxlbmRhciIgfQogICAgLy8gdGhlZGF0YVsnZmlsdGVycyddID0geyBpbnN0cnVjdG9yX2lkOiAiMTk1In07CgogICAgLy8gY29uc29sZS5sb2codGhlZGF0YSk7Cgokc2NvcGUuYnVzaW5lc3NDYWxlbmRhckV2ZW50U291cmNlcyA9IFt7CiAgICAgIC8vIHVybDogJy9hcGkvYWRtaW4vZXZlbnRzL2dldHBvc3QnLAogICAgICB1cmw6ICcvYXBpL2FkbWluL3JlcG9ydHMvZXZlbnRzMicsCiAgICAgIGRhdGE6ICRzY29wZS50aGVkYXRhX3JlcG9ydCAsCnR5cGU6ICdQT1NUJwp9LCB7CnVybDogJy9hcGkvYWRtaW4vY2FsZW5kYXIvbGltaXRhdGlvbnMvYmFja2dyb3VuZC9nZXRwb3N0JywKICAgICAgZGF0YTogJHNjb3BlLnRoZWRhdGFfcmVwb3J0ICwKICAgICAgdHlwZTogJ1BPU1QnICAgIC8vIH0sIHsKLy8gICAgIHVybDogJy9hcGkvYWRtaW4vcmVjdXJyaW5nL2dldHBvc3QnLAovLyAgICAgdHlwZTogJ1BPU1QnCn1dOwoKJHNjb3BlLmdvdG9Ub2RheSA9IGZ1bmN0aW9uKCkgewokc2NvcGUuZ290b0RhdGUobmV3IERhdGUoKSk7CnZpc2libGVEYXRlU3RhcnQgPSBuZXcgRGF0ZSh1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ2V0VmlldycpLnN0YXJ0KTsKZGF0ZVRvR29UbyA9IHZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSArICItIiArICgnMCcgKyAodmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpICsgMSkpLnNsaWNlKC0yKSArICItIiArICgnMCcgKyB2aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSkuc2xpY2UoLTIpOwpzaGFyZWRQcm9wZXJ0aWVzLnNldF9jYWxlbmRhcl9kYXRlKGRhdGVUb0dvVG8pOwokc2NvcGUudmlzaWJsZURhdGVTdGFydD12aXNpYmxlRGF0ZVN0YXJ0OwokbG9jYXRpb24uc2VhcmNoKCdzdGFydCcsZGF0ZVRvR29Ubyk7Cn0KCiRzY29wZS5pbnN0cnVjdG9yU2VsZWN0ZWQ9ZnVuY3Rpb24odGhpc3RoaXMpCnsKdXBkYXRlU3VnZ2VzdGlvbnMoKTsKfQokc2NvcGUuZXZlbnRUeXBlU2VsZWN0ZWQ9ZnVuY3Rpb24odGhpc3RoaXMpCnsKdXBkYXRlU3VnZ2VzdGlvbnMoKTsKfQpmdW5jdGlvbiB1cGRhdGVTdWdnZXN0aW9ucygpCnsKbG9nRGVidWcoImZ1bmN0aW9uOiB1cGRhdGVTdWdnZXN0aW9ucyIpOwpzaGFyZWRQcm9wZXJ0aWVzLnNldF9ldmVudF90eXBlX2Zvcl9zdWdnZXN0aW9ucygkc2NvcGUuc2VsZWN0ZWRfZXZlbnRfdHlwZV9pZCk7CnNoYXJlZFByb3BlcnRpZXMuc2V0X3NlbGVjdGVkX2luc3RydWN0b3IoJHNjb3BlLnNlbGVjdGVkX2J1c2luZXNzX3VzZXJfaWQpOwpmb3IgKGk9MDtpPCRzY29wZS5ldmVudF90eXBlcy5sZW5ndGg7aSsrKQp7Ci8vIGNvbnNvbGUubG9nKCRzY29wZS5ldmVudF90eXBlc1tpXS5ldmVudF90eXBlX2lkKTsKaWYgKCRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkPT0kc2NvcGUuZXZlbnRfdHlwZXNbaV0uZXZlbnRfdHlwZV9pZCkKewovLyBjb25zb2xlLmxvZygiZm91bmQgZXZlbnQgdHlwZSBpZCIpOwppZiAoJHNjb3BlLmV2ZW50X3R5cGVzW2ldLmlzX2NsYXNzKSAvLyBpcyBjbGFzcwp7CmxvZ0RlYnVnKCIkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcj0iKyRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyKTsKaWYgKCRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyKQp7CmNvbnNvbGUubG9nKCJpcyBjbGFzcyBzdWdnZXN0aW9uZCIpOwokaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3RjbGFzcy8iKyRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkKyIvIiskc2NvcGUuc2VsZWN0ZWRfYnVzaW5lc3NfdXNlcl9pZCsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSsiLyIrKCRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkrMSkrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0SG91cnMoKSArICIvIiArICRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKSArICIvIiArICRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyX2lkKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKQp7CiRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkX2lzX2NsYXNzPXRydWU7CiRzY29wZS5ldmVudHNTdWdnZXN0ZWQgPSByZXNwb25zZS5kYXRhOwp9KTsKfQplbHNlCnsKY29uc29sZS5sb2coIm5vdCBpcyBjbGFzcyBzdWdnZXN0aW9uZCIpOwokaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3RjbGFzcy8iKyRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkKyIvIiskc2NvcGUuc2VsZWN0ZWRfYnVzaW5lc3NfdXNlcl9pZCsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSsiLyIrKCRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkrMSkrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0SG91cnMoKSArICIvIiArICRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKSArICIvMCIpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpCnsKJHNjb3BlLnNlbGVjdGVkX2V2ZW50X3R5cGVfaWRfaXNfY2xhc3M9dHJ1ZTsKJHNjb3BlLmV2ZW50c1N1Z2dlc3RlZCA9IHJlc3BvbnNlLmRhdGE7Cn0pOwp9Cn0KZWxzZSAvLyBpcyBub3QgY2xhc3MKewokaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3QvIiskc2NvcGUuc2VsZWN0ZWRfZXZlbnRfdHlwZV9pZCsiLyIrJHNjb3BlLnNlbGVjdGVkX2J1c2luZXNzX3VzZXJfaWQrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCkrIi8iKygkc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpKzEpKyIvIiskc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXREYXRlKCkrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldEhvdXJzKCkgKyAiLyIgKyAkc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXRNaW51dGVzKCkpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpCnsKJHNjb3BlLnNlbGVjdGVkX2V2ZW50X3R5cGVfaWRfaXNfY2xhc3M9ZmFsc2U7CiRzY29wZS5ldmVudHNTdWdnZXN0ZWQgPSByZXNwb25zZS5kYXRhOwp9KTsKfQp9Cn0KfQoKJHNjb3BlLmdvdG9OZXh0ID0gZnVuY3Rpb24oKSB7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZW1vdmVFdmVudHMnKTsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ25leHQnKTsKJHNjb3BlLnVwZGF0ZUNhbGVuZGFyQ2VudGVyVGl0bGUoKTsKLy8gYWRkaW5nIHRoZSBmb2xsb3dpbmcgdG8gbWFrZSB0aGUgdXJsCi8vIHBvaW50IHRvIHRoZSByaWdodCB3ZWVrLCBpZiBnb2luZyB0byBhIGRpZmZlcmVudCBVUkwgYW5kIHRoZW4gZ29pbmcgYmFjawp2aXNpYmxlRGF0ZVN0YXJ0ID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5zdGFydCk7CmRhdGVUb0dvVG8gPSB2aXNpYmxlRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCkgKyAiLSIgKyAoJzAnICsgKHZpc2libGVEYXRlU3RhcnQuZ2V0TW9udGgoKSArIDEpKS5zbGljZSgtMikgKyAiLSIgKyAoJzAnICsgdmlzaWJsZURhdGVTdGFydC5nZXREYXRlKCkpLnNsaWNlKC0yKTsKc2hhcmVkUHJvcGVydGllcy5zZXRfY2FsZW5kYXJfZGF0ZShkYXRlVG9Hb1RvKTsKJHNjb3BlLnZpc2libGVEYXRlU3RhcnQ9dmlzaWJsZURhdGVTdGFydDsKJGxvY2F0aW9uLnNlYXJjaCgnc3RhcnQnLGRhdGVUb0dvVG8pOwp9CiRzY29wZS5nb3RvUHJldiA9IGZ1bmN0aW9uKCkgewp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVtb3ZlRXZlbnRzJyk7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdwcmV2Jyk7CiRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlKCk7Ci8vIGFkZGluZyB0aGUgZm9sbG93aW5nIHRvIG1ha2UgdGhlIHVybAovLyBwb2ludCB0byB0aGUgcmlnaHQgd2VlaywgaWYgZ29pbmcgdG8gYSBkaWZmZXJlbnQgVVJMIGFuZCB0aGVuIGdvaW5nIGJhY2sKdmlzaWJsZURhdGVTdGFydCA9IG5ldyBEYXRlKHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3Jykuc3RhcnQpOwpkYXRlVG9Hb1RvID0gdmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpICsgIi0iICsgKCcwJyArICh2aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkgKyAxKSkuc2xpY2UoLTIpICsgIi0iICsgKCcwJyArIHZpc2libGVEYXRlU3RhcnQuZ2V0RGF0ZSgpKS5zbGljZSgtMik7CnNoYXJlZFByb3BlcnRpZXMuc2V0X2NhbGVuZGFyX2RhdGUoZGF0ZVRvR29Ubyk7CiRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0PXZpc2libGVEYXRlU3RhcnQ7CiRsb2NhdGlvbi5zZWFyY2goJ3N0YXJ0JyxkYXRlVG9Hb1RvKTsKCn0KJHNjb3BlLmdvdG9EYXRlID0gZnVuY3Rpb24obmV3ZGF0ZSkgewp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ290b0RhdGUnLCBuZXdkYXRlKTsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlbW92ZUV2ZW50cycpOwp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwokc2NvcGUudXBkYXRlQ2FsZW5kYXJDZW50ZXJUaXRsZSgpOwp9Cgokc2NvcGUuZWRpdEhvdXJzT2ZXb3JrID0gZnVuY3Rpb24oKSB7Ci8vIHBhcmFtIHNob3VsZCBsb29rIGxpa2UgIjIwMTYtMDctMDEiCnZpc2libGVEYXRlU3RhcnQgPSBuZXcgRGF0ZSh1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ2V0VmlldycpLnN0YXJ0KTsKZGF0ZVRvR29UbyA9IHZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSArICItIiArICgnMCcgKyAodmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpICsgMSkpLnNsaWNlKC0yKSArICItIiArICgnMCcgKyB2aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSkuc2xpY2UoLTIpOwokbG9jYXRpb24ucGF0aCgnL2hvdXJzX29mX3dvcmsnKS5zZWFyY2goewpzdGFydDogZGF0ZVRvR29Ubwp9KTsKfTsKCiRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlID0gZnVuY3Rpb24oKSB7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3Jyk7Cgp2aXNpYmxlRGF0ZVN0YXJ0ID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5zdGFydCk7CnZpc2libGVEYXRlRW5kID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5lbmQpOwoKJHNjb3BlLmNhbGVuZGFyVGl0bGVDZW50ZXIgPSB2aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSArICIgIiArIG1vbnRoTmFtZXNbdmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpXSArCiIg4oCUICIgKyB2aXNpYmxlRGF0ZUVuZC5nZXREYXRlKCkgKyAiICIgKyBtb250aE5hbWVzW3Zpc2libGVEYXRlRW5kLmdldE1vbnRoKCldICsKIiAiICsgdmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpOwp9OwoKJHNjb3BlLnNob3dFdmVudFBvcHVwID0gZnVuY3Rpb24oc2VsZWN0ZWRFdmVudCkgewpzaG93RXZlbnRQb3B1cChzZWxlY3RlZEV2ZW50LCAkdWliTW9kYWwpCn07Cgokc2NvcGUuZXZlbnRDcmVhdGVNb2RhbEZyb21TY2hlZHVsZXIgPSBmdW5jdGlvbihlc3VnZ2VzdCkKewovLyBpZiBjbGFzcyAtIGdvIHRvIGV2ZW50IGNsYXNzCmNvbnNvbGUubG9nKGVzdWdnZXN0KTsKZm9yIChpPTA7aTwkc2NvcGUuZXZlbnRfdHlwZXMubGVuZ3RoO2krKykKewppZiAoZXN1Z2dlc3QuZXZlbnRfdHlwZV9pZD09JHNjb3BlLmV2ZW50X3R5cGVzW2ldLmV2ZW50X3R5cGVfaWQpCnsKaWYgKCRzY29wZS5ldmVudF90eXBlc1tpXS5pc19jbGFzcykKewpjb25zb2xlLmxvZygiaXMgY2xhc3MiKTsKd2luZG93LmxvY2F0aW9uLmhyZWY9Jy8jL2V2ZW50X2NsYXNzLycgKyBlc3VnZ2VzdC5ldmVudF9pZDsKcmV0dXJuOwp9Cn0KfQpsb2dEZWJ1ZyhKU09OLnN0cmluZ2lmeShlc3VnZ2VzdCkpOwpsb2dEZWJ1Zyhlc3VnZ2VzdC5zdGFydF9lcG9jaCk7CnN0YXJ0RGF0ZT1lc3VnZ2VzdC5zdGFydF9lcG9jaCoxMDAwOwoKdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CmFuaW1hdGlvbjogZmFsc2UsCnRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2V2ZW50X2NyZWF0ZS5waHAnLApjb250cm9sbGVyOiAnZXZlbnRDcmVhdGVNb2RhbENvbnRyb2xsZXInLApzaXplOiAnbCcsCnJlc29sdmU6IHsKc3RhcnREYXRlOiBmdW5jdGlvbigpIHsKcmV0dXJuIHN0YXJ0RGF0ZTsKfSwKZXZlbnRfdHlwZV9pZDogZnVuY3Rpb24oKSB7CnJldHVybiAkc2NvcGUuc2VsZWN0ZWRfZXZlbnRfdHlwZV9pZDsKfSwKbG9jYXRpb25faWQ6IGZ1bmN0aW9uKCkgewpyZXR1cm4gZXN1Z2dlc3QubG9jYXRpb25faWQ7Cn0sCmVtcF9pZDogZnVuY3Rpb24oKSB7CnJldHVybiBlc3VnZ2VzdC5lbXBfaWQ7Cn0sCnJlc2NoZWR1bGVfZXZlbnQ6IGZ1bmN0aW9uKCkKewppZiAoJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGUpCnsKcmV0dXJuICRzY29wZS5wcmV2aW91c19ldmVudF9yZXNjaGVkdWxlX2V2ZW50Owp9CmVsc2UKewpyZXR1cm4gbnVsbDsKfQp9Cgp9Cn0pOwoKfQokc2NvcGUuZXZlbnRDcmVhdGVNb2RhbCA9IGZ1bmN0aW9uKHN0YXJ0RGF0ZSwgc2l6ZSkgewogICAgICAgIGxvZ0RlYnVnKCJldmVudENyZWF0ZU1vZGFsIHN0YXJ0RGF0ZT0iK3N0YXJ0RGF0ZSk7Cgp2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKYW5pbWF0aW9uOiBmYWxzZSwKdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfZXZlbnRfY3JlYXRlLnBocCcsCmNvbnRyb2xsZXI6ICdldmVudENyZWF0ZU1vZGFsQ29udHJvbGxlcicsCnNpemU6IHNpemUsCnJlc29sdmU6IHsKc3RhcnREYXRlOiBmdW5jdGlvbigpIHsKcmV0dXJuIHN0YXJ0RGF0ZTsKfSwKZXZlbnRfdHlwZV9pZDogZnVuY3Rpb24oKSB7CnJldHVybiAwOwp9LApsb2NhdGlvbl9pZDogZnVuY3Rpb24oKSB7CnJldHVybiAwOwp9LAplbXBfaWQ6IGZ1bmN0aW9uKCkgewpyZXR1cm4gMDsKfSwKcmVzY2hlZHVsZV9ldmVudDogZnVuY3Rpb24oKQp7CmlmICgkc2NvcGUucHJldmlvdXNfZXZlbnRfcmVzY2hlZHVsZSkKewpyZXR1cm4gJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGVfZXZlbnQ7Cn0KZWxzZQp7CnJldHVybiBudWxsOwp9ICAgICAgICAgICAgICAgIH0KCn0KfSk7Cgptb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHNlbGVjdGVkSXRlbSkgewokc2NvcGUuc2VsZWN0ZWQgPSBzZWxlY3RlZEl0ZW07Cn0sIGZ1bmN0aW9uKCkgewpsb2dEZWJ1ZygnTW9kYWwgZGlzbWlzc2VkIGF0OiAnICsgbmV3IERhdGUoKSk7Cn0pOwp9OwoKLy8vCiRzY29wZS51cGRhdGVFdmVudERhdGFiYXNlID0gZnVuY3Rpb24oc3RhcnRfcGFyYW0sIGVuZF9wYXJhbSwgZXZlbnRfaWQsIHRoZWV2ZW50KQp7Cgpsb2dEZWJ1ZygidXBkYXRlRXZlbnREYXRhYmFzZSBzdGFydD0iICsgc3RhcnRfcGFyYW0gKyAiLCBlbmQ9IiArIGVuZF9wYXJhbSArICIsIGV2ZW50X2lkPSIgKyBldmVudF9pZCk7CnRoZXVybCA9ICcvYXBpL2FkbWluL2V2ZW50cy9zZXQvJyArIGV2ZW50X2lkOwoKJGh0dHAoewptZXRob2Q6ICdQT1NUJywKdXJsOiB0aGV1cmwsCmRhdGE6IHsKc3RhcnRfZGF0ZTogc3RhcnRfcGFyYW0sCmVuZF9kYXRlOiBlbmRfcGFyYW0sCmV2ZW50X2lkOiBldmVudF9pZAp9LApoZWFkZXJzOiB7CidDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbjtjaGFyc2V0PXV0Zi04Jwp9Cn0pLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkgewoKbG9nRGVidWcoZGF0YSk7CmlmIChkYXRhLkVycm9yKSB7CmxvZ0RlYnVnKCJlcnJvciAiICsgZGF0YS5NZXNzYWdlKTsKYWxlcnQoJ2Vycm9yJyk7CmNhbGVuZGFyID0gImNhbGVuZGFyX2J1c2luZXNzIjsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwp9IGVsc2Ugewpsb2dEZWJ1Zygic3VjY2VzcyIpOwpjYWxlbmRhciA9ICJjYWxlbmRhcl9idXNpbmVzcyI7Ci8vIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKLy8gJHVpYk1vZGFsSW5zdGFuY2UuZGlzbWlzcygnYWRkZWQgYW5kIHJlZmV0Y2hFdmVudHMnKTsKfQp9KTsKCn07Ci8vLwoKJHNjb3BlLmNsYXNzRXZlbnRBZGRVc2VyID0gZnVuY3Rpb24oZXN1Z2dlc3QpCnsKY29uc29sZS5sb2coImNsYXNzRXZlbnRBZGRVc2VyIG9yIFJlbW92ZSIpOwppZiAoKGVzdWdnZXN0LmlzX3JlZ2lzdGVyZWQ9PTEpIHwgKChlc3VnZ2VzdC5pc193YWl0aW5nbGlzdD09MSkgJiYgKGVzdWdnZXN0LmlzX2NhbmNlbGVkPT0wKSkpCnsKY29uc29sZS5sb2coIm5lZWQgdG8gdW5yZWdpc3RlciIpOwpyZW1vdmVFbmRVc2VyRnJvbUV2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcl9pZCxlc3VnZ2VzdC5ldmVudF9pZCxyZW1vdmVFbmRVc2VyRnJvbUV2ZW50X2NhbGxiYWNrLCByZW1vdmVFbmRVc2VyRnJvbUV2ZW50X2NhbGxiYWNrKTsKZnVuY3Rpb24gcmVtb3ZlRW5kVXNlckZyb21FdmVudF9jYWxsYmFjaygpCnsKJHNjb3BlLmV2ZW50VHlwZVNlbGVjdGVkKCk7CmNhbGVuZGFyID0gImNhbGVuZGFyX2J1c2luZXNzIjsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwoKfQp9CmVsc2UKewovLyBjb25zb2xlLmxvZyhlc3VnZ2VzdC5ldmVudF9pZCk7Ci8vIGNvbnNvbGUubG9nKCRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyX2lkKTsKLy8gaWYgc2VsZWN0ZWQgdXNlciAtIGFkZGluZyBoaW0vaGVyIHRvIGNsYXNzCmlmICgkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcikKewphZGRFbmRVc2VyVG9FdmVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJfaWQsZXN1Z2dlc3QuZXZlbnRfaWQsYWRkRW5kVXNlclRvRXZlbnRfY2FsbGJhY2ssIGFkZEVuZFVzZXJUb0V2ZW50X2NhbGxiYWNrKTsKZnVuY3Rpb24gYWRkRW5kVXNlclRvRXZlbnRfY2FsbGJhY2soKQp7CmNhbGVuZGFyID0gImNhbGVuZGFyX2J1c2luZXNzIjsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwokc2NvcGUuZXZlbnRUeXBlU2VsZWN0ZWQoKTsKfQp9CmVsc2UgLy8gZWxzZSAtIGdvaW5nIHRvIGNsYXNzIHBhZ2UKewp3aW5kb3cubG9jYXRpb24uaHJlZj0nLyMvZXZlbnRfY2xhc3MvJyArIGVzdWdnZXN0LmV2ZW50X2lkOwp9Cn0KfQokc2NvcGUuY2FsZW5kYXJfYnVzaW5lc3NfY29uZmlnID0gewpjYWxlbmRhcjogewpoZWlnaHQ6ICdhdXRvJywKZWRpdGFibGU6IHRydWUsCi8vIGhlYWRlcjogewovLyAgICAgbGVmdDogJycsCi8vICAgICBjZW50ZXI6ICcnLAovLyAgICAgcmlnaHQ6ICcnCi8vIH0sCi8vIGhlYWRlcjogewovLyAgICAgbGVmdDogJ3RpdGxlJywKLy8gICAgIGNlbnRlcjogJycsCi8vICAgICByaWdodDogJ3RvZGF5IHByZXYsbmV4dCcKLy8gfSwKdGl0bGVGb3JtYXQ6IHsKLy8gd2VlazogICJkIFtNTU1deyAnJiM4MjExOycgZCBNTU19Igp9LAovLyB0aXRsZUZvcm1hdDogewovLyAgICAgbW9udGg6ICdNTU1NIHl5eXknLAovLyAgICAgd2VlazogIk1NTSBkWyB5eXl5XXsgJyYjODIxMjsnWyBNTU1dIGQgeXl5eX0iLAovLyAgICAgZGF5OiAnTU0vZGQnCi8vIH0sCmhlYWRlcjogJycsCi8vIGRlZmF1bHRWaWV3OiAnYWdlbmRhV2VlaycsCi8vIHZpZXdzOiB7Ci8vICAgICBkb250U2hvd0RhdGU6IHsKLy8gICAgICAgICB0eXBlOiAnYWdlbmRhV2VlaycsCi8vICAgICAgICAgZHVyYXRpb246IHsKLy8gICAgICAgICAgICAgZGF5czogNwovLyAgICAgICAgIH0sCi8vICAgICAgICAgdGl0bGU6ICdBcGVydHVyYScsCi8vICAgICAgICAgY29sdW1uRm9ybWF0OiAnZGRkZCcgLy8gRm9ybWF0IHRoZSBkYXkgdG8gb25seSBzaG93IGxpa2UgJ01vbmRheScKLy8gICAgICAgICAgICAgLy8gaGlkZGVuRGF5czogWzAsIDZdIC8vIEhpZGUgU3VuZGF5IGFuZCBTYXR1cmRheT8KLy8gICAgIH0KLy8gfSwKLy8gc2xvdER1cmF0aW9uOiAnMDA6MTU6MDAnLApldmVudERyb3A6IGZ1bmN0aW9uKGV2ZW50LCBkYXlEZWx0YSwgbWludXRlRGVsdGEsIGFsbERheSwgcmV2ZXJ0RnVuYywgdWlDYWxlbmRhckNvbmZpZykgewpsb2dEZWJ1ZygiZXZlbnQgZHJvcCIgKyBldmVudC50aXRsZSArICIoIiArIGV2ZW50LmlkICsgIikgbW92ZWQgIiArIG1pbnV0ZURlbHRhICsgIiBtaW51dGVzIik7CmxvZ0RlYnVnKCJvbGQgc3RhcnQ9IiArIGV2ZW50LnN0YXJ0ICsgIiwgb2xkIGVuZD0iICsgZXZlbnQuZW5kKTsKJHNjb3BlLnVwZGF0ZUV2ZW50RGF0YWJhc2UoZXZlbnQuc3RhcnQsIGV2ZW50LmVuZCwgZXZlbnQuaWQsIGV2ZW50KTsKfSwKZXZlbnRSZXNpemU6IGZ1bmN0aW9uKGV2ZW50LCBkZWx0YSwgcmV2ZXJ0RnVuYykgewpsb2dEZWJ1ZygiZXZlbnQgcmVzaXplIiArIGV2ZW50LnRpdGxlICsgIigiICsgZXZlbnQuaWQgKyAiKSBtb3ZlZCAiKTsKbG9nRGVidWcoIm9sZCBzdGFydD0iICsgZXZlbnQuc3RhcnQgKyAiLCBvbGQgZW5kPSIgKyBldmVudC5lbmQpOwokc2NvcGUudXBkYXRlRXZlbnREYXRhYmFzZShldmVudC5zdGFydCwgZXZlbnQuZW5kLCBldmVudC5pZCwgZXZlbnQpOwp9LApkZWZhdWx0VmlldzogJ2FnZW5kYVdlZWsnLApldmVudFN0YXJ0RWRpdGFibGU6ZmFsc2UsCmV2ZW50RHVyYXRpb25FZGl0YWJsZTpmYWxzZSwKZGVmYXVsdERhdGU6IG1vbWVudChjdXJyRGVmYXVsdERhdGUpLAoKLy8gZGVmYXVsdFZpZXc6ICdkb250U2hvd0RhdGUnLApldmVudENsaWNrOiBmdW5jdGlvbihjYWxFdmVudCwganNFdmVudCwgdmlldykgewpsb2dEZWJ1ZygiY2FsZW5kYXIgZXZlbnQgY2xpY2tlZCAiICsgY2FsRXZlbnQudGl0bGUgKyAiKCIgKyBjYWxFdmVudC5pZCArICIpICIgKyBjYWxFdmVudC5zdGFydCArICIgIiArIGNhbEV2ZW50LmVuZCk7Ci8vIGxvZ0RlYnVnKEpTT04uc3RyaW5naWZ5KGNhbEV2ZW50KSk7Ci8vIGlmIGl0J3MgYSBnZW5lcmljIGV2ZW50ICh2YWNhdGlvbiBldGMpCi8vIHNob3cgcG9wdXAgd2l0aCBvcHRpb24gdG8gZGVsZXRlCmlmIChjYWxFdmVudC5pc19nZW5lcmljX2V0eXBlPT0xKQp7Ci8vICRzY29wZS5zaG93R2VuZXJpY0V2ZW50KGNhbEV2ZW50KTsKJHNjb3BlLnNob3dFdmVudFBvcHVwKGNhbEV2ZW50KTsKCn0KZWxzZQp7CiRzY29wZS5zaG93RXZlbnRQb3B1cChjYWxFdmVudCk7Cn0KLy8gY2hhbmdlIHRoZSBib3JkZXIgY29sb3IganVzdCBmb3IgZnVuCi8vICQodGhpcykuY3NzKCdib3JkZXItY29sb3InLCAncmVkJyk7Cgp9LApkYXlDbGljazogZnVuY3Rpb24oZGF0ZSwganNFdmVudCwgdmlldykgewovLyBsb2dEZWJ1ZygibmV3IGV2ZW50IGNyZWF0aW9uIGNsaWNrZWQgIiArIGNhbEV2ZW50LnRpdGxlICsgIigiICsgY2FsRXZlbnQuaWQgKyAiKSAiICsgY2FsRXZlbnQuc3RhcnQgKyAiICIgKyBjYWxFdmVudC5lbmQpOwovLyAgICAgc3RhcnQgPSBkYXRlOwovLyAgICAgZW5kID0gbW9tZW50KHN0YXJ0KS5hZGQoNDUsICdtaW51dGVzJyk7CmlmICh2aWV3Lm5hbWUgPT09ICJtb250aCIpIHsKY2FsZW5kYXIgPSAiY2FsZW5kYXJfYnVzaW5lc3MiOwp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdjaGFuZ2VWaWV3JywgImFnZW5kYVdlZWsiKTsKfSBlbHNlIHsKJHNjb3BlLmV2ZW50Q3JlYXRlTW9kYWwoZGF0ZSk7Cn0KLy8gY2hhbmdlIHRoZSBib3JkZXIgY29sb3IganVzdCBmb3IgZnVuCi8vICQodGhpcykuY3NzKCdib3JkZXItY29sb3InLCAncmVkJyk7Cgp9LApldmVudFJlbmRlcjogZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpCnsKaWYgKCFldmVudC5ldmVudF9pZD4wKQp7Ci8vIG5vdCBhIHJlYWwgZXZlbnQgLSBwcm9iYWJseSBibG9jayAvIGJhY2tncm91bmQKLy8gaWdub3JpbmcgaXQKcmV0dXJuOwp9Ci8vIGNoYW5naW5nIGxvb2sgYW5kIGZlZWwgb2YgZXZlbiB0aGF0IGlzIHRvIHJlc2NoZWR1bGUKaWYgKHNoYXJlZFByb3BlcnRpZXMuZ2V0X2V2ZW50X3Jlc2NoZWR1bGUoKSE9bnVsbCkKewppZiAoZXZlbnQuZXZlbnRfaWQ9PXNoYXJlZFByb3BlcnRpZXMuZ2V0X2V2ZW50X3Jlc2NoZWR1bGUoKS5ldmVudF9pZCkKewplbGVtZW50LmNzcygnYmFja2dyb3VuZC1jb2xvcicsICcjQTlBOUE5CScpOwplbGVtZW50LmNzcygnYm9yZGVyLWNvbG9yJywgJyNBOUE5QTkJJyk7CnJldHVybjsKfQp9CiAgICAgICAgICAgICAgICBpZiAoZXZlbnQuaXNfZ2VuZXJpY19ldHlwZT09MSkKICAgICAgICAgICAgICAgIHsKCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIGlmIChldmVudC5pc19jbGFzcz09MSkKewovLyBpZiBjbGFzcyBhZGRpbmcgbnVtYmVyIG9mIHBhcnRpY2lwYW50cwppZiAoZXZlbnQubm9fb2Zfd2FpdGluZ191c2Vycz4wKQp7CmVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZChldmVudC5ub19vZl91c2VycysiLyIrZXZlbnQubWF4X3BhcnRpY2lwYW50cysgIiAoIitldmVudC5ub19vZl93YWl0aW5nX3VzZXJzKyIpIisiIC0gIik7Cn0KZWxzZQp7CmVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZChldmVudC5ub19vZl91c2VycysiLyIrZXZlbnQubWF4X3BhcnRpY2lwYW50cysiIC0gIik7Cn0KfQplbHNlCnsKLy8gaWYgbm90IGNsYXNzIC0gd3JpdGluZyB0aGUgZW5kdXNlciBuYW1lCmlmIChldmVudC5kdXJhdGlvbl9ldmVudCE9MCkgLy8gYWxzbyBpZiBub3QgaG91cnMgb2Ygd29yawp7Ci8vIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykuYXBwZW5kKCIgKCIrZXZlbnQuZXZlbnRVc2Vyc1swXS5idXNlcl9maXJzdF9uYW1lKyIgIitldmVudC5ldmVudFVzZXJzWzBdLmJ1c2VyX2xhc3RfbmFtZSsiKSIpOwovLyBjb25zb2xlLmxvZyhldmVudC5ldmVudFVzZXJzKTsKLy8gY29uc29sZS5sb2coZXZlbnQuZXZlbnRVc2Vycy5sZW5ndGgpOwogICAgICAgICAgICAgICAgICAgIC8vIGlmIChldmVudC5ldmVudFVzZXJzLmxlbmd0aD4wKQp7CiAgICAgICAgICAgICAgICAgICAgICAvLyBlbGVtZW50LmZpbmQoJy5mYy10aXRsZScpLnByZXBlbmQoIiIrZXZlbnQuZXZlbnRVc2Vyc1swXS5idXNlcl9maXJzdF9uYW1lKyIgIitldmVudC5ldmVudFVzZXJzWzBdLmJ1c2VyX2xhc3RfbmFtZSsiICgiKTsKICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZCgiIitldmVudC5ldmVudF91c2VyX2NsaWVudHMrIiAoIik7CmVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykuYXBwZW5kKCIpIik7Cn0KfQovLyBsb2dEZWJ1ZygiaGVyZTQiKTsKfQppZiAoZXZlbnQuaXNfcmVwZWF0aW5nID09IDEpIHsKZWxlbWVudC5maW5kKCIuZmMtdGl0bGUiKS5hcHBlbmQoIiZuYnNwOzxpIGNsYXNzPSdmYSBmYS1yZXBlYXQnPjwvaT4mbmJzcDsiKTsKLy8gIGVsZW1lbnQuZmluZCgiLmZjLXRpdGxlIikuYXBwZW5kKCImbmJzcDs8aW1nIHNyYz0nL3B1YmxpYy9pbWFnZXMvcmVjdXJyaW5nLWljb24ucG5nJyB3aWR0aD0nMTBweCcgaGVpZ2h0PScxMHB4Jy8+Iik7Cn0KfSwKbWluVGltZTogJGdDYWxlbmRhckRpc3BsYXlNaW5UaW1lLAptYXhUaW1lOiAkZ0NhbGVuZGFyRGlzcGxheU1heFRpbWUsCnNlbGVjdGFibGU6IGZhbHNlLApzZWxlY3RIZWxwZXI6IGZhbHNlLAp0aW1lem9uZTogZmFsc2UsCmlzUlRMOiB0cnVlLApsYW5nOiAiaGUiLCAvLyBrawphbGxEYXlTbG90OiBmYWxzZSwKbG9hZGluZzogZnVuY3Rpb24oYm9vbCkgewppZiAoYm9vbCkgewogICAgICAgICAgICAgICAgICAgIGxvZ0RlYnVnKCdsb2FkaW5nIGNhbGVuZGFyMSAnICsgJHNjb3BlLmNhbGVuZGFyKTsKLy8gJCgnI2xvYWRpbmcnKS5zaG93KCk7Cn0gZWxzZSB7Ci8vICQoJyNsb2FkaW5nJykuaGlkZSgpOwpsb2dEZWJ1ZygnZmluaXNoZWQgbG9hZGluZyBjYWxlbmRhciB4JyArICRzY29wZS5jYWxlbmRhcik7CiRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlKCk7CmxvZ0RlYnVnKCJhZnRlciBjYWxlbmRhciBsb2FkIHZpc2libGVEYXRlU3RhcnQ9Iit1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ2V0VmlldycpLnN0YXJ0KTsKdmlzaWJsZURhdGVTdGFydCA9IG5ldyBEYXRlKHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3Jykuc3RhcnQpOwpkYXRlVG9Hb1RvID0gdmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpICsgIi0iICsgKCcwJyArICh2aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkgKyAxKSkuc2xpY2UoLTIpICsgIi0iICsgKCcwJyArIHZpc2libGVEYXRlU3RhcnQuZ2V0RGF0ZSgpKS5zbGljZSgtMik7Ci8vIGNvbnNvbGUubG9nKCJkYXRlVG9Hb1RvIitkYXRlVG9Hb1RvKTsKLy8gJGh0dHAuZ2V0KCRnQXBpVVJMUHJlZml4ICsgIi9lbmR1c2VyL2V2ZW50cy9zdWdnZXN0LyIrdmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpKyIvIit0aGlzX3dlZWtfZnVsbF95ZWFyKyIvIit0aGlzX3dlZWtfbW9udGgrIi8iK3RoaXNfd2Vla19kYXlfb2ZfbW9udGgrIi8iKyB0aGlzX3dlZWtfaG91cnMrICIvIiArIHRoaXNfd2Vla19taW51dGVzKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKQokc2NvcGUuZXZlbnRfdHlwZV9pZD0kc2NvcGUuc2VsZWN0ZWRfZXZlbnRfdHlwZV9pZDsKJHNjb3BlLnZpc2libGVEYXRlU3RhcnQ9dmlzaWJsZURhdGVTdGFydDsKLy8xMjEyMTIKLy8gaWYgKCRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkX2lzX2NsYXNzKQovLyB7Ci8vICAgJGh0dHAuZ2V0KCRnQXBpVVJMUHJlZml4ICsgIi9lbmR1c2VyL2V2ZW50cy9zdWdnZXN0Y2xhc3MvIiskc2NvcGUuZXZlbnRfdHlwZV9pZCsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSsiLyIrKCRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkrMSkrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0SG91cnMoKSArICIvIiArICRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKSsgIi8iICsgJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJfaWQpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpCi8vICAgewovLyAgICAgICAvLwkgICAgJHNjb3BlLm15RGF0YSA9IHJlc3BvbnNlLmRhdGE7Ci8vICAgICAgIC8vCQlsb2dEZWJ1ZygiZ3JpZG9wdGlvbnM9Iiskc2NvcGUuZ3JpZE9wdGlvbnMpOwovLyAgICAgICAkc2NvcGUuZXZlbnRzU3VnZ2VzdGVkID0gcmVzcG9uc2UuZGF0YTsKLy8gICAgICAgLy8gJHNjb3BlLmRhdGVUb0dvVG89ZGF0ZVRvR29UbzsKLy8gICB9KTsKLy8gfQovLyBlbHNlCi8vIHsKLy8gICAkaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3QvIiskc2NvcGUuZXZlbnRfdHlwZV9pZCsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSsiLyIrKCRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkrMSkrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0SG91cnMoKSArICIvIiArICRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkKLy8gICB7Ci8vICAgICAgIC8vCSAgICAkc2NvcGUubXlEYXRhID0gcmVzcG9uc2UuZGF0YTsKLy8gICAgICAgLy8JCWxvZ0RlYnVnKCJncmlkb3B0aW9ucz0iKyRzY29wZS5ncmlkT3B0aW9ucyk7Ci8vICAgICAgICRzY29wZS5ldmVudHNTdWdnZXN0ZWQgPSByZXNwb25zZS5kYXRhOwovLyAgICAgICAvLyAkc2NvcGUuZGF0ZVRvR29Ubz1kYXRlVG9Hb1RvOwovLyAgIH0pOwovLyB9CgovLyBhZnRlciBjYWxlbmRhciBpcyBsb2FkZWQgLSBsb2FkaW5nIGV2ZW50IHR5cGVzIGFuZCBzdWdnZXN0aW9uIGZvciBxdWV1ZXMKLy8gd2UgaGFuZGxlIHRoaW5ncyByZWxhdGVkIHRvIHRoZSBldmVudCB0eXBlcyBvbmx5IGFmdGVyIGxvYWRpbmcgdGhlbSAoYW5kIHRoZSBjYWxlbmRhcikKZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzTm9TeXN0ZW0oJGh0dHAsJHNjb3BlLCdldmVudF90eXBlcycsZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzTm9TeXN0ZW1fY2FsbGJhY2spOwoKZnVuY3Rpb24gZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzTm9TeXN0ZW1fY2FsbGJhY2soKQp7ICAgIC8vIGNoZWNraW5nIGlmIGNhbGVuZGFyIHNob3VsZCBzdGFydCB3aXRoIGEgc3BlY2lmaWMgZXZlbnQgdHlwZSBmb3Igc3VnZ2VzdGlvbnMKLy8gbG9nRGVidWcoIlggc2hhcmVkUHJvcGVydGllcy5nZXRfZXZlbnRfdHlwZV9mb3Jfc3VnZ2VzdGlvbnM9IitzaGFyZWRQcm9wZXJ0aWVzLmdldF9ldmVudF90eXBlX2Zvcl9zdWdnZXN0aW9ucygpKTsKaWYgKHNoYXJlZFByb3BlcnRpZXMuZ2V0X2V2ZW50X3R5cGVfZm9yX3N1Z2dlc3Rpb25zKCkhPW51bGwpCnsKJHNjb3BlLnNlbGVjdGVkX2V2ZW50X3R5cGVfaWQ9c2hhcmVkUHJvcGVydGllcy5nZXRfZXZlbnRfdHlwZV9mb3Jfc3VnZ2VzdGlvbnMoKTsKJHNjb3BlLmV2ZW50VHlwZVNlbGVjdGVkKCRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkKTsKfQoKLy8gZmlyc3QgY2hlY2tpbmcgaWYgdGhlcmUncyBhbiBldmVudCB0byByZXNjaGVkdWxlCmlmIChzaGFyZWRQcm9wZXJ0aWVzLmdldF9ldmVudF9yZXNjaGVkdWxlKCkhPW51bGwpCnsKJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGU9dHJ1ZTsKJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGVfZXZlbnQ9c2hhcmVkUHJvcGVydGllcy5nZXRfZXZlbnRfcmVzY2hlZHVsZSgpOwpzaGFyZWRQcm9wZXJ0aWVzLnNldF9ldmVudF9yZXNjaGVkdWxlKG51bGwpOwpsb2dEZWJ1ZygiZ290IGV2ZW50IHRvIHJlc2NoZWR1bGUgIitKU09OLnN0cmluZ2lmeSgkc2NvcGUucHJldmlvdXNfZXZlbnRfcmVzY2hlZHVsZV9ldmVudCkpOwpsb2dEZWJ1ZygicmVzY2hlZHVsZSBldmVudF90eXBlX2lkPSIrJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGVfZXZlbnQuZXZlbnRfdHlwZV9pZCk7CiRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkPSRzY29wZS5wcmV2aW91c19ldmVudF9yZXNjaGVkdWxlX2V2ZW50LmV2ZW50X3R5cGVfaWQ7CiRzY29wZS5ldmVudFR5cGVTZWxlY3RlZCgpOwp9Ci8vIGNoZWNraW5nIHNlbGVjdGVkIHVzZXIgb25seSBpZiB0aGVyZSdzIG5vIHNlbGVjdGVkIGV2ZW50IHRvIG1vdmUKZWxzZSBpZiAoc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpIT1udWxsKQp7CmNvbnNvbGUubG9nKCJnb3QgcHJldmlvdXMgc2VsZWN0ZWQgdXNlciAiK3NoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKS5idXNlcl9maXJzdF9uYW1lKTsKJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJuYW1lPXNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKS5idXNlcl9maXJzdF9uYW1lKyIgIitzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfbGFzdF9uYW1lOwokc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcl9pZD1zaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzaW5lc3NfdXNlcl9pZDsKbG9nRGVidWcoIiRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyX2lkPSIrJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJfaWQpOwoKJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXI9dHJ1ZTsKfQp9Cn0KCn0sCi8vIHNlbGVjdDogZnVuY3Rpb24oc3RhcnQsIGVuZCwgYWxsRGF5KSB7Ci8vICAgICAvLyB2YXIgdGl0bGUgPSBwcm9tcHQoJ0V2ZW50IFRpdGxlOicgKyAoc3RhcnQgKyAzNTI4MDAwMDApIC8gKDYwICogMTAwMCkgKyAiICIgKyBlbmQgKyAiICIgKyBhbGxEYXkpOwovLyAgICAgdGl0bGUgPSAi16nXoteV16og16TXoteZ15zXldeqIjsKLy8gICAgIGlmICh0aXRsZSkgewovLyAgICAgICAgIGxvZ0RlYnVnKCJjcmVhdGluZyBkZXZlbnQgc3RhcnQiKTsKLy8gICAgICAgICBsb2dEZWJ1Zygic3RhcnQ9IiArIHN0YXJ0KTsKLy8gICAgICAgICBjaGVja0RhdGUgPSBuZXcgRGF0ZShzdGFydCk7Ci8vICAgICAgICAgbG9nRGVidWcoImNoZWNrIGRhdGUgPSAiICsgY2hlY2tEYXRlKQovLyAgICAgICAgIGxvZ0RlYnVnKCJlbmQ9IiArIGVuZCk7Ci8vICAgICAgICAgZWNvbG9yID0gIiMiICsgJHNjb3BlLmV2ZW50Q29sb3I7IC8vZ2V0UmFuZG9tQ29sb3IoKTsKLy8KLy8KLy8gICAgICAgICAvLyB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tdLmZ1bGxDYWxlbmRhcigncmVyZW5kZXJFdmVudHMnKTsKLy8KLy8gICAgICAgICBjYWxlbmRhciA9ICRzY29wZS5jYWxlbmRhcl9uYW1lOwovLyAgICAgICAgIHRlbXBfbGltaXRfaWQgPSAkZ0NhbGVuZGFyVGVtcEVudklEMSAtIGdldFJhbmRvbUludCgxMCwgODApOwovLyAgICAgICAgIG5ld0V2ZW50ID0gewovLyAgICAgICAgICAgICBpZDogdGVtcF9saW1pdF9pZCwKLy8gICAgICAgICAgICAgdGl0bGU6IHRpdGxlLAovLyAgICAgICAgICAgICBzdGFydDogc3RhcnQsCi8vICAgICAgICAgICAgIGNvbG9yOiBlY29sb3IsCi8vICAgICAgICAgICAgIGVuZDogZW5kLAovLyAgICAgICAgICAgICBhbGxEYXk6IGZhbHNlLAovLyAgICAgICAgICAgICBjbGFzc05hbWU6IFsnb3BlblNlc2FtZSddCi8vICAgICAgICAgICAgICAgICAvLyBjb2xvcjogcmVzb3VyY2UuZXZlbnRDb2xvcgovLyAgICAgICAgIH07Ci8vICAgICAgICAgY2FsZW5kYXIgPSAkc2NvcGUuY2FsZW5kYXJfbmFtZTsKLy8KLy8gICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZW5kZXJFdmVudCcsIG5ld0V2ZW50LCB0cnVlKTsKLy8gICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCd1bnNlbGVjdCcpOwovLwovLyAgICAgICAgIGxvZ0RlYnVnKCJjcmVhdGluZyBkZXZlbnQgZW5kIik7Ci8vICAgICAgICAgJHNjb3BlLmFkZEV2ZW50VG9EYXRhYmFzZShzdGFydCwgZW5kLCB0aXRsZSwgZWNvbG9yLCB0ZW1wX2xpbWl0X2lkKTsKLy8KLy8gICAgIH0KLy8gfQp9Cn07Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignSG91cnNPZldvcmtDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGNvbXBpbGUsICRsb2NhdGlvbiwgdWlDYWxlbmRhckNvbmZpZywgJHVpYk1vZGFsKSB7CmxvZ0RlYnVnKCdIb3Vyc09mV29yayBDb250cm9sbGVyJyk7Cgpsb2dEZWJ1ZygiJGxvY2F0aW9uLnNlYXJjaCgpLnN0YXJ0PSIgKyAkbG9jYXRpb24uc2VhcmNoKCkuc3RhcnQpOwppZiAodHlwZW9mICRsb2NhdGlvbi5zZWFyY2goKS5zdGFydCA9PSAndW5kZWZpbmVkJykgewpjdXJyRGVmYXVsdERhdGUgPSAkZ0hvdXIwZGF0ZTsKJHNjb3BlLmZpeGVkU2NoZWR1bGUgPSB0cnVlOwokc2NvcGUuY2FsZW5kYXJUaXRsZUNlbnRlciA9ICLXqdei15XXqiDXpNei15nXnNeV16og16fXkdeV16LXldeqIjsKbG9nRGVidWcoItep16LXldeqINek16LXmdec15XXqiDXp9eR15XXoteV16oiKTsKaG91cnNPZldvcmtEZWZhdWx0Vmlldz0nZG9udFNob3dEYXRlJzsKfSBlbHNlIHsKY3VyckRlZmF1bHREYXRlID0gJGxvY2F0aW9uLnNlYXJjaCgpLnN0YXJ0Owokc2NvcGUuZml4ZWRTY2hlZHVsZSA9IGZhbHNlOwovLyAkc2NvcGUuY2FsZW5kYXJUaXRsZUNlbnRlciA9ICLXqdei15XXqiDXpNei15nXnNeV16og16fXkdeV16LXldeqIjsKaG91cnNPZldvcmtEZWZhdWx0Vmlldz0nYWdlbmRhV2Vlayc7Cn0KCgokc2NvcGUudmlzaWJsZURhdGUgPSBbXTsKJHNjb3BlLmNhbGVuZGFyID0gJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnOwokc2NvcGUuc2VsZWN0ZWRFdmVudFR5cGUgPSBbXTsKCmdldEFsbEJ1c2luZXNzRXZlbnRUeXBlcygkaHR0cCwkc2NvcGUsJ2V2ZW50X3R5cGVzJyxnZXRBbGxCdXNpbmVzc0V2ZW50VHlwZXNfY2FsbGJhY2spOwoKZnVuY3Rpb24gZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzX2NhbGxiYWNrKCkKewokc2NvcGUuc2VsZWN0RXZlbnRUeXBlKCRzY29wZS5ldmVudF90eXBlc1swXSk7Cn0KJHNjb3BlLmJhY2tUb0NhbGVuZGFyID0gZnVuY3Rpb24oKSB7CnZpc2libGVEYXRlU3RhcnQgPSBuZXcgRGF0ZSh1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ2V0VmlldycpLnN0YXJ0KTsKZGF0ZVRvR29UbyA9IHZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSArICItIiArICgnMCcgKyAodmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpICsgMSkpLnNsaWNlKC0yKSArICItIiArICgnMCcgKyB2aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSkuc2xpY2UoLTIpOwokbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2NhbGVuZGFyJykuc2VhcmNoKHsKc3RhcnQ6IGRhdGVUb0dvVG8KfSk7Cn0KJHNjb3BlLnNlbGVjdEV2ZW50VHlwZSA9IGZ1bmN0aW9uKGV2ZW50VHlwZSkgewokc2NvcGUuc2VsZWN0ZWRFdmVudFR5cGUgPSBldmVudFR5cGU7CmxvZ0RlYnVnKCJzZWxlY3RlZCBFdmVudCBUeXBlID0gIiArICRzY29wZS5zZWxlY3RlZEV2ZW50VHlwZS5ldmVudF90eXBlX2lkICsgIiwgIiArICRzY29wZS5zZWxlY3RlZEV2ZW50VHlwZS5ldmVudF90eXBlX25hbWUpOwprdXplSXNDYWxlbmRhckRyYWdnYmxlID0gJHNjb3BlLnNlbGVjdGVkRXZlbnRUeXBlLmRpZmZfcmFuZ2U7Cn07Cgokc2NvcGUuY2hhbmdlRXZlbnRDb2xvciA9IGZ1bmN0aW9uKG5ld0NvbG9yKSB7CiRzY29wZS5ldmVudENvbG9yID0gbmV3Q29sb3I7CmFsbGxFdmVudHNBcnJheSA9IHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2NsaWVudEV2ZW50cycpOwpmb3IgKGkgaW4gYWxsbEV2ZW50c0FycmF5KSB7CmFsbGxFdmVudHNBcnJheVtpXS5jb2xvciA9ICIjIiArIG5ld0NvbG9yOwp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCd1cGRhdGVFdmVudCcsIGFsbGxFdmVudHNBcnJheVtpXSk7Cn0KfTsKCiRzY29wZS5ldmVudENsaWNrTW9kdWxlID0gZnVuY3Rpb24oc2VsZWN0ZWRFdmVudCwgc2l6ZSkgewpsb2dEZWJ1Zygic2VsZWN0ZWQgRXZlbnQgdGl0bGU9IiArIHNlbGVjdGVkRXZlbnQudGl0bGUpOwoKCnZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewphbmltYXRpb246IGZhbHNlLAp0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9saW1pdGF0aW9uX2RldGFpbHMuaHRtbCcsCmNvbnRyb2xsZXI6ICdldmVudERldGFpbHNIb3Vyc09mV29ya01vZGFsQ29udHJvbGxlcicsCnNpemU6IHNpemUsCnJlc29sdmU6IHsKc2VsZWN0ZWRFdmVudDogZnVuY3Rpb24oKSB7CnJldHVybiBzZWxlY3RlZEV2ZW50Owp9LApmaXhlZFNjaGVkdWxlOiBmdW5jdGlvbiAoKQp7CnJldHVybiAkc2NvcGUuZml4ZWRTY2hlZHVsZTsKfQp9Cn0pOwoKbW9kYWxJbnN0YW5jZS5yZXN1bHQudGhlbihmdW5jdGlvbihzZWxlY3RlZEl0ZW0pIHsKJHNjb3BlLnNlbGVjdGVkID0gc2VsZWN0ZWRJdGVtOwp9LCBmdW5jdGlvbigpIHsKbG9nRGVidWcoJ01vZGFsIGRpc21pc3NlZCBhdDogJyArIG5ldyBEYXRlKCkpOwp9KTsKfTsKCgp2YXIgZGF0ZSA9IG5ldyBEYXRlKCk7CnZhciBkID0gZGF0ZS5nZXREYXRlKCk7CnZhciBtID0gZGF0ZS5nZXRNb250aCgpOwp2YXIgeSA9IGRhdGUuZ2V0RnVsbFllYXIoKTsKCgpmdW5jdGlvbiBnZXRUaW1lU3RhbXAobm93KSB7CnJldHVybiAoKG5vdy5nZXRNb250aCgpICsgMSkgKyAnLycgKyAobm93LmdldERhdGUoKSkgKyAnLycgKyBub3cuZ2V0RnVsbFllYXIoKSArICIgIiArIG5vdy5nZXRIb3VycygpICsgJzonICsgKChub3cuZ2V0TWludXRlcygpIDwgMTApID8gKCIwIiArIG5vdy5nZXRNaW51dGVzKCkpIDogKG5vdy5nZXRNaW51dGVzKCkpKSArICc6JyArICgobm93LmdldFNlY29uZHMoKSA8IDEwKSA/ICgiMCIgKyBub3cKLmdldFNlY29uZHMoKSkgOiAobm93LmdldFNlY29uZHMoKSkpKTsKfQoKCi8qIENoYW5nZSBWaWV3ICovCiRzY29wZS5jaGFuZ2VWaWV3ID0gZnVuY3Rpb24odmlldywgY2FsZW5kYXIpIHsKbG9nRGVidWcoImNoYW5nZSB2aWV3ICIgKyB2aWV3KTsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignY2hhbmdlVmlldycsIHZpZXcpOwp9OwovKiBDaGFuZ2UgVmlldyAqLwoKJHNjb3BlLnJlbmRlckNhbGVuZGVyID0gZnVuY3Rpb24oY2FsZW5kYXIpIHsKJHRpbWVvdXQoZnVuY3Rpb24oKSB7CmlmICh1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0pIHsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVuZGVyJyk7Cn0KfSk7Cn07Cgokc2NvcGUuY2hhbmdlU2VsZWN0YWJsZSA9IGZ1bmN0aW9uKCkgewprdXplSXNDYWxlbmRhckRyYWdnYmxlID0gIWt1emVJc0NhbGVuZGFyRHJhZ2dibGU7CmNhbGVuZGFyID0gJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnOwovLyB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3JykuY2FsZW5kYXIub3B0aW9ucy5zZWxlY3RhYmxlID0gZmFsc2U7CnZpZXcgPSB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdvcHRpb24nLCAnc2VsZWN0YWJsZScsIGZhbHNlKTsKLy8gdmlldy5jYWxlbmRhci5vcHRpb25zLnNlbGVjdGFibGUgPSBmYWxzZTsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVuZGVyJyk7Cgp9Ci8qIGNvbmZpZyBvYmplY3QgKi8KCiRzY29wZS5jYWxlbmRhcl9ob3Vyc19vZl93b3JrX2NvbmZpZyA9IHsKY2FsZW5kYXI6IHsKaGVpZ2h0OiAnYXV0bycsCmVkaXRhYmxlOiB0cnVlLAovLyBoZWFkZXI6IHsKLy8gICAgIGxlZnQ6ICcnLAovLyAgICAgY2VudGVyOiAnJywKLy8gICAgIHJpZ2h0OiAnJwovLyB9LApoZWFkZXI6ICcnLAovLyBoZWFkZXI6IHsKLy8gICAgIGxlZnQ6ICd0aXRsZScsCi8vICAgICBjZW50ZXI6ICcnLAovLyAgICAgcmlnaHQ6ICd0b2RheSBwcmV2LG5leHQnCi8vIH0sCi8vIGRlZmF1bHRWaWV3OiAnYWdlbmRhV2VlaycsCnZpZXdzOiB7CmRvbnRTaG93RGF0ZTogewp0eXBlOiAnYWdlbmRhV2VlaycsCmR1cmF0aW9uOiB7CmRheXM6IDcKfSwKdGl0bGU6ICdBcGVydHVyYScsCmNvbHVtbkZvcm1hdDogJ2RkZGQnIC8vIEZvcm1hdCB0aGUgZGF5IHRvIG9ubHkgc2hvdyBsaWtlICdNb25kYXknCi8vIGhpZGRlbkRheXM6IFswLCA2XSAvLyBIaWRlIFN1bmRheSBhbmQgU2F0dXJkYXk/Cn0sCmRvU2hvd0RhdGU6IHsKdHlwZTogJ2FnZW5kYVdlZWsnLApkdXJhdGlvbjogewpkYXlzOiA3Cn0sCnRpdGxlOiAnQXBlcnR1cmEnLAoKLy8gaGlkZGVuRGF5czogWzAsIDZdIC8vIEhpZGUgU3VuZGF5IGFuZCBTYXR1cmRheT8KfQp9LApldmVudERyb3A6IGZ1bmN0aW9uKGV2ZW50LCBkYXlEZWx0YSwgbWludXRlRGVsdGEsIGFsbERheSwgcmV2ZXJ0RnVuYywgdWlDYWxlbmRhckNvbmZpZykgewpsb2dEZWJ1ZygiZXZlbnRkcm9wIiArIGV2ZW50LnRpdGxlICsgIigiICsgZXZlbnQuaWQgKyAiKSBtb3ZlZCAiICsgbWludXRlRGVsdGEgKyAiIG1pbnV0ZXMiKTsKbG9nRGVidWcoIm9sZCBzdGFydD0iICsgZXZlbnQuc3RhcnQgKyAiLCBvbGQgZW5kPSIgKyBldmVudC5lbmQpOwokc2NvcGUudXBkYXRlTGltaXRhdGlvbkRhdGFiYXNlKGV2ZW50LnN0YXJ0LCBldmVudC5lbmQsIGV2ZW50LmlkLCBldmVudC50ZW1wX2xpbWl0X2lkLCBldmVudCk7Cn0sCmV2ZW50UmVzaXplOiBmdW5jdGlvbihldmVudCwgZGVsdGEsIHJldmVydEZ1bmMpIHsKbG9nRGVidWcoImV2ZW50cmVzaXplLCBldmVudC5lbmQ9IiArIGV2ZW50LmVuZCk7CiRzY29wZS51cGRhdGVMaW1pdGF0aW9uRGF0YWJhc2UoZXZlbnQuc3RhcnQsIGV2ZW50LmVuZCwgZXZlbnQuaWQsIGV2ZW50LnRlbXBfbGltaXRfaWQsIGV2ZW50KTsKfSwKZGVmYXVsdFZpZXc6IGhvdXJzT2ZXb3JrRGVmYXVsdFZpZXcsCmV2ZW50Q2xpY2s6IGZ1bmN0aW9uKGNhbEV2ZW50LCBqc0V2ZW50LCB2aWV3KSB7CmxvZ0RlYnVnKCJldmVudCBjbGlja2VkICIgKyBjYWxFdmVudC50aXRsZSArICIoaWQ9IiArIGNhbEV2ZW50LmlkICsgIiwgZGF5X2xpbWl0X2lkPSIgKyBjYWxFdmVudC5kYXlfbGltaXRfaWQgKyAiLCB0ZW1wX2xpbWl0X2lkPSIgKyBjYWxFdmVudC50ZW1wX2xpbWl0X2lkICsgIiwgbGltaXRfaWQ9IiArIGNhbEV2ZW50LmxpbWl0X2lkICsgIikgc3RhcnQ9IiArIGNhbEV2ZW50LnN0YXJ0ICsgIiwgZW5kPSIgKyBjYWxFdmVudC5lbmQpOwokc2NvcGUuZXZlbnRDbGlja01vZHVsZShjYWxFdmVudCk7Ci8vIGNoYW5nZSB0aGUgYm9yZGVyIGNvbG9yIGp1c3QgZm9yIGZ1bgovLyAkKHRoaXMpLmNzcygnYm9yZGVyLWNvbG9yJywgJ3JlZCcpOwoKfSwKZXZlbnRSZW5kZXI6IGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KQp7CmNvbnNvbGUubG9nKGV2ZW50KTsKZWxlbWVudC5maW5kKCcuZmMtdGl0bGUnKS5wcmVwZW5kKGV2ZW50LmxvY2F0aW9uX25hbWUrIiAvIDxici8+Iik7CmVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZChldmVudC5pbnN0cnVjdG9yX25hbWUrIiAvIDxici8+Iik7Ci8vIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZCgiIitldmVudC5ldmVudFVzZXJzWzBdLmJ1c2VyX2ZpcnN0X25hbWUrIiAiK2V2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfbGFzdF9uYW1lKyIgKCIpOwoKLy8gY29uc29sZS5sb2coInJlbmRlciBsaW1pdGF0aW9uICIrSlNPTi5zdHJpbmdpZnkoZXZlbnQpKTsKLy8gaWYgKGV2ZW50LmlzX2NsYXNzPT0xKQovLyB7Ci8vICAgLy8gaWYgY2xhc3MgYWRkaW5nIG51bWJlciBvZiBwYXJ0aWNpcGFudHMKLy8gICBpZiAoZXZlbnQubm9fb2Zfd2FpdGluZ191c2Vycz4wKQovLyAgIHsKLy8gICAgIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZChldmVudC5ub19vZl91c2VycysiLyIrZXZlbnQubWF4X3BhcnRpY2lwYW50cysgIiAoIitldmVudC5ub19vZl93YWl0aW5nX3VzZXJzKyIpIisiIC0gIik7Ci8vICAgfQovLyAgIGVsc2UKLy8gICB7Ci8vICAgICBlbGVtZW50LmZpbmQoJy5mYy10aXRsZScpLnByZXBlbmQoZXZlbnQubm9fb2ZfdXNlcnMrIi8iK2V2ZW50Lm1heF9wYXJ0aWNpcGFudHMrIiAtICIpOwovLyAgIH0KLy8gfQovLyBlbHNlCi8vIHsKLy8gICAvLyBpZiBub3QgY2xhc3MgLSB3cml0aW5nIHRoZSBlbmR1c2VyIG5hbWUKLy8gICBpZiAoZXZlbnQuZHVyYXRpb25fZXZlbnQhPTApIC8vIGFsc28gaWYgbm90IGhvdXJzIG9mIHdvcmsKLy8gICB7Ci8vICAgICAvLyBlbGVtZW50LmZpbmQoJy5mYy10aXRsZScpLmFwcGVuZCgiICgiK2V2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfZmlyc3RfbmFtZSsiICIrZXZlbnQuZXZlbnRVc2Vyc1swXS5idXNlcl9sYXN0X25hbWUrIikiKTsKLy8gICAgIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZCgiIitldmVudC5ldmVudFVzZXJzWzBdLmJ1c2VyX2ZpcnN0X25hbWUrIiAiK2V2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfbGFzdF9uYW1lKyIgKCIpOwovLyAgICAgZWxlbWVudC5maW5kKCcuZmMtdGl0bGUnKS5hcHBlbmQoIikiKTsKLy8gICB9Ci8vICAgLy8gbG9nRGVidWcoImhlcmU0Iik7Ci8vIH0KLy8gaWYgKGV2ZW50LmlzX3JlcGVhdGluZyA9PSAxKSB7Ci8vICAgICBlbGVtZW50LmZpbmQoIi5mYy10aXRsZSIpLnByZXBlbmQoIiZuYnNwOzxpIGNsYXNzPSdmYSBmYS1yZXBlYXQnPjwvaT4mbmJzcDsiKTsKLy8gICAgIC8vICBlbGVtZW50LmZpbmQoIi5mYy10aXRsZSIpLmFwcGVuZCgiJm5ic3A7PGltZyBzcmM9Jy9wdWJsaWMvaW1hZ2VzL3JlY3VycmluZy1pY29uLnBuZycgd2lkdGg9JzEwcHgnIGhlaWdodD0nMTBweCcvPiIpOwovLyB9Cn0sCm1pblRpbWU6ICRnQ2FsZW5kYXJEaXNwbGF5TWluVGltZSwKbWF4VGltZTogJGdDYWxlbmRhckRpc3BsYXlNYXhUaW1lLApzZWxlY3RhYmxlOiB0cnVlLApzZWxlY3RIZWxwZXI6IGZhbHNlLAp0aW1lem9uZTogZmFsc2UsCmlzUlRMOiB0cnVlLApsYW5nOiAiaGUiLApzZWxlY3RDb25zdHJhaW50OiB7CnN0YXJ0OiAnMDA6MDEnLAplbmQ6ICcyMzo1OScsCn0sCmRlZmF1bHREYXRlOiBtb21lbnQoY3VyckRlZmF1bHREYXRlKSwKYWxsRGF5U2xvdDogZmFsc2UsCmxvYWRpbmc6IGZ1bmN0aW9uKGJvb2wpIHsKaWYgKGJvb2wpIHsKICAgICAgICAgICAgICAgICAgICBsb2dEZWJ1ZygnbG9hZGluZyBjYWxlbmRhcjIgJyArICRzY29wZS5jYWxlbmRhcik7CgovLyAkKCcjbG9hZGluZycpLnNob3coKTsKfSBlbHNlIHsKLy8gJCgnI2xvYWRpbmcnKS5oaWRlKCk7CmxvZ0RlYnVnKCdmaW5pc2hlZCBsb2FkaW5nIGNhbGVuZGFyICcgKyAkc2NvcGUuY2FsZW5kYXIpOwppZiAoISRzY29wZS5maXhlZFNjaGVkdWxlKSB7CiRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlKCk7Cn0KLy8gJHNjb3BlLmJhY2tUb0ZpeGVkKCk7Cn0KfSwKc2VsZWN0OiBmdW5jdGlvbihzdGFydCwgZW5kLCBhbGxEYXkpIHsKLy8gdGhpcyBpcyBjYWxsZWQgd2hlbiBjcmVhdGluZyBhIG5ldyBibG9jawokc2NvcGUuY3JlYXRlTGltaXRhdGlvbkJsb2NrKHN0YXJ0LCBlbmQpOwp9Cn0KfTsKCi8vIGNyZWF0ZSBsaW1pdGF0aW9uIGJsb2NrCiRzY29wZS5jcmVhdGVMaW1pdGF0aW9uQmxvY2sgPSBmdW5jdGlvbihzdGFydCwgZW5kKQp7CmxvZ0RlYnVnKCJmdW5jdGlvbjogY3JlYXRlTGltaXRhdGlvbkJsb2NrIik7CnZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewphbmltYXRpb246IGZhbHNlLAp0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9saW1pdGF0aW9uX2NyZWF0ZS5waHAnLApzaXplOiAneHMnLApjb250cm9sbGVyOiAnYnVzaW5lc3NfbW9kYWxfbGltaXRhdGlvbl9jcmVhdGUnLApyZXNvbHZlOiB7CnN0YXJ0OiBmdW5jdGlvbigpCnsKcmV0dXJuIHN0YXJ0Owp9LAplbmQ6IGZ1bmN0aW9uKCkKewpyZXR1cm4gZW5kOwp9LApmaXhlZFNjaGVkdWxlOiBmdW5jdGlvbiAoKQp7CnJldHVybiAkc2NvcGUuZml4ZWRTY2hlZHVsZTsKfQp9Cn0pOwp9CiRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlID0gZnVuY3Rpb24oKSB7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3Jyk7Cgp2aXNpYmxlRGF0ZVN0YXJ0ID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5zdGFydCk7CnZpc2libGVEYXRlRW5kID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5lbmQpOwoKJHNjb3BlLmNhbGVuZGFyVGl0bGVDZW50ZXIgPSB2aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSArICIgIiArIG1vbnRoTmFtZXNbdmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpXSArCiIg4oCUICIgKyB2aXNpYmxlRGF0ZUVuZC5nZXREYXRlKCkgKyAiICIgKyBtb250aE5hbWVzW3Zpc2libGVEYXRlRW5kLmdldE1vbnRoKCldICsKIiAiICsgdmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpOwp9OwovKiBldmVudCBzb3VyY2VzIGFycmF5Ki8KJHNjb3BlLmV2ZW50U291cmNlcyA9IFt7CnVybDogJy9hcGkvYWRtaW4vY2FsZW5kYXIvbGltaXRhdGlvbnMvcGVyZGF5L2dldHBvc3QnLAp0eXBlOiAnUE9TVCcKfV07CgovLyAkc2NvcGUuZ2V0RXZlbnRzID0gZnVuY3Rpb24oKSB7Ci8vICAgICBjYWxlbmRhciA9ICdjYWxlbmRhcl9ob3Vyc19vZl93b3JrJzsKLy8gICAgIGFsbGxFdmVudHNBcnJheSA9IHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2NsaWVudEV2ZW50cycpOwovLyAgICAgZm9yIChpIGluIGFsbGxFdmVudHNBcnJheSkgewovLyAgICAgICAgIGxvZ0RlYnVnKGFsbGxFdmVudHNBcnJheVtpXSk7Ci8vICAgICB9Ci8vCi8vIH0KCiRzY29wZS5nb3RvVG9kYXkgPSBmdW5jdGlvbigpIHsKJHNjb3BlLmdvdG9EYXRlKG5ldyBEYXRlKCkpOwp9CiRzY29wZS5nb3RvTmV4dCA9IGZ1bmN0aW9uKCkgewp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignbmV4dCcpOwp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVtb3ZlRXZlbnRzJyk7CiRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlKCk7Cn0KJHNjb3BlLmdvdG9QcmV2ID0gZnVuY3Rpb24oKSB7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZW1vdmVFdmVudHMnKTsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3ByZXYnKTsKJHNjb3BlLnVwZGF0ZUNhbGVuZGFyQ2VudGVyVGl0bGUoKTsKfQokc2NvcGUuZ290b0RhdGUgPSBmdW5jdGlvbihuZXdkYXRlKSB7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnb3RvRGF0ZScsIG5ld2RhdGUpOwp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignY2hhbmdlVmlldycsICdhZ2VuZGFXZWVrJyk7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZW1vdmVFdmVudHMnKTsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKCiRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlKCk7CiRzY29wZS5maXhlZFNjaGVkdWxlID0gZmFsc2U7Cn0KCiRzY29wZS5iYWNrVG9GaXhlZCA9IGZ1bmN0aW9uKCkgewokc2NvcGUuZml4ZWRTY2hlZHVsZSA9IHRydWU7CiRzY29wZS5jYWxlbmRhclRpdGxlQ2VudGVyID0gItep16LXldeqINek16LXmdec15XXqiDXp9eR15XXoteV16oiOwp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignY2hhbmdlVmlldycsICdkb250U2hvd0RhdGUnKTsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dvdG9EYXRlJywgbW9tZW50KCRnSG91cjBkYXRlKSk7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZW1vdmVFdmVudHMnKTsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKCn0KCi8vICRzY29wZS5kZWxldGVBbGxFdmVudHMgPSBmdW5jdGlvbigpIHsKLy8gICAgIGNhbGVuZGFyID0gJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnOwovLyAgICAgYWxsbEV2ZW50c0FycmF5ID0gdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignY2xpZW50RXZlbnRzJyk7Ci8vICAgICBmb3IgKGkgaW4gYWxsbEV2ZW50c0FycmF5KSB7Ci8vICAgICAgICAgbG9nRGVidWcoYWxsbEV2ZW50c0FycmF5W2ldKTsKLy8gICAgICAgICAkc2NvcGUuZGVsZXRlQ2FsZW5kYXJKU0V2ZW50KGNhbGVuZGFyLCBhbGxsRXZlbnRzQXJyYXlbaV0uaWQpOwovLyAgICAgICAgICRzY29wZS5kZWxldGVDYWxlbmRhckRCRXZlbnQoYWxsbEV2ZW50c0FycmF5W2ldLmlkKTsKLy8gICAgIH0KLy8KLy8gfQokc2NvcGUudXBkYXRlTGltaXRhdGlvbkRhdGFiYXNlID0gZnVuY3Rpb24oc3RhcnRfcGFyYW0sIGVuZF9wYXJhbSwgZXZlbnRfaWQsIHRlbXBfbGltaXRfaWQsIHRoZWV2ZW50KSB7Cgpsb2dEZWJ1ZygidXBkYXRlTGltaXRhdGlvbkRhdGFiYXNlIHN0YXJ0PSIgKyBzdGFydF9wYXJhbSArICIsIGVuZD0iICsgZW5kX3BhcmFtICsgIixldmVudF9pZD0iICsgZXZlbnRfaWQpOwoKZnVuY3Rpb24gdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uX2ZhaWx1cmUoKQp7CmNhbGVuZGFyID0gImNhbGVuZGFyX2hvdXJzX29mX3dvcmsiOwp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZWZldGNoRXZlbnRzJyk7Cn0KLy8gaWYgdGhlIGV2ZW50IHRoYXQgaXMgZ2V0dGluZyB1cGRhdGVkIGlzIGFuIGV2ZW50IGZyb20gMTk3MCAobm90IHBlcmRheSkKLy8gdGhlbiB3ZSBhZGQgYSBuZXcgcGVyZGF5IGxpbWl0YXRpb24gd2l0aCBsaW1pdF9pZCBvZiB0aGUgMTk3MCBsaW1pdGF0aW9ucyAtIHdpdGggdGhlIG5ldyB0aW1lcy4KCi8vIG90aGVyd2lzZSB3ZSBqdXN0IHVwZGF0ZSB0aGUgcGVyZGF5IGxpbWl0YXRpb24KCmlmICgkc2NvcGUuZml4ZWRTY2hlZHVsZSkgLy8gZml4ZWQgc2NoZWR1bGUgdnMgc3BlY2lmaWMgd2VlZC9kYXkgbGltaXRhdGlvbgp7CnRoZWRhdGEgPSB7CnN0YXJ0X2RhdGU6IHN0YXJ0X3BhcmFtLAplbmRfZGF0ZTogZW5kX3BhcmFtLAp0ZW1wX2xpbWl0X2lkOiB0ZW1wX2xpbWl0X2lkLApsaW1pdF9pZDogZXZlbnRfaWQKfTsKCnVwZGF0ZUNhbGVuZGFyTGltaXRhdGlvbigkaHR0cCwkc2NvcGUsdGhlZGF0YSxldmVudF9pZCwgbnVsbCwgdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uX2ZhaWx1cmUpOwp9CmVsc2UgLy8gbm90IGZpeGVkIHNjaGVkdWxlIC0gZGFpbHkvd2Vla2x5IGxpbWl0YXRpb25zCnsKaWYgKCh0aGVldmVudC5saW1pdF9pZCAhPSBudWxsKSAmICh0aGVldmVudC5kYXlfbGltaXRfaWQgPT0gLTEpKSAvLyBldmVudCBsaW1pdGF0aW9uIGhhcyBsaW1pdF9pZCBzbyBpdHMgYW4gMTk3MCBldmVudAovLyBuZWVkIHRvIGFkZCBhIG5ldyBwZXJkYXkgbGltaXRhdGlvbiB0aGF0IHBvaW50IChsaW1pdF9pZCkgdG8gdGhlIG9sZCAxOTcwIGV2ZW50IHRvIGNhbmNlbCBpdAp7CnRlbXBfbGltaXRfaWQgPSBjYWxjX3RlbXBfbGltaXRfaWQoKTsKdGhlZXZlbnQudGVtcF9saW1pdF9pZCA9IHRlbXBfbGltaXRfaWQ7CnRoZWV2ZW50LmRheV9saW1pdF9pZCA9IHRlbXBfbGltaXRfaWQ7Ci8vIHRoZSBtb3ZlZCBldmVudCBpbiB0aGUgY2FsZW5kYXIgbm93IGhhcyBkYXlfbGltaXRfaWQgYW5kIHRlbXBfbGltaXRfaWQKLy8gaWYgaXRzIGxvYWRlZCBmcm9tIHRoZSBkYiwgaXQgd2lsbCBvbmx5IGhhdmUgZGF5X2xpbWl0X2lkIChhbmQgbm90IHRoZSB0ZW1wIG9uZSkKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnXS5mdWxsQ2FsZW5kYXIoJ3VwZGF0ZUV2ZW50JywgdGhlZXZlbnQpOwoKdGhlZGF0YSA9IHsKc3RhcnRfZGF0ZTogc3RhcnRfcGFyYW0sCmVuZF9kYXRlOiBlbmRfcGFyYW0sCmNvbG9yOiB0aGVldmVudC5jb2xvciwKdGVtcF9saW1pdF9pZDogdGVtcF9saW1pdF9pZCwKZXZlbnRfdHlwZV9pZDogdGhlZXZlbnQuZXZlbnRfdHlwZV9pZCwKZXZlbnRfdHlwZXM6IHRoZWV2ZW50LmV2ZW50X3R5cGVzLApsb2NhdGlvbl9pZDogdGhlZXZlbnQubG9jYXRpb25faWQsCmVtcF9pZDogdGhlZXZlbnQuZW1wX2lkLApsaW1pdF9pZDogdGhlZXZlbnQuaWQsCnRpdGxlOiB0aGVldmVudC50aXRsZQp9OwpjcmVhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXkoJGh0dHAsJHNjb3BlLHRoZWRhdGEsbnVsbCwgdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uX2ZhaWx1cmUpOwoKfQplbHNlIC8vIGV2ZW50IGxpbWl0YXRpb24gdG8gbW92ZS91cGRhdGUgaGFzIG5vIGxpbWl0X2lkIC0gc28gdGhpcyBpcyBuZXcgcGVyZGF5IGV2ZW50IC0gd2UganVzdCB1cGRhdGUgaXQKewp0aGVkYXRhPSB7CnN0YXJ0X2RhdGU6IHN0YXJ0X3BhcmFtLAplbmRfZGF0ZTogZW5kX3BhcmFtLAp0ZW1wX2RheV9saW1pdF9pZDogdGhlZXZlbnQudGVtcF9saW1pdF9pZCwKbG9jYXRpb25faWQ6IHRoZWV2ZW50LmxvY2F0aW9uX2lkLApkYXlfbGltaXRfaWQ6IHRoZWV2ZW50LmRheV9saW1pdF9pZAp9Owp1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXkoJGh0dHAsJHNjb3BlLHRoZWRhdGEsbnVsbCwgdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uX2ZhaWx1cmUpOwp9Cn0KfTsKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ0V2ZW50Q2xhc3NQYWdlQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHRpbWVvdXQsICRodHRwLCAkcm9vdFNjb3BlLCAkcm91dGVQYXJhbXMsICRsb2NhdGlvbiwgJHJvdXRlLCBzaGFyZWREYXRhLCAkdWliTW9kYWwpCnsKZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkKTsKZ2V0QWxsQ2xpZW50cygkaHR0cCwkc2NvcGUsJ2V2ZW50VHlwZVVzZXJzJyk7CmdldEJ1c2luZXNzTG9jYXRpb25zKCRodHRwLCRzY29wZSwnYnVzaW5lc3NfbG9jYXRpb25zJyk7CmdldEFsbEluc3RydWN0b3JzKCRodHRwLCRzY29wZSwnaW5zdHJ1Y3RvcnMnKTsKCiRzY29wZS51cGRhdGVFdmVudFRpdGxlID0gZnVuY3Rpb24obmV3VmFsdWUsY3VycmVudEV2ZW50KQp7Cm5ld190aXRsZT1uZXdWYWx1ZTsKc2V0RXZlbnRUaXRsZSgkaHR0cCwkc2NvcGUsY3VycmVudEV2ZW50LmV2ZW50X2lkLCBuZXdfdGl0bGUsIHVwZGF0ZUV2ZW50X2NhbGxiYWNrLCB1cGRhdGVFdmVudF9jYWxsYmFjayk7CgpmdW5jdGlvbiB1cGRhdGVFdmVudF9jYWxsYmFjaygpCnsKZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCk7Cn0KCn07Cgokc2NvcGUudXBkYXRlRXZlbnRNYXhQYXJ0aWNpcGFudHMgPSBmdW5jdGlvbihuZXdWYWx1ZSxjdXJyZW50RXZlbnQpCnsKbmV3X21heF9wYXJ0aWNpcGFudHM9bmV3VmFsdWU7CmlmICggbmV3X21heF9wYXJ0aWNpcGFudHMgPCBjdXJyZW50RXZlbnQubm9fb2ZfdXNlcnMgKXsKc2V0RXZlbnRNYXhQYXJ0aWNpcGFudHMoJGh0dHAsJHNjb3BlLGN1cnJlbnRFdmVudC5ldmVudF9pZCwgY3VycmVudEV2ZW50Lm5vX29mX3VzZXJzLCBjdXJyZW50RXZlbnQubm9fb2ZfdXNlcnMsIHVwZGF0ZUV2ZW50X2NhbGxiYWNrLCB1cGRhdGVFdmVudF9jYWxsYmFjayk7Cn0gZWxzZSB7CnNldEV2ZW50TWF4UGFydGljaXBhbnRzKCRodHRwLCRzY29wZSxjdXJyZW50RXZlbnQuZXZlbnRfaWQsIG5ld19tYXhfcGFydGljaXBhbnRzLCBjdXJyZW50RXZlbnQubm9fb2ZfdXNlcnMsIHVwZGF0ZUV2ZW50X2NhbGxiYWNrLCB1cGRhdGVFdmVudF9jYWxsYmFjayk7Cn0KCmZ1bmN0aW9uIHVwZGF0ZUV2ZW50X2NhbGxiYWNrKCkKewpnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkKTsKfQoKfTsKCiRzY29wZS51cGRhdGVVc2VyRXZlbnRQcmljZSA9IGZ1bmN0aW9uKG5ld3ZhbHVlLCB0aGVldmVudCwgZXVzZXIpCnsKbmV3X3ByaWNlPW5ld3ZhbHVlOwpzZXRDbGllbnRFdmVudFByaWNlKCRodHRwLCRzY29wZSxldXNlci5idXNpbmVzc191c2VyX2lkLHRoZWV2ZW50LmV2ZW50X2lkLCBuZXdfcHJpY2Usc2V0Q2xpZW50RXZlbnRQcmljZV9jYWxsYmFjaywgc2V0Q2xpZW50RXZlbnRQcmljZV9jYWxsYmFjayk7CmZ1bmN0aW9uIHNldENsaWVudEV2ZW50UHJpY2VfY2FsbGJhY2soKQp7CmdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQpOwp9Cn07Cgokc2NvcGUudXBkYXRlTG9jYXRpb25FdmVudCA9IGZ1bmN0aW9uKCkKewpjb25zb2xlLmxvZygiZnVuY3Rpb246IHVwZGF0ZUxvY2F0aW9uRXZlbnQiKTsKdXBkYXRlRXZlbnRMb2NhdGlvbigkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLCRzY29wZS5jdXJyZW50RXZlbnQubG9jYXRpb25faWQsdXBkYXRlRXZlbnRMb2NhdGlvbl9jYWxsYmFjaywgdXBkYXRlRXZlbnRMb2NhdGlvbl9jYWxsYmFjayk7CiRzY29wZS51cGRhdGVMb2NhdGlvbkFsZXJ0TWVzc2FnZT0i157XoteT15vXnyDXodeY15jXldehLi4uIjsKZnVuY3Rpb24gdXBkYXRlRXZlbnRMb2NhdGlvbl9jYWxsYmFjaygpCnsKJHNjb3BlLnVwZGF0ZUxvY2F0aW9uQWxlcnRNZXNzYWdlPSLXoteV15PXm9efINeR15TXptec15fXlCEiOwokdGltZW91dChmdW5jdGlvbigpCnsKJHNjb3BlLnVwZGF0ZUxvY2F0aW9uQWxlcnRNZXNzYWdlPW51bGw7Cn0sIDE1MDApOwp9Cn07Cgokc2NvcGUudXBkYXRlSW5zdHJ1Y3RvckNsYXNzRXZlbnQgPSBmdW5jdGlvbigpCnsKY29uc29sZS5sb2coImZ1bmN0aW9uOiB1cGRhdGVJbnN0cnVjdG9yQ2xhc3NFdmVudCIpOwp1cGRhdGVFdmVudEluc3RydWN0b3IoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCwkc2NvcGUuY3VycmVudEV2ZW50Lmluc3RydWN0b3JfaWQsdXBkYXRlRXZlbnRJbnN0cnVjdG9yX2NhbGxiYWNrLCB1cGRhdGVFdmVudEluc3RydWN0b3JfY2FsbGJhY2spOwokc2NvcGUudXBkYXRlSW5zdHJ1Y3RvckFsZXJ0TWVzc2FnZT0i157XoteT15vXnyDXodeY15jXldehLi4uIjsKZnVuY3Rpb24gdXBkYXRlRXZlbnRJbnN0cnVjdG9yX2NhbGxiYWNrKCkKewokc2NvcGUudXBkYXRlSW5zdHJ1Y3RvckFsZXJ0TWVzc2FnZT0i16LXldeT15vXnyDXkdeU16bXnNeX15QhIjsKJHRpbWVvdXQoZnVuY3Rpb24oKQp7CiRzY29wZS51cGRhdGVJbnN0cnVjdG9yQWxlcnRNZXNzYWdlPW51bGw7Cn0sIDE1MDApOwp9Cn0KCgokc2NvcGUuYWN0aXZhdGVFdmVudENsYXNzID0gZnVuY3Rpb24oKQp7CnsKbG9nRGVidWcoInJlb3BlbkV2ZW50Iik7CnJlb3BlbkV2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkLCRzY29wZS5zZWxlY3RlZEV2ZW50LGFmdGVyUmVvcGVuRXZlbnQsYWZ0ZXJSZW9wZW5FdmVudCk7CmZ1bmN0aW9uIGFmdGVyUmVvcGVuRXZlbnQoKQp7CmdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQpOwp9Owp9Cn0KCi8vIGNsb3NlIGV2ZW50IGNsYXNzCiRzY29wZS5jbG9zZUV2ZW50Q2xhc3MgPSBmdW5jdGlvbigpIHsKICAgICAgbG9nRGVidWcoImNsb3NlRXZlbnRDbGFzcyIpOwoKdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CmFuaW1hdGlvbjogZmFsc2UsCnRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2V2ZW50X2NsYXNzX2Nsb3NlLnBocCcsCnNpemU6ICd4cycsCmNvbnRyb2xsZXI6ICdjbGFzc0Nsb3NlTW9kYWxDb250cm9sbGVyJywKcmVzb2x2ZTogewpldmVudF9pZDogZnVuY3Rpb24oKSB7CnJldHVybiAkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkOwp9Cn0KfSk7Cn07CgovLyBkZWxldGUgcmVwZWF0aW5nL2NsYXNzIGV2ZW50CiRzY29wZS5kZWxldGVDbGFzc0V2ZW50ID0gZnVuY3Rpb24oKQp7CmlmICgkc2NvcGUuY3VycmVudEV2ZW50LmlzX3JlcGVhdGluZz09MCkKewpsb2dEZWJ1ZygiY2xhc3MgZXZlbnQgbm90IHJlcGVhdGluZyIpOwokc2NvcGUuZGVsZXRlQ2xhc3NFdmVudFNpbmdsZSgpOwp9CmVsc2UKewpsb2dEZWJ1ZygiY2xhc3MgZXZlbnQgaXMgcmVwZWF0aW5nIik7CnZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewphbmltYXRpb246IGZhbHNlLAp0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9yZXBlYXRpbmdfZXZlbnRfZGVsZXRlX2FsbC5waHAnLApzaXplOiAneHMnLApjb250cm9sbGVyOiAnY2xhc3NEZWxldGVBbGxNb2RhbENvbnRyb2xsZXInLApyZXNvbHZlOiB7CmN1cnJlbnRFdmVudDogZnVuY3Rpb24oKSB7CnJldHVybiAkc2NvcGUuY3VycmVudEV2ZW50Owp9Cn0KfSk7Cn0KfTsKCiRzY29wZS5kZWxldGVDbGFzc0V2ZW50U2luZ2xlPWZ1bmN0aW9uICgpIC8vIGRlbGV0ZSBvbmx5IG9uZS9jdXJyZW50IGNsYXNzIGV2ZWh0CnsKY2FuY2VsQ2xhc3NFdmVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCxjYW5jZWxDbGFzc0V2ZW50X2NhbGxiYWNrLCBjYW5jZWxDbGFzc0V2ZW50X2NhbGxiYWNrKTsKZnVuY3Rpb24gY2FuY2VsQ2xhc3NFdmVudF9jYWxsYmFjaygpCnsKZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCk7Cn0KfQoKJHNjb3BlLiRvbigicmVsb2FkRXZlbnQiLGZ1bmN0aW9uKGUsYSl7Ci8vIFBvc3QgeW91ciBjb2RlCmxvZ0RlYnVnKCJicm9hZGNhc3RlZCAtIHJlbG9hZGluZyBldmVudCAiK2EuZXZlbnRfaWQpOwpnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkcm91dGVQYXJhbXMuZXZlbnRfaWQpOwp9KTsKCi8vIHJlbW92ZSBlbmQgdXNlciBmcm9tIGV2ZW50CiRzY29wZS5ldmVudFJlbW92ZUVuZFVzZXIgPSBmdW5jdGlvbihlbmR1c2VyX2lkKQp7CmNvbnNvbGUubG9nKCJldmVudFJlbW92ZUVuZFVzZXIiKTsKcmVtb3ZlRW5kVXNlckZyb21FdmVudCgkaHR0cCwkc2NvcGUsZW5kdXNlcl9pZCwkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkLHJlbW92ZUVuZFVzZXJGcm9tRXZlbnRfZmluaXNoLCByZW1vdmVFbmRVc2VyRnJvbUV2ZW50X2ZpbmlzaCk7CmZ1bmN0aW9uIHJlbW92ZUVuZFVzZXJGcm9tRXZlbnRfZmluaXNoKCkKewpnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkcm91dGVQYXJhbXMuZXZlbnRfaWQpOwp9Cn07Cgokc2NvcGUuZXZlbnRDbGllbnRTZWxlY3RlZCA9IGZ1bmN0aW9uKHNlbGVjdGVkKSB7CmlmIChzZWxlY3RlZCkgewovLyBhbGVydChKU09OLnN0cmluZ2lmeSggc2VsZWN0ZWQsIG51bGwsIDIgKSk7CmxvZ0RlYnVnKCdldmVudENsaWVudFNlbGVjdGVkMiB5ZXMgc2VsZWN0ZWQgJyArIHNlbGVjdGVkLm9yaWdpbmFsT2JqZWN0LmZpcnN0X25hbWUpOwokc2NvcGUuZXZlbnRBZGRFbmRVc2VyKHNlbGVjdGVkLm9yaWdpbmFsT2JqZWN0LmJ1c2luZXNzX3VzZXJfaWQpOwokcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2FuZ3Vjb21wbGV0ZS1hbHQ6Y2xlYXJJbnB1dCcsICdjbGllbnRfYW5ndWNvbXBsZXRlJyk7Cgp9IGVsc2Ugewpsb2dEZWJ1Zygnbm90IHNlbGVjdGVkJyk7Cn0KfTsKCiRzY29wZS5ldmVudEFkZEVuZFVzZXIgPSBmdW5jdGlvbihlbmR1c2VyX2lkKQp7CmFkZEVuZFVzZXJUb0V2ZW50KCRodHRwLCRzY29wZSxlbmR1c2VyX2lkLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQsYWRkRW5kVXNlclRvRXZlbnRfZmluaXNoLCBhZGRFbmRVc2VyVG9FdmVudF9maW5pc2gpOwpmdW5jdGlvbiBhZGRFbmRVc2VyVG9FdmVudF9maW5pc2goKQp7CmdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCk7Cn0KfTsKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ0V2ZW50UGFnZUNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICR0aW1lb3V0LCAkaHR0cCwgJHVpYk1vZGFsICxzaGFyZWRQcm9wZXJ0aWVzLCAkcm91dGVQYXJhbXMsICRyb290U2NvcGUsICRsb2NhdGlvbiwgJHJvdXRlLCBzaGFyZWREYXRhKQp7CmxvZ0RlYnVnKCJFdmVudFBhZ2VDb250cm9sbGVyIik7CgpnZXRBbGxJbnN0cnVjdG9yc0luY0luYWN0aXZlKCRodHRwLCRzY29wZSwnaW5zdHJ1Y3RvcnMnLGdldEFsbEluc3RydWN0b3JzSW5jSW5hY3RpdmVfc3VjY2Vzcyk7CmdldEJ1c2luZXNzTG9jYXRpb25zKCRodHRwLCRzY29wZSwnYnVzaW5lc3NfbG9jYXRpb25zJyk7CgpmdW5jdGlvbiBnZXRBbGxJbnN0cnVjdG9yc0luY0luYWN0aXZlX3N1Y2Nlc3MoKQp7CmdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCxzZXRQYXJ0aWNpcGF0ZWQpOwp9CgogIHZhciBpbml0aWFsaXppbmcgPSB0cnVlIDsKCiAgJHNjb3BlLiR3YXRjaCgiY3VycmVudEV2ZW50IiwgZnVuY3Rpb24obmV3VmFsdWUsIG9sZFZhbHVlKSB7CiAgICBpZiAoaW5pdGlhbGl6aW5nKSB7CiAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkgeyBpbml0aWFsaXppbmcgPSBmYWxzZTsgfSk7CiAgICB9IGVsc2UgewogICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgdmFyIHRpbWVvdXRJZDsKICAgICAgJCgnI2RvY3MgOmlucHV0LCB0ZXh0YXJlYScpLm9uKCdpbnB1dCBwcm9wZXJ0eWNoYW5nZSBjaGFuZ2UnLCBmdW5jdGlvbigpIHsKICAgICAgLy8gIGNvbnNvbGUubG9nKCdUZXh0YXJlYSBDaGFuZ2UnKTsKICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0SWQpOwogICAgICAgLy8gUnVucyBYIHNlY29uZCAoWCoxMDAwIG1zKSBhZnRlciB0aGUgbGFzdCBjaGFuZ2UKICAgICAgIHRpbWVvdXRJZCA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgJHNjb3BlLnVwZGF0ZUV2ZW50RXh0cmFGaWVsZHMoKQogICAgICAgfSwgNzAwKTsKICAgICAgIH0pOwogICAgfSwgMTAwMCk7CiAgICB9CiAgfSk7Cgokc2NvcGUuZXh0cmFGaWVsZHNBbGVydE1lc3NhZ2U9bnVsbDsKCiRzY29wZS51cGRhdGVFdmVudFRpdGxlID0gZnVuY3Rpb24obmV3VmFsdWUsY3VycmVudEV2ZW50KQp7Cm5ld190aXRsZT1uZXdWYWx1ZTsKc2V0RXZlbnRUaXRsZSgkaHR0cCwkc2NvcGUsY3VycmVudEV2ZW50LmV2ZW50X2lkLCBuZXdfdGl0bGUsIHVwZGF0ZUV2ZW50X2NhbGxiYWNrLCB1cGRhdGVFdmVudF9jYWxsYmFjayk7CgpmdW5jdGlvbiB1cGRhdGVFdmVudF9jYWxsYmFjaygpCnsKZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCk7Cn0KCn07CgoKJHNjb3BlLnVwZGF0ZUV2ZW50RXh0cmFGaWVsZHMgPSBmdW5jdGlvbigpCnsKICAgIGxvZ0RlYnVnKCJzYXZlIHVwZGF0ZUV2ZW50RXh0cmFGaWVsZHMiKTsKdGhlZGF0YSA9IHsKZXh0cmFGaWVsZHM6JHNjb3BlLmN1cnJlbnRFdmVudC5leHRyYUZpZWxkcwp9OwogICAgJHNjb3BlLmV4dHJhRmllbGRzQWxlcnRNZXNzYWdlPSLXqdeV157XqC4uLiI7CnVwZGF0ZUV2ZW50RXh0cmFGaWVsZHMoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCx0aGVkYXRhLHVwZGF0ZUV2ZW50RXh0cmFGaWVsZHNfY2FsbGJhY2ssIHVwZGF0ZUV2ZW50RXh0cmFGaWVsZHNfY2FsbGJhY2spOwoKZnVuY3Rpb24gdXBkYXRlRXZlbnRFeHRyYUZpZWxkc19jYWxsYmFjaygpCnsKICAgICAgLy8gZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLHNldFBhcnRpY2lwYXRlZCk7CgogICAgICAkc2NvcGUuZXh0cmFGaWVsZHNBbGVydE1lc3NhZ2U9Iteg16nXnteoISI7CiR0aW1lb3V0KGZ1bmN0aW9uKCkKewokc2NvcGUuZXh0cmFGaWVsZHNBbGVydE1lc3NhZ2U9bnVsbDsKICAgICAgfSwgMjMwMCk7Cn0KfTsKCiRzY29wZS5yZXNjaGVkdWxlRXZlbnQgPSBmdW5jdGlvbigpCnsKbG9nRGVidWcoInNlZXRpbmcgZXZlbnQgdG8gbW92ZSAgIiskc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0pOwpzaGFyZWRQcm9wZXJ0aWVzLnNldF9ldmVudF9yZXNjaGVkdWxlKCRzY29wZS5jdXJyZW50RXZlbnQpOwogICAgc2hhcmVkUHJvcGVydGllcy5zZXRfc2VsZWN0ZWRfdXNlcihudWxsKTsKCi8vIHVzZXJfaW5mbz0gewovLyAgICAgdXNlcl9pZDogJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudFVzZXJzWzBdLnVzZXJfaWQsCi8vICAgICBidXNlcl9maXJzdF9uYW1lOiAkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfZmlyc3RfbmFtZSwKLy8gICAgIGJ1c2VyX2xhc3RfbmFtZTogJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudFVzZXJzWzBdLmJ1c2VyX2xhc3RfbmFtZQovLyB9OwovLyBzaGFyZWRQcm9wZXJ0aWVzLnNldF9zZWxlY3RlZF91c2VyKHVzZXJfaW5mbyk7CiRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfY2FsZW5kYXInKTsKfQoKJHNjb3BlLnVwZGF0ZUxvY2F0aW9uRXZlbnQgPSBmdW5jdGlvbigpCnsKY29uc29sZS5sb2coImZ1bmN0aW9uOiB1cGRhdGVMb2NhdGlvbkV2ZW50Iik7CnVwZGF0ZUV2ZW50TG9jYXRpb24oJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCwkc2NvcGUuY3VycmVudEV2ZW50LmxvY2F0aW9uX2lkLHVwZGF0ZUV2ZW50TG9jYXRpb25fY2FsbGJhY2ssIHVwZGF0ZUV2ZW50TG9jYXRpb25fY2FsbGJhY2spOwokc2NvcGUudXBkYXRlTG9jYXRpb25BbGVydE1lc3NhZ2U9Itee16LXk9eb158g16HXmNeY15XXoS4uLiI7CmZ1bmN0aW9uIHVwZGF0ZUV2ZW50TG9jYXRpb25fY2FsbGJhY2soKQp7CiRzY29wZS51cGRhdGVMb2NhdGlvbkFsZXJ0TWVzc2FnZT0i16LXldeT15vXnyDXkdeU16bXnNeX15QhIjsKJHRpbWVvdXQoZnVuY3Rpb24oKQp7CiRzY29wZS51cGRhdGVMb2NhdGlvbkFsZXJ0TWVzc2FnZT1udWxsOwp9LCAxNTAwKTsKfQp9OwoKJHNjb3BlLnVwZGF0ZUluc3RydWN0b3JFdmVudCA9IGZ1bmN0aW9uKCkKewpjb25zb2xlLmxvZygiZnVuY3Rpb246IHVwZGF0ZUluc3RydWN0b3JFdmVudCIpOwp1cGRhdGVFdmVudEluc3RydWN0b3IoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCwkc2NvcGUuY3VycmVudEV2ZW50Lmluc3RydWN0b3JfaWQsdXBkYXRlRXZlbnRJbnN0cnVjdG9yX2NhbGxiYWNrLCB1cGRhdGVFdmVudEluc3RydWN0b3JfY2FsbGJhY2spOwokc2NvcGUudXBkYXRlSW5zdHJ1Y3RvckFsZXJ0TWVzc2FnZT0i157XoteT15vXnyDXodeY15jXldehLi4uIjsKZnVuY3Rpb24gdXBkYXRlRXZlbnRJbnN0cnVjdG9yX2NhbGxiYWNrKCkKewokc2NvcGUudXBkYXRlSW5zdHJ1Y3RvckFsZXJ0TWVzc2FnZT0i16LXldeT15vXnyDXkdeU16bXnNeX15QhIjsKJHRpbWVvdXQoZnVuY3Rpb24oKQp7CiRzY29wZS51cGRhdGVJbnN0cnVjdG9yQWxlcnRNZXNzYWdlPW51bGw7Cn0sIDE1MDApOwp9Cn07Cgokc2NvcGUuaW5pdGlhdGVQYXltZW50ID0gZnVuY3Rpb24oaXNwbHVzKQp7CnZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewphbmltYXRpb246IGZhbHNlLAp0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9jbGllbnRfcGF5bWVudC5waHAnLApjb250cm9sbGVyOiAnYnVzaW5lc3NDbGllbmRDYXJkUGF5bWVudCcsCi8vIHNpemU6IHNpemUsCnJlc29sdmU6IHsKY3VycmVudENsaWVudDogZnVuY3Rpb24oKSB7CnJldHVybiAkc2NvcGUuY3VycmVudEV2ZW50Q2xpZW50c1swXTsKfSwKaXNwbHVzOiBmdW5jdGlvbigpIHsKcmV0dXJuIGlzcGx1czsKfQp9Cn0pOwp9Cgokc2NvcGUuZGVsZXRlRXZlbnQ9ZnVuY3Rpb24gKCkKewovLyBjaGVja2luZyBpZiBjYW5jZWxpbmcgYSBnZW5lcmNfdHlwZSBldmVudCAtIHRoZW4gdGhlcmUncyBubyB1c2VyCmlmICgkc2NvcGUuY3VycmVudEV2ZW50LmlzX2dlbmVyaWNfZXR5cGU9PTEpCnsKY2FuY2VsU2luZ2xlRXZlbnQoJGh0dHAsJHNjb3BlLDAsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLGNhbmNlbFNpbmdsZUV2ZW50X2NhbGxiYWNrLCBjYW5jZWxTaW5nbGVFdmVudF9jYWxsYmFjayk7Cn0KZWxzZQp7CmNhbmNlbFNpbmdsZUV2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50VXNlcnNbMF0uYnVzaW5lc3NfdXNlcl9pZCwkcm91dGVQYXJhbXMuZXZlbnRfaWQsY2FuY2VsU2luZ2xlRXZlbnRfY2FsbGJhY2ssIGNhbmNlbFNpbmdsZUV2ZW50X2NhbGxiYWNrKTsKfQpmdW5jdGlvbiBjYW5jZWxTaW5nbGVFdmVudF9jYWxsYmFjaygpCnsKZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLHNldFBhcnRpY2lwYXRlZCk7Cn0KfQoKJHNjb3BlLnNldFBhcnRpY2lwYXRpb25TdGF0dXMgPSBmdW5jdGlvbigpCnsKc2V0RXZlbnRVc2VyUGFydGljaXBhdGlvblN0YXR1cygkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRVc2Vyc1swXS5idXNpbmVzc191c2VyX2lkLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRVc2Vyc1swXS5ldmVudF91c2VyX3N0YXR1c19pZCxzZXRQYXJ0aWNpcGF0aW9uU3RhdHVzX2NhbGxiYWNrLCBzZXRQYXJ0aWNpcGF0aW9uU3RhdHVzX2NhbGxiYWNrKTsKJHNjb3BlLnVwZGF0ZVN0YXR1c0FsZXJ0TWVzc2FnZT0i157XoteT15vXnyDXodeY15jXldehLi4uIjsKZnVuY3Rpb24gc2V0UGFydGljaXBhdGlvblN0YXR1c19jYWxsYmFjaygpCnsKLy8gZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLHNldFBhcnRpY2lwYXRlZCk7CnNldFBhcnRpY2lwYXRlZCgpOwokc2NvcGUudXBkYXRlU3RhdHVzQWxlcnRNZXNzYWdlPSLXoteV15PXm9efINeR15TXptec15fXlCEiOwokdGltZW91dChmdW5jdGlvbigpCnsKJHNjb3BlLnVwZGF0ZVN0YXR1c0FsZXJ0TWVzc2FnZT1udWxsOwp9LCAyNTAwKTsKfQp9CgpmdW5jdGlvbiBzZXRQYXJ0aWNpcGF0ZWQoKQp7CmxvZ0RlYnVnKCJnZXQgY2xpZW50IGluZm8iKTsKZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Q2xpZW50cycsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudFVzZXJzWzBdLmJ1c2luZXNzX3VzZXJfaWQpOwpsb2dEZWJ1Zygic2V0dGluZyBzZXRQYXJ0aWNpcGF0ZWQiKTsKaWYgKCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRVc2Vyc1swXS5zdGF0dXNfbmFtZSE9JGdVc2VyX3N0YXR1c19hYnNlbnRlZCkKewokc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50VXNlcnNbMF0ucGFydGljaXBhdGVkPXRydWU7Cn0KZWxzZQp7CiRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRVc2Vyc1swXS5wYXJ0aWNpcGF0ZWQ9ZmFsc2U7Cn0KCi8vIHRoaXMgbG9vcCBpcyBmb3IgZml4aW5nIHRoZSBkYXRlIGZvcm1hdCB0byBhcHBlYXIgcHJvcGVybHkgaW4gdGhlIGlucHV0IGRhdGUgaHRtbCBvYmplY3QKZm9yIChpID0gMDsgaTwgKCRzY29wZS5jdXJyZW50RXZlbnQuZXh0cmFGaWVsZHMpLmxlbmd0aDsgaSsrKQp7CmxvZ0RlYnVnKCRzY29wZS5jdXJyZW50RXZlbnQuZXh0cmFGaWVsZHNbaV0pOwppZiAoJHNjb3BlLmN1cnJlbnRFdmVudC5leHRyYUZpZWxkc1tpXS5maWVsZF9kYXRhdHlwZT09IkRBVEUiKQp7Ci8vIGxvZ0RlYnVnKCJkYXRlIik7CiRzY29wZS5jdXJyZW50RXZlbnQuZXh0cmFGaWVsZHNbaV0uZmllbGRfdmFsdWU9bmV3IERhdGUoJHNjb3BlLmN1cnJlbnRFdmVudC5leHRyYUZpZWxkc1tpXS5maWVsZF92YWx1ZSk7Cn0KfQoKbG9nRGVidWcoIiRzY29wZS5jdXJyZW50RXZlbnQuaW5zdHJ1Y3Rvcl9pZDs9Iiskc2NvcGUuY3VycmVudEV2ZW50Lmluc3RydWN0b3JfaWQpOwpmb3IodmFyIGkgPSAwOyBpIDwgJHNjb3BlLmluc3RydWN0b3JzLmxlbmd0aDsgaSsrKQp7CmxvZ0RlYnVnKCRzY29wZS5pbnN0cnVjdG9yc1tpXS5pc19hY3RpdmUpOwppZiAoJHNjb3BlLmluc3RydWN0b3JzW2ldLmJ1c2luZXNzX3VzZXJfaWQ9PSRzY29wZS5jdXJyZW50RXZlbnQuaW5zdHJ1Y3Rvcl9pZCkKewpsb2dEZWJ1ZygieWVzaCIpOwokc2NvcGUuaW5zdHJ1Y3RvcnNbaV0uaXNfYWN0aXZlPTE7Cn0KfQp9Cgokc2NvcGUudXBkYXRlVXNlckV2ZW50UHJpY2UgPSBmdW5jdGlvbihuZXd2YWx1ZSwgdGhlZXZlbnQpCnsKbmV3X3ByaWNlPW5ld3ZhbHVlOwpzZXRDbGllbnRFdmVudFByaWNlKCRodHRwLCRzY29wZSwkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50VXNlcnNbMF0uYnVzaW5lc3NfdXNlcl9pZCx0aGVldmVudC5ldmVudF9pZCwgbmV3X3ByaWNlLHNldENsaWVudEV2ZW50UHJpY2VfY2FsbGJhY2ssIHNldENsaWVudEV2ZW50UHJpY2VfY2FsbGJhY2spOwpmdW5jdGlvbiBzZXRDbGllbnRFdmVudFByaWNlX2NhbGxiYWNrKCkKewpnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkcm91dGVQYXJhbXMuZXZlbnRfaWQsc2V0UGFydGljaXBhdGVkKTsKfQp9OwoKJHNjb3BlLiRvbigiZXZlbnRQYWdlUmVsb2FkRGF0YSIsZnVuY3Rpb24oZSxhKQp7CmdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCxzZXRQYXJ0aWNpcGF0ZWQpOwp9KTsKCgoKCiRzY29wZS5jbG9zZUV2ZW50ID0gZnVuY3Rpb24oKQp7CmxvZ0RlYnVnKCJjaGVja2luZyBpZiBldmVudCBoYXMgZXh0cmEgZmllbGRzIHRoYXQgYXJlIHJlcXVpcmVkIGJlZm9yZSBjbG9zaW5nIGl0Iik7CmNoZWNrRXZlbnRFeHRyYUZpZWxkcygkaHR0cCwkc2NvcGUsJ2NoZWNrRXZlbnRFeHRyYUZpZWxkcycsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLGNoZWNrRXZlbnRFeHRyYUZpZWxkc19zdWNjZXNzKTsKZnVuY3Rpb24gY2hlY2tFdmVudEV4dHJhRmllbGRzX3N1Y2Nlc3MoKQp7CmlmICgkc2NvcGUuY2hlY2tFdmVudEV4dHJhRmllbGRzPT10cnVlKQp7CmxvZ0RlYnVnKCJldmVudCBoYXMgYWxsIGV4dHJhIGZpZWxkcyBvaywgY2xvc2luZyBldmVudCIpOwovLyAkc2NvcGUuY3VycmVudEV2ZW50Lmlnbm9yZUV4dHJhRmllbGRzVmFsaWRhdGlvbj10cnVlOwpjbG9zZUV2ZW50KCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuZXZlbnRfaWQsJHNjb3BlLmN1cnJlbnRFdmVudCxhZnRlckNsb3NlRXZlbnQsYWZ0ZXJDbG9zZUV2ZW50KTsKZnVuY3Rpb24gYWZ0ZXJDbG9zZUV2ZW50KCkKewpnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkcm91dGVQYXJhbXMuZXZlbnRfaWQsc2V0UGFydGljaXBhdGVkKTsKfTsKfQplbHNlCnsKbG9nRGVidWcoImV2ZW50IGhhcyBleHRyYSBmaWVsZHMgcmVxdWlyZWQgdGhhdCBhcmUgbm90IGZpbGxlZCIpOwp2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKYW5pbWF0aW9uOiBmYWxzZSwKdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfZXZlbnRfY2xvc2VfaWdub3JlX21hbmRhdG9yeV9maWVsZHMucGhwJywKY29udHJvbGxlcjogJ2V2ZW50Q2xvc2VJZ25vcmVNYW5kYXRvcnlGaWVsZHNNb2RhbENvbnRyb2xsZXInLApzaXplOiAnbScsCnJlc29sdmU6IHsKY3VycmVudEV2ZW50OiBmdW5jdGlvbigpIHsKcmV0dXJuICRzY29wZS5jdXJyZW50RXZlbnQ7Cn0KfQp9KTsKfQp9Cn0KJHNjb3BlLnJlb3BlbkV2ZW50ID0gZnVuY3Rpb24oKQp7CmxvZ0RlYnVnKCJyZW9wZW5FdmVudCIpOwpyZW9wZW5FdmVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCwkc2NvcGUuY3VycmVudEV2ZW50LGFmdGVyUmVvcGVuRXZlbnQsYWZ0ZXJSZW9wZW5FdmVudCk7CmZ1bmN0aW9uIGFmdGVyUmVvcGVuRXZlbnQoKQp7CmdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQsc2V0UGFydGljaXBhdGVkKTsKfTsKfQoKfSk7CgprdXplQXBwLmZpbHRlcignc3RhcnRGcm9tJywgZnVuY3Rpb24oKQp7CnJldHVybiBmdW5jdGlvbihpbnB1dCwgc3RhcnQpCnsKaWYoIWlucHV0KSByZXR1cm4gW107Ci8vIGNvbnNvbGUubG9nKCJoZXJlcmVlZSAiK2lucHV0KTsKc3RhcnQgPSArc3RhcnQ7IC8vcGFyc2UgdG8gaW50CnJldHVybiBpbnB1dC5zbGljZShzdGFydCk7Cn0KfSk7Ci8vIGFuZ3VsYXIgZmlsdGVyIGZvciBldmVudHMgYmVmb3JlL2FmdGVyIHRvZGF5Cmt1emVBcHAuZmlsdGVyKCdiZWZvcmVOb3cnLCBmdW5jdGlvbigpIHsKLy8gQ3JlYXRlIHRoZSByZXR1cm4gZnVuY3Rpb24gYW5kIHNldCB0aGUgcmVxdWlyZWQgcGFyYW1ldGVyIG5hbWUgdG8gKippbnB1dCoqCnJldHVybiBmdW5jdGlvbihpbnB1dCkgewp2YXIgb3V0ID0gW107CgovLyBVc2luZyB0aGUgYW5ndWxhci5mb3JFYWNoIG1ldGhvZCwgZ28gdGhyb3VnaCB0aGUgYXJyYXkgb2YgZGF0YSBhbmQgcGVyZm9ybSB0aGUgb3BlcmF0aW9uIG9mIGZpZ3VyaW5nIG91dCBpZiB0aGUgbGFuZ3VhZ2UgaXMgc3RhdGljYWxseSBvciBkeW5hbWljYWxseSB0eXBlZC4KdmFyIGJyb3dzZXJfZXBvY2ggPSAobmV3IERhdGUpLmdldFRpbWUoKTsKCmFuZ3VsYXIuZm9yRWFjaChpbnB1dCwgZnVuY3Rpb24oZXZlbnQpCnsKLy8gIGxvZ0RlYnVnKCJmaWx0ZXJpbmcsIGV2ZW50LmV2ZW50X3VzZXJfc3RhdHVzX2lkPSIrZXZlbnQuZXZlbnRfdXNlcl9zdGF0dXNfaWQpOwppZiAoZXZlbnQuc3RhcnRfZXBvY2ggPD0gKGJyb3dzZXJfZXBvY2gvMTAwMCkpCnsKb3V0LnB1c2goZXZlbnQpCn0KfSkKcmV0dXJuIG91dDsKfQp9KTsKa3V6ZUFwcC5maWx0ZXIoJ2FmdGVyTm93JywgZnVuY3Rpb24oKSB7Ci8vIENyZWF0ZSB0aGUgcmV0dXJuIGZ1bmN0aW9uIGFuZCBzZXQgdGhlIHJlcXVpcmVkIHBhcmFtZXRlciBuYW1lIHRvICoqaW5wdXQqKgpyZXR1cm4gZnVuY3Rpb24oaW5wdXQpIHsKdmFyIG91dCA9IFtdOwoKLy8gVXNpbmcgdGhlIGFuZ3VsYXIuZm9yRWFjaCBtZXRob2QsIGdvIHRocm91Z2ggdGhlIGFycmF5IG9mIGRhdGEgYW5kIHBlcmZvcm0gdGhlIG9wZXJhdGlvbiBvZiBmaWd1cmluZyBvdXQgaWYgdGhlIGxhbmd1YWdlIGlzIHN0YXRpY2FsbHkgb3IgZHluYW1pY2FsbHkgdHlwZWQuCnZhciBicm93c2VyX2Vwb2NoID0gKG5ldyBEYXRlKS5nZXRUaW1lKCk7Cgphbmd1bGFyLmZvckVhY2goaW5wdXQsIGZ1bmN0aW9uKGV2ZW50KQp7Ci8vICBsb2dEZWJ1ZygiZmlsdGVyaW5nLCBldmVudC5ldmVudF91c2VyX3N0YXR1c19pZD0iK2V2ZW50LmV2ZW50X3VzZXJfc3RhdHVzX2lkKTsKaWYgKGV2ZW50LnN0YXJ0X2Vwb2NoID4gKGJyb3dzZXJfZXBvY2gvMTAwMCkpCnsKb3V0LnB1c2goZXZlbnQpCn0KfSkKcmV0dXJuIG91dDsKfQp9KTsKCmt1emVBcHAuZmlsdGVyKCdpc0FjdGl2ZScsIGZ1bmN0aW9uKCkgewovLyBDcmVhdGUgdGhlIHJldHVybiBmdW5jdGlvbiBhbmQgc2V0IHRoZSByZXF1aXJlZCBwYXJhbWV0ZXIgbmFtZSB0byAqKmlucHV0KioKcmV0dXJuIGZ1bmN0aW9uKGlucHV0KSB7CnZhciBvdXQgPSBbXTsKCi8vIFVzaW5nIHRoZSBhbmd1bGFyLmZvckVhY2ggbWV0aG9kLCBnbyB0aHJvdWdoIHRoZSBhcnJheSBvZiBkYXRhIGFuZCBwZXJmb3JtIHRoZSBvcGVyYXRpb24gb2YgZmlndXJpbmcgb3V0IGlmIHRoZSBsYW5ndWFnZSBpcyBzdGF0aWNhbGx5IG9yIGR5bmFtaWNhbGx5IHR5cGVkLgoKYW5ndWxhci5mb3JFYWNoKGlucHV0LCBmdW5jdGlvbihldmVudCkKewovLyAgbG9nRGVidWcoImZpbHRlcmluZywgZXZlbnQuZXZlbnRfdXNlcl9zdGF0dXNfaWQ9IitldmVudC5ldmVudF91c2VyX3N0YXR1c19pZCk7CmlmIChldmVudC5pc19hY3RpdmU9PTEpCnsKb3V0LnB1c2goZXZlbnQpCn0KfSkKcmV0dXJuIG91dDsKfQp9KTsKCmt1emVBcHAuZmlsdGVyKCdzaG91bGRfYmVfZGlzcGxheWVkJywgZnVuY3Rpb24oKSB7Ci8vIENyZWF0ZSB0aGUgcmV0dXJuIGZ1bmN0aW9uIGFuZCBzZXQgdGhlIHJlcXVpcmVkIHBhcmFtZXRlciBuYW1lIHRvICoqaW5wdXQqKgpyZXR1cm4gZnVuY3Rpb24oaW5wdXQpIHsKdmFyIG91dCA9IFtdOwoKLy8gVXNpbmcgdGhlIGFuZ3VsYXIuZm9yRWFjaCBtZXRob2QsIGdvIHRocm91Z2ggdGhlIGFycmF5IG9mIGRhdGEgYW5kIHBlcmZvcm0gdGhlIG9wZXJhdGlvbiBvZiBmaWd1cmluZyBvdXQgaWYgdGhlIGxhbmd1YWdlIGlzIHN0YXRpY2FsbHkgb3IgZHluYW1pY2FsbHkgdHlwZWQuCgphbmd1bGFyLmZvckVhY2goaW5wdXQsIGZ1bmN0aW9uKGV2ZW50KQp7Ci8vICBsb2dEZWJ1ZygiZmlsdGVyaW5nLCBldmVudC5ldmVudF91c2VyX3N0YXR1c19pZD0iK2V2ZW50LmV2ZW50X3VzZXJfc3RhdHVzX2lkKTsKaWYgKGV2ZW50LnNob3VsZF9iZV9kaXNwbGF5ZWQ9PTEpCnsKb3V0LnB1c2goZXZlbnQpCn0KfSkKcmV0dXJuIG91dDsKfQp9KTsKCmt1emVBcHAuY29udHJvbGxlcignSW5zdHJ1Y3RvclNob3cxQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHRpbWVvdXQsICRodHRwLCBzaGFyZWRQcm9wZXJ0aWVzLCAkcm9vdFNjb3BlLCAkcm91dGVQYXJhbXMsICRsb2NhdGlvbiwgJHJvdXRlLCBzaGFyZWREYXRhLCAkdWliTW9kYWwpCnsKZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLGdldEJ1c2luZXNzQ2xpZW50SW5mb19zdWNjZXNzKTsKICBnZXRzZWN1cml0eVByb2ZpbGVzKCRodHRwLCRzY29wZSwnc2VjX3Byb2ZpbGVzJyk7CgpmdW5jdGlvbiBnZXRCdXNpbmVzc0NsaWVudEluZm9fc3VjY2VzcygpCnsKZ2V0Q2xpZW50RXh0cmFGaWVsZHMoJGh0dHAsJHNjb3BlLCRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5idXNpbmVzc191c2VyX2lkLCdjbGllbnRFeHRyYUZpZWxkcycsZ2V0Q2xpZW50RXh0cmFGaWVsZHNfc3VjY2Vzcyk7CgpmdW5jdGlvbiBnZXRDbGllbnRFeHRyYUZpZWxkc19zdWNjZXNzKCkKewpmb3IgKGkgPSAwOyBpPCAoJHNjb3BlLmNsaWVudEV4dHJhRmllbGRzKS5sZW5ndGg7IGkrKykKewpsb2dEZWJ1Zygkc2NvcGUuY2xpZW50RXh0cmFGaWVsZHNbaV0pOwppZiAoJHNjb3BlLmNsaWVudEV4dHJhRmllbGRzW2ldLmZpZWxkX2RhdGF0eXBlPT0iREFURSIpCnsKLy8gbG9nRGVidWcoImRhdGUiKTsKJHNjb3BlLmNsaWVudEV4dHJhRmllbGRzW2ldLmZpZWxkX3ZhbHVlPW5ldyBEYXRlKCRzY29wZS5jbGllbnRFeHRyYUZpZWxkc1tpXS5maWVsZF92YWx1ZSk7Cn0KfQp9Cn0KCiAgJHNjb3BlLnVwZGF0ZV9zZWNfcHJvZmlsZSA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1ZygidXBkYXRlX3NlY19wcm9maWxlIGZvciBidWlkPSIrJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLmJ1c2luZXNzX3VzZXJfaWQrICIsIHByb2ZpbGVfaWQiKyRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5zZWNfcHJvZmlsZV9pZCk7CiAgICB1cGRhdGVfc2VjX3Byb2ZpbGUoJGh0dHAsJHNjb3BlLCRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5idXNpbmVzc191c2VyX2lkLCRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5zZWNfcHJvZmlsZV9pZCx1cGRhdGVfc2VjX3Byb2ZpbGVfc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiB1cGRhdGVfc2VjX3Byb2ZpbGVfc3VjY2VzcygpCiAgICB7CiAgICAgIGdldHNlY3VyaXR5UHJvZmlsZXMoJGh0dHAsJHNjb3BlLCdzZWNfcHJvZmlsZXMnKTsKICAgIH0KICB9CiRzY29wZS5hcmNoaXZlQ2xpZW50TW9kYWwgPSBmdW5jdGlvbigpCnsKLy8gYXJjaGl2ZS9kZWxldGUgY2xpZW50IC0gYXNrIGlmIHN1cmUKdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CmFuaW1hdGlvbjogZmFsc2UsCnRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2FyY2hpdmVfY2xpZW50X21vZGFsLnBocCcsCnNpemU6ICd4cycsCmNvbnRyb2xsZXI6ICdhcmNoaXZlX2NsaWVudF9tb2RhbCcsICAvLyAncGF5bWVueURldGFpbHNNb2RhbENvbnRyb2xsZXInLApyZXNvbHZlOiB7CmJ1c2luZXNzX3VzZXJfaWQ6IGZ1bmN0aW9uKCkgewpyZXR1cm4gJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLmJ1c2luZXNzX3VzZXJfaWQ7Cn0sCmJ1c2VyX2xhc3RfbmFtZTogZnVuY3Rpb24oKSB7CnJldHVybiAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYnVzZXJfbGFzdF9uYW1lOwp9LApidXNlcl9maXJzdF9uYW1lOiBmdW5jdGlvbigpIHsKcmV0dXJuICRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5idXNlcl9maXJzdF9uYW1lOwp9LAppc19pbnN0cnVjdG9yOiBmdW5jdGlvbigpIHsKcmV0dXJuIHRydWU7Cn0KfQp9KTsKfQoKJHNjb3BlLnVwZGF0ZVVzZXJGaXJzdE5hbWUgPSBmdW5jdGlvbihuZXdWYWx1ZSkKewpzZXRDbGllbnRGaXJzdE5hbWUoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLG5ld1ZhbHVlLGFmdGVyQ2xpZW50U2V0LGFmdGVyQ2xpZW50U2V0KTsKZnVuY3Rpb24gYWZ0ZXJDbGllbnRTZXQoKQp7CmdldEJ1c2luZXNzQ2xpZW50SW5mbygkaHR0cCwkc2NvcGUsJ2Zvcm1VcGRhdGVDbGllbnRBbmd1bGFyJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7Cn0KfQokc2NvcGUudXBkYXRlVXNlckxhc3ROYW1lID0gZnVuY3Rpb24obmV3VmFsdWUpCnsKc2V0Q2xpZW50TGFzdE5hbWUoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLG5ld1ZhbHVlLGFmdGVyQ2xpZW50U2V0LGFmdGVyQ2xpZW50U2V0KTsKZnVuY3Rpb24gYWZ0ZXJDbGllbnRTZXQoKQp7CmdldEJ1c2luZXNzQ2xpZW50SW5mbygkaHR0cCwkc2NvcGUsJ2Zvcm1VcGRhdGVDbGllbnRBbmd1bGFyJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7Cn0KfQokc2NvcGUudXBkYXRlVXNlclBob25lTnVtYmVyID0gZnVuY3Rpb24obmV3VmFsdWUpCnsKbmV3VmFsdWUgPSBuZXdWYWx1ZS5yZXBsYWNlKCctJywnJyk7CmlmIChpc05hTihuZXdWYWx1ZSkpCnsKYWxlcnQoIteQ16DXkCDXlNeW158g157Xodek16gg15jXnNek15XXnyDXqten15nXnyIpOwpnZXRCdXNpbmVzc0NsaWVudEluZm8oJGh0dHAsJHNjb3BlLCdmb3JtVXBkYXRlQ2xpZW50QW5ndWxhcicsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwp9CmVsc2UKewpzZXRDbGllbnRQaG9uZU51bWJlcigkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsbmV3VmFsdWUsc2V0Q2xpZW50UGhvbmVOdW1iZXJfY2FsbGJhY2ssc2V0Q2xpZW50UGhvbmVOdW1iZXJfY2FsbGJhY2spOwpmdW5jdGlvbiBzZXRDbGllbnRQaG9uZU51bWJlcl9jYWxsYmFjaygpCnsKZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKfQp9Cn0KCn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignQ2xpZW50c1Nob3cxQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHRpbWVvdXQsICRodHRwLCBzaGFyZWRQcm9wZXJ0aWVzLCAkcm9vdFNjb3BlLCAkcm91dGVQYXJhbXMsICRsb2NhdGlvbiwgJHJvdXRlLCBzaGFyZWREYXRhLCAkdWliTW9kYWwpCnsKZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLGdldEJ1c2luZXNzQ2xpZW50SW5mb19zdWNjZXNzKTsKCmZ1bmN0aW9uIGdldEJ1c2luZXNzQ2xpZW50SW5mb19zdWNjZXNzKCkKewpnZXRDbGllbnRFeHRyYUZpZWxkcygkaHR0cCwkc2NvcGUsJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLmJ1c2luZXNzX3VzZXJfaWQsJ2NsaWVudEV4dHJhRmllbGRzJyxnZXRDbGllbnRFeHRyYUZpZWxkc19zdWNjZXNzKTsKCmZ1bmN0aW9uIGdldENsaWVudEV4dHJhRmllbGRzX3N1Y2Nlc3MoKQp7CmZvciAoaSA9IDA7IGk8ICgkc2NvcGUuY2xpZW50RXh0cmFGaWVsZHMpLmxlbmd0aDsgaSsrKQp7CmxvZ0RlYnVnKCRzY29wZS5jbGllbnRFeHRyYUZpZWxkc1tpXSk7CmlmICgkc2NvcGUuY2xpZW50RXh0cmFGaWVsZHNbaV0uZmllbGRfZGF0YXR5cGU9PSJEQVRFIikKewovLyBsb2dEZWJ1ZygiZGF0ZSIpOwokc2NvcGUuY2xpZW50RXh0cmFGaWVsZHNbaV0uZmllbGRfdmFsdWU9bmV3IERhdGUoJHNjb3BlLmNsaWVudEV4dHJhRmllbGRzW2ldLmZpZWxkX3ZhbHVlKTsKfQp9Cn0KfQp7CmdldENsaWVudEV2ZW50cygkaHR0cCwkc2NvcGUsJ2N1cnJlbnRDbGllbnRFdmVudHMnLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKCmdldENsaWVudFBheW1lbnRzKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCwnY3VycmVudENsaWVudFBheW1lbnRzJyk7Cgokc2NvcGUuYXJjaGl2ZUNsaWVudE1vZGFsID0gZnVuY3Rpb24oKQp7Ci8vIGFyY2hpdmUvZGVsZXRlIGNsaWVudCAtIGFzayBpZiBzdXJlCnZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewphbmltYXRpb246IGZhbHNlLAp0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdhcmNoaXZlX2NsaWVudF9tb2RhbC5waHAnLApzaXplOiAneHMnLApjb250cm9sbGVyOiAnYXJjaGl2ZV9jbGllbnRfbW9kYWwnLCAgLy8gJ3BheW1lbnlEZXRhaWxzTW9kYWxDb250cm9sbGVyJywKcmVzb2x2ZTogewpidXNpbmVzc191c2VyX2lkOiBmdW5jdGlvbigpIHsKcmV0dXJuICRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5idXNpbmVzc191c2VyX2lkOwp9LApidXNlcl9sYXN0X25hbWU6IGZ1bmN0aW9uKCkgewpyZXR1cm4gJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLmJ1c2VyX2xhc3RfbmFtZTsKfSwKYnVzZXJfZmlyc3RfbmFtZTogZnVuY3Rpb24oKSB7CnJldHVybiAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYnVzZXJfZmlyc3RfbmFtZTsKfSwKaXNfaW5zdHJ1Y3RvcjogZnVuY3Rpb24oKSB7CnJldHVybiBmYWxzZTsKfQp9Cn0pOwp9CiRzY29wZS5wYWNrYWdlRGVsZXRlID0gZnVuY3Rpb24ocGFja2FnZSkKewpsb2dEZWJ1ZygicGFja2FnZSBkZWxldGUgIitKU09OLnN0cmluZ2lmeShwYWNrYWdlKSk7CmRlbGV0ZVBhY2thZ2UoJGh0dHAsJHNjb3BlLHBhY2thZ2UucGFja2FnZV91c2VyX2lkLCRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5idXNpbmVzc191c2VyX2lkLHN1Y2Nlc3NfY2FsbGJhY2ssIHN1Y2Nlc3NfY2FsbGJhY2spOwpmdW5jdGlvbiBzdWNjZXNzX2NhbGxiYWNrKCkKewokcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NsaWVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCn0KfQoKJHNjb3BlLnVwZGF0ZUNsaWVudEV4dHJhRmllbGRzID0gZnVuY3Rpb24oKQp7CiAgICAgIGxvZ0RlYnVnKCJ1cGRhdGVDbGllbnRFeHRyYUZpZWxkcyIpOwp0aGVkYXRhID0gewpleHRyYUZpZWxkczokc2NvcGUuY2xpZW50RXh0cmFGaWVsZHMKfTsKICAgICAgJHNjb3BlLmV4dHJhRmllbGRzQWxlcnRNZXNzYWdlPSLXqdeV157XqC4uLiI7CiAgICAgIHVwZGF0ZUNsaWVudEV4dHJhRmllbGRzKCRodHRwLCRzY29wZSwkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYnVzaW5lc3NfdXNlcl9pZCx0aGVkYXRhLHVwZGF0ZUV2ZW50Q2xpZW50RmllbGRzX2NhbGxiYWNrLCB1cGRhdGVFdmVudENsaWVudEZpZWxkc19jYWxsYmFjayk7CgogICAgICBmdW5jdGlvbiB1cGRhdGVFdmVudENsaWVudEZpZWxkc19jYWxsYmFjaygpCnsKLy8gZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLHNldFBhcnRpY2lwYXRlZCk7CiAgICAgICAgJHNjb3BlLmV4dHJhRmllbGRzQWxlcnRNZXNzYWdlPSLXoNep157XqCEiOwokdGltZW91dChmdW5jdGlvbigpCnsKJHNjb3BlLmV4dHJhRmllbGRzQWxlcnRNZXNzYWdlPW51bGw7Cn0sIDMwMDApOwp9Cn07Cgokc2NvcGUuc2NoZWR1bGVFdmVudEZvckNsaWVudCA9IGZ1bmN0aW9uKCkKewpsb2dEZWJ1Zygic2VldGluZyBzaGFyZSBwcm9wZXJ0eSB1c2VyX2lkICIrJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdKTsKc2hhcmVkUHJvcGVydGllcy5zZXRfc2VsZWN0ZWRfdXNlcigkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0pOwokbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2NhbGVuZGFyJyk7Cn0KJHNjb3BlLmludm9pY2VHZW5lcmF0ZUNoZWNrYm94ID0gZnVuY3Rpb24oZnBheW1lbnQpCnsKbG9nRGVidWcoImludm9pY2VHZW5lcmF0ZUNoZWNrYm94IGZvciAiK0pTT04uc3RyaW5naWZ5KGZwYXltZW50KSk7CnNldENsaWVudFBheW1lbnRJbnZvaWNlR2VuZXJhdGVkKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCxmcGF5bWVudC51c2VyX3BheW1lbnRfaWQsZnBheW1lbnQuaW52b2ljZV9nZW5lcmF0ZWQsc2V0Q2xpZW50UGF5bWVudEludm9pY2VHZW5lcmF0ZWRfY2FsbGJhY2ssIHNldENsaWVudFBheW1lbnRJbnZvaWNlR2VuZXJhdGVkX2NhbGxiYWNrKTsKZnVuY3Rpb24gc2V0Q2xpZW50UGF5bWVudEludm9pY2VHZW5lcmF0ZWRfY2FsbGJhY2soKQp7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKfQp9OwoKJHNjb3BlLnJlY2FsY1VzZXJCYWxhbmNlID0gZnVuY3Rpb24oKQp7CmxvZ0RlYnVnKCJyZWNhbGNVc2VyQmFsYW5jZSIpOwpyZWNhbGNVc2VyQmFsYW5jZSgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsIHJlY2FsY1VzZXJCYWxhbmNlX2NhbGxiYWNrKTsKZnVuY3Rpb24gcmVjYWxjVXNlckJhbGFuY2VfY2FsbGJhY2soKQp7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKfSAgICB9CiRzY29wZS51cGRhdGVFdmVudFBhY2thZ2VSZWZlcmVuY2UgPSBmdW5jdGlvbih1c2VyX2lkLCBmbWVldGluZykKewpsb2dEZWJ1ZygidXBkYXRlRXZlbnRQYWNrYWdlUmVmZXJlbmNlLCB1c2VyPSIrdXNlcl9pZCsiLCBmbWVldGluZz0iK0pTT04uc3RyaW5naWZ5KGZtZWV0aW5nKSk7CnZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewphbmltYXRpb246IGZhbHNlLAp0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9jbGllbnRfZXZlbnRfcGFja2FnZV9hc3NvY2lhdGlvbi5waHAnLApzaXplOiAneHMnLApjb250cm9sbGVyOiAnZXZlbnRQYWNrYWdlQXNzb2NpYXRpb25Nb2RhbENvbnRyb2xsZXInLCAgLy8gJ3BheW1lbnlEZXRhaWxzTW9kYWxDb250cm9sbGVyJywKcmVzb2x2ZTogewpmbWVldGluZzogZnVuY3Rpb24oKSB7CnJldHVybiBmbWVldGluZzsKfSwKYmFsYW5jZTogZnVuY3Rpb24oKSB7CnJldHVybiAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYmFsYW5jZTsKfSwKYnVzaW5lc3NfdXNlcl9pZDogZnVuY3Rpb24oKSB7CnJldHVybiAkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZDsKfQp9Cn0pOwp9OwoKJHNjb3BlLnVwZGF0ZVBhY2thZ2VQYXltZW50UmVmZXJlbmNlID0gZnVuY3Rpb24odXNlcl9pZCwgZnBhY2thZ2UpCnsKbG9nRGVidWcoInVwZGF0ZVBhY2thZ2VQYXltZW50UmVmZXJlbmNlLCB1c2VyPSIrdXNlcl9pZCsiLCBmcGFja2FnZT0iK0pTT04uc3RyaW5naWZ5KGZwYWNrYWdlKSk7CnZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewphbmltYXRpb246IGZhbHNlLAp0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9jbGllbnRfcGFja2FnZV9wYXltZW50X2Fzc29jaWF0aW9uLnBocCcsCnNpemU6ICd4cycsCmNvbnRyb2xsZXI6ICdwYWNrYWdlUGF5bWVudEFzc29jaWF0aW9uTW9kYWxDb250cm9sbGVyJywgIC8vICdwYXltZW55RGV0YWlsc01vZGFsQ29udHJvbGxlcicsCnJlc29sdmU6IHsKZnBhY2thZ2U6IGZ1bmN0aW9uKCkgewpyZXR1cm4gZnBhY2thZ2U7Cn0sCmJhbGFuY2U6IGZ1bmN0aW9uKCkgewpyZXR1cm4gJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLmJhbGFuY2U7Cn0sCmJ1c2luZXNzX3VzZXJfaWQ6IGZ1bmN0aW9uKCkgewpyZXR1cm4gJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQ7Cn0KfQp9KTsKfTsKCi8vIHNob3cgcGF5bWVudCBwb3B1cAokc2NvcGUuc2hvd1BheW1lbnREZXRhaWxzID0gZnVuY3Rpb24oZnBheW1lbnQpCnsKbG9nRGVidWcoInNob3dQYXltZW50RGV0YWlscyIpOwp2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKYW5pbWF0aW9uOiBmYWxzZSwKdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfY2xpZW50X3BheW1lbnRfZGV0YWlscy5waHAnLApzaXplOiAneHMnLApjb250cm9sbGVyOiAncGF5bWVueURldGFpbHNNb2RhbENvbnRyb2xsZXInLApyZXNvbHZlOiB7CmZwYXltZW50OiBmdW5jdGlvbigpIHsKcmV0dXJuIGZwYXltZW50Owp9Cn0KfSk7Cn0KJHNjb3BlLmludm9pY2VOdW1iZXJDaGFuZ2VkID0gZnVuY3Rpb24obmV3X2ludm9pY2VfbnVtYmVyLGZwYXltZW50KQp7CmxvZ0RlYnVnKCJpbnZvaWNlTnVtYmVyQ2hhbmdlZCAiKyBuZXdfaW52b2ljZV9udW1iZXIgKyJmb3IgIitKU09OLnN0cmluZ2lmeShmcGF5bWVudCkpOwpzZXRDbGllbnRQYXltZW50SW52b2ljZU51bWJlcigkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsZnBheW1lbnQudXNlcl9wYXltZW50X2lkLG5ld19pbnZvaWNlX251bWJlcixzZXRDbGllbnRQYXltZW50SW52b2ljZU51bWJlcl9jYWxsYmFjaywgc2V0Q2xpZW50UGF5bWVudEludm9pY2VOdW1iZXJfY2FsbGJhY2spOwpmdW5jdGlvbiBzZXRDbGllbnRQYXltZW50SW52b2ljZU51bWJlcl9jYWxsYmFjaygpCnsKLy8gJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwp9Cn07Cgokc2NvcGUuJG9uKCJjbGllbnRQYWdlUmVsb2FkRGF0YSIsZnVuY3Rpb24oZSxhKQp7CmxvZ0RlYnVnKCJjbGllbnRQYWdlUmVsb2FkRGF0YSIpOwpnZXRCdXNpbmVzc1VzZXJQYWNrYWdlcygkaHR0cCwkc2NvcGUsJ3VzZXJfcGFja2FnZXMnLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKZ2V0Q2xpZW50UGF5bWVudHMoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLCdjdXJyZW50Q2xpZW50UGF5bWVudHMnKTsKZ2V0Q2xpZW50RXZlbnRzKCRodHRwLCRzY29wZSwnY3VycmVudENsaWVudEV2ZW50cycsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwpnZXRCdXNpbmVzc0NsaWVudEluZm8oJGh0dHAsJHNjb3BlLCdmb3JtVXBkYXRlQ2xpZW50QW5ndWxhcicsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwoKICAgICAgLy8gJHRpbWVvdXQoZnVuY3Rpb24oKQogICAgICAvLyB7CiAgICAgIC8vICAgJHNjb3BlLmN1cnNvcmRlbGV0ZT0iIjsKICAgICAgLy8gICBkb2N1bWVudC5ib2R5LnN0eWxlLmN1cnNvcj0nJzsKICAgICAgLy8gfSwgMjAwMCk7Cgp9KTsKCiRzY29wZS5pc0NvbmZpcm1lZE9yQ2xvc2VkID0gZnVuY3Rpb24oZXZlbnQpCnsKaWYgKCRzY29wZS5zaG93QWxsRXZlbnRzKQp7CnJldHVybiB0cnVlOwp9CgppZiAoKGV2ZW50LmlzX2NvbmZpcm1lZCA9PSAxKSB8fCAoZXZlbnQuaXNfZmluYWxfc3RhdHVzID09IDEpIHx8ICgoZXZlbnQuaXNfd2FpdGluZ19saXN0ID09IDEpICYmIChldmVudC5pc19jYW5jZWxlZCA9PSAwKSkpCnsKcmV0dXJuIHRydWU7Cn0KZWxzZQp7CnJldHVybiBmYWxzZTsKfQp9CiRzY29wZS5nb3RvQ2xpZW50RWRpdFBhZ2U9Z290b0NsaWVudEVkaXRQYWdlOwokc2NvcGUuZ290b0JhY2s9ZnVuY3Rpb24oKQp7CmxvZ0RlYnVnKCdnbyBiYWNrJyk7CndpbmRvdy5oaXN0b3J5LmJhY2soKTsKfTsKCiRzY29wZS5nb3RvRXZlbnRQYWdlID0gZnVuY3Rpb24gKHRoZWV2ZW50KQp7CmdvdG9FdmVudFBhZ2UodGhlZXZlbnQpOwp9Cn0KJHNjb3BlLmluaXRpYXRlUGF5bWVudCA9IGZ1bmN0aW9uKGlzcGx1cykKewpsb2dEZWJ1ZygiaW5pdGlhdGVQYXltZW50IGlzcGx1cyIraXNwbHVzKTsKdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CmFuaW1hdGlvbjogZmFsc2UsCnRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2NsaWVudF9wYXltZW50LnBocCcsCmNvbnRyb2xsZXI6ICdidXNpbmVzc0NsaWVuZENhcmRQYXltZW50JywKLy8gc2l6ZTogc2l6ZSwKcmVzb2x2ZTogewpjdXJyZW50Q2xpZW50OiBmdW5jdGlvbigpIHsKcmV0dXJuICRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXTsKfSwKaXNwbHVzOiBmdW5jdGlvbigpIHsKcmV0dXJuIGlzcGx1czsKfQp9Cn0pOwp9Cgokc2NvcGUudXBkYXRlVXNlckZpcnN0TmFtZSA9IGZ1bmN0aW9uKG5ld1ZhbHVlKQp7CnNldENsaWVudEZpcnN0TmFtZSgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsbmV3VmFsdWUsYWZ0ZXJDbGllbnRTZXQsYWZ0ZXJDbGllbnRTZXQpOwpmdW5jdGlvbiBhZnRlckNsaWVudFNldCgpCnsKZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKfQp9CiRzY29wZS51cGRhdGVVc2VyTGFzdE5hbWUgPSBmdW5jdGlvbihuZXdWYWx1ZSkKewpzZXRDbGllbnRMYXN0TmFtZSgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsbmV3VmFsdWUsYWZ0ZXJDbGllbnRTZXQsYWZ0ZXJDbGllbnRTZXQpOwpmdW5jdGlvbiBhZnRlckNsaWVudFNldCgpCnsKZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKfQp9CiRzY29wZS51cGRhdGVVc2VyRW1haWwgPSBmdW5jdGlvbihuZXdWYWx1ZSkKewpzZXRDbGllbnRFbWFpbCgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsbmV3VmFsdWUsYWZ0ZXJzZXRDbGllbnRFbWFpbCxhZnRlcnNldENsaWVudEVtYWlsKTsKZnVuY3Rpb24gYWZ0ZXJzZXRDbGllbnRFbWFpbCgpCnsKZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKfQp9CgoKJHNjb3BlLnVwZGF0ZVVzZXJQaG9uZU51bWJlciA9IGZ1bmN0aW9uKG5ld1ZhbHVlKQp7Cm5ld1ZhbHVlID0gbmV3VmFsdWUucmVwbGFjZSgnLScsJycpOwppZiAoaXNOYU4obmV3VmFsdWUpKQp7CmFsZXJ0KCLXkNeg15Ag15TXltefINee16HXpNeoINeY15zXpNeV158g16rXp9eZ158iKTsKZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKfQplbHNlCnsKc2V0Q2xpZW50UGhvbmVOdW1iZXIoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLG5ld1ZhbHVlLHNldENsaWVudFBob25lTnVtYmVyX2NhbGxiYWNrLHNldENsaWVudFBob25lTnVtYmVyX2NhbGxiYWNrKTsKZnVuY3Rpb24gc2V0Q2xpZW50UGhvbmVOdW1iZXJfY2FsbGJhY2soKQp7CmdldEJ1c2luZXNzQ2xpZW50SW5mbygkaHR0cCwkc2NvcGUsJ2Zvcm1VcGRhdGVDbGllbnRBbmd1bGFyJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7Cn0KfQp9CiRzY29wZS51cGRhdGVVc2VyRXZlbnRQcmljZSA9IGZ1bmN0aW9uKG5ld3ZhbHVlLCB0aGVldmVudCkKewpuZXdfcHJpY2U9bmV3dmFsdWU7CnNldENsaWVudEV2ZW50UHJpY2UoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLHRoZWV2ZW50LmV2ZW50X2lkLCBuZXdfcHJpY2Usc2V0Q2xpZW50RXZlbnRQcmljZV9jYWxsYmFjaywgc2V0Q2xpZW50RXZlbnRQcmljZV9jYWxsYmFjayk7CmZ1bmN0aW9uIHNldENsaWVudEV2ZW50UHJpY2VfY2FsbGJhY2soKQp7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKfQp9OwoKJHNjb3BlLnVwZGF0ZVVzZXJQYWNrYWdlRXZlbnRzQ291bnRlciA9IGZ1bmN0aW9uKG5ld3ZhbHVlLCB0aGVwYWNrYWdlKQp7CmV2ZW50c19jb3VudGVyPW5ld3ZhbHVlOwpzZXRVc2VyUGFja2FnZUV2ZW50c0NvdW50ZXIoJGh0dHAsJHNjb3BlLHRoZXBhY2thZ2UucGFja2FnZV91c2VyX2lkLGV2ZW50c19jb3VudGVyLHNldFVzZXJQYWNrYWdlRXZlbnRzQ291bnRlcl9jYWxsYmFjaywgc2V0VXNlclBhY2thZ2VFdmVudHNDb3VudGVyX2NhbGxiYWNrKQpmdW5jdGlvbiBzZXRVc2VyUGFja2FnZUV2ZW50c0NvdW50ZXJfY2FsbGJhY2soKQp7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKfQp9Owokc2NvcGUudXBkYXRlVXNlclBhY2thZ2VQYWNrYWdlUHJpY2UgPSBmdW5jdGlvbihuZXd2YWx1ZSwgdGhlcGFja2FnZSkKewpwYWNrYWdlX3ByaWNlPW5ld3ZhbHVlOwpzZXRVc2VyUGFja2FnZVBhY2thZ2VQcmljZSgkaHR0cCwkc2NvcGUsdGhlcGFja2FnZS5wYWNrYWdlX3VzZXJfaWQscGFja2FnZV9wcmljZSxzZXRVc2VyUGFja2FnZVBhY2thZ2VQcmljZV9jYWxsYmFjaywgc2V0VXNlclBhY2thZ2VQYWNrYWdlUHJpY2VfY2FsbGJhY2spCmZ1bmN0aW9uIHNldFVzZXJQYWNrYWdlUGFja2FnZVByaWNlX2NhbGxiYWNrKCkKewovLyBnZXRCdXNpbmVzc1VzZXJQYWNrYWdlcygkaHR0cCwkc2NvcGUsJ3VzZXJfcGFja2FnZXMnLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwp9Cn07Cgokc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXIgPSB7fTsKbG9nRGVidWcoJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwokc2NvcGUuc2hvd19jbGllbnRfdXBkYXRlX2NsaWVudCA9IHRydWU7CiRzY29wZS5zaG93X2NsaWVudF91cGRhdGVfc2F2ZSA9IGZhbHNlOwokc2NvcGUuc2hvd19jbGllbnRfZGVsZXRlX2NsaWVudCA9IHRydWU7CiRzY29wZS5zaG93X2NsaWVudF91cGRhdGVfY2FuY2VsID0gZmFsc2U7Cgokc2NvcGUudXBkYXRlQ2xpZW50RW5hYmxlID0gZnVuY3Rpb24oKSB7CmxvZ0RlYnVnKCJlbmFibGluZyBlZGl0aW5nICgkc2NvcGUuY2xpZW50c1VwZGF0ZURpc2FibGVkIHdhcyAiICsgJHNjb3BlLmNsaWVudHNVcGRhdGVEaXNhYmxlZCArICIpIik7CiRzY29wZS5jbGllbnRzVXBkYXRlRGlzYWJsZWQgPSBmYWxzZTsKJHNjb3BlLnNob3dfY2xpZW50X3VwZGF0ZV9jbGllbnQgPSBmYWxzZTsKJHNjb3BlLnNob3dfY2xpZW50X3VwZGF0ZV9zYXZlID0gdHJ1ZTsKJHNjb3BlLnNob3dfY2xpZW50X2RlbGV0ZV9jbGllbnQgPSBmYWxzZTsKJHNjb3BlLnNob3dfY2xpZW50X3VwZGF0ZV9jYW5jZWwgPSB0cnVlOwp9CiRzY29wZS51cGRhdGVDbGllbnREaXNhYmxlID0gZnVuY3Rpb24oKSB7CmxvZ0RlYnVnKCJkaXNhYmxlIGVkaXRpbmciKTsKLy8JCSRsb2NhdGlvbi5wYXRoKCcvQ2xpZW50cy8nKyRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKJHJvdXRlLnJlbG9hZCgpOwp9CiRzY29wZS5zY2hlZHVsZUV2ZW50RnJvbUVuZFVzZXIgPSBmdW5jdGlvbigpIHsKc2hhcmVkRGF0YS5zZXRTZWxlY3RlZEVuZFVzZXIoewppZDogJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsCmZpcnN0X25hbWU6ICRzY29wZS5jdXJyZW50Q2xpZW50LnVzZXJzWzBdLmZpcnN0X25hbWUsCmxhc3RfbmFtZTogJHNjb3BlLmN1cnJlbnRDbGllbnQudXNlcnNbMF0ubGFzdF9uYW1lCn0pOwpsb2dEZWJ1Zygic2NoZWR1bGUgZXZlbnQgZm9yIHVzZXIgIiArICRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKLy8JCSRsb2NhdGlvbi5wYXRoKCcvQ2xpZW50cy8nKyRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jYWxlbmRhcicpOwp9CgogICAgJHNjb3BlLnVzZXJEZWxldGVQYXltZW50ID0gZnVuY3Rpb24gKGZwYXltZW50KQogICAgewogICAgICAvLyAkc2NvcGUuY3Vyc29yZGVsZXRlPSJ3YWl0IjsKICAgICAgbG9nRGVidWcoInVzZXJEZWxldGVQYXltZW50Iik7CiAgICAgIC8vIGRvY3VtZW50LmJvZHkuc3R5bGUuY3Vyc29yPSd3YWl0JzsKCiAgICAgIGRlbGV0ZUNsaWVudFBheW1lbnRzKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCxmcGF5bWVudC51c2VyX3BheW1lbnRfaWQsZGVsZXRlQ2xpZW50UGF5bWVudHNfc3VjY2Vzc19jYWxsYmFjayk7CiAgICAgIGZ1bmN0aW9uIGRlbGV0ZUNsaWVudFBheW1lbnRzX3N1Y2Nlc3NfY2FsbGJhY2soKQogICAgICB7CiAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgICAgIGxvZ0RlYnVnKCJ1c2VyRGVsZXRlUGF5bWVudCIpOwogICAgICAgIC8vICRzY29wZS5jdXJzb3JkZWxldGU9IiI7CiAgICAgICAgLy8gZG9jdW1lbnQuYm9keS5zdHlsZS5jdXJzb3I9Jyc7CiAgICAgIH0KICAgIH0KLy8gcmVtb3ZlIGVuZCB1c2VyIGZyb20gZXZlbnQKJHNjb3BlLnVzZXJEZWxldGVFdmVudCA9IGZ1bmN0aW9uKGVuZHVzZXJfaWQsIHRoZWV2ZW50KQp7Ci8vIGlmIGl0J3MgYSBjbGFzcyAtIHdlIHNpbXBseSByZW1vdmUgdGhlIHVzZXIgZnJvbSB0aGUgZXZlbnQKaWYgKHRoZWV2ZW50LmlzX2NsYXNzPT0xKQp7CmxvZ0RlYnVnKCJzY29wZS51c2VyRGVsZXRlRXZlbnQiKTsKcmVtb3ZlRW5kVXNlckZyb21FdmVudCgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsdGhlZXZlbnQuZXZlbnRfaWQscmVtb3ZlRW5kVXNlckZyb21FdmVudF9maW5pc2gsIHJlbW92ZUVuZFVzZXJGcm9tRXZlbnRfZmluaXNoKTsKZnVuY3Rpb24gcmVtb3ZlRW5kVXNlckZyb21FdmVudF9maW5pc2goKQp7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKfQp9Ci8vIGlmIGl0cyBub3QgYSBjbGFzcyAtIHdlIG5lZWQgdG8gcmVtb3ZlIHRoZSBldmVudCBpdHNlbGYKZWxzZQp7Ci8vIGFsZXJ0KCJub3QgY2xhc3MgZXZlbnQsIFRPRE8iKTsKfQp9OwoKLy8gcmV0cmV2aW5nIHBhY2thZ2VzIGZvciB0aGUgYnVzaW5lc3MKZ2V0QnVzaW5lc3NQYWNrYWdlcygkaHR0cCwkc2NvcGUsJ3BhY2thZ2VzJyk7CgovLyBnZXQgcGFja2FnZXMgZm9yIHRoaXMgc3BlY2lmaWMgdXNlcgpnZXRCdXNpbmVzc1VzZXJQYWNrYWdlcygkaHR0cCwkc2NvcGUsJ3VzZXJfcGFja2FnZXMnLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKLy8gYWRkaW5nIHBhY2thZ2UgdG8gdXNlciAtIGNhbGxlZCB3aGVuIGEgcGFja2FnZSBpcyBzZWxlY3RlZAokc2NvcGUucGFja2FnZUZvckNsaWVudFNlbGVjdGVkID0gZnVuY3Rpb24oc2VsZWN0ZWRQYWNrYWdlKSB7CmlmIChzZWxlY3RlZFBhY2thZ2UpIHsKLy8gbG9nRGVidWcoJ3llcyBzZWxlY3RlZCAnICsgSlNPTi5zdHJpbmdpZnkoc2VsZWN0ZWRQYWNrYWdlKSk7CmFkZEJ1c2luZXNzUGFja2FnZVRvVXNlcigkaHR0cCwkc2NvcGUsc2VsZWN0ZWRQYWNrYWdlLm9yaWdpbmFsT2JqZWN0LCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLGFkZEJ1c2luZXNzUGFja2FnZVN1Y2Nlc3MpOwpmdW5jdGlvbiBhZGRCdXNpbmVzc1BhY2thZ2VTdWNjZXNzKCkKewpsb2dEZWJ1ZygiYWRkQnVzaW5lc3NQYWNrYWdlU3VjY2VzczIiKTsKLy8gZ2V0QnVzaW5lc3NQYWNrYWdlcygkaHR0cCwkc2NvcGUsJ3BhY2thZ2VzJyk7Ci8vIGdldEJ1c2luZXNzVXNlclBhY2thZ2VzKCRodHRwLCRzY29wZSwndXNlcl9wYWNrYWdlcycsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwokcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NsaWVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCn0KJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdhbmd1Y29tcGxldGUtYWx0OmNsZWFySW5wdXQnLCAnY2xpZW50X2FuZ3Vjb21wbGV0ZScpOwp9CmVsc2UKewovLyBsb2dEZWJ1Zygnbm90IHNlbGVjdGVkLCBkbyBub3RoaW5nJyk7Cn0KfTsKfSk7CgoKLy8gTmVlZCB0byBkaXN0aW5ndWlzaCBiZXR3ZWVuIGVuZCB1c2VyIChjbGllbnQpIGFuZCBidXNpbmVzcyBvd25lci4KLy8gY3VycmVudGx5IGNhbGxzIG9ubHkgZW5kIHVzZXIKa3V6ZUFwcC5jb250cm9sbGVyKCdIb21lQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICR1aWJNb2RhbCkKewoKZ2V0QWxsQ2xpZW50cygkaHR0cCwkc2NvcGUsJ2FsbENsaWVudHMnKTsKCiRzY29wZS5ob21lcGFnZUxpbWl0PTY7CmdldE9wZW5lZEV2ZW50cygkaHR0cCwkc2NvcGUsJHNjb3BlLmhvbWVwYWdlTGltaXQsJ29wZW5lZF9ldmVudHMnKTsKCnZhciB0b2RheWRhdGUgPSBuZXcgRGF0ZSgpOwp2YXIgaG93bWFueWRheXNhaGVhZD0zMDsKdmFyIHN0YXJ0ZGF0ZT10b2RheWRhdGUuZ2V0RnVsbFllYXIoKSsiLSIrKDErdG9kYXlkYXRlLmdldE1vbnRoKCkpKyItIit0b2RheWRhdGUuZ2V0RGF0ZSgpOwp0b2RheWRhdGUuc2V0RGF0ZSh0b2RheWRhdGUuZ2V0RGF0ZSgpICsgaG93bWFueWRheXNhaGVhZCk7CnZhciBlbmRkYXRlPXRvZGF5ZGF0ZS5nZXRGdWxsWWVhcigpKyItIisoMSt0b2RheWRhdGUuZ2V0TW9udGgoKSkrIi0iK3RvZGF5ZGF0ZS5nZXREYXRlKCk7CgovLyBmaWx0ZXIgZm9yIHVzZXJzIHdobyBoYXZlIGRlYnQKJHNjb3BlLmhhdmVEZWJ0ID0gZnVuY3Rpb24oZXVzZXIpCnsKaWYgKGV1c2VyLnVzZXJfYmFsYW5jZSA8IDApCnsKcmV0dXJuIHRydWU7Cn0KZWxzZQp7CnJldHVybiBmYWxzZTsKfQp9OwoKJHNjb3BlLmdvdG9DbGllbnRQYWdlID0gZnVuY3Rpb24oYnVzaW5lc3NfdXNlcl9pZCkKewovLyBsb2dEZWJ1ZyhldXNlcik7CndpbmRvdy5sb2NhdGlvbi5ocmVmPScvIy9idXNpbmVzc19jbGllbnRzLycgKyBidXNpbmVzc191c2VyX2lkOwp9Cgp2YXIgcGF5bG9hZCA9ICdzdGFydD0nICsgc3RhcnRkYXRlICsgJyZlbmQ9JyArIGVuZGRhdGU7CnZhciBjb25maWcgPSB7CmhlYWRlcnM6IHsnQ29udGVudC1UeXBlJzonYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkOyBjaGFyc2V0PVVURi04J30KfQogICAgdmFyIHBvc3R1cmwgPSAiL2FwaS9hZG1pbi9yZXBvcnRzL2V2ZW50czIiOwoKICAgICRzY29wZS5ldmVudFJlcG9ydENvbmZpZyA9IHt9OwogICAgJHNjb3BlLmV2ZW50UmVwb3J0Q29uZmlnLnNvdXJjZSA9ICJkb2NzIjsKICAgICRzY29wZS5ldmVudFJlcG9ydENvbmZpZy5maWx0ZXJzID0gewogICAgICBzdGFydF9kYXRlOiBzdGFydGRhdGUsCiAgICAgIGlzX2NhbmNlbGVkOiAnMCcsCiAgICAgIGVuZF9kYXRlOiBlbmRkYXRlCiAgICB9OwoKICAgIGdldEV2ZW50c1JlcG9ydCgkaHR0cCwkc2NvcGUsICRzY29wZS5ldmVudFJlcG9ydENvbmZpZywgZ2V0RXZlbnRzUmVwb3J0QWdncmVnYXRlZF9zdWNjZXNzKTsKCiAgICBmdW5jdGlvbiBnZXRFdmVudHNSZXBvcnRBZ2dyZWdhdGVkX3N1Y2Nlc3MocmVzcG9uc2UpewogICAgICAkc2NvcGUuYWRtaW5fZXZlbnRzID0gcmVzcG9uc2UuanNvbjsKICAgICAgICB9CiAgICAvLyAkaHR0cC5wb3N0KHBvc3R1cmwsIHBheWxvYWQsIGNvbmZpZykuc3VjY2VzcyhmdW5jdGlvbihkYXRhKQogICAgLy8gewogICAgLy8gICBsb2dEZWJ1ZygiZG9uZSIpOwogICAgLy8gICAkc2NvcGUuYWRtaW5fZXZlbnRzID0gZGF0YTsKICAgIC8vIH0pOwoKJHNjb3BlLnNob3dFdmVudFBvcHVwID0gZnVuY3Rpb24oc2VsZWN0ZWRFdmVudCkgewpzaG93RXZlbnRQb3B1cChzZWxlY3RlZEV2ZW50LCAkdWliTW9kYWwpCn07CiRzY29wZS5lZGl0RXZlbnQ9IGZ1bmN0aW9uICh0aGVldmVudCkKewpnb3RvRXZlbnRQYWdlKHRoZWV2ZW50KTsKfQp9KTsKCi8vIGt1emVBcHAuY29udHJvbGxlcignQnVzaW5lc3NDb25maWdDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJHJvdXRlUGFyYW1zLCAkbG9jYXRpb24sICRyb3V0ZSwgc2hhcmVkRGF0YSkgewoKa3V6ZUFwcC5jb250cm9sbGVyKCdDb25maWdVc2VyQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHVpYk1vZGFsLCAkaHR0cCwgJHRpbWVvdXQpCnsKJHNjb3BlLmluVGhlTWlkZGxlT2ZTYXZlPWZhbHNlOwoKbG9nRGVidWcoIkNvbmZpZ1VzZXJDb250cm9sbGVyIik7Ci8vICRzY29wZS5hamF4X2luZm89IteU16nXmdeg15XXmdeZ150g16DXqdee16jXlSI7CgogIGdldEJ1c2luZXNzVXNlclJlbGF0aW9ucygkaHR0cCwkc2NvcGUsJ2J1c2luZXNzX3VzZXJfcmVsYXRpb25zJyxnZXRMb2dnZWRVc2VySW5mb19zdWNjZXNzLGdldExvZ2dlZFVzZXJJbmZvX2ZhaWx1cmUpOwoKZ2V0TG9nZ2VkVXNlckluZm8oJGh0dHAsJHNjb3BlLCd1c2VyUHJvcGVydGllcycsZ2V0TG9nZ2VkVXNlckluZm9fc3VjY2VzcyxnZXRMb2dnZWRVc2VySW5mb19mYWlsdXJlKTsKZnVuY3Rpb24gZ2V0TG9nZ2VkVXNlckluZm9fc3VjY2VzcygpCnsKbG9nRGVidWcoImdldExvZ2dlZFVzZXJJbmZvX3N1Y2Nlc3MiKTsKICAgIC8vICRzY29wZS51c2VyUHJvcGVydGllc0R1cGxpY2F0ZSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoJHNjb3BlLnVzZXJQcm9wZXJ0aWVzKSk7Cn0KZnVuY3Rpb24gZ2V0TG9nZ2VkVXNlckluZm9fZmFpbHVyZSgpCnsKbG9nRGVidWcoImdldExvZ2dlZFVzZXJJbmZvX2ZhaWx1cmUiKTsKfQoKJHNjb3BlLmJhY2sgPSBmdW5jdGlvbigpIHsKd2luZG93Lmhpc3RvcnkuYmFjaygpOwp9OwoKJHNjb3BlLmNoYW5nZVBhc3N3b3JkTW9kYWwgPSBmdW5jdGlvbigpCnsKICAgIGxvZ0RlYnVnKCJjaGFuZ2VQYXNzd29yZE1vZGFsIiskc2NvcGUudXNlclByb3BlcnRpZXNEdXBsaWNhdGVbMF0pOwokc2NvcGUuaW5UaGVNaWRkbGVPZlNhdmU9dHJ1ZTsKZnVuY3Rpb24gc21zUmVzZXRQYXNzd29yZF9zdWNjZXNzKCkKewpjb25zb2xlLmxvZygic21zUmVzZXRQYXNzd29yZF9zdWNjZXNzIik7CnZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewphbmltYXRpb246IGZhbHNlLAp0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdtb2RhbF9jaGFuZ2VfcGFzc3dvcmQucGhwJywKY29udHJvbGxlcjogJ21vZGFsX2NoYW5nZV9wYXNzd29yZCcsCnNpemU6ICdsJywKcmVzb2x2ZTogewp1c2VyX3Bob25lX251bWJlcjogZnVuY3Rpb24oKSB7Ci8vIHBhc3Npbmcgb3JpZ2luYWwgcGhvbmUgbnVtYmVyCnJldHVybiAkc2NvcGUudXNlclByb3BlcnRpZXNEdXBsaWNhdGVbMF0ucGhvbmVfbnVtYmVyOwp9Cn0KfSk7Cgptb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHJlc3VsdCkgewokc2NvcGUuaW5UaGVNaWRkbGVPZlNhdmU9ZmFsc2U7CmxvZ0RlYnVnKCdzbXNSZXNldFBhc3N3b3JkIE1vZGFsIGZpbmlzZWhkIHJlc3VsdDogJyArIHJlc3VsdCk7CiRzY29wZS5hamF4X2luZm89IteU16HXmdeh157XkCDXoteV15PXm9eg15Qg15HXlNem15zXl9eUISI7Ci8vIGdldExvZ2dlZFVzZXJJbmZvKCRodHRwLCRzY29wZSwndXNlclByb3BlcnRpZXMnLGdldExvZ2dlZFVzZXJJbmZvX3N1Y2Nlc3MsZ2V0TG9nZ2VkVXNlckluZm9fZmFpbHVyZSk7CiR0aW1lb3V0KGZ1bmN0aW9uKCkKewokc2NvcGUuYWpheF9pbmZvPW51bGw7Cn0sIDIwMDApOwpsb2dEZWJ1Zygnc21zUmVzZXRQYXNzd29yZCBNb2RhbCBkaXNtaXNzZWQgYXQ6ICcgKyBuZXcgRGF0ZSgpKTsKfSwgZnVuY3Rpb24oKSB7CiRzY29wZS5pblRoZU1pZGRsZU9mU2F2ZT1mYWxzZTsKbG9nRGVidWcoJ21vZGFsX2NoYW5nZV9wYXNzd29yZCBNb2RhbCBkaXNtaXNzZWQgYXQ6ICcgKyBuZXcgRGF0ZSgpKTsKfSk7Cn0KCgpjaGFuZ2VQYXNzd29yZFNNUygkaHR0cCwkc2NvcGUsJHNjb3BlLnVzZXJQcm9wZXJ0aWVzRHVwbGljYXRlWzBdLnBob25lX251bWJlcixzbXNSZXNldFBhc3N3b3JkX3N1Y2Nlc3MpOwp9CiRzY29wZS51cGRhdGVVc2VyQ29uZmlnPWZ1bmN0aW9uKCkKewokc2NvcGUuaW5UaGVNaWRkbGVPZlNhdmU9dHJ1ZTsKbG9nRGVidWcoInVwZGF0ZVVzZXJDb25maWcsIGluVGhlTWlkZGxlT2ZTYXZlPSIrJHNjb3BlLmluVGhlTWlkZGxlT2ZTYXZlKTsKLy8gbG9nRGVidWcoJHNjb3BlLnVzZXJQcm9wZXJ0aWVzRHVwbGljYXRlKTsKLy8gbG9nRGVidWcoJHNjb3BlLnVzZXJQcm9wZXJ0aWVzKTsKaWYgKGFuZ3VsYXIuZXF1YWxzKCRzY29wZS51c2VyUHJvcGVydGllc0R1cGxpY2F0ZVswXS5waG9uZV9udW1iZXIsJHNjb3BlLnVzZXJQcm9wZXJ0aWVzWzBdLnBob25lX251bWJlcikpCnsKbG9nRGVidWcoIm5vdGhpbmcgY2hhbmdlZCBpbiBwaG9uZSBudW1iZXIsIGNoZWNraW5nIG90aGVyIGRhdGEgb3RoZXIgZGF0YSIpOwppZiAoYW5ndWxhci5lcXVhbHMoJHNjb3BlLnVzZXJQcm9wZXJ0aWVzRHVwbGljYXRlWzBdLCRzY29wZS51c2VyUHJvcGVydGllc1swXSkpCnsKJHNjb3BlLmluVGhlTWlkZGxlT2ZTYXZlPWZhbHNlOwpsb2dEZWJ1Zygibm90aGluZyBjaGFuZ2VkIGluIGRldGFpbHMsIG5vdGhpbmcgdG8gc2F2ZSIpOwokc2NvcGUuYWpheF9pbmZvPSLXnNeQINeR15XXptei15Ug16nXmdeg15XXmdeZ150g15zXqdee15nXqNeULi4uIjsKJHRpbWVvdXQoZnVuY3Rpb24oKQp7CiRzY29wZS5hamF4X2luZm89bnVsbDsKfSwgMTUwMCk7Cn0KZWxzZQp7CmNoYW5nZVVzZXJEZXRhaWxzKCRodHRwLCRzY29wZSwkc2NvcGUudXNlclByb3BlcnRpZXNbMF0uZmlyc3RfbmFtZSwkc2NvcGUudXNlclByb3BlcnRpZXNbMF0ubGFzdF9uYW1lLCAkc2NvcGUudXNlclByb3BlcnRpZXNbMF0uZW1haWxfYWRkcmVzcyxjaGFuZ2VVc2VyRGV0YWlsc19zdWNjZXNzLCBjaGFuZ2VVc2VyRGV0YWlsc19mYWlsdXJlKTsKJHNjb3BlLmFqYXhfaW5mbz0i157XoteT15vXnyDXqdeZ16DXldeZ15nXnS4uLiI7Cn0KCmZ1bmN0aW9uIGNoYW5nZVVzZXJEZXRhaWxzX3N1Y2Nlc3MoKQp7CmxvZ0RlYnVnKCJjaGFuZ2VVc2VyRGV0YWlsc19zdWNjZXNzIik7CiRzY29wZS5hamF4X2luZm89IteU16nXmdeg15XXmdeZ150g16DXqdee16jXlSDXkdeU16bXnNeX15QhIjsKJHNjb3BlLmluVGhlTWlkZGxlT2ZTYXZlPWZhbHNlOwokdGltZW91dChmdW5jdGlvbigpCnsKJHNjb3BlLmFqYXhfaW5mbz1udWxsOwp9LCAxNTAwKTsKZ2V0TG9nZ2VkVXNlckluZm8oJGh0dHAsJHNjb3BlLCd1c2VyUHJvcGVydGllcycsZ2V0TG9nZ2VkVXNlckluZm9fc3VjY2VzcyxnZXRMb2dnZWRVc2VySW5mb19mYWlsdXJlKTsKfQpmdW5jdGlvbiBjaGFuZ2VVc2VyRGV0YWlsc19mYWlsdXJlKCkKewpsb2dEZWJ1ZygiY2hhbmdlVXNlckRldGFpbHNfZmFpbHVyZSIpOwp9Cgp9CmVsc2UKewovLyB1cGRhdGUgdXNlciBpbmZvIC0gYWZ0ZXIgdmVyaWZ5aW5nIHBhc3N3b3JkCmNvbnNvbGUubG9nKCJwaG9uZSBjaGFuZ2VkLCBjaGVja2luZyBpZiBuZXcgcGhvbmUgaXMgaW4gZGVzY2VudCBmb3JtYXQiKTsKaWYgKCFjaGVja1Bob25lTnVtYmVyKCRzY29wZS51c2VyUHJvcGVydGllc1swXS5waG9uZV9udW1iZXIpKQp7CiRzY29wZS5hamF4X2luZm89IteQ16DXkCDXlNeW158g157Xodek16gg15jXnNek15XXnyDXodec15XXnNeo15kg16rXp9eZ158g15zXp9eR15zXqiDXlNeV15PXoteV16og157Xp9eZ15XXli4iOwokdGltZW91dChmdW5jdGlvbigpCnsKJHNjb3BlLmFqYXhfaW5mbz1udWxsOwp9LCAzMDAwKTsKcmV0dXJuOwp9CmNvbnNvbGUubG9nKCJwaG9uZSBjaGFuZ2VkLCBjaGVja2luZyBpZiBuZXcgcGhvbmUgaXMgbm90IHVzZWQgYWxyZWFkeSIpOwppc05ld1Bob25lVXNlZElmTm90U2VuZFNNUygkaHR0cCwkc2NvcGUsJHNjb3BlLnVzZXJQcm9wZXJ0aWVzWzBdLnBob25lX251bWJlciwgaXNOZXdQaG9uZVVzZWRfc3VjY2VzcywgaXNOZXdQaG9uZVVzZWRfZmFpbHVyZSxmYWxzZSk7CmZ1bmN0aW9uIGlzTmV3UGhvbmVVc2VkX3N1Y2Nlc3MocmVzcG9uc2UpCnsKY29uc29sZS5sb2coInBob25lIG5vdCB1c2VkIC0gcHJvbXB0aW5nIGZvciBwYXNzd29yZCIpOwp2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKYW5pbWF0aW9uOiBmYWxzZSwKdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnbW9kYWxfY2hlY2tfcGFzc3dvcmRfdXBkYXRlX2NvbmZpZy5waHAnLApjb250cm9sbGVyOiAnbW9kYWxfY2hlY2tfcGFzc3dvcmRfdXBkYXRlX2NvbmZpZycsCnNpemU6ICdsJywKcmVzb2x2ZTogewpuZXdfdXNlcl9wcm9lcnRpZXM6IGZ1bmN0aW9uKCkgewpyZXR1cm4gJHNjb3BlLnVzZXJQcm9wZXJ0aWVzWzBdOwp9Cn0KfSk7Cgptb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHJlc3VsdCkgewpsb2dEZWJ1ZygnbW9kYWxfY2hlY2tfcGFzc3dvcmRfdXBkYXRlX2NvbmZpZyBNb2RhbCBmaW5pc2hlZCByZXN1bHQ6ICcgKyByZXN1bHQpOwokc2NvcGUuYWpheF9pbmZvPSLXlNep15nXoNeV15nXmdedINeg16nXnteo15Ug15HXlNem15zXl9eUISI7CiRzY29wZS5pblRoZU1pZGRsZU9mU2F2ZT1mYWxzZTsKZ2V0TG9nZ2VkVXNlckluZm8oJGh0dHAsJHNjb3BlLCd1c2VyUHJvcGVydGllcycsZ2V0TG9nZ2VkVXNlckluZm9fc3VjY2VzcyxnZXRMb2dnZWRVc2VySW5mb19mYWlsdXJlKTsKJHRpbWVvdXQoZnVuY3Rpb24oKQp7CiRzY29wZS5hamF4X2luZm89bnVsbDsKfSwgMzAwMCk7Cn0sIGZ1bmN0aW9uKCkgewokc2NvcGUuaW5UaGVNaWRkbGVPZlNhdmU9ZmFsc2U7CmxvZ0RlYnVnKCdtb2RhbF9jaGVja19wYXNzd29yZF91cGRhdGVfY29uZmlnIE1vZGFsIGRpc21pc3NlZCBhdDogJyArIG5ldyBEYXRlKCkpOwp9KTsKfQoKZnVuY3Rpb24gaXNOZXdQaG9uZVVzZWRfZmFpbHVyZShyZXNwb25zZSkKewokc2NvcGUuYWpheF9pbmZvPXJlc3BvbnNlLm1lc3NhZ2U7CiR0aW1lb3V0KGZ1bmN0aW9uKCkKewokc2NvcGUuYWpheF9pbmZvPW51bGw7Cn0sIDIwMDApOwp9Cn0KfTsKfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdtb2RhbF9jaGVja19wYXNzd29yZF91cGRhdGVfY29uZmlnJywgZnVuY3Rpb24oJHNjb3BlLCAkdGltZW91dCwgJHVpYk1vZGFsSW5zdGFuY2UsIG5ld191c2VyX3Byb2VydGllcywgJGh0dHApCnsKJHNjb3BlLm5ld191c2VyX3Byb2VydGllcz1uZXdfdXNlcl9wcm9lcnRpZXM7CmxvZ0RlYnVnKCJtb2RhbF9jaGVja19wYXNzd29yZF91cGRhdGVfY29uZmlnIGNvbnRyb2xsZXIiKTsKLy8gJHNjb3BlLnBob25lX3ZlcmlmaWNhdGlvbiA9IHt9OyAvLyB0aGVzZSBhcmUgdGhlIGNvbXBsZXRlIGRldGFpbHMgZm9yIHRoZSBuZXcgZXZlbnQgLy8KLy8gJHNjb3BlLnBob25lX3ZlcmlmaWNhdGlvbi5waG9uZV9udW1iZXI9bmV3X3VzZXJfcHJvZXJ0aWVzLnBob25lX251bWJlcjsKJHNjb3BlLmNsb3NlID0gZnVuY3Rpb24oKSB7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCdkaXNtaXNzJyk7Cn07Cgokc2NvcGUuY2hhbmdlUGhvbmVOdW1iZXIgPSBmdW5jdGlvbigpCnsKY2hhbmdlVXNlckRldGFpbHNWZXJpZnkoJGh0dHAsJHNjb3BlLCRzY29wZS5uZXdfdXNlcl9wcm9lcnRpZXMucGhvbmVfbnVtYmVyLCRzY29wZS5uZXdfdXNlcl9wcm9lcnRpZXMuZmlyc3RfbmFtZSwkc2NvcGUubmV3X3VzZXJfcHJvZXJ0aWVzLmxhc3RfbmFtZSwgJHNjb3BlLm5ld191c2VyX3Byb2VydGllcy5lbWFpbF9hZGRyZXNzLCRzY29wZS52ZXJpZnlfdXNlcl9wYXNzd29yZCwkc2NvcGUucGhvbmVfdmVyaWZpY2F0aW9uLGNoYW5nZVVzZXJEZXRhaWxzVmVyaWZ5X3N1Y2Nlc3MsIGNoYW5nZVVzZXJEZXRhaWxzVmVyaWZ5X2ZhaWx1cmUsZmFsc2UpOwpmdW5jdGlvbiBjaGFuZ2VVc2VyRGV0YWlsc1ZlcmlmeV9zdWNjZXNzKCkKewpsb2dEZWJ1ZygiY2hhbmdlVXNlckRldGFpbHNWZXJpZnlfc3VjY2VzcyIpOwovLyBhbGVydCgn15TXqdeZ16DXldeZ15nXnSDXoteV15PXm9eg15Ug15HXlNem15zXl9eUJyk7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKHRydWUpOwp9CmZ1bmN0aW9uIGNoYW5nZVVzZXJEZXRhaWxzVmVyaWZ5X2ZhaWx1cmUocmVzcG9uc2UpCnsKbG9nRGVidWcoImNoYW5nZVVzZXJEZXRhaWxzVmVyaWZ5X2ZhaWx1cmUgIityZXNwb25zZS5tZXNzYWdlKTsKJHNjb3BlLmFqYXhfZXJyb3I9cmVzcG9uc2UubWVzc2FnZSsiLiI7CiR0aW1lb3V0KGZ1bmN0aW9uKCkKewokc2NvcGUuYWpheF9lcnJvcj1udWxsOwp9LCA0MDAwKTsKfQp9Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignbW9kYWxfY2hhbmdlX3Bhc3N3b3JkJywgZnVuY3Rpb24oJHNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgdXNlcl9waG9uZV9udW1iZXIsICRodHRwKQp7CmxvZ0RlYnVnKCJtb2RhbF9jaGFuZ2VfcGFzc3dvcmQgY29udHJvbGxlciIpOwokc2NvcGUucGhvbmVfdmVyaWZpY2F0aW9uID0ge307IC8vIHRoZXNlIGFyZSB0aGUgY29tcGxldGUgZGV0YWlscyBmb3IgdGhlIG5ldyBldmVudCAvLwokc2NvcGUucGhvbmVfdmVyaWZpY2F0aW9uLnBob25lX251bWJlcj11c2VyX3Bob25lX251bWJlcjsKJHNjb3BlLnBob25lX3ZlcmlmaWNhdGlvbi5zbXNfZXJyb3I9IiI7CiRzY29wZS5jbG9zZSA9IGZ1bmN0aW9uKCkgewokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnZGlzbWlzcycpOwp9OwoKJHNjb3BlLmNoYW5nZVBhc3N3b3JkID0gZnVuY3Rpb24oKQp7CmNoYW5nZVBhc3N3b3JkKCRodHRwLCRzY29wZSwkc2NvcGUucGhvbmVfdmVyaWZpY2F0aW9uLnVzZXJfcGFzc3dvcmQsJHNjb3BlLnBob25lX3ZlcmlmaWNhdGlvbi51c2VyX3Bhc3N3b3JkMiwkc2NvcGUucGhvbmVfdmVyaWZpY2F0aW9uLnZlcmlmaWNhdGlvbl9jb2RlLCBjaGFuZ2VQYXNzd29yZF9zdWNjZXNzLCBjaGFuZ2VQYXNzd29yZF9mYWlsdXJlLGZhbHNlKTsKJHNjb3BlLmFqYXhfZXJyb3I9IiI7CmZ1bmN0aW9uIGNoYW5nZVBhc3N3b3JkX3N1Y2Nlc3MoKQp7CmxvZ0RlYnVnKCJjaGFuZ2VQYXNzd29yZF9zdWNjZXNzIik7CnN0YXR1cz0iZmZmZmYiOwovLyBhbGVydCgn15TXodeZ16HXnteQINei15XXk9eb16DXlCDXkdeU16bXnNeX15QnKTsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UodHJ1ZSk7Cn0KZnVuY3Rpb24gY2hhbmdlUGFzc3dvcmRfZmFpbHVyZShyZXNwb25zZSkKewpsb2dEZWJ1ZygiY2hhbmdlUGFzc3dvcmRfZmFpbHVyZSAiK3Jlc3BvbnNlLm1lc3NhZ2UpOwokc2NvcGUuYWpheF9lcnJvcj1yZXNwb25zZS5tZXNzYWdlOwp9Cn0KfSk7CgprdXplQXBwLmZhY3RvcnkoJ0J1c2luZXNzQ29uZmlnJywgZnVuY3Rpb24oJGh0dHApIHsKcmV0dXJuIHsKZ2V0OiBmdW5jdGlvbiAoKSB7CmxvZ0RlYnVnKCJsb2FkIGdldF9idXNpbmVzc19jb25maWciKTsKcmV0dXJuICRodHRwLmdldCgiL2FwaS9hZG1pbi9idXNpbmVzc19jb25maWciKQoudGhlbihmdW5jdGlvbihyZXNwb25zZSkgewpyZXN1bHQgPSByZXNwb25zZS5kYXRhWzBdOwpyZXN1bHQudXNlX2hvbGlkYXlzPSEhcGFyc2VJbnQocmVzcG9uc2UuZGF0YVswXS51c2VfaG9saWRheXMpOwpyZXN1bHQuc21zX25vdGlmaWNhdGlvbnM9ISFwYXJzZUludChyZXNwb25zZS5kYXRhWzBdLnNtc19ub3RpZmljYXRpb25zKTsKcmVzdWx0LnN0YXJ0X2ludm9pY2VfbnVtYmVyID0gcGFyc2VJbnQocmVzcG9uc2UuZGF0YVswXS5zdGFydF9pbnZvaWNlX251bWJlcik7CnZhciBkID0gbmV3IERhdGUoKTsKZC5zZXRIb3VycyggcmVzdWx0LmNhbGVuZGFyX2Rpc3BsYXlfc3RhcnRfaG91cnMgKTsKZC5zZXRNaW51dGVzKCByZXN1bHQuY2FsZW5kYXJfZGlzcGxheV9zdGFydF9taW51dGVzICk7CnJlc3VsdC5teXRpbWUgPSBkOwpyZXN1bHQuY2FsZW5kYXJfZGlzcGxheV9zdGFydCA9IGQ7CnZhciBkID0gbmV3IERhdGUoKTsKZC5zZXRIb3VycyggcmVzdWx0LmNhbGVuZGFyX2Rpc3BsYXlfZW5kX2hvdXJzICk7CmQuc2V0TWludXRlcyggcmVzdWx0LmNhbGVuZGFyX2Rpc3BsYXlfZW5kX21pbnV0ZXMgKTsKcmVzdWx0Lm15dGltZSA9IGQ7CnJlc3VsdC5jYWxlbmRhcl9kaXNwbGF5X2VuZCA9IGQ7CnJlc3VsdC52YXRfcmF0ZSA9IE51bWJlcihyZXN1bHQudmF0X3JhdGUpOwpyZXR1cm4gcmVzdWx0Owp9KTsKfQp9Owp9KTsKCmt1emVBcHAuY29udHJvbGxlcignQ29uZmlnQnVzaW5lc3NDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJHRpbWVvdXQsIEJ1c2luZXNzQ29uZmlnKQp7CmxvZ0RlYnVnKCJteSBidXNpbmVzcyBjb25maWciKTsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXM9W107CgpmdW5jdGlvbiBnZXRfYnVzaW5lc3NfY29uZmlnKCkgewpsb2dEZWJ1ZygiZ2V0X2J1c2luZXNzX2NvbmZpZyIpOwpsb2dEZWJ1ZygiQnVzaW5lc3NDb25maWc6ICIsIEJ1c2luZXNzQ29uZmlnKTsKQnVzaW5lc3NDb25maWcuZ2V0KCkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7ICRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMgPSByZXN1bHQ7IH0pOwp9CmdldF9idXNpbmVzc19jb25maWcoKTsKCgokc2NvcGUuaHN0ZXAgPSAxOwokc2NvcGUubXN0ZXAgPSAxNTsKCiRzY29wZS5idXNpbmVzc0NvbmZpZ0NhbmNlbCA9IGZ1bmN0aW9uKCkgewp3aW5kb3cuaGlzdG9yeS5iYWNrKCk7Cn07Cgokc2NvcGUudXBkYXRlQnVzaW5lc3NDb25maWcgPSBmdW5jdGlvbigpIHsKbG9nRGVidWcoInVwZGF0aW5nIGJ1c2luZXNzIGNvbmZpZyIgKyBKU09OLnN0cmluZ2lmeSgkc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzKSk7Cgokc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzX2FqYXhfZXJyb3I9IiI7CiRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMuY2FsZW5kYXJfZGlzcGxheV9zdGFydF9ob3Vycz0kc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzLmNhbGVuZGFyX2Rpc3BsYXlfc3RhcnQuZ2V0SG91cnMoKTsKJHNjb3BlLmJ1c2luZXNzUHJvcGVydGllcy5jYWxlbmRhcl9kaXNwbGF5X3N0YXJ0X21pbnV0ZXM9JHNjb3BlLmJ1c2luZXNzUHJvcGVydGllcy5jYWxlbmRhcl9kaXNwbGF5X3N0YXJ0LmdldE1pbnV0ZXMoKTsKJHNjb3BlLmJ1c2luZXNzUHJvcGVydGllcy5jYWxlbmRhcl9kaXNwbGF5X2VuZF9ob3Vycz0kc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzLmNhbGVuZGFyX2Rpc3BsYXlfZW5kLmdldEhvdXJzKCk7CiRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMuY2FsZW5kYXJfZGlzcGxheV9lbmRfbWludXRlcz0kc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzLmNhbGVuZGFyX2Rpc3BsYXlfZW5kLmdldE1pbnV0ZXMoKTsKaWYgKCRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMuY2FsZW5kYXJfZGlzcGxheV9zdGFydF9ob3Vycz4kc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzLmNhbGVuZGFyX2Rpc3BsYXlfZW5kX2hvdXJzKQp7CmFsZXJ0KCfXltee158g16HXmdeV150g15zXkCDXmdeb15XXnCDXnNeU15nXldeqINec16TXoNeZINeW157XnyDXlNeq15fXnNeUJyk7CnJldHVybjsKfQokc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzX2FqYXhfZXJyb3I9Itee16LXk9eb158g16DXqteV16DXmdedLi4uIjsKCiRodHRwKHsKbWV0aG9kOiAnUE9TVCcsCnVybDogJy9hcGkvYWRtaW4vYnVzaW5lc3NfY29uZmlnL3NldCcsCmRhdGE6ICRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMsIC8vIHBhc3MgaW4gZGF0YSBhcyBzdHJpbmdzCmhlYWRlcnM6IHsKJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uO2NoYXJzZXQ9dXRmLTgnCn0KfSkuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7Cgpsb2dEZWJ1ZyhkYXRhKTsKaWYgKCFkYXRhLnN1Y2Nlc3MpIHsKbG9nRGVidWcoImVycm9yICIgKyBkYXRhLk1lc3NhZ2UpOwokc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzX2FqYXhfZXJyb3IgPSBkYXRhLk1lc3NhZ2U7Cn0gZWxzZSB7CiRnQ2FsZW5kYXJEaXNwbGF5TWluVGltZT1kYXRhLmpzb24ubmV3U3RhcnRUaW1lOwokZ0NhbGVuZGFyRGlzcGxheU1heFRpbWU9ZGF0YS5qc29uLm5ld0VuZFRpbWU7CmNvbnNvbGUubG9nKCJ1cGRhdGVkIGdDYWxlbmRhckRpc3BsYXlNaW5UaW1lPSIrJGdDYWxlbmRhckRpc3BsYXlNaW5UaW1lKTsKY29uc29sZS5sb2coInVwZGF0ZWQgZ0NhbGVuZGFyRGlzcGxheU1heFRpbWU9IiskZ0NhbGVuZGFyRGlzcGxheU1heFRpbWUpOwokc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzX2FqYXhfZXJyb3I9Itei15XXk9eb158g15HXlNem15zXl9eUISI7CiR0aW1lb3V0KGZ1bmN0aW9uKCkKewokc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzX2FqYXhfZXJyb3I9bnVsbDsKfSwgMjAwMCk7CmdldF9idXNpbmVzc19jb25maWcoKTsKLy8gd2luZG93Lmhpc3RvcnkuYmFjaygpOwovLyAkc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzX2FqYXhfZXJyb3IgPSAi16TXqNeY15kg15TXoteh16cg16DXqdee16jXlSDXkdeU16bXnNeX15QuIjsKCn0KfSk7Cn07Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignY2xpZW50Q2FyZENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUpIHsKbG9nRGVidWcoImNsaWVudENhcmRDb250cm9sbGVyIik7CiRzY29wZS5mdXR1cmVNZWV0aW5ncyA9IFt7CmRhdGV0aW1lOiAi16jXkNep15XXnywgMjUuMS4yMDE2IiwKaG91cjogIjE0OjAwIiwKdHlwZTogIten15HXldem15QiLApwcmljZTogIjEwMCIsCmxhYmVsczogW3sKbGFiZWw6ICJzdWNjZXNzIiwKdGV4dDogItep15XXnNedIgp9LCB7CmxhYmVsOiAid2FybmluZyIsCnRleHQ6ICLXnNeQINeq15XXoteTIgp9XQp9LCB7CmRhdGV0aW1lOiAi16jXkNep15XXnywgMjUuMS4yMDE2IiwKaG91cjogIjE0OjAwIiwKdHlwZTogIten15HXldem15QiLApwcmljZTogIjEwMCIsCmxhYmVsczogW3sKbGFiZWw6ICJkYW5nZXIiLAp0ZXh0OiAi15zXkCDXqdeV15zXnSIKfSwgewpsYWJlbDogImluZm8iLAp0ZXh0OiAi16rXldei15MiCn1dCn0sIHsKZGF0ZXRpbWU6ICLXqdec15nXqdeZLCAyNS4xLjIwMTYiLApob3VyOiAiMTQ6MDAiLAp0eXBlOiAi16fXkdeV16bXlCIsCnByaWNlOiAiMTAwIiwKbGFiZWxzOiBbewpsYWJlbDogImRhbmdlciIsCnRleHQ6ICLXnNeQINep15XXnNedIgp9LCB7CmxhYmVsOiAiaW5mbyIsCnRleHQ6ICLXqteV16LXkyIKfV0KfSwgewpkYXRldGltZTogIteo15DXqdeV158sIDI1LjEuMjAxNiIsCmhvdXI6ICIxNDowMCIsCnR5cGU6ICLXp9eR15XXpteUIiwKcHJpY2U6ICIxMDAiCn0sIF0KCiRzY29wZS5oaXN0b3J5TWVldGluZ3MgPSBbewpkYXRldGltZTogIteo15DXqdeV158sIDI1LjEuMjAxNiIsCmhvdXI6ICIxNDowMCIsCnR5cGU6ICLXp9eR15XXpteUIiwKcHJpY2U6ICIxMDAiCn0sIHsKZGF0ZXRpbWU6ICLXqNeQ16nXldefLCAyNS4xLjIwMTYiLApob3VyOiAiMTQ6MDAiLAp0eXBlOiAi16fXkdeV16bXlCIsCnByaWNlOiAiMTAwIgp9LCB7CmRhdGV0aW1lOiAi16nXnNeZ16nXmSwgMjUuMS4yMDE2IiwKaG91cjogIjE0OjAwIiwKdHlwZTogIten15HXldem15QiLApwcmljZTogIjEwMCIKfSwgewpkYXRldGltZTogIteo15DXqdeV158sIDI1LjEuMjAxNiIsCmhvdXI6ICIxNDowMCIsCnR5cGU6ICLXp9eR15XXpteUIiwKcHJpY2U6ICIxMDAiCn0sIF0KCiRzY29wZS5jY1BheW1lbnRzID0gW3sKZGF0ZXRpbWU6ICLXqNeQ16nXldefLCAyNS4xLjIwMTYiLApyZWNpcHRfbnVtOiAiNzY3IiwKYW1vdW50OiAiMzAwIiwKbGFiZWxzOiBbewpsYWJlbDogImRhbmdlciIsCnRleHQ6ICLXnNeQINep15XXmdeZ15oiCn0sIHsKbGFiZWw6ICJpbmZvIiwKdGV4dDogIteU15XXpNen15MiCn1dCn0sIF0KCgp9KTsKCmt1emVBcHAuY29udHJvbGxlcigna3V6ZUNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkbG9jYXRpb24pIHsKCi8vIG1haW4ga3V6ZSBjb250cm9sbGVyCgovLyBNVVNUIFNFVCBMQU5HVUFHRSBCRUZPUkUgQU5ZIE9USEVSIE9QRVJBVElPTiAhISEKdXBkYXRlR2xvYmFsTGFuZ3VhZ2UoJHNjb3BlLCAkZ0RlZmF1bHRMYW5nKTsKLy8gTVVTVCBTRVQgTEFOR1VBR0UgQkVGT1JFIEFOWSBPVEhFUiBPUEVSQVRJT04gISEhCgovLyBsb2dEZWJ1ZygieHh4eHh4eHgiICsgJHNjb3BlLmxhbmdmaWxlWydzaG93X2FsbF9jbGllbnRzJ10pOwoKJHNjb3BlLnNob3dDbGllbnRzQ29sdW1ucyA9IFt7CmZpZWxkOiAndXNlcl9pZCcsCm5hbWU6ICRzY29wZS5sYW5nZmlsZVsnc2hvd19hbGxfY2xpZW50c191c2VyaWQnXQp9LCB7CmZpZWxkOiAnYnVzZXJfZmlyc3RfbmFtZScsCm5hbWU6ICRzY29wZS5sYW5nZmlsZVsnc2hvd19hbGxfY2xpZW50c19maXJzdF9uYW1lJ10KfSwgewpmaWVsZDogJ2J1c2VyX2xhc3RfbmFtZScsCm5hbWU6ICRzY29wZS5sYW5nZmlsZVsnc2hvd19hbGxfY2xpZW50c19sYXN0X25hbWUnXQp9LCB7CmZpZWxkOiAncm9sZV9uYW1lJywKbmFtZTogJHNjb3BlLmxhbmdmaWxlWydzaG93X2FsbF9jbGllbnRzX2FwcHJvdmVkJ10KfV07CgoKJHNjb3BlLmdyaWRDbGllbnRDbGljayA9IGZ1bmN0aW9uKHJvdykgewovL2xvZ0RlYnVnKHJvdyk7CnZhciByb3dfdXNlcmlkID0gcm93LmVudGl0eS51c2VyX2lkOwpsb2dEZWJ1Zygic2VsZWN0ZWQgcm93IHVzZXJfaWQgPSIgKyByb3dfdXNlcmlkKTsKJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jbGllbnRzLycgKyByb3dfdXNlcmlkKTsKfTsKCiRzY29wZS5zaG93Q2xpZW50c0dyaWRPcHRpb25zID0gewplbmFibGVGaWx0ZXJpbmc6IGZhbHNlLAplbmFibGVTb3J0aW5nOiB0cnVlLApjb2x1bW5EZWZzOiAkc2NvcGUuc2hvd0NsaWVudHNDb2x1bW5zLApyb3dUZW1wbGF0ZTogJy9wdWJsaWMvY29tcG9uZW50cy9jbGllbnRzLWdyaWQtcm93Lmh0bWwnLApvblJlZ2lzdGVyQXBpOiBmdW5jdGlvbihncmlkQXBpKSB7CiRzY29wZS5ncmlkQXBpID0gZ3JpZEFwaTsKJHNjb3BlLmdyaWRBcGkuZ3JpZC5yZWdpc3RlclJvd3NQcm9jZXNzb3IoJHNjb3BlLnNpbmdsZUZpbHRlciwgMjAwKTsKfSwKfTsKCiRzY29wZS5pc0FjdGl2ZSA9IGZ1bmN0aW9uKHZpZXdMb2NhdGlvbikgewpsb2dEZWJ1Zygidmlld0xvY2F0aW9uID0gIiArIHZpZXdMb2NhdGlvbik7CnZhciBhY3RpdmUgPSAodmlld0xvY2F0aW9uID09PSAkbG9jYXRpb24ucGF0aCgpKTsKcmV0dXJuIGFjdGl2ZTsKfTsKCiRzY29wZS5maWx0ZXIgPSBmdW5jdGlvbigpIHsKbG9nRGVidWcoInNpbmdsZSBmaWx0ZXIiKTsKJHNjb3BlLmdyaWRBcGkuZ3JpZC5yZWZyZXNoKCk7CmlmICgkc2NvcGUuZmlsdGVyLlZhbHVlICE9ICIiKSB7CiRzY29wZS5maWx0ZXIuYnV0dG9uVmFsdWUgPSAiJyIgKyAkc2NvcGUuZmlsdGVyLlZhbHVlICsgIiciOwp9IGVsc2Ugewokc2NvcGUuZmlsdGVyLmJ1dHRvblZhbHVlID0gIiI7Cn0KfTsKCiRzY29wZS5zaW5nbGVGaWx0ZXIgPSBmdW5jdGlvbihyZW5kZXJhYmxlUm93cykgewp2YXIgbWF0Y2hlciA9IG5ldyBSZWdFeHAoJHNjb3BlLmZpbHRlci5WYWx1ZSk7CmxvZ0RlYnVnKCJzY29wZT0iICsgJHNjb3BlKTsKbG9nRGVidWcoInNjb3BlLmZpbHRlci5WYWx1ZT0iICsgJHNjb3BlLmZpbHRlci5WYWx1ZSk7CmlmICgoJHNjb3BlLmZpbHRlci5WYWx1ZSA9PSBudWxsKSB8fCAoJHNjb3BlLmZpbHRlci5WYWx1ZSA9PSAiIikpIHsKbG9nRGVidWcoImVtcHR5IGZpbHRlciIpOwpyZXR1cm4gcmVuZGVyYWJsZVJvd3M7Cn0KcmVuZGVyYWJsZVJvd3MuZm9yRWFjaChmdW5jdGlvbihyb3cpIHsKLy8JCQlsb2dEZWJ1Zygicm93PSIrcm93KTsKcm93LnZpc2libGUgPSBmYWxzZTsKdmFyICRjdXJyRmlyc3ROYW1lID0gcm93LmVudGl0eVsnZmlyc3RfbmFtZSddOwp2YXIgJGN1cnJMYXN0TmFtZSA9IHJvdy5lbnRpdHlbJ2xhc3RfbmFtZSddOwpsb2dEZWJ1ZygiY3VyckZpcnN0TmFtZT0iICsgJGN1cnJGaXJzdE5hbWUpOwoKaWYgKCRjdXJyRmlyc3ROYW1lICE9IG51bGwpIHsKaWYgKCRjdXJyRmlyc3ROYW1lLmluZGV4T2YoJHNjb3BlLmZpbHRlci5WYWx1ZSkgPiAtMSkgewpyb3cudmlzaWJsZSA9IHRydWU7Cn0KfSBlbHNlIC8vIHJvdyBpcyBudWxsCnsKcm93LnZpc2libGUgPSBmYWxzZTsKfQoKaWYgKCRjdXJyTGFzdE5hbWUgIT0gbnVsbCkgewppZiAoJGN1cnJMYXN0TmFtZS5pbmRleE9mKCRzY29wZS5maWx0ZXIuVmFsdWUpID4gLTEpIHsKcm93LnZpc2libGUgPSB0cnVlOwp9Cn0gZWxzZSAvLyByb3cgaXMgbnVsbAp7CnJvdy52aXNpYmxlID0gZmFsc2U7Cn0KfSk7CnJldHVybiByZW5kZXJhYmxlUm93czsKfTsKCi8vIGltcG9ydGFudCEhIGluaXRpYWxpemluZyBhbmd1bGFyIGZvcm1zIGFzIGFycmF5cwokc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIgPSB7fTsKJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyID0ge307CgovLyBsb2dEZWJ1ZygibG9jYXRpb249IiArICRsb2NhdGlvbik7Ci8vIGxvZ0RlYnVnKCRsb2NhdGlvbik7Cgokc2NvcGUuY2hhbmdlTGFuZyA9IGZ1bmN0aW9uKCRuZXdsYW5nKSB7CmxvZ0RlYnVnKCRuZXdsYW5nKTsKLy8kc2NvcGUuc3BDbGFzcyA9ICdyaWdodCc7CnVwZGF0ZUdsb2JhbExhbmd1YWdlKCRzY29wZSwgJG5ld2xhbmcpCn0KCiRzY29wZS5hZGROZXdDbGllbnQgPSBmdW5jdGlvbigpIHsKJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jbGllbnRzL2FkZCcpOwp9CiRzY29wZS5hZGROZXdJbnN0cnVjdG9yID0gZnVuY3Rpb24oKSB7CiRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfaW5zdHJ1Y3RvcnMvYWRkJyk7Cn0KfSk7CgovLy8vLy8gYmVmb3JlIGZvcm1zCmt1emVBcHAuY29udHJvbGxlcignRGVtb0NvbnRyb2xsZXInLCBbCickc2NvcGUnLCAnJGJ1aWxkZXInLCAnJHZhbGlkYXRvcicsCmZ1bmN0aW9uKCRzY29wZSwgJGJ1aWxkZXIsICR2YWxpZGF0b3IpIHsKdmFyIGNoZWNrYm94LCB0ZXh0Ym94Owp0ZXh0Ym94ID0gJGJ1aWxkZXIuYWRkRm9ybU9iamVjdCgnZGVmYXVsdCcsIHsKaWQ6ICd0ZXh0Ym94JywKY29tcG9uZW50OiAndGV4dElucHV0JywKbGFiZWw6ICdOYW1lJywKZGVzY3JpcHRpb246ICdZb3VyIG5hbWUnLApwbGFjZWhvbGRlcjogJ1lvdXIgbmFtZScsCnJlcXVpcmVkOiB0cnVlLAplZGl0YWJsZTogZmFsc2UKfSk7CmNoZWNrYm94ID0gJGJ1aWxkZXIuYWRkRm9ybU9iamVjdCgnZGVmYXVsdCcsIHsKaWQ6ICdjaGVja2JveCcsCmNvbXBvbmVudDogJ2NoZWNrYm94JywKbGFiZWw6ICdQZXRzJywKZGVzY3JpcHRpb246ICdEbyB5b3UgaGF2ZSBhbnkgcGV0cz8nLApvcHRpb25zOiBbJ0RvZycsICdDYXQnXQp9KTsKJGJ1aWxkZXIuYWRkRm9ybU9iamVjdCgnZGVmYXVsdCcsIHsKY29tcG9uZW50OiAnc2FtcGxlSW5wdXQnCn0pOwokc2NvcGUuZm9ybSA9ICRidWlsZGVyLmZvcm1zWydkZWZhdWx0J107CiRzY29wZS5pbnB1dCA9IFtdOwokc2NvcGUuZGVmYXVsdFZhbHVlID0ge307CiRzY29wZS5kZWZhdWx0VmFsdWVbdGV4dGJveC5pZF0gPSAnZGVmYXVsdCB2YWx1ZSc7CiRzY29wZS5kZWZhdWx0VmFsdWVbY2hlY2tib3guaWRdID0gW3RydWUsIHRydWVdOwpyZXR1cm4gJHNjb3BlLnN1Ym1pdCA9IGZ1bmN0aW9uKCkgewpyZXR1cm4gJHZhbGlkYXRvci52YWxpZGF0ZSgkc2NvcGUsICdkZWZhdWx0Jykuc3VjY2VzcyhmdW5jdGlvbigpIHsKcmV0dXJuIGxvZ0RlYnVnKCdzdWNjZXNzJyk7Cn0pLmVycm9yKGZ1bmN0aW9uKCkgewpyZXR1cm4gbG9nRGVidWcoJ2Vycm9yJyk7Cn0pOwp9Owp9Cl0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdBbGVydERlbW9DdHJsJywgZnVuY3Rpb24oJHNjb3BlKSB7CiRzY29wZS5hbGVydHMgPSBbewp0eXBlOiAnZGFuZ2VyJywKbXNnOiAnT2ggc25hcCEgQ2hhbmdlIGEgZmV3IHRoaW5ncyB1cCBhbmQgdHJ5IHN1Ym1pdHRpbmcgYWdhaW4uJwp9LCB7CnR5cGU6ICdzdWNjZXNzJywKbXNnOiAnV2VsbCBkb25lISBZb3Ugc3VjY2Vzc2Z1bGx5IHJlYWQgdGhpcyBpbXBvcnRhbnQgYWxlcnQgbWVzc2FnZS4nCn1dOwoKJHNjb3BlLmFkZEFsZXJ0ID0gZnVuY3Rpb24oKSB7CiRzY29wZS5hbGVydHMucHVzaCh7Cm1zZzogJ0Fub3RoZXIgYWxlcnQhJwp9KTsKfTsKCiRzY29wZS5jbG9zZUFsZXJ0ID0gZnVuY3Rpb24oaW5kZXgpIHsKJHNjb3BlLmFsZXJ0cy5zcGxpY2UoaW5kZXgsIDEpOwp9Owp9KTsKCgpmdW5jdGlvbiBpc051bWJlcktleShldnQpewp2YXIgY2hhckNvZGUgPSAoZXZ0LndoaWNoKSA/IGV2dC53aGljaCA6IGV2ZW50LmtleUNvZGU7CnJldHVybiAhKGNoYXJDb2RlID4gMzEgJiYgKGNoYXJDb2RlIDwgNDggfHwgY2hhckNvZGUgPiA1NykpOwp9Cgo=</text>
      </register>
      <register name="r" type="4">
        <keys>
          <key char="64" code="0" mods="0" />
          <key char="116" code="0" mods="0" />
          <key char="119" code="0" mods="0" />
          <key char="105" code="0" mods="0" />
          <key char="123" code="0" mods="0" />
          <key char="32" code="0" mods="0" />
          <key char="116" code="0" mods="0" />
          <key char="121" code="0" mods="0" />
          <key char="65535" code="8" mods="0" />
          <key char="65535" code="8" mods="0" />
          <key char="99" code="0" mods="0" />
          <key char="111" code="0" mods="0" />
          <key char="100" code="0" mods="0" />
          <key char="101" code="0" mods="0" />
          <key char="32" code="0" mods="0" />
          <key char="58" code="0" mods="0" />
          <key char="65535" code="91" mods="130" />
          <key char="65" code="0" mods="0" />
          <key char="44" code="0" mods="0" />
          <key char="65535" code="8" mods="0" />
          <key char="44" code="0" mods="0" />
          <key char="65535" code="91" mods="130" />
          <key char="119" code="0" mods="0" />
          <key char="119" code="0" mods="0" />
          <key char="105" code="0" mods="0" />
          <key char="110" code="0" mods="0" />
          <key char="97" code="0" mods="0" />
          <key char="109" code="0" mods="0" />
          <key char="101" code="0" mods="0" />
          <key char="58" code="0" mods="0" />
          <key char="32" code="0" mods="0" />
          <key char="34" code="0" mods="0" />
          <key char="65535" code="91" mods="130" />
          <key char="65" code="0" mods="0" />
          <key char="34" code="0" mods="0" />
          <key char="65535" code="91" mods="130" />
          <key char="65" code="0" mods="0" />
          <key char="65535" code="10" mods="0" />
          <key char="125" code="0" mods="0" />
          <key char="65535" code="91" mods="130" />
          <key char="97" code="0" mods="0" />
          <key char="44" code="0" mods="0" />
          <key char="65535" code="91" mods="130" />
          <key char="119" code="0" mods="0" />
          <key char="119" code="0" mods="0" />
          <key char="48" code="0" mods="0" />
        </keys>
      </register>
      <register name="3" type="2">
        <text encoding="base64">Cg==</text>
      </register>
      <register name="4" type="2">
        <text encoding="base64">Ly8gdjExIC0gMjMgbWFyY2ggMjAxNwovL0RlZmluZSBhbiBhbmd1bGFyIG1vZHVsZSBmb3Igb3VyIGFwcAoKdmFyIGt1emVJc0NhbGVuZGFyRHJhZ2dibGU7Cmt1emVJc0NhbGVuZGFyRHJhZ2dibGUgPSB0cnVlOwoKLy8gYW5ndWxhciBtb2R1bGVzCi8vJGFuZ3VsYXJNb2R1bGVzPVsnbmdSb3V0ZScsJ3VpLmJvb3RzdHJhcCcsJ3VpLmdyaWQnXTsKJGFuZ3VsYXJNb2R1bGVzID0gWyduZ1JvdXRlJywgJ3VpLmJvb3RzdHJhcCcsICd1aS5ncmlkJywgJ2J1aWxkZXInLCAnYnVpbGRlci5jb21wb25lbnRzJywgJ3ZhbGlkYXRvci5ydWxlcycsICd1aS5jYWxlbmRhcicsICdjaGVja2xpc3QtbW9kZWwnLCAndWkuYm9vdHN0cmFwLmRhdGV0aW1lcGlja2VyJywgJ2FuZ3Vjb21wbGV0ZS1hbHQnLCAnbXVsdGlwbGVTZWxlY3QnLCdhbmd1bGFySW5saW5lRWRpdCcsJ3RleHRBbmd1bGFyJywnbmdDc3YnXTsKCnZhciBkYXlOYW1lcyA9IFsn16jXkNep15XXnycsICfXqdeg15knLCAn16nXnNeZ16nXmScsICfXqNeR15nXoteZJywgJ9eX157Xmdep15knLCAn16nXmdep15knLCAn16nXkdeqJ107CnZhciBtb250aE5hbWVzID0gWyLXmdeg15XXkNeoIiwgItek15HXqNeV15DXqCIsICLXnteo16UiLCAi15DXpNeo15nXnCIsICLXnteQ15kiLCAi15nXldeg15kiLAogICAgIteZ15XXnNeZIiwgIteQ15XXkteV16HXmCIsICLXodek15jXnteR16giLCAi15DXlden15jXldeR16giLCAi16DXldeR157XkdeoIiwgIteT16bXnteR16giCl07Cgp2YXIgbG9naW5OZXh0U2NyZWVuPSIiOwoKKGZ1bmN0aW9uKCl7RGF0ZS5zaG9ydE1vbnRocz1bIkphbiIsIkZlYiIsIk1hciIsIkFwciIsIk1heSIsIkp1biIsIkp1bCIsIkF1ZyIsIlNlcCIsIk9jdCIsIk5vdiIsIkRlYyJdLERhdGUubG9uZ01vbnRocz1bIkphbnVhcnkiLCJGZWJydWFyeSIsIk1hcmNoIiwiQXByaWwiLCJNYXkiLCJKdW5lIiwiSnVseSIsIkF1Z3VzdCIsIlNlcHRlbWJlciIsIk9jdG9iZXIiLCJOb3ZlbWJlciIsIkRlY2VtYmVyIl0sRGF0ZS5zaG9ydERheXM9WyJTdW4iLCJNb24iLCJUdWUiLCJXZWQiLCJUaHUiLCJGcmkiLCJTYXQiXSxEYXRlLmxvbmdEYXlzPVsiU3VuZGF5IiwiTW9uZGF5IiwiVHVlc2RheSIsIldlZG5lc2RheSIsIlRodXJzZGF5IiwiRnJpZGF5IiwiU2F0dXJkYXkiXTt2YXIgdD17ZDpmdW5jdGlvbigpe3JldHVybih0aGlzLmdldERhdGUoKTwxMD8iMCI6IiIpK3RoaXMuZ2V0RGF0ZSgpfSxEOmZ1bmN0aW9uKCl7cmV0dXJuIERhdGUuc2hvcnREYXlzW3RoaXMuZ2V0RGF5KCldfSxqOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZ2V0RGF0ZSgpfSxsOmZ1bmN0aW9uKCl7cmV0dXJuIERhdGUubG9uZ0RheXNbdGhpcy5nZXREYXkoKV19LE46ZnVuY3Rpb24oKXtyZXR1cm4gMD09dGhpcy5nZXREYXkoKT83OnRoaXMuZ2V0RGF5KCl9LFM6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5nZXREYXRlKCklMTA9PTEmJjExIT10aGlzLmdldERhdGUoKT8ic3QiOnRoaXMuZ2V0RGF0ZSgpJTEwPT0yJiYxMiE9dGhpcy5nZXREYXRlKCk/Im5kIjp0aGlzLmdldERhdGUoKSUxMD09MyYmMTMhPXRoaXMuZ2V0RGF0ZSgpPyJyZCI6InRoIn0sdzpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldERheSgpfSx6OmZ1bmN0aW9uKCl7dmFyIHQ9bmV3IERhdGUodGhpcy5nZXRGdWxsWWVhcigpLDAsMSk7cmV0dXJuIE1hdGguY2VpbCgodGhpcy10KS84NjRlNSl9LFc6ZnVuY3Rpb24oKXt2YXIgdD1uZXcgRGF0ZSh0aGlzLnZhbHVlT2YoKSksZT0odGhpcy5nZXREYXkoKSs2KSU3O3Quc2V0RGF0ZSh0LmdldERhdGUoKS1lKzMpO3ZhciBuPXQudmFsdWVPZigpO3JldHVybiB0LnNldE1vbnRoKDAsMSksNCE9PXQuZ2V0RGF5KCkmJnQuc2V0TW9udGgoMCwxKyg0LXQuZ2V0RGF5KCkrNyklNyksMStNYXRoLmNlaWwoKG4tdCkvNjA0OGU1KX0sRjpmdW5jdGlvbigpe3JldHVybiBEYXRlLmxvbmdNb250aHNbdGhpcy5nZXRNb250aCgpXX0sbTpmdW5jdGlvbigpe3JldHVybih0aGlzLmdldE1vbnRoKCk8OT8iMCI6IiIpKyh0aGlzLmdldE1vbnRoKCkrMSl9LE06ZnVuY3Rpb24oKXtyZXR1cm4gRGF0ZS5zaG9ydE1vbnRoc1t0aGlzLmdldE1vbnRoKCldfSxuOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZ2V0TW9udGgoKSsxfSx0OmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5nZXRGdWxsWWVhcigpLGU9dGhpcy5nZXRNb250aCgpKzE7cmV0dXJuIDEyPT09ZSYmKHQ9dCsrLGU9MCksbmV3IERhdGUodCxlLDApLmdldERhdGUoKX0sTDpmdW5jdGlvbigpe3ZhciB0PXRoaXMuZ2V0RnVsbFllYXIoKTtyZXR1cm4gdCU0MDA9PTB8fHQlMTAwIT0wJiZ0JTQ9PTB9LG86ZnVuY3Rpb24oKXt2YXIgdD1uZXcgRGF0ZSh0aGlzLnZhbHVlT2YoKSk7cmV0dXJuIHQuc2V0RGF0ZSh0LmdldERhdGUoKS0odGhpcy5nZXREYXkoKSs2KSU3KzMpLHQuZ2V0RnVsbFllYXIoKX0sWTpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldEZ1bGxZZWFyKCl9LHk6ZnVuY3Rpb24oKXtyZXR1cm4oIiIrdGhpcy5nZXRGdWxsWWVhcigpKS5zdWJzdHIoMil9LGE6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5nZXRIb3VycygpPDEyPyJhbSI6InBtIn0sQTpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldEhvdXJzKCk8MTI/IkFNIjoiUE0ifSxCOmZ1bmN0aW9uKCl7cmV0dXJuIE1hdGguZmxvb3IoMWUzKigodGhpcy5nZXRVVENIb3VycygpKzEpJTI0K3RoaXMuZ2V0VVRDTWludXRlcygpLzYwK3RoaXMuZ2V0VVRDU2Vjb25kcygpLzM2MDApLzI0KX0sZzpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldEhvdXJzKCklMTJ8fDEyfSxHOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZ2V0SG91cnMoKX0saDpmdW5jdGlvbigpe3JldHVybigodGhpcy5nZXRIb3VycygpJTEyfHwxMik8MTA/IjAiOiIiKSsodGhpcy5nZXRIb3VycygpJTEyfHwxMil9LEg6ZnVuY3Rpb24oKXtyZXR1cm4odGhpcy5nZXRIb3VycygpPDEwPyIwIjoiIikrdGhpcy5nZXRIb3VycygpfSxpOmZ1bmN0aW9uKCl7cmV0dXJuKHRoaXMuZ2V0TWludXRlcygpPDEwPyIwIjoiIikrdGhpcy5nZXRNaW51dGVzKCl9LHM6ZnVuY3Rpb24oKXtyZXR1cm4odGhpcy5nZXRTZWNvbmRzKCk8MTA/IjAiOiIiKSt0aGlzLmdldFNlY29uZHMoKX0sdTpmdW5jdGlvbigpe3ZhciB0PXRoaXMuZ2V0TWlsbGlzZWNvbmRzKCk7cmV0dXJuKDEwPnQ/IjAwIjoxMDA+dD8iMCI6IiIpK3R9LGU6ZnVuY3Rpb24oKXtyZXR1cm4vXCgoLiopXCkvLmV4ZWMoKG5ldyBEYXRlKS50b1N0cmluZygpKVsxXX0sSTpmdW5jdGlvbigpe2Zvcih2YXIgdD1udWxsLGU9MDsxMj5lOysrZSl7dmFyIG49bmV3IERhdGUodGhpcy5nZXRGdWxsWWVhcigpLGUsMSksaT1uLmdldFRpbWV6b25lT2Zmc2V0KCk7aWYobnVsbD09PXQpdD1pO2Vsc2V7aWYodD5pKXt0PWk7YnJlYWt9aWYoaT50KWJyZWFrfX1yZXR1cm4gdGhpcy5nZXRUaW1lem9uZU9mZnNldCgpPT10fDB9LE86ZnVuY3Rpb24oKXtyZXR1cm4oLXRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKTwwPyItIjoiKyIpKyhNYXRoLmFicyh0aGlzLmdldFRpbWV6b25lT2Zmc2V0KCkvNjApPDEwPyIwIjoiIikrTWF0aC5mbG9vcihNYXRoLmFicyh0aGlzLmdldFRpbWV6b25lT2Zmc2V0KCkvNjApKSsoMD09TWF0aC5hYnModGhpcy5nZXRUaW1lem9uZU9mZnNldCgpJTYwKT8iMDAiOihNYXRoLmFicyh0aGlzLmdldFRpbWV6b25lT2Zmc2V0KCklNjApPDEwPyIwIjoiIikrTWF0aC5hYnModGhpcy5nZXRUaW1lem9uZU9mZnNldCgpJTYwKSl9LFA6ZnVuY3Rpb24oKXtyZXR1cm4oLXRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKTwwPyItIjoiKyIpKyhNYXRoLmFicyh0aGlzLmdldFRpbWV6b25lT2Zmc2V0KCkvNjApPDEwPyIwIjoiIikrTWF0aC5mbG9vcihNYXRoLmFicyh0aGlzLmdldFRpbWV6b25lT2Zmc2V0KCkvNjApKSsiOiIrKDA9PU1hdGguYWJzKHRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKSU2MCk/IjAwIjooTWF0aC5hYnModGhpcy5nZXRUaW1lem9uZU9mZnNldCgpJTYwKTwxMD8iMCI6IiIpK01hdGguYWJzKHRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKSU2MCkpfSxUOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMudG9UaW1lU3RyaW5nKCkucmVwbGFjZSgvXi4rIFwoPyhbXlwpXSspXCk/JC8sIiQxIil9LFo6ZnVuY3Rpb24oKXtyZXR1cm4gNjAqLXRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKX0sYzpmdW5jdGlvbigpe3JldHVybiB0aGlzLmZvcm1hdCgiWS1tLWRcXFRIOmk6c1AiKX0scjpmdW5jdGlvbigpe3JldHVybiB0aGlzLnRvU3RyaW5nKCl9LFU6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5nZXRUaW1lKCkvMWUzfX07RGF0ZS5wcm90b3R5cGUuZm9ybWF0PWZ1bmN0aW9uKGUpe3ZhciBuPXRoaXM7cmV0dXJuIGUucmVwbGFjZSgvKFxcPykoLikvZyxmdW5jdGlvbihlLGkscil7cmV0dXJuIiI9PT1pJiZ0W3JdP3Rbcl0uY2FsbChuKTpyfSl9fSkuY2FsbCh0aGlzKTsKCmZ1bmN0aW9uIGdvdG9DbGllbnRQYWdlKGJ1c2luZXNzX3VzZXJfaWQpCnsKICB3aW5kb3cubG9jYXRpb24uaHJlZj0nLyMvYnVzaW5lc3NfY2xpZW50cy8nICsgYnVzaW5lc3NfdXNlcl9pZDsKfQpmdW5jdGlvbiBnb3RvSW5zdHJ1Y3RvclBhZ2UoYnVzaW5lc3NfdXNlcl9pZCkKewogIHdpbmRvdy5sb2NhdGlvbi5ocmVmPScvIy9idXNpbmVzc19pbnN0cnVjdG9ycy8nICsgYnVzaW5lc3NfdXNlcl9pZDsKfQoKZnVuY3Rpb24gZ290b0V2ZW50UGFnZSh0aGVldmVudCkKewogIGxvZ0RlYnVnKCJnb3RvRXZlbnRQYWdlICIrdGhlZXZlbnQpOwogIGlmICh0aGVldmVudC5pc19jbGFzcz09MSkKICB7CiAgICB3aW5kb3cubG9jYXRpb24uaHJlZj0nLyMvZXZlbnRfY2xhc3MvJyArIHRoZWV2ZW50LmV2ZW50X2lkOwogIH0KICBlbHNlCiAgewogICAgd2luZG93LmxvY2F0aW9uLmhyZWY9Jy8jL2V2ZW50LycgKyB0aGVldmVudC5ldmVudF9pZDsKICB9Cn0KCmZ1bmN0aW9uIGdvdG9Mb2NhdGlvblBhZ2UobG9jYXRpb25faWQpCnsKICBsb2dEZWJ1ZygiZ290b0xvY2F0aW9uUGFnZSAiK2xvY2F0aW9uX2lkKTsKICB3aW5kb3cubG9jYXRpb24uaHJlZj0nLyMvYnVzaW5lc3NfbG9jYXRpb25zLycgKyBsb2NhdGlvbl9pZDsKCn0KCmZ1bmN0aW9uIGdvdG9DbGllbnRFZGl0UGFnZSh1c2VyX2lkKQp7CiAgd2luZG93LmxvY2F0aW9uLmhyZWY9Jy8jL2J1c2luZXNzX2NsaWVudHMvJyArIHVzZXJfaWQgKyAnL2VkaXQnOwp9CgpmdW5jdGlvbiBnb3RvQmFjaygpCnsKICB3aW5kb3cuaGlzdG9yeS5iYWNrKCk7Cn0KCmZ1bmN0aW9uIHNob3dFdmVudFBvcHVwKHNlbGVjdGVkRXZlbnQsICR1aWJNb2RhbCkKewogIC8vIHRoaXMgZnVuY3Rpb24gdXNlZCB0byBicmluZyBhIHBvcHVwCiAgLy8gbm93IGl0IGdvZXMgdG8gdGhlIGV2ZW50IHBhZ2UKICBnb3RvRXZlbnRQYWdlKHNlbGVjdGVkRXZlbnQpOwoKICAvLyBpZiAoc2VsZWN0ZWRFdmVudC5pc19yZXBlYXRpbmcgPT0gMSkgewogIC8vICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAvLyAgICAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgLy8gICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9jbGFzc19zaW5nbGUucGhwJywKICAvLyAgICAgICAgIGNvbnRyb2xsZXI6ICdldmVudFJlY3VycmluZ0RldGFpbHNCdXNpbmVzc0NhbGVuZGFyTW9kYWxDb250cm9sbGVyJywKICAvLyAgICAgICAgIC8vIHNpemU6IHNpemUsCiAgLy8gICAgICAgICByZXNvbHZlOiB7CiAgLy8gICAgICAgICAgICAgc2VsZWN0ZWRFdmVudDogZnVuY3Rpb24oKSB7CiAgLy8gICAgICAgICAgICAgICAgIHJldHVybiBzZWxlY3RlZEV2ZW50OwogIC8vICAgICAgICAgICAgIH0KICAvLyAgICAgICAgIH0KICAvLyAgICAgfSk7CiAgLy8gfSBlbHNlIHsKICAvLyAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgLy8gICAgICAgICBhbmltYXRpb246IGZhbHNlLAogIC8vICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfZXZlbnRfc2luZ2xlLnBocCcsCiAgLy8gICAgICAgICBjb250cm9sbGVyOiAnZXZlbnREZXRhaWxzQnVzaW5lc3NDYWxlbmRhck1vZGFsQ29udHJvbGxlcicsCiAgLy8gICAgICAgICAvLyBzaXplOiBzaXplLAogIC8vICAgICAgICAgcmVzb2x2ZTogewogIC8vICAgICAgICAgICAgIHNlbGVjdGVkRXZlbnQ6IGZ1bmN0aW9uKCkgewogIC8vICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZWN0ZWRFdmVudDsKICAvLyAgICAgICAgICAgICB9CiAgLy8gICAgICAgICB9CiAgLy8gICAgIH0pOwogIC8vIH0KfQpmdW5jdGlvbiB1cGRhdGVHbG9iYWxMYW5ndWFnZSgkc2NvcGUsICRuZXdsYW5nKSB7CgogICAgLy8JdmFyIGdMYW5nPWdMYW5nQmFzZVtnTGFuZ0N1cnJdOwogICAgJGdMYW5nID0gZ0xhbmdCYXNlWyRuZXdsYW5nXTsKICAgIC8vIGxvZ0RlYnVnKCJnTGFuZ0Jhc2VbJG5ld2xhbmddWyd0aXRsZTEnXT0iICsgZ0xhbmdCYXNlWyRuZXdsYW5nXVsndGl0bGUxJ10pOwogICAgLy8gbG9nRGVidWcoImxhbmd1Z2FnZToiICsgJGdMYW5nWydsYW5ndWFnZSddKTsKICAgIC8vCWxvZ0RlYnVnKCJsYW5ndWdhZ2UgZGlyOiAiKyRnTGFuZ1snZGlyJ10pOwogICAgLy8JbG9nRGVidWcoImNoYW5naW5nIGxhbmd1YWdlIHRvICIrJG5ld2xhbmcpCiAgICAkc2NvcGUuc3BDbGFzcyA9ICRnTGFuZ1snY2xhc3MnXTsKICAgIC8vCWxvZ0RlYnVnKCJpcyBhcnJheT8gIithbmd1bGFyLmlzQXJyYXkoJGdMYW5nKSk7CiAgICAvLwlsb2dEZWJ1ZygiJGdMYW5nWydkaXInXT0iKyRnTGFuZ1snZGlyJ10pOwogICAgLy8JbG9nRGVidWcoIiRnTGFuZ1sndGl0bGUxJ109IiskZ0xhbmdbJ3RpdGxlMSddKTsKICAgICRzY29wZS5sYW5nZmlsZSA9ICRnTGFuZzsKICAgIC8vIGxvZ0RlYnVnKCJpcyBhcnJheT8gIiArIGFuZ3VsYXIuaXNBcnJheSgkc2NvcGUubGFuZ2ZpbGUpKTsKICAgIC8vIGxvZ0RlYnVnKCIkc2NvcGUubGFuZ2ZpbGU9IiArICRzY29wZS5sYW5nZmlsZSk7CiAgICAvLyBsb2dEZWJ1ZygiJHNjb3BlLmxhbmdmaWxlWyd0aXRsZTEnXT0iICsgJHNjb3BlLmxhbmdmaWxlWyd0aXRsZTEnXSk7CgogICAgJHNjb3BlLnRlc3RuZXd2YXIgPSAkc2NvcGUubGFuZ2ZpbGVbJ3RpdGxlMSddOwogICAgLy8JJHNjb3BlLm1lc3NhZ2U9JHNjb3BlLmxhbmdmaWxlWyd0aXRsZTEnXTsKfQoKZnVuY3Rpb24gZ2V0UmFuZG9tQ29sb3IoKSB7CiAgICB2YXIgbGV0dGVycyA9ICcwMTIzNDU2Nzg5QUJDREVGJy5zcGxpdCgnJyk7CiAgICB2YXIgY29sb3IgPSAnIyc7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IDY7IGkrKykgewogICAgICAgIGNvbG9yICs9IGxldHRlcnNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTYpXTsKICAgIH0KICAgIHJldHVybiBjb2xvcjsKfQoKZnVuY3Rpb24gZ2V0UmFuZG9tSW50KG1pbiwgbWF4KSB7CiAgICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKG1heCAtIG1pbiArIDEpKSArIG1pbjsKfQoKZnVuY3Rpb24gY2FsY190ZW1wX2xpbWl0X2lkKCkgewogICAgdmFyIGQgPSBuZXcgRGF0ZSgpOwogICAgdmFyIHJhbmRvbWxpbWl0ID0gZC5nZXRUaW1lKCk7CiAgICBsb2dEZWJ1ZygiY2FsY190ZW1wX2xpbWl0X2lkPSIgKyByYW5kb21saW1pdCk7CiAgICByZXR1cm4gcmFuZG9tbGltaXQ7Cn0KCnZhciAkZ0xvZ0xldmVsID0gJ2RlYnVnJzsKCi8vIHN0YXJ0aW5nCmxvZ0RlYnVnKCJtYWluICRnTG9nTGV2ZWw9IiArICRnTG9nTGV2ZWwpOwpsb2dEZWJ1ZygiaW5pdGlhbGl6ZSBhbmd1bGFyIik7CmxvZ0RlYnVnKCJpbml0aWFsaXppbmcgbW9kdWxlcyAiICsgJGFuZ3VsYXJNb2R1bGVzKTsKCnZhciBrdXplQXBwID0gYW5ndWxhci5tb2R1bGUoJ2t1emVBcHAnLCAkYW5ndWxhck1vZHVsZXMpCgovLyRyb290U2NvcGUuc3BDbGFzcyA9ICdyaWdodCc7Cmt1emVSdW4gPSBmdW5jdGlvbigpIHsKCn0Ka3V6ZUFwcC5ydW4oWwogICAgJyRidWlsZGVyJywKICAgIGZ1bmN0aW9uKCRidWlsZGVyKSB7CiAgICAgICAgLy8gbG9nRGVidWcoImluc2lkZSBrdXplQXBwLnJ1biIpOwogICAgICAgICRidWlsZGVyLnJlZ2lzdGVyQ29tcG9uZW50KCdzYW1wbGVJbnB1dCcsIHsKICAgICAgICAgICAgZ3JvdXA6ICdmcm9tIGh0bWwnLAogICAgICAgICAgICBsYWJlbDogJ1NhbXBsZScsCiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnRnJvbSBodG1sIHRlbXBsYXRlJywKICAgICAgICAgICAgcGxhY2Vob2xkZXI6ICdwbGFjZWhvbGRlcicsCiAgICAgICAgICAgIHJlcXVpcmVkOiBmYWxzZSwKICAgICAgICAgICAgdmFsaWRhdGlvbk9wdGlvbnM6IFt7CiAgICAgICAgICAgICAgICBsYWJlbDogJ25vbmUnLAogICAgICAgICAgICAgICAgcnVsZTogJy8uKi8nCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgIGxhYmVsOiAnbnVtYmVyJywKICAgICAgICAgICAgICAgIHJ1bGU6ICdbbnVtYmVyXScKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgbGFiZWw6ICdlbWFpbCcsCiAgICAgICAgICAgICAgICBydWxlOiAnW2VtYWlsXScKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgbGFiZWw6ICd1cmwnLAogICAgICAgICAgICAgICAgcnVsZTogJ1t1cmxdJwogICAgICAgICAgICB9XSwKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYW5ndWxhci1mb3JtLWJ1aWxkZXIvZXhhbXBsZS90ZW1wbGF0ZS5odG1sJywKICAgICAgICAgICAgcG9wb3ZlclRlbXBsYXRlVXJsOiAnL2FuZ3VsYXItZm9ybS1idWlsZGVyL2V4YW1wbGUvcG9wb3ZlclRlbXBsYXRlLmh0bWwnCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuICRidWlsZGVyLnJlZ2lzdGVyQ29tcG9uZW50KCduYW1lJywgewogICAgICAgICAgICBncm91cDogJ0RlZmF1bHQnLAogICAgICAgICAgICBsYWJlbDogJ05hbWUnLAogICAgICAgICAgICByZXF1aXJlZDogZmFsc2UsCiAgICAgICAgICAgIGFycmF5VG9UZXh0OiB0cnVlLAogICAgICAgICAgICB0ZW1wbGF0ZTogIjxkaXYgY2xhc3M9XCJmb3JtLWdyb3VwXCI+XG4gICAgPGxhYmVsIGZvcj1cInt7Zm9ybU5hbWUraW5kZXh9fVwiIGNsYXNzPVwiY29sLW1kLTQgY29udHJvbC1sYWJlbFwiIG5nLWNsYXNzPVwieydmYi1yZXF1aXJlZCc6cmVxdWlyZWR9XCI+e3tsYWJlbH19PC9sYWJlbD5cbiAgICA8ZGl2IGNsYXNzPVwiY29sLW1kLThcIj5cbiAgICAgICAgPGlucHV0IHR5cGU9J2hpZGRlbicgbmctbW9kZWw9XCJpbnB1dFRleHRcIiB2YWxpZGF0b3ItcmVxdWlyZWQ9XCJ7e3JlcXVpcmVkfX1cIiB2YWxpZGF0b3ItZ3JvdXA9XCJ7e2Zvcm1OYW1lfX1cIi8+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJjb2wtc20tNlwiIHN0eWxlPVwicGFkZGluZy1sZWZ0OiAwO1wiPlxuICAgICAgICAgICAgPGlucHV0IHR5cGU9XCJ0ZXh0XCJcbiAgICAgICAgICAgICAgICBuZy1tb2RlbD1cImlucHV0QXJyYXlbMF1cIlxuICAgICAgICAgICAgICAgIGNsYXNzPVwiZm9ybS1jb250cm9sXCIgaWQ9XCJ7e2Zvcm1OYW1lK2luZGV4fX0tMFwiLz5cbiAgICAgICAgICAgIDxwIGNsYXNzPSdoZWxwLWJsb2NrJz5GaXJzdCBuYW1lPC9wPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImNvbC1zbS02XCIgc3R5bGU9XCJwYWRkaW5nLWxlZnQ6IDA7XCI+XG4gICAgICAgICAgICA8aW5wdXQgdHlwZT1cInRleHRcIlxuICAgICAgICAgICAgICAgIG5nLW1vZGVsPVwiaW5wdXRBcnJheVsxXVwiXG4gICAgICAgICAgICAgICAgY2xhc3M9XCJmb3JtLWNvbnRyb2xcIiBpZD1cInt7Zm9ybU5hbWUraW5kZXh9fS0xXCIvPlxuICAgICAgICAgICAgPHAgY2xhc3M9J2hlbHAtYmxvY2snPkxhc3QgbmFtZTwvcD5cbiAgICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG48L2Rpdj4iLAogICAgICAgICAgICBwb3BvdmVyVGVtcGxhdGU6ICI8Zm9ybT5cbiAgICA8ZGl2IGNsYXNzPVwiZm9ybS1ncm91cFwiPlxuICAgICAgICA8bGFiZWwgY2xhc3M9J2NvbnRyb2wtbGFiZWwnPkxhYmVsPC9sYWJlbD5cbiAgICAgICAgPGlucHV0IHR5cGU9J3RleHQnIG5nLW1vZGVsPVwibGFiZWxcIiB2YWxpZGF0b3I9XCJbcmVxdWlyZWRdXCIgY2xhc3M9J2Zvcm0tY29udHJvbCcvPlxuICAgIDwvZGl2PlxuICAgIDxkaXYgY2xhc3M9XCJjaGVja2JveFwiPlxuICAgICAgICA8bGFiZWw+XG4gICAgICAgICAgICA8aW5wdXQgdHlwZT0nY2hlY2tib3gnIG5nLW1vZGVsPVwicmVxdWlyZWRcIiAvPlxuICAgICAgICAgICAgUmVxdWlyZWRcbiAgICAgICAgPC9sYWJlbD5cbiAgICA8L2Rpdj5cblxuICAgIDxoci8+XG4gICAgPGRpdiBjbGFzcz0nZm9ybS1ncm91cCc+XG4gICAgICAgIDxpbnB1dCB0eXBlPSdzdWJtaXQnIG5nLWNsaWNrPVwicG9wb3Zlci5zYXZlKCRldmVudClcIiBjbGFzcz0nYnRuIGJ0bi1wcmltYXJ5JyB2YWx1ZT0nU2F2ZScvPlxuICAgICAgICA8aW5wdXQgdHlwZT0nYnV0dG9uJyBuZy1jbGljaz1cInBvcG92ZXIuY2FuY2VsKCRldmVudClcIiBjbGFzcz0nYnRuIGJ0bi1kZWZhdWx0JyB2YWx1ZT0nQ2FuY2VsJy8+XG4gICAgICAgIDxpbnB1dCB0eXBlPSdidXR0b24nIG5nLWNsaWNrPVwicG9wb3Zlci5yZW1vdmUoJGV2ZW50KVwiIGNsYXNzPSdidG4gYnRuLWRhbmdlcicgdmFsdWU9J0RlbGV0ZScvPlxuICAgIDwvZGl2PlxuPC9mb3JtPiIKICAgICAgICB9KTsKICAgIH0KXSkKCi8vIERFTEVURUQgLSB4ZWRpdGFibGUgc3R1ZmYKLy8ga3V6ZUFwcC5ydW4oZnVuY3Rpb24oZWRpdGFibGVPcHRpb25zLCBlZGl0YWJsZVRoZW1lcykgewovLyAgICAgbG9nRGVidWcoImluaXRpYWxpemluZyB4ZWRpdGFibGUgZWRpdGFibGVPcHRpb25zIik7Ci8vICAgICBlZGl0YWJsZU9wdGlvbnMudGhlbWUgPSAnYnMzJzsgLy8gYm9vdHN0cmFwMyB0aGVtZS4gQ2FuIGJlIGFsc28gJ2JzMicsICdkZWZhdWx0JwovLyAgICAgLy8gZWRpdGFibGVPcHRpb25zLmRlZmF1bHRzLm1vZGUgPSAnaW5saW5lJzsKLy8gICAgIGxvZ0RlYnVnKGVkaXRhYmxlT3B0aW9ucyk7Ci8vICAgICAvLyBlZGl0YWJsZU9wdGlvbnMubW9kZSA9ICdpbmxpbmUnOwovLyAgICAgZWRpdGFibGVUaGVtZXMuYnMzLmlucHV0Q2xhc3MgPSAnaW5wdXQtc20nOwovLyAgICAgZWRpdGFibGVUaGVtZXMuYnMzLmJ1dHRvbnNDbGFzcyA9ICdidG4tc20nOwovLyB9KTsKCi8vIGFmdGVyIGZvcm1zCi8vRGVmaW5lIFJvdXRpbmcgZm9yIGFwcAovL1VyaSAvQWRkTmV3T3JkZXIgLT4gdGVtcGxhdGUgYWRkX29yZGVyLmh0bWwgYW5kIENvbnRyb2xsZXIgQ2xpZW50c0FkZENvbnRyb2xsZXIKLy9VcmkgL1Nob3dPcmRlcnMgLT4gdGVtcGxhdGUgc2hvd19vcmRlcnMuaHRtbCBhbmQgQ29udHJvbGxlciBDbGllbnRzQWRkQ29udHJvbGxlcgprdXplQXBwLmNvbmZpZyhbJyRyb3V0ZVByb3ZpZGVyJywKICAgIGZ1bmN0aW9uKCRyb3V0ZVByb3ZpZGVyKSB7CiAgICAgICAgLy8gbG9nRGVidWcoJHJvdXRlUHJvdmlkZXIpOwogICAgICAgICRyb3V0ZVByb3ZpZGVyLgogICAgICAgIC8vIHdoZW4oJy9jbGllbnRjYXJkJywgewogICAgICAgIC8vICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19jbGllbnRfY2FyZC5odG1sJywKICAgICAgICAvLyAgICAgY29udHJvbGxlcjogJ2NsaWVudENhcmRDb250cm9sbGVyJwogICAgICAgIC8vIH0pLgogICAgICAgIHdoZW4oJy9jb250YWN0JywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdjb250YWN0LnBocCcsCiAgICAgICAgICAgIC8vIGNvbnRyb2xsZXI6ICdlbmRVc2VySG9tZUNvbnRyb2xsZXInCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdjb250YWN0Q29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvZXZlbnRfdHlwZXMnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2V2ZW50X3R5cGVzLmh0bWwnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnRXZlbnRUeXBlc0NvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2V2ZW50X3R5cGVzL2FkZCcsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfZXZlbnRfdHlwZV9hZGQucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0V2ZW50VHlwZU5ld0NvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2V2ZW50X3R5cGVzLzpldmVudF90eXBlX2lkJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19ldmVudF90eXBlX2FkZC5waHAnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnRXZlbnRUeXBlVXBkYXRlQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvaG91cnNfb2Zfd29yaycsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfaG91cnNfb2Zfd29yay5odG1sJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0hvdXJzT2ZXb3JrQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvYnVzaW5lc3NfY2FsZW5kYXInLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2NhbGVuZGFyLmh0bWwnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnQnVzaW5lc3NDYWxlbmRhckNvbnRyb2xsZXInLAogICAgICAgICAgICByZWxvYWRPblNlYXJjaDogZmFsc2UKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvYW5ndWxhci1mb3JtLWJ1aWxkZXInLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2FuZ3VsYXItZm9ybS1idWlsZGVyL2luZGV4Lmh0bWwnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnRGVtb0NvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2J1c2luZXNzX2NsaWVudHMvYWRkJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19jbGllbnRzX2FkZC5odG1sJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0NsaWVudHNBZGRDb250cm9sbGVyJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9idXNpbmVzc19jbGllbnRzJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19jbGllbnRzLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdDbGllbnRzU2hvd0NvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2J1c2luZXNzX2NsaWVudHMvOmJ1c2luZXNzX3VzZXJfaWQnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2NsaWVudF9jYXJkLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdDbGllbnRzU2hvdzFDb250cm9sbGVyJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9idXNpbmVzc19yZXBvcnRzJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19yZXBvcnRzLmh0bWwnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnQnVzaW5lc3NSZXBvcnRzQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvYnVzaW5lc3NfaW5zdHJ1Y3RvcnMnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2luc3RydWN0b3JzLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdJbnN0cnVjdG9yc1Nob3dDb250cm9sbGVyJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9idXNpbmVzc19pbnN0cnVjdG9ycy9hZGQnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2NsaWVudHNfYWRkLmh0bWwnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnSW5zdHJ1Y3RvcnNBZGRDb250cm9sbGVyJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9idXNpbmVzc19sb2NhdGlvbnMnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2xvY2F0aW9ucy5waHAnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnYnVzaW5lc3NfbG9jYXRpb25zJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9idXNpbmVzc19sb2NhdGlvbnMvYWRkJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19sb2NhdGlvbnNfYWRkLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdidXNpbmVzc19sb2NhdGlvbnNfYWRkJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9idXNpbmVzc19sb2NhdGlvbnMvOmxvY2F0aW9uX2lkJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19sb2NhdGlvbnNfYWRkLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdidXNpbmVzc19sb2NhdGlvbnNfdXBkYXRlJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9idXNpbmVzc19pbnN0cnVjdG9ycy86YnVzaW5lc3NfdXNlcl9pZCcsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfaW5zdHJ1Y3Rvcl9jYXJkLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdJbnN0cnVjdG9yU2hvdzFDb250cm9sbGVyJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9ldmVudC86ZXZlbnRfaWQnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2V2ZW50X2NhcmQucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0V2ZW50UGFnZUNvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2V2ZW50X2NsYXNzLzpldmVudF9pZCcsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfZXZlbnRfY2xhc3NfY2FyZC5odG1sJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0V2ZW50Q2xhc3NQYWdlQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvcGFja2FnZXMnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX3BhY2thZ2VzX3Nob3cucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ1BhY2thZ2VzQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvcGFja2FnZXMvYWRkJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19wYWNrYWdlc19jcmVhdGUucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ2J1c2luZXNzX3BhY2thZ2VzX2FkZF9jbnRsJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9wYWNrYWdlcy86cGFja2FnZV9pZCcsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfcGFja2FnZXNfY3JlYXRlLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdidXNpbmVzc19wYWNrYWdlc191cGRhdGVfY250bCcKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvYnVzaW5lc3NfY29uZmlnJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19jb25maWcucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0NvbmZpZ0J1c2luZXNzQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvdXNlcl9jb25maWcnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ3VzZXJfY29uZmlnLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdDb25maWdVc2VyQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvYnVzaW5lc3NfZG9jcycsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfZG9jcy5odG1sJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0J1c2luZXNzRG9jc0NvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignLycsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnaG9tZS5waHAnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnSG9tZUNvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgb3RoZXJ3aXNlKHsKICAgICAgICAgICAgLy8gICAgcmVkaXJlY3RUbzogJy8nCiAgICAgICAgfSk7CiAgICB9Cl0pOwoKa3V6ZUFwcC5mYWN0b3J5KCdzaGFyZWREYXRhJywgZnVuY3Rpb24oKSB7CiAgICB2YXIgc2VsZWN0ZWRFbmRVc2VyID0gbnVsbDsKCiAgICByZXR1cm4gewogICAgICAgIGdldFNlbGVjdGVkRW5kVXNlcjogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIC8vWW91IGNvdWxkIGFsc28gcmV0dXJuIHNwZWNpZmljIGF0dHJpYnV0ZSBvZiB0aGUgZm9ybSBkYXRhIGluc3RlYWQKICAgICAgICAgICAgLy9vZiB0aGUgZW50aXJlIGRhdGEKICAgICAgICAgICAgcmV0dXJuIHNlbGVjdGVkRW5kVXNlcjsKICAgICAgICB9LAogICAgICAgIHNldFNlbGVjdGVkRW5kVXNlcjogZnVuY3Rpb24obmV3U2VsZWN0ZWRFbmRVc2VyKSB7CiAgICAgICAgICAgIC8vWW91IGNvdWxkIGFsc28gc2V0IHNwZWNpZmljIGF0dHJpYnV0ZSBvZiB0aGUgZm9ybSBkYXRhIGluc3RlYWQKICAgICAgICAgICAgc2VsZWN0ZWRFbmRVc2VyID0gbmV3U2VsZWN0ZWRFbmRVc2VyOwogICAgICAgIH0sCiAgICB9Owp9KTsKCmt1emVBcHAuZGlyZWN0aXZlKCdjb252ZXJ0VG9OdW1iZXInLCBmdW5jdGlvbigpIHsKICByZXR1cm4gewogICAgcmVxdWlyZTogJ25nTW9kZWwnLAogICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGVsZW1lbnQsIGF0dHJzLCBuZ01vZGVsKSB7CiAgICAgIG5nTW9kZWwuJHBhcnNlcnMucHVzaChmdW5jdGlvbih2YWwpIHsKICAgICAgICByZXR1cm4gdmFsICE9IG51bGwgPyBwYXJzZUludCh2YWwsIDEwKSA6IG51bGw7CiAgICAgIH0pOwogICAgICBuZ01vZGVsLiRmb3JtYXR0ZXJzLnB1c2goZnVuY3Rpb24odmFsKSB7CiAgICAgICAgcmV0dXJuIHZhbCAhPSBudWxsID8gJycgKyB2YWwgOiBudWxsOwogICAgICB9KTsKICAgIH0KICB9Owp9KTsKCmt1emVBcHAuZGlyZWN0aXZlKCdlbGFzdGljJywgWwogICAgJyR0aW1lb3V0JywKICAgIGZ1bmN0aW9uKCR0aW1lb3V0KSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJywKICAgICAgICAgICAgbGluazogZnVuY3Rpb24oJHNjb3BlLCBlbGVtZW50KSB7CiAgICAgICAgICAgICAgICAkc2NvcGUuaW5pdGlhbEhlaWdodCA9ICRzY29wZS5pbml0aWFsSGVpZ2h0IHx8IGVsZW1lbnRbMF0uc3R5bGUuaGVpZ2h0OwogICAgICAgICAgICAgICAgdmFyIHJlc2l6ZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIGVsZW1lbnRbMF0uc3R5bGUuaGVpZ2h0ID0gJHNjb3BlLmluaXRpYWxIZWlnaHQ7CiAgICAgICAgICAgICAgICAgICAgZWxlbWVudFswXS5zdHlsZS5oZWlnaHQgPSAiIiArIGVsZW1lbnRbMF0uc2Nyb2xsSGVpZ2h0ICsgInB4IjsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBlbGVtZW50Lm9uKCJpbnB1dCBjaGFuZ2UiLCByZXNpemUpOwogICAgICAgICAgICAgICAgLy8gZWxlbWVudC5vbigiaW5wdXQgY2hhbmdlIiwgcmVzaXplKTsKICAgICAgICAgICAgICAgICR0aW1lb3V0KHJlc2l6ZSwgMCk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgfQpdKTsKCmt1emVBcHAuc2VydmljZSgnc2hhcmVkUHJvcGVydGllcycsIGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgc2VsZWN0ZWRfdXNlciA9IG51bGw7CiAgICAgICAgdmFyIGNhbGVuZGFyX2RhdGUgPSBudWxsOwogICAgICAgIHZhciBldmVudF9yZXNjaGVkdWxlID0gbnVsbDsKICAgICAgICB2YXIgc2VsZWN0ZWRfaW5zdHJ1Y3RvciA9IDA7CiAgICAgICAgdmFyIGV2ZW50X3R5cGVfZm9yX3N1Z2dlc3Rpb25zID0gbnVsbDsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBnZXRfc2VsZWN0ZWRfaW5zdHJ1Y3RvcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGVjdGVkX2luc3RydWN0b3I7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNldF9zZWxlY3RlZF9pbnN0cnVjdG9yOiBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgICAgICAgICAgc2VsZWN0ZWRfaW5zdHJ1Y3RvciA9IHZhbHVlOwogICAgICAgICAgICB9LAogICAgICAgICAgICBnZXRfc2VsZWN0ZWRfdXNlcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGVjdGVkX3VzZXI7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNldF9zZWxlY3RlZF91c2VyOiBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgICAgICAgICAgc2VsZWN0ZWRfdXNlciA9IHZhbHVlOwogICAgICAgICAgICB9LAogICAgICAgICAgICBzZXRfZXZlbnRfcmVzY2hlZHVsZTogZnVuY3Rpb24odmFsdWUpIHsKICAgICAgICAgICAgICAgIGV2ZW50X3Jlc2NoZWR1bGUgPSB2YWx1ZTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZ2V0X2V2ZW50X3Jlc2NoZWR1bGU6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBldmVudF9yZXNjaGVkdWxlOwogICAgICAgICAgICB9LAogICAgICAgICAgICBnZXRfY2FsZW5kYXJfZGF0ZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGNhbGVuZGFyX2RhdGU7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNldF9jYWxlbmRhcl9kYXRlOiBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgICAgICAgICAgY2FsZW5kYXJfZGF0ZSA9IHZhbHVlOwogICAgICAgICAgICB9LAogICAgICAgICAgICBnZXRfZXZlbnRfdHlwZV9mb3Jfc3VnZ2VzdGlvbnM6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBldmVudF90eXBlX2Zvcl9zdWdnZXN0aW9uczsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2V0X2V2ZW50X3R5cGVfZm9yX3N1Z2dlc3Rpb25zOiBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgICAgICAgICAgLy8gbG9nRGVidWcoInNldF9ldmVudF90eXBlX2Zvcl9zdWdnZXN0aW9ucz0iK3ZhbHVlKTsKICAgICAgICAgICAgICAgIGV2ZW50X3R5cGVfZm9yX3N1Z2dlc3Rpb25zID0gdmFsdWU7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ21lbnVDb250cm9sbGVyJywgWyckc2NvcGUnLCAnJGxvY2F0aW9uJywgZnVuY3Rpb24oJHNjb3BlLCAkbG9jYXRpb24pIHsKICAgIHJldHVybiB0cnVlOwogICAgbG9nRGVidWcoIiRzY29wZS5pc0N1cnJlbnRQYXRoPSIgKyAkc2NvcGUuaXNDdXJyZW50UGF0aCk7CiAgICAkc2NvcGUuaXNDdXJyZW50UGF0aCA9IGZ1bmN0aW9uKHBhdGgpIHsKICAgICAgICByZXR1cm4gJGxvY2F0aW9uLnBhdGgoKSA9PSBwYXRoOwogICAgfTsKfV0pOwoKCgprdXplQXBwLmNvbnRyb2xsZXIoJ0J1c2luZXNzUmVwb3J0c0NvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkbG9jYXRpb24sJHJvdXRlUGFyYW1zKQp7CgogIGxvZ0RlYnVnKCJjb250cm9sbGVyOiBCdXNpbmVzc1JlcG9ydHNDb250cm9sbGVyIik7CgogICRzY29wZS5vcmRlckJ5RmllbGQgPSAnc3RhcnRfZXBvY2gnOwogICRzY29wZS5yZXZlcnNlU29ydD10cnVlOwogICRzY29wZS5ldmVudE1vZGVsPXRydWU7CgogIGdldEJ1c2luZXNzTG9jYXRpb25zKCRodHRwLCRzY29wZSwnYnVzaW5lc3NfbG9jYXRpb25zJyk7CiAgZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzKCRodHRwLCRzY29wZSwnZXZlbnRfdHlwZXMnKTsKICBnZXRBbGxJbnN0cnVjdG9ycygkaHR0cCwkc2NvcGUsJ2luc3RydWN0b3JzJyk7CiAgZ2V0QWxsQ2xpZW50c0FuZEFyY2hpdmUoJGh0dHAsJHNjb3BlLCdjbGllbnRzJyk7CiAgJHNjb3BlLnN0YXR1c2VzID0gWyB7InN0YXR1c19pZCI6IjAiLCJzdGF0dXNfbmFtZSI6Itek16rXldeXIn0sIHsic3RhdHVzX2lkIjoiMSIsInN0YXR1c19uYW1lIjoi16HXkteV16gifV07CiAgJHNjb3BlLmNhbmNlbGxhdGlvbnMgPSBbIHsiaXNfY2FuY2VsZWQiOiIwIiwiY2FuY2VsbGF0aW9uX25hbWUiOiLXnNeQINeR15XXmNecIn0seyJpc19jYW5jZWxlZCI6IjEiLCJjYW5jZWxsYXRpb25fbmFtZSI6IteR15XXmNecIn1dOwogICRzY29wZS5tb250aHMgPSBbIHsibW9udGgiOiIxIn0seyJtb250aCI6IjIifSx7Im1vbnRoIjoiMyJ9LHsibW9udGgiOiI0In0seyJtb250aCI6IjUifSx7Im1vbnRoIjoiNiJ9LHsibW9udGgiOiI3In0seyJtb250aCI6IjgifSx7Im1vbnRoIjoiOSJ9LHsibW9udGgiOiIxMCJ9LHsibW9udGgiOiIxMSJ9LHsibW9udGgiOiIxMiJ9XTsKICAkc2NvcGUueWVhcnMgPSBbIHsieWVhciI6IjIwMTYifSx7InllYXIiOiIyMDE3In1dOwogICRzY29wZS5wZXJpb2RzID0gWwogICAgICB7InBlcmlvZF9uYW1lIjoi15TXmdeh15jXldeo15kiLCAicGVyaW9kX3NpZ24iOiItMSJ9LAogICAgICB7InBlcmlvZF9uYW1lIjoi15TXmdeV150iLCAicGVyaW9kX3NpZ24iOiIwIn0sCiAgICAgIHsicGVyaW9kX25hbWUiOiLXoteq15nXk9eZIiwgInBlcmlvZF9zaWduIjoiMSJ9LAogICAgXQoKICAkc2NvcGUuY3N2X2NvbHVtbnNfb3JkZXIgPSBbJ2V2ZW50X3R5cGVfbmFtZScsICdzdGFydF90aW1lJywgJ2V2ZW50X3VzZXJfY2xpZW50cycsICdpbnN0cnVjdG9yX25hbWUnLCAnaXNfY2FuY2VsZWQnLCAnaXNfY29tcGxldGVkJywgJ2FjdHVhbF9wcmljZScsICdwYXJ0aWNpcGF0ZWQnXTsKICAkc2NvcGUuY3N2X2NvbHVtbnNfaGVhZGVyID0gWyfXodeV15Ig157XpNeS16knLCAn16rXkNeo15nXmiDXldep16LXlCcsICfXntep16rXqtek15nXnScsICfXnteT16jXmdeaJywn157XkdeV15jXnCcsICfXodeS15XXqCcsICfXnteX15nXqCcsICfXntep16rXqtek15nXnSddOwoKCgogICRzY29wZS5nb3RvQ2xpZW50UGFnZT0gZnVuY3Rpb24gKGJ1c2luZXNzVXNlcmlkKSB7CiAgICBnb3RvQ2xpZW50UGFnZShidXNpbmVzc1VzZXJpZCk7CiAgfQoKICBmdW5jdGlvbiBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSh4LHZhbHVlKXsKICAgIGlmICggeCAhPSB1bmRlZmluZWQgKXsKICAgICAgdmFyIHgxID0gbmV3IEFycmF5KCk7CiAgICAgIGZvciAoaSA9IDA7IGkgPCB4Lmxlbmd0aDsgaSsrKXsKICAgICAgICB4MVtpXSA9IHhbaV1bdmFsdWVdOwogICAgICB9CiAgICAgIHgxID0geDEuam9pbigpOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgcmV0dXJuIHgxOwogIH0KCiAgJHNjb3BlLnJlcG9ydF9pc19sb2FkaW5nID0gZmFsc2U7CgogICRzY29wZS5ldmVudHNSZXBvcnQgPSBmdW5jdGlvbigpewogICAgbG9nRGVidWcoImV2ZW50c1JlcG9ydCIpOwoKICAgICRzY29wZS5zaG93QWdnID0gKCRzY29wZS5ldmVudFR5cGVNb2RlbCkgfHwKICAgICAoJHNjb3BlLmluc3RydWN0b3JNb2RlbCkgfHwgKCRzY29wZS5tb250aE1vZGVsKSB8fCAoJHNjb3BlLmNsaWVudHNNb2RlbCkgfHwgKCRzY29wZS55ZWFyTW9kZWwpIDsKCiAgICBldmVudF90eXBlX2lkX2ZpbHRlciA9IGxpc3RfdG9fc3RyaW5nX2J5X3ZhbHVlKCRzY29wZS5zZWxlY3RlZEV2ZW50VHlwZUZpbHRlciwgImV2ZW50X3R5cGVfaWQiICk7CiAgICBpbnN0cnVjdG9yX2lkX2ZpbHRlciA9IGxpc3RfdG9fc3RyaW5nX2J5X3ZhbHVlKCRzY29wZS5zZWxlY3RlZEluc3RydWN0b3JGaWx0ZXIsICJidXNpbmVzc191c2VyX2lkIiApOwogICAgbW9udGhfZmlsdGVyID0gbGlzdF90b19zdHJpbmdfYnlfdmFsdWUoJHNjb3BlLnNlbGVjdGVkTW9udGhGaWx0ZXIsICJtb250aCIgKTsKICAgIGNsaWVudF9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuc2VsZWN0ZWRDbGllbnRGaWx0ZXIsICJidXNpbmVzc191c2VyX2lkIiApOwogICAgeWVhcl9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuc2VsZWN0ZWRZZWFyRmlsdGVyLCAieWVhciIgKTsKICAgIHN0YXR1c19maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuc2VsZWN0ZWRTdGF0dXNGaWx0ZXIsICJzdGF0dXNfaWQiICk7CiAgICBpc19jYW5jZWxlZF9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuc2VsZWN0ZWRJc19jYW5jZWxlZEZpbHRlciwgImlzX2NhbmNlbGVkIiApOwogICAgcGVyaW9kX2ZpbHRlciA9IGxpc3RfdG9fc3RyaW5nX2J5X3ZhbHVlKCRzY29wZS5zZWxlY3RlZFBlcmlvZEZpbHRlciwgInBlcmlvZF9zaWduIiApOwoKICAgICRzY29wZS5ldmVudFJlcG9ydENvbmZpZyA9IHt9OwoKICAgICRzY29wZS5ldmVudFJlcG9ydENvbmZpZy5maWx0ZXJzID0gewogICAgICBldmVudF90eXBlX2lkOiBldmVudF90eXBlX2lkX2ZpbHRlciwKICAgICAgaW5zdHJ1Y3Rvcl9pZDogaW5zdHJ1Y3Rvcl9pZF9maWx0ZXIsCiAgICAgIG1vbnRoOiBtb250aF9maWx0ZXIsCiAgICAgIHllYXI6IHllYXJfZmlsdGVyLAogICAgICBjbGllbnQ6IGNsaWVudF9maWx0ZXIsCiAgICAgIHN0YXR1czogc3RhdHVzX2ZpbHRlciwKICAgICAgcGVyaW9kOiBwZXJpb2RfZmlsdGVyLAogICAgICBpc19jYW5jZWxlZDogaXNfY2FuY2VsZWRfZmlsdGVyCiAgICB9OwoKICAgICRzY29wZS5ldmVudFJlcG9ydENvbmZpZy5hZ2dyZWdhdGlvbnMgPSB7CiAgICAgIGV2ZW50X3R5cGVfaWQ6ICRzY29wZS5ldmVudFR5cGVNb2RlbCwKICAgICAgaW5zdHJ1Y3Rvcl9pZDogJHNjb3BlLmluc3RydWN0b3JNb2RlbCwKICAgICAgbW9udGg6ICRzY29wZS5tb250aE1vZGVsLAogICAgICB5ZWFyOiAkc2NvcGUueWVhck1vZGVsLAogICAgICBjbGllbnQ6ICRzY29wZS5jbGllbnRNb2RlbCwKICAgIH07CgogICAgaWYgKCAkc2NvcGUuc2hvd0FnZyApIHsKICAgICAgZ2V0RXZlbnRzUmVwb3J0KCRodHRwLCRzY29wZSwgZ2V0RXZlbnRzUmVwb3J0QWdncmVnYXRlZF9zdWNjZXNzKTsKICAgICAgJHNjb3BlLnJlcG9ydF9pc19sb2FkaW5nID0gdHJ1ZTsKICAgIH0gZWxzZSB7CiAgICAgIGdldEV2ZW50c1JlcG9ydCgkaHR0cCwkc2NvcGUsIGdldEV2ZW50c1JlcG9ydExpc3Rfc3VjY2Vzcyk7CiAgICAgICRzY29wZS5yZXBvcnRfaXNfbG9hZGluZyA9IHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0RXZlbnRzUmVwb3J0TGlzdF9zdWNjZXNzKHJlc3BvbnNlKXsKICAgICAgJHNjb3BlLkV2ZW50UmVwb3J0TGlzdCA9IHJlc3BvbnNlLmpzb247CiAgICAgICRzY29wZS5kb3dubG9hZF9yZXBvcnQgPSAkc2NvcGVbICdFdmVudFJlcG9ydExpc3QnIF07CiAgICAgICRzY29wZS5yZXBvcnRfaXNfbG9hZGluZyA9IGZhbHNlOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldEV2ZW50c1JlcG9ydEFnZ3JlZ2F0ZWRfc3VjY2VzcyhyZXNwb25zZSl7CiAgICAgICRzY29wZS5FdmVudFJlcG9ydEFnZ3JlZ2F0ZWQgPSByZXNwb25zZS5qc29uOwogICAgICAkc2NvcGUuZG93bmxvYWRfcmVwb3J0ID0gJHNjb3BlWyAnRXZlbnRSZXBvcnRBZ2dyZWdhdGVkJyBdOwogICAgICAkc2NvcGUucmVwb3J0X2lzX2xvYWRpbmcgPSBmYWxzZTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRDbGllbnRzUmVwb3J0TGlzdF9zdWNjZXNzKHJlc3BvbnNlKXsKICAgICAgJHNjb3BlLkNsaWVudHNSZXBvcnRMaXN0ID0gcmVzcG9uc2UuanNvbjsKICAgICAgY29uc29sZS5sb2coIi0tLS0tLS0tLS0tLSIpCiAgICAgIGNvbnNvbGUubG9nKCRzY29wZS5DbGllbnRzUmVwb3J0TGlzdCkKICAgICAgY29uc29sZS5sb2coIi0tLS0tLS0tLS0tLSIpCiAgICAgICRzY29wZS5yZXBvcnRfaXNfbG9hZGluZyA9IGZhbHNlOwogICAgfQoKCiAgfQoKICAkc2NvcGUuY2xpZW50c1JlcG9ydCA9IGZ1bmN0aW9uKCl7CiAgICBsb2dEZWJ1ZygiY2xpZW50c1JlcG9ydCIpOwoKICAgIGNsaWVudF9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuc2VsZWN0ZWRDbGllbnRGaWx0ZXIsICJjbGllbnQiICk7CgogICAgJHNjb3BlLmV2ZW50UmVwb3J0Q29uZmlnID0ge307CgogICAgJHNjb3BlLmV2ZW50UmVwb3J0Q29uZmlnLmZpbHRlcnMgPSB7CiAgICAgIGNsaWVudDogY2xpZW50X2ZpbHRlciwKICAgIH07CgogICAgJHNjb3BlLmV2ZW50UmVwb3J0Q29uZmlnLmFnZ3JlZ2F0aW9ucyA9IHsKICAgIH07CgogICAgZ2V0Q2xpZW50c1JlcG9ydCgkaHR0cCwkc2NvcGUsIGdldENsaWVudHNSZXBvcnRfc3VjY2Vzcyk7CiAgICAkc2NvcGUucmVwb3J0X2lzX2xvYWRpbmcgPSB0cnVlOwogICAgZnVuY3Rpb24gZ2V0Q2xpZW50c1JlcG9ydF9zdWNjZXNzKHJlc3BvbnNlKXsKICAgICAgJHNjb3BlLmNsaWVudFJlcG9ydCA9IHJlc3BvbnNlLmpzb247CiAgICAgICRzY29wZS5kb3dubG9hZF9yZXBvcnQgPSAkc2NvcGVbICdjbGllbnRSZXBvcnQnIF07CiAgICAgICRzY29wZS5yZXBvcnRfaXNfbG9hZGluZyA9IGZhbHNlOwogICAgfQogIH0KCiAgJHNjb3BlLmVkaXRFdmVudD0gZnVuY3Rpb24gKHRoZWV2ZW50KQogIHsKICAgIGdvdG9FdmVudFBhZ2UodGhlZXZlbnQpOwogIH0KCiAgJHNjb3BlLmV2ZW50c1JlcG9ydCgpOwogICRzY29wZS5zZWxlY3RlZFJlcG9ydD0iZXZlbnRzIjsKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2J1c2luZXNzX3BhY2thZ2VzX3VwZGF0ZV9jbnRsJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uLCRyb3V0ZVBhcmFtcykKewogICRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIgPSB7fTsgLy8gdGhlc2UgYXJlIHRoZSBjb21wbGV0ZSBkZXRhaWxzIGZvciB0aGUgbmV3IGV2ZW50IC8vCiAgJHNjb3BlLnBhY2thZ2VfaXNfdXBkYXRlID0gdHJ1ZTsKICAkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLnBhY2thZ2VfbGltaXRfdHlwZT0xOwoKICAvLyBnZXR0dGluZyB0aGUgcGFja2FnZSBhbmQgaXRzIGV2ZW50IHR5cGVzCiAgZ2V0QnVzaW5lc3NQYWNrYWdlKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMucGFja2FnZV9pZCwnZm9ybUFkZFBhY2thZ2VBbmd1bGFyJyxmdW5jdGlvbihyZXNwb25zZSkKICB7CiAgICAkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLmlzX3VwZGF0ZSA9IHRydWU7CiAgICAkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLm9yaWdFdmVudFR5cGVzPWFuZ3VsYXIuY29weSgkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLnNlbGVjdGVkRXZlbnRUeXBlcyk7CiAgICAkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLnBhY2thZ2VfbGltaXRfdHlwZT0xOwogICAgLy8gdGhlbiBnZXR0aW5nIGFsbCB0aGUgZXZlbnQgdHlwZXMKICAgIGdldEV2ZW50VHlwZXNOb0FkbWluKCRodHRwLCRzY29wZSwncmVsYXRlZEV2ZW50VHlwZXMnLGdldEV2ZW50VHlwZXNOb0FkbWluX3N1Y2Nlc3MpOwogICAgZnVuY3Rpb24gZ2V0RXZlbnRUeXBlc05vQWRtaW5fc3VjY2VzcygpCiAgICB7CiAgICAgIC8vIHRoZW4gcmVtb3ZpbmcgZXhpc3RpbmcgZXZlbnQgdHlwZXMgb2YgcGFja2FnZSBmcm9tIGxpc3QKICAgICAgLy8gY29uc29sZS5sb2coJHNjb3BlLnJlbGF0ZWRFdmVudFR5cGVzWzBdKTsKICAgICAgLy8gY29uc29sZS5sb2coJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5zZWxlY3RlZEV2ZW50VHlwZXNbMF0pOwogICAgICBmb3IodmFyIGkgPSAwOyBpIDwgJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5zZWxlY3RlZEV2ZW50VHlwZXMubGVuZ3RoOyBpKyspCiAgICAgIHsKICAgICAgICAvLyBjb3B5aW5nIHRoZSBhY3R1YWwgb2JqZWN0IG9mICRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuc2VsZWN0ZWRFdmVudFR5cGVzW2ldCiAgICAgICAgZm9yKHZhciBqID0gMDsgaiA8ICRzY29wZS5yZWxhdGVkRXZlbnRUeXBlcy5sZW5ndGg7IGorKykKICAgICAgICB7CiAgICAgICAgICBpZiAoJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5zZWxlY3RlZEV2ZW50VHlwZXNbaV0uZXZlbnRfdHlwZV9pZD09JHNjb3BlLnJlbGF0ZWRFdmVudFR5cGVzW2pdLmV2ZW50X3R5cGVfaWQpCiAgICAgICAgICB7CiAgICAgICAgICAgICRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuc2VsZWN0ZWRFdmVudFR5cGVzW2ldPWFuZ3VsYXIuY29weSgkc2NvcGUucmVsYXRlZEV2ZW50VHlwZXNbal0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogIH0pOwogICRzY29wZS5nb3RvQmFjayA9IGdvdG9CYWNrOwogICRzY29wZS5jcmVhdGVQYWNrYWdlID0gZnVuY3Rpb24oKQogIHsKICAgIGNvbnNvbGUubG9nKCJ1cGRhdGVQYWNrYWdlRGV0YWlscyIpOwogICAgdXBkYXRlUGFja2FnZURldGFpbHMoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5wYWNrYWdlX2lkLCRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIsc3VjY2Vzc19jYWxsYmFjaywgZmFpbHVyZV9jYWxsYmFjayk7CiAgICBmdW5jdGlvbiBzdWNjZXNzX2NhbGxiYWNrKCkKICAgIHsKICAgICAgZ290b0JhY2soKTsKICAgIH0KICAgIGZ1bmN0aW9uIGZhaWx1cmVfY2FsbGJhY2soKQogICAgewogICAgICBnb3RvQmFjaygpOwogICAgfQogIH07Cn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdidXNpbmVzc19wYWNrYWdlc19hZGRfY250bCcsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikgewogICAgbG9nRGVidWcoJ2J1c2luZXNzX3BhY2thZ2VzX2FkZF9jbnRsJyk7CiAgICAkc2NvcGUucGFja2FnZV9pc191cGRhdGUgPSBmYWxzZTsKICAgICRzY29wZS5nb3RvQmFjayA9IGdvdG9CYWNrOwogICAgJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhciA9IHt9OwogICAgJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5ldmVudHNfY291bnRlciA9IDE7CiAgICAkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLmV2ZW50c19wZXJfd2VlayA9IDE7CiAgICAkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLnBhY2thZ2VfZHVyYXRpb25fbW9udGhzID0gMzsKICAgICRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIucGFja2FnZV9saW1pdF90eXBlPTE7CiAgICBnZXRFdmVudFR5cGVzTm9BZG1pbigkaHR0cCwkc2NvcGUsJ3JlbGF0ZWRFdmVudFR5cGVzJyk7CgogICAgJHNjb3BlLmNyZWF0ZVBhY2thZ2UgPSBmdW5jdGlvbigpCiAgICB7CiAgICAgIGNyZWF0ZVBhY2thZ2UoJGh0dHAsJHNjb3BlLCRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIsY3JlYXRlUGFja2FnZV9zdWNjZXNzLCBjcmVhdGVQYWNrYWdlX2ZhaWx1cmUpOwogICAgICBmdW5jdGlvbiBjcmVhdGVQYWNrYWdlX3N1Y2Nlc3MoKQogICAgICB7CiAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9wYWNrYWdlcycpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGNyZWF0ZVBhY2thZ2VfZmFpbHVyZSgpCiAgICAgIHsKICAgICAgICAvLyBsb2dFcnJvcigiZXJyb3IgIiArIGRhdGEubWVzc2FnZSk7CiAgICAgICAgLy8gJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5hamF4X2Vycm9yID0gZGF0YS5tZXNzYWdlOwogICAgICB9CiAgICB9Cn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdidXNpbmVzc19sb2NhdGlvbnMnLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkbG9jYXRpb24pIHsKICAgIGxvZ0RlYnVnKCdidXNpbmVzc19sb2NhdGlvbnMgY29udHJvbGxlcicpOwogICAgZ2V0QnVzaW5lc3NMb2NhdGlvbnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19sb2NhdGlvbnMnKTsKICAgICRzY29wZS5hZGROZXdMb2NhdGlvbiA9IGZ1bmN0aW9uICgpCiAgICB7CiAgICAgICRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfbG9jYXRpb25zL2FkZCcpOwogICAgfQogICAgJHNjb3BlLmdvdG9Mb2NhdGlvblBhZ2UgPSBmdW5jdGlvbihsb2NhdGlvbl9pZCkKICAgIHsKICAgICAgZ290b0xvY2F0aW9uUGFnZShsb2NhdGlvbl9pZCk7CiAgICB9Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignQnVzaW5lc3NEb2NzQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikgewogICAgbG9nRGVidWcoJ0J1c2luZXNzRG9jc0NvbnRyb2xsZXInKTsKfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdidXNpbmVzc19sb2NhdGlvbnNfdXBkYXRlJywgZnVuY3Rpb24oJHNjb3BlLCAkcm91dGVQYXJhbXMsICRodHRwLCAkbG9jYXRpb24pIHsKICAgIGxvZ0RlYnVnKCdidXNpbmVzc19sb2NhdGlvbnNfdXBkYXRlIGNvbnRyb2xsZXInKTsKICAgICRzY29wZS5pc191cGRhdGU9dHJ1ZTsKICAgIC8vIGdldEJ1c2luZXNzTG9jYXRpb25zKCRodHRwLCRzY29wZSwnYnVzaW5lc3NfbG9jYXRpb25zJyk7CiAgICBnZXRCdXNpbmVzc0xvY2F0aW9uKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMubG9jYXRpb25faWQsJ2N1cnJfbG9jYXRpb24nLGdldEJ1c2luZXNzTG9jYXRpb25fc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBnZXRCdXNpbmVzc0xvY2F0aW9uX3N1Y2Nlc3MoKQogICAgewogICAgICAkc2NvcGUuZm9ybUFkZExvY2F0aW9uQW5ndWxhcj0kc2NvcGUuY3Vycl9sb2NhdGlvblswXTsKICAgIH0KCgogICAgJHNjb3BlLmFkZExvY2F0aW9uID0gZnVuY3Rpb24oKQogICAgewogICAgICAvLyBpbiB0aGlzIGNhc2UgLSB1cGRhdGUgbG9jYXRpb24KICAgICAgdGhlZGF0YSA9ICRzY29wZS5mb3JtQWRkTG9jYXRpb25Bbmd1bGFyOwoKICAgICAgZnVuY3Rpb24gYWRkTG9jYXRpb25fc3VjY2VzcygpCiAgICAgIHsKICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2xvY2F0aW9ucycpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGFkZExvY2F0aW9uX2ZhaWx1cmUoKQogICAgICB7CiAgICAgICAgJHNjb3BlLmZvcm1BZGRMb2NhdGlvbkFuZ3VsYXIuYWpheF9lcnJvciA9IHJlc3BvbnNlLm1lc3NhZ2U7CiAgICAgIH0KICAgICAgdXBkYXRlTG9jYXRpb24oJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5sb2NhdGlvbl9pZCwgdGhlZGF0YSxhZGRMb2NhdGlvbl9zdWNjZXNzLGFkZExvY2F0aW9uX2ZhaWx1cmUpOwogICAgfQp9KTsKCmt1emVBcHAuY29udHJvbGxlcignYnVzaW5lc3NfbG9jYXRpb25zX2FkZCcsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikgewogICAgbG9nRGVidWcoJ2J1c2luZXNzX2xvY2F0aW9uc19hZGQgY29udHJvbGxlcicpOwogICAgZ2V0QnVzaW5lc3NMb2NhdGlvbnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19sb2NhdGlvbnMnKTsKICAgICRzY29wZS5pc191cGRhdGU9ZmFsc2U7CgogICAgJHNjb3BlLmFkZExvY2F0aW9uID0gZnVuY3Rpb24oKQogICAgewogICAgICB0aGVkYXRhID0gJHNjb3BlLmZvcm1BZGRMb2NhdGlvbkFuZ3VsYXI7CgogICAgICBmdW5jdGlvbiBhZGRMb2NhdGlvbl9zdWNjZXNzKCkKICAgICAgewogICAgICAgICRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfbG9jYXRpb25zJyk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gYWRkTG9jYXRpb25fZmFpbHVyZSgpCiAgICAgIHsKICAgICAgICAkc2NvcGUuZm9ybUFkZExvY2F0aW9uQW5ndWxhci5hamF4X2Vycm9yID0gcmVzcG9uc2UubWVzc2FnZTsKICAgICAgfQogICAgICBhZGRMb2NhdGlvbigkaHR0cCwkc2NvcGUsdGhlZGF0YSxhZGRMb2NhdGlvbl9zdWNjZXNzLGFkZExvY2F0aW9uX2ZhaWx1cmUpOwogICAgfQp9KTsKCmt1emVBcHAuY29udHJvbGxlcignSW5zdHJ1Y3RvcnNBZGRDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uKSB7CiAgICBsb2dEZWJ1ZygnSW5zdHJ1Y3RvcnNBZGRDb250cm9sbGVyJyk7CiAgICAkc2NvcGUuaXNJbnN0cnVjdG9yPXRydWU7CiAgICAkc2NvcGUudXNlcnR5cGU9Imluc3RydWN0b3IiOwogICAgJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyID0ge307CiAgICAkc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIuaXNfdXBkYXRlPWZhbHNlOwogICAgJHNjb3BlLmFkZENsaWVudCA9IGZ1bmN0aW9uKCkgLy8gYWRkIGluc3RydWN0b3IsIHVzaW5nIHRoZSBzYW1lIGZ1bmN0aW9uIG5hbWUgYXMgd2UgdXNlIHRoZSBzYW1lIHNjcmVlbgogICAgewogICAgICB0aGVkYXRhID0gJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyOwoKICAgICAgZnVuY3Rpb24gYWRkSW5zdHJ1Y3Rvcl9zdWNjZXNzKCkKICAgICAgewogICAgICAgICRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfaW5zdHJ1Y3RvcnMnKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBhZGRDbGllbnRfZmFpbHVyZSgpCiAgICAgIHsKICAgICAgICAkc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIuYWpheF9lcnJvciA9IHJlc3BvbnNlLm1lc3NhZ2U7CiAgICAgIH0KICAgICAgYWRkSW5zdHJ1Y3RvcigkaHR0cCwkc2NvcGUsdGhlZGF0YSxhZGRJbnN0cnVjdG9yX3N1Y2Nlc3MpOwogICAgfQp9KTsKa3V6ZUFwcC5jb250cm9sbGVyKCdDbGllbnRzQWRkQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICR0aW1lb3V0LCAkbG9jYXRpb24sIHNoYXJlZFByb3BlcnRpZXMpIHsKICAgIGxvZ0RlYnVnKCdDbGllbnRzQWRkQ29udHJvbGxlciAtIFRoaXMgaXMgQWRkIG5ldyBjbGllbnQgc2NyZWVuJyk7CiAgICAkc2NvcGUuaXNJbnN0cnVjdG9yPWZhbHNlOwoKICAgICRzY29wZS51c2VydHlwZT0iZW5kdXNlciI7CiAgICAkc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIgPSB7fTsKICAgICRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5pc191cGRhdGU9ZmFsc2U7CiAgICAkc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIuZGlzYWJsZV9waG9uZV9lZGl0aW5nPWZhbHNlOwoKICAgIGlmICgoJHNjb3BlLmZpbHRlci5WYWx1ZSAhPSAiIikgJiYgKHR5cGVvZiAkc2NvcGUuZmlsdGVyLlZhbHVlICE9ICd1bmRlZmluZWQnKSkgewogICAgICAgIGxvZ0RlYnVnKCJjbGllbnRzIGZpbHRlciBpcyBub3QgZW1wdHkiKTsKICAgICAgICB2YXIgZmlsdGVyID0gU3RyaW5nKCRzY29wZS5maWx0ZXIuVmFsdWUpOwogICAgICAgIGlmIChmaWx0ZXIuaW5kZXhPZigiICIpID4gMCkgewogICAgICAgICAgICAkc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIuZmlyc3RfbmFtZSA9IGZpbHRlci5zdWJzdHIoMCwgZmlsdGVyLmluZGV4T2YoIiAiKSk7CiAgICAgICAgICAgICRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5sYXN0X25hbWUgPSBmaWx0ZXIuc3Vic3RyKDEgKyBmaWx0ZXIuaW5kZXhPZigiICIpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIuZmlyc3RfbmFtZSA9IGZpbHRlcjsKICAgICAgICAgICAgJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyLmxhc3RfbmFtZSA9ICIiOwogICAgICAgIH0KICAgICAgICAkc2NvcGUuZmlsdGVyLlZhbHVlID0gIiI7CiAgICAgICAgJHNjb3BlLmZpbHRlci5idXR0b25WYWx1ZSA9ICIiOwogICAgfSBlbHNlIHsKICAgIH0KCiAgICAkc2NvcGUuZ290b0JhY2sgPSBmdW5jdGlvbigpCiAgICB7CiAgICAgICRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfY2xpZW50cycpOwogICAgfQoKICAgICRzY29wZS5hZGRDbGllbnQgPSBmdW5jdGlvbigpCiAgICB7CiAgICAgIHRoZWRhdGEgPSAkc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXI7CgogICAgICBmdW5jdGlvbiBhZGRDbGllbnRfc3VjY2Vzcyh1c2VyX2lkKQogICAgICB7CiAgICAgICAgaWYgKCRzY29wZS5zYXZlX2FuZF9zY2hlZHVsZSkKICAgICAgICB7CiAgICAgICAgICAvLyAkbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2NsaWVudHMvJyt1c2VyX2lkLmpzb24pOwogICAgICAgICAgbG9nRGVidWcoIk5FVyB1c2VyIHVzZXJfaWQ9Iit1c2VyX2lkLmpzb24pOwoKICAgICAgICAgIHVzZXJfaW5mbz0gewogICAgICAgICAgICAgIGJ1c2luZXNzX3VzZXJfaWQ6IHVzZXJfaWQuanNvbiwKICAgICAgICAgICAgICBidXNlcl9maXJzdF9uYW1lOiAkc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIuYnVzZXJfZmlyc3RfbmFtZSwKICAgICAgICAgICAgICBidXNlcl9sYXN0X25hbWU6ICRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5idXNlcl9sYXN0X25hbWUKICAgICAgICAgIH07CgogICAgICAgICAgc2hhcmVkUHJvcGVydGllcy5zZXRfc2VsZWN0ZWRfdXNlcih1c2VyX2luZm8pOwogICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jYWxlbmRhcicpOwoKICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfY2xpZW50cy8nKTsKICAgICAgICB9CiAgICAgICAgY29uc29sZS5sb2coIm5ldyB1c2VyIGlkID0gIit1c2VyX2lkLmpzb24pOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGFkZENsaWVudF9mYWlsdXJlKHJlc3BvbnNlKQogICAgICB7CiAgICAgICAgJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyLmFqYXhfZXJyb3IgPSByZXNwb25zZS5tZXNzYWdlOwogICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkKICAgICAgICB7CiAgICAgICAgICAkc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIuYWpheF9lcnJvcj1udWxsOwogICAgICAgIH0sIDI1MDApOwogICAgICB9CiAgICAgIGFkZENsaWVudCgkaHR0cCwkc2NvcGUsdGhlZGF0YSxhZGRDbGllbnRfc3VjY2VzcywgYWRkQ2xpZW50X2ZhaWx1cmUsZmFsc2UpOwogICAgfQp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ1BhY2thZ2VzQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikgewogICAgbG9nRGVidWcoJ1BhY2thZ2VzQ29udHJvbGxlcicpOwogICAgZ2V0QnVzaW5lc3NQYWNrYWdlcygkaHR0cCwkc2NvcGUsJ3BhY2thZ2VzJyk7CgogICAgJHNjb3BlLnNob3dQYWNrYWdlID0gZnVuY3Rpb24gKHRoZXBhY2thZ2UpCiAgICB7CiAgICAgICRsb2NhdGlvbi5wYXRoKCcvcGFja2FnZXMvJyt0aGVwYWNrYWdlLnBhY2thZ2VfaWQpOwogICAgfQp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ0luc3RydWN0b3JzU2hvd0NvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkbG9jYXRpb24pIHsKICAgIGxvZ0RlYnVnKCdJbnN0cnVjdG9yc1Nob3dDb250cm9sbGVyJyk7CiAgICAkc2NvcGUub3JkZXJCeUZpZWxkID0gJ2J1c2VyX3N0YXJ0X2RhdGUnOwogICAgJHNjb3BlLnJldmVyc2VTb3J0PXRydWU7CgogICAgZ2V0QWxsSW5zdHJ1Y3RvcnMoJGh0dHAsJHNjb3BlLCdhbGxDbGllbnRzJyxnZXRBbGxJbnN0cnVjdG9yc19zdWNjZXNzKTsKICAgIGZ1bmN0aW9uIGdldEFsbEluc3RydWN0b3JzX3N1Y2Nlc3MoKQogICAgewogICAgICAkc2NvcGUuc2hvd0NsaWVudHNHcmlkT3B0aW9ucy5kYXRhPSRzY29wZS5hbGxDbGllbnRzOwogICAgfQoKICAgICRzY29wZS5nb3RvSW5zdHJ1Y3RvclBhZ2U9IGZ1bmN0aW9uIChidXNpbmVzc191c2VyX2lkKQogICAgewogICAgICBnb3RvSW5zdHJ1Y3RvclBhZ2UoYnVzaW5lc3NfdXNlcl9pZCk7CiAgICB9CgogICAgJHNjb3BlLmNsaWVudE5hbWVGaWx0ZXI9IiI7CiAgICAkc2NvcGUuaW5wdXRGaWx0ZXIgPSBmdW5jdGlvbiAoaXRlbSkKICAgIHsKICAgICAgLy8gY29uc29sZS5sb2coaXRlbS5idXNlcl9waG9uZV9udW1iZXIpOwogICAgICByZXR1cm4gZmlsdGVyX2ZpcnN0bGFzdF9uYW1lKGl0ZW0uYnVzZXJfZmlyc3RfbmFtZSxpdGVtLmJ1c2VyX2xhc3RfbmFtZSxpdGVtLmJ1c2VyX3Bob25lX251bWJlciwkc2NvcGUuY2xpZW50TmFtZUZpbHRlcik7CiAgICB9Owp9KTsKCmt1emVBcHAuY29udHJvbGxlcignQ2xpZW50c1Nob3dDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkdWliTW9kYWwsICRodHRwLCAkbG9jYXRpb24pIHsKICAgIGxvZ0RlYnVnKCdDbGllbnRzU2hvd0NvbnRyb2xsZXInKTsKICAgICRzY29wZS5vcmRlckJ5RmllbGQgPSAnYnVzZXJfc3RhcnRfZGF0ZSc7CiAgICAkc2NvcGUucmV2ZXJzZVNvcnQ9dHJ1ZTsKCiAgICBnZXRBbGxDbGllbnRzKCRodHRwLCRzY29wZSwnYWxsQ2xpZW50cycsZ2V0Q2xpZW50X3N1Y2Nlc3MpOwogICAgZnVuY3Rpb24gZ2V0Q2xpZW50X3N1Y2Nlc3MoKQogICAgewogICAgICAkc2NvcGUuc2hvd0NsaWVudHNHcmlkT3B0aW9ucy5kYXRhPSRzY29wZS5hbGxDbGllbnRzOwogICAgfQoKICAgICRzY29wZS5nb3RvQ2xpZW50UGFnZT0gZnVuY3Rpb24gKGJ1c2luZXNzVXNlcmlkKQogICAgewogICAgICBnb3RvQ2xpZW50UGFnZShidXNpbmVzc1VzZXJpZCk7CiAgICB9CgogICAgLy8gZmlsdGVyIGFyY2hpdmVkIGNsaWVudHMKICAgICRzY29wZS5zaG93QXJjaGl2ZWRDaGVja2JveD1mYWxzZTsKICAgICRzY29wZS5zaG93QXJjaGl2ZWQgPSBmdW5jdGlvbiAoZWNsaWVudCkKICAgIHsKICAgICAgaWYgKGVjbGllbnQuaXNfYWN0aXZlPT0wKQogICAgICB7CiAgICAgICAgbG9nRGVidWcoZWNsaWVudCk7CiAgICAgICAgaWYgKCRzY29wZS5zaG93QXJjaGl2ZWRDaGVja2JveCkKICAgICAgICB7CiAgICAgICAgICByZXR1cm4gZWNsaWVudDsKICAgICAgICB9CiAgICAgIH0KICAgICAgZWxzZSB7CiAgICAgICAgcmV0dXJuIGVjbGllbnQ7CiAgICAgIH0KICAgIH07CgogICAgJHNjb3BlLmNsaWVudE5hbWVGaWx0ZXI9IiI7CiAgICAkc2NvcGUuaW5wdXRGaWx0ZXIgPSBmdW5jdGlvbiAoaXRlbSkKICAgIHsKICAgICAgY29uc29sZS5sb2coImNsaWVudE5hbWVGaWx0ZXIiKTsKICAgICAgcmV0dXJuIGZpbHRlcl9maXJzdGxhc3RfbmFtZShpdGVtLmJ1c2VyX2ZpcnN0X25hbWUsaXRlbS5idXNlcl9sYXN0X25hbWUsaXRlbS5idXNlcl9waG9uZV9udW1iZXIsJHNjb3BlLmNsaWVudE5hbWVGaWx0ZXIpOwogICAgfTsKCiAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcz1bXTsKICAgIC8vICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzID0gWwogICAgLy8gICB7ImZpZWxkX2lkIjowLCJmaWVsZF9uYW1lIjoi16rXkNeo15nXmiDXnNeZ15PXlCIsImZpZWxkX2RhdGF0eXBlIjoiREFURSIsImlzX21hbmRhdG9yeSI6MCwgImZyb21kYiI6IGZhbHNlLCAiZGJfaWRfdG9maXgiOiAwLCAiaXNfYWN0aXZlIjogMSwgIm1vZGlmaWVkIjogZmFsc2V9LAogICAgLy8gICB7ImZpZWxkX2lkIjowLCJmaWVsZF9uYW1lIjoi15TXoteo15XXqiIsImZpZWxkX2RhdGF0eXBlIjoiVEVYVF9BUkVBIiwiaXNfbWFuZGF0b3J5IjowLCAiZnJvbWRiIjogZmFsc2UsICJkYl9pZF90b2ZpeCI6IDAsICJpc19hY3RpdmUiOiAxLCAibW9kaWZpZWQiOiBmYWxzZX0KICAgIC8vIF07CgogICAgZnVuY3Rpb24gZ2V0Q2xpZW50c0V4dHJhRmllbGRzX3N1Y2Nlc3MoKQogICAgewogICAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyA9ICRzY29wZS5leHRyYUZpZWxkczsKICAgIH0KICAgIGdldENsaWVudHNFeHRyYUZpZWxkcygkaHR0cCwkc2NvcGUsJ2V4dHJhRmllbGRzJyxnZXRDbGllbnRzRXh0cmFGaWVsZHNfc3VjY2Vzcyk7CgogICAgJHNjb3BlLmV2ZW50VHlwZUV4dHJhRmllbGRzUG9wID0gZnVuY3Rpb24oZXZlbnRUeXBlUHJvcGVydGllcykgewogICAgICAgIGxvZ0RlYnVnKCJldmVudCBjcmVhdGUgbW9kYWwiKTsKCiAgICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgICAgICAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2NsaWVudF9leHRyYV9maWVsZHMucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ2V2ZW50VHlwZUV4dHJhRmllbGRzTW9kYWxDb250cm9sbGVyJywKICAgICAgICAgICAgc2l6ZTogJ2wnLAogICAgICAgICAgICByZXNvbHZlOiB7CiAgICAgICAgICAgICAgICBldmVudFR5cGVQcm9wZXJ0aWVzOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXZlbnRUeXBlUHJvcGVydGllczsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBtb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHNlbGVjdGVkSXRlbSkgewogICAgICAgICAgICBsb2dEZWJ1ZyhzZWxlY3RlZEl0ZW0pOwogICAgICAgICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzID0gc2VsZWN0ZWRJdGVtOwogICAgICAgIH0sIGZ1bmN0aW9uKCkgewogICAgICAgICAgICBsb2dEZWJ1ZygnTW9kYWwgZGlzbWlzc2VkIGF0OiAnICsgbmV3IERhdGUoKSk7CiAgICAgICAgfSk7CiAgICB9Owp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ3NjaGVkdWxlckNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkcm91dGVQYXJhbXMpIHsKICAgIGV2ZW50X3R5cGVfaWQ9JHJvdXRlUGFyYW1zLmV2ZW50X3R5cGVfaWQ7CgogICAgJHNjb3BlLnN1Z2dlc3Rpb25EYXRlID0gW107CiAgICAkc2NvcGUuc3VnZ2VzdGlvbkRhdGUuZGF0ZSA9IG5ldyBEYXRlKCk7CiAgICAkc2NvcGUuc3VnZ2VzdGlvbkRhdGUub3B0aW9ucyA9IHsKICAgICAgICAgICAgLy8gbWluRGF0ZTogbmV3IERhdGUoKSwKICAgICAgICAgICAgLy8gc2hvd1dlZWtzOiB0cnVlLAogICAgICAgICAgICBtaW5WaWV3OidkYXknLAogICAgICAgICAgICBzdGFydFZpZXc6ICdkYXknCgogICAgICAgICAgfTsKICAgIHZhciB0aGV0aW1lID0gbmV3IERhdGUoKTsKICAgICRzY29wZS5maWx0ZXJBbGxEYXlzQ2hlY2tib3g9dHJ1ZTsKICAgICRzY29wZS5maWx0ZXJEYXlJdGVtcyA9IHsKCiAgICAgICfXqNeQ16nXldefJzogdHJ1ZSwKICAgICAgJ9ep16DXmSc6IHRydWUsCiAgICAgICfXqdec15nXqdeZJzogdHJ1ZSwKICAgICAgJ9eo15HXmdei15knOiB0cnVlLAogICAgICAn15fXnteZ16nXmSc6IHRydWUsCiAgICAgICfXqdeZ16nXmSc6IHRydWUsCiAgICAgICfXqdeR16onOiB0cnVlCiAgICB9OwoKICAgICRzY29wZS5vblRpbWVTZXQgPSBmdW5jdGlvbiAobmV3RGF0ZSwgb2xkRGF0ZSkgewogICAgICAgIGxvZ0RlYnVnKCJuZXcgZGF0ZSAiK25ld0RhdGUuZ2V0VGltZSgpICsgIiBvbGQgZGF0ZSAiK29sZERhdGUuZ2V0VGltZSgpKTsKICAgICAgICBkaWZmPW5ld0RhdGUuZ2V0VGltZSgpLW9sZERhdGUuZ2V0VGltZSgpOwogICAgICAgIC8vIGlmIG5ldyBkYXRlIGlzIGluIGEgZGlmZmVyZW50IHdlZWsKICAgICAgICAvLyB3ZSByZWZldGNoIHN1Z2dlc3Rpb25zIGZvciB0aGUgY3VycmVudCB3ZWVrCiAgICAgICAgdmFyIG5ld0RhdGVXID0gbmV3IERhdGUobmV3RGF0ZSk7CiAgICAgICAgdmFyIG9sZERhdGVXID0gbmV3IERhdGUob2xkRGF0ZSk7CiAgICAgICAgLy8gYWxlcnQobmV3RGF0ZVcuZm9ybWF0KCdXJykpOwogICAgICAgIC8vIGFsZXJ0KG9sZERhdGVXLmZvcm1hdCgnVycpKTsKICAgICAgICBpZiAobmV3RGF0ZVcuZm9ybWF0KCdXJykhPW9sZERhdGVXLmZvcm1hdCgnVycpKQogICAgICAgIHsKICAgICAgICAgIGxvZ0RlYnVnKCJkaWZmIGlzIGEgd2VlayBvciBtb3JlLCByZWZldGNoaW5nIHN1Z2dlc3Rpb25zIik7CiAgICAgICAgICAkaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3QvIitldmVudF90eXBlX2lkKyIvIituZXdEYXRlLmdldEZ1bGxZZWFyKCkrIi8iKyhuZXdEYXRlLmdldE1vbnRoKCkrMSkrIi8iK25ld0RhdGUuZ2V0RGF0ZSgpKyIvIituZXdEYXRlLmdldEhvdXJzKCkgKyAiLyIgKyBuZXdEYXRlLmdldE1pbnV0ZXMoKSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkgewogICAgICAgICAgICAgIC8vCSAgICAkc2NvcGUubXlEYXRhID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgICAgICAvLwkJbG9nRGVidWcoImdyaWRvcHRpb25zPSIrJHNjb3BlLmdyaWRPcHRpb25zKTsKICAgICAgICAgICAgICAkc2NvcGUuZXZlbnRzU3VnZ2VzdGVkID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgIH0pOwoKICAgICAgICB9CiAgICB9CgogICAgJHNjb3BlLm9wdGlvbnMgPSB7CiAgICAgICBjdXN0b21DbGFzczogZ2V0RGF5Q2xhc3MsCiAgICAgICBtaW5EYXRlOiBuZXcgRGF0ZSgpLAogICAgICAgc2hvd1dlZWtzOiB0cnVlCiAgICAgfTsKICAgICAkc2NvcGUuZHQgPSBuZXcgRGF0ZSgpOwoKCiAgICAgZnVuY3Rpb24gZ2V0RGF5Q2xhc3MoZGF0YSkgewogICAgICAgICByZXR1cm4gJyc7CiAgICAgICB9CgogICAgJHNjb3BlLmRheXNJdGVtcyA9IFsKICAgICAge25hbWU6J9eo15DXqdeV158nfSwKICAgICAge25hbWU6J9ep16DXmSd9LAogICAgICB7bmFtZTon16nXnNeZ16nXmSd9LAogICAgICB7bmFtZTon16jXkdeZ16LXmSd9LAogICAgICB7bmFtZTon15fXnteZ16nXmSd9LAogICAgICB7bmFtZTon16nXmdep15knfSwKICAgICAge25hbWU6J9ep15HXqid9CiAgICBdOwoKICAgICRzY29wZS5maWx0ZXJBbGxEYXlJdGVtc1NldCA9IGZ1bmN0aW9uICgpCiAgICB7CiAgICAgICRzY29wZS5maWx0ZXJEYXlJdGVtc1sn16jXkNep15XXnyddPSRzY29wZS5maWx0ZXJBbGxEYXlzQ2hlY2tib3g7CiAgICAgICRzY29wZS5maWx0ZXJEYXlJdGVtc1sn16nXoNeZJ109JHNjb3BlLmZpbHRlckFsbERheXNDaGVja2JveDsKICAgICAgJHNjb3BlLmZpbHRlckRheUl0ZW1zWyfXqdec15nXqdeZJ109JHNjb3BlLmZpbHRlckFsbERheXNDaGVja2JveDsKICAgICAgJHNjb3BlLmZpbHRlckRheUl0ZW1zWyfXqNeR15nXoteZJ109JHNjb3BlLmZpbHRlckFsbERheXNDaGVja2JveDsKICAgICAgJHNjb3BlLmZpbHRlckRheUl0ZW1zWyfXl9ee15nXqdeZJ109JHNjb3BlLmZpbHRlckFsbERheXNDaGVja2JveDsKICAgICAgJHNjb3BlLmZpbHRlckRheUl0ZW1zWyfXqdeZ16nXmSddPSRzY29wZS5maWx0ZXJBbGxEYXlzQ2hlY2tib3g7CiAgICAgICRzY29wZS5maWx0ZXJEYXlJdGVtc1sn16nXkdeqJ109JHNjb3BlLmZpbHRlckFsbERheXNDaGVja2JveDsKICAgIH0KCiAgICAkc2NvcGUuc3VnZ2VzdEZpbHRlckRheXMgPSBmdW5jdGlvbiAoZXN1Z2dlc3QpCiAgICB7CiAgICAgIC8vIGxvZ0RlYnVnKGVzdWdnZXN0KTsKICAgICAgaWYgKCgkc2NvcGUuZmlsdGVyRGF5SXRlbXNbZXN1Z2dlc3Quc3RhcnRfZm9ybWF0X2Rvd10pICYgKCgkc2NvcGUuc3VnZ2VzdGlvbkRhdGUuZGF0ZS5nZXRUaW1lKCkvMTAwMCk8ZXN1Z2dlc3Quc3RhcnRfZXBvY2gpKQogICAgICB7CiAgICAgICAgcmV0dXJuIGVzdWdnZXN0OwogICAgICB9CiAgICB9OwoKICAgIGxvZ0RlYnVnKCdzY2hlZHVsZXJDb250cm9sbGVyIGZvciBldmVudCB0eXBlIGlkICcrZXZlbnRfdHlwZV9pZCsiICIrdGhldGltZS5nZXRIb3VycygpICsgIjoiICsgdGhldGltZS5nZXRNaW51dGVzKCkgKyAiOiIgKyB0aGV0aW1lLmdldFNlY29uZHMoKSk7CiAgICAkaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3QvIitldmVudF90eXBlX2lkKyIvIit0aGV0aW1lLmdldEZ1bGxZZWFyKCkrIi8iKyh0aGV0aW1lLmdldE1vbnRoKCkrMSkrIi8iK3RoZXRpbWUuZ2V0RGF0ZSgpKyIvIit0aGV0aW1lLmdldEhvdXJzKCkgKyAiLyIgKyB0aGV0aW1lLmdldE1pbnV0ZXMoKSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkgewogICAgICAgIC8vCSAgICAkc2NvcGUubXlEYXRhID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAvLwkJbG9nRGVidWcoImdyaWRvcHRpb25zPSIrJHNjb3BlLmdyaWRPcHRpb25zKTsKICAgICAgICAkc2NvcGUuZXZlbnRzU3VnZ2VzdGVkID0gcmVzcG9uc2UuZGF0YTsKICAgIH0pOwoKICAgICRodHRwLmdldCgkZ0FwaVVSTFByZWZpeCArICIvZW5kdXNlci9ldmVudF90eXBlcy8iK2V2ZW50X3R5cGVfaWQpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHsKICAgICAgICAvLwkgICAgJHNjb3BlLm15RGF0YSA9IHJlc3BvbnNlLmRhdGE7CiAgICAgICAgLy8JCWxvZ0RlYnVnKCJncmlkb3B0aW9ucz0iKyRzY29wZS5ncmlkT3B0aW9ucyk7CiAgICAgICAgJHNjb3BlLmV2ZW50VHlwZURldGFpbHMgPSByZXNwb25zZS5kYXRhOwogICAgfSk7Cn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdjb250YWN0Q29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHApIHsKICAgIGxvZ0RlYnVnKCdjb250YWN0Q29udHJvbGxlcicpOwp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ3BhY2thZ2VQYXltZW50QXNzb2NpYXRpb25Nb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRyb3V0ZVBhcmFtcywgJHJvb3RTY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRodHRwLCBmcGFja2FnZSwgYmFsYW5jZSwgYnVzaW5lc3NfdXNlcl9pZCwgdWlDYWxlbmRhckNvbmZpZykKewogIGxvZ0RlYnVnKCJwYWNrYWdlUGF5bWVudEFzc29jaWF0aW9uTW9kYWxDb250cm9sbGVyIik7CgogICRzY29wZS5mcGFja2FnZT1mcGFja2FnZTsKICAkc2NvcGUuYmFsYW5jZT1iYWxhbmNlOwogICRzY29wZS5wYWNrYWdlX3BheW1lbnRzPSRzY29wZS5mcGFja2FnZS5wYWNrYWdlX3BheW1lbnRzOwogICRzY29wZS5wcmV2aW91c19pc19hbGxfcGFpZD0kc2NvcGUuZnBhY2thZ2UuaXNfYWxsX3BhaWQ7CiAgJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQ9YnVzaW5lc3NfdXNlcl9pZDsKCiAgLy8gJ2NhbGN1bGF0aW5nJyBwcmV2aW91cyBzdGF0dXMgb2YgcGF5bWVudAogIGlmICgkc2NvcGUucGFja2FnZV9wYXltZW50cz4wKQogIHsKICAgIGlmICgkc2NvcGUucHJldmlvdXNfaXNfYWxsX3BhaWQ9PTEpCiAgICB7CiAgICAgICRzY29wZS5wcmV2aW91c19zdGF0dXM9ImlzX2FsbF9wYWlkIjsKICAgICAgJHNjb3BlLnBhY2thZ2Vfc3RhdHVzX2lkPS0xOwogICAgICAkc2NvcGUucHJldmlvdXNfcGFja2FnZV9zdGF0dXNfaWQ9LTE7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICRzY29wZS5wcmV2aW91c19zdGF0dXM9ImlzX3BhcnRseV9wYWlkIjsKICAgICAgJHNjb3BlLnBhY2thZ2Vfc3RhdHVzX2lkPS0xOwogICAgICAkc2NvcGUucHJldmlvdXNfcGFja2FnZV9zdGF0dXNfaWQ9LTE7CiAgICB9CiAgfQogIGVsc2UKICB7CiAgICAgICRzY29wZS5wcmV2aW91c19zdGF0dXM9Im5vdF9wYWlkIjsKICAgICAgJHNjb3BlLnBhY2thZ2Vfc3RhdHVzX2lkPTA7CiAgICAgICRzY29wZS5wcmV2aW91c19wYWNrYWdlX3N0YXR1c19pZD0wOwoKICB9CiAgbG9nRGVidWcoInByZXZpb3VzX3N0YXR1cz0iKyRzY29wZS5wcmV2aW91c19zdGF0dXMpOwoKICAkc2NvcGUuY2xvc2VNb2RhbCA9IGZ1bmN0aW9uKCkKICB7CiAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICB9OwogICRzY29wZS51cGRhdGVQYWNrYWdlUGF5bWVudCA9IGZ1bmN0aW9uKCkKICB7CiAgICAvLyBjb25zb2xlLmxvZygicHJldmlvdXNfcGFja2FnZV91c2VyX2lkPSIrJHNjb3BlLmZtZWV0aW5nLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZCk7CiAgICAvLyBjb25zb2xlLmxvZygicGFja2FnZV91c2VyX2lkPSIrJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZCk7CiAgICBsb2dEZWJ1ZygidXBkYXRlUGFja2FnZVBheW1lbnQiKQogICAgLy8gaWYgc2VsZWN0ZWQgcGFja2FnZSBpcyBsaWtlIHByZXZpb3VzIHBhY2thZ2UgLSBkbyBub3RoaW5nCiAgICBpZiAoKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3N0YXR1c19pZD09JHNjb3BlLnBhY2thZ2Vfc3RhdHVzX2lkKSkKICAgIHsKICAgICAgbG9nRGVidWcoInNlbGVjdGVkIG9wdGlvbiBpcyBsaWtlIHByZXZpb3VzIG9wdGlvbiAtIGRvIG5vdGhpbmciKTsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgfQoKICAgIC8vIHByZXZpb3VzIHBhY2thZ2Ugd2FzIHBhaWQvcGFydGx5LXBhaWQgLSBub3cgbm90aGluZ3MgaXMgc2VsZWN0ZWQKICAgIGVsc2UgaWYgKCgkc2NvcGUucHJldmlvdXNfcGFja2FnZV9zdGF0dXNfaWQ9PS0xKSAmJiAoJHNjb3BlLnBhY2thZ2Vfc3RhdHVzX2lkPT0wKSkKICAgIHsKICAgICAgbG9nRGVidWcoIndhcyBwYWlkL3BhcnRseSBwYWlkLCByZW1vdmluZyBwYXltZW50Iik7CiAgICAgIHJlbW92ZVBhY2thZ2VQYXltZW50KCRodHRwLCRzY29wZSwkc2NvcGUuZnBhY2thZ2UucGFja2FnZV91c2VyX2lkLCRzY29wZS5idXNpbmVzc191c2VyX2lkLHVwZGF0ZUV2ZW50UGFja2FnZV9zdWNjZXNzKTsKICAgIH0KICAgIC8vIHByZXZpb3VzIHBhY2thZ2Ugd2FzIHNlbGVjdGVkIC0gbm93IGEgZGlmZmVyZW50IHBhY2thZ2UgaXMgc2VsZWN0ZWQKICAgIGVsc2UgaWYgKCgkc2NvcGUucHJldmlvdXNfcGFja2FnZV9zdGF0dXNfaWQ9PTApICYmICgkc2NvcGUucGFja2FnZV9zdGF0dXNfaWQ9PS0xKSkKICAgIHsKICAgICAgbG9nRGVidWcoIndhcyBub3QgcGFpZCAtIG5vdyBwYXkgZnVsbHkvcGFydGlhbGx5Iik7CiAgICAgIHBheUZvclBhY2thZ2UoJGh0dHAsJHNjb3BlLCRzY29wZS5mcGFja2FnZS5wYWNrYWdlX3VzZXJfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwoKICAgICAgLy8gcmVhc3NpZ25FdmVudFBhY2thZ2VBc3NvY2lhdGlvbigkaHR0cCwkc2NvcGUsJHNjb3BlLmZtZWV0aW5nLmV2ZW50X2lkLCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MoKQogIHsKICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICAgIGxvZ0RlYnVnKCJicm9hZGNhc3RpbmcgY2xpZW50UGFnZVJlbG9hZERhdGEiKTsKICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKICB9Cgp9KTsKCmt1emVBcHAuY29udHJvbGxlcignZXZlbnRQYWNrYWdlQXNzb2NpYXRpb25Nb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRyb3V0ZVBhcmFtcywgJHJvb3RTY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRodHRwLCBmbWVldGluZywgYmFsYW5jZSwgYnVzaW5lc3NfdXNlcl9pZCwgdWlDYWxlbmRhckNvbmZpZykKewogICRzY29wZS5mbWVldGluZz1hbmd1bGFyLmNvcHkoZm1lZXRpbmcpOwogICRzY29wZS5iYWxhbmNlPWJhbGFuY2U7CiAgJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD0kc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkOwogICRzY29wZS5wcmV2aW91c19ldmVudF9wYXltZW50cz0kc2NvcGUuZm1lZXRpbmcuZXZlbnRfcGF5bWVudHM7CiAgJHNjb3BlLnByZXZpb3VzX2lzX2FsbF9wYWlkPSRzY29wZS5mbWVldGluZy5pc19hbGxfcGFpZDsKICAkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZD1idXNpbmVzc191c2VyX2lkOwoKICAvLyAnY2FsY3VsYXRpbmcnIHByZXZpb3VzIHN0YXR1cyBvZiBwYXltZW50CiAgaWYgKCRzY29wZS5wcmV2aW91c19ldmVudF9wYXltZW50cz4wKQogIHsKICAgIGlmICgkc2NvcGUucHJldmlvdXNfaXNfYWxsX3BhaWQ9PTEpCiAgICB7CiAgICAgICRzY29wZS5wcmV2aW91c19zdGF0dXM9ImlzX2FsbF9wYWlkIjsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgJHNjb3BlLnByZXZpb3VzX3N0YXR1cz0iaXNfcGFydGx5X3BhaWQiOwogICAgfQogIH0KICBlbHNlCiAgewogICAgICBpZiAoJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD4wKQogICAgICB7CiAgICAgICAgJHNjb3BlLnByZXZpb3VzX3N0YXR1cz0iaXNfcGFja2FnZV9wYWlkIjsKICAgICAgfQogICAgICBlbHNlCiAgICAgIHsKICAgICAgICAkc2NvcGUucHJldmlvdXNfc3RhdHVzPSJub3RfcGFpZCI7CiAgICAgIH0KICB9CiAgbG9nRGVidWcoInByZXZpb3VzX3N0YXR1cz0iKyRzY29wZS5wcmV2aW91c19zdGF0dXMpOwoKICBpZiAoKCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQ9PTApICYmICgkc2NvcGUuZm1lZXRpbmcuZXZlbnRfcGF5bWVudHM+MCkpCiAgewogICAgLy8gdGhpcyBpcyBhIGNhc2Ugd2hlcmUgcGF5bWVudCB3YXMgcGFydGx5IG9yIGZ1bGx5IG1hZGUgZnJvbSBiYWxhbmNlCiAgICAkc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkPS0xOwogICAgJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD0tMTsKICB9CgogIGxvZ0RlYnVnKCJldmVudFBhY2thZ2VBc3NvY2lhdGlvbk1vZGFsQ29udHJvbGxlciIpOwogIGdldFBhY2thZ2VzRm9yRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5idXNpbmVzc191c2VyX2lkLCRzY29wZS5mbWVldGluZy5ldmVudF9pZCwncmVsYXRlZFBhY2thZ2VzJyxnZXRQYWNrYWdlc0ZvckV2ZW50X3N1Y2Nlc3MpOyAvLyB3YXMgZ2V0QnVzaW5lc3NQYWNrYWdlCiAgZnVuY3Rpb24gZ2V0UGFja2FnZXNGb3JFdmVudF9zdWNjZXNzKCkKICB7CiAgfQoKICAkc2NvcGUuY2xvc2VNb2RhbCA9IGZ1bmN0aW9uKCkKICB7CiAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICB9OwogICRzY29wZS51cGRhdGVFdmVudFBhY2thZ2UgPSBmdW5jdGlvbigpCiAgewogICAgY29uc29sZS5sb2coInByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD0iKyRzY29wZS5mbWVldGluZy5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQpOwogICAgY29uc29sZS5sb2coInBhY2thZ2VfdXNlcl9pZD0iKyRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQpOwogICAgLy8gaWYgc2VsZWN0ZWQgcGFja2FnZSBpcyBsaWtlIHByZXZpb3VzIHBhY2thZ2UgLSBkbyBub3RoaW5nCiAgICBpZiAoKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ9PSRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQpKQogICAgewogICAgICBsb2dEZWJ1Zygic2VsZWN0ZWQgb3B0aW9uIGlzIGxpa2UgcHJldmlvdXMgb3B0aW9uIC0gZG8gbm90aGluZyIpOwogICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgICB9CiAgICAvLyBpZiBzZWxlY3RlZCBwYWNrYWdlIGlzIGxpa2UgcHJldmlvdXMgcGFja2FnZSAtIGRvIG5vdGhpbmcKICAgIGlmICgoJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD09JHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZCkgJiYgKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ+MCkpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJzZWxlY3RlZCBwYWNrYWdlIGlzIGxpa2UgcHJldmlvdXMgcGFja2FnZSAtIGRvIG5vdGhpbmciKTsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgfQogICAgLy8gcHJldmlvdXMgcGFja2FnZSB3YXMgc2VsZWN0IC0gbm93IG5vdGhpbmdzIGlzIHNlbGVjdGVkCiAgICBlbHNlIGlmICgoJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD4wKSAmJiAoJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZD09MCkpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJubyBwYWNrYWdlIHNlbGVjdGVkLCByZW1vdmUgcGFja2FnZS1ldmVudCBhc3NvY2lhdGlvbiIpOwogICAgICByZW1vdmVFdmVudFBhY2thZ2VBc3NvY2lhdGlvbigkaHR0cCwkc2NvcGUsJHNjb3BlLmZtZWV0aW5nLmV2ZW50X2lkLCRzY29wZS5idXNpbmVzc191c2VyX2lkLHVwZGF0ZUV2ZW50UGFja2FnZV9zdWNjZXNzKTsKICAgIH0KICAgIC8vIHByZXZpb3VzIHBhY2thZ2Ugd2FzIHNlbGVjdGVkIC0gbm93IGEgZGlmZmVyZW50IHBhY2thZ2UgaXMgc2VsZWN0ZWQKICAgIGVsc2UgaWYgKCgkc2NvcGUucHJldmlvdXNfcGFja2FnZV91c2VyX2lkPjApICYmICgkc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkPjApKQogICAgewogICAgICBsb2dEZWJ1ZygidXBkYXRpbmcgbmV3IHBhY2thZ2UgdG8gcGFja2FnZV91c2VyX2lkPSAiKyRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQpOwogICAgICByZWFzc2lnbkV2ZW50UGFja2FnZUFzc29jaWF0aW9uKCRodHRwLCRzY29wZSwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZCwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCx1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2Vzcyk7CiAgICB9CiAgICAvLyBwcmV2aW91cyBwYWNrYWdlIHdhcyBub25lIC0gbm93IGEgcGFja2FnZSBpcyBzZWxlY3RlZAogICAgZWxzZSBpZiAoKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ9PTApICYmICgkc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkPjApKQogICAgewogICAgICBsb2dEZWJ1ZygidXBkYXRpbmcgbmV3IHBhY2thZ2UgdG8gcGFja2FnZV91c2VyX2lkPSAiKyRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQpOwogICAgICByZWFzc2lnbkV2ZW50UGFja2FnZUFzc29jaWF0aW9uKCRodHRwLCRzY29wZSwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZCwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCx1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2Vzcyk7CiAgICB9CiAgICAvLyBwcmV2aW91cyBhc3NvY2lhdGlvbiB3YXMgcGFpZCBvciBoYWxmIHBhaWQgLSBub3cgaXRzIG5vbmUKICAgIGVsc2UgaWYgKCgkc2NvcGUucHJldmlvdXNfZXZlbnRfcGF5bWVudHM+MCkgJiYgKCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQ9PTApKQogICAgewogICAgICBsb2dEZWJ1ZygicmVtb3ZpbmcgcGF5bWVudCBmcm9tIGV2ZW50LCBwYWNrYWdlX3VzZXJfaWQ9ICIrJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZCk7CiAgICAgIHJlbW92ZUV2ZW50UGF5bWVudEFzc29jaWF0aW9uKCRodHRwLCRzY29wZSwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwoKICAgICAgLy8gcmVhc3NpZ25FdmVudFBhY2thZ2VBc3NvY2lhdGlvbigkaHR0cCwkc2NvcGUsJHNjb3BlLmZtZWV0aW5nLmV2ZW50X2lkLCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwogICAgICAvLyB0b2RvCiAgICB9CiAgICAvLyB3YXMgcGFja2FnZSBwYXltZW50IC0+IG5vdyBiYWxhbmNlIHBheW1lbnQKICAgIGVsc2UgaWYgKCgkc2NvcGUucHJldmlvdXNfcGFja2FnZV91c2VyX2lkPjApICYmICgkc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkPT0tMSkpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJtb3ZpbmcgcGF5bWVudCBmcm9tIHBhY2thZ2UgdG8gYmFsYW5jZSIpOwogICAgICBhZGRFdmVudFBheW1lbnRSZW1vdmVQYWNrYWdlKCRodHRwLCRzY29wZSwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwogICAgfQogICAgLy8gd2FzIGJhbGFuY2UgcGF5bWVudCAtPiBub3cgcGFja2FnZSBwYXltZW50CiAgICBlbHNlIGlmICgoJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD09LTEpICYmICgkc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkPjApKQogICAgewogICAgICBsb2dEZWJ1ZygibW92aW5nIHBheW1lbnQgZnJvbSBiYWxhbmNlIHRvIHBhY2thZ2UiKTsKICAgICAgYWRkRXZlbnRQYWNrYWdlUmVtb3ZlUGF5bWVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLmZtZWV0aW5nLmV2ZW50X2lkLCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwoKICAgIH0KICAgIC8vIHdhcyBub3QgcGFpZCBhdCBhbGwgLT4gbm93IGJhbGFuY2UgcGF5CiAgICBlbHNlIGlmICgoJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD09MCkgJiYgKCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQ9PS0xKSkKICAgIHsKICAgICAgbG9nRGVidWcoIm1vdmluZyBwYXltZW50IGZyb20gbm9uZSB0byBiYWxhbmNlIik7CiAgICAgIGFkZEV2ZW50UGF5bWVudEFzc29jaWF0aW9uKCRodHRwLCRzY29wZSwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MoKQogIHsKICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICAgIGxvZ0RlYnVnKCJicm9hZGNhc3RpbmcgY2xpZW50UGFnZVJlbG9hZERhdGEiKTsKICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKICB9Cgp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ2FyY2hpdmVfY2xpZW50X21vZGFsJywgZnVuY3Rpb24oJHNjb3BlLCAkbG9jYXRpb24sIGlzX2luc3RydWN0b3IsIGJ1c2luZXNzX3VzZXJfaWQsIGJ1c2VyX2ZpcnN0X25hbWUsIGJ1c2VyX2xhc3RfbmFtZSwgJHJvb3RTY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRodHRwLCB1aUNhbGVuZGFyQ29uZmlnKSB7CiAgJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQ9YnVzaW5lc3NfdXNlcl9pZDsKICAkc2NvcGUuYnVzZXJfZmlyc3RfbmFtZT1idXNlcl9maXJzdF9uYW1lOwogICRzY29wZS5idXNlcl9sYXN0X25hbWU9YnVzZXJfbGFzdF9uYW1lOwogICRzY29wZS5pc19pbnN0cnVjdG9yPWlzX2luc3RydWN0b3I7CgogIGxvZ0RlYnVnKCJhcmNoaXZlX2NsaWVudF9tb2RhbCBjb250cm9sbGVyIik7CgogICRzY29wZS5jbG9zZU1vZGFsID0gZnVuY3Rpb24oKSB7CiAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICB9OwoKICAkc2NvcGUuYXJjaGl2ZUNsaWVudCA9IGZ1bmN0aW9uKCkKICB7CiAgICBhcmNoaXZlQ2xpZW50KCRodHRwLCRzY29wZSwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCxhcmNoaXZlQ2xpZW50X3N1Y2Nlc3MpOwogICAgZnVuY3Rpb24gYXJjaGl2ZUNsaWVudF9zdWNjZXNzKCkKICAgIHsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgICBpZiAoJHNjb3BlLmlzX2luc3RydWN0b3IpCiAgICAgIHsKICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2luc3RydWN0b3JzJyk7CiAgICAgIH0KICAgICAgZWxzZSB7CiAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jbGllbnRzJyk7CiAgICAgIH0KICAgIH0KICB9Cgp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ3BheW1lbnlEZXRhaWxzTW9kYWxDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkcm91dGVQYXJhbXMsICRyb290U2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgZnBheW1lbnQsIHVpQ2FsZW5kYXJDb25maWcpIHsKICAkc2NvcGUuZnBheW1lbnQ9e307CiAgJHNjb3BlLmZwYXltZW50LnBheW1lbnRfZGF0ZT1mcGF5bWVudC5wYXltZW50X2RhdGU7CiAgJHNjb3BlLmZwYXltZW50LnBheW1lbnRfYW1vdW50PWZwYXltZW50LnBheW1lbnRfYW1vdW50OwogICRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2dlbmVyYXRlZD1mcGF5bWVudC5pbnZvaWNlX2dlbmVyYXRlZDsKICAkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9udW1iZXI9ZnBheW1lbnQuaW52b2ljZV9udW1iZXI7CiAgaWYgKGZwYXltZW50Lmludm9pY2VfZGF0ZT09bnVsbCkKICB7CiAgICAkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlX2Zvcm1hdD1uZXcgRGF0ZSgpOwogIH0KICBlbHNlCiAgewogICAgJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZV9mb3JtYXQ9ZnBheW1lbnQuaW52b2ljZV9kYXRlX2Zvcm1hdDsKICB9CiAgJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZT1mcGF5bWVudC5pbnZvaWNlX2RhdGU7CiAgJHNjb3BlLnNlbGVjdGVkUGF5bWVudE1ldGhvZD17CgkJbmFtZTogZnBheW1lbnQucGF5bWVudF9tZXRob2RfbmFtZV90eHQsCgkJbWV0aG9kOiBmcGF5bWVudC5wYXltZW50X21ldGhvZF9uYW1lCgl9OwogICRzY29wZS5pc1BheW1lbnRNZXRob2RTZWxlY3RlZD10cnVlOwoKICBsb2dEZWJ1Zygib2xkIGRhdGUgIiskc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlKTsKICBpZiAoJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZSE9bnVsbCkKICB7CiAgICAkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlX2Zvcm1hdCA9IG5ldyBEYXRlKCRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2RhdGUpOwogIH0KICAkc2NvcGUucGF5bWVudE1ldGhvZHMgPSBwYXltZW50TWV0aG9kczsKICAkc2NvcGUucGF5bWVudFR5cGVUaXRsZT1mcGF5bWVudC5wYXltZW50X21ldGhvZF9uYW1lX3R4dDsKICAkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9zb3VyY2U9IkVYVEVSTkFMIjsKCiAgbG9nRGVidWcoJHNjb3BlLnBheW1lbnRNZXRob2RzKTsKICBsb2dEZWJ1ZygicGF5bWVueURldGFpbHNNb2RhbENvbnRyb2xsZXIgZm9yIHBheW1lbnQgIitKU09OLnN0cmluZ2lmeShmcGF5bWVudCwgbnVsbCwgNCkpOwoKICAkc2NvcGUuc2VsZWN0UGF5bWVudE1ldGhvZCA9IGZ1bmN0aW9uKHBheW1lbnQpIHsKICAgICRzY29wZS5wYXltZW50VHlwZVRpdGxlPXBheW1lbnQubmFtZTsKICAgIGxvZ0RlYnVnKCJwYXltZW50PSIrcGF5bWVudCk7CgogICAgJHNjb3BlLnNlbGVjdGVkUGF5bWVudE1ldGhvZD1wYXltZW50OwogICAgJHNjb3BlLmlzUGF5bWVudE1ldGhvZFNlbGVjdGVkPXRydWU7CiAgfTsKCiAgJHNjb3BlLmNsb3NlTW9kYWwgPSBmdW5jdGlvbigpIHsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogIH07CgogICRzY29wZS51cGRhdGVQYXltZW50ID0gZnVuY3Rpb24oKQogIHsKICAgIC8vIGxvZ0RlYnVnKGN1cnJlbnRDbGllbnQpOwogICAgbG9nRGVidWcoInBheW1lbnQgbWV0aG9kIik7CiAgICBsb2dEZWJ1Zygkc2NvcGUuc2VsZWN0ZWRQYXltZW50TWV0aG9kKTsKICAgIGxvZ0RlYnVnKCIkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9nZW5lcmF0ZWQ9PCIrJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZ2VuZXJhdGVkKyI+LCAkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlX2Zvcm1hdD0iKyRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2RhdGVfZm9ybWF0KTsKICAgIGxvZ0RlYnVnKCIkc2NvcGUuc2VsZWN0ZWRQYXltZW50TWV0aG9kLm1ldGhvZD0iKyRzY29wZS5zZWxlY3RlZFBheW1lbnRNZXRob2QubWV0aG9kKTsKICAgIGlmICgoJHNjb3BlLmZwYXltZW50LnBheW1lbnRfYW1vdW50PT0wKSB8fCAoJHNjb3BlLmZwYXltZW50LnBheW1lbnRfYW1vdW50PT0nJykgfHwgKCRzY29wZS5mcGF5bWVudC5wYXltZW50X2Ftb3VudD09bnVsbCkpCiAgICB7CiAgICAgICRzY29wZS51c2VyRXJyb3I9IteQ16DXkCDXlNeW158g16HXm9eV150g15vXnNep15TXlSI7CiAgICAgIC8vIGFsZXJ0KCdzcycpOwogICAgfQogICAgZWxzZSBpZiAoISRzY29wZS5pc1BheW1lbnRNZXRob2RTZWxlY3RlZCkKICAgIHsKICAgICAgJHNjb3BlLnVzZXJFcnJvcj0i15DXoNeQINeR15fXqCDXkNee16bXoteZINeq16nXnNeV150iOwogICAgICAvLyBhbGVydCgnc3MnKTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgaWYgKCgkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9nZW5lcmF0ZWQhPTEpIHx8ICgkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlX2Zvcm1hdD09bnVsbCkpCiAgICAgIHsKICAgICAgICB2YXIgaW52b2ljZV9kYXRlX2Zvcm1hdCA9ICJudWxsIjsKICAgICAgfQogICAgICBlbHNlCiAgICAgIHsKICAgICAgICB2YXIgaW52b2ljZV9kYXRlX2Zvcm1hdCA9ICRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2RhdGVfZm9ybWF0LmdldERhdGUoKSAgKyAiLSIgKyAoJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZV9mb3JtYXQuZ2V0TW9udGgoKSsxKSArICItIiArICRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2RhdGVfZm9ybWF0LmdldEZ1bGxZZWFyKCk7CiAgICAgIH0KICAgICAgdGhlZGF0YT0gewogICAgICAgICAgYmFsYW5jZVRvUGF5OiAkc2NvcGUuZnBheW1lbnQucGF5bWVudF9hbW91bnQsCiAgICAgICAgICBwYXltZW50X21ldGhvZF9uYW1lOiAkc2NvcGUuc2VsZWN0ZWRQYXltZW50TWV0aG9kLm1ldGhvZCwKICAgICAgICAgIGludm9pY2VfbnVtYmVyOiAkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9udW1iZXIsCiAgICAgICAgICBpbnZvaWNlX2dlbmVyYXRlZDogJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZ2VuZXJhdGVkLAogICAgICAgICAgaW52b2ljZV9kYXRlOiBpbnZvaWNlX2RhdGVfZm9ybWF0LAogICAgICAgICAgaW52b2ljZV9zb3VyY2U6ICRzY29wZS5mcGF5bWVudC5pbnZvaWNlX3NvdXJjZQogICAgICB9OwogICAgICB1cGRhdGVQYXltZW50Rm9yQ2xpZW50KCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCxmcGF5bWVudC51c2VyX3BheW1lbnRfaWQsdGhlZGF0YSxjcmVhdGVQYXltZW50Rm9yQ2xpZW50X2NhbGxiYWNrLCBjcmVhdGVQYXltZW50Rm9yQ2xpZW50X2ZhaWx1cmUpOwogICAgICBmdW5jdGlvbiBjcmVhdGVQYXltZW50Rm9yQ2xpZW50X2NhbGxiYWNrKCkKICAgICAgewogICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICAgICAgICBsb2dEZWJ1ZygiYnJvYWRjYXN0aW5nIGNsaWVudFBhZ2VSZWxvYWREYXRhIik7CiAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGNyZWF0ZVBheW1lbnRGb3JDbGllbnRfZmFpbHVyZSgpCiAgICAgIHsKICAgICAgICBsb2dEZWJ1ZygiYnJvYWRjYXN0aW5nIGNsaWVudFBhZ2VSZWxvYWREYXRhIik7CiAgICAgICAgLy8gJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgICB9CiAgICB9CiB9Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignZXZlbnRUeXBlRXh0cmFGaWVsZHNNb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRyb290U2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgZXZlbnRUeXBlUHJvcGVydGllcywgdWlDYWxlbmRhckNvbmZpZykgewogICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzPWV2ZW50VHlwZVByb3BlcnRpZXM7CiAgbG9nRGVidWcoImV2ZW50VHlwZVByb3BlcnRpZXM9IitKU09OLnN0cmluZ2lmeShldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzLCBudWxsLCA0KSk7CiAgaWYgKGV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHM9PW51bGwpCiAgewogICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXNPcmlnPVtdOwogICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHM9W107CiAgfQogIGVsc2UgaWYgKGV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMubGVuZ3RoPjApCiAgewogICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXNPcmlnPShldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzKS5zbGljZSgwKTsKICB9CiAgZWxzZQogIHsKICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzT3JpZz1bXTsKICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzPVtdOwogIH0KICAkc2NvcGUub2tMaW1pdGF0aW9uTW9kYWwgPSBmdW5jdGlvbigpIHsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogIH07CgogICRzY29wZS5jYW5jZWwgPSBmdW5jdGlvbigpCiAgewogICAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcz0kc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllc09yaWc7CiAgICAgIGxvZ0RlYnVnKCJjbG9zZSIpOwogICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllc09yaWcpOwogIH0KICAkc2NvcGUuc2F2ZUFuZENsb3NlID0gZnVuY3Rpb24oKQogIHsKICAgIGxvZ0RlYnVnKCJzYXZlIGFuZCBjbG9zZSIpOwogICAgZnVuY3Rpb24gc2V0Q2xpZW50c0V4dHJhRmllbGRzX3N1Y2Nlc3MoKQogICAgewoKICAgIH0KICAgICRzY29wZS5DbGllbnRzRGV0YWlscz17fTsKICAgICRzY29wZS5DbGllbnRzRGV0YWlscy5leHRyYUZpZWxkcz0kc2NvcGUuZXh0cmFGaWVsZHM7CiAgICBzZXRDbGllbnRzRXh0cmFGaWVsZHMoJGh0dHAsJHNjb3BlLCRzY29wZS5DbGllbnRzRGV0YWlscyxzZXRDbGllbnRzRXh0cmFGaWVsZHNfc3VjY2Vzcyk7CiAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyk7CiAgfQoKICAkc2NvcGUuYWRkRXh0cmFGaWVsZHMgPSBmdW5jdGlvbigpCiAgewogICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyk7CiAgfQoKICAkc2NvcGUuZXh0cmFGaWVsZHMgPSBldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzOwogICRzY29wZS5maWVsZFR5cGVzID0gW3tmaWVsZF9kYXRhdHlwZTogIlRFWFRfQVJFQSIsIG5hbWU6J9eq15nXkdeqINeY16fXodeYJ30sIHtmaWVsZF9kYXRhdHlwZTogIk5VTUJFUiIsIG5hbWU6J9ee16HXpNeoJ30gLCB7ZmllbGRfZGF0YXR5cGU6ICJTVFJJTkciLCBuYW1lOifXmNen16HXmCDXp9em16gnfSAsIHtmaWVsZF9kYXRhdHlwZTogIkJPT0xFQU4iLCBuYW1lOifXqteZ15HXqiDXodeZ157XldefJ30gLCB7ZmllbGRfZGF0YXR5cGU6ICJEQVRFIiwgbmFtZTon16rXkNeo15nXmid9XTsKCiAgJHNjb3BlLmFkZE5ld0ZpZWxkID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgbmV3SXRlbU5vID0gJHNjb3BlLmV4dHJhRmllbGRzLmxlbmd0aCsxOwogICAgJHNjb3BlLmV4dHJhRmllbGRzLnB1c2goeyJmaWVsZF9kYXRhdHlwZSI6IlNUUklORyIsImlzX21hbmRhdG9yeSI6MCwgImZyb21kYiI6IGZhbHNlLCAiZmllbGRfaWQiOiAwLCAiaXNfYWN0aXZlIjogMSwgIm1vZGlmaWVkIjogMH0pOwoKICAgIGxvZ0RlYnVnKCJleHRyYSBmaWVsZHMgIiArIEpTT04uc3RyaW5naWZ5KCRzY29wZS5leHRyYUZpZWxkcywgbnVsbCwgMikpOwoKICB9OwoKICAkc2NvcGUucmVtb3ZlRmllbGQgPSBmdW5jdGlvbihjaG9pY2UpCiAgewogICAgLy8gcmVtb3ZpbmcgZmllbGQKICAgIC8vIGlmIGl0cyBub3Qgb3JpZ2luYXRlZCBmcm9tIGRhdGFiYXNlIC0gdGhlbiB3ZSBzaW1wbHkgZGVsZXRlIGl0IGZyb20gdGhlIGFycmF5CiAgICAvLyBvdGhlcndpc2Ugd2UgbWFyayBpdCBhcyBhY3RpdmU9ZmFsc2UKICAgIGxvZ0RlYnVnKGNob2ljZSk7CiAgICAvLyB2YXIgbGFzdEl0ZW0gPSAoY2hvaWNlLmlkKS0xOy8vJHNjb3BlLmNob2ljZXMubGVuZ3RoLTE7CiAgICAvLyAkc2NvcGUuY2hvaWNlcy5zcGxpY2UobGFzdEl0ZW0sMSk7CiAgICBmb3IodmFyIGkgPSAwOyBpIDwgJHNjb3BlLmV4dHJhRmllbGRzLmxlbmd0aDsgaSsrKQogICAgewogICAgICBpZiAoJHNjb3BlLmV4dHJhRmllbGRzW2ldID09IGNob2ljZSkKICAgICAgewogICAgICAgIGlmIChjaG9pY2UuZnJvbWRiPT1mYWxzZSkKICAgICAgICB7CiAgICAgICAgICAvLyBpZiBub3QgZnJvbSBkYiAtIHJlbW92aW5nIGl0IGZyb20gdGhlIGFycmF5IG9mIGV4dHJhLWZpZWxkcwogICAgICAgICAgJHNjb3BlLmV4dHJhRmllbGRzLnNwbGljZShpLCAxKTsKICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgIC8vIGlmIGZpZWxkIG9yaWdpbmF0ZWQgZnJvbSBkYiAtIHRoYW4gd2UgZG9udCByZW1vdmUgaXQgZnJvbSB0aGUgYXJyYXkKICAgICAgICAgIC8vIGFuZCBtYXJrIGl0IGFzIGFjdGl2ZT1mYWxzZSBzbyB0aGF0IGl0IGNhbiBiZSBoYW5kZWxlZCBvbiB0aGUgc2VydmVyCiAgICAgICAgICBjaG9pY2UuaXNfYWN0aXZlPTA7CiAgICAgICAgICBjaG9pY2UubW9kaWZpZWQ9dHJ1ZTsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICB9Owp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ2V2ZW50Q2xvc2VJZ25vcmVNYW5kYXRvcnlGaWVsZHNNb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRyb3V0ZVBhcmFtcywgJHJvb3RTY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRodHRwLCBjdXJyZW50RXZlbnQsIHVpQ2FsZW5kYXJDb25maWcpIHsKICAkc2NvcGUuY3VycmVudEV2ZW50PWN1cnJlbnRFdmVudDsKCiAgJHNjb3BlLm9rQ2FuY2VsID0gZnVuY3Rpb24oKSB7CiAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICB9OwoKICAkc2NvcGUuY2xvc2VFdmVudElnbm9yZU1hbmRhdG9yeUZpZWxkcyA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1ZygiaWdub3JlIG1hbmRhdG9yeSBleHRyYSBmaWVsZHMgYW5kIGNsb3NlIGV2ZW50Iik7CiAgICAkc2NvcGUuY3VycmVudEV2ZW50Lmlnbm9yZUV4dHJhRmllbGRzVmFsaWRhdGlvbj10cnVlOwogICAgY2xvc2VFdmVudCgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLCRzY29wZS5jdXJyZW50RXZlbnQsYWZ0ZXJDbG9zZUV2ZW50LGFmdGVyQ2xvc2VFdmVudCk7CiAgICBmdW5jdGlvbiBhZnRlckNsb3NlRXZlbnQoKQogICAgewogICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2V2ZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgfTsKICB9Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignZXZlbnRUeXBlQ2hhbmdlZFBvcHVwQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRsb2NhdGlvbiwgJHNjb3BlLCAkcm91dGVQYXJhbXMsICRyb290U2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgZXZlbnRUeXBlUHJvcGVydGllcywgdWlDYWxlbmRhckNvbmZpZykgewogICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzPWV2ZW50VHlwZVByb3BlcnRpZXM7CiAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMudXBkYXRlZF9mcm9tX2RhdGU9bmV3IERhdGUoKTsKICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy51cGRhdGVfZXhpc3RpbmdfZXZlbnRzPWZhbHNlOwoKICAkc2NvcGUuY2xvc2VNb2RhbCA9IGZ1bmN0aW9uKCkgewogICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgfTsKCiAgJHNjb3BlLnVwZGF0ZUV2ZW50VHlwZSA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1ZygidXBkYXRlIEV2ZW50IFR5cGUgIiArICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV2ZW50X3R5cGVfaWQpOwogICAgaWYgKCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF9yZWdpc3RyYXRpb25zPT0nJykKICAgIHsKICAgICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMubWF4X3JlZ2lzdHJhdGlvbnM9MDsKICAgIH0KICAgIHVwZGF0ZUV2ZW50VHlwZSgkaHR0cCwkc2NvcGUsJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXZlbnRfdHlwZV9pZCwkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcyx1cGRhdGVFdmVudFR5cGVfc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiB1cGRhdGVFdmVudFR5cGVfc3VjY2VzcygpCiAgICB7CiAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICAgICAgJGxvY2F0aW9uLnBhdGgoJy9ldmVudF90eXBlcycpOwogICAgfQogIH0KCn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignY2xhc3NEZWxldGVBbGxNb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRyb290U2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgY3VycmVudEV2ZW50LCB1aUNhbGVuZGFyQ29uZmlnKQp7CiAgbG9nRGVidWcoImNvbnRyb2xsZXI6IGNsYXNzRGVsZXRlQWxsTW9kYWxDb250cm9sbGVyIik7CiAgJHNjb3BlLmN1cnJlbnRFdmVudD1jdXJyZW50RXZlbnQ7CiAgJHNjb3BlLmNsb3NlTW9kYWwgPSBmdW5jdGlvbigpCiAgewogICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgfTsKCgogICRzY29wZS5kZWxldGVDbGFzc0V2ZW50U2luZ2xlPWZ1bmN0aW9uICgpIC8vIGRlbGV0ZSBvbmx5IG9uZS9jdXJyZW50IGNsYXNzIGV2ZWh0CiAgewogICAgY2FuY2VsQ2xhc3NFdmVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCxjYW5jZWxDbGFzc0V2ZW50X2NhbGxiYWNrLCBjYW5jZWxDbGFzc0V2ZW50X2NhbGxiYWNrKTsKICAgIGZ1bmN0aW9uIGNhbmNlbENsYXNzRXZlbnRfY2FsbGJhY2soKQogICAgewogICAgICBnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkKTsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ3JlbG9hZEV2ZW50Jyx7ZXZlbnRfaWQgOiAkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkfSk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCiAgICB9CiAgfQogICRzY29wZS5kZWxldGVDbGFzc0V2ZW50c0FsbD1mdW5jdGlvbiAoKSAvLyBkZWxldGUgYWxsIHJlcGVhdGluZyBldmVudHMKICB7CiAgICBjYW5jZWxDbGFzc1JlcGVhdGluZ0V2ZW50KCRodHRwLCRzY29wZSwwLCRzY29wZS5jdXJyZW50RXZlbnQucmVwZWF0X2V2ZW50X2lkLGNhbmNlbENsYXNzRXZlbnRfY2FsbGJhY2ssIGNhbmNlbENsYXNzRXZlbnRfY2FsbGJhY2spOwogICAgZnVuY3Rpb24gY2FuY2VsQ2xhc3NFdmVudF9jYWxsYmFjaygpCiAgICB7CiAgICAgIGdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQpOwogICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgncmVsb2FkRXZlbnQnLHtldmVudF9pZCA6ICRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWR9KTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKICAgIH0KICB9CiAgJHNjb3BlLmRlbGV0ZUNsYXNzRXZlbnRzQWxsU3RhcnRpbmdFdmVudElEPWZ1bmN0aW9uICgpIC8vIGRlbGV0ZSBhbGwgcmVwZWF0aW5nIGV2ZW50cyBzdGFydGluZyBldmVudF9pZAogIHsKICAgIGNhbmNlbENsYXNzUmVwZWF0aW5nRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQsJHNjb3BlLmN1cnJlbnRFdmVudC5yZXBlYXRfZXZlbnRfaWQsY2FuY2VsQ2xhc3NFdmVudF9jYWxsYmFjaywgY2FuY2VsQ2xhc3NFdmVudF9jYWxsYmFjayk7CiAgICBmdW5jdGlvbiBjYW5jZWxDbGFzc0V2ZW50X2NhbGxiYWNrKCkKICAgIHsKICAgICAgLy8gZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCk7CiAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdyZWxvYWRFdmVudCcse2V2ZW50X2lkIDogJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZH0pOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgfQogIH0KCn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignYnVzaW5lc3NfbW9kYWxfbGltaXRhdGlvbl9jcmVhdGUnLCBmdW5jdGlvbigkc2NvcGUsICRyb290U2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgc3RhcnQsZW5kLCBmaXhlZFNjaGVkdWxlLCB1aUNhbGVuZGFyQ29uZmlnKSB7CgogICRzY29wZS5maXhlZFNjaGVkdWxlPWZpeGVkU2NoZWR1bGU7CiAgJHNjb3BlLm9yaWdpbmFsX3N0YXJ0PXN0YXJ0OwogICRzY29wZS5vcmlnaW5hbF9lbmQ9ZW5kOwoKICAkc2NvcGUuc3RhcnQ9bmV3IG1vbWVudChzdGFydCkqMTAwMDsKICAkc2NvcGUuZW5kPW5ldyBtb21lbnQoZW5kKSoxMDAwOwogIGNvbnNvbGUubG9nKCdzdGFydD0nK3N0YXJ0KTsKICBjb25zb2xlLmxvZygnZW5kPScrZW5kKTsKCiAgZ2V0QnVzaW5lc3NMb2NhdGlvbnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19sb2NhdGlvbnMnLGdldEJ1c2luZXNzTG9jYXRpb25zX3N1Y2Nlc3MpOwogIGZ1bmN0aW9uIGdldEJ1c2luZXNzTG9jYXRpb25zX3N1Y2Nlc3MoKQogIHsKICAgICRzY29wZS5uZXdFdmVudERldGFpbHMubG9jYXRpb25faWQ9JHNjb3BlLmJ1c2luZXNzX2xvY2F0aW9uc1swXS5sb2NhdGlvbl9pZDsKICB9CgogIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc3RhcnQpOwogIHNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKGVuZCk7CiAgbG9nRGVidWcoInNlbGVjdGVkRGF0ZVN0YXJ0ID0gIitzZWxlY3RlZERhdGVTdGFydCk7CiAgdmFyIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZSgpICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKICB2YXIgc2VsZWN0ZWREYXRlRW5kID0gbmV3IERhdGUoc2VsZWN0ZWREYXRlRW5kLmdldFRpbWUoKSArIHNlbGVjdGVkRGF0ZUVuZC5nZXRUaW1lem9uZU9mZnNldCgpICogNjAwMDApOwoKICAvLyBsb2dEZWJ1ZygiZGF0ZT0iICsgc2VsZWN0ZWREYXRlU3RhcnQpOwogICRzY29wZS5zZWxlY3RlZEV2ZW50ID0gW107CiAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscyA9IFtdOwogICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRIb3VycygpOwogICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcyA9IChzZWxlY3RlZERhdGVTdGFydC5nZXRNaW51dGVzKCkgPCAxMCA/ICcwJyA6ICcnKSArIHNlbGVjdGVkRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRvdyA9IGRheU5hbWVzW3NlbGVjdGVkRGF0ZVN0YXJ0LmdldERheSgpXTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRhdGUgPSBzZWxlY3RlZERhdGVTdGFydDsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoID0gbW9udGhOYW1lc1tzZWxlY3RlZERhdGVTdGFydC5nZXRNb250aCgpXTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoMTEyID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TW9udGgoKSsxOwogICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aCA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldERhdGUoKTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXIgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRGdWxsWWVhcigpOwogICRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZV9pbnB1dF9mb3JtYXQ9IG5ldyBEYXRlKDE5NzAsIDAsIDEsICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMsICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcywgMCk7CgogICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzID0gc2VsZWN0ZWREYXRlRW5kLmdldEhvdXJzKCk7CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcyA9IChzZWxlY3RlZERhdGVFbmQuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBzZWxlY3RlZERhdGVFbmQuZ2V0TWludXRlcygpOwoKCiAgJHNjb3BlLmNhbmNlbCA9IGZ1bmN0aW9uKCkgewogICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgfTsKCiAgZ2V0QWxsSW5zdHJ1Y3RvcnMoJGh0dHAsJHNjb3BlLCdpbnN0cnVjdG9ycycsZ2V0QWxsSW5zdHJ1Y3RvcnNfc3VjY2Vzcyk7CiAgZnVuY3Rpb24gZ2V0QWxsSW5zdHJ1Y3RvcnNfc3VjY2VzcygpCiAgewogICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pbnN0cnVjdG9yX2lkPSRzY29wZS5pbnN0cnVjdG9yc1swXS5idXNpbmVzc191c2VyX2lkOwogIH0KICBnZXROb0NsYXNzRXZlbnRUeXBlc05vQWRtaW4oJGh0dHAsJHNjb3BlLCdyZWxhdGVkRXZlbnRUeXBlcycpOwoKICAkc2NvcGUuY3JlYXRlTmV3TGltaXRhdGlvbiA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1ZygiZnVuY3Rpb246IGNyZWF0ZU5ld0xpbWl0YXRpb24iKTsKICAgIGNhbGVuZGFyID0gJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnOwoKICAgIGlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudFR5cGVzLmxlbmd0aDwxKQogICAgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBpZiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnM8JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykKICAgIHsKICAgICAgYWxlcnQoIteW157XnyDXodeZ15XXnSDXnNek16DXmSDXltee158g15TXqteX15zXlCIpOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBpZiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnM9PSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMpCiAgICB7CiAgICAgIGlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzPD0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpCiAgICAgIHsKICAgICAgICBhbGVydCgi15bXntefINeh15nXldedINec16TXoNeZINeW157XnyDXlNeq15fXnNeUIik7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIGlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzPCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMrMTApKQogICAgICB7CiAgICAgICAgYWxlcnQoIteR15zXldenINen15jXnyDXni0xMCDXk9en15XXqiIpOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfQogICAgaWYgKCFrdXplSXNDYWxlbmRhckRyYWdnYmxlKSB7CiAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigndW5zZWxlY3QnKTsKICAgIH0KICAgIGxvZ0RlYnVnKCJzdGFydD0iICsgc3RhcnQpOwogICAgY2hlY2tEYXRlID0gbmV3IERhdGUoc3RhcnQpOwogICAgbG9nRGVidWcoImNoZWNrIGRhdGUgPSAiICsgY2hlY2tEYXRlKQogICAgbG9nRGVidWcoImVuZD0iICsgZW5kKTsKICAgIGVjb2xvcj0iIzAwYTY1YSI7CgogICAgaWYgKGNoZWNrRGF0ZS5nZXRGdWxsWWVhcigpID09IDE5NzApIHsKICAgICAgICBkYXlfbGltaXRfaWQgPSAtMTsKICAgIH0gZWxzZSB7CiAgICAgICAgZGF5X2xpbWl0X2lkID0gMTsKICAgIH0KCiAgICAvLyB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tdLmZ1bGxDYWxlbmRhcigncmVyZW5kZXJFdmVudHMnKTsKCiAgICB0ZW1wX2xpbWl0X2lkID0gY2FsY190ZW1wX2xpbWl0X2lkKCk7CgogICAgbG9nRGVidWcoJHNjb3BlLnNlbGVjdGVkRXZlbnRUeXBlc1swXSk7CiAgICBsb2dEZWJ1Zygkc2NvcGUuc2VsZWN0ZWRFdmVudFR5cGVzWzBdLmV2ZW50X3R5cGVfaWQpOwoKICAgIHN0YXJ0X3BhcmFtPXN0YXJ0OwogICAgZW5kX3BhcmFtPWVuZDsKICAgIHRpdGxlX3BhcmFtPScnOwogICAgbG9nRGVidWcoImFkZExpbWl0YXRpb25Ub0RhdGFiYXNlIHN0YXJ0PSIgKyBzdGFydF9wYXJhbSArICIsIGVuZD0iICsgIiwgdGl0bGU9IiArIHRpdGxlX3BhcmFtICk7CgogICAgdGhlZGF0YSA9IHsKICAgICAgICBzdGFydF9kYXRlOiAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWUsCiAgICAgICAgZW5kX2RhdGU6ICRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kX3RpbWUsCiAgICAgICAgY29sb3I6IGVjb2xvciwKICAgICAgICB0ZW1wX2xpbWl0X2lkOiB0ZW1wX2xpbWl0X2lkLAogICAgICAgIGVtcF9pZDogJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pbnN0cnVjdG9yX2lkLAogICAgICAgIGxvY2F0aW9uX2lkOiAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmxvY2F0aW9uX2lkLAogICAgICAgIGV2ZW50X3R5cGVfaWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50VHlwZXNbMF0uZXZlbnRfdHlwZV9pZCwKICAgICAgICBldmVudF90eXBlczogJHNjb3BlLnNlbGVjdGVkRXZlbnRUeXBlcywKICAgICAgICB0aXRsZTogdGl0bGVfcGFyYW0KICAgIH07CgogICAgaWYgKCRzY29wZS5maXhlZFNjaGVkdWxlKSAvLyBmaXhlZCBzY2hlZHVsZSB2cyBzcGVjaWZpYyB3ZWVkL2RheSBsaW1pdGF0aW9uCiAgICB7CiAgICAgIGNyZWF0ZUNhbGVuZGFyTGltaXRhdGlvbigkaHR0cCwkc2NvcGUsdGhlZGF0YSxsaW1pdGF0aW9uX3N1Y2Nlc3NfY2FsbGJhY2spOwogICAgfQogICAgZWxzZQogICAgewogICAgICBjcmVhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXkoJGh0dHAsJHNjb3BlLHRoZWRhdGEsbGltaXRhdGlvbl9zdWNjZXNzX2NhbGxiYWNrKTsKICAgIH0KICAgIGZ1bmN0aW9uIGxpbWl0YXRpb25fc3VjY2Vzc19jYWxsYmFjaygpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJzdWNjZXNzIik7CiAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuZGlzbWlzcygpOwogICAgfQoKICB9CgogICRzY29wZS5zdGFydE1pbnV0ZXMgPSBmdW5jdGlvbigpCiAgewogICAgbG9nRGVidWcoInN0YXJ0TWludXRlcyAiKygkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpKTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcz1taW51dGVzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpOwogICAgY2FsY3VsYXRlU3RhcnRUaW1lKCk7CiAgfQogICRzY29wZS5zdGFydEhvdXJzID0gZnVuY3Rpb24oKQogIHsKICAgIGxvZ0RlYnVnKCJzdGFydEhvdXJzICIraG91cnNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMpKTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnM9aG91cnNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMpOwogICAgY2FsY3VsYXRlU3RhcnRUaW1lKCk7CiAgfQogICRzY29wZS5lbmRNaW51dGVzID0gZnVuY3Rpb24oKQogIHsKICAgIGxvZ0RlYnVnKCJlbmRNaW51dGVzICIrKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpKTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXM9bWludXRlc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcyk7CiAgICBjYWxjdWxhdGVFbmRUaW1lKCk7CiAgfQogICRzY29wZS5lbmRIb3VycyA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1ZygiZW5kSG91cnMgIitob3Vyc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMpKTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzPWhvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vycyk7CiAgICBjYWxjdWxhdGVFbmRUaW1lKCk7CiAgfQoKCiAgZnVuY3Rpb24gY2FsY3VsYXRlU3RhcnRUaW1lKCkKICB7CiAgICBldmVudFllYXI9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyOwogICAgZXZlbnRNb250aD0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoMTEyOwogICAgZXZlbnREYXk9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXlvZm1vbnRoOwogICAgaWYgKHBhcnNlSW50KGV2ZW50TW9udGgpPDEwKQogICAgewogICAgICBldmVudE1vbnRoPSIwIitldmVudE1vbnRoOwogICAgfQogICAgaWYgKHBhcnNlSW50KGV2ZW50RGF5KTwxMCkKICAgIHsKICAgICAgZXZlbnREYXk9IjAiK2V2ZW50RGF5OwogICAgfQogICAgbG9nRGVidWcoIiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0eWVhcj0iK2V2ZW50WWVhcik7CiAgICBsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXlvZm1vbnRoPSIrZXZlbnRNb250aCk7CiAgICBsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aD0iK2V2ZW50RGF5KTsKICAgIG5ld19zdGFydD1tb21lbnQudXRjKGV2ZW50WWVhcisiLSIrZXZlbnRNb250aCsiLSIrZXZlbnREYXkrIlQwMDowMDowMCIpLmFkZCgoKHBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMpKjYwKStwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpKSwgJ21pbnV0ZXMnKTsKICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZT1uZXdfc3RhcnQ7CiAgICBsb2dEZWJ1ZygibmV3X3N0YXJ0PSIrbmV3X3N0YXJ0KTsKICB9CiAgZnVuY3Rpb24gY2FsY3VsYXRlRW5kVGltZSgpCiAgewogICAgZXZlbnRZZWFyPSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0eWVhcjsKICAgIGV2ZW50TW9udGg9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aDExMjsKICAgIGV2ZW50RGF5PSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aDsKICAgIGlmIChwYXJzZUludChldmVudE1vbnRoKTwxMCkKICAgIHsKICAgICAgZXZlbnRNb250aD0iMCIrZXZlbnRNb250aDsKICAgIH0KICAgIGlmIChwYXJzZUludChldmVudERheSk8MTApCiAgICB7CiAgICAgIGV2ZW50RGF5PSIwIitldmVudERheTsKICAgIH0KICAgIGxvZ0RlYnVnKCIkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXI9IitldmVudFllYXIpOwogICAgbG9nRGVidWcoIiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aD0iK2V2ZW50TW9udGgpOwogICAgbG9nRGVidWcoIiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bW9udGg9IitldmVudERheSk7CiAgICBuZXdfZW5kPW1vbWVudC51dGMoZXZlbnRZZWFyKyItIitldmVudE1vbnRoKyItIitldmVudERheSsiVDAwOjAwOjAwIikuYWRkKCgocGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMpKjYwKStwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzKSksICdtaW51dGVzJyk7CiAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZF90aW1lPW5ld19lbmQ7CiAgICBsb2dEZWJ1ZygibmV3X2VuZD0iK25ld19lbmQpOwogIH0KCiAgY2FsY3VsYXRlU3RhcnRUaW1lKCk7CiAgY2FsY3VsYXRlRW5kVGltZSgpOwoKICBmdW5jdGlvbiBtaW51dGVzQ2hhbmdlZCh0aGVtaW51dGVzKQogIHsKICAgIGxvZ0RlYnVnKCJ0aGVtaW51dGVzPSIrdGhlbWludXRlcyk7CiAgICBpZiAodHlwZW9mIHRoZW1pbnV0ZXM9PSJ1bmRlZmluZWQiKQogICAgewogICAgICByZXR1cm4gIjAwIjsKICAgIH0KICAgIHRoZW1pbnV0ZXM9cGFyc2VJbnQodGhlbWludXRlcyk7CiAgICBpZiAodGhlbWludXRlcz42MCkKICAgIHsKICAgICAgcmV0dXJuICIwMCI7CiAgICB9CiAgICBlbHNlIGlmICh0aGVtaW51dGVzPDApCiAgICB7CiAgICAgIHJldHVybiAiMDAiOwogICAgfQogICAgZWxzZSBpZiAodGhlbWludXRlcz09IiIpCiAgICB7CiAgICAgIHJldHVybiAiMDAiOwogICAgfQogICAgZWxzZSBpZiAodGhlbWludXRlczwxMCkKICAgIHsKICAgICAgcmV0dXJuICIwIit0aGVtaW51dGVzOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIHJldHVybiB0aGVtaW51dGVzOwogICAgfQogIH0KICBmdW5jdGlvbiBob3Vyc0NoYW5nZWQodGhlaG91cnMpCiAgewogICAgbG9nRGVidWcoInRoZWhvdXJzPSIrdGhlaG91cnMpOwogICAgaWYgKHR5cGVvZiB0aGVob3Vycz09InVuZGVmaW5lZCIpCiAgICB7CiAgICAgIHJldHVybiAiMCI7CiAgICB9CiAgICB0aGVob3Vycz1wYXJzZUludCh0aGVob3Vycyk7CiAgICBpZiAodGhlaG91cnM+MjQpCiAgICB7CiAgICAgIHJldHVybiAwOwogICAgfQogICAgZWxzZSBpZiAodGhlaG91cnM8MCkKICAgIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CiAgICBlbHNlIGlmICh0aGVob3Vycz09IiIpCiAgICB7CiAgICAgIHJldHVybiAiMCI7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgcmV0dXJuIHRoZWhvdXJzOwogICAgfQogIH0KfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2NsYXNzQ2xvc2VNb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRyb290U2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgZXZlbnRfaWQsIHVpQ2FsZW5kYXJDb25maWcpIHsKICBnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnc2VsZWN0ZWRFdmVudCcsZXZlbnRfaWQsYWZ0ZXJHZXRDbGllbnRTcGVjaWZpY0V2ZW50KTsKICBmdW5jdGlvbiBhZnRlckdldENsaWVudFNwZWNpZmljRXZlbnQoKQogIHsKICAgIGZvciAoaSA9IDA7IGkgPCAkc2NvcGUuc2VsZWN0ZWRFdmVudC5ldmVudFVzZXJzLmxlbmd0aDsgaSsrKQogICAgewogICAgICBpZiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRVc2Vyc1tpXS5zdGF0dXNfbmFtZSE9JGdVc2VyX3N0YXR1c19hYnNlbnRlZCkKICAgICAgewogICAgICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50VXNlcnNbaV0ucGFydGljaXBhdGVkPXRydWU7CiAgICAgIH0KICAgICAgaWYgKCRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50VXNlcnNbaV0uaXNfd2FpdGluZ19saXN0PT0xKQogICAgICB7CiAgICAgICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRVc2Vyc1tpXS5wYXJ0aWNpcGF0ZWQ9ZmFsc2U7CiAgICAgIH0KICAgIH0KICAgIGxvZ0RlYnVnKCRzY29wZS5zZWxlY3RlZEV2ZW50KTsKICB9CgogIC8vIGNsaWNrZWQgcm93IC0gY2hlY2svdW5jaGVjayB0aGUgY2hlY2tib3ggb2YgYSB1c2VyCiAgJHNjb3BlLnJvd0NsaWNrZWQgPSBmdW5jdGlvbihvYmopCiAgewogICAgbG9nRGVidWcoJ3JvdyBjbGlja2VkJyk7CiAgICBvYmoucGFydGljaXBhdGVkID0gIW9iai5wYXJ0aWNpcGF0ZWQ7CiAgfTsKCiAgJHNjb3BlLm9rTGltaXRhdGlvbk1vZGFsID0gZnVuY3Rpb24oKSB7CiAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICB9OwoKICAkc2NvcGUuY2xvc2VDbGFzcyA9IGZ1bmN0aW9uKCkKICB7CiAgICBjbG9zZUNsYXNzRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50X2lkLCRzY29wZS5zZWxlY3RlZEV2ZW50LGFmdGVyQ2xvc2VFdmVudCxhZnRlckNsb3NlRXZlbnQpOwogICAgZnVuY3Rpb24gYWZ0ZXJDbG9zZUV2ZW50KCkKICAgIHsKICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdyZWxvYWRFdmVudCcse2V2ZW50X2lkIDogJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRfaWR9KTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKICAgIH07CiAgfQp9KTsKCmt1emVBcHAuY29udHJvbGxlcignYnVzaW5lc3NDbGllbmRDYXJkUGF5bWVudCcsIGZ1bmN0aW9uKCRzY29wZSwgJHJvdXRlUGFyYW1zLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIGN1cnJlbnRDbGllbnQsIGlzcGx1cywgdWlDYWxlbmRhckNvbmZpZywgQnVzaW5lc3NDb25maWcpCnsKICAkc2NvcGUuaXNwbHVzPWlzcGx1czsKICBsb2dEZWJ1ZygnYnVzaW5lc3NDbGllbmRDYXJkUGF5bWVudCBpc3BsdXM9JyAraXNwbHVzKyIgY3VycmVudENsaWVudD0iKyBKU09OLnN0cmluZ2lmeShjdXJyZW50Q2xpZW50LCBudWxsLCAyKSk7CiAgJHNjb3BlLmt1emVJc0xvYWRpbmc9ZmFsc2U7CiAgbG9nRGVidWcoJ2N1cnJlbnRDbGllbnQucGF5bWVudF9iYWxhbmNlPScrY3VycmVudENsaWVudC5wYXltZW50X2JhbGFuY2UrIixjdXJyZW50Q2xpZW50LnVucGFpZF9iYWxhbmNlID0iK2N1cnJlbnRDbGllbnQudW5wYWlkX2JhbGFuY2UpOwogIHRoZWJhbGFuY2UgPSBjdXJyZW50Q2xpZW50LnBheW1lbnRfYmFsYW5jZS1jdXJyZW50Q2xpZW50LnVucGFpZF9iYWxhbmNlOwogIGxvZ0RlYnVnKCd0aGViYWxhbmNlPScrdGhlYmFsYW5jZSk7CiAgaWYgKHRoZWJhbGFuY2U8MCkKICB7CiAgICAkc2NvcGUuYmFsYW5jZVRvUGF5PU1hdGguYWJzKHRoZWJhbGFuY2UpOwogIH0KICBlbHNlCiAgewogICAgJHNjb3BlLmJhbGFuY2VUb1BheT0wOwogIH0KICAkc2NvcGUucGF5bWVudFR5cGVUaXRsZT0i15HXl9eoIjsKICAkc2NvcGUuY3VycmVudENsaWVudD1jdXJyZW50Q2xpZW50OwogIGxvZ0RlYnVnKCRzY29wZS5jdXJyZW50Q2xpZW50KTsKICAkc2NvcGUuYnVzaW5lc3NDb25maWcgPSBCdXNpbmVzc0NvbmZpZy5nZXQoKTsKICAkc2NvcGUuYnVzaW5lc3NDb25maWcudGhlbihmdW5jdGlvbiAoY29uZmlnKSB7CiAgICAkc2NvcGUuaW52b2ljZV9zb3VyY2VfaWQgPSBjb25maWcuaW52b2ljZV9zb3VyY2VfaWQ7CiAgICAkc2NvcGUuaGFzVmF0ID0gY29uZmlnLnZhdF9yYXRlID4gMDsKICB9KTsKCiAgJHNjb3BlLmNsb3NlTW9kYWwgPSBmdW5jdGlvbigpIHsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogIH07CgogICRzY29wZS5leHRlcm5hbF9pbnZvaWNlX2dlbmVyYXRlZD1mYWxzZTsKICAkc2NvcGUuaW52b2ljZV9kYXRlX2Zvcm1hdD1uZXcgRGF0ZSgpOwoKICBnZXROZXh0SW52b2ljZU51bWJlcigkaHR0cCwkc2NvcGUsJHNjb3BlLmN1cnJlbnRDbGllbnQuYnVzaW5lc3NfdXNlcl9pZCwnaW52b2ljZV9udW1iZXInKTsKCiAgJHNjb3BlLnBheW1lbnRNZXRob2RzID0gcGF5bWVudE1ldGhvZHM7CiAgJHNjb3BlLmNyZWRpdENhcmRUeXBlcyA9IGNyZWRpdENhcmRUeXBlczsKICAkc2NvcGUuY3JlZGl0VHJhbnNhY3Rpb25UeXBlcyA9IGNyZWRpdFRyYW5zYWN0aW9uVHlwZXM7CiAgJHNjb3BlLmJhbmtzID0gYmFua3M7CgogIC8vIGluZGljYXRpb24gd2hldGhlciBwYXltZW50IG1ldGhvZCB3YXMgc2VsZWN0ZWQKICAkc2NvcGUuaXNQYXltZW50TWV0aG9kU2VsZWN0ZWQ9ZmFsc2U7CiAgJHNjb3BlLnNlbGVjdFBheW1lbnRNZXRob2QgPSBmdW5jdGlvbihwYXltZW50KSB7CiAgICAkc2NvcGUucGF5bWVudFR5cGVUaXRsZT1wYXltZW50Lm5hbWU7CiAgICAkc2NvcGUuc2VsZWN0ZWRQYXltZW50TWV0aG9kPXBheW1lbnQ7CiAgICAkc2NvcGUuaXNQYXltZW50TWV0aG9kU2VsZWN0ZWQ9dHJ1ZTsKICB9OwoKICAkc2NvcGUudXBkYXRlQmFsYW5jZSA9IGZ1bmN0aW9uIHVwZGF0ZUJhbGFuY2UgKGlzU291cmNlV2l0aFZhdCkgewogICAgJHNjb3BlLmJ1c2luZXNzQ29uZmlnLnRoZW4oZnVuY3Rpb24gKGNvbmZpZykgewogICAgICBpZiAoaXNTb3VyY2VXaXRoVmF0KSB7CiAgICAgICAgJHNjb3BlLmJhbGFuY2VUb1BheU5vVmF0ID0gTnVtYmVyKCgkc2NvcGUuYmFsYW5jZVRvUGF5IC8gKDEgKyBjb25maWcudmF0X3JhdGUpKS50b0ZpeGVkKDIpKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAkc2NvcGUuYmFsYW5jZVRvUGF5ID0gTnVtYmVyKCgkc2NvcGUuYmFsYW5jZVRvUGF5Tm9WYXQgKiAoMSArIGNvbmZpZy52YXRfcmF0ZSkpLnRvRml4ZWQoMikpOwogICAgICB9CiAgICB9KQogIH07CgogICRzY29wZS5tYWtlUGF5bWVudCA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1ZyhjdXJyZW50Q2xpZW50KTsKICAgIGxvZ0RlYnVnKCJwYXltZW50IG1ldGhvZCIpOwogICAgbG9nRGVidWcoJHNjb3BlLnNlbGVjdGVkUGF5bWVudE1ldGhvZCk7CiAgICBsb2dEZWJ1ZygiJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZ2VuZXJhdGVkPTwiKyRzY29wZS5pbnZvaWNlX2dlbmVyYXRlZCsiPiIpOwoKICAgIGlmICgoJHNjb3BlLmJhbGFuY2VUb1BheT09MCkgfHwgKCRzY29wZS5iYWxhbmNlVG9QYXk9PScnKXx8ICgkc2NvcGUuYmFsYW5jZVRvUGF5PT1udWxsKSkKICAgIHsKICAgICAgJHNjb3BlLnVzZXJFcnJvcj0i15DXoNeQINeU15bXnyDXodeb15XXnSDXm9ec16nXlNeVIjsKICAgIH0KICAgIGVsc2UgaWYgKCEkc2NvcGUuaXNQYXltZW50TWV0aG9kU2VsZWN0ZWQpCiAgICB7CiAgICAgICRzY29wZS51c2VyRXJyb3I9IteQ16DXkCDXkdeX16gg15DXntem16LXmSDXqtep15zXldedIjsKICAgICAgLy8gYWxlcnQoJ3NzJyk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgIGlmICgoJHNjb3BlLmludm9pY2VfZ2VuZXJhdGVkIT0xKSB8fCAoJHNjb3BlLmludm9pY2VfZGF0ZV9mb3JtYXQ9PW51bGwpKQogICAgICB7CiAgICAgICAgdmFyIGludm9pY2VfZGF0ZV9mb3JtYXQgPSAibnVsbCI7CiAgICAgIH0KICAgICAgZWxzZQogICAgICB7CiAgICAgICAgdmFyIGludm9pY2VfZGF0ZV9mb3JtYXQgPSAkc2NvcGUuaW52b2ljZV9kYXRlX2Zvcm1hdC5nZXREYXRlKCkgICsgIi0iICsgKCRzY29wZS5pbnZvaWNlX2RhdGVfZm9ybWF0LmdldE1vbnRoKCkrMSkgKyAiLSIgKyAkc2NvcGUuaW52b2ljZV9kYXRlX2Zvcm1hdC5nZXRGdWxsWWVhcigpOwogICAgICB9CiAgICAgIGlmIChpc3BsdXMpCiAgICAgIHsKICAgICAgICB3aGF0VG9QYXk9JHNjb3BlLmJhbGFuY2VUb1BheTsKICAgICAgfQogICAgICBlbHNlIHsKICAgICAgICB3aGF0VG9QYXk9LSRzY29wZS5iYWxhbmNlVG9QYXk7CiAgICAgIH0KICAgICAgdGhlZGF0YT0gewogICAgICAgIGJhbGFuY2VUb1BheTogd2hhdFRvUGF5LAogICAgICAgIGJhbGFuY2VUb1BheU5vVmF0OiAkc2NvcGUuYmFsYW5jZVRvUGF5Tm9WYXQgKiAoaXNwbHVzID8gKzEgOiAtMSksCiAgICAgICAgcGF5bWVudF9tZXRob2RfbmFtZTogJHNjb3BlLnNlbGVjdGVkUGF5bWVudE1ldGhvZC5tZXRob2QsCiAgICAgICAgaW52b2ljZV9udW1iZXI6ICRzY29wZS5pbnZvaWNlX251bWJlciwKICAgICAgICBpbnZvaWNlX2dlbmVyYXRlZDogJHNjb3BlLmludm9pY2VfZ2VuZXJhdGVkLAogICAgICAgIGludm9pY2VfZGF0ZTogaW52b2ljZV9kYXRlX2Zvcm1hdCwKICAgICAgICBiYW5rX2NvbXBhbnlfY29kZTogJHNjb3BlLmJhbmtfY29tcGFueV9jb2RlLAogICAgICAgIGJhbmtfYnJhbmNoX251bWJlcjogJHNjb3BlLmJhbmtfYnJhbmNoX251bWJlciwKICAgICAgICBjaGVja19udW1iZXI6ICRzY29wZS5jaGVja19udW1iZXIsCiAgICAgICAgYWNjb3VudF9udW1iZXI6ICRzY29wZS5hY2NvdW50X251bWJlciwKICAgICAgICBjcmVkaXRfY2FyZF9udW1iZXI6ICRzY29wZS5jcmVkaXRfY2FyZF9udW1iZXIsCiAgICAgICAgY3JlZGl0X2NhcmRfdHlwZTogJHNjb3BlLmNyZWRpdF9jYXJkX3R5cGUsCiAgICAgICAgY3JlZGl0X2NhcmRfdHJhbnNhY3Rpb25fdHlwZTogJHNjb3BlLmNyZWRpdF9jYXJkX3RyYW5zYWN0aW9uX3R5cGUsCiAgICAgICAgaW52b2ljZV9jb21tZW50czogJHNjb3BlLmludm9pY2VfY29tbWVudHMKICAgICAgfTsKICAgICAgJHNjb3BlLmt1emVJc0xvYWRpbmc9dHJ1ZTsKICAgICAgY3JlYXRlUGF5bWVudEZvckNsaWVudCgkaHR0cCwkc2NvcGUsY3VycmVudENsaWVudC5idXNpbmVzc191c2VyX2lkLHRoZWRhdGEsY3JlYXRlUGF5bWVudEZvckNsaWVudF9zdWNjZXNzLCBjcmVhdGVQYXltZW50Rm9yQ2xpZW50X2ZhaWx1cmUpOwogICAgICBmdW5jdGlvbiBjcmVhdGVQYXltZW50Rm9yQ2xpZW50X3N1Y2Nlc3MoKQogICAgICB7CiAgICAgICAgJHNjb3BlLmt1emVJc0xvYWRpbmc9ZmFsc2U7CiAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgICAgIGxvZ0RlYnVnKCJicm9hZGNhc3RpbmcgY2xpZW50UGFnZVJlbG9hZERhdGEiKTsKICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NsaWVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCiAgICAgICAgbG9nRGVidWcoImJyb2FkY2FzdGluZyBldmVudFBhZ2VSZWxvYWREYXRhIik7CiAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdldmVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCiAgICAgICAgLy8gbG9nRGVidWcoImJyb2FkY2FzdGluZyByZWxvYWRFdmVudCIpOwogICAgICAgIC8vICRyb290U2NvcGUuJGJyb2FkY2FzdCgncmVsb2FkRXZlbnQnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKICAgICAgfQogICAgICBmdW5jdGlvbiBjcmVhdGVQYXltZW50Rm9yQ2xpZW50X2ZhaWx1cmUoKQogICAgICB7CiAgICAgICAgJHNjb3BlLmt1emVJc0xvYWRpbmc9ZmFsc2U7CiAgICAgIH0KICAgIH0KIH0KfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdldmVudERldGFpbHNCdXNpbmVzc0NhbGVuZGFyTW9kYWxDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIHNlbGVjdGVkRXZlbnQsIHVpQ2FsZW5kYXJDb25maWcpIHsKICAgIHZhciBkYXlOYW1lcyA9IFsn16jXkNep15XXnycsICfXqdeg15knLCAn16nXnNeZ16nXmScsICfXqNeR15nXoteZJywgJ9eX157Xmdep15knLCAn16nXmdep15knLCAn16nXkdeqJ107CgogICAgJHNjb3BlLmdvdG9DbGllbnRQYWdlPSBmdW5jdGlvbiAoYnVzaW5lc1VzZXJpZCkKICAgIHsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgICBnb3RvQ2xpZW50UGFnZShidXNpbmVzVXNlcmlkKTsKICAgIH0KICAgICRzY29wZS5lZGl0RXZlbnQ9IGZ1bmN0aW9uICh0aGVldmVudCkKICAgIHsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgICBnb3RvRXZlbnRQYWdlKHRoZWV2ZW50KTsKICAgIH0KCiAgICBsb2dEZWJ1Zygic2VsZWN0ZWQgRXZlbnQgaW5mbyA9IiArIEpTT04uc3RyaW5naWZ5KHNlbGVjdGVkRXZlbnQsIG51bGwsIDIpKTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50ID0gc2VsZWN0ZWRFdmVudDsKICAgIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc2VsZWN0ZWRFdmVudC5zdGFydCk7CiAgICB2YXIgc2VsZWN0ZWREYXRlU3RhcnQgPSBuZXcgRGF0ZShzZWxlY3RlZERhdGVTdGFydC5nZXRUaW1lKCkgKyBzZWxlY3RlZERhdGVTdGFydC5nZXRUaW1lem9uZU9mZnNldCgpICogNjAwMDApOwoKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRIb3VycygpOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzID0gKHNlbGVjdGVkRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKSA8IDEwID8gJzAnIDogJycpICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TWludXRlcygpOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkb3cgPSBkYXlOYW1lc1tzZWxlY3RlZERhdGVTdGFydC5nZXREYXkoKV07CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRhdGUgPSBzZWxlY3RlZERhdGVTdGFydDsKCiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydERheSA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldERhdGUoKTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0TW9udGggPSAxICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TW9udGgoKTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0TW9udGhUeHQgPSBtb250aE5hbWVzWyRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0TW9udGggLSAxXTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0WWVhciA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCk7CgogICAgc2VsZWN0ZWREYXRlRW5kID0gbmV3IERhdGUoc2VsZWN0ZWRFdmVudC5lbmQpOwogICAgdmFyIHNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKHNlbGVjdGVkRGF0ZUVuZC5nZXRUaW1lKCkgKyBzZWxlY3RlZERhdGVFbmQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKCiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycyA9IHNlbGVjdGVkRGF0ZUVuZC5nZXRIb3VycygpOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kZG93ID0gZGF5TmFtZXNbc2VsZWN0ZWREYXRlRW5kLmdldERheSgpXTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKSA8IDEwID8gJzAnIDogJycpICsgc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKTsKICAgICRzY29wZS5va0xpbWl0YXRpb25Nb2RhbCA9IGZ1bmN0aW9uKCkgewogICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICAgIH07CgogICAgJHNjb3BlLmRlbGV0ZUxpbWl0YXRpb25Nb2RhbCA9IGZ1bmN0aW9uKCkgewogICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoJ2RlbGV0ZScpOwogICAgICAgIGNhbGVuZGFyID0gJ2NhbGVuZGFyX2J1c2luZXNzJzsKCiAgICAgICAgJHNjb3BlLmRlbGV0ZUNhbGVuZGFyREJFdmVudChzZWxlY3RlZEV2ZW50LCBjYWxlbmRhcik7CiAgICB9OwogICAgJHNjb3BlLmRlbGV0ZUNhbGVuZGFySlNFdmVudCA9IGZ1bmN0aW9uKGNhbGVuZGFyLCBzZWxlY3RlZEV2ZW50aWQpIHsKCiAgICAgICAgbG9nRGVidWcoImNhbGVuZGFyX2hvdXJzX29mX3dvcmtfY29uZmlnPSIgKyB1aUNhbGVuZGFyQ29uZmlnKTsKICAgICAgICBsb2dEZWJ1ZygidWlDYWxlbmRhckNvbmZpZ1tjYWxlbmRhcl09IiArIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWydjYWxlbmRhcl9idXNpbmVzcyddKTsKICAgICAgICBsb2dEZWJ1ZygiZGVsZXRlIGpzIGV2ZW50ICIgKyBzZWxlY3RlZEV2ZW50aWQpOwogICAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlbW92ZUV2ZW50cycsIFtzZWxlY3RlZEV2ZW50aWRdKTsgLy8gZ28gdG8gZGF0ZSBpbiBjYWxlbmRhciBnb3RvCiAgICB9OwogICAgJHNjb3BlLmRlbGV0ZUNhbGVuZGFyREJFdmVudCA9IGZ1bmN0aW9uKHNlbGVjdGVkRXZlbnQsIGNhbGVuZGFyKSB7CiAgICAgICAgbG9nRGVidWcoImRlbGV0ZSBldmVudCAiICsgc2VsZWN0ZWRFdmVudC5pZCk7CiAgICAgICAgJGh0dHAoewogICAgICAgICAgICBtZXRob2Q6ICdQT1NUJywKICAgICAgICAgICAgdXJsOiAnL2FwaS9hZG1pbi9ldmVudHMvZGVsZXRlLycgKyBzZWxlY3RlZEV2ZW50LmlkLAogICAgICAgICAgICBkYXRhOiB7CiAgICAgICAgICAgICAgICB0ZW1wX2xpbWl0X2lkOiBzZWxlY3RlZEV2ZW50LnRlbXBfbGltaXRfaWQKICAgICAgICAgICAgfSwKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uO2NoYXJzZXQ9dXRmLTgnCiAgICAgICAgICAgIH0KICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHsKCiAgICAgICAgICAgIGxvZ0RlYnVnKGRhdGEpOwogICAgICAgICAgICBpZiAoIWRhdGEuc3VjY2VzcykgewogICAgICAgICAgICAgICAgbG9nRGVidWcoImRlbGV0ZSBsaW1pdF9pZCBlcnJvciArIiArIGRhdGEubWVzc2FnZSk7CiAgICAgICAgICAgICAgICAvLyBpZiBub3Qgc3VjY2Vzc2Z1bCwgYmluZCBlcnJvcnMgdG8gZXJyb3IgdmFyaWFibGVzCiAgICAgICAgICAgICAgICAvLwkJCSAgJHNjb3BlLmVycm9yTmFtZSA9IGRhdGEuZXJyb3JzLm5hbWU7CiAgICAgICAgICAgICAgICAvLwkJCSAgJHNjb3BlLmVycm9yU3VwZXJoZXJvID0gZGF0YS5lcnJvcnMuc3VwZXJoZXJvQWxpYXM7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBsb2dEZWJ1ZygiZGVsZXRlIGxpbWl0X2lkIHN1Y2Nlc3MiKTsKICAgICAgICAgICAgICAgIC8vIGlmIHN1Y2Nlc3NmdWwsIGJpbmQgc3VjY2VzcyBtZXNzYWdlIHRvIG1lc3NhZ2UKICAgICAgICAgICAgICAgIC8vCQkJICAkc2NvcGUubWVzc2FnZSA9IGRhdGEubWVzc2FnZTsKICAgICAgICAgICAgICAgICRzY29wZS5kZWxldGVDYWxlbmRhckpTRXZlbnQoY2FsZW5kYXIsIHNlbGVjdGVkRXZlbnQuaWQpOwoKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBsb2dEZWJ1ZygiYWZ0ZXIgcmVtb3ZlIGV2ZW50Iik7CiAgICB9Owp9KTsKCmt1emVBcHAuY29udHJvbGxlcignZXZlbnRSZWN1cnJpbmdEZXRhaWxzQnVzaW5lc3NDYWxlbmRhck1vZGFsQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRodHRwLCBzZWxlY3RlZEV2ZW50LCB1aUNhbGVuZGFyQ29uZmlnKSB7CiAgICB2YXIgZGF5TmFtZXMgPSBbJ9eo15DXqdeV158nLCAn16nXoNeZJywgJ9ep15zXmdep15knLCAn16jXkdeZ16LXmScsICfXl9ee15nXqdeZJywgJ9ep15nXqdeZJywgJ9ep15HXqiddOwoKICAgICRzY29wZS5nb3RvQ2xpZW50UGFnZT0gZnVuY3Rpb24gKGJ1c2luZXNzVXNlcmlkKQogICAgewogICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgICAgIGdvdG9DbGllbnRQYWdlKGJ1c2luZXNzVXNlcmlkKTsKICAgIH0KICAgICRzY29wZS5lZGl0RXZlbnQ9IGZ1bmN0aW9uICh0aGVldmVudCkKICAgIHsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgICBnb3RvRXZlbnRQYWdlKHRoZWV2ZW50KTsKICAgIH0KCgogICAgbG9nRGVidWcoInNlbGVjdGVkIFJlY3VycmluZyBFdmVudCBpbmZvID0iICsgSlNPTi5zdHJpbmdpZnkoc2VsZWN0ZWRFdmVudCwgbnVsbCwgMikpOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQgPSBzZWxlY3RlZEV2ZW50OwogICAgc2VsZWN0ZWREYXRlU3RhcnQgPSBuZXcgRGF0ZShzZWxlY3RlZEV2ZW50LnN0YXJ0KTsKICAgIHZhciBzZWxlY3RlZERhdGVTdGFydCA9IG5ldyBEYXRlKHNlbGVjdGVkRGF0ZVN0YXJ0LmdldFRpbWUoKSArIHNlbGVjdGVkRGF0ZVN0YXJ0LmdldFRpbWV6b25lT2Zmc2V0KCkgKiA2MDAwMCk7CgogICAgLy8gbG9nRGVidWcoInNlbGVjdGVkRXZlbnQuc3RhcnQ9IiArIHNlbGVjdGVkRXZlbnQuc3RhcnQpOwogICAgLy8gbG9nRGVidWcoImRhdGU9IiArIHNlbGVjdGVkRGF0ZVN0YXJ0KTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRIb3VycygpOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzID0gKHNlbGVjdGVkRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKSA8IDEwID8gJzAnIDogJycpICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TWludXRlcygpOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkb3cgPSBkYXlOYW1lc1tzZWxlY3RlZERhdGVTdGFydC5nZXREYXkoKV07CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRhdGUgPSBzZWxlY3RlZERhdGVTdGFydDsKCiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydERheSA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldERhdGUoKTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0TW9udGggPSAxICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TW9udGgoKTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0TW9udGhUeHQgPSBtb250aE5hbWVzWyRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0TW9udGggLSAxXTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0WWVhciA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCk7CgogICAgc2VsZWN0ZWREYXRlRW5kID0gbmV3IERhdGUoc2VsZWN0ZWRFdmVudC5lbmQpOwogICAgdmFyIHNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKHNlbGVjdGVkRGF0ZUVuZC5nZXRUaW1lKCkgKyBzZWxlY3RlZERhdGVFbmQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKCiAgICAvLyBsb2dEZWJ1Zygic2VsZWN0ZWRFdmVudC5lbmQ9IiArIHNlbGVjdGVkRXZlbnQuZW5kKTsKICAgIC8vIGxvZ0RlYnVnKCJkYXRlPSIgKyBzZWxlY3RlZERhdGVFbmQpOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMgPSBzZWxlY3RlZERhdGVFbmQuZ2V0SG91cnMoKTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGRvdyA9IGRheU5hbWVzW3NlbGVjdGVkRGF0ZUVuZC5nZXREYXkoKV07CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzID0gKHNlbGVjdGVkRGF0ZUVuZC5nZXRNaW51dGVzKCkgPCAxMCA/ICcwJyA6ICcnKSArIHNlbGVjdGVkRGF0ZUVuZC5nZXRNaW51dGVzKCk7CiAgICAkc2NvcGUub2tMaW1pdGF0aW9uTW9kYWwgPSBmdW5jdGlvbigpIHsKICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgICB9OwoKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2V2ZW50RGV0YWlsc0hvdXJzT2ZXb3JrTW9kYWxDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIHNlbGVjdGVkRXZlbnQsIGZpeGVkU2NoZWR1bGUsIHVpQ2FsZW5kYXJDb25maWcpIHsKICAgIHZhciBkYXlOYW1lcyA9IFsn16jXkNep15XXnycsICfXqdeg15knLCAn16nXnNeZ16nXmScsICfXqNeR15nXoteZJywgJ9eX157Xmdep15knLCAn16nXmdep15knLCAn16nXkdeqJ107CgogICAgLy8gbG9nRGVidWcoInNlbGVjdGVkIEV2ZW50ID0iICsgSlNPTi5zdHJpbmdpZnkoc2VsZWN0ZWRFdmVudCwgbnVsbCwgNCkpOwogICAgJHNjb3BlLmZpeGVkU2NoZWR1bGU9Zml4ZWRTY2hlZHVsZTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50ID0gc2VsZWN0ZWRFdmVudDsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50Lm9yaWdfZXZlbnRfdHlwZXMgPSBhbmd1bGFyLmNvcHkoc2VsZWN0ZWRFdmVudC5ldmVudF90eXBlcyk7CiAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzID0gW107CgogICAgZ2V0QnVzaW5lc3NMb2NhdGlvbnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19sb2NhdGlvbnMnKTsKCiAgICBsb2dEZWJ1ZygiaG91cnMgb2Ygd29yayBibG9jay9ldmVudCBjbGlja2VkICIrSlNPTi5zdHJpbmdpZnkoJHNjb3BlLnNlbGVjdGVkRXZlbnQpKTsKCiAgICBzZWxlY3RlZERhdGVTdGFydCA9IG5ldyBEYXRlKHNlbGVjdGVkRXZlbnQuc3RhcnQpOwogICAgdmFyIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZSgpICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKICAgIGdldEFsbEluc3RydWN0b3JzKCRodHRwLCRzY29wZSwnaW5zdHJ1Y3RvcnMnKTsKICAgIGdldE5vQ2xhc3NFdmVudFR5cGVzTm9BZG1pbigkaHR0cCwkc2NvcGUsJ3JlbGF0ZWRFdmVudFR5cGVzJyxnZXROb0NsYXNzRXZlbnRUeXBlc05vQWRtaW5fc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBnZXROb0NsYXNzRXZlbnRUeXBlc05vQWRtaW5fc3VjY2VzcygpCiAgICB7CiAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCAkc2NvcGUuc2VsZWN0ZWRFdmVudC5ldmVudF90eXBlcy5sZW5ndGg7IGkrKykKICAgICAgewogICAgICAgIC8vIGNvcHlpbmcgdGhlIGFjdHVhbCBvYmplY3Qgb2YgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRfdHlwZXNbaV0KICAgICAgICBmb3IodmFyIGogPSAwOyBqIDwgJHNjb3BlLnJlbGF0ZWRFdmVudFR5cGVzLmxlbmd0aDsgaisrKQogICAgICAgIHsKICAgICAgICAgIGlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5ldmVudF90eXBlc1tpXS5ldmVudF90eXBlX2lkPT0kc2NvcGUucmVsYXRlZEV2ZW50VHlwZXNbal0uZXZlbnRfdHlwZV9pZCkKICAgICAgICAgIHsKICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRfdHlwZXNbaV09YW5ndWxhci5jb3B5KCRzY29wZS5yZWxhdGVkRXZlbnRUeXBlc1tqXSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgLy8gbG9nRGVidWcoInNlbGVjdGVkRXZlbnQuc3RhcnQ9IiArIHNlbGVjdGVkRXZlbnQuc3RhcnQpOwogICAgLy8gbG9nRGVidWcoImRhdGU9IiArIHNlbGVjdGVkRGF0ZVN0YXJ0KTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRIb3VycygpOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzID0gKHNlbGVjdGVkRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKSA8IDEwID8gJzAnIDogJycpICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TWludXRlcygpOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkb3cgPSBkYXlOYW1lc1tzZWxlY3RlZERhdGVTdGFydC5nZXREYXkoKV07CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRhdGUgPSBzZWxlY3RlZERhdGVTdGFydDsKCiAgICBzZWxlY3RlZERhdGVFbmQgPSBuZXcgRGF0ZShzZWxlY3RlZEV2ZW50LmVuZCk7CiAgICB2YXIgc2VsZWN0ZWREYXRlRW5kID0gbmV3IERhdGUoc2VsZWN0ZWREYXRlRW5kLmdldFRpbWUoKSArIHNlbGVjdGVkRGF0ZUVuZC5nZXRUaW1lem9uZU9mZnNldCgpICogNjAwMDApOwoKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bW9udGggPSBtb250aE5hbWVzW3NlbGVjdGVkRGF0ZVN0YXJ0LmdldE1vbnRoKCldOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aDExMiA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldE1vbnRoKCkrMTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aCA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldERhdGUoKTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0eWVhciA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCk7CiAgICAvLyAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWVfaW5wdXRfZm9ybWF0PSBuZXcgRGF0ZSgxOTcwLCAwLCAxLCAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzLCAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMsIDApOwoKICAgIC8vIGxvZ0RlYnVnKCJzZWxlY3RlZEV2ZW50LmVuZD0iICsgc2VsZWN0ZWRFdmVudC5lbmQpOwogICAgLy8gbG9nRGVidWcoImRhdGU9IiArIHNlbGVjdGVkRGF0ZUVuZCk7CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycyA9IHNlbGVjdGVkRGF0ZUVuZC5nZXRIb3VycygpOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kZG93ID0gZGF5TmFtZXNbc2VsZWN0ZWREYXRlRW5kLmdldERheSgpXTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKSA8IDEwID8gJzAnIDogJycpICsgc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKTsKCgogICAgJHNjb3BlLm9rTGltaXRhdGlvbk1vZGFsID0gZnVuY3Rpb24oKSB7CiAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgfTsKCiAgICAkc2NvcGUudXBkYXRlTGltaXRhdGlvbk1vZGFsID0gZnVuY3Rpb24oKQogICAgewogICAgICBsb2dEZWJ1ZygiZnVuY3Rpb246IHVwZGF0ZUxpbWl0YXRpb25Nb2RhbCIpOwogICAgICBpZiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRfdHlwZXMubGVuZ3RoPDEpCiAgICAgIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgaWYgKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzPCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMpCiAgICAgIHsKICAgICAgICBhbGVydCgi15bXntefINeh15nXldedINec16TXoNeZINeW157XnyDXlNeq15fXnNeUIik7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIGlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vycz09JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykKICAgICAgewogICAgICAgIGlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzPD0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpCiAgICAgICAgewogICAgICAgICAgYWxlcnQoIteW157XnyDXodeZ15XXnSDXnNek16DXmSDXltee158g15TXqteX15zXlCIpOwogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlczwoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKzEwKSkKICAgICAgICB7CiAgICAgICAgICBhbGVydCgi15HXnNeV16cg16fXmNefINeeLTEwINeT16fXldeqIik7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICB9CgoKICAgICAgZnVuY3Rpb24gdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uX3N1Y2Nlc3MoKQogICAgICB7CiAgICAgICAgY2FsZW5kYXIgPSAnY2FsZW5kYXJfaG91cnNfb2Zfd29yayc7CiAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOyAvLyBnbyB0byBkYXRlIGluIGNhbGVuZGFyIGdvdG8KICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5kaXNtaXNzKCdkZWxldGUnKTsKICAgICAgfQoKICAgICAgaWYgKCRzY29wZS5maXhlZFNjaGVkdWxlKQogICAgICB7CiAgICAgICAgLy8gZml4ZWQgc2NoZWR1bGUgLSB1cGFkdGluZyBsaW1pdGF0aW9uIDE5NzAKICAgICAgICB0aGVkYXRhID0gewogICAgICAgICAgICBzdGFydF9kYXRlOiBuZXdfc3RhcnQsCiAgICAgICAgICAgIGVuZF9kYXRlOiBuZXdfZW5kLAogICAgICAgICAgICB0ZW1wX2xpbWl0X2lkOiBudWxsLAogICAgICAgICAgICBsaW1pdF9pZDogJHNjb3BlLnNlbGVjdGVkRXZlbnQubGltaXRfaWQsCiAgICAgICAgICAgIGV2ZW50X3R5cGVzOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5ldmVudF90eXBlcywKICAgICAgICAgICAgbG9jYXRpb25faWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmxvY2F0aW9uX2lkLAogICAgICAgICAgICBvcmlnX2V2ZW50X3R5cGVzOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5vcmlnX2V2ZW50X3R5cGVzLAogICAgICAgICAgICBlbXBfaWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmVtcF9pZAogICAgICAgIH07CiAgICAgICAgdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uKCRodHRwLCRzY29wZSx0aGVkYXRhLCRzY29wZS5zZWxlY3RlZEV2ZW50LmxpbWl0X2lkLCB1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25fc3VjY2Vzcyk7CiAgICAgIH0KICAgICAgZWxzZQogICAgICAvLyBub3QgZml4ZWQgc2NoZWR1bGUgLSBwZXJkYXkgYmxvY2sKICAgICAgewogICAgICAgIC8vLy8vLy8vLy8vCiAgICAgICAgaWYgKCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5saW1pdF9pZCAhPSBudWxsKSAmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5kYXlfbGltaXRfaWQgPT0gLTEpKSAvLyBldmVudCBsaW1pdGF0aW9uIGhhcyBsaW1pdF9pZCBzbyBpdHMgYW4gMTk3MCBldmVudAogICAgICAgIC8vIG5lZWQgdG8gYWRkIGEgbmV3IHBlcmRheSBsaW1pdGF0aW9uIHRoYXQgcG9pbnQgKGxpbWl0X2lkKSB0byB0aGUgb2xkIDE5NzAgZXZlbnQgdG8gcmVwbGFjdGUgaXQKICAgICAgICB7CiAgICAgICAgICAgIHRlbXBfbGltaXRfaWQgPSBjYWxjX3RlbXBfbGltaXRfaWQoKTsKICAgICAgICAgICAgLy8gdGhlZXZlbnQudGVtcF9saW1pdF9pZCA9IHRlbXBfbGltaXRfaWQ7CiAgICAgICAgICAgIC8vIHRoZWV2ZW50LmRheV9saW1pdF9pZCA9IHRlbXBfbGltaXRfaWQ7CiAgICAgICAgICAgIC8vIHRoZSBtb3ZlZCBldmVudCBpbiB0aGUgY2FsZW5kYXIgbm93IGhhcyBkYXlfbGltaXRfaWQgYW5kIHRlbXBfbGltaXRfaWQKICAgICAgICAgICAgLy8gaWYgaXRzIGxvYWRlZCBmcm9tIHRoZSBkYiwgaXQgd2lsbCBvbmx5IGhhdmUgZGF5X2xpbWl0X2lkIChhbmQgbm90IHRoZSB0ZW1wIG9uZSkKICAgICAgICAgICAgLy8gdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnXS5mdWxsQ2FsZW5kYXIoJ3VwZGF0ZUV2ZW50JywgdGhlZXZlbnQpOwogICAgICAgICAgICAvLyBjb25zb2xlLmxvZygiWFhYWFhYWFhYWFhYWCIpOwogICAgICAgICAgICB0aGVkYXRhID0gewogICAgICAgICAgICAgICAgc3RhcnRfZGF0ZTogbmV3X3N0YXJ0LAogICAgICAgICAgICAgICAgZW5kX2RhdGU6IG5ld19lbmQsCiAgICAgICAgICAgICAgICBjb2xvcjogJycsCiAgICAgICAgICAgICAgICB0ZW1wX2xpbWl0X2lkOiAwLAogICAgICAgICAgICAgICAgZXZlbnRfdHlwZV9pZDogJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRfdHlwZV9pZCwKICAgICAgICAgICAgICAgIGV2ZW50X3R5cGVzOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5ldmVudF90eXBlcywKICAgICAgICAgICAgICAgIGxpbWl0X2lkOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5pZCwKICAgICAgICAgICAgICAgIGxvY2F0aW9uX2lkOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5sb2NhdGlvbl9pZCwKICAgICAgICAgICAgICAgIGVtcF9pZDogJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW1wX2lkCiAgICAgICAgICAgICAgICAvLyB0aXRsZTogdGhlZXZlbnQudGl0bGUKICAgICAgICAgICAgfTsKICAgICAgICAgICAgY3JlYXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5KCRodHRwLCRzY29wZSx0aGVkYXRhLHVwZGF0ZUNhbGVuZGFyTGltaXRhdGlvbl9zdWNjZXNzKTsKCiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICB0aGVkYXRhPSB7CiAgICAgICAgICAgICAgc3RhcnRfZGF0ZTogbmV3X3N0YXJ0LAogICAgICAgICAgICAgIGVuZF9kYXRlOiBuZXdfZW5kLAogICAgICAgICAgICAgIHRlbXBfZGF5X2xpbWl0X2lkOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC50ZW1wX2xpbWl0X2lkLAogICAgICAgICAgICAgIG9yaWdfZXZlbnRfdHlwZXM6ICRzY29wZS5zZWxlY3RlZEV2ZW50Lm9yaWdfZXZlbnRfdHlwZXMsCiAgICAgICAgICAgICAgZXZlbnRfdHlwZXM6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50X3R5cGVzLAogICAgICAgICAgICAgIGxvY2F0aW9uX2lkOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5sb2NhdGlvbl9pZCwKICAgICAgICAgICAgICBkYXlfbGltaXRfaWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmRheV9saW1pdF9pZCwKICAgICAgICAgICAgICBlbXBfaWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmVtcF9pZAogICAgICAgICAgfTsKICAgICAgICAgIHVwZGF0ZUNhbGVuZGFyTGltaXRhdGlvblBlckRheSgkaHR0cCwkc2NvcGUsdGhlZGF0YSx1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25fc3VjY2Vzcyk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAkc2NvcGUuZGVsZXRlTGltaXRhdGlvbk1vZGFsID0gZnVuY3Rpb24oKSB7CiAgICAgICAgY2FsZW5kYXIgPSAnY2FsZW5kYXJfaG91cnNfb2Zfd29yayc7CgogICAgICAgIC8vIHJlbW92aW5nIGxpbWl0YXRpb24gZnJvbSBkYXRhYmFzZSwgaWYgdHJ1ZSAtIHJlbW92aW5nIGZyb20gZGlzcGxheSBhbHNvCiAgICAgICAgaWYgKCRzY29wZS5kZWxldGVDYWxlbmRhckRCTGltaXRhdGlvbkV2ZW50KHNlbGVjdGVkRXZlbnQpKQogICAgICAgIHsKICAgICAgICAgIC8vICRzY29wZS5kZWxldGVDYWxlbmRhckpTRXZlbnQoY2FsZW5kYXIsIHNlbGVjdGVkRXZlbnQuaWQpOwogICAgICAgIH0KICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5kaXNtaXNzKCdkZWxldGUnKTsKICAgIH07CiAgICAkc2NvcGUuZGVsZXRlQ2FsZW5kYXJKU0V2ZW50ID0gZnVuY3Rpb24oY2FsZW5kYXIsIHNlbGVjdGVkRXZlbnRpZCkgewoKICAgICAgICBsb2dEZWJ1ZygiY2FsZW5kYXJfaG91cnNfb2Zfd29ya19jb25maWc9IiArIHVpQ2FsZW5kYXJDb25maWcpOwogICAgICAgIGxvZ0RlYnVnKCJ1aUNhbGVuZGFyQ29uZmlnW2NhbGVuZGFyXT0iICsgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnXSk7CiAgICAgICAgbG9nRGVidWcoImRlbGV0ZSBqcyBldmVudCAiICsgc2VsZWN0ZWRFdmVudGlkKTsKICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZW1vdmVFdmVudHMnLCBbc2VsZWN0ZWRFdmVudGlkXSk7IC8vIGdvIHRvIGRhdGUgaW4gY2FsZW5kYXIgZ290bwogICAgfTsKICAgICRzY29wZS5kZWxldGVDYWxlbmRhckRCTGltaXRhdGlvbkV2ZW50ID0gZnVuY3Rpb24oc2VsZWN0ZWRFdmVudCkgewogICAgICAgIGNhbGVuZGFyID0gJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnOwogICAgICAgIC8vIHJldHVybiBmYWxzZTsKCiAgICAgICAgLy8gZGVsZXRpbmcgZXZlbnQgbGltaXRhdGlvbiAobm90IHBlciBkYXkpCiAgICAgICAgLy8gZWl0aGVyIGZyb20gMTk3MCAoaG91cnNfb2Zfd29yayBwYWdlKQogICAgICAgIC8vIG9yIGZyb20gdGhlaXIgaW5zdGFuY2UgaW4gdGhlIGN1cnJlbnQgd2VlaydzIGxpbWl0YXRpb24uCiAgICAgICAgLy8gZWl0aGVyIHdheSBkYXlfbGltaXRfaWQgaXMgLTEgZm9yIGxpbWl0YXRpb25zIGZyb20gMTk3MAogICAgICAgIGlmIChzZWxlY3RlZEV2ZW50LmRheV9saW1pdF9pZCA9PSAtMSkKICAgICAgICB7CiAgICAgICAgICAgIGxvZ0RlYnVnKCJyZW1vdmluZyBldmVudCBsaW1pdGF0aW9uLCBjaGVja2lnbiBpZiBpdHMgaW4gMTk3MCAodGhlIG9yaWdpbmFsKSBvciBhbiBpbnN0YW5jZSBpbiBwcmVzZW50Iik7CiAgICAgICAgICAgIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc2VsZWN0ZWRFdmVudC5zdGFydCk7CiAgICAgICAgICAgIC8vIGlmIGl0cyAxOTcwIHRoaXMgbWVhbnMgd2UncmUgaW4gdGhlIGhvdXJzX29mX3dvcmsgZ2VuZXJhbCBwYWdlCiAgICAgICAgICAgIC8vIHNvIHdlIHNpbXBseSBkZWxldGUgaXQKICAgICAgICAgICAgaWYgKHNlbGVjdGVkRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCkgPT0gMTk3MCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbG9nRGVidWcoInJlbW92aW5nIGV2ZW50IGxpbWl0YXRpb24gZnJvbSAxOTcwIik7CiAgICAgICAgICAgICAgICB0aGVkYXRhPSB7CiAgICAgICAgICAgICAgICAgICAgdGVtcF9saW1pdF9pZDogc2VsZWN0ZWRFdmVudC50ZW1wX2xpbWl0X2lkCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgZGVsZXRlQ2FsZW5kYXJMaW1pdGF0aW9uKCRodHRwLCRzY29wZSx0aGVkYXRhLHNlbGVjdGVkRXZlbnQubGltaXRfaWQsIGRlbGV0ZUNhbGVuZGFyTGltaXRhdGlvbl9zdWNjZXNzKTsKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGRlbGV0ZUNhbGVuZGFyTGltaXRhdGlvbl9zdWNjZXNzKCkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgJHNjb3BlLmRlbGV0ZUNhbGVuZGFySlNFdmVudChjYWxlbmRhciwgc2VsZWN0ZWRFdmVudC5pZCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAvLyByZW1vdmluZyBldmVudCBsaW1pdGF0aW9uIGZyb20gdGhlIGEgc3BlY2lmaWMgd2VlawogICAgICAgICAgICAgICAgLy8gdGhpcyBtZWFucyBhZGRpbmcgZXZlbnQgbGltaXRhdGlvbiBwZXIgZGF5IHdpdGggcmFuZ2UgZW5kPXN0YXJ0CiAgICAgICAgICAgICAgICAvLyBtYXliZSBCVUcgQlVHR1k/CiAgICAgICAgICAgICAgICBsb2dEZWJ1ZygieCByZW1vdmluZyBldmVudCBsaW1pdGF0aW9uIGZyb20gYSBzcGVjaWZpYyB3ZWVrLCB0aGlzIG1lYW5zIGFkZGluZyBldmVudCBsaW1pdGF0aW9uIHBlciBkYXkgd2l0aCByYW5nZSAwLTAiKTsKICAgICAgICAgICAgICAgIC8vIGxvZ0RlYnVnKEpTT04uc3RyaW5naWZ5KHNlbGVjdGVkRXZlbnQpKTsKCiAgICAgICAgICAgICAgICB0aGVkYXRhID0gewogICAgICAgICAgICAgICAgICAgIHN0YXJ0X2RhdGU6IHNlbGVjdGVkRXZlbnQuc3RhcnQsCiAgICAgICAgICAgICAgICAgICAgZW5kX2RhdGU6IHNlbGVjdGVkRXZlbnQuc3RhcnQsCiAgICAgICAgICAgICAgICAgICAgY29sb3I6ICIjMDAwMDAwIiwKICAgICAgICAgICAgICAgICAgICB0ZW1wX2xpbWl0X2lkOiAxLAogICAgICAgICAgICAgICAgICAgIGV2ZW50X3R5cGVfaWQ6IHNlbGVjdGVkRXZlbnQuZXZlbnRfdHlwZV9pZCwKICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbl9pZDogc2VsZWN0ZWRFdmVudC5sb2NhdGlvbl9pZCwKICAgICAgICAgICAgICAgICAgICBsaW1pdF9pZDogc2VsZWN0ZWRFdmVudC5saW1pdF9pZCwKICAgICAgICAgICAgICAgICAgICB0aXRsZTogc2VsZWN0ZWRFdmVudC50aXRsZQogICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICBjcmVhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXkoJGh0dHAsJHNjb3BlLHRoZWRhdGEsY3JlYXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5X3N1Y2Nlc3MpOwogICAgICAgICAgICAgICAgZnVuY3Rpb24gY3JlYXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5X3N1Y2Nlc3MoKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAkc2NvcGUuZGVsZXRlQ2FsZW5kYXJKU0V2ZW50KGNhbGVuZGFyLCBzZWxlY3RlZEV2ZW50LmlkKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlCiAgICAgICAgewogICAgICAgICAgICAvLyBkZWxldGluZyBhIHBlcmRheSBsaW1pdGF0aW9uLgogICAgICAgICAgICAvLyBpZiBpdCdzIGEgcGVyZGF5IHRoYXQgInJlcGxhY2VkIiBhIDE5NzAgb25lCiAgICAgICAgICAgIC8vIHRoZW4gd2UgY2Fubm90IGRlbGV0ZSBpdCAob3RoZXJ3aXNlIHRoZSBvcmlnaW5hbCAxOTcwIHdpbGwgcmVhcHBlYXIpCiAgICAgICAgICAgIC8vIHNvIHdlIHNldCBpdCB0byBzdGFydD1lbmQKICAgICAgICAgICAgLy8gdGhpcyBtYXliZSBhIEJVRyBhbmQgY2F1c2UgVFJPVUJMRSAvLyBUT0RPCiAgICAgICAgICAgIC8vIG90aGV3aXNlIHdlIGNhbiBkZWxldGUgaXQgLSB0aGUgcGVyZGF5IC0gYXMgaXRzIGEgbmV3IHBlcmRheSBhbmQgbm90ICJyZXBsYWNpbmciIGEgMTk3MCBvbmUKCiAgICAgICAgICAgIGlmIChzZWxlY3RlZEV2ZW50LmxpbWl0X2lkICE9IG51bGwpIC8vIHRoaXMgaXMgdGhlIHBlcmRheSB0aGF0IHJlcGxhY2VzIGEgMTk3MCBvbmUgLSB3ZSBzZXQgaXQgdG8gc3RhcnQ9ZW5kCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBsb2dEZWJ1ZygicmVtb3ZpbmcgZXZlbnQgbGltaXRhdGlvbiBwZXIgZGF5IHJlbGF0ZWQgdG8gMTk3MCAodXBkYXRpbmcgaXQgdG8gc3RhcnQ9ZW5kKSIpOwoKICAgICAgICAgICAgICB0aGVkYXRhPSB7CiAgICAgICAgICAgICAgICAgIHN0YXJ0X2RhdGU6IHNlbGVjdGVkRXZlbnQuc3RhcnQsCiAgICAgICAgICAgICAgICAgIGVuZF9kYXRlOiBzZWxlY3RlZEV2ZW50LnN0YXJ0LAogICAgICAgICAgICAgICAgICB0ZW1wX2RheV9saW1pdF9pZDogc2VsZWN0ZWRFdmVudC50ZW1wX2xpbWl0X2lkLAogICAgICAgICAgICAgICAgICBkYXlfbGltaXRfaWQ6IHNlbGVjdGVkRXZlbnQuZGF5X2xpbWl0X2lkCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICB1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXkoJGh0dHAsJHNjb3BlLHRoZWRhdGEsdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5X3N1Y2Nlcyk7CgogICAgICAgICAgICAgIGZ1bmN0aW9uIHVwZGF0ZUNhbGVuZGFyTGltaXRhdGlvblBlckRheV9zdWNjZXMoKQogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICRzY29wZS5kZWxldGVDYWxlbmRhckpTRXZlbnQoY2FsZW5kYXIsIHNlbGVjdGVkRXZlbnQuaWQpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlICAvLyB0aGlzIGlzIHRoZSBjYXNlIHdoZXJlIHRoZSBwZXJkYXkgZG9lc250IHJlcGxhY2UgYSAxOTcwIG9uZSwgd2UgY2FuIHNpbXBseSBkZWxldGUgaXQKICAgICAgICAgICAgewogICAgICAgICAgICAgIGxvZ0RlYnVnKCJyZW1vdmluZyBldmVudCBsaW1pdGF0aW9uIHBlciBkYXkgcmVsYXRlZCBub3QgcmVsYXRlZCB0byAxOTcwIChzbyB3ZSdyZSBkZWxldGluZyBpdCkiKTsKICAgICAgICAgICAgICB0aGVkYXRhID0gewogICAgICAgICAgICAgICAgICB0ZW1wX2xpbWl0X2lkOiBzZWxlY3RlZEV2ZW50LnRlbXBfbGltaXRfaWQKICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIGRlbGV0ZUNhbGVuZGFyTGltaXRhdGlvblBlckRheSgkaHR0cCwkc2NvcGUsdGhlZGF0YSxzZWxlY3RlZEV2ZW50LmRheV9saW1pdF9pZCwgZGVsZXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5X3N1Y2Nlc3MpOwogICAgICAgICAgICAgIGZ1bmN0aW9uIGRlbGV0ZUNhbGVuZGFyTGltaXRhdGlvblBlckRheV9zdWNjZXNzKCkKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAkc2NvcGUuZGVsZXRlQ2FsZW5kYXJKU0V2ZW50KGNhbGVuZGFyLCBzZWxlY3RlZEV2ZW50LmlkKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgbG9nRGVidWcoImFmdGVyIHJlbW92ZSBldmVudCIpOwoKICAgIH07CgoKICAgICRzY29wZS5zdGFydE1pbnV0ZXMgPSBmdW5jdGlvbigpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJzdGFydE1pbnV0ZXMgIisoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKSk7CiAgICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcz1taW51dGVzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpOwogICAgICBjYWxjdWxhdGVTdGFydFRpbWUoKTsKICAgIH0KICAgICRzY29wZS5zdGFydEhvdXJzID0gZnVuY3Rpb24oKQogICAgewogICAgICBsb2dEZWJ1Zygic3RhcnRIb3VycyAiK2hvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKSk7CiAgICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnM9aG91cnNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMpOwogICAgICBjYWxjdWxhdGVTdGFydFRpbWUoKTsKICAgIH0KICAgICRzY29wZS5lbmRNaW51dGVzID0gZnVuY3Rpb24oKQogICAgewogICAgICBsb2dEZWJ1ZygiZW5kTWludXRlcyAiKygkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzKSk7CiAgICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXM9bWludXRlc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcyk7CiAgICAgIGNhbGN1bGF0ZUVuZFRpbWUoKTsKICAgIH0KICAgICRzY29wZS5lbmRIb3VycyA9IGZ1bmN0aW9uKCkKICAgIHsKICAgICAgbG9nRGVidWcoImVuZEhvdXJzICIraG91cnNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzKSk7CiAgICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzPWhvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vycyk7CiAgICAgIGNhbGN1bGF0ZUVuZFRpbWUoKTsKICAgIH0KCgogICAgZnVuY3Rpb24gY2FsY3VsYXRlU3RhcnRUaW1lKCkKICAgIHsKICAgICAgZXZlbnRZZWFyPSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0eWVhcjsKICAgICAgZXZlbnRNb250aD0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoMTEyOwogICAgICBldmVudERheT0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRheW9mbW9udGg7CiAgICAgIGlmIChwYXJzZUludChldmVudE1vbnRoKTwxMCkKICAgICAgewogICAgICAgIGV2ZW50TW9udGg9IjAiK2V2ZW50TW9udGg7CiAgICAgIH0KICAgICAgaWYgKHBhcnNlSW50KGV2ZW50RGF5KTwxMCkKICAgICAgewogICAgICAgIGV2ZW50RGF5PSIwIitldmVudERheTsKICAgICAgfQoKICAgICAgbmV3X3N0YXJ0PW1vbWVudC51dGMoZXZlbnRZZWFyKyItIitldmVudE1vbnRoKyItIitldmVudERheSsiVDAwOjAwOjAwIikuYWRkKCgocGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykqNjApK3BhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcykpLCAnbWludXRlcycpOwogICAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWU9bmV3X3N0YXJ0OwogICAgICBsb2dEZWJ1ZygibmV3X3N0YXJ0PSIrbmV3X3N0YXJ0KTsKICAgIH0KICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZUVuZFRpbWUoKQogICAgewogICAgICBldmVudFllYXI9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyOwogICAgICBldmVudE1vbnRoPSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bW9udGgxMTI7CiAgICAgIGV2ZW50RGF5PSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aDsKICAgICAgaWYgKHBhcnNlSW50KGV2ZW50TW9udGgpPDEwKQogICAgICB7CiAgICAgICAgZXZlbnRNb250aD0iMCIrZXZlbnRNb250aDsKICAgICAgfQogICAgICBpZiAocGFyc2VJbnQoZXZlbnREYXkpPDEwKQogICAgICB7CiAgICAgICAgZXZlbnREYXk9IjAiK2V2ZW50RGF5OwogICAgICB9CgogICAgICBuZXdfZW5kPW1vbWVudC51dGMoZXZlbnRZZWFyKyItIitldmVudE1vbnRoKyItIitldmVudERheSsiVDAwOjAwOjAwIikuYWRkKCgocGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMpKjYwKStwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzKSksICdtaW51dGVzJyk7CiAgICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kX3RpbWU9bmV3X2VuZDsKICAgICAgbG9nRGVidWcoIm5ld19lbmQ9IituZXdfZW5kKTsKICAgIH0KCiAgICBjYWxjdWxhdGVTdGFydFRpbWUoKTsKICAgIGNhbGN1bGF0ZUVuZFRpbWUoKTsKCiAgICBmdW5jdGlvbiBtaW51dGVzQ2hhbmdlZCh0aGVtaW51dGVzKQogICAgewogICAgICBsb2dEZWJ1ZygidGhlbWludXRlcz0iK3RoZW1pbnV0ZXMpOwogICAgICBpZiAodHlwZW9mIHRoZW1pbnV0ZXM9PSJ1bmRlZmluZWQiKQogICAgICB7CiAgICAgICAgcmV0dXJuICIwMCI7CiAgICAgIH0KICAgICAgdGhlbWludXRlcz1wYXJzZUludCh0aGVtaW51dGVzKTsKICAgICAgaWYgKHRoZW1pbnV0ZXM+NjApCiAgICAgIHsKICAgICAgICByZXR1cm4gIjAwIjsKICAgICAgfQogICAgICBlbHNlIGlmICh0aGVtaW51dGVzPDApCiAgICAgIHsKICAgICAgICByZXR1cm4gIjAwIjsKICAgICAgfQogICAgICBlbHNlIGlmICh0aGVtaW51dGVzPT0iIikKICAgICAgewogICAgICAgIHJldHVybiAiMDAiOwogICAgICB9CiAgICAgIGVsc2UgaWYgKHRoZW1pbnV0ZXM8MTApCiAgICAgIHsKICAgICAgICByZXR1cm4gIjAiK3RoZW1pbnV0ZXM7CiAgICAgIH0KICAgICAgZWxzZQogICAgICB7CiAgICAgICAgICByZXR1cm4gdGhlbWludXRlczsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gaG91cnNDaGFuZ2VkKHRoZWhvdXJzKQogICAgewogICAgICBsb2dEZWJ1ZygidGhlaG91cnM9Iit0aGVob3Vycyk7CiAgICAgIGlmICh0eXBlb2YgdGhlaG91cnM9PSJ1bmRlZmluZWQiKQogICAgICB7CiAgICAgICAgcmV0dXJuICIwIjsKICAgICAgfQogICAgICB0aGVob3Vycz1wYXJzZUludCh0aGVob3Vycyk7CiAgICAgIGlmICh0aGVob3Vycz4yNCkKICAgICAgewogICAgICAgIHJldHVybiAwOwogICAgICB9CiAgICAgIGVsc2UgaWYgKHRoZWhvdXJzPDApCiAgICAgIHsKICAgICAgICByZXR1cm4gMDsKICAgICAgfQogICAgICBlbHNlIGlmICh0aGVob3Vycz09IiIpCiAgICAgIHsKICAgICAgICByZXR1cm4gIjAiOwogICAgICB9CiAgICAgIGVsc2UKICAgICAgewogICAgICAgICAgcmV0dXJuIHRoZWhvdXJzOwogICAgICB9CiAgICB9Cgp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ0V2ZW50VHlwZXNDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGNvbXBpbGUsIHVpQ2FsZW5kYXJDb25maWcsICR1aWJNb2RhbCwkbG9jYXRpb24pIHsKICAgIGxvZ0RlYnVnKCdFdmVudFR5cGVzIENvbnRyb2xsZXInKTsKCiAgICBnZXRBbGxCdXNpbmVzc0V2ZW50VHlwZXMoJGh0dHAsJHNjb3BlLCdldmVudF90eXBlcycpOwogICAgJHNjb3BlLnNob3dFdmVudFR5cGUgPSBmdW5jdGlvbiAodGhlRXZlbnQpCiAgICB7CiAgICAgICRsb2NhdGlvbi5wYXRoKCcvZXZlbnRfdHlwZXMvJyt0aGVFdmVudC5ldmVudF90eXBlX2lkKTsKICAgIH0KfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ0V2ZW50VHlwZU5ld0NvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkY29tcGlsZSwgdWlDYWxlbmRhckNvbmZpZywgJHVpYk1vZGFsLCAkbG9jYXRpb24pIHsKICAgIGxvZ0RlYnVnKCdFdmVudFR5cGVzIENvbnRyb2xsZXIgTmV3Jyk7CgogICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMgPSB7fTsgLy8gdGhlc2UgYXJlIHRoZSBjb21wbGV0ZSBkZXRhaWxzIGZvciB0aGUgbmV3IGV2ZW50IC8vCiAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5pc19jbGFzcyA9IDA7CiAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5ibG9ja0V4dHJhVGltZSA9IGZhbHNlOwogICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZHVyYXRpb25fYmVmb3JlX2V2ZW50ID0gMDsKICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmR1cmF0aW9uX2FmdGVyX2V2ZW50ID0gMDsKICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmluaGVyaXRfbWFpbl9ob3VycyA9IDE7CiAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5tYXhfd2FpdGluZ19saXN0ID0gMzsKICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmlzX3VwZGF0ZSA9IGZhbHNlOwogICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMubWF4X3BhcnRpY2lwYW50cyA9IDE7CiAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5tYXhfcmVnaXN0cmF0aW9ucz0xOwogICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuaXNfcHVibGljPTE7CiAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5pbnN0cnVjdG9yX2lkPTA7CgogICAgJHNjb3BlLmV2ZW50Q29sb3JTdHlsZSA9IHt9OwogICAgZGVmYXVsdENvbG9yID0gJzAwYTY1YSc7CiAgICAkc2NvcGUuZXZlbnRDb2xvclN0eWxlW2RlZmF1bHRDb2xvcl0gPSB7CiAgICAgICAgJ3RyYW5zZm9ybSc6ICdyb3RhdGUoMzBkZWcpJwogICAgfTsKICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV2ZW50Q29sb3IgPSAiIyIgKyBkZWZhdWx0Q29sb3I7CiAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyA9IFsKICAgICAgeyJmaWVsZF9uYW1lIjoi16HXmdeb15XXnSDXntek15LXqSIsImZpZWxkX2RhdGF0eXBlIjoiVEVYVF9BUkVBIiwiaXNfbWFuZGF0b3J5IjowLCAiZnJvbWRiIjogZmFsc2UsICJkYl9pZF90b2ZpeCI6IDAsICJpc19hY3RpdmUiOiAxLCAibW9kaWZpZWQiOiBmYWxzZX0sCiAgICAgIHsiZmllbGRfbmFtZSI6Itep15nXoteV16jXmSDXkdeZ16oiLCJmaWVsZF9kYXRhdHlwZSI6IlRFWFRfQVJFQSIsImlzX21hbmRhdG9yeSI6MCwgImZyb21kYiI6IGZhbHNlLCAiZGJfaWRfdG9maXgiOiAwLCAiaXNfYWN0aXZlIjogMSwgIm1vZGlmaWVkIjogZmFsc2V9CiAgICBdOwoKICAgIGdldEFsbEluc3RydWN0b3JzKCRodHRwLCRzY29wZSwnaW5zdHJ1Y3RvcnMnLGdldEFsbEluc3RydWN0b3JzX3N1Y2Nlc3MpOwogICAgZnVuY3Rpb24gZ2V0QWxsSW5zdHJ1Y3RvcnNfc3VjY2VzcygpCiAgICB7CiAgICAgIC8vICRzY29wZS5pbnN0cnVjdG9ycy51bnNoaWZ0KHtidXNpbmVzc191c2VyX2lkOjAsIGJ1c2VyX2ZpcnN0X25hbWU6IiIsIGJ1c2VyX2xhc3RfbmFtZToiIn0pOwogICAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5pbnN0cnVjdG9yX2lkPSRzY29wZS5pbnN0cnVjdG9yc1swXS5idXNpbmVzc191c2VyX2lkOwogICAgfQoKICAgICRzY29wZS5ldmVudFR5cGVFeHRyYUZpZWxkc1BvcCA9IGZ1bmN0aW9uKGV2ZW50VHlwZVByb3BlcnRpZXMpIHsKICAgICAgICBsb2dEZWJ1ZygiZXZlbnQgY3JlYXRlIG1vZGFsIik7CgogICAgICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewogICAgICAgICAgICBhbmltYXRpb246IGZhbHNlLAogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9ldmVudF90eXBlX2V4dHJhX2ZpZWxkcy5waHAnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnZXZlbnRUeXBlRXh0cmFGaWVsZHNNb2RhbENvbnRyb2xsZXInLAogICAgICAgICAgICBzaXplOiAnbCcsCiAgICAgICAgICAgIHJlc29sdmU6IHsKICAgICAgICAgICAgICAgIGV2ZW50VHlwZVByb3BlcnRpZXM6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBldmVudFR5cGVQcm9wZXJ0aWVzOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIG1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24oc2VsZWN0ZWRJdGVtKSB7CiAgICAgICAgICAgIGxvZ0RlYnVnKHNlbGVjdGVkSXRlbSk7CiAgICAgICAgICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMgPSBzZWxlY3RlZEl0ZW07CiAgICAgICAgfSwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGxvZ0RlYnVnKCdNb2RhbCBkaXNtaXNzZWQgYXQ6ICcgKyBuZXcgRGF0ZSgpKTsKICAgICAgICB9KTsKICAgIH07CgogICAgJHNjb3BlLmNoYW5nZUV2ZW50Q29sb3IgPSBmdW5jdGlvbihuZXdDb2xvcikgewogICAgICAgIGxvZ0RlYnVnKCJjaG9vc2luZyBjb2xvciAiICsgbmV3Q29sb3IpOwogICAgICAgICRzY29wZS5ldmVudENvbG9yID0gbmV3Q29sb3I7CiAgICAgICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXZlbnRDb2xvciA9ICIjIiArIG5ld0NvbG9yOwogICAgICAgICRzY29wZS5ldmVudENvbG9yU3R5bGUgPSB7CiAgICAgICAgICAgICdiYWNrZ3JvdW5kLWNvbG9yJzogIiMiICsgbmV3Q29sb3IKICAgICAgICB9OwogICAgICAgICRzY29wZS5ldmVudENvbG9yU3R5bGVbbmV3Q29sb3JdID0gewogICAgICAgICAgICAndHJhbnNmb3JtJzogJ3JvdGF0ZSgzMGRlZyknCiAgICAgICAgfTsKCiAgICB9CgogICAgJHNjb3BlLmFkZEV2ZW50VHlwZUNhbmNlbCA9IGZ1bmN0aW9uKCkgewogICAgICAgICRsb2NhdGlvbi5wYXRoKCcvZXZlbnRfdHlwZXMnKTsKICAgIH07CgogICAgJHNjb3BlLmFkZEV2ZW50VHlwZSA9IGZ1bmN0aW9uKCkgewogICAgICAgIGxvZ0RlYnVnKCJhZGQgRXZlbnQgVHlwZSIgKyAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcyArICJleHRyYSBmaWVsZHM9IiArJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMpOwogICAgICAgIGlmICgoJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMubWF4X3JlZ2lzdHJhdGlvbnM9PScnKSB8fCAoISRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF9yZWdpc3RyYXRpb25zKSkKICAgICAgICB7CiAgICAgICAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5tYXhfcmVnaXN0cmF0aW9ucz0wOwogICAgICAgIH0KICAgICAgICBhZGRFdmVudFR5cGUoJGh0dHAsJHNjb3BlLCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLGFkZEV2ZW50VHlwZV9zdWNjZXNzKTsKICAgICAgICBmdW5jdGlvbiBhZGRFdmVudFR5cGVfc3VjY2VzcygpCiAgICAgICAgewogICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9ldmVudF90eXBlcycpOwogICAgICAgIH0KICAgIH07Cn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdFdmVudFR5cGVVcGRhdGVDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGNvbXBpbGUsICRyb3V0ZVBhcmFtcywgdWlDYWxlbmRhckNvbmZpZywgJHVpYk1vZGFsLCAkbG9jYXRpb24pIHsKICAgIGV2ZW50X3R5cGVfaWQ9JHJvdXRlUGFyYW1zLmV2ZW50X3R5cGVfaWQ7CiAgICBsb2dEZWJ1ZygnRXZlbnRUeXBlcyBDb250cm9sbGVyIFVwZGF0ZSAnK2V2ZW50X3R5cGVfaWQpOwoKICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzID0ge307IC8vIHRoZXNlIGFyZSB0aGUgY29tcGxldGUgZGV0YWlscyBmb3IgdGhlIG5ldyBldmVudCAvLwogICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuaXNfdXBkYXRlID0gdHJ1ZTsKCiAgICAkc2NvcGUuZXZlbnRDb2xvclN0eWxlID0ge307CiAgICBnZXRBbGxJbnN0cnVjdG9ycygkaHR0cCwkc2NvcGUsJ2luc3RydWN0b3JzJyxnZXRBbGxJbnN0cnVjdG9yc19zdWNjZXNzKTsKICAgIGZ1bmN0aW9uIGdldEFsbEluc3RydWN0b3JzX3N1Y2Nlc3MoKQogICAgewogICAgICAkc2NvcGUuaW5zdHJ1Y3RvcnMudW5zaGlmdCh7YnVzaW5lc3NfdXNlcl9pZDpudWxsLCBidXNlcl9maXJzdF9uYW1lOiIiLCBidXNlcl9sYXN0X25hbWU6IiJ9KTsKICAgIH0KCiAgICBnZXRCdXNpbmVzc0V2ZW50VHlwZSgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmV2ZW50X3R5cGVfaWQsJ2V2ZW50VHlwZVByb3BlcnRpZXMnLGdldEJ1c2luZXNzRXZlbnRUeXBlX3N1Y2Nlc3MpOwoKICAgIGZ1bmN0aW9uIGdldEJ1c2luZXNzRXZlbnRUeXBlX3N1Y2Nlc3MoKQogICAgewogICAgICAgIGlmICgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5tYXhfcmVnaXN0cmF0aW9ucz09bnVsbCkKICAgICAgICB7CiAgICAgICAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5tYXhfcmVnaXN0cmF0aW9ucz0xOwogICAgICAgIH0KICAgICAgICBpZiAoKCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmR1cmF0aW9uX2JlZm9yZV9ldmVudD4wKSB8ICgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5kdXJhdGlvbl9hZnRlcl9ldmVudD4wKSkKICAgICAgICB7CiAgICAgICAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5ibG9ja0V4dHJhVGltZSA9IDE7CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5ibG9ja0V4dHJhVGltZSA9IDA7CiAgICAgICAgfQogICAgICAgIC8vICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmluaGVyaXRfbWFpbl9ob3VycyA9IHJlc3BvbnNlLmRhdGFbMF0uaW5oZXJpdF9tYWluX2hvdXJzOwogICAgICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmlzX3VwZGF0ZSA9IHRydWU7CiAgICAgICAgbG9nRGVidWcoIiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmNvbG9yPSIrJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuY29sb3IpOwogICAgICAgICRzY29wZS5ldmVudENvbG9yU3R5bGVbJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuY29sb3JdID0gewogICAgICAgICAgICAndHJhbnNmb3JtJzogJ3JvdGF0ZSgzMGRlZyknCiAgICAgICAgfTsKICAgICAgICAkc2NvcGUuY2hhbmdlRXZlbnRDb2xvcigoJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuY29sb3IpLnN1YnN0cigxKSk7CiAgICAgICAgbG9nRGVidWcoIiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmluc3RydWN0b3JfaWQ9Iiskc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5pbnN0cnVjdG9yX2lkKTsKICAgICAgICAvLyBzYXZpbmcgZXZlbnQgdHlwZSBkZXRhaWxzIGFzaWRlIHRvIGxhdGVyIGNoZWNrIGlmIGFueXRoaW5nIGNoYW5nZWQKICAgICAgICBsb2dEZWJ1ZygiZHVwbGljYXRpbmcgb2JqZWN0IG9mIGV2ZW50IHR5cGUgdG8gbGF0ZXIgY29tcGFyZSAiK3R5cGVvZiAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcyk7CiAgICAgICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXNEdXBsaWNhdGUgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzKSk7CiAgICAgICAgbG9nRGVidWcoIiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzRHVwbGljYXRlID0iKyRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzRHVwbGljYXRlLmV2ZW50X3R5cGVfbmFtZSk7CiAgICB9OwoKICAgIC8vIGV2ZW50IHR5cGUgY2hhbmdlZCBwb3B1cAogICAgJHNjb3BlLmV2ZW50VHlwZUNoYW5nZWRQb3B1cCA9IGZ1bmN0aW9uKGV2ZW50VHlwZVByb3BlcnRpZXMpIHsKICAgICAgICBsb2dEZWJ1ZygiZXZlbnQgY3JlYXRlIG1vZGFsIik7CgogICAgICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewogICAgICAgICAgICBhbmltYXRpb246IGZhbHNlLAogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9ldmVudF90eXBlX2NoYW5nZWQucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ2V2ZW50VHlwZUNoYW5nZWRQb3B1cENvbnRyb2xsZXInLAogICAgICAgICAgICBzaXplOiAnbCcsCiAgICAgICAgICAgIHJlc29sdmU6IHsKICAgICAgICAgICAgICAgIGV2ZW50VHlwZVByb3BlcnRpZXM6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllczsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBtb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHNlbGVjdGVkSXRlbSkKICAgICAgICB7CiAgICAgICAgICAgIGxvZ0RlYnVnKHNlbGVjdGVkSXRlbSk7CiAgICAgICAgICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMgPSBzZWxlY3RlZEl0ZW07CiAgICAgICAgfSwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGxvZ0RlYnVnKCdNb2RhbCBkaXNtaXNzZWQgYXQ6ICcgKyBuZXcgRGF0ZSgpKTsKICAgICAgICB9KTsKICAgIH07CgogICAgLy8gZXZlbnQgdHlwZSBleHRyYSBmaWVsZCBwb3B1cAogICAgJHNjb3BlLmV2ZW50VHlwZUV4dHJhRmllbGRzUG9wID0gZnVuY3Rpb24oZXZlbnRUeXBlUHJvcGVydGllcykgewogICAgICAgIGxvZ0RlYnVnKCJldmVudCBjcmVhdGUgbW9kYWwiKTsKCiAgICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgICAgICAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2V2ZW50X3R5cGVfZXh0cmFfZmllbGRzLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdldmVudFR5cGVFeHRyYUZpZWxkc01vZGFsQ29udHJvbGxlcicsCiAgICAgICAgICAgIHNpemU6ICdsJywKICAgICAgICAgICAgcmVzb2x2ZTogewogICAgICAgICAgICAgICAgZXZlbnRUeXBlUHJvcGVydGllczogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGV2ZW50VHlwZVByb3BlcnRpZXM7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgbW9kYWxJbnN0YW5jZS5yZXN1bHQudGhlbihmdW5jdGlvbihzZWxlY3RlZEl0ZW0pIHsKICAgICAgICAgICAgbG9nRGVidWcoc2VsZWN0ZWRJdGVtKTsKICAgICAgICAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyA9IHNlbGVjdGVkSXRlbTsKICAgICAgICB9LCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgbG9nRGVidWcoJ01vZGFsIGRpc21pc3NlZCBhdDogJyArIG5ldyBEYXRlKCkpOwogICAgICAgIH0pOwogICAgfTsKCgogICAgJHNjb3BlLmNoYW5nZUV2ZW50Q29sb3IgPSBmdW5jdGlvbihuZXdDb2xvcikgewogICAgICAgIGxvZ0RlYnVnKCJjaG9vc2luZyBjb2xvciAiICsgbmV3Q29sb3IpOwogICAgICAgICRzY29wZS5ldmVudENvbG9yID0gbmV3Q29sb3I7CiAgICAgICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXZlbnRDb2xvciA9ICIjIiArIG5ld0NvbG9yOwogICAgICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmNvbG9yID0gIiMiICsgbmV3Q29sb3I7CiAgICAgICAgJHNjb3BlLmV2ZW50Q29sb3JTdHlsZSA9IHsKICAgICAgICAgICAgJ2JhY2tncm91bmQtY29sb3InOiAiIyIgKyBuZXdDb2xvcgogICAgICAgIH07CiAgICAgICAgJHNjb3BlLmV2ZW50Q29sb3JTdHlsZVtuZXdDb2xvcl0gPSB7CiAgICAgICAgICAgICd0cmFuc2Zvcm0nOiAncm90YXRlKDMwZGVnKScKICAgICAgICB9OwoKICAgIH0KCiAgICAkc2NvcGUuYWRkRXZlbnRUeXBlQ2FuY2VsID0gZnVuY3Rpb24oKSB7CiAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9ldmVudF90eXBlcycpOwogICAgfTsKCiAgICAkc2NvcGUuYWRkRXZlbnRUeXBlID0gZnVuY3Rpb24oKSB7IC8vIHRoaXMgZnVuY3Rpb24gVVBEQVRFUyBldmVudCB0eXBlIChub3QgYWRkcykKICAgICAgLy8gY2hlY2tpbmcgaWYgYW55dGhpbmcgY2hhbmdlZCByZWFsbHkKICAgICAgLy8gYW5kIGFza2luZyBpZiB3ZSBzaG91bGQgdXBkYXRlIGFsbCBldmVudHMgZnJvbSBub3cgKG9yIG9ubHkgbmV3bHkgY3JlYXRlZCBldmVudHMpCiAgICAgIC8vIGNoZWNraW5nCiAgICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzRHVwbGljYXRlLmV4dHJhRmllbGRzPSRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzOwogICAgICBpZiAoYW5ndWxhci5lcXVhbHMoJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXNEdXBsaWNhdGUsJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMpKQogICAgICB7CiAgICAgICAgLy8gJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXNEdXBsaWNhdGUuZXh0cmFGaWVsZHMgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzKSk7CgogICAgICAgIGxvZ0RlYnVnKCJub3RoaW5nIGNoYW5nZWQgaW4gZXZlbnQgdHlwZSwgb3Igb25seSBleHRyYSBmaWVsZHMiKTsKICAgICAgICAkc2NvcGUudXBkYXRlRXZlbnRUeXBlKCk7CiAgICAgIH0KICAgICAgZWxzZQogICAgICB7CiAgICAgICAgbG9nRGVidWcoImV2ZW50IHR5cGUgY2hhbmdlZCIpOwogICAgICAgICRzY29wZS5ldmVudFR5cGVDaGFuZ2VkUG9wdXAoKTsKICAgICAgfQogICAgICAvLyAkc2NvcGUudXBkYXRlRXZlbnRUeXBlKCk7CiAgICB9CiAgICAkc2NvcGUudXBkYXRlRXZlbnRUeXBlID0gZnVuY3Rpb24oKQogICAgewogICAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy51cGRhdGVfZXhpc3RpbmdfZXZlbnRzPWZhbHNlOwoKICAgICAgbG9nRGVidWcoInVwZGF0ZSBFdmVudCBUeXBlICIgKyAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5ldmVudF90eXBlX2lkKTsKICAgICAgaWYgKCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF9yZWdpc3RyYXRpb25zPT0nJykKICAgICAgewogICAgICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF9yZWdpc3RyYXRpb25zPTA7CiAgICAgIH0KICAgICAgdXBkYXRlRXZlbnRUeXBlKCRodHRwLCRzY29wZSwkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5ldmVudF90eXBlX2lkLCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLHVwZGF0ZUV2ZW50VHlwZV9zdWNjZXNzKTsKICAgICAgZnVuY3Rpb24gdXBkYXRlRXZlbnRUeXBlX3N1Y2Nlc3MoKQogICAgICB7CiAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9ldmVudF90eXBlcycpOwogICAgICB9CiAgICB9Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignZXZlbnRDcmVhdGVNb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkcm9vdFNjb3BlLCBzaGFyZWRQcm9wZXJ0aWVzLCBldmVudF90eXBlX2lkLCBsb2NhdGlvbl9pZCwgZW1wX2lkLCAkaHR0cCwgc3RhcnREYXRlLCByZXNjaGVkdWxlX2V2ZW50LCB1aUNhbGVuZGFyQ29uZmlnKSB7CiAgICBzdGFydERhdGU9bmV3IG1vbWVudChzdGFydERhdGUpOwogICAgbG9nRGVidWcoImV2ZW50Q3JlYXRlTW9kYWxDb250cm9sbGVyLCBzdGFydERhdGU9IitzdGFydERhdGUrIiB0eXBlICIrdHlwZW9mIHN0YXJ0RGF0ZSk7CiAgICBsb2dEZWJ1ZygiZXZlbnRDcmVhdGVNb2RhbENvbnRyb2xsZXIsIHJlc2NoZWR1bGVfZXZlbnQ9IityZXNjaGVkdWxlX2V2ZW50KTsKCiAgICAkc2NvcGUuZXZlbnRUeXBlVGl0bGUgPSAi15HXl9eoINeh15XXkiDXntek15LXqSI7CiAgICAkc2NvcGUuc2hvd0V2ZW50VHlwZVNlbGVjdGVkID0gZmFsc2U7CiAgICAkc2NvcGUuc2hvd0V2ZW50Q2xpZW50U2VsZWN0ZWQgPSBmYWxzZTsKICAgICRzY29wZS5uZXdFdmVudERldGFpbHMgPSB7fTsgLy8gdGhlc2UgYXJlIHRoZSBjb21wbGV0ZSBkZXRhaWxzIGZvciB0aGUgbmV3IGV2ZW50IC8vCiAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnJlcGVhdFR5cGUgPSAiZm9yZXZlciI7CiAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnJlcGVhdEZpeGVkVGltZXMgPSAiNCI7CiAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLm1heF9wYXJ0aWNpcGFudHMgPSAxOwoKICAgIGxvZ0RlYnVnKCJYWFggPSAiK0pTT04uc3RyaW5naWZ5KHJlc2NoZWR1bGVfZXZlbnQpKTsKCiAgICAkc2NvcGUucmVzY2hlZHVsZV9ldmVudD1mYWxzZTsKICAgICRzY29wZS5yZXNjaGVkdWxlX2V2ZW50X2RldGFpbHM9cmVzY2hlZHVsZV9ldmVudDsKICAgIGlmICgkc2NvcGUucmVzY2hlZHVsZV9ldmVudF9kZXRhaWxzIT1udWxsKQogICAgewogICAgICBsb2dEZWJ1ZygicmVzY2hlZHVsZV9ldmVudF9kZXRhaWxzPSIrJHNjb3BlLnJlc2NoZWR1bGVfZXZlbnRfZGV0YWlscy5ldmVudF9pZCk7CiAgICAgIGxvZ0RlYnVnKEpTT04uc3RyaW5naWZ5KCRzY29wZS5yZXNjaGVkdWxlX2V2ZW50X2RldGFpbHMpKTsKICAgICAgJHNjb3BlLnJlc2NoZWR1bGVfZXZlbnQ9dHJ1ZTsKICAgICAgJHNjb3BlLmdpdmVuX2V2ZW50X3R5cGVfaWQgPSAkc2NvcGUucmVzY2hlZHVsZV9ldmVudF9kZXRhaWxzLmV2ZW50X3R5cGVfaWQ7CiAgICAgIC8vIHN0aWxsIHByZWZlcmluZyBlbXBfaWQgZnJvbSBzY2hlZHVsZXIgc3VnZ2VzdGlvbiBpcyBpdCB3YXMgc2VsZWN0ZWQKICAgICAgaWYgKGVtcF9pZCE9MCkKICAgICAgewogICAgICAgICRzY29wZS5naXZlbl9lbXBfaWQgPSBlbXBfaWQ7CiAgICAgIH0KICAgICAgZWxzZQogICAgICB7CiAgICAgICAgJHNjb3BlLmdpdmVuX2VtcF9pZCA9ICRzY29wZS5yZXNjaGVkdWxlX2V2ZW50X2RldGFpbHMuaW5zdHJ1Y3Rvcl9pZDsKICAgICAgfQogICAgICAvLyBzdGlsbCBwcmVmZXJpbmcgbG9jYXRpb25faWQgZnJvbSBzY2hlZHVsZXIgc3VnZ2VzdGlvbiBvdmVyIHRoZSBvcmlnaW5hbCBsb2NhdGlvbiBmcm9tIGV2ZW50CiAgICAgIGlmIChsb2NhdGlvbl9pZCE9MCkKICAgICAgewogICAgICAgICRzY29wZS5naXZlbl9sb2NhdGlvbl9pZCA9IGxvY2F0aW9uX2lkOwogICAgICB9CiAgICAgIGVsc2UKICAgICAgewogICAgICAgICRzY29wZS5naXZlbl9sb2NhdGlvbl9pZCA9ICRzY29wZS5yZXNjaGVkdWxlX2V2ZW50X2RldGFpbHMubG9jYXRpb25faWQ7CiAgICAgIH0KICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgJHNjb3BlLmdpdmVuX2V2ZW50X3R5cGVfaWQgPSBldmVudF90eXBlX2lkOwogICAgICAkc2NvcGUuZ2l2ZW5fbG9jYXRpb25faWQgPSBsb2NhdGlvbl9pZDsKICAgICAgJHNjb3BlLmdpdmVuX2VtcF9pZCA9IGVtcF9pZDsKICAgIH0KICAgIGlmICgkc2NvcGUuZ2l2ZW5fZXZlbnRfdHlwZV9pZD4wKQogICAgewogICAgICAkc2NvcGUucHJldmlvdXNseV9zZWxlY3RlZF9ldmVudF90eXBlPXRydWU7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICRzY29wZS5wcmV2aW91c2x5X3NlbGVjdGVkX2V2ZW50X3R5cGU9ZmFsc2U7CiAgICB9CiAgICBsb2dEZWJ1ZygiJHNjb3BlLmdpdmVuX2V2ZW50X3R5cGVfaWQ9Iiskc2NvcGUuZ2l2ZW5fZXZlbnRfdHlwZV9pZCk7CgogICAgc2VsZWN0ZWREYXRlU3RhcnQgPSBuZXcgRGF0ZShzdGFydERhdGUpOwogICAgbG9nRGVidWcoInNlbGVjdGVkRGF0ZVN0YXJ0ID0gIitzZWxlY3RlZERhdGVTdGFydCk7CiAgICB2YXIgc2VsZWN0ZWREYXRlU3RhcnQgPSBuZXcgRGF0ZShzZWxlY3RlZERhdGVTdGFydC5nZXRUaW1lKCkgKyBzZWxlY3RlZERhdGVTdGFydC5nZXRUaW1lem9uZU9mZnNldCgpICogNjAwMDApOwoKICAgIC8vIGxvZ0RlYnVnKCJkYXRlPSIgKyBzZWxlY3RlZERhdGVTdGFydCk7CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudCA9IFtdOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycyA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldEhvdXJzKCk7CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBzZWxlY3RlZERhdGVTdGFydC5nZXRNaW51dGVzKCk7CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRvdyA9IGRheU5hbWVzW3NlbGVjdGVkRGF0ZVN0YXJ0LmdldERheSgpXTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF0ZSA9IHNlbGVjdGVkRGF0ZVN0YXJ0OwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aCA9IG1vbnRoTmFtZXNbc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TW9udGgoKV07CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoMTEyID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TW9udGgoKSsxOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXlvZm1vbnRoID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RGF0ZSgpOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RnVsbFllYXIoKTsKICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZV9pbnB1dF9mb3JtYXQ9IG5ldyBEYXRlKDE5NzAsIDAsIDEsICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMsICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcywgMCk7CgogICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pbnN0cnVjdG9yX2lkID0gJHNjb3BlLmdpdmVuX2VtcF9pZDsKICAgICRzY29wZS5uZXdFdmVudERldGFpbHMubG9jYXRpb25faWQgPSAkc2NvcGUuZ2l2ZW5fbG9jYXRpb25faWQ7CgogICAgZ2V0QnVzaW5lc3NMb2NhdGlvbnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19sb2NhdGlvbnMnLGdldEJ1c2luZXNzTG9jYXRpb25zX2ZpbmlzaCk7CiAgICBmdW5jdGlvbiBnZXRCdXNpbmVzc0xvY2F0aW9uc19maW5pc2goKQogICAgewogICAgICBpZiAoJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5sb2NhdGlvbl9pZD09MCkKICAgICAgewogICAgICAgICRzY29wZS5uZXdFdmVudERldGFpbHMubG9jYXRpb25faWQ9JHNjb3BlLmJ1c2luZXNzX2xvY2F0aW9uc1swXS5sb2NhdGlvbl9pZDsKICAgICAgfQogICAgfQoKICAgIGNvbnNvbGUubG9nKCIkc2NvcGUubmV3RXZlbnREZXRhaWxzLmluc3RydWN0b3JfaWQ9Iiskc2NvcGUubmV3RXZlbnREZXRhaWxzLmluc3RydWN0b3JfaWQpOwogICAgLy8gaWYgY2xpZW50IHdhcyBwcmV2aW91c2x5IHNlbGVjdGVkCiAgICAkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcj1mYWxzZTsKICAgIGxvZ0RlYnVnKCJzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyPSIrc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcik7CiAgICBpZiAoc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpIT1udWxsKQogICAgewogICAgICAvLyBjb25zb2xlLmxvZygiZ290IHByZXZpb3VzIHNlbGVjdGVkIHVzZXIgIitzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfZmlyc3RfbmFtZSk7CiAgICAgICRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VybmFtZT1zaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfZmlyc3RfbmFtZSsiICIrc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2VyX2xhc3RfbmFtZTsKICAgICAgJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXI9dHJ1ZTsKCiAgICAgICRzY29wZS5zaG93RXZlbnRDbGllbnRTZWxlY3RlZCA9IHRydWU7CiAgICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kdXNlcl9pZCA9IHNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKS5idXNpbmVzc191c2VyX2lkOwogICAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZHVzZXJfZmlyc3RfbmFtZSA9IHNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKS5idXNlcl9maXJzdF9uYW1lOwogICAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZHVzZXJfbGFzdF9uYW1lID0gc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2VyX2xhc3RfbmFtZTsKICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5idXNpbmVzc191c2VyX2lkID0gc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2luZXNzX3VzZXJfaWQ7CgogICAgfQogICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5zdGFydF90aW1lID0gc3RhcnREYXRlOwogICAgbG9nRGVidWcoIiRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZTE9Iiskc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWUpOwogICAgJHNjb3BlLnN0YXJ0TWludXRlcyA9IGZ1bmN0aW9uKCkKICAgIHsKICAgICAgbG9nRGVidWcoInN0YXJ0TWludXRlcyAiKygkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpKTsKICAgICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzPW1pbnV0ZXNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcyk7CiAgICAgIGNhbGN1bGF0ZVN0YXJ0VGltZSgpOwogICAgICBjYWxjdWxhdGVFbmRUaW1lRHluYW1pYygpOwogICAgfQogICAgJHNjb3BlLnN0YXJ0SG91cnMgPSBmdW5jdGlvbigpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJzdGFydEhvdXJzICIraG91cnNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMpKTsKICAgICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3Vycz1ob3Vyc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3Vycyk7CiAgICAgIGNhbGN1bGF0ZVN0YXJ0VGltZSgpOwogICAgICBjYWxjdWxhdGVFbmRUaW1lRHluYW1pYygpOwogICAgfQoKICAgICRzY29wZS5lbmRNaW51dGVzID0gZnVuY3Rpb24oKQogICAgewogICAgICBsb2dEZWJ1ZygiZW5kTWludXRlcyAiKygkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzKSk7CiAgICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXM9bWludXRlc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcyk7CiAgICAgIGNhbGN1bGF0ZVN0YXJ0VGltZSgpOwogICAgICBjYWxjdWxhdGVFbmRUaW1lRHluYW1pYygpOwogICAgfQogICAgJHNjb3BlLmVuZEhvdXJzID0gZnVuY3Rpb24oKQogICAgewogICAgICBsb2dEZWJ1ZygiZW5kSG91cnMgIitob3Vyc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMpKTsKICAgICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnM9aG91cnNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzKTsKICAgICAgY2FsY3VsYXRlU3RhcnRUaW1lKCk7CiAgICAgIGNhbGN1bGF0ZUVuZFRpbWVEeW5hbWljKCk7CiAgICB9CgogICAgZnVuY3Rpb24gY2FsY3VsYXRlU3RhcnRUaW1lKCkKICAgIHsKICAgICAgZXZlbnRZZWFyPSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0eWVhcjsKICAgICAgZXZlbnRNb250aD0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoMTEyOwogICAgICBldmVudERheT0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRheW9mbW9udGg7CiAgICAgIGlmIChwYXJzZUludChldmVudE1vbnRoKTwxMCkKICAgICAgewogICAgICAgIGV2ZW50TW9udGg9IjAiK2V2ZW50TW9udGg7CiAgICAgIH0KICAgICAgaWYgKHBhcnNlSW50KGV2ZW50RGF5KTwxMCkKICAgICAgewogICAgICAgIGV2ZW50RGF5PSIwIitldmVudERheTsKICAgICAgfQogICAgICBsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyPSIrZXZlbnRZZWFyKTsKICAgICAgbG9nRGVidWcoIiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aD0iK2V2ZW50TW9udGgpOwogICAgICBsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aD0iK2V2ZW50RGF5KTsKICAgICAgbmV3X3N0YXJ0PW1vbWVudC51dGMoZXZlbnRZZWFyKyItIitldmVudE1vbnRoKyItIitldmVudERheSsiVDAwOjAwOjAwIikuYWRkKCgocGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykqNjApK3BhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcykpLCAnbWludXRlcycpOwogICAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWU9bmV3X3N0YXJ0OwogICAgICBsb2dEZWJ1ZygibmV3X3N0YXJ0PSIrbmV3X3N0YXJ0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG1pbnV0ZXNDaGFuZ2VkKHRoZW1pbnV0ZXMpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJ0aGVtaW51dGVzPSIrdGhlbWludXRlcyk7CiAgICAgIGlmICh0eXBlb2YgdGhlbWludXRlcz09InVuZGVmaW5lZCIpCiAgICAgIHsKICAgICAgICByZXR1cm4gIjAwIjsKICAgICAgfQogICAgICBpZiAoaXNOYU4odGhlbWludXRlcykpCiAgICAgIHsKICAgICAgICByZXR1cm4gIjAwIjsKICAgICAgfQogICAgICBpZiAodGhlbWludXRlcz09JycpCiAgICAgIHsKICAgICAgICByZXR1cm4gIjAwIjsKICAgICAgfQogICAgICB0aGVtaW51dGVzPXBhcnNlSW50KHRoZW1pbnV0ZXMpOwogICAgICBpZiAodGhlbWludXRlcz42MCkKICAgICAgewogICAgICAgIHJldHVybiAiMDAiOwogICAgICB9CiAgICAgIGVsc2UgaWYgKHRoZW1pbnV0ZXM8MCkKICAgICAgewogICAgICAgIHJldHVybiAiMDAiOwogICAgICB9CiAgICAgIGVsc2UgaWYgKHRoZW1pbnV0ZXM9PSIiKQogICAgICB7CiAgICAgICAgcmV0dXJuICIwMCI7CiAgICAgIH0KICAgICAgZWxzZSBpZiAodGhlbWludXRlczwxMCkKICAgICAgewogICAgICAgIHJldHVybiAiMCIrdGhlbWludXRlczsKICAgICAgfQogICAgICBlbHNlCiAgICAgIHsKICAgICAgICAgIHJldHVybiB0aGVtaW51dGVzOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBob3Vyc0NoYW5nZWQodGhlaG91cnMpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJ0aGVob3Vycz0iK3RoZWhvdXJzKTsKICAgICAgaWYgKHR5cGVvZiB0aGVob3Vycz09InVuZGVmaW5lZCIpCiAgICAgIHsKICAgICAgICByZXR1cm4gIjAiOwogICAgICB9CiAgICAgIGlmIChpc05hTih0aGVob3VycykpCiAgICAgIHsKICAgICAgICByZXR1cm4gIjAiOwogICAgICB9CiAgICAgIGlmICh0aGVob3Vycz09JycpCiAgICAgIHsKICAgICAgICByZXR1cm4gIjAiOwogICAgICB9CiAgICAgIHRoZWhvdXJzPXBhcnNlSW50KHRoZWhvdXJzKTsKICAgICAgaWYgKHRoZWhvdXJzPjI0KQogICAgICB7CiAgICAgICAgcmV0dXJuIDA7CiAgICAgIH0KICAgICAgZWxzZSBpZiAodGhlaG91cnM8MCkKICAgICAgewogICAgICAgIHJldHVybiAwOwogICAgICB9CiAgICAgIGVsc2UgaWYgKHRoZWhvdXJzPT0iIikKICAgICAgewogICAgICAgIHJldHVybiAiMCI7CiAgICAgIH0KICAgICAgZWxzZQogICAgICB7CiAgICAgICAgICByZXR1cm4gdGhlaG91cnM7CiAgICAgIH0KICAgIH0KICAgIGdldEFsbEluc3RydWN0b3JzKCRodHRwLCRzY29wZSwnaW5zdHJ1Y3RvcnMnLGdldEFsbEluc3RydWN0b3JzX3N1Y2Nlc3MpOwogICAgZnVuY3Rpb24gZ2V0QWxsSW5zdHJ1Y3RvcnNfc3VjY2VzcygpCiAgICB7CiAgICAgIC8vICRzY29wZS5pbnN0cnVjdG9ycy51bnNoaWZ0KHtidXNpbmVzc191c2VyX2lkOm51bGwsIGJ1c2VyX2ZpcnN0X25hbWU6IiIsIGJ1c2VyX2xhc3RfbmFtZToiIn0pOwogICAgICBpZiAoISRzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZD4wKQogICAgICB7CiAgICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pbnN0cnVjdG9yX2lkPSRzY29wZS5pbnN0cnVjdG9yc1swXS5idXNpbmVzc191c2VyX2lkOwogICAgICB9CiAgICB9CgogICAgJHNjb3BlLnNlbGVjdEV2ZW50VHlwZSA9IGZ1bmN0aW9uKCkgewogICAgICAgIC8vIHJlbW92aW5nIGV2ZW50IHR5cGUg15HXl9eoINeh15XXkiDXntek15LXqQogICAgICAgIGlmICgkc2NvcGUuZXZlbnRUeXBlT3B0aW9uc1swXS5ldmVudF90eXBlX2lkPT0wKQogICAgICAgIHsKICAgICAgICAgICRzY29wZS5ldmVudFR5cGVPcHRpb25zLnNwbGljZSgwLCAxKTsKICAgICAgICB9CiAgICAgICAgJHNjb3BlLmFqYXhfZXJyb3I9Jyc7CiAgICAgICAgY2hvaWNlPSRzY29wZS5zZWxlY3RFdmVudFR5cGVTZWxlY3RlZDsKICAgICAgICBsb2dEZWJ1Zygic2VsZWN0RXZlbnRUeXBlIik7CiAgICAgICAgbG9nRGVidWcoSlNPTi5zdHJpbmdpZnkoJHNjb3BlLnNlbGVjdEV2ZW50VHlwZVNlbGVjdGVkKSk7CiAgICAgICAgJHNjb3BlLmV2ZW50VHlwZVRpdGxlID0gY2hvaWNlLmV2ZW50X3R5cGVfbmFtZTsKICAgICAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmV2ZW50X3R5cGVfaWQgPSBjaG9pY2UuZXZlbnRfdHlwZV9pZDsKCiAgICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5ldmVudF9uYW1lID0gY2hvaWNlLmV2ZW50X3R5cGVfbmFtZTsKICAgICAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLm9yaWdpbmFsX2V2ZW50X25hbWUgPSBjaG9pY2UuZXZlbnRfdHlwZV9uYW1lOwogICAgICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuZXZlbnRfZGVzY3JpcHRpb24gPSBjaG9pY2UuZXZlbnRfdHlwZV9kZXNjcmlwdGlvbjsKICAgICAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmlzX2NsYXNzID0gY2hvaWNlLmlzX2NsYXNzOwogICAgICAgICRzY29wZS5uZXdFdmVudERldGFpbHMub3JpZ2luYWxfcHJpY2UgPSBjaG9pY2Uub3JpZ2luYWxfcHJpY2U7CiAgICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pc19nZW5lcmljX2V0eXBlID0gY2hvaWNlLmlzX2dlbmVyaWNfZXR5cGU7CiAgICAgICAgLy8gJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pbnN0cnVjdG9yX2lkID0gY2hvaWNlLmluc3RydWN0b3JfaWQ7CiAgICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5kdXJhdGlvbl9ldmVudCA9IGNob2ljZS5kdXJhdGlvbl9ldmVudDsKICAgICAgICAvLyBsb2dEZWJ1Zygic2NvcGUubmV3RXZlbnREZXRhaWxzLmlzX2NsYXNzPSIrJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pc19jbGFzcyk7CiAgICAgICAgLy8gbG9nRGVidWcoInNjb3BlLm5ld0V2ZW50RGV0YWlscy5pbnN0cnVjdG9yX2lkPSIrJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pbnN0cnVjdG9yX2lkKTsKICAgICAgICAvLyBsb2dEZWJ1Zygic3RhcnREYXRlPSIrc3RhcnREYXRlKTsKICAgICAgICAvLyAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWUgPSBzdGFydERhdGU7CiAgICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5ldmVudHR5cGUgPSBjaG9pY2U7CiAgICAgICAgY2FsY3VsYXRlRW5kVGltZSgpOwoKICAgICAgICAvLyAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWVfaW5wdXRfZm9ybWF0PSBuZXcgRGF0ZSgxOTcwLCAwLCAxLCAxNCwgNTcsIDApOwoKICAgICAgICBsb2dEZWJ1ZygibmV3RXZlbnQgc3RhcnQ9IiArICRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZSk7CiAgICAgICAgbG9nRGVidWcoIm5ld0V2ZW50IGVuZD0iICsgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmRfdGltZSk7CgogICAgICAgICRzY29wZS5zaG93RXZlbnRUeXBlU2VsZWN0ZWQgPSB0cnVlOwogICAgfQoKICAgIC8vIHRoaXMgZnVuY3Rpb24gY2FsY3VsYXRlcyBlbmQgdGltZSBhY2NvcmRpbmcgdG8gdGhlIGxlbmd0aCBvZiB0aGUgZXZlbnR0eXBlCiAgICBmdW5jdGlvbiBjYWxjdWxhdGVFbmRUaW1lKCkKICAgIHsKICAgICAgY29uc29sZS5sb2coIiRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZT0iKyRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZSk7CiAgICAgIGVuZCA9IG1vbWVudCgkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWUpLmFkZCgkc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50LCAnbWludXRlcycpOwogICAgICBzZWxlY3RlZERhdGVFbmQgPSBuZXcgRGF0ZShlbmQpOwogICAgICBzZWxlY3RlZERhdGVFbmQgPSBuZXcgRGF0ZShzZWxlY3RlZERhdGVFbmQuZ2V0VGltZSgpICsgc2VsZWN0ZWREYXRlRW5kLmdldFRpbWV6b25lT2Zmc2V0KCkgKiA2MDAwMCk7CiAgICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzID0gc2VsZWN0ZWREYXRlRW5kLmdldEhvdXJzKCk7CiAgICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGRvdyA9IGRheU5hbWVzW3NlbGVjdGVkRGF0ZUVuZC5nZXREYXkoKV07CiAgICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKSA8IDEwID8gJzAnIDogJycpICsgc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKTsKICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmRfdGltZSA9IGVuZDsKICAgICAgLy8gY2FsY3VsYXRpbmcgZHVyYXRpb24KICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5kdXJhdGlvbl9ldmVudD1wYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzKS1wYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpOwogICAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50PSRzY29wZS5uZXdFdmVudERldGFpbHMuZHVyYXRpb25fZXZlbnQrKHBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzKS1wYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKSkqNjA7CiAgICAgIGlmICgkc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50PDApCiAgICAgIHsKICAgICAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50PTA7CiAgICAgIH0KICAgIH0KCiAgICAvLyB0aGlzIGZ1bmN0aW9uIGNhbGN1bGF0ZXMgZW5kIHRpbWUgYWNjb3JkaW5nIHRvIHRoZSBpbnB1dCBmcm9tIG1vZGFsIHdpbmRvdwogICAgLy8gYW5kIG5vdCBhY2NvcmRpbmcgdG8gZXZlbnQgdHlwZSBsZW5ndGgKICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZUVuZFRpbWVEeW5hbWljKCkKICAgIHsKICAgICAgZXZlbnRZZWFyPSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0eWVhcjsKICAgICAgZXZlbnRNb250aD0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoMTEyOwogICAgICBldmVudERheT0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRheW9mbW9udGg7CiAgICAgIGlmIChwYXJzZUludChldmVudE1vbnRoKTwxMCkKICAgICAgewogICAgICAgIGV2ZW50TW9udGg9IjAiK2V2ZW50TW9udGg7CiAgICAgIH0KICAgICAgaWYgKHBhcnNlSW50KGV2ZW50RGF5KTwxMCkKICAgICAgewogICAgICAgIGV2ZW50RGF5PSIwIitldmVudERheTsKICAgICAgfQogICAgICBsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyPSIrZXZlbnRZZWFyKTsKICAgICAgbG9nRGVidWcoIiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aD0iK2V2ZW50TW9udGgpOwogICAgICBsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aD0iK2V2ZW50RGF5KTsKICAgICAgbmV3X2VuZD1tb21lbnQudXRjKGV2ZW50WWVhcisiLSIrZXZlbnRNb250aCsiLSIrZXZlbnREYXkrIlQwMDowMDowMCIpLmFkZCgoKHBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzKSo2MCkrcGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcykpLCAnbWludXRlcycpOwogICAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZF90aW1lPW5ld19lbmQ7CiAgICAgIGxvZ0RlYnVnKCJuZXdfZW5kPSIrbmV3X2VuZCk7CiAgICAgIC8vIGNhbGN1bGF0aW5nIGR1cmF0aW9uCiAgICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuZHVyYXRpb25fZXZlbnQ9cGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcyktcGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKTsKICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5kdXJhdGlvbl9ldmVudD0kc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50KyhwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycyktcGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykpKjYwOwogICAgICBpZiAoJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5kdXJhdGlvbl9ldmVudDwwKQogICAgICB7CiAgICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5kdXJhdGlvbl9ldmVudD0wOwogICAgICB9CiAgICB9CiAgICBnZXRBbGxCdXNpbmVzc0V2ZW50VHlwZXMoJGh0dHAsJHNjb3BlLCdldmVudFR5cGVPcHRpb25zJyxnZXRBbGxCdXNpbmVzc0V2ZW50VHlwZXNfc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBnZXRBbGxCdXNpbmVzc0V2ZW50VHlwZXNfc3VjY2VzcygpCiAgICB7CiAgICAgIC8vIGFmdGVyIGxvYWRpbmcgZXZlbnQgdHlwZXMsIGlmIHRoZSBnaXZlbiBldmVudCB0eXBlIGlzICE9IDAgd2UgInNlbGVjdCIgaXQKICAgICAgY29uc29sZS5sb2coImdldEFsbEJ1c2luZXNzRXZlbnRUeXBlc19zdWNjZXNzIik7CiAgICAgIGlmICgkc2NvcGUuZ2l2ZW5fZXZlbnRfdHlwZV9pZD4wKQogICAgICB7CiAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8ICRzY29wZS5ldmVudFR5cGVPcHRpb25zLmxlbmd0aDsgaSsrKQogICAgICAgIHsKICAgICAgICAgIGlmICgkc2NvcGUuZXZlbnRUeXBlT3B0aW9uc1tpXS5ldmVudF90eXBlX2lkPT0kc2NvcGUuZ2l2ZW5fZXZlbnRfdHlwZV9pZCkKICAgICAgICAgIHsKICAgICAgICAgICAgY29uc29sZS5sb2coImdpdmVuX2V2ZW50X3R5cGVfaWQgZm91bmQiKTsKICAgICAgICAgICAgLy8gJHNjb3BlLmNhbGN1bGF0ZVN0YXJ0VGltZSgpOwogICAgICAgICAgICAkc2NvcGUuc2VsZWN0RXZlbnRUeXBlU2VsZWN0ZWQ9JHNjb3BlLmV2ZW50VHlwZU9wdGlvbnNbaV07CiAgICAgICAgICAgIC8vICRzY29wZS5zZWxlY3RFdmVudFR5cGUoJHNjb3BlLmV2ZW50VHlwZU9wdGlvbnNbaV0pOwogICAgICAgICAgICAkc2NvcGUuc2VsZWN0RXZlbnRUeXBlKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGVsc2UgewogICAgICAgICRzY29wZS5ldmVudFR5cGVPcHRpb25zLnVuc2hpZnQoeyJldmVudF90eXBlX2lkIjowLCAiZXZlbnRfdHlwZV9uYW1lIjoi15HXl9eoINeh15XXkiDXntek15LXqSIsIGlzX3ZhY2F0aW9uOiAwfSk7CiAgICAgICAgJHNjb3BlLnNlbGVjdEV2ZW50VHlwZVNlbGVjdGVkPSRzY29wZS5ldmVudFR5cGVPcHRpb25zWzBdOwogICAgICB9CiAgICB9CiAgICBnZXRBbGxDbGllbnRzKCRodHRwLCRzY29wZSwnZXZlbnRUeXBlVXNlcnMnKTsKCiAgICAkc2NvcGUuZXZlbnRDbGllbnRTZWxlY3RlZCA9IGZ1bmN0aW9uKHNlbGVjdGVkKSB7CiAgICAgICAgaWYgKHNlbGVjdGVkKSB7CiAgICAgICAgICAgIC8vIGFsZXJ0KEpTT04uc3RyaW5naWZ5KCBzZWxlY3RlZCwgbnVsbCwgMiApKTsKICAgICAgICAgICAgbG9nRGVidWcoJ2NsaWVudCBzZWxlY3RlZCAnICsgc2VsZWN0ZWQub3JpZ2luYWxPYmplY3QuYnVzZXJfZmlyc3RfbmFtZSk7CiAgICAgICAgICAgICRzY29wZS5zaG93RXZlbnRDbGllbnRTZWxlY3RlZCA9IHRydWU7CiAgICAgICAgICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kdXNlcl9pZCA9IHNlbGVjdGVkLm9yaWdpbmFsT2JqZWN0LmJ1c2luZXNzX3VzZXJfaWQ7CiAgICAgICAgICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kdXNlcl9maXJzdF9uYW1lID0gc2VsZWN0ZWQub3JpZ2luYWxPYmplY3QuYnVzZXJfZmlyc3RfbmFtZTsKICAgICAgICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmR1c2VyX2xhc3RfbmFtZSA9IHNlbGVjdGVkLm9yaWdpbmFsT2JqZWN0LmJ1c2VyX2xhc3RfbmFtZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBsb2dEZWJ1Zygnbm90IHNlbGVjdGVkJyk7CiAgICAgICAgICAgIC8vICRzY29wZS5ldmVudENsaWVudERlU2VsZWN0ZWQoKTsKICAgICAgICB9CiAgICB9OwogICAgJHNjb3BlLmV2ZW50Q2xpZW50RGVTZWxlY3RlZCA9IGZ1bmN0aW9uKCkgewogICAgICAgICRzY29wZS5zaG93RXZlbnRDbGllbnRTZWxlY3RlZCA9IGZhbHNlOwogICAgICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kdXNlcl9pZCA9IG51bGw7CiAgICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmR1c2VyX2ZpcnN0X25hbWUgPSBudWxsOwogICAgICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kdXNlcl9sYXN0X25hbWUgPSBudWxsOwogICAgICAgICRzY29wZS5jbGVhckNsaWVudElucHV0KCdjbGllbnRfYW5ndWNvbXBsZXRlJyk7CiAgICB9CgogICAgJHNjb3BlLmNsZWFyQ2xpZW50SW5wdXQgPSBmdW5jdGlvbihpZCkgewogICAgICAgIGlmIChpZCkgewogICAgICAgICAgICAkc2NvcGUuJGJyb2FkY2FzdCgnYW5ndWNvbXBsZXRlLWFsdDpjbGVhcklucHV0JywgaWQpOwogICAgICAgIH0KICAgICAgICAvLyBlbHNlewogICAgICAgIC8vICAgJHNjb3BlLiRicm9hZGNhc3QoJ2FuZ3Vjb21wbGV0ZS1hbHQ6Y2xlYXJJbnB1dCcpOwogICAgICAgIC8vIH0KICAgIH0KCiAgICAkc2NvcGUuY2FuY2VsID0gZnVuY3Rpb24oKSB7CiAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgfTsKCiAgICAkc2NvcGUudXBkYXRlRXZlbnROYW1lQ2hlY2sgPSBmdW5jdGlvbihuZXdWYWx1ZSkKICAgIHsKICAgICAgbG9nRGVidWcoInVwZGF0ZUV2ZW50TmFtZT0iK25ld1ZhbHVlKTsKICAgICAgaWYgKG5ld1ZhbHVlPT0iIikKICAgICAgewogICAgICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuZXZlbnRfbmFtZSA9ICRzY29wZS5uZXdFdmVudERldGFpbHMub3JpZ2luYWxfZXZlbnRfbmFtZTsKICAgICAgfQogICAgfQogICAgLy8gcmVzY2hlZHVsZUV2ZW50CiAgICAkc2NvcGUucmVzY2hlZHVsZUV2ZW50ID0gZnVuY3Rpb24oKSB7CiAgICAgIGxvZ0RlYnVnKCJmdW5jdGlvbjogcmVzY2hlZHVsZUV2ZW50Iik7CgogICAgICAvLyBuZXdFdmVudEpTT05EZXRhaWxzID0gSlNPTi5zdHJpbmdpZnkoJHNjb3BlLm5ld0V2ZW50RGV0YWlscywgbnVsbCwgNCk7IC8vIChPcHRpb25hbCkgYmVhdXRpZnVsIGluZGVudGVkIG91dHB1dC4KICAgICAgbG9nRGVidWcoInJlc2NoZWR1bGVFdmVudCwgIiArIEpTT04uc3RyaW5naWZ5KCRzY29wZS5uZXdFdmVudERldGFpbHMsIG51bGwsIDQpKTsKICAgICAgLy8gaWYgKCRzY29wZS5uZXdFdmVudERldGFpbHMuZXZlbnRSZWN1cnJpbmcpIHsKICAgICAgLy8gICBjcmVhdGVSZWN1cnJpbmdFdmVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLm5ld0V2ZW50RGV0YWlscyxjcmVhdGVSZWN1cnJpbmdFdmVudF9zdWNjZXNzKTsKICAgICAgLy8gICBmdW5jdGlvbiBjcmVhdGVSZWN1cnJpbmdFdmVudF9zdWNjZXNzKCkKICAgICAgLy8gICB7CiAgICAgIC8vICAgICBjYWxlbmRhciA9ICJjYWxlbmRhcl9idXNpbmVzcyI7CiAgICAgIC8vICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZWZldGNoRXZlbnRzJyk7CiAgICAgIC8vICAgICAkdWliTW9kYWxJbnN0YW5jZS5kaXNtaXNzKCk7CiAgICAgIC8vICAgICAvLyBlcnJvciB3YXMKICAgICAgLy8gICAgIC8vIGxvZ0RlYnVnKCJlcnJvciAiICsgZGF0YS5NZXNzYWdlKTsKICAgICAgLy8gICAgIC8vICRzY29wZS5hamF4X2Vycm9yID0gZGF0YS5NZXNzYWdlOwogICAgICAvLyAgIH0KICAgICAgLy8gfQogICAgICAvLyBlbHNlCiAgICAgIHsKICAgICAgICAvLyBpZiBldmVudCBpcyBub3QgY2xhc3MsIGEgY2xpZW50IG11c3QgYmUgc2VsZWN0ZWQKICAgICAgICAvLyBpZiAoKCEkc2NvcGUuc2hvd0V2ZW50Q2xpZW50U2VsZWN0ZWQpICYmICghJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pc19jbGFzcykpCiAgICAgICAgLy8gewogICAgICAgIC8vICAgLy8gYWxlcnQoJ2NsaWVudCBtdXN0IGJlIHNlbGVjdGVkJyk7CiAgICAgICAgLy8gICAkc2NvcGUuYWpheF9lcnJvcj0i15DXoNeQINeU15XXodejINee16nXqteq16Mg15zXntek15LXqSI7CiAgICAgICAgLy8gICByZXR1cm47CiAgICAgICAgLy8gfQogICAgICAgIHJlc2NoZWR1bGVFdmVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLnJlc2NoZWR1bGVfZXZlbnRfZGV0YWlscy5ldmVudF9pZCwkc2NvcGUubmV3RXZlbnREZXRhaWxzLHJlc2NoZWR1bGVFdmVudF9zdWNjZXNzKTsKICAgICAgICBmdW5jdGlvbiByZXNjaGVkdWxlRXZlbnRfc3VjY2VzcygpCiAgICAgICAgewogICAgICAgICAgY2FsZW5kYXIgPSAiY2FsZW5kYXJfYnVzaW5lc3MiOwogICAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwogICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjYWxlbmRhckV2ZW50UmVzY2hlZHVsZURlc2VsZWN0Jyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCiAgICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5kaXNtaXNzKCdhZGRlZCcpOwogICAgICAgIH0KICAgICAgICAvLyBvbiBmYWlsdXJlIHdhcwogICAgICAgIC8vICRzY29wZS5hamF4X2Vycm9yID0gZGF0YS5NZXNzYWdlOwogICAgICB9CiAgICB9OwoKICAgICRzY29wZS5jcmVhdGVOZXdFdmVudCA9IGZ1bmN0aW9uKCkgewogICAgICAgIGxvZ0RlYnVnKCJjcmVhdGVOZXdFdmVudCBzdGFydF90aW1lPSIrIHR5cGVvZiAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWUpOwoKICAgICAgICBuZXdFdmVudEpTT05EZXRhaWxzID0gSlNPTi5zdHJpbmdpZnkoJHNjb3BlLm5ld0V2ZW50RGV0YWlscywgbnVsbCwgNCk7IC8vIChPcHRpb25hbCkgYmVhdXRpZnVsIGluZGVudGVkIG91dHB1dC4KICAgICAgICBsb2dEZWJ1ZygiY3JlYXRlTmV3RXZlbnQsICIgKyBuZXdFdmVudEpTT05EZXRhaWxzKTsKICAgICAgICBpZiAoJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5ldmVudFJlY3VycmluZykgewogICAgICAgICAgY3JlYXRlUmVjdXJyaW5nRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5uZXdFdmVudERldGFpbHMsY3JlYXRlUmVjdXJyaW5nRXZlbnRfc3VjY2Vzcyk7CiAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVSZWN1cnJpbmdFdmVudF9zdWNjZXNzKCkKICAgICAgICAgIHsKICAgICAgICAgICAgY2FsZW5kYXIgPSAiY2FsZW5kYXJfYnVzaW5lc3MiOwogICAgICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZWZldGNoRXZlbnRzJyk7CiAgICAgICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoKTsKICAgICAgICAgICAgLy8gZXJyb3Igd2FzCiAgICAgICAgICAgIC8vIGxvZ0RlYnVnKCJlcnJvciAiICsgZGF0YS5NZXNzYWdlKTsKICAgICAgICAgICAgLy8gJHNjb3BlLmFqYXhfZXJyb3IgPSBkYXRhLk1lc3NhZ2U7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAvLyBjaGVja2luZyBldmVudCB0aW1lIGxvZ2ljCiAgICAgICAgICBpZiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3Vycz4kc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycykKICAgICAgICAgIHsKICAgICAgICAgICAgJHNjb3BlLmFqYXhfZXJyb3I9IteW157XnyDXlNeU16rXl9ec15Qg16nXnCDXlNee16TXktepINeQ15fXqNeZINeW157XnyDXlNeh15nXldedINep15zXlSI7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIC8vIGNoZWNraW5nIGV2ZW50IHRpbWUgbG9naWMKICAgICAgICAgIGlmIChwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKT09cGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMpKQogICAgICAgICAgewogICAgICAgICAgICBpZiAocGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKT49cGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcykpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAkc2NvcGUuYWpheF9lcnJvcj0i15bXntefINeU15TXqteX15zXlCDXqdecINeU157XpNeS16kg15DXl9eo15kg15bXntefINeU16HXmdeV150g16nXnNeVIjsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbG9nRGVidWcoIiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcz0iKyRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcyk7CiAgICAgICAgICAgIGxvZ0RlYnVnKCIkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzPSIrJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcyk7CiAgICAgICAgICAgIGlmICgocGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKSs1KT49cGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcykpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAkc2NvcGUuYWpheF9lcnJvcj0i15DXldeo15og15TXntek15LXqSDXl9eZ15nXkSDXnNeU15nXldeqINec16TXl9eV16ogNSDXk9en15XXqiI7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICAvLyBpZiBldmVudCBpcyBub3QgY2xhc3MsIGEgY2xpZW50IG11c3QgYmUgc2VsZWN0ZWQKICAgICAgICAgIGlmICgoISRzY29wZS5zaG93RXZlbnRDbGllbnRTZWxlY3RlZCkgJiYgKCEkc2NvcGUubmV3RXZlbnREZXRhaWxzLmlzX2NsYXNzKSAmJiAoJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pc19nZW5lcmljX2V0eXBlPT0wKSkKICAgICAgICAgIHsKICAgICAgICAgICAgLy8gYWxlcnQoJ2NsaWVudCBtdXN0IGJlIHNlbGVjdGVkJyk7CiAgICAgICAgICAgICRzY29wZS5hamF4X2Vycm9yPSLXkNeg15Ag15TXldeh16Mg157Xqdeq16rXoyDXnNee16TXktepIjsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgaWYgKCRzY29wZS5zZWxlY3RFdmVudFR5cGVTZWxlY3RlZC5ldmVudF90eXBlX2lkPT0wKQogICAgICAgICAgewogICAgICAgICAgICAvLyBhbGVydCgnY2xpZW50IG11c3QgYmUgc2VsZWN0ZWQnKTsKICAgICAgICAgICAgJHNjb3BlLmFqYXhfZXJyb3I9IteQ16DXkCDXkdeX16gg16HXldeSINee16TXktepICI7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIGNyZWF0ZUV2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUubmV3RXZlbnREZXRhaWxzLGNyZWF0ZUV2ZW50X3N1Y2Nlc3MpOwogICAgICAgICAgZnVuY3Rpb24gY3JlYXRlRXZlbnRfc3VjY2VzcygpCiAgICAgICAgICB7CiAgICAgICAgICAgIGNhbGVuZGFyID0gImNhbGVuZGFyX2J1c2luZXNzIjsKICAgICAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwogICAgICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5kaXNtaXNzKCdhZGRlZCcpOwogICAgICAgICAgfQogICAgICAgICAgLy8gb24gZmFpbHVyZSB3YXMKICAgICAgICAgIC8vICRzY29wZS5hamF4X2Vycm9yID0gZGF0YS5NZXNzYWdlOwogICAgICAgIH0KICAgIH0KfSk7Ci8vLy8gZmZmZmZmZgprdXplQXBwLmNvbnRyb2xsZXIoJ0J1c2luZXNzQ2FsZW5kYXJDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgc2hhcmVkUHJvcGVydGllcywgJGNvbXBpbGUsICRsb2NhdGlvbiwgdWlDYWxlbmRhckNvbmZpZywgJHVpYk1vZGFsLCBzaGFyZWREYXRhKSB7CiAgICBpbml0aWFsRW5kVXNlciA9IHNoYXJlZERhdGEuZ2V0U2VsZWN0ZWRFbmRVc2VyKCk7CiAgICBsb2dEZWJ1ZygnQnVzaW5lc3NDYWxlbmRhciBDb250cm9sbGVyLCBzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCk9JyArIHNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKSk7CgogICAgZ2V0QnVzaW5lc3NMb2NhdGlvbnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19sb2NhdGlvbnMnKTsKCiAgICAkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcj1mYWxzZTsKCiAgICBpZiAoc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpIT1udWxsKQogICAgewogICAgICBjb25zb2xlLmxvZygiZ290IHByZXZpb3VzIHNlbGVjdGVkIHVzZXIgIitzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfZmlyc3RfbmFtZSk7CiAgICAgICRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VybmFtZT1zaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfZmlyc3RfbmFtZSsiICIrc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2VyX2xhc3RfbmFtZTsKICAgICAgJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJfaWQ9c2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2luZXNzX3VzZXJfaWQ7CiAgICAgIGxvZ0RlYnVnKCIkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcl9pZD0iKyRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyX2lkKTsKCiAgICAgICRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyPXRydWU7CiAgICB9CgogICAgLy8gY2hlY2tpbmcgaWYgY2FsZW5kYXIgc2hvdWxkIHN0YXJ0IHdpdGggYSBzcGVjaWZpYyBkYXRlIChmcm9tIHVybCBvciBmcm9tIHByZXZpb3VzbHkgc2VsZWN0ZWQgZGF0ZSkKICAgIGxvZ0RlYnVnKCIkbG9jYXRpb24uc2VhcmNoKCkuc3RhcnQ9IiArICRsb2NhdGlvbi5zZWFyY2goKS5zdGFydCk7CiAgICBpZiAodHlwZW9mICRsb2NhdGlvbi5zZWFyY2goKS5zdGFydCAhPSAndW5kZWZpbmVkJykKICAgIHsKICAgICAgY3VyckRlZmF1bHREYXRlID0gJGxvY2F0aW9uLnNlYXJjaCgpLnN0YXJ0OwogICAgfQogICAgZWxzZSBpZiAoc2hhcmVkUHJvcGVydGllcy5nZXRfY2FsZW5kYXJfZGF0ZSgpIT1udWxsKQogICAgewogICAgICBjb25zb2xlLmxvZygiZ290IHByZXZpb3VzIGRhdGUgICIrc2hhcmVkUHJvcGVydGllcy5nZXRfY2FsZW5kYXJfZGF0ZSgpKTsKICAgICAgY3VyckRlZmF1bHREYXRlID0gc2hhcmVkUHJvcGVydGllcy5nZXRfY2FsZW5kYXJfZGF0ZSgpOwogICAgfQogICAgZWxzZQogICAgewogICAgICBjdXJyRGVmYXVsdERhdGUgPSBuZXcgRGF0ZSgpOwogICAgfQogICAgZ2V0QWxsSW5zdHJ1Y3RvcnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19pbnN0cnVjdG9ycycsZ2V0QWxsSW5zdHJ1Y3RvcnNfZmluaXNoKTsKICAgIGZ1bmN0aW9uIGdldEFsbEluc3RydWN0b3JzX2ZpbmlzaCgpCiAgICB7CiAgICAgIC8vIGNvbnNvbGUubG9nKCRzY29wZS5idXNpbmVzc19pbnN0cnVjdG9ycyk7CiAgICAgICRzY29wZS5idXNpbmVzc19pbnN0cnVjdG9ycy51bnNoaWZ0KHsiYnVzZXJfZnVsbF9uYW1lIjoi15vXnCDXlNem15XXldeqIiwgImJ1c2VyX2ZpcnN0X25hbWUiOiLXm9eV15zXnSIsImJ1c2VyX2xhc3RfbmFtZSI6IiIsICJ1c2VyX2lkIjogMCwgImJ1c2luZXNzX3VzZXJfaWQiOiAwfSk7CgogICAgICAvLyBzZXR0aW5nIHNlbGVjdGVkIGdldF9zZWxlY3RlZF9pbnN0cnVjdG9yCiAgICAgICRzY29wZS5wcmV2aW91c19zZWxlY3RlZF9pbnN0cnVjdG9yPWZhbHNlOwogICAgICBpZiAoc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfaW5zdHJ1Y3RvcigpPj0wKQogICAgICB7CiAgICAgICAgLy8gY29uc29sZS5sb2coImdvdCBwcmV2aW91cyBzZWxlY3RlZCBpbnN0cnVjdG9yICIrc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfaW5zdHJ1Y3RvcigpKTsKICAgICAgICAkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfaW5zdHJ1Y3Rvcl9pZD1zaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF9pbnN0cnVjdG9yKCk7CiAgICAgICAgJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX2luc3RydWN0b3I9dHJ1ZTsKICAgICAgICAkc2NvcGUuc2VsZWN0ZWRfYnVzaW5lc3NfdXNlcl9pZD1zaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF9pbnN0cnVjdG9yKCk7CiAgICAgIH0KICAgIH0KICAgIGdldEFsbEJ1c2luZXNzRXZlbnRUeXBlc05vU3lzdGVtKCRodHRwLCRzY29wZSwnZXZlbnRfdHlwZXMnKTsKCiAgICAvLyBzZXR0aW5nIHNlbGVjdGVkIHVzZXIgaWQKICAgICRzY29wZS5wcmV2aW91c19ldmVudF9yZXNjaGVkdWxlPWZhbHNlOwogICAgJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGVfZXZlbnQ9bnVsbDsKCiAgICAkc2NvcGUuJG9uKCJjYWxlbmRhckV2ZW50UmVzY2hlZHVsZURlc2VsZWN0IixmdW5jdGlvbihlLGEpCiAgICB7CiAgICAgICRzY29wZS5jYWxlbmRhckV2ZW50UmVzY2hlZHVsZURlc2VsZWN0KCk7CiAgICB9KTsKCiAgICAvLyBkZXNlbGVjdGluZyBldmVudCBmcm9tIGJlaW5nIHJlc2NoZWR1bGVkCiAgICAkc2NvcGUuY2FsZW5kYXJFdmVudFJlc2NoZWR1bGVEZXNlbGVjdD1mdW5jdGlvbigpCiAgICB7CiAgICAgIHNoYXJlZFByb3BlcnRpZXMuc2V0X2V2ZW50X3Jlc2NoZWR1bGUobnVsbCk7CiAgICAgICRzY29wZS5wcmV2aW91c19ldmVudF9yZXNjaGVkdWxlPWZhbHNlOwogICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwogICAgfQogICAgLy8gZGVsZXRpbmcgY2xpZW50IHNlbGVjdGlvbiBpbiBjYWxlbmRhcgogICAgJHNjb3BlLmNhbGVuZGFyQ2xpZW50RGVzZWxlY3Q9ZnVuY3Rpb24oKSAvLyByZWxvYWQgY2xhc3MvZXZlbnQgc3VnZ2VzdGlvbnMKICAgIHsKICAgICAgJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXI9ZmFsc2U7CiAgICAgIHNoYXJlZFByb3BlcnRpZXMuc2V0X3NlbGVjdGVkX3VzZXIobnVsbCk7CiAgICAgICRzY29wZS5ldmVudFR5cGVTZWxlY3RlZCgpOwogICAgfQogICAgaWYgKGluaXRpYWxFbmRVc2VyICE9IG51bGwpIHsKICAgICAgICAkc2NvcGUuYnVzaW5lc3NDYWxlbmRhckluaXRpYWxOYW1lID0gdHJ1ZTsKICAgICAgICBzaGFyZWREYXRhLnNldFNlbGVjdGVkRW5kVXNlcihudWxsKTsKICAgICAgICAkc2NvcGUuYnVzaW5lc3NDYWxlbmRhckluaXRpYWxzID0gewogICAgICAgICAgICBuYW1lOiBpbml0aWFsRW5kVXNlci5maXJzdF9uYW1lICsgIiAiICsgaW5pdGlhbEVuZFVzZXIubGFzdF9uYW1lCiAgICAgICAgfTsKICAgIH0gZWxzZSB7CiAgICAgICAgJHNjb3BlLmJ1c2luZXNzQ2FsZW5kYXJJbml0aWFsTmFtZSA9IGZhbHNlOwogICAgfQogICAgLyogY29uZmlnIG9iamVjdCAqLwogICAgJHNjb3BlLmNhbGVuZGFyX25hbWUgPSAiY2FsZW5kYXJfYnVzaW5lc3MiOwogICAgJHNjb3BlLmNhbGVuZGFyID0gImNhbGVuZGFyX2J1c2luZXNzIjsKICAgIC8qIGV2ZW50IHNvdXJjZXMgYXJyYXkqLwogICAgJHNjb3BlLmJ1c2luZXNzQ2FsZW5kYXJFdmVudFNvdXJjZXMgPSBbewogICAgICAgIHVybDogJy9hcGkvYWRtaW4vZXZlbnRzL2dldHBvc3QnLAogICAgICAgIHR5cGU6ICdQT1NUJwogICAgfSwgewogICAgICAgIHVybDogJy9hcGkvYWRtaW4vY2FsZW5kYXIvbGltaXRhdGlvbnMvYmFja2dyb3VuZC9nZXRwb3N0JywKICAgICAgICB0eXBlOiAnUE9TVCcKICAgIC8vIH0sIHsKICAgIC8vICAgICB1cmw6ICcvYXBpL2FkbWluL3JlY3VycmluZy9nZXRwb3N0JywKICAgIC8vICAgICB0eXBlOiAnUE9TVCcKICAgIH1dOwoKICAgICRzY29wZS5nb3RvVG9kYXkgPSBmdW5jdGlvbigpIHsKICAgICAgICAkc2NvcGUuZ290b0RhdGUobmV3IERhdGUoKSk7CiAgICAgICAgdmlzaWJsZURhdGVTdGFydCA9IG5ldyBEYXRlKHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3Jykuc3RhcnQpOwogICAgICAgIGRhdGVUb0dvVG8gPSB2aXNpYmxlRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCkgKyAiLSIgKyAoJzAnICsgKHZpc2libGVEYXRlU3RhcnQuZ2V0TW9udGgoKSArIDEpKS5zbGljZSgtMikgKyAiLSIgKyAoJzAnICsgdmlzaWJsZURhdGVTdGFydC5nZXREYXRlKCkpLnNsaWNlKC0yKTsKICAgICAgICBzaGFyZWRQcm9wZXJ0aWVzLnNldF9jYWxlbmRhcl9kYXRlKGRhdGVUb0dvVG8pOwogICAgICAgICRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0PXZpc2libGVEYXRlU3RhcnQ7CiAgICAgICAgJGxvY2F0aW9uLnNlYXJjaCgnc3RhcnQnLGRhdGVUb0dvVG8pOwogICAgfQoKICAgICRzY29wZS5pbnN0cnVjdG9yU2VsZWN0ZWQ9ZnVuY3Rpb24odGhpc3RoaXMpCiAgICB7CiAgICAgIHVwZGF0ZVN1Z2dlc3Rpb25zKCk7CiAgICB9CiAgICAkc2NvcGUuZXZlbnRUeXBlU2VsZWN0ZWQ9ZnVuY3Rpb24odGhpc3RoaXMpCiAgICB7CiAgICAgIHVwZGF0ZVN1Z2dlc3Rpb25zKCk7CiAgICB9CiAgICBmdW5jdGlvbiB1cGRhdGVTdWdnZXN0aW9ucygpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJmdW5jdGlvbjogdXBkYXRlU3VnZ2VzdGlvbnMiKTsKICAgICAgc2hhcmVkUHJvcGVydGllcy5zZXRfZXZlbnRfdHlwZV9mb3Jfc3VnZ2VzdGlvbnMoJHNjb3BlLnNlbGVjdGVkX2V2ZW50X3R5cGVfaWQpOwogICAgICBzaGFyZWRQcm9wZXJ0aWVzLnNldF9zZWxlY3RlZF9pbnN0cnVjdG9yKCRzY29wZS5zZWxlY3RlZF9idXNpbmVzc191c2VyX2lkKTsKICAgICAgZm9yIChpPTA7aTwkc2NvcGUuZXZlbnRfdHlwZXMubGVuZ3RoO2krKykKICAgICAgewogICAgICAgIC8vIGNvbnNvbGUubG9nKCRzY29wZS5ldmVudF90eXBlc1tpXS5ldmVudF90eXBlX2lkKTsKICAgICAgICBpZiAoJHNjb3BlLnNlbGVjdGVkX2V2ZW50X3R5cGVfaWQ9PSRzY29wZS5ldmVudF90eXBlc1tpXS5ldmVudF90eXBlX2lkKQogICAgICAgIHsKICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJmb3VuZCBldmVudCB0eXBlIGlkIik7CiAgICAgICAgICBpZiAoJHNjb3BlLmV2ZW50X3R5cGVzW2ldLmlzX2NsYXNzKSAvLyBpcyBjbGFzcwogICAgICAgICAgewogICAgICAgICAgICBsb2dEZWJ1ZygiJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXI9Iiskc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcik7CiAgICAgICAgICAgIGlmICgkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcikKICAgICAgICAgICAgewogICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJpcyBjbGFzcyBzdWdnZXN0aW9uZCIpOwogICAgICAgICAgICAgICRodHRwLmdldCgkZ0FwaVVSTFByZWZpeCArICIvZW5kdXNlci9ldmVudHMvc3VnZ2VzdGNsYXNzLyIrJHNjb3BlLnNlbGVjdGVkX2V2ZW50X3R5cGVfaWQrIi8iKyRzY29wZS5zZWxlY3RlZF9idXNpbmVzc191c2VyX2lkKyIvIiskc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpKyIvIisoJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0TW9udGgoKSsxKSsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0RGF0ZSgpKyIvIiskc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXRIb3VycygpICsgIi8iICsgJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0TWludXRlcygpICsgIi8iICsgJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJfaWQpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRfZXZlbnRfdHlwZV9pZF9pc19jbGFzcz10cnVlOwogICAgICAgICAgICAgICAgICAkc2NvcGUuZXZlbnRzU3VnZ2VzdGVkID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBjb25zb2xlLmxvZygibm90IGlzIGNsYXNzIHN1Z2dlc3Rpb25kIik7CiAgICAgICAgICAgICAgJGh0dHAuZ2V0KCRnQXBpVVJMUHJlZml4ICsgIi9lbmR1c2VyL2V2ZW50cy9zdWdnZXN0Y2xhc3MvIiskc2NvcGUuc2VsZWN0ZWRfZXZlbnRfdHlwZV9pZCsiLyIrJHNjb3BlLnNlbGVjdGVkX2J1c2luZXNzX3VzZXJfaWQrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCkrIi8iKygkc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpKzEpKyIvIiskc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXREYXRlKCkrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldEhvdXJzKCkgKyAiLyIgKyAkc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXRNaW51dGVzKCkgKyAiLzAiKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKQogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkX2V2ZW50X3R5cGVfaWRfaXNfY2xhc3M9dHJ1ZTsKICAgICAgICAgICAgICAgICAgJHNjb3BlLmV2ZW50c1N1Z2dlc3RlZCA9IHJlc3BvbnNlLmRhdGE7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGVsc2UgLy8gaXMgbm90IGNsYXNzCiAgICAgICAgICB7CiAgICAgICAgICAgICRodHRwLmdldCgkZ0FwaVVSTFByZWZpeCArICIvZW5kdXNlci9ldmVudHMvc3VnZ2VzdC8iKyRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkKyIvIiskc2NvcGUuc2VsZWN0ZWRfYnVzaW5lc3NfdXNlcl9pZCsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSsiLyIrKCRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkrMSkrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0SG91cnMoKSArICIvIiArICRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkX2V2ZW50X3R5cGVfaWRfaXNfY2xhc3M9ZmFsc2U7CiAgICAgICAgICAgICAgICAkc2NvcGUuZXZlbnRzU3VnZ2VzdGVkID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgJHNjb3BlLmdvdG9OZXh0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlbW92ZUV2ZW50cycpOwogICAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCduZXh0Jyk7CiAgICAgICAgJHNjb3BlLnVwZGF0ZUNhbGVuZGFyQ2VudGVyVGl0bGUoKTsKICAgICAgICAvLyBhZGRpbmcgdGhlIGZvbGxvd2luZyB0byBtYWtlIHRoZSB1cmwKICAgICAgICAvLyBwb2ludCB0byB0aGUgcmlnaHQgd2VlaywgaWYgZ29pbmcgdG8gYSBkaWZmZXJlbnQgVVJMIGFuZCB0aGVuIGdvaW5nIGJhY2sKICAgICAgICB2aXNpYmxlRGF0ZVN0YXJ0ID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5zdGFydCk7CiAgICAgICAgZGF0ZVRvR29UbyA9IHZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSArICItIiArICgnMCcgKyAodmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpICsgMSkpLnNsaWNlKC0yKSArICItIiArICgnMCcgKyB2aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSkuc2xpY2UoLTIpOwogICAgICAgIHNoYXJlZFByb3BlcnRpZXMuc2V0X2NhbGVuZGFyX2RhdGUoZGF0ZVRvR29Ubyk7CiAgICAgICAgJHNjb3BlLnZpc2libGVEYXRlU3RhcnQ9dmlzaWJsZURhdGVTdGFydDsKICAgICAgICAkbG9jYXRpb24uc2VhcmNoKCdzdGFydCcsZGF0ZVRvR29Ubyk7CiAgICB9CiAgICAkc2NvcGUuZ290b1ByZXYgPSBmdW5jdGlvbigpIHsKICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVtb3ZlRXZlbnRzJyk7CiAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3ByZXYnKTsKICAgICAgICAkc2NvcGUudXBkYXRlQ2FsZW5kYXJDZW50ZXJUaXRsZSgpOwogICAgICAgIC8vIGFkZGluZyB0aGUgZm9sbG93aW5nIHRvIG1ha2UgdGhlIHVybAogICAgICAgIC8vIHBvaW50IHRvIHRoZSByaWdodCB3ZWVrLCBpZiBnb2luZyB0byBhIGRpZmZlcmVudCBVUkwgYW5kIHRoZW4gZ29pbmcgYmFjawogICAgICAgIHZpc2libGVEYXRlU3RhcnQgPSBuZXcgRGF0ZSh1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ2V0VmlldycpLnN0YXJ0KTsKICAgICAgICBkYXRlVG9Hb1RvID0gdmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpICsgIi0iICsgKCcwJyArICh2aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkgKyAxKSkuc2xpY2UoLTIpICsgIi0iICsgKCcwJyArIHZpc2libGVEYXRlU3RhcnQuZ2V0RGF0ZSgpKS5zbGljZSgtMik7CiAgICAgICAgc2hhcmVkUHJvcGVydGllcy5zZXRfY2FsZW5kYXJfZGF0ZShkYXRlVG9Hb1RvKTsKICAgICAgICAkc2NvcGUudmlzaWJsZURhdGVTdGFydD12aXNpYmxlRGF0ZVN0YXJ0OwogICAgICAgICRsb2NhdGlvbi5zZWFyY2goJ3N0YXJ0JyxkYXRlVG9Hb1RvKTsKCiAgICB9CiAgICAkc2NvcGUuZ290b0RhdGUgPSBmdW5jdGlvbihuZXdkYXRlKSB7CiAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dvdG9EYXRlJywgbmV3ZGF0ZSk7CiAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlbW92ZUV2ZW50cycpOwogICAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZWZldGNoRXZlbnRzJyk7CiAgICAgICAgJHNjb3BlLnVwZGF0ZUNhbGVuZGFyQ2VudGVyVGl0bGUoKTsKICAgIH0KCiAgICAkc2NvcGUuZWRpdEhvdXJzT2ZXb3JrID0gZnVuY3Rpb24oKSB7CiAgICAgICAgLy8gcGFyYW0gc2hvdWxkIGxvb2sgbGlrZSAiMjAxNi0wNy0wMSIKICAgICAgICB2aXNpYmxlRGF0ZVN0YXJ0ID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5zdGFydCk7CiAgICAgICAgZGF0ZVRvR29UbyA9IHZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSArICItIiArICgnMCcgKyAodmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpICsgMSkpLnNsaWNlKC0yKSArICItIiArICgnMCcgKyB2aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSkuc2xpY2UoLTIpOwogICAgICAgICRsb2NhdGlvbi5wYXRoKCcvaG91cnNfb2Zfd29yaycpLnNlYXJjaCh7CiAgICAgICAgICAgIHN0YXJ0OiBkYXRlVG9Hb1RvCiAgICAgICAgfSk7CiAgICB9OwoKICAgICRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKTsKCiAgICAgICAgdmlzaWJsZURhdGVTdGFydCA9IG5ldyBEYXRlKHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3Jykuc3RhcnQpOwogICAgICAgIHZpc2libGVEYXRlRW5kID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5lbmQpOwoKICAgICAgICAkc2NvcGUuY2FsZW5kYXJUaXRsZUNlbnRlciA9IHZpc2libGVEYXRlU3RhcnQuZ2V0RGF0ZSgpICsgIiAiICsgbW9udGhOYW1lc1t2aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCldICsKICAgICAgICAgICAgIiDigJQgIiArIHZpc2libGVEYXRlRW5kLmdldERhdGUoKSArICIgIiArIG1vbnRoTmFtZXNbdmlzaWJsZURhdGVFbmQuZ2V0TW9udGgoKV0gKwogICAgICAgICAgICAiICIgKyB2aXNpYmxlRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCk7CiAgICB9OwoKICAgICRzY29wZS5zaG93RXZlbnRQb3B1cCA9IGZ1bmN0aW9uKHNlbGVjdGVkRXZlbnQpIHsKICAgICAgICBzaG93RXZlbnRQb3B1cChzZWxlY3RlZEV2ZW50LCAkdWliTW9kYWwpCiAgICB9OwoKICAgICRzY29wZS5ldmVudENyZWF0ZU1vZGFsRnJvbVNjaGVkdWxlciA9IGZ1bmN0aW9uKGVzdWdnZXN0KQogICAgewogICAgICAvLyBpZiBjbGFzcyAtIGdvIHRvIGV2ZW50IGNsYXNzCiAgICAgIGNvbnNvbGUubG9nKGVzdWdnZXN0KTsKICAgICAgZm9yIChpPTA7aTwkc2NvcGUuZXZlbnRfdHlwZXMubGVuZ3RoO2krKykKICAgICAgewogICAgICAgIGlmIChlc3VnZ2VzdC5ldmVudF90eXBlX2lkPT0kc2NvcGUuZXZlbnRfdHlwZXNbaV0uZXZlbnRfdHlwZV9pZCkKICAgICAgICB7CiAgICAgICAgICBpZiAoJHNjb3BlLmV2ZW50X3R5cGVzW2ldLmlzX2NsYXNzKQogICAgICAgICAgewogICAgICAgICAgICBjb25zb2xlLmxvZygiaXMgY2xhc3MiKTsKICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWY9Jy8jL2V2ZW50X2NsYXNzLycgKyBlc3VnZ2VzdC5ldmVudF9pZDsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBsb2dEZWJ1ZyhKU09OLnN0cmluZ2lmeShlc3VnZ2VzdCkpOwogICAgICBsb2dEZWJ1Zyhlc3VnZ2VzdC5zdGFydF9lcG9jaCk7CiAgICAgIHN0YXJ0RGF0ZT1lc3VnZ2VzdC5zdGFydF9lcG9jaCoxMDAwOwoKICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgICAgICAgICBhbmltYXRpb246IGZhbHNlLAogICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfZXZlbnRfY3JlYXRlLnBocCcsCiAgICAgICAgICBjb250cm9sbGVyOiAnZXZlbnRDcmVhdGVNb2RhbENvbnRyb2xsZXInLAogICAgICAgICAgc2l6ZTogJ2wnLAogICAgICAgICAgcmVzb2x2ZTogewogICAgICAgICAgICAgIHN0YXJ0RGF0ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBzdGFydERhdGU7CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBldmVudF90eXBlX2lkOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuICRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkOwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgbG9jYXRpb25faWQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gZXN1Z2dlc3QubG9jYXRpb25faWQ7CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBlbXBfaWQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gZXN1Z2dlc3QuZW1wX2lkOwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgcmVzY2hlZHVsZV9ldmVudDogZnVuY3Rpb24oKQogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGlmICgkc2NvcGUucHJldmlvdXNfZXZlbnRfcmVzY2hlZHVsZSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuICRzY29wZS5wcmV2aW91c19ldmVudF9yZXNjaGVkdWxlX2V2ZW50OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CgogICAgICAgICAgfQogICAgICB9KTsKCiAgICB9CiAgICAkc2NvcGUuZXZlbnRDcmVhdGVNb2RhbCA9IGZ1bmN0aW9uKHN0YXJ0RGF0ZSwgc2l6ZSkgewogICAgICAgIGxvZ0RlYnVnKCJldmVudCBjcmVhdGUgbW9kYWwgc3RhcnREYXRlPSIrc3RhcnREYXRlKTsKCiAgICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgICAgICAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2V2ZW50X2NyZWF0ZS5waHAnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnZXZlbnRDcmVhdGVNb2RhbENvbnRyb2xsZXInLAogICAgICAgICAgICBzaXplOiBzaXplLAogICAgICAgICAgICByZXNvbHZlOiB7CiAgICAgICAgICAgICAgICBzdGFydERhdGU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBzdGFydERhdGU7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZXZlbnRfdHlwZV9pZDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbG9jYXRpb25faWQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGVtcF9pZDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcmVzY2hlZHVsZV9ldmVudDogZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGUpCiAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGVfZXZlbnQ7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICAgIH0gICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBtb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHNlbGVjdGVkSXRlbSkgewogICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWQgPSBzZWxlY3RlZEl0ZW07CiAgICAgICAgfSwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGxvZ0RlYnVnKCdNb2RhbCBkaXNtaXNzZWQgYXQ6ICcgKyBuZXcgRGF0ZSgpKTsKICAgICAgICB9KTsKICAgIH07CgogICAgLy8vCiAgICAkc2NvcGUudXBkYXRlRXZlbnREYXRhYmFzZSA9IGZ1bmN0aW9uKHN0YXJ0X3BhcmFtLCBlbmRfcGFyYW0sIGV2ZW50X2lkLCB0aGVldmVudCkKICAgIHsKCiAgICAgICAgbG9nRGVidWcoInVwZGF0ZUV2ZW50RGF0YWJhc2Ugc3RhcnQ9IiArIHN0YXJ0X3BhcmFtICsgIiwgZW5kPSIgKyBlbmRfcGFyYW0gKyAiLCBldmVudF9pZD0iICsgZXZlbnRfaWQpOwogICAgICAgIHRoZXVybCA9ICcvYXBpL2FkbWluL2V2ZW50cy9zZXQvJyArIGV2ZW50X2lkOwoKICAgICAgICAkaHR0cCh7CiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLAogICAgICAgICAgICB1cmw6IHRoZXVybCwKICAgICAgICAgICAgZGF0YTogewogICAgICAgICAgICAgICAgc3RhcnRfZGF0ZTogc3RhcnRfcGFyYW0sCiAgICAgICAgICAgICAgICBlbmRfZGF0ZTogZW5kX3BhcmFtLAogICAgICAgICAgICAgICAgZXZlbnRfaWQ6IGV2ZW50X2lkCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbjtjaGFyc2V0PXV0Zi04JwogICAgICAgICAgICB9CiAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7CgogICAgICAgICAgICBsb2dEZWJ1ZyhkYXRhKTsKICAgICAgICAgICAgaWYgKGRhdGEuRXJyb3IpIHsKICAgICAgICAgICAgICAgIGxvZ0RlYnVnKCJlcnJvciAiICsgZGF0YS5NZXNzYWdlKTsKICAgICAgICAgICAgICAgIGFsZXJ0KCdlcnJvcicpOwogICAgICAgICAgICAgICAgY2FsZW5kYXIgPSAiY2FsZW5kYXJfYnVzaW5lc3MiOwogICAgICAgICAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbG9nRGVidWcoInN1Y2Nlc3MiKTsKICAgICAgICAgICAgICAgIGNhbGVuZGFyID0gImNhbGVuZGFyX2J1c2luZXNzIjsKICAgICAgICAgICAgICAgIC8vIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKICAgICAgICAgICAgICAgIC8vICR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoJ2FkZGVkIGFuZCByZWZldGNoRXZlbnRzJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICB9OwogICAgLy8vCgogICAgJHNjb3BlLmNsYXNzRXZlbnRBZGRVc2VyID0gZnVuY3Rpb24oZXN1Z2dlc3QpCiAgICB7CiAgICAgIGNvbnNvbGUubG9nKCJjbGFzc0V2ZW50QWRkVXNlciBvciBSZW1vdmUiKTsKICAgICAgaWYgKChlc3VnZ2VzdC5pc19yZWdpc3RlcmVkPT0xKSB8ICgoZXN1Z2dlc3QuaXNfd2FpdGluZ2xpc3Q9PTEpICYmIChlc3VnZ2VzdC5pc19jYW5jZWxlZD09MCkpKQogICAgICB7CiAgICAgICAgY29uc29sZS5sb2coIm5lZWQgdG8gdW5yZWdpc3RlciIpOwogICAgICAgIHJlbW92ZUVuZFVzZXJGcm9tRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyX2lkLGVzdWdnZXN0LmV2ZW50X2lkLHJlbW92ZUVuZFVzZXJGcm9tRXZlbnRfY2FsbGJhY2ssIHJlbW92ZUVuZFVzZXJGcm9tRXZlbnRfY2FsbGJhY2spOwogICAgICAgIGZ1bmN0aW9uIHJlbW92ZUVuZFVzZXJGcm9tRXZlbnRfY2FsbGJhY2soKQogICAgICAgIHsKICAgICAgICAgICRzY29wZS5ldmVudFR5cGVTZWxlY3RlZCgpOwogICAgICAgICAgY2FsZW5kYXIgPSAiY2FsZW5kYXJfYnVzaW5lc3MiOwogICAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwoKICAgICAgICB9CiAgICAgIH0KICAgICAgZWxzZQogICAgICB7CiAgICAgICAgLy8gY29uc29sZS5sb2coZXN1Z2dlc3QuZXZlbnRfaWQpOwogICAgICAgIC8vIGNvbnNvbGUubG9nKCRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyX2lkKTsKICAgICAgICAvLyBpZiBzZWxlY3RlZCB1c2VyIC0gYWRkaW5nIGhpbS9oZXIgdG8gY2xhc3MKICAgICAgICBpZiAoJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXIpCiAgICAgICAgewogICAgICAgICAgYWRkRW5kVXNlclRvRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyX2lkLGVzdWdnZXN0LmV2ZW50X2lkLGFkZEVuZFVzZXJUb0V2ZW50X2NhbGxiYWNrLCBhZGRFbmRVc2VyVG9FdmVudF9jYWxsYmFjayk7CiAgICAgICAgICBmdW5jdGlvbiBhZGRFbmRVc2VyVG9FdmVudF9jYWxsYmFjaygpCiAgICAgICAgICB7CiAgICAgICAgICAgIGNhbGVuZGFyID0gImNhbGVuZGFyX2J1c2luZXNzIjsKICAgICAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwogICAgICAgICAgICAkc2NvcGUuZXZlbnRUeXBlU2VsZWN0ZWQoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZSAvLyBlbHNlIC0gZ29pbmcgdG8gY2xhc3MgcGFnZQogICAgICAgIHsKICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmPScvIy9ldmVudF9jbGFzcy8nICsgZXN1Z2dlc3QuZXZlbnRfaWQ7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAkc2NvcGUuY2FsZW5kYXJfYnVzaW5lc3NfY29uZmlnID0gewogICAgICAgIGNhbGVuZGFyOiB7CiAgICAgICAgICAgIGhlaWdodDogJ2F1dG8nLAogICAgICAgICAgICBlZGl0YWJsZTogdHJ1ZSwKICAgICAgICAgICAgLy8gaGVhZGVyOiB7CiAgICAgICAgICAgIC8vICAgICBsZWZ0OiAnJywKICAgICAgICAgICAgLy8gICAgIGNlbnRlcjogJycsCiAgICAgICAgICAgIC8vICAgICByaWdodDogJycKICAgICAgICAgICAgLy8gfSwKICAgICAgICAgICAgLy8gaGVhZGVyOiB7CiAgICAgICAgICAgIC8vICAgICBsZWZ0OiAndGl0bGUnLAogICAgICAgICAgICAvLyAgICAgY2VudGVyOiAnJywKICAgICAgICAgICAgLy8gICAgIHJpZ2h0OiAndG9kYXkgcHJldixuZXh0JwogICAgICAgICAgICAvLyB9LAogICAgICAgICAgICB0aXRsZUZvcm1hdDogewogICAgICAgICAgICAgICAgLy8gd2VlazogICJkIFtNTU1deyAnJiM4MjExOycgZCBNTU19IgogICAgICAgICAgICB9LAogICAgICAgICAgICAvLyB0aXRsZUZvcm1hdDogewogICAgICAgICAgICAvLyAgICAgbW9udGg6ICdNTU1NIHl5eXknLAogICAgICAgICAgICAvLyAgICAgd2VlazogIk1NTSBkWyB5eXl5XXsgJyYjODIxMjsnWyBNTU1dIGQgeXl5eX0iLAogICAgICAgICAgICAvLyAgICAgZGF5OiAnTU0vZGQnCiAgICAgICAgICAgIC8vIH0sCiAgICAgICAgICAgIGhlYWRlcjogJycsCiAgICAgICAgICAgIC8vIGRlZmF1bHRWaWV3OiAnYWdlbmRhV2VlaycsCiAgICAgICAgICAgIC8vIHZpZXdzOiB7CiAgICAgICAgICAgIC8vICAgICBkb250U2hvd0RhdGU6IHsKICAgICAgICAgICAgLy8gICAgICAgICB0eXBlOiAnYWdlbmRhV2VlaycsCiAgICAgICAgICAgIC8vICAgICAgICAgZHVyYXRpb246IHsKICAgICAgICAgICAgLy8gICAgICAgICAgICAgZGF5czogNwogICAgICAgICAgICAvLyAgICAgICAgIH0sCiAgICAgICAgICAgIC8vICAgICAgICAgdGl0bGU6ICdBcGVydHVyYScsCiAgICAgICAgICAgIC8vICAgICAgICAgY29sdW1uRm9ybWF0OiAnZGRkZCcgLy8gRm9ybWF0IHRoZSBkYXkgdG8gb25seSBzaG93IGxpa2UgJ01vbmRheScKICAgICAgICAgICAgLy8gICAgICAgICAgICAgLy8gaGlkZGVuRGF5czogWzAsIDZdIC8vIEhpZGUgU3VuZGF5IGFuZCBTYXR1cmRheT8KICAgICAgICAgICAgLy8gICAgIH0KICAgICAgICAgICAgLy8gfSwKICAgICAgICAgICAgLy8gc2xvdER1cmF0aW9uOiAnMDA6MTU6MDAnLAogICAgICAgICAgICBldmVudERyb3A6IGZ1bmN0aW9uKGV2ZW50LCBkYXlEZWx0YSwgbWludXRlRGVsdGEsIGFsbERheSwgcmV2ZXJ0RnVuYywgdWlDYWxlbmRhckNvbmZpZykgewogICAgICAgICAgICAgICAgbG9nRGVidWcoImV2ZW50IGRyb3AiICsgZXZlbnQudGl0bGUgKyAiKCIgKyBldmVudC5pZCArICIpIG1vdmVkICIgKyBtaW51dGVEZWx0YSArICIgbWludXRlcyIpOwogICAgICAgICAgICAgICAgbG9nRGVidWcoIm9sZCBzdGFydD0iICsgZXZlbnQuc3RhcnQgKyAiLCBvbGQgZW5kPSIgKyBldmVudC5lbmQpOwogICAgICAgICAgICAgICAgJHNjb3BlLnVwZGF0ZUV2ZW50RGF0YWJhc2UoZXZlbnQuc3RhcnQsIGV2ZW50LmVuZCwgZXZlbnQuaWQsIGV2ZW50KTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZXZlbnRSZXNpemU6IGZ1bmN0aW9uKGV2ZW50LCBkZWx0YSwgcmV2ZXJ0RnVuYykgewogICAgICAgICAgICAgIGxvZ0RlYnVnKCJldmVudCByZXNpemUiICsgZXZlbnQudGl0bGUgKyAiKCIgKyBldmVudC5pZCArICIpIG1vdmVkICIpOwogICAgICAgICAgICAgIGxvZ0RlYnVnKCJvbGQgc3RhcnQ9IiArIGV2ZW50LnN0YXJ0ICsgIiwgb2xkIGVuZD0iICsgZXZlbnQuZW5kKTsKICAgICAgICAgICAgICAkc2NvcGUudXBkYXRlRXZlbnREYXRhYmFzZShldmVudC5zdGFydCwgZXZlbnQuZW5kLCBldmVudC5pZCwgZXZlbnQpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBkZWZhdWx0VmlldzogJ2FnZW5kYVdlZWsnLAogICAgICAgICAgICBldmVudFN0YXJ0RWRpdGFibGU6ZmFsc2UsCiAgICAgICAgICAgIGV2ZW50RHVyYXRpb25FZGl0YWJsZTpmYWxzZSwKICAgICAgICAgICAgZGVmYXVsdERhdGU6IG1vbWVudChjdXJyRGVmYXVsdERhdGUpLAoKICAgICAgICAgICAgLy8gZGVmYXVsdFZpZXc6ICdkb250U2hvd0RhdGUnLAogICAgICAgICAgICBldmVudENsaWNrOiBmdW5jdGlvbihjYWxFdmVudCwganNFdmVudCwgdmlldykgewogICAgICAgICAgICAgICAgbG9nRGVidWcoImNhbGVuZGFyIGV2ZW50IGNsaWNrZWQgIiArIGNhbEV2ZW50LnRpdGxlICsgIigiICsgY2FsRXZlbnQuaWQgKyAiKSAiICsgY2FsRXZlbnQuc3RhcnQgKyAiICIgKyBjYWxFdmVudC5lbmQpOwogICAgICAgICAgICAgICAgLy8gbG9nRGVidWcoSlNPTi5zdHJpbmdpZnkoY2FsRXZlbnQpKTsKICAgICAgICAgICAgICAgIC8vIGlmIGl0J3MgYSBnZW5lcmljIGV2ZW50ICh2YWNhdGlvbiBldGMpCiAgICAgICAgICAgICAgICAvLyBzaG93IHBvcHVwIHdpdGggb3B0aW9uIHRvIGRlbGV0ZQogICAgICAgICAgICAgICAgaWYgKGNhbEV2ZW50LmlzX2dlbmVyaWNfZXR5cGU9PTEpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIC8vICRzY29wZS5zaG93R2VuZXJpY0V2ZW50KGNhbEV2ZW50KTsKICAgICAgICAgICAgICAgICAgJHNjb3BlLnNob3dFdmVudFBvcHVwKGNhbEV2ZW50KTsKCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICRzY29wZS5zaG93RXZlbnRQb3B1cChjYWxFdmVudCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBjaGFuZ2UgdGhlIGJvcmRlciBjb2xvciBqdXN0IGZvciBmdW4KICAgICAgICAgICAgICAgIC8vICQodGhpcykuY3NzKCdib3JkZXItY29sb3InLCAncmVkJyk7CgogICAgICAgICAgICB9LAogICAgICAgICAgICBkYXlDbGljazogZnVuY3Rpb24oZGF0ZSwganNFdmVudCwgdmlldykgewogICAgICAgICAgICAgICAgLy8gbG9nRGVidWcoIm5ldyBldmVudCBjcmVhdGlvbiBjbGlja2VkICIgKyBjYWxFdmVudC50aXRsZSArICIoIiArIGNhbEV2ZW50LmlkICsgIikgIiArIGNhbEV2ZW50LnN0YXJ0ICsgIiAiICsgY2FsRXZlbnQuZW5kKTsKICAgICAgICAgICAgICAgIC8vICAgICBzdGFydCA9IGRhdGU7CiAgICAgICAgICAgICAgICAvLyAgICAgZW5kID0gbW9tZW50KHN0YXJ0KS5hZGQoNDUsICdtaW51dGVzJyk7CiAgICAgICAgICAgICAgICBpZiAodmlldy5uYW1lID09PSAibW9udGgiKSB7CiAgICAgICAgICAgICAgICAgICAgY2FsZW5kYXIgPSAiY2FsZW5kYXJfYnVzaW5lc3MiOwogICAgICAgICAgICAgICAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2NoYW5nZVZpZXcnLCAiYWdlbmRhV2VlayIpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZXZlbnRDcmVhdGVNb2RhbChkYXRlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vIGNoYW5nZSB0aGUgYm9yZGVyIGNvbG9yIGp1c3QgZm9yIGZ1bgogICAgICAgICAgICAgICAgLy8gJCh0aGlzKS5jc3MoJ2JvcmRlci1jb2xvcicsICdyZWQnKTsKCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGV2ZW50UmVuZGVyOiBmdW5jdGlvbihldmVudCwgZWxlbWVudCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaWYgKCFldmVudC5ldmVudF9pZD4wKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAvLyBub3QgYSByZWFsIGV2ZW50IC0gcHJvYmFibHkgYmxvY2sgLyBiYWNrZ3JvdW5kCiAgICAgICAgICAgICAgICAgIC8vIGlnbm9yaW5nIGl0CiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vIGNoYW5naW5nIGxvb2sgYW5kIGZlZWwgb2YgZXZlbiB0aGF0IGlzIHRvIHJlc2NoZWR1bGUKICAgICAgICAgICAgICAgIGlmIChzaGFyZWRQcm9wZXJ0aWVzLmdldF9ldmVudF9yZXNjaGVkdWxlKCkhPW51bGwpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIGlmIChldmVudC5ldmVudF9pZD09c2hhcmVkUHJvcGVydGllcy5nZXRfZXZlbnRfcmVzY2hlZHVsZSgpLmV2ZW50X2lkKQogICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5jc3MoJ2JhY2tncm91bmQtY29sb3InLCAnI0E5QTlBOQknKTsKICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmNzcygnYm9yZGVyLWNvbG9yJywgJyNBOUE5QTkJJyk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoZXZlbnQuaXNfY2xhc3M9PTEpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIC8vIGlmIGNsYXNzIGFkZGluZyBudW1iZXIgb2YgcGFydGljaXBhbnRzCiAgICAgICAgICAgICAgICAgIGlmIChldmVudC5ub19vZl93YWl0aW5nX3VzZXJzPjApCiAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmZpbmQoJy5mYy10aXRsZScpLnByZXBlbmQoZXZlbnQubm9fb2ZfdXNlcnMrIi8iK2V2ZW50Lm1heF9wYXJ0aWNpcGFudHMrICIgKCIrZXZlbnQubm9fb2Zfd2FpdGluZ191c2VycysiKSIrIiAtICIpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZChldmVudC5ub19vZl91c2VycysiLyIrZXZlbnQubWF4X3BhcnRpY2lwYW50cysiIC0gIik7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgLy8gaWYgbm90IGNsYXNzIC0gd3JpdGluZyB0aGUgZW5kdXNlciBuYW1lCiAgICAgICAgICAgICAgICAgIGlmIChldmVudC5kdXJhdGlvbl9ldmVudCE9MCkgLy8gYWxzbyBpZiBub3QgaG91cnMgb2Ygd29yawogICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgLy8gZWxlbWVudC5maW5kKCcuZmMtdGl0bGUnKS5hcHBlbmQoIiAoIitldmVudC5ldmVudFVzZXJzWzBdLmJ1c2VyX2ZpcnN0X25hbWUrIiAiK2V2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfbGFzdF9uYW1lKyIpIik7CiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coZXZlbnQuZXZlbnRVc2Vycyk7CiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coZXZlbnQuZXZlbnRVc2Vycy5sZW5ndGgpOwogICAgICAgICAgICAgICAgICAgIGlmIChldmVudC5ldmVudFVzZXJzLmxlbmd0aD4wKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZCgiIitldmVudC5ldmVudFVzZXJzWzBdLmJ1c2VyX2ZpcnN0X25hbWUrIiAiK2V2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfbGFzdF9uYW1lKyIgKCIpOwogICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5maW5kKCcuZmMtdGl0bGUnKS5hcHBlbmQoIikiKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgLy8gbG9nRGVidWcoImhlcmU0Iik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoZXZlbnQuaXNfcmVwZWF0aW5nID09IDEpIHsKICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmZpbmQoIi5mYy10aXRsZSIpLmFwcGVuZCgiJm5ic3A7PGkgY2xhc3M9J2ZhIGZhLXJlcGVhdCc+PC9pPiZuYnNwOyIpOwogICAgICAgICAgICAgICAgICAgIC8vICBlbGVtZW50LmZpbmQoIi5mYy10aXRsZSIpLmFwcGVuZCgiJm5ic3A7PGltZyBzcmM9Jy9wdWJsaWMvaW1hZ2VzL3JlY3VycmluZy1pY29uLnBuZycgd2lkdGg9JzEwcHgnIGhlaWdodD0nMTBweCcvPiIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBtaW5UaW1lOiAkZ0NhbGVuZGFyRGlzcGxheU1pblRpbWUsCiAgICAgICAgICAgIG1heFRpbWU6ICRnQ2FsZW5kYXJEaXNwbGF5TWF4VGltZSwKICAgICAgICAgICAgc2VsZWN0YWJsZTogZmFsc2UsCiAgICAgICAgICAgIHNlbGVjdEhlbHBlcjogZmFsc2UsCiAgICAgICAgICAgIHRpbWV6b25lOiBmYWxzZSwKICAgICAgICAgICAgaXNSVEw6IHRydWUsCiAgICAgICAgICAgIGxhbmc6ICJoZSIsIC8vIGtrCiAgICAgICAgICAgIGFsbERheVNsb3Q6IGZhbHNlLAogICAgICAgICAgICBsb2FkaW5nOiBmdW5jdGlvbihib29sKSB7CiAgICAgICAgICAgICAgICBpZiAoYm9vbCkgewogICAgICAgICAgICAgICAgICAgIGxvZ0RlYnVnKCdsb2FkaW5nIGNhbGVuZGFyICcgKyAkc2NvcGUuY2FsZW5kYXIpOwogICAgICAgICAgICAgICAgICAgIC8vICQoJyNsb2FkaW5nJykuc2hvdygpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvLyAkKCcjbG9hZGluZycpLmhpZGUoKTsKICAgICAgICAgICAgICAgICAgICBsb2dEZWJ1ZygnZmluaXNoZWQgbG9hZGluZyBjYWxlbmRhciB4JyArICRzY29wZS5jYWxlbmRhcik7CiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnVwZGF0ZUNhbGVuZGFyQ2VudGVyVGl0bGUoKTsKICAgICAgICAgICAgICAgICAgICBsb2dEZWJ1ZygiYWZ0ZXIgY2FsZW5kYXIgbG9hZCB2aXNpYmxlRGF0ZVN0YXJ0PSIrdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5zdGFydCk7CiAgICAgICAgICAgICAgICAgICAgdmlzaWJsZURhdGVTdGFydCA9IG5ldyBEYXRlKHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3Jykuc3RhcnQpOwogICAgICAgICAgICAgICAgICAgIGRhdGVUb0dvVG8gPSB2aXNpYmxlRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCkgKyAiLSIgKyAoJzAnICsgKHZpc2libGVEYXRlU3RhcnQuZ2V0TW9udGgoKSArIDEpKS5zbGljZSgtMikgKyAiLSIgKyAoJzAnICsgdmlzaWJsZURhdGVTdGFydC5nZXREYXRlKCkpLnNsaWNlKC0yKTsKICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygiZGF0ZVRvR29UbyIrZGF0ZVRvR29Ubyk7CiAgICAgICAgICAgICAgICAgICAgLy8gJGh0dHAuZ2V0KCRnQXBpVVJMUHJlZml4ICsgIi9lbmR1c2VyL2V2ZW50cy9zdWdnZXN0LyIrdmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpKyIvIit0aGlzX3dlZWtfZnVsbF95ZWFyKyIvIit0aGlzX3dlZWtfbW9udGgrIi8iK3RoaXNfd2Vla19kYXlfb2ZfbW9udGgrIi8iKyB0aGlzX3dlZWtfaG91cnMrICIvIiArIHRoaXNfd2Vla19taW51dGVzKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKQogICAgICAgICAgICAgICAgICAgICRzY29wZS5ldmVudF90eXBlX2lkPSRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkOwogICAgICAgICAgICAgICAgICAgICRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0PXZpc2libGVEYXRlU3RhcnQ7CiAgICAgICAgICAgICAgICAgICAgLy8xMjEyMTIKICAgICAgICAgICAgICAgICAgICAvLyBpZiAoJHNjb3BlLnNlbGVjdGVkX2V2ZW50X3R5cGVfaWRfaXNfY2xhc3MpCiAgICAgICAgICAgICAgICAgICAgLy8gewogICAgICAgICAgICAgICAgICAgIC8vICAgJGh0dHAuZ2V0KCRnQXBpVVJMUHJlZml4ICsgIi9lbmR1c2VyL2V2ZW50cy9zdWdnZXN0Y2xhc3MvIiskc2NvcGUuZXZlbnRfdHlwZV9pZCsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSsiLyIrKCRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkrMSkrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0SG91cnMoKSArICIvIiArICRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKSsgIi8iICsgJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJfaWQpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpCiAgICAgICAgICAgICAgICAgICAgLy8gICB7CiAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgLy8JICAgICRzY29wZS5teURhdGEgPSByZXNwb25zZS5kYXRhOwogICAgICAgICAgICAgICAgICAgIC8vICAgICAgIC8vCQlsb2dEZWJ1ZygiZ3JpZG9wdGlvbnM9Iiskc2NvcGUuZ3JpZE9wdGlvbnMpOwogICAgICAgICAgICAgICAgICAgIC8vICAgICAgICRzY29wZS5ldmVudHNTdWdnZXN0ZWQgPSByZXNwb25zZS5kYXRhOwogICAgICAgICAgICAgICAgICAgIC8vICAgICAgIC8vICRzY29wZS5kYXRlVG9Hb1RvPWRhdGVUb0dvVG87CiAgICAgICAgICAgICAgICAgICAgLy8gICB9KTsKICAgICAgICAgICAgICAgICAgICAvLyB9CiAgICAgICAgICAgICAgICAgICAgLy8gZWxzZQogICAgICAgICAgICAgICAgICAgIC8vIHsKICAgICAgICAgICAgICAgICAgICAvLyAgICRodHRwLmdldCgkZ0FwaVVSTFByZWZpeCArICIvZW5kdXNlci9ldmVudHMvc3VnZ2VzdC8iKyRzY29wZS5ldmVudF90eXBlX2lkKyIvIiskc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpKyIvIisoJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0TW9udGgoKSsxKSsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0RGF0ZSgpKyIvIiskc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXRIb3VycygpICsgIi8iICsgJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0TWludXRlcygpKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKQogICAgICAgICAgICAgICAgICAgIC8vICAgewogICAgICAgICAgICAgICAgICAgIC8vICAgICAgIC8vCSAgICAkc2NvcGUubXlEYXRhID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAvLwkJbG9nRGVidWcoImdyaWRvcHRpb25zPSIrJHNjb3BlLmdyaWRPcHRpb25zKTsKICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAkc2NvcGUuZXZlbnRzU3VnZ2VzdGVkID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAvLyAkc2NvcGUuZGF0ZVRvR29Ubz1kYXRlVG9Hb1RvOwogICAgICAgICAgICAgICAgICAgIC8vICAgfSk7CiAgICAgICAgICAgICAgICAgICAgLy8gfQoKICAgICAgICAgICAgICAgICAgICAvLyBhZnRlciBjYWxlbmRhciBpcyBsb2FkZWQgLSBsb2FkaW5nIGV2ZW50IHR5cGVzIGFuZCBzdWdnZXN0aW9uIGZvciBxdWV1ZXMKICAgICAgICAgICAgICAgICAgICAvLyB3ZSBoYW5kbGUgdGhpbmdzIHJlbGF0ZWQgdG8gdGhlIGV2ZW50IHR5cGVzIG9ubHkgYWZ0ZXIgbG9hZGluZyB0aGVtIChhbmQgdGhlIGNhbGVuZGFyKQogICAgICAgICAgICAgICAgICAgIGdldEFsbEJ1c2luZXNzRXZlbnRUeXBlc05vU3lzdGVtKCRodHRwLCRzY29wZSwnZXZlbnRfdHlwZXMnLGdldEFsbEJ1c2luZXNzRXZlbnRUeXBlc05vU3lzdGVtX2NhbGxiYWNrKTsKCiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzTm9TeXN0ZW1fY2FsbGJhY2soKQogICAgICAgICAgICAgICAgICAgIHsgICAgLy8gY2hlY2tpbmcgaWYgY2FsZW5kYXIgc2hvdWxkIHN0YXJ0IHdpdGggYSBzcGVjaWZpYyBldmVudCB0eXBlIGZvciBzdWdnZXN0aW9ucwogICAgICAgICAgICAgICAgICAgICAgICAvLyBsb2dEZWJ1ZygiWCBzaGFyZWRQcm9wZXJ0aWVzLmdldF9ldmVudF90eXBlX2Zvcl9zdWdnZXN0aW9ucz0iK3NoYXJlZFByb3BlcnRpZXMuZ2V0X2V2ZW50X3R5cGVfZm9yX3N1Z2dlc3Rpb25zKCkpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2hhcmVkUHJvcGVydGllcy5nZXRfZXZlbnRfdHlwZV9mb3Jfc3VnZ2VzdGlvbnMoKSE9bnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkPXNoYXJlZFByb3BlcnRpZXMuZ2V0X2V2ZW50X3R5cGVfZm9yX3N1Z2dlc3Rpb25zKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmV2ZW50VHlwZVNlbGVjdGVkKCRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gZmlyc3QgY2hlY2tpbmcgaWYgdGhlcmUncyBhbiBldmVudCB0byByZXNjaGVkdWxlCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzaGFyZWRQcm9wZXJ0aWVzLmdldF9ldmVudF9yZXNjaGVkdWxlKCkhPW51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUucHJldmlvdXNfZXZlbnRfcmVzY2hlZHVsZT10cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5wcmV2aW91c19ldmVudF9yZXNjaGVkdWxlX2V2ZW50PXNoYXJlZFByb3BlcnRpZXMuZ2V0X2V2ZW50X3Jlc2NoZWR1bGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICBzaGFyZWRQcm9wZXJ0aWVzLnNldF9ldmVudF9yZXNjaGVkdWxlKG51bGwpOwogICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ0RlYnVnKCJnb3QgZXZlbnQgdG8gcmVzY2hlZHVsZSAiK0pTT04uc3RyaW5naWZ5KCRzY29wZS5wcmV2aW91c19ldmVudF9yZXNjaGVkdWxlX2V2ZW50KSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nRGVidWcoInJlc2NoZWR1bGUgZXZlbnRfdHlwZV9pZD0iKyRzY29wZS5wcmV2aW91c19ldmVudF9yZXNjaGVkdWxlX2V2ZW50LmV2ZW50X3R5cGVfaWQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkPSRzY29wZS5wcmV2aW91c19ldmVudF9yZXNjaGVkdWxlX2V2ZW50LmV2ZW50X3R5cGVfaWQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmV2ZW50VHlwZVNlbGVjdGVkKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gY2hlY2tpbmcgc2VsZWN0ZWQgdXNlciBvbmx5IGlmIHRoZXJlJ3Mgbm8gc2VsZWN0ZWQgZXZlbnQgdG8gbW92ZQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkhPW51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiZ290IHByZXZpb3VzIHNlbGVjdGVkIHVzZXIgIitzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfZmlyc3RfbmFtZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJuYW1lPXNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKS5idXNlcl9maXJzdF9uYW1lKyIgIitzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfbGFzdF9uYW1lOwogICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyX2lkPXNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKS5idXNpbmVzc191c2VyX2lkOwogICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ0RlYnVnKCIkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcl9pZD0iKyRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyX2lkKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXI9dHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIC8vIHNlbGVjdDogZnVuY3Rpb24oc3RhcnQsIGVuZCwgYWxsRGF5KSB7CiAgICAgICAgICAgIC8vICAgICAvLyB2YXIgdGl0bGUgPSBwcm9tcHQoJ0V2ZW50IFRpdGxlOicgKyAoc3RhcnQgKyAzNTI4MDAwMDApIC8gKDYwICogMTAwMCkgKyAiICIgKyBlbmQgKyAiICIgKyBhbGxEYXkpOwogICAgICAgICAgICAvLyAgICAgdGl0bGUgPSAi16nXoteV16og16TXoteZ15zXldeqIjsKICAgICAgICAgICAgLy8gICAgIGlmICh0aXRsZSkgewogICAgICAgICAgICAvLyAgICAgICAgIGxvZ0RlYnVnKCJjcmVhdGluZyBkZXZlbnQgc3RhcnQiKTsKICAgICAgICAgICAgLy8gICAgICAgICBsb2dEZWJ1Zygic3RhcnQ9IiArIHN0YXJ0KTsKICAgICAgICAgICAgLy8gICAgICAgICBjaGVja0RhdGUgPSBuZXcgRGF0ZShzdGFydCk7CiAgICAgICAgICAgIC8vICAgICAgICAgbG9nRGVidWcoImNoZWNrIGRhdGUgPSAiICsgY2hlY2tEYXRlKQogICAgICAgICAgICAvLyAgICAgICAgIGxvZ0RlYnVnKCJlbmQ9IiArIGVuZCk7CiAgICAgICAgICAgIC8vICAgICAgICAgZWNvbG9yID0gIiMiICsgJHNjb3BlLmV2ZW50Q29sb3I7IC8vZ2V0UmFuZG9tQ29sb3IoKTsKICAgICAgICAgICAgLy8KICAgICAgICAgICAgLy8KICAgICAgICAgICAgLy8gICAgICAgICAvLyB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tdLmZ1bGxDYWxlbmRhcigncmVyZW5kZXJFdmVudHMnKTsKICAgICAgICAgICAgLy8KICAgICAgICAgICAgLy8gICAgICAgICBjYWxlbmRhciA9ICRzY29wZS5jYWxlbmRhcl9uYW1lOwogICAgICAgICAgICAvLyAgICAgICAgIHRlbXBfbGltaXRfaWQgPSAkZ0NhbGVuZGFyVGVtcEVudklEMSAtIGdldFJhbmRvbUludCgxMCwgODApOwogICAgICAgICAgICAvLyAgICAgICAgIG5ld0V2ZW50ID0gewogICAgICAgICAgICAvLyAgICAgICAgICAgICBpZDogdGVtcF9saW1pdF9pZCwKICAgICAgICAgICAgLy8gICAgICAgICAgICAgdGl0bGU6IHRpdGxlLAogICAgICAgICAgICAvLyAgICAgICAgICAgICBzdGFydDogc3RhcnQsCiAgICAgICAgICAgIC8vICAgICAgICAgICAgIGNvbG9yOiBlY29sb3IsCiAgICAgICAgICAgIC8vICAgICAgICAgICAgIGVuZDogZW5kLAogICAgICAgICAgICAvLyAgICAgICAgICAgICBhbGxEYXk6IGZhbHNlLAogICAgICAgICAgICAvLyAgICAgICAgICAgICBjbGFzc05hbWU6IFsnb3BlblNlc2FtZSddCiAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICAvLyBjb2xvcjogcmVzb3VyY2UuZXZlbnRDb2xvcgogICAgICAgICAgICAvLyAgICAgICAgIH07CiAgICAgICAgICAgIC8vICAgICAgICAgY2FsZW5kYXIgPSAkc2NvcGUuY2FsZW5kYXJfbmFtZTsKICAgICAgICAgICAgLy8KICAgICAgICAgICAgLy8gICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZW5kZXJFdmVudCcsIG5ld0V2ZW50LCB0cnVlKTsKICAgICAgICAgICAgLy8gICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCd1bnNlbGVjdCcpOwogICAgICAgICAgICAvLwogICAgICAgICAgICAvLyAgICAgICAgIGxvZ0RlYnVnKCJjcmVhdGluZyBkZXZlbnQgZW5kIik7CiAgICAgICAgICAgIC8vICAgICAgICAgJHNjb3BlLmFkZEV2ZW50VG9EYXRhYmFzZShzdGFydCwgZW5kLCB0aXRsZSwgZWNvbG9yLCB0ZW1wX2xpbWl0X2lkKTsKICAgICAgICAgICAgLy8KICAgICAgICAgICAgLy8gICAgIH0KICAgICAgICAgICAgLy8gfQogICAgICAgIH0KICAgIH07Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignSG91cnNPZldvcmtDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGNvbXBpbGUsICRsb2NhdGlvbiwgdWlDYWxlbmRhckNvbmZpZywgJHVpYk1vZGFsKSB7CiAgICBsb2dEZWJ1ZygnSG91cnNPZldvcmsgQ29udHJvbGxlcicpOwoKICAgIGxvZ0RlYnVnKCIkbG9jYXRpb24uc2VhcmNoKCkuc3RhcnQ9IiArICRsb2NhdGlvbi5zZWFyY2goKS5zdGFydCk7CiAgICBpZiAodHlwZW9mICRsb2NhdGlvbi5zZWFyY2goKS5zdGFydCA9PSAndW5kZWZpbmVkJykgewogICAgICAgIGN1cnJEZWZhdWx0RGF0ZSA9ICRnSG91cjBkYXRlOwogICAgICAgICRzY29wZS5maXhlZFNjaGVkdWxlID0gdHJ1ZTsKICAgICAgICAkc2NvcGUuY2FsZW5kYXJUaXRsZUNlbnRlciA9ICLXqdei15XXqiDXpNei15nXnNeV16og16fXkdeV16LXldeqIjsKICAgICAgICBsb2dEZWJ1Zygi16nXoteV16og16TXoteZ15zXldeqINen15HXldei15XXqiIpOwogICAgICAgIGhvdXJzT2ZXb3JrRGVmYXVsdFZpZXc9J2RvbnRTaG93RGF0ZSc7CiAgICB9IGVsc2UgewogICAgICAgIGN1cnJEZWZhdWx0RGF0ZSA9ICRsb2NhdGlvbi5zZWFyY2goKS5zdGFydDsKICAgICAgICAkc2NvcGUuZml4ZWRTY2hlZHVsZSA9IGZhbHNlOwogICAgICAgIC8vICRzY29wZS5jYWxlbmRhclRpdGxlQ2VudGVyID0gItep16LXldeqINek16LXmdec15XXqiDXp9eR15XXoteV16oiOwogICAgICAgIGhvdXJzT2ZXb3JrRGVmYXVsdFZpZXc9J2FnZW5kYVdlZWsnOwogICAgfQoKCiAgICAkc2NvcGUudmlzaWJsZURhdGUgPSBbXTsKICAgICRzY29wZS5jYWxlbmRhciA9ICdjYWxlbmRhcl9ob3Vyc19vZl93b3JrJzsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50VHlwZSA9IFtdOwoKICAgIGdldEFsbEJ1c2luZXNzRXZlbnRUeXBlcygkaHR0cCwkc2NvcGUsJ2V2ZW50X3R5cGVzJyxnZXRBbGxCdXNpbmVzc0V2ZW50VHlwZXNfY2FsbGJhY2spOwoKICAgIGZ1bmN0aW9uIGdldEFsbEJ1c2luZXNzRXZlbnRUeXBlc19jYWxsYmFjaygpCiAgICB7CiAgICAgICRzY29wZS5zZWxlY3RFdmVudFR5cGUoJHNjb3BlLmV2ZW50X3R5cGVzWzBdKTsKICAgIH0KICAgICRzY29wZS5iYWNrVG9DYWxlbmRhciA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZpc2libGVEYXRlU3RhcnQgPSBuZXcgRGF0ZSh1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ2V0VmlldycpLnN0YXJ0KTsKICAgICAgICBkYXRlVG9Hb1RvID0gdmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpICsgIi0iICsgKCcwJyArICh2aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkgKyAxKSkuc2xpY2UoLTIpICsgIi0iICsgKCcwJyArIHZpc2libGVEYXRlU3RhcnQuZ2V0RGF0ZSgpKS5zbGljZSgtMik7CiAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jYWxlbmRhcicpLnNlYXJjaCh7CiAgICAgICAgICAgIHN0YXJ0OiBkYXRlVG9Hb1RvCiAgICAgICAgfSk7CiAgICB9CiAgICAkc2NvcGUuc2VsZWN0RXZlbnRUeXBlID0gZnVuY3Rpb24oZXZlbnRUeXBlKSB7CiAgICAgICAgJHNjb3BlLnNlbGVjdGVkRXZlbnRUeXBlID0gZXZlbnRUeXBlOwogICAgICAgIGxvZ0RlYnVnKCJzZWxlY3RlZCBFdmVudCBUeXBlID0gIiArICRzY29wZS5zZWxlY3RlZEV2ZW50VHlwZS5ldmVudF90eXBlX2lkICsgIiwgIiArICRzY29wZS5zZWxlY3RlZEV2ZW50VHlwZS5ldmVudF90eXBlX25hbWUpOwogICAgICAgIGt1emVJc0NhbGVuZGFyRHJhZ2dibGUgPSAkc2NvcGUuc2VsZWN0ZWRFdmVudFR5cGUuZGlmZl9yYW5nZTsKICAgIH07CgogICAgJHNjb3BlLmNoYW5nZUV2ZW50Q29sb3IgPSBmdW5jdGlvbihuZXdDb2xvcikgewogICAgICAgICRzY29wZS5ldmVudENvbG9yID0gbmV3Q29sb3I7CiAgICAgICAgYWxsbEV2ZW50c0FycmF5ID0gdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignY2xpZW50RXZlbnRzJyk7CiAgICAgICAgZm9yIChpIGluIGFsbGxFdmVudHNBcnJheSkgewogICAgICAgICAgICBhbGxsRXZlbnRzQXJyYXlbaV0uY29sb3IgPSAiIyIgKyBuZXdDb2xvcjsKICAgICAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigndXBkYXRlRXZlbnQnLCBhbGxsRXZlbnRzQXJyYXlbaV0pOwogICAgICAgIH0KICAgIH07CgogICAgJHNjb3BlLmV2ZW50Q2xpY2tNb2R1bGUgPSBmdW5jdGlvbihzZWxlY3RlZEV2ZW50LCBzaXplKSB7CiAgICAgICAgbG9nRGVidWcoInNlbGVjdGVkIEV2ZW50IHRpdGxlPSIgKyBzZWxlY3RlZEV2ZW50LnRpdGxlKTsKCgogICAgICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewogICAgICAgICAgICBhbmltYXRpb246IGZhbHNlLAogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9saW1pdGF0aW9uX2RldGFpbHMuaHRtbCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdldmVudERldGFpbHNIb3Vyc09mV29ya01vZGFsQ29udHJvbGxlcicsCiAgICAgICAgICAgIHNpemU6IHNpemUsCiAgICAgICAgICAgIHJlc29sdmU6IHsKICAgICAgICAgICAgICAgIHNlbGVjdGVkRXZlbnQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxlY3RlZEV2ZW50OwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGZpeGVkU2NoZWR1bGU6IGZ1bmN0aW9uICgpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuZml4ZWRTY2hlZHVsZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBtb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHNlbGVjdGVkSXRlbSkgewogICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWQgPSBzZWxlY3RlZEl0ZW07CiAgICAgICAgfSwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGxvZ0RlYnVnKCdNb2RhbCBkaXNtaXNzZWQgYXQ6ICcgKyBuZXcgRGF0ZSgpKTsKICAgICAgICB9KTsKICAgIH07CgoKICAgIHZhciBkYXRlID0gbmV3IERhdGUoKTsKICAgIHZhciBkID0gZGF0ZS5nZXREYXRlKCk7CiAgICB2YXIgbSA9IGRhdGUuZ2V0TW9udGgoKTsKICAgIHZhciB5ID0gZGF0ZS5nZXRGdWxsWWVhcigpOwoKCiAgICBmdW5jdGlvbiBnZXRUaW1lU3RhbXAobm93KSB7CiAgICAgICAgcmV0dXJuICgobm93LmdldE1vbnRoKCkgKyAxKSArICcvJyArIChub3cuZ2V0RGF0ZSgpKSArICcvJyArIG5vdy5nZXRGdWxsWWVhcigpICsgIiAiICsgbm93LmdldEhvdXJzKCkgKyAnOicgKyAoKG5vdy5nZXRNaW51dGVzKCkgPCAxMCkgPyAoIjAiICsgbm93LmdldE1pbnV0ZXMoKSkgOiAobm93LmdldE1pbnV0ZXMoKSkpICsgJzonICsgKChub3cuZ2V0U2Vjb25kcygpIDwgMTApID8gKCIwIiArIG5vdwogICAgICAgICAgICAuZ2V0U2Vjb25kcygpKSA6IChub3cuZ2V0U2Vjb25kcygpKSkpOwogICAgfQoKCiAgICAvKiBDaGFuZ2UgVmlldyAqLwogICAgJHNjb3BlLmNoYW5nZVZpZXcgPSBmdW5jdGlvbih2aWV3LCBjYWxlbmRhcikgewogICAgICAgIGxvZ0RlYnVnKCJjaGFuZ2UgdmlldyAiICsgdmlldyk7CiAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignY2hhbmdlVmlldycsIHZpZXcpOwogICAgfTsKICAgIC8qIENoYW5nZSBWaWV3ICovCgogICAgJHNjb3BlLnJlbmRlckNhbGVuZGVyID0gZnVuY3Rpb24oY2FsZW5kYXIpIHsKICAgICAgICAkdGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgaWYgKHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXSkgewogICAgICAgICAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVuZGVyJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH07CgogICAgJHNjb3BlLmNoYW5nZVNlbGVjdGFibGUgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAga3V6ZUlzQ2FsZW5kYXJEcmFnZ2JsZSA9ICFrdXplSXNDYWxlbmRhckRyYWdnYmxlOwogICAgICAgICAgICBjYWxlbmRhciA9ICdjYWxlbmRhcl9ob3Vyc19vZl93b3JrJzsKICAgICAgICAgICAgLy8gdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ2V0VmlldycpLmNhbGVuZGFyLm9wdGlvbnMuc2VsZWN0YWJsZSA9IGZhbHNlOwogICAgICAgICAgICB2aWV3ID0gdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignb3B0aW9uJywgJ3NlbGVjdGFibGUnLCBmYWxzZSk7CiAgICAgICAgICAgIC8vIHZpZXcuY2FsZW5kYXIub3B0aW9ucy5zZWxlY3RhYmxlID0gZmFsc2U7CiAgICAgICAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlbmRlcicpOwoKICAgICAgICB9CiAgICAgICAgLyogY29uZmlnIG9iamVjdCAqLwoKICAgICRzY29wZS5jYWxlbmRhcl9ob3Vyc19vZl93b3JrX2NvbmZpZyA9IHsKICAgICAgICBjYWxlbmRhcjogewogICAgICAgICAgICBoZWlnaHQ6ICdhdXRvJywKICAgICAgICAgICAgZWRpdGFibGU6IHRydWUsCiAgICAgICAgICAgIC8vIGhlYWRlcjogewogICAgICAgICAgICAvLyAgICAgbGVmdDogJycsCiAgICAgICAgICAgIC8vICAgICBjZW50ZXI6ICcnLAogICAgICAgICAgICAvLyAgICAgcmlnaHQ6ICcnCiAgICAgICAgICAgIC8vIH0sCiAgICAgICAgICAgIGhlYWRlcjogJycsCiAgICAgICAgICAgIC8vIGhlYWRlcjogewogICAgICAgICAgICAvLyAgICAgbGVmdDogJ3RpdGxlJywKICAgICAgICAgICAgLy8gICAgIGNlbnRlcjogJycsCiAgICAgICAgICAgIC8vICAgICByaWdodDogJ3RvZGF5IHByZXYsbmV4dCcKICAgICAgICAgICAgLy8gfSwKICAgICAgICAgICAgLy8gZGVmYXVsdFZpZXc6ICdhZ2VuZGFXZWVrJywKICAgICAgICAgICAgdmlld3M6IHsKICAgICAgICAgICAgICAgIGRvbnRTaG93RGF0ZTogewogICAgICAgICAgICAgICAgICAgIHR5cGU6ICdhZ2VuZGFXZWVrJywKICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogewogICAgICAgICAgICAgICAgICAgICAgICBkYXlzOiA3CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ0FwZXJ0dXJhJywKICAgICAgICAgICAgICAgICAgICBjb2x1bW5Gb3JtYXQ6ICdkZGRkJyAvLyBGb3JtYXQgdGhlIGRheSB0byBvbmx5IHNob3cgbGlrZSAnTW9uZGF5JwogICAgICAgICAgICAgICAgICAgICAgICAvLyBoaWRkZW5EYXlzOiBbMCwgNl0gLy8gSGlkZSBTdW5kYXkgYW5kIFNhdHVyZGF5PwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGRvU2hvd0RhdGU6IHsKICAgICAgICAgICAgICAgICAgICB0eXBlOiAnYWdlbmRhV2VlaycsCiAgICAgICAgICAgICAgICAgICAgZHVyYXRpb246IHsKICAgICAgICAgICAgICAgICAgICAgICAgZGF5czogNwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdBcGVydHVyYScsCgogICAgICAgICAgICAgICAgICAgICAgICAvLyBoaWRkZW5EYXlzOiBbMCwgNl0gLy8gSGlkZSBTdW5kYXkgYW5kIFNhdHVyZGF5PwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBldmVudERyb3A6IGZ1bmN0aW9uKGV2ZW50LCBkYXlEZWx0YSwgbWludXRlRGVsdGEsIGFsbERheSwgcmV2ZXJ0RnVuYywgdWlDYWxlbmRhckNvbmZpZykgewogICAgICAgICAgICAgICAgbG9nRGVidWcoImV2ZW50ZHJvcCIgKyBldmVudC50aXRsZSArICIoIiArIGV2ZW50LmlkICsgIikgbW92ZWQgIiArIG1pbnV0ZURlbHRhICsgIiBtaW51dGVzIik7CiAgICAgICAgICAgICAgICBsb2dEZWJ1Zygib2xkIHN0YXJ0PSIgKyBldmVudC5zdGFydCArICIsIG9sZCBlbmQ9IiArIGV2ZW50LmVuZCk7CiAgICAgICAgICAgICAgICAkc2NvcGUudXBkYXRlTGltaXRhdGlvbkRhdGFiYXNlKGV2ZW50LnN0YXJ0LCBldmVudC5lbmQsIGV2ZW50LmlkLCBldmVudC50ZW1wX2xpbWl0X2lkLCBldmVudCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGV2ZW50UmVzaXplOiBmdW5jdGlvbihldmVudCwgZGVsdGEsIHJldmVydEZ1bmMpIHsKICAgICAgICAgICAgICAgIGxvZ0RlYnVnKCJldmVudHJlc2l6ZSwgZXZlbnQuZW5kPSIgKyBldmVudC5lbmQpOwogICAgICAgICAgICAgICAgJHNjb3BlLnVwZGF0ZUxpbWl0YXRpb25EYXRhYmFzZShldmVudC5zdGFydCwgZXZlbnQuZW5kLCBldmVudC5pZCwgZXZlbnQudGVtcF9saW1pdF9pZCwgZXZlbnQpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBkZWZhdWx0VmlldzogaG91cnNPZldvcmtEZWZhdWx0VmlldywKICAgICAgICAgICAgZXZlbnRDbGljazogZnVuY3Rpb24oY2FsRXZlbnQsIGpzRXZlbnQsIHZpZXcpIHsKICAgICAgICAgICAgICAgIGxvZ0RlYnVnKCJldmVudCBjbGlja2VkICIgKyBjYWxFdmVudC50aXRsZSArICIoaWQ9IiArIGNhbEV2ZW50LmlkICsgIiwgZGF5X2xpbWl0X2lkPSIgKyBjYWxFdmVudC5kYXlfbGltaXRfaWQgKyAiLCB0ZW1wX2xpbWl0X2lkPSIgKyBjYWxFdmVudC50ZW1wX2xpbWl0X2lkICsgIiwgbGltaXRfaWQ9IiArIGNhbEV2ZW50LmxpbWl0X2lkICsgIikgc3RhcnQ9IiArIGNhbEV2ZW50LnN0YXJ0ICsgIiwgZW5kPSIgKyBjYWxFdmVudC5lbmQpOwogICAgICAgICAgICAgICAgJHNjb3BlLmV2ZW50Q2xpY2tNb2R1bGUoY2FsRXZlbnQpOwogICAgICAgICAgICAgICAgLy8gY2hhbmdlIHRoZSBib3JkZXIgY29sb3IganVzdCBmb3IgZnVuCiAgICAgICAgICAgICAgICAvLyAkKHRoaXMpLmNzcygnYm9yZGVyLWNvbG9yJywgJ3JlZCcpOwoKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZXZlbnRSZW5kZXI6IGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgY29uc29sZS5sb2coZXZlbnQpOwogICAgICAgICAgICAgIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZChldmVudC5sb2NhdGlvbl9uYW1lKyIgLyA8YnIvPiIpOwogICAgICAgICAgICAgIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZChldmVudC5pbnN0cnVjdG9yX25hbWUrIiAvIDxici8+Iik7CiAgICAgICAgICAgICAgLy8gZWxlbWVudC5maW5kKCcuZmMtdGl0bGUnKS5wcmVwZW5kKCIiK2V2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfZmlyc3RfbmFtZSsiICIrZXZlbnQuZXZlbnRVc2Vyc1swXS5idXNlcl9sYXN0X25hbWUrIiAoIik7CgogICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJyZW5kZXIgbGltaXRhdGlvbiAiK0pTT04uc3RyaW5naWZ5KGV2ZW50KSk7CiAgICAgICAgICAgICAgICAvLyBpZiAoZXZlbnQuaXNfY2xhc3M9PTEpCiAgICAgICAgICAgICAgICAvLyB7CiAgICAgICAgICAgICAgICAvLyAgIC8vIGlmIGNsYXNzIGFkZGluZyBudW1iZXIgb2YgcGFydGljaXBhbnRzCiAgICAgICAgICAgICAgICAvLyAgIGlmIChldmVudC5ub19vZl93YWl0aW5nX3VzZXJzPjApCiAgICAgICAgICAgICAgICAvLyAgIHsKICAgICAgICAgICAgICAgIC8vICAgICBlbGVtZW50LmZpbmQoJy5mYy10aXRsZScpLnByZXBlbmQoZXZlbnQubm9fb2ZfdXNlcnMrIi8iK2V2ZW50Lm1heF9wYXJ0aWNpcGFudHMrICIgKCIrZXZlbnQubm9fb2Zfd2FpdGluZ191c2VycysiKSIrIiAtICIpOwogICAgICAgICAgICAgICAgLy8gICB9CiAgICAgICAgICAgICAgICAvLyAgIGVsc2UKICAgICAgICAgICAgICAgIC8vICAgewogICAgICAgICAgICAgICAgLy8gICAgIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZChldmVudC5ub19vZl91c2VycysiLyIrZXZlbnQubWF4X3BhcnRpY2lwYW50cysiIC0gIik7CiAgICAgICAgICAgICAgICAvLyAgIH0KICAgICAgICAgICAgICAgIC8vIH0KICAgICAgICAgICAgICAgIC8vIGVsc2UKICAgICAgICAgICAgICAgIC8vIHsKICAgICAgICAgICAgICAgIC8vICAgLy8gaWYgbm90IGNsYXNzIC0gd3JpdGluZyB0aGUgZW5kdXNlciBuYW1lCiAgICAgICAgICAgICAgICAvLyAgIGlmIChldmVudC5kdXJhdGlvbl9ldmVudCE9MCkgLy8gYWxzbyBpZiBub3QgaG91cnMgb2Ygd29yawogICAgICAgICAgICAgICAgLy8gICB7CiAgICAgICAgICAgICAgICAvLyAgICAgLy8gZWxlbWVudC5maW5kKCcuZmMtdGl0bGUnKS5hcHBlbmQoIiAoIitldmVudC5ldmVudFVzZXJzWzBdLmJ1c2VyX2ZpcnN0X25hbWUrIiAiK2V2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfbGFzdF9uYW1lKyIpIik7CiAgICAgICAgICAgICAgICAvLyAgICAgZWxlbWVudC5maW5kKCcuZmMtdGl0bGUnKS5wcmVwZW5kKCIiK2V2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfZmlyc3RfbmFtZSsiICIrZXZlbnQuZXZlbnRVc2Vyc1swXS5idXNlcl9sYXN0X25hbWUrIiAoIik7CiAgICAgICAgICAgICAgICAvLyAgICAgZWxlbWVudC5maW5kKCcuZmMtdGl0bGUnKS5hcHBlbmQoIikiKTsKICAgICAgICAgICAgICAgIC8vICAgfQogICAgICAgICAgICAgICAgLy8gICAvLyBsb2dEZWJ1ZygiaGVyZTQiKTsKICAgICAgICAgICAgICAgIC8vIH0KICAgICAgICAgICAgICAgIC8vIGlmIChldmVudC5pc19yZXBlYXRpbmcgPT0gMSkgewogICAgICAgICAgICAgICAgLy8gICAgIGVsZW1lbnQuZmluZCgiLmZjLXRpdGxlIikucHJlcGVuZCgiJm5ic3A7PGkgY2xhc3M9J2ZhIGZhLXJlcGVhdCc+PC9pPiZuYnNwOyIpOwogICAgICAgICAgICAgICAgLy8gICAgIC8vICBlbGVtZW50LmZpbmQoIi5mYy10aXRsZSIpLmFwcGVuZCgiJm5ic3A7PGltZyBzcmM9Jy9wdWJsaWMvaW1hZ2VzL3JlY3VycmluZy1pY29uLnBuZycgd2lkdGg9JzEwcHgnIGhlaWdodD0nMTBweCcvPiIpOwogICAgICAgICAgICAgICAgLy8gfQogICAgICAgICAgICB9LAogICAgICAgICAgICBtaW5UaW1lOiAkZ0NhbGVuZGFyRGlzcGxheU1pblRpbWUsCiAgICAgICAgICAgIG1heFRpbWU6ICRnQ2FsZW5kYXJEaXNwbGF5TWF4VGltZSwKICAgICAgICAgICAgc2VsZWN0YWJsZTogdHJ1ZSwKICAgICAgICAgICAgc2VsZWN0SGVscGVyOiBmYWxzZSwKICAgICAgICAgICAgdGltZXpvbmU6IGZhbHNlLAogICAgICAgICAgICBpc1JUTDogdHJ1ZSwKICAgICAgICAgICAgbGFuZzogImhlIiwKICAgICAgICAgICAgc2VsZWN0Q29uc3RyYWludDogewogICAgICAgICAgICAgICAgc3RhcnQ6ICcwMDowMScsCiAgICAgICAgICAgICAgICBlbmQ6ICcyMzo1OScsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRlZmF1bHREYXRlOiBtb21lbnQoY3VyckRlZmF1bHREYXRlKSwKICAgICAgICAgICAgYWxsRGF5U2xvdDogZmFsc2UsCiAgICAgICAgICAgIGxvYWRpbmc6IGZ1bmN0aW9uKGJvb2wpIHsKICAgICAgICAgICAgICAgIGlmIChib29sKSB7CiAgICAgICAgICAgICAgICAgICAgbG9nRGVidWcoJ2xvYWRpbmcgY2FsZW5kYXIgJyArICRzY29wZS5jYWxlbmRhcik7CgogICAgICAgICAgICAgICAgICAgIC8vICQoJyNsb2FkaW5nJykuc2hvdygpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvLyAkKCcjbG9hZGluZycpLmhpZGUoKTsKICAgICAgICAgICAgICAgICAgICBsb2dEZWJ1ZygnZmluaXNoZWQgbG9hZGluZyBjYWxlbmRhciAnICsgJHNjb3BlLmNhbGVuZGFyKTsKICAgICAgICAgICAgICAgICAgICBpZiAoISRzY29wZS5maXhlZFNjaGVkdWxlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIC8vICRzY29wZS5iYWNrVG9GaXhlZCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBzZWxlY3Q6IGZ1bmN0aW9uKHN0YXJ0LCBlbmQsIGFsbERheSkgewogICAgICAgICAgICAgIC8vIHRoaXMgaXMgY2FsbGVkIHdoZW4gY3JlYXRpbmcgYSBuZXcgYmxvY2sKICAgICAgICAgICAgICAkc2NvcGUuY3JlYXRlTGltaXRhdGlvbkJsb2NrKHN0YXJ0LCBlbmQpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKCiAgICAvLyBjcmVhdGUgbGltaXRhdGlvbiBibG9jawogICAgJHNjb3BlLmNyZWF0ZUxpbWl0YXRpb25CbG9jayA9IGZ1bmN0aW9uKHN0YXJ0LCBlbmQpCiAgICB7CiAgICAgICAgbG9nRGVidWcoImZ1bmN0aW9uOiBjcmVhdGVMaW1pdGF0aW9uQmxvY2siKTsKICAgICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAgICAgICAgICAgYW5pbWF0aW9uOiBmYWxzZSwKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfbGltaXRhdGlvbl9jcmVhdGUucGhwJywKICAgICAgICAgICAgc2l6ZTogJ3hzJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ2J1c2luZXNzX21vZGFsX2xpbWl0YXRpb25fY3JlYXRlJywKICAgICAgICAgICAgcmVzb2x2ZTogewogICAgICAgICAgICAgIHN0YXJ0OiBmdW5jdGlvbigpCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICByZXR1cm4gc3RhcnQ7CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBlbmQ6IGZ1bmN0aW9uKCkKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBlbmQ7CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBmaXhlZFNjaGVkdWxlOiBmdW5jdGlvbiAoKQogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuZml4ZWRTY2hlZHVsZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0KICAgICRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKTsKCiAgICAgICAgdmlzaWJsZURhdGVTdGFydCA9IG5ldyBEYXRlKHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3Jykuc3RhcnQpOwogICAgICAgIHZpc2libGVEYXRlRW5kID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5lbmQpOwoKICAgICAgICAkc2NvcGUuY2FsZW5kYXJUaXRsZUNlbnRlciA9IHZpc2libGVEYXRlU3RhcnQuZ2V0RGF0ZSgpICsgIiAiICsgbW9udGhOYW1lc1t2aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCldICsKICAgICAgICAgICAgIiDigJQgIiArIHZpc2libGVEYXRlRW5kLmdldERhdGUoKSArICIgIiArIG1vbnRoTmFtZXNbdmlzaWJsZURhdGVFbmQuZ2V0TW9udGgoKV0gKwogICAgICAgICAgICAiICIgKyB2aXNpYmxlRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCk7CiAgICB9OwogICAgLyogZXZlbnQgc291cmNlcyBhcnJheSovCiAgICAkc2NvcGUuZXZlbnRTb3VyY2VzID0gW3sKICAgICAgICB1cmw6ICcvYXBpL2FkbWluL2NhbGVuZGFyL2xpbWl0YXRpb25zL3BlcmRheS9nZXRwb3N0JywKICAgICAgICB0eXBlOiAnUE9TVCcKICAgIH1dOwoKICAgIC8vICRzY29wZS5nZXRFdmVudHMgPSBmdW5jdGlvbigpIHsKICAgIC8vICAgICBjYWxlbmRhciA9ICdjYWxlbmRhcl9ob3Vyc19vZl93b3JrJzsKICAgIC8vICAgICBhbGxsRXZlbnRzQXJyYXkgPSB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdjbGllbnRFdmVudHMnKTsKICAgIC8vICAgICBmb3IgKGkgaW4gYWxsbEV2ZW50c0FycmF5KSB7CiAgICAvLyAgICAgICAgIGxvZ0RlYnVnKGFsbGxFdmVudHNBcnJheVtpXSk7CiAgICAvLyAgICAgfQogICAgLy8KICAgIC8vIH0KCiAgICAkc2NvcGUuZ290b1RvZGF5ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgJHNjb3BlLmdvdG9EYXRlKG5ldyBEYXRlKCkpOwogICAgfQogICAgJHNjb3BlLmdvdG9OZXh0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ25leHQnKTsKICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVtb3ZlRXZlbnRzJyk7CiAgICAgICAgJHNjb3BlLnVwZGF0ZUNhbGVuZGFyQ2VudGVyVGl0bGUoKTsKICAgIH0KICAgICRzY29wZS5nb3RvUHJldiA9IGZ1bmN0aW9uKCkgewogICAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZW1vdmVFdmVudHMnKTsKICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncHJldicpOwogICAgICAgICRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlKCk7CiAgICB9CiAgICAkc2NvcGUuZ290b0RhdGUgPSBmdW5jdGlvbihuZXdkYXRlKSB7CiAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dvdG9EYXRlJywgbmV3ZGF0ZSk7CiAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2NoYW5nZVZpZXcnLCAnYWdlbmRhV2VlaycpOwogICAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZW1vdmVFdmVudHMnKTsKICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwoKICAgICAgICAkc2NvcGUudXBkYXRlQ2FsZW5kYXJDZW50ZXJUaXRsZSgpOwogICAgICAgICRzY29wZS5maXhlZFNjaGVkdWxlID0gZmFsc2U7CiAgICB9CgogICAgJHNjb3BlLmJhY2tUb0ZpeGVkID0gZnVuY3Rpb24oKSB7CiAgICAgICAgJHNjb3BlLmZpeGVkU2NoZWR1bGUgPSB0cnVlOwogICAgICAgICRzY29wZS5jYWxlbmRhclRpdGxlQ2VudGVyID0gItep16LXldeqINek16LXmdec15XXqiDXp9eR15XXoteV16oiOwogICAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdjaGFuZ2VWaWV3JywgJ2RvbnRTaG93RGF0ZScpOwogICAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnb3RvRGF0ZScsIG1vbWVudCgkZ0hvdXIwZGF0ZSkpOwogICAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZW1vdmVFdmVudHMnKTsKICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwoKICAgIH0KCiAgICAvLyAkc2NvcGUuZGVsZXRlQWxsRXZlbnRzID0gZnVuY3Rpb24oKSB7CiAgICAvLyAgICAgY2FsZW5kYXIgPSAnY2FsZW5kYXJfaG91cnNfb2Zfd29yayc7CiAgICAvLyAgICAgYWxsbEV2ZW50c0FycmF5ID0gdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignY2xpZW50RXZlbnRzJyk7CiAgICAvLyAgICAgZm9yIChpIGluIGFsbGxFdmVudHNBcnJheSkgewogICAgLy8gICAgICAgICBsb2dEZWJ1ZyhhbGxsRXZlbnRzQXJyYXlbaV0pOwogICAgLy8gICAgICAgICAkc2NvcGUuZGVsZXRlQ2FsZW5kYXJKU0V2ZW50KGNhbGVuZGFyLCBhbGxsRXZlbnRzQXJyYXlbaV0uaWQpOwogICAgLy8gICAgICAgICAkc2NvcGUuZGVsZXRlQ2FsZW5kYXJEQkV2ZW50KGFsbGxFdmVudHNBcnJheVtpXS5pZCk7CiAgICAvLyAgICAgfQogICAgLy8KICAgIC8vIH0KICAgICRzY29wZS51cGRhdGVMaW1pdGF0aW9uRGF0YWJhc2UgPSBmdW5jdGlvbihzdGFydF9wYXJhbSwgZW5kX3BhcmFtLCBldmVudF9pZCwgdGVtcF9saW1pdF9pZCwgdGhlZXZlbnQpIHsKCiAgICAgICAgbG9nRGVidWcoInVwZGF0ZUxpbWl0YXRpb25EYXRhYmFzZSBzdGFydD0iICsgc3RhcnRfcGFyYW0gKyAiLCBlbmQ9IiArIGVuZF9wYXJhbSArICIsZXZlbnRfaWQ9IiArIGV2ZW50X2lkKTsKCiAgICAgICAgZnVuY3Rpb24gdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uX2ZhaWx1cmUoKQogICAgICAgIHsKICAgICAgICAgIGNhbGVuZGFyID0gImNhbGVuZGFyX2hvdXJzX29mX3dvcmsiOwogICAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwogICAgICAgIH0KICAgICAgICAvLyBpZiB0aGUgZXZlbnQgdGhhdCBpcyBnZXR0aW5nIHVwZGF0ZWQgaXMgYW4gZXZlbnQgZnJvbSAxOTcwIChub3QgcGVyZGF5KQogICAgICAgIC8vIHRoZW4gd2UgYWRkIGEgbmV3IHBlcmRheSBsaW1pdGF0aW9uIHdpdGggbGltaXRfaWQgb2YgdGhlIDE5NzAgbGltaXRhdGlvbnMgLSB3aXRoIHRoZSBuZXcgdGltZXMuCgogICAgICAgIC8vIG90aGVyd2lzZSB3ZSBqdXN0IHVwZGF0ZSB0aGUgcGVyZGF5IGxpbWl0YXRpb24KCiAgICAgICAgaWYgKCRzY29wZS5maXhlZFNjaGVkdWxlKSAvLyBmaXhlZCBzY2hlZHVsZSB2cyBzcGVjaWZpYyB3ZWVkL2RheSBsaW1pdGF0aW9uCiAgICAgICAgewogICAgICAgICAgdGhlZGF0YSA9IHsKICAgICAgICAgICAgICBzdGFydF9kYXRlOiBzdGFydF9wYXJhbSwKICAgICAgICAgICAgICBlbmRfZGF0ZTogZW5kX3BhcmFtLAogICAgICAgICAgICAgIHRlbXBfbGltaXRfaWQ6IHRlbXBfbGltaXRfaWQsCiAgICAgICAgICAgICAgbGltaXRfaWQ6IGV2ZW50X2lkCiAgICAgICAgICB9OwoKICAgICAgICAgIHVwZGF0ZUNhbGVuZGFyTGltaXRhdGlvbigkaHR0cCwkc2NvcGUsdGhlZGF0YSxldmVudF9pZCwgbnVsbCwgdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uX2ZhaWx1cmUpOwogICAgICAgIH0KICAgICAgICBlbHNlIC8vIG5vdCBmaXhlZCBzY2hlZHVsZSAtIGRhaWx5L3dlZWtseSBsaW1pdGF0aW9ucwogICAgICAgIHsKICAgICAgICAgICAgaWYgKCh0aGVldmVudC5saW1pdF9pZCAhPSBudWxsKSAmICh0aGVldmVudC5kYXlfbGltaXRfaWQgPT0gLTEpKSAvLyBldmVudCBsaW1pdGF0aW9uIGhhcyBsaW1pdF9pZCBzbyBpdHMgYW4gMTk3MCBldmVudAogICAgICAgICAgICAvLyBuZWVkIHRvIGFkZCBhIG5ldyBwZXJkYXkgbGltaXRhdGlvbiB0aGF0IHBvaW50IChsaW1pdF9pZCkgdG8gdGhlIG9sZCAxOTcwIGV2ZW50IHRvIGNhbmNlbCBpdAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICB0ZW1wX2xpbWl0X2lkID0gY2FsY190ZW1wX2xpbWl0X2lkKCk7CiAgICAgICAgICAgICAgICB0aGVldmVudC50ZW1wX2xpbWl0X2lkID0gdGVtcF9saW1pdF9pZDsKICAgICAgICAgICAgICAgIHRoZWV2ZW50LmRheV9saW1pdF9pZCA9IHRlbXBfbGltaXRfaWQ7CiAgICAgICAgICAgICAgICAvLyB0aGUgbW92ZWQgZXZlbnQgaW4gdGhlIGNhbGVuZGFyIG5vdyBoYXMgZGF5X2xpbWl0X2lkIGFuZCB0ZW1wX2xpbWl0X2lkCiAgICAgICAgICAgICAgICAvLyBpZiBpdHMgbG9hZGVkIGZyb20gdGhlIGRiLCBpdCB3aWxsIG9ubHkgaGF2ZSBkYXlfbGltaXRfaWQgKGFuZCBub3QgdGhlIHRlbXAgb25lKQogICAgICAgICAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnXS5mdWxsQ2FsZW5kYXIoJ3VwZGF0ZUV2ZW50JywgdGhlZXZlbnQpOwogICAgICAgICAgICAgICAgY29uc29sZS5sb2coIlhYWFhYWFhYWFhYWFgiKTsKICAgICAgICAgICAgICAgIHRoZWRhdGEgPSB7CiAgICAgICAgICAgICAgICAgICAgc3RhcnRfZGF0ZTogc3RhcnRfcGFyYW0sCiAgICAgICAgICAgICAgICAgICAgZW5kX2RhdGU6IGVuZF9wYXJhbSwKICAgICAgICAgICAgICAgICAgICBjb2xvcjogdGhlZXZlbnQuY29sb3IsCiAgICAgICAgICAgICAgICAgICAgdGVtcF9saW1pdF9pZDogdGVtcF9saW1pdF9pZCwKICAgICAgICAgICAgICAgICAgICBldmVudF90eXBlX2lkOiB0aGVldmVudC5ldmVudF90eXBlX2lkLAogICAgICAgICAgICAgICAgICAgIGV2ZW50X3R5cGVzOiB0aGVldmVudC5ldmVudF90eXBlcywKICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbl9pZDogdGhlZXZlbnQubG9jYXRpb25faWQsCiAgICAgICAgICAgICAgICAgICAgZW1wX2lkOiB0aGVldmVudC5lbXBfaWQsCiAgICAgICAgICAgICAgICAgICAgbGltaXRfaWQ6IHRoZWV2ZW50LmlkLAogICAgICAgICAgICAgICAgICAgIHRpdGxlOiB0aGVldmVudC50aXRsZQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIGNyZWF0ZUNhbGVuZGFyTGltaXRhdGlvblBlckRheSgkaHR0cCwkc2NvcGUsdGhlZGF0YSxudWxsLCB1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25fZmFpbHVyZSk7CgogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgLy8gZXZlbnQgbGltaXRhdGlvbiB0byBtb3ZlL3VwZGF0ZSBoYXMgbm8gbGltaXRfaWQgLSBzbyB0aGlzIGlzIG5ldyBwZXJkYXkgZXZlbnQgLSB3ZSBqdXN0IHVwZGF0ZSBpdAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgdGhlZGF0YT0gewogICAgICAgICAgICAgICAgICBzdGFydF9kYXRlOiBzdGFydF9wYXJhbSwKICAgICAgICAgICAgICAgICAgZW5kX2RhdGU6IGVuZF9wYXJhbSwKICAgICAgICAgICAgICAgICAgdGVtcF9kYXlfbGltaXRfaWQ6IHRoZWV2ZW50LnRlbXBfbGltaXRfaWQsCiAgICAgICAgICAgICAgICAgIGxvY2F0aW9uX2lkOiB0aGVldmVudC5sb2NhdGlvbl9pZCwKICAgICAgICAgICAgICAgICAgZGF5X2xpbWl0X2lkOiB0aGVldmVudC5kYXlfbGltaXRfaWQKICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIHVwZGF0ZUNhbGVuZGFyTGltaXRhdGlvblBlckRheSgkaHR0cCwkc2NvcGUsdGhlZGF0YSxudWxsLCB1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25fZmFpbHVyZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Owp9KTsKCmt1emVBcHAuY29udHJvbGxlcignRXZlbnRDbGFzc1BhZ2VDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkdGltZW91dCwgJGh0dHAsICRyb290U2NvcGUsICRyb3V0ZVBhcmFtcywgJGxvY2F0aW9uLCAkcm91dGUsIHNoYXJlZERhdGEsICR1aWJNb2RhbCkKewogIGdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCk7CiAgZ2V0QWxsQ2xpZW50cygkaHR0cCwkc2NvcGUsJ2V2ZW50VHlwZVVzZXJzJyk7CiAgZ2V0QnVzaW5lc3NMb2NhdGlvbnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19sb2NhdGlvbnMnKTsKICBnZXRBbGxJbnN0cnVjdG9ycygkaHR0cCwkc2NvcGUsJ2luc3RydWN0b3JzJyk7CgogICRzY29wZS51cGRhdGVFdmVudFRpdGxlID0gZnVuY3Rpb24obmV3VmFsdWUsY3VycmVudEV2ZW50KQogIHsKICAgIG5ld190aXRsZT1uZXdWYWx1ZTsKICAgIHNldEV2ZW50VGl0bGUoJGh0dHAsJHNjb3BlLGN1cnJlbnRFdmVudC5ldmVudF9pZCwgbmV3X3RpdGxlLCB1cGRhdGVFdmVudF9jYWxsYmFjaywgdXBkYXRlRXZlbnRfY2FsbGJhY2spOwoKICAgIGZ1bmN0aW9uIHVwZGF0ZUV2ZW50X2NhbGxiYWNrKCkKICAgIHsKICAgICAgZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCk7CiAgICB9CgogIH07CgogICRzY29wZS51cGRhdGVFdmVudE1heFBhcnRpY2lwYW50cyA9IGZ1bmN0aW9uKG5ld1ZhbHVlLGN1cnJlbnRFdmVudCkKICB7CiAgICBuZXdfbWF4X3BhcnRpY2lwYW50cz1uZXdWYWx1ZTsKICAgIGlmICggbmV3X21heF9wYXJ0aWNpcGFudHMgPCBjdXJyZW50RXZlbnQubm9fb2ZfdXNlcnMgKXsKICAgICAgc2V0RXZlbnRNYXhQYXJ0aWNpcGFudHMoJGh0dHAsJHNjb3BlLGN1cnJlbnRFdmVudC5ldmVudF9pZCwgY3VycmVudEV2ZW50Lm5vX29mX3VzZXJzLCBjdXJyZW50RXZlbnQubm9fb2ZfdXNlcnMsIHVwZGF0ZUV2ZW50X2NhbGxiYWNrLCB1cGRhdGVFdmVudF9jYWxsYmFjayk7CiAgICB9IGVsc2UgewogICAgICBzZXRFdmVudE1heFBhcnRpY2lwYW50cygkaHR0cCwkc2NvcGUsY3VycmVudEV2ZW50LmV2ZW50X2lkLCBuZXdfbWF4X3BhcnRpY2lwYW50cywgY3VycmVudEV2ZW50Lm5vX29mX3VzZXJzLCB1cGRhdGVFdmVudF9jYWxsYmFjaywgdXBkYXRlRXZlbnRfY2FsbGJhY2spOwogICAgfQoKICAgIGZ1bmN0aW9uIHVwZGF0ZUV2ZW50X2NhbGxiYWNrKCkKICAgIHsKICAgICAgZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCk7CiAgICB9CgogIH07CgogICRzY29wZS51cGRhdGVVc2VyRXZlbnRQcmljZSA9IGZ1bmN0aW9uKG5ld3ZhbHVlLCB0aGVldmVudCwgZXVzZXIpCiAgewogICAgbmV3X3ByaWNlPW5ld3ZhbHVlOwogICAgc2V0Q2xpZW50RXZlbnRQcmljZSgkaHR0cCwkc2NvcGUsZXVzZXIuYnVzaW5lc3NfdXNlcl9pZCx0aGVldmVudC5ldmVudF9pZCwgbmV3X3ByaWNlLHNldENsaWVudEV2ZW50UHJpY2VfY2FsbGJhY2ssIHNldENsaWVudEV2ZW50UHJpY2VfY2FsbGJhY2spOwogICAgZnVuY3Rpb24gc2V0Q2xpZW50RXZlbnRQcmljZV9jYWxsYmFjaygpCiAgICB7CiAgICAgIGdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQpOwogICAgfQogIH07CgogICRzY29wZS51cGRhdGVMb2NhdGlvbkV2ZW50ID0gZnVuY3Rpb24oKQogIHsKICAgIGNvbnNvbGUubG9nKCJmdW5jdGlvbjogdXBkYXRlTG9jYXRpb25FdmVudCIpOwogICAgdXBkYXRlRXZlbnRMb2NhdGlvbigkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLCRzY29wZS5jdXJyZW50RXZlbnQubG9jYXRpb25faWQsdXBkYXRlRXZlbnRMb2NhdGlvbl9jYWxsYmFjaywgdXBkYXRlRXZlbnRMb2NhdGlvbl9jYWxsYmFjayk7CiAgICAkc2NvcGUudXBkYXRlTG9jYXRpb25BbGVydE1lc3NhZ2U9Itee16LXk9eb158g16HXmNeY15XXoS4uLiI7CiAgICBmdW5jdGlvbiB1cGRhdGVFdmVudExvY2F0aW9uX2NhbGxiYWNrKCkKICAgIHsKICAgICAgJHNjb3BlLnVwZGF0ZUxvY2F0aW9uQWxlcnRNZXNzYWdlPSLXoteV15PXm9efINeR15TXptec15fXlCEiOwogICAgICAkdGltZW91dChmdW5jdGlvbigpCiAgICAgIHsKICAgICAgICAkc2NvcGUudXBkYXRlTG9jYXRpb25BbGVydE1lc3NhZ2U9bnVsbDsKICAgICAgfSwgMTUwMCk7CiAgICB9CiAgfTsKCiAgJHNjb3BlLnVwZGF0ZUluc3RydWN0b3JDbGFzc0V2ZW50ID0gZnVuY3Rpb24oKQogIHsKICAgIGNvbnNvbGUubG9nKCJmdW5jdGlvbjogdXBkYXRlSW5zdHJ1Y3RvckNsYXNzRXZlbnQiKTsKICAgIHVwZGF0ZUV2ZW50SW5zdHJ1Y3RvcigkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLCRzY29wZS5jdXJyZW50RXZlbnQuaW5zdHJ1Y3Rvcl9pZCx1cGRhdGVFdmVudEluc3RydWN0b3JfY2FsbGJhY2ssIHVwZGF0ZUV2ZW50SW5zdHJ1Y3Rvcl9jYWxsYmFjayk7CiAgICAkc2NvcGUudXBkYXRlSW5zdHJ1Y3RvckFsZXJ0TWVzc2FnZT0i157XoteT15vXnyDXodeY15jXldehLi4uIjsKICAgIGZ1bmN0aW9uIHVwZGF0ZUV2ZW50SW5zdHJ1Y3Rvcl9jYWxsYmFjaygpCiAgICB7CiAgICAgICRzY29wZS51cGRhdGVJbnN0cnVjdG9yQWxlcnRNZXNzYWdlPSLXoteV15PXm9efINeR15TXptec15fXlCEiOwogICAgICAkdGltZW91dChmdW5jdGlvbigpCiAgICAgIHsKICAgICAgICAkc2NvcGUudXBkYXRlSW5zdHJ1Y3RvckFsZXJ0TWVzc2FnZT1udWxsOwogICAgICB9LCAxNTAwKTsKICAgIH0KICB9CgoKICAkc2NvcGUuYWN0aXZhdGVFdmVudENsYXNzID0gZnVuY3Rpb24oKQogIHsKICAgIHsKICAgICAgbG9nRGVidWcoInJlb3BlbkV2ZW50Iik7CiAgICAgIHJlb3BlbkV2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkLCRzY29wZS5zZWxlY3RlZEV2ZW50LGFmdGVyUmVvcGVuRXZlbnQsYWZ0ZXJSZW9wZW5FdmVudCk7CiAgICAgIGZ1bmN0aW9uIGFmdGVyUmVvcGVuRXZlbnQoKQogICAgICB7CiAgICAgICAgZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCk7CiAgICAgIH07CiAgICB9CiAgfQoKICAvLyBjbG9zZSBldmVudCBjbGFzcwogICRzY29wZS5jbG9zZUV2ZW50Q2xhc3MgPSBmdW5jdGlvbigpIHsKICAgICAgbG9nRGVidWcoImV2ZW50IGNyZWF0ZSBtb2RhbCIpOwoKICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgICAgICAgICBhbmltYXRpb246IGZhbHNlLAogICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfZXZlbnRfY2xhc3NfY2xvc2UucGhwJywKICAgICAgICAgIHNpemU6ICd4cycsCiAgICAgICAgICBjb250cm9sbGVyOiAnY2xhc3NDbG9zZU1vZGFsQ29udHJvbGxlcicsCiAgICAgICAgICByZXNvbHZlOiB7CiAgICAgICAgICAgICAgZXZlbnRfaWQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZDsKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgIH0pOwogIH07CgogIC8vIGRlbGV0ZSByZXBlYXRpbmcvY2xhc3MgZXZlbnQKICAkc2NvcGUuZGVsZXRlQ2xhc3NFdmVudCA9IGZ1bmN0aW9uKCkKICB7CiAgICBpZiAoJHNjb3BlLmN1cnJlbnRFdmVudC5pc19yZXBlYXRpbmc9PTApCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJjbGFzcyBldmVudCBub3QgcmVwZWF0aW5nIik7CiAgICAgICRzY29wZS5kZWxldGVDbGFzc0V2ZW50U2luZ2xlKCk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJjbGFzcyBldmVudCBpcyByZXBlYXRpbmciKTsKICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgICAgICAgICBhbmltYXRpb246IGZhbHNlLAogICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfcmVwZWF0aW5nX2V2ZW50X2RlbGV0ZV9hbGwucGhwJywKICAgICAgICAgIHNpemU6ICd4cycsCiAgICAgICAgICBjb250cm9sbGVyOiAnY2xhc3NEZWxldGVBbGxNb2RhbENvbnRyb2xsZXInLAogICAgICAgICAgcmVzb2x2ZTogewogICAgICAgICAgICAgIGN1cnJlbnRFdmVudDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuY3VycmVudEV2ZW50OwogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfTsKCiAgJHNjb3BlLmRlbGV0ZUNsYXNzRXZlbnRTaW5nbGU9ZnVuY3Rpb24gKCkgLy8gZGVsZXRlIG9ubHkgb25lL2N1cnJlbnQgY2xhc3MgZXZlaHQKICB7CiAgICBjYW5jZWxDbGFzc0V2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkLGNhbmNlbENsYXNzRXZlbnRfY2FsbGJhY2ssIGNhbmNlbENsYXNzRXZlbnRfY2FsbGJhY2spOwogICAgZnVuY3Rpb24gY2FuY2VsQ2xhc3NFdmVudF9jYWxsYmFjaygpCiAgICB7CiAgICAgIGdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQpOwogICAgfQogIH0KCiAgJHNjb3BlLiRvbigicmVsb2FkRXZlbnQiLGZ1bmN0aW9uKGUsYSl7CiAgICAgICAvLyBQb3N0IHlvdXIgY29kZQogICBsb2dEZWJ1ZygiYnJvYWRjYXN0ZWQgLSByZWxvYWRpbmcgZXZlbnQgIithLmV2ZW50X2lkKTsKICAgZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkKTsKfSk7CgogIC8vIHJlbW92ZSBlbmQgdXNlciBmcm9tIGV2ZW50CiAgJHNjb3BlLmV2ZW50UmVtb3ZlRW5kVXNlciA9IGZ1bmN0aW9uKGVuZHVzZXJfaWQpCiAgewogICAgY29uc29sZS5sb2coImV2ZW50UmVtb3ZlRW5kVXNlciIpOwogICAgcmVtb3ZlRW5kVXNlckZyb21FdmVudCgkaHR0cCwkc2NvcGUsZW5kdXNlcl9pZCwkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkLHJlbW92ZUVuZFVzZXJGcm9tRXZlbnRfZmluaXNoLCByZW1vdmVFbmRVc2VyRnJvbUV2ZW50X2ZpbmlzaCk7CiAgICBmdW5jdGlvbiByZW1vdmVFbmRVc2VyRnJvbUV2ZW50X2ZpbmlzaCgpCiAgICB7CiAgICAgIGdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCk7CiAgICB9CiAgfTsKCiAgJHNjb3BlLmV2ZW50Q2xpZW50U2VsZWN0ZWQgPSBmdW5jdGlvbihzZWxlY3RlZCkgewogICAgICBpZiAoc2VsZWN0ZWQpIHsKICAgICAgICAgIC8vIGFsZXJ0KEpTT04uc3RyaW5naWZ5KCBzZWxlY3RlZCwgbnVsbCwgMiApKTsKICAgICAgICAgIGxvZ0RlYnVnKCdldmVudENsaWVudFNlbGVjdGVkMiB5ZXMgc2VsZWN0ZWQgJyArIHNlbGVjdGVkLm9yaWdpbmFsT2JqZWN0LmZpcnN0X25hbWUpOwogICAgICAgICAgJHNjb3BlLmV2ZW50QWRkRW5kVXNlcihzZWxlY3RlZC5vcmlnaW5hbE9iamVjdC5idXNpbmVzc191c2VyX2lkKTsKICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnYW5ndWNvbXBsZXRlLWFsdDpjbGVhcklucHV0JywgJ2NsaWVudF9hbmd1Y29tcGxldGUnKTsKCiAgICAgIH0gZWxzZSB7CiAgICAgICAgICBsb2dEZWJ1Zygnbm90IHNlbGVjdGVkJyk7CiAgICAgIH0KICB9OwoKICAkc2NvcGUuZXZlbnRBZGRFbmRVc2VyID0gZnVuY3Rpb24oZW5kdXNlcl9pZCkKICB7CiAgICBhZGRFbmRVc2VyVG9FdmVudCgkaHR0cCwkc2NvcGUsZW5kdXNlcl9pZCwkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkLGFkZEVuZFVzZXJUb0V2ZW50X2ZpbmlzaCwgYWRkRW5kVXNlclRvRXZlbnRfZmluaXNoKTsKICAgIGZ1bmN0aW9uIGFkZEVuZFVzZXJUb0V2ZW50X2ZpbmlzaCgpCiAgICB7CiAgICAgIGdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCk7CiAgICB9CiAgfTsKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ0V2ZW50UGFnZUNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICR0aW1lb3V0LCAkaHR0cCwgJHVpYk1vZGFsICxzaGFyZWRQcm9wZXJ0aWVzLCAkcm91dGVQYXJhbXMsICRyb290U2NvcGUsICRsb2NhdGlvbiwgJHJvdXRlLCBzaGFyZWREYXRhKQp7CiAgbG9nRGVidWcoIkV2ZW50UGFnZUNvbnRyb2xsZXIiKTsKCiAgZ2V0QWxsSW5zdHJ1Y3RvcnNJbmNJbmFjdGl2ZSgkaHR0cCwkc2NvcGUsJ2luc3RydWN0b3JzJyxnZXRBbGxJbnN0cnVjdG9yc0luY0luYWN0aXZlX3N1Y2Nlc3MpOwogIGdldEJ1c2luZXNzTG9jYXRpb25zKCRodHRwLCRzY29wZSwnYnVzaW5lc3NfbG9jYXRpb25zJyk7CgogIGZ1bmN0aW9uIGdldEFsbEluc3RydWN0b3JzSW5jSW5hY3RpdmVfc3VjY2VzcygpCiAgewogICAgZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLHNldFBhcnRpY2lwYXRlZCk7CiAgfQoKICAkc2NvcGUuZXh0cmFGaWVsZHNBbGVydE1lc3NhZ2U9bnVsbDsKCiAgJHNjb3BlLnVwZGF0ZUV2ZW50VGl0bGUgPSBmdW5jdGlvbihuZXdWYWx1ZSxjdXJyZW50RXZlbnQpCiAgewogICAgbmV3X3RpdGxlPW5ld1ZhbHVlOwogICAgc2V0RXZlbnRUaXRsZSgkaHR0cCwkc2NvcGUsY3VycmVudEV2ZW50LmV2ZW50X2lkLCBuZXdfdGl0bGUsIHVwZGF0ZUV2ZW50X2NhbGxiYWNrLCB1cGRhdGVFdmVudF9jYWxsYmFjayk7CgogICAgZnVuY3Rpb24gdXBkYXRlRXZlbnRfY2FsbGJhY2soKQogICAgewogICAgICBnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkKTsKICAgIH0KCiAgfTsKCgogICRzY29wZS51cGRhdGVFdmVudEV4dHJhRmllbGRzID0gZnVuY3Rpb24oKQogIHsKICAgIGxvZ0RlYnVnKCJ1cGRhdGVFdmVudEV4dHJhRmllbGRzIik7CiAgICB0aGVkYXRhID0gewogICAgICAgZXh0cmFGaWVsZHM6JHNjb3BlLmN1cnJlbnRFdmVudC5leHRyYUZpZWxkcwogICAgICB9OwogICAgJHNjb3BlLmV4dHJhRmllbGRzQWxlcnRNZXNzYWdlPSLXntei15PXm9efINeg16rXldeg15nXnSwg15DXoNeQINeU157XqtefLi4uIjsKICAgIHVwZGF0ZUV2ZW50RXh0cmFGaWVsZHMoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCx0aGVkYXRhLHVwZGF0ZUV2ZW50RXh0cmFGaWVsZHNfY2FsbGJhY2ssIHVwZGF0ZUV2ZW50RXh0cmFGaWVsZHNfY2FsbGJhY2spOwoKICAgIGZ1bmN0aW9uIHVwZGF0ZUV2ZW50RXh0cmFGaWVsZHNfY2FsbGJhY2soKQogICAgewogICAgICBnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkcm91dGVQYXJhbXMuZXZlbnRfaWQsc2V0UGFydGljaXBhdGVkKTsKICAgICAgJHNjb3BlLmV4dHJhRmllbGRzQWxlcnRNZXNzYWdlPSLXqteZ16LXldeTINeg16nXnteoINeR15TXptec15fXlCEiOwogICAgICAkdGltZW91dChmdW5jdGlvbigpCiAgICAgIHsKICAgICAgICAkc2NvcGUuZXh0cmFGaWVsZHNBbGVydE1lc3NhZ2U9bnVsbDsKICAgICAgfSwgMzAwMCk7CiAgICB9CiAgfTsKCiAgJHNjb3BlLnJlc2NoZWR1bGVFdmVudCA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1Zygic2VldGluZyBldmVudCB0byBtb3ZlICAiKyRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXSk7CiAgICBzaGFyZWRQcm9wZXJ0aWVzLnNldF9ldmVudF9yZXNjaGVkdWxlKCRzY29wZS5jdXJyZW50RXZlbnQpOwogICAgLy8gdXNlcl9pbmZvPSB7CiAgICAvLyAgICAgdXNlcl9pZDogJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudFVzZXJzWzBdLnVzZXJfaWQsCiAgICAvLyAgICAgYnVzZXJfZmlyc3RfbmFtZTogJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudFVzZXJzWzBdLmJ1c2VyX2ZpcnN0X25hbWUsCiAgICAvLyAgICAgYnVzZXJfbGFzdF9uYW1lOiAkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfbGFzdF9uYW1lCiAgICAvLyB9OwogICAgLy8gc2hhcmVkUHJvcGVydGllcy5zZXRfc2VsZWN0ZWRfdXNlcih1c2VyX2luZm8pOwogICAgJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jYWxlbmRhcicpOwogIH0KCiAgJHNjb3BlLnVwZGF0ZUxvY2F0aW9uRXZlbnQgPSBmdW5jdGlvbigpCiAgewogICAgY29uc29sZS5sb2coImZ1bmN0aW9uOiB1cGRhdGVMb2NhdGlvbkV2ZW50Iik7CiAgICB1cGRhdGVFdmVudExvY2F0aW9uKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuZXZlbnRfaWQsJHNjb3BlLmN1cnJlbnRFdmVudC5sb2NhdGlvbl9pZCx1cGRhdGVFdmVudExvY2F0aW9uX2NhbGxiYWNrLCB1cGRhdGVFdmVudExvY2F0aW9uX2NhbGxiYWNrKTsKICAgICRzY29wZS51cGRhdGVMb2NhdGlvbkFsZXJ0TWVzc2FnZT0i157XoteT15vXnyDXodeY15jXldehLi4uIjsKICAgIGZ1bmN0aW9uIHVwZGF0ZUV2ZW50TG9jYXRpb25fY2FsbGJhY2soKQogICAgewogICAgICAkc2NvcGUudXBkYXRlTG9jYXRpb25BbGVydE1lc3NhZ2U9Itei15XXk9eb158g15HXlNem15zXl9eUISI7CiAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkKICAgICAgewogICAgICAgICRzY29wZS51cGRhdGVMb2NhdGlvbkFsZXJ0TWVzc2FnZT1udWxsOwogICAgICB9LCAxNTAwKTsKICAgIH0KICB9OwoKICAkc2NvcGUudXBkYXRlSW5zdHJ1Y3RvckV2ZW50ID0gZnVuY3Rpb24oKQogIHsKICAgIGNvbnNvbGUubG9nKCJmdW5jdGlvbjogdXBkYXRlSW5zdHJ1Y3RvckV2ZW50Iik7CiAgICB1cGRhdGVFdmVudEluc3RydWN0b3IoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCwkc2NvcGUuY3VycmVudEV2ZW50Lmluc3RydWN0b3JfaWQsdXBkYXRlRXZlbnRJbnN0cnVjdG9yX2NhbGxiYWNrLCB1cGRhdGVFdmVudEluc3RydWN0b3JfY2FsbGJhY2spOwogICAgJHNjb3BlLnVwZGF0ZUluc3RydWN0b3JBbGVydE1lc3NhZ2U9Itee16LXk9eb158g16HXmNeY15XXoS4uLiI7CiAgICBmdW5jdGlvbiB1cGRhdGVFdmVudEluc3RydWN0b3JfY2FsbGJhY2soKQogICAgewogICAgICAkc2NvcGUudXBkYXRlSW5zdHJ1Y3RvckFsZXJ0TWVzc2FnZT0i16LXldeT15vXnyDXkdeU16bXnNeX15QhIjsKICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKQogICAgICB7CiAgICAgICAgJHNjb3BlLnVwZGF0ZUluc3RydWN0b3JBbGVydE1lc3NhZ2U9bnVsbDsKICAgICAgfSwgMTUwMCk7CiAgICB9CiAgfTsKCiAgJHNjb3BlLmluaXRpYXRlUGF5bWVudCA9IGZ1bmN0aW9uKGlzcGx1cykKICB7CiAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAgICAgICBhbmltYXRpb246IGZhbHNlLAogICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2NsaWVudF9wYXltZW50LnBocCcsCiAgICAgICAgY29udHJvbGxlcjogJ2J1c2luZXNzQ2xpZW5kQ2FyZFBheW1lbnQnLAogICAgICAgIC8vIHNpemU6IHNpemUsCiAgICAgICAgcmVzb2x2ZTogewogICAgICAgICAgY3VycmVudENsaWVudDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgcmV0dXJuICRzY29wZS5jdXJyZW50RXZlbnRDbGllbnRzWzBdOwogICAgICAgICAgfSwKICAgICAgICAgIGlzcGx1czogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGlzcGx1czsKICAgICAgICAgIH0KICAgICAgICB9CiAgICB9KTsKICB9CgogICRzY29wZS5kZWxldGVFdmVudD1mdW5jdGlvbiAoKQogIHsKICAgIC8vIGNoZWNraW5nIGlmIGNhbmNlbGluZyBhIGdlbmVyY190eXBlIGV2ZW50IC0gdGhlbiB0aGVyZSdzIG5vIHVzZXIKICAgIGlmICgkc2NvcGUuY3VycmVudEV2ZW50LmlzX2dlbmVyaWNfZXR5cGU9PTEpCiAgICB7CiAgICAgIGNhbmNlbFNpbmdsZUV2ZW50KCRodHRwLCRzY29wZSwwLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCxjYW5jZWxTaW5nbGVFdmVudF9jYWxsYmFjaywgY2FuY2VsU2luZ2xlRXZlbnRfY2FsbGJhY2spOwogICAgfQogICAgZWxzZQogICAgewogICAgICBjYW5jZWxTaW5nbGVFdmVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudFVzZXJzWzBdLmJ1c2luZXNzX3VzZXJfaWQsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLGNhbmNlbFNpbmdsZUV2ZW50X2NhbGxiYWNrLCBjYW5jZWxTaW5nbGVFdmVudF9jYWxsYmFjayk7CiAgICB9CiAgICBmdW5jdGlvbiBjYW5jZWxTaW5nbGVFdmVudF9jYWxsYmFjaygpCiAgICB7CiAgICAgIGdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCxzZXRQYXJ0aWNpcGF0ZWQpOwogICAgfQogIH0KCiAgJHNjb3BlLnNldFBhcnRpY2lwYXRpb25TdGF0dXMgPSBmdW5jdGlvbigpCiAgewogICAgc2V0RXZlbnRVc2VyUGFydGljaXBhdGlvblN0YXR1cygkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRVc2Vyc1swXS5idXNpbmVzc191c2VyX2lkLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRVc2Vyc1swXS5ldmVudF91c2VyX3N0YXR1c19pZCxzZXRQYXJ0aWNpcGF0aW9uU3RhdHVzX2NhbGxiYWNrLCBzZXRQYXJ0aWNpcGF0aW9uU3RhdHVzX2NhbGxiYWNrKTsKICAgICRzY29wZS51cGRhdGVTdGF0dXNBbGVydE1lc3NhZ2U9Itee16LXk9eb158g16HXmNeY15XXoS4uLiI7CiAgICBmdW5jdGlvbiBzZXRQYXJ0aWNpcGF0aW9uU3RhdHVzX2NhbGxiYWNrKCkKICAgIHsKICAgICAgLy8gZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLHNldFBhcnRpY2lwYXRlZCk7CiAgICAgIHNldFBhcnRpY2lwYXRlZCgpOwogICAgICAkc2NvcGUudXBkYXRlU3RhdHVzQWxlcnRNZXNzYWdlPSLXoteV15PXm9efINeR15TXptec15fXlCEiOwogICAgICAkdGltZW91dChmdW5jdGlvbigpCiAgICAgIHsKICAgICAgICAkc2NvcGUudXBkYXRlU3RhdHVzQWxlcnRNZXNzYWdlPW51bGw7CiAgICAgIH0sIDI1MDApOwogICAgfQogIH0KCiAgZnVuY3Rpb24gc2V0UGFydGljaXBhdGVkKCkKICB7CiAgICBsb2dEZWJ1ZygiZ2V0IGNsaWVudCBpbmZvIik7CiAgICBnZXRCdXNpbmVzc0NsaWVudEluZm8oJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnRDbGllbnRzJywkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50VXNlcnNbMF0uYnVzaW5lc3NfdXNlcl9pZCk7CiAgICBsb2dEZWJ1Zygic2V0dGluZyBzZXRQYXJ0aWNpcGF0ZWQiKTsKICAgIGlmICgkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50VXNlcnNbMF0uc3RhdHVzX25hbWUhPSRnVXNlcl9zdGF0dXNfYWJzZW50ZWQpCiAgICB7CiAgICAgICRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRVc2Vyc1swXS5wYXJ0aWNpcGF0ZWQ9dHJ1ZTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudFVzZXJzWzBdLnBhcnRpY2lwYXRlZD1mYWxzZTsKICAgIH0KCiAgICAvLyB0aGlzIGxvb3AgaXMgZm9yIGZpeGluZyB0aGUgZGF0ZSBmb3JtYXQgdG8gYXBwZWFyIHByb3Blcmx5IGluIHRoZSBpbnB1dCBkYXRlIGh0bWwgb2JqZWN0CiAgICBmb3IgKGkgPSAwOyBpPCAoJHNjb3BlLmN1cnJlbnRFdmVudC5leHRyYUZpZWxkcykubGVuZ3RoOyBpKyspCiAgICB7CiAgICAgIGxvZ0RlYnVnKCRzY29wZS5jdXJyZW50RXZlbnQuZXh0cmFGaWVsZHNbaV0pOwogICAgICBpZiAoJHNjb3BlLmN1cnJlbnRFdmVudC5leHRyYUZpZWxkc1tpXS5maWVsZF9kYXRhdHlwZT09IkRBVEUiKQogICAgICB7CiAgICAgICAgLy8gbG9nRGVidWcoImRhdGUiKTsKICAgICAgICAkc2NvcGUuY3VycmVudEV2ZW50LmV4dHJhRmllbGRzW2ldLmZpZWxkX3ZhbHVlPW5ldyBEYXRlKCRzY29wZS5jdXJyZW50RXZlbnQuZXh0cmFGaWVsZHNbaV0uZmllbGRfdmFsdWUpOwogICAgICB9CiAgICB9CgogICAgbG9nRGVidWcoIiRzY29wZS5jdXJyZW50RXZlbnQuaW5zdHJ1Y3Rvcl9pZDs9Iiskc2NvcGUuY3VycmVudEV2ZW50Lmluc3RydWN0b3JfaWQpOwogICAgZm9yKHZhciBpID0gMDsgaSA8ICRzY29wZS5pbnN0cnVjdG9ycy5sZW5ndGg7IGkrKykKICAgIHsKICAgICAgbG9nRGVidWcoJHNjb3BlLmluc3RydWN0b3JzW2ldLmlzX2FjdGl2ZSk7CiAgICAgIGlmICgkc2NvcGUuaW5zdHJ1Y3RvcnNbaV0uYnVzaW5lc3NfdXNlcl9pZD09JHNjb3BlLmN1cnJlbnRFdmVudC5pbnN0cnVjdG9yX2lkKQogICAgICB7CiAgICAgICAgbG9nRGVidWcoInllc2giKTsKICAgICAgICAkc2NvcGUuaW5zdHJ1Y3RvcnNbaV0uaXNfYWN0aXZlPTE7CiAgICAgIH0KICAgIH0KICB9CgogICRzY29wZS51cGRhdGVVc2VyRXZlbnRQcmljZSA9IGZ1bmN0aW9uKG5ld3ZhbHVlLCB0aGVldmVudCkKICB7CiAgICBuZXdfcHJpY2U9bmV3dmFsdWU7CiAgICBzZXRDbGllbnRFdmVudFByaWNlKCRodHRwLCRzY29wZSwkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50VXNlcnNbMF0uYnVzaW5lc3NfdXNlcl9pZCx0aGVldmVudC5ldmVudF9pZCwgbmV3X3ByaWNlLHNldENsaWVudEV2ZW50UHJpY2VfY2FsbGJhY2ssIHNldENsaWVudEV2ZW50UHJpY2VfY2FsbGJhY2spOwogICAgZnVuY3Rpb24gc2V0Q2xpZW50RXZlbnRQcmljZV9jYWxsYmFjaygpCiAgICB7CiAgICAgIGdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCxzZXRQYXJ0aWNpcGF0ZWQpOwogICAgfQogIH07CgogICRzY29wZS4kb24oImV2ZW50UGFnZVJlbG9hZERhdGEiLGZ1bmN0aW9uKGUsYSkKICB7CiAgICBnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkcm91dGVQYXJhbXMuZXZlbnRfaWQsc2V0UGFydGljaXBhdGVkKTsKICB9KTsKCiAgJHNjb3BlLmNsb3NlRXZlbnQgPSBmdW5jdGlvbigpCiAgewogICAgbG9nRGVidWcoImNoZWNraW5nIGlmIGV2ZW50IGhhcyBleHRyYSBmaWVsZHMgdGhhdCBhcmUgcmVxdWlyZWQgYmVmb3JlIGNsb3NpbmcgaXQiKTsKICAgIGNoZWNrRXZlbnRFeHRyYUZpZWxkcygkaHR0cCwkc2NvcGUsJ2NoZWNrRXZlbnRFeHRyYUZpZWxkcycsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLGNoZWNrRXZlbnRFeHRyYUZpZWxkc19zdWNjZXNzKTsKICAgIGZ1bmN0aW9uIGNoZWNrRXZlbnRFeHRyYUZpZWxkc19zdWNjZXNzKCkKICAgIHsKICAgICAgaWYgKCRzY29wZS5jaGVja0V2ZW50RXh0cmFGaWVsZHM9PXRydWUpCiAgICAgIHsKICAgICAgICBsb2dEZWJ1ZygiZXZlbnQgaGFzIGFsbCBleHRyYSBmaWVsZHMgb2ssIGNsb3NpbmcgZXZlbnQiKTsKICAgICAgICAvLyAkc2NvcGUuY3VycmVudEV2ZW50Lmlnbm9yZUV4dHJhRmllbGRzVmFsaWRhdGlvbj10cnVlOwogICAgICAgIGNsb3NlRXZlbnQoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCwkc2NvcGUuY3VycmVudEV2ZW50LGFmdGVyQ2xvc2VFdmVudCxhZnRlckNsb3NlRXZlbnQpOwogICAgICAgIGZ1bmN0aW9uIGFmdGVyQ2xvc2VFdmVudCgpCiAgICAgICAgewogICAgICAgICAgZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLHNldFBhcnRpY2lwYXRlZCk7CiAgICAgICAgfTsKICAgICAgfQogICAgICBlbHNlCiAgICAgIHsKICAgICAgICBsb2dEZWJ1ZygiZXZlbnQgaGFzIGV4dHJhIGZpZWxkcyByZXF1aXJlZCB0aGF0IGFyZSBub3QgZmlsbGVkIik7CiAgICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgICAgICAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2V2ZW50X2Nsb3NlX2lnbm9yZV9tYW5kYXRvcnlfZmllbGRzLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdldmVudENsb3NlSWdub3JlTWFuZGF0b3J5RmllbGRzTW9kYWxDb250cm9sbGVyJywKICAgICAgICAgICAgc2l6ZTogJ20nLAogICAgICAgICAgICByZXNvbHZlOiB7CiAgICAgICAgICAgICAgICBjdXJyZW50RXZlbnQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuY3VycmVudEV2ZW50OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICB9CiAgJHNjb3BlLnJlb3BlbkV2ZW50ID0gZnVuY3Rpb24oKQogIHsKICAgIGxvZ0RlYnVnKCJyZW9wZW5FdmVudCIpOwogICAgcmVvcGVuRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQsJHNjb3BlLmN1cnJlbnRFdmVudCxhZnRlclJlb3BlbkV2ZW50LGFmdGVyUmVvcGVuRXZlbnQpOwogICAgZnVuY3Rpb24gYWZ0ZXJSZW9wZW5FdmVudCgpCiAgICB7CiAgICAgIGdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQsc2V0UGFydGljaXBhdGVkKTsKICAgIH07CiAgfQoKfSk7CgprdXplQXBwLmZpbHRlcignc3RhcnRGcm9tJywgZnVuY3Rpb24oKQp7CiAgICByZXR1cm4gZnVuY3Rpb24oaW5wdXQsIHN0YXJ0KQogICAgewogICAgICAgaWYoIWlucHV0KSByZXR1cm4gW107CiAgICAgICAgLy8gY29uc29sZS5sb2coImhlcmVyZWVlICIraW5wdXQpOwogICAgICAgIHN0YXJ0ID0gK3N0YXJ0OyAvL3BhcnNlIHRvIGludAogICAgICAgIHJldHVybiBpbnB1dC5zbGljZShzdGFydCk7CiAgICB9Cn0pOwovLyBhbmd1bGFyIGZpbHRlciBmb3IgZXZlbnRzIGJlZm9yZS9hZnRlciB0b2RheQprdXplQXBwLmZpbHRlcignYmVmb3JlTm93JywgZnVuY3Rpb24oKSB7CiAgLy8gQ3JlYXRlIHRoZSByZXR1cm4gZnVuY3Rpb24gYW5kIHNldCB0aGUgcmVxdWlyZWQgcGFyYW1ldGVyIG5hbWUgdG8gKippbnB1dCoqCiByZXR1cm4gZnVuY3Rpb24oaW5wdXQpIHsKICAgdmFyIG91dCA9IFtdOwoKICAgLy8gVXNpbmcgdGhlIGFuZ3VsYXIuZm9yRWFjaCBtZXRob2QsIGdvIHRocm91Z2ggdGhlIGFycmF5IG9mIGRhdGEgYW5kIHBlcmZvcm0gdGhlIG9wZXJhdGlvbiBvZiBmaWd1cmluZyBvdXQgaWYgdGhlIGxhbmd1YWdlIGlzIHN0YXRpY2FsbHkgb3IgZHluYW1pY2FsbHkgdHlwZWQuCiAgIHZhciBicm93c2VyX2Vwb2NoID0gKG5ldyBEYXRlKS5nZXRUaW1lKCk7CgogICBhbmd1bGFyLmZvckVhY2goaW5wdXQsIGZ1bmN0aW9uKGV2ZW50KQogICB7CiAgICAvLyAgbG9nRGVidWcoImZpbHRlcmluZywgZXZlbnQuZXZlbnRfdXNlcl9zdGF0dXNfaWQ9IitldmVudC5ldmVudF91c2VyX3N0YXR1c19pZCk7CiAgICAgaWYgKGV2ZW50LnN0YXJ0X2Vwb2NoIDw9IChicm93c2VyX2Vwb2NoLzEwMDApKQogICAgIHsKICAgICAgIG91dC5wdXNoKGV2ZW50KQogICAgIH0KICAgfSkKICAgcmV0dXJuIG91dDsKIH0KfSk7Cmt1emVBcHAuZmlsdGVyKCdhZnRlck5vdycsIGZ1bmN0aW9uKCkgewogIC8vIENyZWF0ZSB0aGUgcmV0dXJuIGZ1bmN0aW9uIGFuZCBzZXQgdGhlIHJlcXVpcmVkIHBhcmFtZXRlciBuYW1lIHRvICoqaW5wdXQqKgogcmV0dXJuIGZ1bmN0aW9uKGlucHV0KSB7CiAgIHZhciBvdXQgPSBbXTsKCiAgIC8vIFVzaW5nIHRoZSBhbmd1bGFyLmZvckVhY2ggbWV0aG9kLCBnbyB0aHJvdWdoIHRoZSBhcnJheSBvZiBkYXRhIGFuZCBwZXJmb3JtIHRoZSBvcGVyYXRpb24gb2YgZmlndXJpbmcgb3V0IGlmIHRoZSBsYW5ndWFnZSBpcyBzdGF0aWNhbGx5IG9yIGR5bmFtaWNhbGx5IHR5cGVkLgogICB2YXIgYnJvd3Nlcl9lcG9jaCA9IChuZXcgRGF0ZSkuZ2V0VGltZSgpOwoKICAgYW5ndWxhci5mb3JFYWNoKGlucHV0LCBmdW5jdGlvbihldmVudCkKICAgewogICAgLy8gIGxvZ0RlYnVnKCJmaWx0ZXJpbmcsIGV2ZW50LmV2ZW50X3VzZXJfc3RhdHVzX2lkPSIrZXZlbnQuZXZlbnRfdXNlcl9zdGF0dXNfaWQpOwogICAgIGlmIChldmVudC5zdGFydF9lcG9jaCA+IChicm93c2VyX2Vwb2NoLzEwMDApKQogICAgIHsKICAgICAgIG91dC5wdXNoKGV2ZW50KQogICAgIH0KICAgfSkKICAgcmV0dXJuIG91dDsKIH0KfSk7CgprdXplQXBwLmZpbHRlcignaXNBY3RpdmUnLCBmdW5jdGlvbigpIHsKICAvLyBDcmVhdGUgdGhlIHJldHVybiBmdW5jdGlvbiBhbmQgc2V0IHRoZSByZXF1aXJlZCBwYXJhbWV0ZXIgbmFtZSB0byAqKmlucHV0KioKIHJldHVybiBmdW5jdGlvbihpbnB1dCkgewogICB2YXIgb3V0ID0gW107CgogICAvLyBVc2luZyB0aGUgYW5ndWxhci5mb3JFYWNoIG1ldGhvZCwgZ28gdGhyb3VnaCB0aGUgYXJyYXkgb2YgZGF0YSBhbmQgcGVyZm9ybSB0aGUgb3BlcmF0aW9uIG9mIGZpZ3VyaW5nIG91dCBpZiB0aGUgbGFuZ3VhZ2UgaXMgc3RhdGljYWxseSBvciBkeW5hbWljYWxseSB0eXBlZC4KCiAgIGFuZ3VsYXIuZm9yRWFjaChpbnB1dCwgZnVuY3Rpb24oZXZlbnQpCiAgIHsKICAgIC8vICBsb2dEZWJ1ZygiZmlsdGVyaW5nLCBldmVudC5ldmVudF91c2VyX3N0YXR1c19pZD0iK2V2ZW50LmV2ZW50X3VzZXJfc3RhdHVzX2lkKTsKICAgICBpZiAoZXZlbnQuaXNfYWN0aXZlPT0xKQogICAgIHsKICAgICAgIG91dC5wdXNoKGV2ZW50KQogICAgIH0KICAgfSkKICAgcmV0dXJuIG91dDsKIH0KfSk7CgprdXplQXBwLmZpbHRlcignc2hvdWxkX2JlX2Rpc3BsYXllZCcsIGZ1bmN0aW9uKCkgewogIC8vIENyZWF0ZSB0aGUgcmV0dXJuIGZ1bmN0aW9uIGFuZCBzZXQgdGhlIHJlcXVpcmVkIHBhcmFtZXRlciBuYW1lIHRvICoqaW5wdXQqKgogcmV0dXJuIGZ1bmN0aW9uKGlucHV0KSB7CiAgIHZhciBvdXQgPSBbXTsKCiAgIC8vIFVzaW5nIHRoZSBhbmd1bGFyLmZvckVhY2ggbWV0aG9kLCBnbyB0aHJvdWdoIHRoZSBhcnJheSBvZiBkYXRhIGFuZCBwZXJmb3JtIHRoZSBvcGVyYXRpb24gb2YgZmlndXJpbmcgb3V0IGlmIHRoZSBsYW5ndWFnZSBpcyBzdGF0aWNhbGx5IG9yIGR5bmFtaWNhbGx5IHR5cGVkLgoKICAgYW5ndWxhci5mb3JFYWNoKGlucHV0LCBmdW5jdGlvbihldmVudCkKICAgewogICAgLy8gIGxvZ0RlYnVnKCJmaWx0ZXJpbmcsIGV2ZW50LmV2ZW50X3VzZXJfc3RhdHVzX2lkPSIrZXZlbnQuZXZlbnRfdXNlcl9zdGF0dXNfaWQpOwogICAgIGlmIChldmVudC5zaG91bGRfYmVfZGlzcGxheWVkPT0xKQogICAgIHsKICAgICAgIG91dC5wdXNoKGV2ZW50KQogICAgIH0KICAgfSkKICAgcmV0dXJuIG91dDsKIH0KfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ0luc3RydWN0b3JTaG93MUNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICR0aW1lb3V0LCAkaHR0cCwgc2hhcmVkUHJvcGVydGllcywgJHJvb3RTY29wZSwgJHJvdXRlUGFyYW1zLCAkbG9jYXRpb24sICRyb3V0ZSwgc2hhcmVkRGF0YSwgJHVpYk1vZGFsKQp7CiAgZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLGdldEJ1c2luZXNzQ2xpZW50SW5mb19zdWNjZXNzKTsKCiAgZnVuY3Rpb24gZ2V0QnVzaW5lc3NDbGllbnRJbmZvX3N1Y2Nlc3MoKQogIHsKICAgIGdldENsaWVudEV4dHJhRmllbGRzKCRodHRwLCRzY29wZSwkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYnVzaW5lc3NfdXNlcl9pZCwnY2xpZW50RXh0cmFGaWVsZHMnLGdldENsaWVudEV4dHJhRmllbGRzX3N1Y2Nlc3MpOwoKICAgIGZ1bmN0aW9uIGdldENsaWVudEV4dHJhRmllbGRzX3N1Y2Nlc3MoKQogICAgewogICAgICBmb3IgKGkgPSAwOyBpPCAoJHNjb3BlLmNsaWVudEV4dHJhRmllbGRzKS5sZW5ndGg7IGkrKykKICAgICAgewogICAgICAgIGxvZ0RlYnVnKCRzY29wZS5jbGllbnRFeHRyYUZpZWxkc1tpXSk7CiAgICAgICAgaWYgKCRzY29wZS5jbGllbnRFeHRyYUZpZWxkc1tpXS5maWVsZF9kYXRhdHlwZT09IkRBVEUiKQogICAgICAgIHsKICAgICAgICAgIC8vIGxvZ0RlYnVnKCJkYXRlIik7CiAgICAgICAgICAkc2NvcGUuY2xpZW50RXh0cmFGaWVsZHNbaV0uZmllbGRfdmFsdWU9bmV3IERhdGUoJHNjb3BlLmNsaWVudEV4dHJhRmllbGRzW2ldLmZpZWxkX3ZhbHVlKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CgogICRzY29wZS5hcmNoaXZlQ2xpZW50TW9kYWwgPSBmdW5jdGlvbigpCiAgewogICAgLy8gYXJjaGl2ZS9kZWxldGUgY2xpZW50IC0gYXNrIGlmIHN1cmUKICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewogICAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYXJjaGl2ZV9jbGllbnRfbW9kYWwucGhwJywKICAgICAgICBzaXplOiAneHMnLAogICAgICAgIGNvbnRyb2xsZXI6ICdhcmNoaXZlX2NsaWVudF9tb2RhbCcsICAvLyAncGF5bWVueURldGFpbHNNb2RhbENvbnRyb2xsZXInLAogICAgICAgIHJlc29sdmU6IHsKICAgICAgICAgIGJ1c2luZXNzX3VzZXJfaWQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYnVzaW5lc3NfdXNlcl9pZDsKICAgICAgICAgIH0sCiAgICAgICAgICBidXNlcl9sYXN0X25hbWU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYnVzZXJfbGFzdF9uYW1lOwogICAgICAgICAgfSwKICAgICAgICAgIGJ1c2VyX2ZpcnN0X25hbWU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYnVzZXJfZmlyc3RfbmFtZTsKICAgICAgICAgIH0sCiAgICAgICAgICBpc19pbnN0cnVjdG9yOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICB9KTsKICB9CgogICRzY29wZS51cGRhdGVVc2VyRmlyc3ROYW1lID0gZnVuY3Rpb24obmV3VmFsdWUpCiAgewogICAgc2V0Q2xpZW50Rmlyc3ROYW1lKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCxuZXdWYWx1ZSxhZnRlckNsaWVudFNldCxhZnRlckNsaWVudFNldCk7CiAgICBmdW5jdGlvbiBhZnRlckNsaWVudFNldCgpCiAgICB7CiAgICAgIGdldEJ1c2luZXNzQ2xpZW50SW5mbygkaHR0cCwkc2NvcGUsJ2Zvcm1VcGRhdGVDbGllbnRBbmd1bGFyJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CiAgICB9CiAgfQogICRzY29wZS51cGRhdGVVc2VyTGFzdE5hbWUgPSBmdW5jdGlvbihuZXdWYWx1ZSkKICB7CiAgICBzZXRDbGllbnRMYXN0TmFtZSgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsbmV3VmFsdWUsYWZ0ZXJDbGllbnRTZXQsYWZ0ZXJDbGllbnRTZXQpOwogICAgZnVuY3Rpb24gYWZ0ZXJDbGllbnRTZXQoKQogICAgewogICAgICBnZXRCdXNpbmVzc0NsaWVudEluZm8oJGh0dHAsJHNjb3BlLCdmb3JtVXBkYXRlQ2xpZW50QW5ndWxhcicsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwogICAgfQogIH0KICAkc2NvcGUudXBkYXRlVXNlclBob25lTnVtYmVyID0gZnVuY3Rpb24obmV3VmFsdWUpCiAgewogICAgbmV3VmFsdWUgPSBuZXdWYWx1ZS5yZXBsYWNlKCctJywnJyk7CiAgICBpZiAoaXNOYU4obmV3VmFsdWUpKQogICAgewogICAgICBhbGVydCgi15DXoNeQINeU15bXnyDXnteh16TXqCDXmNec16TXldefINeq16fXmdefIik7CiAgICAgIGdldEJ1c2luZXNzQ2xpZW50SW5mbygkaHR0cCwkc2NvcGUsJ2Zvcm1VcGRhdGVDbGllbnRBbmd1bGFyJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgIHNldENsaWVudFBob25lTnVtYmVyKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCxuZXdWYWx1ZSxzZXRDbGllbnRQaG9uZU51bWJlcl9jYWxsYmFjayxzZXRDbGllbnRQaG9uZU51bWJlcl9jYWxsYmFjayk7CiAgICAgIGZ1bmN0aW9uIHNldENsaWVudFBob25lTnVtYmVyX2NhbGxiYWNrKCkKICAgICAgewogICAgICAgIGdldEJ1c2luZXNzQ2xpZW50SW5mbygkaHR0cCwkc2NvcGUsJ2Zvcm1VcGRhdGVDbGllbnRBbmd1bGFyJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CiAgICAgIH0KICAgIH0KICB9Cgp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ0NsaWVudHNTaG93MUNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICR0aW1lb3V0LCAkaHR0cCwgc2hhcmVkUHJvcGVydGllcywgJHJvb3RTY29wZSwgJHJvdXRlUGFyYW1zLCAkbG9jYXRpb24sICRyb3V0ZSwgc2hhcmVkRGF0YSwgJHVpYk1vZGFsKQp7CiAgICBnZXRCdXNpbmVzc0NsaWVudEluZm8oJGh0dHAsJHNjb3BlLCdmb3JtVXBkYXRlQ2xpZW50QW5ndWxhcicsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsZ2V0QnVzaW5lc3NDbGllbnRJbmZvX3N1Y2Nlc3MpOwoKICAgIGZ1bmN0aW9uIGdldEJ1c2luZXNzQ2xpZW50SW5mb19zdWNjZXNzKCkKICAgIHsKICAgICAgZ2V0Q2xpZW50RXh0cmFGaWVsZHMoJGh0dHAsJHNjb3BlLCRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5idXNpbmVzc191c2VyX2lkLCdjbGllbnRFeHRyYUZpZWxkcycsZ2V0Q2xpZW50RXh0cmFGaWVsZHNfc3VjY2Vzcyk7CgogICAgICBmdW5jdGlvbiBnZXRDbGllbnRFeHRyYUZpZWxkc19zdWNjZXNzKCkKICAgICAgewogICAgICAgIGZvciAoaSA9IDA7IGk8ICgkc2NvcGUuY2xpZW50RXh0cmFGaWVsZHMpLmxlbmd0aDsgaSsrKQogICAgICAgIHsKICAgICAgICAgIGxvZ0RlYnVnKCRzY29wZS5jbGllbnRFeHRyYUZpZWxkc1tpXSk7CiAgICAgICAgICBpZiAoJHNjb3BlLmNsaWVudEV4dHJhRmllbGRzW2ldLmZpZWxkX2RhdGF0eXBlPT0iREFURSIpCiAgICAgICAgICB7CiAgICAgICAgICAgIC8vIGxvZ0RlYnVnKCJkYXRlIik7CiAgICAgICAgICAgICRzY29wZS5jbGllbnRFeHRyYUZpZWxkc1tpXS5maWVsZF92YWx1ZT1uZXcgRGF0ZSgkc2NvcGUuY2xpZW50RXh0cmFGaWVsZHNbaV0uZmllbGRfdmFsdWUpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQp7CiAgICBnZXRDbGllbnRFdmVudHMoJGh0dHAsJHNjb3BlLCdjdXJyZW50Q2xpZW50RXZlbnRzJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CgogICAgZ2V0Q2xpZW50UGF5bWVudHMoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLCdjdXJyZW50Q2xpZW50UGF5bWVudHMnKTsKCiAgICAkc2NvcGUuYXJjaGl2ZUNsaWVudE1vZGFsID0gZnVuY3Rpb24oKQogICAgewogICAgICAvLyBhcmNoaXZlL2RlbGV0ZSBjbGllbnQgLSBhc2sgaWYgc3VyZQogICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAgICAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdhcmNoaXZlX2NsaWVudF9tb2RhbC5waHAnLAogICAgICAgICAgc2l6ZTogJ3hzJywKICAgICAgICAgIGNvbnRyb2xsZXI6ICdhcmNoaXZlX2NsaWVudF9tb2RhbCcsICAvLyAncGF5bWVueURldGFpbHNNb2RhbENvbnRyb2xsZXInLAogICAgICAgICAgcmVzb2x2ZTogewogICAgICAgICAgICBidXNpbmVzc191c2VyX2lkOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYnVzaW5lc3NfdXNlcl9pZDsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgYnVzZXJfbGFzdF9uYW1lOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYnVzZXJfbGFzdF9uYW1lOwogICAgICAgICAgICB9LAogICAgICAgICAgICBidXNlcl9maXJzdF9uYW1lOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYnVzZXJfZmlyc3RfbmFtZTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgaXNfaW5zdHJ1Y3RvcjogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgICAkc2NvcGUucGFja2FnZURlbGV0ZSA9IGZ1bmN0aW9uKHBhY2thZ2UpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJwYWNrYWdlIGRlbGV0ZSAiK0pTT04uc3RyaW5naWZ5KHBhY2thZ2UpKTsKICAgICAgZGVsZXRlUGFja2FnZSgkaHR0cCwkc2NvcGUscGFja2FnZS5wYWNrYWdlX3VzZXJfaWQsJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLmJ1c2luZXNzX3VzZXJfaWQsc3VjY2Vzc19jYWxsYmFjaywgc3VjY2Vzc19jYWxsYmFjayk7CiAgICAgIGZ1bmN0aW9uIHN1Y2Nlc3NfY2FsbGJhY2soKQogICAgICB7CiAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgICB9CiAgICB9CgogICAgJHNjb3BlLnVwZGF0ZUNsaWVudEV4dHJhRmllbGRzID0gZnVuY3Rpb24oKQogICAgewogICAgICBsb2dEZWJ1ZygidXBkYXRlRXZlbnRFeHRyYUZpZWxkcyIpOwogICAgICB0aGVkYXRhID0gewogICAgICAgICBleHRyYUZpZWxkczokc2NvcGUuY2xpZW50RXh0cmFGaWVsZHMKICAgICAgICB9OwogICAgICAkc2NvcGUuZXh0cmFGaWVsZHNBbGVydE1lc3NhZ2U9Itee16LXk9eb158g16DXqteV16DXmdedLCDXkNeg15Ag15TXnteq158uLi4iOwogICAgICB1cGRhdGVDbGllbnRFeHRyYUZpZWxkcygkaHR0cCwkc2NvcGUsJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLmJ1c2luZXNzX3VzZXJfaWQsdGhlZGF0YSx1cGRhdGVFdmVudEV4dHJhRmllbGRzX2NhbGxiYWNrLCB1cGRhdGVFdmVudEV4dHJhRmllbGRzX2NhbGxiYWNrKTsKCiAgICAgIGZ1bmN0aW9uIHVwZGF0ZUV2ZW50RXh0cmFGaWVsZHNfY2FsbGJhY2soKQogICAgICB7CiAgICAgICAgLy8gZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLHNldFBhcnRpY2lwYXRlZCk7CiAgICAgICAgJHNjb3BlLmV4dHJhRmllbGRzQWxlcnRNZXNzYWdlPSLXqteZ16LXldeTINeg16nXnteoINeR15TXptec15fXlCEiOwogICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkKICAgICAgICB7CiAgICAgICAgICAkc2NvcGUuZXh0cmFGaWVsZHNBbGVydE1lc3NhZ2U9bnVsbDsKICAgICAgICB9LCAzMDAwKTsKICAgICAgfQogICAgfTsKCiAgICAkc2NvcGUuc2NoZWR1bGVFdmVudEZvckNsaWVudCA9IGZ1bmN0aW9uKCkKICAgIHsKICAgICAgbG9nRGVidWcoInNlZXRpbmcgc2hhcmUgcHJvcGVydHkgdXNlcl9pZCAiKyRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXSk7CiAgICAgIHNoYXJlZFByb3BlcnRpZXMuc2V0X3NlbGVjdGVkX3VzZXIoJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdKTsKICAgICAgJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jYWxlbmRhcicpOwogICAgfQogICAgJHNjb3BlLmludm9pY2VHZW5lcmF0ZUNoZWNrYm94ID0gZnVuY3Rpb24oZnBheW1lbnQpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJpbnZvaWNlR2VuZXJhdGVDaGVja2JveCBmb3IgIitKU09OLnN0cmluZ2lmeShmcGF5bWVudCkpOwogICAgICBzZXRDbGllbnRQYXltZW50SW52b2ljZUdlbmVyYXRlZCgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsZnBheW1lbnQudXNlcl9wYXltZW50X2lkLGZwYXltZW50Lmludm9pY2VfZ2VuZXJhdGVkLHNldENsaWVudFBheW1lbnRJbnZvaWNlR2VuZXJhdGVkX2NhbGxiYWNrLCBzZXRDbGllbnRQYXltZW50SW52b2ljZUdlbmVyYXRlZF9jYWxsYmFjayk7CiAgICAgIGZ1bmN0aW9uIHNldENsaWVudFBheW1lbnRJbnZvaWNlR2VuZXJhdGVkX2NhbGxiYWNrKCkKICAgICAgewogICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKICAgICAgfQogICAgfTsKCiAgICAkc2NvcGUucmVjYWxjVXNlckJhbGFuY2UgPSBmdW5jdGlvbigpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJyZWNhbGNVc2VyQmFsYW5jZSIpOwogICAgICByZWNhbGNVc2VyQmFsYW5jZSgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsIHJlY2FsY1VzZXJCYWxhbmNlX2NhbGxiYWNrKTsKICAgICAgZnVuY3Rpb24gcmVjYWxjVXNlckJhbGFuY2VfY2FsbGJhY2soKQogICAgICB7CiAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgICB9ICAgIH0KICAgICRzY29wZS51cGRhdGVFdmVudFBhY2thZ2VSZWZlcmVuY2UgPSBmdW5jdGlvbih1c2VyX2lkLCBmbWVldGluZykKICAgIHsKICAgICAgbG9nRGVidWcoInVwZGF0ZUV2ZW50UGFja2FnZVJlZmVyZW5jZSwgdXNlcj0iK3VzZXJfaWQrIiwgZm1lZXRpbmc9IitKU09OLnN0cmluZ2lmeShmbWVldGluZykpOwogICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAgICAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9jbGllbnRfZXZlbnRfcGFja2FnZV9hc3NvY2lhdGlvbi5waHAnLAogICAgICAgICAgc2l6ZTogJ3hzJywKICAgICAgICAgIGNvbnRyb2xsZXI6ICdldmVudFBhY2thZ2VBc3NvY2lhdGlvbk1vZGFsQ29udHJvbGxlcicsICAvLyAncGF5bWVueURldGFpbHNNb2RhbENvbnRyb2xsZXInLAogICAgICAgICAgcmVzb2x2ZTogewogICAgICAgICAgICAgIGZtZWV0aW5nOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIGZtZWV0aW5nOwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgYmFsYW5jZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYmFsYW5jZTsKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGJ1c2luZXNzX3VzZXJfaWQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQ7CiAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICB9KTsKICAgIH07CgogICAgJHNjb3BlLnVwZGF0ZVBhY2thZ2VQYXltZW50UmVmZXJlbmNlID0gZnVuY3Rpb24odXNlcl9pZCwgZnBhY2thZ2UpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJ1cGRhdGVQYWNrYWdlUGF5bWVudFJlZmVyZW5jZSwgdXNlcj0iK3VzZXJfaWQrIiwgZnBhY2thZ2U9IitKU09OLnN0cmluZ2lmeShmcGFja2FnZSkpOwogICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAgICAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9jbGllbnRfcGFja2FnZV9wYXltZW50X2Fzc29jaWF0aW9uLnBocCcsCiAgICAgICAgICBzaXplOiAneHMnLAogICAgICAgICAgY29udHJvbGxlcjogJ3BhY2thZ2VQYXltZW50QXNzb2NpYXRpb25Nb2RhbENvbnRyb2xsZXInLCAgLy8gJ3BheW1lbnlEZXRhaWxzTW9kYWxDb250cm9sbGVyJywKICAgICAgICAgIHJlc29sdmU6IHsKICAgICAgICAgICAgICBmcGFja2FnZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBmcGFja2FnZTsKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGJhbGFuY2U6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLmJhbGFuY2U7CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBidXNpbmVzc191c2VyX2lkOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuICRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkOwogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgfSk7CiAgICB9OwoKICAgIC8vIHNob3cgcGF5bWVudCBwb3B1cAogICAgJHNjb3BlLnNob3dQYXltZW50RGV0YWlscyA9IGZ1bmN0aW9uKGZwYXltZW50KQogICAgewogICAgICBsb2dEZWJ1Zygic2hvd1BheW1lbnREZXRhaWxzIik7CiAgICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewogICAgICAgICAgYW5pbWF0aW9uOiBmYWxzZSwKICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2NsaWVudF9wYXltZW50X2RldGFpbHMucGhwJywKICAgICAgICAgIHNpemU6ICd4cycsCiAgICAgICAgICBjb250cm9sbGVyOiAncGF5bWVueURldGFpbHNNb2RhbENvbnRyb2xsZXInLAogICAgICAgICAgcmVzb2x2ZTogewogICAgICAgICAgICAgIGZwYXltZW50OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIGZwYXltZW50OwogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgICAkc2NvcGUuaW52b2ljZU51bWJlckNoYW5nZWQgPSBmdW5jdGlvbihuZXdfaW52b2ljZV9udW1iZXIsZnBheW1lbnQpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJpbnZvaWNlTnVtYmVyQ2hhbmdlZCAiKyBuZXdfaW52b2ljZV9udW1iZXIgKyJmb3IgIitKU09OLnN0cmluZ2lmeShmcGF5bWVudCkpOwogICAgICBzZXRDbGllbnRQYXltZW50SW52b2ljZU51bWJlcigkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsZnBheW1lbnQudXNlcl9wYXltZW50X2lkLG5ld19pbnZvaWNlX251bWJlcixzZXRDbGllbnRQYXltZW50SW52b2ljZU51bWJlcl9jYWxsYmFjaywgc2V0Q2xpZW50UGF5bWVudEludm9pY2VOdW1iZXJfY2FsbGJhY2spOwogICAgICBmdW5jdGlvbiBzZXRDbGllbnRQYXltZW50SW52b2ljZU51bWJlcl9jYWxsYmFjaygpCiAgICAgIHsKICAgICAgICAvLyAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NsaWVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCiAgICAgIH0KICAgIH07CgogICAgJHNjb3BlLiRvbigiY2xpZW50UGFnZVJlbG9hZERhdGEiLGZ1bmN0aW9uKGUsYSkKICAgIHsKICAgICAgbG9nRGVidWcoImNsaWVudFBhZ2VSZWxvYWREYXRhIik7CiAgICAgIGdldEJ1c2luZXNzVXNlclBhY2thZ2VzKCRodHRwLCRzY29wZSwndXNlcl9wYWNrYWdlcycsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwogICAgICBnZXRDbGllbnRQYXltZW50cygkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsJ2N1cnJlbnRDbGllbnRQYXltZW50cycpOwogICAgICBnZXRDbGllbnRFdmVudHMoJGh0dHAsJHNjb3BlLCdjdXJyZW50Q2xpZW50RXZlbnRzJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CiAgICAgIGdldEJ1c2luZXNzQ2xpZW50SW5mbygkaHR0cCwkc2NvcGUsJ2Zvcm1VcGRhdGVDbGllbnRBbmd1bGFyJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CgogICAgfSk7CgogICAgJHNjb3BlLmlzQ29uZmlybWVkT3JDbG9zZWQgPSBmdW5jdGlvbihldmVudCkKICAgIHsKICAgICAgaWYgKCRzY29wZS5zaG93QWxsRXZlbnRzKQogICAgICB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KCiAgICAgIGlmICgoZXZlbnQuaXNfY29uZmlybWVkID09IDEpIHx8IChldmVudC5pc19maW5hbF9zdGF0dXMgPT0gMSkgfHwgKChldmVudC5pc193YWl0aW5nX2xpc3QgPT0gMSkgJiYgKGV2ZW50LmlzX2NhbmNlbGVkID09IDApKSkKICAgICAgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIGVsc2UKICAgICAgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfQogICAgJHNjb3BlLmdvdG9DbGllbnRFZGl0UGFnZT1nb3RvQ2xpZW50RWRpdFBhZ2U7CiAgICAkc2NvcGUuZ290b0JhY2s9ZnVuY3Rpb24oKQogICAgewogICAgICBsb2dEZWJ1ZygnZ28gYmFjaycpOwogICAgICB3aW5kb3cuaGlzdG9yeS5iYWNrKCk7CiAgICB9OwoKICAgICRzY29wZS5nb3RvRXZlbnRQYWdlID0gZnVuY3Rpb24gKHRoZWV2ZW50KQogICAgewogICAgICBnb3RvRXZlbnRQYWdlKHRoZWV2ZW50KTsKICAgIH0KfQogICAgJHNjb3BlLmluaXRpYXRlUGF5bWVudCA9IGZ1bmN0aW9uKGlzcGx1cykKICAgIHsKICAgICAgbG9nRGVidWcoImluaXRpYXRlUGF5bWVudCBpc3BsdXMiK2lzcGx1cyk7CiAgICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewogICAgICAgICAgYW5pbWF0aW9uOiBmYWxzZSwKICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2NsaWVudF9wYXltZW50LnBocCcsCiAgICAgICAgICBjb250cm9sbGVyOiAnYnVzaW5lc3NDbGllbmRDYXJkUGF5bWVudCcsCiAgICAgICAgICAvLyBzaXplOiBzaXplLAogICAgICAgICAgcmVzb2x2ZTogewogICAgICAgICAgICBjdXJyZW50Q2xpZW50OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF07CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGlzcGx1czogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gaXNwbHVzOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgIH0pOwogICAgfQoKICAgICRzY29wZS51cGRhdGVVc2VyRmlyc3ROYW1lID0gZnVuY3Rpb24obmV3VmFsdWUpCiAgICB7CiAgICAgIHNldENsaWVudEZpcnN0TmFtZSgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsbmV3VmFsdWUsYWZ0ZXJDbGllbnRTZXQsYWZ0ZXJDbGllbnRTZXQpOwogICAgICBmdW5jdGlvbiBhZnRlckNsaWVudFNldCgpCiAgICAgIHsKICAgICAgICBnZXRCdXNpbmVzc0NsaWVudEluZm8oJGh0dHAsJHNjb3BlLCdmb3JtVXBkYXRlQ2xpZW50QW5ndWxhcicsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwogICAgICB9CiAgICB9CiAgICAkc2NvcGUudXBkYXRlVXNlckxhc3ROYW1lID0gZnVuY3Rpb24obmV3VmFsdWUpCiAgICB7CiAgICAgIHNldENsaWVudExhc3ROYW1lKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCxuZXdWYWx1ZSxhZnRlckNsaWVudFNldCxhZnRlckNsaWVudFNldCk7CiAgICAgIGZ1bmN0aW9uIGFmdGVyQ2xpZW50U2V0KCkKICAgICAgewogICAgICAgIGdldEJ1c2luZXNzQ2xpZW50SW5mbygkaHR0cCwkc2NvcGUsJ2Zvcm1VcGRhdGVDbGllbnRBbmd1bGFyJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CiAgICAgIH0KICAgIH0KICAgICRzY29wZS51cGRhdGVVc2VyRW1haWwgPSBmdW5jdGlvbihuZXdWYWx1ZSkKICAgIHsKICAgICAgc2V0Q2xpZW50RW1haWwoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLG5ld1ZhbHVlLGFmdGVyc2V0Q2xpZW50RW1haWwsYWZ0ZXJzZXRDbGllbnRFbWFpbCk7CiAgICAgIGZ1bmN0aW9uIGFmdGVyc2V0Q2xpZW50RW1haWwoKQogICAgICB7CiAgICAgICAgZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKICAgICAgfQogICAgfQoKCiAgICAkc2NvcGUudXBkYXRlVXNlclBob25lTnVtYmVyID0gZnVuY3Rpb24obmV3VmFsdWUpCiAgICB7CiAgICAgIG5ld1ZhbHVlID0gbmV3VmFsdWUucmVwbGFjZSgnLScsJycpOwogICAgICBpZiAoaXNOYU4obmV3VmFsdWUpKQogICAgICB7CiAgICAgICAgYWxlcnQoIteQ16DXkCDXlNeW158g157Xodek16gg15jXnNek15XXnyDXqten15nXnyIpOwogICAgICAgIGdldEJ1c2luZXNzQ2xpZW50SW5mbygkaHR0cCwkc2NvcGUsJ2Zvcm1VcGRhdGVDbGllbnRBbmd1bGFyJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CiAgICAgIH0KICAgICAgZWxzZQogICAgICB7CiAgICAgICAgc2V0Q2xpZW50UGhvbmVOdW1iZXIoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLG5ld1ZhbHVlLHNldENsaWVudFBob25lTnVtYmVyX2NhbGxiYWNrLHNldENsaWVudFBob25lTnVtYmVyX2NhbGxiYWNrKTsKICAgICAgICBmdW5jdGlvbiBzZXRDbGllbnRQaG9uZU51bWJlcl9jYWxsYmFjaygpCiAgICAgICAgewogICAgICAgICAgZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgICRzY29wZS51cGRhdGVVc2VyRXZlbnRQcmljZSA9IGZ1bmN0aW9uKG5ld3ZhbHVlLCB0aGVldmVudCkKICAgIHsKICAgICAgbmV3X3ByaWNlPW5ld3ZhbHVlOwogICAgICBzZXRDbGllbnRFdmVudFByaWNlKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCx0aGVldmVudC5ldmVudF9pZCwgbmV3X3ByaWNlLHNldENsaWVudEV2ZW50UHJpY2VfY2FsbGJhY2ssIHNldENsaWVudEV2ZW50UHJpY2VfY2FsbGJhY2spOwogICAgICBmdW5jdGlvbiBzZXRDbGllbnRFdmVudFByaWNlX2NhbGxiYWNrKCkKICAgICAgewogICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKICAgICAgfQogICAgfTsKCiAgICAkc2NvcGUudXBkYXRlVXNlclBhY2thZ2VFdmVudHNDb3VudGVyID0gZnVuY3Rpb24obmV3dmFsdWUsIHRoZXBhY2thZ2UpCiAgICB7CiAgICAgIGV2ZW50c19jb3VudGVyPW5ld3ZhbHVlOwogICAgICBzZXRVc2VyUGFja2FnZUV2ZW50c0NvdW50ZXIoJGh0dHAsJHNjb3BlLHRoZXBhY2thZ2UucGFja2FnZV91c2VyX2lkLGV2ZW50c19jb3VudGVyLHNldFVzZXJQYWNrYWdlRXZlbnRzQ291bnRlcl9jYWxsYmFjaywgc2V0VXNlclBhY2thZ2VFdmVudHNDb3VudGVyX2NhbGxiYWNrKQogICAgICBmdW5jdGlvbiBzZXRVc2VyUGFja2FnZUV2ZW50c0NvdW50ZXJfY2FsbGJhY2soKQogICAgICB7CiAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgICB9CiAgICB9OwogICAgJHNjb3BlLnVwZGF0ZVVzZXJQYWNrYWdlUGFja2FnZVByaWNlID0gZnVuY3Rpb24obmV3dmFsdWUsIHRoZXBhY2thZ2UpCiAgICB7CiAgICAgIHBhY2thZ2VfcHJpY2U9bmV3dmFsdWU7CiAgICAgIHNldFVzZXJQYWNrYWdlUGFja2FnZVByaWNlKCRodHRwLCRzY29wZSx0aGVwYWNrYWdlLnBhY2thZ2VfdXNlcl9pZCxwYWNrYWdlX3ByaWNlLHNldFVzZXJQYWNrYWdlUGFja2FnZVByaWNlX2NhbGxiYWNrLCBzZXRVc2VyUGFja2FnZVBhY2thZ2VQcmljZV9jYWxsYmFjaykKICAgICAgZnVuY3Rpb24gc2V0VXNlclBhY2thZ2VQYWNrYWdlUHJpY2VfY2FsbGJhY2soKQogICAgICB7CiAgICAgICAgLy8gZ2V0QnVzaW5lc3NVc2VyUGFja2FnZXMoJGh0dHAsJHNjb3BlLCd1c2VyX3BhY2thZ2VzJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CiAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgICB9CiAgICB9OwoKICAgICRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhciA9IHt9OwogICAgbG9nRGVidWcoJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwogICAgJHNjb3BlLnNob3dfY2xpZW50X3VwZGF0ZV9jbGllbnQgPSB0cnVlOwogICAgJHNjb3BlLnNob3dfY2xpZW50X3VwZGF0ZV9zYXZlID0gZmFsc2U7CiAgICAkc2NvcGUuc2hvd19jbGllbnRfZGVsZXRlX2NsaWVudCA9IHRydWU7CiAgICAkc2NvcGUuc2hvd19jbGllbnRfdXBkYXRlX2NhbmNlbCA9IGZhbHNlOwoKICAgICRzY29wZS51cGRhdGVDbGllbnRFbmFibGUgPSBmdW5jdGlvbigpIHsKICAgICAgICBsb2dEZWJ1ZygiZW5hYmxpbmcgZWRpdGluZyAoJHNjb3BlLmNsaWVudHNVcGRhdGVEaXNhYmxlZCB3YXMgIiArICRzY29wZS5jbGllbnRzVXBkYXRlRGlzYWJsZWQgKyAiKSIpOwogICAgICAgICRzY29wZS5jbGllbnRzVXBkYXRlRGlzYWJsZWQgPSBmYWxzZTsKICAgICAgICAkc2NvcGUuc2hvd19jbGllbnRfdXBkYXRlX2NsaWVudCA9IGZhbHNlOwogICAgICAgICRzY29wZS5zaG93X2NsaWVudF91cGRhdGVfc2F2ZSA9IHRydWU7CiAgICAgICAgJHNjb3BlLnNob3dfY2xpZW50X2RlbGV0ZV9jbGllbnQgPSBmYWxzZTsKICAgICAgICAkc2NvcGUuc2hvd19jbGllbnRfdXBkYXRlX2NhbmNlbCA9IHRydWU7CiAgICB9CiAgICAkc2NvcGUudXBkYXRlQ2xpZW50RGlzYWJsZSA9IGZ1bmN0aW9uKCkgewogICAgICAgIGxvZ0RlYnVnKCJkaXNhYmxlIGVkaXRpbmciKTsKICAgICAgICAvLwkJJGxvY2F0aW9uLnBhdGgoJy9DbGllbnRzLycrJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwogICAgICAgICRyb3V0ZS5yZWxvYWQoKTsKICAgIH0KICAgICRzY29wZS5zY2hlZHVsZUV2ZW50RnJvbUVuZFVzZXIgPSBmdW5jdGlvbigpIHsKICAgICAgICBzaGFyZWREYXRhLnNldFNlbGVjdGVkRW5kVXNlcih7CiAgICAgICAgICAgIGlkOiAkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCwKICAgICAgICAgICAgZmlyc3RfbmFtZTogJHNjb3BlLmN1cnJlbnRDbGllbnQudXNlcnNbMF0uZmlyc3RfbmFtZSwKICAgICAgICAgICAgbGFzdF9uYW1lOiAkc2NvcGUuY3VycmVudENsaWVudC51c2Vyc1swXS5sYXN0X25hbWUKICAgICAgICB9KTsKICAgICAgICBsb2dEZWJ1Zygic2NoZWR1bGUgZXZlbnQgZm9yIHVzZXIgIiArICRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKICAgICAgICAvLwkJJGxvY2F0aW9uLnBhdGgoJy9DbGllbnRzLycrJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwogICAgICAgICRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfY2FsZW5kYXInKTsKICAgIH0KCiAgICAvLyByZW1vdmUgZW5kIHVzZXIgZnJvbSBldmVudAogICAgJHNjb3BlLnVzZXJEZWxldGVFdmVudCA9IGZ1bmN0aW9uKGVuZHVzZXJfaWQsIHRoZWV2ZW50KQogICAgewogICAgICAvLyBpZiBpdCdzIGEgY2xhc3MgLSB3ZSBzaW1wbHkgcmVtb3ZlIHRoZSB1c2VyIGZyb20gdGhlIGV2ZW50CiAgICAgIGlmICh0aGVldmVudC5pc19jbGFzcz09MSkKICAgICAgewogICAgICAgIGxvZ0RlYnVnKCJzY29wZS51c2VyRGVsZXRlRXZlbnQiKTsKICAgICAgICByZW1vdmVFbmRVc2VyRnJvbUV2ZW50KCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCx0aGVldmVudC5ldmVudF9pZCxyZW1vdmVFbmRVc2VyRnJvbUV2ZW50X2ZpbmlzaCwgcmVtb3ZlRW5kVXNlckZyb21FdmVudF9maW5pc2gpOwogICAgICAgIGZ1bmN0aW9uIHJlbW92ZUVuZFVzZXJGcm9tRXZlbnRfZmluaXNoKCkKICAgICAgICB7CiAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NsaWVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCiAgICAgICAgfQogICAgICB9CiAgICAgIC8vIGlmIGl0cyBub3QgYSBjbGFzcyAtIHdlIG5lZWQgdG8gcmVtb3ZlIHRoZSBldmVudCBpdHNlbGYKICAgICAgZWxzZQogICAgICB7CiAgICAgICAgLy8gYWxlcnQoIm5vdCBjbGFzcyBldmVudCwgVE9ETyIpOwogICAgICB9CiAgICB9OwoKICAgIC8vIHJldHJldmluZyBwYWNrYWdlcyBmb3IgdGhlIGJ1c2luZXNzCiAgICBnZXRCdXNpbmVzc1BhY2thZ2VzKCRodHRwLCRzY29wZSwncGFja2FnZXMnKTsKCiAgICAvLyBnZXQgcGFja2FnZXMgZm9yIHRoaXMgc3BlY2lmaWMgdXNlcgogICAgZ2V0QnVzaW5lc3NVc2VyUGFja2FnZXMoJGh0dHAsJHNjb3BlLCd1c2VyX3BhY2thZ2VzJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CiAgICAvLyBhZGRpbmcgcGFja2FnZSB0byB1c2VyIC0gY2FsbGVkIHdoZW4gYSBwYWNrYWdlIGlzIHNlbGVjdGVkCiAgICAkc2NvcGUucGFja2FnZUZvckNsaWVudFNlbGVjdGVkID0gZnVuY3Rpb24oc2VsZWN0ZWRQYWNrYWdlKSB7CiAgICAgICAgaWYgKHNlbGVjdGVkUGFja2FnZSkgewogICAgICAgICAgICAvLyBsb2dEZWJ1ZygneWVzIHNlbGVjdGVkICcgKyBKU09OLnN0cmluZ2lmeShzZWxlY3RlZFBhY2thZ2UpKTsKICAgICAgICAgICAgYWRkQnVzaW5lc3NQYWNrYWdlVG9Vc2VyKCRodHRwLCRzY29wZSxzZWxlY3RlZFBhY2thZ2Uub3JpZ2luYWxPYmplY3QsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsYWRkQnVzaW5lc3NQYWNrYWdlU3VjY2Vzcyk7CiAgICAgICAgICAgIGZ1bmN0aW9uIGFkZEJ1c2luZXNzUGFja2FnZVN1Y2Nlc3MoKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgbG9nRGVidWcoImFkZEJ1c2luZXNzUGFja2FnZVN1Y2Nlc3MyIik7CiAgICAgICAgICAgICAgLy8gZ2V0QnVzaW5lc3NQYWNrYWdlcygkaHR0cCwkc2NvcGUsJ3BhY2thZ2VzJyk7CiAgICAgICAgICAgICAgLy8gZ2V0QnVzaW5lc3NVc2VyUGFja2FnZXMoJGh0dHAsJHNjb3BlLCd1c2VyX3BhY2thZ2VzJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CiAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgICAgICAgICB9CiAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnYW5ndWNvbXBsZXRlLWFsdDpjbGVhcklucHV0JywgJ2NsaWVudF9hbmd1Y29tcGxldGUnKTsKICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgLy8gbG9nRGVidWcoJ25vdCBzZWxlY3RlZCwgZG8gbm90aGluZycpOwogICAgICAgIH0KICAgIH07Cn0pOwoKCi8vIE5lZWQgdG8gZGlzdGluZ3Vpc2ggYmV0d2VlbiBlbmQgdXNlciAoY2xpZW50KSBhbmQgYnVzaW5lc3Mgb3duZXIuCi8vIGN1cnJlbnRseSBjYWxscyBvbmx5IGVuZCB1c2VyCmt1emVBcHAuY29udHJvbGxlcignSG9tZUNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkdWliTW9kYWwpCnsKCiAgICBnZXRBbGxDbGllbnRzKCRodHRwLCRzY29wZSwnYWxsQ2xpZW50cycpOwoKICAgICRzY29wZS5ob21lcGFnZUxpbWl0PTY7CiAgICBnZXRPcGVuZWRFdmVudHMoJGh0dHAsJHNjb3BlLCRzY29wZS5ob21lcGFnZUxpbWl0LCdvcGVuZWRfZXZlbnRzJyk7CgogICAgdmFyIHRvZGF5ZGF0ZSA9IG5ldyBEYXRlKCk7CiAgICB2YXIgaG93bWFueWRheXNhaGVhZD0zMDsKICAgIHZhciBzdGFydGRhdGU9dG9kYXlkYXRlLmdldEZ1bGxZZWFyKCkrIi0iKygxK3RvZGF5ZGF0ZS5nZXRNb250aCgpKSsiLSIrdG9kYXlkYXRlLmdldERhdGUoKTsKICAgIHRvZGF5ZGF0ZS5zZXREYXRlKHRvZGF5ZGF0ZS5nZXREYXRlKCkgKyBob3dtYW55ZGF5c2FoZWFkKTsKICAgIHZhciBlbmRkYXRlPXRvZGF5ZGF0ZS5nZXRGdWxsWWVhcigpKyItIisoMSt0b2RheWRhdGUuZ2V0TW9udGgoKSkrIi0iK3RvZGF5ZGF0ZS5nZXREYXRlKCk7CgogICAgLy8gZmlsdGVyIGZvciB1c2VycyB3aG8gaGF2ZSBkZWJ0CiAgICAkc2NvcGUuaGF2ZURlYnQgPSBmdW5jdGlvbihldXNlcikKICAgIHsKICAgICAgaWYgKGV1c2VyLnVzZXJfYmFsYW5jZSA8IDApCiAgICAgIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICBlbHNlCiAgICAgIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH07CgogICAgJHNjb3BlLmdvdG9DbGllbnRQYWdlID0gZnVuY3Rpb24oYnVzaW5lc3NfdXNlcl9pZCkKICAgIHsKICAgICAgLy8gbG9nRGVidWcoZXVzZXIpOwogICAgICB3aW5kb3cubG9jYXRpb24uaHJlZj0nLyMvYnVzaW5lc3NfY2xpZW50cy8nICsgYnVzaW5lc3NfdXNlcl9pZDsKICAgIH0KCiAgICB2YXIgcGF5bG9hZCA9ICdzdGFydD0nICsgc3RhcnRkYXRlICsgJyZlbmQ9JyArIGVuZGRhdGU7CiAgICB2YXIgY29uZmlnID0gewogICAgICBoZWFkZXJzOiB7J0NvbnRlbnQtVHlwZSc6J2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZDsgY2hhcnNldD1VVEYtOCd9CiAgICB9CiAgICB2YXIgcG9zdHVybCA9ICIvYXBpL2FkbWluL2V2ZW50cy9nZXRwb3N0IjsKCiAgICAkaHR0cC5wb3N0KHBvc3R1cmwsIHBheWxvYWQsIGNvbmZpZykuc3VjY2VzcyhmdW5jdGlvbihkYXRhKQogICAgewogICAgICBsb2dEZWJ1ZygiZG9uZSIpOwogICAgICAkc2NvcGUuYWRtaW5fZXZlbnRzID0gZGF0YTsKICAgIH0pOwoKICAgICRzY29wZS5zaG93RXZlbnRQb3B1cCA9IGZ1bmN0aW9uKHNlbGVjdGVkRXZlbnQpIHsKICAgICAgICBzaG93RXZlbnRQb3B1cChzZWxlY3RlZEV2ZW50LCAkdWliTW9kYWwpCiAgICB9OwogICAgJHNjb3BlLmVkaXRFdmVudD0gZnVuY3Rpb24gKHRoZWV2ZW50KQogICAgewogICAgICBnb3RvRXZlbnRQYWdlKHRoZWV2ZW50KTsKICAgIH0KfSk7CgovLyBrdXplQXBwLmNvbnRyb2xsZXIoJ0J1c2luZXNzQ29uZmlnQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRyb3V0ZVBhcmFtcywgJGxvY2F0aW9uLCAkcm91dGUsIHNoYXJlZERhdGEpIHsKCmt1emVBcHAuY29udHJvbGxlcignQ29uZmlnVXNlckNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICR1aWJNb2RhbCwgJGh0dHAsICR0aW1lb3V0KQp7CiAgJHNjb3BlLmluVGhlTWlkZGxlT2ZTYXZlPWZhbHNlOwoKICBsb2dEZWJ1ZygiQ29uZmlnVXNlckNvbnRyb2xsZXIiKTsKICAvLyAkc2NvcGUuYWpheF9pbmZvPSLXlNep15nXoNeV15nXmdedINeg16nXnteo15UiOwoKICBnZXRMb2dnZWRVc2VySW5mbygkaHR0cCwkc2NvcGUsJ3VzZXJQcm9wZXJ0aWVzJyxnZXRMb2dnZWRVc2VySW5mb19zdWNjZXNzLGdldExvZ2dlZFVzZXJJbmZvX2ZhaWx1cmUpOwogIGZ1bmN0aW9uIGdldExvZ2dlZFVzZXJJbmZvX3N1Y2Nlc3MoKQogIHsKICAgIGxvZ0RlYnVnKCJnZXRMb2dnZWRVc2VySW5mb19zdWNjZXNzIik7CiAgICAkc2NvcGUudXNlclByb3BlcnRpZXNEdXBsaWNhdGUgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KCRzY29wZS51c2VyUHJvcGVydGllcykpOwogIH0KICBmdW5jdGlvbiBnZXRMb2dnZWRVc2VySW5mb19mYWlsdXJlKCkKICB7CiAgICBsb2dEZWJ1ZygiZ2V0TG9nZ2VkVXNlckluZm9fZmFpbHVyZSIpOwogIH0KCiAgJHNjb3BlLmJhY2sgPSBmdW5jdGlvbigpIHsKICAgIHdpbmRvdy5oaXN0b3J5LmJhY2soKTsKICB9OwoKICAkc2NvcGUuY2hhbmdlUGFzc3dvcmRNb2RhbCA9IGZ1bmN0aW9uKCkKICB7CiAgICAkc2NvcGUuaW5UaGVNaWRkbGVPZlNhdmU9dHJ1ZTsKICAgIGZ1bmN0aW9uIHNtc1Jlc2V0UGFzc3dvcmRfc3VjY2VzcygpCiAgICB7CiAgICAgIGNvbnNvbGUubG9nKCJzbXNSZXNldFBhc3N3b3JkX3N1Y2Nlc3MiKTsKICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgICAgICAgICBhbmltYXRpb246IGZhbHNlLAogICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnbW9kYWxfY2hhbmdlX3Bhc3N3b3JkLnBocCcsCiAgICAgICAgICBjb250cm9sbGVyOiAnbW9kYWxfY2hhbmdlX3Bhc3N3b3JkJywKICAgICAgICAgIHNpemU6ICdsJywKICAgICAgICAgIHJlc29sdmU6IHsKICAgICAgICAgICAgICB1c2VyX3Bob25lX251bWJlcjogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIC8vIHBhc3Npbmcgb3JpZ2luYWwgcGhvbmUgbnVtYmVyCiAgICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUudXNlclByb3BlcnRpZXNEdXBsaWNhdGVbMF0ucGhvbmVfbnVtYmVyOwogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgfSk7CgogICAgICBtb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHJlc3VsdCkgewogICAgICAgICRzY29wZS5pblRoZU1pZGRsZU9mU2F2ZT1mYWxzZTsKICAgICAgICBsb2dEZWJ1Zygnc21zUmVzZXRQYXNzd29yZCBNb2RhbCBmaW5pc2VoZCByZXN1bHQ6ICcgKyByZXN1bHQpOwogICAgICAgICRzY29wZS5hamF4X2luZm89IteU16HXmdeh157XkCDXoteV15PXm9eg15Qg15HXlNem15zXl9eUISI7CiAgICAgICAgLy8gZ2V0TG9nZ2VkVXNlckluZm8oJGh0dHAsJHNjb3BlLCd1c2VyUHJvcGVydGllcycsZ2V0TG9nZ2VkVXNlckluZm9fc3VjY2VzcyxnZXRMb2dnZWRVc2VySW5mb19mYWlsdXJlKTsKICAgICAgICAkdGltZW91dChmdW5jdGlvbigpCiAgICAgICAgewogICAgICAgICAgJHNjb3BlLmFqYXhfaW5mbz1udWxsOwogICAgICAgIH0sIDIwMDApOwogICAgICAgICAgbG9nRGVidWcoJ3Ntc1Jlc2V0UGFzc3dvcmQgTW9kYWwgZGlzbWlzc2VkIGF0OiAnICsgbmV3IERhdGUoKSk7CiAgICAgIH0sIGZ1bmN0aW9uKCkgewogICAgICAgICAgJHNjb3BlLmluVGhlTWlkZGxlT2ZTYXZlPWZhbHNlOwogICAgICAgICAgbG9nRGVidWcoJ21vZGFsX2NoYW5nZV9wYXNzd29yZCBNb2RhbCBkaXNtaXNzZWQgYXQ6ICcgKyBuZXcgRGF0ZSgpKTsKICAgICAgfSk7CiAgICB9CgoKICAgIGNoYW5nZVBhc3N3b3JkU01TKCRodHRwLCRzY29wZSwkc2NvcGUudXNlclByb3BlcnRpZXNEdXBsaWNhdGVbMF0ucGhvbmVfbnVtYmVyLHNtc1Jlc2V0UGFzc3dvcmRfc3VjY2Vzcyk7CiAgfQogICRzY29wZS51cGRhdGVVc2VyQ29uZmlnPWZ1bmN0aW9uKCkKICB7CiAgICAkc2NvcGUuaW5UaGVNaWRkbGVPZlNhdmU9dHJ1ZTsKICAgIGxvZ0RlYnVnKCJ1cGRhdGVVc2VyQ29uZmlnLCBpblRoZU1pZGRsZU9mU2F2ZT0iKyRzY29wZS5pblRoZU1pZGRsZU9mU2F2ZSk7CiAgICAvLyBsb2dEZWJ1Zygkc2NvcGUudXNlclByb3BlcnRpZXNEdXBsaWNhdGUpOwogICAgLy8gbG9nRGVidWcoJHNjb3BlLnVzZXJQcm9wZXJ0aWVzKTsKICAgIGlmIChhbmd1bGFyLmVxdWFscygkc2NvcGUudXNlclByb3BlcnRpZXNEdXBsaWNhdGVbMF0ucGhvbmVfbnVtYmVyLCRzY29wZS51c2VyUHJvcGVydGllc1swXS5waG9uZV9udW1iZXIpKQogICAgewogICAgICBsb2dEZWJ1Zygibm90aGluZyBjaGFuZ2VkIGluIHBob25lIG51bWJlciwgY2hlY2tpbmcgb3RoZXIgZGF0YSBvdGhlciBkYXRhIik7CiAgICAgIGlmIChhbmd1bGFyLmVxdWFscygkc2NvcGUudXNlclByb3BlcnRpZXNEdXBsaWNhdGVbMF0sJHNjb3BlLnVzZXJQcm9wZXJ0aWVzWzBdKSkKICAgICAgewogICAgICAgICRzY29wZS5pblRoZU1pZGRsZU9mU2F2ZT1mYWxzZTsKICAgICAgICBsb2dEZWJ1Zygibm90aGluZyBjaGFuZ2VkIGluIGRldGFpbHMsIG5vdGhpbmcgdG8gc2F2ZSIpOwogICAgICAgICRzY29wZS5hamF4X2luZm89Itec15Ag15HXldem16LXlSDXqdeZ16DXldeZ15nXnSDXnNep157Xmdeo15QuLi4iOwogICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkKICAgICAgICB7CiAgICAgICAgICAkc2NvcGUuYWpheF9pbmZvPW51bGw7CiAgICAgICAgfSwgMTUwMCk7CiAgICAgIH0KICAgICAgZWxzZQogICAgICB7CiAgICAgICAgY2hhbmdlVXNlckRldGFpbHMoJGh0dHAsJHNjb3BlLCRzY29wZS51c2VyUHJvcGVydGllc1swXS5maXJzdF9uYW1lLCRzY29wZS51c2VyUHJvcGVydGllc1swXS5sYXN0X25hbWUsICRzY29wZS51c2VyUHJvcGVydGllc1swXS5lbWFpbF9hZGRyZXNzLGNoYW5nZVVzZXJEZXRhaWxzX3N1Y2Nlc3MsIGNoYW5nZVVzZXJEZXRhaWxzX2ZhaWx1cmUpOwogICAgICAgICRzY29wZS5hamF4X2luZm89Itee16LXk9eb158g16nXmdeg15XXmdeZ150uLi4iOwogICAgICB9CgogICAgICBmdW5jdGlvbiBjaGFuZ2VVc2VyRGV0YWlsc19zdWNjZXNzKCkKICAgICAgewogICAgICAgIGxvZ0RlYnVnKCJjaGFuZ2VVc2VyRGV0YWlsc19zdWNjZXNzIik7CiAgICAgICAgJHNjb3BlLmFqYXhfaW5mbz0i15TXqdeZ16DXldeZ15nXnSDXoNep157XqNeVINeR15TXptec15fXlCEiOwogICAgICAgICRzY29wZS5pblRoZU1pZGRsZU9mU2F2ZT1mYWxzZTsKICAgICAgICAkdGltZW91dChmdW5jdGlvbigpCiAgICAgICAgewogICAgICAgICAgJHNjb3BlLmFqYXhfaW5mbz1udWxsOwogICAgICAgIH0sIDE1MDApOwogICAgICAgIGdldExvZ2dlZFVzZXJJbmZvKCRodHRwLCRzY29wZSwndXNlclByb3BlcnRpZXMnLGdldExvZ2dlZFVzZXJJbmZvX3N1Y2Nlc3MsZ2V0TG9nZ2VkVXNlckluZm9fZmFpbHVyZSk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gY2hhbmdlVXNlckRldGFpbHNfZmFpbHVyZSgpCiAgICAgIHsKICAgICAgICBsb2dEZWJ1ZygiY2hhbmdlVXNlckRldGFpbHNfZmFpbHVyZSIpOwogICAgICB9CgogICAgfQogICAgZWxzZQogICAgewogICAgICAvLyB1cGRhdGUgdXNlciBpbmZvIC0gYWZ0ZXIgdmVyaWZ5aW5nIHBhc3N3b3JkCiAgICAgIGNvbnNvbGUubG9nKCJwaG9uZSBjaGFuZ2VkLCBjaGVja2luZyBpZiBuZXcgcGhvbmUgaXMgaW4gZGVzY2VudCBmb3JtYXQiKTsKICAgICAgaWYgKCFjaGVja1Bob25lTnVtYmVyKCRzY29wZS51c2VyUHJvcGVydGllc1swXS5waG9uZV9udW1iZXIpKQogICAgICB7CiAgICAgICAgJHNjb3BlLmFqYXhfaW5mbz0i15DXoNeQINeU15bXnyDXnteh16TXqCDXmNec16TXldefINeh15zXldec16jXmSDXqten15nXnyDXnNen15HXnNeqINeU15XXk9ei15XXqiDXnten15nXldeWLiI7CiAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKQogICAgICAgIHsKICAgICAgICAgICRzY29wZS5hamF4X2luZm89bnVsbDsKICAgICAgICB9LCAzMDAwKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgY29uc29sZS5sb2coInBob25lIGNoYW5nZWQsIGNoZWNraW5nIGlmIG5ldyBwaG9uZSBpcyBub3QgdXNlZCBhbHJlYWR5Iik7CiAgICAgIGlzTmV3UGhvbmVVc2VkSWZOb3RTZW5kU01TKCRodHRwLCRzY29wZSwkc2NvcGUudXNlclByb3BlcnRpZXNbMF0ucGhvbmVfbnVtYmVyLCBpc05ld1Bob25lVXNlZF9zdWNjZXNzLCBpc05ld1Bob25lVXNlZF9mYWlsdXJlLGZhbHNlKTsKICAgICAgZnVuY3Rpb24gaXNOZXdQaG9uZVVzZWRfc3VjY2VzcyhyZXNwb25zZSkKICAgICAgewogICAgICAgIGNvbnNvbGUubG9nKCJwaG9uZSBub3QgdXNlZCAtIHByb21wdGluZyBmb3IgcGFzc3dvcmQiKTsKICAgICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAgICAgICAgICAgYW5pbWF0aW9uOiBmYWxzZSwKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnbW9kYWxfY2hlY2tfcGFzc3dvcmRfdXBkYXRlX2NvbmZpZy5waHAnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnbW9kYWxfY2hlY2tfcGFzc3dvcmRfdXBkYXRlX2NvbmZpZycsCiAgICAgICAgICAgIHNpemU6ICdsJywKICAgICAgICAgICAgcmVzb2x2ZTogewogICAgICAgICAgICAgIG5ld191c2VyX3Byb2VydGllczogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUudXNlclByb3BlcnRpZXNbMF07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIG1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7CiAgICAgICAgICAgIGxvZ0RlYnVnKCdtb2RhbF9jaGVja19wYXNzd29yZF91cGRhdGVfY29uZmlnIE1vZGFsIGZpbmlzaGVkIHJlc3VsdDogJyArIHJlc3VsdCk7CiAgICAgICAgICAgICRzY29wZS5hamF4X2luZm89IteU16nXmdeg15XXmdeZ150g16DXqdee16jXlSDXkdeU16bXnNeX15QhIjsKICAgICAgICAgICAgJHNjb3BlLmluVGhlTWlkZGxlT2ZTYXZlPWZhbHNlOwogICAgICAgICAgICBnZXRMb2dnZWRVc2VySW5mbygkaHR0cCwkc2NvcGUsJ3VzZXJQcm9wZXJ0aWVzJyxnZXRMb2dnZWRVc2VySW5mb19zdWNjZXNzLGdldExvZ2dlZFVzZXJJbmZvX2ZhaWx1cmUpOwogICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAkc2NvcGUuYWpheF9pbmZvPW51bGw7CiAgICAgICAgICAgIH0sIDMwMDApOwogICAgICAgIH0sIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAkc2NvcGUuaW5UaGVNaWRkbGVPZlNhdmU9ZmFsc2U7CiAgICAgICAgICAgIGxvZ0RlYnVnKCdtb2RhbF9jaGVja19wYXNzd29yZF91cGRhdGVfY29uZmlnIE1vZGFsIGRpc21pc3NlZCBhdDogJyArIG5ldyBEYXRlKCkpOwogICAgICAgIH0pOwogICAgICB9CgogICAgICBmdW5jdGlvbiBpc05ld1Bob25lVXNlZF9mYWlsdXJlKHJlc3BvbnNlKQogICAgICB7CiAgICAgICAgJHNjb3BlLmFqYXhfaW5mbz1yZXNwb25zZS5tZXNzYWdlOwogICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkKICAgICAgICB7CiAgICAgICAgICAkc2NvcGUuYWpheF9pbmZvPW51bGw7CiAgICAgICAgfSwgMjAwMCk7CiAgICAgIH0KICAgIH0KICB9Owp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ21vZGFsX2NoZWNrX3Bhc3N3b3JkX3VwZGF0ZV9jb25maWcnLCBmdW5jdGlvbigkc2NvcGUsICR0aW1lb3V0LCAkdWliTW9kYWxJbnN0YW5jZSwgbmV3X3VzZXJfcHJvZXJ0aWVzLCAkaHR0cCkKewogICRzY29wZS5uZXdfdXNlcl9wcm9lcnRpZXM9bmV3X3VzZXJfcHJvZXJ0aWVzOwogIGxvZ0RlYnVnKCJtb2RhbF9jaGVja19wYXNzd29yZF91cGRhdGVfY29uZmlnIGNvbnRyb2xsZXIiKTsKICAvLyAkc2NvcGUucGhvbmVfdmVyaWZpY2F0aW9uID0ge307IC8vIHRoZXNlIGFyZSB0aGUgY29tcGxldGUgZGV0YWlscyBmb3IgdGhlIG5ldyBldmVudCAvLwogIC8vICRzY29wZS5waG9uZV92ZXJpZmljYXRpb24ucGhvbmVfbnVtYmVyPW5ld191c2VyX3Byb2VydGllcy5waG9uZV9udW1iZXI7CiAgJHNjb3BlLmNsb3NlID0gZnVuY3Rpb24oKSB7CiAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCdkaXNtaXNzJyk7CiAgfTsKCiAgJHNjb3BlLmNoYW5nZVBob25lTnVtYmVyID0gZnVuY3Rpb24oKQogIHsKICAgIGNoYW5nZVVzZXJEZXRhaWxzVmVyaWZ5KCRodHRwLCRzY29wZSwkc2NvcGUubmV3X3VzZXJfcHJvZXJ0aWVzLnBob25lX251bWJlciwkc2NvcGUubmV3X3VzZXJfcHJvZXJ0aWVzLmZpcnN0X25hbWUsJHNjb3BlLm5ld191c2VyX3Byb2VydGllcy5sYXN0X25hbWUsICRzY29wZS5uZXdfdXNlcl9wcm9lcnRpZXMuZW1haWxfYWRkcmVzcywkc2NvcGUudmVyaWZ5X3VzZXJfcGFzc3dvcmQsJHNjb3BlLnBob25lX3ZlcmlmaWNhdGlvbixjaGFuZ2VVc2VyRGV0YWlsc1ZlcmlmeV9zdWNjZXNzLCBjaGFuZ2VVc2VyRGV0YWlsc1ZlcmlmeV9mYWlsdXJlLGZhbHNlKTsKICAgIGZ1bmN0aW9uIGNoYW5nZVVzZXJEZXRhaWxzVmVyaWZ5X3N1Y2Nlc3MoKQogICAgewogICAgICBsb2dEZWJ1ZygiY2hhbmdlVXNlckRldGFpbHNWZXJpZnlfc3VjY2VzcyIpOwogICAgICAvLyBhbGVydCgn15TXqdeZ16DXldeZ15nXnSDXoteV15PXm9eg15Ug15HXlNem15zXl9eUJyk7CiAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKHRydWUpOwogICAgfQogICAgZnVuY3Rpb24gY2hhbmdlVXNlckRldGFpbHNWZXJpZnlfZmFpbHVyZShyZXNwb25zZSkKICAgIHsKICAgICAgbG9nRGVidWcoImNoYW5nZVVzZXJEZXRhaWxzVmVyaWZ5X2ZhaWx1cmUgIityZXNwb25zZS5tZXNzYWdlKTsKICAgICAgJHNjb3BlLmFqYXhfZXJyb3I9cmVzcG9uc2UubWVzc2FnZSsiLiI7CiAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkKICAgICAgewogICAgICAgICRzY29wZS5hamF4X2Vycm9yPW51bGw7CiAgICAgIH0sIDQwMDApOwogICAgfQogIH0KfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdtb2RhbF9jaGFuZ2VfcGFzc3dvcmQnLCBmdW5jdGlvbigkc2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCB1c2VyX3Bob25lX251bWJlciwgJGh0dHApCnsKICBsb2dEZWJ1ZygibW9kYWxfY2hhbmdlX3Bhc3N3b3JkIGNvbnRyb2xsZXIiKTsKICAkc2NvcGUucGhvbmVfdmVyaWZpY2F0aW9uID0ge307IC8vIHRoZXNlIGFyZSB0aGUgY29tcGxldGUgZGV0YWlscyBmb3IgdGhlIG5ldyBldmVudCAvLwogICRzY29wZS5waG9uZV92ZXJpZmljYXRpb24ucGhvbmVfbnVtYmVyPXVzZXJfcGhvbmVfbnVtYmVyOwogICRzY29wZS5waG9uZV92ZXJpZmljYXRpb24uc21zX2Vycm9yPSIiOwogICRzY29wZS5jbG9zZSA9IGZ1bmN0aW9uKCkgewogICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnZGlzbWlzcycpOwogIH07CgogICRzY29wZS5jaGFuZ2VQYXNzd29yZCA9IGZ1bmN0aW9uKCkKICB7CiAgICBjaGFuZ2VQYXNzd29yZCgkaHR0cCwkc2NvcGUsJHNjb3BlLnBob25lX3ZlcmlmaWNhdGlvbi51c2VyX3Bhc3N3b3JkLCRzY29wZS5waG9uZV92ZXJpZmljYXRpb24udXNlcl9wYXNzd29yZDIsJHNjb3BlLnBob25lX3ZlcmlmaWNhdGlvbi52ZXJpZmljYXRpb25fY29kZSwgY2hhbmdlUGFzc3dvcmRfc3VjY2VzcywgY2hhbmdlUGFzc3dvcmRfZmFpbHVyZSxmYWxzZSk7CiAgICAkc2NvcGUuYWpheF9lcnJvcj0iIjsKICAgIGZ1bmN0aW9uIGNoYW5nZVBhc3N3b3JkX3N1Y2Nlc3MoKQogICAgewogICAgICBsb2dEZWJ1ZygiY2hhbmdlUGFzc3dvcmRfc3VjY2VzcyIpOwogICAgICBzdGF0dXM9ImZmZmZmIjsKICAgICAgLy8gYWxlcnQoJ9eU16HXmdeh157XkCDXoteV15PXm9eg15Qg15HXlNem15zXl9eUJyk7CiAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKHRydWUpOwogICAgfQogICAgZnVuY3Rpb24gY2hhbmdlUGFzc3dvcmRfZmFpbHVyZShyZXNwb25zZSkKICAgIHsKICAgICAgbG9nRGVidWcoImNoYW5nZVBhc3N3b3JkX2ZhaWx1cmUgIityZXNwb25zZS5tZXNzYWdlKTsKICAgICAgJHNjb3BlLmFqYXhfZXJyb3I9cmVzcG9uc2UubWVzc2FnZTsKICAgIH0KICB9Cn0pOwoKa3V6ZUFwcC5mYWN0b3J5KCdCdXNpbmVzc0NvbmZpZycsIGZ1bmN0aW9uKCRodHRwKSB7CiAgICByZXR1cm4gewogICAgICAgIGdldDogZnVuY3Rpb24gKCkgewogICAgICAgICAgbG9nRGVidWcoImxvYWQgZ2V0X2J1c2luZXNzX2NvbmZpZyIpOwogICAgICAgICAgcmV0dXJuICRodHRwLmdldCgiL2FwaS9hZG1pbi9idXNpbmVzc19jb25maWciKQogICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkgewogICAgICAgICAgICAgIHJlc3VsdCA9IHJlc3BvbnNlLmRhdGFbMF07CiAgICAgICAgICAgICAgcmVzdWx0LnVzZV9ob2xpZGF5cz0hIXBhcnNlSW50KHJlc3BvbnNlLmRhdGFbMF0udXNlX2hvbGlkYXlzKTsKICAgICAgICAgICAgICByZXN1bHQuc21zX25vdGlmaWNhdGlvbnM9ISFwYXJzZUludChyZXNwb25zZS5kYXRhWzBdLnNtc19ub3RpZmljYXRpb25zKTsKICAgICAgICAgICAgICByZXN1bHQuc3RhcnRfaW52b2ljZV9udW1iZXIgPSBwYXJzZUludChyZXNwb25zZS5kYXRhWzBdLnN0YXJ0X2ludm9pY2VfbnVtYmVyKTsKICAgICAgICAgICAgICB2YXIgZCA9IG5ldyBEYXRlKCk7CiAgICAgICAgICAgICAgZC5zZXRIb3VycyggcmVzdWx0LmNhbGVuZGFyX2Rpc3BsYXlfc3RhcnRfaG91cnMgKTsKICAgICAgICAgICAgICBkLnNldE1pbnV0ZXMoIHJlc3VsdC5jYWxlbmRhcl9kaXNwbGF5X3N0YXJ0X21pbnV0ZXMgKTsKICAgICAgICAgICAgICByZXN1bHQubXl0aW1lID0gZDsKICAgICAgICAgICAgICByZXN1bHQuY2FsZW5kYXJfZGlzcGxheV9zdGFydCA9IGQ7CiAgICAgICAgICAgICAgdmFyIGQgPSBuZXcgRGF0ZSgpOwogICAgICAgICAgICAgIGQuc2V0SG91cnMoIHJlc3VsdC5jYWxlbmRhcl9kaXNwbGF5X2VuZF9ob3VycyApOwogICAgICAgICAgICAgIGQuc2V0TWludXRlcyggcmVzdWx0LmNhbGVuZGFyX2Rpc3BsYXlfZW5kX21pbnV0ZXMgKTsKICAgICAgICAgICAgICByZXN1bHQubXl0aW1lID0gZDsKICAgICAgICAgICAgICByZXN1bHQuY2FsZW5kYXJfZGlzcGxheV9lbmQgPSBkOwogICAgICAgICAgICAgIHJlc3VsdC52YXRfcmF0ZSA9IE51bWJlcihyZXN1bHQudmF0X3JhdGUpOwogICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9Owp9KTsKCmt1emVBcHAuY29udHJvbGxlcignQ29uZmlnQnVzaW5lc3NDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJHRpbWVvdXQsIEJ1c2luZXNzQ29uZmlnKQp7CiAgbG9nRGVidWcoIm15IGJ1c2luZXNzIGNvbmZpZyIpOwogICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzPVtdOwoKICBmdW5jdGlvbiBnZXRfYnVzaW5lc3NfY29uZmlnKCkgewogICAgbG9nRGVidWcoImdldF9idXNpbmVzc19jb25maWciKTsKICAgIGxvZ0RlYnVnKCJCdXNpbmVzc0NvbmZpZzogIiwgQnVzaW5lc3NDb25maWcpOwogICAgQnVzaW5lc3NDb25maWcuZ2V0KCkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7ICRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMgPSByZXN1bHQ7IH0pOwogIH0KICBnZXRfYnVzaW5lc3NfY29uZmlnKCk7CgoKICAkc2NvcGUuaHN0ZXAgPSAxOwogICRzY29wZS5tc3RlcCA9IDE1OwoKICAgICRzY29wZS5idXNpbmVzc0NvbmZpZ0NhbmNlbCA9IGZ1bmN0aW9uKCkgewogICAgICB3aW5kb3cuaGlzdG9yeS5iYWNrKCk7CiAgICB9OwoKICAgICRzY29wZS51cGRhdGVCdXNpbmVzc0NvbmZpZyA9IGZ1bmN0aW9uKCkgewogICAgICAgIGxvZ0RlYnVnKCJ1cGRhdGluZyBidXNpbmVzcyBjb25maWciICsgSlNPTi5zdHJpbmdpZnkoJHNjb3BlLmJ1c2luZXNzUHJvcGVydGllcykpOwoKICAgICAgICAkc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzX2FqYXhfZXJyb3I9IiI7CiAgICAgICAgJHNjb3BlLmJ1c2luZXNzUHJvcGVydGllcy5jYWxlbmRhcl9kaXNwbGF5X3N0YXJ0X2hvdXJzPSRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMuY2FsZW5kYXJfZGlzcGxheV9zdGFydC5nZXRIb3VycygpOwogICAgICAgICRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMuY2FsZW5kYXJfZGlzcGxheV9zdGFydF9taW51dGVzPSRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMuY2FsZW5kYXJfZGlzcGxheV9zdGFydC5nZXRNaW51dGVzKCk7CiAgICAgICAgJHNjb3BlLmJ1c2luZXNzUHJvcGVydGllcy5jYWxlbmRhcl9kaXNwbGF5X2VuZF9ob3Vycz0kc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzLmNhbGVuZGFyX2Rpc3BsYXlfZW5kLmdldEhvdXJzKCk7CiAgICAgICAgJHNjb3BlLmJ1c2luZXNzUHJvcGVydGllcy5jYWxlbmRhcl9kaXNwbGF5X2VuZF9taW51dGVzPSRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMuY2FsZW5kYXJfZGlzcGxheV9lbmQuZ2V0TWludXRlcygpOwogICAgICAgIGlmICgkc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzLmNhbGVuZGFyX2Rpc3BsYXlfc3RhcnRfaG91cnM+JHNjb3BlLmJ1c2luZXNzUHJvcGVydGllcy5jYWxlbmRhcl9kaXNwbGF5X2VuZF9ob3VycykKICAgICAgICB7CiAgICAgICAgICBhbGVydCgn15bXntefINeh15nXldedINec15Ag15nXm9eV15wg15zXlNeZ15XXqiDXnNek16DXmSDXltee158g15TXqteX15zXlCcpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICAkc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzX2FqYXhfZXJyb3I9Itee16LXk9eb158g16DXqteV16DXmdedLi4uIjsKCiAgICAgICAgJGh0dHAoewogICAgICAgICAgICBtZXRob2Q6ICdQT1NUJywKICAgICAgICAgICAgdXJsOiAnL2FwaS9hZG1pbi9idXNpbmVzc19jb25maWcvc2V0JywKICAgICAgICAgICAgZGF0YTogJHNjb3BlLmJ1c2luZXNzUHJvcGVydGllcywgLy8gcGFzcyBpbiBkYXRhIGFzIHN0cmluZ3MKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uO2NoYXJzZXQ9dXRmLTgnCiAgICAgICAgICAgIH0KICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHsKCiAgICAgICAgICAgIGxvZ0RlYnVnKGRhdGEpOwogICAgICAgICAgICBpZiAoIWRhdGEuc3VjY2VzcykgewogICAgICAgICAgICAgICAgbG9nRGVidWcoImVycm9yICIgKyBkYXRhLk1lc3NhZ2UpOwogICAgICAgICAgICAgICAgJHNjb3BlLmJ1c2luZXNzUHJvcGVydGllc19hamF4X2Vycm9yID0gZGF0YS5NZXNzYWdlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJGdDYWxlbmRhckRpc3BsYXlNaW5UaW1lPWRhdGEuanNvbi5uZXdTdGFydFRpbWU7CiAgICAgICAgICAgICAgICAkZ0NhbGVuZGFyRGlzcGxheU1heFRpbWU9ZGF0YS5qc29uLm5ld0VuZFRpbWU7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygidXBkYXRlZCBnQ2FsZW5kYXJEaXNwbGF5TWluVGltZT0iKyRnQ2FsZW5kYXJEaXNwbGF5TWluVGltZSk7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygidXBkYXRlZCBnQ2FsZW5kYXJEaXNwbGF5TWF4VGltZT0iKyRnQ2FsZW5kYXJEaXNwbGF5TWF4VGltZSk7CiAgICAgICAgICAgICAgICAkc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzX2FqYXhfZXJyb3I9Itei15XXk9eb158g15HXlNem15zXl9eUISI7CiAgICAgICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXNfYWpheF9lcnJvcj1udWxsOwogICAgICAgICAgICAgICAgfSwgMjAwMCk7CiAgICAgICAgICAgICAgICBnZXRfYnVzaW5lc3NfY29uZmlnKCk7CiAgICAgICAgICAgICAgICAvLyB3aW5kb3cuaGlzdG9yeS5iYWNrKCk7CiAgICAgICAgICAgICAgICAvLyAkc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzX2FqYXhfZXJyb3IgPSAi16TXqNeY15kg15TXoteh16cg16DXqdee16jXlSDXkdeU16bXnNeX15QuIjsKCiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH07Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignY2xpZW50Q2FyZENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUpIHsKICAgIGxvZ0RlYnVnKCJjbGllbnRDYXJkQ29udHJvbGxlciIpOwogICAgJHNjb3BlLmZ1dHVyZU1lZXRpbmdzID0gW3sKICAgICAgICBkYXRldGltZTogIteo15DXqdeV158sIDI1LjEuMjAxNiIsCiAgICAgICAgaG91cjogIjE0OjAwIiwKICAgICAgICB0eXBlOiAi16fXkdeV16bXlCIsCiAgICAgICAgcHJpY2U6ICIxMDAiLAogICAgICAgIGxhYmVsczogW3sKICAgICAgICAgICAgbGFiZWw6ICJzdWNjZXNzIiwKICAgICAgICAgICAgdGV4dDogItep15XXnNedIgogICAgICAgIH0sIHsKICAgICAgICAgICAgbGFiZWw6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgdGV4dDogItec15Ag16rXldei15MiCiAgICAgICAgfV0KICAgIH0sIHsKICAgICAgICBkYXRldGltZTogIteo15DXqdeV158sIDI1LjEuMjAxNiIsCiAgICAgICAgaG91cjogIjE0OjAwIiwKICAgICAgICB0eXBlOiAi16fXkdeV16bXlCIsCiAgICAgICAgcHJpY2U6ICIxMDAiLAogICAgICAgIGxhYmVsczogW3sKICAgICAgICAgICAgbGFiZWw6ICJkYW5nZXIiLAogICAgICAgICAgICB0ZXh0OiAi15zXkCDXqdeV15zXnSIKICAgICAgICB9LCB7CiAgICAgICAgICAgIGxhYmVsOiAiaW5mbyIsCiAgICAgICAgICAgIHRleHQ6ICLXqteV16LXkyIKICAgICAgICB9XQogICAgfSwgewogICAgICAgIGRhdGV0aW1lOiAi16nXnNeZ16nXmSwgMjUuMS4yMDE2IiwKICAgICAgICBob3VyOiAiMTQ6MDAiLAogICAgICAgIHR5cGU6ICLXp9eR15XXpteUIiwKICAgICAgICBwcmljZTogIjEwMCIsCiAgICAgICAgbGFiZWxzOiBbewogICAgICAgICAgICBsYWJlbDogImRhbmdlciIsCiAgICAgICAgICAgIHRleHQ6ICLXnNeQINep15XXnNedIgogICAgICAgIH0sIHsKICAgICAgICAgICAgbGFiZWw6ICJpbmZvIiwKICAgICAgICAgICAgdGV4dDogIteq15XXoteTIgogICAgICAgIH1dCiAgICB9LCB7CiAgICAgICAgZGF0ZXRpbWU6ICLXqNeQ16nXldefLCAyNS4xLjIwMTYiLAogICAgICAgIGhvdXI6ICIxNDowMCIsCiAgICAgICAgdHlwZTogIten15HXldem15QiLAogICAgICAgIHByaWNlOiAiMTAwIgogICAgfSwgXQoKICAgICRzY29wZS5oaXN0b3J5TWVldGluZ3MgPSBbewogICAgICAgIGRhdGV0aW1lOiAi16jXkNep15XXnywgMjUuMS4yMDE2IiwKICAgICAgICBob3VyOiAiMTQ6MDAiLAogICAgICAgIHR5cGU6ICLXp9eR15XXpteUIiwKICAgICAgICBwcmljZTogIjEwMCIKICAgIH0sIHsKICAgICAgICBkYXRldGltZTogIteo15DXqdeV158sIDI1LjEuMjAxNiIsCiAgICAgICAgaG91cjogIjE0OjAwIiwKICAgICAgICB0eXBlOiAi16fXkdeV16bXlCIsCiAgICAgICAgcHJpY2U6ICIxMDAiCiAgICB9LCB7CiAgICAgICAgZGF0ZXRpbWU6ICLXqdec15nXqdeZLCAyNS4xLjIwMTYiLAogICAgICAgIGhvdXI6ICIxNDowMCIsCiAgICAgICAgdHlwZTogIten15HXldem15QiLAogICAgICAgIHByaWNlOiAiMTAwIgogICAgfSwgewogICAgICAgIGRhdGV0aW1lOiAi16jXkNep15XXnywgMjUuMS4yMDE2IiwKICAgICAgICBob3VyOiAiMTQ6MDAiLAogICAgICAgIHR5cGU6ICLXp9eR15XXpteUIiwKICAgICAgICBwcmljZTogIjEwMCIKICAgIH0sIF0KCiAgICAkc2NvcGUuY2NQYXltZW50cyA9IFt7CiAgICAgICAgZGF0ZXRpbWU6ICLXqNeQ16nXldefLCAyNS4xLjIwMTYiLAogICAgICAgIHJlY2lwdF9udW06ICI3NjciLAogICAgICAgIGFtb3VudDogIjMwMCIsCiAgICAgICAgbGFiZWxzOiBbewogICAgICAgICAgICBsYWJlbDogImRhbmdlciIsCiAgICAgICAgICAgIHRleHQ6ICLXnNeQINep15XXmdeZ15oiCiAgICAgICAgfSwgewogICAgICAgICAgICBsYWJlbDogImluZm8iLAogICAgICAgICAgICB0ZXh0OiAi15TXldek16fXkyIKICAgICAgICB9XQogICAgfSwgXQoKCn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdrdXplQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikgewoKICAgIC8vIG1haW4ga3V6ZSBjb250cm9sbGVyCgogICAgLy8gTVVTVCBTRVQgTEFOR1VBR0UgQkVGT1JFIEFOWSBPVEhFUiBPUEVSQVRJT04gISEhCiAgICB1cGRhdGVHbG9iYWxMYW5ndWFnZSgkc2NvcGUsICRnRGVmYXVsdExhbmcpOwogICAgLy8gTVVTVCBTRVQgTEFOR1VBR0UgQkVGT1JFIEFOWSBPVEhFUiBPUEVSQVRJT04gISEhCgogICAgLy8gbG9nRGVidWcoInh4eHh4eHh4IiArICRzY29wZS5sYW5nZmlsZVsnc2hvd19hbGxfY2xpZW50cyddKTsKCiAgICAkc2NvcGUuc2hvd0NsaWVudHNDb2x1bW5zID0gW3sKICAgICAgICBmaWVsZDogJ3VzZXJfaWQnLAogICAgICAgIG5hbWU6ICRzY29wZS5sYW5nZmlsZVsnc2hvd19hbGxfY2xpZW50c191c2VyaWQnXQogICAgfSwgewogICAgICAgIGZpZWxkOiAnYnVzZXJfZmlyc3RfbmFtZScsCiAgICAgICAgbmFtZTogJHNjb3BlLmxhbmdmaWxlWydzaG93X2FsbF9jbGllbnRzX2ZpcnN0X25hbWUnXQogICAgfSwgewogICAgICAgIGZpZWxkOiAnYnVzZXJfbGFzdF9uYW1lJywKICAgICAgICBuYW1lOiAkc2NvcGUubGFuZ2ZpbGVbJ3Nob3dfYWxsX2NsaWVudHNfbGFzdF9uYW1lJ10KICAgIH0sIHsKICAgICAgICBmaWVsZDogJ3JvbGVfbmFtZScsCiAgICAgICAgbmFtZTogJHNjb3BlLmxhbmdmaWxlWydzaG93X2FsbF9jbGllbnRzX2FwcHJvdmVkJ10KICAgIH1dOwoKCiAgICAkc2NvcGUuZ3JpZENsaWVudENsaWNrID0gZnVuY3Rpb24ocm93KSB7CiAgICAgICAgLy9sb2dEZWJ1Zyhyb3cpOwogICAgICAgIHZhciByb3dfdXNlcmlkID0gcm93LmVudGl0eS51c2VyX2lkOwogICAgICAgIGxvZ0RlYnVnKCJzZWxlY3RlZCByb3cgdXNlcl9pZCA9IiArIHJvd191c2VyaWQpOwogICAgICAgICRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfY2xpZW50cy8nICsgcm93X3VzZXJpZCk7CiAgICB9OwoKICAgICRzY29wZS5zaG93Q2xpZW50c0dyaWRPcHRpb25zID0gewogICAgICAgIGVuYWJsZUZpbHRlcmluZzogZmFsc2UsCiAgICAgICAgZW5hYmxlU29ydGluZzogdHJ1ZSwKICAgICAgICBjb2x1bW5EZWZzOiAkc2NvcGUuc2hvd0NsaWVudHNDb2x1bW5zLAogICAgICAgIHJvd1RlbXBsYXRlOiAnL3B1YmxpYy9jb21wb25lbnRzL2NsaWVudHMtZ3JpZC1yb3cuaHRtbCcsCiAgICAgICAgb25SZWdpc3RlckFwaTogZnVuY3Rpb24oZ3JpZEFwaSkgewogICAgICAgICAgICAkc2NvcGUuZ3JpZEFwaSA9IGdyaWRBcGk7CiAgICAgICAgICAgICRzY29wZS5ncmlkQXBpLmdyaWQucmVnaXN0ZXJSb3dzUHJvY2Vzc29yKCRzY29wZS5zaW5nbGVGaWx0ZXIsIDIwMCk7CiAgICAgICAgfSwKICAgIH07CgogICAgJHNjb3BlLmlzQWN0aXZlID0gZnVuY3Rpb24odmlld0xvY2F0aW9uKSB7CiAgICAgICAgbG9nRGVidWcoInZpZXdMb2NhdGlvbiA9ICIgKyB2aWV3TG9jYXRpb24pOwogICAgICAgIHZhciBhY3RpdmUgPSAodmlld0xvY2F0aW9uID09PSAkbG9jYXRpb24ucGF0aCgpKTsKICAgICAgICByZXR1cm4gYWN0aXZlOwogICAgfTsKCiAgICAkc2NvcGUuZmlsdGVyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgbG9nRGVidWcoInNpbmdsZSBmaWx0ZXIiKTsKICAgICAgICAkc2NvcGUuZ3JpZEFwaS5ncmlkLnJlZnJlc2goKTsKICAgICAgICBpZiAoJHNjb3BlLmZpbHRlci5WYWx1ZSAhPSAiIikgewogICAgICAgICAgICAkc2NvcGUuZmlsdGVyLmJ1dHRvblZhbHVlID0gIiciICsgJHNjb3BlLmZpbHRlci5WYWx1ZSArICInIjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkc2NvcGUuZmlsdGVyLmJ1dHRvblZhbHVlID0gIiI7CiAgICAgICAgfQogICAgfTsKCiAgICAkc2NvcGUuc2luZ2xlRmlsdGVyID0gZnVuY3Rpb24ocmVuZGVyYWJsZVJvd3MpIHsKICAgICAgICB2YXIgbWF0Y2hlciA9IG5ldyBSZWdFeHAoJHNjb3BlLmZpbHRlci5WYWx1ZSk7CiAgICAgICAgbG9nRGVidWcoInNjb3BlPSIgKyAkc2NvcGUpOwogICAgICAgIGxvZ0RlYnVnKCJzY29wZS5maWx0ZXIuVmFsdWU9IiArICRzY29wZS5maWx0ZXIuVmFsdWUpOwogICAgICAgIGlmICgoJHNjb3BlLmZpbHRlci5WYWx1ZSA9PSBudWxsKSB8fCAoJHNjb3BlLmZpbHRlci5WYWx1ZSA9PSAiIikpIHsKICAgICAgICAgICAgbG9nRGVidWcoImVtcHR5IGZpbHRlciIpOwogICAgICAgICAgICByZXR1cm4gcmVuZGVyYWJsZVJvd3M7CiAgICAgICAgfQogICAgICAgIHJlbmRlcmFibGVSb3dzLmZvckVhY2goZnVuY3Rpb24ocm93KSB7CiAgICAgICAgICAgIC8vCQkJbG9nRGVidWcoInJvdz0iK3Jvdyk7CiAgICAgICAgICAgIHJvdy52aXNpYmxlID0gZmFsc2U7CiAgICAgICAgICAgIHZhciAkY3VyckZpcnN0TmFtZSA9IHJvdy5lbnRpdHlbJ2ZpcnN0X25hbWUnXTsKICAgICAgICAgICAgdmFyICRjdXJyTGFzdE5hbWUgPSByb3cuZW50aXR5WydsYXN0X25hbWUnXTsKICAgICAgICAgICAgbG9nRGVidWcoImN1cnJGaXJzdE5hbWU9IiArICRjdXJyRmlyc3ROYW1lKTsKCiAgICAgICAgICAgIGlmICgkY3VyckZpcnN0TmFtZSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoJGN1cnJGaXJzdE5hbWUuaW5kZXhPZigkc2NvcGUuZmlsdGVyLlZhbHVlKSA+IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgcm93LnZpc2libGUgPSB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgLy8gcm93IGlzIG51bGwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgcm93LnZpc2libGUgPSBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCRjdXJyTGFzdE5hbWUgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKCRjdXJyTGFzdE5hbWUuaW5kZXhPZigkc2NvcGUuZmlsdGVyLlZhbHVlKSA+IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgcm93LnZpc2libGUgPSB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgLy8gcm93IGlzIG51bGwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgcm93LnZpc2libGUgPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHJldHVybiByZW5kZXJhYmxlUm93czsKICAgIH07CgogICAgLy8gaW1wb3J0YW50ISEgaW5pdGlhbGl6aW5nIGFuZ3VsYXIgZm9ybXMgYXMgYXJyYXlzCiAgICAkc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIgPSB7fTsKICAgICRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhciA9IHt9OwoKICAgIC8vIGxvZ0RlYnVnKCJsb2NhdGlvbj0iICsgJGxvY2F0aW9uKTsKICAgIC8vIGxvZ0RlYnVnKCRsb2NhdGlvbik7CgogICAgJHNjb3BlLmNoYW5nZUxhbmcgPSBmdW5jdGlvbigkbmV3bGFuZykgewogICAgICAgIGxvZ0RlYnVnKCRuZXdsYW5nKTsKICAgICAgICAvLyRzY29wZS5zcENsYXNzID0gJ3JpZ2h0JzsKICAgICAgICB1cGRhdGVHbG9iYWxMYW5ndWFnZSgkc2NvcGUsICRuZXdsYW5nKQogICAgfQoKICAgICRzY29wZS5hZGROZXdDbGllbnQgPSBmdW5jdGlvbigpIHsKICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2NsaWVudHMvYWRkJyk7CiAgICB9CiAgICAkc2NvcGUuYWRkTmV3SW5zdHJ1Y3RvciA9IGZ1bmN0aW9uKCkgewogICAgICAgICRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfaW5zdHJ1Y3RvcnMvYWRkJyk7CiAgICB9Cn0pOwoKLy8vLy8vIGJlZm9yZSBmb3JtcwprdXplQXBwLmNvbnRyb2xsZXIoJ0RlbW9Db250cm9sbGVyJywgWwogICAgJyRzY29wZScsICckYnVpbGRlcicsICckdmFsaWRhdG9yJywKICAgIGZ1bmN0aW9uKCRzY29wZSwgJGJ1aWxkZXIsICR2YWxpZGF0b3IpIHsKICAgICAgICB2YXIgY2hlY2tib3gsIHRleHRib3g7CiAgICAgICAgdGV4dGJveCA9ICRidWlsZGVyLmFkZEZvcm1PYmplY3QoJ2RlZmF1bHQnLCB7CiAgICAgICAgICAgIGlkOiAndGV4dGJveCcsCiAgICAgICAgICAgIGNvbXBvbmVudDogJ3RleHRJbnB1dCcsCiAgICAgICAgICAgIGxhYmVsOiAnTmFtZScsCiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnWW91ciBuYW1lJywKICAgICAgICAgICAgcGxhY2Vob2xkZXI6ICdZb3VyIG5hbWUnLAogICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgZWRpdGFibGU6IGZhbHNlCiAgICAgICAgfSk7CiAgICAgICAgY2hlY2tib3ggPSAkYnVpbGRlci5hZGRGb3JtT2JqZWN0KCdkZWZhdWx0JywgewogICAgICAgICAgICBpZDogJ2NoZWNrYm94JywKICAgICAgICAgICAgY29tcG9uZW50OiAnY2hlY2tib3gnLAogICAgICAgICAgICBsYWJlbDogJ1BldHMnLAogICAgICAgICAgICBkZXNjcmlwdGlvbjogJ0RvIHlvdSBoYXZlIGFueSBwZXRzPycsCiAgICAgICAgICAgIG9wdGlvbnM6IFsnRG9nJywgJ0NhdCddCiAgICAgICAgfSk7CiAgICAgICAgJGJ1aWxkZXIuYWRkRm9ybU9iamVjdCgnZGVmYXVsdCcsIHsKICAgICAgICAgICAgY29tcG9uZW50OiAnc2FtcGxlSW5wdXQnCiAgICAgICAgfSk7CiAgICAgICAgJHNjb3BlLmZvcm0gPSAkYnVpbGRlci5mb3Jtc1snZGVmYXVsdCddOwogICAgICAgICRzY29wZS5pbnB1dCA9IFtdOwogICAgICAgICRzY29wZS5kZWZhdWx0VmFsdWUgPSB7fTsKICAgICAgICAkc2NvcGUuZGVmYXVsdFZhbHVlW3RleHRib3guaWRdID0gJ2RlZmF1bHQgdmFsdWUnOwogICAgICAgICRzY29wZS5kZWZhdWx0VmFsdWVbY2hlY2tib3guaWRdID0gW3RydWUsIHRydWVdOwogICAgICAgIHJldHVybiAkc2NvcGUuc3VibWl0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiAkdmFsaWRhdG9yLnZhbGlkYXRlKCRzY29wZSwgJ2RlZmF1bHQnKS5zdWNjZXNzKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGxvZ0RlYnVnKCdzdWNjZXNzJyk7CiAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGxvZ0RlYnVnKCdlcnJvcicpOwogICAgICAgICAgICB9KTsKICAgICAgICB9OwogICAgfQpdKTsKCmt1emVBcHAuY29udHJvbGxlcignQWxlcnREZW1vQ3RybCcsIGZ1bmN0aW9uKCRzY29wZSkgewogICAgJHNjb3BlLmFsZXJ0cyA9IFt7CiAgICAgICAgdHlwZTogJ2RhbmdlcicsCiAgICAgICAgbXNnOiAnT2ggc25hcCEgQ2hhbmdlIGEgZmV3IHRoaW5ncyB1cCBhbmQgdHJ5IHN1Ym1pdHRpbmcgYWdhaW4uJwogICAgfSwgewogICAgICAgIHR5cGU6ICdzdWNjZXNzJywKICAgICAgICBtc2c6ICdXZWxsIGRvbmUhIFlvdSBzdWNjZXNzZnVsbHkgcmVhZCB0aGlzIGltcG9ydGFudCBhbGVydCBtZXNzYWdlLicKICAgIH1dOwoKICAgICRzY29wZS5hZGRBbGVydCA9IGZ1bmN0aW9uKCkgewogICAgICAgICRzY29wZS5hbGVydHMucHVzaCh7CiAgICAgICAgICAgIG1zZzogJ0Fub3RoZXIgYWxlcnQhJwogICAgICAgIH0pOwogICAgfTsKCiAgICAkc2NvcGUuY2xvc2VBbGVydCA9IGZ1bmN0aW9uKGluZGV4KSB7CiAgICAgICAgJHNjb3BlLmFsZXJ0cy5zcGxpY2UoaW5kZXgsIDEpOwogICAgfTsKfSk7CgoKZnVuY3Rpb24gaXNOdW1iZXJLZXkoZXZ0KXsKICAgIHZhciBjaGFyQ29kZSA9IChldnQud2hpY2gpID8gZXZ0LndoaWNoIDogZXZlbnQua2V5Q29kZTsKICAgIHJldHVybiAhKGNoYXJDb2RlID4gMzEgJiYgKGNoYXJDb2RlIDwgNDggfHwgY2hhckNvZGUgPiA1NykpOwo=</text>
      </register>
      <register name="t" type="4">
        <keys>
          <key char="119" code="0" mods="0" />
          <key char="105" code="0" mods="0" />
          <key char="123" code="0" mods="0" />
          <key char="32" code="0" mods="0" />
          <key char="99" code="0" mods="0" />
          <key char="111" code="0" mods="0" />
          <key char="100" code="0" mods="0" />
          <key char="101" code="0" mods="0" />
          <key char="58" code="0" mods="0" />
          <key char="32" code="0" mods="0" />
          <key char="65535" code="91" mods="130" />
          <key char="65" code="0" mods="0" />
          <key char="44" code="0" mods="0" />
          <key char="65535" code="91" mods="130" />
          <key char="119" code="0" mods="0" />
          <key char="119" code="0" mods="0" />
          <key char="105" code="0" mods="0" />
          <key char="110" code="0" mods="0" />
          <key char="97" code="0" mods="0" />
          <key char="109" code="0" mods="0" />
          <key char="101" code="0" mods="0" />
          <key char="58" code="0" mods="0" />
          <key char="32" code="0" mods="0" />
          <key char="34" code="0" mods="0" />
          <key char="65535" code="91" mods="130" />
          <key char="65" code="0" mods="0" />
          <key char="34" code="0" mods="0" />
          <key char="65535" code="91" mods="130" />
          <key char="111" code="0" mods="0" />
          <key char="125" code="0" mods="0" />
          <key char="44" code="0" mods="0" />
          <key char="65535" code="91" mods="130" />
          <key char="119" code="0" mods="0" />
          <key char="119" code="0" mods="0" />
          <key char="48" code="0" mods="0" />
        </keys>
      </register>
      <register name="5" type="4">
        <text encoding="base64">Ly8gdjExIC0gMjMgbWFyY2ggMjAxNwovL0RlZmluZSBhbiBhbmd1bGFyIG1vZHVsZSBmb3Igb3VyIGFwcAoKdmFyIGt1emVJc0NhbGVuZGFyRHJhZ2dibGU7Cmt1emVJc0NhbGVuZGFyRHJhZ2dibGUgPSB0cnVlOwoKLy8gYW5ndWxhciBtb2R1bGVzCi8vJGFuZ3VsYXJNb2R1bGVzPVsnbmdSb3V0ZScsJ3VpLmJvb3RzdHJhcCcsJ3VpLmdyaWQnXTsKJGFuZ3VsYXJNb2R1bGVzID0gWyduZ1JvdXRlJywgJ3VpLmJvb3RzdHJhcCcsICd1aS5ncmlkJywgJ2J1aWxkZXInLCAnYnVpbGRlci5jb21wb25lbnRzJywgJ3ZhbGlkYXRvci5ydWxlcycsICd1aS5jYWxlbmRhcicsICdjaGVja2xpc3QtbW9kZWwnLCAndWkuYm9vdHN0cmFwLmRhdGV0aW1lcGlja2VyJywgJ2FuZ3Vjb21wbGV0ZS1hbHQnLCAnbXVsdGlwbGVTZWxlY3QnLCdhbmd1bGFySW5saW5lRWRpdCcsJ3RleHRBbmd1bGFyJywnbmdDc3YnXTsKCnZhciBkYXlOYW1lcyA9IFsn16jXkNep15XXnycsICfXqdeg15knLCAn16nXnNeZ16nXmScsICfXqNeR15nXoteZJywgJ9eX157Xmdep15knLCAn16nXmdep15knLCAn16nXkdeqJ107CnZhciBtb250aE5hbWVzID0gWyLXmdeg15XXkNeoIiwgItek15HXqNeV15DXqCIsICLXnteo16UiLCAi15DXpNeo15nXnCIsICLXnteQ15kiLCAi15nXldeg15kiLAogICAgIteZ15XXnNeZIiwgIteQ15XXkteV16HXmCIsICLXodek15jXnteR16giLCAi15DXlden15jXldeR16giLCAi16DXldeR157XkdeoIiwgIteT16bXnteR16giCl07Cgp2YXIgbG9naW5OZXh0U2NyZWVuPSIiOwoKKGZ1bmN0aW9uKCl7RGF0ZS5zaG9ydE1vbnRocz1bIkphbiIsIkZlYiIsIk1hciIsIkFwciIsIk1heSIsIkp1biIsIkp1bCIsIkF1ZyIsIlNlcCIsIk9jdCIsIk5vdiIsIkRlYyJdLERhdGUubG9uZ01vbnRocz1bIkphbnVhcnkiLCJGZWJydWFyeSIsIk1hcmNoIiwiQXByaWwiLCJNYXkiLCJKdW5lIiwiSnVseSIsIkF1Z3VzdCIsIlNlcHRlbWJlciIsIk9jdG9iZXIiLCJOb3ZlbWJlciIsIkRlY2VtYmVyIl0sRGF0ZS5zaG9ydERheXM9WyJTdW4iLCJNb24iLCJUdWUiLCJXZWQiLCJUaHUiLCJGcmkiLCJTYXQiXSxEYXRlLmxvbmdEYXlzPVsiU3VuZGF5IiwiTW9uZGF5IiwiVHVlc2RheSIsIldlZG5lc2RheSIsIlRodXJzZGF5IiwiRnJpZGF5IiwiU2F0dXJkYXkiXTt2YXIgdD17ZDpmdW5jdGlvbigpe3JldHVybih0aGlzLmdldERhdGUoKTwxMD8iMCI6IiIpK3RoaXMuZ2V0RGF0ZSgpfSxEOmZ1bmN0aW9uKCl7cmV0dXJuIERhdGUuc2hvcnREYXlzW3RoaXMuZ2V0RGF5KCldfSxqOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZ2V0RGF0ZSgpfSxsOmZ1bmN0aW9uKCl7cmV0dXJuIERhdGUubG9uZ0RheXNbdGhpcy5nZXREYXkoKV19LE46ZnVuY3Rpb24oKXtyZXR1cm4gMD09dGhpcy5nZXREYXkoKT83OnRoaXMuZ2V0RGF5KCl9LFM6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5nZXREYXRlKCklMTA9PTEmJjExIT10aGlzLmdldERhdGUoKT8ic3QiOnRoaXMuZ2V0RGF0ZSgpJTEwPT0yJiYxMiE9dGhpcy5nZXREYXRlKCk/Im5kIjp0aGlzLmdldERhdGUoKSUxMD09MyYmMTMhPXRoaXMuZ2V0RGF0ZSgpPyJyZCI6InRoIn0sdzpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldERheSgpfSx6OmZ1bmN0aW9uKCl7dmFyIHQ9bmV3IERhdGUodGhpcy5nZXRGdWxsWWVhcigpLDAsMSk7cmV0dXJuIE1hdGguY2VpbCgodGhpcy10KS84NjRlNSl9LFc6ZnVuY3Rpb24oKXt2YXIgdD1uZXcgRGF0ZSh0aGlzLnZhbHVlT2YoKSksZT0odGhpcy5nZXREYXkoKSs2KSU3O3Quc2V0RGF0ZSh0LmdldERhdGUoKS1lKzMpO3ZhciBuPXQudmFsdWVPZigpO3JldHVybiB0LnNldE1vbnRoKDAsMSksNCE9PXQuZ2V0RGF5KCkmJnQuc2V0TW9udGgoMCwxKyg0LXQuZ2V0RGF5KCkrNyklNyksMStNYXRoLmNlaWwoKG4tdCkvNjA0OGU1KX0sRjpmdW5jdGlvbigpe3JldHVybiBEYXRlLmxvbmdNb250aHNbdGhpcy5nZXRNb250aCgpXX0sbTpmdW5jdGlvbigpe3JldHVybih0aGlzLmdldE1vbnRoKCk8OT8iMCI6IiIpKyh0aGlzLmdldE1vbnRoKCkrMSl9LE06ZnVuY3Rpb24oKXtyZXR1cm4gRGF0ZS5zaG9ydE1vbnRoc1t0aGlzLmdldE1vbnRoKCldfSxuOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZ2V0TW9udGgoKSsxfSx0OmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5nZXRGdWxsWWVhcigpLGU9dGhpcy5nZXRNb250aCgpKzE7cmV0dXJuIDEyPT09ZSYmKHQ9dCsrLGU9MCksbmV3IERhdGUodCxlLDApLmdldERhdGUoKX0sTDpmdW5jdGlvbigpe3ZhciB0PXRoaXMuZ2V0RnVsbFllYXIoKTtyZXR1cm4gdCU0MDA9PTB8fHQlMTAwIT0wJiZ0JTQ9PTB9LG86ZnVuY3Rpb24oKXt2YXIgdD1uZXcgRGF0ZSh0aGlzLnZhbHVlT2YoKSk7cmV0dXJuIHQuc2V0RGF0ZSh0LmdldERhdGUoKS0odGhpcy5nZXREYXkoKSs2KSU3KzMpLHQuZ2V0RnVsbFllYXIoKX0sWTpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldEZ1bGxZZWFyKCl9LHk6ZnVuY3Rpb24oKXtyZXR1cm4oIiIrdGhpcy5nZXRGdWxsWWVhcigpKS5zdWJzdHIoMil9LGE6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5nZXRIb3VycygpPDEyPyJhbSI6InBtIn0sQTpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldEhvdXJzKCk8MTI/IkFNIjoiUE0ifSxCOmZ1bmN0aW9uKCl7cmV0dXJuIE1hdGguZmxvb3IoMWUzKigodGhpcy5nZXRVVENIb3VycygpKzEpJTI0K3RoaXMuZ2V0VVRDTWludXRlcygpLzYwK3RoaXMuZ2V0VVRDU2Vjb25kcygpLzM2MDApLzI0KX0sZzpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldEhvdXJzKCklMTJ8fDEyfSxHOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZ2V0SG91cnMoKX0saDpmdW5jdGlvbigpe3JldHVybigodGhpcy5nZXRIb3VycygpJTEyfHwxMik8MTA/IjAiOiIiKSsodGhpcy5nZXRIb3VycygpJTEyfHwxMil9LEg6ZnVuY3Rpb24oKXtyZXR1cm4odGhpcy5nZXRIb3VycygpPDEwPyIwIjoiIikrdGhpcy5nZXRIb3VycygpfSxpOmZ1bmN0aW9uKCl7cmV0dXJuKHRoaXMuZ2V0TWludXRlcygpPDEwPyIwIjoiIikrdGhpcy5nZXRNaW51dGVzKCl9LHM6ZnVuY3Rpb24oKXtyZXR1cm4odGhpcy5nZXRTZWNvbmRzKCk8MTA/IjAiOiIiKSt0aGlzLmdldFNlY29uZHMoKX0sdTpmdW5jdGlvbigpe3ZhciB0PXRoaXMuZ2V0TWlsbGlzZWNvbmRzKCk7cmV0dXJuKDEwPnQ/IjAwIjoxMDA+dD8iMCI6IiIpK3R9LGU6ZnVuY3Rpb24oKXtyZXR1cm4vXCgoLiopXCkvLmV4ZWMoKG5ldyBEYXRlKS50b1N0cmluZygpKVsxXX0sSTpmdW5jdGlvbigpe2Zvcih2YXIgdD1udWxsLGU9MDsxMj5lOysrZSl7dmFyIG49bmV3IERhdGUodGhpcy5nZXRGdWxsWWVhcigpLGUsMSksaT1uLmdldFRpbWV6b25lT2Zmc2V0KCk7aWYobnVsbD09PXQpdD1pO2Vsc2V7aWYodD5pKXt0PWk7YnJlYWt9aWYoaT50KWJyZWFrfX1yZXR1cm4gdGhpcy5nZXRUaW1lem9uZU9mZnNldCgpPT10fDB9LE86ZnVuY3Rpb24oKXtyZXR1cm4oLXRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKTwwPyItIjoiKyIpKyhNYXRoLmFicyh0aGlzLmdldFRpbWV6b25lT2Zmc2V0KCkvNjApPDEwPyIwIjoiIikrTWF0aC5mbG9vcihNYXRoLmFicyh0aGlzLmdldFRpbWV6b25lT2Zmc2V0KCkvNjApKSsoMD09TWF0aC5hYnModGhpcy5nZXRUaW1lem9uZU9mZnNldCgpJTYwKT8iMDAiOihNYXRoLmFicyh0aGlzLmdldFRpbWV6b25lT2Zmc2V0KCklNjApPDEwPyIwIjoiIikrTWF0aC5hYnModGhpcy5nZXRUaW1lem9uZU9mZnNldCgpJTYwKSl9LFA6ZnVuY3Rpb24oKXtyZXR1cm4oLXRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKTwwPyItIjoiKyIpKyhNYXRoLmFicyh0aGlzLmdldFRpbWV6b25lT2Zmc2V0KCkvNjApPDEwPyIwIjoiIikrTWF0aC5mbG9vcihNYXRoLmFicyh0aGlzLmdldFRpbWV6b25lT2Zmc2V0KCkvNjApKSsiOiIrKDA9PU1hdGguYWJzKHRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKSU2MCk/IjAwIjooTWF0aC5hYnModGhpcy5nZXRUaW1lem9uZU9mZnNldCgpJTYwKTwxMD8iMCI6IiIpK01hdGguYWJzKHRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKSU2MCkpfSxUOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMudG9UaW1lU3RyaW5nKCkucmVwbGFjZSgvXi4rIFwoPyhbXlwpXSspXCk/JC8sIiQxIil9LFo6ZnVuY3Rpb24oKXtyZXR1cm4gNjAqLXRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKX0sYzpmdW5jdGlvbigpe3JldHVybiB0aGlzLmZvcm1hdCgiWS1tLWRcXFRIOmk6c1AiKX0scjpmdW5jdGlvbigpe3JldHVybiB0aGlzLnRvU3RyaW5nKCl9LFU6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5nZXRUaW1lKCkvMWUzfX07RGF0ZS5wcm90b3R5cGUuZm9ybWF0PWZ1bmN0aW9uKGUpe3ZhciBuPXRoaXM7cmV0dXJuIGUucmVwbGFjZSgvKFxcPykoLikvZyxmdW5jdGlvbihlLGkscil7cmV0dXJuIiI9PT1pJiZ0W3JdP3Rbcl0uY2FsbChuKTpyfSl9fSkuY2FsbCh0aGlzKTsKCmZ1bmN0aW9uIGdvdG9DbGllbnRQYWdlKGJ1c2luZXNzX3VzZXJfaWQpCnsKICB3aW5kb3cubG9jYXRpb24uaHJlZj0nLyMvYnVzaW5lc3NfY2xpZW50cy8nICsgYnVzaW5lc3NfdXNlcl9pZDsKfQpmdW5jdGlvbiBnb3RvSW5zdHJ1Y3RvclBhZ2UoYnVzaW5lc3NfdXNlcl9pZCkKewogIHdpbmRvdy5sb2NhdGlvbi5ocmVmPScvIy9idXNpbmVzc19pbnN0cnVjdG9ycy8nICsgYnVzaW5lc3NfdXNlcl9pZDsKfQoKZnVuY3Rpb24gZ290b0V2ZW50UGFnZSh0aGVldmVudCkKewogIGxvZ0RlYnVnKCJnb3RvRXZlbnRQYWdlICIrdGhlZXZlbnQpOwogIGlmICh0aGVldmVudC5pc19jbGFzcz09MSkKICB7CiAgICB3aW5kb3cubG9jYXRpb24uaHJlZj0nLyMvZXZlbnRfY2xhc3MvJyArIHRoZWV2ZW50LmV2ZW50X2lkOwogIH0KICBlbHNlCiAgewogICAgd2luZG93LmxvY2F0aW9uLmhyZWY9Jy8jL2V2ZW50LycgKyB0aGVldmVudC5ldmVudF9pZDsKICB9Cn0KCmZ1bmN0aW9uIGdvdG9Mb2NhdGlvblBhZ2UobG9jYXRpb25faWQpCnsKICBsb2dEZWJ1ZygiZ290b0xvY2F0aW9uUGFnZSAiK2xvY2F0aW9uX2lkKTsKICB3aW5kb3cubG9jYXRpb24uaHJlZj0nLyMvYnVzaW5lc3NfbG9jYXRpb25zLycgKyBsb2NhdGlvbl9pZDsKCn0KCmZ1bmN0aW9uIGdvdG9DbGllbnRFZGl0UGFnZSh1c2VyX2lkKQp7CiAgd2luZG93LmxvY2F0aW9uLmhyZWY9Jy8jL2J1c2luZXNzX2NsaWVudHMvJyArIHVzZXJfaWQgKyAnL2VkaXQnOwp9CgpmdW5jdGlvbiBnb3RvQmFjaygpCnsKICB3aW5kb3cuaGlzdG9yeS5iYWNrKCk7Cn0KCmZ1bmN0aW9uIHNob3dFdmVudFBvcHVwKHNlbGVjdGVkRXZlbnQsICR1aWJNb2RhbCkKewogIC8vIHRoaXMgZnVuY3Rpb24gdXNlZCB0byBicmluZyBhIHBvcHVwCiAgLy8gbm93IGl0IGdvZXMgdG8gdGhlIGV2ZW50IHBhZ2UKICBnb3RvRXZlbnRQYWdlKHNlbGVjdGVkRXZlbnQpOwoKICAvLyBpZiAoc2VsZWN0ZWRFdmVudC5pc19yZXBlYXRpbmcgPT0gMSkgewogIC8vICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAvLyAgICAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgLy8gICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9jbGFzc19zaW5nbGUucGhwJywKICAvLyAgICAgICAgIGNvbnRyb2xsZXI6ICdldmVudFJlY3VycmluZ0RldGFpbHNCdXNpbmVzc0NhbGVuZGFyTW9kYWxDb250cm9sbGVyJywKICAvLyAgICAgICAgIC8vIHNpemU6IHNpemUsCiAgLy8gICAgICAgICByZXNvbHZlOiB7CiAgLy8gICAgICAgICAgICAgc2VsZWN0ZWRFdmVudDogZnVuY3Rpb24oKSB7CiAgLy8gICAgICAgICAgICAgICAgIHJldHVybiBzZWxlY3RlZEV2ZW50OwogIC8vICAgICAgICAgICAgIH0KICAvLyAgICAgICAgIH0KICAvLyAgICAgfSk7CiAgLy8gfSBlbHNlIHsKICAvLyAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgLy8gICAgICAgICBhbmltYXRpb246IGZhbHNlLAogIC8vICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfZXZlbnRfc2luZ2xlLnBocCcsCiAgLy8gICAgICAgICBjb250cm9sbGVyOiAnZXZlbnREZXRhaWxzQnVzaW5lc3NDYWxlbmRhck1vZGFsQ29udHJvbGxlcicsCiAgLy8gICAgICAgICAvLyBzaXplOiBzaXplLAogIC8vICAgICAgICAgcmVzb2x2ZTogewogIC8vICAgICAgICAgICAgIHNlbGVjdGVkRXZlbnQ6IGZ1bmN0aW9uKCkgewogIC8vICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZWN0ZWRFdmVudDsKICAvLyAgICAgICAgICAgICB9CiAgLy8gICAgICAgICB9CiAgLy8gICAgIH0pOwogIC8vIH0KfQpmdW5jdGlvbiB1cGRhdGVHbG9iYWxMYW5ndWFnZSgkc2NvcGUsICRuZXdsYW5nKSB7CgogICAgLy8JdmFyIGdMYW5nPWdMYW5nQmFzZVtnTGFuZ0N1cnJdOwogICAgJGdMYW5nID0gZ0xhbmdCYXNlWyRuZXdsYW5nXTsKICAgIC8vIGxvZ0RlYnVnKCJnTGFuZ0Jhc2VbJG5ld2xhbmddWyd0aXRsZTEnXT0iICsgZ0xhbmdCYXNlWyRuZXdsYW5nXVsndGl0bGUxJ10pOwogICAgLy8gbG9nRGVidWcoImxhbmd1Z2FnZToiICsgJGdMYW5nWydsYW5ndWFnZSddKTsKICAgIC8vCWxvZ0RlYnVnKCJsYW5ndWdhZ2UgZGlyOiAiKyRnTGFuZ1snZGlyJ10pOwogICAgLy8JbG9nRGVidWcoImNoYW5naW5nIGxhbmd1YWdlIHRvICIrJG5ld2xhbmcpCiAgICAkc2NvcGUuc3BDbGFzcyA9ICRnTGFuZ1snY2xhc3MnXTsKICAgIC8vCWxvZ0RlYnVnKCJpcyBhcnJheT8gIithbmd1bGFyLmlzQXJyYXkoJGdMYW5nKSk7CiAgICAvLwlsb2dEZWJ1ZygiJGdMYW5nWydkaXInXT0iKyRnTGFuZ1snZGlyJ10pOwogICAgLy8JbG9nRGVidWcoIiRnTGFuZ1sndGl0bGUxJ109IiskZ0xhbmdbJ3RpdGxlMSddKTsKICAgICRzY29wZS5sYW5nZmlsZSA9ICRnTGFuZzsKICAgIC8vIGxvZ0RlYnVnKCJpcyBhcnJheT8gIiArIGFuZ3VsYXIuaXNBcnJheSgkc2NvcGUubGFuZ2ZpbGUpKTsKICAgIC8vIGxvZ0RlYnVnKCIkc2NvcGUubGFuZ2ZpbGU9IiArICRzY29wZS5sYW5nZmlsZSk7CiAgICAvLyBsb2dEZWJ1ZygiJHNjb3BlLmxhbmdmaWxlWyd0aXRsZTEnXT0iICsgJHNjb3BlLmxhbmdmaWxlWyd0aXRsZTEnXSk7CgogICAgJHNjb3BlLnRlc3RuZXd2YXIgPSAkc2NvcGUubGFuZ2ZpbGVbJ3RpdGxlMSddOwogICAgLy8JJHNjb3BlLm1lc3NhZ2U9JHNjb3BlLmxhbmdmaWxlWyd0aXRsZTEnXTsKfQoKZnVuY3Rpb24gZ2V0UmFuZG9tQ29sb3IoKSB7CiAgICB2YXIgbGV0dGVycyA9ICcwMTIzNDU2Nzg5QUJDREVGJy5zcGxpdCgnJyk7CiAgICB2YXIgY29sb3IgPSAnIyc7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IDY7IGkrKykgewogICAgICAgIGNvbG9yICs9IGxldHRlcnNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTYpXTsKICAgIH0KICAgIHJldHVybiBjb2xvcjsKfQoKZnVuY3Rpb24gZ2V0UmFuZG9tSW50KG1pbiwgbWF4KSB7CiAgICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKG1heCAtIG1pbiArIDEpKSArIG1pbjsKfQoKZnVuY3Rpb24gY2FsY190ZW1wX2xpbWl0X2lkKCkgewogICAgdmFyIGQgPSBuZXcgRGF0ZSgpOwogICAgdmFyIHJhbmRvbWxpbWl0ID0gZC5nZXRUaW1lKCk7CiAgICBsb2dEZWJ1ZygiY2FsY190ZW1wX2xpbWl0X2lkPSIgKyByYW5kb21saW1pdCk7CiAgICByZXR1cm4gcmFuZG9tbGltaXQ7Cn0KCnZhciAkZ0xvZ0xldmVsID0gJ2RlYnVnJzsKCi8vIHN0YXJ0aW5nCmxvZ0RlYnVnKCJtYWluICRnTG9nTGV2ZWw9IiArICRnTG9nTGV2ZWwpOwpsb2dEZWJ1ZygiaW5pdGlhbGl6ZSBhbmd1bGFyIik7CmxvZ0RlYnVnKCJpbml0aWFsaXppbmcgbW9kdWxlcyAiICsgJGFuZ3VsYXJNb2R1bGVzKTsKCnZhciBrdXplQXBwID0gYW5ndWxhci5tb2R1bGUoJ2t1emVBcHAnLCAkYW5ndWxhck1vZHVsZXMpCgovLyRyb290U2NvcGUuc3BDbGFzcyA9ICdyaWdodCc7Cmt1emVSdW4gPSBmdW5jdGlvbigpIHsKCn0Ka3V6ZUFwcC5ydW4oWwogICAgJyRidWlsZGVyJywKICAgIGZ1bmN0aW9uKCRidWlsZGVyKSB7CiAgICAgICAgLy8gbG9nRGVidWcoImluc2lkZSBrdXplQXBwLnJ1biIpOwogICAgICAgICRidWlsZGVyLnJlZ2lzdGVyQ29tcG9uZW50KCdzYW1wbGVJbnB1dCcsIHsKICAgICAgICAgICAgZ3JvdXA6ICdmcm9tIGh0bWwnLAogICAgICAgICAgICBsYWJlbDogJ1NhbXBsZScsCiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnRnJvbSBodG1sIHRlbXBsYXRlJywKICAgICAgICAgICAgcGxhY2Vob2xkZXI6ICdwbGFjZWhvbGRlcicsCiAgICAgICAgICAgIHJlcXVpcmVkOiBmYWxzZSwKICAgICAgICAgICAgdmFsaWRhdGlvbk9wdGlvbnM6IFt7CiAgICAgICAgICAgICAgICBsYWJlbDogJ25vbmUnLAogICAgICAgICAgICAgICAgcnVsZTogJy8uKi8nCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgIGxhYmVsOiAnbnVtYmVyJywKICAgICAgICAgICAgICAgIHJ1bGU6ICdbbnVtYmVyXScKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgbGFiZWw6ICdlbWFpbCcsCiAgICAgICAgICAgICAgICBydWxlOiAnW2VtYWlsXScKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgbGFiZWw6ICd1cmwnLAogICAgICAgICAgICAgICAgcnVsZTogJ1t1cmxdJwogICAgICAgICAgICB9XSwKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYW5ndWxhci1mb3JtLWJ1aWxkZXIvZXhhbXBsZS90ZW1wbGF0ZS5odG1sJywKICAgICAgICAgICAgcG9wb3ZlclRlbXBsYXRlVXJsOiAnL2FuZ3VsYXItZm9ybS1idWlsZGVyL2V4YW1wbGUvcG9wb3ZlclRlbXBsYXRlLmh0bWwnCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuICRidWlsZGVyLnJlZ2lzdGVyQ29tcG9uZW50KCduYW1lJywgewogICAgICAgICAgICBncm91cDogJ0RlZmF1bHQnLAogICAgICAgICAgICBsYWJlbDogJ05hbWUnLAogICAgICAgICAgICByZXF1aXJlZDogZmFsc2UsCiAgICAgICAgICAgIGFycmF5VG9UZXh0OiB0cnVlLAogICAgICAgICAgICB0ZW1wbGF0ZTogIjxkaXYgY2xhc3M9XCJmb3JtLWdyb3VwXCI+XG4gICAgPGxhYmVsIGZvcj1cInt7Zm9ybU5hbWUraW5kZXh9fVwiIGNsYXNzPVwiY29sLW1kLTQgY29udHJvbC1sYWJlbFwiIG5nLWNsYXNzPVwieydmYi1yZXF1aXJlZCc6cmVxdWlyZWR9XCI+e3tsYWJlbH19PC9sYWJlbD5cbiAgICA8ZGl2IGNsYXNzPVwiY29sLW1kLThcIj5cbiAgICAgICAgPGlucHV0IHR5cGU9J2hpZGRlbicgbmctbW9kZWw9XCJpbnB1dFRleHRcIiB2YWxpZGF0b3ItcmVxdWlyZWQ9XCJ7e3JlcXVpcmVkfX1cIiB2YWxpZGF0b3ItZ3JvdXA9XCJ7e2Zvcm1OYW1lfX1cIi8+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJjb2wtc20tNlwiIHN0eWxlPVwicGFkZGluZy1sZWZ0OiAwO1wiPlxuICAgICAgICAgICAgPGlucHV0IHR5cGU9XCJ0ZXh0XCJcbiAgICAgICAgICAgICAgICBuZy1tb2RlbD1cImlucHV0QXJyYXlbMF1cIlxuICAgICAgICAgICAgICAgIGNsYXNzPVwiZm9ybS1jb250cm9sXCIgaWQ9XCJ7e2Zvcm1OYW1lK2luZGV4fX0tMFwiLz5cbiAgICAgICAgICAgIDxwIGNsYXNzPSdoZWxwLWJsb2NrJz5GaXJzdCBuYW1lPC9wPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImNvbC1zbS02XCIgc3R5bGU9XCJwYWRkaW5nLWxlZnQ6IDA7XCI+XG4gICAgICAgICAgICA8aW5wdXQgdHlwZT1cInRleHRcIlxuICAgICAgICAgICAgICAgIG5nLW1vZGVsPVwiaW5wdXRBcnJheVsxXVwiXG4gICAgICAgICAgICAgICAgY2xhc3M9XCJmb3JtLWNvbnRyb2xcIiBpZD1cInt7Zm9ybU5hbWUraW5kZXh9fS0xXCIvPlxuICAgICAgICAgICAgPHAgY2xhc3M9J2hlbHAtYmxvY2snPkxhc3QgbmFtZTwvcD5cbiAgICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG48L2Rpdj4iLAogICAgICAgICAgICBwb3BvdmVyVGVtcGxhdGU6ICI8Zm9ybT5cbiAgICA8ZGl2IGNsYXNzPVwiZm9ybS1ncm91cFwiPlxuICAgICAgICA8bGFiZWwgY2xhc3M9J2NvbnRyb2wtbGFiZWwnPkxhYmVsPC9sYWJlbD5cbiAgICAgICAgPGlucHV0IHR5cGU9J3RleHQnIG5nLW1vZGVsPVwibGFiZWxcIiB2YWxpZGF0b3I9XCJbcmVxdWlyZWRdXCIgY2xhc3M9J2Zvcm0tY29udHJvbCcvPlxuICAgIDwvZGl2PlxuICAgIDxkaXYgY2xhc3M9XCJjaGVja2JveFwiPlxuICAgICAgICA8bGFiZWw+XG4gICAgICAgICAgICA8aW5wdXQgdHlwZT0nY2hlY2tib3gnIG5nLW1vZGVsPVwicmVxdWlyZWRcIiAvPlxuICAgICAgICAgICAgUmVxdWlyZWRcbiAgICAgICAgPC9sYWJlbD5cbiAgICA8L2Rpdj5cblxuICAgIDxoci8+XG4gICAgPGRpdiBjbGFzcz0nZm9ybS1ncm91cCc+XG4gICAgICAgIDxpbnB1dCB0eXBlPSdzdWJtaXQnIG5nLWNsaWNrPVwicG9wb3Zlci5zYXZlKCRldmVudClcIiBjbGFzcz0nYnRuIGJ0bi1wcmltYXJ5JyB2YWx1ZT0nU2F2ZScvPlxuICAgICAgICA8aW5wdXQgdHlwZT0nYnV0dG9uJyBuZy1jbGljaz1cInBvcG92ZXIuY2FuY2VsKCRldmVudClcIiBjbGFzcz0nYnRuIGJ0bi1kZWZhdWx0JyB2YWx1ZT0nQ2FuY2VsJy8+XG4gICAgICAgIDxpbnB1dCB0eXBlPSdidXR0b24nIG5nLWNsaWNrPVwicG9wb3Zlci5yZW1vdmUoJGV2ZW50KVwiIGNsYXNzPSdidG4gYnRuLWRhbmdlcicgdmFsdWU9J0RlbGV0ZScvPlxuICAgIDwvZGl2PlxuPC9mb3JtPiIKICAgICAgICB9KTsKICAgIH0KXSkKCi8vIERFTEVURUQgLSB4ZWRpdGFibGUgc3R1ZmYKLy8ga3V6ZUFwcC5ydW4oZnVuY3Rpb24oZWRpdGFibGVPcHRpb25zLCBlZGl0YWJsZVRoZW1lcykgewovLyAgICAgbG9nRGVidWcoImluaXRpYWxpemluZyB4ZWRpdGFibGUgZWRpdGFibGVPcHRpb25zIik7Ci8vICAgICBlZGl0YWJsZU9wdGlvbnMudGhlbWUgPSAnYnMzJzsgLy8gYm9vdHN0cmFwMyB0aGVtZS4gQ2FuIGJlIGFsc28gJ2JzMicsICdkZWZhdWx0JwovLyAgICAgLy8gZWRpdGFibGVPcHRpb25zLmRlZmF1bHRzLm1vZGUgPSAnaW5saW5lJzsKLy8gICAgIGxvZ0RlYnVnKGVkaXRhYmxlT3B0aW9ucyk7Ci8vICAgICAvLyBlZGl0YWJsZU9wdGlvbnMubW9kZSA9ICdpbmxpbmUnOwovLyAgICAgZWRpdGFibGVUaGVtZXMuYnMzLmlucHV0Q2xhc3MgPSAnaW5wdXQtc20nOwovLyAgICAgZWRpdGFibGVUaGVtZXMuYnMzLmJ1dHRvbnNDbGFzcyA9ICdidG4tc20nOwovLyB9KTsKCi8vIGFmdGVyIGZvcm1zCi8vRGVmaW5lIFJvdXRpbmcgZm9yIGFwcAovL1VyaSAvQWRkTmV3T3JkZXIgLT4gdGVtcGxhdGUgYWRkX29yZGVyLmh0bWwgYW5kIENvbnRyb2xsZXIgQ2xpZW50c0FkZENvbnRyb2xsZXIKLy9VcmkgL1Nob3dPcmRlcnMgLT4gdGVtcGxhdGUgc2hvd19vcmRlcnMuaHRtbCBhbmQgQ29udHJvbGxlciBDbGllbnRzQWRkQ29udHJvbGxlcgprdXplQXBwLmNvbmZpZyhbJyRyb3V0ZVByb3ZpZGVyJywKICAgIGZ1bmN0aW9uKCRyb3V0ZVByb3ZpZGVyKSB7CiAgICAgICAgLy8gbG9nRGVidWcoJHJvdXRlUHJvdmlkZXIpOwogICAgICAgICRyb3V0ZVByb3ZpZGVyLgogICAgICAgIC8vIHdoZW4oJy9jbGllbnRjYXJkJywgewogICAgICAgIC8vICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19jbGllbnRfY2FyZC5odG1sJywKICAgICAgICAvLyAgICAgY29udHJvbGxlcjogJ2NsaWVudENhcmRDb250cm9sbGVyJwogICAgICAgIC8vIH0pLgogICAgICAgIHdoZW4oJy9jb250YWN0JywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdjb250YWN0LnBocCcsCiAgICAgICAgICAgIC8vIGNvbnRyb2xsZXI6ICdlbmRVc2VySG9tZUNvbnRyb2xsZXInCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdjb250YWN0Q29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvZXZlbnRfdHlwZXMnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2V2ZW50X3R5cGVzLmh0bWwnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnRXZlbnRUeXBlc0NvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2V2ZW50X3R5cGVzL2FkZCcsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfZXZlbnRfdHlwZV9hZGQucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0V2ZW50VHlwZU5ld0NvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2V2ZW50X3R5cGVzLzpldmVudF90eXBlX2lkJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19ldmVudF90eXBlX2FkZC5waHAnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnRXZlbnRUeXBlVXBkYXRlQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvaG91cnNfb2Zfd29yaycsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfaG91cnNfb2Zfd29yay5odG1sJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0hvdXJzT2ZXb3JrQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvYnVzaW5lc3NfY2FsZW5kYXInLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2NhbGVuZGFyLmh0bWwnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnQnVzaW5lc3NDYWxlbmRhckNvbnRyb2xsZXInLAogICAgICAgICAgICByZWxvYWRPblNlYXJjaDogZmFsc2UKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvYW5ndWxhci1mb3JtLWJ1aWxkZXInLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2FuZ3VsYXItZm9ybS1idWlsZGVyL2luZGV4Lmh0bWwnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnRGVtb0NvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2J1c2luZXNzX2NsaWVudHMvYWRkJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19jbGllbnRzX2FkZC5odG1sJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0NsaWVudHNBZGRDb250cm9sbGVyJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9idXNpbmVzc19jbGllbnRzJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19jbGllbnRzLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdDbGllbnRzU2hvd0NvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2J1c2luZXNzX2NsaWVudHMvOmJ1c2luZXNzX3VzZXJfaWQnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2NsaWVudF9jYXJkLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdDbGllbnRzU2hvdzFDb250cm9sbGVyJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9idXNpbmVzc19yZXBvcnRzJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19yZXBvcnRzLmh0bWwnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnQnVzaW5lc3NSZXBvcnRzQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvYnVzaW5lc3NfaW5zdHJ1Y3RvcnMnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2luc3RydWN0b3JzLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdJbnN0cnVjdG9yc1Nob3dDb250cm9sbGVyJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9idXNpbmVzc19pbnN0cnVjdG9ycy9hZGQnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2NsaWVudHNfYWRkLmh0bWwnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnSW5zdHJ1Y3RvcnNBZGRDb250cm9sbGVyJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9idXNpbmVzc19sb2NhdGlvbnMnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2xvY2F0aW9ucy5waHAnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnYnVzaW5lc3NfbG9jYXRpb25zJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9idXNpbmVzc19sb2NhdGlvbnMvYWRkJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19sb2NhdGlvbnNfYWRkLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdidXNpbmVzc19sb2NhdGlvbnNfYWRkJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9idXNpbmVzc19sb2NhdGlvbnMvOmxvY2F0aW9uX2lkJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19sb2NhdGlvbnNfYWRkLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdidXNpbmVzc19sb2NhdGlvbnNfdXBkYXRlJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9idXNpbmVzc19pbnN0cnVjdG9ycy86YnVzaW5lc3NfdXNlcl9pZCcsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfaW5zdHJ1Y3Rvcl9jYXJkLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdJbnN0cnVjdG9yU2hvdzFDb250cm9sbGVyJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9ldmVudC86ZXZlbnRfaWQnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2V2ZW50X2NhcmQucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0V2ZW50UGFnZUNvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2V2ZW50X2NsYXNzLzpldmVudF9pZCcsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfZXZlbnRfY2xhc3NfY2FyZC5odG1sJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0V2ZW50Q2xhc3NQYWdlQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvcGFja2FnZXMnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX3BhY2thZ2VzX3Nob3cucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ1BhY2thZ2VzQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvcGFja2FnZXMvYWRkJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19wYWNrYWdlc19jcmVhdGUucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ2J1c2luZXNzX3BhY2thZ2VzX2FkZF9jbnRsJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9wYWNrYWdlcy86cGFja2FnZV9pZCcsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfcGFja2FnZXNfY3JlYXRlLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdidXNpbmVzc19wYWNrYWdlc191cGRhdGVfY250bCcKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvYnVzaW5lc3NfY29uZmlnJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19jb25maWcucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0NvbmZpZ0J1c2luZXNzQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvdXNlcl9jb25maWcnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ3VzZXJfY29uZmlnLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdDb25maWdVc2VyQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvYnVzaW5lc3NfZG9jcycsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfZG9jcy5odG1sJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0J1c2luZXNzRG9jc0NvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignLycsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnaG9tZS5waHAnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnSG9tZUNvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgb3RoZXJ3aXNlKHsKICAgICAgICAgICAgLy8gICAgcmVkaXJlY3RUbzogJy8nCiAgICAgICAgfSk7CiAgICB9Cl0pOwoKa3V6ZUFwcC5mYWN0b3J5KCdzaGFyZWREYXRhJywgZnVuY3Rpb24oKSB7CiAgICB2YXIgc2VsZWN0ZWRFbmRVc2VyID0gbnVsbDsKCiAgICByZXR1cm4gewogICAgICAgIGdldFNlbGVjdGVkRW5kVXNlcjogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIC8vWW91IGNvdWxkIGFsc28gcmV0dXJuIHNwZWNpZmljIGF0dHJpYnV0ZSBvZiB0aGUgZm9ybSBkYXRhIGluc3RlYWQKICAgICAgICAgICAgLy9vZiB0aGUgZW50aXJlIGRhdGEKICAgICAgICAgICAgcmV0dXJuIHNlbGVjdGVkRW5kVXNlcjsKICAgICAgICB9LAogICAgICAgIHNldFNlbGVjdGVkRW5kVXNlcjogZnVuY3Rpb24obmV3U2VsZWN0ZWRFbmRVc2VyKSB7CiAgICAgICAgICAgIC8vWW91IGNvdWxkIGFsc28gc2V0IHNwZWNpZmljIGF0dHJpYnV0ZSBvZiB0aGUgZm9ybSBkYXRhIGluc3RlYWQKICAgICAgICAgICAgc2VsZWN0ZWRFbmRVc2VyID0gbmV3U2VsZWN0ZWRFbmRVc2VyOwogICAgICAgIH0sCiAgICB9Owp9KTsKCmt1emVBcHAuZGlyZWN0aXZlKCdjb252ZXJ0VG9OdW1iZXInLCBmdW5jdGlvbigpIHsKICByZXR1cm4gewogICAgcmVxdWlyZTogJ25nTW9kZWwnLAogICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGVsZW1lbnQsIGF0dHJzLCBuZ01vZGVsKSB7CiAgICAgIG5nTW9kZWwuJHBhcnNlcnMucHVzaChmdW5jdGlvbih2YWwpIHsKICAgICAgICByZXR1cm4gdmFsICE9IG51bGwgPyBwYXJzZUludCh2YWwsIDEwKSA6IG51bGw7CiAgICAgIH0pOwogICAgICBuZ01vZGVsLiRmb3JtYXR0ZXJzLnB1c2goZnVuY3Rpb24odmFsKSB7CiAgICAgICAgcmV0dXJuIHZhbCAhPSBudWxsID8gJycgKyB2YWwgOiBudWxsOwogICAgICB9KTsKICAgIH0KICB9Owp9KTsKCmt1emVBcHAuZGlyZWN0aXZlKCdlbGFzdGljJywgWwogICAgJyR0aW1lb3V0JywKICAgIGZ1bmN0aW9uKCR0aW1lb3V0KSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJywKICAgICAgICAgICAgbGluazogZnVuY3Rpb24oJHNjb3BlLCBlbGVtZW50KSB7CiAgICAgICAgICAgICAgICAkc2NvcGUuaW5pdGlhbEhlaWdodCA9ICRzY29wZS5pbml0aWFsSGVpZ2h0IHx8IGVsZW1lbnRbMF0uc3R5bGUuaGVpZ2h0OwogICAgICAgICAgICAgICAgdmFyIHJlc2l6ZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIGVsZW1lbnRbMF0uc3R5bGUuaGVpZ2h0ID0gJHNjb3BlLmluaXRpYWxIZWlnaHQ7CiAgICAgICAgICAgICAgICAgICAgZWxlbWVudFswXS5zdHlsZS5oZWlnaHQgPSAiIiArIGVsZW1lbnRbMF0uc2Nyb2xsSGVpZ2h0ICsgInB4IjsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBlbGVtZW50Lm9uKCJpbnB1dCBjaGFuZ2UiLCByZXNpemUpOwogICAgICAgICAgICAgICAgLy8gZWxlbWVudC5vbigiaW5wdXQgY2hhbmdlIiwgcmVzaXplKTsKICAgICAgICAgICAgICAgICR0aW1lb3V0KHJlc2l6ZSwgMCk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgfQpdKTsKCmt1emVBcHAuc2VydmljZSgnc2hhcmVkUHJvcGVydGllcycsIGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgc2VsZWN0ZWRfdXNlciA9IG51bGw7CiAgICAgICAgdmFyIGNhbGVuZGFyX2RhdGUgPSBudWxsOwogICAgICAgIHZhciBldmVudF9yZXNjaGVkdWxlID0gbnVsbDsKICAgICAgICB2YXIgc2VsZWN0ZWRfaW5zdHJ1Y3RvciA9IDA7CiAgICAgICAgdmFyIGV2ZW50X3R5cGVfZm9yX3N1Z2dlc3Rpb25zID0gbnVsbDsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBnZXRfc2VsZWN0ZWRfaW5zdHJ1Y3RvcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGVjdGVkX2luc3RydWN0b3I7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNldF9zZWxlY3RlZF9pbnN0cnVjdG9yOiBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgICAgICAgICAgc2VsZWN0ZWRfaW5zdHJ1Y3RvciA9IHZhbHVlOwogICAgICAgICAgICB9LAogICAgICAgICAgICBnZXRfc2VsZWN0ZWRfdXNlcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGVjdGVkX3VzZXI7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNldF9zZWxlY3RlZF91c2VyOiBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgICAgICAgICAgc2VsZWN0ZWRfdXNlciA9IHZhbHVlOwogICAgICAgICAgICB9LAogICAgICAgICAgICBzZXRfZXZlbnRfcmVzY2hlZHVsZTogZnVuY3Rpb24odmFsdWUpIHsKICAgICAgICAgICAgICAgIGV2ZW50X3Jlc2NoZWR1bGUgPSB2YWx1ZTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZ2V0X2V2ZW50X3Jlc2NoZWR1bGU6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBldmVudF9yZXNjaGVkdWxlOwogICAgICAgICAgICB9LAogICAgICAgICAgICBnZXRfY2FsZW5kYXJfZGF0ZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGNhbGVuZGFyX2RhdGU7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNldF9jYWxlbmRhcl9kYXRlOiBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgICAgICAgICAgY2FsZW5kYXJfZGF0ZSA9IHZhbHVlOwogICAgICAgICAgICB9LAogICAgICAgICAgICBnZXRfZXZlbnRfdHlwZV9mb3Jfc3VnZ2VzdGlvbnM6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBldmVudF90eXBlX2Zvcl9zdWdnZXN0aW9uczsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2V0X2V2ZW50X3R5cGVfZm9yX3N1Z2dlc3Rpb25zOiBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgICAgICAgICAgLy8gbG9nRGVidWcoInNldF9ldmVudF90eXBlX2Zvcl9zdWdnZXN0aW9ucz0iK3ZhbHVlKTsKICAgICAgICAgICAgICAgIGV2ZW50X3R5cGVfZm9yX3N1Z2dlc3Rpb25zID0gdmFsdWU7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ21lbnVDb250cm9sbGVyJywgWyckc2NvcGUnLCAnJGxvY2F0aW9uJywgZnVuY3Rpb24oJHNjb3BlLCAkbG9jYXRpb24pIHsKICAgIHJldHVybiB0cnVlOwogICAgbG9nRGVidWcoIiRzY29wZS5pc0N1cnJlbnRQYXRoPSIgKyAkc2NvcGUuaXNDdXJyZW50UGF0aCk7CiAgICAkc2NvcGUuaXNDdXJyZW50UGF0aCA9IGZ1bmN0aW9uKHBhdGgpIHsKICAgICAgICByZXR1cm4gJGxvY2F0aW9uLnBhdGgoKSA9PSBwYXRoOwogICAgfTsKfV0pOwoKCgprdXplQXBwLmNvbnRyb2xsZXIoJ0J1c2luZXNzUmVwb3J0c0NvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkbG9jYXRpb24sJHJvdXRlUGFyYW1zKQp7CgogIGxvZ0RlYnVnKCJjb250cm9sbGVyOiBCdXNpbmVzc1JlcG9ydHNDb250cm9sbGVyIik7CgogICRzY29wZS5vcmRlckJ5RmllbGQgPSAnc3RhcnRfZXBvY2gnOwogICRzY29wZS5yZXZlcnNlU29ydD10cnVlOwogICRzY29wZS5ldmVudE1vZGVsPXRydWU7CgogIGdldEJ1c2luZXNzTG9jYXRpb25zKCRodHRwLCRzY29wZSwnYnVzaW5lc3NfbG9jYXRpb25zJyk7CiAgZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzKCRodHRwLCRzY29wZSwnZXZlbnRfdHlwZXMnKTsKICBnZXRBbGxJbnN0cnVjdG9ycygkaHR0cCwkc2NvcGUsJ2luc3RydWN0b3JzJyk7CiAgZ2V0QWxsQ2xpZW50c0FuZEFyY2hpdmUoJGh0dHAsJHNjb3BlLCdjbGllbnRzJyk7CiAgJHNjb3BlLnN0YXR1c2VzID0gWyB7InN0YXR1c19pZCI6IjAiLCJzdGF0dXNfbmFtZSI6Itek16rXldeXIn0sIHsic3RhdHVzX2lkIjoiMSIsInN0YXR1c19uYW1lIjoi16HXkteV16gifV07CiAgJHNjb3BlLmNhbmNlbGxhdGlvbnMgPSBbIHsiaXNfY2FuY2VsZWQiOiIwIiwiY2FuY2VsbGF0aW9uX25hbWUiOiLXnNeQINeR15XXmNecIn0seyJpc19jYW5jZWxlZCI6IjEiLCJjYW5jZWxsYXRpb25fbmFtZSI6IteR15XXmNecIn1dOwogICRzY29wZS5tb250aHMgPSBbIHsibW9udGgiOiIxIn0seyJtb250aCI6IjIifSx7Im1vbnRoIjoiMyJ9LHsibW9udGgiOiI0In0seyJtb250aCI6IjUifSx7Im1vbnRoIjoiNiJ9LHsibW9udGgiOiI3In0seyJtb250aCI6IjgifSx7Im1vbnRoIjoiOSJ9LHsibW9udGgiOiIxMCJ9LHsibW9udGgiOiIxMSJ9LHsibW9udGgiOiIxMiJ9XTsKICAkc2NvcGUueWVhcnMgPSBbIHsieWVhciI6IjIwMTYifSx7InllYXIiOiIyMDE3In1dOwogICRzY29wZS5wZXJpb2RzID0gWwogICAgICB7InBlcmlvZF9uYW1lIjoi15TXmdeh15jXldeo15kiLCAicGVyaW9kX3NpZ24iOiItMSJ9LAogICAgICB7InBlcmlvZF9uYW1lIjoi15TXmdeV150iLCAicGVyaW9kX3NpZ24iOiIwIn0sCiAgICAgIHsicGVyaW9kX25hbWUiOiLXoteq15nXk9eZIiwgInBlcmlvZF9zaWduIjoiMSJ9LAogICAgXQoKICAkc2NvcGUuY3N2X2NvbHVtbnNfb3JkZXIgPSBbJ2V2ZW50X3R5cGVfbmFtZScsICdzdGFydF90aW1lJywgJ2V2ZW50X3VzZXJfY2xpZW50cycsICdpbnN0cnVjdG9yX25hbWUnLCAnaXNfY2FuY2VsZWQnLCAnaXNfY29tcGxldGVkJywgJ2FjdHVhbF9wcmljZScsICdwYXJ0aWNpcGF0ZWQnXTsKICAkc2NvcGUuY3N2X2NvbHVtbnNfaGVhZGVyID0gWyfXodeV15Ig157XpNeS16knLCAn16rXkNeo15nXmiDXldep16LXlCcsICfXntep16rXqtek15nXnScsICfXnteT16jXmdeaJywn157XkdeV15jXnCcsICfXodeS15XXqCcsICfXnteX15nXqCcsICfXntep16rXqtek15nXnSddOwoKCgogICRzY29wZS5nb3RvQ2xpZW50UGFnZT0gZnVuY3Rpb24gKGJ1c2luZXNzVXNlcmlkKSB7CiAgICBnb3RvQ2xpZW50UGFnZShidXNpbmVzc1VzZXJpZCk7CiAgfQoKICBmdW5jdGlvbiBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSh4LHZhbHVlKXsKICAgIGlmICggeCAhPSB1bmRlZmluZWQgKXsKICAgICAgdmFyIHgxID0gbmV3IEFycmF5KCk7CiAgICAgIGZvciAoaSA9IDA7IGkgPCB4Lmxlbmd0aDsgaSsrKXsKICAgICAgICB4MVtpXSA9IHhbaV1bdmFsdWVdOwogICAgICB9CiAgICAgIHgxID0geDEuam9pbigpOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgcmV0dXJuIHgxOwogIH0KCiAgJHNjb3BlLnJlcG9ydF9pc19sb2FkaW5nID0gZmFsc2U7CgogICRzY29wZS5ldmVudHNSZXBvcnQgPSBmdW5jdGlvbigpewogICAgbG9nRGVidWcoImV2ZW50c1JlcG9ydCIpOwoKICAgICRzY29wZS5zaG93QWdnID0gKCRzY29wZS5ldmVudFR5cGVNb2RlbCkgfHwKICAgICAoJHNjb3BlLmluc3RydWN0b3JNb2RlbCkgfHwgKCRzY29wZS5tb250aE1vZGVsKSB8fCAoJHNjb3BlLmNsaWVudHNNb2RlbCkgfHwgKCRzY29wZS55ZWFyTW9kZWwpIDsKCiAgICBldmVudF90eXBlX2lkX2ZpbHRlciA9IGxpc3RfdG9fc3RyaW5nX2J5X3ZhbHVlKCRzY29wZS5zZWxlY3RlZEV2ZW50VHlwZUZpbHRlciwgImV2ZW50X3R5cGVfaWQiICk7CiAgICBpbnN0cnVjdG9yX2lkX2ZpbHRlciA9IGxpc3RfdG9fc3RyaW5nX2J5X3ZhbHVlKCRzY29wZS5zZWxlY3RlZEluc3RydWN0b3JGaWx0ZXIsICJidXNpbmVzc191c2VyX2lkIiApOwogICAgbW9udGhfZmlsdGVyID0gbGlzdF90b19zdHJpbmdfYnlfdmFsdWUoJHNjb3BlLnNlbGVjdGVkTW9udGhGaWx0ZXIsICJtb250aCIgKTsKICAgIGNsaWVudF9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuc2VsZWN0ZWRDbGllbnRGaWx0ZXIsICJidXNpbmVzc191c2VyX2lkIiApOwogICAgeWVhcl9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuc2VsZWN0ZWRZZWFyRmlsdGVyLCAieWVhciIgKTsKICAgIHN0YXR1c19maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuc2VsZWN0ZWRTdGF0dXNGaWx0ZXIsICJzdGF0dXNfaWQiICk7CiAgICBpc19jYW5jZWxlZF9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuc2VsZWN0ZWRJc19jYW5jZWxlZEZpbHRlciwgImlzX2NhbmNlbGVkIiApOwogICAgcGVyaW9kX2ZpbHRlciA9IGxpc3RfdG9fc3RyaW5nX2J5X3ZhbHVlKCRzY29wZS5zZWxlY3RlZFBlcmlvZEZpbHRlciwgInBlcmlvZF9zaWduIiApOwoKICAgICRzY29wZS5ldmVudFJlcG9ydENvbmZpZyA9IHt9OwoKICAgICRzY29wZS5ldmVudFJlcG9ydENvbmZpZy5maWx0ZXJzID0gewogICAgICBldmVudF90eXBlX2lkOiBldmVudF90eXBlX2lkX2ZpbHRlciwKICAgICAgaW5zdHJ1Y3Rvcl9pZDogaW5zdHJ1Y3Rvcl9pZF9maWx0ZXIsCiAgICAgIG1vbnRoOiBtb250aF9maWx0ZXIsCiAgICAgIHllYXI6IHllYXJfZmlsdGVyLAogICAgICBjbGllbnQ6IGNsaWVudF9maWx0ZXIsCiAgICAgIHN0YXR1czogc3RhdHVzX2ZpbHRlciwKICAgICAgcGVyaW9kOiBwZXJpb2RfZmlsdGVyLAogICAgICBpc19jYW5jZWxlZDogaXNfY2FuY2VsZWRfZmlsdGVyCiAgICB9OwoKICAgICRzY29wZS5ldmVudFJlcG9ydENvbmZpZy5hZ2dyZWdhdGlvbnMgPSB7CiAgICAgIGV2ZW50X3R5cGVfaWQ6ICRzY29wZS5ldmVudFR5cGVNb2RlbCwKICAgICAgaW5zdHJ1Y3Rvcl9pZDogJHNjb3BlLmluc3RydWN0b3JNb2RlbCwKICAgICAgbW9udGg6ICRzY29wZS5tb250aE1vZGVsLAogICAgICB5ZWFyOiAkc2NvcGUueWVhck1vZGVsLAogICAgICBjbGllbnQ6ICRzY29wZS5jbGllbnRNb2RlbCwKICAgIH07CgogICAgaWYgKCAkc2NvcGUuc2hvd0FnZyApIHsKICAgICAgZ2V0RXZlbnRzUmVwb3J0KCRodHRwLCRzY29wZSwgZ2V0RXZlbnRzUmVwb3J0QWdncmVnYXRlZF9zdWNjZXNzKTsKICAgICAgJHNjb3BlLnJlcG9ydF9pc19sb2FkaW5nID0gdHJ1ZTsKICAgIH0gZWxzZSB7CiAgICAgIGdldEV2ZW50c1JlcG9ydCgkaHR0cCwkc2NvcGUsIGdldEV2ZW50c1JlcG9ydExpc3Rfc3VjY2Vzcyk7CiAgICAgICRzY29wZS5yZXBvcnRfaXNfbG9hZGluZyA9IHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0RXZlbnRzUmVwb3J0TGlzdF9zdWNjZXNzKHJlc3BvbnNlKXsKICAgICAgJHNjb3BlLkV2ZW50UmVwb3J0TGlzdCA9IHJlc3BvbnNlLmpzb247CiAgICAgICRzY29wZS5kb3dubG9hZF9yZXBvcnQgPSAkc2NvcGVbICdFdmVudFJlcG9ydExpc3QnIF07CiAgICAgICRzY29wZS5yZXBvcnRfaXNfbG9hZGluZyA9IGZhbHNlOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldEV2ZW50c1JlcG9ydEFnZ3JlZ2F0ZWRfc3VjY2VzcyhyZXNwb25zZSl7CiAgICAgICRzY29wZS5FdmVudFJlcG9ydEFnZ3JlZ2F0ZWQgPSByZXNwb25zZS5qc29uOwogICAgICAkc2NvcGUuZG93bmxvYWRfcmVwb3J0ID0gJHNjb3BlWyAnRXZlbnRSZXBvcnRBZ2dyZWdhdGVkJyBdOwogICAgICAkc2NvcGUucmVwb3J0X2lzX2xvYWRpbmcgPSBmYWxzZTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRDbGllbnRzUmVwb3J0TGlzdF9zdWNjZXNzKHJlc3BvbnNlKXsKICAgICAgJHNjb3BlLkNsaWVudHNSZXBvcnRMaXN0ID0gcmVzcG9uc2UuanNvbjsKICAgICAgY29uc29sZS5sb2coIi0tLS0tLS0tLS0tLSIpCiAgICAgIGNvbnNvbGUubG9nKCRzY29wZS5DbGllbnRzUmVwb3J0TGlzdCkKICAgICAgY29uc29sZS5sb2coIi0tLS0tLS0tLS0tLSIpCiAgICAgICRzY29wZS5yZXBvcnRfaXNfbG9hZGluZyA9IGZhbHNlOwogICAgfQoKCiAgfQoKICAkc2NvcGUuY2xpZW50c1JlcG9ydCA9IGZ1bmN0aW9uKCl7CiAgICBsb2dEZWJ1ZygiY2xpZW50c1JlcG9ydCIpOwoKICAgIGNsaWVudF9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuc2VsZWN0ZWRDbGllbnRGaWx0ZXIsICJjbGllbnQiICk7CgogICAgJHNjb3BlLmV2ZW50UmVwb3J0Q29uZmlnID0ge307CgogICAgJHNjb3BlLmV2ZW50UmVwb3J0Q29uZmlnLmZpbHRlcnMgPSB7CiAgICAgIGNsaWVudDogY2xpZW50X2ZpbHRlciwKICAgIH07CgogICAgJHNjb3BlLmV2ZW50UmVwb3J0Q29uZmlnLmFnZ3JlZ2F0aW9ucyA9IHsKICAgIH07CgogICAgZ2V0Q2xpZW50c1JlcG9ydCgkaHR0cCwkc2NvcGUsIGdldENsaWVudHNSZXBvcnRfc3VjY2Vzcyk7CiAgICAkc2NvcGUucmVwb3J0X2lzX2xvYWRpbmcgPSB0cnVlOwogICAgZnVuY3Rpb24gZ2V0Q2xpZW50c1JlcG9ydF9zdWNjZXNzKHJlc3BvbnNlKXsKICAgICAgJHNjb3BlLmNsaWVudFJlcG9ydCA9IHJlc3BvbnNlLmpzb247CiAgICAgICRzY29wZS5kb3dubG9hZF9yZXBvcnQgPSAkc2NvcGVbICdjbGllbnRSZXBvcnQnIF07CiAgICAgICRzY29wZS5yZXBvcnRfaXNfbG9hZGluZyA9IGZhbHNlOwogICAgfQogIH0KCiAgJHNjb3BlLmVkaXRFdmVudD0gZnVuY3Rpb24gKHRoZWV2ZW50KQogIHsKICAgIGdvdG9FdmVudFBhZ2UodGhlZXZlbnQpOwogIH0KCiAgJHNjb3BlLmV2ZW50c1JlcG9ydCgpOwogICRzY29wZS5zZWxlY3RlZFJlcG9ydD0iZXZlbnRzIjsKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2J1c2luZXNzX3BhY2thZ2VzX3VwZGF0ZV9jbnRsJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uLCRyb3V0ZVBhcmFtcykKewogICRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIgPSB7fTsgLy8gdGhlc2UgYXJlIHRoZSBjb21wbGV0ZSBkZXRhaWxzIGZvciB0aGUgbmV3IGV2ZW50IC8vCiAgJHNjb3BlLnBhY2thZ2VfaXNfdXBkYXRlID0gdHJ1ZTsKICAkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLnBhY2thZ2VfbGltaXRfdHlwZT0xOwoKICAvLyBnZXR0dGluZyB0aGUgcGFja2FnZSBhbmQgaXRzIGV2ZW50IHR5cGVzCiAgZ2V0QnVzaW5lc3NQYWNrYWdlKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMucGFja2FnZV9pZCwnZm9ybUFkZFBhY2thZ2VBbmd1bGFyJyxmdW5jdGlvbihyZXNwb25zZSkKICB7CiAgICAkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLmlzX3VwZGF0ZSA9IHRydWU7CiAgICAkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLm9yaWdFdmVudFR5cGVzPWFuZ3VsYXIuY29weSgkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLnNlbGVjdGVkRXZlbnRUeXBlcyk7CiAgICAkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLnBhY2thZ2VfbGltaXRfdHlwZT0xOwogICAgLy8gdGhlbiBnZXR0aW5nIGFsbCB0aGUgZXZlbnQgdHlwZXMKICAgIGdldEV2ZW50VHlwZXNOb0FkbWluKCRodHRwLCRzY29wZSwncmVsYXRlZEV2ZW50VHlwZXMnLGdldEV2ZW50VHlwZXNOb0FkbWluX3N1Y2Nlc3MpOwogICAgZnVuY3Rpb24gZ2V0RXZlbnRUeXBlc05vQWRtaW5fc3VjY2VzcygpCiAgICB7CiAgICAgIC8vIHRoZW4gcmVtb3ZpbmcgZXhpc3RpbmcgZXZlbnQgdHlwZXMgb2YgcGFja2FnZSBmcm9tIGxpc3QKICAgICAgLy8gY29uc29sZS5sb2coJHNjb3BlLnJlbGF0ZWRFdmVudFR5cGVzWzBdKTsKICAgICAgLy8gY29uc29sZS5sb2coJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5zZWxlY3RlZEV2ZW50VHlwZXNbMF0pOwogICAgICBmb3IodmFyIGkgPSAwOyBpIDwgJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5zZWxlY3RlZEV2ZW50VHlwZXMubGVuZ3RoOyBpKyspCiAgICAgIHsKICAgICAgICAvLyBjb3B5aW5nIHRoZSBhY3R1YWwgb2JqZWN0IG9mICRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuc2VsZWN0ZWRFdmVudFR5cGVzW2ldCiAgICAgICAgZm9yKHZhciBqID0gMDsgaiA8ICRzY29wZS5yZWxhdGVkRXZlbnRUeXBlcy5sZW5ndGg7IGorKykKICAgICAgICB7CiAgICAgICAgICBpZiAoJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5zZWxlY3RlZEV2ZW50VHlwZXNbaV0uZXZlbnRfdHlwZV9pZD09JHNjb3BlLnJlbGF0ZWRFdmVudFR5cGVzW2pdLmV2ZW50X3R5cGVfaWQpCiAgICAgICAgICB7CiAgICAgICAgICAgICRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuc2VsZWN0ZWRFdmVudFR5cGVzW2ldPWFuZ3VsYXIuY29weSgkc2NvcGUucmVsYXRlZEV2ZW50VHlwZXNbal0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogIH0pOwogICRzY29wZS5nb3RvQmFjayA9IGdvdG9CYWNrOwogICRzY29wZS5jcmVhdGVQYWNrYWdlID0gZnVuY3Rpb24oKQogIHsKICAgIGNvbnNvbGUubG9nKCJ1cGRhdGVQYWNrYWdlRGV0YWlscyIpOwogICAgdXBkYXRlUGFja2FnZURldGFpbHMoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5wYWNrYWdlX2lkLCRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIsc3VjY2Vzc19jYWxsYmFjaywgZmFpbHVyZV9jYWxsYmFjayk7CiAgICBmdW5jdGlvbiBzdWNjZXNzX2NhbGxiYWNrKCkKICAgIHsKICAgICAgZ290b0JhY2soKTsKICAgIH0KICAgIGZ1bmN0aW9uIGZhaWx1cmVfY2FsbGJhY2soKQogICAgewogICAgICBnb3RvQmFjaygpOwogICAgfQogIH07Cn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdidXNpbmVzc19wYWNrYWdlc19hZGRfY250bCcsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikgewogICAgbG9nRGVidWcoJ2J1c2luZXNzX3BhY2thZ2VzX2FkZF9jbnRsJyk7CiAgICAkc2NvcGUucGFja2FnZV9pc191cGRhdGUgPSBmYWxzZTsKICAgICRzY29wZS5nb3RvQmFjayA9IGdvdG9CYWNrOwogICAgJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhciA9IHt9OwogICAgJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5ldmVudHNfY291bnRlciA9IDE7CiAgICAkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLmV2ZW50c19wZXJfd2VlayA9IDE7CiAgICAkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLnBhY2thZ2VfZHVyYXRpb25fbW9udGhzID0gMzsKICAgICRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIucGFja2FnZV9saW1pdF90eXBlPTE7CiAgICBnZXRFdmVudFR5cGVzTm9BZG1pbigkaHR0cCwkc2NvcGUsJ3JlbGF0ZWRFdmVudFR5cGVzJyk7CgogICAgJHNjb3BlLmNyZWF0ZVBhY2thZ2UgPSBmdW5jdGlvbigpCiAgICB7CiAgICAgIGNyZWF0ZVBhY2thZ2UoJGh0dHAsJHNjb3BlLCRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIsY3JlYXRlUGFja2FnZV9zdWNjZXNzLCBjcmVhdGVQYWNrYWdlX2ZhaWx1cmUpOwogICAgICBmdW5jdGlvbiBjcmVhdGVQYWNrYWdlX3N1Y2Nlc3MoKQogICAgICB7CiAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9wYWNrYWdlcycpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGNyZWF0ZVBhY2thZ2VfZmFpbHVyZSgpCiAgICAgIHsKICAgICAgICAvLyBsb2dFcnJvcigiZXJyb3IgIiArIGRhdGEubWVzc2FnZSk7CiAgICAgICAgLy8gJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5hamF4X2Vycm9yID0gZGF0YS5tZXNzYWdlOwogICAgICB9CiAgICB9Cn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdidXNpbmVzc19sb2NhdGlvbnMnLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkbG9jYXRpb24pIHsKICAgIGxvZ0RlYnVnKCdidXNpbmVzc19sb2NhdGlvbnMgY29udHJvbGxlcicpOwogICAgZ2V0QnVzaW5lc3NMb2NhdGlvbnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19sb2NhdGlvbnMnKTsKICAgICRzY29wZS5hZGROZXdMb2NhdGlvbiA9IGZ1bmN0aW9uICgpCiAgICB7CiAgICAgICRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfbG9jYXRpb25zL2FkZCcpOwogICAgfQogICAgJHNjb3BlLmdvdG9Mb2NhdGlvblBhZ2UgPSBmdW5jdGlvbihsb2NhdGlvbl9pZCkKICAgIHsKICAgICAgZ290b0xvY2F0aW9uUGFnZShsb2NhdGlvbl9pZCk7CiAgICB9Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignQnVzaW5lc3NEb2NzQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikgewogICAgbG9nRGVidWcoJ0J1c2luZXNzRG9jc0NvbnRyb2xsZXInKTsKfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdidXNpbmVzc19sb2NhdGlvbnNfdXBkYXRlJywgZnVuY3Rpb24oJHNjb3BlLCAkcm91dGVQYXJhbXMsICRodHRwLCAkbG9jYXRpb24pIHsKICAgIGxvZ0RlYnVnKCdidXNpbmVzc19sb2NhdGlvbnNfdXBkYXRlIGNvbnRyb2xsZXInKTsKICAgICRzY29wZS5pc191cGRhdGU9dHJ1ZTsKICAgIC8vIGdldEJ1c2luZXNzTG9jYXRpb25zKCRodHRwLCRzY29wZSwnYnVzaW5lc3NfbG9jYXRpb25zJyk7CiAgICBnZXRCdXNpbmVzc0xvY2F0aW9uKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMubG9jYXRpb25faWQsJ2N1cnJfbG9jYXRpb24nLGdldEJ1c2luZXNzTG9jYXRpb25fc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBnZXRCdXNpbmVzc0xvY2F0aW9uX3N1Y2Nlc3MoKQogICAgewogICAgICAkc2NvcGUuZm9ybUFkZExvY2F0aW9uQW5ndWxhcj0kc2NvcGUuY3Vycl9sb2NhdGlvblswXTsKICAgIH0KCgogICAgJHNjb3BlLmFkZExvY2F0aW9uID0gZnVuY3Rpb24oKQogICAgewogICAgICAvLyBpbiB0aGlzIGNhc2UgLSB1cGRhdGUgbG9jYXRpb24KICAgICAgdGhlZGF0YSA9ICRzY29wZS5mb3JtQWRkTG9jYXRpb25Bbmd1bGFyOwoKICAgICAgZnVuY3Rpb24gYWRkTG9jYXRpb25fc3VjY2VzcygpCiAgICAgIHsKICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2xvY2F0aW9ucycpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGFkZExvY2F0aW9uX2ZhaWx1cmUoKQogICAgICB7CiAgICAgICAgJHNjb3BlLmZvcm1BZGRMb2NhdGlvbkFuZ3VsYXIuYWpheF9lcnJvciA9IHJlc3BvbnNlLm1lc3NhZ2U7CiAgICAgIH0KICAgICAgdXBkYXRlTG9jYXRpb24oJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5sb2NhdGlvbl9pZCwgdGhlZGF0YSxhZGRMb2NhdGlvbl9zdWNjZXNzLGFkZExvY2F0aW9uX2ZhaWx1cmUpOwogICAgfQp9KTsKCmt1emVBcHAuY29udHJvbGxlcignYnVzaW5lc3NfbG9jYXRpb25zX2FkZCcsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikgewogICAgbG9nRGVidWcoJ2J1c2luZXNzX2xvY2F0aW9uc19hZGQgY29udHJvbGxlcicpOwogICAgZ2V0QnVzaW5lc3NMb2NhdGlvbnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19sb2NhdGlvbnMnKTsKICAgICRzY29wZS5pc191cGRhdGU9ZmFsc2U7CgogICAgJHNjb3BlLmFkZExvY2F0aW9uID0gZnVuY3Rpb24oKQogICAgewogICAgICB0aGVkYXRhID0gJHNjb3BlLmZvcm1BZGRMb2NhdGlvbkFuZ3VsYXI7CgogICAgICBmdW5jdGlvbiBhZGRMb2NhdGlvbl9zdWNjZXNzKCkKICAgICAgewogICAgICAgICRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfbG9jYXRpb25zJyk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gYWRkTG9jYXRpb25fZmFpbHVyZSgpCiAgICAgIHsKICAgICAgICAkc2NvcGUuZm9ybUFkZExvY2F0aW9uQW5ndWxhci5hamF4X2Vycm9yID0gcmVzcG9uc2UubWVzc2FnZTsKICAgICAgfQogICAgICBhZGRMb2NhdGlvbigkaHR0cCwkc2NvcGUsdGhlZGF0YSxhZGRMb2NhdGlvbl9zdWNjZXNzLGFkZExvY2F0aW9uX2ZhaWx1cmUpOwogICAgfQp9KTsKCmt1emVBcHAuY29udHJvbGxlcignSW5zdHJ1Y3RvcnNBZGRDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uKSB7CiAgICBsb2dEZWJ1ZygnSW5zdHJ1Y3RvcnNBZGRDb250cm9sbGVyJyk7CiAgICAkc2NvcGUuaXNJbnN0cnVjdG9yPXRydWU7CiAgICAkc2NvcGUudXNlcnR5cGU9Imluc3RydWN0b3IiOwogICAgJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyID0ge307CiAgICAkc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIuaXNfdXBkYXRlPWZhbHNlOwogICAgJHNjb3BlLmFkZENsaWVudCA9IGZ1bmN0aW9uKCkgLy8gYWRkIGluc3RydWN0b3IsIHVzaW5nIHRoZSBzYW1lIGZ1bmN0aW9uIG5hbWUgYXMgd2UgdXNlIHRoZSBzYW1lIHNjcmVlbgogICAgewogICAgICB0aGVkYXRhID0gJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyOwoKICAgICAgZnVuY3Rpb24gYWRkSW5zdHJ1Y3Rvcl9zdWNjZXNzKCkKICAgICAgewogICAgICAgICRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfaW5zdHJ1Y3RvcnMnKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBhZGRDbGllbnRfZmFpbHVyZSgpCiAgICAgIHsKICAgICAgICAkc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIuYWpheF9lcnJvciA9IHJlc3BvbnNlLm1lc3NhZ2U7CiAgICAgIH0KICAgICAgYWRkSW5zdHJ1Y3RvcigkaHR0cCwkc2NvcGUsdGhlZGF0YSxhZGRJbnN0cnVjdG9yX3N1Y2Nlc3MpOwogICAgfQp9KTsKa3V6ZUFwcC5jb250cm9sbGVyKCdDbGllbnRzQWRkQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICR0aW1lb3V0LCAkbG9jYXRpb24sIHNoYXJlZFByb3BlcnRpZXMpIHsKICAgIGxvZ0RlYnVnKCdDbGllbnRzQWRkQ29udHJvbGxlciAtIFRoaXMgaXMgQWRkIG5ldyBjbGllbnQgc2NyZWVuJyk7CiAgICAkc2NvcGUuaXNJbnN0cnVjdG9yPWZhbHNlOwoKICAgICRzY29wZS51c2VydHlwZT0iZW5kdXNlciI7CiAgICAkc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIgPSB7fTsKICAgICRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5pc191cGRhdGU9ZmFsc2U7CiAgICAkc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIuZGlzYWJsZV9waG9uZV9lZGl0aW5nPWZhbHNlOwoKICAgIGlmICgoJHNjb3BlLmZpbHRlci5WYWx1ZSAhPSAiIikgJiYgKHR5cGVvZiAkc2NvcGUuZmlsdGVyLlZhbHVlICE9ICd1bmRlZmluZWQnKSkgewogICAgICAgIGxvZ0RlYnVnKCJjbGllbnRzIGZpbHRlciBpcyBub3QgZW1wdHkiKTsKICAgICAgICB2YXIgZmlsdGVyID0gU3RyaW5nKCRzY29wZS5maWx0ZXIuVmFsdWUpOwogICAgICAgIGlmIChmaWx0ZXIuaW5kZXhPZigiICIpID4gMCkgewogICAgICAgICAgICAkc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIuZmlyc3RfbmFtZSA9IGZpbHRlci5zdWJzdHIoMCwgZmlsdGVyLmluZGV4T2YoIiAiKSk7CiAgICAgICAgICAgICRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5sYXN0X25hbWUgPSBmaWx0ZXIuc3Vic3RyKDEgKyBmaWx0ZXIuaW5kZXhPZigiICIpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIuZmlyc3RfbmFtZSA9IGZpbHRlcjsKICAgICAgICAgICAgJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyLmxhc3RfbmFtZSA9ICIiOwogICAgICAgIH0KICAgICAgICAkc2NvcGUuZmlsdGVyLlZhbHVlID0gIiI7CiAgICAgICAgJHNjb3BlLmZpbHRlci5idXR0b25WYWx1ZSA9ICIiOwogICAgfSBlbHNlIHsKICAgIH0KCiAgICAkc2NvcGUuZ290b0JhY2sgPSBmdW5jdGlvbigpCiAgICB7CiAgICAgICRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfY2xpZW50cycpOwogICAgfQoKICAgICRzY29wZS5hZGRDbGllbnQgPSBmdW5jdGlvbigpCiAgICB7CiAgICAgIHRoZWRhdGEgPSAkc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXI7CgogICAgICBmdW5jdGlvbiBhZGRDbGllbnRfc3VjY2Vzcyh1c2VyX2lkKQogICAgICB7CiAgICAgICAgaWYgKCRzY29wZS5zYXZlX2FuZF9zY2hlZHVsZSkKICAgICAgICB7CiAgICAgICAgICAvLyAkbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2NsaWVudHMvJyt1c2VyX2lkLmpzb24pOwogICAgICAgICAgbG9nRGVidWcoIk5FVyB1c2VyIHVzZXJfaWQ9Iit1c2VyX2lkLmpzb24pOwoKICAgICAgICAgIHVzZXJfaW5mbz0gewogICAgICAgICAgICAgIGJ1c2luZXNzX3VzZXJfaWQ6IHVzZXJfaWQuanNvbiwKICAgICAgICAgICAgICBidXNlcl9maXJzdF9uYW1lOiAkc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIuYnVzZXJfZmlyc3RfbmFtZSwKICAgICAgICAgICAgICBidXNlcl9sYXN0X25hbWU6ICRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5idXNlcl9sYXN0X25hbWUKICAgICAgICAgIH07CgogICAgICAgICAgc2hhcmVkUHJvcGVydGllcy5zZXRfc2VsZWN0ZWRfdXNlcih1c2VyX2luZm8pOwogICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jYWxlbmRhcicpOwoKICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfY2xpZW50cy8nKTsKICAgICAgICB9CiAgICAgICAgY29uc29sZS5sb2coIm5ldyB1c2VyIGlkID0gIit1c2VyX2lkLmpzb24pOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGFkZENsaWVudF9mYWlsdXJlKHJlc3BvbnNlKQogICAgICB7CiAgICAgICAgJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyLmFqYXhfZXJyb3IgPSByZXNwb25zZS5tZXNzYWdlOwogICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkKICAgICAgICB7CiAgICAgICAgICAkc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIuYWpheF9lcnJvcj1udWxsOwogICAgICAgIH0sIDI1MDApOwogICAgICB9CiAgICAgIGFkZENsaWVudCgkaHR0cCwkc2NvcGUsdGhlZGF0YSxhZGRDbGllbnRfc3VjY2VzcywgYWRkQ2xpZW50X2ZhaWx1cmUsZmFsc2UpOwogICAgfQp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ1BhY2thZ2VzQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikgewogICAgbG9nRGVidWcoJ1BhY2thZ2VzQ29udHJvbGxlcicpOwogICAgZ2V0QnVzaW5lc3NQYWNrYWdlcygkaHR0cCwkc2NvcGUsJ3BhY2thZ2VzJyk7CgogICAgJHNjb3BlLnNob3dQYWNrYWdlID0gZnVuY3Rpb24gKHRoZXBhY2thZ2UpCiAgICB7CiAgICAgICRsb2NhdGlvbi5wYXRoKCcvcGFja2FnZXMvJyt0aGVwYWNrYWdlLnBhY2thZ2VfaWQpOwogICAgfQp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ0luc3RydWN0b3JzU2hvd0NvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkbG9jYXRpb24pIHsKICAgIGxvZ0RlYnVnKCdJbnN0cnVjdG9yc1Nob3dDb250cm9sbGVyJyk7CiAgICAkc2NvcGUub3JkZXJCeUZpZWxkID0gJ2J1c2VyX3N0YXJ0X2RhdGUnOwogICAgJHNjb3BlLnJldmVyc2VTb3J0PXRydWU7CgogICAgZ2V0QWxsSW5zdHJ1Y3RvcnMoJGh0dHAsJHNjb3BlLCdhbGxDbGllbnRzJyxnZXRBbGxJbnN0cnVjdG9yc19zdWNjZXNzKTsKICAgIGZ1bmN0aW9uIGdldEFsbEluc3RydWN0b3JzX3N1Y2Nlc3MoKQogICAgewogICAgICAkc2NvcGUuc2hvd0NsaWVudHNHcmlkT3B0aW9ucy5kYXRhPSRzY29wZS5hbGxDbGllbnRzOwogICAgfQoKICAgICRzY29wZS5nb3RvSW5zdHJ1Y3RvclBhZ2U9IGZ1bmN0aW9uIChidXNpbmVzc191c2VyX2lkKQogICAgewogICAgICBnb3RvSW5zdHJ1Y3RvclBhZ2UoYnVzaW5lc3NfdXNlcl9pZCk7CiAgICB9CgogICAgJHNjb3BlLmNsaWVudE5hbWVGaWx0ZXI9IiI7CiAgICAkc2NvcGUuaW5wdXRGaWx0ZXIgPSBmdW5jdGlvbiAoaXRlbSkKICAgIHsKICAgICAgLy8gY29uc29sZS5sb2coaXRlbS5idXNlcl9waG9uZV9udW1iZXIpOwogICAgICByZXR1cm4gZmlsdGVyX2ZpcnN0bGFzdF9uYW1lKGl0ZW0uYnVzZXJfZmlyc3RfbmFtZSxpdGVtLmJ1c2VyX2xhc3RfbmFtZSxpdGVtLmJ1c2VyX3Bob25lX251bWJlciwkc2NvcGUuY2xpZW50TmFtZUZpbHRlcik7CiAgICB9Owp9KTsKCmt1emVBcHAuY29udHJvbGxlcignQ2xpZW50c1Nob3dDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkdWliTW9kYWwsICRodHRwLCAkbG9jYXRpb24pIHsKICAgIGxvZ0RlYnVnKCdDbGllbnRzU2hvd0NvbnRyb2xsZXInKTsKICAgICRzY29wZS5vcmRlckJ5RmllbGQgPSAnYnVzZXJfc3RhcnRfZGF0ZSc7CiAgICAkc2NvcGUucmV2ZXJzZVNvcnQ9dHJ1ZTsKCiAgICBnZXRBbGxDbGllbnRzKCRodHRwLCRzY29wZSwnYWxsQ2xpZW50cycsZ2V0Q2xpZW50X3N1Y2Nlc3MpOwogICAgZnVuY3Rpb24gZ2V0Q2xpZW50X3N1Y2Nlc3MoKQogICAgewogICAgICAkc2NvcGUuc2hvd0NsaWVudHNHcmlkT3B0aW9ucy5kYXRhPSRzY29wZS5hbGxDbGllbnRzOwogICAgfQoKICAgICRzY29wZS5nb3RvQ2xpZW50UGFnZT0gZnVuY3Rpb24gKGJ1c2luZXNzVXNlcmlkKQogICAgewogICAgICBnb3RvQ2xpZW50UGFnZShidXNpbmVzc1VzZXJpZCk7CiAgICB9CgogICAgLy8gZmlsdGVyIGFyY2hpdmVkIGNsaWVudHMKICAgICRzY29wZS5zaG93QXJjaGl2ZWRDaGVja2JveD1mYWxzZTsKICAgICRzY29wZS5zaG93QXJjaGl2ZWQgPSBmdW5jdGlvbiAoZWNsaWVudCkKICAgIHsKICAgICAgaWYgKGVjbGllbnQuaXNfYWN0aXZlPT0wKQogICAgICB7CiAgICAgICAgbG9nRGVidWcoZWNsaWVudCk7CiAgICAgICAgaWYgKCRzY29wZS5zaG93QXJjaGl2ZWRDaGVja2JveCkKICAgICAgICB7CiAgICAgICAgICByZXR1cm4gZWNsaWVudDsKICAgICAgICB9CiAgICAgIH0KICAgICAgZWxzZSB7CiAgICAgICAgcmV0dXJuIGVjbGllbnQ7CiAgICAgIH0KICAgIH07CgogICAgJHNjb3BlLmNsaWVudE5hbWVGaWx0ZXI9IiI7CiAgICAkc2NvcGUuaW5wdXRGaWx0ZXIgPSBmdW5jdGlvbiAoaXRlbSkKICAgIHsKICAgICAgY29uc29sZS5sb2coImNsaWVudE5hbWVGaWx0ZXIiKTsKICAgICAgcmV0dXJuIGZpbHRlcl9maXJzdGxhc3RfbmFtZShpdGVtLmJ1c2VyX2ZpcnN0X25hbWUsaXRlbS5idXNlcl9sYXN0X25hbWUsaXRlbS5idXNlcl9waG9uZV9udW1iZXIsJHNjb3BlLmNsaWVudE5hbWVGaWx0ZXIpOwogICAgfTsKCiAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcz1bXTsKICAgIC8vICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzID0gWwogICAgLy8gICB7ImZpZWxkX2lkIjowLCJmaWVsZF9uYW1lIjoi16rXkNeo15nXmiDXnNeZ15PXlCIsImZpZWxkX2RhdGF0eXBlIjoiREFURSIsImlzX21hbmRhdG9yeSI6MCwgImZyb21kYiI6IGZhbHNlLCAiZGJfaWRfdG9maXgiOiAwLCAiaXNfYWN0aXZlIjogMSwgIm1vZGlmaWVkIjogZmFsc2V9LAogICAgLy8gICB7ImZpZWxkX2lkIjowLCJmaWVsZF9uYW1lIjoi15TXoteo15XXqiIsImZpZWxkX2RhdGF0eXBlIjoiVEVYVF9BUkVBIiwiaXNfbWFuZGF0b3J5IjowLCAiZnJvbWRiIjogZmFsc2UsICJkYl9pZF90b2ZpeCI6IDAsICJpc19hY3RpdmUiOiAxLCAibW9kaWZpZWQiOiBmYWxzZX0KICAgIC8vIF07CgogICAgZnVuY3Rpb24gZ2V0Q2xpZW50c0V4dHJhRmllbGRzX3N1Y2Nlc3MoKQogICAgewogICAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyA9ICRzY29wZS5leHRyYUZpZWxkczsKICAgIH0KICAgIGdldENsaWVudHNFeHRyYUZpZWxkcygkaHR0cCwkc2NvcGUsJ2V4dHJhRmllbGRzJyxnZXRDbGllbnRzRXh0cmFGaWVsZHNfc3VjY2Vzcyk7CgogICAgJHNjb3BlLmV2ZW50VHlwZUV4dHJhRmllbGRzUG9wID0gZnVuY3Rpb24oZXZlbnRUeXBlUHJvcGVydGllcykgewogICAgICAgIGxvZ0RlYnVnKCJldmVudCBjcmVhdGUgbW9kYWwiKTsKCiAgICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgICAgICAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2NsaWVudF9leHRyYV9maWVsZHMucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ2V2ZW50VHlwZUV4dHJhRmllbGRzTW9kYWxDb250cm9sbGVyJywKICAgICAgICAgICAgc2l6ZTogJ2wnLAogICAgICAgICAgICByZXNvbHZlOiB7CiAgICAgICAgICAgICAgICBldmVudFR5cGVQcm9wZXJ0aWVzOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXZlbnRUeXBlUHJvcGVydGllczsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBtb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHNlbGVjdGVkSXRlbSkgewogICAgICAgICAgICBsb2dEZWJ1ZyhzZWxlY3RlZEl0ZW0pOwogICAgICAgICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzID0gc2VsZWN0ZWRJdGVtOwogICAgICAgIH0sIGZ1bmN0aW9uKCkgewogICAgICAgICAgICBsb2dEZWJ1ZygnTW9kYWwgZGlzbWlzc2VkIGF0OiAnICsgbmV3IERhdGUoKSk7CiAgICAgICAgfSk7CiAgICB9Owp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ3NjaGVkdWxlckNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkcm91dGVQYXJhbXMpIHsKICAgIGV2ZW50X3R5cGVfaWQ9JHJvdXRlUGFyYW1zLmV2ZW50X3R5cGVfaWQ7CgogICAgJHNjb3BlLnN1Z2dlc3Rpb25EYXRlID0gW107CiAgICAkc2NvcGUuc3VnZ2VzdGlvbkRhdGUuZGF0ZSA9IG5ldyBEYXRlKCk7CiAgICAkc2NvcGUuc3VnZ2VzdGlvbkRhdGUub3B0aW9ucyA9IHsKICAgICAgICAgICAgLy8gbWluRGF0ZTogbmV3IERhdGUoKSwKICAgICAgICAgICAgLy8gc2hvd1dlZWtzOiB0cnVlLAogICAgICAgICAgICBtaW5WaWV3OidkYXknLAogICAgICAgICAgICBzdGFydFZpZXc6ICdkYXknCgogICAgICAgICAgfTsKICAgIHZhciB0aGV0aW1lID0gbmV3IERhdGUoKTsKICAgICRzY29wZS5maWx0ZXJBbGxEYXlzQ2hlY2tib3g9dHJ1ZTsKICAgICRzY29wZS5maWx0ZXJEYXlJdGVtcyA9IHsKCiAgICAgICfXqNeQ16nXldefJzogdHJ1ZSwKICAgICAgJ9ep16DXmSc6IHRydWUsCiAgICAgICfXqdec15nXqdeZJzogdHJ1ZSwKICAgICAgJ9eo15HXmdei15knOiB0cnVlLAogICAgICAn15fXnteZ16nXmSc6IHRydWUsCiAgICAgICfXqdeZ16nXmSc6IHRydWUsCiAgICAgICfXqdeR16onOiB0cnVlCiAgICB9OwoKICAgICRzY29wZS5vblRpbWVTZXQgPSBmdW5jdGlvbiAobmV3RGF0ZSwgb2xkRGF0ZSkgewogICAgICAgIGxvZ0RlYnVnKCJuZXcgZGF0ZSAiK25ld0RhdGUuZ2V0VGltZSgpICsgIiBvbGQgZGF0ZSAiK29sZERhdGUuZ2V0VGltZSgpKTsKICAgICAgICBkaWZmPW5ld0RhdGUuZ2V0VGltZSgpLW9sZERhdGUuZ2V0VGltZSgpOwogICAgICAgIC8vIGlmIG5ldyBkYXRlIGlzIGluIGEgZGlmZmVyZW50IHdlZWsKICAgICAgICAvLyB3ZSByZWZldGNoIHN1Z2dlc3Rpb25zIGZvciB0aGUgY3VycmVudCB3ZWVrCiAgICAgICAgdmFyIG5ld0RhdGVXID0gbmV3IERhdGUobmV3RGF0ZSk7CiAgICAgICAgdmFyIG9sZERhdGVXID0gbmV3IERhdGUob2xkRGF0ZSk7CiAgICAgICAgLy8gYWxlcnQobmV3RGF0ZVcuZm9ybWF0KCdXJykpOwogICAgICAgIC8vIGFsZXJ0KG9sZERhdGVXLmZvcm1hdCgnVycpKTsKICAgICAgICBpZiAobmV3RGF0ZVcuZm9ybWF0KCdXJykhPW9sZERhdGVXLmZvcm1hdCgnVycpKQogICAgICAgIHsKICAgICAgICAgIGxvZ0RlYnVnKCJkaWZmIGlzIGEgd2VlayBvciBtb3JlLCByZWZldGNoaW5nIHN1Z2dlc3Rpb25zIik7CiAgICAgICAgICAkaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3QvIitldmVudF90eXBlX2lkKyIvIituZXdEYXRlLmdldEZ1bGxZZWFyKCkrIi8iKyhuZXdEYXRlLmdldE1vbnRoKCkrMSkrIi8iK25ld0RhdGUuZ2V0RGF0ZSgpKyIvIituZXdEYXRlLmdldEhvdXJzKCkgKyAiLyIgKyBuZXdEYXRlLmdldE1pbnV0ZXMoKSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkgewogICAgICAgICAgICAgIC8vCSAgICAkc2NvcGUubXlEYXRhID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgICAgICAvLwkJbG9nRGVidWcoImdyaWRvcHRpb25zPSIrJHNjb3BlLmdyaWRPcHRpb25zKTsKICAgICAgICAgICAgICAkc2NvcGUuZXZlbnRzU3VnZ2VzdGVkID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgIH0pOwoKICAgICAgICB9CiAgICB9CgogICAgJHNjb3BlLm9wdGlvbnMgPSB7CiAgICAgICBjdXN0b21DbGFzczogZ2V0RGF5Q2xhc3MsCiAgICAgICBtaW5EYXRlOiBuZXcgRGF0ZSgpLAogICAgICAgc2hvd1dlZWtzOiB0cnVlCiAgICAgfTsKICAgICAkc2NvcGUuZHQgPSBuZXcgRGF0ZSgpOwoKCiAgICAgZnVuY3Rpb24gZ2V0RGF5Q2xhc3MoZGF0YSkgewogICAgICAgICByZXR1cm4gJyc7CiAgICAgICB9CgogICAgJHNjb3BlLmRheXNJdGVtcyA9IFsKICAgICAge25hbWU6J9eo15DXqdeV158nfSwKICAgICAge25hbWU6J9ep16DXmSd9LAogICAgICB7bmFtZTon16nXnNeZ16nXmSd9LAogICAgICB7bmFtZTon16jXkdeZ16LXmSd9LAogICAgICB7bmFtZTon15fXnteZ16nXmSd9LAogICAgICB7bmFtZTon16nXmdep15knfSwKICAgICAge25hbWU6J9ep15HXqid9CiAgICBdOwoKICAgICRzY29wZS5maWx0ZXJBbGxEYXlJdGVtc1NldCA9IGZ1bmN0aW9uICgpCiAgICB7CiAgICAgICRzY29wZS5maWx0ZXJEYXlJdGVtc1sn16jXkNep15XXnyddPSRzY29wZS5maWx0ZXJBbGxEYXlzQ2hlY2tib3g7CiAgICAgICRzY29wZS5maWx0ZXJEYXlJdGVtc1sn16nXoNeZJ109JHNjb3BlLmZpbHRlckFsbERheXNDaGVja2JveDsKICAgICAgJHNjb3BlLmZpbHRlckRheUl0ZW1zWyfXqdec15nXqdeZJ109JHNjb3BlLmZpbHRlckFsbERheXNDaGVja2JveDsKICAgICAgJHNjb3BlLmZpbHRlckRheUl0ZW1zWyfXqNeR15nXoteZJ109JHNjb3BlLmZpbHRlckFsbERheXNDaGVja2JveDsKICAgICAgJHNjb3BlLmZpbHRlckRheUl0ZW1zWyfXl9ee15nXqdeZJ109JHNjb3BlLmZpbHRlckFsbERheXNDaGVja2JveDsKICAgICAgJHNjb3BlLmZpbHRlckRheUl0ZW1zWyfXqdeZ16nXmSddPSRzY29wZS5maWx0ZXJBbGxEYXlzQ2hlY2tib3g7CiAgICAgICRzY29wZS5maWx0ZXJEYXlJdGVtc1sn16nXkdeqJ109JHNjb3BlLmZpbHRlckFsbERheXNDaGVja2JveDsKICAgIH0KCiAgICAkc2NvcGUuc3VnZ2VzdEZpbHRlckRheXMgPSBmdW5jdGlvbiAoZXN1Z2dlc3QpCiAgICB7CiAgICAgIC8vIGxvZ0RlYnVnKGVzdWdnZXN0KTsKICAgICAgaWYgKCgkc2NvcGUuZmlsdGVyRGF5SXRlbXNbZXN1Z2dlc3Quc3RhcnRfZm9ybWF0X2Rvd10pICYgKCgkc2NvcGUuc3VnZ2VzdGlvbkRhdGUuZGF0ZS5nZXRUaW1lKCkvMTAwMCk8ZXN1Z2dlc3Quc3RhcnRfZXBvY2gpKQogICAgICB7CiAgICAgICAgcmV0dXJuIGVzdWdnZXN0OwogICAgICB9CiAgICB9OwoKICAgIGxvZ0RlYnVnKCdzY2hlZHVsZXJDb250cm9sbGVyIGZvciBldmVudCB0eXBlIGlkICcrZXZlbnRfdHlwZV9pZCsiICIrdGhldGltZS5nZXRIb3VycygpICsgIjoiICsgdGhldGltZS5nZXRNaW51dGVzKCkgKyAiOiIgKyB0aGV0aW1lLmdldFNlY29uZHMoKSk7CiAgICAkaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3QvIitldmVudF90eXBlX2lkKyIvIit0aGV0aW1lLmdldEZ1bGxZZWFyKCkrIi8iKyh0aGV0aW1lLmdldE1vbnRoKCkrMSkrIi8iK3RoZXRpbWUuZ2V0RGF0ZSgpKyIvIit0aGV0aW1lLmdldEhvdXJzKCkgKyAiLyIgKyB0aGV0aW1lLmdldE1pbnV0ZXMoKSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkgewogICAgICAgIC8vCSAgICAkc2NvcGUubXlEYXRhID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAvLwkJbG9nRGVidWcoImdyaWRvcHRpb25zPSIrJHNjb3BlLmdyaWRPcHRpb25zKTsKICAgICAgICAkc2NvcGUuZXZlbnRzU3VnZ2VzdGVkID0gcmVzcG9uc2UuZGF0YTsKICAgIH0pOwoKICAgICRodHRwLmdldCgkZ0FwaVVSTFByZWZpeCArICIvZW5kdXNlci9ldmVudF90eXBlcy8iK2V2ZW50X3R5cGVfaWQpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHsKICAgICAgICAvLwkgICAgJHNjb3BlLm15RGF0YSA9IHJlc3BvbnNlLmRhdGE7CiAgICAgICAgLy8JCWxvZ0RlYnVnKCJncmlkb3B0aW9ucz0iKyRzY29wZS5ncmlkT3B0aW9ucyk7CiAgICAgICAgJHNjb3BlLmV2ZW50VHlwZURldGFpbHMgPSByZXNwb25zZS5kYXRhOwogICAgfSk7Cn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdjb250YWN0Q29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHApIHsKICAgIGxvZ0RlYnVnKCdjb250YWN0Q29udHJvbGxlcicpOwp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ3BhY2thZ2VQYXltZW50QXNzb2NpYXRpb25Nb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRyb3V0ZVBhcmFtcywgJHJvb3RTY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRodHRwLCBmcGFja2FnZSwgYmFsYW5jZSwgYnVzaW5lc3NfdXNlcl9pZCwgdWlDYWxlbmRhckNvbmZpZykKewogIGxvZ0RlYnVnKCJwYWNrYWdlUGF5bWVudEFzc29jaWF0aW9uTW9kYWxDb250cm9sbGVyIik7CgogICRzY29wZS5mcGFja2FnZT1mcGFja2FnZTsKICAkc2NvcGUuYmFsYW5jZT1iYWxhbmNlOwogICRzY29wZS5wYWNrYWdlX3BheW1lbnRzPSRzY29wZS5mcGFja2FnZS5wYWNrYWdlX3BheW1lbnRzOwogICRzY29wZS5wcmV2aW91c19pc19hbGxfcGFpZD0kc2NvcGUuZnBhY2thZ2UuaXNfYWxsX3BhaWQ7CiAgJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQ9YnVzaW5lc3NfdXNlcl9pZDsKCiAgLy8gJ2NhbGN1bGF0aW5nJyBwcmV2aW91cyBzdGF0dXMgb2YgcGF5bWVudAogIGlmICgkc2NvcGUucGFja2FnZV9wYXltZW50cz4wKQogIHsKICAgIGlmICgkc2NvcGUucHJldmlvdXNfaXNfYWxsX3BhaWQ9PTEpCiAgICB7CiAgICAgICRzY29wZS5wcmV2aW91c19zdGF0dXM9ImlzX2FsbF9wYWlkIjsKICAgICAgJHNjb3BlLnBhY2thZ2Vfc3RhdHVzX2lkPS0xOwogICAgICAkc2NvcGUucHJldmlvdXNfcGFja2FnZV9zdGF0dXNfaWQ9LTE7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICRzY29wZS5wcmV2aW91c19zdGF0dXM9ImlzX3BhcnRseV9wYWlkIjsKICAgICAgJHNjb3BlLnBhY2thZ2Vfc3RhdHVzX2lkPS0xOwogICAgICAkc2NvcGUucHJldmlvdXNfcGFja2FnZV9zdGF0dXNfaWQ9LTE7CiAgICB9CiAgfQogIGVsc2UKICB7CiAgICAgICRzY29wZS5wcmV2aW91c19zdGF0dXM9Im5vdF9wYWlkIjsKICAgICAgJHNjb3BlLnBhY2thZ2Vfc3RhdHVzX2lkPTA7CiAgICAgICRzY29wZS5wcmV2aW91c19wYWNrYWdlX3N0YXR1c19pZD0wOwoKICB9CiAgbG9nRGVidWcoInByZXZpb3VzX3N0YXR1cz0iKyRzY29wZS5wcmV2aW91c19zdGF0dXMpOwoKICAkc2NvcGUuY2xvc2VNb2RhbCA9IGZ1bmN0aW9uKCkKICB7CiAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICB9OwogICRzY29wZS51cGRhdGVQYWNrYWdlUGF5bWVudCA9IGZ1bmN0aW9uKCkKICB7CiAgICAvLyBjb25zb2xlLmxvZygicHJldmlvdXNfcGFja2FnZV91c2VyX2lkPSIrJHNjb3BlLmZtZWV0aW5nLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZCk7CiAgICAvLyBjb25zb2xlLmxvZygicGFja2FnZV91c2VyX2lkPSIrJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZCk7CiAgICBsb2dEZWJ1ZygidXBkYXRlUGFja2FnZVBheW1lbnQiKQogICAgLy8gaWYgc2VsZWN0ZWQgcGFja2FnZSBpcyBsaWtlIHByZXZpb3VzIHBhY2thZ2UgLSBkbyBub3RoaW5nCiAgICBpZiAoKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3N0YXR1c19pZD09JHNjb3BlLnBhY2thZ2Vfc3RhdHVzX2lkKSkKICAgIHsKICAgICAgbG9nRGVidWcoInNlbGVjdGVkIG9wdGlvbiBpcyBsaWtlIHByZXZpb3VzIG9wdGlvbiAtIGRvIG5vdGhpbmciKTsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgfQoKICAgIC8vIHByZXZpb3VzIHBhY2thZ2Ugd2FzIHBhaWQvcGFydGx5LXBhaWQgLSBub3cgbm90aGluZ3MgaXMgc2VsZWN0ZWQKICAgIGVsc2UgaWYgKCgkc2NvcGUucHJldmlvdXNfcGFja2FnZV9zdGF0dXNfaWQ9PS0xKSAmJiAoJHNjb3BlLnBhY2thZ2Vfc3RhdHVzX2lkPT0wKSkKICAgIHsKICAgICAgbG9nRGVidWcoIndhcyBwYWlkL3BhcnRseSBwYWlkLCByZW1vdmluZyBwYXltZW50Iik7CiAgICAgIHJlbW92ZVBhY2thZ2VQYXltZW50KCRodHRwLCRzY29wZSwkc2NvcGUuZnBhY2thZ2UucGFja2FnZV91c2VyX2lkLCRzY29wZS5idXNpbmVzc191c2VyX2lkLHVwZGF0ZUV2ZW50UGFja2FnZV9zdWNjZXNzKTsKICAgIH0KICAgIC8vIHByZXZpb3VzIHBhY2thZ2Ugd2FzIHNlbGVjdGVkIC0gbm93IGEgZGlmZmVyZW50IHBhY2thZ2UgaXMgc2VsZWN0ZWQKICAgIGVsc2UgaWYgKCgkc2NvcGUucHJldmlvdXNfcGFja2FnZV9zdGF0dXNfaWQ9PTApICYmICgkc2NvcGUucGFja2FnZV9zdGF0dXNfaWQ9PS0xKSkKICAgIHsKICAgICAgbG9nRGVidWcoIndhcyBub3QgcGFpZCAtIG5vdyBwYXkgZnVsbHkvcGFydGlhbGx5Iik7CiAgICAgIHBheUZvclBhY2thZ2UoJGh0dHAsJHNjb3BlLCRzY29wZS5mcGFja2FnZS5wYWNrYWdlX3VzZXJfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwoKICAgICAgLy8gcmVhc3NpZ25FdmVudFBhY2thZ2VBc3NvY2lhdGlvbigkaHR0cCwkc2NvcGUsJHNjb3BlLmZtZWV0aW5nLmV2ZW50X2lkLCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MoKQogIHsKICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICAgIGxvZ0RlYnVnKCJicm9hZGNhc3RpbmcgY2xpZW50UGFnZVJlbG9hZERhdGEiKTsKICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKICB9Cgp9KTsKCmt1emVBcHAuY29udHJvbGxlcignZXZlbnRQYWNrYWdlQXNzb2NpYXRpb25Nb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRyb3V0ZVBhcmFtcywgJHJvb3RTY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRodHRwLCBmbWVldGluZywgYmFsYW5jZSwgYnVzaW5lc3NfdXNlcl9pZCwgdWlDYWxlbmRhckNvbmZpZykKewogICRzY29wZS5mbWVldGluZz1hbmd1bGFyLmNvcHkoZm1lZXRpbmcpOwogICRzY29wZS5iYWxhbmNlPWJhbGFuY2U7CiAgJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD0kc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkOwogICRzY29wZS5wcmV2aW91c19ldmVudF9wYXltZW50cz0kc2NvcGUuZm1lZXRpbmcuZXZlbnRfcGF5bWVudHM7CiAgJHNjb3BlLnByZXZpb3VzX2lzX2FsbF9wYWlkPSRzY29wZS5mbWVldGluZy5pc19hbGxfcGFpZDsKICAkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZD1idXNpbmVzc191c2VyX2lkOwoKICAvLyAnY2FsY3VsYXRpbmcnIHByZXZpb3VzIHN0YXR1cyBvZiBwYXltZW50CiAgaWYgKCRzY29wZS5wcmV2aW91c19ldmVudF9wYXltZW50cz4wKQogIHsKICAgIGlmICgkc2NvcGUucHJldmlvdXNfaXNfYWxsX3BhaWQ9PTEpCiAgICB7CiAgICAgICRzY29wZS5wcmV2aW91c19zdGF0dXM9ImlzX2FsbF9wYWlkIjsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgJHNjb3BlLnByZXZpb3VzX3N0YXR1cz0iaXNfcGFydGx5X3BhaWQiOwogICAgfQogIH0KICBlbHNlCiAgewogICAgICBpZiAoJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD4wKQogICAgICB7CiAgICAgICAgJHNjb3BlLnByZXZpb3VzX3N0YXR1cz0iaXNfcGFja2FnZV9wYWlkIjsKICAgICAgfQogICAgICBlbHNlCiAgICAgIHsKICAgICAgICAkc2NvcGUucHJldmlvdXNfc3RhdHVzPSJub3RfcGFpZCI7CiAgICAgIH0KICB9CiAgbG9nRGVidWcoInByZXZpb3VzX3N0YXR1cz0iKyRzY29wZS5wcmV2aW91c19zdGF0dXMpOwoKICBpZiAoKCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQ9PTApICYmICgkc2NvcGUuZm1lZXRpbmcuZXZlbnRfcGF5bWVudHM+MCkpCiAgewogICAgLy8gdGhpcyBpcyBhIGNhc2Ugd2hlcmUgcGF5bWVudCB3YXMgcGFydGx5IG9yIGZ1bGx5IG1hZGUgZnJvbSBiYWxhbmNlCiAgICAkc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkPS0xOwogICAgJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD0tMTsKICB9CgogIGxvZ0RlYnVnKCJldmVudFBhY2thZ2VBc3NvY2lhdGlvbk1vZGFsQ29udHJvbGxlciIpOwogIGdldFBhY2thZ2VzRm9yRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5idXNpbmVzc191c2VyX2lkLCRzY29wZS5mbWVldGluZy5ldmVudF9pZCwncmVsYXRlZFBhY2thZ2VzJyxnZXRQYWNrYWdlc0ZvckV2ZW50X3N1Y2Nlc3MpOyAvLyB3YXMgZ2V0QnVzaW5lc3NQYWNrYWdlCiAgZnVuY3Rpb24gZ2V0UGFja2FnZXNGb3JFdmVudF9zdWNjZXNzKCkKICB7CiAgfQoKICAkc2NvcGUuY2xvc2VNb2RhbCA9IGZ1bmN0aW9uKCkKICB7CiAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICB9OwogICRzY29wZS51cGRhdGVFdmVudFBhY2thZ2UgPSBmdW5jdGlvbigpCiAgewogICAgY29uc29sZS5sb2coInByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD0iKyRzY29wZS5mbWVldGluZy5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQpOwogICAgY29uc29sZS5sb2coInBhY2thZ2VfdXNlcl9pZD0iKyRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQpOwogICAgLy8gaWYgc2VsZWN0ZWQgcGFja2FnZSBpcyBsaWtlIHByZXZpb3VzIHBhY2thZ2UgLSBkbyBub3RoaW5nCiAgICBpZiAoKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ9PSRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQpKQogICAgewogICAgICBsb2dEZWJ1Zygic2VsZWN0ZWQgb3B0aW9uIGlzIGxpa2UgcHJldmlvdXMgb3B0aW9uIC0gZG8gbm90aGluZyIpOwogICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgICB9CiAgICAvLyBpZiBzZWxlY3RlZCBwYWNrYWdlIGlzIGxpa2UgcHJldmlvdXMgcGFja2FnZSAtIGRvIG5vdGhpbmcKICAgIGlmICgoJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD09JHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZCkgJiYgKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ+MCkpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJzZWxlY3RlZCBwYWNrYWdlIGlzIGxpa2UgcHJldmlvdXMgcGFja2FnZSAtIGRvIG5vdGhpbmciKTsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgfQogICAgLy8gcHJldmlvdXMgcGFja2FnZSB3YXMgc2VsZWN0IC0gbm93IG5vdGhpbmdzIGlzIHNlbGVjdGVkCiAgICBlbHNlIGlmICgoJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD4wKSAmJiAoJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZD09MCkpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJubyBwYWNrYWdlIHNlbGVjdGVkLCByZW1vdmUgcGFja2FnZS1ldmVudCBhc3NvY2lhdGlvbiIpOwogICAgICByZW1vdmVFdmVudFBhY2thZ2VBc3NvY2lhdGlvbigkaHR0cCwkc2NvcGUsJHNjb3BlLmZtZWV0aW5nLmV2ZW50X2lkLCRzY29wZS5idXNpbmVzc191c2VyX2lkLHVwZGF0ZUV2ZW50UGFja2FnZV9zdWNjZXNzKTsKICAgIH0KICAgIC8vIHByZXZpb3VzIHBhY2thZ2Ugd2FzIHNlbGVjdGVkIC0gbm93IGEgZGlmZmVyZW50IHBhY2thZ2UgaXMgc2VsZWN0ZWQKICAgIGVsc2UgaWYgKCgkc2NvcGUucHJldmlvdXNfcGFja2FnZV91c2VyX2lkPjApICYmICgkc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkPjApKQogICAgewogICAgICBsb2dEZWJ1ZygidXBkYXRpbmcgbmV3IHBhY2thZ2UgdG8gcGFja2FnZV91c2VyX2lkPSAiKyRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQpOwogICAgICByZWFzc2lnbkV2ZW50UGFja2FnZUFzc29jaWF0aW9uKCRodHRwLCRzY29wZSwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZCwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCx1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2Vzcyk7CiAgICB9CiAgICAvLyBwcmV2aW91cyBwYWNrYWdlIHdhcyBub25lIC0gbm93IGEgcGFja2FnZSBpcyBzZWxlY3RlZAogICAgZWxzZSBpZiAoKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ9PTApICYmICgkc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkPjApKQogICAgewogICAgICBsb2dEZWJ1ZygidXBkYXRpbmcgbmV3IHBhY2thZ2UgdG8gcGFja2FnZV91c2VyX2lkPSAiKyRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQpOwogICAgICByZWFzc2lnbkV2ZW50UGFja2FnZUFzc29jaWF0aW9uKCRodHRwLCRzY29wZSwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZCwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCx1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2Vzcyk7CiAgICB9CiAgICAvLyBwcmV2aW91cyBhc3NvY2lhdGlvbiB3YXMgcGFpZCBvciBoYWxmIHBhaWQgLSBub3cgaXRzIG5vbmUKICAgIGVsc2UgaWYgKCgkc2NvcGUucHJldmlvdXNfZXZlbnRfcGF5bWVudHM+MCkgJiYgKCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQ9PTApKQogICAgewogICAgICBsb2dEZWJ1ZygicmVtb3ZpbmcgcGF5bWVudCBmcm9tIGV2ZW50LCBwYWNrYWdlX3VzZXJfaWQ9ICIrJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZCk7CiAgICAgIHJlbW92ZUV2ZW50UGF5bWVudEFzc29jaWF0aW9uKCRodHRwLCRzY29wZSwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwoKICAgICAgLy8gcmVhc3NpZ25FdmVudFBhY2thZ2VBc3NvY2lhdGlvbigkaHR0cCwkc2NvcGUsJHNjb3BlLmZtZWV0aW5nLmV2ZW50X2lkLCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwogICAgICAvLyB0b2RvCiAgICB9CiAgICAvLyB3YXMgcGFja2FnZSBwYXltZW50IC0+IG5vdyBiYWxhbmNlIHBheW1lbnQKICAgIGVsc2UgaWYgKCgkc2NvcGUucHJldmlvdXNfcGFja2FnZV91c2VyX2lkPjApICYmICgkc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkPT0tMSkpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJtb3ZpbmcgcGF5bWVudCBmcm9tIHBhY2thZ2UgdG8gYmFsYW5jZSIpOwogICAgICBhZGRFdmVudFBheW1lbnRSZW1vdmVQYWNrYWdlKCRodHRwLCRzY29wZSwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwogICAgfQogICAgLy8gd2FzIGJhbGFuY2UgcGF5bWVudCAtPiBub3cgcGFja2FnZSBwYXltZW50CiAgICBlbHNlIGlmICgoJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD09LTEpICYmICgkc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkPjApKQogICAgewogICAgICBsb2dEZWJ1ZygibW92aW5nIHBheW1lbnQgZnJvbSBiYWxhbmNlIHRvIHBhY2thZ2UiKTsKICAgICAgYWRkRXZlbnRQYWNrYWdlUmVtb3ZlUGF5bWVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLmZtZWV0aW5nLmV2ZW50X2lkLCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwoKICAgIH0KICAgIC8vIHdhcyBub3QgcGFpZCBhdCBhbGwgLT4gbm93IGJhbGFuY2UgcGF5CiAgICBlbHNlIGlmICgoJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD09MCkgJiYgKCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQ9PS0xKSkKICAgIHsKICAgICAgbG9nRGVidWcoIm1vdmluZyBwYXltZW50IGZyb20gbm9uZSB0byBiYWxhbmNlIik7CiAgICAgIGFkZEV2ZW50UGF5bWVudEFzc29jaWF0aW9uKCRodHRwLCRzY29wZSwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MoKQogIHsKICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICAgIGxvZ0RlYnVnKCJicm9hZGNhc3RpbmcgY2xpZW50UGFnZVJlbG9hZERhdGEiKTsKICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKICB9Cgp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ2FyY2hpdmVfY2xpZW50X21vZGFsJywgZnVuY3Rpb24oJHNjb3BlLCAkbG9jYXRpb24sIGlzX2luc3RydWN0b3IsIGJ1c2luZXNzX3VzZXJfaWQsIGJ1c2VyX2ZpcnN0X25hbWUsIGJ1c2VyX2xhc3RfbmFtZSwgJHJvb3RTY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRodHRwLCB1aUNhbGVuZGFyQ29uZmlnKSB7CiAgJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQ9YnVzaW5lc3NfdXNlcl9pZDsKICAkc2NvcGUuYnVzZXJfZmlyc3RfbmFtZT1idXNlcl9maXJzdF9uYW1lOwogICRzY29wZS5idXNlcl9sYXN0X25hbWU9YnVzZXJfbGFzdF9uYW1lOwogICRzY29wZS5pc19pbnN0cnVjdG9yPWlzX2luc3RydWN0b3I7CgogIGxvZ0RlYnVnKCJhcmNoaXZlX2NsaWVudF9tb2RhbCBjb250cm9sbGVyIik7CgogICRzY29wZS5jbG9zZU1vZGFsID0gZnVuY3Rpb24oKSB7CiAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICB9OwoKICAkc2NvcGUuYXJjaGl2ZUNsaWVudCA9IGZ1bmN0aW9uKCkKICB7CiAgICBhcmNoaXZlQ2xpZW50KCRodHRwLCRzY29wZSwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCxhcmNoaXZlQ2xpZW50X3N1Y2Nlc3MpOwogICAgZnVuY3Rpb24gYXJjaGl2ZUNsaWVudF9zdWNjZXNzKCkKICAgIHsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgICBpZiAoJHNjb3BlLmlzX2luc3RydWN0b3IpCiAgICAgIHsKICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2luc3RydWN0b3JzJyk7CiAgICAgIH0KICAgICAgZWxzZSB7CiAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jbGllbnRzJyk7CiAgICAgIH0KICAgIH0KICB9Cgp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ3BheW1lbnlEZXRhaWxzTW9kYWxDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkcm91dGVQYXJhbXMsICRyb290U2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgZnBheW1lbnQsIHVpQ2FsZW5kYXJDb25maWcpIHsKICAkc2NvcGUuZnBheW1lbnQ9e307CiAgJHNjb3BlLmZwYXltZW50LnBheW1lbnRfZGF0ZT1mcGF5bWVudC5wYXltZW50X2RhdGU7CiAgJHNjb3BlLmZwYXltZW50LnBheW1lbnRfYW1vdW50PWZwYXltZW50LnBheW1lbnRfYW1vdW50OwogICRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2dlbmVyYXRlZD1mcGF5bWVudC5pbnZvaWNlX2dlbmVyYXRlZDsKICAkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9udW1iZXI9ZnBheW1lbnQuaW52b2ljZV9udW1iZXI7CiAgaWYgKGZwYXltZW50Lmludm9pY2VfZGF0ZT09bnVsbCkKICB7CiAgICAkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlX2Zvcm1hdD1uZXcgRGF0ZSgpOwogIH0KICBlbHNlCiAgewogICAgJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZV9mb3JtYXQ9ZnBheW1lbnQuaW52b2ljZV9kYXRlX2Zvcm1hdDsKICB9CiAgJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZT1mcGF5bWVudC5pbnZvaWNlX2RhdGU7CiAgJHNjb3BlLnNlbGVjdGVkUGF5bWVudE1ldGhvZD17CgkJbmFtZTogZnBheW1lbnQucGF5bWVudF9tZXRob2RfbmFtZV90eHQsCgkJbWV0aG9kOiBmcGF5bWVudC5wYXltZW50X21ldGhvZF9uYW1lCgl9OwogICRzY29wZS5pc1BheW1lbnRNZXRob2RTZWxlY3RlZD10cnVlOwoKICBsb2dEZWJ1Zygib2xkIGRhdGUgIiskc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlKTsKICBpZiAoJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZSE9bnVsbCkKICB7CiAgICAkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlX2Zvcm1hdCA9IG5ldyBEYXRlKCRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2RhdGUpOwogIH0KICAkc2NvcGUucGF5bWVudE1ldGhvZHMgPSBwYXltZW50TWV0aG9kczsKICAkc2NvcGUucGF5bWVudFR5cGVUaXRsZT1mcGF5bWVudC5wYXltZW50X21ldGhvZF9uYW1lX3R4dDsKICAkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9zb3VyY2U9IkVYVEVSTkFMIjsKCiAgbG9nRGVidWcoJHNjb3BlLnBheW1lbnRNZXRob2RzKTsKICBsb2dEZWJ1ZygicGF5bWVueURldGFpbHNNb2RhbENvbnRyb2xsZXIgZm9yIHBheW1lbnQgIitKU09OLnN0cmluZ2lmeShmcGF5bWVudCwgbnVsbCwgNCkpOwoKICAkc2NvcGUuc2VsZWN0UGF5bWVudE1ldGhvZCA9IGZ1bmN0aW9uKHBheW1lbnQpIHsKICAgICRzY29wZS5wYXltZW50VHlwZVRpdGxlPXBheW1lbnQubmFtZTsKICAgIGxvZ0RlYnVnKCJwYXltZW50PSIrcGF5bWVudCk7CgogICAgJHNjb3BlLnNlbGVjdGVkUGF5bWVudE1ldGhvZD1wYXltZW50OwogICAgJHNjb3BlLmlzUGF5bWVudE1ldGhvZFNlbGVjdGVkPXRydWU7CiAgfTsKCiAgJHNjb3BlLmNsb3NlTW9kYWwgPSBmdW5jdGlvbigpIHsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogIH07CgogICRzY29wZS51cGRhdGVQYXltZW50ID0gZnVuY3Rpb24oKQogIHsKICAgIC8vIGxvZ0RlYnVnKGN1cnJlbnRDbGllbnQpOwogICAgbG9nRGVidWcoInBheW1lbnQgbWV0aG9kIik7CiAgICBsb2dEZWJ1Zygkc2NvcGUuc2VsZWN0ZWRQYXltZW50TWV0aG9kKTsKICAgIGxvZ0RlYnVnKCIkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9nZW5lcmF0ZWQ9PCIrJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZ2VuZXJhdGVkKyI+LCAkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlX2Zvcm1hdD0iKyRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2RhdGVfZm9ybWF0KTsKICAgIGxvZ0RlYnVnKCIkc2NvcGUuc2VsZWN0ZWRQYXltZW50TWV0aG9kLm1ldGhvZD0iKyRzY29wZS5zZWxlY3RlZFBheW1lbnRNZXRob2QubWV0aG9kKTsKICAgIGlmICgoJHNjb3BlLmZwYXltZW50LnBheW1lbnRfYW1vdW50PT0wKSB8fCAoJHNjb3BlLmZwYXltZW50LnBheW1lbnRfYW1vdW50PT0nJykgfHwgKCRzY29wZS5mcGF5bWVudC5wYXltZW50X2Ftb3VudD09bnVsbCkpCiAgICB7CiAgICAgICRzY29wZS51c2VyRXJyb3I9IteQ16DXkCDXlNeW158g16HXm9eV150g15vXnNep15TXlSI7CiAgICAgIC8vIGFsZXJ0KCdzcycpOwogICAgfQogICAgZWxzZSBpZiAoISRzY29wZS5pc1BheW1lbnRNZXRob2RTZWxlY3RlZCkKICAgIHsKICAgICAgJHNjb3BlLnVzZXJFcnJvcj0i15DXoNeQINeR15fXqCDXkNee16bXoteZINeq16nXnNeV150iOwogICAgICAvLyBhbGVydCgnc3MnKTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgaWYgKCgkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9nZW5lcmF0ZWQhPTEpIHx8ICgkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlX2Zvcm1hdD09bnVsbCkpCiAgICAgIHsKICAgICAgICB2YXIgaW52b2ljZV9kYXRlX2Zvcm1hdCA9ICJudWxsIjsKICAgICAgfQogICAgICBlbHNlCiAgICAgIHsKICAgICAgICB2YXIgaW52b2ljZV9kYXRlX2Zvcm1hdCA9ICRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2RhdGVfZm9ybWF0LmdldERhdGUoKSAgKyAiLSIgKyAoJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZV9mb3JtYXQuZ2V0TW9udGgoKSsxKSArICItIiArICRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2RhdGVfZm9ybWF0LmdldEZ1bGxZZWFyKCk7CiAgICAgIH0KICAgICAgdGhlZGF0YT0gewogICAgICAgICAgYmFsYW5jZVRvUGF5OiAkc2NvcGUuZnBheW1lbnQucGF5bWVudF9hbW91bnQsCiAgICAgICAgICBwYXltZW50X21ldGhvZF9uYW1lOiAkc2NvcGUuc2VsZWN0ZWRQYXltZW50TWV0aG9kLm1ldGhvZCwKICAgICAgICAgIGludm9pY2VfbnVtYmVyOiAkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9udW1iZXIsCiAgICAgICAgICBpbnZvaWNlX2dlbmVyYXRlZDogJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZ2VuZXJhdGVkLAogICAgICAgICAgaW52b2ljZV9kYXRlOiBpbnZvaWNlX2RhdGVfZm9ybWF0LAogICAgICAgICAgaW52b2ljZV9zb3VyY2U6ICRzY29wZS5mcGF5bWVudC5pbnZvaWNlX3NvdXJjZQogICAgICB9OwogICAgICB1cGRhdGVQYXltZW50Rm9yQ2xpZW50KCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCxmcGF5bWVudC51c2VyX3BheW1lbnRfaWQsdGhlZGF0YSxjcmVhdGVQYXltZW50Rm9yQ2xpZW50X2NhbGxiYWNrLCBjcmVhdGVQYXltZW50Rm9yQ2xpZW50X2ZhaWx1cmUpOwogICAgICBmdW5jdGlvbiBjcmVhdGVQYXltZW50Rm9yQ2xpZW50X2NhbGxiYWNrKCkKICAgICAgewogICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICAgICAgICBsb2dEZWJ1ZygiYnJvYWRjYXN0aW5nIGNsaWVudFBhZ2VSZWxvYWREYXRhIik7CiAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGNyZWF0ZVBheW1lbnRGb3JDbGllbnRfZmFpbHVyZSgpCiAgICAgIHsKICAgICAgICBsb2dEZWJ1ZygiYnJvYWRjYXN0aW5nIGNsaWVudFBhZ2VSZWxvYWREYXRhIik7CiAgICAgICAgLy8gJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgICB9CiAgICB9CiB9Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignZXZlbnRUeXBlRXh0cmFGaWVsZHNNb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRyb290U2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgZXZlbnRUeXBlUHJvcGVydGllcywgdWlDYWxlbmRhckNvbmZpZykgewogICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzPWV2ZW50VHlwZVByb3BlcnRpZXM7CiAgbG9nRGVidWcoImV2ZW50VHlwZVByb3BlcnRpZXM9IitKU09OLnN0cmluZ2lmeShldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzLCBudWxsLCA0KSk7CiAgaWYgKGV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHM9PW51bGwpCiAgewogICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXNPcmlnPVtdOwogICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHM9W107CiAgfQogIGVsc2UgaWYgKGV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMubGVuZ3RoPjApCiAgewogICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXNPcmlnPShldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzKS5zbGljZSgwKTsKICB9CiAgZWxzZQogIHsKICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzT3JpZz1bXTsKICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzPVtdOwogIH0KICAkc2NvcGUub2tMaW1pdGF0aW9uTW9kYWwgPSBmdW5jdGlvbigpIHsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogIH07CgogICRzY29wZS5jYW5jZWwgPSBmdW5jdGlvbigpCiAgewogICAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcz0kc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllc09yaWc7CiAgICAgIGxvZ0RlYnVnKCJjbG9zZSIpOwogICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllc09yaWcpOwogIH0KICAkc2NvcGUuc2F2ZUFuZENsb3NlID0gZnVuY3Rpb24oKQogIHsKICAgIGxvZ0RlYnVnKCJzYXZlIGFuZCBjbG9zZSIpOwogICAgZnVuY3Rpb24gc2V0Q2xpZW50c0V4dHJhRmllbGRzX3N1Y2Nlc3MoKQogICAgewoKICAgIH0KICAgICRzY29wZS5DbGllbnRzRGV0YWlscz17fTsKICAgICRzY29wZS5DbGllbnRzRGV0YWlscy5leHRyYUZpZWxkcz0kc2NvcGUuZXh0cmFGaWVsZHM7CiAgICBzZXRDbGllbnRzRXh0cmFGaWVsZHMoJGh0dHAsJHNjb3BlLCRzY29wZS5DbGllbnRzRGV0YWlscyxzZXRDbGllbnRzRXh0cmFGaWVsZHNfc3VjY2Vzcyk7CiAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyk7CiAgfQoKICAkc2NvcGUuYWRkRXh0cmFGaWVsZHMgPSBmdW5jdGlvbigpCiAgewogICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyk7CiAgfQoKICAkc2NvcGUuZXh0cmFGaWVsZHMgPSBldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzOwogICRzY29wZS5maWVsZFR5cGVzID0gW3tmaWVsZF9kYXRhdHlwZTogIlRFWFRfQVJFQSIsIG5hbWU6J9eq15nXkdeqINeY16fXodeYJ30sIHtmaWVsZF9kYXRhdHlwZTogIk5VTUJFUiIsIG5hbWU6J9ee16HXpNeoJ30gLCB7ZmllbGRfZGF0YXR5cGU6ICJTVFJJTkciLCBuYW1lOifXmNen16HXmCDXp9em16gnfSAsIHtmaWVsZF9kYXRhdHlwZTogIkJPT0xFQU4iLCBuYW1lOifXqteZ15HXqiDXodeZ157XldefJ30gLCB7ZmllbGRfZGF0YXR5cGU6ICJEQVRFIiwgbmFtZTon16rXkNeo15nXmid9XTsKCiAgJHNjb3BlLmFkZE5ld0ZpZWxkID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgbmV3SXRlbU5vID0gJHNjb3BlLmV4dHJhRmllbGRzLmxlbmd0aCsxOwogICAgJHNjb3BlLmV4dHJhRmllbGRzLnB1c2goeyJmaWVsZF9kYXRhdHlwZSI6IlNUUklORyIsImlzX21hbmRhdG9yeSI6MCwgImZyb21kYiI6IGZhbHNlLCAiZmllbGRfaWQiOiAwLCAiaXNfYWN0aXZlIjogMSwgIm1vZGlmaWVkIjogMH0pOwoKICAgIGxvZ0RlYnVnKCJleHRyYSBmaWVsZHMgIiArIEpTT04uc3RyaW5naWZ5KCRzY29wZS5leHRyYUZpZWxkcywgbnVsbCwgMikpOwoKICB9OwoKICAkc2NvcGUucmVtb3ZlRmllbGQgPSBmdW5jdGlvbihjaG9pY2UpCiAgewogICAgLy8gcmVtb3ZpbmcgZmllbGQKICAgIC8vIGlmIGl0cyBub3Qgb3JpZ2luYXRlZCBmcm9tIGRhdGFiYXNlIC0gdGhlbiB3ZSBzaW1wbHkgZGVsZXRlIGl0IGZyb20gdGhlIGFycmF5CiAgICAvLyBvdGhlcndpc2Ugd2UgbWFyayBpdCBhcyBhY3RpdmU9ZmFsc2UKICAgIGxvZ0RlYnVnKGNob2ljZSk7CiAgICAvLyB2YXIgbGFzdEl0ZW0gPSAoY2hvaWNlLmlkKS0xOy8vJHNjb3BlLmNob2ljZXMubGVuZ3RoLTE7CiAgICAvLyAkc2NvcGUuY2hvaWNlcy5zcGxpY2UobGFzdEl0ZW0sMSk7CiAgICBmb3IodmFyIGkgPSAwOyBpIDwgJHNjb3BlLmV4dHJhRmllbGRzLmxlbmd0aDsgaSsrKQogICAgewogICAgICBpZiAoJHNjb3BlLmV4dHJhRmllbGRzW2ldID09IGNob2ljZSkKICAgICAgewogICAgICAgIGlmIChjaG9pY2UuZnJvbWRiPT1mYWxzZSkKICAgICAgICB7CiAgICAgICAgICAvLyBpZiBub3QgZnJvbSBkYiAtIHJlbW92aW5nIGl0IGZyb20gdGhlIGFycmF5IG9mIGV4dHJhLWZpZWxkcwogICAgICAgICAgJHNjb3BlLmV4dHJhRmllbGRzLnNwbGljZShpLCAxKTsKICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgIC8vIGlmIGZpZWxkIG9yaWdpbmF0ZWQgZnJvbSBkYiAtIHRoYW4gd2UgZG9udCByZW1vdmUgaXQgZnJvbSB0aGUgYXJyYXkKICAgICAgICAgIC8vIGFuZCBtYXJrIGl0IGFzIGFjdGl2ZT1mYWxzZSBzbyB0aGF0IGl0IGNhbiBiZSBoYW5kZWxlZCBvbiB0aGUgc2VydmVyCiAgICAgICAgICBjaG9pY2UuaXNfYWN0aXZlPTA7CiAgICAgICAgICBjaG9pY2UubW9kaWZpZWQ9dHJ1ZTsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICB9Owp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ2V2ZW50Q2xvc2VJZ25vcmVNYW5kYXRvcnlGaWVsZHNNb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRyb3V0ZVBhcmFtcywgJHJvb3RTY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRodHRwLCBjdXJyZW50RXZlbnQsIHVpQ2FsZW5kYXJDb25maWcpIHsKICAkc2NvcGUuY3VycmVudEV2ZW50PWN1cnJlbnRFdmVudDsKCiAgJHNjb3BlLm9rQ2FuY2VsID0gZnVuY3Rpb24oKSB7CiAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICB9OwoKICAkc2NvcGUuY2xvc2VFdmVudElnbm9yZU1hbmRhdG9yeUZpZWxkcyA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1ZygiaWdub3JlIG1hbmRhdG9yeSBleHRyYSBmaWVsZHMgYW5kIGNsb3NlIGV2ZW50Iik7CiAgICAkc2NvcGUuY3VycmVudEV2ZW50Lmlnbm9yZUV4dHJhRmllbGRzVmFsaWRhdGlvbj10cnVlOwogICAgY2xvc2VFdmVudCgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLCRzY29wZS5jdXJyZW50RXZlbnQsYWZ0ZXJDbG9zZUV2ZW50LGFmdGVyQ2xvc2VFdmVudCk7CiAgICBmdW5jdGlvbiBhZnRlckNsb3NlRXZlbnQoKQogICAgewogICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2V2ZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgfTsKICB9Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignZXZlbnRUeXBlQ2hhbmdlZFBvcHVwQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRsb2NhdGlvbiwgJHNjb3BlLCAkcm91dGVQYXJhbXMsICRyb290U2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgZXZlbnRUeXBlUHJvcGVydGllcywgdWlDYWxlbmRhckNvbmZpZykgewogICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzPWV2ZW50VHlwZVByb3BlcnRpZXM7CiAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMudXBkYXRlZF9mcm9tX2RhdGU9bmV3IERhdGUoKTsKICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy51cGRhdGVfZXhpc3RpbmdfZXZlbnRzPWZhbHNlOwoKICAkc2NvcGUuY2xvc2VNb2RhbCA9IGZ1bmN0aW9uKCkgewogICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgfTsKCiAgJHNjb3BlLnVwZGF0ZUV2ZW50VHlwZSA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1ZygidXBkYXRlIEV2ZW50IFR5cGUgIiArICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV2ZW50X3R5cGVfaWQpOwogICAgaWYgKCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF9yZWdpc3RyYXRpb25zPT0nJykKICAgIHsKICAgICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMubWF4X3JlZ2lzdHJhdGlvbnM9MDsKICAgIH0KICAgIHVwZGF0ZUV2ZW50VHlwZSgkaHR0cCwkc2NvcGUsJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXZlbnRfdHlwZV9pZCwkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcyx1cGRhdGVFdmVudFR5cGVfc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiB1cGRhdGVFdmVudFR5cGVfc3VjY2VzcygpCiAgICB7CiAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICAgICAgJGxvY2F0aW9uLnBhdGgoJy9ldmVudF90eXBlcycpOwogICAgfQogIH0KCn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignY2xhc3NEZWxldGVBbGxNb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRyb290U2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgY3VycmVudEV2ZW50LCB1aUNhbGVuZGFyQ29uZmlnKQp7CiAgbG9nRGVidWcoImNvbnRyb2xsZXI6IGNsYXNzRGVsZXRlQWxsTW9kYWxDb250cm9sbGVyIik7CiAgJHNjb3BlLmN1cnJlbnRFdmVudD1jdXJyZW50RXZlbnQ7CiAgJHNjb3BlLmNsb3NlTW9kYWwgPSBmdW5jdGlvbigpCiAgewogICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgfTsKCgogICRzY29wZS5kZWxldGVDbGFzc0V2ZW50U2luZ2xlPWZ1bmN0aW9uICgpIC8vIGRlbGV0ZSBvbmx5IG9uZS9jdXJyZW50IGNsYXNzIGV2ZWh0CiAgewogICAgY2FuY2VsQ2xhc3NFdmVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCxjYW5jZWxDbGFzc0V2ZW50X2NhbGxiYWNrLCBjYW5jZWxDbGFzc0V2ZW50X2NhbGxiYWNrKTsKICAgIGZ1bmN0aW9uIGNhbmNlbENsYXNzRXZlbnRfY2FsbGJhY2soKQogICAgewogICAgICBnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkKTsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ3JlbG9hZEV2ZW50Jyx7ZXZlbnRfaWQgOiAkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkfSk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCiAgICB9CiAgfQogICRzY29wZS5kZWxldGVDbGFzc0V2ZW50c0FsbD1mdW5jdGlvbiAoKSAvLyBkZWxldGUgYWxsIHJlcGVhdGluZyBldmVudHMKICB7CiAgICBjYW5jZWxDbGFzc1JlcGVhdGluZ0V2ZW50KCRodHRwLCRzY29wZSwwLCRzY29wZS5jdXJyZW50RXZlbnQucmVwZWF0X2V2ZW50X2lkLGNhbmNlbENsYXNzRXZlbnRfY2FsbGJhY2ssIGNhbmNlbENsYXNzRXZlbnRfY2FsbGJhY2spOwogICAgZnVuY3Rpb24gY2FuY2VsQ2xhc3NFdmVudF9jYWxsYmFjaygpCiAgICB7CiAgICAgIGdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQpOwogICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgncmVsb2FkRXZlbnQnLHtldmVudF9pZCA6ICRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWR9KTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKICAgIH0KICB9CiAgJHNjb3BlLmRlbGV0ZUNsYXNzRXZlbnRzQWxsU3RhcnRpbmdFdmVudElEPWZ1bmN0aW9uICgpIC8vIGRlbGV0ZSBhbGwgcmVwZWF0aW5nIGV2ZW50cyBzdGFydGluZyBldmVudF9pZAogIHsKICAgIGNhbmNlbENsYXNzUmVwZWF0aW5nRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQsJHNjb3BlLmN1cnJlbnRFdmVudC5yZXBlYXRfZXZlbnRfaWQsY2FuY2VsQ2xhc3NFdmVudF9jYWxsYmFjaywgY2FuY2VsQ2xhc3NFdmVudF9jYWxsYmFjayk7CiAgICBmdW5jdGlvbiBjYW5jZWxDbGFzc0V2ZW50X2NhbGxiYWNrKCkKICAgIHsKICAgICAgLy8gZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCk7CiAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdyZWxvYWRFdmVudCcse2V2ZW50X2lkIDogJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZH0pOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgfQogIH0KCn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignYnVzaW5lc3NfbW9kYWxfbGltaXRhdGlvbl9jcmVhdGUnLCBmdW5jdGlvbigkc2NvcGUsICRyb290U2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgc3RhcnQsZW5kLCBmaXhlZFNjaGVkdWxlLCB1aUNhbGVuZGFyQ29uZmlnKSB7CgogICRzY29wZS5maXhlZFNjaGVkdWxlPWZpeGVkU2NoZWR1bGU7CiAgJHNjb3BlLm9yaWdpbmFsX3N0YXJ0PXN0YXJ0OwogICRzY29wZS5vcmlnaW5hbF9lbmQ9ZW5kOwoKICAkc2NvcGUuc3RhcnQ9bmV3IG1vbWVudChzdGFydCkqMTAwMDsKICAkc2NvcGUuZW5kPW5ldyBtb21lbnQoZW5kKSoxMDAwOwogIGNvbnNvbGUubG9nKCdzdGFydD0nK3N0YXJ0KTsKICBjb25zb2xlLmxvZygnZW5kPScrZW5kKTsKCiAgZ2V0QnVzaW5lc3NMb2NhdGlvbnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19sb2NhdGlvbnMnLGdldEJ1c2luZXNzTG9jYXRpb25zX3N1Y2Nlc3MpOwogIGZ1bmN0aW9uIGdldEJ1c2luZXNzTG9jYXRpb25zX3N1Y2Nlc3MoKQogIHsKICAgICRzY29wZS5uZXdFdmVudERldGFpbHMubG9jYXRpb25faWQ9JHNjb3BlLmJ1c2luZXNzX2xvY2F0aW9uc1swXS5sb2NhdGlvbl9pZDsKICB9CgogIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc3RhcnQpOwogIHNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKGVuZCk7CiAgbG9nRGVidWcoInNlbGVjdGVkRGF0ZVN0YXJ0ID0gIitzZWxlY3RlZERhdGVTdGFydCk7CiAgdmFyIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZSgpICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKICB2YXIgc2VsZWN0ZWREYXRlRW5kID0gbmV3IERhdGUoc2VsZWN0ZWREYXRlRW5kLmdldFRpbWUoKSArIHNlbGVjdGVkRGF0ZUVuZC5nZXRUaW1lem9uZU9mZnNldCgpICogNjAwMDApOwoKICAvLyBsb2dEZWJ1ZygiZGF0ZT0iICsgc2VsZWN0ZWREYXRlU3RhcnQpOwogICRzY29wZS5zZWxlY3RlZEV2ZW50ID0gW107CiAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscyA9IFtdOwogICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRIb3VycygpOwogICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcyA9IChzZWxlY3RlZERhdGVTdGFydC5nZXRNaW51dGVzKCkgPCAxMCA/ICcwJyA6ICcnKSArIHNlbGVjdGVkRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRvdyA9IGRheU5hbWVzW3NlbGVjdGVkRGF0ZVN0YXJ0LmdldERheSgpXTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRhdGUgPSBzZWxlY3RlZERhdGVTdGFydDsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoID0gbW9udGhOYW1lc1tzZWxlY3RlZERhdGVTdGFydC5nZXRNb250aCgpXTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoMTEyID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TW9udGgoKSsxOwogICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aCA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldERhdGUoKTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXIgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRGdWxsWWVhcigpOwogICRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZV9pbnB1dF9mb3JtYXQ9IG5ldyBEYXRlKDE5NzAsIDAsIDEsICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMsICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcywgMCk7CgogICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzID0gc2VsZWN0ZWREYXRlRW5kLmdldEhvdXJzKCk7CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcyA9IChzZWxlY3RlZERhdGVFbmQuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBzZWxlY3RlZERhdGVFbmQuZ2V0TWludXRlcygpOwoKCiAgJHNjb3BlLmNhbmNlbCA9IGZ1bmN0aW9uKCkgewogICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgfTsKCiAgZ2V0QWxsSW5zdHJ1Y3RvcnMoJGh0dHAsJHNjb3BlLCdpbnN0cnVjdG9ycycsZ2V0QWxsSW5zdHJ1Y3RvcnNfc3VjY2Vzcyk7CiAgZnVuY3Rpb24gZ2V0QWxsSW5zdHJ1Y3RvcnNfc3VjY2VzcygpCiAgewogICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pbnN0cnVjdG9yX2lkPSRzY29wZS5pbnN0cnVjdG9yc1swXS5idXNpbmVzc191c2VyX2lkOwogIH0KICBnZXROb0NsYXNzRXZlbnRUeXBlc05vQWRtaW4oJGh0dHAsJHNjb3BlLCdyZWxhdGVkRXZlbnRUeXBlcycpOwoKICAkc2NvcGUuY3JlYXRlTmV3TGltaXRhdGlvbiA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1ZygiZnVuY3Rpb246IGNyZWF0ZU5ld0xpbWl0YXRpb24iKTsKICAgIGNhbGVuZGFyID0gJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnOwoKICAgIGlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudFR5cGVzLmxlbmd0aDwxKQogICAgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBpZiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnM8JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykKICAgIHsKICAgICAgYWxlcnQoIteW157XnyDXodeZ15XXnSDXnNek16DXmSDXltee158g15TXqteX15zXlCIpOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBpZiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnM9PSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMpCiAgICB7CiAgICAgIGlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzPD0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpCiAgICAgIHsKICAgICAgICBhbGVydCgi15bXntefINeh15nXldedINec16TXoNeZINeW157XnyDXlNeq15fXnNeUIik7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIGlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzPCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMrMTApKQogICAgICB7CiAgICAgICAgYWxlcnQoIteR15zXldenINen15jXnyDXni0xMCDXk9en15XXqiIpOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfQogICAgaWYgKCFrdXplSXNDYWxlbmRhckRyYWdnYmxlKSB7CiAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigndW5zZWxlY3QnKTsKICAgIH0KICAgIGxvZ0RlYnVnKCJzdGFydD0iICsgc3RhcnQpOwogICAgY2hlY2tEYXRlID0gbmV3IERhdGUoc3RhcnQpOwogICAgbG9nRGVidWcoImNoZWNrIGRhdGUgPSAiICsgY2hlY2tEYXRlKQogICAgbG9nRGVidWcoImVuZD0iICsgZW5kKTsKICAgIGVjb2xvcj0iIzAwYTY1YSI7CgogICAgaWYgKGNoZWNrRGF0ZS5nZXRGdWxsWWVhcigpID09IDE5NzApIHsKICAgICAgICBkYXlfbGltaXRfaWQgPSAtMTsKICAgIH0gZWxzZSB7CiAgICAgICAgZGF5X2xpbWl0X2lkID0gMTsKICAgIH0KCiAgICAvLyB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tdLmZ1bGxDYWxlbmRhcigncmVyZW5kZXJFdmVudHMnKTsKCiAgICB0ZW1wX2xpbWl0X2lkID0gY2FsY190ZW1wX2xpbWl0X2lkKCk7CgogICAgbG9nRGVidWcoJHNjb3BlLnNlbGVjdGVkRXZlbnRUeXBlc1swXSk7CiAgICBsb2dEZWJ1Zygkc2NvcGUuc2VsZWN0ZWRFdmVudFR5cGVzWzBdLmV2ZW50X3R5cGVfaWQpOwoKICAgIHN0YXJ0X3BhcmFtPXN0YXJ0OwogICAgZW5kX3BhcmFtPWVuZDsKICAgIHRpdGxlX3BhcmFtPScnOwogICAgbG9nRGVidWcoImFkZExpbWl0YXRpb25Ub0RhdGFiYXNlIHN0YXJ0PSIgKyBzdGFydF9wYXJhbSArICIsIGVuZD0iICsgIiwgdGl0bGU9IiArIHRpdGxlX3BhcmFtICk7CgogICAgdGhlZGF0YSA9IHsKICAgICAgICBzdGFydF9kYXRlOiAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWUsCiAgICAgICAgZW5kX2RhdGU6ICRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kX3RpbWUsCiAgICAgICAgY29sb3I6IGVjb2xvciwKICAgICAgICB0ZW1wX2xpbWl0X2lkOiB0ZW1wX2xpbWl0X2lkLAogICAgICAgIGVtcF9pZDogJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pbnN0cnVjdG9yX2lkLAogICAgICAgIGxvY2F0aW9uX2lkOiAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmxvY2F0aW9uX2lkLAogICAgICAgIGV2ZW50X3R5cGVfaWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50VHlwZXNbMF0uZXZlbnRfdHlwZV9pZCwKICAgICAgICBldmVudF90eXBlczogJHNjb3BlLnNlbGVjdGVkRXZlbnRUeXBlcywKICAgICAgICB0aXRsZTogdGl0bGVfcGFyYW0KICAgIH07CgogICAgaWYgKCRzY29wZS5maXhlZFNjaGVkdWxlKSAvLyBmaXhlZCBzY2hlZHVsZSB2cyBzcGVjaWZpYyB3ZWVkL2RheSBsaW1pdGF0aW9uCiAgICB7CiAgICAgIGNyZWF0ZUNhbGVuZGFyTGltaXRhdGlvbigkaHR0cCwkc2NvcGUsdGhlZGF0YSxsaW1pdGF0aW9uX3N1Y2Nlc3NfY2FsbGJhY2spOwogICAgfQogICAgZWxzZQogICAgewogICAgICBjcmVhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXkoJGh0dHAsJHNjb3BlLHRoZWRhdGEsbGltaXRhdGlvbl9zdWNjZXNzX2NhbGxiYWNrKTsKICAgIH0KICAgIGZ1bmN0aW9uIGxpbWl0YXRpb25fc3VjY2Vzc19jYWxsYmFjaygpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJzdWNjZXNzIik7CiAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuZGlzbWlzcygpOwogICAgfQoKICB9CgogICRzY29wZS5zdGFydE1pbnV0ZXMgPSBmdW5jdGlvbigpCiAgewogICAgbG9nRGVidWcoInN0YXJ0TWludXRlcyAiKygkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpKTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcz1taW51dGVzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpOwogICAgY2FsY3VsYXRlU3RhcnRUaW1lKCk7CiAgfQogICRzY29wZS5zdGFydEhvdXJzID0gZnVuY3Rpb24oKQogIHsKICAgIGxvZ0RlYnVnKCJzdGFydEhvdXJzICIraG91cnNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMpKTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnM9aG91cnNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMpOwogICAgY2FsY3VsYXRlU3RhcnRUaW1lKCk7CiAgfQogICRzY29wZS5lbmRNaW51dGVzID0gZnVuY3Rpb24oKQogIHsKICAgIGxvZ0RlYnVnKCJlbmRNaW51dGVzICIrKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpKTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXM9bWludXRlc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcyk7CiAgICBjYWxjdWxhdGVFbmRUaW1lKCk7CiAgfQogICRzY29wZS5lbmRIb3VycyA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1ZygiZW5kSG91cnMgIitob3Vyc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMpKTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzPWhvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vycyk7CiAgICBjYWxjdWxhdGVFbmRUaW1lKCk7CiAgfQoKCiAgZnVuY3Rpb24gY2FsY3VsYXRlU3RhcnRUaW1lKCkKICB7CiAgICBldmVudFllYXI9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyOwogICAgZXZlbnRNb250aD0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoMTEyOwogICAgZXZlbnREYXk9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXlvZm1vbnRoOwogICAgaWYgKHBhcnNlSW50KGV2ZW50TW9udGgpPDEwKQogICAgewogICAgICBldmVudE1vbnRoPSIwIitldmVudE1vbnRoOwogICAgfQogICAgaWYgKHBhcnNlSW50KGV2ZW50RGF5KTwxMCkKICAgIHsKICAgICAgZXZlbnREYXk9IjAiK2V2ZW50RGF5OwogICAgfQogICAgbG9nRGVidWcoIiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0eWVhcj0iK2V2ZW50WWVhcik7CiAgICBsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXlvZm1vbnRoPSIrZXZlbnRNb250aCk7CiAgICBsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aD0iK2V2ZW50RGF5KTsKICAgIG5ld19zdGFydD1tb21lbnQudXRjKGV2ZW50WWVhcisiLSIrZXZlbnRNb250aCsiLSIrZXZlbnREYXkrIlQwMDowMDowMCIpLmFkZCgoKHBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMpKjYwKStwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpKSwgJ21pbnV0ZXMnKTsKICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZT1uZXdfc3RhcnQ7CiAgICBsb2dEZWJ1ZygibmV3X3N0YXJ0PSIrbmV3X3N0YXJ0KTsKICB9CiAgZnVuY3Rpb24gY2FsY3VsYXRlRW5kVGltZSgpCiAgewogICAgZXZlbnRZZWFyPSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0eWVhcjsKICAgIGV2ZW50TW9udGg9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aDExMjsKICAgIGV2ZW50RGF5PSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aDsKICAgIGlmIChwYXJzZUludChldmVudE1vbnRoKTwxMCkKICAgIHsKICAgICAgZXZlbnRNb250aD0iMCIrZXZlbnRNb250aDsKICAgIH0KICAgIGlmIChwYXJzZUludChldmVudERheSk8MTApCiAgICB7CiAgICAgIGV2ZW50RGF5PSIwIitldmVudERheTsKICAgIH0KICAgIGxvZ0RlYnVnKCIkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXI9IitldmVudFllYXIpOwogICAgbG9nRGVidWcoIiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aD0iK2V2ZW50TW9udGgpOwogICAgbG9nRGVidWcoIiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bW9udGg9IitldmVudERheSk7CiAgICBuZXdfZW5kPW1vbWVudC51dGMoZXZlbnRZZWFyKyItIitldmVudE1vbnRoKyItIitldmVudERheSsiVDAwOjAwOjAwIikuYWRkKCgocGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMpKjYwKStwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzKSksICdtaW51dGVzJyk7CiAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZF90aW1lPW5ld19lbmQ7CiAgICBsb2dEZWJ1ZygibmV3X2VuZD0iK25ld19lbmQpOwogIH0KCiAgY2FsY3VsYXRlU3RhcnRUaW1lKCk7CiAgY2FsY3VsYXRlRW5kVGltZSgpOwoKICBmdW5jdGlvbiBtaW51dGVzQ2hhbmdlZCh0aGVtaW51dGVzKQogIHsKICAgIGxvZ0RlYnVnKCJ0aGVtaW51dGVzPSIrdGhlbWludXRlcyk7CiAgICBpZiAodHlwZW9mIHRoZW1pbnV0ZXM9PSJ1bmRlZmluZWQiKQogICAgewogICAgICByZXR1cm4gIjAwIjsKICAgIH0KICAgIHRoZW1pbnV0ZXM9cGFyc2VJbnQodGhlbWludXRlcyk7CiAgICBpZiAodGhlbWludXRlcz42MCkKICAgIHsKICAgICAgcmV0dXJuICIwMCI7CiAgICB9CiAgICBlbHNlIGlmICh0aGVtaW51dGVzPDApCiAgICB7CiAgICAgIHJldHVybiAiMDAiOwogICAgfQogICAgZWxzZSBpZiAodGhlbWludXRlcz09IiIpCiAgICB7CiAgICAgIHJldHVybiAiMDAiOwogICAgfQogICAgZWxzZSBpZiAodGhlbWludXRlczwxMCkKICAgIHsKICAgICAgcmV0dXJuICIwIit0aGVtaW51dGVzOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIHJldHVybiB0aGVtaW51dGVzOwogICAgfQogIH0KICBmdW5jdGlvbiBob3Vyc0NoYW5nZWQodGhlaG91cnMpCiAgewogICAgbG9nRGVidWcoInRoZWhvdXJzPSIrdGhlaG91cnMpOwogICAgaWYgKHR5cGVvZiB0aGVob3Vycz09InVuZGVmaW5lZCIpCiAgICB7CiAgICAgIHJldHVybiAiMCI7CiAgICB9CiAgICB0aGVob3Vycz1wYXJzZUludCh0aGVob3Vycyk7CiAgICBpZiAodGhlaG91cnM+MjQpCiAgICB7CiAgICAgIHJldHVybiAwOwogICAgfQogICAgZWxzZSBpZiAodGhlaG91cnM8MCkKICAgIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CiAgICBlbHNlIGlmICh0aGVob3Vycz09IiIpCiAgICB7CiAgICAgIHJldHVybiAiMCI7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgcmV0dXJuIHRoZWhvdXJzOwogICAgfQogIH0KfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2NsYXNzQ2xvc2VNb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRyb290U2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgZXZlbnRfaWQsIHVpQ2FsZW5kYXJDb25maWcpIHsKICBnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnc2VsZWN0ZWRFdmVudCcsZXZlbnRfaWQsYWZ0ZXJHZXRDbGllbnRTcGVjaWZpY0V2ZW50KTsKICBmdW5jdGlvbiBhZnRlckdldENsaWVudFNwZWNpZmljRXZlbnQoKQogIHsKICAgIGZvciAoaSA9IDA7IGkgPCAkc2NvcGUuc2VsZWN0ZWRFdmVudC5ldmVudFVzZXJzLmxlbmd0aDsgaSsrKQogICAgewogICAgICBpZiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRVc2Vyc1tpXS5zdGF0dXNfbmFtZSE9JGdVc2VyX3N0YXR1c19hYnNlbnRlZCkKICAgICAgewogICAgICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50VXNlcnNbaV0ucGFydGljaXBhdGVkPXRydWU7CiAgICAgIH0KICAgICAgaWYgKCRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50VXNlcnNbaV0uaXNfd2FpdGluZ19saXN0PT0xKQogICAgICB7CiAgICAgICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRVc2Vyc1tpXS5wYXJ0aWNpcGF0ZWQ9ZmFsc2U7CiAgICAgIH0KICAgIH0KICAgIGxvZ0RlYnVnKCRzY29wZS5zZWxlY3RlZEV2ZW50KTsKICB9CgogIC8vIGNsaWNrZWQgcm93IC0gY2hlY2svdW5jaGVjayB0aGUgY2hlY2tib3ggb2YgYSB1c2VyCiAgJHNjb3BlLnJvd0NsaWNrZWQgPSBmdW5jdGlvbihvYmopCiAgewogICAgbG9nRGVidWcoJ3JvdyBjbGlja2VkJyk7CiAgICBvYmoucGFydGljaXBhdGVkID0gIW9iai5wYXJ0aWNpcGF0ZWQ7CiAgfTsKCiAgJHNjb3BlLm9rTGltaXRhdGlvbk1vZGFsID0gZnVuY3Rpb24oKSB7CiAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICB9OwoKICAkc2NvcGUuY2xvc2VDbGFzcyA9IGZ1bmN0aW9uKCkKICB7CiAgICBjbG9zZUNsYXNzRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50X2lkLCRzY29wZS5zZWxlY3RlZEV2ZW50LGFmdGVyQ2xvc2VFdmVudCxhZnRlckNsb3NlRXZlbnQpOwogICAgZnVuY3Rpb24gYWZ0ZXJDbG9zZUV2ZW50KCkKICAgIHsKICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdyZWxvYWRFdmVudCcse2V2ZW50X2lkIDogJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRfaWR9KTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKICAgIH07CiAgfQp9KTsKCmt1emVBcHAuY29udHJvbGxlcignYnVzaW5lc3NDbGllbmRDYXJkUGF5bWVudCcsIGZ1bmN0aW9uKCRzY29wZSwgJHJvdXRlUGFyYW1zLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIGN1cnJlbnRDbGllbnQsIGlzcGx1cywgdWlDYWxlbmRhckNvbmZpZywgQnVzaW5lc3NDb25maWcpCnsKICAkc2NvcGUuaXNwbHVzPWlzcGx1czsKICBsb2dEZWJ1ZygnYnVzaW5lc3NDbGllbmRDYXJkUGF5bWVudCBpc3BsdXM9JyAraXNwbHVzKyIgY3VycmVudENsaWVudD0iKyBKU09OLnN0cmluZ2lmeShjdXJyZW50Q2xpZW50LCBudWxsLCAyKSk7CiAgJHNjb3BlLmt1emVJc0xvYWRpbmc9ZmFsc2U7CiAgbG9nRGVidWcoJ2N1cnJlbnRDbGllbnQucGF5bWVudF9iYWxhbmNlPScrY3VycmVudENsaWVudC5wYXltZW50X2JhbGFuY2UrIixjdXJyZW50Q2xpZW50LnVucGFpZF9iYWxhbmNlID0iK2N1cnJlbnRDbGllbnQudW5wYWlkX2JhbGFuY2UpOwogIHRoZWJhbGFuY2UgPSBjdXJyZW50Q2xpZW50LnBheW1lbnRfYmFsYW5jZS1jdXJyZW50Q2xpZW50LnVucGFpZF9iYWxhbmNlOwogIGxvZ0RlYnVnKCd0aGViYWxhbmNlPScrdGhlYmFsYW5jZSk7CiAgaWYgKHRoZWJhbGFuY2U8MCkKICB7CiAgICAkc2NvcGUuYmFsYW5jZVRvUGF5PU1hdGguYWJzKHRoZWJhbGFuY2UpOwogIH0KICBlbHNlCiAgewogICAgJHNjb3BlLmJhbGFuY2VUb1BheT0wOwogIH0KICAkc2NvcGUucGF5bWVudFR5cGVUaXRsZT0i15HXl9eoIjsKICAkc2NvcGUuY3VycmVudENsaWVudD1jdXJyZW50Q2xpZW50OwogIGxvZ0RlYnVnKCRzY29wZS5jdXJyZW50Q2xpZW50KTsKICAkc2NvcGUuYnVzaW5lc3NDb25maWcgPSBCdXNpbmVzc0NvbmZpZy5nZXQoKTsKICAkc2NvcGUuYnVzaW5lc3NDb25maWcudGhlbihmdW5jdGlvbiAoY29uZmlnKSB7CiAgICAkc2NvcGUuaW52b2ljZV9zb3VyY2VfaWQgPSBjb25maWcuaW52b2ljZV9zb3VyY2VfaWQ7CiAgICAkc2NvcGUuaGFzVmF0ID0gY29uZmlnLnZhdF9yYXRlID4gMDsKICB9KTsKCiAgJHNjb3BlLmNsb3NlTW9kYWwgPSBmdW5jdGlvbigpIHsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogIH07CgogICRzY29wZS5leHRlcm5hbF9pbnZvaWNlX2dlbmVyYXRlZD1mYWxzZTsKICAkc2NvcGUuaW52b2ljZV9kYXRlX2Zvcm1hdD1uZXcgRGF0ZSgpOwoKICBnZXROZXh0SW52b2ljZU51bWJlcigkaHR0cCwkc2NvcGUsJHNjb3BlLmN1cnJlbnRDbGllbnQuYnVzaW5lc3NfdXNlcl9pZCwnaW52b2ljZV9udW1iZXInKTsKCiAgJHNjb3BlLnBheW1lbnRNZXRob2RzID0gcGF5bWVudE1ldGhvZHM7CiAgJHNjb3BlLmNyZWRpdENhcmRUeXBlcyA9IGNyZWRpdENhcmRUeXBlczsKICAkc2NvcGUuY3JlZGl0VHJhbnNhY3Rpb25UeXBlcyA9IGNyZWRpdFRyYW5zYWN0aW9uVHlwZXM7CiAgJHNjb3BlLmJhbmtzID0gYmFua3M7CgogIC8vIGluZGljYXRpb24gd2hldGhlciBwYXltZW50IG1ldGhvZCB3YXMgc2VsZWN0ZWQKICAkc2NvcGUuaXNQYXltZW50TWV0aG9kU2VsZWN0ZWQ9ZmFsc2U7CiAgJHNjb3BlLnNlbGVjdFBheW1lbnRNZXRob2QgPSBmdW5jdGlvbihwYXltZW50KSB7CiAgICAkc2NvcGUucGF5bWVudFR5cGVUaXRsZT1wYXltZW50Lm5hbWU7CiAgICAkc2NvcGUuc2VsZWN0ZWRQYXltZW50TWV0aG9kPXBheW1lbnQ7CiAgICAkc2NvcGUuaXNQYXltZW50TWV0aG9kU2VsZWN0ZWQ9dHJ1ZTsKICB9OwoKICAkc2NvcGUudXBkYXRlQmFsYW5jZSA9IGZ1bmN0aW9uIHVwZGF0ZUJhbGFuY2UgKGlzU291cmNlV2l0aFZhdCkgewogICAgJHNjb3BlLmJ1c2luZXNzQ29uZmlnLnRoZW4oZnVuY3Rpb24gKGNvbmZpZykgewogICAgICBpZiAoaXNTb3VyY2VXaXRoVmF0KSB7CiAgICAgICAgJHNjb3BlLmJhbGFuY2VUb1BheU5vVmF0ID0gTnVtYmVyKCgkc2NvcGUuYmFsYW5jZVRvUGF5IC8gKDEgKyBjb25maWcudmF0X3JhdGUpKS50b0ZpeGVkKDIpKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAkc2NvcGUuYmFsYW5jZVRvUGF5ID0gTnVtYmVyKCgkc2NvcGUuYmFsYW5jZVRvUGF5Tm9WYXQgKiAoMSArIGNvbmZpZy52YXRfcmF0ZSkpLnRvRml4ZWQoMikpOwogICAgICB9CiAgICB9KQogIH07CgogICRzY29wZS5tYWtlUGF5bWVudCA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1ZyhjdXJyZW50Q2xpZW50KTsKICAgIGxvZ0RlYnVnKCJwYXltZW50IG1ldGhvZCIpOwogICAgbG9nRGVidWcoJHNjb3BlLnNlbGVjdGVkUGF5bWVudE1ldGhvZCk7CiAgICBsb2dEZWJ1ZygiJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZ2VuZXJhdGVkPTwiKyRzY29wZS5pbnZvaWNlX2dlbmVyYXRlZCsiPiIpOwoKICAgIGlmICgoJHNjb3BlLmJhbGFuY2VUb1BheT09MCkgfHwgKCRzY29wZS5iYWxhbmNlVG9QYXk9PScnKXx8ICgkc2NvcGUuYmFsYW5jZVRvUGF5PT1udWxsKSkKICAgIHsKICAgICAgJHNjb3BlLnVzZXJFcnJvcj0i15DXoNeQINeU15bXnyDXodeb15XXnSDXm9ec16nXlNeVIjsKICAgIH0KICAgIGVsc2UgaWYgKCEkc2NvcGUuaXNQYXltZW50TWV0aG9kU2VsZWN0ZWQpCiAgICB7CiAgICAgICRzY29wZS51c2VyRXJyb3I9IteQ16DXkCDXkdeX16gg15DXntem16LXmSDXqtep15zXldedIjsKICAgICAgLy8gYWxlcnQoJ3NzJyk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgIGlmICgoJHNjb3BlLmludm9pY2VfZ2VuZXJhdGVkIT0xKSB8fCAoJHNjb3BlLmludm9pY2VfZGF0ZV9mb3JtYXQ9PW51bGwpKQogICAgICB7CiAgICAgICAgdmFyIGludm9pY2VfZGF0ZV9mb3JtYXQgPSAibnVsbCI7CiAgICAgIH0KICAgICAgZWxzZQogICAgICB7CiAgICAgICAgdmFyIGludm9pY2VfZGF0ZV9mb3JtYXQgPSAkc2NvcGUuaW52b2ljZV9kYXRlX2Zvcm1hdC5nZXREYXRlKCkgICsgIi0iICsgKCRzY29wZS5pbnZvaWNlX2RhdGVfZm9ybWF0LmdldE1vbnRoKCkrMSkgKyAiLSIgKyAkc2NvcGUuaW52b2ljZV9kYXRlX2Zvcm1hdC5nZXRGdWxsWWVhcigpOwogICAgICB9CiAgICAgIGlmIChpc3BsdXMpCiAgICAgIHsKICAgICAgICB3aGF0VG9QYXk9JHNjb3BlLmJhbGFuY2VUb1BheTsKICAgICAgfQogICAgICBlbHNlIHsKICAgICAgICB3aGF0VG9QYXk9LSRzY29wZS5iYWxhbmNlVG9QYXk7CiAgICAgIH0KICAgICAgdGhlZGF0YT0gewogICAgICAgIGJhbGFuY2VUb1BheTogd2hhdFRvUGF5LAogICAgICAgIGJhbGFuY2VUb1BheU5vVmF0OiAkc2NvcGUuYmFsYW5jZVRvUGF5Tm9WYXQgKiAoaXNwbHVzID8gKzEgOiAtMSksCiAgICAgICAgcGF5bWVudF9tZXRob2RfbmFtZTogJHNjb3BlLnNlbGVjdGVkUGF5bWVudE1ldGhvZC5tZXRob2QsCiAgICAgICAgaW52b2ljZV9udW1iZXI6ICRzY29wZS5pbnZvaWNlX251bWJlciwKICAgICAgICBpbnZvaWNlX2dlbmVyYXRlZDogJHNjb3BlLmludm9pY2VfZ2VuZXJhdGVkLAogICAgICAgIGludm9pY2VfZGF0ZTogaW52b2ljZV9kYXRlX2Zvcm1hdCwKICAgICAgICBiYW5rX2NvbXBhbnlfY29kZTogJHNjb3BlLmJhbmtfY29tcGFueV9jb2RlLAogICAgICAgIGJhbmtfYnJhbmNoX251bWJlcjogJHNjb3BlLmJhbmtfYnJhbmNoX251bWJlciwKICAgICAgICBjaGVja19udW1iZXI6ICRzY29wZS5jaGVja19udW1iZXIsCiAgICAgICAgYWNjb3VudF9udW1iZXI6ICRzY29wZS5hY2NvdW50X251bWJlciwKICAgICAgICBjcmVkaXRfY2FyZF9udW1iZXI6ICRzY29wZS5jcmVkaXRfY2FyZF9udW1iZXIsCiAgICAgICAgY3JlZGl0X2NhcmRfdHlwZTogJHNjb3BlLmNyZWRpdF9jYXJkX3R5cGUsCiAgICAgICAgY3JlZGl0X2NhcmRfdHJhbnNhY3Rpb25fdHlwZTogJHNjb3BlLmNyZWRpdF9jYXJkX3RyYW5zYWN0aW9uX3R5cGUsCiAgICAgICAgaW52b2ljZV9jb21tZW50czogJHNjb3BlLmludm9pY2VfY29tbWVudHMKICAgICAgfTsKICAgICAgJHNjb3BlLmt1emVJc0xvYWRpbmc9dHJ1ZTsKICAgICAgY3JlYXRlUGF5bWVudEZvckNsaWVudCgkaHR0cCwkc2NvcGUsY3VycmVudENsaWVudC5idXNpbmVzc191c2VyX2lkLHRoZWRhdGEsY3JlYXRlUGF5bWVudEZvckNsaWVudF9zdWNjZXNzLCBjcmVhdGVQYXltZW50Rm9yQ2xpZW50X2ZhaWx1cmUpOwogICAgICBmdW5jdGlvbiBjcmVhdGVQYXltZW50Rm9yQ2xpZW50X3N1Y2Nlc3MoKQogICAgICB7CiAgICAgICAgJHNjb3BlLmt1emVJc0xvYWRpbmc9ZmFsc2U7CiAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgICAgIGxvZ0RlYnVnKCJicm9hZGNhc3RpbmcgY2xpZW50UGFnZVJlbG9hZERhdGEiKTsKICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NsaWVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCiAgICAgICAgbG9nRGVidWcoImJyb2FkY2FzdGluZyBldmVudFBhZ2VSZWxvYWREYXRhIik7CiAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdldmVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCiAgICAgICAgLy8gbG9nRGVidWcoImJyb2FkY2FzdGluZyByZWxvYWRFdmVudCIpOwogICAgICAgIC8vICRyb290U2NvcGUuJGJyb2FkY2FzdCgncmVsb2FkRXZlbnQnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKICAgICAgfQogICAgICBmdW5jdGlvbiBjcmVhdGVQYXltZW50Rm9yQ2xpZW50X2ZhaWx1cmUoKQogICAgICB7CiAgICAgICAgJHNjb3BlLmt1emVJc0xvYWRpbmc9ZmFsc2U7CiAgICAgIH0KICAgIH0KIH0KfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdldmVudERldGFpbHNCdXNpbmVzc0NhbGVuZGFyTW9kYWxDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIHNlbGVjdGVkRXZlbnQsIHVpQ2FsZW5kYXJDb25maWcpIHsKICAgIHZhciBkYXlOYW1lcyA9IFsn16jXkNep15XXnycsICfXqdeg15knLCAn16nXnNeZ16nXmScsICfXqNeR15nXoteZJywgJ9eX157Xmdep15knLCAn16nXmdep15knLCAn16nXkdeqJ107CgogICAgJHNjb3BlLmdvdG9DbGllbnRQYWdlPSBmdW5jdGlvbiAoYnVzaW5lc1VzZXJpZCkKICAgIHsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgICBnb3RvQ2xpZW50UGFnZShidXNpbmVzVXNlcmlkKTsKICAgIH0KICAgICRzY29wZS5lZGl0RXZlbnQ9IGZ1bmN0aW9uICh0aGVldmVudCkKICAgIHsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgICBnb3RvRXZlbnRQYWdlKHRoZWV2ZW50KTsKICAgIH0KCiAgICBsb2dEZWJ1Zygic2VsZWN0ZWQgRXZlbnQgaW5mbyA9IiArIEpTT04uc3RyaW5naWZ5KHNlbGVjdGVkRXZlbnQsIG51bGwsIDIpKTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50ID0gc2VsZWN0ZWRFdmVudDsKICAgIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc2VsZWN0ZWRFdmVudC5zdGFydCk7CiAgICB2YXIgc2VsZWN0ZWREYXRlU3RhcnQgPSBuZXcgRGF0ZShzZWxlY3RlZERhdGVTdGFydC5nZXRUaW1lKCkgKyBzZWxlY3RlZERhdGVTdGFydC5nZXRUaW1lem9uZU9mZnNldCgpICogNjAwMDApOwoKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRIb3VycygpOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzID0gKHNlbGVjdGVkRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKSA8IDEwID8gJzAnIDogJycpICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TWludXRlcygpOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkb3cgPSBkYXlOYW1lc1tzZWxlY3RlZERhdGVTdGFydC5nZXREYXkoKV07CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRhdGUgPSBzZWxlY3RlZERhdGVTdGFydDsKCiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydERheSA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldERhdGUoKTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0TW9udGggPSAxICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TW9udGgoKTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0TW9udGhUeHQgPSBtb250aE5hbWVzWyRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0TW9udGggLSAxXTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0WWVhciA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCk7CgogICAgc2VsZWN0ZWREYXRlRW5kID0gbmV3IERhdGUoc2VsZWN0ZWRFdmVudC5lbmQpOwogICAgdmFyIHNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKHNlbGVjdGVkRGF0ZUVuZC5nZXRUaW1lKCkgKyBzZWxlY3RlZERhdGVFbmQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKCiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycyA9IHNlbGVjdGVkRGF0ZUVuZC5nZXRIb3VycygpOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kZG93ID0gZGF5TmFtZXNbc2VsZWN0ZWREYXRlRW5kLmdldERheSgpXTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKSA8IDEwID8gJzAnIDogJycpICsgc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKTsKICAgICRzY29wZS5va0xpbWl0YXRpb25Nb2RhbCA9IGZ1bmN0aW9uKCkgewogICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICAgIH07CgogICAgJHNjb3BlLmRlbGV0ZUxpbWl0YXRpb25Nb2RhbCA9IGZ1bmN0aW9uKCkgewogICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoJ2RlbGV0ZScpOwogICAgICAgIGNhbGVuZGFyID0gJ2NhbGVuZGFyX2J1c2luZXNzJzsKCiAgICAgICAgJHNjb3BlLmRlbGV0ZUNhbGVuZGFyREJFdmVudChzZWxlY3RlZEV2ZW50LCBjYWxlbmRhcik7CiAgICB9OwogICAgJHNjb3BlLmRlbGV0ZUNhbGVuZGFySlNFdmVudCA9IGZ1bmN0aW9uKGNhbGVuZGFyLCBzZWxlY3RlZEV2ZW50aWQpIHsKCiAgICAgICAgbG9nRGVidWcoImNhbGVuZGFyX2hvdXJzX29mX3dvcmtfY29uZmlnPSIgKyB1aUNhbGVuZGFyQ29uZmlnKTsKICAgICAgICBsb2dEZWJ1ZygidWlDYWxlbmRhckNvbmZpZ1tjYWxlbmRhcl09IiArIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWydjYWxlbmRhcl9idXNpbmVzcyddKTsKICAgICAgICBsb2dEZWJ1ZygiZGVsZXRlIGpzIGV2ZW50ICIgKyBzZWxlY3RlZEV2ZW50aWQpOwogICAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlbW92ZUV2ZW50cycsIFtzZWxlY3RlZEV2ZW50aWRdKTsgLy8gZ28gdG8gZGF0ZSBpbiBjYWxlbmRhciBnb3RvCiAgICB9OwogICAgJHNjb3BlLmRlbGV0ZUNhbGVuZGFyREJFdmVudCA9IGZ1bmN0aW9uKHNlbGVjdGVkRXZlbnQsIGNhbGVuZGFyKSB7CiAgICAgICAgbG9nRGVidWcoImRlbGV0ZSBldmVudCAiICsgc2VsZWN0ZWRFdmVudC5pZCk7CiAgICAgICAgJGh0dHAoewogICAgICAgICAgICBtZXRob2Q6ICdQT1NUJywKICAgICAgICAgICAgdXJsOiAnL2FwaS9hZG1pbi9ldmVudHMvZGVsZXRlLycgKyBzZWxlY3RlZEV2ZW50LmlkLAogICAgICAgICAgICBkYXRhOiB7CiAgICAgICAgICAgICAgICB0ZW1wX2xpbWl0X2lkOiBzZWxlY3RlZEV2ZW50LnRlbXBfbGltaXRfaWQKICAgICAgICAgICAgfSwKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uO2NoYXJzZXQ9dXRmLTgnCiAgICAgICAgICAgIH0KICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHsKCiAgICAgICAgICAgIGxvZ0RlYnVnKGRhdGEpOwogICAgICAgICAgICBpZiAoIWRhdGEuc3VjY2VzcykgewogICAgICAgICAgICAgICAgbG9nRGVidWcoImRlbGV0ZSBsaW1pdF9pZCBlcnJvciArIiArIGRhdGEubWVzc2FnZSk7CiAgICAgICAgICAgICAgICAvLyBpZiBub3Qgc3VjY2Vzc2Z1bCwgYmluZCBlcnJvcnMgdG8gZXJyb3IgdmFyaWFibGVzCiAgICAgICAgICAgICAgICAvLwkJCSAgJHNjb3BlLmVycm9yTmFtZSA9IGRhdGEuZXJyb3JzLm5hbWU7CiAgICAgICAgICAgICAgICAvLwkJCSAgJHNjb3BlLmVycm9yU3VwZXJoZXJvID0gZGF0YS5lcnJvcnMuc3VwZXJoZXJvQWxpYXM7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBsb2dEZWJ1ZygiZGVsZXRlIGxpbWl0X2lkIHN1Y2Nlc3MiKTsKICAgICAgICAgICAgICAgIC8vIGlmIHN1Y2Nlc3NmdWwsIGJpbmQgc3VjY2VzcyBtZXNzYWdlIHRvIG1lc3NhZ2UKICAgICAgICAgICAgICAgIC8vCQkJICAkc2NvcGUubWVzc2FnZSA9IGRhdGEubWVzc2FnZTsKICAgICAgICAgICAgICAgICRzY29wZS5kZWxldGVDYWxlbmRhckpTRXZlbnQoY2FsZW5kYXIsIHNlbGVjdGVkRXZlbnQuaWQpOwoKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBsb2dEZWJ1ZygiYWZ0ZXIgcmVtb3ZlIGV2ZW50Iik7CiAgICB9Owp9KTsKCmt1emVBcHAuY29udHJvbGxlcignZXZlbnRSZWN1cnJpbmdEZXRhaWxzQnVzaW5lc3NDYWxlbmRhck1vZGFsQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRodHRwLCBzZWxlY3RlZEV2ZW50LCB1aUNhbGVuZGFyQ29uZmlnKSB7CiAgICB2YXIgZGF5TmFtZXMgPSBbJ9eo15DXqdeV158nLCAn16nXoNeZJywgJ9ep15zXmdep15knLCAn16jXkdeZ16LXmScsICfXl9ee15nXqdeZJywgJ9ep15nXqdeZJywgJ9ep15HXqiddOwoKICAgICRzY29wZS5nb3RvQ2xpZW50UGFnZT0gZnVuY3Rpb24gKGJ1c2luZXNzVXNlcmlkKQogICAgewogICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgICAgIGdvdG9DbGllbnRQYWdlKGJ1c2luZXNzVXNlcmlkKTsKICAgIH0KICAgICRzY29wZS5lZGl0RXZlbnQ9IGZ1bmN0aW9uICh0aGVldmVudCkKICAgIHsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgICBnb3RvRXZlbnRQYWdlKHRoZWV2ZW50KTsKICAgIH0KCgogICAgbG9nRGVidWcoInNlbGVjdGVkIFJlY3VycmluZyBFdmVudCBpbmZvID0iICsgSlNPTi5zdHJpbmdpZnkoc2VsZWN0ZWRFdmVudCwgbnVsbCwgMikpOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQgPSBzZWxlY3RlZEV2ZW50OwogICAgc2VsZWN0ZWREYXRlU3RhcnQgPSBuZXcgRGF0ZShzZWxlY3RlZEV2ZW50LnN0YXJ0KTsKICAgIHZhciBzZWxlY3RlZERhdGVTdGFydCA9IG5ldyBEYXRlKHNlbGVjdGVkRGF0ZVN0YXJ0LmdldFRpbWUoKSArIHNlbGVjdGVkRGF0ZVN0YXJ0LmdldFRpbWV6b25lT2Zmc2V0KCkgKiA2MDAwMCk7CgogICAgLy8gbG9nRGVidWcoInNlbGVjdGVkRXZlbnQuc3RhcnQ9IiArIHNlbGVjdGVkRXZlbnQuc3RhcnQpOwogICAgLy8gbG9nRGVidWcoImRhdGU9IiArIHNlbGVjdGVkRGF0ZVN0YXJ0KTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRIb3VycygpOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzID0gKHNlbGVjdGVkRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKSA8IDEwID8gJzAnIDogJycpICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TWludXRlcygpOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkb3cgPSBkYXlOYW1lc1tzZWxlY3RlZERhdGVTdGFydC5nZXREYXkoKV07CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRhdGUgPSBzZWxlY3RlZERhdGVTdGFydDsKCiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydERheSA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldERhdGUoKTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0TW9udGggPSAxICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TW9udGgoKTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0TW9udGhUeHQgPSBtb250aE5hbWVzWyRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0TW9udGggLSAxXTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0WWVhciA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCk7CgogICAgc2VsZWN0ZWREYXRlRW5kID0gbmV3IERhdGUoc2VsZWN0ZWRFdmVudC5lbmQpOwogICAgdmFyIHNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKHNlbGVjdGVkRGF0ZUVuZC5nZXRUaW1lKCkgKyBzZWxlY3RlZERhdGVFbmQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKCiAgICAvLyBsb2dEZWJ1Zygic2VsZWN0ZWRFdmVudC5lbmQ9IiArIHNlbGVjdGVkRXZlbnQuZW5kKTsKICAgIC8vIGxvZ0RlYnVnKCJkYXRlPSIgKyBzZWxlY3RlZERhdGVFbmQpOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMgPSBzZWxlY3RlZERhdGVFbmQuZ2V0SG91cnMoKTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGRvdyA9IGRheU5hbWVzW3NlbGVjdGVkRGF0ZUVuZC5nZXREYXkoKV07CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzID0gKHNlbGVjdGVkRGF0ZUVuZC5nZXRNaW51dGVzKCkgPCAxMCA/ICcwJyA6ICcnKSArIHNlbGVjdGVkRGF0ZUVuZC5nZXRNaW51dGVzKCk7CiAgICAkc2NvcGUub2tMaW1pdGF0aW9uTW9kYWwgPSBmdW5jdGlvbigpIHsKICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgICB9OwoKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2V2ZW50RGV0YWlsc0hvdXJzT2ZXb3JrTW9kYWxDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIHNlbGVjdGVkRXZlbnQsIGZpeGVkU2NoZWR1bGUsIHVpQ2FsZW5kYXJDb25maWcpIHsKICAgIHZhciBkYXlOYW1lcyA9IFsn16jXkNep15XXnycsICfXqdeg15knLCAn16nXnNeZ16nXmScsICfXqNeR15nXoteZJywgJ9eX157Xmdep15knLCAn16nXmdep15knLCAn16nXkdeqJ107CgogICAgLy8gbG9nRGVidWcoInNlbGVjdGVkIEV2ZW50ID0iICsgSlNPTi5zdHJpbmdpZnkoc2VsZWN0ZWRFdmVudCwgbnVsbCwgNCkpOwogICAgJHNjb3BlLmZpeGVkU2NoZWR1bGU9Zml4ZWRTY2hlZHVsZTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50ID0gc2VsZWN0ZWRFdmVudDsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50Lm9yaWdfZXZlbnRfdHlwZXMgPSBhbmd1bGFyLmNvcHkoc2VsZWN0ZWRFdmVudC5ldmVudF90eXBlcyk7CiAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzID0gW107CgogICAgZ2V0QnVzaW5lc3NMb2NhdGlvbnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19sb2NhdGlvbnMnKTsKCiAgICBsb2dEZWJ1ZygiaG91cnMgb2Ygd29yayBibG9jay9ldmVudCBjbGlja2VkICIrSlNPTi5zdHJpbmdpZnkoJHNjb3BlLnNlbGVjdGVkRXZlbnQpKTsKCiAgICBzZWxlY3RlZERhdGVTdGFydCA9IG5ldyBEYXRlKHNlbGVjdGVkRXZlbnQuc3RhcnQpOwogICAgdmFyIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZSgpICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKICAgIGdldEFsbEluc3RydWN0b3JzKCRodHRwLCRzY29wZSwnaW5zdHJ1Y3RvcnMnKTsKICAgIGdldE5vQ2xhc3NFdmVudFR5cGVzTm9BZG1pbigkaHR0cCwkc2NvcGUsJ3JlbGF0ZWRFdmVudFR5cGVzJyxnZXROb0NsYXNzRXZlbnRUeXBlc05vQWRtaW5fc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBnZXROb0NsYXNzRXZlbnRUeXBlc05vQWRtaW5fc3VjY2VzcygpCiAgICB7CiAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCAkc2NvcGUuc2VsZWN0ZWRFdmVudC5ldmVudF90eXBlcy5sZW5ndGg7IGkrKykKICAgICAgewogICAgICAgIC8vIGNvcHlpbmcgdGhlIGFjdHVhbCBvYmplY3Qgb2YgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRfdHlwZXNbaV0KICAgICAgICBmb3IodmFyIGogPSAwOyBqIDwgJHNjb3BlLnJlbGF0ZWRFdmVudFR5cGVzLmxlbmd0aDsgaisrKQogICAgICAgIHsKICAgICAgICAgIGlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5ldmVudF90eXBlc1tpXS5ldmVudF90eXBlX2lkPT0kc2NvcGUucmVsYXRlZEV2ZW50VHlwZXNbal0uZXZlbnRfdHlwZV9pZCkKICAgICAgICAgIHsKICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRfdHlwZXNbaV09YW5ndWxhci5jb3B5KCRzY29wZS5yZWxhdGVkRXZlbnRUeXBlc1tqXSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgLy8gbG9nRGVidWcoInNlbGVjdGVkRXZlbnQuc3RhcnQ9IiArIHNlbGVjdGVkRXZlbnQuc3RhcnQpOwogICAgLy8gbG9nRGVidWcoImRhdGU9IiArIHNlbGVjdGVkRGF0ZVN0YXJ0KTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRIb3VycygpOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzID0gKHNlbGVjdGVkRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKSA8IDEwID8gJzAnIDogJycpICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TWludXRlcygpOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkb3cgPSBkYXlOYW1lc1tzZWxlY3RlZERhdGVTdGFydC5nZXREYXkoKV07CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRhdGUgPSBzZWxlY3RlZERhdGVTdGFydDsKCiAgICBzZWxlY3RlZERhdGVFbmQgPSBuZXcgRGF0ZShzZWxlY3RlZEV2ZW50LmVuZCk7CiAgICB2YXIgc2VsZWN0ZWREYXRlRW5kID0gbmV3IERhdGUoc2VsZWN0ZWREYXRlRW5kLmdldFRpbWUoKSArIHNlbGVjdGVkRGF0ZUVuZC5nZXRUaW1lem9uZU9mZnNldCgpICogNjAwMDApOwoKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bW9udGggPSBtb250aE5hbWVzW3NlbGVjdGVkRGF0ZVN0YXJ0LmdldE1vbnRoKCldOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aDExMiA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldE1vbnRoKCkrMTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aCA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldERhdGUoKTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0eWVhciA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCk7CiAgICAvLyAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWVfaW5wdXRfZm9ybWF0PSBuZXcgRGF0ZSgxOTcwLCAwLCAxLCAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzLCAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMsIDApOwoKICAgIC8vIGxvZ0RlYnVnKCJzZWxlY3RlZEV2ZW50LmVuZD0iICsgc2VsZWN0ZWRFdmVudC5lbmQpOwogICAgLy8gbG9nRGVidWcoImRhdGU9IiArIHNlbGVjdGVkRGF0ZUVuZCk7CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycyA9IHNlbGVjdGVkRGF0ZUVuZC5nZXRIb3VycygpOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kZG93ID0gZGF5TmFtZXNbc2VsZWN0ZWREYXRlRW5kLmdldERheSgpXTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKSA8IDEwID8gJzAnIDogJycpICsgc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKTsKCgogICAgJHNjb3BlLm9rTGltaXRhdGlvbk1vZGFsID0gZnVuY3Rpb24oKSB7CiAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgfTsKCiAgICAkc2NvcGUudXBkYXRlTGltaXRhdGlvbk1vZGFsID0gZnVuY3Rpb24oKQogICAgewogICAgICBsb2dEZWJ1ZygiZnVuY3Rpb246IHVwZGF0ZUxpbWl0YXRpb25Nb2RhbCIpOwogICAgICBpZiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRfdHlwZXMubGVuZ3RoPDEpCiAgICAgIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgaWYgKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzPCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMpCiAgICAgIHsKICAgICAgICBhbGVydCgi15bXntefINeh15nXldedINec16TXoNeZINeW157XnyDXlNeq15fXnNeUIik7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIGlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vycz09JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykKICAgICAgewogICAgICAgIGlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzPD0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpCiAgICAgICAgewogICAgICAgICAgYWxlcnQoIteW157XnyDXodeZ15XXnSDXnNek16DXmSDXltee158g15TXqteX15zXlCIpOwogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlczwoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKzEwKSkKICAgICAgICB7CiAgICAgICAgICBhbGVydCgi15HXnNeV16cg16fXmNefINeeLTEwINeT16fXldeqIik7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICB9CgoKICAgICAgZnVuY3Rpb24gdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uX3N1Y2Nlc3MoKQogICAgICB7CiAgICAgICAgY2FsZW5kYXIgPSAnY2FsZW5kYXJfaG91cnNfb2Zfd29yayc7CiAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOyAvLyBnbyB0byBkYXRlIGluIGNhbGVuZGFyIGdvdG8KICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5kaXNtaXNzKCdkZWxldGUnKTsKICAgICAgfQoKICAgICAgaWYgKCRzY29wZS5maXhlZFNjaGVkdWxlKQogICAgICB7CiAgICAgICAgLy8gZml4ZWQgc2NoZWR1bGUgLSB1cGFkdGluZyBsaW1pdGF0aW9uIDE5NzAKICAgICAgICB0aGVkYXRhID0gewogICAgICAgICAgICBzdGFydF9kYXRlOiBuZXdfc3RhcnQsCiAgICAgICAgICAgIGVuZF9kYXRlOiBuZXdfZW5kLAogICAgICAgICAgICB0ZW1wX2xpbWl0X2lkOiBudWxsLAogICAgICAgICAgICBsaW1pdF9pZDogJHNjb3BlLnNlbGVjdGVkRXZlbnQubGltaXRfaWQsCiAgICAgICAgICAgIGV2ZW50X3R5cGVzOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5ldmVudF90eXBlcywKICAgICAgICAgICAgbG9jYXRpb25faWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmxvY2F0aW9uX2lkLAogICAgICAgICAgICBvcmlnX2V2ZW50X3R5cGVzOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5vcmlnX2V2ZW50X3R5cGVzLAogICAgICAgICAgICBlbXBfaWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmVtcF9pZAogICAgICAgIH07CiAgICAgICAgdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uKCRodHRwLCRzY29wZSx0aGVkYXRhLCRzY29wZS5zZWxlY3RlZEV2ZW50LmxpbWl0X2lkLCB1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25fc3VjY2Vzcyk7CiAgICAgIH0KICAgICAgZWxzZQogICAgICAvLyBub3QgZml4ZWQgc2NoZWR1bGUgLSBwZXJkYXkgYmxvY2sKICAgICAgewogICAgICAgIC8vLy8vLy8vLy8vCiAgICAgICAgaWYgKCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5saW1pdF9pZCAhPSBudWxsKSAmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5kYXlfbGltaXRfaWQgPT0gLTEpKSAvLyBldmVudCBsaW1pdGF0aW9uIGhhcyBsaW1pdF9pZCBzbyBpdHMgYW4gMTk3MCBldmVudAogICAgICAgIC8vIG5lZWQgdG8gYWRkIGEgbmV3IHBlcmRheSBsaW1pdGF0aW9uIHRoYXQgcG9pbnQgKGxpbWl0X2lkKSB0byB0aGUgb2xkIDE5NzAgZXZlbnQgdG8gcmVwbGFjdGUgaXQKICAgICAgICB7CiAgICAgICAgICAgIHRlbXBfbGltaXRfaWQgPSBjYWxjX3RlbXBfbGltaXRfaWQoKTsKICAgICAgICAgICAgLy8gdGhlZXZlbnQudGVtcF9saW1pdF9pZCA9IHRlbXBfbGltaXRfaWQ7CiAgICAgICAgICAgIC8vIHRoZWV2ZW50LmRheV9saW1pdF9pZCA9IHRlbXBfbGltaXRfaWQ7CiAgICAgICAgICAgIC8vIHRoZSBtb3ZlZCBldmVudCBpbiB0aGUgY2FsZW5kYXIgbm93IGhhcyBkYXlfbGltaXRfaWQgYW5kIHRlbXBfbGltaXRfaWQKICAgICAgICAgICAgLy8gaWYgaXRzIGxvYWRlZCBmcm9tIHRoZSBkYiwgaXQgd2lsbCBvbmx5IGhhdmUgZGF5X2xpbWl0X2lkIChhbmQgbm90IHRoZSB0ZW1wIG9uZSkKICAgICAgICAgICAgLy8gdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnXS5mdWxsQ2FsZW5kYXIoJ3VwZGF0ZUV2ZW50JywgdGhlZXZlbnQpOwogICAgICAgICAgICAvLyBjb25zb2xlLmxvZygiWFhYWFhYWFhYWFhYWCIpOwogICAgICAgICAgICB0aGVkYXRhID0gewogICAgICAgICAgICAgICAgc3RhcnRfZGF0ZTogbmV3X3N0YXJ0LAogICAgICAgICAgICAgICAgZW5kX2RhdGU6IG5ld19lbmQsCiAgICAgICAgICAgICAgICBjb2xvcjogJycsCiAgICAgICAgICAgICAgICB0ZW1wX2xpbWl0X2lkOiAwLAogICAgICAgICAgICAgICAgZXZlbnRfdHlwZV9pZDogJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRfdHlwZV9pZCwKICAgICAgICAgICAgICAgIGV2ZW50X3R5cGVzOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5ldmVudF90eXBlcywKICAgICAgICAgICAgICAgIGxpbWl0X2lkOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5pZCwKICAgICAgICAgICAgICAgIGxvY2F0aW9uX2lkOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5sb2NhdGlvbl9pZCwKICAgICAgICAgICAgICAgIGVtcF9pZDogJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW1wX2lkCiAgICAgICAgICAgICAgICAvLyB0aXRsZTogdGhlZXZlbnQudGl0bGUKICAgICAgICAgICAgfTsKICAgICAgICAgICAgY3JlYXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5KCRodHRwLCRzY29wZSx0aGVkYXRhLHVwZGF0ZUNhbGVuZGFyTGltaXRhdGlvbl9zdWNjZXNzKTsKCiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICB0aGVkYXRhPSB7CiAgICAgICAgICAgICAgc3RhcnRfZGF0ZTogbmV3X3N0YXJ0LAogICAgICAgICAgICAgIGVuZF9kYXRlOiBuZXdfZW5kLAogICAgICAgICAgICAgIHRlbXBfZGF5X2xpbWl0X2lkOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC50ZW1wX2xpbWl0X2lkLAogICAgICAgICAgICAgIG9yaWdfZXZlbnRfdHlwZXM6ICRzY29wZS5zZWxlY3RlZEV2ZW50Lm9yaWdfZXZlbnRfdHlwZXMsCiAgICAgICAgICAgICAgZXZlbnRfdHlwZXM6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50X3R5cGVzLAogICAgICAgICAgICAgIGxvY2F0aW9uX2lkOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5sb2NhdGlvbl9pZCwKICAgICAgICAgICAgICBkYXlfbGltaXRfaWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmRheV9saW1pdF9pZCwKICAgICAgICAgICAgICBlbXBfaWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmVtcF9pZAogICAgICAgICAgfTsKICAgICAgICAgIHVwZGF0ZUNhbGVuZGFyTGltaXRhdGlvblBlckRheSgkaHR0cCwkc2NvcGUsdGhlZGF0YSx1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25fc3VjY2Vzcyk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAkc2NvcGUuZGVsZXRlTGltaXRhdGlvbk1vZGFsID0gZnVuY3Rpb24oKSB7CiAgICAgICAgY2FsZW5kYXIgPSAnY2FsZW5kYXJfaG91cnNfb2Zfd29yayc7CgogICAgICAgIC8vIHJlbW92aW5nIGxpbWl0YXRpb24gZnJvbSBkYXRhYmFzZSwgaWYgdHJ1ZSAtIHJlbW92aW5nIGZyb20gZGlzcGxheSBhbHNvCiAgICAgICAgaWYgKCRzY29wZS5kZWxldGVDYWxlbmRhckRCTGltaXRhdGlvbkV2ZW50KHNlbGVjdGVkRXZlbnQpKQogICAgICAgIHsKICAgICAgICAgIC8vICRzY29wZS5kZWxldGVDYWxlbmRhckpTRXZlbnQoY2FsZW5kYXIsIHNlbGVjdGVkRXZlbnQuaWQpOwogICAgICAgIH0KICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5kaXNtaXNzKCdkZWxldGUnKTsKICAgIH07CiAgICAkc2NvcGUuZGVsZXRlQ2FsZW5kYXJKU0V2ZW50ID0gZnVuY3Rpb24oY2FsZW5kYXIsIHNlbGVjdGVkRXZlbnRpZCkgewoKICAgICAgICBsb2dEZWJ1ZygiY2FsZW5kYXJfaG91cnNfb2Zfd29ya19jb25maWc9IiArIHVpQ2FsZW5kYXJDb25maWcpOwogICAgICAgIGxvZ0RlYnVnKCJ1aUNhbGVuZGFyQ29uZmlnW2NhbGVuZGFyXT0iICsgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnXSk7CiAgICAgICAgbG9nRGVidWcoImRlbGV0ZSBqcyBldmVudCAiICsgc2VsZWN0ZWRFdmVudGlkKTsKICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZW1vdmVFdmVudHMnLCBbc2VsZWN0ZWRFdmVudGlkXSk7IC8vIGdvIHRvIGRhdGUgaW4gY2FsZW5kYXIgZ290bwogICAgfTsKICAgICRzY29wZS5kZWxldGVDYWxlbmRhckRCTGltaXRhdGlvbkV2ZW50ID0gZnVuY3Rpb24oc2VsZWN0ZWRFdmVudCkgewogICAgICAgIGNhbGVuZGFyID0gJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnOwogICAgICAgIC8vIHJldHVybiBmYWxzZTsKCiAgICAgICAgLy8gZGVsZXRpbmcgZXZlbnQgbGltaXRhdGlvbiAobm90IHBlciBkYXkpCiAgICAgICAgLy8gZWl0aGVyIGZyb20gMTk3MCAoaG91cnNfb2Zfd29yayBwYWdlKQogICAgICAgIC8vIG9yIGZyb20gdGhlaXIgaW5zdGFuY2UgaW4gdGhlIGN1cnJlbnQgd2VlaydzIGxpbWl0YXRpb24uCiAgICAgICAgLy8gZWl0aGVyIHdheSBkYXlfbGltaXRfaWQgaXMgLTEgZm9yIGxpbWl0YXRpb25zIGZyb20gMTk3MAogICAgICAgIGlmIChzZWxlY3RlZEV2ZW50LmRheV9saW1pdF9pZCA9PSAtMSkKICAgICAgICB7CiAgICAgICAgICAgIGxvZ0RlYnVnKCJyZW1vdmluZyBldmVudCBsaW1pdGF0aW9uLCBjaGVja2lnbiBpZiBpdHMgaW4gMTk3MCAodGhlIG9yaWdpbmFsKSBvciBhbiBpbnN0YW5jZSBpbiBwcmVzZW50Iik7CiAgICAgICAgICAgIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc2VsZWN0ZWRFdmVudC5zdGFydCk7CiAgICAgICAgICAgIC8vIGlmIGl0cyAxOTcwIHRoaXMgbWVhbnMgd2UncmUgaW4gdGhlIGhvdXJzX29mX3dvcmsgZ2VuZXJhbCBwYWdlCiAgICAgICAgICAgIC8vIHNvIHdlIHNpbXBseSBkZWxldGUgaXQKICAgICAgICAgICAgaWYgKHNlbGVjdGVkRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCkgPT0gMTk3MCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbG9nRGVidWcoInJlbW92aW5nIGV2ZW50IGxpbWl0YXRpb24gZnJvbSAxOTcwIik7CiAgICAgICAgICAgICAgICB0aGVkYXRhPSB7CiAgICAgICAgICAgICAgICAgICAgdGVtcF9saW1pdF9pZDogc2VsZWN0ZWRFdmVudC50ZW1wX2xpbWl0X2lkCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgZGVsZXRlQ2FsZW5kYXJMaW1pdGF0aW9uKCRodHRwLCRzY29wZSx0aGVkYXRhLHNlbGVjdGVkRXZlbnQubGltaXRfaWQsIGRlbGV0ZUNhbGVuZGFyTGltaXRhdGlvbl9zdWNjZXNzKTsKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGRlbGV0ZUNhbGVuZGFyTGltaXRhdGlvbl9zdWNjZXNzKCkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgJHNjb3BlLmRlbGV0ZUNhbGVuZGFySlNFdmVudChjYWxlbmRhciwgc2VsZWN0ZWRFdmVudC5pZCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAvLyByZW1vdmluZyBldmVudCBsaW1pdGF0aW9uIGZyb20gdGhlIGEgc3BlY2lmaWMgd2VlawogICAgICAgICAgICAgICAgLy8gdGhpcyBtZWFucyBhZGRpbmcgZXZlbnQgbGltaXRhdGlvbiBwZXIgZGF5IHdpdGggcmFuZ2UgZW5kPXN0YXJ0CiAgICAgICAgICAgICAgICAvLyBtYXliZSBCVUcgQlVHR1k/CiAgICAgICAgICAgICAgICBsb2dEZWJ1ZygieCByZW1vdmluZyBldmVudCBsaW1pdGF0aW9uIGZyb20gYSBzcGVjaWZpYyB3ZWVrLCB0aGlzIG1lYW5zIGFkZGluZyBldmVudCBsaW1pdGF0aW9uIHBlciBkYXkgd2l0aCByYW5nZSAwLTAiKTsKICAgICAgICAgICAgICAgIC8vIGxvZ0RlYnVnKEpTT04uc3RyaW5naWZ5KHNlbGVjdGVkRXZlbnQpKTsKCiAgICAgICAgICAgICAgICB0aGVkYXRhID0gewogICAgICAgICAgICAgICAgICAgIHN0YXJ0X2RhdGU6IHNlbGVjdGVkRXZlbnQuc3RhcnQsCiAgICAgICAgICAgICAgICAgICAgZW5kX2RhdGU6IHNlbGVjdGVkRXZlbnQuc3RhcnQsCiAgICAgICAgICAgICAgICAgICAgY29sb3I6ICIjMDAwMDAwIiwKICAgICAgICAgICAgICAgICAgICB0ZW1wX2xpbWl0X2lkOiAxLAogICAgICAgICAgICAgICAgICAgIGV2ZW50X3R5cGVfaWQ6IHNlbGVjdGVkRXZlbnQuZXZlbnRfdHlwZV9pZCwKICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbl9pZDogc2VsZWN0ZWRFdmVudC5sb2NhdGlvbl9pZCwKICAgICAgICAgICAgICAgICAgICBsaW1pdF9pZDogc2VsZWN0ZWRFdmVudC5saW1pdF9pZCwKICAgICAgICAgICAgICAgICAgICB0aXRsZTogc2VsZWN0ZWRFdmVudC50aXRsZQogICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICBjcmVhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXkoJGh0dHAsJHNjb3BlLHRoZWRhdGEsY3JlYXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5X3N1Y2Nlc3MpOwogICAgICAgICAgICAgICAgZnVuY3Rpb24gY3JlYXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5X3N1Y2Nlc3MoKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAkc2NvcGUuZGVsZXRlQ2FsZW5kYXJKU0V2ZW50KGNhbGVuZGFyLCBzZWxlY3RlZEV2ZW50LmlkKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlCiAgICAgICAgewogICAgICAgICAgICAvLyBkZWxldGluZyBhIHBlcmRheSBsaW1pdGF0aW9uLgogICAgICAgICAgICAvLyBpZiBpdCdzIGEgcGVyZGF5IHRoYXQgInJlcGxhY2VkIiBhIDE5NzAgb25lCiAgICAgICAgICAgIC8vIHRoZW4gd2UgY2Fubm90IGRlbGV0ZSBpdCAob3RoZXJ3aXNlIHRoZSBvcmlnaW5hbCAxOTcwIHdpbGwgcmVhcHBlYXIpCiAgICAgICAgICAgIC8vIHNvIHdlIHNldCBpdCB0byBzdGFydD1lbmQKICAgICAgICAgICAgLy8gdGhpcyBtYXliZSBhIEJVRyBhbmQgY2F1c2UgVFJPVUJMRSAvLyBUT0RPCiAgICAgICAgICAgIC8vIG90aGV3aXNlIHdlIGNhbiBkZWxldGUgaXQgLSB0aGUgcGVyZGF5IC0gYXMgaXRzIGEgbmV3IHBlcmRheSBhbmQgbm90ICJyZXBsYWNpbmciIGEgMTk3MCBvbmUKCiAgICAgICAgICAgIGlmIChzZWxlY3RlZEV2ZW50LmxpbWl0X2lkICE9IG51bGwpIC8vIHRoaXMgaXMgdGhlIHBlcmRheSB0aGF0IHJlcGxhY2VzIGEgMTk3MCBvbmUgLSB3ZSBzZXQgaXQgdG8gc3RhcnQ9ZW5kCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBsb2dEZWJ1ZygicmVtb3ZpbmcgZXZlbnQgbGltaXRhdGlvbiBwZXIgZGF5IHJlbGF0ZWQgdG8gMTk3MCAodXBkYXRpbmcgaXQgdG8gc3RhcnQ9ZW5kKSIpOwoKICAgICAgICAgICAgICB0aGVkYXRhPSB7CiAgICAgICAgICAgICAgICAgIHN0YXJ0X2RhdGU6IHNlbGVjdGVkRXZlbnQuc3RhcnQsCiAgICAgICAgICAgICAgICAgIGVuZF9kYXRlOiBzZWxlY3RlZEV2ZW50LnN0YXJ0LAogICAgICAgICAgICAgICAgICB0ZW1wX2RheV9saW1pdF9pZDogc2VsZWN0ZWRFdmVudC50ZW1wX2xpbWl0X2lkLAogICAgICAgICAgICAgICAgICBkYXlfbGltaXRfaWQ6IHNlbGVjdGVkRXZlbnQuZGF5X2xpbWl0X2lkCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICB1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXkoJGh0dHAsJHNjb3BlLHRoZWRhdGEsdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5X3N1Y2Nlcyk7CgogICAgICAgICAgICAgIGZ1bmN0aW9uIHVwZGF0ZUNhbGVuZGFyTGltaXRhdGlvblBlckRheV9zdWNjZXMoKQogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICRzY29wZS5kZWxldGVDYWxlbmRhckpTRXZlbnQoY2FsZW5kYXIsIHNlbGVjdGVkRXZlbnQuaWQpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlICAvLyB0aGlzIGlzIHRoZSBjYXNlIHdoZXJlIHRoZSBwZXJkYXkgZG9lc250IHJlcGxhY2UgYSAxOTcwIG9uZSwgd2UgY2FuIHNpbXBseSBkZWxldGUgaXQKICAgICAgICAgICAgewogICAgICAgICAgICAgIGxvZ0RlYnVnKCJyZW1vdmluZyBldmVudCBsaW1pdGF0aW9uIHBlciBkYXkgcmVsYXRlZCBub3QgcmVsYXRlZCB0byAxOTcwIChzbyB3ZSdyZSBkZWxldGluZyBpdCkiKTsKICAgICAgICAgICAgICB0aGVkYXRhID0gewogICAgICAgICAgICAgICAgICB0ZW1wX2xpbWl0X2lkOiBzZWxlY3RlZEV2ZW50LnRlbXBfbGltaXRfaWQKICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIGRlbGV0ZUNhbGVuZGFyTGltaXRhdGlvblBlckRheSgkaHR0cCwkc2NvcGUsdGhlZGF0YSxzZWxlY3RlZEV2ZW50LmRheV9saW1pdF9pZCwgZGVsZXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5X3N1Y2Nlc3MpOwogICAgICAgICAgICAgIGZ1bmN0aW9uIGRlbGV0ZUNhbGVuZGFyTGltaXRhdGlvblBlckRheV9zdWNjZXNzKCkKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAkc2NvcGUuZGVsZXRlQ2FsZW5kYXJKU0V2ZW50KGNhbGVuZGFyLCBzZWxlY3RlZEV2ZW50LmlkKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgbG9nRGVidWcoImFmdGVyIHJlbW92ZSBldmVudCIpOwoKICAgIH07CgoKICAgICRzY29wZS5zdGFydE1pbnV0ZXMgPSBmdW5jdGlvbigpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJzdGFydE1pbnV0ZXMgIisoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKSk7CiAgICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcz1taW51dGVzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpOwogICAgICBjYWxjdWxhdGVTdGFydFRpbWUoKTsKICAgIH0KICAgICRzY29wZS5zdGFydEhvdXJzID0gZnVuY3Rpb24oKQogICAgewogICAgICBsb2dEZWJ1Zygic3RhcnRIb3VycyAiK2hvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKSk7CiAgICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnM9aG91cnNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMpOwogICAgICBjYWxjdWxhdGVTdGFydFRpbWUoKTsKICAgIH0KICAgICRzY29wZS5lbmRNaW51dGVzID0gZnVuY3Rpb24oKQogICAgewogICAgICBsb2dEZWJ1ZygiZW5kTWludXRlcyAiKygkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzKSk7CiAgICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXM9bWludXRlc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcyk7CiAgICAgIGNhbGN1bGF0ZUVuZFRpbWUoKTsKICAgIH0KICAgICRzY29wZS5lbmRIb3VycyA9IGZ1bmN0aW9uKCkKICAgIHsKICAgICAgbG9nRGVidWcoImVuZEhvdXJzICIraG91cnNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzKSk7CiAgICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzPWhvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vycyk7CiAgICAgIGNhbGN1bGF0ZUVuZFRpbWUoKTsKICAgIH0KCgogICAgZnVuY3Rpb24gY2FsY3VsYXRlU3RhcnRUaW1lKCkKICAgIHsKICAgICAgZXZlbnRZZWFyPSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0eWVhcjsKICAgICAgZXZlbnRNb250aD0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoMTEyOwogICAgICBldmVudERheT0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRheW9mbW9udGg7CiAgICAgIGlmIChwYXJzZUludChldmVudE1vbnRoKTwxMCkKICAgICAgewogICAgICAgIGV2ZW50TW9udGg9IjAiK2V2ZW50TW9udGg7CiAgICAgIH0KICAgICAgaWYgKHBhcnNlSW50KGV2ZW50RGF5KTwxMCkKICAgICAgewogICAgICAgIGV2ZW50RGF5PSIwIitldmVudERheTsKICAgICAgfQoKICAgICAgbmV3X3N0YXJ0PW1vbWVudC51dGMoZXZlbnRZZWFyKyItIitldmVudE1vbnRoKyItIitldmVudERheSsiVDAwOjAwOjAwIikuYWRkKCgocGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykqNjApK3BhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcykpLCAnbWludXRlcycpOwogICAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWU9bmV3X3N0YXJ0OwogICAgICBsb2dEZWJ1ZygibmV3X3N0YXJ0PSIrbmV3X3N0YXJ0KTsKICAgIH0KICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZUVuZFRpbWUoKQogICAgewogICAgICBldmVudFllYXI9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyOwogICAgICBldmVudE1vbnRoPSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bW9udGgxMTI7CiAgICAgIGV2ZW50RGF5PSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aDsKICAgICAgaWYgKHBhcnNlSW50KGV2ZW50TW9udGgpPDEwKQogICAgICB7CiAgICAgICAgZXZlbnRNb250aD0iMCIrZXZlbnRNb250aDsKICAgICAgfQogICAgICBpZiAocGFyc2VJbnQoZXZlbnREYXkpPDEwKQogICAgICB7CiAgICAgICAgZXZlbnREYXk9IjAiK2V2ZW50RGF5OwogICAgICB9CgogICAgICBuZXdfZW5kPW1vbWVudC51dGMoZXZlbnRZZWFyKyItIitldmVudE1vbnRoKyItIitldmVudERheSsiVDAwOjAwOjAwIikuYWRkKCgocGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMpKjYwKStwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzKSksICdtaW51dGVzJyk7CiAgICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kX3RpbWU9bmV3X2VuZDsKICAgICAgbG9nRGVidWcoIm5ld19lbmQ9IituZXdfZW5kKTsKICAgIH0KCiAgICBjYWxjdWxhdGVTdGFydFRpbWUoKTsKICAgIGNhbGN1bGF0ZUVuZFRpbWUoKTsKCiAgICBmdW5jdGlvbiBtaW51dGVzQ2hhbmdlZCh0aGVtaW51dGVzKQogICAgewogICAgICBsb2dEZWJ1ZygidGhlbWludXRlcz0iK3RoZW1pbnV0ZXMpOwogICAgICBpZiAodHlwZW9mIHRoZW1pbnV0ZXM9PSJ1bmRlZmluZWQiKQogICAgICB7CiAgICAgICAgcmV0dXJuICIwMCI7CiAgICAgIH0KICAgICAgdGhlbWludXRlcz1wYXJzZUludCh0aGVtaW51dGVzKTsKICAgICAgaWYgKHRoZW1pbnV0ZXM+NjApCiAgICAgIHsKICAgICAgICByZXR1cm4gIjAwIjsKICAgICAgfQogICAgICBlbHNlIGlmICh0aGVtaW51dGVzPDApCiAgICAgIHsKICAgICAgICByZXR1cm4gIjAwIjsKICAgICAgfQogICAgICBlbHNlIGlmICh0aGVtaW51dGVzPT0iIikKICAgICAgewogICAgICAgIHJldHVybiAiMDAiOwogICAgICB9CiAgICAgIGVsc2UgaWYgKHRoZW1pbnV0ZXM8MTApCiAgICAgIHsKICAgICAgICByZXR1cm4gIjAiK3RoZW1pbnV0ZXM7CiAgICAgIH0KICAgICAgZWxzZQogICAgICB7CiAgICAgICAgICByZXR1cm4gdGhlbWludXRlczsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gaG91cnNDaGFuZ2VkKHRoZWhvdXJzKQogICAgewogICAgICBsb2dEZWJ1ZygidGhlaG91cnM9Iit0aGVob3Vycyk7CiAgICAgIGlmICh0eXBlb2YgdGhlaG91cnM9PSJ1bmRlZmluZWQiKQogICAgICB7CiAgICAgICAgcmV0dXJuICIwIjsKICAgICAgfQogICAgICB0aGVob3Vycz1wYXJzZUludCh0aGVob3Vycyk7CiAgICAgIGlmICh0aGVob3Vycz4yNCkKICAgICAgewogICAgICAgIHJldHVybiAwOwogICAgICB9CiAgICAgIGVsc2UgaWYgKHRoZWhvdXJzPDApCiAgICAgIHsKICAgICAgICByZXR1cm4gMDsKICAgICAgfQogICAgICBlbHNlIGlmICh0aGVob3Vycz09IiIpCiAgICAgIHsKICAgICAgICByZXR1cm4gIjAiOwogICAgICB9CiAgICAgIGVsc2UKICAgICAgewogICAgICAgICAgcmV0dXJuIHRoZWhvdXJzOwogICAgICB9CiAgICB9Cgp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ0V2ZW50VHlwZXNDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGNvbXBpbGUsIHVpQ2FsZW5kYXJDb25maWcsICR1aWJNb2RhbCwkbG9jYXRpb24pIHsKICAgIGxvZ0RlYnVnKCdFdmVudFR5cGVzIENvbnRyb2xsZXInKTsKCiAgICBnZXRBbGxCdXNpbmVzc0V2ZW50VHlwZXMoJGh0dHAsJHNjb3BlLCdldmVudF90eXBlcycpOwogICAgJHNjb3BlLnNob3dFdmVudFR5cGUgPSBmdW5jdGlvbiAodGhlRXZlbnQpCiAgICB7CiAgICAgICRsb2NhdGlvbi5wYXRoKCcvZXZlbnRfdHlwZXMvJyt0aGVFdmVudC5ldmVudF90eXBlX2lkKTsKICAgIH0KfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ0V2ZW50VHlwZU5ld0NvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkY29tcGlsZSwgdWlDYWxlbmRhckNvbmZpZywgJHVpYk1vZGFsLCAkbG9jYXRpb24pIHsKICAgIGxvZ0RlYnVnKCdFdmVudFR5cGVzIENvbnRyb2xsZXIgTmV3Jyk7CgogICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMgPSB7fTsgLy8gdGhlc2UgYXJlIHRoZSBjb21wbGV0ZSBkZXRhaWxzIGZvciB0aGUgbmV3IGV2ZW50IC8vCiAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5pc19jbGFzcyA9IDA7CiAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5ibG9ja0V4dHJhVGltZSA9IGZhbHNlOwogICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZHVyYXRpb25fYmVmb3JlX2V2ZW50ID0gMDsKICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmR1cmF0aW9uX2FmdGVyX2V2ZW50ID0gMDsKICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmluaGVyaXRfbWFpbl9ob3VycyA9IDE7CiAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5tYXhfd2FpdGluZ19saXN0ID0gMzsKICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmlzX3VwZGF0ZSA9IGZhbHNlOwogICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMubWF4X3BhcnRpY2lwYW50cyA9IDE7CiAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5tYXhfcmVnaXN0cmF0aW9ucz0xOwogICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuaXNfcHVibGljPTE7CiAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5pbnN0cnVjdG9yX2lkPTA7CgogICAgJHNjb3BlLmV2ZW50Q29sb3JTdHlsZSA9IHt9OwogICAgZGVmYXVsdENvbG9yID0gJzAwYTY1YSc7CiAgICAkc2NvcGUuZXZlbnRDb2xvclN0eWxlW2RlZmF1bHRDb2xvcl0gPSB7CiAgICAgICAgJ3RyYW5zZm9ybSc6ICdyb3RhdGUoMzBkZWcpJwogICAgfTsKICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV2ZW50Q29sb3IgPSAiIyIgKyBkZWZhdWx0Q29sb3I7CiAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyA9IFsKICAgICAgeyJmaWVsZF9uYW1lIjoi16HXmdeb15XXnSDXntek15LXqSIsImZpZWxkX2RhdGF0eXBlIjoiVEVYVF9BUkVBIiwiaXNfbWFuZGF0b3J5IjowLCAiZnJvbWRiIjogZmFsc2UsICJkYl9pZF90b2ZpeCI6IDAsICJpc19hY3RpdmUiOiAxLCAibW9kaWZpZWQiOiBmYWxzZX0sCiAgICAgIHsiZmllbGRfbmFtZSI6Itep15nXoteV16jXmSDXkdeZ16oiLCJmaWVsZF9kYXRhdHlwZSI6IlRFWFRfQVJFQSIsImlzX21hbmRhdG9yeSI6MCwgImZyb21kYiI6IGZhbHNlLCAiZGJfaWRfdG9maXgiOiAwLCAiaXNfYWN0aXZlIjogMSwgIm1vZGlmaWVkIjogZmFsc2V9CiAgICBdOwoKICAgIGdldEFsbEluc3RydWN0b3JzKCRodHRwLCRzY29wZSwnaW5zdHJ1Y3RvcnMnLGdldEFsbEluc3RydWN0b3JzX3N1Y2Nlc3MpOwogICAgZnVuY3Rpb24gZ2V0QWxsSW5zdHJ1Y3RvcnNfc3VjY2VzcygpCiAgICB7CiAgICAgIC8vICRzY29wZS5pbnN0cnVjdG9ycy51bnNoaWZ0KHtidXNpbmVzc191c2VyX2lkOjAsIGJ1c2VyX2ZpcnN0X25hbWU6IiIsIGJ1c2VyX2xhc3RfbmFtZToiIn0pOwogICAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5pbnN0cnVjdG9yX2lkPSRzY29wZS5pbnN0cnVjdG9yc1swXS5idXNpbmVzc191c2VyX2lkOwogICAgfQoKICAgICRzY29wZS5ldmVudFR5cGVFeHRyYUZpZWxkc1BvcCA9IGZ1bmN0aW9uKGV2ZW50VHlwZVByb3BlcnRpZXMpIHsKICAgICAgICBsb2dEZWJ1ZygiZXZlbnQgY3JlYXRlIG1vZGFsIik7CgogICAgICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewogICAgICAgICAgICBhbmltYXRpb246IGZhbHNlLAogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9ldmVudF90eXBlX2V4dHJhX2ZpZWxkcy5waHAnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnZXZlbnRUeXBlRXh0cmFGaWVsZHNNb2RhbENvbnRyb2xsZXInLAogICAgICAgICAgICBzaXplOiAnbCcsCiAgICAgICAgICAgIHJlc29sdmU6IHsKICAgICAgICAgICAgICAgIGV2ZW50VHlwZVByb3BlcnRpZXM6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBldmVudFR5cGVQcm9wZXJ0aWVzOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIG1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24oc2VsZWN0ZWRJdGVtKSB7CiAgICAgICAgICAgIGxvZ0RlYnVnKHNlbGVjdGVkSXRlbSk7CiAgICAgICAgICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMgPSBzZWxlY3RlZEl0ZW07CiAgICAgICAgfSwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGxvZ0RlYnVnKCdNb2RhbCBkaXNtaXNzZWQgYXQ6ICcgKyBuZXcgRGF0ZSgpKTsKICAgICAgICB9KTsKICAgIH07CgogICAgJHNjb3BlLmNoYW5nZUV2ZW50Q29sb3IgPSBmdW5jdGlvbihuZXdDb2xvcikgewogICAgICAgIGxvZ0RlYnVnKCJjaG9vc2luZyBjb2xvciAiICsgbmV3Q29sb3IpOwogICAgICAgICRzY29wZS5ldmVudENvbG9yID0gbmV3Q29sb3I7CiAgICAgICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXZlbnRDb2xvciA9ICIjIiArIG5ld0NvbG9yOwogICAgICAgICRzY29wZS5ldmVudENvbG9yU3R5bGUgPSB7CiAgICAgICAgICAgICdiYWNrZ3JvdW5kLWNvbG9yJzogIiMiICsgbmV3Q29sb3IKICAgICAgICB9OwogICAgICAgICRzY29wZS5ldmVudENvbG9yU3R5bGVbbmV3Q29sb3JdID0gewogICAgICAgICAgICAndHJhbnNmb3JtJzogJ3JvdGF0ZSgzMGRlZyknCiAgICAgICAgfTsKCiAgICB9CgogICAgJHNjb3BlLmFkZEV2ZW50VHlwZUNhbmNlbCA9IGZ1bmN0aW9uKCkgewogICAgICAgICRsb2NhdGlvbi5wYXRoKCcvZXZlbnRfdHlwZXMnKTsKICAgIH07CgogICAgJHNjb3BlLmFkZEV2ZW50VHlwZSA9IGZ1bmN0aW9uKCkgewogICAgICAgIGxvZ0RlYnVnKCJhZGQgRXZlbnQgVHlwZSIgKyAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcyArICJleHRyYSBmaWVsZHM9IiArJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMpOwogICAgICAgIGlmICgoJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMubWF4X3JlZ2lzdHJhdGlvbnM9PScnKSB8fCAoISRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF9yZWdpc3RyYXRpb25zKSkKICAgICAgICB7CiAgICAgICAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5tYXhfcmVnaXN0cmF0aW9ucz0wOwogICAgICAgIH0KICAgICAgICBhZGRFdmVudFR5cGUoJGh0dHAsJHNjb3BlLCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLGFkZEV2ZW50VHlwZV9zdWNjZXNzKTsKICAgICAgICBmdW5jdGlvbiBhZGRFdmVudFR5cGVfc3VjY2VzcygpCiAgICAgICAgewogICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9ldmVudF90eXBlcycpOwogICAgICAgIH0KICAgIH07Cn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdFdmVudFR5cGVVcGRhdGVDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGNvbXBpbGUsICRyb3V0ZVBhcmFtcywgdWlDYWxlbmRhckNvbmZpZywgJHVpYk1vZGFsLCAkbG9jYXRpb24pIHsKICAgIGV2ZW50X3R5cGVfaWQ9JHJvdXRlUGFyYW1zLmV2ZW50X3R5cGVfaWQ7CiAgICBsb2dEZWJ1ZygnRXZlbnRUeXBlcyBDb250cm9sbGVyIFVwZGF0ZSAnK2V2ZW50X3R5cGVfaWQpOwoKICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzID0ge307IC8vIHRoZXNlIGFyZSB0aGUgY29tcGxldGUgZGV0YWlscyBmb3IgdGhlIG5ldyBldmVudCAvLwogICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuaXNfdXBkYXRlID0gdHJ1ZTsKCiAgICAkc2NvcGUuZXZlbnRDb2xvclN0eWxlID0ge307CiAgICBnZXRBbGxJbnN0cnVjdG9ycygkaHR0cCwkc2NvcGUsJ2luc3RydWN0b3JzJyxnZXRBbGxJbnN0cnVjdG9yc19zdWNjZXNzKTsKICAgIGZ1bmN0aW9uIGdldEFsbEluc3RydWN0b3JzX3N1Y2Nlc3MoKQogICAgewogICAgICAkc2NvcGUuaW5zdHJ1Y3RvcnMudW5zaGlmdCh7YnVzaW5lc3NfdXNlcl9pZDpudWxsLCBidXNlcl9maXJzdF9uYW1lOiIiLCBidXNlcl9sYXN0X25hbWU6IiJ9KTsKICAgIH0KCiAgICBnZXRCdXNpbmVzc0V2ZW50VHlwZSgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmV2ZW50X3R5cGVfaWQsJ2V2ZW50VHlwZVByb3BlcnRpZXMnLGdldEJ1c2luZXNzRXZlbnRUeXBlX3N1Y2Nlc3MpOwoKICAgIGZ1bmN0aW9uIGdldEJ1c2luZXNzRXZlbnRUeXBlX3N1Y2Nlc3MoKQogICAgewogICAgICAgIGlmICgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5tYXhfcmVnaXN0cmF0aW9ucz09bnVsbCkKICAgICAgICB7CiAgICAgICAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5tYXhfcmVnaXN0cmF0aW9ucz0xOwogICAgICAgIH0KICAgICAgICBpZiAoKCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmR1cmF0aW9uX2JlZm9yZV9ldmVudD4wKSB8ICgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5kdXJhdGlvbl9hZnRlcl9ldmVudD4wKSkKICAgICAgICB7CiAgICAgICAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5ibG9ja0V4dHJhVGltZSA9IDE7CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5ibG9ja0V4dHJhVGltZSA9IDA7CiAgICAgICAgfQogICAgICAgIC8vICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmluaGVyaXRfbWFpbl9ob3VycyA9IHJlc3BvbnNlLmRhdGFbMF0uaW5oZXJpdF9tYWluX2hvdXJzOwogICAgICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmlzX3VwZGF0ZSA9IHRydWU7CiAgICAgICAgbG9nRGVidWcoIiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmNvbG9yPSIrJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuY29sb3IpOwogICAgICAgICRzY29wZS5ldmVudENvbG9yU3R5bGVbJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuY29sb3JdID0gewogICAgICAgICAgICAndHJhbnNmb3JtJzogJ3JvdGF0ZSgzMGRlZyknCiAgICAgICAgfTsKICAgICAgICAkc2NvcGUuY2hhbmdlRXZlbnRDb2xvcigoJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuY29sb3IpLnN1YnN0cigxKSk7CiAgICAgICAgbG9nRGVidWcoIiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmluc3RydWN0b3JfaWQ9Iiskc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5pbnN0cnVjdG9yX2lkKTsKICAgICAgICAvLyBzYXZpbmcgZXZlbnQgdHlwZSBkZXRhaWxzIGFzaWRlIHRvIGxhdGVyIGNoZWNrIGlmIGFueXRoaW5nIGNoYW5nZWQKICAgICAgICBsb2dEZWJ1ZygiZHVwbGljYXRpbmcgb2JqZWN0IG9mIGV2ZW50IHR5cGUgdG8gbGF0ZXIgY29tcGFyZSAiK3R5cGVvZiAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcyk7CiAgICAgICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXNEdXBsaWNhdGUgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzKSk7CiAgICAgICAgbG9nRGVidWcoIiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzRHVwbGljYXRlID0iKyRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzRHVwbGljYXRlLmV2ZW50X3R5cGVfbmFtZSk7CiAgICB9OwoKICAgIC8vIGV2ZW50IHR5cGUgY2hhbmdlZCBwb3B1cAogICAgJHNjb3BlLmV2ZW50VHlwZUNoYW5nZWRQb3B1cCA9IGZ1bmN0aW9uKGV2ZW50VHlwZVByb3BlcnRpZXMpIHsKICAgICAgICBsb2dEZWJ1ZygiZXZlbnQgY3JlYXRlIG1vZGFsIik7CgogICAgICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewogICAgICAgICAgICBhbmltYXRpb246IGZhbHNlLAogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9ldmVudF90eXBlX2NoYW5nZWQucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ2V2ZW50VHlwZUNoYW5nZWRQb3B1cENvbnRyb2xsZXInLAogICAgICAgICAgICBzaXplOiAnbCcsCiAgICAgICAgICAgIHJlc29sdmU6IHsKICAgICAgICAgICAgICAgIGV2ZW50VHlwZVByb3BlcnRpZXM6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllczsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBtb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHNlbGVjdGVkSXRlbSkKICAgICAgICB7CiAgICAgICAgICAgIGxvZ0RlYnVnKHNlbGVjdGVkSXRlbSk7CiAgICAgICAgICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMgPSBzZWxlY3RlZEl0ZW07CiAgICAgICAgfSwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGxvZ0RlYnVnKCdNb2RhbCBkaXNtaXNzZWQgYXQ6ICcgKyBuZXcgRGF0ZSgpKTsKICAgICAgICB9KTsKICAgIH07CgogICAgLy8gZXZlbnQgdHlwZSBleHRyYSBmaWVsZCBwb3B1cAogICAgJHNjb3BlLmV2ZW50VHlwZUV4dHJhRmllbGRzUG9wID0gZnVuY3Rpb24oZXZlbnRUeXBlUHJvcGVydGllcykgewogICAgICAgIGxvZ0RlYnVnKCJldmVudCBjcmVhdGUgbW9kYWwiKTsKCiAgICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgICAgICAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2V2ZW50X3R5cGVfZXh0cmFfZmllbGRzLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdldmVudFR5cGVFeHRyYUZpZWxkc01vZGFsQ29udHJvbGxlcicsCiAgICAgICAgICAgIHNpemU6ICdsJywKICAgICAgICAgICAgcmVzb2x2ZTogewogICAgICAgICAgICAgICAgZXZlbnRUeXBlUHJvcGVydGllczogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGV2ZW50VHlwZVByb3BlcnRpZXM7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgbW9kYWxJbnN0YW5jZS5yZXN1bHQudGhlbihmdW5jdGlvbihzZWxlY3RlZEl0ZW0pIHsKICAgICAgICAgICAgbG9nRGVidWcoc2VsZWN0ZWRJdGVtKTsKICAgICAgICAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyA9IHNlbGVjdGVkSXRlbTsKICAgICAgICB9LCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgbG9nRGVidWcoJ01vZGFsIGRpc21pc3NlZCBhdDogJyArIG5ldyBEYXRlKCkpOwogICAgICAgIH0pOwogICAgfTsKCgogICAgJHNjb3BlLmNoYW5nZUV2ZW50Q29sb3IgPSBmdW5jdGlvbihuZXdDb2xvcikgewogICAgICAgIGxvZ0RlYnVnKCJjaG9vc2luZyBjb2xvciAiICsgbmV3Q29sb3IpOwogICAgICAgICRzY29wZS5ldmVudENvbG9yID0gbmV3Q29sb3I7CiAgICAgICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXZlbnRDb2xvciA9ICIjIiArIG5ld0NvbG9yOwogICAgICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmNvbG9yID0gIiMiICsgbmV3Q29sb3I7CiAgICAgICAgJHNjb3BlLmV2ZW50Q29sb3JTdHlsZSA9IHsKICAgICAgICAgICAgJ2JhY2tncm91bmQtY29sb3InOiAiIyIgKyBuZXdDb2xvcgogICAgICAgIH07CiAgICAgICAgJHNjb3BlLmV2ZW50Q29sb3JTdHlsZVtuZXdDb2xvcl0gPSB7CiAgICAgICAgICAgICd0cmFuc2Zvcm0nOiAncm90YXRlKDMwZGVnKScKICAgICAgICB9OwoKICAgIH0KCiAgICAkc2NvcGUuYWRkRXZlbnRUeXBlQ2FuY2VsID0gZnVuY3Rpb24oKSB7CiAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9ldmVudF90eXBlcycpOwogICAgfTsKCiAgICAkc2NvcGUuYWRkRXZlbnRUeXBlID0gZnVuY3Rpb24oKSB7IC8vIHRoaXMgZnVuY3Rpb24gVVBEQVRFUyBldmVudCB0eXBlIChub3QgYWRkcykKICAgICAgLy8gY2hlY2tpbmcgaWYgYW55dGhpbmcgY2hhbmdlZCByZWFsbHkKICAgICAgLy8gYW5kIGFza2luZyBpZiB3ZSBzaG91bGQgdXBkYXRlIGFsbCBldmVudHMgZnJvbSBub3cgKG9yIG9ubHkgbmV3bHkgY3JlYXRlZCBldmVudHMpCiAgICAgIC8vIGNoZWNraW5nCiAgICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzRHVwbGljYXRlLmV4dHJhRmllbGRzPSRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzOwogICAgICBpZiAoYW5ndWxhci5lcXVhbHMoJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXNEdXBsaWNhdGUsJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMpKQogICAgICB7CiAgICAgICAgLy8gJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXNEdXBsaWNhdGUuZXh0cmFGaWVsZHMgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzKSk7CgogICAgICAgIGxvZ0RlYnVnKCJub3RoaW5nIGNoYW5nZWQgaW4gZXZlbnQgdHlwZSwgb3Igb25seSBleHRyYSBmaWVsZHMiKTsKICAgICAgICAkc2NvcGUudXBkYXRlRXZlbnRUeXBlKCk7CiAgICAgIH0KICAgICAgZWxzZQogICAgICB7CiAgICAgICAgbG9nRGVidWcoImV2ZW50IHR5cGUgY2hhbmdlZCIpOwogICAgICAgICRzY29wZS5ldmVudFR5cGVDaGFuZ2VkUG9wdXAoKTsKICAgICAgfQogICAgICAvLyAkc2NvcGUudXBkYXRlRXZlbnRUeXBlKCk7CiAgICB9CiAgICAkc2NvcGUudXBkYXRlRXZlbnRUeXBlID0gZnVuY3Rpb24oKQogICAgewogICAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy51cGRhdGVfZXhpc3RpbmdfZXZlbnRzPWZhbHNlOwoKICAgICAgbG9nRGVidWcoInVwZGF0ZSBFdmVudCBUeXBlICIgKyAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5ldmVudF90eXBlX2lkKTsKICAgICAgaWYgKCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF9yZWdpc3RyYXRpb25zPT0nJykKICAgICAgewogICAgICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF9yZWdpc3RyYXRpb25zPTA7CiAgICAgIH0KICAgICAgdXBkYXRlRXZlbnRUeXBlKCRodHRwLCRzY29wZSwkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5ldmVudF90eXBlX2lkLCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLHVwZGF0ZUV2ZW50VHlwZV9zdWNjZXNzKTsKICAgICAgZnVuY3Rpb24gdXBkYXRlRXZlbnRUeXBlX3N1Y2Nlc3MoKQogICAgICB7CiAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9ldmVudF90eXBlcycpOwogICAgICB9CiAgICB9Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignZXZlbnRDcmVhdGVNb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkcm9vdFNjb3BlLCBzaGFyZWRQcm9wZXJ0aWVzLCBldmVudF90eXBlX2lkLCBsb2NhdGlvbl9pZCwgZW1wX2lkLCAkaHR0cCwgc3RhcnREYXRlLCByZXNjaGVkdWxlX2V2ZW50LCB1aUNhbGVuZGFyQ29uZmlnKSB7CiAgICBzdGFydERhdGU9bmV3IG1vbWVudChzdGFydERhdGUpOwogICAgbG9nRGVidWcoImV2ZW50Q3JlYXRlTW9kYWxDb250cm9sbGVyLCBzdGFydERhdGU9IitzdGFydERhdGUrIiB0eXBlICIrdHlwZW9mIHN0YXJ0RGF0ZSk7CiAgICBsb2dEZWJ1ZygiZXZlbnRDcmVhdGVNb2RhbENvbnRyb2xsZXIsIHJlc2NoZWR1bGVfZXZlbnQ9IityZXNjaGVkdWxlX2V2ZW50KTsKCiAgICAkc2NvcGUuZXZlbnRUeXBlVGl0bGUgPSAi15HXl9eoINeh15XXkiDXntek15LXqSI7CiAgICAkc2NvcGUuc2hvd0V2ZW50VHlwZVNlbGVjdGVkID0gZmFsc2U7CiAgICAkc2NvcGUuc2hvd0V2ZW50Q2xpZW50U2VsZWN0ZWQgPSBmYWxzZTsKICAgICRzY29wZS5uZXdFdmVudERldGFpbHMgPSB7fTsgLy8gdGhlc2UgYXJlIHRoZSBjb21wbGV0ZSBkZXRhaWxzIGZvciB0aGUgbmV3IGV2ZW50IC8vCiAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnJlcGVhdFR5cGUgPSAiZm9yZXZlciI7CiAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnJlcGVhdEZpeGVkVGltZXMgPSAiNCI7CiAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLm1heF9wYXJ0aWNpcGFudHMgPSAxOwoKICAgIGxvZ0RlYnVnKCJYWFggPSAiK0pTT04uc3RyaW5naWZ5KHJlc2NoZWR1bGVfZXZlbnQpKTsKCiAgICAkc2NvcGUucmVzY2hlZHVsZV9ldmVudD1mYWxzZTsKICAgICRzY29wZS5yZXNjaGVkdWxlX2V2ZW50X2RldGFpbHM9cmVzY2hlZHVsZV9ldmVudDsKICAgIGlmICgkc2NvcGUucmVzY2hlZHVsZV9ldmVudF9kZXRhaWxzIT1udWxsKQogICAgewogICAgICBsb2dEZWJ1ZygicmVzY2hlZHVsZV9ldmVudF9kZXRhaWxzPSIrJHNjb3BlLnJlc2NoZWR1bGVfZXZlbnRfZGV0YWlscy5ldmVudF9pZCk7CiAgICAgIGxvZ0RlYnVnKEpTT04uc3RyaW5naWZ5KCRzY29wZS5yZXNjaGVkdWxlX2V2ZW50X2RldGFpbHMpKTsKICAgICAgJHNjb3BlLnJlc2NoZWR1bGVfZXZlbnQ9dHJ1ZTsKICAgICAgJHNjb3BlLmdpdmVuX2V2ZW50X3R5cGVfaWQgPSAkc2NvcGUucmVzY2hlZHVsZV9ldmVudF9kZXRhaWxzLmV2ZW50X3R5cGVfaWQ7CiAgICAgIC8vIHN0aWxsIHByZWZlcmluZyBlbXBfaWQgZnJvbSBzY2hlZHVsZXIgc3VnZ2VzdGlvbiBpcyBpdCB3YXMgc2VsZWN0ZWQKICAgICAgaWYgKGVtcF9pZCE9MCkKICAgICAgewogICAgICAgICRzY29wZS5naXZlbl9lbXBfaWQgPSBlbXBfaWQ7CiAgICAgIH0KICAgICAgZWxzZQogICAgICB7CiAgICAgICAgJHNjb3BlLmdpdmVuX2VtcF9pZCA9ICRzY29wZS5yZXNjaGVkdWxlX2V2ZW50X2RldGFpbHMuaW5zdHJ1Y3Rvcl9pZDsKICAgICAgfQogICAgICAvLyBzdGlsbCBwcmVmZXJpbmcgbG9jYXRpb25faWQgZnJvbSBzY2hlZHVsZXIgc3VnZ2VzdGlvbiBvdmVyIHRoZSBvcmlnaW5hbCBsb2NhdGlvbiBmcm9tIGV2ZW50CiAgICAgIGlmIChsb2NhdGlvbl9pZCE9MCkKICAgICAgewogICAgICAgICRzY29wZS5naXZlbl9sb2NhdGlvbl9pZCA9IGxvY2F0aW9uX2lkOwogICAgICB9CiAgICAgIGVsc2UKICAgICAgewogICAgICAgICRzY29wZS5naXZlbl9sb2NhdGlvbl9pZCA9ICRzY29wZS5yZXNjaGVkdWxlX2V2ZW50X2RldGFpbHMubG9jYXRpb25faWQ7CiAgICAgIH0KICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgJHNjb3BlLmdpdmVuX2V2ZW50X3R5cGVfaWQgPSBldmVudF90eXBlX2lkOwogICAgICAkc2NvcGUuZ2l2ZW5fbG9jYXRpb25faWQgPSBsb2NhdGlvbl9pZDsKICAgICAgJHNjb3BlLmdpdmVuX2VtcF9pZCA9IGVtcF9pZDsKICAgIH0KICAgIGlmICgkc2NvcGUuZ2l2ZW5fZXZlbnRfdHlwZV9pZD4wKQogICAgewogICAgICAkc2NvcGUucHJldmlvdXNseV9zZWxlY3RlZF9ldmVudF90eXBlPXRydWU7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICRzY29wZS5wcmV2aW91c2x5X3NlbGVjdGVkX2V2ZW50X3R5cGU9ZmFsc2U7CiAgICB9CiAgICBsb2dEZWJ1ZygiJHNjb3BlLmdpdmVuX2V2ZW50X3R5cGVfaWQ9Iiskc2NvcGUuZ2l2ZW5fZXZlbnRfdHlwZV9pZCk7CgogICAgc2VsZWN0ZWREYXRlU3RhcnQgPSBuZXcgRGF0ZShzdGFydERhdGUpOwogICAgbG9nRGVidWcoInNlbGVjdGVkRGF0ZVN0YXJ0ID0gIitzZWxlY3RlZERhdGVTdGFydCk7CiAgICB2YXIgc2VsZWN0ZWREYXRlU3RhcnQgPSBuZXcgRGF0ZShzZWxlY3RlZERhdGVTdGFydC5nZXRUaW1lKCkgKyBzZWxlY3RlZERhdGVTdGFydC5nZXRUaW1lem9uZU9mZnNldCgpICogNjAwMDApOwoKICAgIC8vIGxvZ0RlYnVnKCJkYXRlPSIgKyBzZWxlY3RlZERhdGVTdGFydCk7CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudCA9IFtdOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycyA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldEhvdXJzKCk7CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBzZWxlY3RlZERhdGVTdGFydC5nZXRNaW51dGVzKCk7CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRvdyA9IGRheU5hbWVzW3NlbGVjdGVkRGF0ZVN0YXJ0LmdldERheSgpXTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF0ZSA9IHNlbGVjdGVkRGF0ZVN0YXJ0OwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aCA9IG1vbnRoTmFtZXNbc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TW9udGgoKV07CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoMTEyID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TW9udGgoKSsxOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXlvZm1vbnRoID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RGF0ZSgpOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RnVsbFllYXIoKTsKICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZV9pbnB1dF9mb3JtYXQ9IG5ldyBEYXRlKDE5NzAsIDAsIDEsICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMsICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcywgMCk7CgogICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pbnN0cnVjdG9yX2lkID0gJHNjb3BlLmdpdmVuX2VtcF9pZDsKICAgICRzY29wZS5uZXdFdmVudERldGFpbHMubG9jYXRpb25faWQgPSAkc2NvcGUuZ2l2ZW5fbG9jYXRpb25faWQ7CgogICAgZ2V0QnVzaW5lc3NMb2NhdGlvbnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19sb2NhdGlvbnMnLGdldEJ1c2luZXNzTG9jYXRpb25zX2ZpbmlzaCk7CiAgICBmdW5jdGlvbiBnZXRCdXNpbmVzc0xvY2F0aW9uc19maW5pc2goKQogICAgewogICAgICBpZiAoJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5sb2NhdGlvbl9pZD09MCkKICAgICAgewogICAgICAgICRzY29wZS5uZXdFdmVudERldGFpbHMubG9jYXRpb25faWQ9JHNjb3BlLmJ1c2luZXNzX2xvY2F0aW9uc1swXS5sb2NhdGlvbl9pZDsKICAgICAgfQogICAgfQoKICAgIGNvbnNvbGUubG9nKCIkc2NvcGUubmV3RXZlbnREZXRhaWxzLmluc3RydWN0b3JfaWQ9Iiskc2NvcGUubmV3RXZlbnREZXRhaWxzLmluc3RydWN0b3JfaWQpOwogICAgLy8gaWYgY2xpZW50IHdhcyBwcmV2aW91c2x5IHNlbGVjdGVkCiAgICAkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcj1mYWxzZTsKICAgIGxvZ0RlYnVnKCJzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyPSIrc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcik7CiAgICBpZiAoc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpIT1udWxsKQogICAgewogICAgICAvLyBjb25zb2xlLmxvZygiZ290IHByZXZpb3VzIHNlbGVjdGVkIHVzZXIgIitzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfZmlyc3RfbmFtZSk7CiAgICAgICRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VybmFtZT1zaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfZmlyc3RfbmFtZSsiICIrc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2VyX2xhc3RfbmFtZTsKICAgICAgJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXI9dHJ1ZTsKCiAgICAgICRzY29wZS5zaG93RXZlbnRDbGllbnRTZWxlY3RlZCA9IHRydWU7CiAgICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kdXNlcl9pZCA9IHNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKS5idXNpbmVzc191c2VyX2lkOwogICAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZHVzZXJfZmlyc3RfbmFtZSA9IHNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKS5idXNlcl9maXJzdF9uYW1lOwogICAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZHVzZXJfbGFzdF9uYW1lID0gc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2VyX2xhc3RfbmFtZTsKICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5idXNpbmVzc191c2VyX2lkID0gc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2luZXNzX3VzZXJfaWQ7CgogICAgfQogICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5zdGFydF90aW1lID0gc3RhcnREYXRlOwogICAgbG9nRGVidWcoIiRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZTE9Iiskc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWUpOwogICAgJHNjb3BlLnN0YXJ0TWludXRlcyA9IGZ1bmN0aW9uKCkKICAgIHsKICAgICAgbG9nRGVidWcoInN0YXJ0TWludXRlcyAiKygkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpKTsKICAgICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzPW1pbnV0ZXNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcyk7CiAgICAgIGNhbGN1bGF0ZVN0YXJ0VGltZSgpOwogICAgICBjYWxjdWxhdGVFbmRUaW1lRHluYW1pYygpOwogICAgfQogICAgJHNjb3BlLnN0YXJ0SG91cnMgPSBmdW5jdGlvbigpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJzdGFydEhvdXJzICIraG91cnNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMpKTsKICAgICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3Vycz1ob3Vyc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3Vycyk7CiAgICAgIGNhbGN1bGF0ZVN0YXJ0VGltZSgpOwogICAgICBjYWxjdWxhdGVFbmRUaW1lRHluYW1pYygpOwogICAgfQoKICAgICRzY29wZS5lbmRNaW51dGVzID0gZnVuY3Rpb24oKQogICAgewogICAgICBsb2dEZWJ1ZygiZW5kTWludXRlcyAiKygkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzKSk7CiAgICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXM9bWludXRlc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcyk7CiAgICAgIGNhbGN1bGF0ZVN0YXJ0VGltZSgpOwogICAgICBjYWxjdWxhdGVFbmRUaW1lRHluYW1pYygpOwogICAgfQogICAgJHNjb3BlLmVuZEhvdXJzID0gZnVuY3Rpb24oKQogICAgewogICAgICBsb2dEZWJ1ZygiZW5kSG91cnMgIitob3Vyc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMpKTsKICAgICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnM9aG91cnNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzKTsKICAgICAgY2FsY3VsYXRlU3RhcnRUaW1lKCk7CiAgICAgIGNhbGN1bGF0ZUVuZFRpbWVEeW5hbWljKCk7CiAgICB9CgogICAgZnVuY3Rpb24gY2FsY3VsYXRlU3RhcnRUaW1lKCkKICAgIHsKICAgICAgZXZlbnRZZWFyPSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0eWVhcjsKICAgICAgZXZlbnRNb250aD0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoMTEyOwogICAgICBldmVudERheT0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRheW9mbW9udGg7CiAgICAgIGlmIChwYXJzZUludChldmVudE1vbnRoKTwxMCkKICAgICAgewogICAgICAgIGV2ZW50TW9udGg9IjAiK2V2ZW50TW9udGg7CiAgICAgIH0KICAgICAgaWYgKHBhcnNlSW50KGV2ZW50RGF5KTwxMCkKICAgICAgewogICAgICAgIGV2ZW50RGF5PSIwIitldmVudERheTsKICAgICAgfQogICAgICBsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyPSIrZXZlbnRZZWFyKTsKICAgICAgbG9nRGVidWcoIiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aD0iK2V2ZW50TW9udGgpOwogICAgICBsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aD0iK2V2ZW50RGF5KTsKICAgICAgbmV3X3N0YXJ0PW1vbWVudC51dGMoZXZlbnRZZWFyKyItIitldmVudE1vbnRoKyItIitldmVudERheSsiVDAwOjAwOjAwIikuYWRkKCgocGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykqNjApK3BhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcykpLCAnbWludXRlcycpOwogICAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWU9bmV3X3N0YXJ0OwogICAgICBsb2dEZWJ1ZygibmV3X3N0YXJ0PSIrbmV3X3N0YXJ0KTsKICAgIH0KICAgIGZ1bmN0aW9uIG1pbnV0ZXNDaGFuZ2VkKHRoZW1pbnV0ZXMpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJ0aGVtaW51dGVzPSIrdGhlbWludXRlcyk7CiAgICAgIGlmICh0eXBlb2YgdGhlbWludXRlcz09InVuZGVmaW5lZCIpCiAgICAgIHsKICAgICAgICByZXR1cm4gIjAwIjsKICAgICAgfQogICAgICBpZiAoaXNOYU4odGhlbWludXRlcykpCiAgICAgIHsKICAgICAgICByZXR1cm4gIjAwIjsKICAgICAgfQogICAgICBpZiAodGhlbWludXRlcz09JycpCiAgICAgIHsKICAgICAgICByZXR1cm4gIjAwIjsKICAgICAgfQogICAgICB0aGVtaW51dGVzPXBhcnNlSW50KHRoZW1pbnV0ZXMpOwogICAgICBpZiAodGhlbWludXRlcz42MCkKICAgICAgewogICAgICAgIHJldHVybiAiMDAiOwogICAgICB9CiAgICAgIGVsc2UgaWYgKHRoZW1pbnV0ZXM8MCkKICAgICAgewogICAgICAgIHJldHVybiAiMDAiOwogICAgICB9CiAgICAgIGVsc2UgaWYgKHRoZW1pbnV0ZXM9PSIiKQogICAgICB7CiAgICAgICAgcmV0dXJuICIwMCI7CiAgICAgIH0KICAgICAgZWxzZSBpZiAodGhlbWludXRlczwxMCkKICAgICAgewogICAgICAgIHJldHVybiAiMCIrdGhlbWludXRlczsKICAgICAgfQogICAgICBlbHNlCiAgICAgIHsKICAgICAgICAgIHJldHVybiB0aGVtaW51dGVzOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBob3Vyc0NoYW5nZWQodGhlaG91cnMpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJ0aGVob3Vycz0iK3RoZWhvdXJzKTsKICAgICAgaWYgKHR5cGVvZiB0aGVob3Vycz09InVuZGVmaW5lZCIpCiAgICAgIHsKICAgICAgICByZXR1cm4gIjAiOwogICAgICB9CiAgICAgIGlmIChpc05hTih0aGVob3VycykpCiAgICAgIHsKICAgICAgICByZXR1cm4gIjAiOwogICAgICB9CiAgICAgIGlmICh0aGVob3Vycz09JycpCiAgICAgIHsKICAgICAgICByZXR1cm4gIjAiOwogICAgICB9CiAgICAgIHRoZWhvdXJzPXBhcnNlSW50KHRoZWhvdXJzKTsKICAgICAgaWYgKHRoZWhvdXJzPjI0KQogICAgICB7CiAgICAgICAgcmV0dXJuIDA7CiAgICAgIH0KICAgICAgZWxzZSBpZiAodGhlaG91cnM8MCkKICAgICAgewogICAgICAgIHJldHVybiAwOwogICAgICB9CiAgICAgIGVsc2UgaWYgKHRoZWhvdXJzPT0iIikKICAgICAgewogICAgICAgIHJldHVybiAiMCI7CiAgICAgIH0KICAgICAgZWxzZQogICAgICB7CiAgICAgICAgICByZXR1cm4gdGhlaG91cnM7CiAgICAgIH0KICAgIH0KICAgIGdldEFsbEluc3RydWN0b3JzKCRodHRwLCRzY29wZSwnaW5zdHJ1Y3RvcnMnLGdldEFsbEluc3RydWN0b3JzX3N1Y2Nlc3MpOwogICAgZnVuY3Rpb24gZ2V0QWxsSW5zdHJ1Y3RvcnNfc3VjY2VzcygpCiAgICB7CiAgICAgIC8vICRzY29wZS5pbnN0cnVjdG9ycy51bnNoaWZ0KHtidXNpbmVzc191c2VyX2lkOm51bGwsIGJ1c2VyX2ZpcnN0X25hbWU6IiIsIGJ1c2VyX2xhc3RfbmFtZToiIn0pOwogICAgICBpZiAoISRzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZD4wKQogICAgICB7CiAgICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pbnN0cnVjdG9yX2lkPSRzY29wZS5pbnN0cnVjdG9yc1swXS5idXNpbmVzc191c2VyX2lkOwogICAgICB9CiAgICB9CgogICAgJHNjb3BlLnNlbGVjdEV2ZW50VHlwZSA9IGZ1bmN0aW9uKCkgewogICAgICAgIC8vIHJlbW92aW5nIGV2ZW50IHR5cGUg15HXl9eoINeh15XXkiDXntek15LXqQogICAgICAgIGlmICgkc2NvcGUuZXZlbnRUeXBlT3B0aW9uc1swXS5ldmVudF90eXBlX2lkPT0wKQogICAgICAgIHsKICAgICAgICAgICRzY29wZS5ldmVudFR5cGVPcHRpb25zLnNwbGljZSgwLCAxKTsKICAgICAgICB9CiAgICAgICAgJHNjb3BlLmFqYXhfZXJyb3I9Jyc7CiAgICAgICAgY2hvaWNlPSRzY29wZS5zZWxlY3RFdmVudFR5cGVTZWxlY3RlZDsKICAgICAgICBsb2dEZWJ1Zygic2VsZWN0RXZlbnRUeXBlIik7CiAgICAgICAgbG9nRGVidWcoSlNPTi5zdHJpbmdpZnkoJHNjb3BlLnNlbGVjdEV2ZW50VHlwZVNlbGVjdGVkKSk7CiAgICAgICAgJHNjb3BlLmV2ZW50VHlwZVRpdGxlID0gY2hvaWNlLmV2ZW50X3R5cGVfbmFtZTsKICAgICAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmV2ZW50X3R5cGVfaWQgPSBjaG9pY2UuZXZlbnRfdHlwZV9pZDsKCiAgICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5ldmVudF9uYW1lID0gY2hvaWNlLmV2ZW50X3R5cGVfbmFtZTsKICAgICAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLm9yaWdpbmFsX2V2ZW50X25hbWUgPSBjaG9pY2UuZXZlbnRfdHlwZV9uYW1lOwogICAgICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuZXZlbnRfZGVzY3JpcHRpb24gPSBjaG9pY2UuZXZlbnRfdHlwZV9kZXNjcmlwdGlvbjsKICAgICAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmlzX2NsYXNzID0gY2hvaWNlLmlzX2NsYXNzOwogICAgICAgICRzY29wZS5uZXdFdmVudERldGFpbHMub3JpZ2luYWxfcHJpY2UgPSBjaG9pY2Uub3JpZ2luYWxfcHJpY2U7CiAgICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pc19nZW5lcmljX2V0eXBlID0gY2hvaWNlLmlzX2dlbmVyaWNfZXR5cGU7CiAgICAgICAgLy8gJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pbnN0cnVjdG9yX2lkID0gY2hvaWNlLmluc3RydWN0b3JfaWQ7CiAgICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5kdXJhdGlvbl9ldmVudCA9IGNob2ljZS5kdXJhdGlvbl9ldmVudDsKICAgICAgICAvLyBsb2dEZWJ1Zygic2NvcGUubmV3RXZlbnREZXRhaWxzLmlzX2NsYXNzPSIrJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pc19jbGFzcyk7CiAgICAgICAgLy8gbG9nRGVidWcoInNjb3BlLm5ld0V2ZW50RGV0YWlscy5pbnN0cnVjdG9yX2lkPSIrJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pbnN0cnVjdG9yX2lkKTsKICAgICAgICAvLyBsb2dEZWJ1Zygic3RhcnREYXRlPSIrc3RhcnREYXRlKTsKICAgICAgICAvLyAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWUgPSBzdGFydERhdGU7CiAgICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5ldmVudHR5cGUgPSBjaG9pY2U7CiAgICAgICAgY2FsY3VsYXRlRW5kVGltZSgpOwoKICAgICAgICAvLyAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWVfaW5wdXRfZm9ybWF0PSBuZXcgRGF0ZSgxOTcwLCAwLCAxLCAxNCwgNTcsIDApOwoKICAgICAgICBsb2dEZWJ1ZygibmV3RXZlbnQgc3RhcnQ9IiArICRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZSk7CiAgICAgICAgbG9nRGVidWcoIm5ld0V2ZW50IGVuZD0iICsgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmRfdGltZSk7CgogICAgICAgICRzY29wZS5zaG93RXZlbnRUeXBlU2VsZWN0ZWQgPSB0cnVlOwogICAgfQoKICAgIC8vIHRoaXMgZnVuY3Rpb24gY2FsY3VsYXRlcyBlbmQgdGltZSBhY2NvcmRpbmcgdG8gdGhlIGxlbmd0aCBvZiB0aGUgZXZlbnR0eXBlCiAgICBmdW5jdGlvbiBjYWxjdWxhdGVFbmRUaW1lKCkKICAgIHsKICAgICAgY29uc29sZS5sb2coIiRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZT0iKyRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZSk7CiAgICAgIGVuZCA9IG1vbWVudCgkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWUpLmFkZCgkc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50LCAnbWludXRlcycpOwogICAgICBzZWxlY3RlZERhdGVFbmQgPSBuZXcgRGF0ZShlbmQpOwogICAgICBzZWxlY3RlZERhdGVFbmQgPSBuZXcgRGF0ZShzZWxlY3RlZERhdGVFbmQuZ2V0VGltZSgpICsgc2VsZWN0ZWREYXRlRW5kLmdldFRpbWV6b25lT2Zmc2V0KCkgKiA2MDAwMCk7CiAgICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzID0gc2VsZWN0ZWREYXRlRW5kLmdldEhvdXJzKCk7CiAgICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGRvdyA9IGRheU5hbWVzW3NlbGVjdGVkRGF0ZUVuZC5nZXREYXkoKV07CiAgICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKSA8IDEwID8gJzAnIDogJycpICsgc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKTsKICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmRfdGltZSA9IGVuZDsKICAgICAgLy8gY2FsY3VsYXRpbmcgZHVyYXRpb24KICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5kdXJhdGlvbl9ldmVudD1wYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzKS1wYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpOwogICAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50PSRzY29wZS5uZXdFdmVudERldGFpbHMuZHVyYXRpb25fZXZlbnQrKHBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzKS1wYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKSkqNjA7CiAgICAgIGlmICgkc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50PDApCiAgICAgIHsKICAgICAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50PTA7CiAgICAgIH0KICAgIH0KCiAgICAvLyB0aGlzIGZ1bmN0aW9uIGNhbGN1bGF0ZXMgZW5kIHRpbWUgYWNjb3JkaW5nIHRvIHRoZSBpbnB1dCBmcm9tIG1vZGFsIHdpbmRvdwogICAgLy8gYW5kIG5vdCBhY2NvcmRpbmcgdG8gZXZlbnQgdHlwZSBsZW5ndGgKICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZUVuZFRpbWVEeW5hbWljKCkKICAgIHsKICAgICAgZXZlbnRZZWFyPSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0eWVhcjsKICAgICAgZXZlbnRNb250aD0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoMTEyOwogICAgICBldmVudERheT0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRheW9mbW9udGg7CiAgICAgIGlmIChwYXJzZUludChldmVudE1vbnRoKTwxMCkKICAgICAgewogICAgICAgIGV2ZW50TW9udGg9IjAiK2V2ZW50TW9udGg7CiAgICAgIH0KICAgICAgaWYgKHBhcnNlSW50KGV2ZW50RGF5KTwxMCkKICAgICAgewogICAgICAgIGV2ZW50RGF5PSIwIitldmVudERheTsKICAgICAgfQogICAgICBsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyPSIrZXZlbnRZZWFyKTsKICAgICAgbG9nRGVidWcoIiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aD0iK2V2ZW50TW9udGgpOwogICAgICBsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aD0iK2V2ZW50RGF5KTsKICAgICAgbmV3X2VuZD1tb21lbnQudXRjKGV2ZW50WWVhcisiLSIrZXZlbnRNb250aCsiLSIrZXZlbnREYXkrIlQwMDowMDowMCIpLmFkZCgoKHBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzKSo2MCkrcGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcykpLCAnbWludXRlcycpOwogICAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZF90aW1lPW5ld19lbmQ7CiAgICAgIGxvZ0RlYnVnKCJuZXdfZW5kPSIrbmV3X2VuZCk7CiAgICAgIC8vIGNhbGN1bGF0aW5nIGR1cmF0aW9uCiAgICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuZHVyYXRpb25fZXZlbnQ9cGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcyktcGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKTsKICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5kdXJhdGlvbl9ldmVudD0kc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50KyhwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycyktcGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykpKjYwOwogICAgICBpZiAoJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5kdXJhdGlvbl9ldmVudDwwKQogICAgICB7CiAgICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5kdXJhdGlvbl9ldmVudD0wOwogICAgICB9CiAgICB9CiAgICBnZXRBbGxCdXNpbmVzc0V2ZW50VHlwZXMoJGh0dHAsJHNjb3BlLCdldmVudFR5cGVPcHRpb25zJyxnZXRBbGxCdXNpbmVzc0V2ZW50VHlwZXNfc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBnZXRBbGxCdXNpbmVzc0V2ZW50VHlwZXNfc3VjY2VzcygpCiAgICB7CiAgICAgIC8vIGFmdGVyIGxvYWRpbmcgZXZlbnQgdHlwZXMsIGlmIHRoZSBnaXZlbiBldmVudCB0eXBlIGlzICE9IDAgd2UgInNlbGVjdCIgaXQKICAgICAgY29uc29sZS5sb2coImdldEFsbEJ1c2luZXNzRXZlbnRUeXBlc19zdWNjZXNzIik7CiAgICAgIGlmICgkc2NvcGUuZ2l2ZW5fZXZlbnRfdHlwZV9pZD4wKQogICAgICB7CiAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8ICRzY29wZS5ldmVudFR5cGVPcHRpb25zLmxlbmd0aDsgaSsrKQogICAgICAgIHsKICAgICAgICAgIGlmICgkc2NvcGUuZXZlbnRUeXBlT3B0aW9uc1tpXS5ldmVudF90eXBlX2lkPT0kc2NvcGUuZ2l2ZW5fZXZlbnRfdHlwZV9pZCkKICAgICAgICAgIHsKICAgICAgICAgICAgY29uc29sZS5sb2coImdpdmVuX2V2ZW50X3R5cGVfaWQgZm91bmQiKTsKICAgICAgICAgICAgLy8gJHNjb3BlLmNhbGN1bGF0ZVN0YXJ0VGltZSgpOwogICAgICAgICAgICAkc2NvcGUuc2VsZWN0RXZlbnRUeXBlU2VsZWN0ZWQ9JHNjb3BlLmV2ZW50VHlwZU9wdGlvbnNbaV07CiAgICAgICAgICAgIC8vICRzY29wZS5zZWxlY3RFdmVudFR5cGUoJHNjb3BlLmV2ZW50VHlwZU9wdGlvbnNbaV0pOwogICAgICAgICAgICAkc2NvcGUuc2VsZWN0RXZlbnRUeXBlKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGVsc2UgewogICAgICAgICRzY29wZS5ldmVudFR5cGVPcHRpb25zLnVuc2hpZnQoeyJldmVudF90eXBlX2lkIjowLCAiZXZlbnRfdHlwZV9uYW1lIjoi15HXl9eoINeh15XXkiDXntek15LXqSIsIGlzX3ZhY2F0aW9uOiAwfSk7CiAgICAgICAgJHNjb3BlLnNlbGVjdEV2ZW50VHlwZVNlbGVjdGVkPSRzY29wZS5ldmVudFR5cGVPcHRpb25zWzBdOwogICAgICB9CiAgICB9CiAgICBnZXRBbGxDbGllbnRzKCRodHRwLCRzY29wZSwnZXZlbnRUeXBlVXNlcnMnKTsKCiAgICAkc2NvcGUuZXZlbnRDbGllbnRTZWxlY3RlZCA9IGZ1bmN0aW9uKHNlbGVjdGVkKSB7CiAgICAgICAgaWYgKHNlbGVjdGVkKSB7CiAgICAgICAgICAgIC8vIGFsZXJ0KEpTT04uc3RyaW5naWZ5KCBzZWxlY3RlZCwgbnVsbCwgMiApKTsKICAgICAgICAgICAgbG9nRGVidWcoJ2NsaWVudCBzZWxlY3RlZCAnICsgc2VsZWN0ZWQub3JpZ2luYWxPYmplY3QuYnVzZXJfZmlyc3RfbmFtZSk7CiAgICAgICAgICAgICRzY29wZS5zaG93RXZlbnRDbGllbnRTZWxlY3RlZCA9IHRydWU7CiAgICAgICAgICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kdXNlcl9pZCA9IHNlbGVjdGVkLm9yaWdpbmFsT2JqZWN0LmJ1c2luZXNzX3VzZXJfaWQ7CiAgICAgICAgICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kdXNlcl9maXJzdF9uYW1lID0gc2VsZWN0ZWQub3JpZ2luYWxPYmplY3QuYnVzZXJfZmlyc3RfbmFtZTsKICAgICAgICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmR1c2VyX2xhc3RfbmFtZSA9IHNlbGVjdGVkLm9yaWdpbmFsT2JqZWN0LmJ1c2VyX2xhc3RfbmFtZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBsb2dEZWJ1Zygnbm90IHNlbGVjdGVkJyk7CiAgICAgICAgICAgIC8vICRzY29wZS5ldmVudENsaWVudERlU2VsZWN0ZWQoKTsKICAgICAgICB9CiAgICB9OwogICAgJHNjb3BlLmV2ZW50Q2xpZW50RGVTZWxlY3RlZCA9IGZ1bmN0aW9uKCkgewogICAgICAgICRzY29wZS5zaG93RXZlbnRDbGllbnRTZWxlY3RlZCA9IGZhbHNlOwogICAgICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kdXNlcl9pZCA9IG51bGw7CiAgICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmR1c2VyX2ZpcnN0X25hbWUgPSBudWxsOwogICAgICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kdXNlcl9sYXN0X25hbWUgPSBudWxsOwogICAgICAgICRzY29wZS5jbGVhckNsaWVudElucHV0KCdjbGllbnRfYW5ndWNvbXBsZXRlJyk7CiAgICB9CgogICAgJHNjb3BlLmNsZWFyQ2xpZW50SW5wdXQgPSBmdW5jdGlvbihpZCkgewogICAgICAgIGlmIChpZCkgewogICAgICAgICAgICAkc2NvcGUuJGJyb2FkY2FzdCgnYW5ndWNvbXBsZXRlLWFsdDpjbGVhcklucHV0JywgaWQpOwogICAgICAgIH0KICAgICAgICAvLyBlbHNlewogICAgICAgIC8vICAgJHNjb3BlLiRicm9hZGNhc3QoJ2FuZ3Vjb21wbGV0ZS1hbHQ6Y2xlYXJJbnB1dCcpOwogICAgICAgIC8vIH0KICAgIH0KCiAgICAkc2NvcGUuY2FuY2VsID0gZnVuY3Rpb24oKSB7CiAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgfTsKCiAgICAkc2NvcGUudXBkYXRlRXZlbnROYW1lQ2hlY2sgPSBmdW5jdGlvbihuZXdWYWx1ZSkKICAgIHsKICAgICAgbG9nRGVidWcoInVwZGF0ZUV2ZW50TmFtZT0iK25ld1ZhbHVlKTsKICAgICAgaWYgKG5ld1ZhbHVlPT0iIikKICAgICAgewogICAgICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuZXZlbnRfbmFtZSA9ICRzY29wZS5uZXdFdmVudERldGFpbHMub3JpZ2luYWxfZXZlbnRfbmFtZTsKICAgICAgfQogICAgfQogICAgLy8gcmVzY2hlZHVsZUV2ZW50CiAgICAkc2NvcGUucmVzY2hlZHVsZUV2ZW50ID0gZnVuY3Rpb24oKSB7CiAgICAgIGxvZ0RlYnVnKCJmdW5jdGlvbjogcmVzY2hlZHVsZUV2ZW50Iik7CgogICAgICAvLyBuZXdFdmVudEpTT05EZXRhaWxzID0gSlNPTi5zdHJpbmdpZnkoJHNjb3BlLm5ld0V2ZW50RGV0YWlscywgbnVsbCwgNCk7IC8vIChPcHRpb25hbCkgYmVhdXRpZnVsIGluZGVudGVkIG91dHB1dC4KICAgICAgbG9nRGVidWcoInJlc2NoZWR1bGVFdmVudCwgIiArIEpTT04uc3RyaW5naWZ5KCRzY29wZS5uZXdFdmVudERldGFpbHMsIG51bGwsIDQpKTsKICAgICAgLy8gaWYgKCRzY29wZS5uZXdFdmVudERldGFpbHMuZXZlbnRSZWN1cnJpbmcpIHsKICAgICAgLy8gICBjcmVhdGVSZWN1cnJpbmdFdmVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLm5ld0V2ZW50RGV0YWlscyxjcmVhdGVSZWN1cnJpbmdFdmVudF9zdWNjZXNzKTsKICAgICAgLy8gICBmdW5jdGlvbiBjcmVhdGVSZWN1cnJpbmdFdmVudF9zdWNjZXNzKCkKICAgICAgLy8gICB7CiAgICAgIC8vICAgICBjYWxlbmRhciA9ICJjYWxlbmRhcl9idXNpbmVzcyI7CiAgICAgIC8vICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZWZldGNoRXZlbnRzJyk7CiAgICAgIC8vICAgICAkdWliTW9kYWxJbnN0YW5jZS5kaXNtaXNzKCk7CiAgICAgIC8vICAgICAvLyBlcnJvciB3YXMKICAgICAgLy8gICAgIC8vIGxvZ0RlYnVnKCJlcnJvciAiICsgZGF0YS5NZXNzYWdlKTsKICAgICAgLy8gICAgIC8vICRzY29wZS5hamF4X2Vycm9yID0gZGF0YS5NZXNzYWdlOwogICAgICAvLyAgIH0KICAgICAgLy8gfQogICAgICAvLyBlbHNlCiAgICAgIHsKICAgICAgICAvLyBpZiBldmVudCBpcyBub3QgY2xhc3MsIGEgY2xpZW50IG11c3QgYmUgc2VsZWN0ZWQKICAgICAgICAvLyBpZiAoKCEkc2NvcGUuc2hvd0V2ZW50Q2xpZW50U2VsZWN0ZWQpICYmICghJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pc19jbGFzcykpCiAgICAgICAgLy8gewogICAgICAgIC8vICAgLy8gYWxlcnQoJ2NsaWVudCBtdXN0IGJlIHNlbGVjdGVkJyk7CiAgICAgICAgLy8gICAkc2NvcGUuYWpheF9lcnJvcj0i15DXoNeQINeU15XXodejINee16nXqteq16Mg15zXntek15LXqSI7CiAgICAgICAgLy8gICByZXR1cm47CiAgICAgICAgLy8gfQogICAgICAgIHJlc2NoZWR1bGVFdmVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLnJlc2NoZWR1bGVfZXZlbnRfZGV0YWlscy5ldmVudF9pZCwkc2NvcGUubmV3RXZlbnREZXRhaWxzLHJlc2NoZWR1bGVFdmVudF9zdWNjZXNzKTsKICAgICAgICBmdW5jdGlvbiByZXNjaGVkdWxlRXZlbnRfc3VjY2VzcygpCiAgICAgICAgewogICAgICAgICAgY2FsZW5kYXIgPSAiY2FsZW5kYXJfYnVzaW5lc3MiOwogICAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwogICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjYWxlbmRhckV2ZW50UmVzY2hlZHVsZURlc2VsZWN0Jyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCiAgICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5kaXNtaXNzKCdhZGRlZCcpOwogICAgICAgIH0KICAgICAgICAvLyBvbiBmYWlsdXJlIHdhcwogICAgICAgIC8vICRzY29wZS5hamF4X2Vycm9yID0gZGF0YS5NZXNzYWdlOwogICAgICB9CiAgICB9OwoKICAgICRzY29wZS5jcmVhdGVOZXdFdmVudCA9IGZ1bmN0aW9uKCkgewogICAgICAgIGxvZ0RlYnVnKCJjcmVhdGVOZXdFdmVudCBzdGFydF90aW1lPSIrIHR5cGVvZiAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWUpOwoKICAgICAgICBuZXdFdmVudEpTT05EZXRhaWxzID0gSlNPTi5zdHJpbmdpZnkoJHNjb3BlLm5ld0V2ZW50RGV0YWlscywgbnVsbCwgNCk7IC8vIChPcHRpb25hbCkgYmVhdXRpZnVsIGluZGVudGVkIG91dHB1dC4KICAgICAgICBsb2dEZWJ1ZygiY3JlYXRlTmV3RXZlbnQsICIgKyBuZXdFdmVudEpTT05EZXRhaWxzKTsKICAgICAgICBpZiAoJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5ldmVudFJlY3VycmluZykgewogICAgICAgICAgY3JlYXRlUmVjdXJyaW5nRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5uZXdFdmVudERldGFpbHMsY3JlYXRlUmVjdXJyaW5nRXZlbnRfc3VjY2Vzcyk7CiAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVSZWN1cnJpbmdFdmVudF9zdWNjZXNzKCkKICAgICAgICAgIHsKICAgICAgICAgICAgY2FsZW5kYXIgPSAiY2FsZW5kYXJfYnVzaW5lc3MiOwogICAgICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZWZldGNoRXZlbnRzJyk7CiAgICAgICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoKTsKICAgICAgICAgICAgLy8gZXJyb3Igd2FzCiAgICAgICAgICAgIC8vIGxvZ0RlYnVnKCJlcnJvciAiICsgZGF0YS5NZXNzYWdlKTsKICAgICAgICAgICAgLy8gJHNjb3BlLmFqYXhfZXJyb3IgPSBkYXRhLk1lc3NhZ2U7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAvLyBjaGVja2luZyBldmVudCB0aW1lIGxvZ2ljCiAgICAgICAgICBpZiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3Vycz4kc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycykKICAgICAgICAgIHsKICAgICAgICAgICAgJHNjb3BlLmFqYXhfZXJyb3I9IteW157XnyDXlNeU16rXl9ec15Qg16nXnCDXlNee16TXktepINeQ15fXqNeZINeW157XnyDXlNeh15nXldedINep15zXlSI7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIC8vIGNoZWNraW5nIGV2ZW50IHRpbWUgbG9naWMKICAgICAgICAgIGlmIChwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKT09cGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMpKQogICAgICAgICAgewogICAgICAgICAgICBpZiAocGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKT49cGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcykpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAkc2NvcGUuYWpheF9lcnJvcj0i15bXntefINeU15TXqteX15zXlCDXqdecINeU157XpNeS16kg15DXl9eo15kg15bXntefINeU16HXmdeV150g16nXnNeVIjsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbG9nRGVidWcoIiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcz0iKyRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcyk7CiAgICAgICAgICAgIGxvZ0RlYnVnKCIkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzPSIrJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcyk7CiAgICAgICAgICAgIGlmICgocGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKSs1KT49cGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcykpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAkc2NvcGUuYWpheF9lcnJvcj0i15DXldeo15og15TXntek15LXqSDXl9eZ15nXkSDXnNeU15nXldeqINec16TXl9eV16ogNSDXk9en15XXqiI7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICAvLyBpZiBldmVudCBpcyBub3QgY2xhc3MsIGEgY2xpZW50IG11c3QgYmUgc2VsZWN0ZWQKICAgICAgICAgIGlmICgoISRzY29wZS5zaG93RXZlbnRDbGllbnRTZWxlY3RlZCkgJiYgKCEkc2NvcGUubmV3RXZlbnREZXRhaWxzLmlzX2NsYXNzKSAmJiAoJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pc19nZW5lcmljX2V0eXBlPT0wKSkKICAgICAgICAgIHsKICAgICAgICAgICAgLy8gYWxlcnQoJ2NsaWVudCBtdXN0IGJlIHNlbGVjdGVkJyk7CiAgICAgICAgICAgICRzY29wZS5hamF4X2Vycm9yPSLXkNeg15Ag15TXldeh16Mg157Xqdeq16rXoyDXnNee16TXktepIjsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgaWYgKCRzY29wZS5zZWxlY3RFdmVudFR5cGVTZWxlY3RlZC5ldmVudF90eXBlX2lkPT0wKQogICAgICAgICAgewogICAgICAgICAgICAvLyBhbGVydCgnY2xpZW50IG11c3QgYmUgc2VsZWN0ZWQnKTsKICAgICAgICAgICAgJHNjb3BlLmFqYXhfZXJyb3I9IteQ16DXkCDXkdeX16gg16HXldeSINee16TXktepICI7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIGNyZWF0ZUV2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUubmV3RXZlbnREZXRhaWxzLGNyZWF0ZUV2ZW50X3N1Y2Nlc3MpOwogICAgICAgICAgZnVuY3Rpb24gY3JlYXRlRXZlbnRfc3VjY2VzcygpCiAgICAgICAgICB7CiAgICAgICAgICAgIGNhbGVuZGFyID0gImNhbGVuZGFyX2J1c2luZXNzIjsKICAgICAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwogICAgICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5kaXNtaXNzKCdhZGRlZCcpOwogICAgICAgICAgfQogICAgICAgICAgLy8gb24gZmFpbHVyZSB3YXMKICAgICAgICAgIC8vICRzY29wZS5hamF4X2Vycm9yID0gZGF0YS5NZXNzYWdlOwogICAgICAgIH0KICAgIH0KfSk7Ci8vLy8gZmZmZmZmZgprdXplQXBwLmNvbnRyb2xsZXIoJ0J1c2luZXNzQ2FsZW5kYXJDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgc2hhcmVkUHJvcGVydGllcywgJGNvbXBpbGUsICRsb2NhdGlvbiwgdWlDYWxlbmRhckNvbmZpZywgJHVpYk1vZGFsLCBzaGFyZWREYXRhKSB7CiAgICBpbml0aWFsRW5kVXNlciA9IHNoYXJlZERhdGEuZ2V0U2VsZWN0ZWRFbmRVc2VyKCk7CiAgICBsb2dEZWJ1ZygnQnVzaW5lc3NDYWxlbmRhciBDb250cm9sbGVyLCBzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCk9JyArIHNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKSk7CgogICAgZ2V0QnVzaW5lc3NMb2NhdGlvbnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19sb2NhdGlvbnMnKTsKCiAgICAkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcj1mYWxzZTsKCiAgICBpZiAoc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpIT1udWxsKQogICAgewogICAgICBjb25zb2xlLmxvZygiZ290IHByZXZpb3VzIHNlbGVjdGVkIHVzZXIgIitzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfZmlyc3RfbmFtZSk7CiAgICAgICRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VybmFtZT1zaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfZmlyc3RfbmFtZSsiICIrc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2VyX2xhc3RfbmFtZTsKICAgICAgJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJfaWQ9c2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2luZXNzX3VzZXJfaWQ7CiAgICAgIGxvZ0RlYnVnKCIkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcl9pZD0iKyRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyX2lkKTsKCiAgICAgICRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyPXRydWU7CiAgICB9CgogICAgLy8gY2hlY2tpbmcgaWYgY2FsZW5kYXIgc2hvdWxkIHN0YXJ0IHdpdGggYSBzcGVjaWZpYyBkYXRlIChmcm9tIHVybCBvciBmcm9tIHByZXZpb3VzbHkgc2VsZWN0ZWQgZGF0ZSkKICAgIGxvZ0RlYnVnKCIkbG9jYXRpb24uc2VhcmNoKCkuc3RhcnQ9IiArICRsb2NhdGlvbi5zZWFyY2goKS5zdGFydCk7CiAgICBpZiAodHlwZW9mICRsb2NhdGlvbi5zZWFyY2goKS5zdGFydCAhPSAndW5kZWZpbmVkJykKICAgIHsKICAgICAgY3VyckRlZmF1bHREYXRlID0gJGxvY2F0aW9uLnNlYXJjaCgpLnN0YXJ0OwogICAgfQogICAgZWxzZSBpZiAoc2hhcmVkUHJvcGVydGllcy5nZXRfY2FsZW5kYXJfZGF0ZSgpIT1udWxsKQogICAgewogICAgICBjb25zb2xlLmxvZygiZ290IHByZXZpb3VzIGRhdGUgICIrc2hhcmVkUHJvcGVydGllcy5nZXRfY2FsZW5kYXJfZGF0ZSgpKTsKICAgICAgY3VyckRlZmF1bHREYXRlID0gc2hhcmVkUHJvcGVydGllcy5nZXRfY2FsZW5kYXJfZGF0ZSgpOwogICAgfQogICAgZWxzZQogICAgewogICAgICBjdXJyRGVmYXVsdERhdGUgPSBuZXcgRGF0ZSgpOwogICAgfQogICAgZ2V0QWxsSW5zdHJ1Y3RvcnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19pbnN0cnVjdG9ycycsZ2V0QWxsSW5zdHJ1Y3RvcnNfZmluaXNoKTsKICAgIGZ1bmN0aW9uIGdldEFsbEluc3RydWN0b3JzX2ZpbmlzaCgpCiAgICB7CiAgICAgIC8vIGNvbnNvbGUubG9nKCRzY29wZS5idXNpbmVzc19pbnN0cnVjdG9ycyk7CiAgICAgICRzY29wZS5idXNpbmVzc19pbnN0cnVjdG9ycy51bnNoaWZ0KHsiYnVzZXJfZnVsbF9uYW1lIjoi15vXnCDXlNem15XXldeqIiwgImJ1c2VyX2ZpcnN0X25hbWUiOiLXm9eV15zXnSIsImJ1c2VyX2xhc3RfbmFtZSI6IiIsICJ1c2VyX2lkIjogMCwgImJ1c2luZXNzX3VzZXJfaWQiOiAwfSk7CgogICAgICAvLyBzZXR0aW5nIHNlbGVjdGVkIGdldF9zZWxlY3RlZF9pbnN0cnVjdG9yCiAgICAgICRzY29wZS5wcmV2aW91c19zZWxlY3RlZF9pbnN0cnVjdG9yPWZhbHNlOwogICAgICBpZiAoc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfaW5zdHJ1Y3RvcigpPj0wKQogICAgICB7CiAgICAgICAgLy8gY29uc29sZS5sb2coImdvdCBwcmV2aW91cyBzZWxlY3RlZCBpbnN0cnVjdG9yICIrc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfaW5zdHJ1Y3RvcigpKTsKICAgICAgICAkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfaW5zdHJ1Y3Rvcl9pZD1zaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF9pbnN0cnVjdG9yKCk7CiAgICAgICAgJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX2luc3RydWN0b3I9dHJ1ZTsKICAgICAgICAkc2NvcGUuc2VsZWN0ZWRfYnVzaW5lc3NfdXNlcl9pZD1zaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF9pbnN0cnVjdG9yKCk7CiAgICAgIH0KICAgIH0KICAgIGdldEFsbEJ1c2luZXNzRXZlbnRUeXBlc05vU3lzdGVtKCRodHRwLCRzY29wZSwnZXZlbnRfdHlwZXMnKTsKCiAgICAvLyBzZXR0aW5nIHNlbGVjdGVkIHVzZXIgaWQKICAgICRzY29wZS5wcmV2aW91c19ldmVudF9yZXNjaGVkdWxlPWZhbHNlOwogICAgJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGVfZXZlbnQ9bnVsbDsKCiAgICAkc2NvcGUuJG9uKCJjYWxlbmRhckV2ZW50UmVzY2hlZHVsZURlc2VsZWN0IixmdW5jdGlvbihlLGEpCiAgICB7CiAgICAgICRzY29wZS5jYWxlbmRhckV2ZW50UmVzY2hlZHVsZURlc2VsZWN0KCk7CiAgICB9KTsKCiAgICAvLyBkZXNlbGVjdGluZyBldmVudCBmcm9tIGJlaW5nIHJlc2NoZWR1bGVkCiAgICAkc2NvcGUuY2FsZW5kYXJFdmVudFJlc2NoZWR1bGVEZXNlbGVjdD1mdW5jdGlvbigpCiAgICB7CiAgICAgIHNoYXJlZFByb3BlcnRpZXMuc2V0X2V2ZW50X3Jlc2NoZWR1bGUobnVsbCk7CiAgICAgICRzY29wZS5wcmV2aW91c19ldmVudF9yZXNjaGVkdWxlPWZhbHNlOwogICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwogICAgfQogICAgLy8gZGVsZXRpbmcgY2xpZW50IHNlbGVjdGlvbiBpbiBjYWxlbmRhcgogICAgJHNjb3BlLmNhbGVuZGFyQ2xpZW50RGVzZWxlY3Q9ZnVuY3Rpb24oKSAvLyByZWxvYWQgY2xhc3MvZXZlbnQgc3VnZ2VzdGlvbnMKICAgIHsKICAgICAgJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXI9ZmFsc2U7CiAgICAgIHNoYXJlZFByb3BlcnRpZXMuc2V0X3NlbGVjdGVkX3VzZXIobnVsbCk7CiAgICAgICRzY29wZS5ldmVudFR5cGVTZWxlY3RlZCgpOwogICAgfQogICAgaWYgKGluaXRpYWxFbmRVc2VyICE9IG51bGwpIHsKICAgICAgICAkc2NvcGUuYnVzaW5lc3NDYWxlbmRhckluaXRpYWxOYW1lID0gdHJ1ZTsKICAgICAgICBzaGFyZWREYXRhLnNldFNlbGVjdGVkRW5kVXNlcihudWxsKTsKICAgICAgICAkc2NvcGUuYnVzaW5lc3NDYWxlbmRhckluaXRpYWxzID0gewogICAgICAgICAgICBuYW1lOiBpbml0aWFsRW5kVXNlci5maXJzdF9uYW1lICsgIiAiICsgaW5pdGlhbEVuZFVzZXIubGFzdF9uYW1lCiAgICAgICAgfTsKICAgIH0gZWxzZSB7CiAgICAgICAgJHNjb3BlLmJ1c2luZXNzQ2FsZW5kYXJJbml0aWFsTmFtZSA9IGZhbHNlOwogICAgfQogICAgLyogY29uZmlnIG9iamVjdCAqLwogICAgJHNjb3BlLmNhbGVuZGFyX25hbWUgPSAiY2FsZW5kYXJfYnVzaW5lc3MiOwogICAgJHNjb3BlLmNhbGVuZGFyID0gImNhbGVuZGFyX2J1c2luZXNzIjsKICAgIC8qIGV2ZW50IHNvdXJjZXMgYXJyYXkqLwogICAgJHNjb3BlLmJ1c2luZXNzQ2FsZW5kYXJFdmVudFNvdXJjZXMgPSBbewogICAgICAgIHVybDogJy9hcGkvYWRtaW4vZXZlbnRzL2dldHBvc3QnLAogICAgICAgIHR5cGU6ICdQT1NUJwogICAgfSwgewogICAgICAgIHVybDogJy9hcGkvYWRtaW4vY2FsZW5kYXIvbGltaXRhdGlvbnMvYmFja2dyb3VuZC9nZXRwb3N0JywKICAgICAgICB0eXBlOiAnUE9TVCcKICAgIC8vIH0sIHsKICAgIC8vICAgICB1cmw6ICcvYXBpL2FkbWluL3JlY3VycmluZy9nZXRwb3N0JywKICAgIC8vICAgICB0eXBlOiAnUE9TVCcKICAgIH1dOwoKICAgICRzY29wZS5nb3RvVG9kYXkgPSBmdW5jdGlvbigpIHsKICAgICAgICAkc2NvcGUuZ290b0RhdGUobmV3IERhdGUoKSk7CiAgICAgICAgdmlzaWJsZURhdGVTdGFydCA9IG5ldyBEYXRlKHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3Jykuc3RhcnQpOwogICAgICAgIGRhdGVUb0dvVG8gPSB2aXNpYmxlRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCkgKyAiLSIgKyAoJzAnICsgKHZpc2libGVEYXRlU3RhcnQuZ2V0TW9udGgoKSArIDEpKS5zbGljZSgtMikgKyAiLSIgKyAoJzAnICsgdmlzaWJsZURhdGVTdGFydC5nZXREYXRlKCkpLnNsaWNlKC0yKTsKICAgICAgICBzaGFyZWRQcm9wZXJ0aWVzLnNldF9jYWxlbmRhcl9kYXRlKGRhdGVUb0dvVG8pOwogICAgICAgICRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0PXZpc2libGVEYXRlU3RhcnQ7CiAgICAgICAgJGxvY2F0aW9uLnNlYXJjaCgnc3RhcnQnLGRhdGVUb0dvVG8pOwogICAgfQoKICAgICRzY29wZS5pbnN0cnVjdG9yU2VsZWN0ZWQ9ZnVuY3Rpb24odGhpc3RoaXMpCiAgICB7CiAgICAgIHVwZGF0ZVN1Z2dlc3Rpb25zKCk7CiAgICB9CiAgICAkc2NvcGUuZXZlbnRUeXBlU2VsZWN0ZWQ9ZnVuY3Rpb24odGhpc3RoaXMpCiAgICB7CiAgICAgIHVwZGF0ZVN1Z2dlc3Rpb25zKCk7CiAgICB9CiAgICBmdW5jdGlvbiB1cGRhdGVTdWdnZXN0aW9ucygpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJmdW5jdGlvbjogdXBkYXRlU3VnZ2VzdGlvbnMiKTsKICAgICAgc2hhcmVkUHJvcGVydGllcy5zZXRfZXZlbnRfdHlwZV9mb3Jfc3VnZ2VzdGlvbnMoJHNjb3BlLnNlbGVjdGVkX2V2ZW50X3R5cGVfaWQpOwogICAgICBzaGFyZWRQcm9wZXJ0aWVzLnNldF9zZWxlY3RlZF9pbnN0cnVjdG9yKCRzY29wZS5zZWxlY3RlZF9idXNpbmVzc191c2VyX2lkKTsKICAgICAgZm9yIChpPTA7aTwkc2NvcGUuZXZlbnRfdHlwZXMubGVuZ3RoO2krKykKICAgICAgewogICAgICAgIC8vIGNvbnNvbGUubG9nKCRzY29wZS5ldmVudF90eXBlc1tpXS5ldmVudF90eXBlX2lkKTsKICAgICAgICBpZiAoJHNjb3BlLnNlbGVjdGVkX2V2ZW50X3R5cGVfaWQ9PSRzY29wZS5ldmVudF90eXBlc1tpXS5ldmVudF90eXBlX2lkKQogICAgICAgIHsKICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJmb3VuZCBldmVudCB0eXBlIGlkIik7CiAgICAgICAgICBpZiAoJHNjb3BlLmV2ZW50X3R5cGVzW2ldLmlzX2NsYXNzKSAvLyBpcyBjbGFzcwogICAgICAgICAgewogICAgICAgICAgICBsb2dEZWJ1ZygiJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXI9Iiskc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcik7CiAgICAgICAgICAgIGlmICgkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcikKICAgICAgICAgICAgewogICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJpcyBjbGFzcyBzdWdnZXN0aW9uZCIpOwogICAgICAgICAgICAgICRodHRwLmdldCgkZ0FwaVVSTFByZWZpeCArICIvZW5kdXNlci9ldmVudHMvc3VnZ2VzdGNsYXNzLyIrJHNjb3BlLnNlbGVjdGVkX2V2ZW50X3R5cGVfaWQrIi8iKyRzY29wZS5zZWxlY3RlZF9idXNpbmVzc191c2VyX2lkKyIvIiskc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpKyIvIisoJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0TW9udGgoKSsxKSsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0RGF0ZSgpKyIvIiskc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXRIb3VycygpICsgIi8iICsgJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0TWludXRlcygpICsgIi8iICsgJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJfaWQpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRfZXZlbnRfdHlwZV9pZF9pc19jbGFzcz10cnVlOwogICAgICAgICAgICAgICAgICAkc2NvcGUuZXZlbnRzU3VnZ2VzdGVkID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBjb25zb2xlLmxvZygibm90IGlzIGNsYXNzIHN1Z2dlc3Rpb25kIik7CiAgICAgICAgICAgICAgJGh0dHAuZ2V0KCRnQXBpVVJMUHJlZml4ICsgIi9lbmR1c2VyL2V2ZW50cy9zdWdnZXN0Y2xhc3MvIiskc2NvcGUuc2VsZWN0ZWRfZXZlbnRfdHlwZV9pZCsiLyIrJHNjb3BlLnNlbGVjdGVkX2J1c2luZXNzX3VzZXJfaWQrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCkrIi8iKygkc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpKzEpKyIvIiskc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXREYXRlKCkrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldEhvdXJzKCkgKyAiLyIgKyAkc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXRNaW51dGVzKCkgKyAiLzAiKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKQogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkX2V2ZW50X3R5cGVfaWRfaXNfY2xhc3M9dHJ1ZTsKICAgICAgICAgICAgICAgICAgJHNjb3BlLmV2ZW50c1N1Z2dlc3RlZCA9IHJlc3BvbnNlLmRhdGE7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGVsc2UgLy8gaXMgbm90IGNsYXNzCiAgICAgICAgICB7CiAgICAgICAgICAgICRodHRwLmdldCgkZ0FwaVVSTFByZWZpeCArICIvZW5kdXNlci9ldmVudHMvc3VnZ2VzdC8iKyRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkKyIvIiskc2NvcGUuc2VsZWN0ZWRfYnVzaW5lc3NfdXNlcl9pZCsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSsiLyIrKCRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkrMSkrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0SG91cnMoKSArICIvIiArICRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkX2V2ZW50X3R5cGVfaWRfaXNfY2xhc3M9ZmFsc2U7CiAgICAgICAgICAgICAgICAkc2NvcGUuZXZlbnRzU3VnZ2VzdGVkID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgJHNjb3BlLmdvdG9OZXh0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlbW92ZUV2ZW50cycpOwogICAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCduZXh0Jyk7CiAgICAgICAgJHNjb3BlLnVwZGF0ZUNhbGVuZGFyQ2VudGVyVGl0bGUoKTsKICAgICAgICAvLyBhZGRpbmcgdGhlIGZvbGxvd2luZyB0byBtYWtlIHRoZSB1cmwKICAgICAgICAvLyBwb2ludCB0byB0aGUgcmlnaHQgd2VlaywgaWYgZ29pbmcgdG8gYSBkaWZmZXJlbnQgVVJMIGFuZCB0aGVuIGdvaW5nIGJhY2sKICAgICAgICB2aXNpYmxlRGF0ZVN0YXJ0ID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5zdGFydCk7CiAgICAgICAgZGF0ZVRvR29UbyA9IHZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSArICItIiArICgnMCcgKyAodmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpICsgMSkpLnNsaWNlKC0yKSArICItIiArICgnMCcgKyB2aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSkuc2xpY2UoLTIpOwogICAgICAgIHNoYXJlZFByb3BlcnRpZXMuc2V0X2NhbGVuZGFyX2RhdGUoZGF0ZVRvR29Ubyk7CiAgICAgICAgJHNjb3BlLnZpc2libGVEYXRlU3RhcnQ9dmlzaWJsZURhdGVTdGFydDsKICAgICAgICAkbG9jYXRpb24uc2VhcmNoKCdzdGFydCcsZGF0ZVRvR29Ubyk7CiAgICB9CiAgICAkc2NvcGUuZ290b1ByZXYgPSBmdW5jdGlvbigpIHsKICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVtb3ZlRXZlbnRzJyk7CiAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3ByZXYnKTsKICAgICAgICAkc2NvcGUudXBkYXRlQ2FsZW5kYXJDZW50ZXJUaXRsZSgpOwogICAgICAgIC8vIGFkZGluZyB0aGUgZm9sbG93aW5nIHRvIG1ha2UgdGhlIHVybAogICAgICAgIC8vIHBvaW50IHRvIHRoZSByaWdodCB3ZWVrLCBpZiBnb2luZyB0byBhIGRpZmZlcmVudCBVUkwgYW5kIHRoZW4gZ29pbmcgYmFjawogICAgICAgIHZpc2libGVEYXRlU3RhcnQgPSBuZXcgRGF0ZSh1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ2V0VmlldycpLnN0YXJ0KTsKICAgICAgICBkYXRlVG9Hb1RvID0gdmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpICsgIi0iICsgKCcwJyArICh2aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkgKyAxKSkuc2xpY2UoLTIpICsgIi0iICsgKCcwJyArIHZpc2libGVEYXRlU3RhcnQuZ2V0RGF0ZSgpKS5zbGljZSgtMik7CiAgICAgICAgc2hhcmVkUHJvcGVydGllcy5zZXRfY2FsZW5kYXJfZGF0ZShkYXRlVG9Hb1RvKTsKICAgICAgICAkc2NvcGUudmlzaWJsZURhdGVTdGFydD12aXNpYmxlRGF0ZVN0YXJ0OwogICAgICAgICRsb2NhdGlvbi5zZWFyY2goJ3N0YXJ0JyxkYXRlVG9Hb1RvKTsKCiAgICB9CiAgICAkc2NvcGUuZ290b0RhdGUgPSBmdW5jdGlvbihuZXdkYXRlKSB7CiAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dvdG9EYXRlJywgbmV3ZGF0ZSk7CiAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlbW92ZUV2ZW50cycpOwogICAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZWZldGNoRXZlbnRzJyk7CiAgICAgICAgJHNjb3BlLnVwZGF0ZUNhbGVuZGFyQ2VudGVyVGl0bGUoKTsKICAgIH0KCiAgICAkc2NvcGUuZWRpdEhvdXJzT2ZXb3JrID0gZnVuY3Rpb24oKSB7CiAgICAgICAgLy8gcGFyYW0gc2hvdWxkIGxvb2sgbGlrZSAiMjAxNi0wNy0wMSIKICAgICAgICB2aXNpYmxlRGF0ZVN0YXJ0ID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5zdGFydCk7CiAgICAgICAgZGF0ZVRvR29UbyA9IHZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSArICItIiArICgnMCcgKyAodmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpICsgMSkpLnNsaWNlKC0yKSArICItIiArICgnMCcgKyB2aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSkuc2xpY2UoLTIpOwogICAgICAgICRsb2NhdGlvbi5wYXRoKCcvaG91cnNfb2Zfd29yaycpLnNlYXJjaCh7CiAgICAgICAgICAgIHN0YXJ0OiBkYXRlVG9Hb1RvCiAgICAgICAgfSk7CiAgICB9OwoKICAgICRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKTsKCiAgICAgICAgdmlzaWJsZURhdGVTdGFydCA9IG5ldyBEYXRlKHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3Jykuc3RhcnQpOwogICAgICAgIHZpc2libGVEYXRlRW5kID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5lbmQpOwoKICAgICAgICAkc2NvcGUuY2FsZW5kYXJUaXRsZUNlbnRlciA9IHZpc2libGVEYXRlU3RhcnQuZ2V0RGF0ZSgpICsgIiAiICsgbW9udGhOYW1lc1t2aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCldICsKICAgICAgICAgICAgIiDigJQgIiArIHZpc2libGVEYXRlRW5kLmdldERhdGUoKSArICIgIiArIG1vbnRoTmFtZXNbdmlzaWJsZURhdGVFbmQuZ2V0TW9udGgoKV0gKwogICAgICAgICAgICAiICIgKyB2aXNpYmxlRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCk7CiAgICB9OwoKICAgICRzY29wZS5zaG93RXZlbnRQb3B1cCA9IGZ1bmN0aW9uKHNlbGVjdGVkRXZlbnQpIHsKICAgICAgICBzaG93RXZlbnRQb3B1cChzZWxlY3RlZEV2ZW50LCAkdWliTW9kYWwpCiAgICB9OwoKICAgICRzY29wZS5ldmVudENyZWF0ZU1vZGFsRnJvbVNjaGVkdWxlciA9IGZ1bmN0aW9uKGVzdWdnZXN0KQogICAgewogICAgICAvLyBpZiBjbGFzcyAtIGdvIHRvIGV2ZW50IGNsYXNzCiAgICAgIGNvbnNvbGUubG9nKGVzdWdnZXN0KTsKICAgICAgZm9yIChpPTA7aTwkc2NvcGUuZXZlbnRfdHlwZXMubGVuZ3RoO2krKykKICAgICAgewogICAgICAgIGlmIChlc3VnZ2VzdC5ldmVudF90eXBlX2lkPT0kc2NvcGUuZXZlbnRfdHlwZXNbaV0uZXZlbnRfdHlwZV9pZCkKICAgICAgICB7CiAgICAgICAgICBpZiAoJHNjb3BlLmV2ZW50X3R5cGVzW2ldLmlzX2NsYXNzKQogICAgICAgICAgewogICAgICAgICAgICBjb25zb2xlLmxvZygiaXMgY2xhc3MiKTsKICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWY9Jy8jL2V2ZW50X2NsYXNzLycgKyBlc3VnZ2VzdC5ldmVudF9pZDsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBsb2dEZWJ1ZyhKU09OLnN0cmluZ2lmeShlc3VnZ2VzdCkpOwogICAgICBsb2dEZWJ1Zyhlc3VnZ2VzdC5zdGFydF9lcG9jaCk7CiAgICAgIHN0YXJ0RGF0ZT1lc3VnZ2VzdC5zdGFydF9lcG9jaCoxMDAwOwoKICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgICAgICAgICBhbmltYXRpb246IGZhbHNlLAogICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfZXZlbnRfY3JlYXRlLnBocCcsCiAgICAgICAgICBjb250cm9sbGVyOiAnZXZlbnRDcmVhdGVNb2RhbENvbnRyb2xsZXInLAogICAgICAgICAgc2l6ZTogJ2wnLAogICAgICAgICAgcmVzb2x2ZTogewogICAgICAgICAgICAgIHN0YXJ0RGF0ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBzdGFydERhdGU7CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBldmVudF90eXBlX2lkOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuICRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkOwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgbG9jYXRpb25faWQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gZXN1Z2dlc3QubG9jYXRpb25faWQ7CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBlbXBfaWQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gZXN1Z2dlc3QuZW1wX2lkOwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgcmVzY2hlZHVsZV9ldmVudDogZnVuY3Rpb24oKQogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGlmICgkc2NvcGUucHJldmlvdXNfZXZlbnRfcmVzY2hlZHVsZSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuICRzY29wZS5wcmV2aW91c19ldmVudF9yZXNjaGVkdWxlX2V2ZW50OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CgogICAgICAgICAgfQogICAgICB9KTsKCiAgICB9CiAgICAkc2NvcGUuZXZlbnRDcmVhdGVNb2RhbCA9IGZ1bmN0aW9uKHN0YXJ0RGF0ZSwgc2l6ZSkgewogICAgICAgIGxvZ0RlYnVnKCJldmVudCBjcmVhdGUgbW9kYWwgc3RhcnREYXRlPSIrc3RhcnREYXRlKTsKCiAgICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgICAgICAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2V2ZW50X2NyZWF0ZS5waHAnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnZXZlbnRDcmVhdGVNb2RhbENvbnRyb2xsZXInLAogICAgICAgICAgICBzaXplOiBzaXplLAogICAgICAgICAgICByZXNvbHZlOiB7CiAgICAgICAgICAgICAgICBzdGFydERhdGU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBzdGFydERhdGU7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZXZlbnRfdHlwZV9pZDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbG9jYXRpb25faWQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGVtcF9pZDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgcmVzY2hlZHVsZV9ldmVudDogZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGUpCiAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGVfZXZlbnQ7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICAgIH0gICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBtb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHNlbGVjdGVkSXRlbSkgewogICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWQgPSBzZWxlY3RlZEl0ZW07CiAgICAgICAgfSwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGxvZ0RlYnVnKCdNb2RhbCBkaXNtaXNzZWQgYXQ6ICcgKyBuZXcgRGF0ZSgpKTsKICAgICAgICB9KTsKICAgIH07CgogICAgLy8vCiAgICAkc2NvcGUudXBkYXRlRXZlbnREYXRhYmFzZSA9IGZ1bmN0aW9uKHN0YXJ0X3BhcmFtLCBlbmRfcGFyYW0sIGV2ZW50X2lkLCB0aGVldmVudCkKICAgIHsKCiAgICAgICAgbG9nRGVidWcoInVwZGF0ZUV2ZW50RGF0YWJhc2Ugc3RhcnQ9IiArIHN0YXJ0X3BhcmFtICsgIiwgZW5kPSIgKyBlbmRfcGFyYW0gKyAiLCBldmVudF9pZD0iICsgZXZlbnRfaWQpOwogICAgICAgIHRoZXVybCA9ICcvYXBpL2FkbWluL2V2ZW50cy9zZXQvJyArIGV2ZW50X2lkOwoKICAgICAgICAkaHR0cCh7CiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLAogICAgICAgICAgICB1cmw6IHRoZXVybCwKICAgICAgICAgICAgZGF0YTogewogICAgICAgICAgICAgICAgc3RhcnRfZGF0ZTogc3RhcnRfcGFyYW0sCiAgICAgICAgICAgICAgICBlbmRfZGF0ZTogZW5kX3BhcmFtLAogICAgICAgICAgICAgICAgZXZlbnRfaWQ6IGV2ZW50X2lkCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbjtjaGFyc2V0PXV0Zi04JwogICAgICAgICAgICB9CiAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7CgogICAgICAgICAgICBsb2dEZWJ1ZyhkYXRhKTsKICAgICAgICAgICAgaWYgKGRhdGEuRXJyb3IpIHsKICAgICAgICAgICAgICAgIGxvZ0RlYnVnKCJlcnJvciAiICsgZGF0YS5NZXNzYWdlKTsKICAgICAgICAgICAgICAgIGFsZXJ0KCdlcnJvcicpOwogICAgICAgICAgICAgICAgY2FsZW5kYXIgPSAiY2FsZW5kYXJfYnVzaW5lc3MiOwogICAgICAgICAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbG9nRGVidWcoInN1Y2Nlc3MiKTsKICAgICAgICAgICAgICAgIGNhbGVuZGFyID0gImNhbGVuZGFyX2J1c2luZXNzIjsKICAgICAgICAgICAgICAgIC8vIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKICAgICAgICAgICAgICAgIC8vICR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoJ2FkZGVkIGFuZCByZWZldGNoRXZlbnRzJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICB9OwogICAgLy8vCgogICAgJHNjb3BlLmNsYXNzRXZlbnRBZGRVc2VyID0gZnVuY3Rpb24oZXN1Z2dlc3QpCiAgICB7CiAgICAgIGNvbnNvbGUubG9nKCJjbGFzc0V2ZW50QWRkVXNlciBvciBSZW1vdmUiKTsKICAgICAgaWYgKChlc3VnZ2VzdC5pc19yZWdpc3RlcmVkPT0xKSB8ICgoZXN1Z2dlc3QuaXNfd2FpdGluZ2xpc3Q9PTEpICYmIChlc3VnZ2VzdC5pc19jYW5jZWxlZD09MCkpKQogICAgICB7CiAgICAgICAgY29uc29sZS5sb2coIm5lZWQgdG8gdW5yZWdpc3RlciIpOwogICAgICAgIHJlbW92ZUVuZFVzZXJGcm9tRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyX2lkLGVzdWdnZXN0LmV2ZW50X2lkLHJlbW92ZUVuZFVzZXJGcm9tRXZlbnRfY2FsbGJhY2ssIHJlbW92ZUVuZFVzZXJGcm9tRXZlbnRfY2FsbGJhY2spOwogICAgICAgIGZ1bmN0aW9uIHJlbW92ZUVuZFVzZXJGcm9tRXZlbnRfY2FsbGJhY2soKQogICAgICAgIHsKICAgICAgICAgICRzY29wZS5ldmVudFR5cGVTZWxlY3RlZCgpOwogICAgICAgICAgY2FsZW5kYXIgPSAiY2FsZW5kYXJfYnVzaW5lc3MiOwogICAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwoKICAgICAgICB9CiAgICAgIH0KICAgICAgZWxzZQogICAgICB7CiAgICAgICAgLy8gY29uc29sZS5sb2coZXN1Z2dlc3QuZXZlbnRfaWQpOwogICAgICAgIC8vIGNvbnNvbGUubG9nKCRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyX2lkKTsKICAgICAgICAvLyBpZiBzZWxlY3RlZCB1c2VyIC0gYWRkaW5nIGhpbS9oZXIgdG8gY2xhc3MKICAgICAgICBpZiAoJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXIpCiAgICAgICAgewogICAgICAgICAgYWRkRW5kVXNlclRvRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyX2lkLGVzdWdnZXN0LmV2ZW50X2lkLGFkZEVuZFVzZXJUb0V2ZW50X2NhbGxiYWNrLCBhZGRFbmRVc2VyVG9FdmVudF9jYWxsYmFjayk7CiAgICAgICAgICBmdW5jdGlvbiBhZGRFbmRVc2VyVG9FdmVudF9jYWxsYmFjaygpCiAgICAgICAgICB7CiAgICAgICAgICAgIGNhbGVuZGFyID0gImNhbGVuZGFyX2J1c2luZXNzIjsKICAgICAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwogICAgICAgICAgICAkc2NvcGUuZXZlbnRUeXBlU2VsZWN0ZWQoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZSAvLyBlbHNlIC0gZ29pbmcgdG8gY2xhc3MgcGFnZQogICAgICAgIHsKICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmPScvIy9ldmVudF9jbGFzcy8nICsgZXN1Z2dlc3QuZXZlbnRfaWQ7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAkc2NvcGUuY2FsZW5kYXJfYnVzaW5lc3NfY29uZmlnID0gewogICAgICAgIGNhbGVuZGFyOiB7CiAgICAgICAgICAgIGhlaWdodDogJ2F1dG8nLAogICAgICAgICAgICBlZGl0YWJsZTogdHJ1ZSwKICAgICAgICAgICAgLy8gaGVhZGVyOiB7CiAgICAgICAgICAgIC8vICAgICBsZWZ0OiAnJywKICAgICAgICAgICAgLy8gICAgIGNlbnRlcjogJycsCiAgICAgICAgICAgIC8vICAgICByaWdodDogJycKICAgICAgICAgICAgLy8gfSwKICAgICAgICAgICAgLy8gaGVhZGVyOiB7CiAgICAgICAgICAgIC8vICAgICBsZWZ0OiAndGl0bGUnLAogICAgICAgICAgICAvLyAgICAgY2VudGVyOiAnJywKICAgICAgICAgICAgLy8gICAgIHJpZ2h0OiAndG9kYXkgcHJldixuZXh0JwogICAgICAgICAgICAvLyB9LAogICAgICAgICAgICB0aXRsZUZvcm1hdDogewogICAgICAgICAgICAgICAgLy8gd2VlazogICJkIFtNTU1deyAnJiM4MjExOycgZCBNTU19IgogICAgICAgICAgICB9LAogICAgICAgICAgICAvLyB0aXRsZUZvcm1hdDogewogICAgICAgICAgICAvLyAgICAgbW9udGg6ICdNTU1NIHl5eXknLAogICAgICAgICAgICAvLyAgICAgd2VlazogIk1NTSBkWyB5eXl5XXsgJyYjODIxMjsnWyBNTU1dIGQgeXl5eX0iLAogICAgICAgICAgICAvLyAgICAgZGF5OiAnTU0vZGQnCiAgICAgICAgICAgIC8vIH0sCiAgICAgICAgICAgIGhlYWRlcjogJycsCiAgICAgICAgICAgIC8vIGRlZmF1bHRWaWV3OiAnYWdlbmRhV2VlaycsCiAgICAgICAgICAgIC8vIHZpZXdzOiB7CiAgICAgICAgICAgIC8vICAgICBkb250U2hvd0RhdGU6IHsKICAgICAgICAgICAgLy8gICAgICAgICB0eXBlOiAnYWdlbmRhV2VlaycsCiAgICAgICAgICAgIC8vICAgICAgICAgZHVyYXRpb246IHsKICAgICAgICAgICAgLy8gICAgICAgICAgICAgZGF5czogNwogICAgICAgICAgICAvLyAgICAgICAgIH0sCiAgICAgICAgICAgIC8vICAgICAgICAgdGl0bGU6ICdBcGVydHVyYScsCiAgICAgICAgICAgIC8vICAgICAgICAgY29sdW1uRm9ybWF0OiAnZGRkZCcgLy8gRm9ybWF0IHRoZSBkYXkgdG8gb25seSBzaG93IGxpa2UgJ01vbmRheScKICAgICAgICAgICAgLy8gICAgICAgICAgICAgLy8gaGlkZGVuRGF5czogWzAsIDZdIC8vIEhpZGUgU3VuZGF5IGFuZCBTYXR1cmRheT8KICAgICAgICAgICAgLy8gICAgIH0KICAgICAgICAgICAgLy8gfSwKICAgICAgICAgICAgLy8gc2xvdER1cmF0aW9uOiAnMDA6MTU6MDAnLAogICAgICAgICAgICBldmVudERyb3A6IGZ1bmN0aW9uKGV2ZW50LCBkYXlEZWx0YSwgbWludXRlRGVsdGEsIGFsbERheSwgcmV2ZXJ0RnVuYywgdWlDYWxlbmRhckNvbmZpZykgewogICAgICAgICAgICAgICAgbG9nRGVidWcoImV2ZW50IGRyb3AiICsgZXZlbnQudGl0bGUgKyAiKCIgKyBldmVudC5pZCArICIpIG1vdmVkICIgKyBtaW51dGVEZWx0YSArICIgbWludXRlcyIpOwogICAgICAgICAgICAgICAgbG9nRGVidWcoIm9sZCBzdGFydD0iICsgZXZlbnQuc3RhcnQgKyAiLCBvbGQgZW5kPSIgKyBldmVudC5lbmQpOwogICAgICAgICAgICAgICAgJHNjb3BlLnVwZGF0ZUV2ZW50RGF0YWJhc2UoZXZlbnQuc3RhcnQsIGV2ZW50LmVuZCwgZXZlbnQuaWQsIGV2ZW50KTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZXZlbnRSZXNpemU6IGZ1bmN0aW9uKGV2ZW50LCBkZWx0YSwgcmV2ZXJ0RnVuYykgewogICAgICAgICAgICAgIGxvZ0RlYnVnKCJldmVudCByZXNpemUiICsgZXZlbnQudGl0bGUgKyAiKCIgKyBldmVudC5pZCArICIpIG1vdmVkICIpOwogICAgICAgICAgICAgIGxvZ0RlYnVnKCJvbGQgc3RhcnQ9IiArIGV2ZW50LnN0YXJ0ICsgIiwgb2xkIGVuZD0iICsgZXZlbnQuZW5kKTsKICAgICAgICAgICAgICAkc2NvcGUudXBkYXRlRXZlbnREYXRhYmFzZShldmVudC5zdGFydCwgZXZlbnQuZW5kLCBldmVudC5pZCwgZXZlbnQpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBkZWZhdWx0VmlldzogJ2FnZW5kYVdlZWsnLAogICAgICAgICAgICBldmVudFN0YXJ0RWRpdGFibGU6ZmFsc2UsCiAgICAgICAgICAgIGV2ZW50RHVyYXRpb25FZGl0YWJsZTpmYWxzZSwKICAgICAgICAgICAgZGVmYXVsdERhdGU6IG1vbWVudChjdXJyRGVmYXVsdERhdGUpLAoKICAgICAgICAgICAgLy8gZGVmYXVsdFZpZXc6ICdkb250U2hvd0RhdGUnLAogICAgICAgICAgICBldmVudENsaWNrOiBmdW5jdGlvbihjYWxFdmVudCwganNFdmVudCwgdmlldykgewogICAgICAgICAgICAgICAgbG9nRGVidWcoImNhbGVuZGFyIGV2ZW50IGNsaWNrZWQgIiArIGNhbEV2ZW50LnRpdGxlICsgIigiICsgY2FsRXZlbnQuaWQgKyAiKSAiICsgY2FsRXZlbnQuc3RhcnQgKyAiICIgKyBjYWxFdmVudC5lbmQpOwogICAgICAgICAgICAgICAgLy8gbG9nRGVidWcoSlNPTi5zdHJpbmdpZnkoY2FsRXZlbnQpKTsKICAgICAgICAgICAgICAgIC8vIGlmIGl0J3MgYSBnZW5lcmljIGV2ZW50ICh2YWNhdGlvbiBldGMpCiAgICAgICAgICAgICAgICAvLyBzaG93IHBvcHVwIHdpdGggb3B0aW9uIHRvIGRlbGV0ZQogICAgICAgICAgICAgICAgaWYgKGNhbEV2ZW50LmlzX2dlbmVyaWNfZXR5cGU9PTEpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIC8vICRzY29wZS5zaG93R2VuZXJpY0V2ZW50KGNhbEV2ZW50KTsKICAgICAgICAgICAgICAgICAgJHNjb3BlLnNob3dFdmVudFBvcHVwKGNhbEV2ZW50KTsKCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICRzY29wZS5zaG93RXZlbnRQb3B1cChjYWxFdmVudCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBjaGFuZ2UgdGhlIGJvcmRlciBjb2xvciBqdXN0IGZvciBmdW4KICAgICAgICAgICAgICAgIC8vICQodGhpcykuY3NzKCdib3JkZXItY29sb3InLCAncmVkJyk7CgogICAgICAgICAgICB9LAogICAgICAgICAgICBkYXlDbGljazogZnVuY3Rpb24oZGF0ZSwganNFdmVudCwgdmlldykgewogICAgICAgICAgICAgICAgLy8gbG9nRGVidWcoIm5ldyBldmVudCBjcmVhdGlvbiBjbGlja2VkICIgKyBjYWxFdmVudC50aXRsZSArICIoIiArIGNhbEV2ZW50LmlkICsgIikgIiArIGNhbEV2ZW50LnN0YXJ0ICsgIiAiICsgY2FsRXZlbnQuZW5kKTsKICAgICAgICAgICAgICAgIC8vICAgICBzdGFydCA9IGRhdGU7CiAgICAgICAgICAgICAgICAvLyAgICAgZW5kID0gbW9tZW50KHN0YXJ0KS5hZGQoNDUsICdtaW51dGVzJyk7CiAgICAgICAgICAgICAgICBpZiAodmlldy5uYW1lID09PSAibW9udGgiKSB7CiAgICAgICAgICAgICAgICAgICAgY2FsZW5kYXIgPSAiY2FsZW5kYXJfYnVzaW5lc3MiOwogICAgICAgICAgICAgICAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2NoYW5nZVZpZXcnLCAiYWdlbmRhV2VlayIpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZXZlbnRDcmVhdGVNb2RhbChkYXRlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vIGNoYW5nZSB0aGUgYm9yZGVyIGNvbG9yIGp1c3QgZm9yIGZ1bgogICAgICAgICAgICAgICAgLy8gJCh0aGlzKS5jc3MoJ2JvcmRlci1jb2xvcicsICdyZWQnKTsKCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGV2ZW50UmVuZGVyOiBmdW5jdGlvbihldmVudCwgZWxlbWVudCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaWYgKCFldmVudC5ldmVudF9pZD4wKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAvLyBub3QgYSByZWFsIGV2ZW50IC0gcHJvYmFibHkgYmxvY2sgLyBiYWNrZ3JvdW5kCiAgICAgICAgICAgICAgICAgIC8vIGlnbm9yaW5nIGl0CiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vIGNoYW5naW5nIGxvb2sgYW5kIGZlZWwgb2YgZXZlbiB0aGF0IGlzIHRvIHJlc2NoZWR1bGUKICAgICAgICAgICAgICAgIGlmIChzaGFyZWRQcm9wZXJ0aWVzLmdldF9ldmVudF9yZXNjaGVkdWxlKCkhPW51bGwpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIGlmIChldmVudC5ldmVudF9pZD09c2hhcmVkUHJvcGVydGllcy5nZXRfZXZlbnRfcmVzY2hlZHVsZSgpLmV2ZW50X2lkKQogICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5jc3MoJ2JhY2tncm91bmQtY29sb3InLCAnI0E5QTlBOQknKTsKICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmNzcygnYm9yZGVyLWNvbG9yJywgJyNBOUE5QTkJJyk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoZXZlbnQuaXNfY2xhc3M9PTEpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIC8vIGlmIGNsYXNzIGFkZGluZyBudW1iZXIgb2YgcGFydGljaXBhbnRzCiAgICAgICAgICAgICAgICAgIGlmIChldmVudC5ub19vZl93YWl0aW5nX3VzZXJzPjApCiAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmZpbmQoJy5mYy10aXRsZScpLnByZXBlbmQoZXZlbnQubm9fb2ZfdXNlcnMrIi8iK2V2ZW50Lm1heF9wYXJ0aWNpcGFudHMrICIgKCIrZXZlbnQubm9fb2Zfd2FpdGluZ191c2VycysiKSIrIiAtICIpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZChldmVudC5ub19vZl91c2VycysiLyIrZXZlbnQubWF4X3BhcnRpY2lwYW50cysiIC0gIik7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgLy8gaWYgbm90IGNsYXNzIC0gd3JpdGluZyB0aGUgZW5kdXNlciBuYW1lCiAgICAgICAgICAgICAgICAgIGlmIChldmVudC5kdXJhdGlvbl9ldmVudCE9MCkgLy8gYWxzbyBpZiBub3QgaG91cnMgb2Ygd29yawogICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgLy8gZWxlbWVudC5maW5kKCcuZmMtdGl0bGUnKS5hcHBlbmQoIiAoIitldmVudC5ldmVudFVzZXJzWzBdLmJ1c2VyX2ZpcnN0X25hbWUrIiAiK2V2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfbGFzdF9uYW1lKyIpIik7CiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coZXZlbnQuZXZlbnRVc2Vycyk7CiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coZXZlbnQuZXZlbnRVc2Vycy5sZW5ndGgpOwogICAgICAgICAgICAgICAgICAgIGlmIChldmVudC5ldmVudFVzZXJzLmxlbmd0aD4wKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZCgiIitldmVudC5ldmVudFVzZXJzWzBdLmJ1c2VyX2ZpcnN0X25hbWUrIiAiK2V2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfbGFzdF9uYW1lKyIgKCIpOwogICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5maW5kKCcuZmMtdGl0bGUnKS5hcHBlbmQoIikiKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgLy8gbG9nRGVidWcoImhlcmU0Iik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoZXZlbnQuaXNfcmVwZWF0aW5nID09IDEpIHsKICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmZpbmQoIi5mYy10aXRsZSIpLmFwcGVuZCgiJm5ic3A7PGkgY2xhc3M9J2ZhIGZhLXJlcGVhdCc+PC9pPiZuYnNwOyIpOwogICAgICAgICAgICAgICAgICAgIC8vICBlbGVtZW50LmZpbmQoIi5mYy10aXRsZSIpLmFwcGVuZCgiJm5ic3A7PGltZyBzcmM9Jy9wdWJsaWMvaW1hZ2VzL3JlY3VycmluZy1pY29uLnBuZycgd2lkdGg9JzEwcHgnIGhlaWdodD0nMTBweCcvPiIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBtaW5UaW1lOiAkZ0NhbGVuZGFyRGlzcGxheU1pblRpbWUsCiAgICAgICAgICAgIG1heFRpbWU6ICRnQ2FsZW5kYXJEaXNwbGF5TWF4VGltZSwKICAgICAgICAgICAgc2VsZWN0YWJsZTogZmFsc2UsCiAgICAgICAgICAgIHNlbGVjdEhlbHBlcjogZmFsc2UsCiAgICAgICAgICAgIHRpbWV6b25lOiBmYWxzZSwKICAgICAgICAgICAgaXNSVEw6IHRydWUsCiAgICAgICAgICAgIGxhbmc6ICJoZSIsIC8vIGtrCiAgICAgICAgICAgIGFsbERheVNsb3Q6IGZhbHNlLAogICAgICAgICAgICBsb2FkaW5nOiBmdW5jdGlvbihib29sKSB7CiAgICAgICAgICAgICAgICBpZiAoYm9vbCkgewogICAgICAgICAgICAgICAgICAgIGxvZ0RlYnVnKCdsb2FkaW5nIGNhbGVuZGFyICcgKyAkc2NvcGUuY2FsZW5kYXIpOwogICAgICAgICAgICAgICAgICAgIC8vICQoJyNsb2FkaW5nJykuc2hvdygpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvLyAkKCcjbG9hZGluZycpLmhpZGUoKTsKICAgICAgICAgICAgICAgICAgICBsb2dEZWJ1ZygnZmluaXNoZWQgbG9hZGluZyBjYWxlbmRhciB4JyArICRzY29wZS5jYWxlbmRhcik7CiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnVwZGF0ZUNhbGVuZGFyQ2VudGVyVGl0bGUoKTsKICAgICAgICAgICAgICAgICAgICBsb2dEZWJ1ZygiYWZ0ZXIgY2FsZW5kYXIgbG9hZCB2aXNpYmxlRGF0ZVN0YXJ0PSIrdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5zdGFydCk7CiAgICAgICAgICAgICAgICAgICAgdmlzaWJsZURhdGVTdGFydCA9IG5ldyBEYXRlKHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3Jykuc3RhcnQpOwogICAgICAgICAgICAgICAgICAgIGRhdGVUb0dvVG8gPSB2aXNpYmxlRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCkgKyAiLSIgKyAoJzAnICsgKHZpc2libGVEYXRlU3RhcnQuZ2V0TW9udGgoKSArIDEpKS5zbGljZSgtMikgKyAiLSIgKyAoJzAnICsgdmlzaWJsZURhdGVTdGFydC5nZXREYXRlKCkpLnNsaWNlKC0yKTsKICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygiZGF0ZVRvR29UbyIrZGF0ZVRvR29Ubyk7CiAgICAgICAgICAgICAgICAgICAgLy8gJGh0dHAuZ2V0KCRnQXBpVVJMUHJlZml4ICsgIi9lbmR1c2VyL2V2ZW50cy9zdWdnZXN0LyIrdmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpKyIvIit0aGlzX3dlZWtfZnVsbF95ZWFyKyIvIit0aGlzX3dlZWtfbW9udGgrIi8iK3RoaXNfd2Vla19kYXlfb2ZfbW9udGgrIi8iKyB0aGlzX3dlZWtfaG91cnMrICIvIiArIHRoaXNfd2Vla19taW51dGVzKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKQogICAgICAgICAgICAgICAgICAgICRzY29wZS5ldmVudF90eXBlX2lkPSRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkOwogICAgICAgICAgICAgICAgICAgICRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0PXZpc2libGVEYXRlU3RhcnQ7CiAgICAgICAgICAgICAgICAgICAgLy8xMjEyMTIKICAgICAgICAgICAgICAgICAgICAvLyBpZiAoJHNjb3BlLnNlbGVjdGVkX2V2ZW50X3R5cGVfaWRfaXNfY2xhc3MpCiAgICAgICAgICAgICAgICAgICAgLy8gewogICAgICAgICAgICAgICAgICAgIC8vICAgJGh0dHAuZ2V0KCRnQXBpVVJMUHJlZml4ICsgIi9lbmR1c2VyL2V2ZW50cy9zdWdnZXN0Y2xhc3MvIiskc2NvcGUuZXZlbnRfdHlwZV9pZCsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSsiLyIrKCRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkrMSkrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0SG91cnMoKSArICIvIiArICRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKSsgIi8iICsgJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJfaWQpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpCiAgICAgICAgICAgICAgICAgICAgLy8gICB7CiAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgLy8JICAgICRzY29wZS5teURhdGEgPSByZXNwb25zZS5kYXRhOwogICAgICAgICAgICAgICAgICAgIC8vICAgICAgIC8vCQlsb2dEZWJ1ZygiZ3JpZG9wdGlvbnM9Iiskc2NvcGUuZ3JpZE9wdGlvbnMpOwogICAgICAgICAgICAgICAgICAgIC8vICAgICAgICRzY29wZS5ldmVudHNTdWdnZXN0ZWQgPSByZXNwb25zZS5kYXRhOwogICAgICAgICAgICAgICAgICAgIC8vICAgICAgIC8vICRzY29wZS5kYXRlVG9Hb1RvPWRhdGVUb0dvVG87CiAgICAgICAgICAgICAgICAgICAgLy8gICB9KTsKICAgICAgICAgICAgICAgICAgICAvLyB9CiAgICAgICAgICAgICAgICAgICAgLy8gZWxzZQogICAgICAgICAgICAgICAgICAgIC8vIHsKICAgICAgICAgICAgICAgICAgICAvLyAgICRodHRwLmdldCgkZ0FwaVVSTFByZWZpeCArICIvZW5kdXNlci9ldmVudHMvc3VnZ2VzdC8iKyRzY29wZS5ldmVudF90eXBlX2lkKyIvIiskc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpKyIvIisoJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0TW9udGgoKSsxKSsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0RGF0ZSgpKyIvIiskc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXRIb3VycygpICsgIi8iICsgJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0TWludXRlcygpKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKQogICAgICAgICAgICAgICAgICAgIC8vICAgewogICAgICAgICAgICAgICAgICAgIC8vICAgICAgIC8vCSAgICAkc2NvcGUubXlEYXRhID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAvLwkJbG9nRGVidWcoImdyaWRvcHRpb25zPSIrJHNjb3BlLmdyaWRPcHRpb25zKTsKICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAkc2NvcGUuZXZlbnRzU3VnZ2VzdGVkID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAvLyAkc2NvcGUuZGF0ZVRvR29Ubz1kYXRlVG9Hb1RvOwogICAgICAgICAgICAgICAgICAgIC8vICAgfSk7CiAgICAgICAgICAgICAgICAgICAgLy8gfQoKICAgICAgICAgICAgICAgICAgICAvLyBhZnRlciBjYWxlbmRhciBpcyBsb2FkZWQgLSBsb2FkaW5nIGV2ZW50IHR5cGVzIGFuZCBzdWdnZXN0aW9uIGZvciBxdWV1ZXMKICAgICAgICAgICAgICAgICAgICAvLyB3ZSBoYW5kbGUgdGhpbmdzIHJlbGF0ZWQgdG8gdGhlIGV2ZW50IHR5cGVzIG9ubHkgYWZ0ZXIgbG9hZGluZyB0aGVtIChhbmQgdGhlIGNhbGVuZGFyKQogICAgICAgICAgICAgICAgICAgIGdldEFsbEJ1c2luZXNzRXZlbnRUeXBlc05vU3lzdGVtKCRodHRwLCRzY29wZSwnZXZlbnRfdHlwZXMnLGdldEFsbEJ1c2luZXNzRXZlbnRUeXBlc05vU3lzdGVtX2NhbGxiYWNrKTsKCiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzTm9TeXN0ZW1fY2FsbGJhY2soKQogICAgICAgICAgICAgICAgICAgIHsgICAgLy8gY2hlY2tpbmcgaWYgY2FsZW5kYXIgc2hvdWxkIHN0YXJ0IHdpdGggYSBzcGVjaWZpYyBldmVudCB0eXBlIGZvciBzdWdnZXN0aW9ucwogICAgICAgICAgICAgICAgICAgICAgICAvLyBsb2dEZWJ1ZygiWCBzaGFyZWRQcm9wZXJ0aWVzLmdldF9ldmVudF90eXBlX2Zvcl9zdWdnZXN0aW9ucz0iK3NoYXJlZFByb3BlcnRpZXMuZ2V0X2V2ZW50X3R5cGVfZm9yX3N1Z2dlc3Rpb25zKCkpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2hhcmVkUHJvcGVydGllcy5nZXRfZXZlbnRfdHlwZV9mb3Jfc3VnZ2VzdGlvbnMoKSE9bnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkPXNoYXJlZFByb3BlcnRpZXMuZ2V0X2V2ZW50X3R5cGVfZm9yX3N1Z2dlc3Rpb25zKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmV2ZW50VHlwZVNlbGVjdGVkKCRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gZmlyc3QgY2hlY2tpbmcgaWYgdGhlcmUncyBhbiBldmVudCB0byByZXNjaGVkdWxlCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzaGFyZWRQcm9wZXJ0aWVzLmdldF9ldmVudF9yZXNjaGVkdWxlKCkhPW51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUucHJldmlvdXNfZXZlbnRfcmVzY2hlZHVsZT10cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5wcmV2aW91c19ldmVudF9yZXNjaGVkdWxlX2V2ZW50PXNoYXJlZFByb3BlcnRpZXMuZ2V0X2V2ZW50X3Jlc2NoZWR1bGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICBzaGFyZWRQcm9wZXJ0aWVzLnNldF9ldmVudF9yZXNjaGVkdWxlKG51bGwpOwogICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ0RlYnVnKCJnb3QgZXZlbnQgdG8gcmVzY2hlZHVsZSAiK0pTT04uc3RyaW5naWZ5KCRzY29wZS5wcmV2aW91c19ldmVudF9yZXNjaGVkdWxlX2V2ZW50KSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nRGVidWcoInJlc2NoZWR1bGUgZXZlbnRfdHlwZV9pZD0iKyRzY29wZS5wcmV2aW91c19ldmVudF9yZXNjaGVkdWxlX2V2ZW50LmV2ZW50X3R5cGVfaWQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkPSRzY29wZS5wcmV2aW91c19ldmVudF9yZXNjaGVkdWxlX2V2ZW50LmV2ZW50X3R5cGVfaWQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmV2ZW50VHlwZVNlbGVjdGVkKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gY2hlY2tpbmcgc2VsZWN0ZWQgdXNlciBvbmx5IGlmIHRoZXJlJ3Mgbm8gc2VsZWN0ZWQgZXZlbnQgdG8gbW92ZQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkhPW51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiZ290IHByZXZpb3VzIHNlbGVjdGVkIHVzZXIgIitzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfZmlyc3RfbmFtZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJuYW1lPXNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKS5idXNlcl9maXJzdF9uYW1lKyIgIitzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfbGFzdF9uYW1lOwogICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyX2lkPXNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKS5idXNpbmVzc191c2VyX2lkOwogICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ0RlYnVnKCIkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcl9pZD0iKyRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyX2lkKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXI9dHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIC8vIHNlbGVjdDogZnVuY3Rpb24oc3RhcnQsIGVuZCwgYWxsRGF5KSB7CiAgICAgICAgICAgIC8vICAgICAvLyB2YXIgdGl0bGUgPSBwcm9tcHQoJ0V2ZW50IFRpdGxlOicgKyAoc3RhcnQgKyAzNTI4MDAwMDApIC8gKDYwICogMTAwMCkgKyAiICIgKyBlbmQgKyAiICIgKyBhbGxEYXkpOwogICAgICAgICAgICAvLyAgICAgdGl0bGUgPSAi16nXoteV16og16TXoteZ15zXldeqIjsKICAgICAgICAgICAgLy8gICAgIGlmICh0aXRsZSkgewogICAgICAgICAgICAvLyAgICAgICAgIGxvZ0RlYnVnKCJjcmVhdGluZyBkZXZlbnQgc3RhcnQiKTsKICAgICAgICAgICAgLy8gICAgICAgICBsb2dEZWJ1Zygic3RhcnQ9IiArIHN0YXJ0KTsKICAgICAgICAgICAgLy8gICAgICAgICBjaGVja0RhdGUgPSBuZXcgRGF0ZShzdGFydCk7CiAgICAgICAgICAgIC8vICAgICAgICAgbG9nRGVidWcoImNoZWNrIGRhdGUgPSAiICsgY2hlY2tEYXRlKQogICAgICAgICAgICAvLyAgICAgICAgIGxvZ0RlYnVnKCJlbmQ9IiArIGVuZCk7CiAgICAgICAgICAgIC8vICAgICAgICAgZWNvbG9yID0gIiMiICsgJHNjb3BlLmV2ZW50Q29sb3I7IC8vZ2V0UmFuZG9tQ29sb3IoKTsKICAgICAgICAgICAgLy8KICAgICAgICAgICAgLy8KICAgICAgICAgICAgLy8gICAgICAgICAvLyB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tdLmZ1bGxDYWxlbmRhcigncmVyZW5kZXJFdmVudHMnKTsKICAgICAgICAgICAgLy8KICAgICAgICAgICAgLy8gICAgICAgICBjYWxlbmRhciA9ICRzY29wZS5jYWxlbmRhcl9uYW1lOwogICAgICAgICAgICAvLyAgICAgICAgIHRlbXBfbGltaXRfaWQgPSAkZ0NhbGVuZGFyVGVtcEVudklEMSAtIGdldFJhbmRvbUludCgxMCwgODApOwogICAgICAgICAgICAvLyAgICAgICAgIG5ld0V2ZW50ID0gewogICAgICAgICAgICAvLyAgICAgICAgICAgICBpZDogdGVtcF9saW1pdF9pZCwKICAgICAgICAgICAgLy8gICAgICAgICAgICAgdGl0bGU6IHRpdGxlLAogICAgICAgICAgICAvLyAgICAgICAgICAgICBzdGFydDogc3RhcnQsCiAgICAgICAgICAgIC8vICAgICAgICAgICAgIGNvbG9yOiBlY29sb3IsCiAgICAgICAgICAgIC8vICAgICAgICAgICAgIGVuZDogZW5kLAogICAgICAgICAgICAvLyAgICAgICAgICAgICBhbGxEYXk6IGZhbHNlLAogICAgICAgICAgICAvLyAgICAgICAgICAgICBjbGFzc05hbWU6IFsnb3BlblNlc2FtZSddCiAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICAvLyBjb2xvcjogcmVzb3VyY2UuZXZlbnRDb2xvcgogICAgICAgICAgICAvLyAgICAgICAgIH07CiAgICAgICAgICAgIC8vICAgICAgICAgY2FsZW5kYXIgPSAkc2NvcGUuY2FsZW5kYXJfbmFtZTsKICAgICAgICAgICAgLy8KICAgICAgICAgICAgLy8gICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZW5kZXJFdmVudCcsIG5ld0V2ZW50LCB0cnVlKTsKICAgICAgICAgICAgLy8gICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCd1bnNlbGVjdCcpOwogICAgICAgICAgICAvLwogICAgICAgICAgICAvLyAgICAgICAgIGxvZ0RlYnVnKCJjcmVhdGluZyBkZXZlbnQgZW5kIik7CiAgICAgICAgICAgIC8vICAgICAgICAgJHNjb3BlLmFkZEV2ZW50VG9EYXRhYmFzZShzdGFydCwgZW5kLCB0aXRsZSwgZWNvbG9yLCB0ZW1wX2xpbWl0X2lkKTsKICAgICAgICAgICAgLy8KICAgICAgICAgICAgLy8gICAgIH0KICAgICAgICAgICAgLy8gfQogICAgICAgIH0KICAgIH07Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignSG91cnNPZldvcmtDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGNvbXBpbGUsICRsb2NhdGlvbiwgdWlDYWxlbmRhckNvbmZpZywgJHVpYk1vZGFsKSB7CiAgICBsb2dEZWJ1ZygnSG91cnNPZldvcmsgQ29udHJvbGxlcicpOwoKICAgIGxvZ0RlYnVnKCIkbG9jYXRpb24uc2VhcmNoKCkuc3RhcnQ9IiArICRsb2NhdGlvbi5zZWFyY2goKS5zdGFydCk7CiAgICBpZiAodHlwZW9mICRsb2NhdGlvbi5zZWFyY2goKS5zdGFydCA9PSAndW5kZWZpbmVkJykgewogICAgICAgIGN1cnJEZWZhdWx0RGF0ZSA9ICRnSG91cjBkYXRlOwogICAgICAgICRzY29wZS5maXhlZFNjaGVkdWxlID0gdHJ1ZTsKICAgICAgICAkc2NvcGUuY2FsZW5kYXJUaXRsZUNlbnRlciA9ICLXqdei15XXqiDXpNei15nXnNeV16og16fXkdeV16LXldeqIjsKICAgICAgICBsb2dEZWJ1Zygi16nXoteV16og16TXoteZ15zXldeqINen15HXldei15XXqiIpOwogICAgICAgIGhvdXJzT2ZXb3JrRGVmYXVsdFZpZXc9J2RvbnRTaG93RGF0ZSc7CiAgICB9IGVsc2UgewogICAgICAgIGN1cnJEZWZhdWx0RGF0ZSA9ICRsb2NhdGlvbi5zZWFyY2goKS5zdGFydDsKICAgICAgICAkc2NvcGUuZml4ZWRTY2hlZHVsZSA9IGZhbHNlOwogICAgICAgIC8vICRzY29wZS5jYWxlbmRhclRpdGxlQ2VudGVyID0gItep16LXldeqINek16LXmdec15XXqiDXp9eR15XXoteV16oiOwogICAgICAgIGhvdXJzT2ZXb3JrRGVmYXVsdFZpZXc9J2FnZW5kYVdlZWsnOwogICAgfQoKCiAgICAkc2NvcGUudmlzaWJsZURhdGUgPSBbXTsKICAgICRzY29wZS5jYWxlbmRhciA9ICdjYWxlbmRhcl9ob3Vyc19vZl93b3JrJzsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50VHlwZSA9IFtdOwoKICAgIGdldEFsbEJ1c2luZXNzRXZlbnRUeXBlcygkaHR0cCwkc2NvcGUsJ2V2ZW50X3R5cGVzJyxnZXRBbGxCdXNpbmVzc0V2ZW50VHlwZXNfY2FsbGJhY2spOwoKICAgIGZ1bmN0aW9uIGdldEFsbEJ1c2luZXNzRXZlbnRUeXBlc19jYWxsYmFjaygpCiAgICB7CiAgICAgICRzY29wZS5zZWxlY3RFdmVudFR5cGUoJHNjb3BlLmV2ZW50X3R5cGVzWzBdKTsKICAgIH0KICAgICRzY29wZS5iYWNrVG9DYWxlbmRhciA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZpc2libGVEYXRlU3RhcnQgPSBuZXcgRGF0ZSh1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ2V0VmlldycpLnN0YXJ0KTsKICAgICAgICBkYXRlVG9Hb1RvID0gdmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpICsgIi0iICsgKCcwJyArICh2aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkgKyAxKSkuc2xpY2UoLTIpICsgIi0iICsgKCcwJyArIHZpc2libGVEYXRlU3RhcnQuZ2V0RGF0ZSgpKS5zbGljZSgtMik7CiAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jYWxlbmRhcicpLnNlYXJjaCh7CiAgICAgICAgICAgIHN0YXJ0OiBkYXRlVG9Hb1RvCiAgICAgICAgfSk7CiAgICB9CiAgICAkc2NvcGUuc2VsZWN0RXZlbnRUeXBlID0gZnVuY3Rpb24oZXZlbnRUeXBlKSB7CiAgICAgICAgJHNjb3BlLnNlbGVjdGVkRXZlbnRUeXBlID0gZXZlbnRUeXBlOwogICAgICAgIGxvZ0RlYnVnKCJzZWxlY3RlZCBFdmVudCBUeXBlID0gIiArICRzY29wZS5zZWxlY3RlZEV2ZW50VHlwZS5ldmVudF90eXBlX2lkICsgIiwgIiArICRzY29wZS5zZWxlY3RlZEV2ZW50VHlwZS5ldmVudF90eXBlX25hbWUpOwogICAgICAgIGt1emVJc0NhbGVuZGFyRHJhZ2dibGUgPSAkc2NvcGUuc2VsZWN0ZWRFdmVudFR5cGUuZGlmZl9yYW5nZTsKICAgIH07CgogICAgJHNjb3BlLmNoYW5nZUV2ZW50Q29sb3IgPSBmdW5jdGlvbihuZXdDb2xvcikgewogICAgICAgICRzY29wZS5ldmVudENvbG9yID0gbmV3Q29sb3I7CiAgICAgICAgYWxsbEV2ZW50c0FycmF5ID0gdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignY2xpZW50RXZlbnRzJyk7CiAgICAgICAgZm9yIChpIGluIGFsbGxFdmVudHNBcnJheSkgewogICAgICAgICAgICBhbGxsRXZlbnRzQXJyYXlbaV0uY29sb3IgPSAiIyIgKyBuZXdDb2xvcjsKICAgICAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigndXBkYXRlRXZlbnQnLCBhbGxsRXZlbnRzQXJyYXlbaV0pOwogICAgICAgIH0KICAgIH07CgogICAgJHNjb3BlLmV2ZW50Q2xpY2tNb2R1bGUgPSBmdW5jdGlvbihzZWxlY3RlZEV2ZW50LCBzaXplKSB7CiAgICAgICAgbG9nRGVidWcoInNlbGVjdGVkIEV2ZW50IHRpdGxlPSIgKyBzZWxlY3RlZEV2ZW50LnRpdGxlKTsKCgogICAgICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewogICAgICAgICAgICBhbmltYXRpb246IGZhbHNlLAogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9saW1pdGF0aW9uX2RldGFpbHMuaHRtbCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdldmVudERldGFpbHNIb3Vyc09mV29ya01vZGFsQ29udHJvbGxlcicsCiAgICAgICAgICAgIHNpemU6IHNpemUsCiAgICAgICAgICAgIHJlc29sdmU6IHsKICAgICAgICAgICAgICAgIHNlbGVjdGVkRXZlbnQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxlY3RlZEV2ZW50OwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGZpeGVkU2NoZWR1bGU6IGZ1bmN0aW9uICgpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuZml4ZWRTY2hlZHVsZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBtb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHNlbGVjdGVkSXRlbSkgewogICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWQgPSBzZWxlY3RlZEl0ZW07CiAgICAgICAgfSwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGxvZ0RlYnVnKCdNb2RhbCBkaXNtaXNzZWQgYXQ6ICcgKyBuZXcgRGF0ZSgpKTsKICAgICAgICB9KTsKICAgIH07CgoKICAgIHZhciBkYXRlID0gbmV3IERhdGUoKTsKICAgIHZhciBkID0gZGF0ZS5nZXREYXRlKCk7CiAgICB2YXIgbSA9IGRhdGUuZ2V0TW9udGgoKTsKICAgIHZhciB5ID0gZGF0ZS5nZXRGdWxsWWVhcigpOwoKCiAgICBmdW5jdGlvbiBnZXRUaW1lU3RhbXAobm93KSB7CiAgICAgICAgcmV0dXJuICgobm93LmdldE1vbnRoKCkgKyAxKSArICcvJyArIChub3cuZ2V0RGF0ZSgpKSArICcvJyArIG5vdy5nZXRGdWxsWWVhcigpICsgIiAiICsgbm93LmdldEhvdXJzKCkgKyAnOicgKyAoKG5vdy5nZXRNaW51dGVzKCkgPCAxMCkgPyAoIjAiICsgbm93LmdldE1pbnV0ZXMoKSkgOiAobm93LmdldE1pbnV0ZXMoKSkpICsgJzonICsgKChub3cuZ2V0U2Vjb25kcygpIDwgMTApID8gKCIwIiArIG5vdwogICAgICAgICAgICAuZ2V0U2Vjb25kcygpKSA6IChub3cuZ2V0U2Vjb25kcygpKSkpOwogICAgfQoKCiAgICAvKiBDaGFuZ2UgVmlldyAqLwogICAgJHNjb3BlLmNoYW5nZVZpZXcgPSBmdW5jdGlvbih2aWV3LCBjYWxlbmRhcikgewogICAgICAgIGxvZ0RlYnVnKCJjaGFuZ2UgdmlldyAiICsgdmlldyk7CiAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignY2hhbmdlVmlldycsIHZpZXcpOwogICAgfTsKICAgIC8qIENoYW5nZSBWaWV3ICovCgogICAgJHNjb3BlLnJlbmRlckNhbGVuZGVyID0gZnVuY3Rpb24oY2FsZW5kYXIpIHsKICAgICAgICAkdGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgaWYgKHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXSkgewogICAgICAgICAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVuZGVyJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH07CgogICAgJHNjb3BlLmNoYW5nZVNlbGVjdGFibGUgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAga3V6ZUlzQ2FsZW5kYXJEcmFnZ2JsZSA9ICFrdXplSXNDYWxlbmRhckRyYWdnYmxlOwogICAgICAgICAgICBjYWxlbmRhciA9ICdjYWxlbmRhcl9ob3Vyc19vZl93b3JrJzsKICAgICAgICAgICAgLy8gdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ2V0VmlldycpLmNhbGVuZGFyLm9wdGlvbnMuc2VsZWN0YWJsZSA9IGZhbHNlOwogICAgICAgICAgICB2aWV3ID0gdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignb3B0aW9uJywgJ3NlbGVjdGFibGUnLCBmYWxzZSk7CiAgICAgICAgICAgIC8vIHZpZXcuY2FsZW5kYXIub3B0aW9ucy5zZWxlY3RhYmxlID0gZmFsc2U7CiAgICAgICAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlbmRlcicpOwoKICAgICAgICB9CiAgICAgICAgLyogY29uZmlnIG9iamVjdCAqLwoKICAgICRzY29wZS5jYWxlbmRhcl9ob3Vyc19vZl93b3JrX2NvbmZpZyA9IHsKICAgICAgICBjYWxlbmRhcjogewogICAgICAgICAgICBoZWlnaHQ6ICdhdXRvJywKICAgICAgICAgICAgZWRpdGFibGU6IHRydWUsCiAgICAgICAgICAgIC8vIGhlYWRlcjogewogICAgICAgICAgICAvLyAgICAgbGVmdDogJycsCiAgICAgICAgICAgIC8vICAgICBjZW50ZXI6ICcnLAogICAgICAgICAgICAvLyAgICAgcmlnaHQ6ICcnCiAgICAgICAgICAgIC8vIH0sCiAgICAgICAgICAgIGhlYWRlcjogJycsCiAgICAgICAgICAgIC8vIGhlYWRlcjogewogICAgICAgICAgICAvLyAgICAgbGVmdDogJ3RpdGxlJywKICAgICAgICAgICAgLy8gICAgIGNlbnRlcjogJycsCiAgICAgICAgICAgIC8vICAgICByaWdodDogJ3RvZGF5IHByZXYsbmV4dCcKICAgICAgICAgICAgLy8gfSwKICAgICAgICAgICAgLy8gZGVmYXVsdFZpZXc6ICdhZ2VuZGFXZWVrJywKICAgICAgICAgICAgdmlld3M6IHsKICAgICAgICAgICAgICAgIGRvbnRTaG93RGF0ZTogewogICAgICAgICAgICAgICAgICAgIHR5cGU6ICdhZ2VuZGFXZWVrJywKICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogewogICAgICAgICAgICAgICAgICAgICAgICBkYXlzOiA3CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ0FwZXJ0dXJhJywKICAgICAgICAgICAgICAgICAgICBjb2x1bW5Gb3JtYXQ6ICdkZGRkJyAvLyBGb3JtYXQgdGhlIGRheSB0byBvbmx5IHNob3cgbGlrZSAnTW9uZGF5JwogICAgICAgICAgICAgICAgICAgICAgICAvLyBoaWRkZW5EYXlzOiBbMCwgNl0gLy8gSGlkZSBTdW5kYXkgYW5kIFNhdHVyZGF5PwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGRvU2hvd0RhdGU6IHsKICAgICAgICAgICAgICAgICAgICB0eXBlOiAnYWdlbmRhV2VlaycsCiAgICAgICAgICAgICAgICAgICAgZHVyYXRpb246IHsKICAgICAgICAgICAgICAgICAgICAgICAgZGF5czogNwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdBcGVydHVyYScsCgogICAgICAgICAgICAgICAgICAgICAgICAvLyBoaWRkZW5EYXlzOiBbMCwgNl0gLy8gSGlkZSBTdW5kYXkgYW5kIFNhdHVyZGF5PwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBldmVudERyb3A6IGZ1bmN0aW9uKGV2ZW50LCBkYXlEZWx0YSwgbWludXRlRGVsdGEsIGFsbERheSwgcmV2ZXJ0RnVuYywgdWlDYWxlbmRhckNvbmZpZykgewogICAgICAgICAgICAgICAgbG9nRGVidWcoImV2ZW50ZHJvcCIgKyBldmVudC50aXRsZSArICIoIiArIGV2ZW50LmlkICsgIikgbW92ZWQgIiArIG1pbnV0ZURlbHRhICsgIiBtaW51dGVzIik7CiAgICAgICAgICAgICAgICBsb2dEZWJ1Zygib2xkIHN0YXJ0PSIgKyBldmVudC5zdGFydCArICIsIG9sZCBlbmQ9IiArIGV2ZW50LmVuZCk7CiAgICAgICAgICAgICAgICAkc2NvcGUudXBkYXRlTGltaXRhdGlvbkRhdGFiYXNlKGV2ZW50LnN0YXJ0LCBldmVudC5lbmQsIGV2ZW50LmlkLCBldmVudC50ZW1wX2xpbWl0X2lkLCBldmVudCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGV2ZW50UmVzaXplOiBmdW5jdGlvbihldmVudCwgZGVsdGEsIHJldmVydEZ1bmMpIHsKICAgICAgICAgICAgICAgIGxvZ0RlYnVnKCJldmVudHJlc2l6ZSwgZXZlbnQuZW5kPSIgKyBldmVudC5lbmQpOwogICAgICAgICAgICAgICAgJHNjb3BlLnVwZGF0ZUxpbWl0YXRpb25EYXRhYmFzZShldmVudC5zdGFydCwgZXZlbnQuZW5kLCBldmVudC5pZCwgZXZlbnQudGVtcF9saW1pdF9pZCwgZXZlbnQpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBkZWZhdWx0VmlldzogaG91cnNPZldvcmtEZWZhdWx0VmlldywKICAgICAgICAgICAgZXZlbnRDbGljazogZnVuY3Rpb24oY2FsRXZlbnQsIGpzRXZlbnQsIHZpZXcpIHsKICAgICAgICAgICAgICAgIGxvZ0RlYnVnKCJldmVudCBjbGlja2VkICIgKyBjYWxFdmVudC50aXRsZSArICIoaWQ9IiArIGNhbEV2ZW50LmlkICsgIiwgZGF5X2xpbWl0X2lkPSIgKyBjYWxFdmVudC5kYXlfbGltaXRfaWQgKyAiLCB0ZW1wX2xpbWl0X2lkPSIgKyBjYWxFdmVudC50ZW1wX2xpbWl0X2lkICsgIiwgbGltaXRfaWQ9IiArIGNhbEV2ZW50LmxpbWl0X2lkICsgIikgc3RhcnQ9IiArIGNhbEV2ZW50LnN0YXJ0ICsgIiwgZW5kPSIgKyBjYWxFdmVudC5lbmQpOwogICAgICAgICAgICAgICAgJHNjb3BlLmV2ZW50Q2xpY2tNb2R1bGUoY2FsRXZlbnQpOwogICAgICAgICAgICAgICAgLy8gY2hhbmdlIHRoZSBib3JkZXIgY29sb3IganVzdCBmb3IgZnVuCiAgICAgICAgICAgICAgICAvLyAkKHRoaXMpLmNzcygnYm9yZGVyLWNvbG9yJywgJ3JlZCcpOwoKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZXZlbnRSZW5kZXI6IGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgY29uc29sZS5sb2coZXZlbnQpOwogICAgICAgICAgICAgIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZChldmVudC5sb2NhdGlvbl9uYW1lKyIgLyA8YnIvPiIpOwogICAgICAgICAgICAgIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZChldmVudC5pbnN0cnVjdG9yX25hbWUrIiAvIDxici8+Iik7CiAgICAgICAgICAgICAgLy8gZWxlbWVudC5maW5kKCcuZmMtdGl0bGUnKS5wcmVwZW5kKCIiK2V2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfZmlyc3RfbmFtZSsiICIrZXZlbnQuZXZlbnRVc2Vyc1swXS5idXNlcl9sYXN0X25hbWUrIiAoIik7CgogICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJyZW5kZXIgbGltaXRhdGlvbiAiK0pTT04uc3RyaW5naWZ5KGV2ZW50KSk7CiAgICAgICAgICAgICAgICAvLyBpZiAoZXZlbnQuaXNfY2xhc3M9PTEpCiAgICAgICAgICAgICAgICAvLyB7CiAgICAgICAgICAgICAgICAvLyAgIC8vIGlmIGNsYXNzIGFkZGluZyBudW1iZXIgb2YgcGFydGljaXBhbnRzCiAgICAgICAgICAgICAgICAvLyAgIGlmIChldmVudC5ub19vZl93YWl0aW5nX3VzZXJzPjApCiAgICAgICAgICAgICAgICAvLyAgIHsKICAgICAgICAgICAgICAgIC8vICAgICBlbGVtZW50LmZpbmQoJy5mYy10aXRsZScpLnByZXBlbmQoZXZlbnQubm9fb2ZfdXNlcnMrIi8iK2V2ZW50Lm1heF9wYXJ0aWNpcGFudHMrICIgKCIrZXZlbnQubm9fb2Zfd2FpdGluZ191c2VycysiKSIrIiAtICIpOwogICAgICAgICAgICAgICAgLy8gICB9CiAgICAgICAgICAgICAgICAvLyAgIGVsc2UKICAgICAgICAgICAgICAgIC8vICAgewogICAgICAgICAgICAgICAgLy8gICAgIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZChldmVudC5ub19vZl91c2VycysiLyIrZXZlbnQubWF4X3BhcnRpY2lwYW50cysiIC0gIik7CiAgICAgICAgICAgICAgICAvLyAgIH0KICAgICAgICAgICAgICAgIC8vIH0KICAgICAgICAgICAgICAgIC8vIGVsc2UKICAgICAgICAgICAgICAgIC8vIHsKICAgICAgICAgICAgICAgIC8vICAgLy8gaWYgbm90IGNsYXNzIC0gd3JpdGluZyB0aGUgZW5kdXNlciBuYW1lCiAgICAgICAgICAgICAgICAvLyAgIGlmIChldmVudC5kdXJhdGlvbl9ldmVudCE9MCkgLy8gYWxzbyBpZiBub3QgaG91cnMgb2Ygd29yawogICAgICAgICAgICAgICAgLy8gICB7CiAgICAgICAgICAgICAgICAvLyAgICAgLy8gZWxlbWVudC5maW5kKCcuZmMtdGl0bGUnKS5hcHBlbmQoIiAoIitldmVudC5ldmVudFVzZXJzWzBdLmJ1c2VyX2ZpcnN0X25hbWUrIiAiK2V2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfbGFzdF9uYW1lKyIpIik7CiAgICAgICAgICAgICAgICAvLyAgICAgZWxlbWVudC5maW5kKCcuZmMtdGl0bGUnKS5wcmVwZW5kKCIiK2V2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfZmlyc3RfbmFtZSsiICIrZXZlbnQuZXZlbnRVc2Vyc1swXS5idXNlcl9sYXN0X25hbWUrIiAoIik7CiAgICAgICAgICAgICAgICAvLyAgICAgZWxlbWVudC5maW5kKCcuZmMtdGl0bGUnKS5hcHBlbmQoIikiKTsKICAgICAgICAgICAgICAgIC8vICAgfQogICAgICAgICAgICAgICAgLy8gICAvLyBsb2dEZWJ1ZygiaGVyZTQiKTsKICAgICAgICAgICAgICAgIC8vIH0KICAgICAgICAgICAgICAgIC8vIGlmIChldmVudC5pc19yZXBlYXRpbmcgPT0gMSkgewogICAgICAgICAgICAgICAgLy8gICAgIGVsZW1lbnQuZmluZCgiLmZjLXRpdGxlIikucHJlcGVuZCgiJm5ic3A7PGkgY2xhc3M9J2ZhIGZhLXJlcGVhdCc+PC9pPiZuYnNwOyIpOwogICAgICAgICAgICAgICAgLy8gICAgIC8vICBlbGVtZW50LmZpbmQoIi5mYy10aXRsZSIpLmFwcGVuZCgiJm5ic3A7PGltZyBzcmM9Jy9wdWJsaWMvaW1hZ2VzL3JlY3VycmluZy1pY29uLnBuZycgd2lkdGg9JzEwcHgnIGhlaWdodD0nMTBweCcvPiIpOwogICAgICAgICAgICAgICAgLy8gfQogICAgICAgICAgICB9LAogICAgICAgICAgICBtaW5UaW1lOiAkZ0NhbGVuZGFyRGlzcGxheU1pblRpbWUsCiAgICAgICAgICAgIG1heFRpbWU6ICRnQ2FsZW5kYXJEaXNwbGF5TWF4VGltZSwKICAgICAgICAgICAgc2VsZWN0YWJsZTogdHJ1ZSwKICAgICAgICAgICAgc2VsZWN0SGVscGVyOiBmYWxzZSwKICAgICAgICAgICAgdGltZXpvbmU6IGZhbHNlLAogICAgICAgICAgICBpc1JUTDogdHJ1ZSwKICAgICAgICAgICAgbGFuZzogImhlIiwKICAgICAgICAgICAgc2VsZWN0Q29uc3RyYWludDogewogICAgICAgICAgICAgICAgc3RhcnQ6ICcwMDowMScsCiAgICAgICAgICAgICAgICBlbmQ6ICcyMzo1OScsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRlZmF1bHREYXRlOiBtb21lbnQoY3VyckRlZmF1bHREYXRlKSwKICAgICAgICAgICAgYWxsRGF5U2xvdDogZmFsc2UsCiAgICAgICAgICAgIGxvYWRpbmc6IGZ1bmN0aW9uKGJvb2wpIHsKICAgICAgICAgICAgICAgIGlmIChib29sKSB7CiAgICAgICAgICAgICAgICAgICAgbG9nRGVidWcoJ2xvYWRpbmcgY2FsZW5kYXIgJyArICRzY29wZS5jYWxlbmRhcik7CgogICAgICAgICAgICAgICAgICAgIC8vICQoJyNsb2FkaW5nJykuc2hvdygpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvLyAkKCcjbG9hZGluZycpLmhpZGUoKTsKICAgICAgICAgICAgICAgICAgICBsb2dEZWJ1ZygnZmluaXNoZWQgbG9hZGluZyBjYWxlbmRhciAnICsgJHNjb3BlLmNhbGVuZGFyKTsKICAgICAgICAgICAgICAgICAgICBpZiAoISRzY29wZS5maXhlZFNjaGVkdWxlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIC8vICRzY29wZS5iYWNrVG9GaXhlZCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBzZWxlY3Q6IGZ1bmN0aW9uKHN0YXJ0LCBlbmQsIGFsbERheSkgewogICAgICAgICAgICAgIC8vIHRoaXMgaXMgY2FsbGVkIHdoZW4gY3JlYXRpbmcgYSBuZXcgYmxvY2sKICAgICAgICAgICAgICAkc2NvcGUuY3JlYXRlTGltaXRhdGlvbkJsb2NrKHN0YXJ0LCBlbmQpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKCiAgICAvLyBjcmVhdGUgbGltaXRhdGlvbiBibG9jawogICAgJHNjb3BlLmNyZWF0ZUxpbWl0YXRpb25CbG9jayA9IGZ1bmN0aW9uKHN0YXJ0LCBlbmQpCiAgICB7CiAgICAgICAgbG9nRGVidWcoImZ1bmN0aW9uOiBjcmVhdGVMaW1pdGF0aW9uQmxvY2siKTsKICAgICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAgICAgICAgICAgYW5pbWF0aW9uOiBmYWxzZSwKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfbGltaXRhdGlvbl9jcmVhdGUucGhwJywKICAgICAgICAgICAgc2l6ZTogJ3hzJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ2J1c2luZXNzX21vZGFsX2xpbWl0YXRpb25fY3JlYXRlJywKICAgICAgICAgICAgcmVzb2x2ZTogewogICAgICAgICAgICAgIHN0YXJ0OiBmdW5jdGlvbigpCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICByZXR1cm4gc3RhcnQ7CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBlbmQ6IGZ1bmN0aW9uKCkKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBlbmQ7CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBmaXhlZFNjaGVkdWxlOiBmdW5jdGlvbiAoKQogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuZml4ZWRTY2hlZHVsZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0KICAgICRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKTsKCiAgICAgICAgdmlzaWJsZURhdGVTdGFydCA9IG5ldyBEYXRlKHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3Jykuc3RhcnQpOwogICAgICAgIHZpc2libGVEYXRlRW5kID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5lbmQpOwoKICAgICAgICAkc2NvcGUuY2FsZW5kYXJUaXRsZUNlbnRlciA9IHZpc2libGVEYXRlU3RhcnQuZ2V0RGF0ZSgpICsgIiAiICsgbW9udGhOYW1lc1t2aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCldICsKICAgICAgICAgICAgIiDigJQgIiArIHZpc2libGVEYXRlRW5kLmdldERhdGUoKSArICIgIiArIG1vbnRoTmFtZXNbdmlzaWJsZURhdGVFbmQuZ2V0TW9udGgoKV0gKwogICAgICAgICAgICAiICIgKyB2aXNpYmxlRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCk7CiAgICB9OwogICAgLyogZXZlbnQgc291cmNlcyBhcnJheSovCiAgICAkc2NvcGUuZXZlbnRTb3VyY2VzID0gW3sKICAgICAgICB1cmw6ICcvYXBpL2FkbWluL2NhbGVuZGFyL2xpbWl0YXRpb25zL3BlcmRheS9nZXRwb3N0JywKICAgICAgICB0eXBlOiAnUE9TVCcKICAgIH1dOwoKICAgIC8vICRzY29wZS5nZXRFdmVudHMgPSBmdW5jdGlvbigpIHsKICAgIC8vICAgICBjYWxlbmRhciA9ICdjYWxlbmRhcl9ob3Vyc19vZl93b3JrJzsKICAgIC8vICAgICBhbGxsRXZlbnRzQXJyYXkgPSB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdjbGllbnRFdmVudHMnKTsKICAgIC8vICAgICBmb3IgKGkgaW4gYWxsbEV2ZW50c0FycmF5KSB7CiAgICAvLyAgICAgICAgIGxvZ0RlYnVnKGFsbGxFdmVudHNBcnJheVtpXSk7CiAgICAvLyAgICAgfQogICAgLy8KICAgIC8vIH0KCiAgICAkc2NvcGUuZ290b1RvZGF5ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgJHNjb3BlLmdvdG9EYXRlKG5ldyBEYXRlKCkpOwogICAgfQogICAgJHNjb3BlLmdvdG9OZXh0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ25leHQnKTsKICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVtb3ZlRXZlbnRzJyk7CiAgICAgICAgJHNjb3BlLnVwZGF0ZUNhbGVuZGFyQ2VudGVyVGl0bGUoKTsKICAgIH0KICAgICRzY29wZS5nb3RvUHJldiA9IGZ1bmN0aW9uKCkgewogICAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZW1vdmVFdmVudHMnKTsKICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncHJldicpOwogICAgICAgICRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlKCk7CiAgICB9CiAgICAkc2NvcGUuZ290b0RhdGUgPSBmdW5jdGlvbihuZXdkYXRlKSB7CiAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dvdG9EYXRlJywgbmV3ZGF0ZSk7CiAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2NoYW5nZVZpZXcnLCAnYWdlbmRhV2VlaycpOwogICAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZW1vdmVFdmVudHMnKTsKICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwoKICAgICAgICAkc2NvcGUudXBkYXRlQ2FsZW5kYXJDZW50ZXJUaXRsZSgpOwogICAgICAgICRzY29wZS5maXhlZFNjaGVkdWxlID0gZmFsc2U7CiAgICB9CgogICAgJHNjb3BlLmJhY2tUb0ZpeGVkID0gZnVuY3Rpb24oKSB7CiAgICAgICAgJHNjb3BlLmZpeGVkU2NoZWR1bGUgPSB0cnVlOwogICAgICAgICRzY29wZS5jYWxlbmRhclRpdGxlQ2VudGVyID0gItep16LXldeqINek16LXmdec15XXqiDXp9eR15XXoteV16oiOwogICAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdjaGFuZ2VWaWV3JywgJ2RvbnRTaG93RGF0ZScpOwogICAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnb3RvRGF0ZScsIG1vbWVudCgkZ0hvdXIwZGF0ZSkpOwogICAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZW1vdmVFdmVudHMnKTsKICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwoKICAgIH0KCiAgICAvLyAkc2NvcGUuZGVsZXRlQWxsRXZlbnRzID0gZnVuY3Rpb24oKSB7CiAgICAvLyAgICAgY2FsZW5kYXIgPSAnY2FsZW5kYXJfaG91cnNfb2Zfd29yayc7CiAgICAvLyAgICAgYWxsbEV2ZW50c0FycmF5ID0gdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignY2xpZW50RXZlbnRzJyk7CiAgICAvLyAgICAgZm9yIChpIGluIGFsbGxFdmVudHNBcnJheSkgewogICAgLy8gICAgICAgICBsb2dEZWJ1ZyhhbGxsRXZlbnRzQXJyYXlbaV0pOwogICAgLy8gICAgICAgICAkc2NvcGUuZGVsZXRlQ2FsZW5kYXJKU0V2ZW50KGNhbGVuZGFyLCBhbGxsRXZlbnRzQXJyYXlbaV0uaWQpOwogICAgLy8gICAgICAgICAkc2NvcGUuZGVsZXRlQ2FsZW5kYXJEQkV2ZW50KGFsbGxFdmVudHNBcnJheVtpXS5pZCk7CiAgICAvLyAgICAgfQogICAgLy8KICAgIC8vIH0KICAgICRzY29wZS51cGRhdGVMaW1pdGF0aW9uRGF0YWJhc2UgPSBmdW5jdGlvbihzdGFydF9wYXJhbSwgZW5kX3BhcmFtLCBldmVudF9pZCwgdGVtcF9saW1pdF9pZCwgdGhlZXZlbnQpIHsKCiAgICAgICAgbG9nRGVidWcoInVwZGF0ZUxpbWl0YXRpb25EYXRhYmFzZSBzdGFydD0iICsgc3RhcnRfcGFyYW0gKyAiLCBlbmQ9IiArIGVuZF9wYXJhbSArICIsZXZlbnRfaWQ9IiArIGV2ZW50X2lkKTsKCiAgICAgICAgZnVuY3Rpb24gdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uX2ZhaWx1cmUoKQogICAgICAgIHsKICAgICAgICAgIGNhbGVuZGFyID0gImNhbGVuZGFyX2hvdXJzX29mX3dvcmsiOwogICAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwogICAgICAgIH0KICAgICAgICAvLyBpZiB0aGUgZXZlbnQgdGhhdCBpcyBnZXR0aW5nIHVwZGF0ZWQgaXMgYW4gZXZlbnQgZnJvbSAxOTcwIChub3QgcGVyZGF5KQogICAgICAgIC8vIHRoZW4gd2UgYWRkIGEgbmV3IHBlcmRheSBsaW1pdGF0aW9uIHdpdGggbGltaXRfaWQgb2YgdGhlIDE5NzAgbGltaXRhdGlvbnMgLSB3aXRoIHRoZSBuZXcgdGltZXMuCgogICAgICAgIC8vIG90aGVyd2lzZSB3ZSBqdXN0IHVwZGF0ZSB0aGUgcGVyZGF5IGxpbWl0YXRpb24KCiAgICAgICAgaWYgKCRzY29wZS5maXhlZFNjaGVkdWxlKSAvLyBmaXhlZCBzY2hlZHVsZSB2cyBzcGVjaWZpYyB3ZWVkL2RheSBsaW1pdGF0aW9uCiAgICAgICAgewogICAgICAgICAgdGhlZGF0YSA9IHsKICAgICAgICAgICAgICBzdGFydF9kYXRlOiBzdGFydF9wYXJhbSwKICAgICAgICAgICAgICBlbmRfZGF0ZTogZW5kX3BhcmFtLAogICAgICAgICAgICAgIHRlbXBfbGltaXRfaWQ6IHRlbXBfbGltaXRfaWQsCiAgICAgICAgICAgICAgbGltaXRfaWQ6IGV2ZW50X2lkCiAgICAgICAgICB9OwoKICAgICAgICAgIHVwZGF0ZUNhbGVuZGFyTGltaXRhdGlvbigkaHR0cCwkc2NvcGUsdGhlZGF0YSxldmVudF9pZCwgbnVsbCwgdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uX2ZhaWx1cmUpOwogICAgICAgIH0KICAgICAgICBlbHNlIC8vIG5vdCBmaXhlZCBzY2hlZHVsZSAtIGRhaWx5L3dlZWtseSBsaW1pdGF0aW9ucwogICAgICAgIHsKICAgICAgICAgICAgaWYgKCh0aGVldmVudC5saW1pdF9pZCAhPSBudWxsKSAmICh0aGVldmVudC5kYXlfbGltaXRfaWQgPT0gLTEpKSAvLyBldmVudCBsaW1pdGF0aW9uIGhhcyBsaW1pdF9pZCBzbyBpdHMgYW4gMTk3MCBldmVudAogICAgICAgICAgICAvLyBuZWVkIHRvIGFkZCBhIG5ldyBwZXJkYXkgbGltaXRhdGlvbiB0aGF0IHBvaW50IChsaW1pdF9pZCkgdG8gdGhlIG9sZCAxOTcwIGV2ZW50IHRvIGNhbmNlbCBpdAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICB0ZW1wX2xpbWl0X2lkID0gY2FsY190ZW1wX2xpbWl0X2lkKCk7CiAgICAgICAgICAgICAgICB0aGVldmVudC50ZW1wX2xpbWl0X2lkID0gdGVtcF9saW1pdF9pZDsKICAgICAgICAgICAgICAgIHRoZWV2ZW50LmRheV9saW1pdF9pZCA9IHRlbXBfbGltaXRfaWQ7CiAgICAgICAgICAgICAgICAvLyB0aGUgbW92ZWQgZXZlbnQgaW4gdGhlIGNhbGVuZGFyIG5vdyBoYXMgZGF5X2xpbWl0X2lkIGFuZCB0ZW1wX2xpbWl0X2lkCiAgICAgICAgICAgICAgICAvLyBpZiBpdHMgbG9hZGVkIGZyb20gdGhlIGRiLCBpdCB3aWxsIG9ubHkgaGF2ZSBkYXlfbGltaXRfaWQgKGFuZCBub3QgdGhlIHRlbXAgb25lKQogICAgICAgICAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnXS5mdWxsQ2FsZW5kYXIoJ3VwZGF0ZUV2ZW50JywgdGhlZXZlbnQpOwogICAgICAgICAgICAgICAgY29uc29sZS5sb2coIlhYWFhYWFhYWFhYWFgiKTsKICAgICAgICAgICAgICAgIHRoZWRhdGEgPSB7CiAgICAgICAgICAgICAgICAgICAgc3RhcnRfZGF0ZTogc3RhcnRfcGFyYW0sCiAgICAgICAgICAgICAgICAgICAgZW5kX2RhdGU6IGVuZF9wYXJhbSwKICAgICAgICAgICAgICAgICAgICBjb2xvcjogdGhlZXZlbnQuY29sb3IsCiAgICAgICAgICAgICAgICAgICAgdGVtcF9saW1pdF9pZDogdGVtcF9saW1pdF9pZCwKICAgICAgICAgICAgICAgICAgICBldmVudF90eXBlX2lkOiB0aGVldmVudC5ldmVudF90eXBlX2lkLAogICAgICAgICAgICAgICAgICAgIGV2ZW50X3R5cGVzOiB0aGVldmVudC5ldmVudF90eXBlcywKICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbl9pZDogdGhlZXZlbnQubG9jYXRpb25faWQsCiAgICAgICAgICAgICAgICAgICAgZW1wX2lkOiB0aGVldmVudC5lbXBfaWQsCiAgICAgICAgICAgICAgICAgICAgbGltaXRfaWQ6IHRoZWV2ZW50LmlkLAogICAgICAgICAgICAgICAgICAgIHRpdGxlOiB0aGVldmVudC50aXRsZQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIGNyZWF0ZUNhbGVuZGFyTGltaXRhdGlvblBlckRheSgkaHR0cCwkc2NvcGUsdGhlZGF0YSxudWxsLCB1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25fZmFpbHVyZSk7CgogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgLy8gZXZlbnQgbGltaXRhdGlvbiB0byBtb3ZlL3VwZGF0ZSBoYXMgbm8gbGltaXRfaWQgLSBzbyB0aGlzIGlzIG5ldyBwZXJkYXkgZXZlbnQgLSB3ZSBqdXN0IHVwZGF0ZSBpdAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgdGhlZGF0YT0gewogICAgICAgICAgICAgICAgICBzdGFydF9kYXRlOiBzdGFydF9wYXJhbSwKICAgICAgICAgICAgICAgICAgZW5kX2RhdGU6IGVuZF9wYXJhbSwKICAgICAgICAgICAgICAgICAgdGVtcF9kYXlfbGltaXRfaWQ6IHRoZWV2ZW50LnRlbXBfbGltaXRfaWQsCiAgICAgICAgICAgICAgICAgIGxvY2F0aW9uX2lkOiB0aGVldmVudC5sb2NhdGlvbl9pZCwKICAgICAgICAgICAgICAgICAgZGF5X2xpbWl0X2lkOiB0aGVldmVudC5kYXlfbGltaXRfaWQKICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIHVwZGF0ZUNhbGVuZGFyTGltaXRhdGlvblBlckRheSgkaHR0cCwkc2NvcGUsdGhlZGF0YSxudWxsLCB1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25fZmFpbHVyZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Owp9KTsKCmt1emVBcHAuY29udHJvbGxlcignRXZlbnRDbGFzc1BhZ2VDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkdGltZW91dCwgJGh0dHAsICRyb290U2NvcGUsICRyb3V0ZVBhcmFtcywgJGxvY2F0aW9uLCAkcm91dGUsIHNoYXJlZERhdGEsICR1aWJNb2RhbCkKewogIGdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCk7CiAgZ2V0QWxsQ2xpZW50cygkaHR0cCwkc2NvcGUsJ2V2ZW50VHlwZVVzZXJzJyk7CiAgZ2V0QnVzaW5lc3NMb2NhdGlvbnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19sb2NhdGlvbnMnKTsKICBnZXRBbGxJbnN0cnVjdG9ycygkaHR0cCwkc2NvcGUsJ2luc3RydWN0b3JzJyk7CgogICRzY29wZS51cGRhdGVFdmVudFRpdGxlID0gZnVuY3Rpb24obmV3VmFsdWUsY3VycmVudEV2ZW50KQogIHsKICAgIG5ld190aXRsZT1uZXdWYWx1ZTsKICAgIHNldEV2ZW50VGl0bGUoJGh0dHAsJHNjb3BlLGN1cnJlbnRFdmVudC5ldmVudF9pZCwgbmV3X3RpdGxlLCB1cGRhdGVFdmVudF9jYWxsYmFjaywgdXBkYXRlRXZlbnRfY2FsbGJhY2spOwoKICAgIGZ1bmN0aW9uIHVwZGF0ZUV2ZW50X2NhbGxiYWNrKCkKICAgIHsKICAgICAgZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCk7CiAgICB9CgogIH07CgogICRzY29wZS51cGRhdGVFdmVudE1heFBhcnRpY2lwYW50cyA9IGZ1bmN0aW9uKG5ld1ZhbHVlLGN1cnJlbnRFdmVudCkKICB7CiAgICBuZXdfbWF4X3BhcnRpY2lwYW50cz1uZXdWYWx1ZTsKICAgIGlmICggbmV3X21heF9wYXJ0aWNpcGFudHMgPCBjdXJyZW50RXZlbnQubm9fb2ZfdXNlcnMgKXsKICAgICAgc2V0RXZlbnRNYXhQYXJ0aWNpcGFudHMoJGh0dHAsJHNjb3BlLGN1cnJlbnRFdmVudC5ldmVudF9pZCwgY3VycmVudEV2ZW50Lm5vX29mX3VzZXJzLCBjdXJyZW50RXZlbnQubm9fb2ZfdXNlcnMsIHVwZGF0ZUV2ZW50X2NhbGxiYWNrLCB1cGRhdGVFdmVudF9jYWxsYmFjayk7CiAgICB9IGVsc2UgewogICAgICBzZXRFdmVudE1heFBhcnRpY2lwYW50cygkaHR0cCwkc2NvcGUsY3VycmVudEV2ZW50LmV2ZW50X2lkLCBuZXdfbWF4X3BhcnRpY2lwYW50cywgY3VycmVudEV2ZW50Lm5vX29mX3VzZXJzLCB1cGRhdGVFdmVudF9jYWxsYmFjaywgdXBkYXRlRXZlbnRfY2FsbGJhY2spOwogICAgfQoKICAgIGZ1bmN0aW9uIHVwZGF0ZUV2ZW50X2NhbGxiYWNrKCkKICAgIHsKICAgICAgZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCk7CiAgICB9CgogIH07CgogICRzY29wZS51cGRhdGVVc2VyRXZlbnRQcmljZSA9IGZ1bmN0aW9uKG5ld3ZhbHVlLCB0aGVldmVudCwgZXVzZXIpCiAgewogICAgbmV3X3ByaWNlPW5ld3ZhbHVlOwogICAgc2V0Q2xpZW50RXZlbnRQcmljZSgkaHR0cCwkc2NvcGUsZXVzZXIuYnVzaW5lc3NfdXNlcl9pZCx0aGVldmVudC5ldmVudF9pZCwgbmV3X3ByaWNlLHNldENsaWVudEV2ZW50UHJpY2VfY2FsbGJhY2ssIHNldENsaWVudEV2ZW50UHJpY2VfY2FsbGJhY2spOwogICAgZnVuY3Rpb24gc2V0Q2xpZW50RXZlbnRQcmljZV9jYWxsYmFjaygpCiAgICB7CiAgICAgIGdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQpOwogICAgfQogIH07CgogICRzY29wZS51cGRhdGVMb2NhdGlvbkV2ZW50ID0gZnVuY3Rpb24oKQogIHsKICAgIGNvbnNvbGUubG9nKCJmdW5jdGlvbjogdXBkYXRlTG9jYXRpb25FdmVudCIpOwogICAgdXBkYXRlRXZlbnRMb2NhdGlvbigkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLCRzY29wZS5jdXJyZW50RXZlbnQubG9jYXRpb25faWQsdXBkYXRlRXZlbnRMb2NhdGlvbl9jYWxsYmFjaywgdXBkYXRlRXZlbnRMb2NhdGlvbl9jYWxsYmFjayk7CiAgICAkc2NvcGUudXBkYXRlTG9jYXRpb25BbGVydE1lc3NhZ2U9Itee16LXk9eb158g16HXmNeY15XXoS4uLiI7CiAgICBmdW5jdGlvbiB1cGRhdGVFdmVudExvY2F0aW9uX2NhbGxiYWNrKCkKICAgIHsKICAgICAgJHNjb3BlLnVwZGF0ZUxvY2F0aW9uQWxlcnRNZXNzYWdlPSLXoteV15PXm9efINeR15TXptec15fXlCEiOwogICAgICAkdGltZW91dChmdW5jdGlvbigpCiAgICAgIHsKICAgICAgICAkc2NvcGUudXBkYXRlTG9jYXRpb25BbGVydE1lc3NhZ2U9bnVsbDsKICAgICAgfSwgMTUwMCk7CiAgICB9CiAgfTsKCiAgJHNjb3BlLnVwZGF0ZUluc3RydWN0b3JDbGFzc0V2ZW50ID0gZnVuY3Rpb24oKQogIHsKICAgIGNvbnNvbGUubG9nKCJmdW5jdGlvbjogdXBkYXRlSW5zdHJ1Y3RvckNsYXNzRXZlbnQiKTsKICAgIHVwZGF0ZUV2ZW50SW5zdHJ1Y3RvcigkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLCRzY29wZS5jdXJyZW50RXZlbnQuaW5zdHJ1Y3Rvcl9pZCx1cGRhdGVFdmVudEluc3RydWN0b3JfY2FsbGJhY2ssIHVwZGF0ZUV2ZW50SW5zdHJ1Y3Rvcl9jYWxsYmFjayk7CiAgICAkc2NvcGUudXBkYXRlSW5zdHJ1Y3RvckFsZXJ0TWVzc2FnZT0i157XoteT15vXnyDXodeY15jXldehLi4uIjsKICAgIGZ1bmN0aW9uIHVwZGF0ZUV2ZW50SW5zdHJ1Y3Rvcl9jYWxsYmFjaygpCiAgICB7CiAgICAgICRzY29wZS51cGRhdGVJbnN0cnVjdG9yQWxlcnRNZXNzYWdlPSLXoteV15PXm9efINeR15TXptec15fXlCEiOwogICAgICAkdGltZW91dChmdW5jdGlvbigpCiAgICAgIHsKICAgICAgICAkc2NvcGUudXBkYXRlSW5zdHJ1Y3RvckFsZXJ0TWVzc2FnZT1udWxsOwogICAgICB9LCAxNTAwKTsKICAgIH0KICB9CgoKICAkc2NvcGUuYWN0aXZhdGVFdmVudENsYXNzID0gZnVuY3Rpb24oKQogIHsKICAgIHsKICAgICAgbG9nRGVidWcoInJlb3BlbkV2ZW50Iik7CiAgICAgIHJlb3BlbkV2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkLCRzY29wZS5zZWxlY3RlZEV2ZW50LGFmdGVyUmVvcGVuRXZlbnQsYWZ0ZXJSZW9wZW5FdmVudCk7CiAgICAgIGZ1bmN0aW9uIGFmdGVyUmVvcGVuRXZlbnQoKQogICAgICB7CiAgICAgICAgZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCk7CiAgICAgIH07CiAgICB9CiAgfQoKICAvLyBjbG9zZSBldmVudCBjbGFzcwogICRzY29wZS5jbG9zZUV2ZW50Q2xhc3MgPSBmdW5jdGlvbigpIHsKICAgICAgbG9nRGVidWcoImV2ZW50IGNyZWF0ZSBtb2RhbCIpOwoKICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgICAgICAgICBhbmltYXRpb246IGZhbHNlLAogICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfZXZlbnRfY2xhc3NfY2xvc2UucGhwJywKICAgICAgICAgIHNpemU6ICd4cycsCiAgICAgICAgICBjb250cm9sbGVyOiAnY2xhc3NDbG9zZU1vZGFsQ29udHJvbGxlcicsCiAgICAgICAgICByZXNvbHZlOiB7CiAgICAgICAgICAgICAgZXZlbnRfaWQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZDsKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgIH0pOwogIH07CgogIC8vIGRlbGV0ZSByZXBlYXRpbmcvY2xhc3MgZXZlbnQKICAkc2NvcGUuZGVsZXRlQ2xhc3NFdmVudCA9IGZ1bmN0aW9uKCkKICB7CiAgICBpZiAoJHNjb3BlLmN1cnJlbnRFdmVudC5pc19yZXBlYXRpbmc9PTApCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJjbGFzcyBldmVudCBub3QgcmVwZWF0aW5nIik7CiAgICAgICRzY29wZS5kZWxldGVDbGFzc0V2ZW50U2luZ2xlKCk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJjbGFzcyBldmVudCBpcyByZXBlYXRpbmciKTsKICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgICAgICAgICBhbmltYXRpb246IGZhbHNlLAogICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfcmVwZWF0aW5nX2V2ZW50X2RlbGV0ZV9hbGwucGhwJywKICAgICAgICAgIHNpemU6ICd4cycsCiAgICAgICAgICBjb250cm9sbGVyOiAnY2xhc3NEZWxldGVBbGxNb2RhbENvbnRyb2xsZXInLAogICAgICAgICAgcmVzb2x2ZTogewogICAgICAgICAgICAgIGN1cnJlbnRFdmVudDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuY3VycmVudEV2ZW50OwogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfTsKCiAgJHNjb3BlLmRlbGV0ZUNsYXNzRXZlbnRTaW5nbGU9ZnVuY3Rpb24gKCkgLy8gZGVsZXRlIG9ubHkgb25lL2N1cnJlbnQgY2xhc3MgZXZlaHQKICB7CiAgICBjYW5jZWxDbGFzc0V2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkLGNhbmNlbENsYXNzRXZlbnRfY2FsbGJhY2ssIGNhbmNlbENsYXNzRXZlbnRfY2FsbGJhY2spOwogICAgZnVuY3Rpb24gY2FuY2VsQ2xhc3NFdmVudF9jYWxsYmFjaygpCiAgICB7CiAgICAgIGdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQpOwogICAgfQogIH0KCiAgJHNjb3BlLiRvbigicmVsb2FkRXZlbnQiLGZ1bmN0aW9uKGUsYSl7CiAgICAgICAvLyBQb3N0IHlvdXIgY29kZQogICBsb2dEZWJ1ZygiYnJvYWRjYXN0ZWQgLSByZWxvYWRpbmcgZXZlbnQgIithLmV2ZW50X2lkKTsKICAgZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkKTsKfSk7CgogIC8vIHJlbW92ZSBlbmQgdXNlciBmcm9tIGV2ZW50CiAgJHNjb3BlLmV2ZW50UmVtb3ZlRW5kVXNlciA9IGZ1bmN0aW9uKGVuZHVzZXJfaWQpCiAgewogICAgY29uc29sZS5sb2coImV2ZW50UmVtb3ZlRW5kVXNlciIpOwogICAgcmVtb3ZlRW5kVXNlckZyb21FdmVudCgkaHR0cCwkc2NvcGUsZW5kdXNlcl9pZCwkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkLHJlbW92ZUVuZFVzZXJGcm9tRXZlbnRfZmluaXNoLCByZW1vdmVFbmRVc2VyRnJvbUV2ZW50X2ZpbmlzaCk7CiAgICBmdW5jdGlvbiByZW1vdmVFbmRVc2VyRnJvbUV2ZW50X2ZpbmlzaCgpCiAgICB7CiAgICAgIGdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCk7CiAgICB9CiAgfTsKCiAgJHNjb3BlLmV2ZW50Q2xpZW50U2VsZWN0ZWQgPSBmdW5jdGlvbihzZWxlY3RlZCkgewogICAgICBpZiAoc2VsZWN0ZWQpIHsKICAgICAgICAgIC8vIGFsZXJ0KEpTT04uc3RyaW5naWZ5KCBzZWxlY3RlZCwgbnVsbCwgMiApKTsKICAgICAgICAgIGxvZ0RlYnVnKCdldmVudENsaWVudFNlbGVjdGVkMiB5ZXMgc2VsZWN0ZWQgJyArIHNlbGVjdGVkLm9yaWdpbmFsT2JqZWN0LmZpcnN0X25hbWUpOwogICAgICAgICAgJHNjb3BlLmV2ZW50QWRkRW5kVXNlcihzZWxlY3RlZC5vcmlnaW5hbE9iamVjdC5idXNpbmVzc191c2VyX2lkKTsKICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnYW5ndWNvbXBsZXRlLWFsdDpjbGVhcklucHV0JywgJ2NsaWVudF9hbmd1Y29tcGxldGUnKTsKCiAgICAgIH0gZWxzZSB7CiAgICAgICAgICBsb2dEZWJ1Zygnbm90IHNlbGVjdGVkJyk7CiAgICAgIH0KICB9OwoKICAkc2NvcGUuZXZlbnRBZGRFbmRVc2VyID0gZnVuY3Rpb24oZW5kdXNlcl9pZCkKICB7CiAgICBhZGRFbmRVc2VyVG9FdmVudCgkaHR0cCwkc2NvcGUsZW5kdXNlcl9pZCwkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkLGFkZEVuZFVzZXJUb0V2ZW50X2ZpbmlzaCwgYWRkRW5kVXNlclRvRXZlbnRfZmluaXNoKTsKICAgIGZ1bmN0aW9uIGFkZEVuZFVzZXJUb0V2ZW50X2ZpbmlzaCgpCiAgICB7CiAgICAgIGdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCk7CiAgICB9CiAgfTsKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ0V2ZW50UGFnZUNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICR0aW1lb3V0LCAkaHR0cCwgJHVpYk1vZGFsICxzaGFyZWRQcm9wZXJ0aWVzLCAkcm91dGVQYXJhbXMsICRyb290U2NvcGUsICRsb2NhdGlvbiwgJHJvdXRlLCBzaGFyZWREYXRhKQp7CiAgbG9nRGVidWcoIkV2ZW50UGFnZUNvbnRyb2xsZXIiKTsKCiAgZ2V0QWxsSW5zdHJ1Y3RvcnNJbmNJbmFjdGl2ZSgkaHR0cCwkc2NvcGUsJ2luc3RydWN0b3JzJyxnZXRBbGxJbnN0cnVjdG9yc0luY0luYWN0aXZlX3N1Y2Nlc3MpOwogIGdldEJ1c2luZXNzTG9jYXRpb25zKCRodHRwLCRzY29wZSwnYnVzaW5lc3NfbG9jYXRpb25zJyk7CgogIGZ1bmN0aW9uIGdldEFsbEluc3RydWN0b3JzSW5jSW5hY3RpdmVfc3VjY2VzcygpCiAgewogICAgZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLHNldFBhcnRpY2lwYXRlZCk7CiAgfQoKICAkc2NvcGUuZXh0cmFGaWVsZHNBbGVydE1lc3NhZ2U9bnVsbDsKCiAgJHNjb3BlLnVwZGF0ZUV2ZW50VGl0bGUgPSBmdW5jdGlvbihuZXdWYWx1ZSxjdXJyZW50RXZlbnQpCiAgewogICAgbmV3X3RpdGxlPW5ld1ZhbHVlOwogICAgc2V0RXZlbnRUaXRsZSgkaHR0cCwkc2NvcGUsY3VycmVudEV2ZW50LmV2ZW50X2lkLCBuZXdfdGl0bGUsIHVwZGF0ZUV2ZW50X2NhbGxiYWNrLCB1cGRhdGVFdmVudF9jYWxsYmFjayk7CgogICAgZnVuY3Rpb24gdXBkYXRlRXZlbnRfY2FsbGJhY2soKQogICAgewogICAgICBnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkKTsKICAgIH0KCiAgfTsKCgogICRzY29wZS51cGRhdGVFdmVudEV4dHJhRmllbGRzID0gZnVuY3Rpb24oKQogIHsKICAgIGxvZ0RlYnVnKCJ1cGRhdGVFdmVudEV4dHJhRmllbGRzIik7CiAgICB0aGVkYXRhID0gewogICAgICAgZXh0cmFGaWVsZHM6JHNjb3BlLmN1cnJlbnRFdmVudC5leHRyYUZpZWxkcwogICAgICB9OwogICAgJHNjb3BlLmV4dHJhRmllbGRzQWxlcnRNZXNzYWdlPSLXntei15PXm9efINeg16rXldeg15nXnSwg15DXoNeQINeU157XqtefLi4uIjsKICAgIHVwZGF0ZUV2ZW50RXh0cmFGaWVsZHMoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCx0aGVkYXRhLHVwZGF0ZUV2ZW50RXh0cmFGaWVsZHNfY2FsbGJhY2ssIHVwZGF0ZUV2ZW50RXh0cmFGaWVsZHNfY2FsbGJhY2spOwoKICAgIGZ1bmN0aW9uIHVwZGF0ZUV2ZW50RXh0cmFGaWVsZHNfY2FsbGJhY2soKQogICAgewogICAgICBnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkcm91dGVQYXJhbXMuZXZlbnRfaWQsc2V0UGFydGljaXBhdGVkKTsKICAgICAgJHNjb3BlLmV4dHJhRmllbGRzQWxlcnRNZXNzYWdlPSLXqteZ16LXldeTINeg16nXnteoINeR15TXptec15fXlCEiOwogICAgICAkdGltZW91dChmdW5jdGlvbigpCiAgICAgIHsKICAgICAgICAkc2NvcGUuZXh0cmFGaWVsZHNBbGVydE1lc3NhZ2U9bnVsbDsKICAgICAgfSwgMzAwMCk7CiAgICB9CiAgfTsKCiAgJHNjb3BlLnJlc2NoZWR1bGVFdmVudCA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1Zygic2VldGluZyBldmVudCB0byBtb3ZlICAiKyRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXSk7CiAgICBzaGFyZWRQcm9wZXJ0aWVzLnNldF9ldmVudF9yZXNjaGVkdWxlKCRzY29wZS5jdXJyZW50RXZlbnQpOwogICAgLy8gdXNlcl9pbmZvPSB7CiAgICAvLyAgICAgdXNlcl9pZDogJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudFVzZXJzWzBdLnVzZXJfaWQsCiAgICAvLyAgICAgYnVzZXJfZmlyc3RfbmFtZTogJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudFVzZXJzWzBdLmJ1c2VyX2ZpcnN0X25hbWUsCiAgICAvLyAgICAgYnVzZXJfbGFzdF9uYW1lOiAkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfbGFzdF9uYW1lCiAgICAvLyB9OwogICAgLy8gc2hhcmVkUHJvcGVydGllcy5zZXRfc2VsZWN0ZWRfdXNlcih1c2VyX2luZm8pOwogICAgJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jYWxlbmRhcicpOwogIH0KCiAgJHNjb3BlLnVwZGF0ZUxvY2F0aW9uRXZlbnQgPSBmdW5jdGlvbigpCiAgewogICAgY29uc29sZS5sb2coImZ1bmN0aW9uOiB1cGRhdGVMb2NhdGlvbkV2ZW50Iik7CiAgICB1cGRhdGVFdmVudExvY2F0aW9uKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuZXZlbnRfaWQsJHNjb3BlLmN1cnJlbnRFdmVudC5sb2NhdGlvbl9pZCx1cGRhdGVFdmVudExvY2F0aW9uX2NhbGxiYWNrLCB1cGRhdGVFdmVudExvY2F0aW9uX2NhbGxiYWNrKTsKICAgICRzY29wZS51cGRhdGVMb2NhdGlvbkFsZXJ0TWVzc2FnZT0i157XoteT15vXnyDXodeY15jXldehLi4uIjsKICAgIGZ1bmN0aW9uIHVwZGF0ZUV2ZW50TG9jYXRpb25fY2FsbGJhY2soKQogICAgewogICAgICAkc2NvcGUudXBkYXRlTG9jYXRpb25BbGVydE1lc3NhZ2U9Itei15XXk9eb158g15HXlNem15zXl9eUISI7CiAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkKICAgICAgewogICAgICAgICRzY29wZS51cGRhdGVMb2NhdGlvbkFsZXJ0TWVzc2FnZT1udWxsOwogICAgICB9LCAxNTAwKTsKICAgIH0KICB9OwoKICAkc2NvcGUudXBkYXRlSW5zdHJ1Y3RvckV2ZW50ID0gZnVuY3Rpb24oKQogIHsKICAgIGNvbnNvbGUubG9nKCJmdW5jdGlvbjogdXBkYXRlSW5zdHJ1Y3RvckV2ZW50Iik7CiAgICB1cGRhdGVFdmVudEluc3RydWN0b3IoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCwkc2NvcGUuY3VycmVudEV2ZW50Lmluc3RydWN0b3JfaWQsdXBkYXRlRXZlbnRJbnN0cnVjdG9yX2NhbGxiYWNrLCB1cGRhdGVFdmVudEluc3RydWN0b3JfY2FsbGJhY2spOwogICAgJHNjb3BlLnVwZGF0ZUluc3RydWN0b3JBbGVydE1lc3NhZ2U9Itee16LXk9eb158g16HXmNeY15XXoS4uLiI7CiAgICBmdW5jdGlvbiB1cGRhdGVFdmVudEluc3RydWN0b3JfY2FsbGJhY2soKQogICAgewogICAgICAkc2NvcGUudXBkYXRlSW5zdHJ1Y3RvckFsZXJ0TWVzc2FnZT0i16LXldeT15vXnyDXkdeU16bXnNeX15QhIjsKICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKQogICAgICB7CiAgICAgICAgJHNjb3BlLnVwZGF0ZUluc3RydWN0b3JBbGVydE1lc3NhZ2U9bnVsbDsKICAgICAgfSwgMTUwMCk7CiAgICB9CiAgfTsKCiAgJHNjb3BlLmluaXRpYXRlUGF5bWVudCA9IGZ1bmN0aW9uKGlzcGx1cykKICB7CiAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAgICAgICBhbmltYXRpb246IGZhbHNlLAogICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2NsaWVudF9wYXltZW50LnBocCcsCiAgICAgICAgY29udHJvbGxlcjogJ2J1c2luZXNzQ2xpZW5kQ2FyZFBheW1lbnQnLAogICAgICAgIC8vIHNpemU6IHNpemUsCiAgICAgICAgcmVzb2x2ZTogewogICAgICAgICAgY3VycmVudENsaWVudDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgcmV0dXJuICRzY29wZS5jdXJyZW50RXZlbnRDbGllbnRzWzBdOwogICAgICAgICAgfSwKICAgICAgICAgIGlzcGx1czogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGlzcGx1czsKICAgICAgICAgIH0KICAgICAgICB9CiAgICB9KTsKICB9CgogICRzY29wZS5kZWxldGVFdmVudD1mdW5jdGlvbiAoKQogIHsKICAgIC8vIGNoZWNraW5nIGlmIGNhbmNlbGluZyBhIGdlbmVyY190eXBlIGV2ZW50IC0gdGhlbiB0aGVyZSdzIG5vIHVzZXIKICAgIGlmICgkc2NvcGUuY3VycmVudEV2ZW50LmlzX2dlbmVyaWNfZXR5cGU9PTEpCiAgICB7CiAgICAgIGNhbmNlbFNpbmdsZUV2ZW50KCRodHRwLCRzY29wZSwwLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCxjYW5jZWxTaW5nbGVFdmVudF9jYWxsYmFjaywgY2FuY2VsU2luZ2xlRXZlbnRfY2FsbGJhY2spOwogICAgfQogICAgZWxzZQogICAgewogICAgICBjYW5jZWxTaW5nbGVFdmVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudFVzZXJzWzBdLmJ1c2luZXNzX3VzZXJfaWQsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLGNhbmNlbFNpbmdsZUV2ZW50X2NhbGxiYWNrLCBjYW5jZWxTaW5nbGVFdmVudF9jYWxsYmFjayk7CiAgICB9CiAgICBmdW5jdGlvbiBjYW5jZWxTaW5nbGVFdmVudF9jYWxsYmFjaygpCiAgICB7CiAgICAgIGdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCxzZXRQYXJ0aWNpcGF0ZWQpOwogICAgfQogIH0KCiAgJHNjb3BlLnNldFBhcnRpY2lwYXRpb25TdGF0dXMgPSBmdW5jdGlvbigpCiAgewogICAgc2V0RXZlbnRVc2VyUGFydGljaXBhdGlvblN0YXR1cygkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRVc2Vyc1swXS5idXNpbmVzc191c2VyX2lkLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRVc2Vyc1swXS5ldmVudF91c2VyX3N0YXR1c19pZCxzZXRQYXJ0aWNpcGF0aW9uU3RhdHVzX2NhbGxiYWNrLCBzZXRQYXJ0aWNpcGF0aW9uU3RhdHVzX2NhbGxiYWNrKTsKICAgICRzY29wZS51cGRhdGVTdGF0dXNBbGVydE1lc3NhZ2U9Itee16LXk9eb158g16HXmNeY15XXoS4uLiI7CiAgICBmdW5jdGlvbiBzZXRQYXJ0aWNpcGF0aW9uU3RhdHVzX2NhbGxiYWNrKCkKICAgIHsKICAgICAgLy8gZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLHNldFBhcnRpY2lwYXRlZCk7CiAgICAgIHNldFBhcnRpY2lwYXRlZCgpOwogICAgICAkc2NvcGUudXBkYXRlU3RhdHVzQWxlcnRNZXNzYWdlPSLXoteV15PXm9efINeR15TXptec15fXlCEiOwogICAgICAkdGltZW91dChmdW5jdGlvbigpCiAgICAgIHsKICAgICAgICAkc2NvcGUudXBkYXRlU3RhdHVzQWxlcnRNZXNzYWdlPW51bGw7CiAgICAgIH0sIDI1MDApOwogICAgfQogIH0KCiAgZnVuY3Rpb24gc2V0UGFydGljaXBhdGVkKCkKICB7CiAgICBsb2dEZWJ1ZygiZ2V0IGNsaWVudCBpbmZvIik7CiAgICBnZXRCdXNpbmVzc0NsaWVudEluZm8oJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnRDbGllbnRzJywkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50VXNlcnNbMF0uYnVzaW5lc3NfdXNlcl9pZCk7CiAgICBsb2dEZWJ1Zygic2V0dGluZyBzZXRQYXJ0aWNpcGF0ZWQiKTsKICAgIGlmICgkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50VXNlcnNbMF0uc3RhdHVzX25hbWUhPSRnVXNlcl9zdGF0dXNfYWJzZW50ZWQpCiAgICB7CiAgICAgICRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRVc2Vyc1swXS5wYXJ0aWNpcGF0ZWQ9dHJ1ZTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudFVzZXJzWzBdLnBhcnRpY2lwYXRlZD1mYWxzZTsKICAgIH0KCiAgICAvLyB0aGlzIGxvb3AgaXMgZm9yIGZpeGluZyB0aGUgZGF0ZSBmb3JtYXQgdG8gYXBwZWFyIHByb3Blcmx5IGluIHRoZSBpbnB1dCBkYXRlIGh0bWwgb2JqZWN0CiAgICBmb3IgKGkgPSAwOyBpPCAoJHNjb3BlLmN1cnJlbnRFdmVudC5leHRyYUZpZWxkcykubGVuZ3RoOyBpKyspCiAgICB7CiAgICAgIGxvZ0RlYnVnKCRzY29wZS5jdXJyZW50RXZlbnQuZXh0cmFGaWVsZHNbaV0pOwogICAgICBpZiAoJHNjb3BlLmN1cnJlbnRFdmVudC5leHRyYUZpZWxkc1tpXS5maWVsZF9kYXRhdHlwZT09IkRBVEUiKQogICAgICB7CiAgICAgICAgLy8gbG9nRGVidWcoImRhdGUiKTsKICAgICAgICAkc2NvcGUuY3VycmVudEV2ZW50LmV4dHJhRmllbGRzW2ldLmZpZWxkX3ZhbHVlPW5ldyBEYXRlKCRzY29wZS5jdXJyZW50RXZlbnQuZXh0cmFGaWVsZHNbaV0uZmllbGRfdmFsdWUpOwogICAgICB9CiAgICB9CgogICAgbG9nRGVidWcoIiRzY29wZS5jdXJyZW50RXZlbnQuaW5zdHJ1Y3Rvcl9pZDs9Iiskc2NvcGUuY3VycmVudEV2ZW50Lmluc3RydWN0b3JfaWQpOwogICAgZm9yKHZhciBpID0gMDsgaSA8ICRzY29wZS5pbnN0cnVjdG9ycy5sZW5ndGg7IGkrKykKICAgIHsKICAgICAgbG9nRGVidWcoJHNjb3BlLmluc3RydWN0b3JzW2ldLmlzX2FjdGl2ZSk7CiAgICAgIGlmICgkc2NvcGUuaW5zdHJ1Y3RvcnNbaV0uYnVzaW5lc3NfdXNlcl9pZD09JHNjb3BlLmN1cnJlbnRFdmVudC5pbnN0cnVjdG9yX2lkKQogICAgICB7CiAgICAgICAgbG9nRGVidWcoInllc2giKTsKICAgICAgICAkc2NvcGUuaW5zdHJ1Y3RvcnNbaV0uaXNfYWN0aXZlPTE7CiAgICAgIH0KICAgIH0KICB9CgogICRzY29wZS51cGRhdGVVc2VyRXZlbnRQcmljZSA9IGZ1bmN0aW9uKG5ld3ZhbHVlLCB0aGVldmVudCkKICB7CiAgICBuZXdfcHJpY2U9bmV3dmFsdWU7CiAgICBzZXRDbGllbnRFdmVudFByaWNlKCRodHRwLCRzY29wZSwkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50VXNlcnNbMF0uYnVzaW5lc3NfdXNlcl9pZCx0aGVldmVudC5ldmVudF9pZCwgbmV3X3ByaWNlLHNldENsaWVudEV2ZW50UHJpY2VfY2FsbGJhY2ssIHNldENsaWVudEV2ZW50UHJpY2VfY2FsbGJhY2spOwogICAgZnVuY3Rpb24gc2V0Q2xpZW50RXZlbnRQcmljZV9jYWxsYmFjaygpCiAgICB7CiAgICAgIGdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCxzZXRQYXJ0aWNpcGF0ZWQpOwogICAgfQogIH07CgogICRzY29wZS4kb24oImV2ZW50UGFnZVJlbG9hZERhdGEiLGZ1bmN0aW9uKGUsYSkKICB7CiAgICBnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkcm91dGVQYXJhbXMuZXZlbnRfaWQsc2V0UGFydGljaXBhdGVkKTsKICB9KTsKCiAgJHNjb3BlLmNsb3NlRXZlbnQgPSBmdW5jdGlvbigpCiAgewogICAgbG9nRGVidWcoImNoZWNraW5nIGlmIGV2ZW50IGhhcyBleHRyYSBmaWVsZHMgdGhhdCBhcmUgcmVxdWlyZWQgYmVmb3JlIGNsb3NpbmcgaXQiKTsKICAgIGNoZWNrRXZlbnRFeHRyYUZpZWxkcygkaHR0cCwkc2NvcGUsJ2NoZWNrRXZlbnRFeHRyYUZpZWxkcycsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLGNoZWNrRXZlbnRFeHRyYUZpZWxkc19zdWNjZXNzKTsKICAgIGZ1bmN0aW9uIGNoZWNrRXZlbnRFeHRyYUZpZWxkc19zdWNjZXNzKCkKICAgIHsKICAgICAgaWYgKCRzY29wZS5jaGVja0V2ZW50RXh0cmFGaWVsZHM9PXRydWUpCiAgICAgIHsKICAgICAgICBsb2dEZWJ1ZygiZXZlbnQgaGFzIGFsbCBleHRyYSBmaWVsZHMgb2ssIGNsb3NpbmcgZXZlbnQiKTsKICAgICAgICAvLyAkc2NvcGUuY3VycmVudEV2ZW50Lmlnbm9yZUV4dHJhRmllbGRzVmFsaWRhdGlvbj10cnVlOwogICAgICAgIGNsb3NlRXZlbnQoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCwkc2NvcGUuY3VycmVudEV2ZW50LGFmdGVyQ2xvc2VFdmVudCxhZnRlckNsb3NlRXZlbnQpOwogICAgICAgIGZ1bmN0aW9uIGFmdGVyQ2xvc2VFdmVudCgpCiAgICAgICAgewogICAgICAgICAgZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLHNldFBhcnRpY2lwYXRlZCk7CiAgICAgICAgfTsKICAgICAgfQogICAgICBlbHNlCiAgICAgIHsKICAgICAgICBsb2dEZWJ1ZygiZXZlbnQgaGFzIGV4dHJhIGZpZWxkcyByZXF1aXJlZCB0aGF0IGFyZSBub3QgZmlsbGVkIik7CiAgICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgICAgICAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2V2ZW50X2Nsb3NlX2lnbm9yZV9tYW5kYXRvcnlfZmllbGRzLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdldmVudENsb3NlSWdub3JlTWFuZGF0b3J5RmllbGRzTW9kYWxDb250cm9sbGVyJywKICAgICAgICAgICAgc2l6ZTogJ20nLAogICAgICAgICAgICByZXNvbHZlOiB7CiAgICAgICAgICAgICAgICBjdXJyZW50RXZlbnQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuY3VycmVudEV2ZW50OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICB9CiAgJHNjb3BlLnJlb3BlbkV2ZW50ID0gZnVuY3Rpb24oKQogIHsKICAgIGxvZ0RlYnVnKCJyZW9wZW5FdmVudCIpOwogICAgcmVvcGVuRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQsJHNjb3BlLmN1cnJlbnRFdmVudCxhZnRlclJlb3BlbkV2ZW50LGFmdGVyUmVvcGVuRXZlbnQpOwogICAgZnVuY3Rpb24gYWZ0ZXJSZW9wZW5FdmVudCgpCiAgICB7CiAgICAgIGdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQsc2V0UGFydGljaXBhdGVkKTsKICAgIH07CiAgfQoKfSk7CgprdXplQXBwLmZpbHRlcignc3RhcnRGcm9tJywgZnVuY3Rpb24oKQp7CiAgICByZXR1cm4gZnVuY3Rpb24oaW5wdXQsIHN0YXJ0KQogICAgewogICAgICAgaWYoIWlucHV0KSByZXR1cm4gW107CiAgICAgICAgLy8gY29uc29sZS5sb2coImhlcmVyZWVlICIraW5wdXQpOwogICAgICAgIHN0YXJ0ID0gK3N0YXJ0OyAvL3BhcnNlIHRvIGludAogICAgICAgIHJldHVybiBpbnB1dC5zbGljZShzdGFydCk7CiAgICB9Cn0pOwovLyBhbmd1bGFyIGZpbHRlciBmb3IgZXZlbnRzIGJlZm9yZS9hZnRlciB0b2RheQprdXplQXBwLmZpbHRlcignYmVmb3JlTm93JywgZnVuY3Rpb24oKSB7CiAgLy8gQ3JlYXRlIHRoZSByZXR1cm4gZnVuY3Rpb24gYW5kIHNldCB0aGUgcmVxdWlyZWQgcGFyYW1ldGVyIG5hbWUgdG8gKippbnB1dCoqCiByZXR1cm4gZnVuY3Rpb24oaW5wdXQpIHsKICAgdmFyIG91dCA9IFtdOwoKICAgLy8gVXNpbmcgdGhlIGFuZ3VsYXIuZm9yRWFjaCBtZXRob2QsIGdvIHRocm91Z2ggdGhlIGFycmF5IG9mIGRhdGEgYW5kIHBlcmZvcm0gdGhlIG9wZXJhdGlvbiBvZiBmaWd1cmluZyBvdXQgaWYgdGhlIGxhbmd1YWdlIGlzIHN0YXRpY2FsbHkgb3IgZHluYW1pY2FsbHkgdHlwZWQuCiAgIHZhciBicm93c2VyX2Vwb2NoID0gKG5ldyBEYXRlKS5nZXRUaW1lKCk7CgogICBhbmd1bGFyLmZvckVhY2goaW5wdXQsIGZ1bmN0aW9uKGV2ZW50KQogICB7CiAgICAvLyAgbG9nRGVidWcoImZpbHRlcmluZywgZXZlbnQuZXZlbnRfdXNlcl9zdGF0dXNfaWQ9IitldmVudC5ldmVudF91c2VyX3N0YXR1c19pZCk7CiAgICAgaWYgKGV2ZW50LnN0YXJ0X2Vwb2NoIDw9IChicm93c2VyX2Vwb2NoLzEwMDApKQogICAgIHsKICAgICAgIG91dC5wdXNoKGV2ZW50KQogICAgIH0KICAgfSkKICAgcmV0dXJuIG91dDsKIH0KfSk7Cmt1emVBcHAuZmlsdGVyKCdhZnRlck5vdycsIGZ1bmN0aW9uKCkgewogIC8vIENyZWF0ZSB0aGUgcmV0dXJuIGZ1bmN0aW9uIGFuZCBzZXQgdGhlIHJlcXVpcmVkIHBhcmFtZXRlciBuYW1lIHRvICoqaW5wdXQqKgogcmV0dXJuIGZ1bmN0aW9uKGlucHV0KSB7CiAgIHZhciBvdXQgPSBbXTsKCiAgIC8vIFVzaW5nIHRoZSBhbmd1bGFyLmZvckVhY2ggbWV0aG9kLCBnbyB0aHJvdWdoIHRoZSBhcnJheSBvZiBkYXRhIGFuZCBwZXJmb3JtIHRoZSBvcGVyYXRpb24gb2YgZmlndXJpbmcgb3V0IGlmIHRoZSBsYW5ndWFnZSBpcyBzdGF0aWNhbGx5IG9yIGR5bmFtaWNhbGx5IHR5cGVkLgogICB2YXIgYnJvd3Nlcl9lcG9jaCA9IChuZXcgRGF0ZSkuZ2V0VGltZSgpOwoKICAgYW5ndWxhci5mb3JFYWNoKGlucHV0LCBmdW5jdGlvbihldmVudCkKICAgewogICAgLy8gIGxvZ0RlYnVnKCJmaWx0ZXJpbmcsIGV2ZW50LmV2ZW50X3VzZXJfc3RhdHVzX2lkPSIrZXZlbnQuZXZlbnRfdXNlcl9zdGF0dXNfaWQpOwogICAgIGlmIChldmVudC5zdGFydF9lcG9jaCA+IChicm93c2VyX2Vwb2NoLzEwMDApKQogICAgIHsKICAgICAgIG91dC5wdXNoKGV2ZW50KQogICAgIH0KICAgfSkKICAgcmV0dXJuIG91dDsKIH0KfSk7CgprdXplQXBwLmZpbHRlcignaXNBY3RpdmUnLCBmdW5jdGlvbigpIHsKICAvLyBDcmVhdGUgdGhlIHJldHVybiBmdW5jdGlvbiBhbmQgc2V0IHRoZSByZXF1aXJlZCBwYXJhbWV0ZXIgbmFtZSB0byAqKmlucHV0KioKIHJldHVybiBmdW5jdGlvbihpbnB1dCkgewogICB2YXIgb3V0ID0gW107CgogICAvLyBVc2luZyB0aGUgYW5ndWxhci5mb3JFYWNoIG1ldGhvZCwgZ28gdGhyb3VnaCB0aGUgYXJyYXkgb2YgZGF0YSBhbmQgcGVyZm9ybSB0aGUgb3BlcmF0aW9uIG9mIGZpZ3VyaW5nIG91dCBpZiB0aGUgbGFuZ3VhZ2UgaXMgc3RhdGljYWxseSBvciBkeW5hbWljYWxseSB0eXBlZC4KCiAgIGFuZ3VsYXIuZm9yRWFjaChpbnB1dCwgZnVuY3Rpb24oZXZlbnQpCiAgIHsKICAgIC8vICBsb2dEZWJ1ZygiZmlsdGVyaW5nLCBldmVudC5ldmVudF91c2VyX3N0YXR1c19pZD0iK2V2ZW50LmV2ZW50X3VzZXJfc3RhdHVzX2lkKTsKICAgICBpZiAoZXZlbnQuaXNfYWN0aXZlPT0xKQogICAgIHsKICAgICAgIG91dC5wdXNoKGV2ZW50KQogICAgIH0KICAgfSkKICAgcmV0dXJuIG91dDsKIH0KfSk7CgprdXplQXBwLmZpbHRlcignc2hvdWxkX2JlX2Rpc3BsYXllZCcsIGZ1bmN0aW9uKCkgewogIC8vIENyZWF0ZSB0aGUgcmV0dXJuIGZ1bmN0aW9uIGFuZCBzZXQgdGhlIHJlcXVpcmVkIHBhcmFtZXRlciBuYW1lIHRvICoqaW5wdXQqKgogcmV0dXJuIGZ1bmN0aW9uKGlucHV0KSB7CiAgIHZhciBvdXQgPSBbXTsKCiAgIC8vIFVzaW5nIHRoZSBhbmd1bGFyLmZvckVhY2ggbWV0aG9kLCBnbyB0aHJvdWdoIHRoZSBhcnJheSBvZiBkYXRhIGFuZCBwZXJmb3JtIHRoZSBvcGVyYXRpb24gb2YgZmlndXJpbmcgb3V0IGlmIHRoZSBsYW5ndWFnZSBpcyBzdGF0aWNhbGx5IG9yIGR5bmFtaWNhbGx5IHR5cGVkLgoKICAgYW5ndWxhci5mb3JFYWNoKGlucHV0LCBmdW5jdGlvbihldmVudCkKICAgewogICAgLy8gIGxvZ0RlYnVnKCJmaWx0ZXJpbmcsIGV2ZW50LmV2ZW50X3VzZXJfc3RhdHVzX2lkPSIrZXZlbnQuZXZlbnRfdXNlcl9zdGF0dXNfaWQpOwogICAgIGlmIChldmVudC5zaG91bGRfYmVfZGlzcGxheWVkPT0xKQogICAgIHsKICAgICAgIG91dC5wdXNoKGV2ZW50KQogICAgIH0KICAgfSkKICAgcmV0dXJuIG91dDsKIH0KfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ0luc3RydWN0b3JTaG93MUNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICR0aW1lb3V0LCAkaHR0cCwgc2hhcmVkUHJvcGVydGllcywgJHJvb3RTY29wZSwgJHJvdXRlUGFyYW1zLCAkbG9jYXRpb24sICRyb3V0ZSwgc2hhcmVkRGF0YSwgJHVpYk1vZGFsKQp7CiAgZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLGdldEJ1c2luZXNzQ2xpZW50SW5mb19zdWNjZXNzKTsKCiAgZnVuY3Rpb24gZ2V0QnVzaW5lc3NDbGllbnRJbmZvX3N1Y2Nlc3MoKQogIHsKICAgIGdldENsaWVudEV4dHJhRmllbGRzKCRodHRwLCRzY29wZSwkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYnVzaW5lc3NfdXNlcl9pZCwnY2xpZW50RXh0cmFGaWVsZHMnLGdldENsaWVudEV4dHJhRmllbGRzX3N1Y2Nlc3MpOwoKICAgIGZ1bmN0aW9uIGdldENsaWVudEV4dHJhRmllbGRzX3N1Y2Nlc3MoKQogICAgewogICAgICBmb3IgKGkgPSAwOyBpPCAoJHNjb3BlLmNsaWVudEV4dHJhRmllbGRzKS5sZW5ndGg7IGkrKykKICAgICAgewogICAgICAgIGxvZ0RlYnVnKCRzY29wZS5jbGllbnRFeHRyYUZpZWxkc1tpXSk7CiAgICAgICAgaWYgKCRzY29wZS5jbGllbnRFeHRyYUZpZWxkc1tpXS5maWVsZF9kYXRhdHlwZT09IkRBVEUiKQogICAgICAgIHsKICAgICAgICAgIC8vIGxvZ0RlYnVnKCJkYXRlIik7CiAgICAgICAgICAkc2NvcGUuY2xpZW50RXh0cmFGaWVsZHNbaV0uZmllbGRfdmFsdWU9bmV3IERhdGUoJHNjb3BlLmNsaWVudEV4dHJhRmllbGRzW2ldLmZpZWxkX3ZhbHVlKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CgogICRzY29wZS5hcmNoaXZlQ2xpZW50TW9kYWwgPSBmdW5jdGlvbigpCiAgewogICAgLy8gYXJjaGl2ZS9kZWxldGUgY2xpZW50IC0gYXNrIGlmIHN1cmUKICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewogICAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYXJjaGl2ZV9jbGllbnRfbW9kYWwucGhwJywKICAgICAgICBzaXplOiAneHMnLAogICAgICAgIGNvbnRyb2xsZXI6ICdhcmNoaXZlX2NsaWVudF9tb2RhbCcsICAvLyAncGF5bWVueURldGFpbHNNb2RhbENvbnRyb2xsZXInLAogICAgICAgIHJlc29sdmU6IHsKICAgICAgICAgIGJ1c2luZXNzX3VzZXJfaWQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYnVzaW5lc3NfdXNlcl9pZDsKICAgICAgICAgIH0sCiAgICAgICAgICBidXNlcl9sYXN0X25hbWU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYnVzZXJfbGFzdF9uYW1lOwogICAgICAgICAgfSwKICAgICAgICAgIGJ1c2VyX2ZpcnN0X25hbWU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYnVzZXJfZmlyc3RfbmFtZTsKICAgICAgICAgIH0sCiAgICAgICAgICBpc19pbnN0cnVjdG9yOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICB9KTsKICB9CgogICRzY29wZS51cGRhdGVVc2VyRmlyc3ROYW1lID0gZnVuY3Rpb24obmV3VmFsdWUpCiAgewogICAgc2V0Q2xpZW50Rmlyc3ROYW1lKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCxuZXdWYWx1ZSxhZnRlckNsaWVudFNldCxhZnRlckNsaWVudFNldCk7CiAgICBmdW5jdGlvbiBhZnRlckNsaWVudFNldCgpCiAgICB7CiAgICAgIGdldEJ1c2luZXNzQ2xpZW50SW5mbygkaHR0cCwkc2NvcGUsJ2Zvcm1VcGRhdGVDbGllbnRBbmd1bGFyJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CiAgICB9CiAgfQogICRzY29wZS51cGRhdGVVc2VyTGFzdE5hbWUgPSBmdW5jdGlvbihuZXdWYWx1ZSkKICB7CiAgICBzZXRDbGllbnRMYXN0TmFtZSgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsbmV3VmFsdWUsYWZ0ZXJDbGllbnRTZXQsYWZ0ZXJDbGllbnRTZXQpOwogICAgZnVuY3Rpb24gYWZ0ZXJDbGllbnRTZXQoKQogICAgewogICAgICBnZXRCdXNpbmVzc0NsaWVudEluZm8oJGh0dHAsJHNjb3BlLCdmb3JtVXBkYXRlQ2xpZW50QW5ndWxhcicsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwogICAgfQogIH0KICAkc2NvcGUudXBkYXRlVXNlclBob25lTnVtYmVyID0gZnVuY3Rpb24obmV3VmFsdWUpCiAgewogICAgbmV3VmFsdWUgPSBuZXdWYWx1ZS5yZXBsYWNlKCctJywnJyk7CiAgICBpZiAoaXNOYU4obmV3VmFsdWUpKQogICAgewogICAgICBhbGVydCgi15DXoNeQINeU15bXnyDXnteh16TXqCDXmNec16TXldefINeq16fXmdefIik7CiAgICAgIGdldEJ1c2luZXNzQ2xpZW50SW5mbygkaHR0cCwkc2NvcGUsJ2Zvcm1VcGRhdGVDbGllbnRBbmd1bGFyJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgIHNldENsaWVudFBob25lTnVtYmVyKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCxuZXdWYWx1ZSxzZXRDbGllbnRQaG9uZU51bWJlcl9jYWxsYmFjayxzZXRDbGllbnRQaG9uZU51bWJlcl9jYWxsYmFjayk7CiAgICAgIGZ1bmN0aW9uIHNldENsaWVudFBob25lTnVtYmVyX2NhbGxiYWNrKCkKICAgICAgewogICAgICAgIGdldEJ1c2luZXNzQ2xpZW50SW5mbygkaHR0cCwkc2NvcGUsJ2Zvcm1VcGRhdGVDbGllbnRBbmd1bGFyJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CiAgICAgIH0KICAgIH0KICB9Cgp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ0NsaWVudHNTaG93MUNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICR0aW1lb3V0LCAkaHR0cCwgc2hhcmVkUHJvcGVydGllcywgJHJvb3RTY29wZSwgJHJvdXRlUGFyYW1zLCAkbG9jYXRpb24sICRyb3V0ZSwgc2hhcmVkRGF0YSwgJHVpYk1vZGFsKQp7CiAgICBnZXRCdXNpbmVzc0NsaWVudEluZm8oJGh0dHAsJHNjb3BlLCdmb3JtVXBkYXRlQ2xpZW50QW5ndWxhcicsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsZ2V0QnVzaW5lc3NDbGllbnRJbmZvX3N1Y2Nlc3MpOwoKICAgIGZ1bmN0aW9uIGdldEJ1c2luZXNzQ2xpZW50SW5mb19zdWNjZXNzKCkKICAgIHsKICAgICAgZ2V0Q2xpZW50RXh0cmFGaWVsZHMoJGh0dHAsJHNjb3BlLCRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5idXNpbmVzc191c2VyX2lkLCdjbGllbnRFeHRyYUZpZWxkcycsZ2V0Q2xpZW50RXh0cmFGaWVsZHNfc3VjY2Vzcyk7CgogICAgICBmdW5jdGlvbiBnZXRDbGllbnRFeHRyYUZpZWxkc19zdWNjZXNzKCkKICAgICAgewogICAgICAgIGZvciAoaSA9IDA7IGk8ICgkc2NvcGUuY2xpZW50RXh0cmFGaWVsZHMpLmxlbmd0aDsgaSsrKQogICAgICAgIHsKICAgICAgICAgIGxvZ0RlYnVnKCRzY29wZS5jbGllbnRFeHRyYUZpZWxkc1tpXSk7CiAgICAgICAgICBpZiAoJHNjb3BlLmNsaWVudEV4dHJhRmllbGRzW2ldLmZpZWxkX2RhdGF0eXBlPT0iREFURSIpCiAgICAgICAgICB7CiAgICAgICAgICAgIC8vIGxvZ0RlYnVnKCJkYXRlIik7CiAgICAgICAgICAgICRzY29wZS5jbGllbnRFeHRyYUZpZWxkc1tpXS5maWVsZF92YWx1ZT1uZXcgRGF0ZSgkc2NvcGUuY2xpZW50RXh0cmFGaWVsZHNbaV0uZmllbGRfdmFsdWUpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQp7CiAgICBnZXRDbGllbnRFdmVudHMoJGh0dHAsJHNjb3BlLCdjdXJyZW50Q2xpZW50RXZlbnRzJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CgogICAgZ2V0Q2xpZW50UGF5bWVudHMoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLCdjdXJyZW50Q2xpZW50UGF5bWVudHMnKTsKCiAgICAkc2NvcGUuYXJjaGl2ZUNsaWVudE1vZGFsID0gZnVuY3Rpb24oKQogICAgewogICAgICAvLyBhcmNoaXZlL2RlbGV0ZSBjbGllbnQgLSBhc2sgaWYgc3VyZQogICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAgICAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdhcmNoaXZlX2NsaWVudF9tb2RhbC5waHAnLAogICAgICAgICAgc2l6ZTogJ3hzJywKICAgICAgICAgIGNvbnRyb2xsZXI6ICdhcmNoaXZlX2NsaWVudF9tb2RhbCcsICAvLyAncGF5bWVueURldGFpbHNNb2RhbENvbnRyb2xsZXInLAogICAgICAgICAgcmVzb2x2ZTogewogICAgICAgICAgICBidXNpbmVzc191c2VyX2lkOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYnVzaW5lc3NfdXNlcl9pZDsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgYnVzZXJfbGFzdF9uYW1lOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYnVzZXJfbGFzdF9uYW1lOwogICAgICAgICAgICB9LAogICAgICAgICAgICBidXNlcl9maXJzdF9uYW1lOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYnVzZXJfZmlyc3RfbmFtZTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgaXNfaW5zdHJ1Y3RvcjogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgICAkc2NvcGUucGFja2FnZURlbGV0ZSA9IGZ1bmN0aW9uKHBhY2thZ2UpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJwYWNrYWdlIGRlbGV0ZSAiK0pTT04uc3RyaW5naWZ5KHBhY2thZ2UpKTsKICAgICAgZGVsZXRlUGFja2FnZSgkaHR0cCwkc2NvcGUscGFja2FnZS5wYWNrYWdlX3VzZXJfaWQsJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLmJ1c2luZXNzX3VzZXJfaWQsc3VjY2Vzc19jYWxsYmFjaywgc3VjY2Vzc19jYWxsYmFjayk7CiAgICAgIGZ1bmN0aW9uIHN1Y2Nlc3NfY2FsbGJhY2soKQogICAgICB7CiAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgICB9CiAgICB9CgogICAgJHNjb3BlLnVwZGF0ZUNsaWVudEV4dHJhRmllbGRzID0gZnVuY3Rpb24oKQogICAgewogICAgICBsb2dEZWJ1ZygidXBkYXRlRXZlbnRFeHRyYUZpZWxkcyIpOwogICAgICB0aGVkYXRhID0gewogICAgICAgICBleHRyYUZpZWxkczokc2NvcGUuY2xpZW50RXh0cmFGaWVsZHMKICAgICAgICB9OwogICAgICAkc2NvcGUuZXh0cmFGaWVsZHNBbGVydE1lc3NhZ2U9Itee16LXk9eb158g16DXqteV16DXmdedLCDXkNeg15Ag15TXnteq158uLi4iOwogICAgICB1cGRhdGVDbGllbnRFeHRyYUZpZWxkcygkaHR0cCwkc2NvcGUsJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLmJ1c2luZXNzX3VzZXJfaWQsdGhlZGF0YSx1cGRhdGVFdmVudEV4dHJhRmllbGRzX2NhbGxiYWNrLCB1cGRhdGVFdmVudEV4dHJhRmllbGRzX2NhbGxiYWNrKTsKCiAgICAgIGZ1bmN0aW9uIHVwZGF0ZUV2ZW50RXh0cmFGaWVsZHNfY2FsbGJhY2soKQogICAgICB7CiAgICAgICAgLy8gZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLHNldFBhcnRpY2lwYXRlZCk7CiAgICAgICAgJHNjb3BlLmV4dHJhRmllbGRzQWxlcnRNZXNzYWdlPSLXqteZ16LXldeTINeg16nXnteoINeR15TXptec15fXlCEiOwogICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkKICAgICAgICB7CiAgICAgICAgICAkc2NvcGUuZXh0cmFGaWVsZHNBbGVydE1lc3NhZ2U9bnVsbDsKICAgICAgICB9LCAzMDAwKTsKICAgICAgfQogICAgfTsKCiAgICAkc2NvcGUuc2NoZWR1bGVFdmVudEZvckNsaWVudCA9IGZ1bmN0aW9uKCkKICAgIHsKICAgICAgbG9nRGVidWcoInNlZXRpbmcgc2hhcmUgcHJvcGVydHkgdXNlcl9pZCAiKyRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXSk7CiAgICAgIHNoYXJlZFByb3BlcnRpZXMuc2V0X3NlbGVjdGVkX3VzZXIoJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdKTsKICAgICAgJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jYWxlbmRhcicpOwogICAgfQogICAgJHNjb3BlLmludm9pY2VHZW5lcmF0ZUNoZWNrYm94ID0gZnVuY3Rpb24oZnBheW1lbnQpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJpbnZvaWNlR2VuZXJhdGVDaGVja2JveCBmb3IgIitKU09OLnN0cmluZ2lmeShmcGF5bWVudCkpOwogICAgICBzZXRDbGllbnRQYXltZW50SW52b2ljZUdlbmVyYXRlZCgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsZnBheW1lbnQudXNlcl9wYXltZW50X2lkLGZwYXltZW50Lmludm9pY2VfZ2VuZXJhdGVkLHNldENsaWVudFBheW1lbnRJbnZvaWNlR2VuZXJhdGVkX2NhbGxiYWNrLCBzZXRDbGllbnRQYXltZW50SW52b2ljZUdlbmVyYXRlZF9jYWxsYmFjayk7CiAgICAgIGZ1bmN0aW9uIHNldENsaWVudFBheW1lbnRJbnZvaWNlR2VuZXJhdGVkX2NhbGxiYWNrKCkKICAgICAgewogICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKICAgICAgfQogICAgfTsKCiAgICAkc2NvcGUucmVjYWxjVXNlckJhbGFuY2UgPSBmdW5jdGlvbigpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJyZWNhbGNVc2VyQmFsYW5jZSIpOwogICAgICByZWNhbGNVc2VyQmFsYW5jZSgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsIHJlY2FsY1VzZXJCYWxhbmNlX2NhbGxiYWNrKTsKICAgICAgZnVuY3Rpb24gcmVjYWxjVXNlckJhbGFuY2VfY2FsbGJhY2soKQogICAgICB7CiAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgICB9ICAgIH0KICAgICRzY29wZS51cGRhdGVFdmVudFBhY2thZ2VSZWZlcmVuY2UgPSBmdW5jdGlvbih1c2VyX2lkLCBmbWVldGluZykKICAgIHsKICAgICAgbG9nRGVidWcoInVwZGF0ZUV2ZW50UGFja2FnZVJlZmVyZW5jZSwgdXNlcj0iK3VzZXJfaWQrIiwgZm1lZXRpbmc9IitKU09OLnN0cmluZ2lmeShmbWVldGluZykpOwogICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAgICAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9jbGllbnRfZXZlbnRfcGFja2FnZV9hc3NvY2lhdGlvbi5waHAnLAogICAgICAgICAgc2l6ZTogJ3hzJywKICAgICAgICAgIGNvbnRyb2xsZXI6ICdldmVudFBhY2thZ2VBc3NvY2lhdGlvbk1vZGFsQ29udHJvbGxlcicsICAvLyAncGF5bWVueURldGFpbHNNb2RhbENvbnRyb2xsZXInLAogICAgICAgICAgcmVzb2x2ZTogewogICAgICAgICAgICAgIGZtZWV0aW5nOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIGZtZWV0aW5nOwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgYmFsYW5jZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYmFsYW5jZTsKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGJ1c2luZXNzX3VzZXJfaWQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQ7CiAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICB9KTsKICAgIH07CgogICAgJHNjb3BlLnVwZGF0ZVBhY2thZ2VQYXltZW50UmVmZXJlbmNlID0gZnVuY3Rpb24odXNlcl9pZCwgZnBhY2thZ2UpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJ1cGRhdGVQYWNrYWdlUGF5bWVudFJlZmVyZW5jZSwgdXNlcj0iK3VzZXJfaWQrIiwgZnBhY2thZ2U9IitKU09OLnN0cmluZ2lmeShmcGFja2FnZSkpOwogICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAgICAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9jbGllbnRfcGFja2FnZV9wYXltZW50X2Fzc29jaWF0aW9uLnBocCcsCiAgICAgICAgICBzaXplOiAneHMnLAogICAgICAgICAgY29udHJvbGxlcjogJ3BhY2thZ2VQYXltZW50QXNzb2NpYXRpb25Nb2RhbENvbnRyb2xsZXInLCAgLy8gJ3BheW1lbnlEZXRhaWxzTW9kYWxDb250cm9sbGVyJywKICAgICAgICAgIHJlc29sdmU6IHsKICAgICAgICAgICAgICBmcGFja2FnZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBmcGFja2FnZTsKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGJhbGFuY2U6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLmJhbGFuY2U7CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBidXNpbmVzc191c2VyX2lkOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuICRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkOwogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgfSk7CiAgICB9OwoKICAgIC8vIHNob3cgcGF5bWVudCBwb3B1cAogICAgJHNjb3BlLnNob3dQYXltZW50RGV0YWlscyA9IGZ1bmN0aW9uKGZwYXltZW50KQogICAgewogICAgICBsb2dEZWJ1Zygic2hvd1BheW1lbnREZXRhaWxzIik7CiAgICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewogICAgICAgICAgYW5pbWF0aW9uOiBmYWxzZSwKICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2NsaWVudF9wYXltZW50X2RldGFpbHMucGhwJywKICAgICAgICAgIHNpemU6ICd4cycsCiAgICAgICAgICBjb250cm9sbGVyOiAncGF5bWVueURldGFpbHNNb2RhbENvbnRyb2xsZXInLAogICAgICAgICAgcmVzb2x2ZTogewogICAgICAgICAgICAgIGZwYXltZW50OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIGZwYXltZW50OwogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgICAkc2NvcGUuaW52b2ljZU51bWJlckNoYW5nZWQgPSBmdW5jdGlvbihuZXdfaW52b2ljZV9udW1iZXIsZnBheW1lbnQpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJpbnZvaWNlTnVtYmVyQ2hhbmdlZCAiKyBuZXdfaW52b2ljZV9udW1iZXIgKyJmb3IgIitKU09OLnN0cmluZ2lmeShmcGF5bWVudCkpOwogICAgICBzZXRDbGllbnRQYXltZW50SW52b2ljZU51bWJlcigkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsZnBheW1lbnQudXNlcl9wYXltZW50X2lkLG5ld19pbnZvaWNlX251bWJlcixzZXRDbGllbnRQYXltZW50SW52b2ljZU51bWJlcl9jYWxsYmFjaywgc2V0Q2xpZW50UGF5bWVudEludm9pY2VOdW1iZXJfY2FsbGJhY2spOwogICAgICBmdW5jdGlvbiBzZXRDbGllbnRQYXltZW50SW52b2ljZU51bWJlcl9jYWxsYmFjaygpCiAgICAgIHsKICAgICAgICAvLyAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NsaWVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCiAgICAgIH0KICAgIH07CgogICAgJHNjb3BlLiRvbigiY2xpZW50UGFnZVJlbG9hZERhdGEiLGZ1bmN0aW9uKGUsYSkKICAgIHsKICAgICAgbG9nRGVidWcoImNsaWVudFBhZ2VSZWxvYWREYXRhIik7CiAgICAgIGdldEJ1c2luZXNzVXNlclBhY2thZ2VzKCRodHRwLCRzY29wZSwndXNlcl9wYWNrYWdlcycsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwogICAgICBnZXRDbGllbnRQYXltZW50cygkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsJ2N1cnJlbnRDbGllbnRQYXltZW50cycpOwogICAgICBnZXRDbGllbnRFdmVudHMoJGh0dHAsJHNjb3BlLCdjdXJyZW50Q2xpZW50RXZlbnRzJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CiAgICAgIGdldEJ1c2luZXNzQ2xpZW50SW5mbygkaHR0cCwkc2NvcGUsJ2Zvcm1VcGRhdGVDbGllbnRBbmd1bGFyJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CgogICAgfSk7CgogICAgJHNjb3BlLmlzQ29uZmlybWVkT3JDbG9zZWQgPSBmdW5jdGlvbihldmVudCkKICAgIHsKICAgICAgaWYgKCRzY29wZS5zaG93QWxsRXZlbnRzKQogICAgICB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KCiAgICAgIGlmICgoZXZlbnQuaXNfY29uZmlybWVkID09IDEpIHx8IChldmVudC5pc19maW5hbF9zdGF0dXMgPT0gMSkgfHwgKChldmVudC5pc193YWl0aW5nX2xpc3QgPT0gMSkgJiYgKGV2ZW50LmlzX2NhbmNlbGVkID09IDApKSkKICAgICAgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIGVsc2UKICAgICAgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfQogICAgJHNjb3BlLmdvdG9DbGllbnRFZGl0UGFnZT1nb3RvQ2xpZW50RWRpdFBhZ2U7CiAgICAkc2NvcGUuZ290b0JhY2s9ZnVuY3Rpb24oKQogICAgewogICAgICBsb2dEZWJ1ZygnZ28gYmFjaycpOwogICAgICB3aW5kb3cuaGlzdG9yeS5iYWNrKCk7CiAgICB9OwoKICAgICRzY29wZS5nb3RvRXZlbnRQYWdlID0gZnVuY3Rpb24gKHRoZWV2ZW50KQogICAgewogICAgICBnb3RvRXZlbnRQYWdlKHRoZWV2ZW50KTsKICAgIH0KfQogICAgJHNjb3BlLmluaXRpYXRlUGF5bWVudCA9IGZ1bmN0aW9uKGlzcGx1cykKICAgIHsKICAgICAgbG9nRGVidWcoImluaXRpYXRlUGF5bWVudCBpc3BsdXMiK2lzcGx1cyk7CiAgICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewogICAgICAgICAgYW5pbWF0aW9uOiBmYWxzZSwKICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2NsaWVudF9wYXltZW50LnBocCcsCiAgICAgICAgICBjb250cm9sbGVyOiAnYnVzaW5lc3NDbGllbmRDYXJkUGF5bWVudCcsCiAgICAgICAgICAvLyBzaXplOiBzaXplLAogICAgICAgICAgcmVzb2x2ZTogewogICAgICAgICAgICBjdXJyZW50Q2xpZW50OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF07CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGlzcGx1czogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gaXNwbHVzOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgIH0pOwogICAgfQoKICAgICRzY29wZS51cGRhdGVVc2VyRmlyc3ROYW1lID0gZnVuY3Rpb24obmV3VmFsdWUpCiAgICB7CiAgICAgIHNldENsaWVudEZpcnN0TmFtZSgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsbmV3VmFsdWUsYWZ0ZXJDbGllbnRTZXQsYWZ0ZXJDbGllbnRTZXQpOwogICAgICBmdW5jdGlvbiBhZnRlckNsaWVudFNldCgpCiAgICAgIHsKICAgICAgICBnZXRCdXNpbmVzc0NsaWVudEluZm8oJGh0dHAsJHNjb3BlLCdmb3JtVXBkYXRlQ2xpZW50QW5ndWxhcicsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwogICAgICB9CiAgICB9CiAgICAkc2NvcGUudXBkYXRlVXNlckxhc3ROYW1lID0gZnVuY3Rpb24obmV3VmFsdWUpCiAgICB7CiAgICAgIHNldENsaWVudExhc3ROYW1lKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCxuZXdWYWx1ZSxhZnRlckNsaWVudFNldCxhZnRlckNsaWVudFNldCk7CiAgICAgIGZ1bmN0aW9uIGFmdGVyQ2xpZW50U2V0KCkKICAgICAgewogICAgICAgIGdldEJ1c2luZXNzQ2xpZW50SW5mbygkaHR0cCwkc2NvcGUsJ2Zvcm1VcGRhdGVDbGllbnRBbmd1bGFyJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CiAgICAgIH0KICAgIH0KICAgICRzY29wZS51cGRhdGVVc2VyRW1haWwgPSBmdW5jdGlvbihuZXdWYWx1ZSkKICAgIHsKICAgICAgc2V0Q2xpZW50RW1haWwoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLG5ld1ZhbHVlLGFmdGVyc2V0Q2xpZW50RW1haWwsYWZ0ZXJzZXRDbGllbnRFbWFpbCk7CiAgICAgIGZ1bmN0aW9uIGFmdGVyc2V0Q2xpZW50RW1haWwoKQogICAgICB7CiAgICAgICAgZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKICAgICAgfQogICAgfQoKCiAgICAkc2NvcGUudXBkYXRlVXNlclBob25lTnVtYmVyID0gZnVuY3Rpb24obmV3VmFsdWUpCiAgICB7CiAgICAgIG5ld1ZhbHVlID0gbmV3VmFsdWUucmVwbGFjZSgnLScsJycpOwogICAgICBpZiAoaXNOYU4obmV3VmFsdWUpKQogICAgICB7CiAgICAgICAgYWxlcnQoIteQ16DXkCDXlNeW158g157Xodek16gg15jXnNek15XXnyDXqten15nXnyIpOwogICAgICAgIGdldEJ1c2luZXNzQ2xpZW50SW5mbygkaHR0cCwkc2NvcGUsJ2Zvcm1VcGRhdGVDbGllbnRBbmd1bGFyJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CiAgICAgIH0KICAgICAgZWxzZQogICAgICB7CiAgICAgICAgc2V0Q2xpZW50UGhvbmVOdW1iZXIoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLG5ld1ZhbHVlLHNldENsaWVudFBob25lTnVtYmVyX2NhbGxiYWNrLHNldENsaWVudFBob25lTnVtYmVyX2NhbGxiYWNrKTsKICAgICAgICBmdW5jdGlvbiBzZXRDbGllbnRQaG9uZU51bWJlcl9jYWxsYmFjaygpCiAgICAgICAgewogICAgICAgICAgZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgICRzY29wZS51cGRhdGVVc2VyRXZlbnRQcmljZSA9IGZ1bmN0aW9uKG5ld3ZhbHVlLCB0aGVldmVudCkKICAgIHsKICAgICAgbmV3X3ByaWNlPW5ld3ZhbHVlOwogICAgICBzZXRDbGllbnRFdmVudFByaWNlKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCx0aGVldmVudC5ldmVudF9pZCwgbmV3X3ByaWNlLHNldENsaWVudEV2ZW50UHJpY2VfY2FsbGJhY2ssIHNldENsaWVudEV2ZW50UHJpY2VfY2FsbGJhY2spOwogICAgICBmdW5jdGlvbiBzZXRDbGllbnRFdmVudFByaWNlX2NhbGxiYWNrKCkKICAgICAgewogICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKICAgICAgfQogICAgfTsKCiAgICAkc2NvcGUudXBkYXRlVXNlclBhY2thZ2VFdmVudHNDb3VudGVyID0gZnVuY3Rpb24obmV3dmFsdWUsIHRoZXBhY2thZ2UpCiAgICB7CiAgICAgIGV2ZW50c19jb3VudGVyPW5ld3ZhbHVlOwogICAgICBzZXRVc2VyUGFja2FnZUV2ZW50c0NvdW50ZXIoJGh0dHAsJHNjb3BlLHRoZXBhY2thZ2UucGFja2FnZV91c2VyX2lkLGV2ZW50c19jb3VudGVyLHNldFVzZXJQYWNrYWdlRXZlbnRzQ291bnRlcl9jYWxsYmFjaywgc2V0VXNlclBhY2thZ2VFdmVudHNDb3VudGVyX2NhbGxiYWNrKQogICAgICBmdW5jdGlvbiBzZXRVc2VyUGFja2FnZUV2ZW50c0NvdW50ZXJfY2FsbGJhY2soKQogICAgICB7CiAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgICB9CiAgICB9OwogICAgJHNjb3BlLnVwZGF0ZVVzZXJQYWNrYWdlUGFja2FnZVByaWNlID0gZnVuY3Rpb24obmV3dmFsdWUsIHRoZXBhY2thZ2UpCiAgICB7CiAgICAgIHBhY2thZ2VfcHJpY2U9bmV3dmFsdWU7CiAgICAgIHNldFVzZXJQYWNrYWdlUGFja2FnZVByaWNlKCRodHRwLCRzY29wZSx0aGVwYWNrYWdlLnBhY2thZ2VfdXNlcl9pZCxwYWNrYWdlX3ByaWNlLHNldFVzZXJQYWNrYWdlUGFja2FnZVByaWNlX2NhbGxiYWNrLCBzZXRVc2VyUGFja2FnZVBhY2thZ2VQcmljZV9jYWxsYmFjaykKICAgICAgZnVuY3Rpb24gc2V0VXNlclBhY2thZ2VQYWNrYWdlUHJpY2VfY2FsbGJhY2soKQogICAgICB7CiAgICAgICAgLy8gZ2V0QnVzaW5lc3NVc2VyUGFja2FnZXMoJGh0dHAsJHNjb3BlLCd1c2VyX3BhY2thZ2VzJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CiAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgICB9CiAgICB9OwoKICAgICRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhciA9IHt9OwogICAgbG9nRGVidWcoJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwogICAgJHNjb3BlLnNob3dfY2xpZW50X3VwZGF0ZV9jbGllbnQgPSB0cnVlOwogICAgJHNjb3BlLnNob3dfY2xpZW50X3VwZGF0ZV9zYXZlID0gZmFsc2U7CiAgICAkc2NvcGUuc2hvd19jbGllbnRfZGVsZXRlX2NsaWVudCA9IHRydWU7CiAgICAkc2NvcGUuc2hvd19jbGllbnRfdXBkYXRlX2NhbmNlbCA9IGZhbHNlOwoKICAgICRzY29wZS51cGRhdGVDbGllbnRFbmFibGUgPSBmdW5jdGlvbigpIHsKICAgICAgICBsb2dEZWJ1ZygiZW5hYmxpbmcgZWRpdGluZyAoJHNjb3BlLmNsaWVudHNVcGRhdGVEaXNhYmxlZCB3YXMgIiArICRzY29wZS5jbGllbnRzVXBkYXRlRGlzYWJsZWQgKyAiKSIpOwogICAgICAgICRzY29wZS5jbGllbnRzVXBkYXRlRGlzYWJsZWQgPSBmYWxzZTsKICAgICAgICAkc2NvcGUuc2hvd19jbGllbnRfdXBkYXRlX2NsaWVudCA9IGZhbHNlOwogICAgICAgICRzY29wZS5zaG93X2NsaWVudF91cGRhdGVfc2F2ZSA9IHRydWU7CiAgICAgICAgJHNjb3BlLnNob3dfY2xpZW50X2RlbGV0ZV9jbGllbnQgPSBmYWxzZTsKICAgICAgICAkc2NvcGUuc2hvd19jbGllbnRfdXBkYXRlX2NhbmNlbCA9IHRydWU7CiAgICB9CiAgICAkc2NvcGUudXBkYXRlQ2xpZW50RGlzYWJsZSA9IGZ1bmN0aW9uKCkgewogICAgICAgIGxvZ0RlYnVnKCJkaXNhYmxlIGVkaXRpbmciKTsKICAgICAgICAvLwkJJGxvY2F0aW9uLnBhdGgoJy9DbGllbnRzLycrJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwogICAgICAgICRyb3V0ZS5yZWxvYWQoKTsKICAgIH0KICAgICRzY29wZS5zY2hlZHVsZUV2ZW50RnJvbUVuZFVzZXIgPSBmdW5jdGlvbigpIHsKICAgICAgICBzaGFyZWREYXRhLnNldFNlbGVjdGVkRW5kVXNlcih7CiAgICAgICAgICAgIGlkOiAkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCwKICAgICAgICAgICAgZmlyc3RfbmFtZTogJHNjb3BlLmN1cnJlbnRDbGllbnQudXNlcnNbMF0uZmlyc3RfbmFtZSwKICAgICAgICAgICAgbGFzdF9uYW1lOiAkc2NvcGUuY3VycmVudENsaWVudC51c2Vyc1swXS5sYXN0X25hbWUKICAgICAgICB9KTsKICAgICAgICBsb2dEZWJ1Zygic2NoZWR1bGUgZXZlbnQgZm9yIHVzZXIgIiArICRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKICAgICAgICAvLwkJJGxvY2F0aW9uLnBhdGgoJy9DbGllbnRzLycrJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwogICAgICAgICRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfY2FsZW5kYXInKTsKICAgIH0KCiAgICAvLyByZW1vdmUgZW5kIHVzZXIgZnJvbSBldmVudAogICAgJHNjb3BlLnVzZXJEZWxldGVFdmVudCA9IGZ1bmN0aW9uKGVuZHVzZXJfaWQsIHRoZWV2ZW50KQogICAgewogICAgICAvLyBpZiBpdCdzIGEgY2xhc3MgLSB3ZSBzaW1wbHkgcmVtb3ZlIHRoZSB1c2VyIGZyb20gdGhlIGV2ZW50CiAgICAgIGlmICh0aGVldmVudC5pc19jbGFzcz09MSkKICAgICAgewogICAgICAgIGxvZ0RlYnVnKCJzY29wZS51c2VyRGVsZXRlRXZlbnQiKTsKICAgICAgICByZW1vdmVFbmRVc2VyRnJvbUV2ZW50KCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCx0aGVldmVudC5ldmVudF9pZCxyZW1vdmVFbmRVc2VyRnJvbUV2ZW50X2ZpbmlzaCwgcmVtb3ZlRW5kVXNlckZyb21FdmVudF9maW5pc2gpOwogICAgICAgIGZ1bmN0aW9uIHJlbW92ZUVuZFVzZXJGcm9tRXZlbnRfZmluaXNoKCkKICAgICAgICB7CiAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NsaWVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCiAgICAgICAgfQogICAgICB9CiAgICAgIC8vIGlmIGl0cyBub3QgYSBjbGFzcyAtIHdlIG5lZWQgdG8gcmVtb3ZlIHRoZSBldmVudCBpdHNlbGYKICAgICAgZWxzZQogICAgICB7CiAgICAgICAgLy8gYWxlcnQoIm5vdCBjbGFzcyBldmVudCwgVE9ETyIpOwogICAgICB9CiAgICB9OwoKICAgIC8vIHJldHJldmluZyBwYWNrYWdlcyBmb3IgdGhlIGJ1c2luZXNzCiAgICBnZXRCdXNpbmVzc1BhY2thZ2VzKCRodHRwLCRzY29wZSwncGFja2FnZXMnKTsKCiAgICAvLyBnZXQgcGFja2FnZXMgZm9yIHRoaXMgc3BlY2lmaWMgdXNlcgogICAgZ2V0QnVzaW5lc3NVc2VyUGFja2FnZXMoJGh0dHAsJHNjb3BlLCd1c2VyX3BhY2thZ2VzJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CiAgICAvLyBhZGRpbmcgcGFja2FnZSB0byB1c2VyIC0gY2FsbGVkIHdoZW4gYSBwYWNrYWdlIGlzIHNlbGVjdGVkCiAgICAkc2NvcGUucGFja2FnZUZvckNsaWVudFNlbGVjdGVkID0gZnVuY3Rpb24oc2VsZWN0ZWRQYWNrYWdlKSB7CiAgICAgICAgaWYgKHNlbGVjdGVkUGFja2FnZSkgewogICAgICAgICAgICAvLyBsb2dEZWJ1ZygneWVzIHNlbGVjdGVkICcgKyBKU09OLnN0cmluZ2lmeShzZWxlY3RlZFBhY2thZ2UpKTsKICAgICAgICAgICAgYWRkQnVzaW5lc3NQYWNrYWdlVG9Vc2VyKCRodHRwLCRzY29wZSxzZWxlY3RlZFBhY2thZ2Uub3JpZ2luYWxPYmplY3QsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsYWRkQnVzaW5lc3NQYWNrYWdlU3VjY2Vzcyk7CiAgICAgICAgICAgIGZ1bmN0aW9uIGFkZEJ1c2luZXNzUGFja2FnZVN1Y2Nlc3MoKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgbG9nRGVidWcoImFkZEJ1c2luZXNzUGFja2FnZVN1Y2Nlc3MyIik7CiAgICAgICAgICAgICAgLy8gZ2V0QnVzaW5lc3NQYWNrYWdlcygkaHR0cCwkc2NvcGUsJ3BhY2thZ2VzJyk7CiAgICAgICAgICAgICAgLy8gZ2V0QnVzaW5lc3NVc2VyUGFja2FnZXMoJGh0dHAsJHNjb3BlLCd1c2VyX3BhY2thZ2VzJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CiAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgICAgICAgICB9CiAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnYW5ndWNvbXBsZXRlLWFsdDpjbGVhcklucHV0JywgJ2NsaWVudF9hbmd1Y29tcGxldGUnKTsKICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgLy8gbG9nRGVidWcoJ25vdCBzZWxlY3RlZCwgZG8gbm90aGluZycpOwogICAgICAgIH0KICAgIH07Cn0pOwoKCi8vIE5lZWQgdG8gZGlzdGluZ3Vpc2ggYmV0d2VlbiBlbmQgdXNlciAoY2xpZW50KSBhbmQgYnVzaW5lc3Mgb3duZXIuCi8vIGN1cnJlbnRseSBjYWxscyBvbmx5IGVuZCB1c2VyCmt1emVBcHAuY29udHJvbGxlcignSG9tZUNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkdWliTW9kYWwpCnsKCiAgICBnZXRBbGxDbGllbnRzKCRodHRwLCRzY29wZSwnYWxsQ2xpZW50cycpOwoKICAgICRzY29wZS5ob21lcGFnZUxpbWl0PTY7CiAgICBnZXRPcGVuZWRFdmVudHMoJGh0dHAsJHNjb3BlLCRzY29wZS5ob21lcGFnZUxpbWl0LCdvcGVuZWRfZXZlbnRzJyk7CgogICAgdmFyIHRvZGF5ZGF0ZSA9IG5ldyBEYXRlKCk7CiAgICB2YXIgaG93bWFueWRheXNhaGVhZD0zMDsKICAgIHZhciBzdGFydGRhdGU9dG9kYXlkYXRlLmdldEZ1bGxZZWFyKCkrIi0iKygxK3RvZGF5ZGF0ZS5nZXRNb250aCgpKSsiLSIrdG9kYXlkYXRlLmdldERhdGUoKTsKICAgIHRvZGF5ZGF0ZS5zZXREYXRlKHRvZGF5ZGF0ZS5nZXREYXRlKCkgKyBob3dtYW55ZGF5c2FoZWFkKTsKICAgIHZhciBlbmRkYXRlPXRvZGF5ZGF0ZS5nZXRGdWxsWWVhcigpKyItIisoMSt0b2RheWRhdGUuZ2V0TW9udGgoKSkrIi0iK3RvZGF5ZGF0ZS5nZXREYXRlKCk7CgogICAgLy8gZmlsdGVyIGZvciB1c2VycyB3aG8gaGF2ZSBkZWJ0CiAgICAkc2NvcGUuaGF2ZURlYnQgPSBmdW5jdGlvbihldXNlcikKICAgIHsKICAgICAgaWYgKGV1c2VyLnVzZXJfYmFsYW5jZSA8IDApCiAgICAgIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICBlbHNlCiAgICAgIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH07CgogICAgJHNjb3BlLmdvdG9DbGllbnRQYWdlID0gZnVuY3Rpb24oYnVzaW5lc3NfdXNlcl9pZCkKICAgIHsKICAgICAgLy8gbG9nRGVidWcoZXVzZXIpOwogICAgICB3aW5kb3cubG9jYXRpb24uaHJlZj0nLyMvYnVzaW5lc3NfY2xpZW50cy8nICsgYnVzaW5lc3NfdXNlcl9pZDsKICAgIH0KCiAgICB2YXIgcGF5bG9hZCA9ICdzdGFydD0nICsgc3RhcnRkYXRlICsgJyZlbmQ9JyArIGVuZGRhdGU7CiAgICB2YXIgY29uZmlnID0gewogICAgICBoZWFkZXJzOiB7J0NvbnRlbnQtVHlwZSc6J2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZDsgY2hhcnNldD1VVEYtOCd9CiAgICB9CiAgICB2YXIgcG9zdHVybCA9ICIvYXBpL2FkbWluL2V2ZW50cy9nZXRwb3N0IjsKCiAgICAkaHR0cC5wb3N0KHBvc3R1cmwsIHBheWxvYWQsIGNvbmZpZykuc3VjY2VzcyhmdW5jdGlvbihkYXRhKQogICAgewogICAgICBsb2dEZWJ1ZygiZG9uZSIpOwogICAgICAkc2NvcGUuYWRtaW5fZXZlbnRzID0gZGF0YTsKICAgIH0pOwoKICAgICRzY29wZS5zaG93RXZlbnRQb3B1cCA9IGZ1bmN0aW9uKHNlbGVjdGVkRXZlbnQpIHsKICAgICAgICBzaG93RXZlbnRQb3B1cChzZWxlY3RlZEV2ZW50LCAkdWliTW9kYWwpCiAgICB9OwogICAgJHNjb3BlLmVkaXRFdmVudD0gZnVuY3Rpb24gKHRoZWV2ZW50KQogICAgewogICAgICBnb3RvRXZlbnRQYWdlKHRoZWV2ZW50KTsKICAgIH0KfSk7CgovLyBrdXplQXBwLmNvbnRyb2xsZXIoJ0J1c2luZXNzQ29uZmlnQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRyb3V0ZVBhcmFtcywgJGxvY2F0aW9uLCAkcm91dGUsIHNoYXJlZERhdGEpIHsKCmt1emVBcHAuY29udHJvbGxlcignQ29uZmlnVXNlckNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICR1aWJNb2RhbCwgJGh0dHAsICR0aW1lb3V0KQp7CiAgJHNjb3BlLmluVGhlTWlkZGxlT2ZTYXZlPWZhbHNlOwoKICBsb2dEZWJ1ZygiQ29uZmlnVXNlckNvbnRyb2xsZXIiKTsKICAvLyAkc2NvcGUuYWpheF9pbmZvPSLXlNep15nXoNeV15nXmdedINeg16nXnteo15UiOwoKICBnZXRMb2dnZWRVc2VySW5mbygkaHR0cCwkc2NvcGUsJ3VzZXJQcm9wZXJ0aWVzJyxnZXRMb2dnZWRVc2VySW5mb19zdWNjZXNzLGdldExvZ2dlZFVzZXJJbmZvX2ZhaWx1cmUpOwogIGZ1bmN0aW9uIGdldExvZ2dlZFVzZXJJbmZvX3N1Y2Nlc3MoKQogIHsKICAgIGxvZ0RlYnVnKCJnZXRMb2dnZWRVc2VySW5mb19zdWNjZXNzIik7CiAgICAkc2NvcGUudXNlclByb3BlcnRpZXNEdXBsaWNhdGUgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KCRzY29wZS51c2VyUHJvcGVydGllcykpOwogIH0KICBmdW5jdGlvbiBnZXRMb2dnZWRVc2VySW5mb19mYWlsdXJlKCkKICB7CiAgICBsb2dEZWJ1ZygiZ2V0TG9nZ2VkVXNlckluZm9fZmFpbHVyZSIpOwogIH0KCiAgJHNjb3BlLmJhY2sgPSBmdW5jdGlvbigpIHsKICAgIHdpbmRvdy5oaXN0b3J5LmJhY2soKTsKICB9OwoKICAkc2NvcGUuY2hhbmdlUGFzc3dvcmRNb2RhbCA9IGZ1bmN0aW9uKCkKICB7CiAgICAkc2NvcGUuaW5UaGVNaWRkbGVPZlNhdmU9dHJ1ZTsKICAgIGZ1bmN0aW9uIHNtc1Jlc2V0UGFzc3dvcmRfc3VjY2VzcygpCiAgICB7CiAgICAgIGNvbnNvbGUubG9nKCJzbXNSZXNldFBhc3N3b3JkX3N1Y2Nlc3MiKTsKICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgICAgICAgICBhbmltYXRpb246IGZhbHNlLAogICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnbW9kYWxfY2hhbmdlX3Bhc3N3b3JkLnBocCcsCiAgICAgICAgICBjb250cm9sbGVyOiAnbW9kYWxfY2hhbmdlX3Bhc3N3b3JkJywKICAgICAgICAgIHNpemU6ICdsJywKICAgICAgICAgIHJlc29sdmU6IHsKICAgICAgICAgICAgICB1c2VyX3Bob25lX251bWJlcjogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIC8vIHBhc3Npbmcgb3JpZ2luYWwgcGhvbmUgbnVtYmVyCiAgICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUudXNlclByb3BlcnRpZXNEdXBsaWNhdGVbMF0ucGhvbmVfbnVtYmVyOwogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgfSk7CgogICAgICBtb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHJlc3VsdCkgewogICAgICAgICRzY29wZS5pblRoZU1pZGRsZU9mU2F2ZT1mYWxzZTsKICAgICAgICBsb2dEZWJ1Zygnc21zUmVzZXRQYXNzd29yZCBNb2RhbCBmaW5pc2VoZCByZXN1bHQ6ICcgKyByZXN1bHQpOwogICAgICAgICRzY29wZS5hamF4X2luZm89IteU16HXmdeh157XkCDXoteV15PXm9eg15Qg15HXlNem15zXl9eUISI7CiAgICAgICAgLy8gZ2V0TG9nZ2VkVXNlckluZm8oJGh0dHAsJHNjb3BlLCd1c2VyUHJvcGVydGllcycsZ2V0TG9nZ2VkVXNlckluZm9fc3VjY2VzcyxnZXRMb2dnZWRVc2VySW5mb19mYWlsdXJlKTsKICAgICAgICAkdGltZW91dChmdW5jdGlvbigpCiAgICAgICAgewogICAgICAgICAgJHNjb3BlLmFqYXhfaW5mbz1udWxsOwogICAgICAgIH0sIDIwMDApOwogICAgICAgICAgbG9nRGVidWcoJ3Ntc1Jlc2V0UGFzc3dvcmQgTW9kYWwgZGlzbWlzc2VkIGF0OiAnICsgbmV3IERhdGUoKSk7CiAgICAgIH0sIGZ1bmN0aW9uKCkgewogICAgICAgICAgJHNjb3BlLmluVGhlTWlkZGxlT2ZTYXZlPWZhbHNlOwogICAgICAgICAgbG9nRGVidWcoJ21vZGFsX2NoYW5nZV9wYXNzd29yZCBNb2RhbCBkaXNtaXNzZWQgYXQ6ICcgKyBuZXcgRGF0ZSgpKTsKICAgICAgfSk7CiAgICB9CgoKICAgIGNoYW5nZVBhc3N3b3JkU01TKCRodHRwLCRzY29wZSwkc2NvcGUudXNlclByb3BlcnRpZXNEdXBsaWNhdGVbMF0ucGhvbmVfbnVtYmVyLHNtc1Jlc2V0UGFzc3dvcmRfc3VjY2Vzcyk7CiAgfQogICRzY29wZS51cGRhdGVVc2VyQ29uZmlnPWZ1bmN0aW9uKCkKICB7CiAgICAkc2NvcGUuaW5UaGVNaWRkbGVPZlNhdmU9dHJ1ZTsKICAgIGxvZ0RlYnVnKCJ1cGRhdGVVc2VyQ29uZmlnLCBpblRoZU1pZGRsZU9mU2F2ZT0iKyRzY29wZS5pblRoZU1pZGRsZU9mU2F2ZSk7CiAgICAvLyBsb2dEZWJ1Zygkc2NvcGUudXNlclByb3BlcnRpZXNEdXBsaWNhdGUpOwogICAgLy8gbG9nRGVidWcoJHNjb3BlLnVzZXJQcm9wZXJ0aWVzKTsKICAgIGlmIChhbmd1bGFyLmVxdWFscygkc2NvcGUudXNlclByb3BlcnRpZXNEdXBsaWNhdGVbMF0ucGhvbmVfbnVtYmVyLCRzY29wZS51c2VyUHJvcGVydGllc1swXS5waG9uZV9udW1iZXIpKQogICAgewogICAgICBsb2dEZWJ1Zygibm90aGluZyBjaGFuZ2VkIGluIHBob25lIG51bWJlciwgY2hlY2tpbmcgb3RoZXIgZGF0YSBvdGhlciBkYXRhIik7CiAgICAgIGlmIChhbmd1bGFyLmVxdWFscygkc2NvcGUudXNlclByb3BlcnRpZXNEdXBsaWNhdGVbMF0sJHNjb3BlLnVzZXJQcm9wZXJ0aWVzWzBdKSkKICAgICAgewogICAgICAgICRzY29wZS5pblRoZU1pZGRsZU9mU2F2ZT1mYWxzZTsKICAgICAgICBsb2dEZWJ1Zygibm90aGluZyBjaGFuZ2VkIGluIGRldGFpbHMsIG5vdGhpbmcgdG8gc2F2ZSIpOwogICAgICAgICRzY29wZS5hamF4X2luZm89Itec15Ag15HXldem16LXlSDXqdeZ16DXldeZ15nXnSDXnNep157Xmdeo15QuLi4iOwogICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkKICAgICAgICB7CiAgICAgICAgICAkc2NvcGUuYWpheF9pbmZvPW51bGw7CiAgICAgICAgfSwgMTUwMCk7CiAgICAgIH0KICAgICAgZWxzZQogICAgICB7CiAgICAgICAgY2hhbmdlVXNlckRldGFpbHMoJGh0dHAsJHNjb3BlLCRzY29wZS51c2VyUHJvcGVydGllc1swXS5maXJzdF9uYW1lLCRzY29wZS51c2VyUHJvcGVydGllc1swXS5sYXN0X25hbWUsICRzY29wZS51c2VyUHJvcGVydGllc1swXS5lbWFpbF9hZGRyZXNzLGNoYW5nZVVzZXJEZXRhaWxzX3N1Y2Nlc3MsIGNoYW5nZVVzZXJEZXRhaWxzX2ZhaWx1cmUpOwogICAgICAgICRzY29wZS5hamF4X2luZm89Itee16LXk9eb158g16nXmdeg15XXmdeZ150uLi4iOwogICAgICB9CgogICAgICBmdW5jdGlvbiBjaGFuZ2VVc2VyRGV0YWlsc19zdWNjZXNzKCkKICAgICAgewogICAgICAgIGxvZ0RlYnVnKCJjaGFuZ2VVc2VyRGV0YWlsc19zdWNjZXNzIik7CiAgICAgICAgJHNjb3BlLmFqYXhfaW5mbz0i15TXqdeZ16DXldeZ15nXnSDXoNep157XqNeVINeR15TXptec15fXlCEiOwogICAgICAgICRzY29wZS5pblRoZU1pZGRsZU9mU2F2ZT1mYWxzZTsKICAgICAgICAkdGltZW91dChmdW5jdGlvbigpCiAgICAgICAgewogICAgICAgICAgJHNjb3BlLmFqYXhfaW5mbz1udWxsOwogICAgICAgIH0sIDE1MDApOwogICAgICAgIGdldExvZ2dlZFVzZXJJbmZvKCRodHRwLCRzY29wZSwndXNlclByb3BlcnRpZXMnLGdldExvZ2dlZFVzZXJJbmZvX3N1Y2Nlc3MsZ2V0TG9nZ2VkVXNlckluZm9fZmFpbHVyZSk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gY2hhbmdlVXNlckRldGFpbHNfZmFpbHVyZSgpCiAgICAgIHsKICAgICAgICBsb2dEZWJ1ZygiY2hhbmdlVXNlckRldGFpbHNfZmFpbHVyZSIpOwogICAgICB9CgogICAgfQogICAgZWxzZQogICAgewogICAgICAvLyB1cGRhdGUgdXNlciBpbmZvIC0gYWZ0ZXIgdmVyaWZ5aW5nIHBhc3N3b3JkCiAgICAgIGNvbnNvbGUubG9nKCJwaG9uZSBjaGFuZ2VkLCBjaGVja2luZyBpZiBuZXcgcGhvbmUgaXMgaW4gZGVzY2VudCBmb3JtYXQiKTsKICAgICAgaWYgKCFjaGVja1Bob25lTnVtYmVyKCRzY29wZS51c2VyUHJvcGVydGllc1swXS5waG9uZV9udW1iZXIpKQogICAgICB7CiAgICAgICAgJHNjb3BlLmFqYXhfaW5mbz0i15DXoNeQINeU15bXnyDXnteh16TXqCDXmNec16TXldefINeh15zXldec16jXmSDXqten15nXnyDXnNen15HXnNeqINeU15XXk9ei15XXqiDXnten15nXldeWLiI7CiAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKQogICAgICAgIHsKICAgICAgICAgICRzY29wZS5hamF4X2luZm89bnVsbDsKICAgICAgICB9LCAzMDAwKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgY29uc29sZS5sb2coInBob25lIGNoYW5nZWQsIGNoZWNraW5nIGlmIG5ldyBwaG9uZSBpcyBub3QgdXNlZCBhbHJlYWR5Iik7CiAgICAgIGlzTmV3UGhvbmVVc2VkSWZOb3RTZW5kU01TKCRodHRwLCRzY29wZSwkc2NvcGUudXNlclByb3BlcnRpZXNbMF0ucGhvbmVfbnVtYmVyLCBpc05ld1Bob25lVXNlZF9zdWNjZXNzLCBpc05ld1Bob25lVXNlZF9mYWlsdXJlLGZhbHNlKTsKICAgICAgZnVuY3Rpb24gaXNOZXdQaG9uZVVzZWRfc3VjY2VzcyhyZXNwb25zZSkKICAgICAgewogICAgICAgIGNvbnNvbGUubG9nKCJwaG9uZSBub3QgdXNlZCAtIHByb21wdGluZyBmb3IgcGFzc3dvcmQiKTsKICAgICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAgICAgICAgICAgYW5pbWF0aW9uOiBmYWxzZSwKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnbW9kYWxfY2hlY2tfcGFzc3dvcmRfdXBkYXRlX2NvbmZpZy5waHAnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnbW9kYWxfY2hlY2tfcGFzc3dvcmRfdXBkYXRlX2NvbmZpZycsCiAgICAgICAgICAgIHNpemU6ICdsJywKICAgICAgICAgICAgcmVzb2x2ZTogewogICAgICAgICAgICAgIG5ld191c2VyX3Byb2VydGllczogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUudXNlclByb3BlcnRpZXNbMF07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIG1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7CiAgICAgICAgICAgIGxvZ0RlYnVnKCdtb2RhbF9jaGVja19wYXNzd29yZF91cGRhdGVfY29uZmlnIE1vZGFsIGZpbmlzaGVkIHJlc3VsdDogJyArIHJlc3VsdCk7CiAgICAgICAgICAgICRzY29wZS5hamF4X2luZm89IteU16nXmdeg15XXmdeZ150g16DXqdee16jXlSDXkdeU16bXnNeX15QhIjsKICAgICAgICAgICAgJHNjb3BlLmluVGhlTWlkZGxlT2ZTYXZlPWZhbHNlOwogICAgICAgICAgICBnZXRMb2dnZWRVc2VySW5mbygkaHR0cCwkc2NvcGUsJ3VzZXJQcm9wZXJ0aWVzJyxnZXRMb2dnZWRVc2VySW5mb19zdWNjZXNzLGdldExvZ2dlZFVzZXJJbmZvX2ZhaWx1cmUpOwogICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAkc2NvcGUuYWpheF9pbmZvPW51bGw7CiAgICAgICAgICAgIH0sIDMwMDApOwogICAgICAgIH0sIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAkc2NvcGUuaW5UaGVNaWRkbGVPZlNhdmU9ZmFsc2U7CiAgICAgICAgICAgIGxvZ0RlYnVnKCdtb2RhbF9jaGVja19wYXNzd29yZF91cGRhdGVfY29uZmlnIE1vZGFsIGRpc21pc3NlZCBhdDogJyArIG5ldyBEYXRlKCkpOwogICAgICAgIH0pOwogICAgICB9CgogICAgICBmdW5jdGlvbiBpc05ld1Bob25lVXNlZF9mYWlsdXJlKHJlc3BvbnNlKQogICAgICB7CiAgICAgICAgJHNjb3BlLmFqYXhfaW5mbz1yZXNwb25zZS5tZXNzYWdlOwogICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkKICAgICAgICB7CiAgICAgICAgICAkc2NvcGUuYWpheF9pbmZvPW51bGw7CiAgICAgICAgfSwgMjAwMCk7CiAgICAgIH0KICAgIH0KICB9Owp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ21vZGFsX2NoZWNrX3Bhc3N3b3JkX3VwZGF0ZV9jb25maWcnLCBmdW5jdGlvbigkc2NvcGUsICR0aW1lb3V0LCAkdWliTW9kYWxJbnN0YW5jZSwgbmV3X3VzZXJfcHJvZXJ0aWVzLCAkaHR0cCkKewogICRzY29wZS5uZXdfdXNlcl9wcm9lcnRpZXM9bmV3X3VzZXJfcHJvZXJ0aWVzOwogIGxvZ0RlYnVnKCJtb2RhbF9jaGVja19wYXNzd29yZF91cGRhdGVfY29uZmlnIGNvbnRyb2xsZXIiKTsKICAvLyAkc2NvcGUucGhvbmVfdmVyaWZpY2F0aW9uID0ge307IC8vIHRoZXNlIGFyZSB0aGUgY29tcGxldGUgZGV0YWlscyBmb3IgdGhlIG5ldyBldmVudCAvLwogIC8vICRzY29wZS5waG9uZV92ZXJpZmljYXRpb24ucGhvbmVfbnVtYmVyPW5ld191c2VyX3Byb2VydGllcy5waG9uZV9udW1iZXI7CiAgJHNjb3BlLmNsb3NlID0gZnVuY3Rpb24oKSB7CiAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCdkaXNtaXNzJyk7CiAgfTsKCiAgJHNjb3BlLmNoYW5nZVBob25lTnVtYmVyID0gZnVuY3Rpb24oKQogIHsKICAgIGNoYW5nZVVzZXJEZXRhaWxzVmVyaWZ5KCRodHRwLCRzY29wZSwkc2NvcGUubmV3X3VzZXJfcHJvZXJ0aWVzLnBob25lX251bWJlciwkc2NvcGUubmV3X3VzZXJfcHJvZXJ0aWVzLmZpcnN0X25hbWUsJHNjb3BlLm5ld191c2VyX3Byb2VydGllcy5sYXN0X25hbWUsICRzY29wZS5uZXdfdXNlcl9wcm9lcnRpZXMuZW1haWxfYWRkcmVzcywkc2NvcGUudmVyaWZ5X3VzZXJfcGFzc3dvcmQsJHNjb3BlLnBob25lX3ZlcmlmaWNhdGlvbixjaGFuZ2VVc2VyRGV0YWlsc1ZlcmlmeV9zdWNjZXNzLCBjaGFuZ2VVc2VyRGV0YWlsc1ZlcmlmeV9mYWlsdXJlLGZhbHNlKTsKICAgIGZ1bmN0aW9uIGNoYW5nZVVzZXJEZXRhaWxzVmVyaWZ5X3N1Y2Nlc3MoKQogICAgewogICAgICBsb2dEZWJ1ZygiY2hhbmdlVXNlckRldGFpbHNWZXJpZnlfc3VjY2VzcyIpOwogICAgICAvLyBhbGVydCgn15TXqdeZ16DXldeZ15nXnSDXoteV15PXm9eg15Ug15HXlNem15zXl9eUJyk7CiAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKHRydWUpOwogICAgfQogICAgZnVuY3Rpb24gY2hhbmdlVXNlckRldGFpbHNWZXJpZnlfZmFpbHVyZShyZXNwb25zZSkKICAgIHsKICAgICAgbG9nRGVidWcoImNoYW5nZVVzZXJEZXRhaWxzVmVyaWZ5X2ZhaWx1cmUgIityZXNwb25zZS5tZXNzYWdlKTsKICAgICAgJHNjb3BlLmFqYXhfZXJyb3I9cmVzcG9uc2UubWVzc2FnZSsiLiI7CiAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkKICAgICAgewogICAgICAgICRzY29wZS5hamF4X2Vycm9yPW51bGw7CiAgICAgIH0sIDQwMDApOwogICAgfQogIH0KfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdtb2RhbF9jaGFuZ2VfcGFzc3dvcmQnLCBmdW5jdGlvbigkc2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCB1c2VyX3Bob25lX251bWJlciwgJGh0dHApCnsKICBsb2dEZWJ1ZygibW9kYWxfY2hhbmdlX3Bhc3N3b3JkIGNvbnRyb2xsZXIiKTsKICAkc2NvcGUucGhvbmVfdmVyaWZpY2F0aW9uID0ge307IC8vIHRoZXNlIGFyZSB0aGUgY29tcGxldGUgZGV0YWlscyBmb3IgdGhlIG5ldyBldmVudCAvLwogICRzY29wZS5waG9uZV92ZXJpZmljYXRpb24ucGhvbmVfbnVtYmVyPXVzZXJfcGhvbmVfbnVtYmVyOwogICRzY29wZS5waG9uZV92ZXJpZmljYXRpb24uc21zX2Vycm9yPSIiOwogICRzY29wZS5jbG9zZSA9IGZ1bmN0aW9uKCkgewogICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnZGlzbWlzcycpOwogIH07CgogICRzY29wZS5jaGFuZ2VQYXNzd29yZCA9IGZ1bmN0aW9uKCkKICB7CiAgICBjaGFuZ2VQYXNzd29yZCgkaHR0cCwkc2NvcGUsJHNjb3BlLnBob25lX3ZlcmlmaWNhdGlvbi51c2VyX3Bhc3N3b3JkLCRzY29wZS5waG9uZV92ZXJpZmljYXRpb24udXNlcl9wYXNzd29yZDIsJHNjb3BlLnBob25lX3ZlcmlmaWNhdGlvbi52ZXJpZmljYXRpb25fY29kZSwgY2hhbmdlUGFzc3dvcmRfc3VjY2VzcywgY2hhbmdlUGFzc3dvcmRfZmFpbHVyZSxmYWxzZSk7CiAgICAkc2NvcGUuYWpheF9lcnJvcj0iIjsKICAgIGZ1bmN0aW9uIGNoYW5nZVBhc3N3b3JkX3N1Y2Nlc3MoKQogICAgewogICAgICBsb2dEZWJ1ZygiY2hhbmdlUGFzc3dvcmRfc3VjY2VzcyIpOwogICAgICBzdGF0dXM9ImZmZmZmIjsKICAgICAgLy8gYWxlcnQoJ9eU16HXmdeh157XkCDXoteV15PXm9eg15Qg15HXlNem15zXl9eUJyk7CiAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKHRydWUpOwogICAgfQogICAgZnVuY3Rpb24gY2hhbmdlUGFzc3dvcmRfZmFpbHVyZShyZXNwb25zZSkKICAgIHsKICAgICAgbG9nRGVidWcoImNoYW5nZVBhc3N3b3JkX2ZhaWx1cmUgIityZXNwb25zZS5tZXNzYWdlKTsKICAgICAgJHNjb3BlLmFqYXhfZXJyb3I9cmVzcG9uc2UubWVzc2FnZTsKICAgIH0KICB9Cn0pOwoKa3V6ZUFwcC5mYWN0b3J5KCdCdXNpbmVzc0NvbmZpZycsIGZ1bmN0aW9uKCRodHRwKSB7CiAgICByZXR1cm4gewogICAgICAgIGdldDogZnVuY3Rpb24gKCkgewogICAgICAgICAgbG9nRGVidWcoImxvYWQgZ2V0X2J1c2luZXNzX2NvbmZpZyIpOwogICAgICAgICAgcmV0dXJuICRodHRwLmdldCgiL2FwaS9hZG1pbi9idXNpbmVzc19jb25maWciKQogICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkgewogICAgICAgICAgICAgIHJlc3VsdCA9IHJlc3BvbnNlLmRhdGFbMF07CiAgICAgICAgICAgICAgcmVzdWx0LnVzZV9ob2xpZGF5cz0hIXBhcnNlSW50KHJlc3BvbnNlLmRhdGFbMF0udXNlX2hvbGlkYXlzKTsKICAgICAgICAgICAgICByZXN1bHQuc21zX25vdGlmaWNhdGlvbnM9ISFwYXJzZUludChyZXNwb25zZS5kYXRhWzBdLnNtc19ub3RpZmljYXRpb25zKTsKICAgICAgICAgICAgICByZXN1bHQuc3RhcnRfaW52b2ljZV9udW1iZXIgPSBwYXJzZUludChyZXNwb25zZS5kYXRhWzBdLnN0YXJ0X2ludm9pY2VfbnVtYmVyKTsKICAgICAgICAgICAgICB2YXIgZCA9IG5ldyBEYXRlKCk7CiAgICAgICAgICAgICAgZC5zZXRIb3VycyggcmVzdWx0LmNhbGVuZGFyX2Rpc3BsYXlfc3RhcnRfaG91cnMgKTsKICAgICAgICAgICAgICBkLnNldE1pbnV0ZXMoIHJlc3VsdC5jYWxlbmRhcl9kaXNwbGF5X3N0YXJ0X21pbnV0ZXMgKTsKICAgICAgICAgICAgICByZXN1bHQubXl0aW1lID0gZDsKICAgICAgICAgICAgICByZXN1bHQuY2FsZW5kYXJfZGlzcGxheV9zdGFydCA9IGQ7CiAgICAgICAgICAgICAgdmFyIGQgPSBuZXcgRGF0ZSgpOwogICAgICAgICAgICAgIGQuc2V0SG91cnMoIHJlc3VsdC5jYWxlbmRhcl9kaXNwbGF5X2VuZF9ob3VycyApOwogICAgICAgICAgICAgIGQuc2V0TWludXRlcyggcmVzdWx0LmNhbGVuZGFyX2Rpc3BsYXlfZW5kX21pbnV0ZXMgKTsKICAgICAgICAgICAgICByZXN1bHQubXl0aW1lID0gZDsKICAgICAgICAgICAgICByZXN1bHQuY2FsZW5kYXJfZGlzcGxheV9lbmQgPSBkOwogICAgICAgICAgICAgIHJlc3VsdC52YXRfcmF0ZSA9IE51bWJlcihyZXN1bHQudmF0X3JhdGUpOwogICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9Owp9KTsKCmt1emVBcHAuY29udHJvbGxlcignQ29uZmlnQnVzaW5lc3NDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJHRpbWVvdXQsIEJ1c2luZXNzQ29uZmlnKQp7CiAgbG9nRGVidWcoIm15IGJ1c2luZXNzIGNvbmZpZyIpOwogICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzPVtdOwoKICBmdW5jdGlvbiBnZXRfYnVzaW5lc3NfY29uZmlnKCkgewogICAgbG9nRGVidWcoImdldF9idXNpbmVzc19jb25maWciKTsKICAgIGxvZ0RlYnVnKCJCdXNpbmVzc0NvbmZpZzogIiwgQnVzaW5lc3NDb25maWcpOwogICAgQnVzaW5lc3NDb25maWcuZ2V0KCkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7ICRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMgPSByZXN1bHQ7IH0pOwogIH0KICBnZXRfYnVzaW5lc3NfY29uZmlnKCk7CgoKICAkc2NvcGUuaHN0ZXAgPSAxOwogICRzY29wZS5tc3RlcCA9IDE1OwoKICAgICRzY29wZS5idXNpbmVzc0NvbmZpZ0NhbmNlbCA9IGZ1bmN0aW9uKCkgewogICAgICB3aW5kb3cuaGlzdG9yeS5iYWNrKCk7CiAgICB9OwoKICAgICRzY29wZS51cGRhdGVCdXNpbmVzc0NvbmZpZyA9IGZ1bmN0aW9uKCkgewogICAgICAgIGxvZ0RlYnVnKCJ1cGRhdGluZyBidXNpbmVzcyBjb25maWciICsgSlNPTi5zdHJpbmdpZnkoJHNjb3BlLmJ1c2luZXNzUHJvcGVydGllcykpOwoKICAgICAgICAkc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzX2FqYXhfZXJyb3I9IiI7CiAgICAgICAgJHNjb3BlLmJ1c2luZXNzUHJvcGVydGllcy5jYWxlbmRhcl9kaXNwbGF5X3N0YXJ0X2hvdXJzPSRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMuY2FsZW5kYXJfZGlzcGxheV9zdGFydC5nZXRIb3VycygpOwogICAgICAgICRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMuY2FsZW5kYXJfZGlzcGxheV9zdGFydF9taW51dGVzPSRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMuY2FsZW5kYXJfZGlzcGxheV9zdGFydC5nZXRNaW51dGVzKCk7CiAgICAgICAgJHNjb3BlLmJ1c2luZXNzUHJvcGVydGllcy5jYWxlbmRhcl9kaXNwbGF5X2VuZF9ob3Vycz0kc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzLmNhbGVuZGFyX2Rpc3BsYXlfZW5kLmdldEhvdXJzKCk7CiAgICAgICAgJHNjb3BlLmJ1c2luZXNzUHJvcGVydGllcy5jYWxlbmRhcl9kaXNwbGF5X2VuZF9taW51dGVzPSRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMuY2FsZW5kYXJfZGlzcGxheV9lbmQuZ2V0TWludXRlcygpOwogICAgICAgIGlmICgkc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzLmNhbGVuZGFyX2Rpc3BsYXlfc3RhcnRfaG91cnM+JHNjb3BlLmJ1c2luZXNzUHJvcGVydGllcy5jYWxlbmRhcl9kaXNwbGF5X2VuZF9ob3VycykKICAgICAgICB7CiAgICAgICAgICBhbGVydCgn15bXntefINeh15nXldedINec15Ag15nXm9eV15wg15zXlNeZ15XXqiDXnNek16DXmSDXltee158g15TXqteX15zXlCcpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICAkc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzX2FqYXhfZXJyb3I9Itee16LXk9eb158g16DXqteV16DXmdedLi4uIjsKCiAgICAgICAgJGh0dHAoewogICAgICAgICAgICBtZXRob2Q6ICdQT1NUJywKICAgICAgICAgICAgdXJsOiAnL2FwaS9hZG1pbi9idXNpbmVzc19jb25maWcvc2V0JywKICAgICAgICAgICAgZGF0YTogJHNjb3BlLmJ1c2luZXNzUHJvcGVydGllcywgLy8gcGFzcyBpbiBkYXRhIGFzIHN0cmluZ3MKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uO2NoYXJzZXQ9dXRmLTgnCiAgICAgICAgICAgIH0KICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHsKCiAgICAgICAgICAgIGxvZ0RlYnVnKGRhdGEpOwogICAgICAgICAgICBpZiAoIWRhdGEuc3VjY2VzcykgewogICAgICAgICAgICAgICAgbG9nRGVidWcoImVycm9yICIgKyBkYXRhLk1lc3NhZ2UpOwogICAgICAgICAgICAgICAgJHNjb3BlLmJ1c2luZXNzUHJvcGVydGllc19hamF4X2Vycm9yID0gZGF0YS5NZXNzYWdlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJGdDYWxlbmRhckRpc3BsYXlNaW5UaW1lPWRhdGEuanNvbi5uZXdTdGFydFRpbWU7CiAgICAgICAgICAgICAgICAkZ0NhbGVuZGFyRGlzcGxheU1heFRpbWU9ZGF0YS5qc29uLm5ld0VuZFRpbWU7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygidXBkYXRlZCBnQ2FsZW5kYXJEaXNwbGF5TWluVGltZT0iKyRnQ2FsZW5kYXJEaXNwbGF5TWluVGltZSk7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygidXBkYXRlZCBnQ2FsZW5kYXJEaXNwbGF5TWF4VGltZT0iKyRnQ2FsZW5kYXJEaXNwbGF5TWF4VGltZSk7CiAgICAgICAgICAgICAgICAkc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzX2FqYXhfZXJyb3I9Itei15XXk9eb158g15HXlNem15zXl9eUISI7CiAgICAgICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXNfYWpheF9lcnJvcj1udWxsOwogICAgICAgICAgICAgICAgfSwgMjAwMCk7CiAgICAgICAgICAgICAgICBnZXRfYnVzaW5lc3NfY29uZmlnKCk7CiAgICAgICAgICAgICAgICAvLyB3aW5kb3cuaGlzdG9yeS5iYWNrKCk7CiAgICAgICAgICAgICAgICAvLyAkc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzX2FqYXhfZXJyb3IgPSAi16TXqNeY15kg15TXoteh16cg16DXqdee16jXlSDXkdeU16bXnNeX15QuIjsKCiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH07Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignY2xpZW50Q2FyZENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUpIHsKICAgIGxvZ0RlYnVnKCJjbGllbnRDYXJkQ29udHJvbGxlciIpOwogICAgJHNjb3BlLmZ1dHVyZU1lZXRpbmdzID0gW3sKICAgICAgICBkYXRldGltZTogIteo15DXqdeV158sIDI1LjEuMjAxNiIsCiAgICAgICAgaG91cjogIjE0OjAwIiwKICAgICAgICB0eXBlOiAi16fXkdeV16bXlCIsCiAgICAgICAgcHJpY2U6ICIxMDAiLAogICAgICAgIGxhYmVsczogW3sKICAgICAgICAgICAgbGFiZWw6ICJzdWNjZXNzIiwKICAgICAgICAgICAgdGV4dDogItep15XXnNedIgogICAgICAgIH0sIHsKICAgICAgICAgICAgbGFiZWw6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgdGV4dDogItec15Ag16rXldei15MiCiAgICAgICAgfV0KICAgIH0sIHsKICAgICAgICBkYXRldGltZTogIteo15DXqdeV158sIDI1LjEuMjAxNiIsCiAgICAgICAgaG91cjogIjE0OjAwIiwKICAgICAgICB0eXBlOiAi16fXkdeV16bXlCIsCiAgICAgICAgcHJpY2U6ICIxMDAiLAogICAgICAgIGxhYmVsczogW3sKICAgICAgICAgICAgbGFiZWw6ICJkYW5nZXIiLAogICAgICAgICAgICB0ZXh0OiAi15zXkCDXqdeV15zXnSIKICAgICAgICB9LCB7CiAgICAgICAgICAgIGxhYmVsOiAiaW5mbyIsCiAgICAgICAgICAgIHRleHQ6ICLXqteV16LXkyIKICAgICAgICB9XQogICAgfSwgewogICAgICAgIGRhdGV0aW1lOiAi16nXnNeZ16nXmSwgMjUuMS4yMDE2IiwKICAgICAgICBob3VyOiAiMTQ6MDAiLAogICAgICAgIHR5cGU6ICLXp9eR15XXpteUIiwKICAgICAgICBwcmljZTogIjEwMCIsCiAgICAgICAgbGFiZWxzOiBbewogICAgICAgICAgICBsYWJlbDogImRhbmdlciIsCiAgICAgICAgICAgIHRleHQ6ICLXnNeQINep15XXnNedIgogICAgICAgIH0sIHsKICAgICAgICAgICAgbGFiZWw6ICJpbmZvIiwKICAgICAgICAgICAgdGV4dDogIteq15XXoteTIgogICAgICAgIH1dCiAgICB9LCB7CiAgICAgICAgZGF0ZXRpbWU6ICLXqNeQ16nXldefLCAyNS4xLjIwMTYiLAogICAgICAgIGhvdXI6ICIxNDowMCIsCiAgICAgICAgdHlwZTogIten15HXldem15QiLAogICAgICAgIHByaWNlOiAiMTAwIgogICAgfSwgXQoKICAgICRzY29wZS5oaXN0b3J5TWVldGluZ3MgPSBbewogICAgICAgIGRhdGV0aW1lOiAi16jXkNep15XXnywgMjUuMS4yMDE2IiwKICAgICAgICBob3VyOiAiMTQ6MDAiLAogICAgICAgIHR5cGU6ICLXp9eR15XXpteUIiwKICAgICAgICBwcmljZTogIjEwMCIKICAgIH0sIHsKICAgICAgICBkYXRldGltZTogIteo15DXqdeV158sIDI1LjEuMjAxNiIsCiAgICAgICAgaG91cjogIjE0OjAwIiwKICAgICAgICB0eXBlOiAi16fXkdeV16bXlCIsCiAgICAgICAgcHJpY2U6ICIxMDAiCiAgICB9LCB7CiAgICAgICAgZGF0ZXRpbWU6ICLXqdec15nXqdeZLCAyNS4xLjIwMTYiLAogICAgICAgIGhvdXI6ICIxNDowMCIsCiAgICAgICAgdHlwZTogIten15HXldem15QiLAogICAgICAgIHByaWNlOiAiMTAwIgogICAgfSwgewogICAgICAgIGRhdGV0aW1lOiAi16jXkNep15XXnywgMjUuMS4yMDE2IiwKICAgICAgICBob3VyOiAiMTQ6MDAiLAogICAgICAgIHR5cGU6ICLXp9eR15XXpteUIiwKICAgICAgICBwcmljZTogIjEwMCIKICAgIH0sIF0KCiAgICAkc2NvcGUuY2NQYXltZW50cyA9IFt7CiAgICAgICAgZGF0ZXRpbWU6ICLXqNeQ16nXldefLCAyNS4xLjIwMTYiLAogICAgICAgIHJlY2lwdF9udW06ICI3NjciLAogICAgICAgIGFtb3VudDogIjMwMCIsCiAgICAgICAgbGFiZWxzOiBbewogICAgICAgICAgICBsYWJlbDogImRhbmdlciIsCiAgICAgICAgICAgIHRleHQ6ICLXnNeQINep15XXmdeZ15oiCiAgICAgICAgfSwgewogICAgICAgICAgICBsYWJlbDogImluZm8iLAogICAgICAgICAgICB0ZXh0OiAi15TXldek16fXkyIKICAgICAgICB9XQogICAgfSwgXQoKCn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdrdXplQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikgewoKICAgIC8vIG1haW4ga3V6ZSBjb250cm9sbGVyCgogICAgLy8gTVVTVCBTRVQgTEFOR1VBR0UgQkVGT1JFIEFOWSBPVEhFUiBPUEVSQVRJT04gISEhCiAgICB1cGRhdGVHbG9iYWxMYW5ndWFnZSgkc2NvcGUsICRnRGVmYXVsdExhbmcpOwogICAgLy8gTVVTVCBTRVQgTEFOR1VBR0UgQkVGT1JFIEFOWSBPVEhFUiBPUEVSQVRJT04gISEhCgogICAgLy8gbG9nRGVidWcoInh4eHh4eHh4IiArICRzY29wZS5sYW5nZmlsZVsnc2hvd19hbGxfY2xpZW50cyddKTsKCiAgICAkc2NvcGUuc2hvd0NsaWVudHNDb2x1bW5zID0gW3sKICAgICAgICBmaWVsZDogJ3VzZXJfaWQnLAogICAgICAgIG5hbWU6ICRzY29wZS5sYW5nZmlsZVsnc2hvd19hbGxfY2xpZW50c191c2VyaWQnXQogICAgfSwgewogICAgICAgIGZpZWxkOiAnYnVzZXJfZmlyc3RfbmFtZScsCiAgICAgICAgbmFtZTogJHNjb3BlLmxhbmdmaWxlWydzaG93X2FsbF9jbGllbnRzX2ZpcnN0X25hbWUnXQogICAgfSwgewogICAgICAgIGZpZWxkOiAnYnVzZXJfbGFzdF9uYW1lJywKICAgICAgICBuYW1lOiAkc2NvcGUubGFuZ2ZpbGVbJ3Nob3dfYWxsX2NsaWVudHNfbGFzdF9uYW1lJ10KICAgIH0sIHsKICAgICAgICBmaWVsZDogJ3JvbGVfbmFtZScsCiAgICAgICAgbmFtZTogJHNjb3BlLmxhbmdmaWxlWydzaG93X2FsbF9jbGllbnRzX2FwcHJvdmVkJ10KICAgIH1dOwoKCiAgICAkc2NvcGUuZ3JpZENsaWVudENsaWNrID0gZnVuY3Rpb24ocm93KSB7CiAgICAgICAgLy9sb2dEZWJ1Zyhyb3cpOwogICAgICAgIHZhciByb3dfdXNlcmlkID0gcm93LmVudGl0eS51c2VyX2lkOwogICAgICAgIGxvZ0RlYnVnKCJzZWxlY3RlZCByb3cgdXNlcl9pZCA9IiArIHJvd191c2VyaWQpOwogICAgICAgICRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfY2xpZW50cy8nICsgcm93X3VzZXJpZCk7CiAgICB9OwoKICAgICRzY29wZS5zaG93Q2xpZW50c0dyaWRPcHRpb25zID0gewogICAgICAgIGVuYWJsZUZpbHRlcmluZzogZmFsc2UsCiAgICAgICAgZW5hYmxlU29ydGluZzogdHJ1ZSwKICAgICAgICBjb2x1bW5EZWZzOiAkc2NvcGUuc2hvd0NsaWVudHNDb2x1bW5zLAogICAgICAgIHJvd1RlbXBsYXRlOiAnL3B1YmxpYy9jb21wb25lbnRzL2NsaWVudHMtZ3JpZC1yb3cuaHRtbCcsCiAgICAgICAgb25SZWdpc3RlckFwaTogZnVuY3Rpb24oZ3JpZEFwaSkgewogICAgICAgICAgICAkc2NvcGUuZ3JpZEFwaSA9IGdyaWRBcGk7CiAgICAgICAgICAgICRzY29wZS5ncmlkQXBpLmdyaWQucmVnaXN0ZXJSb3dzUHJvY2Vzc29yKCRzY29wZS5zaW5nbGVGaWx0ZXIsIDIwMCk7CiAgICAgICAgfSwKICAgIH07CgogICAgJHNjb3BlLmlzQWN0aXZlID0gZnVuY3Rpb24odmlld0xvY2F0aW9uKSB7CiAgICAgICAgbG9nRGVidWcoInZpZXdMb2NhdGlvbiA9ICIgKyB2aWV3TG9jYXRpb24pOwogICAgICAgIHZhciBhY3RpdmUgPSAodmlld0xvY2F0aW9uID09PSAkbG9jYXRpb24ucGF0aCgpKTsKICAgICAgICByZXR1cm4gYWN0aXZlOwogICAgfTsKCiAgICAkc2NvcGUuZmlsdGVyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgbG9nRGVidWcoInNpbmdsZSBmaWx0ZXIiKTsKICAgICAgICAkc2NvcGUuZ3JpZEFwaS5ncmlkLnJlZnJlc2goKTsKICAgICAgICBpZiAoJHNjb3BlLmZpbHRlci5WYWx1ZSAhPSAiIikgewogICAgICAgICAgICAkc2NvcGUuZmlsdGVyLmJ1dHRvblZhbHVlID0gIiciICsgJHNjb3BlLmZpbHRlci5WYWx1ZSArICInIjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkc2NvcGUuZmlsdGVyLmJ1dHRvblZhbHVlID0gIiI7CiAgICAgICAgfQogICAgfTsKCiAgICAkc2NvcGUuc2luZ2xlRmlsdGVyID0gZnVuY3Rpb24ocmVuZGVyYWJsZVJvd3MpIHsKICAgICAgICB2YXIgbWF0Y2hlciA9IG5ldyBSZWdFeHAoJHNjb3BlLmZpbHRlci5WYWx1ZSk7CiAgICAgICAgbG9nRGVidWcoInNjb3BlPSIgKyAkc2NvcGUpOwogICAgICAgIGxvZ0RlYnVnKCJzY29wZS5maWx0ZXIuVmFsdWU9IiArICRzY29wZS5maWx0ZXIuVmFsdWUpOwogICAgICAgIGlmICgoJHNjb3BlLmZpbHRlci5WYWx1ZSA9PSBudWxsKSB8fCAoJHNjb3BlLmZpbHRlci5WYWx1ZSA9PSAiIikpIHsKICAgICAgICAgICAgbG9nRGVidWcoImVtcHR5IGZpbHRlciIpOwogICAgICAgICAgICByZXR1cm4gcmVuZGVyYWJsZVJvd3M7CiAgICAgICAgfQogICAgICAgIHJlbmRlcmFibGVSb3dzLmZvckVhY2goZnVuY3Rpb24ocm93KSB7CiAgICAgICAgICAgIC8vCQkJbG9nRGVidWcoInJvdz0iK3Jvdyk7CiAgICAgICAgICAgIHJvdy52aXNpYmxlID0gZmFsc2U7CiAgICAgICAgICAgIHZhciAkY3VyckZpcnN0TmFtZSA9IHJvdy5lbnRpdHlbJ2ZpcnN0X25hbWUnXTsKICAgICAgICAgICAgdmFyICRjdXJyTGFzdE5hbWUgPSByb3cuZW50aXR5WydsYXN0X25hbWUnXTsKICAgICAgICAgICAgbG9nRGVidWcoImN1cnJGaXJzdE5hbWU9IiArICRjdXJyRmlyc3ROYW1lKTsKCiAgICAgICAgICAgIGlmICgkY3VyckZpcnN0TmFtZSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoJGN1cnJGaXJzdE5hbWUuaW5kZXhPZigkc2NvcGUuZmlsdGVyLlZhbHVlKSA+IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgcm93LnZpc2libGUgPSB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgLy8gcm93IGlzIG51bGwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgcm93LnZpc2libGUgPSBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCRjdXJyTGFzdE5hbWUgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKCRjdXJyTGFzdE5hbWUuaW5kZXhPZigkc2NvcGUuZmlsdGVyLlZhbHVlKSA+IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgcm93LnZpc2libGUgPSB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgLy8gcm93IGlzIG51bGwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgcm93LnZpc2libGUgPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHJldHVybiByZW5kZXJhYmxlUm93czsKICAgIH07CgogICAgLy8gaW1wb3J0YW50ISEgaW5pdGlhbGl6aW5nIGFuZ3VsYXIgZm9ybXMgYXMgYXJyYXlzCiAgICAkc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIgPSB7fTsKICAgICRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhciA9IHt9OwoKICAgIC8vIGxvZ0RlYnVnKCJsb2NhdGlvbj0iICsgJGxvY2F0aW9uKTsKICAgIC8vIGxvZ0RlYnVnKCRsb2NhdGlvbik7CgogICAgJHNjb3BlLmNoYW5nZUxhbmcgPSBmdW5jdGlvbigkbmV3bGFuZykgewogICAgICAgIGxvZ0RlYnVnKCRuZXdsYW5nKTsKICAgICAgICAvLyRzY29wZS5zcENsYXNzID0gJ3JpZ2h0JzsKICAgICAgICB1cGRhdGVHbG9iYWxMYW5ndWFnZSgkc2NvcGUsICRuZXdsYW5nKQogICAgfQoKICAgICRzY29wZS5hZGROZXdDbGllbnQgPSBmdW5jdGlvbigpIHsKICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2NsaWVudHMvYWRkJyk7CiAgICB9CiAgICAkc2NvcGUuYWRkTmV3SW5zdHJ1Y3RvciA9IGZ1bmN0aW9uKCkgewogICAgICAgICRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfaW5zdHJ1Y3RvcnMvYWRkJyk7CiAgICB9Cn0pOwoKLy8vLy8vIGJlZm9yZSBmb3JtcwprdXplQXBwLmNvbnRyb2xsZXIoJ0RlbW9Db250cm9sbGVyJywgWwogICAgJyRzY29wZScsICckYnVpbGRlcicsICckdmFsaWRhdG9yJywKICAgIGZ1bmN0aW9uKCRzY29wZSwgJGJ1aWxkZXIsICR2YWxpZGF0b3IpIHsKICAgICAgICB2YXIgY2hlY2tib3gsIHRleHRib3g7CiAgICAgICAgdGV4dGJveCA9ICRidWlsZGVyLmFkZEZvcm1PYmplY3QoJ2RlZmF1bHQnLCB7CiAgICAgICAgICAgIGlkOiAndGV4dGJveCcsCiAgICAgICAgICAgIGNvbXBvbmVudDogJ3RleHRJbnB1dCcsCiAgICAgICAgICAgIGxhYmVsOiAnTmFtZScsCiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnWW91ciBuYW1lJywKICAgICAgICAgICAgcGxhY2Vob2xkZXI6ICdZb3VyIG5hbWUnLAogICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgZWRpdGFibGU6IGZhbHNlCiAgICAgICAgfSk7CiAgICAgICAgY2hlY2tib3ggPSAkYnVpbGRlci5hZGRGb3JtT2JqZWN0KCdkZWZhdWx0JywgewogICAgICAgICAgICBpZDogJ2NoZWNrYm94JywKICAgICAgICAgICAgY29tcG9uZW50OiAnY2hlY2tib3gnLAogICAgICAgICAgICBsYWJlbDogJ1BldHMnLAogICAgICAgICAgICBkZXNjcmlwdGlvbjogJ0RvIHlvdSBoYXZlIGFueSBwZXRzPycsCiAgICAgICAgICAgIG9wdGlvbnM6IFsnRG9nJywgJ0NhdCddCiAgICAgICAgfSk7CiAgICAgICAgJGJ1aWxkZXIuYWRkRm9ybU9iamVjdCgnZGVmYXVsdCcsIHsKICAgICAgICAgICAgY29tcG9uZW50OiAnc2FtcGxlSW5wdXQnCiAgICAgICAgfSk7CiAgICAgICAgJHNjb3BlLmZvcm0gPSAkYnVpbGRlci5mb3Jtc1snZGVmYXVsdCddOwogICAgICAgICRzY29wZS5pbnB1dCA9IFtdOwogICAgICAgICRzY29wZS5kZWZhdWx0VmFsdWUgPSB7fTsKICAgICAgICAkc2NvcGUuZGVmYXVsdFZhbHVlW3RleHRib3guaWRdID0gJ2RlZmF1bHQgdmFsdWUnOwogICAgICAgICRzY29wZS5kZWZhdWx0VmFsdWVbY2hlY2tib3guaWRdID0gW3RydWUsIHRydWVdOwogICAgICAgIHJldHVybiAkc2NvcGUuc3VibWl0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiAkdmFsaWRhdG9yLnZhbGlkYXRlKCRzY29wZSwgJ2RlZmF1bHQnKS5zdWNjZXNzKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGxvZ0RlYnVnKCdzdWNjZXNzJyk7CiAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGxvZ0RlYnVnKCdlcnJvcicpOwogICAgICAgICAgICB9KTsKICAgICAgICB9OwogICAgfQpdKTsKCmt1emVBcHAuY29udHJvbGxlcignQWxlcnREZW1vQ3RybCcsIGZ1bmN0aW9uKCRzY29wZSkgewogICAgJHNjb3BlLmFsZXJ0cyA9IFt7CiAgICAgICAgdHlwZTogJ2RhbmdlcicsCiAgICAgICAgbXNnOiAnT2ggc25hcCEgQ2hhbmdlIGEgZmV3IHRoaW5ncyB1cCBhbmQgdHJ5IHN1Ym1pdHRpbmcgYWdhaW4uJwogICAgfSwgewogICAgICAgIHR5cGU6ICdzdWNjZXNzJywKICAgICAgICBtc2c6ICdXZWxsIGRvbmUhIFlvdSBzdWNjZXNzZnVsbHkgcmVhZCB0aGlzIGltcG9ydGFudCBhbGVydCBtZXNzYWdlLicKICAgIH1dOwoKICAgICRzY29wZS5hZGRBbGVydCA9IGZ1bmN0aW9uKCkgewogICAgICAgICRzY29wZS5hbGVydHMucHVzaCh7CiAgICAgICAgICAgIG1zZzogJ0Fub3RoZXIgYWxlcnQhJwogICAgICAgIH0pOwogICAgfTsKCiAgICAkc2NvcGUuY2xvc2VBbGVydCA9IGZ1bmN0aW9uKGluZGV4KSB7CiAgICAgICAgJHNjb3BlLmFsZXJ0cy5zcGxpY2UoaW5kZXgsIDEpOwogICAgfTsKfSk7CgoKZnVuY3Rpb24gaXNOdW1iZXJLZXkoZXZ0KXsKICAgIHZhciBjaGFyQ29kZSA9IChldnQud2hpY2gpID8gZXZ0LndoaWNoIDogZXZlbnQua2V5Q29kZTsKICAgIHJldHVybiAhKGNoYXJDb2RlID4gMzEgJiYgKGNoYXJDb2RlIDwgNDggfHwgY2hhckNvZGUgPiA1NykpOwp9</text>
      </register>
      <register name="6" type="2">
        <text encoding="base64">PD9waHAgaW5jbHVkZSAnYnVzaW5lc3MtYXBwLXYxMS5qcycKPz4K</text>
      </register>
      <register name="7" type="2">
        <text encoding="base64">ICAgICRpbnZvaWNlX3NvdXJjZV9pZD1rdXplX3V0aWxzOjpnZXRJbnZvaWNlU291cmNlSWQoKTsK</text>
      </register>
      <register name="8" type="2">
        <text encoding="base64">ICBrdXplX3V0aWxzOjpsb2dEZWJ1ZygiaW52b2ljZV9zb3VyY2U9JGludm9pY2Vfc291cmNlIik7Cg==</text>
      </register>
      <register name="9" type="2">
        <text encoding="base64">KTsK</text>
      </register>
      <register name=":" type="4">
        <text>%s/&quot;yPos&quot;: 0.20000000298023225/&quot;yPos&quot;: 0.1/</text>
      </register>
    </registers>
    <search>
      <last-search encoding="base64">XDxjdXJyZW50Q2xpZW50XD4=</last-search>
      <last-offset />
      <last-pattern encoding="base64">XDxjdXJyZW50Q2xpZW50XD4=</last-pattern>
      <last-replace>&quot;yPos&quot;: 0.1</last-replace>
      <last-substitute>&quot;yPos&quot;: 0.20000000298023225</last-substitute>
      <last-dir>1</last-dir>
      <show-last>false</show-last>
    </search>
    <history>
      <history-search>
        <entry>'</entry>
        <entry>payment</entry>
        <entry>credit_card_type</entry>
        <entry>console.log</entry>
        <entry>cliend</entry>
        <entry>thedata</entry>
        <entry>Clliend</entry>
        <entry>Business</entry>
        <entry>paymentMethods</entry>
        <entry>business</entry>
        <entry>admin</entry>
        <entry>\/business_config</entry>
        <entry>\cUser</entry>
        <entry>cliendCard</entry>
        <entry>cliendBu</entry>
        <entry>CliendB</entry>
        <entry>Cliend</entry>
        <entry>BusinessCo</entry>
        <entry>\cbusinessconfig</entry>
        <entry encoding="base64">XDxjdXJyZW50Q2xpZW50XD4=</entry>
      </history-search>
      <history-cmd>
        <entry encoding="base64">JzwsJz5zLzsvJ107Lw==</entry>
        <entry>s/, /\r/g</entry>
        <entry>s/, /,\r/g</entry>
        <entry>Reg</entry>
        <entry>reg</entry>
        <entry encoding="base64">JzwsJz5zL1wkLy9n</entry>
        <entry encoding="base64">JzwsJz5zLywkLyAuICIsIi8=</entry>
        <entry encoding="base64">JzwsJz5zLywkLyAuICIsIiAuLw==</entry>
        <entry encoding="base64">JzwsJz5zL1xFLykv</entry>
        <entry encoding="base64">JzwsJz5zL1w+Lykv</entry>
        <entry encoding="base64">JzwsJz5zLyAuLykgLi8=</entry>
        <entry encoding="base64">JzwsJz5zLyBcLi8pIC4v</entry>
        <entry encoding="base64">JzwsJz5zLyA9LiokLywv</entry>
        <entry encoding="base64">JzwsJz5zLyB8fCBudWxsLy8=</entry>
        <entry encoding="base64">JzwsJz5zLywgLywiIC4gIi8=</entry>
        <entry encoding="base64">JzwsJz5zLywgLywiIC4gIi9n</entry>
        <entry encoding="base64">JzwsJz5zLyBcLiAvIC5cci9n</entry>
        <entry encoding="base64">JzwsJz5zLyIiLyInJyIv</entry>
        <entry encoding="base64">JzwsJz5zLywvJywv</entry>
        <entry encoding="base64">JzwsJz5zLycvLw==</entry>
      </history-cmd>
      <history-expr />
      <history-input />
    </history>
    <shortcut-conflicts>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed OPEN_BRACKET</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed V</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed F</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed U</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed S</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed N</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed P</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed W</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>shift ctrl pressed A</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed C</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed D</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed R</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed A</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed T</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed I</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed B</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed CLOSE_BRACKET</text>
      </shortcut-conflict>
    </shortcut-conflicts>
  </component>
</application>
<application>
  <component name="VimSettings">
    <state version="4" enabled="true" />
    <globalmarks />
    <filemarks>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/Decoration.cs" timestamp="1497974348932">
        <mark key="'" line="59" column="96" />
        <mark key="[" line="49" column="5" />
        <mark key="]" line="50" column="76" />
        <mark key="^" line="50" column="76" />
        <mark key="." line="50" column="76" />
      </file>
      <file name="$USER_HOME$/Projects/mocha-given/index.d.ts" timestamp="1490284104781">
        <mark key="'" line="1" column="0" />
        <mark key="[" line="11" column="0" />
        <mark key="]" line="11" column="0" />
        <mark key="." line="11" column="0" />
        <mark key="^" line="1" column="11" />
      </file>
      <file name="$APPLICATION_CONFIG_DIR$/scratches/scratch_2.json" timestamp="1492339330086">
        <mark key="[" line="3" column="0" />
        <mark key="]" line="3" column="0" />
        <mark key="." line="3" column="0" />
      </file>
      <file name="/a.dummy" timestamp="1497520323357">
        <mark key="[" line="0" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/CameraMovement.cs" timestamp="1497450852828">
        <mark key="'" line="193" column="4" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/UI/ExitToast.cs" timestamp="1497532567374">
        <mark key="'" line="40" column="0" />
        <mark key="[" line="2" column="0" />
        <mark key="]" line="2" column="0" />
        <mark key="." line="2" column="0" />
        <mark key="^" line="10" column="9" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/PieceGenerator.cs" timestamp="1497881338401">
        <mark key="'" line="158" column="26" />
        <mark key="[" line="107" column="28" />
        <mark key="]" line="107" column="37" />
        <mark key="." line="107" column="37" />
        <mark key="^" line="107" column="37" />
      </file>
      <file name="$APPLICATION_CONFIG_DIR$/scratches/scratch.json" timestamp="1492339698148">
        <mark key="'" line="21" column="0" />
        <mark key="[" line="2" column="14" />
        <mark key="]" line="2" column="13" />
        <mark key="." line="2" column="13" />
        <mark key="^" line="2" column="13" />
      </file>
      <file name="$APPLICATION_CONFIG_DIR$/scratches/scratch_3.json" timestamp="1492678325641">
        <mark key="'" line="4983" column="0" />
        <mark key="[" line="0" column="0" />
        <mark key="]" line="0" column="48708" />
        <mark key="^" line="0" column="48708" />
        <mark key="." line="0" column="48708" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/UI/GameEditor/SaveButton.cs" timestamp="1497883434954">
        <mark key="'" line="70" column="26" />
        <mark key="[" line="53" column="102" />
        <mark key="]" line="53" column="105" />
        <mark key="." line="53" column="105" />
        <mark key="^" line="53" column="105" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/PuzzlePiece.cs" timestamp="1497973981788">
        <mark key="'" line="70" column="42" />
        <mark key="[" line="199" column="8" />
        <mark key="]" line="199" column="42" />
        <mark key="." line="199" column="42" />
        <mark key="^" line="199" column="42" />
      </file>
      <file name="$USER_HOME$/Projects/Guy Prives/Automator/server/config/environment/production.ts" timestamp="1492787130440">
        <mark key="[" line="11" column="26" />
        <mark key="]" line="11" column="26" />
        <mark key="." line="11" column="34" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/public/js/angular/kuze_business_utils-v11.js" timestamp="1498380813341">
        <mark key="'" line="833" column="9" />
      </file>
      <file name="$USER_HOME$/Projects/Guy Prives/Automator/server/config/environment/development.ts" timestamp="1492787124254">
        <mark key="[" line="9" column="26" />
        <mark key="]" line="9" column="34" />
        <mark key="." line="9" column="34" />
        <mark key="^" line="9" column="34" />
      </file>
      <file name="$USER_HOME$/Projects/luftzig.com/front/src/Sections/WhoAmI.elm" timestamp="1497690707700">
        <mark key="[" line="5" column="32" />
        <mark key="]" line="5" column="35" />
        <mark key="^" line="5" column="34" />
        <mark key="." line="5" column="35" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/angular/business_modal_client_payment.php" timestamp="1498381358793">
        <mark key="'" line="44" column="41" />
        <mark key="[" line="68" column="10" />
        <mark key="]" line="65" column="64" />
        <mark key="." line="65" column="64" />
        <mark key="^" line="65" column="64" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/db_scripts/2017_06_21_Business_invoices.sql" timestamp="1498380038149">
        <mark key="[" line="19" column="77" />
        <mark key="]" line="19" column="0" />
        <mark key="." line="19" column="0" />
        <mark key="^" line="19" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/.gitignore" timestamp="1497785206525">
        <mark key="[" line="0" column="0" />
        <mark key="]" line="1" column="7" />
        <mark key="^" line="1" column="7" />
        <mark key="." line="1" column="7" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/AndroidGalleryImageSaver.cs" timestamp="1497519923388">
        <mark key="'" line="31" column="0" />
        <mark key="[" line="15" column="0" />
        <mark key="]" line="15" column="0" />
        <mark key="^" line="15" column="16" />
        <mark key="." line="15" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/kuze_payment_utils.php" timestamp="1498052001162">
        <mark key="'" line="182" column="34" />
        <mark key="[" line="56" column="96" />
        <mark key="]" line="57" column="36" />
        <mark key="^" line="57" column="36" />
        <mark key="." line="57" column="36" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/kuze_config/dev/kuze_config.php" timestamp="1497781648229">
        <mark key="[" line="43" column="0" />
        <mark key="]" line="48" column="37" />
        <mark key="." line="47" column="31" />
        <mark key="^" line="47" column="31" />
      </file>
      <file name="$USER_HOME$/Projects/luftzig.com/front/src/Styling.elm" timestamp="1497700286779">
        <mark key="'" line="39" column="31" />
        <mark key="[" line="39" column="47" />
        <mark key="]" line="39" column="47" />
        <mark key="." line="39" column="47" />
        <mark key="^" line="39" column="47" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php.ini" timestamp="1497781365670">
        <mark key="[" line="0" column="24" />
        <mark key="]" line="0" column="23" />
        <mark key="^" line="0" column="23" />
        <mark key="." line="0" column="23" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/angular/business_event_card.php" timestamp="1498032963100">
        <mark key="'" line="112" column="17" />
        <mark key="[" line="112" column="157" />
        <mark key="]" line="112" column="178" />
      </file>
      <file name="$USER_HOME$/Projects/luftzig.com/front/elm-stuff/packages/rtfeldman/elm-css/8.1.0/src/Css.elm" timestamp="1497694656695">
        <mark key="'" line="4371" column="8" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/kuze_const.php" timestamp="1498044815249">
        <mark key="'" line="79" column="0" />
        <mark key="[" line="37" column="31" />
        <mark key="]" line="37" column="34" />
        <mark key="." line="37" column="34" />
        <mark key="^" line="37" column="34" />
      </file>
      <file name="$USER_HOME$/Projects/Guy Prives/Automator/server/gulpfile.js" timestamp="1491404784596">
        <mark key="[" line="25" column="25" />
        <mark key="]" line="25" column="41" />
        <mark key="^" line="25" column="41" />
        <mark key="." line="25" column="41" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/angular/business_config.php" timestamp="1498044504233">
        <mark key="'" line="84" column="40" />
        <mark key="[" line="31" column="0" />
        <mark key="]" line="31" column="0" />
        <mark key="." line="31" column="0" />
        <mark key="^" line="109" column="210" />
      </file>
      <file name="$USER_HOME$/Projects/Guy Prives/Automator/server/api/campaigns-view/campaign.model.ts" timestamp="1492790714937">
        <mark key="[" line="19" column="22" />
        <mark key="]" line="19" column="31" />
        <mark key="^" line="19" column="31" />
        <mark key="." line="19" column="31" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/PieceHex.cs" timestamp="1497973650339">
        <mark key="'" line="29" column="12" />
        <mark key="[" line="23" column="0" />
        <mark key="]" line="23" column="0" />
        <mark key="." line="23" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/luftzig.com/front/src/Main.elm" timestamp="1497695316614">
        <mark key="'" line="11" column="17" />
        <mark key="[" line="24" column="8" />
        <mark key="]" line="24" column="23" />
        <mark key="." line="24" column="23" />
        <mark key="^" line="24" column="23" />
      </file>
      <file name="$USER_HOME$/Projects/Guy Prives/Automator/server/src/index.ts" timestamp="1491408128292">
        <mark key="[" line="5" column="1" />
        <mark key="]" line="5" column="1" />
        <mark key="." line="5" column="1" />
        <mark key="^" line="5" column="1" />
      </file>
      <file name="$USER_HOME$/Projects/Guy Prives/Automator/server/api/updater/updater.model.ts" timestamp="1492787491819">
        <mark key="'" line="19" column="105" />
        <mark key="[" line="19" column="105" />
        <mark key="]" line="19" column="105" />
        <mark key="^" line="19" column="105" />
        <mark key="." line="19" column="105" />
      </file>
      <file name="$USER_HOME$/Projects/Guy Prives/Automator/server/api/appreciate-client/CampaignPatch.ts" timestamp="1492686242202">
        <mark key="[" line="4" column="14" />
        <mark key="]" line="4" column="26" />
        <mark key="." line="4" column="26" />
        <mark key="^" line="4" column="26" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/docker-compose.yml" timestamp="1497790359903">
        <mark key="[" line="20" column="15" />
        <mark key="]" line="20" column="17" />
        <mark key="." line="20" column="17" />
        <mark key="^" line="20" column="17" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/GardenScreenshot.cs" timestamp="1497536741022">
        <mark key="'" line="171" column="8" />
        <mark key="[" line="175" column="39" />
        <mark key="]" line="175" column="49" />
        <mark key="." line="175" column="49" />
        <mark key="^" line="175" column="49" />
      </file>
      <file name="$USER_HOME$/Projects/Guy Prives/Automator/server/src/page.ts" timestamp="1491408215088">
        <mark key="[" line="0" column="0" />
        <mark key="]" line="2" column="1" />
        <mark key="^" line="2" column="1" />
        <mark key="." line="2" column="1" />
      </file>
      <file name="$USER_HOME$/Projects/Guy Prives/Automator/server/api/appreciate-client/appreciate-client.ts" timestamp="1492789578918">
        <mark key="'" line="82" column="20" />
        <mark key="[" line="65" column="41" />
        <mark key="]" line="65" column="51" />
        <mark key="^" line="65" column="51" />
        <mark key="." line="65" column="51" />
      </file>
      <file name="$USER_HOME$/Projects/Guy Prives/Automator/server/api/appreciate-client/patch-request-converter.ts" timestamp="1492680861043">
        <mark key="'" line="64" column="0" />
        <mark key="[" line="65" column="25" />
        <mark key="]" line="65" column="31" />
        <mark key="^" line="65" column="31" />
        <mark key="." line="65" column="31" />
      </file>
      <file name="$USER_HOME$/Projects/Guy Prives/Automator/server/api/appreciate-client/campaign.model.ts" timestamp="1492786547226">
        <mark key="[" line="21" column="43" />
        <mark key="]" line="21" column="58" />
        <mark key="." line="21" column="58" />
        <mark key="^" line="21" column="58" />
      </file>
      <file name="$APPLICATION_CONFIG_DIR$/consoles/db/6e25fe0b-98f3-46a4-9336-01e7aed49277/console.sql" timestamp="1498052057448">
        <mark key="[" line="0" column="28" />
        <mark key="]" line="0" column="27" />
        <mark key="." line="0" column="27" />
        <mark key="^" line="0" column="27" />
      </file>
      <file name="$USER_HOME$/Projects/Guy Prives/Automator/server/api/appreciate-client/Campaign.ts" timestamp="1492339605604">
        <mark key="[" line="3" column="17" />
        <mark key="]" line="4" column="21" />
        <mark key="^" line="4" column="21" />
        <mark key="." line="4" column="21" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/UI/SavedImageToast.cs" timestamp="1497521665292">
        <mark key="[" line="17" column="9" />
        <mark key="]" line="21" column="22" />
        <mark key="." line="21" column="22" />
        <mark key="^" line="21" column="22" />
      </file>
      <file name="$USER_HOME$/Projects/the_bar_node/server/.gitignore" timestamp="1490277634801">
        <mark key="[" line="4" column="6" />
        <mark key="]" line="5" column="7" />
        <mark key="^" line="5" column="7" />
        <mark key="." line="5" column="7" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/DragAndDrop.cs" timestamp="1497973668942">
        <mark key="'" line="34" column="14" />
        <mark key="[" line="47" column="0" />
        <mark key="]" line="54" column="4" />
        <mark key="." line="19" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/Guy Prives/Automator/server/src/main.js.ts" timestamp="1491408186798">
        <mark key="[" line="4" column="0" />
        <mark key="]" line="4" column="4" />
        <mark key="^" line="4" column="4" />
        <mark key="." line="4" column="4" />
      </file>
      <file name="$USER_HOME$/Projects/luftzig.com/front/.gitignore" timestamp="1497188838530">
        <mark key="[" line="1" column="6" />
        <mark key="]" line="2" column="0" />
        <mark key="^" line="2" column="0" />
        <mark key="." line="2" column="0" />
      </file>
      <file name="$APPLICATION_CONFIG_DIR$/scratches/scratch_1.json" timestamp="1492339311193">
        <mark key="'" line="2669" column="0" />
        <mark key="[" line="0" column="0" />
        <mark key="]" line="2669" column="0" />
        <mark key="^" line="0" column="31135" />
        <mark key="." line="0" column="31135" />
      </file>
      <file name="$USER_HOME$/Projects/Guy Prives/Automator/server/webpack.js" timestamp="1491407163613">
        <mark key="[" line="17" column="19" />
        <mark key="]" line="17" column="25" />
        <mark key="." line="17" column="25" />
        <mark key="^" line="17" column="25" />
      </file>
      <file name="$USER_HOME$/Projects/luftzig.com/front/src/Sections/Main.elm" timestamp="1497264215848">
        <mark key="[" line="2" column="0" />
        <mark key="]" line="2" column="0" />
        <mark key="^" line="2" column="25" />
        <mark key="." line="2" column="0" />
      </file>
      <file name="$APPLICATION_CONFIG_DIR$/scratches/scratch_4.json" timestamp="1492678382301">
        <mark key="[" line="0" column="0" />
        <mark key="]" line="107" column="0" />
        <mark key="^" line="107" column="0" />
        <mark key="." line="107" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/phpold/kuze_utils.php" timestamp="1497784331390">
        <mark key="'" line="59" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/Guy Prives/Automator/server/webpack.config.js" timestamp="1491408271452">
        <mark key="[" line="13" column="12" />
        <mark key="]" line="13" column="13" />
        <mark key="^" line="13" column="13" />
        <mark key="." line="13" column="13" />
      </file>
      <file name="$USER_HOME$/Projects/Guy Prives/Automator/server/api/updater/updater.helpers.ts" timestamp="1492791203674">
        <mark key="'" line="25" column="36" />
        <mark key="[" line="33" column="48" />
        <mark key="]" line="34" column="24" />
        <mark key="." line="34" column="24" />
        <mark key="^" line="34" column="24" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/UI/GameEditor/ShareGardenButton.cs" timestamp="1497533996458">
        <mark key="'" line="24" column="51" />
        <mark key="[" line="29" column="0" />
        <mark key="]" line="29" column="36" />
        <mark key="." line="29" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/Guy Prives/Automator/server/routes/index.ts" timestamp="1491406948665">
        <mark key="[" line="2" column="0" />
        <mark key="]" line="2" column="0" />
        <mark key="." line="2" column="4" />
        <mark key="^" line="1" column="4" />
      </file>
      <file name="$APPLICATION_CONFIG_DIR$/scratches/scratch.js" timestamp="1498046463701">
        <mark key="[" line="0" column="0" />
        <mark key="]" line="0" column="0" />
        <mark key="." line="0" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/public/js/angular/kuze_enduser_app.js" timestamp="1498045366621">
        <mark key="'" line="1187" column="20" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/kuze_general_business_utils.php" timestamp="1498052689298">
        <mark key="'" line="129" column="24" />
        <mark key="[" line="129" column="30" />
        <mark key="]" line="129" column="30" />
        <mark key="." line="129" column="30" />
        <mark key="^" line="129" column="30" />
      </file>
      <file name="$USER_HOME$/Projects/Guy Prives/Automator/server/docker-compose.yml" timestamp="1492784969603">
        <mark key="[" line="28" column="17" />
        <mark key="]" line="28" column="19" />
        <mark key="." line="28" column="19" />
        <mark key="^" line="28" column="19" />
      </file>
      <file name="$USER_HOME$/Projects/Guy Prives/Automator/server/package.json" timestamp="1492003154014">
        <mark key="'" line="6" column="19" />
        <mark key="[" line="37" column="19" />
        <mark key="]" line="37" column="24" />
        <mark key="." line="37" column="24" />
        <mark key="^" line="37" column="24" />
      </file>
      <file name="$USER_HOME$/Projects/Guy Prives/Automator/server/app.ts" timestamp="1491984160678">
        <mark key="[" line="15" column="0" />
        <mark key="]" line="15" column="0" />
        <mark key="." line="15" column="0" />
        <mark key="^" line="7" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/Guy Prives/Automator/server/api/appreciate-client/budget-line.ts" timestamp="1492338169256">
        <mark key="[" line="0" column="0" />
        <mark key="]" line="0" column="21" />
        <mark key="^" line="0" column="21" />
        <mark key="." line="0" column="21" />
      </file>
      <file name="$USER_HOME$/Projects/mocha-given/package.json" timestamp="1490283218372">
        <mark key="'" line="10" column="18" />
        <mark key="[" line="10" column="14" />
        <mark key="]" line="10" column="18" />
        <mark key="^" line="10" column="18" />
        <mark key="." line="10" column="18" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/Dockerfile" timestamp="1498035272323">
        <mark key="[" line="0" column="9" />
        <mark key="]" line="0" column="11" />
        <mark key="^" line="0" column="11" />
        <mark key="." line="0" column="11" />
      </file>
      <file name="$USER_HOME$/Projects/Guy Prives/Automator/server/api/campaigns-view/campaign.view.ts" timestamp="1492787095058">
        <mark key="[" line="8" column="17" />
        <mark key="]" line="9" column="53" />
        <mark key="." line="9" column="53" />
        <mark key="^" line="9" column="53" />
      </file>
      <file name="$USER_HOME$/Projects/luftzig.com/front/src/View.elm" timestamp="1497799291882">
        <mark key="'" line="94" column="10" />
        <mark key="[" line="2" column="7" />
        <mark key="]" line="2" column="15" />
        <mark key="." line="2" column="15" />
        <mark key="^" line="2" column="15" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/api/api_admin.php" timestamp="1498379736606">
        <mark key="'" line="2895" column="30" />
        <mark key="[" line="2867" column="0" />
        <mark key="]" line="2867" column="0" />
        <mark key="." line="2867" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/kuze_utils.php" timestamp="1498033498892">
        <mark key="'" line="709" column="39" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/site.conf" timestamp="1497783226999">
        <mark key="'" line="0" column="0" />
        <mark key="[" line="0" column="0" />
        <mark key="]" line="39" column="0" />
        <mark key="." line="8" column="4" />
        <mark key="^" line="8" column="4" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" timestamp="1498380493826">
        <mark key="[" line="5" column="0" />
        <mark key="]" line="5" column="0" />
        <mark key="^" line="4" column="0" />
        <mark key="." line="5" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/the_bar_node/server/package.json" timestamp="1490283423008">
        <mark key="[" line="19" column="51" />
        <mark key="]" line="19" column="82" />
        <mark key="^" line="19" column="82" />
        <mark key="." line="19" column="82" />
      </file>
      <file name="$USER_HOME$/Projects/the_bar_node/server/vendors.d.ts" timestamp="1490281242449">
        <mark key="[" line="0" column="20" />
        <mark key="]" line="0" column="20" />
        <mark key="." line="0" column="20" />
      </file>
      <file name="$APPLICATION_CONFIG_DIR$/scratches/scratch_5.json" timestamp="1492685289704">
        <mark key="'" line="7" column="18" />
        <mark key="[" line="0" column="0" />
        <mark key="]" line="0" column="9003" />
        <mark key="^" line="0" column="9003" />
        <mark key="." line="0" column="9003" />
      </file>
      <file name="$USER_HOME$/Projects/Guy Prives/Automator/server/api/appreciate-client/BudgetLine.ts" timestamp="1492339590331">
        <mark key="[" line="9" column="17" />
        <mark key="]" line="9" column="21" />
        <mark key="^" line="9" column="21" />
        <mark key="." line="9" column="21" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/UI/ToastBase.cs" timestamp="1497521492534">
        <mark key="[" line="8" column="4" />
        <mark key="]" line="8" column="9" />
        <mark key="." line="8" column="9" />
        <mark key="^" line="8" column="9" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" timestamp="1498381037924">
        <mark key="'" line="1839" column="9" />
        <mark key="[" line="1856" column="0" />
        <mark key="]" line="1856" column="0" />
        <mark key="." line="1856" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/the_bar_node/server/test/greeter-spec.ts" timestamp="1490284305782">
        <mark key="'" line="4" column="40" />
        <mark key="[" line="14" column="22" />
        <mark key="]" line="14" column="22" />
        <mark key="." line="14" column="22" />
        <mark key="^" line="12" column="37" />
      </file>
      <file name="$USER_HOME$/Projects/Guy Prives/Automator/server/api/view/view.spec.ts" timestamp="1491985147360">
        <mark key="[" line="2" column="0" />
        <mark key="]" line="2" column="0" />
        <mark key="." line="2" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/Guy Prives/Automator/server/tsconfig.json" timestamp="1492002963211">
        <mark key="[" line="11" column="7" />
        <mark key="]" line="11" column="8" />
        <mark key="." line="11" column="8" />
        <mark key="^" line="11" column="8" />
      </file>
      <file name="$APPLICATION_CONFIG_DIR$/scratches/scratch_6.json" timestamp="1492685876216">
        <mark key="'" line="452" column="0" />
        <mark key="[" line="517" column="35" />
        <mark key="]" line="517" column="33" />
        <mark key="^" line="517" column="33" />
        <mark key="." line="517" column="33" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/test.php" timestamp="1497784041419">
        <mark key="[" line="125" column="25" />
        <mark key="]" line="125" column="25" />
        <mark key="^" line="125" column="25" />
        <mark key="." line="125" column="25" />
      </file>
      <file name="$USER_HOME$/Projects/Guy Prives/Automator/server/api/appreciate-client/appreciate.exploratory.spec.ts" timestamp="1492003635975">
        <mark key="[" line="9" column="50" />
        <mark key="]" line="9" column="48" />
        <mark key="." line="9" column="48" />
        <mark key="^" line="9" column="48" />
      </file>
      <file name="/dummy.sql" timestamp="1498380990363">
        <mark key="[" line="0" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/Guy Prives/Automator/server/Dockerfile" timestamp="1491980582122">
        <mark key="[" line="0" column="23" />
        <mark key="]" line="0" column="25" />
        <mark key="." line="0" column="25" />
        <mark key="^" line="0" column="25" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/Borders.cs" timestamp="1497869872208">
        <mark key="'" line="0" column="0" />
        <mark key="[" line="27" column="0" />
        <mark key="]" line="27" column="0" />
        <mark key="^" line="14" column="49" />
        <mark key="." line="27" column="0" />
      </file>
      <file name="/Dummy.txt" timestamp="1498053031083">
        <mark key="[" line="0" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/luftzig.com/front/src/Model.elm" timestamp="1497692129327">
        <mark key="[" line="8" column="15" />
        <mark key="]" line="9" column="15" />
        <mark key="." line="9" column="15" />
        <mark key="^" line="9" column="15" />
      </file>
      <file name="$APPLICATION_CONFIG_DIR$/scratches/scratch.ts" timestamp="1492330300404">
        <mark key="[" line="0" column="0" />
        <mark key="]" line="0" column="172" />
        <mark key="." line="0" column="119" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/docker-compose.yaml" timestamp="1497774333361">
        <mark key="[" line="16" column="8" />
        <mark key="]" line="16" column="8" />
        <mark key="^" line="16" column="8" />
        <mark key="." line="16" column="8" />
      </file>
      <file name="$USER_HOME$/Projects/luftzig.com/front/src/Sections/CodeSection.elm" timestamp="1497799548443">
        <mark key="'" line="39" column="20" />
        <mark key="[" line="22" column="21" />
        <mark key="]" line="22" column="20" />
        <mark key="." line="22" column="20" />
        <mark key="^" line="22" column="20" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/Helpers.cs" timestamp="1497867695982">
        <mark key="[" line="17" column="51" />
        <mark key="]" line="17" column="57" />
        <mark key="^" line="17" column="57" />
        <mark key="." line="17" column="57" />
      </file>
      <file name="$USER_HOME$/Projects/the_bar_node/server/tsconfig.json" timestamp="1490282855133">
        <mark key="[" line="11" column="6" />
        <mark key="]" line="11" column="4" />
        <mark key="." line="11" column="4" />
        <mark key="^" line="11" column="4" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/kuze_login.php" timestamp="1497776244958">
        <mark key="'" line="43" column="8" />
      </file>
      <file name="$USER_HOME$/Projects/Guy Prives/Automator/server/.gitignore" timestamp="1491647826020">
        <mark key="[" line="2" column="5" />
        <mark key="]" line="3" column="5" />
        <mark key="^" line="3" column="5" />
        <mark key="." line="3" column="5" />
      </file>
      <file name="$USER_HOME$/Projects/luftzig.com/gae/app.yaml" timestamp="1497701788499">
        <mark key="[" line="11" column="16" />
        <mark key="]" line="11" column="17" />
        <mark key="." line="11" column="17" />
      </file>
      <file name="$USER_HOME$/Projects/the_bar_node/server/node_modules/mocha-given/mocha-given.d.ts" timestamp="1490283175399">
        <mark key="[" line="6" column="2" />
        <mark key="]" line="6" column="2" />
        <mark key="^" line="1" column="7" />
        <mark key="." line="6" column="2" />
      </file>
    </filemarks>
    <jumps>
      <jump line="22" column="11" filename="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/Decoration.cs" />
      <jump line="158" column="26" filename="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/PieceGenerator.cs" />
      <jump line="52" column="24" filename="$USER_HOME$/Projects/zengarden/Assets/Scripts/UI/GameEditor/SaveButton.cs" />
      <jump line="51" column="36" filename="$USER_HOME$/Projects/zengarden/Assets/Scripts/UI/GameEditor/SaveButton.cs" />
      <jump line="64" column="36" filename="$USER_HOME$/Projects/zengarden/Assets/Scripts/UI/GameEditor/SaveButton.cs" />
      <jump line="70" column="26" filename="$USER_HOME$/Projects/zengarden/Assets/Scripts/UI/GameEditor/SaveButton.cs" />
      <jump line="7" column="23" filename="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/Decoration.cs" />
      <jump line="59" column="15" filename="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/Decoration.cs" />
      <jump line="65" column="11" filename="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/Decoration.cs" />
      <jump line="56" column="96" filename="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/Decoration.cs" />
      <jump line="29" column="12" filename="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/PieceHex.cs" />
      <jump line="34" column="14" filename="$USER_HOME$/Projects/zengarden/Assets/Scripts/DragAndDrop.cs" />
      <jump line="70" column="42" filename="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/PuzzlePiece.cs" />
      <jump line="95" column="0" filename="$USER_HOME$/Projects/kuze/php/angular/business_event_card.php" />
      <jump line="80" column="129" filename="$USER_HOME$/Projects/kuze/php/angular/business_config.php" />
      <jump line="42" column="0" filename="$USER_HOME$/Projects/kuze/php/angular/business_event_card.php" />
      <jump line="0" column="0" filename="$USER_HOME$/Projects/kuze/php/angular/business_event_card.php" />
      <jump line="257" column="0" filename="$USER_HOME$/Projects/kuze/php/angular/business_event_card.php" />
      <jump line="141" column="18" filename="$USER_HOME$/Projects/kuze/php/angular/business_event_card.php" />
      <jump line="112" column="17" filename="$USER_HOME$/Projects/kuze/php/angular/business_event_card.php" />
      <jump line="3874" column="8" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="15" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="5522" column="27" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="5837" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="3" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="86" column="33" filename="$USER_HOME$/Projects/kuze/php/angular/business_config.php" />
      <jump line="3" column="41" filename="$USER_HOME$/Projects/kuze/php/angular/business_config.php" />
      <jump line="2" column="41" filename="$USER_HOME$/Projects/kuze/php/angular/business_config.php" />
      <jump line="709" column="39" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="2" column="0" filename="$USER_HOME$/Projects/kuze/php/kuze_const.php" />
      <jump line="71" column="0" filename="$USER_HOME$/Projects/kuze/php/kuze_const.php" />
      <jump line="336" column="9" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/kuze_business_utils-v11.js" />
      <jump line="5152" column="23" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="12" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="22" column="24" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="24" column="48" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="26" column="28" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="28" column="52" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="47" column="27" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="53" column="27" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="28" column="14" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="1959" column="24" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="140" column="0" filename="$USER_HOME$/Projects/kuze/php/kuze_general_business_utils.php" />
      <jump line="14" column="15" filename="$USER_HOME$/Projects/kuze/php/kuze_general_business_utils.php" />
      <jump line="84" column="40" filename="$USER_HOME$/Projects/kuze/php/angular/business_config.php" />
      <jump line="94" column="0" filename="$USER_HOME$/Projects/kuze/php/kuze_general_business_utils.php" />
      <jump line="8" column="0" filename="$USER_HOME$/Projects/kuze/php/kuze_general_business_utils.php" />
      <jump line="142" column="0" filename="$USER_HOME$/Projects/kuze/php/kuze_general_business_utils.php" />
      <jump line="5496" column="11" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="1187" column="20" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/kuze_enduser_app.js" />
      <jump line="1857" column="9" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="1239" column="11" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="1867" column="9" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="1280" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="1281" column="9" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="1844" column="26" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="5501" column="12" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="5502" column="25" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="5482" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="5507" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="5575" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="5658" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="5775" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="5813" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="141" column="30" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="147" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="150" column="28" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="185" column="3" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="199" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="319" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="335" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="349" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="368" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="409" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="419" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="565" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="613" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="639" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="22" column="54" filename="$USER_HOME$/Projects/kuze/php/angular/business_modal_client_payment.php" />
      <jump line="1960" column="82" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="1998" column="12" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="2450" column="3" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="2729" column="13" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="2773" column="13" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="2790" column="13" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="2807" column="13" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="2895" column="30" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="179" column="34" filename="$USER_HOME$/Projects/kuze/php/kuze_payment_utils.php" />
      <jump line="7" column="27" filename="$USER_HOME$/Projects/kuze/php/kuze_payment_utils.php" />
      <jump line="129" column="24" filename="$USER_HOME$/Projects/kuze/php/kuze_general_business_utils.php" />
      <jump line="44" column="41" filename="$USER_HOME$/Projects/kuze/php/angular/business_modal_client_payment.php" />
      <jump line="1920" column="42" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="0" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5850" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5" column="21" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="1855" column="26" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="1271" column="26" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="1275" column="18" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="1839" column="9" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="833" column="9" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/kuze_business_utils-v11.js" />
    </jumps>
    <registers>
      <register name="&quot;" type="4">
        <text encoding="base64">IA==</text>
      </register>
      <register name="-" type="4">
        <text encoding="base64">IA==</text>
      </register>
      <register name="/" type="4">
        <text encoding="base64">XDxwYXltZW50TWV0aG9kc1w+</text>
      </register>
      <register name="0" type="2">
        <text encoding="base64">QUxURVIgVEFCTEUga3pfdXNlcl9wYXltZW50cwogIEFERCAoCiAgcGF5bWVudF9hbW91bnRfbm9fdmF0IEZMT0FUCiAgKTsK</text>
      </register>
      <register name="1" type="2">
        <text encoding="base64">ICAgICAgPGRpdiBjbGFzcz0iIgo=</text>
      </register>
      <register name="2" type="2">
        <text encoding="base64">ICA8ZGl2Cg==</text>
      </register>
      <register name="3" type="2">
        <text encoding="base64">ICAgIDxkaXYgY2wK</text>
      </register>
      <register name="4" type="2">
        <text encoding="base64">ICAgIAo=</text>
      </register>
      <register name="5" type="2">
        <text encoding="base64">ICBjb25zb2xlLmxvZygiUGF5bWVudCBtZXRob2RzIiwgcGF5bWVudE1ldGhvZHMpOwo=</text>
      </register>
      <register name="6" type="2">
        <text encoding="base64">Ly8gdjExIC0gMjMgbWFyY2ggMjAxCg==</text>
      </register>
      <register name="7" type="4">
        <text encoding="base64">NwovL0RlZmluZSBhbiBhbmd1bGFyIG1vZHVsZSBmb3Igb3VyIGFwcAoKdmFyIGt1emVJc0NhbGVuZGFyRHJhZ2dibGU7Cmt1emVJc0NhbGVuZGFyRHJhZ2dibGUgPSB0cnVlOwoKLy8gYW5ndWxhciBtb2R1bGVzCi8vJGFuZ3VsYXJNb2R1bGVzPVsnbmdSb3V0ZScsJ3VpLmJvb3RzdHJhcCcsJ3VpLmdyaWQnXTsKJGFuZ3VsYXJNb2R1bGVzID0gWyduZ1JvdXRlJywgJ3VpLmJvb3RzdHJhcCcsICd1aS5ncmlkJywgJ2J1aWxkZXInLCAnYnVpbGRlci5jb21wb25lbnRzJywgJ3ZhbGlkYXRvci5ydWxlcycsICd1aS5jYWxlbmRhcicsICdjaGVja2xpc3QtbW9kZWwnLCAndWkuYm9vdHN0cmFwLmRhdGV0aW1lcGlja2VyJywgJ2FuZ3Vjb21wbGV0ZS1hbHQnLCAnbXVsdGlwbGVTZWxlY3QnLCdhbmd1bGFySW5saW5lRWRpdCcsJ3RleHRBbmd1bGFyJywnbmdDc3YnXTsKCnZhciBkYXlOYW1lcyA9IFsn16jXkNep15XXnycsICfXqdeg15knLCAn16nXnNeZ16nXmScsICfXqNeR15nXoteZJywgJ9eX157Xmdep15knLCAn16nXmdep15knLCAn16nXkdeqJ107CnZhciBtb250aE5hbWVzID0gWyLXmdeg15XXkNeoIiwgItek15HXqNeV15DXqCIsICLXnteo16UiLCAi15DXpNeo15nXnCIsICLXnteQ15kiLCAi15nXldeg15kiLAogICAgIteZ15XXnNeZIiwgIteQ15XXkteV16HXmCIsICLXodek15jXnteR16giLCAi15DXlden15jXldeR16giLCAi16DXldeR157XkdeoIiwgIteT16bXnteR16giCl07Cgp2YXIgbG9naW5OZXh0U2NyZWVuPSIiOwoKKGZ1bmN0aW9uKCl7RGF0ZS5zaG9ydE1vbnRocz1bIkphbiIsIkZlYiIsIk1hciIsIkFwciIsIk1heSIsIkp1biIsIkp1bCIsIkF1ZyIsIlNlcCIsIk9jdCIsIk5vdiIsIkRlYyJdLERhdGUubG9uZ01vbnRocz1bIkphbnVhcnkiLCJGZWJydWFyeSIsIk1hcmNoIiwiQXByaWwiLCJNYXkiLCJKdW5lIiwiSnVseSIsIkF1Z3VzdCIsIlNlcHRlbWJlciIsIk9jdG9iZXIiLCJOb3ZlbWJlciIsIkRlY2VtYmVyIl0sRGF0ZS5zaG9ydERheXM9WyJTdW4iLCJNb24iLCJUdWUiLCJXZWQiLCJUaHUiLCJGcmkiLCJTYXQiXSxEYXRlLmxvbmdEYXlzPVsiU3VuZGF5IiwiTW9uZGF5IiwiVHVlc2RheSIsIldlZG5lc2RheSIsIlRodXJzZGF5IiwiRnJpZGF5IiwiU2F0dXJkYXkiXTt2YXIgdD17ZDpmdW5jdGlvbigpe3JldHVybih0aGlzLmdldERhdGUoKTwxMD8iMCI6IiIpK3RoaXMuZ2V0RGF0ZSgpfSxEOmZ1bmN0aW9uKCl7cmV0dXJuIERhdGUuc2hvcnREYXlzW3RoaXMuZ2V0RGF5KCldfSxqOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZ2V0RGF0ZSgpfSxsOmZ1bmN0aW9uKCl7cmV0dXJuIERhdGUubG9uZ0RheXNbdGhpcy5nZXREYXkoKV19LE46ZnVuY3Rpb24oKXtyZXR1cm4gMD09dGhpcy5nZXREYXkoKT83OnRoaXMuZ2V0RGF5KCl9LFM6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5nZXREYXRlKCklMTA9PTEmJjExIT10aGlzLmdldERhdGUoKT8ic3QiOnRoaXMuZ2V0RGF0ZSgpJTEwPT0yJiYxMiE9dGhpcy5nZXREYXRlKCk/Im5kIjp0aGlzLmdldERhdGUoKSUxMD09MyYmMTMhPXRoaXMuZ2V0RGF0ZSgpPyJyZCI6InRoIn0sdzpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldERheSgpfSx6OmZ1bmN0aW9uKCl7dmFyIHQ9bmV3IERhdGUodGhpcy5nZXRGdWxsWWVhcigpLDAsMSk7cmV0dXJuIE1hdGguY2VpbCgodGhpcy10KS84NjRlNSl9LFc6ZnVuY3Rpb24oKXt2YXIgdD1uZXcgRGF0ZSh0aGlzLnZhbHVlT2YoKSksZT0odGhpcy5nZXREYXkoKSs2KSU3O3Quc2V0RGF0ZSh0LmdldERhdGUoKS1lKzMpO3ZhciBuPXQudmFsdWVPZigpO3JldHVybiB0LnNldE1vbnRoKDAsMSksNCE9PXQuZ2V0RGF5KCkmJnQuc2V0TW9udGgoMCwxKyg0LXQuZ2V0RGF5KCkrNyklNyksMStNYXRoLmNlaWwoKG4tdCkvNjA0OGU1KX0sRjpmdW5jdGlvbigpe3JldHVybiBEYXRlLmxvbmdNb250aHNbdGhpcy5nZXRNb250aCgpXX0sbTpmdW5jdGlvbigpe3JldHVybih0aGlzLmdldE1vbnRoKCk8OT8iMCI6IiIpKyh0aGlzLmdldE1vbnRoKCkrMSl9LE06ZnVuY3Rpb24oKXtyZXR1cm4gRGF0ZS5zaG9ydE1vbnRoc1t0aGlzLmdldE1vbnRoKCldfSxuOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZ2V0TW9udGgoKSsxfSx0OmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5nZXRGdWxsWWVhcigpLGU9dGhpcy5nZXRNb250aCgpKzE7cmV0dXJuIDEyPT09ZSYmKHQ9dCsrLGU9MCksbmV3IERhdGUodCxlLDApLmdldERhdGUoKX0sTDpmdW5jdGlvbigpe3ZhciB0PXRoaXMuZ2V0RnVsbFllYXIoKTtyZXR1cm4gdCU0MDA9PTB8fHQlMTAwIT0wJiZ0JTQ9PTB9LG86ZnVuY3Rpb24oKXt2YXIgdD1uZXcgRGF0ZSh0aGlzLnZhbHVlT2YoKSk7cmV0dXJuIHQuc2V0RGF0ZSh0LmdldERhdGUoKS0odGhpcy5nZXREYXkoKSs2KSU3KzMpLHQuZ2V0RnVsbFllYXIoKX0sWTpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldEZ1bGxZZWFyKCl9LHk6ZnVuY3Rpb24oKXtyZXR1cm4oIiIrdGhpcy5nZXRGdWxsWWVhcigpKS5zdWJzdHIoMil9LGE6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5nZXRIb3VycygpPDEyPyJhbSI6InBtIn0sQTpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldEhvdXJzKCk8MTI/IkFNIjoiUE0ifSxCOmZ1bmN0aW9uKCl7cmV0dXJuIE1hdGguZmxvb3IoMWUzKigodGhpcy5nZXRVVENIb3VycygpKzEpJTI0K3RoaXMuZ2V0VVRDTWludXRlcygpLzYwK3RoaXMuZ2V0VVRDU2Vjb25kcygpLzM2MDApLzI0KX0sZzpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldEhvdXJzKCklMTJ8fDEyfSxHOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZ2V0SG91cnMoKX0saDpmdW5jdGlvbigpe3JldHVybigodGhpcy5nZXRIb3VycygpJTEyfHwxMik8MTA/IjAiOiIiKSsodGhpcy5nZXRIb3VycygpJTEyfHwxMil9LEg6ZnVuY3Rpb24oKXtyZXR1cm4odGhpcy5nZXRIb3VycygpPDEwPyIwIjoiIikrdGhpcy5nZXRIb3VycygpfSxpOmZ1bmN0aW9uKCl7cmV0dXJuKHRoaXMuZ2V0TWludXRlcygpPDEwPyIwIjoiIikrdGhpcy5nZXRNaW51dGVzKCl9LHM6ZnVuY3Rpb24oKXtyZXR1cm4odGhpcy5nZXRTZWNvbmRzKCk8MTA/IjAiOiIiKSt0aGlzLmdldFNlY29uZHMoKX0sdTpmdW5jdGlvbigpe3ZhciB0PXRoaXMuZ2V0TWlsbGlzZWNvbmRzKCk7cmV0dXJuKDEwPnQ/IjAwIjoxMDA+dD8iMCI6IiIpK3R9LGU6ZnVuY3Rpb24oKXtyZXR1cm4vXCgoLiopXCkvLmV4ZWMoKG5ldyBEYXRlKS50b1N0cmluZygpKVsxXX0sSTpmdW5jdGlvbigpe2Zvcih2YXIgdD1udWxsLGU9MDsxMj5lOysrZSl7dmFyIG49bmV3IERhdGUodGhpcy5nZXRGdWxsWWVhcigpLGUsMSksaT1uLmdldFRpbWV6b25lT2Zmc2V0KCk7aWYobnVsbD09PXQpdD1pO2Vsc2V7aWYodD5pKXt0PWk7YnJlYWt9aWYoaT50KWJyZWFrfX1yZXR1cm4gdGhpcy5nZXRUaW1lem9uZU9mZnNldCgpPT10fDB9LE86ZnVuY3Rpb24oKXtyZXR1cm4oLXRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKTwwPyItIjoiKyIpKyhNYXRoLmFicyh0aGlzLmdldFRpbWV6b25lT2Zmc2V0KCkvNjApPDEwPyIwIjoiIikrTWF0aC5mbG9vcihNYXRoLmFicyh0aGlzLmdldFRpbWV6b25lT2Zmc2V0KCkvNjApKSsoMD09TWF0aC5hYnModGhpcy5nZXRUaW1lem9uZU9mZnNldCgpJTYwKT8iMDAiOihNYXRoLmFicyh0aGlzLmdldFRpbWV6b25lT2Zmc2V0KCklNjApPDEwPyIwIjoiIikrTWF0aC5hYnModGhpcy5nZXRUaW1lem9uZU9mZnNldCgpJTYwKSl9LFA6ZnVuY3Rpb24oKXtyZXR1cm4oLXRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKTwwPyItIjoiKyIpKyhNYXRoLmFicyh0aGlzLmdldFRpbWV6b25lT2Zmc2V0KCkvNjApPDEwPyIwIjoiIikrTWF0aC5mbG9vcihNYXRoLmFicyh0aGlzLmdldFRpbWV6b25lT2Zmc2V0KCkvNjApKSsiOiIrKDA9PU1hdGguYWJzKHRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKSU2MCk/IjAwIjooTWF0aC5hYnModGhpcy5nZXRUaW1lem9uZU9mZnNldCgpJTYwKTwxMD8iMCI6IiIpK01hdGguYWJzKHRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKSU2MCkpfSxUOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMudG9UaW1lU3RyaW5nKCkucmVwbGFjZSgvXi4rIFwoPyhbXlwpXSspXCk/JC8sIiQxIil9LFo6ZnVuY3Rpb24oKXtyZXR1cm4gNjAqLXRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKX0sYzpmdW5jdGlvbigpe3JldHVybiB0aGlzLmZvcm1hdCgiWS1tLWRcXFRIOmk6c1AiKX0scjpmdW5jdGlvbigpe3JldHVybiB0aGlzLnRvU3RyaW5nKCl9LFU6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5nZXRUaW1lKCkvMWUzfX07RGF0ZS5wcm90b3R5cGUuZm9ybWF0PWZ1bmN0aW9uKGUpe3ZhciBuPXRoaXM7cmV0dXJuIGUucmVwbGFjZSgvKFxcPykoLikvZyxmdW5jdGlvbihlLGkscil7cmV0dXJuIiI9PT1pJiZ0W3JdP3Rbcl0uY2FsbChuKTpyfSl9fSkuY2FsbCh0aGlzKTsKCmZ1bmN0aW9uIGdvdG9DbGllbnRQYWdlKGJ1c2luZXNzX3VzZXJfaWQpCnsKICB3aW5kb3cubG9jYXRpb24uaHJlZj0nLyMvYnVzaW5lc3NfY2xpZW50cy8nICsgYnVzaW5lc3NfdXNlcl9pZDsKfQpmdW5jdGlvbiBnb3RvSW5zdHJ1Y3RvclBhZ2UoYnVzaW5lc3NfdXNlcl9pZCkKewogIHdpbmRvdy5sb2NhdGlvbi5ocmVmPScvIy9idXNpbmVzc19pbnN0cnVjdG9ycy8nICsgYnVzaW5lc3NfdXNlcl9pZDsKfQoKZnVuY3Rpb24gZ290b0V2ZW50UGFnZSh0aGVldmVudCkKewogIGxvZ0RlYnVnKCJnb3RvRXZlbnRQYWdlICIrdGhlZXZlbnQpOwogIGlmICh0aGVldmVudC5pc19jbGFzcz09MSkKICB7CiAgICB3aW5kb3cubG9jYXRpb24uaHJlZj0nLyMvZXZlbnRfY2xhc3MvJyArIHRoZWV2ZW50LmV2ZW50X2lkOwogIH0KICBlbHNlCiAgewogICAgd2luZG93LmxvY2F0aW9uLmhyZWY9Jy8jL2V2ZW50LycgKyB0aGVldmVudC5ldmVudF9pZDsKICB9Cn0KCmZ1bmN0aW9uIGdvdG9Mb2NhdGlvblBhZ2UobG9jYXRpb25faWQpCnsKICBsb2dEZWJ1ZygiZ290b0xvY2F0aW9uUGFnZSAiK2xvY2F0aW9uX2lkKTsKICB3aW5kb3cubG9jYXRpb24uaHJlZj0nLyMvYnVzaW5lc3NfbG9jYXRpb25zLycgKyBsb2NhdGlvbl9pZDsKCn0KCmZ1bmN0aW9uIGdvdG9DbGllbnRFZGl0UGFnZSh1c2VyX2lkKQp7CiAgd2luZG93LmxvY2F0aW9uLmhyZWY9Jy8jL2J1c2luZXNzX2NsaWVudHMvJyArIHVzZXJfaWQgKyAnL2VkaXQnOwp9CgpmdW5jdGlvbiBnb3RvQmFjaygpCnsKICB3aW5kb3cuaGlzdG9yeS5iYWNrKCk7Cn0KCmZ1bmN0aW9uIHNob3dFdmVudFBvcHVwKHNlbGVjdGVkRXZlbnQsICR1aWJNb2RhbCkKewogIC8vIHRoaXMgZnVuY3Rpb24gdXNlZCB0byBicmluZyBhIHBvcHVwCiAgLy8gbm93IGl0IGdvZXMgdG8gdGhlIGV2ZW50IHBhZ2UKICBnb3RvRXZlbnRQYWdlKHNlbGVjdGVkRXZlbnQpOwoKICAvLyBpZiAoc2VsZWN0ZWRFdmVudC5pc19yZXBlYXRpbmcgPT0gMSkgewogIC8vICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAvLyAgICAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgLy8gICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9jbGFzc19zaW5nbGUucGhwJywKICAvLyAgICAgICAgIGNvbnRyb2xsZXI6ICdldmVudFJlY3VycmluZ0RldGFpbHNCdXNpbmVzc0NhbGVuZGFyTW9kYWxDb250cm9sbGVyJywKICAvLyAgICAgICAgIC8vIHNpemU6IHNpemUsCiAgLy8gICAgICAgICByZXNvbHZlOiB7CiAgLy8gICAgICAgICAgICAgc2VsZWN0ZWRFdmVudDogZnVuY3Rpb24oKSB7CiAgLy8gICAgICAgICAgICAgICAgIHJldHVybiBzZWxlY3RlZEV2ZW50OwogIC8vICAgICAgICAgICAgIH0KICAvLyAgICAgICAgIH0KICAvLyAgICAgfSk7CiAgLy8gfSBlbHNlIHsKICAvLyAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgLy8gICAgICAgICBhbmltYXRpb246IGZhbHNlLAogIC8vICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfZXZlbnRfc2luZ2xlLnBocCcsCiAgLy8gICAgICAgICBjb250cm9sbGVyOiAnZXZlbnREZXRhaWxzQnVzaW5lc3NDYWxlbmRhck1vZGFsQ29udHJvbGxlcicsCiAgLy8gICAgICAgICAvLyBzaXplOiBzaXplLAogIC8vICAgICAgICAgcmVzb2x2ZTogewogIC8vICAgICAgICAgICAgIHNlbGVjdGVkRXZlbnQ6IGZ1bmN0aW9uKCkgewogIC8vICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZWN0ZWRFdmVudDsKICAvLyAgICAgICAgICAgICB9CiAgLy8gICAgICAgICB9CiAgLy8gICAgIH0pOwogIC8vIH0KfQpmdW5jdGlvbiB1cGRhdGVHbG9iYWxMYW5ndWFnZSgkc2NvcGUsICRuZXdsYW5nKSB7CgogICAgLy8JdmFyIGdMYW5nPWdMYW5nQmFzZVtnTGFuZ0N1cnJdOwogICAgJGdMYW5nID0gZ0xhbmdCYXNlWyRuZXdsYW5nXTsKICAgIC8vIGxvZ0RlYnVnKCJnTGFuZ0Jhc2VbJG5ld2xhbmddWyd0aXRsZTEnXT0iICsgZ0xhbmdCYXNlWyRuZXdsYW5nXVsndGl0bGUxJ10pOwogICAgLy8gbG9nRGVidWcoImxhbmd1Z2FnZToiICsgJGdMYW5nWydsYW5ndWFnZSddKTsKICAgIC8vCWxvZ0RlYnVnKCJsYW5ndWdhZ2UgZGlyOiAiKyRnTGFuZ1snZGlyJ10pOwogICAgLy8JbG9nRGVidWcoImNoYW5naW5nIGxhbmd1YWdlIHRvICIrJG5ld2xhbmcpCiAgICAkc2NvcGUuc3BDbGFzcyA9ICRnTGFuZ1snY2xhc3MnXTsKICAgIC8vCWxvZ0RlYnVnKCJpcyBhcnJheT8gIithbmd1bGFyLmlzQXJyYXkoJGdMYW5nKSk7CiAgICAvLwlsb2dEZWJ1ZygiJGdMYW5nWydkaXInXT0iKyRnTGFuZ1snZGlyJ10pOwogICAgLy8JbG9nRGVidWcoIiRnTGFuZ1sndGl0bGUxJ109IiskZ0xhbmdbJ3RpdGxlMSddKTsKICAgICRzY29wZS5sYW5nZmlsZSA9ICRnTGFuZzsKICAgIC8vIGxvZ0RlYnVnKCJpcyBhcnJheT8gIiArIGFuZ3VsYXIuaXNBcnJheSgkc2NvcGUubGFuZ2ZpbGUpKTsKICAgIC8vIGxvZ0RlYnVnKCIkc2NvcGUubGFuZ2ZpbGU9IiArICRzY29wZS5sYW5nZmlsZSk7CiAgICAvLyBsb2dEZWJ1ZygiJHNjb3BlLmxhbmdmaWxlWyd0aXRsZTEnXT0iICsgJHNjb3BlLmxhbmdmaWxlWyd0aXRsZTEnXSk7CgogICAgJHNjb3BlLnRlc3RuZXd2YXIgPSAkc2NvcGUubGFuZ2ZpbGVbJ3RpdGxlMSddOwogICAgLy8JJHNjb3BlLm1lc3NhZ2U9JHNjb3BlLmxhbmdmaWxlWyd0aXRsZTEnXTsKfQoKZnVuY3Rpb24gZ2V0UmFuZG9tQ29sb3IoKSB7CiAgICB2YXIgbGV0dGVycyA9ICcwMTIzNDU2Nzg5QUJDREVGJy5zcGxpdCgnJyk7CiAgICB2YXIgY29sb3IgPSAnIyc7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IDY7IGkrKykgewogICAgICAgIGNvbG9yICs9IGxldHRlcnNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTYpXTsKICAgIH0KICAgIHJldHVybiBjb2xvcjsKfQoKZnVuY3Rpb24gZ2V0UmFuZG9tSW50KG1pbiwgbWF4KSB7CiAgICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKG1heCAtIG1pbiArIDEpKSArIG1pbjsKfQoKZnVuY3Rpb24gY2FsY190ZW1wX2xpbWl0X2lkKCkgewogICAgdmFyIGQgPSBuZXcgRGF0ZSgpOwogICAgdmFyIHJhbmRvbWxpbWl0ID0gZC5nZXRUaW1lKCk7CiAgICBsb2dEZWJ1ZygiY2FsY190ZW1wX2xpbWl0X2lkPSIgKyByYW5kb21saW1pdCk7CiAgICByZXR1cm4gcmFuZG9tbGltaXQ7Cn0KCnZhciAkZ0xvZ0xldmVsID0gJ2RlYnVnJzsKCi8vIHN0YXJ0aW5nCmxvZ0RlYnVnKCJtYWluICRnTG9nTGV2ZWw9IiArICRnTG9nTGV2ZWwpOwpsb2dEZWJ1ZygiaW5pdGlhbGl6ZSBhbmd1bGFyIik7CmxvZ0RlYnVnKCJpbml0aWFsaXppbmcgbW9kdWxlcyAiICsgJGFuZ3VsYXJNb2R1bGVzKTsKCnZhciBrdXplQXBwID0gYW5ndWxhci5tb2R1bGUoJ2t1emVBcHAnLCAkYW5ndWxhck1vZHVsZXMpCgovLyRyb290U2NvcGUuc3BDbGFzcyA9ICdyaWdodCc7Cmt1emVSdW4gPSBmdW5jdGlvbigpIHsKCn0Ka3V6ZUFwcC5ydW4oWwogICAgJyRidWlsZGVyJywKICAgIGZ1bmN0aW9uKCRidWlsZGVyKSB7CiAgICAgICAgLy8gbG9nRGVidWcoImluc2lkZSBrdXplQXBwLnJ1biIpOwogICAgICAgICRidWlsZGVyLnJlZ2lzdGVyQ29tcG9uZW50KCdzYW1wbGVJbnB1dCcsIHsKICAgICAgICAgICAgZ3JvdXA6ICdmcm9tIGh0bWwnLAogICAgICAgICAgICBsYWJlbDogJ1NhbXBsZScsCiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnRnJvbSBodG1sIHRlbXBsYXRlJywKICAgICAgICAgICAgcGxhY2Vob2xkZXI6ICdwbGFjZWhvbGRlcicsCiAgICAgICAgICAgIHJlcXVpcmVkOiBmYWxzZSwKICAgICAgICAgICAgdmFsaWRhdGlvbk9wdGlvbnM6IFt7CiAgICAgICAgICAgICAgICBsYWJlbDogJ25vbmUnLAogICAgICAgICAgICAgICAgcnVsZTogJy8uKi8nCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgIGxhYmVsOiAnbnVtYmVyJywKICAgICAgICAgICAgICAgIHJ1bGU6ICdbbnVtYmVyXScKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgbGFiZWw6ICdlbWFpbCcsCiAgICAgICAgICAgICAgICBydWxlOiAnW2VtYWlsXScKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgbGFiZWw6ICd1cmwnLAogICAgICAgICAgICAgICAgcnVsZTogJ1t1cmxdJwogICAgICAgICAgICB9XSwKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYW5ndWxhci1mb3JtLWJ1aWxkZXIvZXhhbXBsZS90ZW1wbGF0ZS5odG1sJywKICAgICAgICAgICAgcG9wb3ZlclRlbXBsYXRlVXJsOiAnL2FuZ3VsYXItZm9ybS1idWlsZGVyL2V4YW1wbGUvcG9wb3ZlclRlbXBsYXRlLmh0bWwnCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuICRidWlsZGVyLnJlZ2lzdGVyQ29tcG9uZW50KCduYW1lJywgewogICAgICAgICAgICBncm91cDogJ0RlZmF1bHQnLAogICAgICAgICAgICBsYWJlbDogJ05hbWUnLAogICAgICAgICAgICByZXF1aXJlZDogZmFsc2UsCiAgICAgICAgICAgIGFycmF5VG9UZXh0OiB0cnVlLAogICAgICAgICAgICB0ZW1wbGF0ZTogIjxkaXYgY2xhc3M9XCJmb3JtLWdyb3VwXCI+XG4gICAgPGxhYmVsIGZvcj1cInt7Zm9ybU5hbWUraW5kZXh9fVwiIGNsYXNzPVwiY29sLW1kLTQgY29udHJvbC1sYWJlbFwiIG5nLWNsYXNzPVwieydmYi1yZXF1aXJlZCc6cmVxdWlyZWR9XCI+e3tsYWJlbH19PC9sYWJlbD5cbiAgICA8ZGl2IGNsYXNzPVwiY29sLW1kLThcIj5cbiAgICAgICAgPGlucHV0IHR5cGU9J2hpZGRlbicgbmctbW9kZWw9XCJpbnB1dFRleHRcIiB2YWxpZGF0b3ItcmVxdWlyZWQ9XCJ7e3JlcXVpcmVkfX1cIiB2YWxpZGF0b3ItZ3JvdXA9XCJ7e2Zvcm1OYW1lfX1cIi8+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJjb2wtc20tNlwiIHN0eWxlPVwicGFkZGluZy1sZWZ0OiAwO1wiPlxuICAgICAgICAgICAgPGlucHV0IHR5cGU9XCJ0ZXh0XCJcbiAgICAgICAgICAgICAgICBuZy1tb2RlbD1cImlucHV0QXJyYXlbMF1cIlxuICAgICAgICAgICAgICAgIGNsYXNzPVwiZm9ybS1jb250cm9sXCIgaWQ9XCJ7e2Zvcm1OYW1lK2luZGV4fX0tMFwiLz5cbiAgICAgICAgICAgIDxwIGNsYXNzPSdoZWxwLWJsb2NrJz5GaXJzdCBuYW1lPC9wPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImNvbC1zbS02XCIgc3R5bGU9XCJwYWRkaW5nLWxlZnQ6IDA7XCI+XG4gICAgICAgICAgICA8aW5wdXQgdHlwZT1cInRleHRcIlxuICAgICAgICAgICAgICAgIG5nLW1vZGVsPVwiaW5wdXRBcnJheVsxXVwiXG4gICAgICAgICAgICAgICAgY2xhc3M9XCJmb3JtLWNvbnRyb2xcIiBpZD1cInt7Zm9ybU5hbWUraW5kZXh9fS0xXCIvPlxuICAgICAgICAgICAgPHAgY2xhc3M9J2hlbHAtYmxvY2snPkxhc3QgbmFtZTwvcD5cbiAgICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG48L2Rpdj4iLAogICAgICAgICAgICBwb3BvdmVyVGVtcGxhdGU6ICI8Zm9ybT5cbiAgICA8ZGl2IGNsYXNzPVwiZm9ybS1ncm91cFwiPlxuICAgICAgICA8bGFiZWwgY2xhc3M9J2NvbnRyb2wtbGFiZWwnPkxhYmVsPC9sYWJlbD5cbiAgICAgICAgPGlucHV0IHR5cGU9J3RleHQnIG5nLW1vZGVsPVwibGFiZWxcIiB2YWxpZGF0b3I9XCJbcmVxdWlyZWRdXCIgY2xhc3M9J2Zvcm0tY29udHJvbCcvPlxuICAgIDwvZGl2PlxuICAgIDxkaXYgY2xhc3M9XCJjaGVja2JveFwiPlxuICAgICAgICA8bGFiZWw+XG4gICAgICAgICAgICA8aW5wdXQgdHlwZT0nY2hlY2tib3gnIG5nLW1vZGVsPVwicmVxdWlyZWRcIiAvPlxuICAgICAgICAgICAgUmVxdWlyZWRcbiAgICAgICAgPC9sYWJlbD5cbiAgICA8L2Rpdj5cblxuICAgIDxoci8+XG4gICAgPGRpdiBjbGFzcz0nZm9ybS1ncm91cCc+XG4gICAgICAgIDxpbnB1dCB0eXBlPSdzdWJtaXQnIG5nLWNsaWNrPVwicG9wb3Zlci5zYXZlKCRldmVudClcIiBjbGFzcz0nYnRuIGJ0bi1wcmltYXJ5JyB2YWx1ZT0nU2F2ZScvPlxuICAgICAgICA8aW5wdXQgdHlwZT0nYnV0dG9uJyBuZy1jbGljaz1cInBvcG92ZXIuY2FuY2VsKCRldmVudClcIiBjbGFzcz0nYnRuIGJ0bi1kZWZhdWx0JyB2YWx1ZT0nQ2FuY2VsJy8+XG4gICAgICAgIDxpbnB1dCB0eXBlPSdidXR0b24nIG5nLWNsaWNrPVwicG9wb3Zlci5yZW1vdmUoJGV2ZW50KVwiIGNsYXNzPSdidG4gYnRuLWRhbmdlcicgdmFsdWU9J0RlbGV0ZScvPlxuICAgIDwvZGl2PlxuPC9mb3JtPiIKICAgICAgICB9KTsKICAgIH0KXSkKCi8vIERFTEVURUQgLSB4ZWRpdGFibGUgc3R1ZmYKLy8ga3V6ZUFwcC5ydW4oZnVuY3Rpb24oZWRpdGFibGVPcHRpb25zLCBlZGl0YWJsZVRoZW1lcykgewovLyAgICAgbG9nRGVidWcoImluaXRpYWxpemluZyB4ZWRpdGFibGUgZWRpdGFibGVPcHRpb25zIik7Ci8vICAgICBlZGl0YWJsZU9wdGlvbnMudGhlbWUgPSAnYnMzJzsgLy8gYm9vdHN0cmFwMyB0aGVtZS4gQ2FuIGJlIGFsc28gJ2JzMicsICdkZWZhdWx0JwovLyAgICAgLy8gZWRpdGFibGVPcHRpb25zLmRlZmF1bHRzLm1vZGUgPSAnaW5saW5lJzsKLy8gICAgIGxvZ0RlYnVnKGVkaXRhYmxlT3B0aW9ucyk7Ci8vICAgICAvLyBlZGl0YWJsZU9wdGlvbnMubW9kZSA9ICdpbmxpbmUnOwovLyAgICAgZWRpdGFibGVUaGVtZXMuYnMzLmlucHV0Q2xhc3MgPSAnaW5wdXQtc20nOwovLyAgICAgZWRpdGFibGVUaGVtZXMuYnMzLmJ1dHRvbnNDbGFzcyA9ICdidG4tc20nOwovLyB9KTsKCi8vIGFmdGVyIGZvcm1zCi8vRGVmaW5lIFJvdXRpbmcgZm9yIGFwcAovL1VyaSAvQWRkTmV3T3JkZXIgLT4gdGVtcGxhdGUgYWRkX29yZGVyLmh0bWwgYW5kIENvbnRyb2xsZXIgQ2xpZW50c0FkZENvbnRyb2xsZXIKLy9VcmkgL1Nob3dPcmRlcnMgLT4gdGVtcGxhdGUgc2hvd19vcmRlcnMuaHRtbCBhbmQgQ29udHJvbGxlciBDbGllbnRzQWRkQ29udHJvbGxlcgprdXplQXBwLmNvbmZpZyhbJyRyb3V0ZVByb3ZpZGVyJywKICAgIGZ1bmN0aW9uKCRyb3V0ZVByb3ZpZGVyKSB7CiAgICAgICAgLy8gbG9nRGVidWcoJHJvdXRlUHJvdmlkZXIpOwogICAgICAgICRyb3V0ZVByb3ZpZGVyLgogICAgICAgIC8vIHdoZW4oJy9jbGllbnRjYXJkJywgewogICAgICAgIC8vICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19jbGllbnRfY2FyZC5odG1sJywKICAgICAgICAvLyAgICAgY29udHJvbGxlcjogJ2NsaWVudENhcmRDb250cm9sbGVyJwogICAgICAgIC8vIH0pLgogICAgICAgIHdoZW4oJy9jb250YWN0JywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdjb250YWN0LnBocCcsCiAgICAgICAgICAgIC8vIGNvbnRyb2xsZXI6ICdlbmRVc2VySG9tZUNvbnRyb2xsZXInCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdjb250YWN0Q29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvZXZlbnRfdHlwZXMnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2V2ZW50X3R5cGVzLmh0bWwnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnRXZlbnRUeXBlc0NvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2V2ZW50X3R5cGVzL2FkZCcsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfZXZlbnRfdHlwZV9hZGQucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0V2ZW50VHlwZU5ld0NvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2V2ZW50X3R5cGVzLzpldmVudF90eXBlX2lkJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19ldmVudF90eXBlX2FkZC5waHAnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnRXZlbnRUeXBlVXBkYXRlQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvaG91cnNfb2Zfd29yaycsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfaG91cnNfb2Zfd29yay5odG1sJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0hvdXJzT2ZXb3JrQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvYnVzaW5lc3NfY2FsZW5kYXInLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2NhbGVuZGFyLmh0bWwnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnQnVzaW5lc3NDYWxlbmRhckNvbnRyb2xsZXInLAogICAgICAgICAgICByZWxvYWRPblNlYXJjaDogZmFsc2UKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvYW5ndWxhci1mb3JtLWJ1aWxkZXInLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2FuZ3VsYXItZm9ybS1idWlsZGVyL2luZGV4Lmh0bWwnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnRGVtb0NvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2J1c2luZXNzX2NsaWVudHMvYWRkJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19jbGllbnRzX2FkZC5odG1sJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0NsaWVudHNBZGRDb250cm9sbGVyJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9idXNpbmVzc19jbGllbnRzJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19jbGllbnRzLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdDbGllbnRzU2hvd0NvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2J1c2luZXNzX2NsaWVudHMvOmJ1c2luZXNzX3VzZXJfaWQnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2NsaWVudF9jYXJkLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdDbGllbnRzU2hvdzFDb250cm9sbGVyJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9idXNpbmVzc19yZXBvcnRzJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19yZXBvcnRzLmh0bWwnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnQnVzaW5lc3NSZXBvcnRzQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvYnVzaW5lc3NfaW5zdHJ1Y3RvcnMnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2luc3RydWN0b3JzLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdJbnN0cnVjdG9yc1Nob3dDb250cm9sbGVyJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9idXNpbmVzc19pbnN0cnVjdG9ycy9hZGQnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2NsaWVudHNfYWRkLmh0bWwnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnSW5zdHJ1Y3RvcnNBZGRDb250cm9sbGVyJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9idXNpbmVzc19sb2NhdGlvbnMnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2xvY2F0aW9ucy5waHAnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnYnVzaW5lc3NfbG9jYXRpb25zJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9idXNpbmVzc19sb2NhdGlvbnMvYWRkJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19sb2NhdGlvbnNfYWRkLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdidXNpbmVzc19sb2NhdGlvbnNfYWRkJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9idXNpbmVzc19sb2NhdGlvbnMvOmxvY2F0aW9uX2lkJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19sb2NhdGlvbnNfYWRkLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdidXNpbmVzc19sb2NhdGlvbnNfdXBkYXRlJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9idXNpbmVzc19pbnN0cnVjdG9ycy86YnVzaW5lc3NfdXNlcl9pZCcsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfaW5zdHJ1Y3Rvcl9jYXJkLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdJbnN0cnVjdG9yU2hvdzFDb250cm9sbGVyJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9ldmVudC86ZXZlbnRfaWQnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2V2ZW50X2NhcmQucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0V2ZW50UGFnZUNvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2V2ZW50X2NsYXNzLzpldmVudF9pZCcsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfZXZlbnRfY2xhc3NfY2FyZC5odG1sJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0V2ZW50Q2xhc3NQYWdlQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvcGFja2FnZXMnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX3BhY2thZ2VzX3Nob3cucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ1BhY2thZ2VzQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvcGFja2FnZXMvYWRkJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19wYWNrYWdlc19jcmVhdGUucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ2J1c2luZXNzX3BhY2thZ2VzX2FkZF9jbnRsJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9wYWNrYWdlcy86cGFja2FnZV9pZCcsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfcGFja2FnZXNfY3JlYXRlLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdidXNpbmVzc19wYWNrYWdlc191cGRhdGVfY250bCcKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvYnVzaW5lc3NfY29uZmlnJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19jb25maWcucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0NvbmZpZ0J1c2luZXNzQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvdXNlcl9jb25maWcnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ3VzZXJfY29uZmlnLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdDb25maWdVc2VyQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvYnVzaW5lc3NfZG9jcycsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfZG9jcy5odG1sJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0J1c2luZXNzRG9jc0NvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignLycsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnaG9tZS5waHAnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnSG9tZUNvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgb3RoZXJ3aXNlKHsKICAgICAgICAgICAgLy8gICAgcmVkaXJlY3RUbzogJy8nCiAgICAgICAgfSk7CiAgICB9Cl0pOwoKa3V6ZUFwcC5mYWN0b3J5KCdzaGFyZWREYXRhJywgZnVuY3Rpb24oKSB7CiAgICB2YXIgc2VsZWN0ZWRFbmRVc2VyID0gbnVsbDsKCiAgICByZXR1cm4gewogICAgICAgIGdldFNlbGVjdGVkRW5kVXNlcjogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIC8vWW91IGNvdWxkIGFsc28gcmV0dXJuIHNwZWNpZmljIGF0dHJpYnV0ZSBvZiB0aGUgZm9ybSBkYXRhIGluc3RlYWQKICAgICAgICAgICAgLy9vZiB0aGUgZW50aXJlIGRhdGEKICAgICAgICAgICAgcmV0dXJuIHNlbGVjdGVkRW5kVXNlcjsKICAgICAgICB9LAogICAgICAgIHNldFNlbGVjdGVkRW5kVXNlcjogZnVuY3Rpb24obmV3U2VsZWN0ZWRFbmRVc2VyKSB7CiAgICAgICAgICAgIC8vWW91IGNvdWxkIGFsc28gc2V0IHNwZWNpZmljIGF0dHJpYnV0ZSBvZiB0aGUgZm9ybSBkYXRhIGluc3RlYWQKICAgICAgICAgICAgc2VsZWN0ZWRFbmRVc2VyID0gbmV3U2VsZWN0ZWRFbmRVc2VyOwogICAgICAgIH0sCiAgICB9Owp9KTsKCmt1emVBcHAuZGlyZWN0aXZlKCdjb252ZXJ0VG9OdW1iZXInLCBmdW5jdGlvbigpIHsKICByZXR1cm4gewogICAgcmVxdWlyZTogJ25nTW9kZWwnLAogICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGVsZW1lbnQsIGF0dHJzLCBuZ01vZGVsKSB7CiAgICAgIG5nTW9kZWwuJHBhcnNlcnMucHVzaChmdW5jdGlvbih2YWwpIHsKICAgICAgICByZXR1cm4gdmFsICE9IG51bGwgPyBwYXJzZUludCh2YWwsIDEwKSA6IG51bGw7CiAgICAgIH0pOwogICAgICBuZ01vZGVsLiRmb3JtYXR0ZXJzLnB1c2goZnVuY3Rpb24odmFsKSB7CiAgICAgICAgcmV0dXJuIHZhbCAhPSBudWxsID8gJycgKyB2YWwgOiBudWxsOwogICAgICB9KTsKICAgIH0KICB9Owp9KTsKCmt1emVBcHAuZGlyZWN0aXZlKCdlbGFzdGljJywgWwogICAgJyR0aW1lb3V0JywKICAgIGZ1bmN0aW9uKCR0aW1lb3V0KSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJywKICAgICAgICAgICAgbGluazogZnVuY3Rpb24oJHNjb3BlLCBlbGVtZW50KSB7CiAgICAgICAgICAgICAgICAkc2NvcGUuaW5pdGlhbEhlaWdodCA9ICRzY29wZS5pbml0aWFsSGVpZ2h0IHx8IGVsZW1lbnRbMF0uc3R5bGUuaGVpZ2h0OwogICAgICAgICAgICAgICAgdmFyIHJlc2l6ZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIGVsZW1lbnRbMF0uc3R5bGUuaGVpZ2h0ID0gJHNjb3BlLmluaXRpYWxIZWlnaHQ7CiAgICAgICAgICAgICAgICAgICAgZWxlbWVudFswXS5zdHlsZS5oZWlnaHQgPSAiIiArIGVsZW1lbnRbMF0uc2Nyb2xsSGVpZ2h0ICsgInB4IjsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBlbGVtZW50Lm9uKCJpbnB1dCBjaGFuZ2UiLCByZXNpemUpOwogICAgICAgICAgICAgICAgLy8gZWxlbWVudC5vbigiaW5wdXQgY2hhbmdlIiwgcmVzaXplKTsKICAgICAgICAgICAgICAgICR0aW1lb3V0KHJlc2l6ZSwgMCk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgfQpdKTsKCmt1emVBcHAuc2VydmljZSgnc2hhcmVkUHJvcGVydGllcycsIGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgc2VsZWN0ZWRfdXNlciA9IG51bGw7CiAgICAgICAgdmFyIGNhbGVuZGFyX2RhdGUgPSBudWxsOwogICAgICAgIHZhciBldmVudF9yZXNjaGVkdWxlID0gbnVsbDsKICAgICAgICB2YXIgc2VsZWN0ZWRfaW5zdHJ1Y3RvciA9IDA7CiAgICAgICAgdmFyIGV2ZW50X3R5cGVfZm9yX3N1Z2dlc3Rpb25zID0gbnVsbDsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBnZXRfc2VsZWN0ZWRfaW5zdHJ1Y3RvcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGVjdGVkX2luc3RydWN0b3I7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNldF9zZWxlY3RlZF9pbnN0cnVjdG9yOiBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgICAgICAgICAgc2VsZWN0ZWRfaW5zdHJ1Y3RvciA9IHZhbHVlOwogICAgICAgICAgICB9LAogICAgICAgICAgICBnZXRfc2VsZWN0ZWRfdXNlcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGVjdGVkX3VzZXI7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNldF9zZWxlY3RlZF91c2VyOiBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgICAgICAgICAgc2VsZWN0ZWRfdXNlciA9IHZhbHVlOwogICAgICAgICAgICB9LAogICAgICAgICAgICBzZXRfZXZlbnRfcmVzY2hlZHVsZTogZnVuY3Rpb24odmFsdWUpIHsKICAgICAgICAgICAgICAgIGV2ZW50X3Jlc2NoZWR1bGUgPSB2YWx1ZTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZ2V0X2V2ZW50X3Jlc2NoZWR1bGU6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBldmVudF9yZXNjaGVkdWxlOwogICAgICAgICAgICB9LAogICAgICAgICAgICBnZXRfY2FsZW5kYXJfZGF0ZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGNhbGVuZGFyX2RhdGU7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNldF9jYWxlbmRhcl9kYXRlOiBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgICAgICAgICAgY2FsZW5kYXJfZGF0ZSA9IHZhbHVlOwogICAgICAgICAgICB9LAogICAgICAgICAgICBnZXRfZXZlbnRfdHlwZV9mb3Jfc3VnZ2VzdGlvbnM6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBldmVudF90eXBlX2Zvcl9zdWdnZXN0aW9uczsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2V0X2V2ZW50X3R5cGVfZm9yX3N1Z2dlc3Rpb25zOiBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgICAgICAgICAgLy8gbG9nRGVidWcoInNldF9ldmVudF90eXBlX2Zvcl9zdWdnZXN0aW9ucz0iK3ZhbHVlKTsKICAgICAgICAgICAgICAgIGV2ZW50X3R5cGVfZm9yX3N1Z2dlc3Rpb25zID0gdmFsdWU7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ21lbnVDb250cm9sbGVyJywgWyckc2NvcGUnLCAnJGxvY2F0aW9uJywgZnVuY3Rpb24oJHNjb3BlLCAkbG9jYXRpb24pIHsKICAgIHJldHVybiB0cnVlOwogICAgbG9nRGVidWcoIiRzY29wZS5pc0N1cnJlbnRQYXRoPSIgKyAkc2NvcGUuaXNDdXJyZW50UGF0aCk7CiAgICAkc2NvcGUuaXNDdXJyZW50UGF0aCA9IGZ1bmN0aW9uKHBhdGgpIHsKICAgICAgICByZXR1cm4gJGxvY2F0aW9uLnBhdGgoKSA9PSBwYXRoOwogICAgfTsKfV0pOwoKCgprdXplQXBwLmNvbnRyb2xsZXIoJ0J1c2luZXNzUmVwb3J0c0NvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkbG9jYXRpb24sJHJvdXRlUGFyYW1zKQp7CgogIGxvZ0RlYnVnKCJjb250cm9sbGVyOiBCdXNpbmVzc1JlcG9ydHNDb250cm9sbGVyIik7CgogICRzY29wZS5vcmRlckJ5RmllbGQgPSAnc3RhcnRfZXBvY2gnOwogICRzY29wZS5yZXZlcnNlU29ydD10cnVlOwogICRzY29wZS5ldmVudE1vZGVsPXRydWU7CgogIGdldEJ1c2luZXNzTG9jYXRpb25zKCRodHRwLCRzY29wZSwnYnVzaW5lc3NfbG9jYXRpb25zJyk7CiAgZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzKCRodHRwLCRzY29wZSwnZXZlbnRfdHlwZXMnKTsKICBnZXRBbGxJbnN0cnVjdG9ycygkaHR0cCwkc2NvcGUsJ2luc3RydWN0b3JzJyk7CiAgZ2V0QWxsQ2xpZW50c0FuZEFyY2hpdmUoJGh0dHAsJHNjb3BlLCdjbGllbnRzJyk7CiAgJHNjb3BlLnN0YXR1c2VzID0gWyB7InN0YXR1c19pZCI6IjAiLCJzdGF0dXNfbmFtZSI6Itek16rXldeXIn0sIHsic3RhdHVzX2lkIjoiMSIsInN0YXR1c19uYW1lIjoi16HXkteV16gifV07CiAgJHNjb3BlLmNhbmNlbGxhdGlvbnMgPSBbIHsiaXNfY2FuY2VsZWQiOiIwIiwiY2FuY2VsbGF0aW9uX25hbWUiOiLXnNeQINeR15XXmNecIn0seyJpc19jYW5jZWxlZCI6IjEiLCJjYW5jZWxsYXRpb25fbmFtZSI6IteR15XXmNecIn1dOwogICRzY29wZS5tb250aHMgPSBbIHsibW9udGgiOiIxIn0seyJtb250aCI6IjIifSx7Im1vbnRoIjoiMyJ9LHsibW9udGgiOiI0In0seyJtb250aCI6IjUifSx7Im1vbnRoIjoiNiJ9LHsibW9udGgiOiI3In0seyJtb250aCI6IjgifSx7Im1vbnRoIjoiOSJ9LHsibW9udGgiOiIxMCJ9LHsibW9udGgiOiIxMSJ9LHsibW9udGgiOiIxMiJ9XTsKICAkc2NvcGUueWVhcnMgPSBbIHsieWVhciI6IjIwMTYifSx7InllYXIiOiIyMDE3In1dOwogICRzY29wZS5wZXJpb2RzID0gWwogICAgICB7InBlcmlvZF9uYW1lIjoi15TXmdeh15jXldeo15kiLCAicGVyaW9kX3NpZ24iOiItMSJ9LAogICAgICB7InBlcmlvZF9uYW1lIjoi15TXmdeV150iLCAicGVyaW9kX3NpZ24iOiIwIn0sCiAgICAgIHsicGVyaW9kX25hbWUiOiLXoteq15nXk9eZIiwgInBlcmlvZF9zaWduIjoiMSJ9LAogICAgXQoKICAkc2NvcGUuY3N2X2NvbHVtbnNfb3JkZXIgPSBbJ2V2ZW50X3R5cGVfbmFtZScsICdzdGFydF90aW1lJywgJ2V2ZW50X3VzZXJfY2xpZW50cycsICdpbnN0cnVjdG9yX25hbWUnLCAnaXNfY2FuY2VsZWQnLCAnaXNfY29tcGxldGVkJywgJ2FjdHVhbF9wcmljZScsICdwYXJ0aWNpcGF0ZWQnXTsKICAkc2NvcGUuY3N2X2NvbHVtbnNfaGVhZGVyID0gWyfXodeV15Ig157XpNeS16knLCAn16rXkNeo15nXmiDXldep16LXlCcsICfXntep16rXqtek15nXnScsICfXnteT16jXmdeaJywn157XkdeV15jXnCcsICfXodeS15XXqCcsICfXnteX15nXqCcsICfXntep16rXqtek15nXnSddOwoKCgogICRzY29wZS5nb3RvQ2xpZW50UGFnZT0gZnVuY3Rpb24gKGJ1c2luZXNzVXNlcmlkKSB7CiAgICBnb3RvQ2xpZW50UGFnZShidXNpbmVzc1VzZXJpZCk7CiAgfQoKICBmdW5jdGlvbiBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSh4LHZhbHVlKXsKICAgIGlmICggeCAhPSB1bmRlZmluZWQgKXsKICAgICAgdmFyIHgxID0gbmV3IEFycmF5KCk7CiAgICAgIGZvciAoaSA9IDA7IGkgPCB4Lmxlbmd0aDsgaSsrKXsKICAgICAgICB4MVtpXSA9IHhbaV1bdmFsdWVdOwogICAgICB9CiAgICAgIHgxID0geDEuam9pbigpOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgcmV0dXJuIHgxOwogIH0KCiAgJHNjb3BlLnJlcG9ydF9pc19sb2FkaW5nID0gZmFsc2U7CgogICRzY29wZS5ldmVudHNSZXBvcnQgPSBmdW5jdGlvbigpewogICAgbG9nRGVidWcoImV2ZW50c1JlcG9ydCIpOwoKICAgICRzY29wZS5zaG93QWdnID0gKCRzY29wZS5ldmVudFR5cGVNb2RlbCkgfHwKICAgICAoJHNjb3BlLmluc3RydWN0b3JNb2RlbCkgfHwgKCRzY29wZS5tb250aE1vZGVsKSB8fCAoJHNjb3BlLmNsaWVudHNNb2RlbCkgfHwgKCRzY29wZS55ZWFyTW9kZWwpIDsKCiAgICBldmVudF90eXBlX2lkX2ZpbHRlciA9IGxpc3RfdG9fc3RyaW5nX2J5X3ZhbHVlKCRzY29wZS5zZWxlY3RlZEV2ZW50VHlwZUZpbHRlciwgImV2ZW50X3R5cGVfaWQiICk7CiAgICBpbnN0cnVjdG9yX2lkX2ZpbHRlciA9IGxpc3RfdG9fc3RyaW5nX2J5X3ZhbHVlKCRzY29wZS5zZWxlY3RlZEluc3RydWN0b3JGaWx0ZXIsICJidXNpbmVzc191c2VyX2lkIiApOwogICAgbW9udGhfZmlsdGVyID0gbGlzdF90b19zdHJpbmdfYnlfdmFsdWUoJHNjb3BlLnNlbGVjdGVkTW9udGhGaWx0ZXIsICJtb250aCIgKTsKICAgIGNsaWVudF9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuc2VsZWN0ZWRDbGllbnRGaWx0ZXIsICJidXNpbmVzc191c2VyX2lkIiApOwogICAgeWVhcl9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuc2VsZWN0ZWRZZWFyRmlsdGVyLCAieWVhciIgKTsKICAgIHN0YXR1c19maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuc2VsZWN0ZWRTdGF0dXNGaWx0ZXIsICJzdGF0dXNfaWQiICk7CiAgICBpc19jYW5jZWxlZF9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuc2VsZWN0ZWRJc19jYW5jZWxlZEZpbHRlciwgImlzX2NhbmNlbGVkIiApOwogICAgcGVyaW9kX2ZpbHRlciA9IGxpc3RfdG9fc3RyaW5nX2J5X3ZhbHVlKCRzY29wZS5zZWxlY3RlZFBlcmlvZEZpbHRlciwgInBlcmlvZF9zaWduIiApOwoKICAgICRzY29wZS5ldmVudFJlcG9ydENvbmZpZyA9IHt9OwoKICAgICRzY29wZS5ldmVudFJlcG9ydENvbmZpZy5maWx0ZXJzID0gewogICAgICBldmVudF90eXBlX2lkOiBldmVudF90eXBlX2lkX2ZpbHRlciwKICAgICAgaW5zdHJ1Y3Rvcl9pZDogaW5zdHJ1Y3Rvcl9pZF9maWx0ZXIsCiAgICAgIG1vbnRoOiBtb250aF9maWx0ZXIsCiAgICAgIHllYXI6IHllYXJfZmlsdGVyLAogICAgICBjbGllbnQ6IGNsaWVudF9maWx0ZXIsCiAgICAgIHN0YXR1czogc3RhdHVzX2ZpbHRlciwKICAgICAgcGVyaW9kOiBwZXJpb2RfZmlsdGVyLAogICAgICBpc19jYW5jZWxlZDogaXNfY2FuY2VsZWRfZmlsdGVyCiAgICB9OwoKICAgICRzY29wZS5ldmVudFJlcG9ydENvbmZpZy5hZ2dyZWdhdGlvbnMgPSB7CiAgICAgIGV2ZW50X3R5cGVfaWQ6ICRzY29wZS5ldmVudFR5cGVNb2RlbCwKICAgICAgaW5zdHJ1Y3Rvcl9pZDogJHNjb3BlLmluc3RydWN0b3JNb2RlbCwKICAgICAgbW9udGg6ICRzY29wZS5tb250aE1vZGVsLAogICAgICB5ZWFyOiAkc2NvcGUueWVhck1vZGVsLAogICAgICBjbGllbnQ6ICRzY29wZS5jbGllbnRNb2RlbCwKICAgIH07CgogICAgaWYgKCAkc2NvcGUuc2hvd0FnZyApIHsKICAgICAgZ2V0RXZlbnRzUmVwb3J0KCRodHRwLCRzY29wZSwgZ2V0RXZlbnRzUmVwb3J0QWdncmVnYXRlZF9zdWNjZXNzKTsKICAgICAgJHNjb3BlLnJlcG9ydF9pc19sb2FkaW5nID0gdHJ1ZTsKICAgIH0gZWxzZSB7CiAgICAgIGdldEV2ZW50c1JlcG9ydCgkaHR0cCwkc2NvcGUsIGdldEV2ZW50c1JlcG9ydExpc3Rfc3VjY2Vzcyk7CiAgICAgICRzY29wZS5yZXBvcnRfaXNfbG9hZGluZyA9IHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0RXZlbnRzUmVwb3J0TGlzdF9zdWNjZXNzKHJlc3BvbnNlKXsKICAgICAgJHNjb3BlLkV2ZW50UmVwb3J0TGlzdCA9IHJlc3BvbnNlLmpzb247CiAgICAgICRzY29wZS5kb3dubG9hZF9yZXBvcnQgPSAkc2NvcGVbICdFdmVudFJlcG9ydExpc3QnIF07CiAgICAgICRzY29wZS5yZXBvcnRfaXNfbG9hZGluZyA9IGZhbHNlOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldEV2ZW50c1JlcG9ydEFnZ3JlZ2F0ZWRfc3VjY2VzcyhyZXNwb25zZSl7CiAgICAgICRzY29wZS5FdmVudFJlcG9ydEFnZ3JlZ2F0ZWQgPSByZXNwb25zZS5qc29uOwogICAgICAkc2NvcGUuZG93bmxvYWRfcmVwb3J0ID0gJHNjb3BlWyAnRXZlbnRSZXBvcnRBZ2dyZWdhdGVkJyBdOwogICAgICAkc2NvcGUucmVwb3J0X2lzX2xvYWRpbmcgPSBmYWxzZTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRDbGllbnRzUmVwb3J0TGlzdF9zdWNjZXNzKHJlc3BvbnNlKXsKICAgICAgJHNjb3BlLkNsaWVudHNSZXBvcnRMaXN0ID0gcmVzcG9uc2UuanNvbjsKICAgICAgY29uc29sZS5sb2coIi0tLS0tLS0tLS0tLSIpCiAgICAgIGNvbnNvbGUubG9nKCRzY29wZS5DbGllbnRzUmVwb3J0TGlzdCkKICAgICAgY29uc29sZS5sb2coIi0tLS0tLS0tLS0tLSIpCiAgICAgICRzY29wZS5yZXBvcnRfaXNfbG9hZGluZyA9IGZhbHNlOwogICAgfQoKCiAgfQoKICAkc2NvcGUuY2xpZW50c1JlcG9ydCA9IGZ1bmN0aW9uKCl7CiAgICBsb2dEZWJ1ZygiY2xpZW50c1JlcG9ydCIpOwoKICAgIGNsaWVudF9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuc2VsZWN0ZWRDbGllbnRGaWx0ZXIsICJjbGllbnQiICk7CgogICAgJHNjb3BlLmV2ZW50UmVwb3J0Q29uZmlnID0ge307CgogICAgJHNjb3BlLmV2ZW50UmVwb3J0Q29uZmlnLmZpbHRlcnMgPSB7CiAgICAgIGNsaWVudDogY2xpZW50X2ZpbHRlciwKICAgIH07CgogICAgJHNjb3BlLmV2ZW50UmVwb3J0Q29uZmlnLmFnZ3JlZ2F0aW9ucyA9IHsKICAgIH07CgogICAgZ2V0Q2xpZW50c1JlcG9ydCgkaHR0cCwkc2NvcGUsIGdldENsaWVudHNSZXBvcnRfc3VjY2Vzcyk7CiAgICAkc2NvcGUucmVwb3J0X2lzX2xvYWRpbmcgPSB0cnVlOwogICAgZnVuY3Rpb24gZ2V0Q2xpZW50c1JlcG9ydF9zdWNjZXNzKHJlc3BvbnNlKXsKICAgICAgJHNjb3BlLmNsaWVudFJlcG9ydCA9IHJlc3BvbnNlLmpzb247CiAgICAgICRzY29wZS5kb3dubG9hZF9yZXBvcnQgPSAkc2NvcGVbICdjbGllbnRSZXBvcnQnIF07CiAgICAgICRzY29wZS5yZXBvcnRfaXNfbG9hZGluZyA9IGZhbHNlOwogICAgfQogIH0KCiAgJHNjb3BlLmVkaXRFdmVudD0gZnVuY3Rpb24gKHRoZWV2ZW50KQogIHsKICAgIGdvdG9FdmVudFBhZ2UodGhlZXZlbnQpOwogIH0KCiAgJHNjb3BlLmV2ZW50c1JlcG9ydCgpOwogICRzY29wZS5zZWxlY3RlZFJlcG9ydD0iZXZlbnRzIjsKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2J1c2luZXNzX3BhY2thZ2VzX3VwZGF0ZV9jbnRsJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uLCRyb3V0ZVBhcmFtcykKewogICRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIgPSB7fTsgLy8gdGhlc2UgYXJlIHRoZSBjb21wbGV0ZSBkZXRhaWxzIGZvciB0aGUgbmV3IGV2ZW50IC8vCiAgJHNjb3BlLnBhY2thZ2VfaXNfdXBkYXRlID0gdHJ1ZTsKICAkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLnBhY2thZ2VfbGltaXRfdHlwZT0xOwoKICAvLyBnZXR0dGluZyB0aGUgcGFja2FnZSBhbmQgaXRzIGV2ZW50IHR5cGVzCiAgZ2V0QnVzaW5lc3NQYWNrYWdlKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMucGFja2FnZV9pZCwnZm9ybUFkZFBhY2thZ2VBbmd1bGFyJyxmdW5jdGlvbihyZXNwb25zZSkKICB7CiAgICAkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLmlzX3VwZGF0ZSA9IHRydWU7CiAgICAkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLm9yaWdFdmVudFR5cGVzPWFuZ3VsYXIuY29weSgkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLnNlbGVjdGVkRXZlbnRUeXBlcyk7CiAgICAkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLnBhY2thZ2VfbGltaXRfdHlwZT0xOwogICAgLy8gdGhlbiBnZXR0aW5nIGFsbCB0aGUgZXZlbnQgdHlwZXMKICAgIGdldEV2ZW50VHlwZXNOb0FkbWluKCRodHRwLCRzY29wZSwncmVsYXRlZEV2ZW50VHlwZXMnLGdldEV2ZW50VHlwZXNOb0FkbWluX3N1Y2Nlc3MpOwogICAgZnVuY3Rpb24gZ2V0RXZlbnRUeXBlc05vQWRtaW5fc3VjY2VzcygpCiAgICB7CiAgICAgIC8vIHRoZW4gcmVtb3ZpbmcgZXhpc3RpbmcgZXZlbnQgdHlwZXMgb2YgcGFja2FnZSBmcm9tIGxpc3QKICAgICAgLy8gY29uc29sZS5sb2coJHNjb3BlLnJlbGF0ZWRFdmVudFR5cGVzWzBdKTsKICAgICAgLy8gY29uc29sZS5sb2coJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5zZWxlY3RlZEV2ZW50VHlwZXNbMF0pOwogICAgICBmb3IodmFyIGkgPSAwOyBpIDwgJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5zZWxlY3RlZEV2ZW50VHlwZXMubGVuZ3RoOyBpKyspCiAgICAgIHsKICAgICAgICAvLyBjb3B5aW5nIHRoZSBhY3R1YWwgb2JqZWN0IG9mICRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuc2VsZWN0ZWRFdmVudFR5cGVzW2ldCiAgICAgICAgZm9yKHZhciBqID0gMDsgaiA8ICRzY29wZS5yZWxhdGVkRXZlbnRUeXBlcy5sZW5ndGg7IGorKykKICAgICAgICB7CiAgICAgICAgICBpZiAoJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5zZWxlY3RlZEV2ZW50VHlwZXNbaV0uZXZlbnRfdHlwZV9pZD09JHNjb3BlLnJlbGF0ZWRFdmVudFR5cGVzW2pdLmV2ZW50X3R5cGVfaWQpCiAgICAgICAgICB7CiAgICAgICAgICAgICRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuc2VsZWN0ZWRFdmVudFR5cGVzW2ldPWFuZ3VsYXIuY29weSgkc2NvcGUucmVsYXRlZEV2ZW50VHlwZXNbal0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogIH0pOwogICRzY29wZS5nb3RvQmFjayA9IGdvdG9CYWNrOwogICRzY29wZS5jcmVhdGVQYWNrYWdlID0gZnVuY3Rpb24oKQogIHsKICAgIGNvbnNvbGUubG9nKCJ1cGRhdGVQYWNrYWdlRGV0YWlscyIpOwogICAgdXBkYXRlUGFja2FnZURldGFpbHMoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5wYWNrYWdlX2lkLCRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIsc3VjY2Vzc19jYWxsYmFjaywgZmFpbHVyZV9jYWxsYmFjayk7CiAgICBmdW5jdGlvbiBzdWNjZXNzX2NhbGxiYWNrKCkKICAgIHsKICAgICAgZ290b0JhY2soKTsKICAgIH0KICAgIGZ1bmN0aW9uIGZhaWx1cmVfY2FsbGJhY2soKQogICAgewogICAgICBnb3RvQmFjaygpOwogICAgfQogIH07Cn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdidXNpbmVzc19wYWNrYWdlc19hZGRfY250bCcsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikgewogICAgbG9nRGVidWcoJ2J1c2luZXNzX3BhY2thZ2VzX2FkZF9jbnRsJyk7CiAgICAkc2NvcGUucGFja2FnZV9pc191cGRhdGUgPSBmYWxzZTsKICAgICRzY29wZS5nb3RvQmFjayA9IGdvdG9CYWNrOwogICAgJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhciA9IHt9OwogICAgJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5ldmVudHNfY291bnRlciA9IDE7CiAgICAkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLmV2ZW50c19wZXJfd2VlayA9IDE7CiAgICAkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLnBhY2thZ2VfZHVyYXRpb25fbW9udGhzID0gMzsKICAgICRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIucGFja2FnZV9saW1pdF90eXBlPTE7CiAgICBnZXRFdmVudFR5cGVzTm9BZG1pbigkaHR0cCwkc2NvcGUsJ3JlbGF0ZWRFdmVudFR5cGVzJyk7CgogICAgJHNjb3BlLmNyZWF0ZVBhY2thZ2UgPSBmdW5jdGlvbigpCiAgICB7CiAgICAgIGNyZWF0ZVBhY2thZ2UoJGh0dHAsJHNjb3BlLCRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIsY3JlYXRlUGFja2FnZV9zdWNjZXNzLCBjcmVhdGVQYWNrYWdlX2ZhaWx1cmUpOwogICAgICBmdW5jdGlvbiBjcmVhdGVQYWNrYWdlX3N1Y2Nlc3MoKQogICAgICB7CiAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9wYWNrYWdlcycpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGNyZWF0ZVBhY2thZ2VfZmFpbHVyZSgpCiAgICAgIHsKICAgICAgICAvLyBsb2dFcnJvcigiZXJyb3IgIiArIGRhdGEubWVzc2FnZSk7CiAgICAgICAgLy8gJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5hamF4X2Vycm9yID0gZGF0YS5tZXNzYWdlOwogICAgICB9CiAgICB9Cn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdidXNpbmVzc19sb2NhdGlvbnMnLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkbG9jYXRpb24pIHsKICAgIGxvZ0RlYnVnKCdidXNpbmVzc19sb2NhdGlvbnMgY29udHJvbGxlcicpOwogICAgZ2V0QnVzaW5lc3NMb2NhdGlvbnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19sb2NhdGlvbnMnKTsKICAgICRzY29wZS5hZGROZXdMb2NhdGlvbiA9IGZ1bmN0aW9uICgpCiAgICB7CiAgICAgICRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfbG9jYXRpb25zL2FkZCcpOwogICAgfQogICAgJHNjb3BlLmdvdG9Mb2NhdGlvblBhZ2UgPSBmdW5jdGlvbihsb2NhdGlvbl9pZCkKICAgIHsKICAgICAgZ290b0xvY2F0aW9uUGFnZShsb2NhdGlvbl9pZCk7CiAgICB9Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignQnVzaW5lc3NEb2NzQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikgewogICAgbG9nRGVidWcoJ0J1c2luZXNzRG9jc0NvbnRyb2xsZXInKTsKfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdidXNpbmVzc19sb2NhdGlvbnNfdXBkYXRlJywgZnVuY3Rpb24oJHNjb3BlLCAkcm91dGVQYXJhbXMsICRodHRwLCAkbG9jYXRpb24pIHsKICAgIGxvZ0RlYnVnKCdidXNpbmVzc19sb2NhdGlvbnNfdXBkYXRlIGNvbnRyb2xsZXInKTsKICAgICRzY29wZS5pc191cGRhdGU9dHJ1ZTsKICAgIC8vIGdldEJ1c2luZXNzTG9jYXRpb25zKCRodHRwLCRzY29wZSwnYnVzaW5lc3NfbG9jYXRpb25zJyk7CiAgICBnZXRCdXNpbmVzc0xvY2F0aW9uKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMubG9jYXRpb25faWQsJ2N1cnJfbG9jYXRpb24nLGdldEJ1c2luZXNzTG9jYXRpb25fc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBnZXRCdXNpbmVzc0xvY2F0aW9uX3N1Y2Nlc3MoKQogICAgewogICAgICAkc2NvcGUuZm9ybUFkZExvY2F0aW9uQW5ndWxhcj0kc2NvcGUuY3Vycl9sb2NhdGlvblswXTsKICAgIH0KCgogICAgJHNjb3BlLmFkZExvY2F0aW9uID0gZnVuY3Rpb24oKQogICAgewogICAgICAvLyBpbiB0aGlzIGNhc2UgLSB1cGRhdGUgbG9jYXRpb24KICAgICAgdGhlZGF0YSA9ICRzY29wZS5mb3JtQWRkTG9jYXRpb25Bbmd1bGFyOwoKICAgICAgZnVuY3Rpb24gYWRkTG9jYXRpb25fc3VjY2VzcygpCiAgICAgIHsKICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2xvY2F0aW9ucycpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGFkZExvY2F0aW9uX2ZhaWx1cmUoKQogICAgICB7CiAgICAgICAgJHNjb3BlLmZvcm1BZGRMb2NhdGlvbkFuZ3VsYXIuYWpheF9lcnJvciA9IHJlc3BvbnNlLm1lc3NhZ2U7CiAgICAgIH0KICAgICAgdXBkYXRlTG9jYXRpb24oJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5sb2NhdGlvbl9pZCwgdGhlZGF0YSxhZGRMb2NhdGlvbl9zdWNjZXNzLGFkZExvY2F0aW9uX2ZhaWx1cmUpOwogICAgfQp9KTsKCmt1emVBcHAuY29udHJvbGxlcignYnVzaW5lc3NfbG9jYXRpb25zX2FkZCcsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikgewogICAgbG9nRGVidWcoJ2J1c2luZXNzX2xvY2F0aW9uc19hZGQgY29udHJvbGxlcicpOwogICAgZ2V0QnVzaW5lc3NMb2NhdGlvbnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19sb2NhdGlvbnMnKTsKICAgICRzY29wZS5pc191cGRhdGU9ZmFsc2U7CgogICAgJHNjb3BlLmFkZExvY2F0aW9uID0gZnVuY3Rpb24oKQogICAgewogICAgICB0aGVkYXRhID0gJHNjb3BlLmZvcm1BZGRMb2NhdGlvbkFuZ3VsYXI7CgogICAgICBmdW5jdGlvbiBhZGRMb2NhdGlvbl9zdWNjZXNzKCkKICAgICAgewogICAgICAgICRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfbG9jYXRpb25zJyk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gYWRkTG9jYXRpb25fZmFpbHVyZSgpCiAgICAgIHsKICAgICAgICAkc2NvcGUuZm9ybUFkZExvY2F0aW9uQW5ndWxhci5hamF4X2Vycm9yID0gcmVzcG9uc2UubWVzc2FnZTsKICAgICAgfQogICAgICBhZGRMb2NhdGlvbigkaHR0cCwkc2NvcGUsdGhlZGF0YSxhZGRMb2NhdGlvbl9zdWNjZXNzLGFkZExvY2F0aW9uX2ZhaWx1cmUpOwogICAgfQp9KTsKCmt1emVBcHAuY29udHJvbGxlcignSW5zdHJ1Y3RvcnNBZGRDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uKSB7CiAgICBsb2dEZWJ1ZygnSW5zdHJ1Y3RvcnNBZGRDb250cm9sbGVyJyk7CiAgICAkc2NvcGUuaXNJbnN0cnVjdG9yPXRydWU7CiAgICAkc2NvcGUudXNlcnR5cGU9Imluc3RydWN0b3IiOwogICAgJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyID0ge307CiAgICAkc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIuaXNfdXBkYXRlPWZhbHNlOwogICAgJHNjb3BlLmFkZENsaWVudCA9IGZ1bmN0aW9uKCkgLy8gYWRkIGluc3RydWN0b3IsIHVzaW5nIHRoZSBzYW1lIGZ1bmN0aW9uIG5hbWUgYXMgd2UgdXNlIHRoZSBzYW1lIHNjcmVlbgogICAgewogICAgICB0aGVkYXRhID0gJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyOwoKICAgICAgZnVuY3Rpb24gYWRkSW5zdHJ1Y3Rvcl9zdWNjZXNzKCkKICAgICAgewogICAgICAgICRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfaW5zdHJ1Y3RvcnMnKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBhZGRDbGllbnRfZmFpbHVyZSgpCiAgICAgIHsKICAgICAgICAkc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIuYWpheF9lcnJvciA9IHJlc3BvbnNlLm1lc3NhZ2U7CiAgICAgIH0KICAgICAgYWRkSW5zdHJ1Y3RvcigkaHR0cCwkc2NvcGUsdGhlZGF0YSxhZGRJbnN0cnVjdG9yX3N1Y2Nlc3MpOwogICAgfQp9KTsKa3V6ZUFwcC5jb250cm9sbGVyKCdDbGllbnRzQWRkQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICR0aW1lb3V0LCAkbG9jYXRpb24sIHNoYXJlZFByb3BlcnRpZXMpIHsKICAgIGxvZ0RlYnVnKCdDbGllbnRzQWRkQ29udHJvbGxlciAtIFRoaXMgaXMgQWRkIG5ldyBjbGllbnQgc2NyZWVuJyk7CiAgICAkc2NvcGUuaXNJbnN0cnVjdG9yPWZhbHNlOwoKICAgICRzY29wZS51c2VydHlwZT0iZW5kdXNlciI7CiAgICAkc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIgPSB7fTsKICAgICRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5pc191cGRhdGU9ZmFsc2U7CiAgICAkc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIuZGlzYWJsZV9waG9uZV9lZGl0aW5nPWZhbHNlOwoKICAgIGlmICgoJHNjb3BlLmZpbHRlci5WYWx1ZSAhPSAiIikgJiYgKHR5cGVvZiAkc2NvcGUuZmlsdGVyLlZhbHVlICE9ICd1bmRlZmluZWQnKSkgewogICAgICAgIGxvZ0RlYnVnKCJjbGllbnRzIGZpbHRlciBpcyBub3QgZW1wdHkiKTsKICAgICAgICB2YXIgZmlsdGVyID0gU3RyaW5nKCRzY29wZS5maWx0ZXIuVmFsdWUpOwogICAgICAgIGlmIChmaWx0ZXIuaW5kZXhPZigiICIpID4gMCkgewogICAgICAgICAgICAkc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIuZmlyc3RfbmFtZSA9IGZpbHRlci5zdWJzdHIoMCwgZmlsdGVyLmluZGV4T2YoIiAiKSk7CiAgICAgICAgICAgICRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5sYXN0X25hbWUgPSBmaWx0ZXIuc3Vic3RyKDEgKyBmaWx0ZXIuaW5kZXhPZigiICIpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIuZmlyc3RfbmFtZSA9IGZpbHRlcjsKICAgICAgICAgICAgJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyLmxhc3RfbmFtZSA9ICIiOwogICAgICAgIH0KICAgICAgICAkc2NvcGUuZmlsdGVyLlZhbHVlID0gIiI7CiAgICAgICAgJHNjb3BlLmZpbHRlci5idXR0b25WYWx1ZSA9ICIiOwogICAgfSBlbHNlIHsKICAgIH0KCiAgICAkc2NvcGUuZ290b0JhY2sgPSBmdW5jdGlvbigpCiAgICB7CiAgICAgICRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfY2xpZW50cycpOwogICAgfQoKICAgICRzY29wZS5hZGRDbGllbnQgPSBmdW5jdGlvbigpCiAgICB7CiAgICAgIHRoZWRhdGEgPSAkc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXI7CgogICAgICBmdW5jdGlvbiBhZGRDbGllbnRfc3VjY2Vzcyh1c2VyX2lkKQogICAgICB7CiAgICAgICAgaWYgKCRzY29wZS5zYXZlX2FuZF9zY2hlZHVsZSkKICAgICAgICB7CiAgICAgICAgICAvLyAkbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2NsaWVudHMvJyt1c2VyX2lkLmpzb24pOwogICAgICAgICAgbG9nRGVidWcoIk5FVyB1c2VyIHVzZXJfaWQ9Iit1c2VyX2lkLmpzb24pOwoKICAgICAgICAgIHVzZXJfaW5mbz0gewogICAgICAgICAgICAgIGJ1c2luZXNzX3VzZXJfaWQ6IHVzZXJfaWQuanNvbiwKICAgICAgICAgICAgICBidXNlcl9maXJzdF9uYW1lOiAkc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIuYnVzZXJfZmlyc3RfbmFtZSwKICAgICAgICAgICAgICBidXNlcl9sYXN0X25hbWU6ICRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5idXNlcl9sYXN0X25hbWUKICAgICAgICAgIH07CgogICAgICAgICAgc2hhcmVkUHJvcGVydGllcy5zZXRfc2VsZWN0ZWRfdXNlcih1c2VyX2luZm8pOwogICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jYWxlbmRhcicpOwoKICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfY2xpZW50cy8nKTsKICAgICAgICB9CiAgICAgICAgY29uc29sZS5sb2coIm5ldyB1c2VyIGlkID0gIit1c2VyX2lkLmpzb24pOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGFkZENsaWVudF9mYWlsdXJlKHJlc3BvbnNlKQogICAgICB7CiAgICAgICAgJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyLmFqYXhfZXJyb3IgPSByZXNwb25zZS5tZXNzYWdlOwogICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkKICAgICAgICB7CiAgICAgICAgICAkc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIuYWpheF9lcnJvcj1udWxsOwogICAgICAgIH0sIDI1MDApOwogICAgICB9CiAgICAgIGFkZENsaWVudCgkaHR0cCwkc2NvcGUsdGhlZGF0YSxhZGRDbGllbnRfc3VjY2VzcywgYWRkQ2xpZW50X2ZhaWx1cmUsZmFsc2UpOwogICAgfQp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ1BhY2thZ2VzQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikgewogICAgbG9nRGVidWcoJ1BhY2thZ2VzQ29udHJvbGxlcicpOwogICAgZ2V0QnVzaW5lc3NQYWNrYWdlcygkaHR0cCwkc2NvcGUsJ3BhY2thZ2VzJyk7CgogICAgJHNjb3BlLnNob3dQYWNrYWdlID0gZnVuY3Rpb24gKHRoZXBhY2thZ2UpCiAgICB7CiAgICAgICRsb2NhdGlvbi5wYXRoKCcvcGFja2FnZXMvJyt0aGVwYWNrYWdlLnBhY2thZ2VfaWQpOwogICAgfQp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ0luc3RydWN0b3JzU2hvd0NvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkbG9jYXRpb24pIHsKICAgIGxvZ0RlYnVnKCdJbnN0cnVjdG9yc1Nob3dDb250cm9sbGVyJyk7CiAgICAkc2NvcGUub3JkZXJCeUZpZWxkID0gJ2J1c2VyX3N0YXJ0X2RhdGUnOwogICAgJHNjb3BlLnJldmVyc2VTb3J0PXRydWU7CgogICAgZ2V0QWxsSW5zdHJ1Y3RvcnMoJGh0dHAsJHNjb3BlLCdhbGxDbGllbnRzJyxnZXRBbGxJbnN0cnVjdG9yc19zdWNjZXNzKTsKICAgIGZ1bmN0aW9uIGdldEFsbEluc3RydWN0b3JzX3N1Y2Nlc3MoKQogICAgewogICAgICAkc2NvcGUuc2hvd0NsaWVudHNHcmlkT3B0aW9ucy5kYXRhPSRzY29wZS5hbGxDbGllbnRzOwogICAgfQoKICAgICRzY29wZS5nb3RvSW5zdHJ1Y3RvclBhZ2U9IGZ1bmN0aW9uIChidXNpbmVzc191c2VyX2lkKQogICAgewogICAgICBnb3RvSW5zdHJ1Y3RvclBhZ2UoYnVzaW5lc3NfdXNlcl9pZCk7CiAgICB9CgogICAgJHNjb3BlLmNsaWVudE5hbWVGaWx0ZXI9IiI7CiAgICAkc2NvcGUuaW5wdXRGaWx0ZXIgPSBmdW5jdGlvbiAoaXRlbSkKICAgIHsKICAgICAgLy8gY29uc29sZS5sb2coaXRlbS5idXNlcl9waG9uZV9udW1iZXIpOwogICAgICByZXR1cm4gZmlsdGVyX2ZpcnN0bGFzdF9uYW1lKGl0ZW0uYnVzZXJfZmlyc3RfbmFtZSxpdGVtLmJ1c2VyX2xhc3RfbmFtZSxpdGVtLmJ1c2VyX3Bob25lX251bWJlciwkc2NvcGUuY2xpZW50TmFtZUZpbHRlcik7CiAgICB9Owp9KTsKCmt1emVBcHAuY29udHJvbGxlcignQ2xpZW50c1Nob3dDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkdWliTW9kYWwsICRodHRwLCAkbG9jYXRpb24pIHsKICAgIGxvZ0RlYnVnKCdDbGllbnRzU2hvd0NvbnRyb2xsZXInKTsKICAgICRzY29wZS5vcmRlckJ5RmllbGQgPSAnYnVzZXJfc3RhcnRfZGF0ZSc7CiAgICAkc2NvcGUucmV2ZXJzZVNvcnQ9dHJ1ZTsKCiAgICBnZXRBbGxDbGllbnRzKCRodHRwLCRzY29wZSwnYWxsQ2xpZW50cycsZ2V0Q2xpZW50X3N1Y2Nlc3MpOwogICAgZnVuY3Rpb24gZ2V0Q2xpZW50X3N1Y2Nlc3MoKQogICAgewogICAgICAkc2NvcGUuc2hvd0NsaWVudHNHcmlkT3B0aW9ucy5kYXRhPSRzY29wZS5hbGxDbGllbnRzOwogICAgfQoKICAgICRzY29wZS5nb3RvQ2xpZW50UGFnZT0gZnVuY3Rpb24gKGJ1c2luZXNzVXNlcmlkKQogICAgewogICAgICBnb3RvQ2xpZW50UGFnZShidXNpbmVzc1VzZXJpZCk7CiAgICB9CgogICAgLy8gZmlsdGVyIGFyY2hpdmVkIGNsaWVudHMKICAgICRzY29wZS5zaG93QXJjaGl2ZWRDaGVja2JveD1mYWxzZTsKICAgICRzY29wZS5zaG93QXJjaGl2ZWQgPSBmdW5jdGlvbiAoZWNsaWVudCkKICAgIHsKICAgICAgaWYgKGVjbGllbnQuaXNfYWN0aXZlPT0wKQogICAgICB7CiAgICAgICAgbG9nRGVidWcoZWNsaWVudCk7CiAgICAgICAgaWYgKCRzY29wZS5zaG93QXJjaGl2ZWRDaGVja2JveCkKICAgICAgICB7CiAgICAgICAgICByZXR1cm4gZWNsaWVudDsKICAgICAgICB9CiAgICAgIH0KICAgICAgZWxzZSB7CiAgICAgICAgcmV0dXJuIGVjbGllbnQ7CiAgICAgIH0KICAgIH07CgogICAgJHNjb3BlLmNsaWVudE5hbWVGaWx0ZXI9IiI7CiAgICAkc2NvcGUuaW5wdXRGaWx0ZXIgPSBmdW5jdGlvbiAoaXRlbSkKICAgIHsKICAgICAgY29uc29sZS5sb2coImNsaWVudE5hbWVGaWx0ZXIiKTsKICAgICAgcmV0dXJuIGZpbHRlcl9maXJzdGxhc3RfbmFtZShpdGVtLmJ1c2VyX2ZpcnN0X25hbWUsaXRlbS5idXNlcl9sYXN0X25hbWUsaXRlbS5idXNlcl9waG9uZV9udW1iZXIsJHNjb3BlLmNsaWVudE5hbWVGaWx0ZXIpOwogICAgfTsKCiAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcz1bXTsKICAgIC8vICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzID0gWwogICAgLy8gICB7ImZpZWxkX2lkIjowLCJmaWVsZF9uYW1lIjoi16rXkNeo15nXmiDXnNeZ15PXlCIsImZpZWxkX2RhdGF0eXBlIjoiREFURSIsImlzX21hbmRhdG9yeSI6MCwgImZyb21kYiI6IGZhbHNlLCAiZGJfaWRfdG9maXgiOiAwLCAiaXNfYWN0aXZlIjogMSwgIm1vZGlmaWVkIjogZmFsc2V9LAogICAgLy8gICB7ImZpZWxkX2lkIjowLCJmaWVsZF9uYW1lIjoi15TXoteo15XXqiIsImZpZWxkX2RhdGF0eXBlIjoiVEVYVF9BUkVBIiwiaXNfbWFuZGF0b3J5IjowLCAiZnJvbWRiIjogZmFsc2UsICJkYl9pZF90b2ZpeCI6IDAsICJpc19hY3RpdmUiOiAxLCAibW9kaWZpZWQiOiBmYWxzZX0KICAgIC8vIF07CgogICAgZnVuY3Rpb24gZ2V0Q2xpZW50c0V4dHJhRmllbGRzX3N1Y2Nlc3MoKQogICAgewogICAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyA9ICRzY29wZS5leHRyYUZpZWxkczsKICAgIH0KICAgIGdldENsaWVudHNFeHRyYUZpZWxkcygkaHR0cCwkc2NvcGUsJ2V4dHJhRmllbGRzJyxnZXRDbGllbnRzRXh0cmFGaWVsZHNfc3VjY2Vzcyk7CgogICAgJHNjb3BlLmV2ZW50VHlwZUV4dHJhRmllbGRzUG9wID0gZnVuY3Rpb24oZXZlbnRUeXBlUHJvcGVydGllcykgewogICAgICAgIGxvZ0RlYnVnKCJldmVudCBjcmVhdGUgbW9kYWwiKTsKCiAgICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgICAgICAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2NsaWVudF9leHRyYV9maWVsZHMucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ2V2ZW50VHlwZUV4dHJhRmllbGRzTW9kYWxDb250cm9sbGVyJywKICAgICAgICAgICAgc2l6ZTogJ2wnLAogICAgICAgICAgICByZXNvbHZlOiB7CiAgICAgICAgICAgICAgICBldmVudFR5cGVQcm9wZXJ0aWVzOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXZlbnRUeXBlUHJvcGVydGllczsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBtb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHNlbGVjdGVkSXRlbSkgewogICAgICAgICAgICBsb2dEZWJ1ZyhzZWxlY3RlZEl0ZW0pOwogICAgICAgICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzID0gc2VsZWN0ZWRJdGVtOwogICAgICAgIH0sIGZ1bmN0aW9uKCkgewogICAgICAgICAgICBsb2dEZWJ1ZygnTW9kYWwgZGlzbWlzc2VkIGF0OiAnICsgbmV3IERhdGUoKSk7CiAgICAgICAgfSk7CiAgICB9Owp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ3NjaGVkdWxlckNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkcm91dGVQYXJhbXMpIHsKICAgIGV2ZW50X3R5cGVfaWQ9JHJvdXRlUGFyYW1zLmV2ZW50X3R5cGVfaWQ7CgogICAgJHNjb3BlLnN1Z2dlc3Rpb25EYXRlID0gW107CiAgICAkc2NvcGUuc3VnZ2VzdGlvbkRhdGUuZGF0ZSA9IG5ldyBEYXRlKCk7CiAgICAkc2NvcGUuc3VnZ2VzdGlvbkRhdGUub3B0aW9ucyA9IHsKICAgICAgICAgICAgLy8gbWluRGF0ZTogbmV3IERhdGUoKSwKICAgICAgICAgICAgLy8gc2hvd1dlZWtzOiB0cnVlLAogICAgICAgICAgICBtaW5WaWV3OidkYXknLAogICAgICAgICAgICBzdGFydFZpZXc6ICdkYXknCgogICAgICAgICAgfTsKICAgIHZhciB0aGV0aW1lID0gbmV3IERhdGUoKTsKICAgICRzY29wZS5maWx0ZXJBbGxEYXlzQ2hlY2tib3g9dHJ1ZTsKICAgICRzY29wZS5maWx0ZXJEYXlJdGVtcyA9IHsKCiAgICAgICfXqNeQ16nXldefJzogdHJ1ZSwKICAgICAgJ9ep16DXmSc6IHRydWUsCiAgICAgICfXqdec15nXqdeZJzogdHJ1ZSwKICAgICAgJ9eo15HXmdei15knOiB0cnVlLAogICAgICAn15fXnteZ16nXmSc6IHRydWUsCiAgICAgICfXqdeZ16nXmSc6IHRydWUsCiAgICAgICfXqdeR16onOiB0cnVlCiAgICB9OwoKICAgICRzY29wZS5vblRpbWVTZXQgPSBmdW5jdGlvbiAobmV3RGF0ZSwgb2xkRGF0ZSkgewogICAgICAgIGxvZ0RlYnVnKCJuZXcgZGF0ZSAiK25ld0RhdGUuZ2V0VGltZSgpICsgIiBvbGQgZGF0ZSAiK29sZERhdGUuZ2V0VGltZSgpKTsKICAgICAgICBkaWZmPW5ld0RhdGUuZ2V0VGltZSgpLW9sZERhdGUuZ2V0VGltZSgpOwogICAgICAgIC8vIGlmIG5ldyBkYXRlIGlzIGluIGEgZGlmZmVyZW50IHdlZWsKICAgICAgICAvLyB3ZSByZWZldGNoIHN1Z2dlc3Rpb25zIGZvciB0aGUgY3VycmVudCB3ZWVrCiAgICAgICAgdmFyIG5ld0RhdGVXID0gbmV3IERhdGUobmV3RGF0ZSk7CiAgICAgICAgdmFyIG9sZERhdGVXID0gbmV3IERhdGUob2xkRGF0ZSk7CiAgICAgICAgLy8gYWxlcnQobmV3RGF0ZVcuZm9ybWF0KCdXJykpOwogICAgICAgIC8vIGFsZXJ0KG9sZERhdGVXLmZvcm1hdCgnVycpKTsKICAgICAgICBpZiAobmV3RGF0ZVcuZm9ybWF0KCdXJykhPW9sZERhdGVXLmZvcm1hdCgnVycpKQogICAgICAgIHsKICAgICAgICAgIGxvZ0RlYnVnKCJkaWZmIGlzIGEgd2VlayBvciBtb3JlLCByZWZldGNoaW5nIHN1Z2dlc3Rpb25zIik7CiAgICAgICAgICAkaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3QvIitldmVudF90eXBlX2lkKyIvIituZXdEYXRlLmdldEZ1bGxZZWFyKCkrIi8iKyhuZXdEYXRlLmdldE1vbnRoKCkrMSkrIi8iK25ld0RhdGUuZ2V0RGF0ZSgpKyIvIituZXdEYXRlLmdldEhvdXJzKCkgKyAiLyIgKyBuZXdEYXRlLmdldE1pbnV0ZXMoKSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkgewogICAgICAgICAgICAgIC8vCSAgICAkc2NvcGUubXlEYXRhID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgICAgICAvLwkJbG9nRGVidWcoImdyaWRvcHRpb25zPSIrJHNjb3BlLmdyaWRPcHRpb25zKTsKICAgICAgICAgICAgICAkc2NvcGUuZXZlbnRzU3VnZ2VzdGVkID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgIH0pOwoKICAgICAgICB9CiAgICB9CgogICAgJHNjb3BlLm9wdGlvbnMgPSB7CiAgICAgICBjdXN0b21DbGFzczogZ2V0RGF5Q2xhc3MsCiAgICAgICBtaW5EYXRlOiBuZXcgRGF0ZSgpLAogICAgICAgc2hvd1dlZWtzOiB0cnVlCiAgICAgfTsKICAgICAkc2NvcGUuZHQgPSBuZXcgRGF0ZSgpOwoKCiAgICAgZnVuY3Rpb24gZ2V0RGF5Q2xhc3MoZGF0YSkgewogICAgICAgICByZXR1cm4gJyc7CiAgICAgICB9CgogICAgJHNjb3BlLmRheXNJdGVtcyA9IFsKICAgICAge25hbWU6J9eo15DXqdeV158nfSwKICAgICAge25hbWU6J9ep16DXmSd9LAogICAgICB7bmFtZTon16nXnNeZ16nXmSd9LAogICAgICB7bmFtZTon16jXkdeZ16LXmSd9LAogICAgICB7bmFtZTon15fXnteZ16nXmSd9LAogICAgICB7bmFtZTon16nXmdep15knfSwKICAgICAge25hbWU6J9ep15HXqid9CiAgICBdOwoKICAgICRzY29wZS5maWx0ZXJBbGxEYXlJdGVtc1NldCA9IGZ1bmN0aW9uICgpCiAgICB7CiAgICAgICRzY29wZS5maWx0ZXJEYXlJdGVtc1sn16jXkNep15XXnyddPSRzY29wZS5maWx0ZXJBbGxEYXlzQ2hlY2tib3g7CiAgICAgICRzY29wZS5maWx0ZXJEYXlJdGVtc1sn16nXoNeZJ109JHNjb3BlLmZpbHRlckFsbERheXNDaGVja2JveDsKICAgICAgJHNjb3BlLmZpbHRlckRheUl0ZW1zWyfXqdec15nXqdeZJ109JHNjb3BlLmZpbHRlckFsbERheXNDaGVja2JveDsKICAgICAgJHNjb3BlLmZpbHRlckRheUl0ZW1zWyfXqNeR15nXoteZJ109JHNjb3BlLmZpbHRlckFsbERheXNDaGVja2JveDsKICAgICAgJHNjb3BlLmZpbHRlckRheUl0ZW1zWyfXl9ee15nXqdeZJ109JHNjb3BlLmZpbHRlckFsbERheXNDaGVja2JveDsKICAgICAgJHNjb3BlLmZpbHRlckRheUl0ZW1zWyfXqdeZ16nXmSddPSRzY29wZS5maWx0ZXJBbGxEYXlzQ2hlY2tib3g7CiAgICAgICRzY29wZS5maWx0ZXJEYXlJdGVtc1sn16nXkdeqJ109JHNjb3BlLmZpbHRlckFsbERheXNDaGVja2JveDsKICAgIH0KCiAgICAkc2NvcGUuc3VnZ2VzdEZpbHRlckRheXMgPSBmdW5jdGlvbiAoZXN1Z2dlc3QpCiAgICB7CiAgICAgIC8vIGxvZ0RlYnVnKGVzdWdnZXN0KTsKICAgICAgaWYgKCgkc2NvcGUuZmlsdGVyRGF5SXRlbXNbZXN1Z2dlc3Quc3RhcnRfZm9ybWF0X2Rvd10pICYgKCgkc2NvcGUuc3VnZ2VzdGlvbkRhdGUuZGF0ZS5nZXRUaW1lKCkvMTAwMCk8ZXN1Z2dlc3Quc3RhcnRfZXBvY2gpKQogICAgICB7CiAgICAgICAgcmV0dXJuIGVzdWdnZXN0OwogICAgICB9CiAgICB9OwoKICAgIGxvZ0RlYnVnKCdzY2hlZHVsZXJDb250cm9sbGVyIGZvciBldmVudCB0eXBlIGlkICcrZXZlbnRfdHlwZV9pZCsiICIrdGhldGltZS5nZXRIb3VycygpICsgIjoiICsgdGhldGltZS5nZXRNaW51dGVzKCkgKyAiOiIgKyB0aGV0aW1lLmdldFNlY29uZHMoKSk7CiAgICAkaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3QvIitldmVudF90eXBlX2lkKyIvIit0aGV0aW1lLmdldEZ1bGxZZWFyKCkrIi8iKyh0aGV0aW1lLmdldE1vbnRoKCkrMSkrIi8iK3RoZXRpbWUuZ2V0RGF0ZSgpKyIvIit0aGV0aW1lLmdldEhvdXJzKCkgKyAiLyIgKyB0aGV0aW1lLmdldE1pbnV0ZXMoKSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkgewogICAgICAgIC8vCSAgICAkc2NvcGUubXlEYXRhID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAvLwkJbG9nRGVidWcoImdyaWRvcHRpb25zPSIrJHNjb3BlLmdyaWRPcHRpb25zKTsKICAgICAgICAkc2NvcGUuZXZlbnRzU3VnZ2VzdGVkID0gcmVzcG9uc2UuZGF0YTsKICAgIH0pOwoKICAgICRodHRwLmdldCgkZ0FwaVVSTFByZWZpeCArICIvZW5kdXNlci9ldmVudF90eXBlcy8iK2V2ZW50X3R5cGVfaWQpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHsKICAgICAgICAvLwkgICAgJHNjb3BlLm15RGF0YSA9IHJlc3BvbnNlLmRhdGE7CiAgICAgICAgLy8JCWxvZ0RlYnVnKCJncmlkb3B0aW9ucz0iKyRzY29wZS5ncmlkT3B0aW9ucyk7CiAgICAgICAgJHNjb3BlLmV2ZW50VHlwZURldGFpbHMgPSByZXNwb25zZS5kYXRhOwogICAgfSk7Cn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdjb250YWN0Q29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHApIHsKICAgIGxvZ0RlYnVnKCdjb250YWN0Q29udHJvbGxlcicpOwp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ3BhY2thZ2VQYXltZW50QXNzb2NpYXRpb25Nb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRyb3V0ZVBhcmFtcywgJHJvb3RTY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRodHRwLCBmcGFja2FnZSwgYmFsYW5jZSwgYnVzaW5lc3NfdXNlcl9pZCwgdWlDYWxlbmRhckNvbmZpZykKewogIGxvZ0RlYnVnKCJwYWNrYWdlUGF5bWVudEFzc29jaWF0aW9uTW9kYWxDb250cm9sbGVyIik7CgogICRzY29wZS5mcGFja2FnZT1mcGFja2FnZTsKICAkc2NvcGUuYmFsYW5jZT1iYWxhbmNlOwogICRzY29wZS5wYWNrYWdlX3BheW1lbnRzPSRzY29wZS5mcGFja2FnZS5wYWNrYWdlX3BheW1lbnRzOwogICRzY29wZS5wcmV2aW91c19pc19hbGxfcGFpZD0kc2NvcGUuZnBhY2thZ2UuaXNfYWxsX3BhaWQ7CiAgJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQ9YnVzaW5lc3NfdXNlcl9pZDsKCiAgLy8gJ2NhbGN1bGF0aW5nJyBwcmV2aW91cyBzdGF0dXMgb2YgcGF5bWVudAogIGlmICgkc2NvcGUucGFja2FnZV9wYXltZW50cz4wKQogIHsKICAgIGlmICgkc2NvcGUucHJldmlvdXNfaXNfYWxsX3BhaWQ9PTEpCiAgICB7CiAgICAgICRzY29wZS5wcmV2aW91c19zdGF0dXM9ImlzX2FsbF9wYWlkIjsKICAgICAgJHNjb3BlLnBhY2thZ2Vfc3RhdHVzX2lkPS0xOwogICAgICAkc2NvcGUucHJldmlvdXNfcGFja2FnZV9zdGF0dXNfaWQ9LTE7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICRzY29wZS5wcmV2aW91c19zdGF0dXM9ImlzX3BhcnRseV9wYWlkIjsKICAgICAgJHNjb3BlLnBhY2thZ2Vfc3RhdHVzX2lkPS0xOwogICAgICAkc2NvcGUucHJldmlvdXNfcGFja2FnZV9zdGF0dXNfaWQ9LTE7CiAgICB9CiAgfQogIGVsc2UKICB7CiAgICAgICRzY29wZS5wcmV2aW91c19zdGF0dXM9Im5vdF9wYWlkIjsKICAgICAgJHNjb3BlLnBhY2thZ2Vfc3RhdHVzX2lkPTA7CiAgICAgICRzY29wZS5wcmV2aW91c19wYWNrYWdlX3N0YXR1c19pZD0wOwoKICB9CiAgbG9nRGVidWcoInByZXZpb3VzX3N0YXR1cz0iKyRzY29wZS5wcmV2aW91c19zdGF0dXMpOwoKICAkc2NvcGUuY2xvc2VNb2RhbCA9IGZ1bmN0aW9uKCkKICB7CiAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICB9OwogICRzY29wZS51cGRhdGVQYWNrYWdlUGF5bWVudCA9IGZ1bmN0aW9uKCkKICB7CiAgICAvLyBjb25zb2xlLmxvZygicHJldmlvdXNfcGFja2FnZV91c2VyX2lkPSIrJHNjb3BlLmZtZWV0aW5nLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZCk7CiAgICAvLyBjb25zb2xlLmxvZygicGFja2FnZV91c2VyX2lkPSIrJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZCk7CiAgICBsb2dEZWJ1ZygidXBkYXRlUGFja2FnZVBheW1lbnQiKQogICAgLy8gaWYgc2VsZWN0ZWQgcGFja2FnZSBpcyBsaWtlIHByZXZpb3VzIHBhY2thZ2UgLSBkbyBub3RoaW5nCiAgICBpZiAoKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3N0YXR1c19pZD09JHNjb3BlLnBhY2thZ2Vfc3RhdHVzX2lkKSkKICAgIHsKICAgICAgbG9nRGVidWcoInNlbGVjdGVkIG9wdGlvbiBpcyBsaWtlIHByZXZpb3VzIG9wdGlvbiAtIGRvIG5vdGhpbmciKTsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgfQoKICAgIC8vIHByZXZpb3VzIHBhY2thZ2Ugd2FzIHBhaWQvcGFydGx5LXBhaWQgLSBub3cgbm90aGluZ3MgaXMgc2VsZWN0ZWQKICAgIGVsc2UgaWYgKCgkc2NvcGUucHJldmlvdXNfcGFja2FnZV9zdGF0dXNfaWQ9PS0xKSAmJiAoJHNjb3BlLnBhY2thZ2Vfc3RhdHVzX2lkPT0wKSkKICAgIHsKICAgICAgbG9nRGVidWcoIndhcyBwYWlkL3BhcnRseSBwYWlkLCByZW1vdmluZyBwYXltZW50Iik7CiAgICAgIHJlbW92ZVBhY2thZ2VQYXltZW50KCRodHRwLCRzY29wZSwkc2NvcGUuZnBhY2thZ2UucGFja2FnZV91c2VyX2lkLCRzY29wZS5idXNpbmVzc191c2VyX2lkLHVwZGF0ZUV2ZW50UGFja2FnZV9zdWNjZXNzKTsKICAgIH0KICAgIC8vIHByZXZpb3VzIHBhY2thZ2Ugd2FzIHNlbGVjdGVkIC0gbm93IGEgZGlmZmVyZW50IHBhY2thZ2UgaXMgc2VsZWN0ZWQKICAgIGVsc2UgaWYgKCgkc2NvcGUucHJldmlvdXNfcGFja2FnZV9zdGF0dXNfaWQ9PTApICYmICgkc2NvcGUucGFja2FnZV9zdGF0dXNfaWQ9PS0xKSkKICAgIHsKICAgICAgbG9nRGVidWcoIndhcyBub3QgcGFpZCAtIG5vdyBwYXkgZnVsbHkvcGFydGlhbGx5Iik7CiAgICAgIHBheUZvclBhY2thZ2UoJGh0dHAsJHNjb3BlLCRzY29wZS5mcGFja2FnZS5wYWNrYWdlX3VzZXJfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwoKICAgICAgLy8gcmVhc3NpZ25FdmVudFBhY2thZ2VBc3NvY2lhdGlvbigkaHR0cCwkc2NvcGUsJHNjb3BlLmZtZWV0aW5nLmV2ZW50X2lkLCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MoKQogIHsKICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICAgIGxvZ0RlYnVnKCJicm9hZGNhc3RpbmcgY2xpZW50UGFnZVJlbG9hZERhdGEiKTsKICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKICB9Cgp9KTsKCmt1emVBcHAuY29udHJvbGxlcignZXZlbnRQYWNrYWdlQXNzb2NpYXRpb25Nb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRyb3V0ZVBhcmFtcywgJHJvb3RTY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRodHRwLCBmbWVldGluZywgYmFsYW5jZSwgYnVzaW5lc3NfdXNlcl9pZCwgdWlDYWxlbmRhckNvbmZpZykKewogICRzY29wZS5mbWVldGluZz1hbmd1bGFyLmNvcHkoZm1lZXRpbmcpOwogICRzY29wZS5iYWxhbmNlPWJhbGFuY2U7CiAgJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD0kc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkOwogICRzY29wZS5wcmV2aW91c19ldmVudF9wYXltZW50cz0kc2NvcGUuZm1lZXRpbmcuZXZlbnRfcGF5bWVudHM7CiAgJHNjb3BlLnByZXZpb3VzX2lzX2FsbF9wYWlkPSRzY29wZS5mbWVldGluZy5pc19hbGxfcGFpZDsKICAkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZD1idXNpbmVzc191c2VyX2lkOwoKICAvLyAnY2FsY3VsYXRpbmcnIHByZXZpb3VzIHN0YXR1cyBvZiBwYXltZW50CiAgaWYgKCRzY29wZS5wcmV2aW91c19ldmVudF9wYXltZW50cz4wKQogIHsKICAgIGlmICgkc2NvcGUucHJldmlvdXNfaXNfYWxsX3BhaWQ9PTEpCiAgICB7CiAgICAgICRzY29wZS5wcmV2aW91c19zdGF0dXM9ImlzX2FsbF9wYWlkIjsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgJHNjb3BlLnByZXZpb3VzX3N0YXR1cz0iaXNfcGFydGx5X3BhaWQiOwogICAgfQogIH0KICBlbHNlCiAgewogICAgICBpZiAoJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD4wKQogICAgICB7CiAgICAgICAgJHNjb3BlLnByZXZpb3VzX3N0YXR1cz0iaXNfcGFja2FnZV9wYWlkIjsKICAgICAgfQogICAgICBlbHNlCiAgICAgIHsKICAgICAgICAkc2NvcGUucHJldmlvdXNfc3RhdHVzPSJub3RfcGFpZCI7CiAgICAgIH0KICB9CiAgbG9nRGVidWcoInByZXZpb3VzX3N0YXR1cz0iKyRzY29wZS5wcmV2aW91c19zdGF0dXMpOwoKICBpZiAoKCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQ9PTApICYmICgkc2NvcGUuZm1lZXRpbmcuZXZlbnRfcGF5bWVudHM+MCkpCiAgewogICAgLy8gdGhpcyBpcyBhIGNhc2Ugd2hlcmUgcGF5bWVudCB3YXMgcGFydGx5IG9yIGZ1bGx5IG1hZGUgZnJvbSBiYWxhbmNlCiAgICAkc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkPS0xOwogICAgJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD0tMTsKICB9CgogIGxvZ0RlYnVnKCJldmVudFBhY2thZ2VBc3NvY2lhdGlvbk1vZGFsQ29udHJvbGxlciIpOwogIGdldFBhY2thZ2VzRm9yRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5idXNpbmVzc191c2VyX2lkLCRzY29wZS5mbWVldGluZy5ldmVudF9pZCwncmVsYXRlZFBhY2thZ2VzJyxnZXRQYWNrYWdlc0ZvckV2ZW50X3N1Y2Nlc3MpOyAvLyB3YXMgZ2V0QnVzaW5lc3NQYWNrYWdlCiAgZnVuY3Rpb24gZ2V0UGFja2FnZXNGb3JFdmVudF9zdWNjZXNzKCkKICB7CiAgfQoKICAkc2NvcGUuY2xvc2VNb2RhbCA9IGZ1bmN0aW9uKCkKICB7CiAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICB9OwogICRzY29wZS51cGRhdGVFdmVudFBhY2thZ2UgPSBmdW5jdGlvbigpCiAgewogICAgY29uc29sZS5sb2coInByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD0iKyRzY29wZS5mbWVldGluZy5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQpOwogICAgY29uc29sZS5sb2coInBhY2thZ2VfdXNlcl9pZD0iKyRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQpOwogICAgLy8gaWYgc2VsZWN0ZWQgcGFja2FnZSBpcyBsaWtlIHByZXZpb3VzIHBhY2thZ2UgLSBkbyBub3RoaW5nCiAgICBpZiAoKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ9PSRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQpKQogICAgewogICAgICBsb2dEZWJ1Zygic2VsZWN0ZWQgb3B0aW9uIGlzIGxpa2UgcHJldmlvdXMgb3B0aW9uIC0gZG8gbm90aGluZyIpOwogICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgICB9CiAgICAvLyBpZiBzZWxlY3RlZCBwYWNrYWdlIGlzIGxpa2UgcHJldmlvdXMgcGFja2FnZSAtIGRvIG5vdGhpbmcKICAgIGlmICgoJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD09JHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZCkgJiYgKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ+MCkpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJzZWxlY3RlZCBwYWNrYWdlIGlzIGxpa2UgcHJldmlvdXMgcGFja2FnZSAtIGRvIG5vdGhpbmciKTsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgfQogICAgLy8gcHJldmlvdXMgcGFja2FnZSB3YXMgc2VsZWN0IC0gbm93IG5vdGhpbmdzIGlzIHNlbGVjdGVkCiAgICBlbHNlIGlmICgoJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD4wKSAmJiAoJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZD09MCkpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJubyBwYWNrYWdlIHNlbGVjdGVkLCByZW1vdmUgcGFja2FnZS1ldmVudCBhc3NvY2lhdGlvbiIpOwogICAgICByZW1vdmVFdmVudFBhY2thZ2VBc3NvY2lhdGlvbigkaHR0cCwkc2NvcGUsJHNjb3BlLmZtZWV0aW5nLmV2ZW50X2lkLCRzY29wZS5idXNpbmVzc191c2VyX2lkLHVwZGF0ZUV2ZW50UGFja2FnZV9zdWNjZXNzKTsKICAgIH0KICAgIC8vIHByZXZpb3VzIHBhY2thZ2Ugd2FzIHNlbGVjdGVkIC0gbm93IGEgZGlmZmVyZW50IHBhY2thZ2UgaXMgc2VsZWN0ZWQKICAgIGVsc2UgaWYgKCgkc2NvcGUucHJldmlvdXNfcGFja2FnZV91c2VyX2lkPjApICYmICgkc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkPjApKQogICAgewogICAgICBsb2dEZWJ1ZygidXBkYXRpbmcgbmV3IHBhY2thZ2UgdG8gcGFja2FnZV91c2VyX2lkPSAiKyRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQpOwogICAgICByZWFzc2lnbkV2ZW50UGFja2FnZUFzc29jaWF0aW9uKCRodHRwLCRzY29wZSwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZCwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCx1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2Vzcyk7CiAgICB9CiAgICAvLyBwcmV2aW91cyBwYWNrYWdlIHdhcyBub25lIC0gbm93IGEgcGFja2FnZSBpcyBzZWxlY3RlZAogICAgZWxzZSBpZiAoKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ9PTApICYmICgkc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkPjApKQogICAgewogICAgICBsb2dEZWJ1ZygidXBkYXRpbmcgbmV3IHBhY2thZ2UgdG8gcGFja2FnZV91c2VyX2lkPSAiKyRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQpOwogICAgICByZWFzc2lnbkV2ZW50UGFja2FnZUFzc29jaWF0aW9uKCRodHRwLCRzY29wZSwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZCwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCx1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2Vzcyk7CiAgICB9CiAgICAvLyBwcmV2aW91cyBhc3NvY2lhdGlvbiB3YXMgcGFpZCBvciBoYWxmIHBhaWQgLSBub3cgaXRzIG5vbmUKICAgIGVsc2UgaWYgKCgkc2NvcGUucHJldmlvdXNfZXZlbnRfcGF5bWVudHM+MCkgJiYgKCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQ9PTApKQogICAgewogICAgICBsb2dEZWJ1ZygicmVtb3ZpbmcgcGF5bWVudCBmcm9tIGV2ZW50LCBwYWNrYWdlX3VzZXJfaWQ9ICIrJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZCk7CiAgICAgIHJlbW92ZUV2ZW50UGF5bWVudEFzc29jaWF0aW9uKCRodHRwLCRzY29wZSwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwoKICAgICAgLy8gcmVhc3NpZ25FdmVudFBhY2thZ2VBc3NvY2lhdGlvbigkaHR0cCwkc2NvcGUsJHNjb3BlLmZtZWV0aW5nLmV2ZW50X2lkLCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwogICAgICAvLyB0b2RvCiAgICB9CiAgICAvLyB3YXMgcGFja2FnZSBwYXltZW50IC0+IG5vdyBiYWxhbmNlIHBheW1lbnQKICAgIGVsc2UgaWYgKCgkc2NvcGUucHJldmlvdXNfcGFja2FnZV91c2VyX2lkPjApICYmICgkc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkPT0tMSkpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJtb3ZpbmcgcGF5bWVudCBmcm9tIHBhY2thZ2UgdG8gYmFsYW5jZSIpOwogICAgICBhZGRFdmVudFBheW1lbnRSZW1vdmVQYWNrYWdlKCRodHRwLCRzY29wZSwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwogICAgfQogICAgLy8gd2FzIGJhbGFuY2UgcGF5bWVudCAtPiBub3cgcGFja2FnZSBwYXltZW50CiAgICBlbHNlIGlmICgoJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD09LTEpICYmICgkc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkPjApKQogICAgewogICAgICBsb2dEZWJ1ZygibW92aW5nIHBheW1lbnQgZnJvbSBiYWxhbmNlIHRvIHBhY2thZ2UiKTsKICAgICAgYWRkRXZlbnRQYWNrYWdlUmVtb3ZlUGF5bWVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLmZtZWV0aW5nLmV2ZW50X2lkLCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwoKICAgIH0KICAgIC8vIHdhcyBub3QgcGFpZCBhdCBhbGwgLT4gbm93IGJhbGFuY2UgcGF5CiAgICBlbHNlIGlmICgoJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD09MCkgJiYgKCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQ9PS0xKSkKICAgIHsKICAgICAgbG9nRGVidWcoIm1vdmluZyBwYXltZW50IGZyb20gbm9uZSB0byBiYWxhbmNlIik7CiAgICAgIGFkZEV2ZW50UGF5bWVudEFzc29jaWF0aW9uKCRodHRwLCRzY29wZSwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MoKQogIHsKICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICAgIGxvZ0RlYnVnKCJicm9hZGNhc3RpbmcgY2xpZW50UGFnZVJlbG9hZERhdGEiKTsKICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKICB9Cgp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ2FyY2hpdmVfY2xpZW50X21vZGFsJywgZnVuY3Rpb24oJHNjb3BlLCAkbG9jYXRpb24sIGlzX2luc3RydWN0b3IsIGJ1c2luZXNzX3VzZXJfaWQsIGJ1c2VyX2ZpcnN0X25hbWUsIGJ1c2VyX2xhc3RfbmFtZSwgJHJvb3RTY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRodHRwLCB1aUNhbGVuZGFyQ29uZmlnKSB7CiAgJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQ9YnVzaW5lc3NfdXNlcl9pZDsKICAkc2NvcGUuYnVzZXJfZmlyc3RfbmFtZT1idXNlcl9maXJzdF9uYW1lOwogICRzY29wZS5idXNlcl9sYXN0X25hbWU9YnVzZXJfbGFzdF9uYW1lOwogICRzY29wZS5pc19pbnN0cnVjdG9yPWlzX2luc3RydWN0b3I7CgogIGxvZ0RlYnVnKCJhcmNoaXZlX2NsaWVudF9tb2RhbCBjb250cm9sbGVyIik7CgogICRzY29wZS5jbG9zZU1vZGFsID0gZnVuY3Rpb24oKSB7CiAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICB9OwoKICAkc2NvcGUuYXJjaGl2ZUNsaWVudCA9IGZ1bmN0aW9uKCkKICB7CiAgICBhcmNoaXZlQ2xpZW50KCRodHRwLCRzY29wZSwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCxhcmNoaXZlQ2xpZW50X3N1Y2Nlc3MpOwogICAgZnVuY3Rpb24gYXJjaGl2ZUNsaWVudF9zdWNjZXNzKCkKICAgIHsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgICBpZiAoJHNjb3BlLmlzX2luc3RydWN0b3IpCiAgICAgIHsKICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2luc3RydWN0b3JzJyk7CiAgICAgIH0KICAgICAgZWxzZSB7CiAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jbGllbnRzJyk7CiAgICAgIH0KICAgIH0KICB9Cgp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ3BheW1lbnlEZXRhaWxzTW9kYWxDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkcm91dGVQYXJhbXMsICRyb290U2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgZnBheW1lbnQsIHVpQ2FsZW5kYXJDb25maWcpIHsKICAkc2NvcGUuZnBheW1lbnQ9e307CiAgJHNjb3BlLmZwYXltZW50LnBheW1lbnRfZGF0ZT1mcGF5bWVudC5wYXltZW50X2RhdGU7CiAgJHNjb3BlLmZwYXltZW50LnBheW1lbnRfYW1vdW50PWZwYXltZW50LnBheW1lbnRfYW1vdW50OwogICRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2dlbmVyYXRlZD1mcGF5bWVudC5pbnZvaWNlX2dlbmVyYXRlZDsKICAkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9udW1iZXI9ZnBheW1lbnQuaW52b2ljZV9udW1iZXI7CiAgaWYgKGZwYXltZW50Lmludm9pY2VfZGF0ZT09bnVsbCkKICB7CiAgICAkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlX2Zvcm1hdD1uZXcgRGF0ZSgpOwogIH0KICBlbHNlCiAgewogICAgJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZV9mb3JtYXQ9ZnBheW1lbnQuaW52b2ljZV9kYXRlX2Zvcm1hdDsKICB9CiAgJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZT1mcGF5bWVudC5pbnZvaWNlX2RhdGU7CiAgJHNjb3BlLnNlbGVjdGVkUGF5bWVudE1ldGhvZD17CgkJbmFtZTogZnBheW1lbnQucGF5bWVudF9tZXRob2RfbmFtZV90eHQsCgkJbWV0aG9kOiBmcGF5bWVudC5wYXltZW50X21ldGhvZF9uYW1lCgl9OwogICRzY29wZS5pc1BheW1lbnRNZXRob2RTZWxlY3RlZD10cnVlOwoKICBsb2dEZWJ1Zygib2xkIGRhdGUgIiskc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlKTsKICBpZiAoJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZSE9bnVsbCkKICB7CiAgICAkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlX2Zvcm1hdCA9IG5ldyBEYXRlKCRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2RhdGUpOwogIH0KICAkc2NvcGUucGF5bWVudE1ldGhvZHMgPSBwYXltZW50TWV0aG9kczsKICAkc2NvcGUucGF5bWVudFR5cGVUaXRsZT1mcGF5bWVudC5wYXltZW50X21ldGhvZF9uYW1lX3R4dDsKICAkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9zb3VyY2U9IkVYVEVSTkFMIjsKCiAgbG9nRGVidWcoJHNjb3BlLnBheW1lbnRNZXRob2RzKTsKICBsb2dEZWJ1ZygicGF5bWVueURldGFpbHNNb2RhbENvbnRyb2xsZXIgZm9yIHBheW1lbnQgIitKU09OLnN0cmluZ2lmeShmcGF5bWVudCwgbnVsbCwgNCkpOwoKICAkc2NvcGUuc2VsZWN0UGF5bWVudE1ldGhvZCA9IGZ1bmN0aW9uKHBheW1lbnQpIHsKICAgICRzY29wZS5wYXltZW50VHlwZVRpdGxlPXBheW1lbnQubmFtZTsKICAgIGxvZ0RlYnVnKCJwYXltZW50PSIrcGF5bWVudCk7CgogICAgJHNjb3BlLnNlbGVjdGVkUGF5bWVudE1ldGhvZD1wYXltZW50OwogICAgJHNjb3BlLmlzUGF5bWVudE1ldGhvZFNlbGVjdGVkPXRydWU7CiAgfTsKCiAgJHNjb3BlLmNsb3NlTW9kYWwgPSBmdW5jdGlvbigpIHsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogIH07CgogICRzY29wZS51cGRhdGVQYXltZW50ID0gZnVuY3Rpb24oKQogIHsKICAgIC8vIGxvZ0RlYnVnKGN1cnJlbnRDbGllbnQpOwogICAgbG9nRGVidWcoInBheW1lbnQgbWV0aG9kIik7CiAgICBsb2dEZWJ1Zygkc2NvcGUuc2VsZWN0ZWRQYXltZW50TWV0aG9kKTsKICAgIGxvZ0RlYnVnKCIkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9nZW5lcmF0ZWQ9PCIrJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZ2VuZXJhdGVkKyI+LCAkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlX2Zvcm1hdD0iKyRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2RhdGVfZm9ybWF0KTsKICAgIGxvZ0RlYnVnKCIkc2NvcGUuc2VsZWN0ZWRQYXltZW50TWV0aG9kLm1ldGhvZD0iKyRzY29wZS5zZWxlY3RlZFBheW1lbnRNZXRob2QubWV0aG9kKTsKICAgIGlmICgoJHNjb3BlLmZwYXltZW50LnBheW1lbnRfYW1vdW50PT0wKSB8fCAoJHNjb3BlLmZwYXltZW50LnBheW1lbnRfYW1vdW50PT0nJykgfHwgKCRzY29wZS5mcGF5bWVudC5wYXltZW50X2Ftb3VudD09bnVsbCkpCiAgICB7CiAgICAgICRzY29wZS51c2VyRXJyb3I9IteQ16DXkCDXlNeW158g16HXm9eV150g15vXnNep15TXlSI7CiAgICAgIC8vIGFsZXJ0KCdzcycpOwogICAgfQogICAgZWxzZSBpZiAoISRzY29wZS5pc1BheW1lbnRNZXRob2RTZWxlY3RlZCkKICAgIHsKICAgICAgJHNjb3BlLnVzZXJFcnJvcj0i15DXoNeQINeR15fXqCDXkNee16bXoteZINeq16nXnNeV150iOwogICAgICAvLyBhbGVydCgnc3MnKTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgaWYgKCgkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9nZW5lcmF0ZWQhPTEpIHx8ICgkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlX2Zvcm1hdD09bnVsbCkpCiAgICAgIHsKICAgICAgICB2YXIgaW52b2ljZV9kYXRlX2Zvcm1hdCA9ICJudWxsIjsKICAgICAgfQogICAgICBlbHNlCiAgICAgIHsKICAgICAgICB2YXIgaW52b2ljZV9kYXRlX2Zvcm1hdCA9ICRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2RhdGVfZm9ybWF0LmdldERhdGUoKSAgKyAiLSIgKyAoJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZV9mb3JtYXQuZ2V0TW9udGgoKSsxKSArICItIiArICRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2RhdGVfZm9ybWF0LmdldEZ1bGxZZWFyKCk7CiAgICAgIH0KICAgICAgdGhlZGF0YT0gewogICAgICAgICAgYmFsYW5jZVRvUGF5OiAkc2NvcGUuZnBheW1lbnQucGF5bWVudF9hbW91bnQsCiAgICAgICAgICBwYXltZW50X21ldGhvZF9uYW1lOiAkc2NvcGUuc2VsZWN0ZWRQYXltZW50TWV0aG9kLm1ldGhvZCwKICAgICAgICAgIGludm9pY2VfbnVtYmVyOiAkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9udW1iZXIsCiAgICAgICAgICBpbnZvaWNlX2dlbmVyYXRlZDogJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZ2VuZXJhdGVkLAogICAgICAgICAgaW52b2ljZV9kYXRlOiBpbnZvaWNlX2RhdGVfZm9ybWF0LAogICAgICAgICAgaW52b2ljZV9zb3VyY2U6ICRzY29wZS5mcGF5bWVudC5pbnZvaWNlX3NvdXJjZQogICAgICB9OwogICAgICB1cGRhdGVQYXltZW50Rm9yQ2xpZW50KCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCxmcGF5bWVudC51c2VyX3BheW1lbnRfaWQsdGhlZGF0YSxjcmVhdGVQYXltZW50Rm9yQ2xpZW50X2NhbGxiYWNrLCBjcmVhdGVQYXltZW50Rm9yQ2xpZW50X2ZhaWx1cmUpOwogICAgICBmdW5jdGlvbiBjcmVhdGVQYXltZW50Rm9yQ2xpZW50X2NhbGxiYWNrKCkKICAgICAgewogICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICAgICAgICBsb2dEZWJ1ZygiYnJvYWRjYXN0aW5nIGNsaWVudFBhZ2VSZWxvYWREYXRhIik7CiAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGNyZWF0ZVBheW1lbnRGb3JDbGllbnRfZmFpbHVyZSgpCiAgICAgIHsKICAgICAgICBsb2dEZWJ1ZygiYnJvYWRjYXN0aW5nIGNsaWVudFBhZ2VSZWxvYWREYXRhIik7CiAgICAgICAgLy8gJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgICB9CiAgICB9CiB9Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignZXZlbnRUeXBlRXh0cmFGaWVsZHNNb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRyb290U2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgZXZlbnRUeXBlUHJvcGVydGllcywgdWlDYWxlbmRhckNvbmZpZykgewogICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzPWV2ZW50VHlwZVByb3BlcnRpZXM7CiAgbG9nRGVidWcoImV2ZW50VHlwZVByb3BlcnRpZXM9IitKU09OLnN0cmluZ2lmeShldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzLCBudWxsLCA0KSk7CiAgaWYgKGV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHM9PW51bGwpCiAgewogICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXNPcmlnPVtdOwogICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHM9W107CiAgfQogIGVsc2UgaWYgKGV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMubGVuZ3RoPjApCiAgewogICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXNPcmlnPShldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzKS5zbGljZSgwKTsKICB9CiAgZWxzZQogIHsKICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzT3JpZz1bXTsKICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzPVtdOwogIH0KICAkc2NvcGUub2tMaW1pdGF0aW9uTW9kYWwgPSBmdW5jdGlvbigpIHsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogIH07CgogICRzY29wZS5jYW5jZWwgPSBmdW5jdGlvbigpCiAgewogICAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcz0kc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllc09yaWc7CiAgICAgIGxvZ0RlYnVnKCJjbG9zZSIpOwogICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllc09yaWcpOwogIH0KICAkc2NvcGUuc2F2ZUFuZENsb3NlID0gZnVuY3Rpb24oKQogIHsKICAgIGxvZ0RlYnVnKCJzYXZlIGFuZCBjbG9zZSIpOwogICAgZnVuY3Rpb24gc2V0Q2xpZW50c0V4dHJhRmllbGRzX3N1Y2Nlc3MoKQogICAgewoKICAgIH0KICAgICRzY29wZS5DbGllbnRzRGV0YWlscz17fTsKICAgICRzY29wZS5DbGllbnRzRGV0YWlscy5leHRyYUZpZWxkcz0kc2NvcGUuZXh0cmFGaWVsZHM7CiAgICBzZXRDbGllbnRzRXh0cmFGaWVsZHMoJGh0dHAsJHNjb3BlLCRzY29wZS5DbGllbnRzRGV0YWlscyxzZXRDbGllbnRzRXh0cmFGaWVsZHNfc3VjY2Vzcyk7CiAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyk7CiAgfQoKICAkc2NvcGUuYWRkRXh0cmFGaWVsZHMgPSBmdW5jdGlvbigpCiAgewogICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyk7CiAgfQoKICAkc2NvcGUuZXh0cmFGaWVsZHMgPSBldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzOwogICRzY29wZS5maWVsZFR5cGVzID0gW3tmaWVsZF9kYXRhdHlwZTogIlRFWFRfQVJFQSIsIG5hbWU6J9eq15nXkdeqINeY16fXodeYJ30sIHtmaWVsZF9kYXRhdHlwZTogIk5VTUJFUiIsIG5hbWU6J9ee16HXpNeoJ30gLCB7ZmllbGRfZGF0YXR5cGU6ICJTVFJJTkciLCBuYW1lOifXmNen16HXmCDXp9em16gnfSAsIHtmaWVsZF9kYXRhdHlwZTogIkJPT0xFQU4iLCBuYW1lOifXqteZ15HXqiDXodeZ157XldefJ30gLCB7ZmllbGRfZGF0YXR5cGU6ICJEQVRFIiwgbmFtZTon16rXkNeo15nXmid9XTsKCiAgJHNjb3BlLmFkZE5ld0ZpZWxkID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgbmV3SXRlbU5vID0gJHNjb3BlLmV4dHJhRmllbGRzLmxlbmd0aCsxOwogICAgJHNjb3BlLmV4dHJhRmllbGRzLnB1c2goeyJmaWVsZF9kYXRhdHlwZSI6IlNUUklORyIsImlzX21hbmRhdG9yeSI6MCwgImZyb21kYiI6IGZhbHNlLCAiZmllbGRfaWQiOiAwLCAiaXNfYWN0aXZlIjogMSwgIm1vZGlmaWVkIjogMH0pOwoKICAgIGxvZ0RlYnVnKCJleHRyYSBmaWVsZHMgIiArIEpTT04uc3RyaW5naWZ5KCRzY29wZS5leHRyYUZpZWxkcywgbnVsbCwgMikpOwoKICB9OwoKICAkc2NvcGUucmVtb3ZlRmllbGQgPSBmdW5jdGlvbihjaG9pY2UpCiAgewogICAgLy8gcmVtb3ZpbmcgZmllbGQKICAgIC8vIGlmIGl0cyBub3Qgb3JpZ2luYXRlZCBmcm9tIGRhdGFiYXNlIC0gdGhlbiB3ZSBzaW1wbHkgZGVsZXRlIGl0IGZyb20gdGhlIGFycmF5CiAgICAvLyBvdGhlcndpc2Ugd2UgbWFyayBpdCBhcyBhY3RpdmU9ZmFsc2UKICAgIGxvZ0RlYnVnKGNob2ljZSk7CiAgICAvLyB2YXIgbGFzdEl0ZW0gPSAoY2hvaWNlLmlkKS0xOy8vJHNjb3BlLmNob2ljZXMubGVuZ3RoLTE7CiAgICAvLyAkc2NvcGUuY2hvaWNlcy5zcGxpY2UobGFzdEl0ZW0sMSk7CiAgICBmb3IodmFyIGkgPSAwOyBpIDwgJHNjb3BlLmV4dHJhRmllbGRzLmxlbmd0aDsgaSsrKQogICAgewogICAgICBpZiAoJHNjb3BlLmV4dHJhRmllbGRzW2ldID09IGNob2ljZSkKICAgICAgewogICAgICAgIGlmIChjaG9pY2UuZnJvbWRiPT1mYWxzZSkKICAgICAgICB7CiAgICAgICAgICAvLyBpZiBub3QgZnJvbSBkYiAtIHJlbW92aW5nIGl0IGZyb20gdGhlIGFycmF5IG9mIGV4dHJhLWZpZWxkcwogICAgICAgICAgJHNjb3BlLmV4dHJhRmllbGRzLnNwbGljZShpLCAxKTsKICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgIC8vIGlmIGZpZWxkIG9yaWdpbmF0ZWQgZnJvbSBkYiAtIHRoYW4gd2UgZG9udCByZW1vdmUgaXQgZnJvbSB0aGUgYXJyYXkKICAgICAgICAgIC8vIGFuZCBtYXJrIGl0IGFzIGFjdGl2ZT1mYWxzZSBzbyB0aGF0IGl0IGNhbiBiZSBoYW5kZWxlZCBvbiB0aGUgc2VydmVyCiAgICAgICAgICBjaG9pY2UuaXNfYWN0aXZlPTA7CiAgICAgICAgICBjaG9pY2UubW9kaWZpZWQ9dHJ1ZTsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICB9Owp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ2V2ZW50Q2xvc2VJZ25vcmVNYW5kYXRvcnlGaWVsZHNNb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRyb3V0ZVBhcmFtcywgJHJvb3RTY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRodHRwLCBjdXJyZW50RXZlbnQsIHVpQ2FsZW5kYXJDb25maWcpIHsKICAkc2NvcGUuY3VycmVudEV2ZW50PWN1cnJlbnRFdmVudDsKCiAgJHNjb3BlLm9rQ2FuY2VsID0gZnVuY3Rpb24oKSB7CiAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICB9OwoKICAkc2NvcGUuY2xvc2VFdmVudElnbm9yZU1hbmRhdG9yeUZpZWxkcyA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1ZygiaWdub3JlIG1hbmRhdG9yeSBleHRyYSBmaWVsZHMgYW5kIGNsb3NlIGV2ZW50Iik7CiAgICAkc2NvcGUuY3VycmVudEV2ZW50Lmlnbm9yZUV4dHJhRmllbGRzVmFsaWRhdGlvbj10cnVlOwogICAgY2xvc2VFdmVudCgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLCRzY29wZS5jdXJyZW50RXZlbnQsYWZ0ZXJDbG9zZUV2ZW50LGFmdGVyQ2xvc2VFdmVudCk7CiAgICBmdW5jdGlvbiBhZnRlckNsb3NlRXZlbnQoKQogICAgewogICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2V2ZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgfTsKICB9Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignZXZlbnRUeXBlQ2hhbmdlZFBvcHVwQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRsb2NhdGlvbiwgJHNjb3BlLCAkcm91dGVQYXJhbXMsICRyb290U2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgZXZlbnRUeXBlUHJvcGVydGllcywgdWlDYWxlbmRhckNvbmZpZykgewogICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzPWV2ZW50VHlwZVByb3BlcnRpZXM7CiAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMudXBkYXRlZF9mcm9tX2RhdGU9bmV3IERhdGUoKTsKICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy51cGRhdGVfZXhpc3RpbmdfZXZlbnRzPWZhbHNlOwoKICAkc2NvcGUuY2xvc2VNb2RhbCA9IGZ1bmN0aW9uKCkgewogICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgfTsKCiAgJHNjb3BlLnVwZGF0ZUV2ZW50VHlwZSA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1ZygidXBkYXRlIEV2ZW50IFR5cGUgIiArICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV2ZW50X3R5cGVfaWQpOwogICAgaWYgKCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF9yZWdpc3RyYXRpb25zPT0nJykKICAgIHsKICAgICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMubWF4X3JlZ2lzdHJhdGlvbnM9MDsKICAgIH0KICAgIHVwZGF0ZUV2ZW50VHlwZSgkaHR0cCwkc2NvcGUsJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXZlbnRfdHlwZV9pZCwkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcyx1cGRhdGVFdmVudFR5cGVfc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiB1cGRhdGVFdmVudFR5cGVfc3VjY2VzcygpCiAgICB7CiAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICAgICAgJGxvY2F0aW9uLnBhdGgoJy9ldmVudF90eXBlcycpOwogICAgfQogIH0KCn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignY2xhc3NEZWxldGVBbGxNb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRyb290U2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgY3VycmVudEV2ZW50LCB1aUNhbGVuZGFyQ29uZmlnKQp7CiAgbG9nRGVidWcoImNvbnRyb2xsZXI6IGNsYXNzRGVsZXRlQWxsTW9kYWxDb250cm9sbGVyIik7CiAgJHNjb3BlLmN1cnJlbnRFdmVudD1jdXJyZW50RXZlbnQ7CiAgJHNjb3BlLmNsb3NlTW9kYWwgPSBmdW5jdGlvbigpCiAgewogICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgfTsKCgogICRzY29wZS5kZWxldGVDbGFzc0V2ZW50U2luZ2xlPWZ1bmN0aW9uICgpIC8vIGRlbGV0ZSBvbmx5IG9uZS9jdXJyZW50IGNsYXNzIGV2ZWh0CiAgewogICAgY2FuY2VsQ2xhc3NFdmVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCxjYW5jZWxDbGFzc0V2ZW50X2NhbGxiYWNrLCBjYW5jZWxDbGFzc0V2ZW50X2NhbGxiYWNrKTsKICAgIGZ1bmN0aW9uIGNhbmNlbENsYXNzRXZlbnRfY2FsbGJhY2soKQogICAgewogICAgICBnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkKTsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ3JlbG9hZEV2ZW50Jyx7ZXZlbnRfaWQgOiAkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkfSk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCiAgICB9CiAgfQogICRzY29wZS5kZWxldGVDbGFzc0V2ZW50c0FsbD1mdW5jdGlvbiAoKSAvLyBkZWxldGUgYWxsIHJlcGVhdGluZyBldmVudHMKICB7CiAgICBjYW5jZWxDbGFzc1JlcGVhdGluZ0V2ZW50KCRodHRwLCRzY29wZSwwLCRzY29wZS5jdXJyZW50RXZlbnQucmVwZWF0X2V2ZW50X2lkLGNhbmNlbENsYXNzRXZlbnRfY2FsbGJhY2ssIGNhbmNlbENsYXNzRXZlbnRfY2FsbGJhY2spOwogICAgZnVuY3Rpb24gY2FuY2VsQ2xhc3NFdmVudF9jYWxsYmFjaygpCiAgICB7CiAgICAgIGdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQpOwogICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgncmVsb2FkRXZlbnQnLHtldmVudF9pZCA6ICRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWR9KTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKICAgIH0KICB9CiAgJHNjb3BlLmRlbGV0ZUNsYXNzRXZlbnRzQWxsU3RhcnRpbmdFdmVudElEPWZ1bmN0aW9uICgpIC8vIGRlbGV0ZSBhbGwgcmVwZWF0aW5nIGV2ZW50cyBzdGFydGluZyBldmVudF9pZAogIHsKICAgIGNhbmNlbENsYXNzUmVwZWF0aW5nRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQsJHNjb3BlLmN1cnJlbnRFdmVudC5yZXBlYXRfZXZlbnRfaWQsY2FuY2VsQ2xhc3NFdmVudF9jYWxsYmFjaywgY2FuY2VsQ2xhc3NFdmVudF9jYWxsYmFjayk7CiAgICBmdW5jdGlvbiBjYW5jZWxDbGFzc0V2ZW50X2NhbGxiYWNrKCkKICAgIHsKICAgICAgLy8gZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCk7CiAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdyZWxvYWRFdmVudCcse2V2ZW50X2lkIDogJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZH0pOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgfQogIH0KCn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignYnVzaW5lc3NfbW9kYWxfbGltaXRhdGlvbl9jcmVhdGUnLCBmdW5jdGlvbigkc2NvcGUsICRyb290U2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgc3RhcnQsZW5kLCBmaXhlZFNjaGVkdWxlLCB1aUNhbGVuZGFyQ29uZmlnKSB7CgogICRzY29wZS5maXhlZFNjaGVkdWxlPWZpeGVkU2NoZWR1bGU7CiAgJHNjb3BlLm9yaWdpbmFsX3N0YXJ0PXN0YXJ0OwogICRzY29wZS5vcmlnaW5hbF9lbmQ9ZW5kOwoKICAkc2NvcGUuc3RhcnQ9bmV3IG1vbWVudChzdGFydCkqMTAwMDsKICAkc2NvcGUuZW5kPW5ldyBtb21lbnQoZW5kKSoxMDAwOwogIGNvbnNvbGUubG9nKCdzdGFydD0nK3N0YXJ0KTsKICBjb25zb2xlLmxvZygnZW5kPScrZW5kKTsKCiAgZ2V0QnVzaW5lc3NMb2NhdGlvbnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19sb2NhdGlvbnMnLGdldEJ1c2luZXNzTG9jYXRpb25zX3N1Y2Nlc3MpOwogIGZ1bmN0aW9uIGdldEJ1c2luZXNzTG9jYXRpb25zX3N1Y2Nlc3MoKQogIHsKICAgICRzY29wZS5uZXdFdmVudERldGFpbHMubG9jYXRpb25faWQ9JHNjb3BlLmJ1c2luZXNzX2xvY2F0aW9uc1swXS5sb2NhdGlvbl9pZDsKICB9CgogIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc3RhcnQpOwogIHNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKGVuZCk7CiAgbG9nRGVidWcoInNlbGVjdGVkRGF0ZVN0YXJ0ID0gIitzZWxlY3RlZERhdGVTdGFydCk7CiAgdmFyIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZSgpICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKICB2YXIgc2VsZWN0ZWREYXRlRW5kID0gbmV3IERhdGUoc2VsZWN0ZWREYXRlRW5kLmdldFRpbWUoKSArIHNlbGVjdGVkRGF0ZUVuZC5nZXRUaW1lem9uZU9mZnNldCgpICogNjAwMDApOwoKICAvLyBsb2dEZWJ1ZygiZGF0ZT0iICsgc2VsZWN0ZWREYXRlU3RhcnQpOwogICRzY29wZS5zZWxlY3RlZEV2ZW50ID0gW107CiAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscyA9IFtdOwogICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRIb3VycygpOwogICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcyA9IChzZWxlY3RlZERhdGVTdGFydC5nZXRNaW51dGVzKCkgPCAxMCA/ICcwJyA6ICcnKSArIHNlbGVjdGVkRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRvdyA9IGRheU5hbWVzW3NlbGVjdGVkRGF0ZVN0YXJ0LmdldERheSgpXTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRhdGUgPSBzZWxlY3RlZERhdGVTdGFydDsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoID0gbW9udGhOYW1lc1tzZWxlY3RlZERhdGVTdGFydC5nZXRNb250aCgpXTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoMTEyID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TW9udGgoKSsxOwogICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aCA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldERhdGUoKTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXIgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRGdWxsWWVhcigpOwogICRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZV9pbnB1dF9mb3JtYXQ9IG5ldyBEYXRlKDE5NzAsIDAsIDEsICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMsICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcywgMCk7CgogICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzID0gc2VsZWN0ZWREYXRlRW5kLmdldEhvdXJzKCk7CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcyA9IChzZWxlY3RlZERhdGVFbmQuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBzZWxlY3RlZERhdGVFbmQuZ2V0TWludXRlcygpOwoKCiAgJHNjb3BlLmNhbmNlbCA9IGZ1bmN0aW9uKCkgewogICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgfTsKCiAgZ2V0QWxsSW5zdHJ1Y3RvcnMoJGh0dHAsJHNjb3BlLCdpbnN0cnVjdG9ycycsZ2V0QWxsSW5zdHJ1Y3RvcnNfc3VjY2Vzcyk7CiAgZnVuY3Rpb24gZ2V0QWxsSW5zdHJ1Y3RvcnNfc3VjY2VzcygpCiAgewogICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pbnN0cnVjdG9yX2lkPSRzY29wZS5pbnN0cnVjdG9yc1swXS5idXNpbmVzc191c2VyX2lkOwogIH0KICBnZXROb0NsYXNzRXZlbnRUeXBlc05vQWRtaW4oJGh0dHAsJHNjb3BlLCdyZWxhdGVkRXZlbnRUeXBlcycpOwoKICAkc2NvcGUuY3JlYXRlTmV3TGltaXRhdGlvbiA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1ZygiZnVuY3Rpb246IGNyZWF0ZU5ld0xpbWl0YXRpb24iKTsKICAgIGNhbGVuZGFyID0gJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnOwoKICAgIGlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudFR5cGVzLmxlbmd0aDwxKQogICAgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBpZiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnM8JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykKICAgIHsKICAgICAgYWxlcnQoIteW157XnyDXodeZ15XXnSDXnNek16DXmSDXltee158g15TXqteX15zXlCIpOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBpZiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnM9PSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMpCiAgICB7CiAgICAgIGlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzPD0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpCiAgICAgIHsKICAgICAgICBhbGVydCgi15bXntefINeh15nXldedINec16TXoNeZINeW157XnyDXlNeq15fXnNeUIik7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIGlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzPCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMrMTApKQogICAgICB7CiAgICAgICAgYWxlcnQoIteR15zXldenINen15jXnyDXni0xMCDXk9en15XXqiIpOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfQogICAgaWYgKCFrdXplSXNDYWxlbmRhckRyYWdnYmxlKSB7CiAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigndW5zZWxlY3QnKTsKICAgIH0KICAgIGxvZ0RlYnVnKCJzdGFydD0iICsgc3RhcnQpOwogICAgY2hlY2tEYXRlID0gbmV3IERhdGUoc3RhcnQpOwogICAgbG9nRGVidWcoImNoZWNrIGRhdGUgPSAiICsgY2hlY2tEYXRlKQogICAgbG9nRGVidWcoImVuZD0iICsgZW5kKTsKICAgIGVjb2xvcj0iIzAwYTY1YSI7CgogICAgaWYgKGNoZWNrRGF0ZS5nZXRGdWxsWWVhcigpID09IDE5NzApIHsKICAgICAgICBkYXlfbGltaXRfaWQgPSAtMTsKICAgIH0gZWxzZSB7CiAgICAgICAgZGF5X2xpbWl0X2lkID0gMTsKICAgIH0KCiAgICAvLyB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tdLmZ1bGxDYWxlbmRhcigncmVyZW5kZXJFdmVudHMnKTsKCiAgICB0ZW1wX2xpbWl0X2lkID0gY2FsY190ZW1wX2xpbWl0X2lkKCk7CgogICAgbG9nRGVidWcoJHNjb3BlLnNlbGVjdGVkRXZlbnRUeXBlc1swXSk7CiAgICBsb2dEZWJ1Zygkc2NvcGUuc2VsZWN0ZWRFdmVudFR5cGVzWzBdLmV2ZW50X3R5cGVfaWQpOwoKICAgIHN0YXJ0X3BhcmFtPXN0YXJ0OwogICAgZW5kX3BhcmFtPWVuZDsKICAgIHRpdGxlX3BhcmFtPScnOwogICAgbG9nRGVidWcoImFkZExpbWl0YXRpb25Ub0RhdGFiYXNlIHN0YXJ0PSIgKyBzdGFydF9wYXJhbSArICIsIGVuZD0iICsgIiwgdGl0bGU9IiArIHRpdGxlX3BhcmFtICk7CgogICAgdGhlZGF0YSA9IHsKICAgICAgICBzdGFydF9kYXRlOiAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWUsCiAgICAgICAgZW5kX2RhdGU6ICRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kX3RpbWUsCiAgICAgICAgY29sb3I6IGVjb2xvciwKICAgICAgICB0ZW1wX2xpbWl0X2lkOiB0ZW1wX2xpbWl0X2lkLAogICAgICAgIGVtcF9pZDogJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pbnN0cnVjdG9yX2lkLAogICAgICAgIGxvY2F0aW9uX2lkOiAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmxvY2F0aW9uX2lkLAogICAgICAgIGV2ZW50X3R5cGVfaWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50VHlwZXNbMF0uZXZlbnRfdHlwZV9pZCwKICAgICAgICBldmVudF90eXBlczogJHNjb3BlLnNlbGVjdGVkRXZlbnRUeXBlcywKICAgICAgICB0aXRsZTogdGl0bGVfcGFyYW0KICAgIH07CgogICAgaWYgKCRzY29wZS5maXhlZFNjaGVkdWxlKSAvLyBmaXhlZCBzY2hlZHVsZSB2cyBzcGVjaWZpYyB3ZWVkL2RheSBsaW1pdGF0aW9uCiAgICB7CiAgICAgIGNyZWF0ZUNhbGVuZGFyTGltaXRhdGlvbigkaHR0cCwkc2NvcGUsdGhlZGF0YSxsaW1pdGF0aW9uX3N1Y2Nlc3NfY2FsbGJhY2spOwogICAgfQogICAgZWxzZQogICAgewogICAgICBjcmVhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXkoJGh0dHAsJHNjb3BlLHRoZWRhdGEsbGltaXRhdGlvbl9zdWNjZXNzX2NhbGxiYWNrKTsKICAgIH0KICAgIGZ1bmN0aW9uIGxpbWl0YXRpb25fc3VjY2Vzc19jYWxsYmFjaygpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJzdWNjZXNzIik7CiAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuZGlzbWlzcygpOwogICAgfQoKICB9CgogICRzY29wZS5zdGFydE1pbnV0ZXMgPSBmdW5jdGlvbigpCiAgewogICAgbG9nRGVidWcoInN0YXJ0TWludXRlcyAiKygkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpKTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcz1taW51dGVzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpOwogICAgY2FsY3VsYXRlU3RhcnRUaW1lKCk7CiAgfQogICRzY29wZS5zdGFydEhvdXJzID0gZnVuY3Rpb24oKQogIHsKICAgIGxvZ0RlYnVnKCJzdGFydEhvdXJzICIraG91cnNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMpKTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnM9aG91cnNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMpOwogICAgY2FsY3VsYXRlU3RhcnRUaW1lKCk7CiAgfQogICRzY29wZS5lbmRNaW51dGVzID0gZnVuY3Rpb24oKQogIHsKICAgIGxvZ0RlYnVnKCJlbmRNaW51dGVzICIrKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpKTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXM9bWludXRlc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcyk7CiAgICBjYWxjdWxhdGVFbmRUaW1lKCk7CiAgfQogICRzY29wZS5lbmRIb3VycyA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1ZygiZW5kSG91cnMgIitob3Vyc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMpKTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzPWhvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vycyk7CiAgICBjYWxjdWxhdGVFbmRUaW1lKCk7CiAgfQoKCiAgZnVuY3Rpb24gY2FsY3VsYXRlU3RhcnRUaW1lKCkKICB7CiAgICBldmVudFllYXI9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyOwogICAgZXZlbnRNb250aD0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoMTEyOwogICAgZXZlbnREYXk9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXlvZm1vbnRoOwogICAgaWYgKHBhcnNlSW50KGV2ZW50TW9udGgpPDEwKQogICAgewogICAgICBldmVudE1vbnRoPSIwIitldmVudE1vbnRoOwogICAgfQogICAgaWYgKHBhcnNlSW50KGV2ZW50RGF5KTwxMCkKICAgIHsKICAgICAgZXZlbnREYXk9IjAiK2V2ZW50RGF5OwogICAgfQogICAgbG9nRGVidWcoIiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0eWVhcj0iK2V2ZW50WWVhcik7CiAgICBsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXlvZm1vbnRoPSIrZXZlbnRNb250aCk7CiAgICBsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aD0iK2V2ZW50RGF5KTsKICAgIG5ld19zdGFydD1tb21lbnQudXRjKGV2ZW50WWVhcisiLSIrZXZlbnRNb250aCsiLSIrZXZlbnREYXkrIlQwMDowMDowMCIpLmFkZCgoKHBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMpKjYwKStwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpKSwgJ21pbnV0ZXMnKTsKICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZT1uZXdfc3RhcnQ7CiAgICBsb2dEZWJ1ZygibmV3X3N0YXJ0PSIrbmV3X3N0YXJ0KTsKICB9CiAgZnVuY3Rpb24gY2FsY3VsYXRlRW5kVGltZSgpCiAgewogICAgZXZlbnRZZWFyPSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0eWVhcjsKICAgIGV2ZW50TW9udGg9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aDExMjsKICAgIGV2ZW50RGF5PSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aDsKICAgIGlmIChwYXJzZUludChldmVudE1vbnRoKTwxMCkKICAgIHsKICAgICAgZXZlbnRNb250aD0iMCIrZXZlbnRNb250aDsKICAgIH0KICAgIGlmIChwYXJzZUludChldmVudERheSk8MTApCiAgICB7CiAgICAgIGV2ZW50RGF5PSIwIitldmVudERheTsKICAgIH0KICAgIGxvZ0RlYnVnKCIkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXI9IitldmVudFllYXIpOwogICAgbG9nRGVidWcoIiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aD0iK2V2ZW50TW9udGgpOwogICAgbG9nRGVidWcoIiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bW9udGg9IitldmVudERheSk7CiAgICBuZXdfZW5kPW1vbWVudC51dGMoZXZlbnRZZWFyKyItIitldmVudE1vbnRoKyItIitldmVudERheSsiVDAwOjAwOjAwIikuYWRkKCgocGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMpKjYwKStwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzKSksICdtaW51dGVzJyk7CiAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZF90aW1lPW5ld19lbmQ7CiAgICBsb2dEZWJ1ZygibmV3X2VuZD0iK25ld19lbmQpOwogIH0KCiAgY2FsY3VsYXRlU3RhcnRUaW1lKCk7CiAgY2FsY3VsYXRlRW5kVGltZSgpOwoKICBmdW5jdGlvbiBtaW51dGVzQ2hhbmdlZCh0aGVtaW51dGVzKQogIHsKICAgIGxvZ0RlYnVnKCJ0aGVtaW51dGVzPSIrdGhlbWludXRlcyk7CiAgICBpZiAodHlwZW9mIHRoZW1pbnV0ZXM9PSJ1bmRlZmluZWQiKQogICAgewogICAgICByZXR1cm4gIjAwIjsKICAgIH0KICAgIHRoZW1pbnV0ZXM9cGFyc2VJbnQodGhlbWludXRlcyk7CiAgICBpZiAodGhlbWludXRlcz42MCkKICAgIHsKICAgICAgcmV0dXJuICIwMCI7CiAgICB9CiAgICBlbHNlIGlmICh0aGVtaW51dGVzPDApCiAgICB7CiAgICAgIHJldHVybiAiMDAiOwogICAgfQogICAgZWxzZSBpZiAodGhlbWludXRlcz09IiIpCiAgICB7CiAgICAgIHJldHVybiAiMDAiOwogICAgfQogICAgZWxzZSBpZiAodGhlbWludXRlczwxMCkKICAgIHsKICAgICAgcmV0dXJuICIwIit0aGVtaW51dGVzOwogICAgfQogICAgZWxzZQogICAgewogICAgICAgIHJldHVybiB0aGVtaW51dGVzOwogICAgfQogIH0KICBmdW5jdGlvbiBob3Vyc0NoYW5nZWQodGhlaG91cnMpCiAgewogICAgbG9nRGVidWcoInRoZWhvdXJzPSIrdGhlaG91cnMpOwogICAgaWYgKHR5cGVvZiB0aGVob3Vycz09InVuZGVmaW5lZCIpCiAgICB7CiAgICAgIHJldHVybiAiMCI7CiAgICB9CiAgICB0aGVob3Vycz1wYXJzZUludCh0aGVob3Vycyk7CiAgICBpZiAodGhlaG91cnM+MjQpCiAgICB7CiAgICAgIHJldHVybiAwOwogICAgfQogICAgZWxzZSBpZiAodGhlaG91cnM8MCkKICAgIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CiAgICBlbHNlIGlmICh0aGVob3Vycz09IiIpCiAgICB7CiAgICAgIHJldHVybiAiMCI7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICAgcmV0dXJuIHRoZWhvdXJzOwogICAgfQogIH0KfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2NsYXNzQ2xvc2VNb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRyb290U2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgZXZlbnRfaWQsIHVpQ2FsZW5kYXJDb25maWcpIHsKICBnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnc2VsZWN0ZWRFdmVudCcsZXZlbnRfaWQsYWZ0ZXJHZXRDbGllbnRTcGVjaWZpY0V2ZW50KTsKICBmdW5jdGlvbiBhZnRlckdldENsaWVudFNwZWNpZmljRXZlbnQoKQogIHsKICAgIGZvciAoaSA9IDA7IGkgPCAkc2NvcGUuc2VsZWN0ZWRFdmVudC5ldmVudFVzZXJzLmxlbmd0aDsgaSsrKQogICAgewogICAgICBpZiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRVc2Vyc1tpXS5zdGF0dXNfbmFtZSE9JGdVc2VyX3N0YXR1c19hYnNlbnRlZCkKICAgICAgewogICAgICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50VXNlcnNbaV0ucGFydGljaXBhdGVkPXRydWU7CiAgICAgIH0KICAgICAgaWYgKCRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50VXNlcnNbaV0uaXNfd2FpdGluZ19saXN0PT0xKQogICAgICB7CiAgICAgICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRVc2Vyc1tpXS5wYXJ0aWNpcGF0ZWQ9ZmFsc2U7CiAgICAgIH0KICAgIH0KICAgIGxvZ0RlYnVnKCRzY29wZS5zZWxlY3RlZEV2ZW50KTsKICB9CgogIC8vIGNsaWNrZWQgcm93IC0gY2hlY2svdW5jaGVjayB0aGUgY2hlY2tib3ggb2YgYSB1c2VyCiAgJHNjb3BlLnJvd0NsaWNrZWQgPSBmdW5jdGlvbihvYmopCiAgewogICAgbG9nRGVidWcoJ3JvdyBjbGlja2VkJyk7CiAgICBvYmoucGFydGljaXBhdGVkID0gIW9iai5wYXJ0aWNpcGF0ZWQ7CiAgfTsKCiAgJHNjb3BlLm9rTGltaXRhdGlvbk1vZGFsID0gZnVuY3Rpb24oKSB7CiAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICB9OwoKICAkc2NvcGUuY2xvc2VDbGFzcyA9IGZ1bmN0aW9uKCkKICB7CiAgICBjbG9zZUNsYXNzRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50X2lkLCRzY29wZS5zZWxlY3RlZEV2ZW50LGFmdGVyQ2xvc2VFdmVudCxhZnRlckNsb3NlRXZlbnQpOwogICAgZnVuY3Rpb24gYWZ0ZXJDbG9zZUV2ZW50KCkKICAgIHsKICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdyZWxvYWRFdmVudCcse2V2ZW50X2lkIDogJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRfaWR9KTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKICAgIH07CiAgfQp9KTsKCmt1emVBcHAuY29udHJvbGxlcignYnVzaW5lc3NDbGllbmRDYXJkUGF5bWVudCcsIGZ1bmN0aW9uKCRzY29wZSwgJHJvdXRlUGFyYW1zLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIGN1cnJlbnRDbGllbnQsIGlzcGx1cywgdWlDYWxlbmRhckNvbmZpZywgQnVzaW5lc3NDb25maWcpCnsKICAkc2NvcGUuaXNwbHVzPWlzcGx1czsKICBsb2dEZWJ1ZygnYnVzaW5lc3NDbGllbmRDYXJkUGF5bWVudCBpc3BsdXM9JyAraXNwbHVzKyIgY3VycmVudENsaWVudD0iKyBKU09OLnN0cmluZ2lmeShjdXJyZW50Q2xpZW50LCBudWxsLCAyKSk7CiAgJHNjb3BlLmt1emVJc0xvYWRpbmc9ZmFsc2U7CiAgbG9nRGVidWcoJ2N1cnJlbnRDbGllbnQucGF5bWVudF9iYWxhbmNlPScrY3VycmVudENsaWVudC5wYXltZW50X2JhbGFuY2UrIixjdXJyZW50Q2xpZW50LnVucGFpZF9iYWxhbmNlID0iK2N1cnJlbnRDbGllbnQudW5wYWlkX2JhbGFuY2UpOwogIHRoZWJhbGFuY2UgPSBjdXJyZW50Q2xpZW50LnBheW1lbnRfYmFsYW5jZS1jdXJyZW50Q2xpZW50LnVucGFpZF9iYWxhbmNlOwogIGxvZ0RlYnVnKCd0aGViYWxhbmNlPScrdGhlYmFsYW5jZSk7CiAgaWYgKHRoZWJhbGFuY2U8MCkKICB7CiAgICAkc2NvcGUuYmFsYW5jZVRvUGF5PU1hdGguYWJzKHRoZWJhbGFuY2UpOwogIH0KICBlbHNlCiAgewogICAgJHNjb3BlLmJhbGFuY2VUb1BheT0wOwogIH0KICAkc2NvcGUucGF5bWVudFR5cGVUaXRsZT0i15HXl9eoIjsKICAkc2NvcGUuY3VycmVudENsaWVudD1jdXJyZW50Q2xpZW50OwogIGxvZ0RlYnVnKCRzY29wZS5jdXJyZW50Q2xpZW50KTsKICAkc2NvcGUuYnVzaW5lc3NDb25maWcgPSBCdXNpbmVzc0NvbmZpZy5nZXQoKTsKICAkc2NvcGUuYnVzaW5lc3NDb25maWcudGhlbihmdW5jdGlvbiAoY29uZmlnKSB7CiAgICAkc2NvcGUuaW52b2ljZV9zb3VyY2VfaWQgPSBjb25maWcuaW52b2ljZV9zb3VyY2VfaWQ7CiAgICAkc2NvcGUuaGFzVmF0ID0gY29uZmlnLnZhdF9yYXRlID4gMDsKICB9KTsKCiAgJHNjb3BlLmNsb3NlTW9kYWwgPSBmdW5jdGlvbigpIHsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogIH07CgogICRzY29wZS5leHRlcm5hbF9pbnZvaWNlX2dlbmVyYXRlZD1mYWxzZTsKICAkc2NvcGUuaW52b2ljZV9kYXRlX2Zvcm1hdD1uZXcgRGF0ZSgpOwoKICBnZXROZXh0SW52b2ljZU51bWJlcigkaHR0cCwkc2NvcGUsJHNjb3BlLmN1cnJlbnRDbGllbnQuYnVzaW5lc3NfdXNlcl9pZCwnaW52b2ljZV9udW1iZXInKTsKCiAgJHNjb3BlLnBheW1lbnRNZXRob2RzID0gcGF5bWVudE1ldGhvZHM7CgogIC8vIGluZGljYXRpb24gd2hldGhlciBwYXltZW50IG1ldGhvZCB3YXMgc2VsZWN0ZWQKICAkc2NvcGUuaXNQYXltZW50TWV0aG9kU2VsZWN0ZWQ9ZmFsc2U7CiAgJHNjb3BlLnNlbGVjdFBheW1lbnRNZXRob2QgPSBmdW5jdGlvbihwYXltZW50KSB7CiAgICAkc2NvcGUucGF5bWVudFR5cGVUaXRsZT1wYXltZW50Lm5hbWU7CiAgICAkc2NvcGUuc2VsZWN0ZWRQYXltZW50TWV0aG9kPXBheW1lbnQ7CiAgICAkc2NvcGUuaXNQYXltZW50TWV0aG9kU2VsZWN0ZWQ9dHJ1ZTsKICB9OwoKICAkc2NvcGUudXBkYXRlQmFsYW5jZSA9IGZ1bmN0aW9uIHVwZGF0ZUJhbGFuY2UgKGlzU291cmNlV2l0aFZhdCkgewogICAgJHNjb3BlLmJ1c2luZXNzQ29uZmlnLnRoZW4oZnVuY3Rpb24gKGNvbmZpZykgewogICAgICBpZiAoaXNTb3VyY2VXaXRoVmF0KSB7CiAgICAgICAgJHNjb3BlLmJhbGFuY2VUb1BheU5vVmF0ID0gTnVtYmVyKCgkc2NvcGUuYmFsYW5jZVRvUGF5IC8gKDEgKyBjb25maWcudmF0X3JhdGUpKS50b0ZpeGVkKDIpKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAkc2NvcGUuYmFsYW5jZVRvUGF5ID0gTnVtYmVyKCgkc2NvcGUuYmFsYW5jZVRvUGF5Tm9WYXQgKiAoMSArIGNvbmZpZy52YXRfcmF0ZSkpLnRvRml4ZWQoMikpOwogICAgICB9CiAgICB9KQogIH07CgogICRzY29wZS5tYWtlUGF5bWVudCA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1ZyhjdXJyZW50Q2xpZW50KTsKICAgIGxvZ0RlYnVnKCJwYXltZW50IG1ldGhvZCIpOwogICAgbG9nRGVidWcoJHNjb3BlLnNlbGVjdGVkUGF5bWVudE1ldGhvZCk7CiAgICBsb2dEZWJ1ZygiJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZ2VuZXJhdGVkPTwiKyRzY29wZS5pbnZvaWNlX2dlbmVyYXRlZCsiPiIpOwoKICAgIGlmICgoJHNjb3BlLmJhbGFuY2VUb1BheT09MCkgfHwgKCRzY29wZS5iYWxhbmNlVG9QYXk9PScnKXx8ICgkc2NvcGUuYmFsYW5jZVRvUGF5PT1udWxsKSkKICAgIHsKICAgICAgJHNjb3BlLnVzZXJFcnJvcj0i15DXoNeQINeU15bXnyDXodeb15XXnSDXm9ec16nXlNeVIjsKICAgIH0KICAgIGVsc2UgaWYgKCEkc2NvcGUuaXNQYXltZW50TWV0aG9kU2VsZWN0ZWQpCiAgICB7CiAgICAgICRzY29wZS51c2VyRXJyb3I9IteQ16DXkCDXkdeX16gg15DXntem16LXmSDXqtep15zXldedIjsKICAgICAgLy8gYWxlcnQoJ3NzJyk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgIGlmICgoJHNjb3BlLmludm9pY2VfZ2VuZXJhdGVkIT0xKSB8fCAoJHNjb3BlLmludm9pY2VfZGF0ZV9mb3JtYXQ9PW51bGwpKQogICAgICB7CiAgICAgICAgdmFyIGludm9pY2VfZGF0ZV9mb3JtYXQgPSAibnVsbCI7CiAgICAgIH0KICAgICAgZWxzZQogICAgICB7CiAgICAgICAgdmFyIGludm9pY2VfZGF0ZV9mb3JtYXQgPSAkc2NvcGUuaW52b2ljZV9kYXRlX2Zvcm1hdC5nZXREYXRlKCkgICsgIi0iICsgKCRzY29wZS5pbnZvaWNlX2RhdGVfZm9ybWF0LmdldE1vbnRoKCkrMSkgKyAiLSIgKyAkc2NvcGUuaW52b2ljZV9kYXRlX2Zvcm1hdC5nZXRGdWxsWWVhcigpOwogICAgICB9CiAgICAgIGlmIChpc3BsdXMpCiAgICAgIHsKICAgICAgICB3aGF0VG9QYXk9JHNjb3BlLmJhbGFuY2VUb1BheTsKICAgICAgfQogICAgICBlbHNlIHsKICAgICAgICB3aGF0VG9QYXk9LSRzY29wZS5iYWxhbmNlVG9QYXk7CiAgICAgIH0KICAgICAgdGhlZGF0YT0gewogICAgICAgICAgYmFsYW5jZVRvUGF5OiB3aGF0VG9QYXksCiAgICAgICAgICBiYWxhbmNlVG9QYXlOb1ZhdDogJHNjb3BlLmJhbGFuY2VUb1BheU5vVmF0ICogKGlzcGx1cyA/ICsxIDogLTEpLAogICAgICAgICAgcGF5bWVudF9tZXRob2RfbmFtZTogJHNjb3BlLnNlbGVjdGVkUGF5bWVudE1ldGhvZC5tZXRob2QsCiAgICAgICAgICBpbnZvaWNlX251bWJlcjogJHNjb3BlLmludm9pY2VfbnVtYmVyLAogICAgICAgICAgaW52b2ljZV9nZW5lcmF0ZWQ6ICRzY29wZS5pbnZvaWNlX2dlbmVyYXRlZCwKICAgICAgICAgIGludm9pY2VfZGF0ZTogaW52b2ljZV9kYXRlX2Zvcm1hdAogICAgICB9OwogICAgICAkc2NvcGUua3V6ZUlzTG9hZGluZz10cnVlOwogICAgICBjcmVhdGVQYXltZW50Rm9yQ2xpZW50KCRodHRwLCRzY29wZSxjdXJyZW50Q2xpZW50LmJ1c2luZXNzX3VzZXJfaWQsdGhlZGF0YSxjcmVhdGVQYXltZW50Rm9yQ2xpZW50X3N1Y2Nlc3MsIGNyZWF0ZVBheW1lbnRGb3JDbGllbnRfZmFpbHVyZSk7CiAgICAgIGZ1bmN0aW9uIGNyZWF0ZVBheW1lbnRGb3JDbGllbnRfc3VjY2VzcygpCiAgICAgIHsKICAgICAgICAkc2NvcGUua3V6ZUlzTG9hZGluZz1mYWxzZTsKICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgICAgICAgbG9nRGVidWcoImJyb2FkY2FzdGluZyBjbGllbnRQYWdlUmVsb2FkRGF0YSIpOwogICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKICAgICAgICBsb2dEZWJ1ZygiYnJvYWRjYXN0aW5nIGV2ZW50UGFnZVJlbG9hZERhdGEiKTsKICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2V2ZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKICAgICAgICAvLyBsb2dEZWJ1ZygiYnJvYWRjYXN0aW5nIHJlbG9hZEV2ZW50Iik7CiAgICAgICAgLy8gJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdyZWxvYWRFdmVudCcpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGNyZWF0ZVBheW1lbnRGb3JDbGllbnRfZmFpbHVyZSgpCiAgICAgIHsKICAgICAgICAkc2NvcGUua3V6ZUlzTG9hZGluZz1mYWxzZTsKICAgICAgfQogICAgfQogfQp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ2V2ZW50RGV0YWlsc0J1c2luZXNzQ2FsZW5kYXJNb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgc2VsZWN0ZWRFdmVudCwgdWlDYWxlbmRhckNvbmZpZykgewogICAgdmFyIGRheU5hbWVzID0gWyfXqNeQ16nXldefJywgJ9ep16DXmScsICfXqdec15nXqdeZJywgJ9eo15HXmdei15knLCAn15fXnteZ16nXmScsICfXqdeZ16nXmScsICfXqdeR16onXTsKCiAgICAkc2NvcGUuZ290b0NsaWVudFBhZ2U9IGZ1bmN0aW9uIChidXNpbmVzVXNlcmlkKQogICAgewogICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgICAgIGdvdG9DbGllbnRQYWdlKGJ1c2luZXNVc2VyaWQpOwogICAgfQogICAgJHNjb3BlLmVkaXRFdmVudD0gZnVuY3Rpb24gKHRoZWV2ZW50KQogICAgewogICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgICAgIGdvdG9FdmVudFBhZ2UodGhlZXZlbnQpOwogICAgfQoKICAgIGxvZ0RlYnVnKCJzZWxlY3RlZCBFdmVudCBpbmZvID0iICsgSlNPTi5zdHJpbmdpZnkoc2VsZWN0ZWRFdmVudCwgbnVsbCwgMikpOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQgPSBzZWxlY3RlZEV2ZW50OwogICAgc2VsZWN0ZWREYXRlU3RhcnQgPSBuZXcgRGF0ZShzZWxlY3RlZEV2ZW50LnN0YXJ0KTsKICAgIHZhciBzZWxlY3RlZERhdGVTdGFydCA9IG5ldyBEYXRlKHNlbGVjdGVkRGF0ZVN0YXJ0LmdldFRpbWUoKSArIHNlbGVjdGVkRGF0ZVN0YXJ0LmdldFRpbWV6b25lT2Zmc2V0KCkgKiA2MDAwMCk7CgogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycyA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldEhvdXJzKCk7CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBzZWxlY3RlZERhdGVTdGFydC5nZXRNaW51dGVzKCk7CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRvdyA9IGRheU5hbWVzW3NlbGVjdGVkRGF0ZVN0YXJ0LmdldERheSgpXTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF0ZSA9IHNlbGVjdGVkRGF0ZVN0YXJ0OwoKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0RGF5ID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RGF0ZSgpOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRNb250aCA9IDEgKyBzZWxlY3RlZERhdGVTdGFydC5nZXRNb250aCgpOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRNb250aFR4dCA9IG1vbnRoTmFtZXNbJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRNb250aCAtIDFdOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRZZWFyID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RnVsbFllYXIoKTsKCiAgICBzZWxlY3RlZERhdGVFbmQgPSBuZXcgRGF0ZShzZWxlY3RlZEV2ZW50LmVuZCk7CiAgICB2YXIgc2VsZWN0ZWREYXRlRW5kID0gbmV3IERhdGUoc2VsZWN0ZWREYXRlRW5kLmdldFRpbWUoKSArIHNlbGVjdGVkRGF0ZUVuZC5nZXRUaW1lem9uZU9mZnNldCgpICogNjAwMDApOwoKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzID0gc2VsZWN0ZWREYXRlRW5kLmdldEhvdXJzKCk7CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRkb3cgPSBkYXlOYW1lc1tzZWxlY3RlZERhdGVFbmQuZ2V0RGF5KCldOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcyA9IChzZWxlY3RlZERhdGVFbmQuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBzZWxlY3RlZERhdGVFbmQuZ2V0TWludXRlcygpOwogICAgJHNjb3BlLm9rTGltaXRhdGlvbk1vZGFsID0gZnVuY3Rpb24oKSB7CiAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgfTsKCiAgICAkc2NvcGUuZGVsZXRlTGltaXRhdGlvbk1vZGFsID0gZnVuY3Rpb24oKSB7CiAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuZGlzbWlzcygnZGVsZXRlJyk7CiAgICAgICAgY2FsZW5kYXIgPSAnY2FsZW5kYXJfYnVzaW5lc3MnOwoKICAgICAgICAkc2NvcGUuZGVsZXRlQ2FsZW5kYXJEQkV2ZW50KHNlbGVjdGVkRXZlbnQsIGNhbGVuZGFyKTsKICAgIH07CiAgICAkc2NvcGUuZGVsZXRlQ2FsZW5kYXJKU0V2ZW50ID0gZnVuY3Rpb24oY2FsZW5kYXIsIHNlbGVjdGVkRXZlbnRpZCkgewoKICAgICAgICBsb2dEZWJ1ZygiY2FsZW5kYXJfaG91cnNfb2Zfd29ya19jb25maWc9IiArIHVpQ2FsZW5kYXJDb25maWcpOwogICAgICAgIGxvZ0RlYnVnKCJ1aUNhbGVuZGFyQ29uZmlnW2NhbGVuZGFyXT0iICsgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJ2NhbGVuZGFyX2J1c2luZXNzJ10pOwogICAgICAgIGxvZ0RlYnVnKCJkZWxldGUganMgZXZlbnQgIiArIHNlbGVjdGVkRXZlbnRpZCk7CiAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVtb3ZlRXZlbnRzJywgW3NlbGVjdGVkRXZlbnRpZF0pOyAvLyBnbyB0byBkYXRlIGluIGNhbGVuZGFyIGdvdG8KICAgIH07CiAgICAkc2NvcGUuZGVsZXRlQ2FsZW5kYXJEQkV2ZW50ID0gZnVuY3Rpb24oc2VsZWN0ZWRFdmVudCwgY2FsZW5kYXIpIHsKICAgICAgICBsb2dEZWJ1ZygiZGVsZXRlIGV2ZW50ICIgKyBzZWxlY3RlZEV2ZW50LmlkKTsKICAgICAgICAkaHR0cCh7CiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLAogICAgICAgICAgICB1cmw6ICcvYXBpL2FkbWluL2V2ZW50cy9kZWxldGUvJyArIHNlbGVjdGVkRXZlbnQuaWQsCiAgICAgICAgICAgIGRhdGE6IHsKICAgICAgICAgICAgICAgIHRlbXBfbGltaXRfaWQ6IHNlbGVjdGVkRXZlbnQudGVtcF9saW1pdF9pZAogICAgICAgICAgICB9LAogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb247Y2hhcnNldD11dGYtOCcKICAgICAgICAgICAgfQogICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkgewoKICAgICAgICAgICAgbG9nRGVidWcoZGF0YSk7CiAgICAgICAgICAgIGlmICghZGF0YS5zdWNjZXNzKSB7CiAgICAgICAgICAgICAgICBsb2dEZWJ1ZygiZGVsZXRlIGxpbWl0X2lkIGVycm9yICsiICsgZGF0YS5tZXNzYWdlKTsKICAgICAgICAgICAgICAgIC8vIGlmIG5vdCBzdWNjZXNzZnVsLCBiaW5kIGVycm9ycyB0byBlcnJvciB2YXJpYWJsZXMKICAgICAgICAgICAgICAgIC8vCQkJICAkc2NvcGUuZXJyb3JOYW1lID0gZGF0YS5lcnJvcnMubmFtZTsKICAgICAgICAgICAgICAgIC8vCQkJICAkc2NvcGUuZXJyb3JTdXBlcmhlcm8gPSBkYXRhLmVycm9ycy5zdXBlcmhlcm9BbGlhczsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGxvZ0RlYnVnKCJkZWxldGUgbGltaXRfaWQgc3VjY2VzcyIpOwogICAgICAgICAgICAgICAgLy8gaWYgc3VjY2Vzc2Z1bCwgYmluZCBzdWNjZXNzIG1lc3NhZ2UgdG8gbWVzc2FnZQogICAgICAgICAgICAgICAgLy8JCQkgICRzY29wZS5tZXNzYWdlID0gZGF0YS5tZXNzYWdlOwogICAgICAgICAgICAgICAgJHNjb3BlLmRlbGV0ZUNhbGVuZGFySlNFdmVudChjYWxlbmRhciwgc2VsZWN0ZWRFdmVudC5pZCk7CgogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIGxvZ0RlYnVnKCJhZnRlciByZW1vdmUgZXZlbnQiKTsKICAgIH07Cn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdldmVudFJlY3VycmluZ0RldGFpbHNCdXNpbmVzc0NhbGVuZGFyTW9kYWxDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIHNlbGVjdGVkRXZlbnQsIHVpQ2FsZW5kYXJDb25maWcpIHsKICAgIHZhciBkYXlOYW1lcyA9IFsn16jXkNep15XXnycsICfXqdeg15knLCAn16nXnNeZ16nXmScsICfXqNeR15nXoteZJywgJ9eX157Xmdep15knLCAn16nXmdep15knLCAn16nXkdeqJ107CgogICAgJHNjb3BlLmdvdG9DbGllbnRQYWdlPSBmdW5jdGlvbiAoYnVzaW5lc3NVc2VyaWQpCiAgICB7CiAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICAgICAgZ290b0NsaWVudFBhZ2UoYnVzaW5lc3NVc2VyaWQpOwogICAgfQogICAgJHNjb3BlLmVkaXRFdmVudD0gZnVuY3Rpb24gKHRoZWV2ZW50KQogICAgewogICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgICAgIGdvdG9FdmVudFBhZ2UodGhlZXZlbnQpOwogICAgfQoKCiAgICBsb2dEZWJ1Zygic2VsZWN0ZWQgUmVjdXJyaW5nIEV2ZW50IGluZm8gPSIgKyBKU09OLnN0cmluZ2lmeShzZWxlY3RlZEV2ZW50LCBudWxsLCAyKSk7CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudCA9IHNlbGVjdGVkRXZlbnQ7CiAgICBzZWxlY3RlZERhdGVTdGFydCA9IG5ldyBEYXRlKHNlbGVjdGVkRXZlbnQuc3RhcnQpOwogICAgdmFyIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZSgpICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKCiAgICAvLyBsb2dEZWJ1Zygic2VsZWN0ZWRFdmVudC5zdGFydD0iICsgc2VsZWN0ZWRFdmVudC5zdGFydCk7CiAgICAvLyBsb2dEZWJ1ZygiZGF0ZT0iICsgc2VsZWN0ZWREYXRlU3RhcnQpOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycyA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldEhvdXJzKCk7CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBzZWxlY3RlZERhdGVTdGFydC5nZXRNaW51dGVzKCk7CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRvdyA9IGRheU5hbWVzW3NlbGVjdGVkRGF0ZVN0YXJ0LmdldERheSgpXTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF0ZSA9IHNlbGVjdGVkRGF0ZVN0YXJ0OwoKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0RGF5ID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RGF0ZSgpOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRNb250aCA9IDEgKyBzZWxlY3RlZERhdGVTdGFydC5nZXRNb250aCgpOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRNb250aFR4dCA9IG1vbnRoTmFtZXNbJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRNb250aCAtIDFdOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRZZWFyID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RnVsbFllYXIoKTsKCiAgICBzZWxlY3RlZERhdGVFbmQgPSBuZXcgRGF0ZShzZWxlY3RlZEV2ZW50LmVuZCk7CiAgICB2YXIgc2VsZWN0ZWREYXRlRW5kID0gbmV3IERhdGUoc2VsZWN0ZWREYXRlRW5kLmdldFRpbWUoKSArIHNlbGVjdGVkRGF0ZUVuZC5nZXRUaW1lem9uZU9mZnNldCgpICogNjAwMDApOwoKICAgIC8vIGxvZ0RlYnVnKCJzZWxlY3RlZEV2ZW50LmVuZD0iICsgc2VsZWN0ZWRFdmVudC5lbmQpOwogICAgLy8gbG9nRGVidWcoImRhdGU9IiArIHNlbGVjdGVkRGF0ZUVuZCk7CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycyA9IHNlbGVjdGVkRGF0ZUVuZC5nZXRIb3VycygpOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kZG93ID0gZGF5TmFtZXNbc2VsZWN0ZWREYXRlRW5kLmdldERheSgpXTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKSA8IDEwID8gJzAnIDogJycpICsgc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKTsKICAgICRzY29wZS5va0xpbWl0YXRpb25Nb2RhbCA9IGZ1bmN0aW9uKCkgewogICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICAgIH07Cgp9KTsKCmt1emVBcHAuY29udHJvbGxlcignZXZlbnREZXRhaWxzSG91cnNPZldvcmtNb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgc2VsZWN0ZWRFdmVudCwgZml4ZWRTY2hlZHVsZSwgdWlDYWxlbmRhckNvbmZpZykgewogICAgdmFyIGRheU5hbWVzID0gWyfXqNeQ16nXldefJywgJ9ep16DXmScsICfXqdec15nXqdeZJywgJ9eo15HXmdei15knLCAn15fXnteZ16nXmScsICfXqdeZ16nXmScsICfXqdeR16onXTsKCiAgICAvLyBsb2dEZWJ1Zygic2VsZWN0ZWQgRXZlbnQgPSIgKyBKU09OLnN0cmluZ2lmeShzZWxlY3RlZEV2ZW50LCBudWxsLCA0KSk7CiAgICAkc2NvcGUuZml4ZWRTY2hlZHVsZT1maXhlZFNjaGVkdWxlOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQgPSBzZWxlY3RlZEV2ZW50OwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQub3JpZ19ldmVudF90eXBlcyA9IGFuZ3VsYXIuY29weShzZWxlY3RlZEV2ZW50LmV2ZW50X3R5cGVzKTsKICAgICRzY29wZS5uZXdFdmVudERldGFpbHMgPSBbXTsKCiAgICBnZXRCdXNpbmVzc0xvY2F0aW9ucygkaHR0cCwkc2NvcGUsJ2J1c2luZXNzX2xvY2F0aW9ucycpOwoKICAgIGxvZ0RlYnVnKCJob3VycyBvZiB3b3JrIGJsb2NrL2V2ZW50IGNsaWNrZWQgIitKU09OLnN0cmluZ2lmeSgkc2NvcGUuc2VsZWN0ZWRFdmVudCkpOwoKICAgIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc2VsZWN0ZWRFdmVudC5zdGFydCk7CiAgICB2YXIgc2VsZWN0ZWREYXRlU3RhcnQgPSBuZXcgRGF0ZShzZWxlY3RlZERhdGVTdGFydC5nZXRUaW1lKCkgKyBzZWxlY3RlZERhdGVTdGFydC5nZXRUaW1lem9uZU9mZnNldCgpICogNjAwMDApOwogICAgZ2V0QWxsSW5zdHJ1Y3RvcnMoJGh0dHAsJHNjb3BlLCdpbnN0cnVjdG9ycycpOwogICAgZ2V0Tm9DbGFzc0V2ZW50VHlwZXNOb0FkbWluKCRodHRwLCRzY29wZSwncmVsYXRlZEV2ZW50VHlwZXMnLGdldE5vQ2xhc3NFdmVudFR5cGVzTm9BZG1pbl9zdWNjZXNzKTsKICAgIGZ1bmN0aW9uIGdldE5vQ2xhc3NFdmVudFR5cGVzTm9BZG1pbl9zdWNjZXNzKCkKICAgIHsKICAgICAgZm9yKHZhciBpID0gMDsgaSA8ICRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50X3R5cGVzLmxlbmd0aDsgaSsrKQogICAgICB7CiAgICAgICAgLy8gY29weWluZyB0aGUgYWN0dWFsIG9iamVjdCBvZiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5ldmVudF90eXBlc1tpXQogICAgICAgIGZvcih2YXIgaiA9IDA7IGogPCAkc2NvcGUucmVsYXRlZEV2ZW50VHlwZXMubGVuZ3RoOyBqKyspCiAgICAgICAgewogICAgICAgICAgaWYgKCRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50X3R5cGVzW2ldLmV2ZW50X3R5cGVfaWQ9PSRzY29wZS5yZWxhdGVkRXZlbnRUeXBlc1tqXS5ldmVudF90eXBlX2lkKQogICAgICAgICAgewogICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5ldmVudF90eXBlc1tpXT1hbmd1bGFyLmNvcHkoJHNjb3BlLnJlbGF0ZWRFdmVudFR5cGVzW2pdKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICAvLyBsb2dEZWJ1Zygic2VsZWN0ZWRFdmVudC5zdGFydD0iICsgc2VsZWN0ZWRFdmVudC5zdGFydCk7CiAgICAvLyBsb2dEZWJ1ZygiZGF0ZT0iICsgc2VsZWN0ZWREYXRlU3RhcnQpOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycyA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldEhvdXJzKCk7CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBzZWxlY3RlZERhdGVTdGFydC5nZXRNaW51dGVzKCk7CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRvdyA9IGRheU5hbWVzW3NlbGVjdGVkRGF0ZVN0YXJ0LmdldERheSgpXTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF0ZSA9IHNlbGVjdGVkRGF0ZVN0YXJ0OwoKICAgIHNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKHNlbGVjdGVkRXZlbnQuZW5kKTsKICAgIHZhciBzZWxlY3RlZERhdGVFbmQgPSBuZXcgRGF0ZShzZWxlY3RlZERhdGVFbmQuZ2V0VGltZSgpICsgc2VsZWN0ZWREYXRlRW5kLmdldFRpbWV6b25lT2Zmc2V0KCkgKiA2MDAwMCk7CgogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aCA9IG1vbnRoTmFtZXNbc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TW9udGgoKV07CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoMTEyID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TW9udGgoKSsxOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXlvZm1vbnRoID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RGF0ZSgpOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RnVsbFllYXIoKTsKICAgIC8vICRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZV9pbnB1dF9mb3JtYXQ9IG5ldyBEYXRlKDE5NzAsIDAsIDEsICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMsICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcywgMCk7CgogICAgLy8gbG9nRGVidWcoInNlbGVjdGVkRXZlbnQuZW5kPSIgKyBzZWxlY3RlZEV2ZW50LmVuZCk7CiAgICAvLyBsb2dEZWJ1ZygiZGF0ZT0iICsgc2VsZWN0ZWREYXRlRW5kKTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzID0gc2VsZWN0ZWREYXRlRW5kLmdldEhvdXJzKCk7CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRkb3cgPSBkYXlOYW1lc1tzZWxlY3RlZERhdGVFbmQuZ2V0RGF5KCldOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcyA9IChzZWxlY3RlZERhdGVFbmQuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBzZWxlY3RlZERhdGVFbmQuZ2V0TWludXRlcygpOwoKCiAgICAkc2NvcGUub2tMaW1pdGF0aW9uTW9kYWwgPSBmdW5jdGlvbigpIHsKICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgICB9OwoKICAgICRzY29wZS51cGRhdGVMaW1pdGF0aW9uTW9kYWwgPSBmdW5jdGlvbigpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJmdW5jdGlvbjogdXBkYXRlTGltaXRhdGlvbk1vZGFsIik7CiAgICAgIGlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5ldmVudF90eXBlcy5sZW5ndGg8MSkKICAgICAgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICBpZiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnM8JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykKICAgICAgewogICAgICAgIGFsZXJ0KCLXltee158g16HXmdeV150g15zXpNeg15kg15bXntefINeU16rXl9ec15QiKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgaWYgKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzPT0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKQogICAgICB7CiAgICAgICAgaWYgKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXM8PSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcykKICAgICAgICB7CiAgICAgICAgICBhbGVydCgi15bXntefINeh15nXldedINec16TXoNeZINeW157XnyDXlNeq15fXnNeUIik7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzPCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMrMTApKQogICAgICAgIHsKICAgICAgICAgIGFsZXJ0KCLXkdec15XXpyDXp9eY158g154tMTAg15PXp9eV16oiKTsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgIH0KCgogICAgICBmdW5jdGlvbiB1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25fc3VjY2VzcygpCiAgICAgIHsKICAgICAgICBjYWxlbmRhciA9ICdjYWxlbmRhcl9ob3Vyc19vZl93b3JrJzsKICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZWZldGNoRXZlbnRzJyk7IC8vIGdvIHRvIGRhdGUgaW4gY2FsZW5kYXIgZ290bwogICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoJ2RlbGV0ZScpOwogICAgICB9CgogICAgICBpZiAoJHNjb3BlLmZpeGVkU2NoZWR1bGUpCiAgICAgIHsKICAgICAgICAvLyBmaXhlZCBzY2hlZHVsZSAtIHVwYWR0aW5nIGxpbWl0YXRpb24gMTk3MAogICAgICAgIHRoZWRhdGEgPSB7CiAgICAgICAgICAgIHN0YXJ0X2RhdGU6IG5ld19zdGFydCwKICAgICAgICAgICAgZW5kX2RhdGU6IG5ld19lbmQsCiAgICAgICAgICAgIHRlbXBfbGltaXRfaWQ6IG51bGwsCiAgICAgICAgICAgIGxpbWl0X2lkOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5saW1pdF9pZCwKICAgICAgICAgICAgZXZlbnRfdHlwZXM6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50X3R5cGVzLAogICAgICAgICAgICBsb2NhdGlvbl9pZDogJHNjb3BlLnNlbGVjdGVkRXZlbnQubG9jYXRpb25faWQsCiAgICAgICAgICAgIG9yaWdfZXZlbnRfdHlwZXM6ICRzY29wZS5zZWxlY3RlZEV2ZW50Lm9yaWdfZXZlbnRfdHlwZXMsCiAgICAgICAgICAgIGVtcF9pZDogJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW1wX2lkCiAgICAgICAgfTsKICAgICAgICB1cGRhdGVDYWxlbmRhckxpbWl0YXRpb24oJGh0dHAsJHNjb3BlLHRoZWRhdGEsJHNjb3BlLnNlbGVjdGVkRXZlbnQubGltaXRfaWQsIHVwZGF0ZUNhbGVuZGFyTGltaXRhdGlvbl9zdWNjZXNzKTsKICAgICAgfQogICAgICBlbHNlCiAgICAgIC8vIG5vdCBmaXhlZCBzY2hlZHVsZSAtIHBlcmRheSBibG9jawogICAgICB7CiAgICAgICAgLy8vLy8vLy8vLy8KICAgICAgICBpZiAoKCRzY29wZS5zZWxlY3RlZEV2ZW50LmxpbWl0X2lkICE9IG51bGwpICYgKCRzY29wZS5zZWxlY3RlZEV2ZW50LmRheV9saW1pdF9pZCA9PSAtMSkpIC8vIGV2ZW50IGxpbWl0YXRpb24gaGFzIGxpbWl0X2lkIHNvIGl0cyBhbiAxOTcwIGV2ZW50CiAgICAgICAgLy8gbmVlZCB0byBhZGQgYSBuZXcgcGVyZGF5IGxpbWl0YXRpb24gdGhhdCBwb2ludCAobGltaXRfaWQpIHRvIHRoZSBvbGQgMTk3MCBldmVudCB0byByZXBsYWN0ZSBpdAogICAgICAgIHsKICAgICAgICAgICAgdGVtcF9saW1pdF9pZCA9IGNhbGNfdGVtcF9saW1pdF9pZCgpOwogICAgICAgICAgICAvLyB0aGVldmVudC50ZW1wX2xpbWl0X2lkID0gdGVtcF9saW1pdF9pZDsKICAgICAgICAgICAgLy8gdGhlZXZlbnQuZGF5X2xpbWl0X2lkID0gdGVtcF9saW1pdF9pZDsKICAgICAgICAgICAgLy8gdGhlIG1vdmVkIGV2ZW50IGluIHRoZSBjYWxlbmRhciBub3cgaGFzIGRheV9saW1pdF9pZCBhbmQgdGVtcF9saW1pdF9pZAogICAgICAgICAgICAvLyBpZiBpdHMgbG9hZGVkIGZyb20gdGhlIGRiLCBpdCB3aWxsIG9ubHkgaGF2ZSBkYXlfbGltaXRfaWQgKGFuZCBub3QgdGhlIHRlbXAgb25lKQogICAgICAgICAgICAvLyB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1snY2FsZW5kYXJfaG91cnNfb2Zfd29yayddLmZ1bGxDYWxlbmRhcigndXBkYXRlRXZlbnQnLCB0aGVldmVudCk7CiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJYWFhYWFhYWFhYWFhYIik7CiAgICAgICAgICAgIHRoZWRhdGEgPSB7CiAgICAgICAgICAgICAgICBzdGFydF9kYXRlOiBuZXdfc3RhcnQsCiAgICAgICAgICAgICAgICBlbmRfZGF0ZTogbmV3X2VuZCwKICAgICAgICAgICAgICAgIGNvbG9yOiAnJywKICAgICAgICAgICAgICAgIHRlbXBfbGltaXRfaWQ6IDAsCiAgICAgICAgICAgICAgICBldmVudF90eXBlX2lkOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5ldmVudF90eXBlX2lkLAogICAgICAgICAgICAgICAgZXZlbnRfdHlwZXM6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50X3R5cGVzLAogICAgICAgICAgICAgICAgbGltaXRfaWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmlkLAogICAgICAgICAgICAgICAgbG9jYXRpb25faWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmxvY2F0aW9uX2lkLAogICAgICAgICAgICAgICAgZW1wX2lkOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbXBfaWQKICAgICAgICAgICAgICAgIC8vIHRpdGxlOiB0aGVldmVudC50aXRsZQogICAgICAgICAgICB9OwogICAgICAgICAgICBjcmVhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXkoJGh0dHAsJHNjb3BlLHRoZWRhdGEsdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uX3N1Y2Nlc3MpOwoKICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgIHRoZWRhdGE9IHsKICAgICAgICAgICAgICBzdGFydF9kYXRlOiBuZXdfc3RhcnQsCiAgICAgICAgICAgICAgZW5kX2RhdGU6IG5ld19lbmQsCiAgICAgICAgICAgICAgdGVtcF9kYXlfbGltaXRfaWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LnRlbXBfbGltaXRfaWQsCiAgICAgICAgICAgICAgb3JpZ19ldmVudF90eXBlczogJHNjb3BlLnNlbGVjdGVkRXZlbnQub3JpZ19ldmVudF90eXBlcywKICAgICAgICAgICAgICBldmVudF90eXBlczogJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRfdHlwZXMsCiAgICAgICAgICAgICAgbG9jYXRpb25faWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmxvY2F0aW9uX2lkLAogICAgICAgICAgICAgIGRheV9saW1pdF9pZDogJHNjb3BlLnNlbGVjdGVkRXZlbnQuZGF5X2xpbWl0X2lkLAogICAgICAgICAgICAgIGVtcF9pZDogJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW1wX2lkCiAgICAgICAgICB9OwogICAgICAgICAgdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5KCRodHRwLCRzY29wZSx0aGVkYXRhLHVwZGF0ZUNhbGVuZGFyTGltaXRhdGlvbl9zdWNjZXNzKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgICRzY29wZS5kZWxldGVMaW1pdGF0aW9uTW9kYWwgPSBmdW5jdGlvbigpIHsKICAgICAgICBjYWxlbmRhciA9ICdjYWxlbmRhcl9ob3Vyc19vZl93b3JrJzsKCiAgICAgICAgLy8gcmVtb3ZpbmcgbGltaXRhdGlvbiBmcm9tIGRhdGFiYXNlLCBpZiB0cnVlIC0gcmVtb3ZpbmcgZnJvbSBkaXNwbGF5IGFsc28KICAgICAgICBpZiAoJHNjb3BlLmRlbGV0ZUNhbGVuZGFyREJMaW1pdGF0aW9uRXZlbnQoc2VsZWN0ZWRFdmVudCkpCiAgICAgICAgewogICAgICAgICAgLy8gJHNjb3BlLmRlbGV0ZUNhbGVuZGFySlNFdmVudChjYWxlbmRhciwgc2VsZWN0ZWRFdmVudC5pZCk7CiAgICAgICAgfQogICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoJ2RlbGV0ZScpOwogICAgfTsKICAgICRzY29wZS5kZWxldGVDYWxlbmRhckpTRXZlbnQgPSBmdW5jdGlvbihjYWxlbmRhciwgc2VsZWN0ZWRFdmVudGlkKSB7CgogICAgICAgIGxvZ0RlYnVnKCJjYWxlbmRhcl9ob3Vyc19vZl93b3JrX2NvbmZpZz0iICsgdWlDYWxlbmRhckNvbmZpZyk7CiAgICAgICAgbG9nRGVidWcoInVpQ2FsZW5kYXJDb25maWdbY2FsZW5kYXJdPSIgKyB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1snY2FsZW5kYXJfaG91cnNfb2Zfd29yayddKTsKICAgICAgICBsb2dEZWJ1ZygiZGVsZXRlIGpzIGV2ZW50ICIgKyBzZWxlY3RlZEV2ZW50aWQpOwogICAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlbW92ZUV2ZW50cycsIFtzZWxlY3RlZEV2ZW50aWRdKTsgLy8gZ28gdG8gZGF0ZSBpbiBjYWxlbmRhciBnb3RvCiAgICB9OwogICAgJHNjb3BlLmRlbGV0ZUNhbGVuZGFyREJMaW1pdGF0aW9uRXZlbnQgPSBmdW5jdGlvbihzZWxlY3RlZEV2ZW50KSB7CiAgICAgICAgY2FsZW5kYXIgPSAnY2FsZW5kYXJfaG91cnNfb2Zfd29yayc7CiAgICAgICAgLy8gcmV0dXJuIGZhbHNlOwoKICAgICAgICAvLyBkZWxldGluZyBldmVudCBsaW1pdGF0aW9uIChub3QgcGVyIGRheSkKICAgICAgICAvLyBlaXRoZXIgZnJvbSAxOTcwIChob3Vyc19vZl93b3JrIHBhZ2UpCiAgICAgICAgLy8gb3IgZnJvbSB0aGVpciBpbnN0YW5jZSBpbiB0aGUgY3VycmVudCB3ZWVrJ3MgbGltaXRhdGlvbi4KICAgICAgICAvLyBlaXRoZXIgd2F5IGRheV9saW1pdF9pZCBpcyAtMSBmb3IgbGltaXRhdGlvbnMgZnJvbSAxOTcwCiAgICAgICAgaWYgKHNlbGVjdGVkRXZlbnQuZGF5X2xpbWl0X2lkID09IC0xKQogICAgICAgIHsKICAgICAgICAgICAgbG9nRGVidWcoInJlbW92aW5nIGV2ZW50IGxpbWl0YXRpb24sIGNoZWNraWduIGlmIGl0cyBpbiAxOTcwICh0aGUgb3JpZ2luYWwpIG9yIGFuIGluc3RhbmNlIGluIHByZXNlbnQiKTsKICAgICAgICAgICAgc2VsZWN0ZWREYXRlU3RhcnQgPSBuZXcgRGF0ZShzZWxlY3RlZEV2ZW50LnN0YXJ0KTsKICAgICAgICAgICAgLy8gaWYgaXRzIDE5NzAgdGhpcyBtZWFucyB3ZSdyZSBpbiB0aGUgaG91cnNfb2Zfd29yayBnZW5lcmFsIHBhZ2UKICAgICAgICAgICAgLy8gc28gd2Ugc2ltcGx5IGRlbGV0ZSBpdAogICAgICAgICAgICBpZiAoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSA9PSAxOTcwKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBsb2dEZWJ1ZygicmVtb3ZpbmcgZXZlbnQgbGltaXRhdGlvbiBmcm9tIDE5NzAiKTsKICAgICAgICAgICAgICAgIHRoZWRhdGE9IHsKICAgICAgICAgICAgICAgICAgICB0ZW1wX2xpbWl0X2lkOiBzZWxlY3RlZEV2ZW50LnRlbXBfbGltaXRfaWQKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBkZWxldGVDYWxlbmRhckxpbWl0YXRpb24oJGh0dHAsJHNjb3BlLHRoZWRhdGEsc2VsZWN0ZWRFdmVudC5saW1pdF9pZCwgZGVsZXRlQ2FsZW5kYXJMaW1pdGF0aW9uX3N1Y2Nlc3MpOwogICAgICAgICAgICAgICAgZnVuY3Rpb24gZGVsZXRlQ2FsZW5kYXJMaW1pdGF0aW9uX3N1Y2Nlc3MoKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAkc2NvcGUuZGVsZXRlQ2FsZW5kYXJKU0V2ZW50KGNhbGVuZGFyLCBzZWxlY3RlZEV2ZW50LmlkKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIC8vIHJlbW92aW5nIGV2ZW50IGxpbWl0YXRpb24gZnJvbSB0aGUgYSBzcGVjaWZpYyB3ZWVrCiAgICAgICAgICAgICAgICAvLyB0aGlzIG1lYW5zIGFkZGluZyBldmVudCBsaW1pdGF0aW9uIHBlciBkYXkgd2l0aCByYW5nZSBlbmQ9c3RhcnQKICAgICAgICAgICAgICAgIC8vIG1heWJlIEJVRyBCVUdHWT8KICAgICAgICAgICAgICAgIGxvZ0RlYnVnKCJ4IHJlbW92aW5nIGV2ZW50IGxpbWl0YXRpb24gZnJvbSBhIHNwZWNpZmljIHdlZWssIHRoaXMgbWVhbnMgYWRkaW5nIGV2ZW50IGxpbWl0YXRpb24gcGVyIGRheSB3aXRoIHJhbmdlIDAtMCIpOwogICAgICAgICAgICAgICAgLy8gbG9nRGVidWcoSlNPTi5zdHJpbmdpZnkoc2VsZWN0ZWRFdmVudCkpOwoKICAgICAgICAgICAgICAgIHRoZWRhdGEgPSB7CiAgICAgICAgICAgICAgICAgICAgc3RhcnRfZGF0ZTogc2VsZWN0ZWRFdmVudC5zdGFydCwKICAgICAgICAgICAgICAgICAgICBlbmRfZGF0ZTogc2VsZWN0ZWRFdmVudC5zdGFydCwKICAgICAgICAgICAgICAgICAgICBjb2xvcjogIiMwMDAwMDAiLAogICAgICAgICAgICAgICAgICAgIHRlbXBfbGltaXRfaWQ6IDEsCiAgICAgICAgICAgICAgICAgICAgZXZlbnRfdHlwZV9pZDogc2VsZWN0ZWRFdmVudC5ldmVudF90eXBlX2lkLAogICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uX2lkOiBzZWxlY3RlZEV2ZW50LmxvY2F0aW9uX2lkLAogICAgICAgICAgICAgICAgICAgIGxpbWl0X2lkOiBzZWxlY3RlZEV2ZW50LmxpbWl0X2lkLAogICAgICAgICAgICAgICAgICAgIHRpdGxlOiBzZWxlY3RlZEV2ZW50LnRpdGxlCiAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgIGNyZWF0ZUNhbGVuZGFyTGltaXRhdGlvblBlckRheSgkaHR0cCwkc2NvcGUsdGhlZGF0YSxjcmVhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXlfc3VjY2Vzcyk7CiAgICAgICAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXlfc3VjY2VzcygpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICRzY29wZS5kZWxldGVDYWxlbmRhckpTRXZlbnQoY2FsZW5kYXIsIHNlbGVjdGVkRXZlbnQuaWQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgIC8vIGRlbGV0aW5nIGEgcGVyZGF5IGxpbWl0YXRpb24uCiAgICAgICAgICAgIC8vIGlmIGl0J3MgYSBwZXJkYXkgdGhhdCAicmVwbGFjZWQiIGEgMTk3MCBvbmUKICAgICAgICAgICAgLy8gdGhlbiB3ZSBjYW5ub3QgZGVsZXRlIGl0IChvdGhlcndpc2UgdGhlIG9yaWdpbmFsIDE5NzAgd2lsbCByZWFwcGVhcikKICAgICAgICAgICAgLy8gc28gd2Ugc2V0IGl0IHRvIHN0YXJ0PWVuZAogICAgICAgICAgICAvLyB0aGlzIG1heWJlIGEgQlVHIGFuZCBjYXVzZSBUUk9VQkxFIC8vIFRPRE8KICAgICAgICAgICAgLy8gb3RoZXdpc2Ugd2UgY2FuIGRlbGV0ZSBpdCAtIHRoZSBwZXJkYXkgLSBhcyBpdHMgYSBuZXcgcGVyZGF5IGFuZCBub3QgInJlcGxhY2luZyIgYSAxOTcwIG9uZQoKICAgICAgICAgICAgaWYgKHNlbGVjdGVkRXZlbnQubGltaXRfaWQgIT0gbnVsbCkgLy8gdGhpcyBpcyB0aGUgcGVyZGF5IHRoYXQgcmVwbGFjZXMgYSAxOTcwIG9uZSAtIHdlIHNldCBpdCB0byBzdGFydD1lbmQKICAgICAgICAgICAgewogICAgICAgICAgICAgIGxvZ0RlYnVnKCJyZW1vdmluZyBldmVudCBsaW1pdGF0aW9uIHBlciBkYXkgcmVsYXRlZCB0byAxOTcwICh1cGRhdGluZyBpdCB0byBzdGFydD1lbmQpIik7CgogICAgICAgICAgICAgIHRoZWRhdGE9IHsKICAgICAgICAgICAgICAgICAgc3RhcnRfZGF0ZTogc2VsZWN0ZWRFdmVudC5zdGFydCwKICAgICAgICAgICAgICAgICAgZW5kX2RhdGU6IHNlbGVjdGVkRXZlbnQuc3RhcnQsCiAgICAgICAgICAgICAgICAgIHRlbXBfZGF5X2xpbWl0X2lkOiBzZWxlY3RlZEV2ZW50LnRlbXBfbGltaXRfaWQsCiAgICAgICAgICAgICAgICAgIGRheV9saW1pdF9pZDogc2VsZWN0ZWRFdmVudC5kYXlfbGltaXRfaWQKICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIHVwZGF0ZUNhbGVuZGFyTGltaXRhdGlvblBlckRheSgkaHR0cCwkc2NvcGUsdGhlZGF0YSx1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXlfc3VjY2VzKTsKCiAgICAgICAgICAgICAgZnVuY3Rpb24gdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5X3N1Y2NlcygpCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJHNjb3BlLmRlbGV0ZUNhbGVuZGFySlNFdmVudChjYWxlbmRhciwgc2VsZWN0ZWRFdmVudC5pZCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgIC8vIHRoaXMgaXMgdGhlIGNhc2Ugd2hlcmUgdGhlIHBlcmRheSBkb2VzbnQgcmVwbGFjZSBhIDE5NzAgb25lLCB3ZSBjYW4gc2ltcGx5IGRlbGV0ZSBpdAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgbG9nRGVidWcoInJlbW92aW5nIGV2ZW50IGxpbWl0YXRpb24gcGVyIGRheSByZWxhdGVkIG5vdCByZWxhdGVkIHRvIDE5NzAgKHNvIHdlJ3JlIGRlbGV0aW5nIGl0KSIpOwogICAgICAgICAgICAgIHRoZWRhdGEgPSB7CiAgICAgICAgICAgICAgICAgIHRlbXBfbGltaXRfaWQ6IHNlbGVjdGVkRXZlbnQudGVtcF9saW1pdF9pZAogICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgZGVsZXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5KCRodHRwLCRzY29wZSx0aGVkYXRhLHNlbGVjdGVkRXZlbnQuZGF5X2xpbWl0X2lkLCBkZWxldGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXlfc3VjY2Vzcyk7CiAgICAgICAgICAgICAgZnVuY3Rpb24gZGVsZXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5X3N1Y2Nlc3MoKQogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICRzY29wZS5kZWxldGVDYWxlbmRhckpTRXZlbnQoY2FsZW5kYXIsIHNlbGVjdGVkRXZlbnQuaWQpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBsb2dEZWJ1ZygiYWZ0ZXIgcmVtb3ZlIGV2ZW50Iik7CgogICAgfTsKCgogICAgJHNjb3BlLnN0YXJ0TWludXRlcyA9IGZ1bmN0aW9uKCkKICAgIHsKICAgICAgbG9nRGVidWcoInN0YXJ0TWludXRlcyAiKygkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpKTsKICAgICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzPW1pbnV0ZXNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcyk7CiAgICAgIGNhbGN1bGF0ZVN0YXJ0VGltZSgpOwogICAgfQogICAgJHNjb3BlLnN0YXJ0SG91cnMgPSBmdW5jdGlvbigpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJzdGFydEhvdXJzICIraG91cnNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMpKTsKICAgICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3Vycz1ob3Vyc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3Vycyk7CiAgICAgIGNhbGN1bGF0ZVN0YXJ0VGltZSgpOwogICAgfQogICAgJHNjb3BlLmVuZE1pbnV0ZXMgPSBmdW5jdGlvbigpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJlbmRNaW51dGVzICIrKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpKTsKICAgICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcz1taW51dGVzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzKTsKICAgICAgY2FsY3VsYXRlRW5kVGltZSgpOwogICAgfQogICAgJHNjb3BlLmVuZEhvdXJzID0gZnVuY3Rpb24oKQogICAgewogICAgICBsb2dEZWJ1ZygiZW5kSG91cnMgIitob3Vyc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMpKTsKICAgICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnM9aG91cnNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzKTsKICAgICAgY2FsY3VsYXRlRW5kVGltZSgpOwogICAgfQoKCiAgICBmdW5jdGlvbiBjYWxjdWxhdGVTdGFydFRpbWUoKQogICAgewogICAgICBldmVudFllYXI9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyOwogICAgICBldmVudE1vbnRoPSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bW9udGgxMTI7CiAgICAgIGV2ZW50RGF5PSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aDsKICAgICAgaWYgKHBhcnNlSW50KGV2ZW50TW9udGgpPDEwKQogICAgICB7CiAgICAgICAgZXZlbnRNb250aD0iMCIrZXZlbnRNb250aDsKICAgICAgfQogICAgICBpZiAocGFyc2VJbnQoZXZlbnREYXkpPDEwKQogICAgICB7CiAgICAgICAgZXZlbnREYXk9IjAiK2V2ZW50RGF5OwogICAgICB9CgogICAgICBuZXdfc3RhcnQ9bW9tZW50LnV0YyhldmVudFllYXIrIi0iK2V2ZW50TW9udGgrIi0iK2V2ZW50RGF5KyJUMDA6MDA6MDAiKS5hZGQoKChwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKSo2MCkrcGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKSksICdtaW51dGVzJyk7CiAgICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZT1uZXdfc3RhcnQ7CiAgICAgIGxvZ0RlYnVnKCJuZXdfc3RhcnQ9IituZXdfc3RhcnQpOwogICAgfQogICAgZnVuY3Rpb24gY2FsY3VsYXRlRW5kVGltZSgpCiAgICB7CiAgICAgIGV2ZW50WWVhcj0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXI7CiAgICAgIGV2ZW50TW9udGg9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aDExMjsKICAgICAgZXZlbnREYXk9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXlvZm1vbnRoOwogICAgICBpZiAocGFyc2VJbnQoZXZlbnRNb250aCk8MTApCiAgICAgIHsKICAgICAgICBldmVudE1vbnRoPSIwIitldmVudE1vbnRoOwogICAgICB9CiAgICAgIGlmIChwYXJzZUludChldmVudERheSk8MTApCiAgICAgIHsKICAgICAgICBldmVudERheT0iMCIrZXZlbnREYXk7CiAgICAgIH0KCiAgICAgIG5ld19lbmQ9bW9tZW50LnV0YyhldmVudFllYXIrIi0iK2V2ZW50TW9udGgrIi0iK2V2ZW50RGF5KyJUMDA6MDA6MDAiKS5hZGQoKChwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycykqNjApK3BhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpKSwgJ21pbnV0ZXMnKTsKICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmRfdGltZT1uZXdfZW5kOwogICAgICBsb2dEZWJ1ZygibmV3X2VuZD0iK25ld19lbmQpOwogICAgfQoKICAgIGNhbGN1bGF0ZVN0YXJ0VGltZSgpOwogICAgY2FsY3VsYXRlRW5kVGltZSgpOwoKICAgIGZ1bmN0aW9uIG1pbnV0ZXNDaGFuZ2VkKHRoZW1pbnV0ZXMpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJ0aGVtaW51dGVzPSIrdGhlbWludXRlcyk7CiAgICAgIGlmICh0eXBlb2YgdGhlbWludXRlcz09InVuZGVmaW5lZCIpCiAgICAgIHsKICAgICAgICByZXR1cm4gIjAwIjsKICAgICAgfQogICAgICB0aGVtaW51dGVzPXBhcnNlSW50KHRoZW1pbnV0ZXMpOwogICAgICBpZiAodGhlbWludXRlcz42MCkKICAgICAgewogICAgICAgIHJldHVybiAiMDAiOwogICAgICB9CiAgICAgIGVsc2UgaWYgKHRoZW1pbnV0ZXM8MCkKICAgICAgewogICAgICAgIHJldHVybiAiMDAiOwogICAgICB9CiAgICAgIGVsc2UgaWYgKHRoZW1pbnV0ZXM9PSIiKQogICAgICB7CiAgICAgICAgcmV0dXJuICIwMCI7CiAgICAgIH0KICAgICAgZWxzZSBpZiAodGhlbWludXRlczwxMCkKICAgICAgewogICAgICAgIHJldHVybiAiMCIrdGhlbWludXRlczsKICAgICAgfQogICAgICBlbHNlCiAgICAgIHsKICAgICAgICAgIHJldHVybiB0aGVtaW51dGVzOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBob3Vyc0NoYW5nZWQodGhlaG91cnMpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJ0aGVob3Vycz0iK3RoZWhvdXJzKTsKICAgICAgaWYgKHR5cGVvZiB0aGVob3Vycz09InVuZGVmaW5lZCIpCiAgICAgIHsKICAgICAgICByZXR1cm4gIjAiOwogICAgICB9CiAgICAgIHRoZWhvdXJzPXBhcnNlSW50KHRoZWhvdXJzKTsKICAgICAgaWYgKHRoZWhvdXJzPjI0KQogICAgICB7CiAgICAgICAgcmV0dXJuIDA7CiAgICAgIH0KICAgICAgZWxzZSBpZiAodGhlaG91cnM8MCkKICAgICAgewogICAgICAgIHJldHVybiAwOwogICAgICB9CiAgICAgIGVsc2UgaWYgKHRoZWhvdXJzPT0iIikKICAgICAgewogICAgICAgIHJldHVybiAiMCI7CiAgICAgIH0KICAgICAgZWxzZQogICAgICB7CiAgICAgICAgICByZXR1cm4gdGhlaG91cnM7CiAgICAgIH0KICAgIH0KCn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignRXZlbnRUeXBlc0NvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkY29tcGlsZSwgdWlDYWxlbmRhckNvbmZpZywgJHVpYk1vZGFsLCRsb2NhdGlvbikgewogICAgbG9nRGVidWcoJ0V2ZW50VHlwZXMgQ29udHJvbGxlcicpOwoKICAgIGdldEFsbEJ1c2luZXNzRXZlbnRUeXBlcygkaHR0cCwkc2NvcGUsJ2V2ZW50X3R5cGVzJyk7CiAgICAkc2NvcGUuc2hvd0V2ZW50VHlwZSA9IGZ1bmN0aW9uICh0aGVFdmVudCkKICAgIHsKICAgICAgJGxvY2F0aW9uLnBhdGgoJy9ldmVudF90eXBlcy8nK3RoZUV2ZW50LmV2ZW50X3R5cGVfaWQpOwogICAgfQp9KTsKCmt1emVBcHAuY29udHJvbGxlcignRXZlbnRUeXBlTmV3Q29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRjb21waWxlLCB1aUNhbGVuZGFyQ29uZmlnLCAkdWliTW9kYWwsICRsb2NhdGlvbikgewogICAgbG9nRGVidWcoJ0V2ZW50VHlwZXMgQ29udHJvbGxlciBOZXcnKTsKCiAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcyA9IHt9OyAvLyB0aGVzZSBhcmUgdGhlIGNvbXBsZXRlIGRldGFpbHMgZm9yIHRoZSBuZXcgZXZlbnQgLy8KICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmlzX2NsYXNzID0gMDsKICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmJsb2NrRXh0cmFUaW1lID0gZmFsc2U7CiAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5kdXJhdGlvbl9iZWZvcmVfZXZlbnQgPSAwOwogICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZHVyYXRpb25fYWZ0ZXJfZXZlbnQgPSAwOwogICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuaW5oZXJpdF9tYWluX2hvdXJzID0gMTsKICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF93YWl0aW5nX2xpc3QgPSAzOwogICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuaXNfdXBkYXRlID0gZmFsc2U7CiAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5tYXhfcGFydGljaXBhbnRzID0gMTsKICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF9yZWdpc3RyYXRpb25zPTE7CiAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5pc19wdWJsaWM9MTsKICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmluc3RydWN0b3JfaWQ9MDsKCiAgICAkc2NvcGUuZXZlbnRDb2xvclN0eWxlID0ge307CiAgICBkZWZhdWx0Q29sb3IgPSAnMDBhNjVhJzsKICAgICRzY29wZS5ldmVudENvbG9yU3R5bGVbZGVmYXVsdENvbG9yXSA9IHsKICAgICAgICAndHJhbnNmb3JtJzogJ3JvdGF0ZSgzMGRlZyknCiAgICB9OwogICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXZlbnRDb2xvciA9ICIjIiArIGRlZmF1bHRDb2xvcjsKICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzID0gWwogICAgICB7ImZpZWxkX25hbWUiOiLXodeZ15vXldedINee16TXktepIiwiZmllbGRfZGF0YXR5cGUiOiJURVhUX0FSRUEiLCJpc19tYW5kYXRvcnkiOjAsICJmcm9tZGIiOiBmYWxzZSwgImRiX2lkX3RvZml4IjogMCwgImlzX2FjdGl2ZSI6IDEsICJtb2RpZmllZCI6IGZhbHNlfSwKICAgICAgeyJmaWVsZF9uYW1lIjoi16nXmdei15XXqNeZINeR15nXqiIsImZpZWxkX2RhdGF0eXBlIjoiVEVYVF9BUkVBIiwiaXNfbWFuZGF0b3J5IjowLCAiZnJvbWRiIjogZmFsc2UsICJkYl9pZF90b2ZpeCI6IDAsICJpc19hY3RpdmUiOiAxLCAibW9kaWZpZWQiOiBmYWxzZX0KICAgIF07CgogICAgZ2V0QWxsSW5zdHJ1Y3RvcnMoJGh0dHAsJHNjb3BlLCdpbnN0cnVjdG9ycycsZ2V0QWxsSW5zdHJ1Y3RvcnNfc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBnZXRBbGxJbnN0cnVjdG9yc19zdWNjZXNzKCkKICAgIHsKICAgICAgLy8gJHNjb3BlLmluc3RydWN0b3JzLnVuc2hpZnQoe2J1c2luZXNzX3VzZXJfaWQ6MCwgYnVzZXJfZmlyc3RfbmFtZToiIiwgYnVzZXJfbGFzdF9uYW1lOiIifSk7CiAgICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmluc3RydWN0b3JfaWQ9JHNjb3BlLmluc3RydWN0b3JzWzBdLmJ1c2luZXNzX3VzZXJfaWQ7CiAgICB9CgogICAgJHNjb3BlLmV2ZW50VHlwZUV4dHJhRmllbGRzUG9wID0gZnVuY3Rpb24oZXZlbnRUeXBlUHJvcGVydGllcykgewogICAgICAgIGxvZ0RlYnVnKCJldmVudCBjcmVhdGUgbW9kYWwiKTsKCiAgICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgICAgICAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2V2ZW50X3R5cGVfZXh0cmFfZmllbGRzLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdldmVudFR5cGVFeHRyYUZpZWxkc01vZGFsQ29udHJvbGxlcicsCiAgICAgICAgICAgIHNpemU6ICdsJywKICAgICAgICAgICAgcmVzb2x2ZTogewogICAgICAgICAgICAgICAgZXZlbnRUeXBlUHJvcGVydGllczogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGV2ZW50VHlwZVByb3BlcnRpZXM7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgbW9kYWxJbnN0YW5jZS5yZXN1bHQudGhlbihmdW5jdGlvbihzZWxlY3RlZEl0ZW0pIHsKICAgICAgICAgICAgbG9nRGVidWcoc2VsZWN0ZWRJdGVtKTsKICAgICAgICAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyA9IHNlbGVjdGVkSXRlbTsKICAgICAgICB9LCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgbG9nRGVidWcoJ01vZGFsIGRpc21pc3NlZCBhdDogJyArIG5ldyBEYXRlKCkpOwogICAgICAgIH0pOwogICAgfTsKCiAgICAkc2NvcGUuY2hhbmdlRXZlbnRDb2xvciA9IGZ1bmN0aW9uKG5ld0NvbG9yKSB7CiAgICAgICAgbG9nRGVidWcoImNob29zaW5nIGNvbG9yICIgKyBuZXdDb2xvcik7CiAgICAgICAgJHNjb3BlLmV2ZW50Q29sb3IgPSBuZXdDb2xvcjsKICAgICAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5ldmVudENvbG9yID0gIiMiICsgbmV3Q29sb3I7CiAgICAgICAgJHNjb3BlLmV2ZW50Q29sb3JTdHlsZSA9IHsKICAgICAgICAgICAgJ2JhY2tncm91bmQtY29sb3InOiAiIyIgKyBuZXdDb2xvcgogICAgICAgIH07CiAgICAgICAgJHNjb3BlLmV2ZW50Q29sb3JTdHlsZVtuZXdDb2xvcl0gPSB7CiAgICAgICAgICAgICd0cmFuc2Zvcm0nOiAncm90YXRlKDMwZGVnKScKICAgICAgICB9OwoKICAgIH0KCiAgICAkc2NvcGUuYWRkRXZlbnRUeXBlQ2FuY2VsID0gZnVuY3Rpb24oKSB7CiAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9ldmVudF90eXBlcycpOwogICAgfTsKCiAgICAkc2NvcGUuYWRkRXZlbnRUeXBlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgbG9nRGVidWcoImFkZCBFdmVudCBUeXBlIiArICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzICsgImV4dHJhIGZpZWxkcz0iICskc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyk7CiAgICAgICAgaWYgKCgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5tYXhfcmVnaXN0cmF0aW9ucz09JycpIHx8ICghJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMubWF4X3JlZ2lzdHJhdGlvbnMpKQogICAgICAgIHsKICAgICAgICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF9yZWdpc3RyYXRpb25zPTA7CiAgICAgICAgfQogICAgICAgIGFkZEV2ZW50VHlwZSgkaHR0cCwkc2NvcGUsJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMsYWRkRXZlbnRUeXBlX3N1Y2Nlc3MpOwogICAgICAgIGZ1bmN0aW9uIGFkZEV2ZW50VHlwZV9zdWNjZXNzKCkKICAgICAgICB7CiAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2V2ZW50X3R5cGVzJyk7CiAgICAgICAgfQogICAgfTsKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ0V2ZW50VHlwZVVwZGF0ZUNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkY29tcGlsZSwgJHJvdXRlUGFyYW1zLCB1aUNhbGVuZGFyQ29uZmlnLCAkdWliTW9kYWwsICRsb2NhdGlvbikgewogICAgZXZlbnRfdHlwZV9pZD0kcm91dGVQYXJhbXMuZXZlbnRfdHlwZV9pZDsKICAgIGxvZ0RlYnVnKCdFdmVudFR5cGVzIENvbnRyb2xsZXIgVXBkYXRlICcrZXZlbnRfdHlwZV9pZCk7CgogICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMgPSB7fTsgLy8gdGhlc2UgYXJlIHRoZSBjb21wbGV0ZSBkZXRhaWxzIGZvciB0aGUgbmV3IGV2ZW50IC8vCiAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5pc191cGRhdGUgPSB0cnVlOwoKICAgICRzY29wZS5ldmVudENvbG9yU3R5bGUgPSB7fTsKICAgIGdldEFsbEluc3RydWN0b3JzKCRodHRwLCRzY29wZSwnaW5zdHJ1Y3RvcnMnLGdldEFsbEluc3RydWN0b3JzX3N1Y2Nlc3MpOwogICAgZnVuY3Rpb24gZ2V0QWxsSW5zdHJ1Y3RvcnNfc3VjY2VzcygpCiAgICB7CiAgICAgICRzY29wZS5pbnN0cnVjdG9ycy51bnNoaWZ0KHtidXNpbmVzc191c2VyX2lkOm51bGwsIGJ1c2VyX2ZpcnN0X25hbWU6IiIsIGJ1c2VyX2xhc3RfbmFtZToiIn0pOwogICAgfQoKICAgIGdldEJ1c2luZXNzRXZlbnRUeXBlKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuZXZlbnRfdHlwZV9pZCwnZXZlbnRUeXBlUHJvcGVydGllcycsZ2V0QnVzaW5lc3NFdmVudFR5cGVfc3VjY2Vzcyk7CgogICAgZnVuY3Rpb24gZ2V0QnVzaW5lc3NFdmVudFR5cGVfc3VjY2VzcygpCiAgICB7CiAgICAgICAgaWYgKCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF9yZWdpc3RyYXRpb25zPT1udWxsKQogICAgICAgIHsKICAgICAgICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF9yZWdpc3RyYXRpb25zPTE7CiAgICAgICAgfQogICAgICAgIGlmICgoJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZHVyYXRpb25fYmVmb3JlX2V2ZW50PjApIHwgKCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmR1cmF0aW9uX2FmdGVyX2V2ZW50PjApKQogICAgICAgIHsKICAgICAgICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmJsb2NrRXh0cmFUaW1lID0gMTsKICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmJsb2NrRXh0cmFUaW1lID0gMDsKICAgICAgICB9CiAgICAgICAgLy8gJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuaW5oZXJpdF9tYWluX2hvdXJzID0gcmVzcG9uc2UuZGF0YVswXS5pbmhlcml0X21haW5faG91cnM7CiAgICAgICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuaXNfdXBkYXRlID0gdHJ1ZTsKICAgICAgICBsb2dEZWJ1ZygiJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuY29sb3I9Iiskc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5jb2xvcik7CiAgICAgICAgJHNjb3BlLmV2ZW50Q29sb3JTdHlsZVskc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5jb2xvcl0gPSB7CiAgICAgICAgICAgICd0cmFuc2Zvcm0nOiAncm90YXRlKDMwZGVnKScKICAgICAgICB9OwogICAgICAgICRzY29wZS5jaGFuZ2VFdmVudENvbG9yKCgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5jb2xvcikuc3Vic3RyKDEpKTsKICAgICAgICBsb2dEZWJ1ZygiJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuaW5zdHJ1Y3Rvcl9pZD0iKyRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmluc3RydWN0b3JfaWQpOwogICAgICAgIC8vIHNhdmluZyBldmVudCB0eXBlIGRldGFpbHMgYXNpZGUgdG8gbGF0ZXIgY2hlY2sgaWYgYW55dGhpbmcgY2hhbmdlZAogICAgICAgIGxvZ0RlYnVnKCJkdXBsaWNhdGluZyBvYmplY3Qgb2YgZXZlbnQgdHlwZSB0byBsYXRlciBjb21wYXJlICIrdHlwZW9mICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzKTsKICAgICAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllc0R1cGxpY2F0ZSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMpKTsKICAgICAgICBsb2dEZWJ1ZygiJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXNEdXBsaWNhdGUgPSIrJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXNEdXBsaWNhdGUuZXZlbnRfdHlwZV9uYW1lKTsKICAgIH07CgogICAgLy8gZXZlbnQgdHlwZSBjaGFuZ2VkIHBvcHVwCiAgICAkc2NvcGUuZXZlbnRUeXBlQ2hhbmdlZFBvcHVwID0gZnVuY3Rpb24oZXZlbnRUeXBlUHJvcGVydGllcykgewogICAgICAgIGxvZ0RlYnVnKCJldmVudCBjcmVhdGUgbW9kYWwiKTsKCiAgICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgICAgICAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2V2ZW50X3R5cGVfY2hhbmdlZC5waHAnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnZXZlbnRUeXBlQ2hhbmdlZFBvcHVwQ29udHJvbGxlcicsCiAgICAgICAgICAgIHNpemU6ICdsJywKICAgICAgICAgICAgcmVzb2x2ZTogewogICAgICAgICAgICAgICAgZXZlbnRUeXBlUHJvcGVydGllczogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIG1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24oc2VsZWN0ZWRJdGVtKQogICAgICAgIHsKICAgICAgICAgICAgbG9nRGVidWcoc2VsZWN0ZWRJdGVtKTsKICAgICAgICAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyA9IHNlbGVjdGVkSXRlbTsKICAgICAgICB9LCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgbG9nRGVidWcoJ01vZGFsIGRpc21pc3NlZCBhdDogJyArIG5ldyBEYXRlKCkpOwogICAgICAgIH0pOwogICAgfTsKCiAgICAvLyBldmVudCB0eXBlIGV4dHJhIGZpZWxkIHBvcHVwCiAgICAkc2NvcGUuZXZlbnRUeXBlRXh0cmFGaWVsZHNQb3AgPSBmdW5jdGlvbihldmVudFR5cGVQcm9wZXJ0aWVzKSB7CiAgICAgICAgbG9nRGVidWcoImV2ZW50IGNyZWF0ZSBtb2RhbCIpOwoKICAgICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAgICAgICAgICAgYW5pbWF0aW9uOiBmYWxzZSwKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfZXZlbnRfdHlwZV9leHRyYV9maWVsZHMucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ2V2ZW50VHlwZUV4dHJhRmllbGRzTW9kYWxDb250cm9sbGVyJywKICAgICAgICAgICAgc2l6ZTogJ2wnLAogICAgICAgICAgICByZXNvbHZlOiB7CiAgICAgICAgICAgICAgICBldmVudFR5cGVQcm9wZXJ0aWVzOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXZlbnRUeXBlUHJvcGVydGllczsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBtb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHNlbGVjdGVkSXRlbSkgewogICAgICAgICAgICBsb2dEZWJ1ZyhzZWxlY3RlZEl0ZW0pOwogICAgICAgICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzID0gc2VsZWN0ZWRJdGVtOwogICAgICAgIH0sIGZ1bmN0aW9uKCkgewogICAgICAgICAgICBsb2dEZWJ1ZygnTW9kYWwgZGlzbWlzc2VkIGF0OiAnICsgbmV3IERhdGUoKSk7CiAgICAgICAgfSk7CiAgICB9OwoKCiAgICAkc2NvcGUuY2hhbmdlRXZlbnRDb2xvciA9IGZ1bmN0aW9uKG5ld0NvbG9yKSB7CiAgICAgICAgbG9nRGVidWcoImNob29zaW5nIGNvbG9yICIgKyBuZXdDb2xvcik7CiAgICAgICAgJHNjb3BlLmV2ZW50Q29sb3IgPSBuZXdDb2xvcjsKICAgICAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5ldmVudENvbG9yID0gIiMiICsgbmV3Q29sb3I7CiAgICAgICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuY29sb3IgPSAiIyIgKyBuZXdDb2xvcjsKICAgICAgICAkc2NvcGUuZXZlbnRDb2xvclN0eWxlID0gewogICAgICAgICAgICAnYmFja2dyb3VuZC1jb2xvcic6ICIjIiArIG5ld0NvbG9yCiAgICAgICAgfTsKICAgICAgICAkc2NvcGUuZXZlbnRDb2xvclN0eWxlW25ld0NvbG9yXSA9IHsKICAgICAgICAgICAgJ3RyYW5zZm9ybSc6ICdyb3RhdGUoMzBkZWcpJwogICAgICAgIH07CgogICAgfQoKICAgICRzY29wZS5hZGRFdmVudFR5cGVDYW5jZWwgPSBmdW5jdGlvbigpIHsKICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2V2ZW50X3R5cGVzJyk7CiAgICB9OwoKICAgICRzY29wZS5hZGRFdmVudFR5cGUgPSBmdW5jdGlvbigpIHsgLy8gdGhpcyBmdW5jdGlvbiBVUERBVEVTIGV2ZW50IHR5cGUgKG5vdCBhZGRzKQogICAgICAvLyBjaGVja2luZyBpZiBhbnl0aGluZyBjaGFuZ2VkIHJlYWxseQogICAgICAvLyBhbmQgYXNraW5nIGlmIHdlIHNob3VsZCB1cGRhdGUgYWxsIGV2ZW50cyBmcm9tIG5vdyAob3Igb25seSBuZXdseSBjcmVhdGVkIGV2ZW50cykKICAgICAgLy8gY2hlY2tpbmcKICAgICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXNEdXBsaWNhdGUuZXh0cmFGaWVsZHM9JHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHM7CiAgICAgIGlmIChhbmd1bGFyLmVxdWFscygkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllc0R1cGxpY2F0ZSwkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcykpCiAgICAgIHsKICAgICAgICAvLyAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllc0R1cGxpY2F0ZS5leHRyYUZpZWxkcyA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMpKTsKCiAgICAgICAgbG9nRGVidWcoIm5vdGhpbmcgY2hhbmdlZCBpbiBldmVudCB0eXBlLCBvciBvbmx5IGV4dHJhIGZpZWxkcyIpOwogICAgICAgICRzY29wZS51cGRhdGVFdmVudFR5cGUoKTsKICAgICAgfQogICAgICBlbHNlCiAgICAgIHsKICAgICAgICBsb2dEZWJ1ZygiZXZlbnQgdHlwZSBjaGFuZ2VkIik7CiAgICAgICAgJHNjb3BlLmV2ZW50VHlwZUNoYW5nZWRQb3B1cCgpOwogICAgICB9CiAgICAgIC8vICRzY29wZS51cGRhdGVFdmVudFR5cGUoKTsKICAgIH0KICAgICRzY29wZS51cGRhdGVFdmVudFR5cGUgPSBmdW5jdGlvbigpCiAgICB7CiAgICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLnVwZGF0ZV9leGlzdGluZ19ldmVudHM9ZmFsc2U7CgogICAgICBsb2dEZWJ1ZygidXBkYXRlIEV2ZW50IFR5cGUgIiArICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV2ZW50X3R5cGVfaWQpOwogICAgICBpZiAoJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMubWF4X3JlZ2lzdHJhdGlvbnM9PScnKQogICAgICB7CiAgICAgICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMubWF4X3JlZ2lzdHJhdGlvbnM9MDsKICAgICAgfQogICAgICB1cGRhdGVFdmVudFR5cGUoJGh0dHAsJHNjb3BlLCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV2ZW50X3R5cGVfaWQsJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMsdXBkYXRlRXZlbnRUeXBlX3N1Y2Nlc3MpOwogICAgICBmdW5jdGlvbiB1cGRhdGVFdmVudFR5cGVfc3VjY2VzcygpCiAgICAgIHsKICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2V2ZW50X3R5cGVzJyk7CiAgICAgIH0KICAgIH0KfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdldmVudENyZWF0ZU1vZGFsQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRyb290U2NvcGUsIHNoYXJlZFByb3BlcnRpZXMsIGV2ZW50X3R5cGVfaWQsIGxvY2F0aW9uX2lkLCBlbXBfaWQsICRodHRwLCBzdGFydERhdGUsIHJlc2NoZWR1bGVfZXZlbnQsIHVpQ2FsZW5kYXJDb25maWcpIHsKICAgIHN0YXJ0RGF0ZT1uZXcgbW9tZW50KHN0YXJ0RGF0ZSk7CiAgICBsb2dEZWJ1ZygiZXZlbnRDcmVhdGVNb2RhbENvbnRyb2xsZXIsIHN0YXJ0RGF0ZT0iK3N0YXJ0RGF0ZSsiIHR5cGUgIit0eXBlb2Ygc3RhcnREYXRlKTsKICAgIGxvZ0RlYnVnKCJldmVudENyZWF0ZU1vZGFsQ29udHJvbGxlciwgcmVzY2hlZHVsZV9ldmVudD0iK3Jlc2NoZWR1bGVfZXZlbnQpOwoKICAgICRzY29wZS5ldmVudFR5cGVUaXRsZSA9ICLXkdeX16gg16HXldeSINee16TXktepIjsKICAgICRzY29wZS5zaG93RXZlbnRUeXBlU2VsZWN0ZWQgPSBmYWxzZTsKICAgICRzY29wZS5zaG93RXZlbnRDbGllbnRTZWxlY3RlZCA9IGZhbHNlOwogICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscyA9IHt9OyAvLyB0aGVzZSBhcmUgdGhlIGNvbXBsZXRlIGRldGFpbHMgZm9yIHRoZSBuZXcgZXZlbnQgLy8KICAgICRzY29wZS5uZXdFdmVudERldGFpbHMucmVwZWF0VHlwZSA9ICJmb3JldmVyIjsKICAgICRzY29wZS5uZXdFdmVudERldGFpbHMucmVwZWF0Rml4ZWRUaW1lcyA9ICI0IjsKICAgICRzY29wZS5uZXdFdmVudERldGFpbHMubWF4X3BhcnRpY2lwYW50cyA9IDE7CgogICAgbG9nRGVidWcoIlhYWCA9ICIrSlNPTi5zdHJpbmdpZnkocmVzY2hlZHVsZV9ldmVudCkpOwoKICAgICRzY29wZS5yZXNjaGVkdWxlX2V2ZW50PWZhbHNlOwogICAgJHNjb3BlLnJlc2NoZWR1bGVfZXZlbnRfZGV0YWlscz1yZXNjaGVkdWxlX2V2ZW50OwogICAgaWYgKCRzY29wZS5yZXNjaGVkdWxlX2V2ZW50X2RldGFpbHMhPW51bGwpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJyZXNjaGVkdWxlX2V2ZW50X2RldGFpbHM9Iiskc2NvcGUucmVzY2hlZHVsZV9ldmVudF9kZXRhaWxzLmV2ZW50X2lkKTsKICAgICAgbG9nRGVidWcoSlNPTi5zdHJpbmdpZnkoJHNjb3BlLnJlc2NoZWR1bGVfZXZlbnRfZGV0YWlscykpOwogICAgICAkc2NvcGUucmVzY2hlZHVsZV9ldmVudD10cnVlOwogICAgICAkc2NvcGUuZ2l2ZW5fZXZlbnRfdHlwZV9pZCA9ICRzY29wZS5yZXNjaGVkdWxlX2V2ZW50X2RldGFpbHMuZXZlbnRfdHlwZV9pZDsKICAgICAgLy8gc3RpbGwgcHJlZmVyaW5nIGVtcF9pZCBmcm9tIHNjaGVkdWxlciBzdWdnZXN0aW9uIGlzIGl0IHdhcyBzZWxlY3RlZAogICAgICBpZiAoZW1wX2lkIT0wKQogICAgICB7CiAgICAgICAgJHNjb3BlLmdpdmVuX2VtcF9pZCA9IGVtcF9pZDsKICAgICAgfQogICAgICBlbHNlCiAgICAgIHsKICAgICAgICAkc2NvcGUuZ2l2ZW5fZW1wX2lkID0gJHNjb3BlLnJlc2NoZWR1bGVfZXZlbnRfZGV0YWlscy5pbnN0cnVjdG9yX2lkOwogICAgICB9CiAgICAgIC8vIHN0aWxsIHByZWZlcmluZyBsb2NhdGlvbl9pZCBmcm9tIHNjaGVkdWxlciBzdWdnZXN0aW9uIG92ZXIgdGhlIG9yaWdpbmFsIGxvY2F0aW9uIGZyb20gZXZlbnQKICAgICAgaWYgKGxvY2F0aW9uX2lkIT0wKQogICAgICB7CiAgICAgICAgJHNjb3BlLmdpdmVuX2xvY2F0aW9uX2lkID0gbG9jYXRpb25faWQ7CiAgICAgIH0KICAgICAgZWxzZQogICAgICB7CiAgICAgICAgJHNjb3BlLmdpdmVuX2xvY2F0aW9uX2lkID0gJHNjb3BlLnJlc2NoZWR1bGVfZXZlbnRfZGV0YWlscy5sb2NhdGlvbl9pZDsKICAgICAgfQogICAgfQogICAgZWxzZQogICAgewogICAgICAkc2NvcGUuZ2l2ZW5fZXZlbnRfdHlwZV9pZCA9IGV2ZW50X3R5cGVfaWQ7CiAgICAgICRzY29wZS5naXZlbl9sb2NhdGlvbl9pZCA9IGxvY2F0aW9uX2lkOwogICAgICAkc2NvcGUuZ2l2ZW5fZW1wX2lkID0gZW1wX2lkOwogICAgfQogICAgaWYgKCRzY29wZS5naXZlbl9ldmVudF90eXBlX2lkPjApCiAgICB7CiAgICAgICRzY29wZS5wcmV2aW91c2x5X3NlbGVjdGVkX2V2ZW50X3R5cGU9dHJ1ZTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgJHNjb3BlLnByZXZpb3VzbHlfc2VsZWN0ZWRfZXZlbnRfdHlwZT1mYWxzZTsKICAgIH0KICAgIGxvZ0RlYnVnKCIkc2NvcGUuZ2l2ZW5fZXZlbnRfdHlwZV9pZD0iKyRzY29wZS5naXZlbl9ldmVudF90eXBlX2lkKTsKCiAgICBzZWxlY3RlZERhdGVTdGFydCA9IG5ldyBEYXRlKHN0YXJ0RGF0ZSk7CiAgICBsb2dEZWJ1Zygic2VsZWN0ZWREYXRlU3RhcnQgPSAiK3NlbGVjdGVkRGF0ZVN0YXJ0KTsKICAgIHZhciBzZWxlY3RlZERhdGVTdGFydCA9IG5ldyBEYXRlKHNlbGVjdGVkRGF0ZVN0YXJ0LmdldFRpbWUoKSArIHNlbGVjdGVkRGF0ZVN0YXJ0LmdldFRpbWV6b25lT2Zmc2V0KCkgKiA2MDAwMCk7CgogICAgLy8gbG9nRGVidWcoImRhdGU9IiArIHNlbGVjdGVkRGF0ZVN0YXJ0KTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50ID0gW107CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0SG91cnMoKTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcyA9IChzZWxlY3RlZERhdGVTdGFydC5nZXRNaW51dGVzKCkgPCAxMCA/ICcwJyA6ICcnKSArIHNlbGVjdGVkRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZG93ID0gZGF5TmFtZXNbc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RGF5KCldOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXRlID0gc2VsZWN0ZWREYXRlU3RhcnQ7CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoID0gbW9udGhOYW1lc1tzZWxlY3RlZERhdGVTdGFydC5nZXRNb250aCgpXTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bW9udGgxMTIgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRNb250aCgpKzE7CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRheW9mbW9udGggPSBzZWxlY3RlZERhdGVTdGFydC5nZXREYXRlKCk7CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXIgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRGdWxsWWVhcigpOwogICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5zdGFydF90aW1lX2lucHV0X2Zvcm1hdD0gbmV3IERhdGUoMTk3MCwgMCwgMSwgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycywgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzLCAwKTsKCiAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmluc3RydWN0b3JfaWQgPSAkc2NvcGUuZ2l2ZW5fZW1wX2lkOwogICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5sb2NhdGlvbl9pZCA9ICRzY29wZS5naXZlbl9sb2NhdGlvbl9pZDsKCiAgICBnZXRCdXNpbmVzc0xvY2F0aW9ucygkaHR0cCwkc2NvcGUsJ2J1c2luZXNzX2xvY2F0aW9ucycsZ2V0QnVzaW5lc3NMb2NhdGlvbnNfZmluaXNoKTsKICAgIGZ1bmN0aW9uIGdldEJ1c2luZXNzTG9jYXRpb25zX2ZpbmlzaCgpCiAgICB7CiAgICAgIGlmICgkc2NvcGUubmV3RXZlbnREZXRhaWxzLmxvY2F0aW9uX2lkPT0wKQogICAgICB7CiAgICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5sb2NhdGlvbl9pZD0kc2NvcGUuYnVzaW5lc3NfbG9jYXRpb25zWzBdLmxvY2F0aW9uX2lkOwogICAgICB9CiAgICB9CgogICAgY29uc29sZS5sb2coIiRzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZD0iKyRzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZCk7CiAgICAvLyBpZiBjbGllbnQgd2FzIHByZXZpb3VzbHkgc2VsZWN0ZWQKICAgICRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyPWZhbHNlOwogICAgbG9nRGVidWcoInNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXI9IitzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKTsKICAgIGlmIChzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkhPW51bGwpCiAgICB7CiAgICAgIC8vIGNvbnNvbGUubG9nKCJnb3QgcHJldmlvdXMgc2VsZWN0ZWQgdXNlciAiK3NoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKS5idXNlcl9maXJzdF9uYW1lKTsKICAgICAgJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJuYW1lPXNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKS5idXNlcl9maXJzdF9uYW1lKyIgIitzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfbGFzdF9uYW1lOwogICAgICAkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcj10cnVlOwoKICAgICAgJHNjb3BlLnNob3dFdmVudENsaWVudFNlbGVjdGVkID0gdHJ1ZTsKICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmR1c2VyX2lkID0gc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2luZXNzX3VzZXJfaWQ7CiAgICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kdXNlcl9maXJzdF9uYW1lID0gc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2VyX2ZpcnN0X25hbWU7CiAgICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kdXNlcl9sYXN0X25hbWUgPSBzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfbGFzdF9uYW1lOwogICAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmJ1c2luZXNzX3VzZXJfaWQgPSBzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzaW5lc3NfdXNlcl9pZDsKCiAgICB9CiAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWUgPSBzdGFydERhdGU7CiAgICBsb2dEZWJ1ZygiJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5zdGFydF90aW1lMT0iKyRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZSk7CiAgICAkc2NvcGUuc3RhcnRNaW51dGVzID0gZnVuY3Rpb24oKQogICAgewogICAgICBsb2dEZWJ1Zygic3RhcnRNaW51dGVzICIrKCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcykpOwogICAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXM9bWludXRlc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKTsKICAgICAgY2FsY3VsYXRlU3RhcnRUaW1lKCk7CiAgICAgIGNhbGN1bGF0ZUVuZFRpbWVEeW5hbWljKCk7CiAgICB9CiAgICAkc2NvcGUuc3RhcnRIb3VycyA9IGZ1bmN0aW9uKCkKICAgIHsKICAgICAgbG9nRGVidWcoInN0YXJ0SG91cnMgIitob3Vyc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykpOwogICAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzPWhvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKTsKICAgICAgY2FsY3VsYXRlU3RhcnRUaW1lKCk7CiAgICAgIGNhbGN1bGF0ZUVuZFRpbWVEeW5hbWljKCk7CiAgICB9CgogICAgJHNjb3BlLmVuZE1pbnV0ZXMgPSBmdW5jdGlvbigpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJlbmRNaW51dGVzICIrKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpKTsKICAgICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcz1taW51dGVzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzKTsKICAgICAgY2FsY3VsYXRlU3RhcnRUaW1lKCk7CiAgICAgIGNhbGN1bGF0ZUVuZFRpbWVEeW5hbWljKCk7CiAgICB9CiAgICAkc2NvcGUuZW5kSG91cnMgPSBmdW5jdGlvbigpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJlbmRIb3VycyAiK2hvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycykpOwogICAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vycz1ob3Vyc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMpOwogICAgICBjYWxjdWxhdGVTdGFydFRpbWUoKTsKICAgICAgY2FsY3VsYXRlRW5kVGltZUR5bmFtaWMoKTsKICAgIH0KCiAgICBmdW5jdGlvbiBjYWxjdWxhdGVTdGFydFRpbWUoKQogICAgewogICAgICBldmVudFllYXI9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyOwogICAgICBldmVudE1vbnRoPSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bW9udGgxMTI7CiAgICAgIGV2ZW50RGF5PSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aDsKICAgICAgaWYgKHBhcnNlSW50KGV2ZW50TW9udGgpPDEwKQogICAgICB7CiAgICAgICAgZXZlbnRNb250aD0iMCIrZXZlbnRNb250aDsKICAgICAgfQogICAgICBpZiAocGFyc2VJbnQoZXZlbnREYXkpPDEwKQogICAgICB7CiAgICAgICAgZXZlbnREYXk9IjAiK2V2ZW50RGF5OwogICAgICB9CiAgICAgIGxvZ0RlYnVnKCIkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXI9IitldmVudFllYXIpOwogICAgICBsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXlvZm1vbnRoPSIrZXZlbnRNb250aCk7CiAgICAgIGxvZ0RlYnVnKCIkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoPSIrZXZlbnREYXkpOwogICAgICBuZXdfc3RhcnQ9bW9tZW50LnV0YyhldmVudFllYXIrIi0iK2V2ZW50TW9udGgrIi0iK2V2ZW50RGF5KyJUMDA6MDA6MDAiKS5hZGQoKChwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKSo2MCkrcGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKSksICdtaW51dGVzJyk7CiAgICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZT1uZXdfc3RhcnQ7CiAgICAgIGxvZ0RlYnVnKCJuZXdfc3RhcnQ9IituZXdfc3RhcnQpOwogICAgfQogICAgZnVuY3Rpb24gbWludXRlc0NoYW5nZWQodGhlbWludXRlcykKICAgIHsKICAgICAgbG9nRGVidWcoInRoZW1pbnV0ZXM9Iit0aGVtaW51dGVzKTsKICAgICAgaWYgKHR5cGVvZiB0aGVtaW51dGVzPT0idW5kZWZpbmVkIikKICAgICAgewogICAgICAgIHJldHVybiAiMDAiOwogICAgICB9CiAgICAgIGlmIChpc05hTih0aGVtaW51dGVzKSkKICAgICAgewogICAgICAgIHJldHVybiAiMDAiOwogICAgICB9CiAgICAgIGlmICh0aGVtaW51dGVzPT0nJykKICAgICAgewogICAgICAgIHJldHVybiAiMDAiOwogICAgICB9CiAgICAgIHRoZW1pbnV0ZXM9cGFyc2VJbnQodGhlbWludXRlcyk7CiAgICAgIGlmICh0aGVtaW51dGVzPjYwKQogICAgICB7CiAgICAgICAgcmV0dXJuICIwMCI7CiAgICAgIH0KICAgICAgZWxzZSBpZiAodGhlbWludXRlczwwKQogICAgICB7CiAgICAgICAgcmV0dXJuICIwMCI7CiAgICAgIH0KICAgICAgZWxzZSBpZiAodGhlbWludXRlcz09IiIpCiAgICAgIHsKICAgICAgICByZXR1cm4gIjAwIjsKICAgICAgfQogICAgICBlbHNlIGlmICh0aGVtaW51dGVzPDEwKQogICAgICB7CiAgICAgICAgcmV0dXJuICIwIit0aGVtaW51dGVzOwogICAgICB9CiAgICAgIGVsc2UKICAgICAgewogICAgICAgICAgcmV0dXJuIHRoZW1pbnV0ZXM7CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIGhvdXJzQ2hhbmdlZCh0aGVob3VycykKICAgIHsKICAgICAgbG9nRGVidWcoInRoZWhvdXJzPSIrdGhlaG91cnMpOwogICAgICBpZiAodHlwZW9mIHRoZWhvdXJzPT0idW5kZWZpbmVkIikKICAgICAgewogICAgICAgIHJldHVybiAiMCI7CiAgICAgIH0KICAgICAgaWYgKGlzTmFOKHRoZWhvdXJzKSkKICAgICAgewogICAgICAgIHJldHVybiAiMCI7CiAgICAgIH0KICAgICAgaWYgKHRoZWhvdXJzPT0nJykKICAgICAgewogICAgICAgIHJldHVybiAiMCI7CiAgICAgIH0KICAgICAgdGhlaG91cnM9cGFyc2VJbnQodGhlaG91cnMpOwogICAgICBpZiAodGhlaG91cnM+MjQpCiAgICAgIHsKICAgICAgICByZXR1cm4gMDsKICAgICAgfQogICAgICBlbHNlIGlmICh0aGVob3VyczwwKQogICAgICB7CiAgICAgICAgcmV0dXJuIDA7CiAgICAgIH0KICAgICAgZWxzZSBpZiAodGhlaG91cnM9PSIiKQogICAgICB7CiAgICAgICAgcmV0dXJuICIwIjsKICAgICAgfQogICAgICBlbHNlCiAgICAgIHsKICAgICAgICAgIHJldHVybiB0aGVob3VyczsKICAgICAgfQogICAgfQogICAgZ2V0QWxsSW5zdHJ1Y3RvcnMoJGh0dHAsJHNjb3BlLCdpbnN0cnVjdG9ycycsZ2V0QWxsSW5zdHJ1Y3RvcnNfc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBnZXRBbGxJbnN0cnVjdG9yc19zdWNjZXNzKCkKICAgIHsKICAgICAgLy8gJHNjb3BlLmluc3RydWN0b3JzLnVuc2hpZnQoe2J1c2luZXNzX3VzZXJfaWQ6bnVsbCwgYnVzZXJfZmlyc3RfbmFtZToiIiwgYnVzZXJfbGFzdF9uYW1lOiIifSk7CiAgICAgIGlmICghJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pbnN0cnVjdG9yX2lkPjApCiAgICAgIHsKICAgICAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmluc3RydWN0b3JfaWQ9JHNjb3BlLmluc3RydWN0b3JzWzBdLmJ1c2luZXNzX3VzZXJfaWQ7CiAgICAgIH0KICAgIH0KCiAgICAkc2NvcGUuc2VsZWN0RXZlbnRUeXBlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgLy8gcmVtb3ZpbmcgZXZlbnQgdHlwZSDXkdeX16gg16HXldeSINee16TXktepCiAgICAgICAgaWYgKCRzY29wZS5ldmVudFR5cGVPcHRpb25zWzBdLmV2ZW50X3R5cGVfaWQ9PTApCiAgICAgICAgewogICAgICAgICAgJHNjb3BlLmV2ZW50VHlwZU9wdGlvbnMuc3BsaWNlKDAsIDEpOwogICAgICAgIH0KICAgICAgICAkc2NvcGUuYWpheF9lcnJvcj0nJzsKICAgICAgICBjaG9pY2U9JHNjb3BlLnNlbGVjdEV2ZW50VHlwZVNlbGVjdGVkOwogICAgICAgIGxvZ0RlYnVnKCJzZWxlY3RFdmVudFR5cGUiKTsKICAgICAgICBsb2dEZWJ1ZyhKU09OLnN0cmluZ2lmeSgkc2NvcGUuc2VsZWN0RXZlbnRUeXBlU2VsZWN0ZWQpKTsKICAgICAgICAkc2NvcGUuZXZlbnRUeXBlVGl0bGUgPSBjaG9pY2UuZXZlbnRfdHlwZV9uYW1lOwogICAgICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuZXZlbnRfdHlwZV9pZCA9IGNob2ljZS5ldmVudF90eXBlX2lkOwoKICAgICAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmV2ZW50X25hbWUgPSBjaG9pY2UuZXZlbnRfdHlwZV9uYW1lOwogICAgICAgICRzY29wZS5uZXdFdmVudERldGFpbHMub3JpZ2luYWxfZXZlbnRfbmFtZSA9IGNob2ljZS5ldmVudF90eXBlX25hbWU7CiAgICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5ldmVudF9kZXNjcmlwdGlvbiA9IGNob2ljZS5ldmVudF90eXBlX2Rlc2NyaXB0aW9uOwogICAgICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuaXNfY2xhc3MgPSBjaG9pY2UuaXNfY2xhc3M7CiAgICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5vcmlnaW5hbF9wcmljZSA9IGNob2ljZS5vcmlnaW5hbF9wcmljZTsKICAgICAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmlzX2dlbmVyaWNfZXR5cGUgPSBjaG9pY2UuaXNfZ2VuZXJpY19ldHlwZTsKICAgICAgICAvLyAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmluc3RydWN0b3JfaWQgPSBjaG9pY2UuaW5zdHJ1Y3Rvcl9pZDsKICAgICAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50ID0gY2hvaWNlLmR1cmF0aW9uX2V2ZW50OwogICAgICAgIC8vIGxvZ0RlYnVnKCJzY29wZS5uZXdFdmVudERldGFpbHMuaXNfY2xhc3M9Iiskc2NvcGUubmV3RXZlbnREZXRhaWxzLmlzX2NsYXNzKTsKICAgICAgICAvLyBsb2dEZWJ1Zygic2NvcGUubmV3RXZlbnREZXRhaWxzLmluc3RydWN0b3JfaWQ9Iiskc2NvcGUubmV3RXZlbnREZXRhaWxzLmluc3RydWN0b3JfaWQpOwogICAgICAgIC8vIGxvZ0RlYnVnKCJzdGFydERhdGU9IitzdGFydERhdGUpOwogICAgICAgIC8vICRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZSA9IHN0YXJ0RGF0ZTsKICAgICAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmV2ZW50dHlwZSA9IGNob2ljZTsKICAgICAgICBjYWxjdWxhdGVFbmRUaW1lKCk7CgogICAgICAgIC8vICRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZV9pbnB1dF9mb3JtYXQ9IG5ldyBEYXRlKDE5NzAsIDAsIDEsIDE0LCA1NywgMCk7CgogICAgICAgIGxvZ0RlYnVnKCJuZXdFdmVudCBzdGFydD0iICsgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5zdGFydF90aW1lKTsKICAgICAgICBsb2dEZWJ1ZygibmV3RXZlbnQgZW5kPSIgKyAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZF90aW1lKTsKCiAgICAgICAgJHNjb3BlLnNob3dFdmVudFR5cGVTZWxlY3RlZCA9IHRydWU7CiAgICB9CgogICAgLy8gdGhpcyBmdW5jdGlvbiBjYWxjdWxhdGVzIGVuZCB0aW1lIGFjY29yZGluZyB0byB0aGUgbGVuZ3RoIG9mIHRoZSBldmVudHR5cGUKICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZUVuZFRpbWUoKQogICAgewogICAgICBjb25zb2xlLmxvZygiJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5zdGFydF90aW1lPSIrJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5zdGFydF90aW1lKTsKICAgICAgZW5kID0gbW9tZW50KCRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZSkuYWRkKCRzY29wZS5uZXdFdmVudERldGFpbHMuZHVyYXRpb25fZXZlbnQsICdtaW51dGVzJyk7CiAgICAgIHNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKGVuZCk7CiAgICAgIHNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKHNlbGVjdGVkRGF0ZUVuZC5nZXRUaW1lKCkgKyBzZWxlY3RlZERhdGVFbmQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKICAgICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMgPSBzZWxlY3RlZERhdGVFbmQuZ2V0SG91cnMoKTsKICAgICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kZG93ID0gZGF5TmFtZXNbc2VsZWN0ZWREYXRlRW5kLmdldERheSgpXTsKICAgICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcyA9IChzZWxlY3RlZERhdGVFbmQuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBzZWxlY3RlZERhdGVFbmQuZ2V0TWludXRlcygpOwogICAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZF90aW1lID0gZW5kOwogICAgICAvLyBjYWxjdWxhdGluZyBkdXJhdGlvbgogICAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50PXBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpLXBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcyk7CiAgICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuZHVyYXRpb25fZXZlbnQ9JHNjb3BlLm5ld0V2ZW50RGV0YWlscy5kdXJhdGlvbl9ldmVudCsocGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMpLXBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMpKSo2MDsKICAgICAgaWYgKCRzY29wZS5uZXdFdmVudERldGFpbHMuZHVyYXRpb25fZXZlbnQ8MCkKICAgICAgewogICAgICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuZHVyYXRpb25fZXZlbnQ9MDsKICAgICAgfQogICAgfQoKICAgIC8vIHRoaXMgZnVuY3Rpb24gY2FsY3VsYXRlcyBlbmQgdGltZSBhY2NvcmRpbmcgdG8gdGhlIGlucHV0IGZyb20gbW9kYWwgd2luZG93CiAgICAvLyBhbmQgbm90IGFjY29yZGluZyB0byBldmVudCB0eXBlIGxlbmd0aAogICAgZnVuY3Rpb24gY2FsY3VsYXRlRW5kVGltZUR5bmFtaWMoKQogICAgewogICAgICBldmVudFllYXI9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyOwogICAgICBldmVudE1vbnRoPSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bW9udGgxMTI7CiAgICAgIGV2ZW50RGF5PSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aDsKICAgICAgaWYgKHBhcnNlSW50KGV2ZW50TW9udGgpPDEwKQogICAgICB7CiAgICAgICAgZXZlbnRNb250aD0iMCIrZXZlbnRNb250aDsKICAgICAgfQogICAgICBpZiAocGFyc2VJbnQoZXZlbnREYXkpPDEwKQogICAgICB7CiAgICAgICAgZXZlbnREYXk9IjAiK2V2ZW50RGF5OwogICAgICB9CiAgICAgIGxvZ0RlYnVnKCIkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXI9IitldmVudFllYXIpOwogICAgICBsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXlvZm1vbnRoPSIrZXZlbnRNb250aCk7CiAgICAgIGxvZ0RlYnVnKCIkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoPSIrZXZlbnREYXkpOwogICAgICBuZXdfZW5kPW1vbWVudC51dGMoZXZlbnRZZWFyKyItIitldmVudE1vbnRoKyItIitldmVudERheSsiVDAwOjAwOjAwIikuYWRkKCgocGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMpKjYwKStwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzKSksICdtaW51dGVzJyk7CiAgICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kX3RpbWU9bmV3X2VuZDsKICAgICAgbG9nRGVidWcoIm5ld19lbmQ9IituZXdfZW5kKTsKICAgICAgLy8gY2FsY3VsYXRpbmcgZHVyYXRpb24KICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5kdXJhdGlvbl9ldmVudD1wYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzKS1wYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpOwogICAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50PSRzY29wZS5uZXdFdmVudERldGFpbHMuZHVyYXRpb25fZXZlbnQrKHBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzKS1wYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKSkqNjA7CiAgICAgIGlmICgkc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50PDApCiAgICAgIHsKICAgICAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50PTA7CiAgICAgIH0KICAgIH0KICAgIGdldEFsbEJ1c2luZXNzRXZlbnRUeXBlcygkaHR0cCwkc2NvcGUsJ2V2ZW50VHlwZU9wdGlvbnMnLGdldEFsbEJ1c2luZXNzRXZlbnRUeXBlc19zdWNjZXNzKTsKICAgIGZ1bmN0aW9uIGdldEFsbEJ1c2luZXNzRXZlbnRUeXBlc19zdWNjZXNzKCkKICAgIHsKICAgICAgLy8gYWZ0ZXIgbG9hZGluZyBldmVudCB0eXBlcywgaWYgdGhlIGdpdmVuIGV2ZW50IHR5cGUgaXMgIT0gMCB3ZSAic2VsZWN0IiBpdAogICAgICBjb25zb2xlLmxvZygiZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzX3N1Y2Nlc3MiKTsKICAgICAgaWYgKCRzY29wZS5naXZlbl9ldmVudF90eXBlX2lkPjApCiAgICAgIHsKICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgJHNjb3BlLmV2ZW50VHlwZU9wdGlvbnMubGVuZ3RoOyBpKyspCiAgICAgICAgewogICAgICAgICAgaWYgKCRzY29wZS5ldmVudFR5cGVPcHRpb25zW2ldLmV2ZW50X3R5cGVfaWQ9PSRzY29wZS5naXZlbl9ldmVudF90eXBlX2lkKQogICAgICAgICAgewogICAgICAgICAgICBjb25zb2xlLmxvZygiZ2l2ZW5fZXZlbnRfdHlwZV9pZCBmb3VuZCIpOwogICAgICAgICAgICAvLyAkc2NvcGUuY2FsY3VsYXRlU3RhcnRUaW1lKCk7CiAgICAgICAgICAgICRzY29wZS5zZWxlY3RFdmVudFR5cGVTZWxlY3RlZD0kc2NvcGUuZXZlbnRUeXBlT3B0aW9uc1tpXTsKICAgICAgICAgICAgLy8gJHNjb3BlLnNlbGVjdEV2ZW50VHlwZSgkc2NvcGUuZXZlbnRUeXBlT3B0aW9uc1tpXSk7CiAgICAgICAgICAgICRzY29wZS5zZWxlY3RFdmVudFR5cGUoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgZWxzZSB7CiAgICAgICAgJHNjb3BlLmV2ZW50VHlwZU9wdGlvbnMudW5zaGlmdCh7ImV2ZW50X3R5cGVfaWQiOjAsICJldmVudF90eXBlX25hbWUiOiLXkdeX16gg16HXldeSINee16TXktepIiwgaXNfdmFjYXRpb246IDB9KTsKICAgICAgICAkc2NvcGUuc2VsZWN0RXZlbnRUeXBlU2VsZWN0ZWQ9JHNjb3BlLmV2ZW50VHlwZU9wdGlvbnNbMF07CiAgICAgIH0KICAgIH0KICAgIGdldEFsbENsaWVudHMoJGh0dHAsJHNjb3BlLCdldmVudFR5cGVVc2VycycpOwoKICAgICRzY29wZS5ldmVudENsaWVudFNlbGVjdGVkID0gZnVuY3Rpb24oc2VsZWN0ZWQpIHsKICAgICAgICBpZiAoc2VsZWN0ZWQpIHsKICAgICAgICAgICAgLy8gYWxlcnQoSlNPTi5zdHJpbmdpZnkoIHNlbGVjdGVkLCBudWxsLCAyICkpOwogICAgICAgICAgICBsb2dEZWJ1ZygnY2xpZW50IHNlbGVjdGVkICcgKyBzZWxlY3RlZC5vcmlnaW5hbE9iamVjdC5idXNlcl9maXJzdF9uYW1lKTsKICAgICAgICAgICAgJHNjb3BlLnNob3dFdmVudENsaWVudFNlbGVjdGVkID0gdHJ1ZTsKICAgICAgICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmR1c2VyX2lkID0gc2VsZWN0ZWQub3JpZ2luYWxPYmplY3QuYnVzaW5lc3NfdXNlcl9pZDsKICAgICAgICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmR1c2VyX2ZpcnN0X25hbWUgPSBzZWxlY3RlZC5vcmlnaW5hbE9iamVjdC5idXNlcl9maXJzdF9uYW1lOwogICAgICAgICAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZHVzZXJfbGFzdF9uYW1lID0gc2VsZWN0ZWQub3JpZ2luYWxPYmplY3QuYnVzZXJfbGFzdF9uYW1lOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGxvZ0RlYnVnKCdub3Qgc2VsZWN0ZWQnKTsKICAgICAgICAgICAgLy8gJHNjb3BlLmV2ZW50Q2xpZW50RGVTZWxlY3RlZCgpOwogICAgICAgIH0KICAgIH07CiAgICAkc2NvcGUuZXZlbnRDbGllbnREZVNlbGVjdGVkID0gZnVuY3Rpb24oKSB7CiAgICAgICAgJHNjb3BlLnNob3dFdmVudENsaWVudFNlbGVjdGVkID0gZmFsc2U7CiAgICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmR1c2VyX2lkID0gbnVsbDsKICAgICAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZHVzZXJfZmlyc3RfbmFtZSA9IG51bGw7CiAgICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmR1c2VyX2xhc3RfbmFtZSA9IG51bGw7CiAgICAgICAgJHNjb3BlLmNsZWFyQ2xpZW50SW5wdXQoJ2NsaWVudF9hbmd1Y29tcGxldGUnKTsKICAgIH0KCiAgICAkc2NvcGUuY2xlYXJDbGllbnRJbnB1dCA9IGZ1bmN0aW9uKGlkKSB7CiAgICAgICAgaWYgKGlkKSB7CiAgICAgICAgICAgICRzY29wZS4kYnJvYWRjYXN0KCdhbmd1Y29tcGxldGUtYWx0OmNsZWFySW5wdXQnLCBpZCk7CiAgICAgICAgfQogICAgICAgIC8vIGVsc2V7CiAgICAgICAgLy8gICAkc2NvcGUuJGJyb2FkY2FzdCgnYW5ndWNvbXBsZXRlLWFsdDpjbGVhcklucHV0Jyk7CiAgICAgICAgLy8gfQogICAgfQoKICAgICRzY29wZS5jYW5jZWwgPSBmdW5jdGlvbigpIHsKICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgICB9OwoKICAgICRzY29wZS51cGRhdGVFdmVudE5hbWVDaGVjayA9IGZ1bmN0aW9uKG5ld1ZhbHVlKQogICAgewogICAgICBsb2dEZWJ1ZygidXBkYXRlRXZlbnROYW1lPSIrbmV3VmFsdWUpOwogICAgICBpZiAobmV3VmFsdWU9PSIiKQogICAgICB7CiAgICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5ldmVudF9uYW1lID0gJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5vcmlnaW5hbF9ldmVudF9uYW1lOwogICAgICB9CiAgICB9CiAgICAvLyByZXNjaGVkdWxlRXZlbnQKICAgICRzY29wZS5yZXNjaGVkdWxlRXZlbnQgPSBmdW5jdGlvbigpIHsKICAgICAgbG9nRGVidWcoImZ1bmN0aW9uOiByZXNjaGVkdWxlRXZlbnQiKTsKCiAgICAgIC8vIG5ld0V2ZW50SlNPTkRldGFpbHMgPSBKU09OLnN0cmluZ2lmeSgkc2NvcGUubmV3RXZlbnREZXRhaWxzLCBudWxsLCA0KTsgLy8gKE9wdGlvbmFsKSBiZWF1dGlmdWwgaW5kZW50ZWQgb3V0cHV0LgogICAgICBsb2dEZWJ1ZygicmVzY2hlZHVsZUV2ZW50LCAiICsgSlNPTi5zdHJpbmdpZnkoJHNjb3BlLm5ld0V2ZW50RGV0YWlscywgbnVsbCwgNCkpOwogICAgICAvLyBpZiAoJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5ldmVudFJlY3VycmluZykgewogICAgICAvLyAgIGNyZWF0ZVJlY3VycmluZ0V2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUubmV3RXZlbnREZXRhaWxzLGNyZWF0ZVJlY3VycmluZ0V2ZW50X3N1Y2Nlc3MpOwogICAgICAvLyAgIGZ1bmN0aW9uIGNyZWF0ZVJlY3VycmluZ0V2ZW50X3N1Y2Nlc3MoKQogICAgICAvLyAgIHsKICAgICAgLy8gICAgIGNhbGVuZGFyID0gImNhbGVuZGFyX2J1c2luZXNzIjsKICAgICAgLy8gICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKICAgICAgLy8gICAgICR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoKTsKICAgICAgLy8gICAgIC8vIGVycm9yIHdhcwogICAgICAvLyAgICAgLy8gbG9nRGVidWcoImVycm9yICIgKyBkYXRhLk1lc3NhZ2UpOwogICAgICAvLyAgICAgLy8gJHNjb3BlLmFqYXhfZXJyb3IgPSBkYXRhLk1lc3NhZ2U7CiAgICAgIC8vICAgfQogICAgICAvLyB9CiAgICAgIC8vIGVsc2UKICAgICAgewogICAgICAgIC8vIGlmIGV2ZW50IGlzIG5vdCBjbGFzcywgYSBjbGllbnQgbXVzdCBiZSBzZWxlY3RlZAogICAgICAgIC8vIGlmICgoISRzY29wZS5zaG93RXZlbnRDbGllbnRTZWxlY3RlZCkgJiYgKCEkc2NvcGUubmV3RXZlbnREZXRhaWxzLmlzX2NsYXNzKSkKICAgICAgICAvLyB7CiAgICAgICAgLy8gICAvLyBhbGVydCgnY2xpZW50IG11c3QgYmUgc2VsZWN0ZWQnKTsKICAgICAgICAvLyAgICRzY29wZS5hamF4X2Vycm9yPSLXkNeg15Ag15TXldeh16Mg157Xqdeq16rXoyDXnNee16TXktepIjsKICAgICAgICAvLyAgIHJldHVybjsKICAgICAgICAvLyB9CiAgICAgICAgcmVzY2hlZHVsZUV2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUucmVzY2hlZHVsZV9ldmVudF9kZXRhaWxzLmV2ZW50X2lkLCRzY29wZS5uZXdFdmVudERldGFpbHMscmVzY2hlZHVsZUV2ZW50X3N1Y2Nlc3MpOwogICAgICAgIGZ1bmN0aW9uIHJlc2NoZWR1bGVFdmVudF9zdWNjZXNzKCkKICAgICAgICB7CiAgICAgICAgICBjYWxlbmRhciA9ICJjYWxlbmRhcl9idXNpbmVzcyI7CiAgICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZWZldGNoRXZlbnRzJyk7CiAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NhbGVuZGFyRXZlbnRSZXNjaGVkdWxlRGVzZWxlY3QnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKICAgICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoJ2FkZGVkJyk7CiAgICAgICAgfQogICAgICAgIC8vIG9uIGZhaWx1cmUgd2FzCiAgICAgICAgLy8gJHNjb3BlLmFqYXhfZXJyb3IgPSBkYXRhLk1lc3NhZ2U7CiAgICAgIH0KICAgIH07CgogICAgJHNjb3BlLmNyZWF0ZU5ld0V2ZW50ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgbG9nRGVidWcoImNyZWF0ZU5ld0V2ZW50IHN0YXJ0X3RpbWU9IisgdHlwZW9mICRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZSk7CgogICAgICAgIG5ld0V2ZW50SlNPTkRldGFpbHMgPSBKU09OLnN0cmluZ2lmeSgkc2NvcGUubmV3RXZlbnREZXRhaWxzLCBudWxsLCA0KTsgLy8gKE9wdGlvbmFsKSBiZWF1dGlmdWwgaW5kZW50ZWQgb3V0cHV0LgogICAgICAgIGxvZ0RlYnVnKCJjcmVhdGVOZXdFdmVudCwgIiArIG5ld0V2ZW50SlNPTkRldGFpbHMpOwogICAgICAgIGlmICgkc2NvcGUubmV3RXZlbnREZXRhaWxzLmV2ZW50UmVjdXJyaW5nKSB7CiAgICAgICAgICBjcmVhdGVSZWN1cnJpbmdFdmVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLm5ld0V2ZW50RGV0YWlscyxjcmVhdGVSZWN1cnJpbmdFdmVudF9zdWNjZXNzKTsKICAgICAgICAgIGZ1bmN0aW9uIGNyZWF0ZVJlY3VycmluZ0V2ZW50X3N1Y2Nlc3MoKQogICAgICAgICAgewogICAgICAgICAgICBjYWxlbmRhciA9ICJjYWxlbmRhcl9idXNpbmVzcyI7CiAgICAgICAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKICAgICAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuZGlzbWlzcygpOwogICAgICAgICAgICAvLyBlcnJvciB3YXMKICAgICAgICAgICAgLy8gbG9nRGVidWcoImVycm9yICIgKyBkYXRhLk1lc3NhZ2UpOwogICAgICAgICAgICAvLyAkc2NvcGUuYWpheF9lcnJvciA9IGRhdGEuTWVzc2FnZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgIC8vIGNoZWNraW5nIGV2ZW50IHRpbWUgbG9naWMKICAgICAgICAgIGlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzPiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzKQogICAgICAgICAgewogICAgICAgICAgICAkc2NvcGUuYWpheF9lcnJvcj0i15bXntefINeU15TXqteX15zXlCDXqdecINeU157XpNeS16kg15DXl9eo15kg15bXntefINeU16HXmdeV150g16nXnNeVIjsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgLy8gY2hlY2tpbmcgZXZlbnQgdGltZSBsb2dpYwogICAgICAgICAgaWYgKHBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMpPT1wYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycykpCiAgICAgICAgICB7CiAgICAgICAgICAgIGlmIChwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpPj1wYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzKSkKICAgICAgICAgICAgewogICAgICAgICAgICAgICRzY29wZS5hamF4X2Vycm9yPSLXltee158g15TXlNeq15fXnNeUINep15wg15TXntek15LXqSDXkNeX16jXmSDXltee158g15TXodeZ15XXnSDXqdec15UiOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzPSIrJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKTsKICAgICAgICAgICAgbG9nRGVidWcoIiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXM9Iiskc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzKTsKICAgICAgICAgICAgaWYgKChwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpKzUpPj1wYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzKSkKICAgICAgICAgICAgewogICAgICAgICAgICAgICRzY29wZS5hamF4X2Vycm9yPSLXkNeV16jXmiDXlNee16TXktepINeX15nXmdeRINec15TXmdeV16og15zXpNeX15XXqiA1INeT16fXldeqIjsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIC8vIGlmIGV2ZW50IGlzIG5vdCBjbGFzcywgYSBjbGllbnQgbXVzdCBiZSBzZWxlY3RlZAogICAgICAgICAgaWYgKCghJHNjb3BlLnNob3dFdmVudENsaWVudFNlbGVjdGVkKSAmJiAoISRzY29wZS5uZXdFdmVudERldGFpbHMuaXNfY2xhc3MpICYmICgkc2NvcGUubmV3RXZlbnREZXRhaWxzLmlzX2dlbmVyaWNfZXR5cGU9PTApKQogICAgICAgICAgewogICAgICAgICAgICAvLyBhbGVydCgnY2xpZW50IG11c3QgYmUgc2VsZWN0ZWQnKTsKICAgICAgICAgICAgJHNjb3BlLmFqYXhfZXJyb3I9IteQ16DXkCDXlNeV16HXoyDXntep16rXqtejINec157XpNeS16kiOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoJHNjb3BlLnNlbGVjdEV2ZW50VHlwZVNlbGVjdGVkLmV2ZW50X3R5cGVfaWQ9PTApCiAgICAgICAgICB7CiAgICAgICAgICAgIC8vIGFsZXJ0KCdjbGllbnQgbXVzdCBiZSBzZWxlY3RlZCcpOwogICAgICAgICAgICAkc2NvcGUuYWpheF9lcnJvcj0i15DXoNeQINeR15fXqCDXodeV15Ig157XpNeS16kgIjsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgY3JlYXRlRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5uZXdFdmVudERldGFpbHMsY3JlYXRlRXZlbnRfc3VjY2Vzcyk7CiAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVFdmVudF9zdWNjZXNzKCkKICAgICAgICAgIHsKICAgICAgICAgICAgY2FsZW5kYXIgPSAiY2FsZW5kYXJfYnVzaW5lc3MiOwogICAgICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZWZldGNoRXZlbnRzJyk7CiAgICAgICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoJ2FkZGVkJyk7CiAgICAgICAgICB9CiAgICAgICAgICAvLyBvbiBmYWlsdXJlIHdhcwogICAgICAgICAgLy8gJHNjb3BlLmFqYXhfZXJyb3IgPSBkYXRhLk1lc3NhZ2U7CiAgICAgICAgfQogICAgfQp9KTsKLy8vLyBmZmZmZmZmCmt1emVBcHAuY29udHJvbGxlcignQnVzaW5lc3NDYWxlbmRhckNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCBzaGFyZWRQcm9wZXJ0aWVzLCAkY29tcGlsZSwgJGxvY2F0aW9uLCB1aUNhbGVuZGFyQ29uZmlnLCAkdWliTW9kYWwsIHNoYXJlZERhdGEpIHsKICAgIGluaXRpYWxFbmRVc2VyID0gc2hhcmVkRGF0YS5nZXRTZWxlY3RlZEVuZFVzZXIoKTsKICAgIGxvZ0RlYnVnKCdCdXNpbmVzc0NhbGVuZGFyIENvbnRyb2xsZXIsIHNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKT0nICsgc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpKTsKCiAgICBnZXRCdXNpbmVzc0xvY2F0aW9ucygkaHR0cCwkc2NvcGUsJ2J1c2luZXNzX2xvY2F0aW9ucycpOwoKICAgICRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyPWZhbHNlOwoKICAgIGlmIChzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkhPW51bGwpCiAgICB7CiAgICAgIGNvbnNvbGUubG9nKCJnb3QgcHJldmlvdXMgc2VsZWN0ZWQgdXNlciAiK3NoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKS5idXNlcl9maXJzdF9uYW1lKTsKICAgICAgJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJuYW1lPXNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKS5idXNlcl9maXJzdF9uYW1lKyIgIitzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfbGFzdF9uYW1lOwogICAgICAkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcl9pZD1zaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzaW5lc3NfdXNlcl9pZDsKICAgICAgbG9nRGVidWcoIiRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyX2lkPSIrJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJfaWQpOwoKICAgICAgJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXI9dHJ1ZTsKICAgIH0KCiAgICAvLyBjaGVja2luZyBpZiBjYWxlbmRhciBzaG91bGQgc3RhcnQgd2l0aCBhIHNwZWNpZmljIGRhdGUgKGZyb20gdXJsIG9yIGZyb20gcHJldmlvdXNseSBzZWxlY3RlZCBkYXRlKQogICAgbG9nRGVidWcoIiRsb2NhdGlvbi5zZWFyY2goKS5zdGFydD0iICsgJGxvY2F0aW9uLnNlYXJjaCgpLnN0YXJ0KTsKICAgIGlmICh0eXBlb2YgJGxvY2F0aW9uLnNlYXJjaCgpLnN0YXJ0ICE9ICd1bmRlZmluZWQnKQogICAgewogICAgICBjdXJyRGVmYXVsdERhdGUgPSAkbG9jYXRpb24uc2VhcmNoKCkuc3RhcnQ7CiAgICB9CiAgICBlbHNlIGlmIChzaGFyZWRQcm9wZXJ0aWVzLmdldF9jYWxlbmRhcl9kYXRlKCkhPW51bGwpCiAgICB7CiAgICAgIGNvbnNvbGUubG9nKCJnb3QgcHJldmlvdXMgZGF0ZSAgIitzaGFyZWRQcm9wZXJ0aWVzLmdldF9jYWxlbmRhcl9kYXRlKCkpOwogICAgICBjdXJyRGVmYXVsdERhdGUgPSBzaGFyZWRQcm9wZXJ0aWVzLmdldF9jYWxlbmRhcl9kYXRlKCk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgIGN1cnJEZWZhdWx0RGF0ZSA9IG5ldyBEYXRlKCk7CiAgICB9CiAgICBnZXRBbGxJbnN0cnVjdG9ycygkaHR0cCwkc2NvcGUsJ2J1c2luZXNzX2luc3RydWN0b3JzJyxnZXRBbGxJbnN0cnVjdG9yc19maW5pc2gpOwogICAgZnVuY3Rpb24gZ2V0QWxsSW5zdHJ1Y3RvcnNfZmluaXNoKCkKICAgIHsKICAgICAgLy8gY29uc29sZS5sb2coJHNjb3BlLmJ1c2luZXNzX2luc3RydWN0b3JzKTsKICAgICAgJHNjb3BlLmJ1c2luZXNzX2luc3RydWN0b3JzLnVuc2hpZnQoeyJidXNlcl9mdWxsX25hbWUiOiLXm9ecINeU16bXldeV16oiLCAiYnVzZXJfZmlyc3RfbmFtZSI6Iteb15XXnNedIiwiYnVzZXJfbGFzdF9uYW1lIjoiIiwgInVzZXJfaWQiOiAwLCAiYnVzaW5lc3NfdXNlcl9pZCI6IDB9KTsKCiAgICAgIC8vIHNldHRpbmcgc2VsZWN0ZWQgZ2V0X3NlbGVjdGVkX2luc3RydWN0b3IKICAgICAgJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX2luc3RydWN0b3I9ZmFsc2U7CiAgICAgIGlmIChzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF9pbnN0cnVjdG9yKCk+PTApCiAgICAgIHsKICAgICAgICAvLyBjb25zb2xlLmxvZygiZ290IHByZXZpb3VzIHNlbGVjdGVkIGluc3RydWN0b3IgIitzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF9pbnN0cnVjdG9yKCkpOwogICAgICAgICRzY29wZS5wcmV2aW91c19zZWxlY3RlZF9pbnN0cnVjdG9yX2lkPXNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX2luc3RydWN0b3IoKTsKICAgICAgICAkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfaW5zdHJ1Y3Rvcj10cnVlOwogICAgICAgICRzY29wZS5zZWxlY3RlZF9idXNpbmVzc191c2VyX2lkPXNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX2luc3RydWN0b3IoKTsKICAgICAgfQogICAgfQogICAgZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzTm9TeXN0ZW0oJGh0dHAsJHNjb3BlLCdldmVudF90eXBlcycpOwoKICAgIC8vIHNldHRpbmcgc2VsZWN0ZWQgdXNlciBpZAogICAgJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGU9ZmFsc2U7CiAgICAkc2NvcGUucHJldmlvdXNfZXZlbnRfcmVzY2hlZHVsZV9ldmVudD1udWxsOwoKICAgICRzY29wZS4kb24oImNhbGVuZGFyRXZlbnRSZXNjaGVkdWxlRGVzZWxlY3QiLGZ1bmN0aW9uKGUsYSkKICAgIHsKICAgICAgJHNjb3BlLmNhbGVuZGFyRXZlbnRSZXNjaGVkdWxlRGVzZWxlY3QoKTsKICAgIH0pOwoKICAgIC8vIGRlc2VsZWN0aW5nIGV2ZW50IGZyb20gYmVpbmcgcmVzY2hlZHVsZWQKICAgICRzY29wZS5jYWxlbmRhckV2ZW50UmVzY2hlZHVsZURlc2VsZWN0PWZ1bmN0aW9uKCkKICAgIHsKICAgICAgc2hhcmVkUHJvcGVydGllcy5zZXRfZXZlbnRfcmVzY2hlZHVsZShudWxsKTsKICAgICAgJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGU9ZmFsc2U7CiAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZWZldGNoRXZlbnRzJyk7CiAgICB9CiAgICAvLyBkZWxldGluZyBjbGllbnQgc2VsZWN0aW9uIGluIGNhbGVuZGFyCiAgICAkc2NvcGUuY2FsZW5kYXJDbGllbnREZXNlbGVjdD1mdW5jdGlvbigpIC8vIHJlbG9hZCBjbGFzcy9ldmVudCBzdWdnZXN0aW9ucwogICAgewogICAgICAkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcj1mYWxzZTsKICAgICAgc2hhcmVkUHJvcGVydGllcy5zZXRfc2VsZWN0ZWRfdXNlcihudWxsKTsKICAgICAgJHNjb3BlLmV2ZW50VHlwZVNlbGVjdGVkKCk7CiAgICB9CiAgICBpZiAoaW5pdGlhbEVuZFVzZXIgIT0gbnVsbCkgewogICAgICAgICRzY29wZS5idXNpbmVzc0NhbGVuZGFySW5pdGlhbE5hbWUgPSB0cnVlOwogICAgICAgIHNoYXJlZERhdGEuc2V0U2VsZWN0ZWRFbmRVc2VyKG51bGwpOwogICAgICAgICRzY29wZS5idXNpbmVzc0NhbGVuZGFySW5pdGlhbHMgPSB7CiAgICAgICAgICAgIG5hbWU6IGluaXRpYWxFbmRVc2VyLmZpcnN0X25hbWUgKyAiICIgKyBpbml0aWFsRW5kVXNlci5sYXN0X25hbWUKICAgICAgICB9OwogICAgfSBlbHNlIHsKICAgICAgICAkc2NvcGUuYnVzaW5lc3NDYWxlbmRhckluaXRpYWxOYW1lID0gZmFsc2U7CiAgICB9CiAgICAvKiBjb25maWcgb2JqZWN0ICovCiAgICAkc2NvcGUuY2FsZW5kYXJfbmFtZSA9ICJjYWxlbmRhcl9idXNpbmVzcyI7CiAgICAkc2NvcGUuY2FsZW5kYXIgPSAiY2FsZW5kYXJfYnVzaW5lc3MiOwogICAgLyogZXZlbnQgc291cmNlcyBhcnJheSovCiAgICAkc2NvcGUuYnVzaW5lc3NDYWxlbmRhckV2ZW50U291cmNlcyA9IFt7CiAgICAgICAgdXJsOiAnL2FwaS9hZG1pbi9ldmVudHMvZ2V0cG9zdCcsCiAgICAgICAgdHlwZTogJ1BPU1QnCiAgICB9LCB7CiAgICAgICAgdXJsOiAnL2FwaS9hZG1pbi9jYWxlbmRhci9saW1pdGF0aW9ucy9iYWNrZ3JvdW5kL2dldHBvc3QnLAogICAgICAgIHR5cGU6ICdQT1NUJwogICAgLy8gfSwgewogICAgLy8gICAgIHVybDogJy9hcGkvYWRtaW4vcmVjdXJyaW5nL2dldHBvc3QnLAogICAgLy8gICAgIHR5cGU6ICdQT1NUJwogICAgfV07CgogICAgJHNjb3BlLmdvdG9Ub2RheSA9IGZ1bmN0aW9uKCkgewogICAgICAgICRzY29wZS5nb3RvRGF0ZShuZXcgRGF0ZSgpKTsKICAgICAgICB2aXNpYmxlRGF0ZVN0YXJ0ID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5zdGFydCk7CiAgICAgICAgZGF0ZVRvR29UbyA9IHZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSArICItIiArICgnMCcgKyAodmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpICsgMSkpLnNsaWNlKC0yKSArICItIiArICgnMCcgKyB2aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSkuc2xpY2UoLTIpOwogICAgICAgIHNoYXJlZFByb3BlcnRpZXMuc2V0X2NhbGVuZGFyX2RhdGUoZGF0ZVRvR29Ubyk7CiAgICAgICAgJHNjb3BlLnZpc2libGVEYXRlU3RhcnQ9dmlzaWJsZURhdGVTdGFydDsKICAgICAgICAkbG9jYXRpb24uc2VhcmNoKCdzdGFydCcsZGF0ZVRvR29Ubyk7CiAgICB9CgogICAgJHNjb3BlLmluc3RydWN0b3JTZWxlY3RlZD1mdW5jdGlvbih0aGlzdGhpcykKICAgIHsKICAgICAgdXBkYXRlU3VnZ2VzdGlvbnMoKTsKICAgIH0KICAgICRzY29wZS5ldmVudFR5cGVTZWxlY3RlZD1mdW5jdGlvbih0aGlzdGhpcykKICAgIHsKICAgICAgdXBkYXRlU3VnZ2VzdGlvbnMoKTsKICAgIH0KICAgIGZ1bmN0aW9uIHVwZGF0ZVN1Z2dlc3Rpb25zKCkKICAgIHsKICAgICAgbG9nRGVidWcoImZ1bmN0aW9uOiB1cGRhdGVTdWdnZXN0aW9ucyIpOwogICAgICBzaGFyZWRQcm9wZXJ0aWVzLnNldF9ldmVudF90eXBlX2Zvcl9zdWdnZXN0aW9ucygkc2NvcGUuc2VsZWN0ZWRfZXZlbnRfdHlwZV9pZCk7CiAgICAgIHNoYXJlZFByb3BlcnRpZXMuc2V0X3NlbGVjdGVkX2luc3RydWN0b3IoJHNjb3BlLnNlbGVjdGVkX2J1c2luZXNzX3VzZXJfaWQpOwogICAgICBmb3IgKGk9MDtpPCRzY29wZS5ldmVudF90eXBlcy5sZW5ndGg7aSsrKQogICAgICB7CiAgICAgICAgLy8gY29uc29sZS5sb2coJHNjb3BlLmV2ZW50X3R5cGVzW2ldLmV2ZW50X3R5cGVfaWQpOwogICAgICAgIGlmICgkc2NvcGUuc2VsZWN0ZWRfZXZlbnRfdHlwZV9pZD09JHNjb3BlLmV2ZW50X3R5cGVzW2ldLmV2ZW50X3R5cGVfaWQpCiAgICAgICAgewogICAgICAgICAgLy8gY29uc29sZS5sb2coImZvdW5kIGV2ZW50IHR5cGUgaWQiKTsKICAgICAgICAgIGlmICgkc2NvcGUuZXZlbnRfdHlwZXNbaV0uaXNfY2xhc3MpIC8vIGlzIGNsYXNzCiAgICAgICAgICB7CiAgICAgICAgICAgIGxvZ0RlYnVnKCIkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcj0iKyRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyKTsKICAgICAgICAgICAgaWYgKCRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgY29uc29sZS5sb2coImlzIGNsYXNzIHN1Z2dlc3Rpb25kIik7CiAgICAgICAgICAgICAgJGh0dHAuZ2V0KCRnQXBpVVJMUHJlZml4ICsgIi9lbmR1c2VyL2V2ZW50cy9zdWdnZXN0Y2xhc3MvIiskc2NvcGUuc2VsZWN0ZWRfZXZlbnRfdHlwZV9pZCsiLyIrJHNjb3BlLnNlbGVjdGVkX2J1c2luZXNzX3VzZXJfaWQrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCkrIi8iKygkc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpKzEpKyIvIiskc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXREYXRlKCkrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldEhvdXJzKCkgKyAiLyIgKyAkc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXRNaW51dGVzKCkgKyAiLyIgKyAkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcl9pZCkudGhlbihmdW5jdGlvbihyZXNwb25zZSkKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkX2lzX2NsYXNzPXRydWU7CiAgICAgICAgICAgICAgICAgICRzY29wZS5ldmVudHNTdWdnZXN0ZWQgPSByZXNwb25zZS5kYXRhOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgewogICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJub3QgaXMgY2xhc3Mgc3VnZ2VzdGlvbmQiKTsKICAgICAgICAgICAgICAkaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3RjbGFzcy8iKyRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkKyIvIiskc2NvcGUuc2VsZWN0ZWRfYnVzaW5lc3NfdXNlcl9pZCsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSsiLyIrKCRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkrMSkrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0SG91cnMoKSArICIvIiArICRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKSArICIvMCIpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRfZXZlbnRfdHlwZV9pZF9pc19jbGFzcz10cnVlOwogICAgICAgICAgICAgICAgICAkc2NvcGUuZXZlbnRzU3VnZ2VzdGVkID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgZWxzZSAvLyBpcyBub3QgY2xhc3MKICAgICAgICAgIHsKICAgICAgICAgICAgJGh0dHAuZ2V0KCRnQXBpVVJMUHJlZml4ICsgIi9lbmR1c2VyL2V2ZW50cy9zdWdnZXN0LyIrJHNjb3BlLnNlbGVjdGVkX2V2ZW50X3R5cGVfaWQrIi8iKyRzY29wZS5zZWxlY3RlZF9idXNpbmVzc191c2VyX2lkKyIvIiskc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpKyIvIisoJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0TW9udGgoKSsxKSsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0RGF0ZSgpKyIvIiskc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXRIb3VycygpICsgIi8iICsgJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0TWludXRlcygpKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRfZXZlbnRfdHlwZV9pZF9pc19jbGFzcz1mYWxzZTsKICAgICAgICAgICAgICAgICRzY29wZS5ldmVudHNTdWdnZXN0ZWQgPSByZXNwb25zZS5kYXRhOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICAkc2NvcGUuZ290b05leHQgPSBmdW5jdGlvbigpIHsKICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVtb3ZlRXZlbnRzJyk7CiAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ25leHQnKTsKICAgICAgICAkc2NvcGUudXBkYXRlQ2FsZW5kYXJDZW50ZXJUaXRsZSgpOwogICAgICAgIC8vIGFkZGluZyB0aGUgZm9sbG93aW5nIHRvIG1ha2UgdGhlIHVybAogICAgICAgIC8vIHBvaW50IHRvIHRoZSByaWdodCB3ZWVrLCBpZiBnb2luZyB0byBhIGRpZmZlcmVudCBVUkwgYW5kIHRoZW4gZ29pbmcgYmFjawogICAgICAgIHZpc2libGVEYXRlU3RhcnQgPSBuZXcgRGF0ZSh1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ2V0VmlldycpLnN0YXJ0KTsKICAgICAgICBkYXRlVG9Hb1RvID0gdmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpICsgIi0iICsgKCcwJyArICh2aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkgKyAxKSkuc2xpY2UoLTIpICsgIi0iICsgKCcwJyArIHZpc2libGVEYXRlU3RhcnQuZ2V0RGF0ZSgpKS5zbGljZSgtMik7CiAgICAgICAgc2hhcmVkUHJvcGVydGllcy5zZXRfY2FsZW5kYXJfZGF0ZShkYXRlVG9Hb1RvKTsKICAgICAgICAkc2NvcGUudmlzaWJsZURhdGVTdGFydD12aXNpYmxlRGF0ZVN0YXJ0OwogICAgICAgICRsb2NhdGlvbi5zZWFyY2goJ3N0YXJ0JyxkYXRlVG9Hb1RvKTsKICAgIH0KICAgICRzY29wZS5nb3RvUHJldiA9IGZ1bmN0aW9uKCkgewogICAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZW1vdmVFdmVudHMnKTsKICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncHJldicpOwogICAgICAgICRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlKCk7CiAgICAgICAgLy8gYWRkaW5nIHRoZSBmb2xsb3dpbmcgdG8gbWFrZSB0aGUgdXJsCiAgICAgICAgLy8gcG9pbnQgdG8gdGhlIHJpZ2h0IHdlZWssIGlmIGdvaW5nIHRvIGEgZGlmZmVyZW50IFVSTCBhbmQgdGhlbiBnb2luZyBiYWNrCiAgICAgICAgdmlzaWJsZURhdGVTdGFydCA9IG5ldyBEYXRlKHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3Jykuc3RhcnQpOwogICAgICAgIGRhdGVUb0dvVG8gPSB2aXNpYmxlRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCkgKyAiLSIgKyAoJzAnICsgKHZpc2libGVEYXRlU3RhcnQuZ2V0TW9udGgoKSArIDEpKS5zbGljZSgtMikgKyAiLSIgKyAoJzAnICsgdmlzaWJsZURhdGVTdGFydC5nZXREYXRlKCkpLnNsaWNlKC0yKTsKICAgICAgICBzaGFyZWRQcm9wZXJ0aWVzLnNldF9jYWxlbmRhcl9kYXRlKGRhdGVUb0dvVG8pOwogICAgICAgICRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0PXZpc2libGVEYXRlU3RhcnQ7CiAgICAgICAgJGxvY2F0aW9uLnNlYXJjaCgnc3RhcnQnLGRhdGVUb0dvVG8pOwoKICAgIH0KICAgICRzY29wZS5nb3RvRGF0ZSA9IGZ1bmN0aW9uKG5ld2RhdGUpIHsKICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ290b0RhdGUnLCBuZXdkYXRlKTsKICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVtb3ZlRXZlbnRzJyk7CiAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKICAgICAgICAkc2NvcGUudXBkYXRlQ2FsZW5kYXJDZW50ZXJUaXRsZSgpOwogICAgfQoKICAgICRzY29wZS5lZGl0SG91cnNPZldvcmsgPSBmdW5jdGlvbigpIHsKICAgICAgICAvLyBwYXJhbSBzaG91bGQgbG9vayBsaWtlICIyMDE2LTA3LTAxIgogICAgICAgIHZpc2libGVEYXRlU3RhcnQgPSBuZXcgRGF0ZSh1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ2V0VmlldycpLnN0YXJ0KTsKICAgICAgICBkYXRlVG9Hb1RvID0gdmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpICsgIi0iICsgKCcwJyArICh2aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkgKyAxKSkuc2xpY2UoLTIpICsgIi0iICsgKCcwJyArIHZpc2libGVEYXRlU3RhcnQuZ2V0RGF0ZSgpKS5zbGljZSgtMik7CiAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9ob3Vyc19vZl93b3JrJykuc2VhcmNoKHsKICAgICAgICAgICAgc3RhcnQ6IGRhdGVUb0dvVG8KICAgICAgICB9KTsKICAgIH07CgogICAgJHNjb3BlLnVwZGF0ZUNhbGVuZGFyQ2VudGVyVGl0bGUgPSBmdW5jdGlvbigpIHsKICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ2V0VmlldycpOwoKICAgICAgICB2aXNpYmxlRGF0ZVN0YXJ0ID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5zdGFydCk7CiAgICAgICAgdmlzaWJsZURhdGVFbmQgPSBuZXcgRGF0ZSh1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ2V0VmlldycpLmVuZCk7CgogICAgICAgICRzY29wZS5jYWxlbmRhclRpdGxlQ2VudGVyID0gdmlzaWJsZURhdGVTdGFydC5nZXREYXRlKCkgKyAiICIgKyBtb250aE5hbWVzW3Zpc2libGVEYXRlU3RhcnQuZ2V0TW9udGgoKV0gKwogICAgICAgICAgICAiIOKAlCAiICsgdmlzaWJsZURhdGVFbmQuZ2V0RGF0ZSgpICsgIiAiICsgbW9udGhOYW1lc1t2aXNpYmxlRGF0ZUVuZC5nZXRNb250aCgpXSArCiAgICAgICAgICAgICIgIiArIHZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKTsKICAgIH07CgogICAgJHNjb3BlLnNob3dFdmVudFBvcHVwID0gZnVuY3Rpb24oc2VsZWN0ZWRFdmVudCkgewogICAgICAgIHNob3dFdmVudFBvcHVwKHNlbGVjdGVkRXZlbnQsICR1aWJNb2RhbCkKICAgIH07CgogICAgJHNjb3BlLmV2ZW50Q3JlYXRlTW9kYWxGcm9tU2NoZWR1bGVyID0gZnVuY3Rpb24oZXN1Z2dlc3QpCiAgICB7CiAgICAgIC8vIGlmIGNsYXNzIC0gZ28gdG8gZXZlbnQgY2xhc3MKICAgICAgY29uc29sZS5sb2coZXN1Z2dlc3QpOwogICAgICBmb3IgKGk9MDtpPCRzY29wZS5ldmVudF90eXBlcy5sZW5ndGg7aSsrKQogICAgICB7CiAgICAgICAgaWYgKGVzdWdnZXN0LmV2ZW50X3R5cGVfaWQ9PSRzY29wZS5ldmVudF90eXBlc1tpXS5ldmVudF90eXBlX2lkKQogICAgICAgIHsKICAgICAgICAgIGlmICgkc2NvcGUuZXZlbnRfdHlwZXNbaV0uaXNfY2xhc3MpCiAgICAgICAgICB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCJpcyBjbGFzcyIpOwogICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZj0nLyMvZXZlbnRfY2xhc3MvJyArIGVzdWdnZXN0LmV2ZW50X2lkOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGxvZ0RlYnVnKEpTT04uc3RyaW5naWZ5KGVzdWdnZXN0KSk7CiAgICAgIGxvZ0RlYnVnKGVzdWdnZXN0LnN0YXJ0X2Vwb2NoKTsKICAgICAgc3RhcnREYXRlPWVzdWdnZXN0LnN0YXJ0X2Vwb2NoKjEwMDA7CgogICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAgICAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9ldmVudF9jcmVhdGUucGhwJywKICAgICAgICAgIGNvbnRyb2xsZXI6ICdldmVudENyZWF0ZU1vZGFsQ29udHJvbGxlcicsCiAgICAgICAgICBzaXplOiAnbCcsCiAgICAgICAgICByZXNvbHZlOiB7CiAgICAgICAgICAgICAgc3RhcnREYXRlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHN0YXJ0RGF0ZTsKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGV2ZW50X3R5cGVfaWQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gJHNjb3BlLnNlbGVjdGVkX2V2ZW50X3R5cGVfaWQ7CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBsb2NhdGlvbl9pZDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBlc3VnZ2VzdC5sb2NhdGlvbl9pZDsKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGVtcF9pZDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBlc3VnZ2VzdC5lbXBfaWQ7CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICByZXNjaGVkdWxlX2V2ZW50OiBmdW5jdGlvbigpCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaWYgKCRzY29wZS5wcmV2aW91c19ldmVudF9yZXNjaGVkdWxlKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICByZXR1cm4gJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGVfZXZlbnQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KCiAgICAgICAgICB9CiAgICAgIH0pOwoKICAgIH0KICAgICRzY29wZS5ldmVudENyZWF0ZU1vZGFsID0gZnVuY3Rpb24oc3RhcnREYXRlLCBzaXplKSB7CiAgICAgICAgbG9nRGVidWcoImV2ZW50IGNyZWF0ZSBtb2RhbCBzdGFydERhdGU9IitzdGFydERhdGUpOwoKICAgICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAgICAgICAgICAgYW5pbWF0aW9uOiBmYWxzZSwKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfZXZlbnRfY3JlYXRlLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdldmVudENyZWF0ZU1vZGFsQ29udHJvbGxlcicsCiAgICAgICAgICAgIHNpemU6IHNpemUsCiAgICAgICAgICAgIHJlc29sdmU6IHsKICAgICAgICAgICAgICAgIHN0YXJ0RGF0ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN0YXJ0RGF0ZTsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBldmVudF90eXBlX2lkOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBsb2NhdGlvbl9pZDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZW1wX2lkOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICByZXNjaGVkdWxlX2V2ZW50OiBmdW5jdGlvbigpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIGlmICgkc2NvcGUucHJldmlvdXNfZXZlbnRfcmVzY2hlZHVsZSkKICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUucHJldmlvdXNfZXZlbnRfcmVzY2hlZHVsZV9ldmVudDsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgICAgfSAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIG1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24oc2VsZWN0ZWRJdGVtKSB7CiAgICAgICAgICAgICRzY29wZS5zZWxlY3RlZCA9IHNlbGVjdGVkSXRlbTsKICAgICAgICB9LCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgbG9nRGVidWcoJ01vZGFsIGRpc21pc3NlZCBhdDogJyArIG5ldyBEYXRlKCkpOwogICAgICAgIH0pOwogICAgfTsKCiAgICAvLy8KICAgICRzY29wZS51cGRhdGVFdmVudERhdGFiYXNlID0gZnVuY3Rpb24oc3RhcnRfcGFyYW0sIGVuZF9wYXJhbSwgZXZlbnRfaWQsIHRoZWV2ZW50KQogICAgewoKICAgICAgICBsb2dEZWJ1ZygidXBkYXRlRXZlbnREYXRhYmFzZSBzdGFydD0iICsgc3RhcnRfcGFyYW0gKyAiLCBlbmQ9IiArIGVuZF9wYXJhbSArICIsIGV2ZW50X2lkPSIgKyBldmVudF9pZCk7CiAgICAgICAgdGhldXJsID0gJy9hcGkvYWRtaW4vZXZlbnRzL3NldC8nICsgZXZlbnRfaWQ7CgogICAgICAgICRodHRwKHsKICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsCiAgICAgICAgICAgIHVybDogdGhldXJsLAogICAgICAgICAgICBkYXRhOiB7CiAgICAgICAgICAgICAgICBzdGFydF9kYXRlOiBzdGFydF9wYXJhbSwKICAgICAgICAgICAgICAgIGVuZF9kYXRlOiBlbmRfcGFyYW0sCiAgICAgICAgICAgICAgICBldmVudF9pZDogZXZlbnRfaWQKICAgICAgICAgICAgfSwKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uO2NoYXJzZXQ9dXRmLTgnCiAgICAgICAgICAgIH0KICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHsKCiAgICAgICAgICAgIGxvZ0RlYnVnKGRhdGEpOwogICAgICAgICAgICBpZiAoZGF0YS5FcnJvcikgewogICAgICAgICAgICAgICAgbG9nRGVidWcoImVycm9yICIgKyBkYXRhLk1lc3NhZ2UpOwogICAgICAgICAgICAgICAgYWxlcnQoJ2Vycm9yJyk7CiAgICAgICAgICAgICAgICBjYWxlbmRhciA9ICJjYWxlbmRhcl9idXNpbmVzcyI7CiAgICAgICAgICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZWZldGNoRXZlbnRzJyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBsb2dEZWJ1Zygic3VjY2VzcyIpOwogICAgICAgICAgICAgICAgY2FsZW5kYXIgPSAiY2FsZW5kYXJfYnVzaW5lc3MiOwogICAgICAgICAgICAgICAgLy8gdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwogICAgICAgICAgICAgICAgLy8gJHVpYk1vZGFsSW5zdGFuY2UuZGlzbWlzcygnYWRkZWQgYW5kIHJlZmV0Y2hFdmVudHMnKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgIH07CiAgICAvLy8KCiAgICAkc2NvcGUuY2xhc3NFdmVudEFkZFVzZXIgPSBmdW5jdGlvbihlc3VnZ2VzdCkKICAgIHsKICAgICAgY29uc29sZS5sb2coImNsYXNzRXZlbnRBZGRVc2VyIG9yIFJlbW92ZSIpOwogICAgICBpZiAoKGVzdWdnZXN0LmlzX3JlZ2lzdGVyZWQ9PTEpIHwgKChlc3VnZ2VzdC5pc193YWl0aW5nbGlzdD09MSkgJiYgKGVzdWdnZXN0LmlzX2NhbmNlbGVkPT0wKSkpCiAgICAgIHsKICAgICAgICBjb25zb2xlLmxvZygibmVlZCB0byB1bnJlZ2lzdGVyIik7CiAgICAgICAgcmVtb3ZlRW5kVXNlckZyb21FdmVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJfaWQsZXN1Z2dlc3QuZXZlbnRfaWQscmVtb3ZlRW5kVXNlckZyb21FdmVudF9jYWxsYmFjaywgcmVtb3ZlRW5kVXNlckZyb21FdmVudF9jYWxsYmFjayk7CiAgICAgICAgZnVuY3Rpb24gcmVtb3ZlRW5kVXNlckZyb21FdmVudF9jYWxsYmFjaygpCiAgICAgICAgewogICAgICAgICAgJHNjb3BlLmV2ZW50VHlwZVNlbGVjdGVkKCk7CiAgICAgICAgICBjYWxlbmRhciA9ICJjYWxlbmRhcl9idXNpbmVzcyI7CiAgICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZWZldGNoRXZlbnRzJyk7CgogICAgICAgIH0KICAgICAgfQogICAgICBlbHNlCiAgICAgIHsKICAgICAgICAvLyBjb25zb2xlLmxvZyhlc3VnZ2VzdC5ldmVudF9pZCk7CiAgICAgICAgLy8gY29uc29sZS5sb2coJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJfaWQpOwogICAgICAgIC8vIGlmIHNlbGVjdGVkIHVzZXIgLSBhZGRpbmcgaGltL2hlciB0byBjbGFzcwogICAgICAgIGlmICgkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcikKICAgICAgICB7CiAgICAgICAgICBhZGRFbmRVc2VyVG9FdmVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJfaWQsZXN1Z2dlc3QuZXZlbnRfaWQsYWRkRW5kVXNlclRvRXZlbnRfY2FsbGJhY2ssIGFkZEVuZFVzZXJUb0V2ZW50X2NhbGxiYWNrKTsKICAgICAgICAgIGZ1bmN0aW9uIGFkZEVuZFVzZXJUb0V2ZW50X2NhbGxiYWNrKCkKICAgICAgICAgIHsKICAgICAgICAgICAgY2FsZW5kYXIgPSAiY2FsZW5kYXJfYnVzaW5lc3MiOwogICAgICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZWZldGNoRXZlbnRzJyk7CiAgICAgICAgICAgICRzY29wZS5ldmVudFR5cGVTZWxlY3RlZCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlIC8vIGVsc2UgLSBnb2luZyB0byBjbGFzcyBwYWdlCiAgICAgICAgewogICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWY9Jy8jL2V2ZW50X2NsYXNzLycgKyBlc3VnZ2VzdC5ldmVudF9pZDsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgICRzY29wZS5jYWxlbmRhcl9idXNpbmVzc19jb25maWcgPSB7CiAgICAgICAgY2FsZW5kYXI6IHsKICAgICAgICAgICAgaGVpZ2h0OiAnYXV0bycsCiAgICAgICAgICAgIGVkaXRhYmxlOiB0cnVlLAogICAgICAgICAgICAvLyBoZWFkZXI6IHsKICAgICAgICAgICAgLy8gICAgIGxlZnQ6ICcnLAogICAgICAgICAgICAvLyAgICAgY2VudGVyOiAnJywKICAgICAgICAgICAgLy8gICAgIHJpZ2h0OiAnJwogICAgICAgICAgICAvLyB9LAogICAgICAgICAgICAvLyBoZWFkZXI6IHsKICAgICAgICAgICAgLy8gICAgIGxlZnQ6ICd0aXRsZScsCiAgICAgICAgICAgIC8vICAgICBjZW50ZXI6ICcnLAogICAgICAgICAgICAvLyAgICAgcmlnaHQ6ICd0b2RheSBwcmV2LG5leHQnCiAgICAgICAgICAgIC8vIH0sCiAgICAgICAgICAgIHRpdGxlRm9ybWF0OiB7CiAgICAgICAgICAgICAgICAvLyB3ZWVrOiAgImQgW01NTV17ICcmIzgyMTE7JyBkIE1NTX0iCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIC8vIHRpdGxlRm9ybWF0OiB7CiAgICAgICAgICAgIC8vICAgICBtb250aDogJ01NTU0geXl5eScsCiAgICAgICAgICAgIC8vICAgICB3ZWVrOiAiTU1NIGRbIHl5eXldeyAnJiM4MjEyOydbIE1NTV0gZCB5eXl5fSIsCiAgICAgICAgICAgIC8vICAgICBkYXk6ICdNTS9kZCcKICAgICAgICAgICAgLy8gfSwKICAgICAgICAgICAgaGVhZGVyOiAnJywKICAgICAgICAgICAgLy8gZGVmYXVsdFZpZXc6ICdhZ2VuZGFXZWVrJywKICAgICAgICAgICAgLy8gdmlld3M6IHsKICAgICAgICAgICAgLy8gICAgIGRvbnRTaG93RGF0ZTogewogICAgICAgICAgICAvLyAgICAgICAgIHR5cGU6ICdhZ2VuZGFXZWVrJywKICAgICAgICAgICAgLy8gICAgICAgICBkdXJhdGlvbjogewogICAgICAgICAgICAvLyAgICAgICAgICAgICBkYXlzOiA3CiAgICAgICAgICAgIC8vICAgICAgICAgfSwKICAgICAgICAgICAgLy8gICAgICAgICB0aXRsZTogJ0FwZXJ0dXJhJywKICAgICAgICAgICAgLy8gICAgICAgICBjb2x1bW5Gb3JtYXQ6ICdkZGRkJyAvLyBGb3JtYXQgdGhlIGRheSB0byBvbmx5IHNob3cgbGlrZSAnTW9uZGF5JwogICAgICAgICAgICAvLyAgICAgICAgICAgICAvLyBoaWRkZW5EYXlzOiBbMCwgNl0gLy8gSGlkZSBTdW5kYXkgYW5kIFNhdHVyZGF5PwogICAgICAgICAgICAvLyAgICAgfQogICAgICAgICAgICAvLyB9LAogICAgICAgICAgICAvLyBzbG90RHVyYXRpb246ICcwMDoxNTowMCcsCiAgICAgICAgICAgIGV2ZW50RHJvcDogZnVuY3Rpb24oZXZlbnQsIGRheURlbHRhLCBtaW51dGVEZWx0YSwgYWxsRGF5LCByZXZlcnRGdW5jLCB1aUNhbGVuZGFyQ29uZmlnKSB7CiAgICAgICAgICAgICAgICBsb2dEZWJ1ZygiZXZlbnQgZHJvcCIgKyBldmVudC50aXRsZSArICIoIiArIGV2ZW50LmlkICsgIikgbW92ZWQgIiArIG1pbnV0ZURlbHRhICsgIiBtaW51dGVzIik7CiAgICAgICAgICAgICAgICBsb2dEZWJ1Zygib2xkIHN0YXJ0PSIgKyBldmVudC5zdGFydCArICIsIG9sZCBlbmQ9IiArIGV2ZW50LmVuZCk7CiAgICAgICAgICAgICAgICAkc2NvcGUudXBkYXRlRXZlbnREYXRhYmFzZShldmVudC5zdGFydCwgZXZlbnQuZW5kLCBldmVudC5pZCwgZXZlbnQpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBldmVudFJlc2l6ZTogZnVuY3Rpb24oZXZlbnQsIGRlbHRhLCByZXZlcnRGdW5jKSB7CiAgICAgICAgICAgICAgbG9nRGVidWcoImV2ZW50IHJlc2l6ZSIgKyBldmVudC50aXRsZSArICIoIiArIGV2ZW50LmlkICsgIikgbW92ZWQgIik7CiAgICAgICAgICAgICAgbG9nRGVidWcoIm9sZCBzdGFydD0iICsgZXZlbnQuc3RhcnQgKyAiLCBvbGQgZW5kPSIgKyBldmVudC5lbmQpOwogICAgICAgICAgICAgICRzY29wZS51cGRhdGVFdmVudERhdGFiYXNlKGV2ZW50LnN0YXJ0LCBldmVudC5lbmQsIGV2ZW50LmlkLCBldmVudCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRlZmF1bHRWaWV3OiAnYWdlbmRhV2VlaycsCiAgICAgICAgICAgIGV2ZW50U3RhcnRFZGl0YWJsZTpmYWxzZSwKICAgICAgICAgICAgZXZlbnREdXJhdGlvbkVkaXRhYmxlOmZhbHNlLAogICAgICAgICAgICBkZWZhdWx0RGF0ZTogbW9tZW50KGN1cnJEZWZhdWx0RGF0ZSksCgogICAgICAgICAgICAvLyBkZWZhdWx0VmlldzogJ2RvbnRTaG93RGF0ZScsCiAgICAgICAgICAgIGV2ZW50Q2xpY2s6IGZ1bmN0aW9uKGNhbEV2ZW50LCBqc0V2ZW50LCB2aWV3KSB7CiAgICAgICAgICAgICAgICBsb2dEZWJ1ZygiY2FsZW5kYXIgZXZlbnQgY2xpY2tlZCAiICsgY2FsRXZlbnQudGl0bGUgKyAiKCIgKyBjYWxFdmVudC5pZCArICIpICIgKyBjYWxFdmVudC5zdGFydCArICIgIiArIGNhbEV2ZW50LmVuZCk7CiAgICAgICAgICAgICAgICAvLyBsb2dEZWJ1ZyhKU09OLnN0cmluZ2lmeShjYWxFdmVudCkpOwogICAgICAgICAgICAgICAgLy8gaWYgaXQncyBhIGdlbmVyaWMgZXZlbnQgKHZhY2F0aW9uIGV0YykKICAgICAgICAgICAgICAgIC8vIHNob3cgcG9wdXAgd2l0aCBvcHRpb24gdG8gZGVsZXRlCiAgICAgICAgICAgICAgICBpZiAoY2FsRXZlbnQuaXNfZ2VuZXJpY19ldHlwZT09MSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgLy8gJHNjb3BlLnNob3dHZW5lcmljRXZlbnQoY2FsRXZlbnQpOwogICAgICAgICAgICAgICAgICAkc2NvcGUuc2hvd0V2ZW50UG9wdXAoY2FsRXZlbnQpOwoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgJHNjb3BlLnNob3dFdmVudFBvcHVwKGNhbEV2ZW50KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vIGNoYW5nZSB0aGUgYm9yZGVyIGNvbG9yIGp1c3QgZm9yIGZ1bgogICAgICAgICAgICAgICAgLy8gJCh0aGlzKS5jc3MoJ2JvcmRlci1jb2xvcicsICdyZWQnKTsKCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRheUNsaWNrOiBmdW5jdGlvbihkYXRlLCBqc0V2ZW50LCB2aWV3KSB7CiAgICAgICAgICAgICAgICAvLyBsb2dEZWJ1ZygibmV3IGV2ZW50IGNyZWF0aW9uIGNsaWNrZWQgIiArIGNhbEV2ZW50LnRpdGxlICsgIigiICsgY2FsRXZlbnQuaWQgKyAiKSAiICsgY2FsRXZlbnQuc3RhcnQgKyAiICIgKyBjYWxFdmVudC5lbmQpOwogICAgICAgICAgICAgICAgLy8gICAgIHN0YXJ0ID0gZGF0ZTsKICAgICAgICAgICAgICAgIC8vICAgICBlbmQgPSBtb21lbnQoc3RhcnQpLmFkZCg0NSwgJ21pbnV0ZXMnKTsKICAgICAgICAgICAgICAgIGlmICh2aWV3Lm5hbWUgPT09ICJtb250aCIpIHsKICAgICAgICAgICAgICAgICAgICBjYWxlbmRhciA9ICJjYWxlbmRhcl9idXNpbmVzcyI7CiAgICAgICAgICAgICAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignY2hhbmdlVmlldycsICJhZ2VuZGFXZWVrIik7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICRzY29wZS5ldmVudENyZWF0ZU1vZGFsKGRhdGUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy8gY2hhbmdlIHRoZSBib3JkZXIgY29sb3IganVzdCBmb3IgZnVuCiAgICAgICAgICAgICAgICAvLyAkKHRoaXMpLmNzcygnYm9yZGVyLWNvbG9yJywgJ3JlZCcpOwoKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZXZlbnRSZW5kZXI6IGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBpZiAoIWV2ZW50LmV2ZW50X2lkPjApCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIC8vIG5vdCBhIHJlYWwgZXZlbnQgLSBwcm9iYWJseSBibG9jayAvIGJhY2tncm91bmQKICAgICAgICAgICAgICAgICAgLy8gaWdub3JpbmcgaXQKICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy8gY2hhbmdpbmcgbG9vayBhbmQgZmVlbCBvZiBldmVuIHRoYXQgaXMgdG8gcmVzY2hlZHVsZQogICAgICAgICAgICAgICAgaWYgKHNoYXJlZFByb3BlcnRpZXMuZ2V0X2V2ZW50X3Jlc2NoZWR1bGUoKSE9bnVsbCkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50LmV2ZW50X2lkPT1zaGFyZWRQcm9wZXJ0aWVzLmdldF9ldmVudF9yZXNjaGVkdWxlKCkuZXZlbnRfaWQpCiAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmNzcygnYmFja2dyb3VuZC1jb2xvcicsICcjQTlBOUE5CScpOwogICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuY3NzKCdib3JkZXItY29sb3InLCAnI0E5QTlBOQknKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChldmVudC5pc19jbGFzcz09MSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgLy8gaWYgY2xhc3MgYWRkaW5nIG51bWJlciBvZiBwYXJ0aWNpcGFudHMKICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50Lm5vX29mX3dhaXRpbmdfdXNlcnM+MCkKICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZChldmVudC5ub19vZl91c2VycysiLyIrZXZlbnQubWF4X3BhcnRpY2lwYW50cysgIiAoIitldmVudC5ub19vZl93YWl0aW5nX3VzZXJzKyIpIisiIC0gIik7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5maW5kKCcuZmMtdGl0bGUnKS5wcmVwZW5kKGV2ZW50Lm5vX29mX3VzZXJzKyIvIitldmVudC5tYXhfcGFydGljaXBhbnRzKyIgLSAiKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAvLyBpZiBub3QgY2xhc3MgLSB3cml0aW5nIHRoZSBlbmR1c2VyIG5hbWUKICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50LmR1cmF0aW9uX2V2ZW50IT0wKSAvLyBhbHNvIGlmIG5vdCBob3VycyBvZiB3b3JrCiAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAvLyBlbGVtZW50LmZpbmQoJy5mYy10aXRsZScpLmFwcGVuZCgiICgiK2V2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfZmlyc3RfbmFtZSsiICIrZXZlbnQuZXZlbnRVc2Vyc1swXS5idXNlcl9sYXN0X25hbWUrIikiKTsKICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhldmVudC5ldmVudFVzZXJzKTsKICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhldmVudC5ldmVudFVzZXJzLmxlbmd0aCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50LmV2ZW50VXNlcnMubGVuZ3RoPjApCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5maW5kKCcuZmMtdGl0bGUnKS5wcmVwZW5kKCIiK2V2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfZmlyc3RfbmFtZSsiICIrZXZlbnQuZXZlbnRVc2Vyc1swXS5idXNlcl9sYXN0X25hbWUrIiAoIik7CiAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmZpbmQoJy5mYy10aXRsZScpLmFwcGVuZCgiKSIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAvLyBsb2dEZWJ1ZygiaGVyZTQiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChldmVudC5pc19yZXBlYXRpbmcgPT0gMSkgewogICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZmluZCgiLmZjLXRpdGxlIikuYXBwZW5kKCImbmJzcDs8aSBjbGFzcz0nZmEgZmEtcmVwZWF0Jz48L2k+Jm5ic3A7Iik7CiAgICAgICAgICAgICAgICAgICAgLy8gIGVsZW1lbnQuZmluZCgiLmZjLXRpdGxlIikuYXBwZW5kKCImbmJzcDs8aW1nIHNyYz0nL3B1YmxpYy9pbWFnZXMvcmVjdXJyaW5nLWljb24ucG5nJyB3aWR0aD0nMTBweCcgaGVpZ2h0PScxMHB4Jy8+Iik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG1pblRpbWU6ICRnQ2FsZW5kYXJEaXNwbGF5TWluVGltZSwKICAgICAgICAgICAgbWF4VGltZTogJGdDYWxlbmRhckRpc3BsYXlNYXhUaW1lLAogICAgICAgICAgICBzZWxlY3RhYmxlOiBmYWxzZSwKICAgICAgICAgICAgc2VsZWN0SGVscGVyOiBmYWxzZSwKICAgICAgICAgICAgdGltZXpvbmU6IGZhbHNlLAogICAgICAgICAgICBpc1JUTDogdHJ1ZSwKICAgICAgICAgICAgbGFuZzogImhlIiwgLy8ga2sKICAgICAgICAgICAgYWxsRGF5U2xvdDogZmFsc2UsCiAgICAgICAgICAgIGxvYWRpbmc6IGZ1bmN0aW9uKGJvb2wpIHsKICAgICAgICAgICAgICAgIGlmIChib29sKSB7CiAgICAgICAgICAgICAgICAgICAgbG9nRGVidWcoJ2xvYWRpbmcgY2FsZW5kYXIgJyArICRzY29wZS5jYWxlbmRhcik7CiAgICAgICAgICAgICAgICAgICAgLy8gJCgnI2xvYWRpbmcnKS5zaG93KCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vICQoJyNsb2FkaW5nJykuaGlkZSgpOwogICAgICAgICAgICAgICAgICAgIGxvZ0RlYnVnKCdmaW5pc2hlZCBsb2FkaW5nIGNhbGVuZGFyIHgnICsgJHNjb3BlLmNhbGVuZGFyKTsKICAgICAgICAgICAgICAgICAgICAkc2NvcGUudXBkYXRlQ2FsZW5kYXJDZW50ZXJUaXRsZSgpOwogICAgICAgICAgICAgICAgICAgIGxvZ0RlYnVnKCJhZnRlciBjYWxlbmRhciBsb2FkIHZpc2libGVEYXRlU3RhcnQ9Iit1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ2V0VmlldycpLnN0YXJ0KTsKICAgICAgICAgICAgICAgICAgICB2aXNpYmxlRGF0ZVN0YXJ0ID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5zdGFydCk7CiAgICAgICAgICAgICAgICAgICAgZGF0ZVRvR29UbyA9IHZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSArICItIiArICgnMCcgKyAodmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpICsgMSkpLnNsaWNlKC0yKSArICItIiArICgnMCcgKyB2aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSkuc2xpY2UoLTIpOwogICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJkYXRlVG9Hb1RvIitkYXRlVG9Hb1RvKTsKICAgICAgICAgICAgICAgICAgICAvLyAkaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3QvIit2aXNpYmxlRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCkrIi8iK3RoaXNfd2Vla19mdWxsX3llYXIrIi8iK3RoaXNfd2Vla19tb250aCsiLyIrdGhpc193ZWVrX2RheV9vZl9tb250aCsiLyIrIHRoaXNfd2Vla19ob3VycysgIi8iICsgdGhpc193ZWVrX21pbnV0ZXMpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpCiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmV2ZW50X3R5cGVfaWQ9JHNjb3BlLnNlbGVjdGVkX2V2ZW50X3R5cGVfaWQ7CiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnZpc2libGVEYXRlU3RhcnQ9dmlzaWJsZURhdGVTdGFydDsKICAgICAgICAgICAgICAgICAgICAvLzEyMTIxMgogICAgICAgICAgICAgICAgICAgIC8vIGlmICgkc2NvcGUuc2VsZWN0ZWRfZXZlbnRfdHlwZV9pZF9pc19jbGFzcykKICAgICAgICAgICAgICAgICAgICAvLyB7CiAgICAgICAgICAgICAgICAgICAgLy8gICAkaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3RjbGFzcy8iKyRzY29wZS5ldmVudF90eXBlX2lkKyIvIiskc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpKyIvIisoJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0TW9udGgoKSsxKSsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0RGF0ZSgpKyIvIiskc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXRIb3VycygpICsgIi8iICsgJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0TWludXRlcygpKyAiLyIgKyAkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcl9pZCkudGhlbihmdW5jdGlvbihyZXNwb25zZSkKICAgICAgICAgICAgICAgICAgICAvLyAgIHsKICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAvLwkgICAgJHNjb3BlLm15RGF0YSA9IHJlc3BvbnNlLmRhdGE7CiAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgLy8JCWxvZ0RlYnVnKCJncmlkb3B0aW9ucz0iKyRzY29wZS5ncmlkT3B0aW9ucyk7CiAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgJHNjb3BlLmV2ZW50c1N1Z2dlc3RlZCA9IHJlc3BvbnNlLmRhdGE7CiAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgLy8gJHNjb3BlLmRhdGVUb0dvVG89ZGF0ZVRvR29UbzsKICAgICAgICAgICAgICAgICAgICAvLyAgIH0pOwogICAgICAgICAgICAgICAgICAgIC8vIH0KICAgICAgICAgICAgICAgICAgICAvLyBlbHNlCiAgICAgICAgICAgICAgICAgICAgLy8gewogICAgICAgICAgICAgICAgICAgIC8vICAgJGh0dHAuZ2V0KCRnQXBpVVJMUHJlZml4ICsgIi9lbmR1c2VyL2V2ZW50cy9zdWdnZXN0LyIrJHNjb3BlLmV2ZW50X3R5cGVfaWQrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCkrIi8iKygkc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpKzEpKyIvIiskc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXREYXRlKCkrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldEhvdXJzKCkgKyAiLyIgKyAkc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXRNaW51dGVzKCkpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpCiAgICAgICAgICAgICAgICAgICAgLy8gICB7CiAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgLy8JICAgICRzY29wZS5teURhdGEgPSByZXNwb25zZS5kYXRhOwogICAgICAgICAgICAgICAgICAgIC8vICAgICAgIC8vCQlsb2dEZWJ1ZygiZ3JpZG9wdGlvbnM9Iiskc2NvcGUuZ3JpZE9wdGlvbnMpOwogICAgICAgICAgICAgICAgICAgIC8vICAgICAgICRzY29wZS5ldmVudHNTdWdnZXN0ZWQgPSByZXNwb25zZS5kYXRhOwogICAgICAgICAgICAgICAgICAgIC8vICAgICAgIC8vICRzY29wZS5kYXRlVG9Hb1RvPWRhdGVUb0dvVG87CiAgICAgICAgICAgICAgICAgICAgLy8gICB9KTsKICAgICAgICAgICAgICAgICAgICAvLyB9CgogICAgICAgICAgICAgICAgICAgIC8vIGFmdGVyIGNhbGVuZGFyIGlzIGxvYWRlZCAtIGxvYWRpbmcgZXZlbnQgdHlwZXMgYW5kIHN1Z2dlc3Rpb24gZm9yIHF1ZXVlcwogICAgICAgICAgICAgICAgICAgIC8vIHdlIGhhbmRsZSB0aGluZ3MgcmVsYXRlZCB0byB0aGUgZXZlbnQgdHlwZXMgb25seSBhZnRlciBsb2FkaW5nIHRoZW0gKGFuZCB0aGUgY2FsZW5kYXIpCiAgICAgICAgICAgICAgICAgICAgZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzTm9TeXN0ZW0oJGh0dHAsJHNjb3BlLCdldmVudF90eXBlcycsZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzTm9TeXN0ZW1fY2FsbGJhY2spOwoKICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiBnZXRBbGxCdXNpbmVzc0V2ZW50VHlwZXNOb1N5c3RlbV9jYWxsYmFjaygpCiAgICAgICAgICAgICAgICAgICAgeyAgICAvLyBjaGVja2luZyBpZiBjYWxlbmRhciBzaG91bGQgc3RhcnQgd2l0aCBhIHNwZWNpZmljIGV2ZW50IHR5cGUgZm9yIHN1Z2dlc3Rpb25zCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGxvZ0RlYnVnKCJYIHNoYXJlZFByb3BlcnRpZXMuZ2V0X2V2ZW50X3R5cGVfZm9yX3N1Z2dlc3Rpb25zPSIrc2hhcmVkUHJvcGVydGllcy5nZXRfZXZlbnRfdHlwZV9mb3Jfc3VnZ2VzdGlvbnMoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzaGFyZWRQcm9wZXJ0aWVzLmdldF9ldmVudF90eXBlX2Zvcl9zdWdnZXN0aW9ucygpIT1udWxsKQogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkX2V2ZW50X3R5cGVfaWQ9c2hhcmVkUHJvcGVydGllcy5nZXRfZXZlbnRfdHlwZV9mb3Jfc3VnZ2VzdGlvbnMoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZXZlbnRUeXBlU2VsZWN0ZWQoJHNjb3BlLnNlbGVjdGVkX2V2ZW50X3R5cGVfaWQpOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAvLyBmaXJzdCBjaGVja2luZyBpZiB0aGVyZSdzIGFuIGV2ZW50IHRvIHJlc2NoZWR1bGUKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNoYXJlZFByb3BlcnRpZXMuZ2V0X2V2ZW50X3Jlc2NoZWR1bGUoKSE9bnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5wcmV2aW91c19ldmVudF9yZXNjaGVkdWxlPXRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGVfZXZlbnQ9c2hhcmVkUHJvcGVydGllcy5nZXRfZXZlbnRfcmVzY2hlZHVsZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgIHNoYXJlZFByb3BlcnRpZXMuc2V0X2V2ZW50X3Jlc2NoZWR1bGUobnVsbCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nRGVidWcoImdvdCBldmVudCB0byByZXNjaGVkdWxlICIrSlNPTi5zdHJpbmdpZnkoJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGVfZXZlbnQpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dEZWJ1ZygicmVzY2hlZHVsZSBldmVudF90eXBlX2lkPSIrJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGVfZXZlbnQuZXZlbnRfdHlwZV9pZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkX2V2ZW50X3R5cGVfaWQ9JHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGVfZXZlbnQuZXZlbnRfdHlwZV9pZDsKICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZXZlbnRUeXBlU2VsZWN0ZWQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAvLyBjaGVja2luZyBzZWxlY3RlZCB1c2VyIG9ubHkgaWYgdGhlcmUncyBubyBzZWxlY3RlZCBldmVudCB0byBtb3ZlCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKSE9bnVsbCkKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJnb3QgcHJldmlvdXMgc2VsZWN0ZWQgdXNlciAiK3NoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKS5idXNlcl9maXJzdF9uYW1lKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcm5hbWU9c2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2VyX2ZpcnN0X25hbWUrIiAiK3NoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKS5idXNlcl9sYXN0X25hbWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJfaWQ9c2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2luZXNzX3VzZXJfaWQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nRGVidWcoIiRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyX2lkPSIrJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJfaWQpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcj10cnVlOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgfSwKICAgICAgICAgICAgLy8gc2VsZWN0OiBmdW5jdGlvbihzdGFydCwgZW5kLCBhbGxEYXkpIHsKICAgICAgICAgICAgLy8gICAgIC8vIHZhciB0aXRsZSA9IHByb21wdCgnRXZlbnQgVGl0bGU6JyArIChzdGFydCArIDM1MjgwMDAwMCkgLyAoNjAgKiAxMDAwKSArICIgIiArIGVuZCArICIgIiArIGFsbERheSk7CiAgICAgICAgICAgIC8vICAgICB0aXRsZSA9ICLXqdei15XXqiDXpNei15nXnNeV16oiOwogICAgICAgICAgICAvLyAgICAgaWYgKHRpdGxlKSB7CiAgICAgICAgICAgIC8vICAgICAgICAgbG9nRGVidWcoImNyZWF0aW5nIGRldmVudCBzdGFydCIpOwogICAgICAgICAgICAvLyAgICAgICAgIGxvZ0RlYnVnKCJzdGFydD0iICsgc3RhcnQpOwogICAgICAgICAgICAvLyAgICAgICAgIGNoZWNrRGF0ZSA9IG5ldyBEYXRlKHN0YXJ0KTsKICAgICAgICAgICAgLy8gICAgICAgICBsb2dEZWJ1ZygiY2hlY2sgZGF0ZSA9ICIgKyBjaGVja0RhdGUpCiAgICAgICAgICAgIC8vICAgICAgICAgbG9nRGVidWcoImVuZD0iICsgZW5kKTsKICAgICAgICAgICAgLy8gICAgICAgICBlY29sb3IgPSAiIyIgKyAkc2NvcGUuZXZlbnRDb2xvcjsgLy9nZXRSYW5kb21Db2xvcigpOwogICAgICAgICAgICAvLwogICAgICAgICAgICAvLwogICAgICAgICAgICAvLyAgICAgICAgIC8vIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW10uZnVsbENhbGVuZGFyKCdyZXJlbmRlckV2ZW50cycpOwogICAgICAgICAgICAvLwogICAgICAgICAgICAvLyAgICAgICAgIGNhbGVuZGFyID0gJHNjb3BlLmNhbGVuZGFyX25hbWU7CiAgICAgICAgICAgIC8vICAgICAgICAgdGVtcF9saW1pdF9pZCA9ICRnQ2FsZW5kYXJUZW1wRW52SUQxIC0gZ2V0UmFuZG9tSW50KDEwLCA4MCk7CiAgICAgICAgICAgIC8vICAgICAgICAgbmV3RXZlbnQgPSB7CiAgICAgICAgICAgIC8vICAgICAgICAgICAgIGlkOiB0ZW1wX2xpbWl0X2lkLAogICAgICAgICAgICAvLyAgICAgICAgICAgICB0aXRsZTogdGl0bGUsCiAgICAgICAgICAgIC8vICAgICAgICAgICAgIHN0YXJ0OiBzdGFydCwKICAgICAgICAgICAgLy8gICAgICAgICAgICAgY29sb3I6IGVjb2xvciwKICAgICAgICAgICAgLy8gICAgICAgICAgICAgZW5kOiBlbmQsCiAgICAgICAgICAgIC8vICAgICAgICAgICAgIGFsbERheTogZmFsc2UsCiAgICAgICAgICAgIC8vICAgICAgICAgICAgIGNsYXNzTmFtZTogWydvcGVuU2VzYW1lJ10KICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgIC8vIGNvbG9yOiByZXNvdXJjZS5ldmVudENvbG9yCiAgICAgICAgICAgIC8vICAgICAgICAgfTsKICAgICAgICAgICAgLy8gICAgICAgICBjYWxlbmRhciA9ICRzY29wZS5jYWxlbmRhcl9uYW1lOwogICAgICAgICAgICAvLwogICAgICAgICAgICAvLyAgICAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlbmRlckV2ZW50JywgbmV3RXZlbnQsIHRydWUpOwogICAgICAgICAgICAvLyAgICAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3Vuc2VsZWN0Jyk7CiAgICAgICAgICAgIC8vCiAgICAgICAgICAgIC8vICAgICAgICAgbG9nRGVidWcoImNyZWF0aW5nIGRldmVudCBlbmQiKTsKICAgICAgICAgICAgLy8gICAgICAgICAkc2NvcGUuYWRkRXZlbnRUb0RhdGFiYXNlKHN0YXJ0LCBlbmQsIHRpdGxlLCBlY29sb3IsIHRlbXBfbGltaXRfaWQpOwogICAgICAgICAgICAvLwogICAgICAgICAgICAvLyAgICAgfQogICAgICAgICAgICAvLyB9CiAgICAgICAgfQogICAgfTsKfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdIb3Vyc09mV29ya0NvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkY29tcGlsZSwgJGxvY2F0aW9uLCB1aUNhbGVuZGFyQ29uZmlnLCAkdWliTW9kYWwpIHsKICAgIGxvZ0RlYnVnKCdIb3Vyc09mV29yayBDb250cm9sbGVyJyk7CgogICAgbG9nRGVidWcoIiRsb2NhdGlvbi5zZWFyY2goKS5zdGFydD0iICsgJGxvY2F0aW9uLnNlYXJjaCgpLnN0YXJ0KTsKICAgIGlmICh0eXBlb2YgJGxvY2F0aW9uLnNlYXJjaCgpLnN0YXJ0ID09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgY3VyckRlZmF1bHREYXRlID0gJGdIb3VyMGRhdGU7CiAgICAgICAgJHNjb3BlLmZpeGVkU2NoZWR1bGUgPSB0cnVlOwogICAgICAgICRzY29wZS5jYWxlbmRhclRpdGxlQ2VudGVyID0gItep16LXldeqINek16LXmdec15XXqiDXp9eR15XXoteV16oiOwogICAgICAgIGxvZ0RlYnVnKCLXqdei15XXqiDXpNei15nXnNeV16og16fXkdeV16LXldeqIik7CiAgICAgICAgaG91cnNPZldvcmtEZWZhdWx0Vmlldz0nZG9udFNob3dEYXRlJzsKICAgIH0gZWxzZSB7CiAgICAgICAgY3VyckRlZmF1bHREYXRlID0gJGxvY2F0aW9uLnNlYXJjaCgpLnN0YXJ0OwogICAgICAgICRzY29wZS5maXhlZFNjaGVkdWxlID0gZmFsc2U7CiAgICAgICAgLy8gJHNjb3BlLmNhbGVuZGFyVGl0bGVDZW50ZXIgPSAi16nXoteV16og16TXoteZ15zXldeqINen15HXldei15XXqiI7CiAgICAgICAgaG91cnNPZldvcmtEZWZhdWx0Vmlldz0nYWdlbmRhV2Vlayc7CiAgICB9CgoKICAgICRzY29wZS52aXNpYmxlRGF0ZSA9IFtdOwogICAgJHNjb3BlLmNhbGVuZGFyID0gJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnRUeXBlID0gW107CgogICAgZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzKCRodHRwLCRzY29wZSwnZXZlbnRfdHlwZXMnLGdldEFsbEJ1c2luZXNzRXZlbnRUeXBlc19jYWxsYmFjayk7CgogICAgZnVuY3Rpb24gZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzX2NhbGxiYWNrKCkKICAgIHsKICAgICAgJHNjb3BlLnNlbGVjdEV2ZW50VHlwZSgkc2NvcGUuZXZlbnRfdHlwZXNbMF0pOwogICAgfQogICAgJHNjb3BlLmJhY2tUb0NhbGVuZGFyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmlzaWJsZURhdGVTdGFydCA9IG5ldyBEYXRlKHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3Jykuc3RhcnQpOwogICAgICAgIGRhdGVUb0dvVG8gPSB2aXNpYmxlRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCkgKyAiLSIgKyAoJzAnICsgKHZpc2libGVEYXRlU3RhcnQuZ2V0TW9udGgoKSArIDEpKS5zbGljZSgtMikgKyAiLSIgKyAoJzAnICsgdmlzaWJsZURhdGVTdGFydC5nZXREYXRlKCkpLnNsaWNlKC0yKTsKICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2NhbGVuZGFyJykuc2VhcmNoKHsKICAgICAgICAgICAgc3RhcnQ6IGRhdGVUb0dvVG8KICAgICAgICB9KTsKICAgIH0KICAgICRzY29wZS5zZWxlY3RFdmVudFR5cGUgPSBmdW5jdGlvbihldmVudFR5cGUpIHsKICAgICAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudFR5cGUgPSBldmVudFR5cGU7CiAgICAgICAgbG9nRGVidWcoInNlbGVjdGVkIEV2ZW50IFR5cGUgPSAiICsgJHNjb3BlLnNlbGVjdGVkRXZlbnRUeXBlLmV2ZW50X3R5cGVfaWQgKyAiLCAiICsgJHNjb3BlLnNlbGVjdGVkRXZlbnRUeXBlLmV2ZW50X3R5cGVfbmFtZSk7CiAgICAgICAga3V6ZUlzQ2FsZW5kYXJEcmFnZ2JsZSA9ICRzY29wZS5zZWxlY3RlZEV2ZW50VHlwZS5kaWZmX3JhbmdlOwogICAgfTsKCiAgICAkc2NvcGUuY2hhbmdlRXZlbnRDb2xvciA9IGZ1bmN0aW9uKG5ld0NvbG9yKSB7CiAgICAgICAgJHNjb3BlLmV2ZW50Q29sb3IgPSBuZXdDb2xvcjsKICAgICAgICBhbGxsRXZlbnRzQXJyYXkgPSB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdjbGllbnRFdmVudHMnKTsKICAgICAgICBmb3IgKGkgaW4gYWxsbEV2ZW50c0FycmF5KSB7CiAgICAgICAgICAgIGFsbGxFdmVudHNBcnJheVtpXS5jb2xvciA9ICIjIiArIG5ld0NvbG9yOwogICAgICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCd1cGRhdGVFdmVudCcsIGFsbGxFdmVudHNBcnJheVtpXSk7CiAgICAgICAgfQogICAgfTsKCiAgICAkc2NvcGUuZXZlbnRDbGlja01vZHVsZSA9IGZ1bmN0aW9uKHNlbGVjdGVkRXZlbnQsIHNpemUpIHsKICAgICAgICBsb2dEZWJ1Zygic2VsZWN0ZWQgRXZlbnQgdGl0bGU9IiArIHNlbGVjdGVkRXZlbnQudGl0bGUpOwoKCiAgICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgICAgICAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2xpbWl0YXRpb25fZGV0YWlscy5odG1sJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ2V2ZW50RGV0YWlsc0hvdXJzT2ZXb3JrTW9kYWxDb250cm9sbGVyJywKICAgICAgICAgICAgc2l6ZTogc2l6ZSwKICAgICAgICAgICAgcmVzb2x2ZTogewogICAgICAgICAgICAgICAgc2VsZWN0ZWRFdmVudDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGVjdGVkRXZlbnQ7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZml4ZWRTY2hlZHVsZTogZnVuY3Rpb24gKCkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuICRzY29wZS5maXhlZFNjaGVkdWxlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIG1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24oc2VsZWN0ZWRJdGVtKSB7CiAgICAgICAgICAgICRzY29wZS5zZWxlY3RlZCA9IHNlbGVjdGVkSXRlbTsKICAgICAgICB9LCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgbG9nRGVidWcoJ01vZGFsIGRpc21pc3NlZCBhdDogJyArIG5ldyBEYXRlKCkpOwogICAgICAgIH0pOwogICAgfTsKCgogICAgdmFyIGRhdGUgPSBuZXcgRGF0ZSgpOwogICAgdmFyIGQgPSBkYXRlLmdldERhdGUoKTsKICAgIHZhciBtID0gZGF0ZS5nZXRNb250aCgpOwogICAgdmFyIHkgPSBkYXRlLmdldEZ1bGxZZWFyKCk7CgoKICAgIGZ1bmN0aW9uIGdldFRpbWVTdGFtcChub3cpIHsKICAgICAgICByZXR1cm4gKChub3cuZ2V0TW9udGgoKSArIDEpICsgJy8nICsgKG5vdy5nZXREYXRlKCkpICsgJy8nICsgbm93LmdldEZ1bGxZZWFyKCkgKyAiICIgKyBub3cuZ2V0SG91cnMoKSArICc6JyArICgobm93LmdldE1pbnV0ZXMoKSA8IDEwKSA/ICgiMCIgKyBub3cuZ2V0TWludXRlcygpKSA6IChub3cuZ2V0TWludXRlcygpKSkgKyAnOicgKyAoKG5vdy5nZXRTZWNvbmRzKCkgPCAxMCkgPyAoIjAiICsgbm93CiAgICAgICAgICAgIC5nZXRTZWNvbmRzKCkpIDogKG5vdy5nZXRTZWNvbmRzKCkpKSk7CiAgICB9CgoKICAgIC8qIENoYW5nZSBWaWV3ICovCiAgICAkc2NvcGUuY2hhbmdlVmlldyA9IGZ1bmN0aW9uKHZpZXcsIGNhbGVuZGFyKSB7CiAgICAgICAgbG9nRGVidWcoImNoYW5nZSB2aWV3ICIgKyB2aWV3KTsKICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdjaGFuZ2VWaWV3Jywgdmlldyk7CiAgICB9OwogICAgLyogQ2hhbmdlIFZpZXcgKi8KCiAgICAkc2NvcGUucmVuZGVyQ2FsZW5kZXIgPSBmdW5jdGlvbihjYWxlbmRhcikgewogICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICBpZiAodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdKSB7CiAgICAgICAgICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZW5kZXInKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfTsKCiAgICAkc2NvcGUuY2hhbmdlU2VsZWN0YWJsZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICBrdXplSXNDYWxlbmRhckRyYWdnYmxlID0gIWt1emVJc0NhbGVuZGFyRHJhZ2dibGU7CiAgICAgICAgICAgIGNhbGVuZGFyID0gJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnOwogICAgICAgICAgICAvLyB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3JykuY2FsZW5kYXIub3B0aW9ucy5zZWxlY3RhYmxlID0gZmFsc2U7CiAgICAgICAgICAgIHZpZXcgPSB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdvcHRpb24nLCAnc2VsZWN0YWJsZScsIGZhbHNlKTsKICAgICAgICAgICAgLy8gdmlldy5jYWxlbmRhci5vcHRpb25zLnNlbGVjdGFibGUgPSBmYWxzZTsKICAgICAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVuZGVyJyk7CgogICAgICAgIH0KICAgICAgICAvKiBjb25maWcgb2JqZWN0ICovCgogICAgJHNjb3BlLmNhbGVuZGFyX2hvdXJzX29mX3dvcmtfY29uZmlnID0gewogICAgICAgIGNhbGVuZGFyOiB7CiAgICAgICAgICAgIGhlaWdodDogJ2F1dG8nLAogICAgICAgICAgICBlZGl0YWJsZTogdHJ1ZSwKICAgICAgICAgICAgLy8gaGVhZGVyOiB7CiAgICAgICAgICAgIC8vICAgICBsZWZ0OiAnJywKICAgICAgICAgICAgLy8gICAgIGNlbnRlcjogJycsCiAgICAgICAgICAgIC8vICAgICByaWdodDogJycKICAgICAgICAgICAgLy8gfSwKICAgICAgICAgICAgaGVhZGVyOiAnJywKICAgICAgICAgICAgLy8gaGVhZGVyOiB7CiAgICAgICAgICAgIC8vICAgICBsZWZ0OiAndGl0bGUnLAogICAgICAgICAgICAvLyAgICAgY2VudGVyOiAnJywKICAgICAgICAgICAgLy8gICAgIHJpZ2h0OiAndG9kYXkgcHJldixuZXh0JwogICAgICAgICAgICAvLyB9LAogICAgICAgICAgICAvLyBkZWZhdWx0VmlldzogJ2FnZW5kYVdlZWsnLAogICAgICAgICAgICB2aWV3czogewogICAgICAgICAgICAgICAgZG9udFNob3dEYXRlOiB7CiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2FnZW5kYVdlZWsnLAogICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRheXM6IDcKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnQXBlcnR1cmEnLAogICAgICAgICAgICAgICAgICAgIGNvbHVtbkZvcm1hdDogJ2RkZGQnIC8vIEZvcm1hdCB0aGUgZGF5IHRvIG9ubHkgc2hvdyBsaWtlICdNb25kYXknCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGhpZGRlbkRheXM6IFswLCA2XSAvLyBIaWRlIFN1bmRheSBhbmQgU2F0dXJkYXk/CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZG9TaG93RGF0ZTogewogICAgICAgICAgICAgICAgICAgIHR5cGU6ICdhZ2VuZGFXZWVrJywKICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogewogICAgICAgICAgICAgICAgICAgICAgICBkYXlzOiA3CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ0FwZXJ0dXJhJywKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGhpZGRlbkRheXM6IFswLCA2XSAvLyBIaWRlIFN1bmRheSBhbmQgU2F0dXJkYXk/CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGV2ZW50RHJvcDogZnVuY3Rpb24oZXZlbnQsIGRheURlbHRhLCBtaW51dGVEZWx0YSwgYWxsRGF5LCByZXZlcnRGdW5jLCB1aUNhbGVuZGFyQ29uZmlnKSB7CiAgICAgICAgICAgICAgICBsb2dEZWJ1ZygiZXZlbnRkcm9wIiArIGV2ZW50LnRpdGxlICsgIigiICsgZXZlbnQuaWQgKyAiKSBtb3ZlZCAiICsgbWludXRlRGVsdGEgKyAiIG1pbnV0ZXMiKTsKICAgICAgICAgICAgICAgIGxvZ0RlYnVnKCJvbGQgc3RhcnQ9IiArIGV2ZW50LnN0YXJ0ICsgIiwgb2xkIGVuZD0iICsgZXZlbnQuZW5kKTsKICAgICAgICAgICAgICAgICRzY29wZS51cGRhdGVMaW1pdGF0aW9uRGF0YWJhc2UoZXZlbnQuc3RhcnQsIGV2ZW50LmVuZCwgZXZlbnQuaWQsIGV2ZW50LnRlbXBfbGltaXRfaWQsIGV2ZW50KTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZXZlbnRSZXNpemU6IGZ1bmN0aW9uKGV2ZW50LCBkZWx0YSwgcmV2ZXJ0RnVuYykgewogICAgICAgICAgICAgICAgbG9nRGVidWcoImV2ZW50cmVzaXplLCBldmVudC5lbmQ9IiArIGV2ZW50LmVuZCk7CiAgICAgICAgICAgICAgICAkc2NvcGUudXBkYXRlTGltaXRhdGlvbkRhdGFiYXNlKGV2ZW50LnN0YXJ0LCBldmVudC5lbmQsIGV2ZW50LmlkLCBldmVudC50ZW1wX2xpbWl0X2lkLCBldmVudCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRlZmF1bHRWaWV3OiBob3Vyc09mV29ya0RlZmF1bHRWaWV3LAogICAgICAgICAgICBldmVudENsaWNrOiBmdW5jdGlvbihjYWxFdmVudCwganNFdmVudCwgdmlldykgewogICAgICAgICAgICAgICAgbG9nRGVidWcoImV2ZW50IGNsaWNrZWQgIiArIGNhbEV2ZW50LnRpdGxlICsgIihpZD0iICsgY2FsRXZlbnQuaWQgKyAiLCBkYXlfbGltaXRfaWQ9IiArIGNhbEV2ZW50LmRheV9saW1pdF9pZCArICIsIHRlbXBfbGltaXRfaWQ9IiArIGNhbEV2ZW50LnRlbXBfbGltaXRfaWQgKyAiLCBsaW1pdF9pZD0iICsgY2FsRXZlbnQubGltaXRfaWQgKyAiKSBzdGFydD0iICsgY2FsRXZlbnQuc3RhcnQgKyAiLCBlbmQ9IiArIGNhbEV2ZW50LmVuZCk7CiAgICAgICAgICAgICAgICAkc2NvcGUuZXZlbnRDbGlja01vZHVsZShjYWxFdmVudCk7CiAgICAgICAgICAgICAgICAvLyBjaGFuZ2UgdGhlIGJvcmRlciBjb2xvciBqdXN0IGZvciBmdW4KICAgICAgICAgICAgICAgIC8vICQodGhpcykuY3NzKCdib3JkZXItY29sb3InLCAncmVkJyk7CgogICAgICAgICAgICB9LAogICAgICAgICAgICBldmVudFJlbmRlcjogZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBjb25zb2xlLmxvZyhldmVudCk7CiAgICAgICAgICAgICAgZWxlbWVudC5maW5kKCcuZmMtdGl0bGUnKS5wcmVwZW5kKGV2ZW50LmxvY2F0aW9uX25hbWUrIiAvIDxici8+Iik7CiAgICAgICAgICAgICAgZWxlbWVudC5maW5kKCcuZmMtdGl0bGUnKS5wcmVwZW5kKGV2ZW50Lmluc3RydWN0b3JfbmFtZSsiIC8gPGJyLz4iKTsKICAgICAgICAgICAgICAvLyBlbGVtZW50LmZpbmQoJy5mYy10aXRsZScpLnByZXBlbmQoIiIrZXZlbnQuZXZlbnRVc2Vyc1swXS5idXNlcl9maXJzdF9uYW1lKyIgIitldmVudC5ldmVudFVzZXJzWzBdLmJ1c2VyX2xhc3RfbmFtZSsiICgiKTsKCiAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coInJlbmRlciBsaW1pdGF0aW9uICIrSlNPTi5zdHJpbmdpZnkoZXZlbnQpKTsKICAgICAgICAgICAgICAgIC8vIGlmIChldmVudC5pc19jbGFzcz09MSkKICAgICAgICAgICAgICAgIC8vIHsKICAgICAgICAgICAgICAgIC8vICAgLy8gaWYgY2xhc3MgYWRkaW5nIG51bWJlciBvZiBwYXJ0aWNpcGFudHMKICAgICAgICAgICAgICAgIC8vICAgaWYgKGV2ZW50Lm5vX29mX3dhaXRpbmdfdXNlcnM+MCkKICAgICAgICAgICAgICAgIC8vICAgewogICAgICAgICAgICAgICAgLy8gICAgIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZChldmVudC5ub19vZl91c2VycysiLyIrZXZlbnQubWF4X3BhcnRpY2lwYW50cysgIiAoIitldmVudC5ub19vZl93YWl0aW5nX3VzZXJzKyIpIisiIC0gIik7CiAgICAgICAgICAgICAgICAvLyAgIH0KICAgICAgICAgICAgICAgIC8vICAgZWxzZQogICAgICAgICAgICAgICAgLy8gICB7CiAgICAgICAgICAgICAgICAvLyAgICAgZWxlbWVudC5maW5kKCcuZmMtdGl0bGUnKS5wcmVwZW5kKGV2ZW50Lm5vX29mX3VzZXJzKyIvIitldmVudC5tYXhfcGFydGljaXBhbnRzKyIgLSAiKTsKICAgICAgICAgICAgICAgIC8vICAgfQogICAgICAgICAgICAgICAgLy8gfQogICAgICAgICAgICAgICAgLy8gZWxzZQogICAgICAgICAgICAgICAgLy8gewogICAgICAgICAgICAgICAgLy8gICAvLyBpZiBub3QgY2xhc3MgLSB3cml0aW5nIHRoZSBlbmR1c2VyIG5hbWUKICAgICAgICAgICAgICAgIC8vICAgaWYgKGV2ZW50LmR1cmF0aW9uX2V2ZW50IT0wKSAvLyBhbHNvIGlmIG5vdCBob3VycyBvZiB3b3JrCiAgICAgICAgICAgICAgICAvLyAgIHsKICAgICAgICAgICAgICAgIC8vICAgICAvLyBlbGVtZW50LmZpbmQoJy5mYy10aXRsZScpLmFwcGVuZCgiICgiK2V2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfZmlyc3RfbmFtZSsiICIrZXZlbnQuZXZlbnRVc2Vyc1swXS5idXNlcl9sYXN0X25hbWUrIikiKTsKICAgICAgICAgICAgICAgIC8vICAgICBlbGVtZW50LmZpbmQoJy5mYy10aXRsZScpLnByZXBlbmQoIiIrZXZlbnQuZXZlbnRVc2Vyc1swXS5idXNlcl9maXJzdF9uYW1lKyIgIitldmVudC5ldmVudFVzZXJzWzBdLmJ1c2VyX2xhc3RfbmFtZSsiICgiKTsKICAgICAgICAgICAgICAgIC8vICAgICBlbGVtZW50LmZpbmQoJy5mYy10aXRsZScpLmFwcGVuZCgiKSIpOwogICAgICAgICAgICAgICAgLy8gICB9CiAgICAgICAgICAgICAgICAvLyAgIC8vIGxvZ0RlYnVnKCJoZXJlNCIpOwogICAgICAgICAgICAgICAgLy8gfQogICAgICAgICAgICAgICAgLy8gaWYgKGV2ZW50LmlzX3JlcGVhdGluZyA9PSAxKSB7CiAgICAgICAgICAgICAgICAvLyAgICAgZWxlbWVudC5maW5kKCIuZmMtdGl0bGUiKS5wcmVwZW5kKCImbmJzcDs8aSBjbGFzcz0nZmEgZmEtcmVwZWF0Jz48L2k+Jm5ic3A7Iik7CiAgICAgICAgICAgICAgICAvLyAgICAgLy8gIGVsZW1lbnQuZmluZCgiLmZjLXRpdGxlIikuYXBwZW5kKCImbmJzcDs8aW1nIHNyYz0nL3B1YmxpYy9pbWFnZXMvcmVjdXJyaW5nLWljb24ucG5nJyB3aWR0aD0nMTBweCcgaGVpZ2h0PScxMHB4Jy8+Iik7CiAgICAgICAgICAgICAgICAvLyB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG1pblRpbWU6ICRnQ2FsZW5kYXJEaXNwbGF5TWluVGltZSwKICAgICAgICAgICAgbWF4VGltZTogJGdDYWxlbmRhckRpc3BsYXlNYXhUaW1lLAogICAgICAgICAgICBzZWxlY3RhYmxlOiB0cnVlLAogICAgICAgICAgICBzZWxlY3RIZWxwZXI6IGZhbHNlLAogICAgICAgICAgICB0aW1lem9uZTogZmFsc2UsCiAgICAgICAgICAgIGlzUlRMOiB0cnVlLAogICAgICAgICAgICBsYW5nOiAiaGUiLAogICAgICAgICAgICBzZWxlY3RDb25zdHJhaW50OiB7CiAgICAgICAgICAgICAgICBzdGFydDogJzAwOjAxJywKICAgICAgICAgICAgICAgIGVuZDogJzIzOjU5JywKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZGVmYXVsdERhdGU6IG1vbWVudChjdXJyRGVmYXVsdERhdGUpLAogICAgICAgICAgICBhbGxEYXlTbG90OiBmYWxzZSwKICAgICAgICAgICAgbG9hZGluZzogZnVuY3Rpb24oYm9vbCkgewogICAgICAgICAgICAgICAgaWYgKGJvb2wpIHsKICAgICAgICAgICAgICAgICAgICBsb2dEZWJ1ZygnbG9hZGluZyBjYWxlbmRhciAnICsgJHNjb3BlLmNhbGVuZGFyKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gJCgnI2xvYWRpbmcnKS5zaG93KCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vICQoJyNsb2FkaW5nJykuaGlkZSgpOwogICAgICAgICAgICAgICAgICAgIGxvZ0RlYnVnKCdmaW5pc2hlZCBsb2FkaW5nIGNhbGVuZGFyICcgKyAkc2NvcGUuY2FsZW5kYXIpOwogICAgICAgICAgICAgICAgICAgIGlmICghJHNjb3BlLmZpeGVkU2NoZWR1bGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnVwZGF0ZUNhbGVuZGFyQ2VudGVyVGl0bGUoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgLy8gJHNjb3BlLmJhY2tUb0ZpeGVkKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNlbGVjdDogZnVuY3Rpb24oc3RhcnQsIGVuZCwgYWxsRGF5KSB7CiAgICAgICAgICAgICAgLy8gdGhpcyBpcyBjYWxsZWQgd2hlbiBjcmVhdGluZyBhIG5ldyBibG9jawogICAgICAgICAgICAgICRzY29wZS5jcmVhdGVMaW1pdGF0aW9uQmxvY2soc3RhcnQsIGVuZCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwoKICAgIC8vIGNyZWF0ZSBsaW1pdGF0aW9uIGJsb2NrCiAgICAkc2NvcGUuY3JlYXRlTGltaXRhdGlvbkJsb2NrID0gZnVuY3Rpb24oc3RhcnQsIGVuZCkKICAgIHsKICAgICAgICBsb2dEZWJ1ZygiZnVuY3Rpb246IGNyZWF0ZUxpbWl0YXRpb25CbG9jayIpOwogICAgICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewogICAgICAgICAgICBhbmltYXRpb246IGZhbHNlLAogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9saW1pdGF0aW9uX2NyZWF0ZS5waHAnLAogICAgICAgICAgICBzaXplOiAneHMnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnYnVzaW5lc3NfbW9kYWxfbGltaXRhdGlvbl9jcmVhdGUnLAogICAgICAgICAgICByZXNvbHZlOiB7CiAgICAgICAgICAgICAgc3RhcnQ6IGZ1bmN0aW9uKCkKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBzdGFydDsKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGVuZDogZnVuY3Rpb24oKQogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIGVuZDsKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGZpeGVkU2NoZWR1bGU6IGZ1bmN0aW9uICgpCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgcmV0dXJuICRzY29wZS5maXhlZFNjaGVkdWxlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfQogICAgJHNjb3BlLnVwZGF0ZUNhbGVuZGFyQ2VudGVyVGl0bGUgPSBmdW5jdGlvbigpIHsKICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ2V0VmlldycpOwoKICAgICAgICB2aXNpYmxlRGF0ZVN0YXJ0ID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5zdGFydCk7CiAgICAgICAgdmlzaWJsZURhdGVFbmQgPSBuZXcgRGF0ZSh1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ2V0VmlldycpLmVuZCk7CgogICAgICAgICRzY29wZS5jYWxlbmRhclRpdGxlQ2VudGVyID0gdmlzaWJsZURhdGVTdGFydC5nZXREYXRlKCkgKyAiICIgKyBtb250aE5hbWVzW3Zpc2libGVEYXRlU3RhcnQuZ2V0TW9udGgoKV0gKwogICAgICAgICAgICAiIOKAlCAiICsgdmlzaWJsZURhdGVFbmQuZ2V0RGF0ZSgpICsgIiAiICsgbW9udGhOYW1lc1t2aXNpYmxlRGF0ZUVuZC5nZXRNb250aCgpXSArCiAgICAgICAgICAgICIgIiArIHZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKTsKICAgIH07CiAgICAvKiBldmVudCBzb3VyY2VzIGFycmF5Ki8KICAgICRzY29wZS5ldmVudFNvdXJjZXMgPSBbewogICAgICAgIHVybDogJy9hcGkvYWRtaW4vY2FsZW5kYXIvbGltaXRhdGlvbnMvcGVyZGF5L2dldHBvc3QnLAogICAgICAgIHR5cGU6ICdQT1NUJwogICAgfV07CgogICAgLy8gJHNjb3BlLmdldEV2ZW50cyA9IGZ1bmN0aW9uKCkgewogICAgLy8gICAgIGNhbGVuZGFyID0gJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnOwogICAgLy8gICAgIGFsbGxFdmVudHNBcnJheSA9IHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2NsaWVudEV2ZW50cycpOwogICAgLy8gICAgIGZvciAoaSBpbiBhbGxsRXZlbnRzQXJyYXkpIHsKICAgIC8vICAgICAgICAgbG9nRGVidWcoYWxsbEV2ZW50c0FycmF5W2ldKTsKICAgIC8vICAgICB9CiAgICAvLwogICAgLy8gfQoKICAgICRzY29wZS5nb3RvVG9kYXkgPSBmdW5jdGlvbigpIHsKICAgICAgICAkc2NvcGUuZ290b0RhdGUobmV3IERhdGUoKSk7CiAgICB9CiAgICAkc2NvcGUuZ290b05leHQgPSBmdW5jdGlvbigpIHsKICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignbmV4dCcpOwogICAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZW1vdmVFdmVudHMnKTsKICAgICAgICAkc2NvcGUudXBkYXRlQ2FsZW5kYXJDZW50ZXJUaXRsZSgpOwogICAgfQogICAgJHNjb3BlLmdvdG9QcmV2ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlbW92ZUV2ZW50cycpOwogICAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdwcmV2Jyk7CiAgICAgICAgJHNjb3BlLnVwZGF0ZUNhbGVuZGFyQ2VudGVyVGl0bGUoKTsKICAgIH0KICAgICRzY29wZS5nb3RvRGF0ZSA9IGZ1bmN0aW9uKG5ld2RhdGUpIHsKICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ290b0RhdGUnLCBuZXdkYXRlKTsKICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignY2hhbmdlVmlldycsICdhZ2VuZGFXZWVrJyk7CiAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlbW92ZUV2ZW50cycpOwogICAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZWZldGNoRXZlbnRzJyk7CgogICAgICAgICRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlKCk7CiAgICAgICAgJHNjb3BlLmZpeGVkU2NoZWR1bGUgPSBmYWxzZTsKICAgIH0KCiAgICAkc2NvcGUuYmFja1RvRml4ZWQgPSBmdW5jdGlvbigpIHsKICAgICAgICAkc2NvcGUuZml4ZWRTY2hlZHVsZSA9IHRydWU7CiAgICAgICAgJHNjb3BlLmNhbGVuZGFyVGl0bGVDZW50ZXIgPSAi16nXoteV16og16TXoteZ15zXldeqINen15HXldei15XXqiI7CiAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2NoYW5nZVZpZXcnLCAnZG9udFNob3dEYXRlJyk7CiAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dvdG9EYXRlJywgbW9tZW50KCRnSG91cjBkYXRlKSk7CiAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlbW92ZUV2ZW50cycpOwogICAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZWZldGNoRXZlbnRzJyk7CgogICAgfQoKICAgIC8vICRzY29wZS5kZWxldGVBbGxFdmVudHMgPSBmdW5jdGlvbigpIHsKICAgIC8vICAgICBjYWxlbmRhciA9ICdjYWxlbmRhcl9ob3Vyc19vZl93b3JrJzsKICAgIC8vICAgICBhbGxsRXZlbnRzQXJyYXkgPSB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdjbGllbnRFdmVudHMnKTsKICAgIC8vICAgICBmb3IgKGkgaW4gYWxsbEV2ZW50c0FycmF5KSB7CiAgICAvLyAgICAgICAgIGxvZ0RlYnVnKGFsbGxFdmVudHNBcnJheVtpXSk7CiAgICAvLyAgICAgICAgICRzY29wZS5kZWxldGVDYWxlbmRhckpTRXZlbnQoY2FsZW5kYXIsIGFsbGxFdmVudHNBcnJheVtpXS5pZCk7CiAgICAvLyAgICAgICAgICRzY29wZS5kZWxldGVDYWxlbmRhckRCRXZlbnQoYWxsbEV2ZW50c0FycmF5W2ldLmlkKTsKICAgIC8vICAgICB9CiAgICAvLwogICAgLy8gfQogICAgJHNjb3BlLnVwZGF0ZUxpbWl0YXRpb25EYXRhYmFzZSA9IGZ1bmN0aW9uKHN0YXJ0X3BhcmFtLCBlbmRfcGFyYW0sIGV2ZW50X2lkLCB0ZW1wX2xpbWl0X2lkLCB0aGVldmVudCkgewoKICAgICAgICBsb2dEZWJ1ZygidXBkYXRlTGltaXRhdGlvbkRhdGFiYXNlIHN0YXJ0PSIgKyBzdGFydF9wYXJhbSArICIsIGVuZD0iICsgZW5kX3BhcmFtICsgIixldmVudF9pZD0iICsgZXZlbnRfaWQpOwoKICAgICAgICBmdW5jdGlvbiB1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25fZmFpbHVyZSgpCiAgICAgICAgewogICAgICAgICAgY2FsZW5kYXIgPSAiY2FsZW5kYXJfaG91cnNfb2Zfd29yayI7CiAgICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZWZldGNoRXZlbnRzJyk7CiAgICAgICAgfQogICAgICAgIC8vIGlmIHRoZSBldmVudCB0aGF0IGlzIGdldHRpbmcgdXBkYXRlZCBpcyBhbiBldmVudCBmcm9tIDE5NzAgKG5vdCBwZXJkYXkpCiAgICAgICAgLy8gdGhlbiB3ZSBhZGQgYSBuZXcgcGVyZGF5IGxpbWl0YXRpb24gd2l0aCBsaW1pdF9pZCBvZiB0aGUgMTk3MCBsaW1pdGF0aW9ucyAtIHdpdGggdGhlIG5ldyB0aW1lcy4KCiAgICAgICAgLy8gb3RoZXJ3aXNlIHdlIGp1c3QgdXBkYXRlIHRoZSBwZXJkYXkgbGltaXRhdGlvbgoKICAgICAgICBpZiAoJHNjb3BlLmZpeGVkU2NoZWR1bGUpIC8vIGZpeGVkIHNjaGVkdWxlIHZzIHNwZWNpZmljIHdlZWQvZGF5IGxpbWl0YXRpb24KICAgICAgICB7CiAgICAgICAgICB0aGVkYXRhID0gewogICAgICAgICAgICAgIHN0YXJ0X2RhdGU6IHN0YXJ0X3BhcmFtLAogICAgICAgICAgICAgIGVuZF9kYXRlOiBlbmRfcGFyYW0sCiAgICAgICAgICAgICAgdGVtcF9saW1pdF9pZDogdGVtcF9saW1pdF9pZCwKICAgICAgICAgICAgICBsaW1pdF9pZDogZXZlbnRfaWQKICAgICAgICAgIH07CgogICAgICAgICAgdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uKCRodHRwLCRzY29wZSx0aGVkYXRhLGV2ZW50X2lkLCBudWxsLCB1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25fZmFpbHVyZSk7CiAgICAgICAgfQogICAgICAgIGVsc2UgLy8gbm90IGZpeGVkIHNjaGVkdWxlIC0gZGFpbHkvd2Vla2x5IGxpbWl0YXRpb25zCiAgICAgICAgewogICAgICAgICAgICBpZiAoKHRoZWV2ZW50LmxpbWl0X2lkICE9IG51bGwpICYgKHRoZWV2ZW50LmRheV9saW1pdF9pZCA9PSAtMSkpIC8vIGV2ZW50IGxpbWl0YXRpb24gaGFzIGxpbWl0X2lkIHNvIGl0cyBhbiAxOTcwIGV2ZW50CiAgICAgICAgICAgIC8vIG5lZWQgdG8gYWRkIGEgbmV3IHBlcmRheSBsaW1pdGF0aW9uIHRoYXQgcG9pbnQgKGxpbWl0X2lkKSB0byB0aGUgb2xkIDE5NzAgZXZlbnQgdG8gY2FuY2VsIGl0CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHRlbXBfbGltaXRfaWQgPSBjYWxjX3RlbXBfbGltaXRfaWQoKTsKICAgICAgICAgICAgICAgIHRoZWV2ZW50LnRlbXBfbGltaXRfaWQgPSB0ZW1wX2xpbWl0X2lkOwogICAgICAgICAgICAgICAgdGhlZXZlbnQuZGF5X2xpbWl0X2lkID0gdGVtcF9saW1pdF9pZDsKICAgICAgICAgICAgICAgIC8vIHRoZSBtb3ZlZCBldmVudCBpbiB0aGUgY2FsZW5kYXIgbm93IGhhcyBkYXlfbGltaXRfaWQgYW5kIHRlbXBfbGltaXRfaWQKICAgICAgICAgICAgICAgIC8vIGlmIGl0cyBsb2FkZWQgZnJvbSB0aGUgZGIsIGl0IHdpbGwgb25seSBoYXZlIGRheV9saW1pdF9pZCAoYW5kIG5vdCB0aGUgdGVtcCBvbmUpCiAgICAgICAgICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1snY2FsZW5kYXJfaG91cnNfb2Zfd29yayddLmZ1bGxDYWxlbmRhcigndXBkYXRlRXZlbnQnLCB0aGVldmVudCk7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiWFhYWFhYWFhYWFhYWCIpOwogICAgICAgICAgICAgICAgdGhlZGF0YSA9IHsKICAgICAgICAgICAgICAgICAgICBzdGFydF9kYXRlOiBzdGFydF9wYXJhbSwKICAgICAgICAgICAgICAgICAgICBlbmRfZGF0ZTogZW5kX3BhcmFtLAogICAgICAgICAgICAgICAgICAgIGNvbG9yOiB0aGVldmVudC5jb2xvciwKICAgICAgICAgICAgICAgICAgICB0ZW1wX2xpbWl0X2lkOiB0ZW1wX2xpbWl0X2lkLAogICAgICAgICAgICAgICAgICAgIGV2ZW50X3R5cGVfaWQ6IHRoZWV2ZW50LmV2ZW50X3R5cGVfaWQsCiAgICAgICAgICAgICAgICAgICAgZXZlbnRfdHlwZXM6IHRoZWV2ZW50LmV2ZW50X3R5cGVzLAogICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uX2lkOiB0aGVldmVudC5sb2NhdGlvbl9pZCwKICAgICAgICAgICAgICAgICAgICBlbXBfaWQ6IHRoZWV2ZW50LmVtcF9pZCwKICAgICAgICAgICAgICAgICAgICBsaW1pdF9pZDogdGhlZXZlbnQuaWQsCiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHRoZWV2ZW50LnRpdGxlCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgY3JlYXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5KCRodHRwLCRzY29wZSx0aGVkYXRhLG51bGwsIHVwZGF0ZUNhbGVuZGFyTGltaXRhdGlvbl9mYWlsdXJlKTsKCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSAvLyBldmVudCBsaW1pdGF0aW9uIHRvIG1vdmUvdXBkYXRlIGhhcyBubyBsaW1pdF9pZCAtIHNvIHRoaXMgaXMgbmV3IHBlcmRheSBldmVudCAtIHdlIGp1c3QgdXBkYXRlIGl0CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICB0aGVkYXRhPSB7CiAgICAgICAgICAgICAgICAgIHN0YXJ0X2RhdGU6IHN0YXJ0X3BhcmFtLAogICAgICAgICAgICAgICAgICBlbmRfZGF0ZTogZW5kX3BhcmFtLAogICAgICAgICAgICAgICAgICB0ZW1wX2RheV9saW1pdF9pZDogdGhlZXZlbnQudGVtcF9saW1pdF9pZCwKICAgICAgICAgICAgICAgICAgbG9jYXRpb25faWQ6IHRoZWV2ZW50LmxvY2F0aW9uX2lkLAogICAgICAgICAgICAgICAgICBkYXlfbGltaXRfaWQ6IHRoZWV2ZW50LmRheV9saW1pdF9pZAogICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5KCRodHRwLCRzY29wZSx0aGVkYXRhLG51bGwsIHVwZGF0ZUNhbGVuZGFyTGltaXRhdGlvbl9mYWlsdXJlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07Cn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdFdmVudENsYXNzUGFnZUNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICR0aW1lb3V0LCAkaHR0cCwgJHJvb3RTY29wZSwgJHJvdXRlUGFyYW1zLCAkbG9jYXRpb24sICRyb3V0ZSwgc2hhcmVkRGF0YSwgJHVpYk1vZGFsKQp7CiAgZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkKTsKICBnZXRBbGxDbGllbnRzKCRodHRwLCRzY29wZSwnZXZlbnRUeXBlVXNlcnMnKTsKICBnZXRCdXNpbmVzc0xvY2F0aW9ucygkaHR0cCwkc2NvcGUsJ2J1c2luZXNzX2xvY2F0aW9ucycpOwogIGdldEFsbEluc3RydWN0b3JzKCRodHRwLCRzY29wZSwnaW5zdHJ1Y3RvcnMnKTsKCiAgJHNjb3BlLnVwZGF0ZUV2ZW50VGl0bGUgPSBmdW5jdGlvbihuZXdWYWx1ZSxjdXJyZW50RXZlbnQpCiAgewogICAgbmV3X3RpdGxlPW5ld1ZhbHVlOwogICAgc2V0RXZlbnRUaXRsZSgkaHR0cCwkc2NvcGUsY3VycmVudEV2ZW50LmV2ZW50X2lkLCBuZXdfdGl0bGUsIHVwZGF0ZUV2ZW50X2NhbGxiYWNrLCB1cGRhdGVFdmVudF9jYWxsYmFjayk7CgogICAgZnVuY3Rpb24gdXBkYXRlRXZlbnRfY2FsbGJhY2soKQogICAgewogICAgICBnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkKTsKICAgIH0KCiAgfTsKCiAgJHNjb3BlLnVwZGF0ZUV2ZW50TWF4UGFydGljaXBhbnRzID0gZnVuY3Rpb24obmV3VmFsdWUsY3VycmVudEV2ZW50KQogIHsKICAgIG5ld19tYXhfcGFydGljaXBhbnRzPW5ld1ZhbHVlOwogICAgaWYgKCBuZXdfbWF4X3BhcnRpY2lwYW50cyA8IGN1cnJlbnRFdmVudC5ub19vZl91c2VycyApewogICAgICBzZXRFdmVudE1heFBhcnRpY2lwYW50cygkaHR0cCwkc2NvcGUsY3VycmVudEV2ZW50LmV2ZW50X2lkLCBjdXJyZW50RXZlbnQubm9fb2ZfdXNlcnMsIGN1cnJlbnRFdmVudC5ub19vZl91c2VycywgdXBkYXRlRXZlbnRfY2FsbGJhY2ssIHVwZGF0ZUV2ZW50X2NhbGxiYWNrKTsKICAgIH0gZWxzZSB7CiAgICAgIHNldEV2ZW50TWF4UGFydGljaXBhbnRzKCRodHRwLCRzY29wZSxjdXJyZW50RXZlbnQuZXZlbnRfaWQsIG5ld19tYXhfcGFydGljaXBhbnRzLCBjdXJyZW50RXZlbnQubm9fb2ZfdXNlcnMsIHVwZGF0ZUV2ZW50X2NhbGxiYWNrLCB1cGRhdGVFdmVudF9jYWxsYmFjayk7CiAgICB9CgogICAgZnVuY3Rpb24gdXBkYXRlRXZlbnRfY2FsbGJhY2soKQogICAgewogICAgICBnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkKTsKICAgIH0KCiAgfTsKCiAgJHNjb3BlLnVwZGF0ZVVzZXJFdmVudFByaWNlID0gZnVuY3Rpb24obmV3dmFsdWUsIHRoZWV2ZW50LCBldXNlcikKICB7CiAgICBuZXdfcHJpY2U9bmV3dmFsdWU7CiAgICBzZXRDbGllbnRFdmVudFByaWNlKCRodHRwLCRzY29wZSxldXNlci5idXNpbmVzc191c2VyX2lkLHRoZWV2ZW50LmV2ZW50X2lkLCBuZXdfcHJpY2Usc2V0Q2xpZW50RXZlbnRQcmljZV9jYWxsYmFjaywgc2V0Q2xpZW50RXZlbnRQcmljZV9jYWxsYmFjayk7CiAgICBmdW5jdGlvbiBzZXRDbGllbnRFdmVudFByaWNlX2NhbGxiYWNrKCkKICAgIHsKICAgICAgZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCk7CiAgICB9CiAgfTsKCiAgJHNjb3BlLnVwZGF0ZUxvY2F0aW9uRXZlbnQgPSBmdW5jdGlvbigpCiAgewogICAgY29uc29sZS5sb2coImZ1bmN0aW9uOiB1cGRhdGVMb2NhdGlvbkV2ZW50Iik7CiAgICB1cGRhdGVFdmVudExvY2F0aW9uKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuZXZlbnRfaWQsJHNjb3BlLmN1cnJlbnRFdmVudC5sb2NhdGlvbl9pZCx1cGRhdGVFdmVudExvY2F0aW9uX2NhbGxiYWNrLCB1cGRhdGVFdmVudExvY2F0aW9uX2NhbGxiYWNrKTsKICAgICRzY29wZS51cGRhdGVMb2NhdGlvbkFsZXJ0TWVzc2FnZT0i157XoteT15vXnyDXodeY15jXldehLi4uIjsKICAgIGZ1bmN0aW9uIHVwZGF0ZUV2ZW50TG9jYXRpb25fY2FsbGJhY2soKQogICAgewogICAgICAkc2NvcGUudXBkYXRlTG9jYXRpb25BbGVydE1lc3NhZ2U9Itei15XXk9eb158g15HXlNem15zXl9eUISI7CiAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkKICAgICAgewogICAgICAgICRzY29wZS51cGRhdGVMb2NhdGlvbkFsZXJ0TWVzc2FnZT1udWxsOwogICAgICB9LCAxNTAwKTsKICAgIH0KICB9OwoKICAkc2NvcGUudXBkYXRlSW5zdHJ1Y3RvckNsYXNzRXZlbnQgPSBmdW5jdGlvbigpCiAgewogICAgY29uc29sZS5sb2coImZ1bmN0aW9uOiB1cGRhdGVJbnN0cnVjdG9yQ2xhc3NFdmVudCIpOwogICAgdXBkYXRlRXZlbnRJbnN0cnVjdG9yKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuZXZlbnRfaWQsJHNjb3BlLmN1cnJlbnRFdmVudC5pbnN0cnVjdG9yX2lkLHVwZGF0ZUV2ZW50SW5zdHJ1Y3Rvcl9jYWxsYmFjaywgdXBkYXRlRXZlbnRJbnN0cnVjdG9yX2NhbGxiYWNrKTsKICAgICRzY29wZS51cGRhdGVJbnN0cnVjdG9yQWxlcnRNZXNzYWdlPSLXntei15PXm9efINeh15jXmNeV16EuLi4iOwogICAgZnVuY3Rpb24gdXBkYXRlRXZlbnRJbnN0cnVjdG9yX2NhbGxiYWNrKCkKICAgIHsKICAgICAgJHNjb3BlLnVwZGF0ZUluc3RydWN0b3JBbGVydE1lc3NhZ2U9Itei15XXk9eb158g15HXlNem15zXl9eUISI7CiAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkKICAgICAgewogICAgICAgICRzY29wZS51cGRhdGVJbnN0cnVjdG9yQWxlcnRNZXNzYWdlPW51bGw7CiAgICAgIH0sIDE1MDApOwogICAgfQogIH0KCgogICRzY29wZS5hY3RpdmF0ZUV2ZW50Q2xhc3MgPSBmdW5jdGlvbigpCiAgewogICAgewogICAgICBsb2dEZWJ1ZygicmVvcGVuRXZlbnQiKTsKICAgICAgcmVvcGVuRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQsJHNjb3BlLnNlbGVjdGVkRXZlbnQsYWZ0ZXJSZW9wZW5FdmVudCxhZnRlclJlb3BlbkV2ZW50KTsKICAgICAgZnVuY3Rpb24gYWZ0ZXJSZW9wZW5FdmVudCgpCiAgICAgIHsKICAgICAgICBnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkKTsKICAgICAgfTsKICAgIH0KICB9CgogIC8vIGNsb3NlIGV2ZW50IGNsYXNzCiAgJHNjb3BlLmNsb3NlRXZlbnRDbGFzcyA9IGZ1bmN0aW9uKCkgewogICAgICBsb2dEZWJ1ZygiZXZlbnQgY3JlYXRlIG1vZGFsIik7CgogICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAgICAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9ldmVudF9jbGFzc19jbG9zZS5waHAnLAogICAgICAgICAgc2l6ZTogJ3hzJywKICAgICAgICAgIGNvbnRyb2xsZXI6ICdjbGFzc0Nsb3NlTW9kYWxDb250cm9sbGVyJywKICAgICAgICAgIHJlc29sdmU6IHsKICAgICAgICAgICAgICBldmVudF9pZDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkOwogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgfSk7CiAgfTsKCiAgLy8gZGVsZXRlIHJlcGVhdGluZy9jbGFzcyBldmVudAogICRzY29wZS5kZWxldGVDbGFzc0V2ZW50ID0gZnVuY3Rpb24oKQogIHsKICAgIGlmICgkc2NvcGUuY3VycmVudEV2ZW50LmlzX3JlcGVhdGluZz09MCkKICAgIHsKICAgICAgbG9nRGVidWcoImNsYXNzIGV2ZW50IG5vdCByZXBlYXRpbmciKTsKICAgICAgJHNjb3BlLmRlbGV0ZUNsYXNzRXZlbnRTaW5nbGUoKTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgbG9nRGVidWcoImNsYXNzIGV2ZW50IGlzIHJlcGVhdGluZyIpOwogICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAgICAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9yZXBlYXRpbmdfZXZlbnRfZGVsZXRlX2FsbC5waHAnLAogICAgICAgICAgc2l6ZTogJ3hzJywKICAgICAgICAgIGNvbnRyb2xsZXI6ICdjbGFzc0RlbGV0ZUFsbE1vZGFsQ29udHJvbGxlcicsCiAgICAgICAgICByZXNvbHZlOiB7CiAgICAgICAgICAgICAgY3VycmVudEV2ZW50OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuICRzY29wZS5jdXJyZW50RXZlbnQ7CiAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICB9KTsKICAgIH0KICB9OwoKICAkc2NvcGUuZGVsZXRlQ2xhc3NFdmVudFNpbmdsZT1mdW5jdGlvbiAoKSAvLyBkZWxldGUgb25seSBvbmUvY3VycmVudCBjbGFzcyBldmVodAogIHsKICAgIGNhbmNlbENsYXNzRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQsY2FuY2VsQ2xhc3NFdmVudF9jYWxsYmFjaywgY2FuY2VsQ2xhc3NFdmVudF9jYWxsYmFjayk7CiAgICBmdW5jdGlvbiBjYW5jZWxDbGFzc0V2ZW50X2NhbGxiYWNrKCkKICAgIHsKICAgICAgZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCk7CiAgICB9CiAgfQoKICAkc2NvcGUuJG9uKCJyZWxvYWRFdmVudCIsZnVuY3Rpb24oZSxhKXsKICAgICAgIC8vIFBvc3QgeW91ciBjb2RlCiAgIGxvZ0RlYnVnKCJicm9hZGNhc3RlZCAtIHJlbG9hZGluZyBldmVudCAiK2EuZXZlbnRfaWQpOwogICBnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkcm91dGVQYXJhbXMuZXZlbnRfaWQpOwp9KTsKCiAgLy8gcmVtb3ZlIGVuZCB1c2VyIGZyb20gZXZlbnQKICAkc2NvcGUuZXZlbnRSZW1vdmVFbmRVc2VyID0gZnVuY3Rpb24oZW5kdXNlcl9pZCkKICB7CiAgICBjb25zb2xlLmxvZygiZXZlbnRSZW1vdmVFbmRVc2VyIik7CiAgICByZW1vdmVFbmRVc2VyRnJvbUV2ZW50KCRodHRwLCRzY29wZSxlbmR1c2VyX2lkLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQscmVtb3ZlRW5kVXNlckZyb21FdmVudF9maW5pc2gsIHJlbW92ZUVuZFVzZXJGcm9tRXZlbnRfZmluaXNoKTsKICAgIGZ1bmN0aW9uIHJlbW92ZUVuZFVzZXJGcm9tRXZlbnRfZmluaXNoKCkKICAgIHsKICAgICAgZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkKTsKICAgIH0KICB9OwoKICAkc2NvcGUuZXZlbnRDbGllbnRTZWxlY3RlZCA9IGZ1bmN0aW9uKHNlbGVjdGVkKSB7CiAgICAgIGlmIChzZWxlY3RlZCkgewogICAgICAgICAgLy8gYWxlcnQoSlNPTi5zdHJpbmdpZnkoIHNlbGVjdGVkLCBudWxsLCAyICkpOwogICAgICAgICAgbG9nRGVidWcoJ2V2ZW50Q2xpZW50U2VsZWN0ZWQyIHllcyBzZWxlY3RlZCAnICsgc2VsZWN0ZWQub3JpZ2luYWxPYmplY3QuZmlyc3RfbmFtZSk7CiAgICAgICAgICAkc2NvcGUuZXZlbnRBZGRFbmRVc2VyKHNlbGVjdGVkLm9yaWdpbmFsT2JqZWN0LmJ1c2luZXNzX3VzZXJfaWQpOwogICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdhbmd1Y29tcGxldGUtYWx0OmNsZWFySW5wdXQnLCAnY2xpZW50X2FuZ3Vjb21wbGV0ZScpOwoKICAgICAgfSBlbHNlIHsKICAgICAgICAgIGxvZ0RlYnVnKCdub3Qgc2VsZWN0ZWQnKTsKICAgICAgfQogIH07CgogICRzY29wZS5ldmVudEFkZEVuZFVzZXIgPSBmdW5jdGlvbihlbmR1c2VyX2lkKQogIHsKICAgIGFkZEVuZFVzZXJUb0V2ZW50KCRodHRwLCRzY29wZSxlbmR1c2VyX2lkLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQsYWRkRW5kVXNlclRvRXZlbnRfZmluaXNoLCBhZGRFbmRVc2VyVG9FdmVudF9maW5pc2gpOwogICAgZnVuY3Rpb24gYWRkRW5kVXNlclRvRXZlbnRfZmluaXNoKCkKICAgIHsKICAgICAgZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkKTsKICAgIH0KICB9Owp9KTsKCmt1emVBcHAuY29udHJvbGxlcignRXZlbnRQYWdlQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHRpbWVvdXQsICRodHRwLCAkdWliTW9kYWwgLHNoYXJlZFByb3BlcnRpZXMsICRyb3V0ZVBhcmFtcywgJHJvb3RTY29wZSwgJGxvY2F0aW9uLCAkcm91dGUsIHNoYXJlZERhdGEpCnsKICBsb2dEZWJ1ZygiRXZlbnRQYWdlQ29udHJvbGxlciIpOwoKICBnZXRBbGxJbnN0cnVjdG9yc0luY0luYWN0aXZlKCRodHRwLCRzY29wZSwnaW5zdHJ1Y3RvcnMnLGdldEFsbEluc3RydWN0b3JzSW5jSW5hY3RpdmVfc3VjY2Vzcyk7CiAgZ2V0QnVzaW5lc3NMb2NhdGlvbnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19sb2NhdGlvbnMnKTsKCiAgZnVuY3Rpb24gZ2V0QWxsSW5zdHJ1Y3RvcnNJbmNJbmFjdGl2ZV9zdWNjZXNzKCkKICB7CiAgICBnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkcm91dGVQYXJhbXMuZXZlbnRfaWQsc2V0UGFydGljaXBhdGVkKTsKICB9CgogICRzY29wZS5leHRyYUZpZWxkc0FsZXJ0TWVzc2FnZT1udWxsOwoKICAkc2NvcGUudXBkYXRlRXZlbnRUaXRsZSA9IGZ1bmN0aW9uKG5ld1ZhbHVlLGN1cnJlbnRFdmVudCkKICB7CiAgICBuZXdfdGl0bGU9bmV3VmFsdWU7CiAgICBzZXRFdmVudFRpdGxlKCRodHRwLCRzY29wZSxjdXJyZW50RXZlbnQuZXZlbnRfaWQsIG5ld190aXRsZSwgdXBkYXRlRXZlbnRfY2FsbGJhY2ssIHVwZGF0ZUV2ZW50X2NhbGxiYWNrKTsKCiAgICBmdW5jdGlvbiB1cGRhdGVFdmVudF9jYWxsYmFjaygpCiAgICB7CiAgICAgIGdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQpOwogICAgfQoKICB9OwoKCiAgJHNjb3BlLnVwZGF0ZUV2ZW50RXh0cmFGaWVsZHMgPSBmdW5jdGlvbigpCiAgewogICAgbG9nRGVidWcoInVwZGF0ZUV2ZW50RXh0cmFGaWVsZHMiKTsKICAgIHRoZWRhdGEgPSB7CiAgICAgICBleHRyYUZpZWxkczokc2NvcGUuY3VycmVudEV2ZW50LmV4dHJhRmllbGRzCiAgICAgIH07CiAgICAkc2NvcGUuZXh0cmFGaWVsZHNBbGVydE1lc3NhZ2U9Itee16LXk9eb158g16DXqteV16DXmdedLCDXkNeg15Ag15TXnteq158uLi4iOwogICAgdXBkYXRlRXZlbnRFeHRyYUZpZWxkcygkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLHRoZWRhdGEsdXBkYXRlRXZlbnRFeHRyYUZpZWxkc19jYWxsYmFjaywgdXBkYXRlRXZlbnRFeHRyYUZpZWxkc19jYWxsYmFjayk7CgogICAgZnVuY3Rpb24gdXBkYXRlRXZlbnRFeHRyYUZpZWxkc19jYWxsYmFjaygpCiAgICB7CiAgICAgIGdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCxzZXRQYXJ0aWNpcGF0ZWQpOwogICAgICAkc2NvcGUuZXh0cmFGaWVsZHNBbGVydE1lc3NhZ2U9Iteq15nXoteV15Mg16DXqdee16gg15HXlNem15zXl9eUISI7CiAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkKICAgICAgewogICAgICAgICRzY29wZS5leHRyYUZpZWxkc0FsZXJ0TWVzc2FnZT1udWxsOwogICAgICB9LCAzMDAwKTsKICAgIH0KICB9OwoKICAkc2NvcGUucmVzY2hlZHVsZUV2ZW50ID0gZnVuY3Rpb24oKQogIHsKICAgIGxvZ0RlYnVnKCJzZWV0aW5nIGV2ZW50IHRvIG1vdmUgICIrJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdKTsKICAgIHNoYXJlZFByb3BlcnRpZXMuc2V0X2V2ZW50X3Jlc2NoZWR1bGUoJHNjb3BlLmN1cnJlbnRFdmVudCk7CiAgICAvLyB1c2VyX2luZm89IHsKICAgIC8vICAgICB1c2VyX2lkOiAkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50VXNlcnNbMF0udXNlcl9pZCwKICAgIC8vICAgICBidXNlcl9maXJzdF9uYW1lOiAkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfZmlyc3RfbmFtZSwKICAgIC8vICAgICBidXNlcl9sYXN0X25hbWU6ICRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRVc2Vyc1swXS5idXNlcl9sYXN0X25hbWUKICAgIC8vIH07CiAgICAvLyBzaGFyZWRQcm9wZXJ0aWVzLnNldF9zZWxlY3RlZF91c2VyKHVzZXJfaW5mbyk7CiAgICAkbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2NhbGVuZGFyJyk7CiAgfQoKICAkc2NvcGUudXBkYXRlTG9jYXRpb25FdmVudCA9IGZ1bmN0aW9uKCkKICB7CiAgICBjb25zb2xlLmxvZygiZnVuY3Rpb246IHVwZGF0ZUxvY2F0aW9uRXZlbnQiKTsKICAgIHVwZGF0ZUV2ZW50TG9jYXRpb24oJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCwkc2NvcGUuY3VycmVudEV2ZW50LmxvY2F0aW9uX2lkLHVwZGF0ZUV2ZW50TG9jYXRpb25fY2FsbGJhY2ssIHVwZGF0ZUV2ZW50TG9jYXRpb25fY2FsbGJhY2spOwogICAgJHNjb3BlLnVwZGF0ZUxvY2F0aW9uQWxlcnRNZXNzYWdlPSLXntei15PXm9efINeh15jXmNeV16EuLi4iOwogICAgZnVuY3Rpb24gdXBkYXRlRXZlbnRMb2NhdGlvbl9jYWxsYmFjaygpCiAgICB7CiAgICAgICRzY29wZS51cGRhdGVMb2NhdGlvbkFsZXJ0TWVzc2FnZT0i16LXldeT15vXnyDXkdeU16bXnNeX15QhIjsKICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKQogICAgICB7CiAgICAgICAgJHNjb3BlLnVwZGF0ZUxvY2F0aW9uQWxlcnRNZXNzYWdlPW51bGw7CiAgICAgIH0sIDE1MDApOwogICAgfQogIH07CgogICRzY29wZS51cGRhdGVJbnN0cnVjdG9yRXZlbnQgPSBmdW5jdGlvbigpCiAgewogICAgY29uc29sZS5sb2coImZ1bmN0aW9uOiB1cGRhdGVJbnN0cnVjdG9yRXZlbnQiKTsKICAgIHVwZGF0ZUV2ZW50SW5zdHJ1Y3RvcigkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLCRzY29wZS5jdXJyZW50RXZlbnQuaW5zdHJ1Y3Rvcl9pZCx1cGRhdGVFdmVudEluc3RydWN0b3JfY2FsbGJhY2ssIHVwZGF0ZUV2ZW50SW5zdHJ1Y3Rvcl9jYWxsYmFjayk7CiAgICAkc2NvcGUudXBkYXRlSW5zdHJ1Y3RvckFsZXJ0TWVzc2FnZT0i157XoteT15vXnyDXodeY15jXldehLi4uIjsKICAgIGZ1bmN0aW9uIHVwZGF0ZUV2ZW50SW5zdHJ1Y3Rvcl9jYWxsYmFjaygpCiAgICB7CiAgICAgICRzY29wZS51cGRhdGVJbnN0cnVjdG9yQWxlcnRNZXNzYWdlPSLXoteV15PXm9efINeR15TXptec15fXlCEiOwogICAgICAkdGltZW91dChmdW5jdGlvbigpCiAgICAgIHsKICAgICAgICAkc2NvcGUudXBkYXRlSW5zdHJ1Y3RvckFsZXJ0TWVzc2FnZT1udWxsOwogICAgICB9LCAxNTAwKTsKICAgIH0KICB9OwoKICAkc2NvcGUuaW5pdGlhdGVQYXltZW50ID0gZnVuY3Rpb24oaXNwbHVzKQogIHsKICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewogICAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfY2xpZW50X3BheW1lbnQucGhwJywKICAgICAgICBjb250cm9sbGVyOiAnYnVzaW5lc3NDbGllbmRDYXJkUGF5bWVudCcsCiAgICAgICAgLy8gc2l6ZTogc2l6ZSwKICAgICAgICByZXNvbHZlOiB7CiAgICAgICAgICBjdXJyZW50Q2xpZW50OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICByZXR1cm4gJHNjb3BlLmN1cnJlbnRFdmVudENsaWVudHNbMF07CiAgICAgICAgICB9LAogICAgICAgICAgaXNwbHVzOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICByZXR1cm4gaXNwbHVzOwogICAgICAgICAgfQogICAgICAgIH0KICAgIH0pOwogIH0KCiAgJHNjb3BlLmRlbGV0ZUV2ZW50PWZ1bmN0aW9uICgpCiAgewogICAgLy8gY2hlY2tpbmcgaWYgY2FuY2VsaW5nIGEgZ2VuZXJjX3R5cGUgZXZlbnQgLSB0aGVuIHRoZXJlJ3Mgbm8gdXNlcgogICAgaWYgKCRzY29wZS5jdXJyZW50RXZlbnQuaXNfZ2VuZXJpY19ldHlwZT09MSkKICAgIHsKICAgICAgY2FuY2VsU2luZ2xlRXZlbnQoJGh0dHAsJHNjb3BlLDAsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLGNhbmNlbFNpbmdsZUV2ZW50X2NhbGxiYWNrLCBjYW5jZWxTaW5nbGVFdmVudF9jYWxsYmFjayk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgIGNhbmNlbFNpbmdsZUV2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50VXNlcnNbMF0uYnVzaW5lc3NfdXNlcl9pZCwkcm91dGVQYXJhbXMuZXZlbnRfaWQsY2FuY2VsU2luZ2xlRXZlbnRfY2FsbGJhY2ssIGNhbmNlbFNpbmdsZUV2ZW50X2NhbGxiYWNrKTsKICAgIH0KICAgIGZ1bmN0aW9uIGNhbmNlbFNpbmdsZUV2ZW50X2NhbGxiYWNrKCkKICAgIHsKICAgICAgZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLHNldFBhcnRpY2lwYXRlZCk7CiAgICB9CiAgfQoKICAkc2NvcGUuc2V0UGFydGljaXBhdGlvblN0YXR1cyA9IGZ1bmN0aW9uKCkKICB7CiAgICBzZXRFdmVudFVzZXJQYXJ0aWNpcGF0aW9uU3RhdHVzKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuZXZlbnRfaWQsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudFVzZXJzWzBdLmJ1c2luZXNzX3VzZXJfaWQsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudFVzZXJzWzBdLmV2ZW50X3VzZXJfc3RhdHVzX2lkLHNldFBhcnRpY2lwYXRpb25TdGF0dXNfY2FsbGJhY2ssIHNldFBhcnRpY2lwYXRpb25TdGF0dXNfY2FsbGJhY2spOwogICAgJHNjb3BlLnVwZGF0ZVN0YXR1c0FsZXJ0TWVzc2FnZT0i157XoteT15vXnyDXodeY15jXldehLi4uIjsKICAgIGZ1bmN0aW9uIHNldFBhcnRpY2lwYXRpb25TdGF0dXNfY2FsbGJhY2soKQogICAgewogICAgICAvLyBnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkcm91dGVQYXJhbXMuZXZlbnRfaWQsc2V0UGFydGljaXBhdGVkKTsKICAgICAgc2V0UGFydGljaXBhdGVkKCk7CiAgICAgICRzY29wZS51cGRhdGVTdGF0dXNBbGVydE1lc3NhZ2U9Itei15XXk9eb158g15HXlNem15zXl9eUISI7CiAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkKICAgICAgewogICAgICAgICRzY29wZS51cGRhdGVTdGF0dXNBbGVydE1lc3NhZ2U9bnVsbDsKICAgICAgfSwgMjUwMCk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBzZXRQYXJ0aWNpcGF0ZWQoKQogIHsKICAgIGxvZ0RlYnVnKCJnZXQgY2xpZW50IGluZm8iKTsKICAgIGdldEJ1c2luZXNzQ2xpZW50SW5mbygkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudENsaWVudHMnLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRVc2Vyc1swXS5idXNpbmVzc191c2VyX2lkKTsKICAgIGxvZ0RlYnVnKCJzZXR0aW5nIHNldFBhcnRpY2lwYXRlZCIpOwogICAgaWYgKCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRVc2Vyc1swXS5zdGF0dXNfbmFtZSE9JGdVc2VyX3N0YXR1c19hYnNlbnRlZCkKICAgIHsKICAgICAgJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudFVzZXJzWzBdLnBhcnRpY2lwYXRlZD10cnVlOwogICAgfQogICAgZWxzZQogICAgewogICAgICAkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50VXNlcnNbMF0ucGFydGljaXBhdGVkPWZhbHNlOwogICAgfQoKICAgIC8vIHRoaXMgbG9vcCBpcyBmb3IgZml4aW5nIHRoZSBkYXRlIGZvcm1hdCB0byBhcHBlYXIgcHJvcGVybHkgaW4gdGhlIGlucHV0IGRhdGUgaHRtbCBvYmplY3QKICAgIGZvciAoaSA9IDA7IGk8ICgkc2NvcGUuY3VycmVudEV2ZW50LmV4dHJhRmllbGRzKS5sZW5ndGg7IGkrKykKICAgIHsKICAgICAgbG9nRGVidWcoJHNjb3BlLmN1cnJlbnRFdmVudC5leHRyYUZpZWxkc1tpXSk7CiAgICAgIGlmICgkc2NvcGUuY3VycmVudEV2ZW50LmV4dHJhRmllbGRzW2ldLmZpZWxkX2RhdGF0eXBlPT0iREFURSIpCiAgICAgIHsKICAgICAgICAvLyBsb2dEZWJ1ZygiZGF0ZSIpOwogICAgICAgICRzY29wZS5jdXJyZW50RXZlbnQuZXh0cmFGaWVsZHNbaV0uZmllbGRfdmFsdWU9bmV3IERhdGUoJHNjb3BlLmN1cnJlbnRFdmVudC5leHRyYUZpZWxkc1tpXS5maWVsZF92YWx1ZSk7CiAgICAgIH0KICAgIH0KCiAgICBsb2dEZWJ1ZygiJHNjb3BlLmN1cnJlbnRFdmVudC5pbnN0cnVjdG9yX2lkOz0iKyRzY29wZS5jdXJyZW50RXZlbnQuaW5zdHJ1Y3Rvcl9pZCk7CiAgICBmb3IodmFyIGkgPSAwOyBpIDwgJHNjb3BlLmluc3RydWN0b3JzLmxlbmd0aDsgaSsrKQogICAgewogICAgICBsb2dEZWJ1Zygkc2NvcGUuaW5zdHJ1Y3RvcnNbaV0uaXNfYWN0aXZlKTsKICAgICAgaWYgKCRzY29wZS5pbnN0cnVjdG9yc1tpXS5idXNpbmVzc191c2VyX2lkPT0kc2NvcGUuY3VycmVudEV2ZW50Lmluc3RydWN0b3JfaWQpCiAgICAgIHsKICAgICAgICBsb2dEZWJ1ZygieWVzaCIpOwogICAgICAgICRzY29wZS5pbnN0cnVjdG9yc1tpXS5pc19hY3RpdmU9MTsKICAgICAgfQogICAgfQogIH0KCiAgJHNjb3BlLnVwZGF0ZVVzZXJFdmVudFByaWNlID0gZnVuY3Rpb24obmV3dmFsdWUsIHRoZWV2ZW50KQogIHsKICAgIG5ld19wcmljZT1uZXd2YWx1ZTsKICAgIHNldENsaWVudEV2ZW50UHJpY2UoJGh0dHAsJHNjb3BlLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRVc2Vyc1swXS5idXNpbmVzc191c2VyX2lkLHRoZWV2ZW50LmV2ZW50X2lkLCBuZXdfcHJpY2Usc2V0Q2xpZW50RXZlbnRQcmljZV9jYWxsYmFjaywgc2V0Q2xpZW50RXZlbnRQcmljZV9jYWxsYmFjayk7CiAgICBmdW5jdGlvbiBzZXRDbGllbnRFdmVudFByaWNlX2NhbGxiYWNrKCkKICAgIHsKICAgICAgZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLHNldFBhcnRpY2lwYXRlZCk7CiAgICB9CiAgfTsKCiAgJHNjb3BlLiRvbigiZXZlbnRQYWdlUmVsb2FkRGF0YSIsZnVuY3Rpb24oZSxhKQogIHsKICAgIGdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCxzZXRQYXJ0aWNpcGF0ZWQpOwogIH0pOwoKICAkc2NvcGUuY2xvc2VFdmVudCA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1ZygiY2hlY2tpbmcgaWYgZXZlbnQgaGFzIGV4dHJhIGZpZWxkcyB0aGF0IGFyZSByZXF1aXJlZCBiZWZvcmUgY2xvc2luZyBpdCIpOwogICAgY2hlY2tFdmVudEV4dHJhRmllbGRzKCRodHRwLCRzY29wZSwnY2hlY2tFdmVudEV4dHJhRmllbGRzJywkcm91dGVQYXJhbXMuZXZlbnRfaWQsY2hlY2tFdmVudEV4dHJhRmllbGRzX3N1Y2Nlc3MpOwogICAgZnVuY3Rpb24gY2hlY2tFdmVudEV4dHJhRmllbGRzX3N1Y2Nlc3MoKQogICAgewogICAgICBpZiAoJHNjb3BlLmNoZWNrRXZlbnRFeHRyYUZpZWxkcz09dHJ1ZSkKICAgICAgewogICAgICAgIGxvZ0RlYnVnKCJldmVudCBoYXMgYWxsIGV4dHJhIGZpZWxkcyBvaywgY2xvc2luZyBldmVudCIpOwogICAgICAgIC8vICRzY29wZS5jdXJyZW50RXZlbnQuaWdub3JlRXh0cmFGaWVsZHNWYWxpZGF0aW9uPXRydWU7CiAgICAgICAgY2xvc2VFdmVudCgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLCRzY29wZS5jdXJyZW50RXZlbnQsYWZ0ZXJDbG9zZUV2ZW50LGFmdGVyQ2xvc2VFdmVudCk7CiAgICAgICAgZnVuY3Rpb24gYWZ0ZXJDbG9zZUV2ZW50KCkKICAgICAgICB7CiAgICAgICAgICBnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkcm91dGVQYXJhbXMuZXZlbnRfaWQsc2V0UGFydGljaXBhdGVkKTsKICAgICAgICB9OwogICAgICB9CiAgICAgIGVsc2UKICAgICAgewogICAgICAgIGxvZ0RlYnVnKCJldmVudCBoYXMgZXh0cmEgZmllbGRzIHJlcXVpcmVkIHRoYXQgYXJlIG5vdCBmaWxsZWQiKTsKICAgICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAgICAgICAgICAgYW5pbWF0aW9uOiBmYWxzZSwKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfZXZlbnRfY2xvc2VfaWdub3JlX21hbmRhdG9yeV9maWVsZHMucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ2V2ZW50Q2xvc2VJZ25vcmVNYW5kYXRvcnlGaWVsZHNNb2RhbENvbnRyb2xsZXInLAogICAgICAgICAgICBzaXplOiAnbScsCiAgICAgICAgICAgIHJlc29sdmU6IHsKICAgICAgICAgICAgICAgIGN1cnJlbnRFdmVudDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRzY29wZS5jdXJyZW50RXZlbnQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfQogIH0KICAkc2NvcGUucmVvcGVuRXZlbnQgPSBmdW5jdGlvbigpCiAgewogICAgbG9nRGVidWcoInJlb3BlbkV2ZW50Iik7CiAgICByZW9wZW5FdmVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCwkc2NvcGUuY3VycmVudEV2ZW50LGFmdGVyUmVvcGVuRXZlbnQsYWZ0ZXJSZW9wZW5FdmVudCk7CiAgICBmdW5jdGlvbiBhZnRlclJlb3BlbkV2ZW50KCkKICAgIHsKICAgICAgZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCxzZXRQYXJ0aWNpcGF0ZWQpOwogICAgfTsKICB9Cgp9KTsKCmt1emVBcHAuZmlsdGVyKCdzdGFydEZyb20nLCBmdW5jdGlvbigpCnsKICAgIHJldHVybiBmdW5jdGlvbihpbnB1dCwgc3RhcnQpCiAgICB7CiAgICAgICBpZighaW5wdXQpIHJldHVybiBbXTsKICAgICAgICAvLyBjb25zb2xlLmxvZygiaGVyZXJlZWUgIitpbnB1dCk7CiAgICAgICAgc3RhcnQgPSArc3RhcnQ7IC8vcGFyc2UgdG8gaW50CiAgICAgICAgcmV0dXJuIGlucHV0LnNsaWNlKHN0YXJ0KTsKICAgIH0KfSk7Ci8vIGFuZ3VsYXIgZmlsdGVyIGZvciBldmVudHMgYmVmb3JlL2FmdGVyIHRvZGF5Cmt1emVBcHAuZmlsdGVyKCdiZWZvcmVOb3cnLCBmdW5jdGlvbigpIHsKICAvLyBDcmVhdGUgdGhlIHJldHVybiBmdW5jdGlvbiBhbmQgc2V0IHRoZSByZXF1aXJlZCBwYXJhbWV0ZXIgbmFtZSB0byAqKmlucHV0KioKIHJldHVybiBmdW5jdGlvbihpbnB1dCkgewogICB2YXIgb3V0ID0gW107CgogICAvLyBVc2luZyB0aGUgYW5ndWxhci5mb3JFYWNoIG1ldGhvZCwgZ28gdGhyb3VnaCB0aGUgYXJyYXkgb2YgZGF0YSBhbmQgcGVyZm9ybSB0aGUgb3BlcmF0aW9uIG9mIGZpZ3VyaW5nIG91dCBpZiB0aGUgbGFuZ3VhZ2UgaXMgc3RhdGljYWxseSBvciBkeW5hbWljYWxseSB0eXBlZC4KICAgdmFyIGJyb3dzZXJfZXBvY2ggPSAobmV3IERhdGUpLmdldFRpbWUoKTsKCiAgIGFuZ3VsYXIuZm9yRWFjaChpbnB1dCwgZnVuY3Rpb24oZXZlbnQpCiAgIHsKICAgIC8vICBsb2dEZWJ1ZygiZmlsdGVyaW5nLCBldmVudC5ldmVudF91c2VyX3N0YXR1c19pZD0iK2V2ZW50LmV2ZW50X3VzZXJfc3RhdHVzX2lkKTsKICAgICBpZiAoZXZlbnQuc3RhcnRfZXBvY2ggPD0gKGJyb3dzZXJfZXBvY2gvMTAwMCkpCiAgICAgewogICAgICAgb3V0LnB1c2goZXZlbnQpCiAgICAgfQogICB9KQogICByZXR1cm4gb3V0OwogfQp9KTsKa3V6ZUFwcC5maWx0ZXIoJ2FmdGVyTm93JywgZnVuY3Rpb24oKSB7CiAgLy8gQ3JlYXRlIHRoZSByZXR1cm4gZnVuY3Rpb24gYW5kIHNldCB0aGUgcmVxdWlyZWQgcGFyYW1ldGVyIG5hbWUgdG8gKippbnB1dCoqCiByZXR1cm4gZnVuY3Rpb24oaW5wdXQpIHsKICAgdmFyIG91dCA9IFtdOwoKICAgLy8gVXNpbmcgdGhlIGFuZ3VsYXIuZm9yRWFjaCBtZXRob2QsIGdvIHRocm91Z2ggdGhlIGFycmF5IG9mIGRhdGEgYW5kIHBlcmZvcm0gdGhlIG9wZXJhdGlvbiBvZiBmaWd1cmluZyBvdXQgaWYgdGhlIGxhbmd1YWdlIGlzIHN0YXRpY2FsbHkgb3IgZHluYW1pY2FsbHkgdHlwZWQuCiAgIHZhciBicm93c2VyX2Vwb2NoID0gKG5ldyBEYXRlKS5nZXRUaW1lKCk7CgogICBhbmd1bGFyLmZvckVhY2goaW5wdXQsIGZ1bmN0aW9uKGV2ZW50KQogICB7CiAgICAvLyAgbG9nRGVidWcoImZpbHRlcmluZywgZXZlbnQuZXZlbnRfdXNlcl9zdGF0dXNfaWQ9IitldmVudC5ldmVudF91c2VyX3N0YXR1c19pZCk7CiAgICAgaWYgKGV2ZW50LnN0YXJ0X2Vwb2NoID4gKGJyb3dzZXJfZXBvY2gvMTAwMCkpCiAgICAgewogICAgICAgb3V0LnB1c2goZXZlbnQpCiAgICAgfQogICB9KQogICByZXR1cm4gb3V0OwogfQp9KTsKCmt1emVBcHAuZmlsdGVyKCdpc0FjdGl2ZScsIGZ1bmN0aW9uKCkgewogIC8vIENyZWF0ZSB0aGUgcmV0dXJuIGZ1bmN0aW9uIGFuZCBzZXQgdGhlIHJlcXVpcmVkIHBhcmFtZXRlciBuYW1lIHRvICoqaW5wdXQqKgogcmV0dXJuIGZ1bmN0aW9uKGlucHV0KSB7CiAgIHZhciBvdXQgPSBbXTsKCiAgIC8vIFVzaW5nIHRoZSBhbmd1bGFyLmZvckVhY2ggbWV0aG9kLCBnbyB0aHJvdWdoIHRoZSBhcnJheSBvZiBkYXRhIGFuZCBwZXJmb3JtIHRoZSBvcGVyYXRpb24gb2YgZmlndXJpbmcgb3V0IGlmIHRoZSBsYW5ndWFnZSBpcyBzdGF0aWNhbGx5IG9yIGR5bmFtaWNhbGx5IHR5cGVkLgoKICAgYW5ndWxhci5mb3JFYWNoKGlucHV0LCBmdW5jdGlvbihldmVudCkKICAgewogICAgLy8gIGxvZ0RlYnVnKCJmaWx0ZXJpbmcsIGV2ZW50LmV2ZW50X3VzZXJfc3RhdHVzX2lkPSIrZXZlbnQuZXZlbnRfdXNlcl9zdGF0dXNfaWQpOwogICAgIGlmIChldmVudC5pc19hY3RpdmU9PTEpCiAgICAgewogICAgICAgb3V0LnB1c2goZXZlbnQpCiAgICAgfQogICB9KQogICByZXR1cm4gb3V0OwogfQp9KTsKCmt1emVBcHAuZmlsdGVyKCdzaG91bGRfYmVfZGlzcGxheWVkJywgZnVuY3Rpb24oKSB7CiAgLy8gQ3JlYXRlIHRoZSByZXR1cm4gZnVuY3Rpb24gYW5kIHNldCB0aGUgcmVxdWlyZWQgcGFyYW1ldGVyIG5hbWUgdG8gKippbnB1dCoqCiByZXR1cm4gZnVuY3Rpb24oaW5wdXQpIHsKICAgdmFyIG91dCA9IFtdOwoKICAgLy8gVXNpbmcgdGhlIGFuZ3VsYXIuZm9yRWFjaCBtZXRob2QsIGdvIHRocm91Z2ggdGhlIGFycmF5IG9mIGRhdGEgYW5kIHBlcmZvcm0gdGhlIG9wZXJhdGlvbiBvZiBmaWd1cmluZyBvdXQgaWYgdGhlIGxhbmd1YWdlIGlzIHN0YXRpY2FsbHkgb3IgZHluYW1pY2FsbHkgdHlwZWQuCgogICBhbmd1bGFyLmZvckVhY2goaW5wdXQsIGZ1bmN0aW9uKGV2ZW50KQogICB7CiAgICAvLyAgbG9nRGVidWcoImZpbHRlcmluZywgZXZlbnQuZXZlbnRfdXNlcl9zdGF0dXNfaWQ9IitldmVudC5ldmVudF91c2VyX3N0YXR1c19pZCk7CiAgICAgaWYgKGV2ZW50LnNob3VsZF9iZV9kaXNwbGF5ZWQ9PTEpCiAgICAgewogICAgICAgb3V0LnB1c2goZXZlbnQpCiAgICAgfQogICB9KQogICByZXR1cm4gb3V0OwogfQp9KTsKCmt1emVBcHAuY29udHJvbGxlcignSW5zdHJ1Y3RvclNob3cxQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHRpbWVvdXQsICRodHRwLCBzaGFyZWRQcm9wZXJ0aWVzLCAkcm9vdFNjb3BlLCAkcm91dGVQYXJhbXMsICRsb2NhdGlvbiwgJHJvdXRlLCBzaGFyZWREYXRhLCAkdWliTW9kYWwpCnsKICBnZXRCdXNpbmVzc0NsaWVudEluZm8oJGh0dHAsJHNjb3BlLCdmb3JtVXBkYXRlQ2xpZW50QW5ndWxhcicsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsZ2V0QnVzaW5lc3NDbGllbnRJbmZvX3N1Y2Nlc3MpOwoKICBmdW5jdGlvbiBnZXRCdXNpbmVzc0NsaWVudEluZm9fc3VjY2VzcygpCiAgewogICAgZ2V0Q2xpZW50RXh0cmFGaWVsZHMoJGh0dHAsJHNjb3BlLCRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5idXNpbmVzc191c2VyX2lkLCdjbGllbnRFeHRyYUZpZWxkcycsZ2V0Q2xpZW50RXh0cmFGaWVsZHNfc3VjY2Vzcyk7CgogICAgZnVuY3Rpb24gZ2V0Q2xpZW50RXh0cmFGaWVsZHNfc3VjY2VzcygpCiAgICB7CiAgICAgIGZvciAoaSA9IDA7IGk8ICgkc2NvcGUuY2xpZW50RXh0cmFGaWVsZHMpLmxlbmd0aDsgaSsrKQogICAgICB7CiAgICAgICAgbG9nRGVidWcoJHNjb3BlLmNsaWVudEV4dHJhRmllbGRzW2ldKTsKICAgICAgICBpZiAoJHNjb3BlLmNsaWVudEV4dHJhRmllbGRzW2ldLmZpZWxkX2RhdGF0eXBlPT0iREFURSIpCiAgICAgICAgewogICAgICAgICAgLy8gbG9nRGVidWcoImRhdGUiKTsKICAgICAgICAgICRzY29wZS5jbGllbnRFeHRyYUZpZWxkc1tpXS5maWVsZF92YWx1ZT1uZXcgRGF0ZSgkc2NvcGUuY2xpZW50RXh0cmFGaWVsZHNbaV0uZmllbGRfdmFsdWUpOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KCiAgJHNjb3BlLmFyY2hpdmVDbGllbnRNb2RhbCA9IGZ1bmN0aW9uKCkKICB7CiAgICAvLyBhcmNoaXZlL2RlbGV0ZSBjbGllbnQgLSBhc2sgaWYgc3VyZQogICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgICAgICAgYW5pbWF0aW9uOiBmYWxzZSwKICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdhcmNoaXZlX2NsaWVudF9tb2RhbC5waHAnLAogICAgICAgIHNpemU6ICd4cycsCiAgICAgICAgY29udHJvbGxlcjogJ2FyY2hpdmVfY2xpZW50X21vZGFsJywgIC8vICdwYXltZW55RGV0YWlsc01vZGFsQ29udHJvbGxlcicsCiAgICAgICAgcmVzb2x2ZTogewogICAgICAgICAgYnVzaW5lc3NfdXNlcl9pZDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgcmV0dXJuICRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5idXNpbmVzc191c2VyX2lkOwogICAgICAgICAgfSwKICAgICAgICAgIGJ1c2VyX2xhc3RfbmFtZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgcmV0dXJuICRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5idXNlcl9sYXN0X25hbWU7CiAgICAgICAgICB9LAogICAgICAgICAgYnVzZXJfZmlyc3RfbmFtZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgcmV0dXJuICRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5idXNlcl9maXJzdF9uYW1lOwogICAgICAgICAgfSwKICAgICAgICAgIGlzX2luc3RydWN0b3I6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgIH0pOwogIH0KCiAgJHNjb3BlLnVwZGF0ZVVzZXJGaXJzdE5hbWUgPSBmdW5jdGlvbihuZXdWYWx1ZSkKICB7CiAgICBzZXRDbGllbnRGaXJzdE5hbWUoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLG5ld1ZhbHVlLGFmdGVyQ2xpZW50U2V0LGFmdGVyQ2xpZW50U2V0KTsKICAgIGZ1bmN0aW9uIGFmdGVyQ2xpZW50U2V0KCkKICAgIHsKICAgICAgZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKICAgIH0KICB9CiAgJHNjb3BlLnVwZGF0ZVVzZXJMYXN0TmFtZSA9IGZ1bmN0aW9uKG5ld1ZhbHVlKQogIHsKICAgIHNldENsaWVudExhc3ROYW1lKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCxuZXdWYWx1ZSxhZnRlckNsaWVudFNldCxhZnRlckNsaWVudFNldCk7CiAgICBmdW5jdGlvbiBhZnRlckNsaWVudFNldCgpCiAgICB7CiAgICAgIGdldEJ1c2luZXNzQ2xpZW50SW5mbygkaHR0cCwkc2NvcGUsJ2Zvcm1VcGRhdGVDbGllbnRBbmd1bGFyJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CiAgICB9CiAgfQogICRzY29wZS51cGRhdGVVc2VyUGhvbmVOdW1iZXIgPSBmdW5jdGlvbihuZXdWYWx1ZSkKICB7CiAgICBuZXdWYWx1ZSA9IG5ld1ZhbHVlLnJlcGxhY2UoJy0nLCcnKTsKICAgIGlmIChpc05hTihuZXdWYWx1ZSkpCiAgICB7CiAgICAgIGFsZXJ0KCLXkNeg15Ag15TXltefINee16HXpNeoINeY15zXpNeV158g16rXp9eZ158iKTsKICAgICAgZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgc2V0Q2xpZW50UGhvbmVOdW1iZXIoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLG5ld1ZhbHVlLHNldENsaWVudFBob25lTnVtYmVyX2NhbGxiYWNrLHNldENsaWVudFBob25lTnVtYmVyX2NhbGxiYWNrKTsKICAgICAgZnVuY3Rpb24gc2V0Q2xpZW50UGhvbmVOdW1iZXJfY2FsbGJhY2soKQogICAgICB7CiAgICAgICAgZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKICAgICAgfQogICAgfQogIH0KCn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignQ2xpZW50c1Nob3cxQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHRpbWVvdXQsICRodHRwLCBzaGFyZWRQcm9wZXJ0aWVzLCAkcm9vdFNjb3BlLCAkcm91dGVQYXJhbXMsICRsb2NhdGlvbiwgJHJvdXRlLCBzaGFyZWREYXRhLCAkdWliTW9kYWwpCnsKICAgIGdldEJ1c2luZXNzQ2xpZW50SW5mbygkaHR0cCwkc2NvcGUsJ2Zvcm1VcGRhdGVDbGllbnRBbmd1bGFyJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCxnZXRCdXNpbmVzc0NsaWVudEluZm9fc3VjY2Vzcyk7CgogICAgZnVuY3Rpb24gZ2V0QnVzaW5lc3NDbGllbnRJbmZvX3N1Y2Nlc3MoKQogICAgewogICAgICBnZXRDbGllbnRFeHRyYUZpZWxkcygkaHR0cCwkc2NvcGUsJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLmJ1c2luZXNzX3VzZXJfaWQsJ2NsaWVudEV4dHJhRmllbGRzJyxnZXRDbGllbnRFeHRyYUZpZWxkc19zdWNjZXNzKTsKCiAgICAgIGZ1bmN0aW9uIGdldENsaWVudEV4dHJhRmllbGRzX3N1Y2Nlc3MoKQogICAgICB7CiAgICAgICAgZm9yIChpID0gMDsgaTwgKCRzY29wZS5jbGllbnRFeHRyYUZpZWxkcykubGVuZ3RoOyBpKyspCiAgICAgICAgewogICAgICAgICAgbG9nRGVidWcoJHNjb3BlLmNsaWVudEV4dHJhRmllbGRzW2ldKTsKICAgICAgICAgIGlmICgkc2NvcGUuY2xpZW50RXh0cmFGaWVsZHNbaV0uZmllbGRfZGF0YXR5cGU9PSJEQVRFIikKICAgICAgICAgIHsKICAgICAgICAgICAgLy8gbG9nRGVidWcoImRhdGUiKTsKICAgICAgICAgICAgJHNjb3BlLmNsaWVudEV4dHJhRmllbGRzW2ldLmZpZWxkX3ZhbHVlPW5ldyBEYXRlKCRzY29wZS5jbGllbnRFeHRyYUZpZWxkc1tpXS5maWVsZF92YWx1ZSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CnsKICAgIGdldENsaWVudEV2ZW50cygkaHR0cCwkc2NvcGUsJ2N1cnJlbnRDbGllbnRFdmVudHMnLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKCiAgICBnZXRDbGllbnRQYXltZW50cygkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsJ2N1cnJlbnRDbGllbnRQYXltZW50cycpOwoKICAgICRzY29wZS5hcmNoaXZlQ2xpZW50TW9kYWwgPSBmdW5jdGlvbigpCiAgICB7CiAgICAgIC8vIGFyY2hpdmUvZGVsZXRlIGNsaWVudCAtIGFzayBpZiBzdXJlCiAgICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewogICAgICAgICAgYW5pbWF0aW9uOiBmYWxzZSwKICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2FyY2hpdmVfY2xpZW50X21vZGFsLnBocCcsCiAgICAgICAgICBzaXplOiAneHMnLAogICAgICAgICAgY29udHJvbGxlcjogJ2FyY2hpdmVfY2xpZW50X21vZGFsJywgIC8vICdwYXltZW55RGV0YWlsc01vZGFsQ29udHJvbGxlcicsCiAgICAgICAgICByZXNvbHZlOiB7CiAgICAgICAgICAgIGJ1c2luZXNzX3VzZXJfaWQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuICRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5idXNpbmVzc191c2VyX2lkOwogICAgICAgICAgICB9LAogICAgICAgICAgICBidXNlcl9sYXN0X25hbWU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuICRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5idXNlcl9sYXN0X25hbWU7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGJ1c2VyX2ZpcnN0X25hbWU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuICRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5idXNlcl9maXJzdF9uYW1lOwogICAgICAgICAgICB9LAogICAgICAgICAgICBpc19pbnN0cnVjdG9yOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICB9KTsKICAgIH0KICAgICRzY29wZS5wYWNrYWdlRGVsZXRlID0gZnVuY3Rpb24ocGFja2FnZSkKICAgIHsKICAgICAgbG9nRGVidWcoInBhY2thZ2UgZGVsZXRlICIrSlNPTi5zdHJpbmdpZnkocGFja2FnZSkpOwogICAgICBkZWxldGVQYWNrYWdlKCRodHRwLCRzY29wZSxwYWNrYWdlLnBhY2thZ2VfdXNlcl9pZCwkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYnVzaW5lc3NfdXNlcl9pZCxzdWNjZXNzX2NhbGxiYWNrLCBzdWNjZXNzX2NhbGxiYWNrKTsKICAgICAgZnVuY3Rpb24gc3VjY2Vzc19jYWxsYmFjaygpCiAgICAgIHsKICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NsaWVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCiAgICAgIH0KICAgIH0KCiAgICAkc2NvcGUudXBkYXRlQ2xpZW50RXh0cmFGaWVsZHMgPSBmdW5jdGlvbigpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJ1cGRhdGVFdmVudEV4dHJhRmllbGRzIik7CiAgICAgIHRoZWRhdGEgPSB7CiAgICAgICAgIGV4dHJhRmllbGRzOiRzY29wZS5jbGllbnRFeHRyYUZpZWxkcwogICAgICAgIH07CiAgICAgICRzY29wZS5leHRyYUZpZWxkc0FsZXJ0TWVzc2FnZT0i157XoteT15vXnyDXoNeq15XXoNeZ150sINeQ16DXkCDXlNee16rXny4uLiI7CiAgICAgIHVwZGF0ZUNsaWVudEV4dHJhRmllbGRzKCRodHRwLCRzY29wZSwkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYnVzaW5lc3NfdXNlcl9pZCx0aGVkYXRhLHVwZGF0ZUV2ZW50RXh0cmFGaWVsZHNfY2FsbGJhY2ssIHVwZGF0ZUV2ZW50RXh0cmFGaWVsZHNfY2FsbGJhY2spOwoKICAgICAgZnVuY3Rpb24gdXBkYXRlRXZlbnRFeHRyYUZpZWxkc19jYWxsYmFjaygpCiAgICAgIHsKICAgICAgICAvLyBnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkcm91dGVQYXJhbXMuZXZlbnRfaWQsc2V0UGFydGljaXBhdGVkKTsKICAgICAgICAkc2NvcGUuZXh0cmFGaWVsZHNBbGVydE1lc3NhZ2U9Iteq15nXoteV15Mg16DXqdee16gg15HXlNem15zXl9eUISI7CiAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKQogICAgICAgIHsKICAgICAgICAgICRzY29wZS5leHRyYUZpZWxkc0FsZXJ0TWVzc2FnZT1udWxsOwogICAgICAgIH0sIDMwMDApOwogICAgICB9CiAgICB9OwoKICAgICRzY29wZS5zY2hlZHVsZUV2ZW50Rm9yQ2xpZW50ID0gZnVuY3Rpb24oKQogICAgewogICAgICBsb2dEZWJ1Zygic2VldGluZyBzaGFyZSBwcm9wZXJ0eSB1c2VyX2lkICIrJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdKTsKICAgICAgc2hhcmVkUHJvcGVydGllcy5zZXRfc2VsZWN0ZWRfdXNlcigkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0pOwogICAgICAkbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2NhbGVuZGFyJyk7CiAgICB9CiAgICAkc2NvcGUuaW52b2ljZUdlbmVyYXRlQ2hlY2tib3ggPSBmdW5jdGlvbihmcGF5bWVudCkKICAgIHsKICAgICAgbG9nRGVidWcoImludm9pY2VHZW5lcmF0ZUNoZWNrYm94IGZvciAiK0pTT04uc3RyaW5naWZ5KGZwYXltZW50KSk7CiAgICAgIHNldENsaWVudFBheW1lbnRJbnZvaWNlR2VuZXJhdGVkKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCxmcGF5bWVudC51c2VyX3BheW1lbnRfaWQsZnBheW1lbnQuaW52b2ljZV9nZW5lcmF0ZWQsc2V0Q2xpZW50UGF5bWVudEludm9pY2VHZW5lcmF0ZWRfY2FsbGJhY2ssIHNldENsaWVudFBheW1lbnRJbnZvaWNlR2VuZXJhdGVkX2NhbGxiYWNrKTsKICAgICAgZnVuY3Rpb24gc2V0Q2xpZW50UGF5bWVudEludm9pY2VHZW5lcmF0ZWRfY2FsbGJhY2soKQogICAgICB7CiAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgICB9CiAgICB9OwoKICAgICRzY29wZS5yZWNhbGNVc2VyQmFsYW5jZSA9IGZ1bmN0aW9uKCkKICAgIHsKICAgICAgbG9nRGVidWcoInJlY2FsY1VzZXJCYWxhbmNlIik7CiAgICAgIHJlY2FsY1VzZXJCYWxhbmNlKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCwgcmVjYWxjVXNlckJhbGFuY2VfY2FsbGJhY2spOwogICAgICBmdW5jdGlvbiByZWNhbGNVc2VyQmFsYW5jZV9jYWxsYmFjaygpCiAgICAgIHsKICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NsaWVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCiAgICAgIH0gICAgfQogICAgJHNjb3BlLnVwZGF0ZUV2ZW50UGFja2FnZVJlZmVyZW5jZSA9IGZ1bmN0aW9uKHVzZXJfaWQsIGZtZWV0aW5nKQogICAgewogICAgICBsb2dEZWJ1ZygidXBkYXRlRXZlbnRQYWNrYWdlUmVmZXJlbmNlLCB1c2VyPSIrdXNlcl9pZCsiLCBmbWVldGluZz0iK0pTT04uc3RyaW5naWZ5KGZtZWV0aW5nKSk7CiAgICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewogICAgICAgICAgYW5pbWF0aW9uOiBmYWxzZSwKICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2NsaWVudF9ldmVudF9wYWNrYWdlX2Fzc29jaWF0aW9uLnBocCcsCiAgICAgICAgICBzaXplOiAneHMnLAogICAgICAgICAgY29udHJvbGxlcjogJ2V2ZW50UGFja2FnZUFzc29jaWF0aW9uTW9kYWxDb250cm9sbGVyJywgIC8vICdwYXltZW55RGV0YWlsc01vZGFsQ29udHJvbGxlcicsCiAgICAgICAgICByZXNvbHZlOiB7CiAgICAgICAgICAgICAgZm1lZXRpbmc6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gZm1lZXRpbmc7CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBiYWxhbmNlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuICRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5iYWxhbmNlOwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgYnVzaW5lc3NfdXNlcl9pZDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiAkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZDsKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgIH0pOwogICAgfTsKCiAgICAkc2NvcGUudXBkYXRlUGFja2FnZVBheW1lbnRSZWZlcmVuY2UgPSBmdW5jdGlvbih1c2VyX2lkLCBmcGFja2FnZSkKICAgIHsKICAgICAgbG9nRGVidWcoInVwZGF0ZVBhY2thZ2VQYXltZW50UmVmZXJlbmNlLCB1c2VyPSIrdXNlcl9pZCsiLCBmcGFja2FnZT0iK0pTT04uc3RyaW5naWZ5KGZwYWNrYWdlKSk7CiAgICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewogICAgICAgICAgYW5pbWF0aW9uOiBmYWxzZSwKICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2NsaWVudF9wYWNrYWdlX3BheW1lbnRfYXNzb2NpYXRpb24ucGhwJywKICAgICAgICAgIHNpemU6ICd4cycsCiAgICAgICAgICBjb250cm9sbGVyOiAncGFja2FnZVBheW1lbnRBc3NvY2lhdGlvbk1vZGFsQ29udHJvbGxlcicsICAvLyAncGF5bWVueURldGFpbHNNb2RhbENvbnRyb2xsZXInLAogICAgICAgICAgcmVzb2x2ZTogewogICAgICAgICAgICAgIGZwYWNrYWdlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIGZwYWNrYWdlOwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgYmFsYW5jZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYmFsYW5jZTsKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGJ1c2luZXNzX3VzZXJfaWQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQ7CiAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICB9KTsKICAgIH07CgogICAgLy8gc2hvdyBwYXltZW50IHBvcHVwCiAgICAkc2NvcGUuc2hvd1BheW1lbnREZXRhaWxzID0gZnVuY3Rpb24oZnBheW1lbnQpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJzaG93UGF5bWVudERldGFpbHMiKTsKICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgICAgICAgICBhbmltYXRpb246IGZhbHNlLAogICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfY2xpZW50X3BheW1lbnRfZGV0YWlscy5waHAnLAogICAgICAgICAgc2l6ZTogJ3hzJywKICAgICAgICAgIGNvbnRyb2xsZXI6ICdwYXltZW55RGV0YWlsc01vZGFsQ29udHJvbGxlcicsCiAgICAgICAgICByZXNvbHZlOiB7CiAgICAgICAgICAgICAgZnBheW1lbnQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gZnBheW1lbnQ7CiAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICB9KTsKICAgIH0KICAgICRzY29wZS5pbnZvaWNlTnVtYmVyQ2hhbmdlZCA9IGZ1bmN0aW9uKG5ld19pbnZvaWNlX251bWJlcixmcGF5bWVudCkKICAgIHsKICAgICAgbG9nRGVidWcoImludm9pY2VOdW1iZXJDaGFuZ2VkICIrIG5ld19pbnZvaWNlX251bWJlciArImZvciAiK0pTT04uc3RyaW5naWZ5KGZwYXltZW50KSk7CiAgICAgIHNldENsaWVudFBheW1lbnRJbnZvaWNlTnVtYmVyKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCxmcGF5bWVudC51c2VyX3BheW1lbnRfaWQsbmV3X2ludm9pY2VfbnVtYmVyLHNldENsaWVudFBheW1lbnRJbnZvaWNlTnVtYmVyX2NhbGxiYWNrLCBzZXRDbGllbnRQYXltZW50SW52b2ljZU51bWJlcl9jYWxsYmFjayk7CiAgICAgIGZ1bmN0aW9uIHNldENsaWVudFBheW1lbnRJbnZvaWNlTnVtYmVyX2NhbGxiYWNrKCkKICAgICAgewogICAgICAgIC8vICRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKICAgICAgfQogICAgfTsKCiAgICAkc2NvcGUuJG9uKCJjbGllbnRQYWdlUmVsb2FkRGF0YSIsZnVuY3Rpb24oZSxhKQogICAgewogICAgICBsb2dEZWJ1ZygiY2xpZW50UGFnZVJlbG9hZERhdGEiKTsKICAgICAgZ2V0QnVzaW5lc3NVc2VyUGFja2FnZXMoJGh0dHAsJHNjb3BlLCd1c2VyX3BhY2thZ2VzJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CiAgICAgIGdldENsaWVudFBheW1lbnRzKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCwnY3VycmVudENsaWVudFBheW1lbnRzJyk7CiAgICAgIGdldENsaWVudEV2ZW50cygkaHR0cCwkc2NvcGUsJ2N1cnJlbnRDbGllbnRFdmVudHMnLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKICAgICAgZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKCiAgICB9KTsKCiAgICAkc2NvcGUuaXNDb25maXJtZWRPckNsb3NlZCA9IGZ1bmN0aW9uKGV2ZW50KQogICAgewogICAgICBpZiAoJHNjb3BlLnNob3dBbGxFdmVudHMpCiAgICAgIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQoKICAgICAgaWYgKChldmVudC5pc19jb25maXJtZWQgPT0gMSkgfHwgKGV2ZW50LmlzX2ZpbmFsX3N0YXR1cyA9PSAxKSB8fCAoKGV2ZW50LmlzX3dhaXRpbmdfbGlzdCA9PSAxKSAmJiAoZXZlbnQuaXNfY2FuY2VsZWQgPT0gMCkpKQogICAgICB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgZWxzZQogICAgICB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9CiAgICAkc2NvcGUuZ290b0NsaWVudEVkaXRQYWdlPWdvdG9DbGllbnRFZGl0UGFnZTsKICAgICRzY29wZS5nb3RvQmFjaz1mdW5jdGlvbigpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCdnbyBiYWNrJyk7CiAgICAgIHdpbmRvdy5oaXN0b3J5LmJhY2soKTsKICAgIH07CgogICAgJHNjb3BlLmdvdG9FdmVudFBhZ2UgPSBmdW5jdGlvbiAodGhlZXZlbnQpCiAgICB7CiAgICAgIGdvdG9FdmVudFBhZ2UodGhlZXZlbnQpOwogICAgfQp9CiAgICAkc2NvcGUuaW5pdGlhdGVQYXltZW50ID0gZnVuY3Rpb24oaXNwbHVzKQogICAgewogICAgICBsb2dEZWJ1ZygiaW5pdGlhdGVQYXltZW50IGlzcGx1cyIraXNwbHVzKTsKICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgICAgICAgICBhbmltYXRpb246IGZhbHNlLAogICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfY2xpZW50X3BheW1lbnQucGhwJywKICAgICAgICAgIGNvbnRyb2xsZXI6ICdidXNpbmVzc0NsaWVuZENhcmRQYXltZW50JywKICAgICAgICAgIC8vIHNpemU6IHNpemUsCiAgICAgICAgICByZXNvbHZlOiB7CiAgICAgICAgICAgIGN1cnJlbnRDbGllbnQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuICRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgaXNwbHVzOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBpc3BsdXM7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgfSk7CiAgICB9CgogICAgJHNjb3BlLnVwZGF0ZVVzZXJGaXJzdE5hbWUgPSBmdW5jdGlvbihuZXdWYWx1ZSkKICAgIHsKICAgICAgc2V0Q2xpZW50Rmlyc3ROYW1lKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCxuZXdWYWx1ZSxhZnRlckNsaWVudFNldCxhZnRlckNsaWVudFNldCk7CiAgICAgIGZ1bmN0aW9uIGFmdGVyQ2xpZW50U2V0KCkKICAgICAgewogICAgICAgIGdldEJ1c2luZXNzQ2xpZW50SW5mbygkaHR0cCwkc2NvcGUsJ2Zvcm1VcGRhdGVDbGllbnRBbmd1bGFyJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CiAgICAgIH0KICAgIH0KICAgICRzY29wZS51cGRhdGVVc2VyTGFzdE5hbWUgPSBmdW5jdGlvbihuZXdWYWx1ZSkKICAgIHsKICAgICAgc2V0Q2xpZW50TGFzdE5hbWUoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLG5ld1ZhbHVlLGFmdGVyQ2xpZW50U2V0LGFmdGVyQ2xpZW50U2V0KTsKICAgICAgZnVuY3Rpb24gYWZ0ZXJDbGllbnRTZXQoKQogICAgICB7CiAgICAgICAgZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKICAgICAgfQogICAgfQogICAgJHNjb3BlLnVwZGF0ZVVzZXJFbWFpbCA9IGZ1bmN0aW9uKG5ld1ZhbHVlKQogICAgewogICAgICBzZXRDbGllbnRFbWFpbCgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsbmV3VmFsdWUsYWZ0ZXJzZXRDbGllbnRFbWFpbCxhZnRlcnNldENsaWVudEVtYWlsKTsKICAgICAgZnVuY3Rpb24gYWZ0ZXJzZXRDbGllbnRFbWFpbCgpCiAgICAgIHsKICAgICAgICBnZXRCdXNpbmVzc0NsaWVudEluZm8oJGh0dHAsJHNjb3BlLCdmb3JtVXBkYXRlQ2xpZW50QW5ndWxhcicsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwogICAgICB9CiAgICB9CgoKICAgICRzY29wZS51cGRhdGVVc2VyUGhvbmVOdW1iZXIgPSBmdW5jdGlvbihuZXdWYWx1ZSkKICAgIHsKICAgICAgbmV3VmFsdWUgPSBuZXdWYWx1ZS5yZXBsYWNlKCctJywnJyk7CiAgICAgIGlmIChpc05hTihuZXdWYWx1ZSkpCiAgICAgIHsKICAgICAgICBhbGVydCgi15DXoNeQINeU15bXnyDXnteh16TXqCDXmNec16TXldefINeq16fXmdefIik7CiAgICAgICAgZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKICAgICAgfQogICAgICBlbHNlCiAgICAgIHsKICAgICAgICBzZXRDbGllbnRQaG9uZU51bWJlcigkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsbmV3VmFsdWUsc2V0Q2xpZW50UGhvbmVOdW1iZXJfY2FsbGJhY2ssc2V0Q2xpZW50UGhvbmVOdW1iZXJfY2FsbGJhY2spOwogICAgICAgIGZ1bmN0aW9uIHNldENsaWVudFBob25lTnVtYmVyX2NhbGxiYWNrKCkKICAgICAgICB7CiAgICAgICAgICBnZXRCdXNpbmVzc0NsaWVudEluZm8oJGh0dHAsJHNjb3BlLCdmb3JtVXBkYXRlQ2xpZW50QW5ndWxhcicsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgJHNjb3BlLnVwZGF0ZVVzZXJFdmVudFByaWNlID0gZnVuY3Rpb24obmV3dmFsdWUsIHRoZWV2ZW50KQogICAgewogICAgICBuZXdfcHJpY2U9bmV3dmFsdWU7CiAgICAgIHNldENsaWVudEV2ZW50UHJpY2UoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLHRoZWV2ZW50LmV2ZW50X2lkLCBuZXdfcHJpY2Usc2V0Q2xpZW50RXZlbnRQcmljZV9jYWxsYmFjaywgc2V0Q2xpZW50RXZlbnRQcmljZV9jYWxsYmFjayk7CiAgICAgIGZ1bmN0aW9uIHNldENsaWVudEV2ZW50UHJpY2VfY2FsbGJhY2soKQogICAgICB7CiAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgICB9CiAgICB9OwoKICAgICRzY29wZS51cGRhdGVVc2VyUGFja2FnZUV2ZW50c0NvdW50ZXIgPSBmdW5jdGlvbihuZXd2YWx1ZSwgdGhlcGFja2FnZSkKICAgIHsKICAgICAgZXZlbnRzX2NvdW50ZXI9bmV3dmFsdWU7CiAgICAgIHNldFVzZXJQYWNrYWdlRXZlbnRzQ291bnRlcigkaHR0cCwkc2NvcGUsdGhlcGFja2FnZS5wYWNrYWdlX3VzZXJfaWQsZXZlbnRzX2NvdW50ZXIsc2V0VXNlclBhY2thZ2VFdmVudHNDb3VudGVyX2NhbGxiYWNrLCBzZXRVc2VyUGFja2FnZUV2ZW50c0NvdW50ZXJfY2FsbGJhY2spCiAgICAgIGZ1bmN0aW9uIHNldFVzZXJQYWNrYWdlRXZlbnRzQ291bnRlcl9jYWxsYmFjaygpCiAgICAgIHsKICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NsaWVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCiAgICAgIH0KICAgIH07CiAgICAkc2NvcGUudXBkYXRlVXNlclBhY2thZ2VQYWNrYWdlUHJpY2UgPSBmdW5jdGlvbihuZXd2YWx1ZSwgdGhlcGFja2FnZSkKICAgIHsKICAgICAgcGFja2FnZV9wcmljZT1uZXd2YWx1ZTsKICAgICAgc2V0VXNlclBhY2thZ2VQYWNrYWdlUHJpY2UoJGh0dHAsJHNjb3BlLHRoZXBhY2thZ2UucGFja2FnZV91c2VyX2lkLHBhY2thZ2VfcHJpY2Usc2V0VXNlclBhY2thZ2VQYWNrYWdlUHJpY2VfY2FsbGJhY2ssIHNldFVzZXJQYWNrYWdlUGFja2FnZVByaWNlX2NhbGxiYWNrKQogICAgICBmdW5jdGlvbiBzZXRVc2VyUGFja2FnZVBhY2thZ2VQcmljZV9jYWxsYmFjaygpCiAgICAgIHsKICAgICAgICAvLyBnZXRCdXNpbmVzc1VzZXJQYWNrYWdlcygkaHR0cCwkc2NvcGUsJ3VzZXJfcGFja2FnZXMnLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NsaWVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCiAgICAgIH0KICAgIH07CgogICAgJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyID0ge307CiAgICBsb2dEZWJ1Zygkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CiAgICAkc2NvcGUuc2hvd19jbGllbnRfdXBkYXRlX2NsaWVudCA9IHRydWU7CiAgICAkc2NvcGUuc2hvd19jbGllbnRfdXBkYXRlX3NhdmUgPSBmYWxzZTsKICAgICRzY29wZS5zaG93X2NsaWVudF9kZWxldGVfY2xpZW50ID0gdHJ1ZTsKICAgICRzY29wZS5zaG93X2NsaWVudF91cGRhdGVfY2FuY2VsID0gZmFsc2U7CgogICAgJHNjb3BlLnVwZGF0ZUNsaWVudEVuYWJsZSA9IGZ1bmN0aW9uKCkgewogICAgICAgIGxvZ0RlYnVnKCJlbmFibGluZyBlZGl0aW5nICgkc2NvcGUuY2xpZW50c1VwZGF0ZURpc2FibGVkIHdhcyAiICsgJHNjb3BlLmNsaWVudHNVcGRhdGVEaXNhYmxlZCArICIpIik7CiAgICAgICAgJHNjb3BlLmNsaWVudHNVcGRhdGVEaXNhYmxlZCA9IGZhbHNlOwogICAgICAgICRzY29wZS5zaG93X2NsaWVudF91cGRhdGVfY2xpZW50ID0gZmFsc2U7CiAgICAgICAgJHNjb3BlLnNob3dfY2xpZW50X3VwZGF0ZV9zYXZlID0gdHJ1ZTsKICAgICAgICAkc2NvcGUuc2hvd19jbGllbnRfZGVsZXRlX2NsaWVudCA9IGZhbHNlOwogICAgICAgICRzY29wZS5zaG93X2NsaWVudF91cGRhdGVfY2FuY2VsID0gdHJ1ZTsKICAgIH0KICAgICRzY29wZS51cGRhdGVDbGllbnREaXNhYmxlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgbG9nRGVidWcoImRpc2FibGUgZWRpdGluZyIpOwogICAgICAgIC8vCQkkbG9jYXRpb24ucGF0aCgnL0NsaWVudHMvJyskcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CiAgICAgICAgJHJvdXRlLnJlbG9hZCgpOwogICAgfQogICAgJHNjb3BlLnNjaGVkdWxlRXZlbnRGcm9tRW5kVXNlciA9IGZ1bmN0aW9uKCkgewogICAgICAgIHNoYXJlZERhdGEuc2V0U2VsZWN0ZWRFbmRVc2VyKHsKICAgICAgICAgICAgaWQ6ICRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLAogICAgICAgICAgICBmaXJzdF9uYW1lOiAkc2NvcGUuY3VycmVudENsaWVudC51c2Vyc1swXS5maXJzdF9uYW1lLAogICAgICAgICAgICBsYXN0X25hbWU6ICRzY29wZS5jdXJyZW50Q2xpZW50LnVzZXJzWzBdLmxhc3RfbmFtZQogICAgICAgIH0pOwogICAgICAgIGxvZ0RlYnVnKCJzY2hlZHVsZSBldmVudCBmb3IgdXNlciAiICsgJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwogICAgICAgIC8vCQkkbG9jYXRpb24ucGF0aCgnL0NsaWVudHMvJyskcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CiAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jYWxlbmRhcicpOwogICAgfQoKICAgIC8vIHJlbW92ZSBlbmQgdXNlciBmcm9tIGV2ZW50CiAgICAkc2NvcGUudXNlckRlbGV0ZUV2ZW50ID0gZnVuY3Rpb24oZW5kdXNlcl9pZCwgdGhlZXZlbnQpCiAgICB7CiAgICAgIC8vIGlmIGl0J3MgYSBjbGFzcyAtIHdlIHNpbXBseSByZW1vdmUgdGhlIHVzZXIgZnJvbSB0aGUgZXZlbnQKICAgICAgaWYgKHRoZWV2ZW50LmlzX2NsYXNzPT0xKQogICAgICB7CiAgICAgICAgbG9nRGVidWcoInNjb3BlLnVzZXJEZWxldGVFdmVudCIpOwogICAgICAgIHJlbW92ZUVuZFVzZXJGcm9tRXZlbnQoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLHRoZWV2ZW50LmV2ZW50X2lkLHJlbW92ZUVuZFVzZXJGcm9tRXZlbnRfZmluaXNoLCByZW1vdmVFbmRVc2VyRnJvbUV2ZW50X2ZpbmlzaCk7CiAgICAgICAgZnVuY3Rpb24gcmVtb3ZlRW5kVXNlckZyb21FdmVudF9maW5pc2goKQogICAgICAgIHsKICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKICAgICAgICB9CiAgICAgIH0KICAgICAgLy8gaWYgaXRzIG5vdCBhIGNsYXNzIC0gd2UgbmVlZCB0byByZW1vdmUgdGhlIGV2ZW50IGl0c2VsZgogICAgICBlbHNlCiAgICAgIHsKICAgICAgICAvLyBhbGVydCgibm90IGNsYXNzIGV2ZW50LCBUT0RPIik7CiAgICAgIH0KICAgIH07CgogICAgLy8gcmV0cmV2aW5nIHBhY2thZ2VzIGZvciB0aGUgYnVzaW5lc3MKICAgIGdldEJ1c2luZXNzUGFja2FnZXMoJGh0dHAsJHNjb3BlLCdwYWNrYWdlcycpOwoKICAgIC8vIGdldCBwYWNrYWdlcyBmb3IgdGhpcyBzcGVjaWZpYyB1c2VyCiAgICBnZXRCdXNpbmVzc1VzZXJQYWNrYWdlcygkaHR0cCwkc2NvcGUsJ3VzZXJfcGFja2FnZXMnLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKICAgIC8vIGFkZGluZyBwYWNrYWdlIHRvIHVzZXIgLSBjYWxsZWQgd2hlbiBhIHBhY2thZ2UgaXMgc2VsZWN0ZWQKICAgICRzY29wZS5wYWNrYWdlRm9yQ2xpZW50U2VsZWN0ZWQgPSBmdW5jdGlvbihzZWxlY3RlZFBhY2thZ2UpIHsKICAgICAgICBpZiAoc2VsZWN0ZWRQYWNrYWdlKSB7CiAgICAgICAgICAgIC8vIGxvZ0RlYnVnKCd5ZXMgc2VsZWN0ZWQgJyArIEpTT04uc3RyaW5naWZ5KHNlbGVjdGVkUGFja2FnZSkpOwogICAgICAgICAgICBhZGRCdXNpbmVzc1BhY2thZ2VUb1VzZXIoJGh0dHAsJHNjb3BlLHNlbGVjdGVkUGFja2FnZS5vcmlnaW5hbE9iamVjdCwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCxhZGRCdXNpbmVzc1BhY2thZ2VTdWNjZXNzKTsKICAgICAgICAgICAgZnVuY3Rpb24gYWRkQnVzaW5lc3NQYWNrYWdlU3VjY2VzcygpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBsb2dEZWJ1ZygiYWRkQnVzaW5lc3NQYWNrYWdlU3VjY2VzczIiKTsKICAgICAgICAgICAgICAvLyBnZXRCdXNpbmVzc1BhY2thZ2VzKCRodHRwLCRzY29wZSwncGFja2FnZXMnKTsKICAgICAgICAgICAgICAvLyBnZXRCdXNpbmVzc1VzZXJQYWNrYWdlcygkaHR0cCwkc2NvcGUsJ3VzZXJfcGFja2FnZXMnLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NsaWVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdhbmd1Y29tcGxldGUtYWx0OmNsZWFySW5wdXQnLCAnY2xpZW50X2FuZ3Vjb21wbGV0ZScpOwogICAgICAgIH0KICAgICAgICBlbHNlCiAgICAgICAgewogICAgICAgICAgICAvLyBsb2dEZWJ1Zygnbm90IHNlbGVjdGVkLCBkbyBub3RoaW5nJyk7CiAgICAgICAgfQogICAgfTsKfSk7CgoKLy8gTmVlZCB0byBkaXN0aW5ndWlzaCBiZXR3ZWVuIGVuZCB1c2VyIChjbGllbnQpIGFuZCBidXNpbmVzcyBvd25lci4KLy8gY3VycmVudGx5IGNhbGxzIG9ubHkgZW5kIHVzZXIKa3V6ZUFwcC5jb250cm9sbGVyKCdIb21lQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICR1aWJNb2RhbCkKewoKICAgIGdldEFsbENsaWVudHMoJGh0dHAsJHNjb3BlLCdhbGxDbGllbnRzJyk7CgogICAgJHNjb3BlLmhvbWVwYWdlTGltaXQ9NjsKICAgIGdldE9wZW5lZEV2ZW50cygkaHR0cCwkc2NvcGUsJHNjb3BlLmhvbWVwYWdlTGltaXQsJ29wZW5lZF9ldmVudHMnKTsKCiAgICB2YXIgdG9kYXlkYXRlID0gbmV3IERhdGUoKTsKICAgIHZhciBob3dtYW55ZGF5c2FoZWFkPTMwOwogICAgdmFyIHN0YXJ0ZGF0ZT10b2RheWRhdGUuZ2V0RnVsbFllYXIoKSsiLSIrKDErdG9kYXlkYXRlLmdldE1vbnRoKCkpKyItIit0b2RheWRhdGUuZ2V0RGF0ZSgpOwogICAgdG9kYXlkYXRlLnNldERhdGUodG9kYXlkYXRlLmdldERhdGUoKSArIGhvd21hbnlkYXlzYWhlYWQpOwogICAgdmFyIGVuZGRhdGU9dG9kYXlkYXRlLmdldEZ1bGxZZWFyKCkrIi0iKygxK3RvZGF5ZGF0ZS5nZXRNb250aCgpKSsiLSIrdG9kYXlkYXRlLmdldERhdGUoKTsKCiAgICAvLyBmaWx0ZXIgZm9yIHVzZXJzIHdobyBoYXZlIGRlYnQKICAgICRzY29wZS5oYXZlRGVidCA9IGZ1bmN0aW9uKGV1c2VyKQogICAgewogICAgICBpZiAoZXVzZXIudXNlcl9iYWxhbmNlIDwgMCkKICAgICAgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIGVsc2UKICAgICAgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfTsKCiAgICAkc2NvcGUuZ290b0NsaWVudFBhZ2UgPSBmdW5jdGlvbihidXNpbmVzc191c2VyX2lkKQogICAgewogICAgICAvLyBsb2dEZWJ1ZyhldXNlcik7CiAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmPScvIy9idXNpbmVzc19jbGllbnRzLycgKyBidXNpbmVzc191c2VyX2lkOwogICAgfQoKICAgIHZhciBwYXlsb2FkID0gJ3N0YXJ0PScgKyBzdGFydGRhdGUgKyAnJmVuZD0nICsgZW5kZGF0ZTsKICAgIHZhciBjb25maWcgPSB7CiAgICAgIGhlYWRlcnM6IHsnQ29udGVudC1UeXBlJzonYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkOyBjaGFyc2V0PVVURi04J30KICAgIH0KICAgIHZhciBwb3N0dXJsID0gIi9hcGkvYWRtaW4vZXZlbnRzL2dldHBvc3QiOwoKICAgICRodHRwLnBvc3QocG9zdHVybCwgcGF5bG9hZCwgY29uZmlnKS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJkb25lIik7CiAgICAgICRzY29wZS5hZG1pbl9ldmVudHMgPSBkYXRhOwogICAgfSk7CgogICAgJHNjb3BlLnNob3dFdmVudFBvcHVwID0gZnVuY3Rpb24oc2VsZWN0ZWRFdmVudCkgewogICAgICAgIHNob3dFdmVudFBvcHVwKHNlbGVjdGVkRXZlbnQsICR1aWJNb2RhbCkKICAgIH07CiAgICAkc2NvcGUuZWRpdEV2ZW50PSBmdW5jdGlvbiAodGhlZXZlbnQpCiAgICB7CiAgICAgIGdvdG9FdmVudFBhZ2UodGhlZXZlbnQpOwogICAgfQp9KTsKCi8vIGt1emVBcHAuY29udHJvbGxlcignQnVzaW5lc3NDb25maWdDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJHJvdXRlUGFyYW1zLCAkbG9jYXRpb24sICRyb3V0ZSwgc2hhcmVkRGF0YSkgewoKa3V6ZUFwcC5jb250cm9sbGVyKCdDb25maWdVc2VyQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHVpYk1vZGFsLCAkaHR0cCwgJHRpbWVvdXQpCnsKICAkc2NvcGUuaW5UaGVNaWRkbGVPZlNhdmU9ZmFsc2U7CgogIGxvZ0RlYnVnKCJDb25maWdVc2VyQ29udHJvbGxlciIpOwogIC8vICRzY29wZS5hamF4X2luZm89IteU16nXmdeg15XXmdeZ150g16DXqdee16jXlSI7CgogIGdldExvZ2dlZFVzZXJJbmZvKCRodHRwLCRzY29wZSwndXNlclByb3BlcnRpZXMnLGdldExvZ2dlZFVzZXJJbmZvX3N1Y2Nlc3MsZ2V0TG9nZ2VkVXNlckluZm9fZmFpbHVyZSk7CiAgZnVuY3Rpb24gZ2V0TG9nZ2VkVXNlckluZm9fc3VjY2VzcygpCiAgewogICAgbG9nRGVidWcoImdldExvZ2dlZFVzZXJJbmZvX3N1Y2Nlc3MiKTsKICAgICRzY29wZS51c2VyUHJvcGVydGllc0R1cGxpY2F0ZSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoJHNjb3BlLnVzZXJQcm9wZXJ0aWVzKSk7CiAgfQogIGZ1bmN0aW9uIGdldExvZ2dlZFVzZXJJbmZvX2ZhaWx1cmUoKQogIHsKICAgIGxvZ0RlYnVnKCJnZXRMb2dnZWRVc2VySW5mb19mYWlsdXJlIik7CiAgfQoKICAkc2NvcGUuYmFjayA9IGZ1bmN0aW9uKCkgewogICAgd2luZG93Lmhpc3RvcnkuYmFjaygpOwogIH07CgogICRzY29wZS5jaGFuZ2VQYXNzd29yZE1vZGFsID0gZnVuY3Rpb24oKQogIHsKICAgICRzY29wZS5pblRoZU1pZGRsZU9mU2F2ZT10cnVlOwogICAgZnVuY3Rpb24gc21zUmVzZXRQYXNzd29yZF9zdWNjZXNzKCkKICAgIHsKICAgICAgY29uc29sZS5sb2coInNtc1Jlc2V0UGFzc3dvcmRfc3VjY2VzcyIpOwogICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAgICAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdtb2RhbF9jaGFuZ2VfcGFzc3dvcmQucGhwJywKICAgICAgICAgIGNvbnRyb2xsZXI6ICdtb2RhbF9jaGFuZ2VfcGFzc3dvcmQnLAogICAgICAgICAgc2l6ZTogJ2wnLAogICAgICAgICAgcmVzb2x2ZTogewogICAgICAgICAgICAgIHVzZXJfcGhvbmVfbnVtYmVyOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgLy8gcGFzc2luZyBvcmlnaW5hbCBwaG9uZSBudW1iZXIKICAgICAgICAgICAgICAgICAgcmV0dXJuICRzY29wZS51c2VyUHJvcGVydGllc0R1cGxpY2F0ZVswXS5waG9uZV9udW1iZXI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICB9KTsKCiAgICAgIG1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7CiAgICAgICAgJHNjb3BlLmluVGhlTWlkZGxlT2ZTYXZlPWZhbHNlOwogICAgICAgIGxvZ0RlYnVnKCdzbXNSZXNldFBhc3N3b3JkIE1vZGFsIGZpbmlzZWhkIHJlc3VsdDogJyArIHJlc3VsdCk7CiAgICAgICAgJHNjb3BlLmFqYXhfaW5mbz0i15TXodeZ16HXnteQINei15XXk9eb16DXlCDXkdeU16bXnNeX15QhIjsKICAgICAgICAvLyBnZXRMb2dnZWRVc2VySW5mbygkaHR0cCwkc2NvcGUsJ3VzZXJQcm9wZXJ0aWVzJyxnZXRMb2dnZWRVc2VySW5mb19zdWNjZXNzLGdldExvZ2dlZFVzZXJJbmZvX2ZhaWx1cmUpOwogICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkKICAgICAgICB7CiAgICAgICAgICAkc2NvcGUuYWpheF9pbmZvPW51bGw7CiAgICAgICAgfSwgMjAwMCk7CiAgICAgICAgICBsb2dEZWJ1Zygnc21zUmVzZXRQYXNzd29yZCBNb2RhbCBkaXNtaXNzZWQgYXQ6ICcgKyBuZXcgRGF0ZSgpKTsKICAgICAgfSwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAkc2NvcGUuaW5UaGVNaWRkbGVPZlNhdmU9ZmFsc2U7CiAgICAgICAgICBsb2dEZWJ1ZygnbW9kYWxfY2hhbmdlX3Bhc3N3b3JkIE1vZGFsIGRpc21pc3NlZCBhdDogJyArIG5ldyBEYXRlKCkpOwogICAgICB9KTsKICAgIH0KCgogICAgY2hhbmdlUGFzc3dvcmRTTVMoJGh0dHAsJHNjb3BlLCRzY29wZS51c2VyUHJvcGVydGllc0R1cGxpY2F0ZVswXS5waG9uZV9udW1iZXIsc21zUmVzZXRQYXNzd29yZF9zdWNjZXNzKTsKICB9CiAgJHNjb3BlLnVwZGF0ZVVzZXJDb25maWc9ZnVuY3Rpb24oKQogIHsKICAgICRzY29wZS5pblRoZU1pZGRsZU9mU2F2ZT10cnVlOwogICAgbG9nRGVidWcoInVwZGF0ZVVzZXJDb25maWcsIGluVGhlTWlkZGxlT2ZTYXZlPSIrJHNjb3BlLmluVGhlTWlkZGxlT2ZTYXZlKTsKICAgIC8vIGxvZ0RlYnVnKCRzY29wZS51c2VyUHJvcGVydGllc0R1cGxpY2F0ZSk7CiAgICAvLyBsb2dEZWJ1Zygkc2NvcGUudXNlclByb3BlcnRpZXMpOwogICAgaWYgKGFuZ3VsYXIuZXF1YWxzKCRzY29wZS51c2VyUHJvcGVydGllc0R1cGxpY2F0ZVswXS5waG9uZV9udW1iZXIsJHNjb3BlLnVzZXJQcm9wZXJ0aWVzWzBdLnBob25lX251bWJlcikpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJub3RoaW5nIGNoYW5nZWQgaW4gcGhvbmUgbnVtYmVyLCBjaGVja2luZyBvdGhlciBkYXRhIG90aGVyIGRhdGEiKTsKICAgICAgaWYgKGFuZ3VsYXIuZXF1YWxzKCRzY29wZS51c2VyUHJvcGVydGllc0R1cGxpY2F0ZVswXSwkc2NvcGUudXNlclByb3BlcnRpZXNbMF0pKQogICAgICB7CiAgICAgICAgJHNjb3BlLmluVGhlTWlkZGxlT2ZTYXZlPWZhbHNlOwogICAgICAgIGxvZ0RlYnVnKCJub3RoaW5nIGNoYW5nZWQgaW4gZGV0YWlscywgbm90aGluZyB0byBzYXZlIik7CiAgICAgICAgJHNjb3BlLmFqYXhfaW5mbz0i15zXkCDXkdeV16bXoteVINep15nXoNeV15nXmdedINec16nXnteZ16jXlC4uLiI7CiAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKQogICAgICAgIHsKICAgICAgICAgICRzY29wZS5hamF4X2luZm89bnVsbDsKICAgICAgICB9LCAxNTAwKTsKICAgICAgfQogICAgICBlbHNlCiAgICAgIHsKICAgICAgICBjaGFuZ2VVc2VyRGV0YWlscygkaHR0cCwkc2NvcGUsJHNjb3BlLnVzZXJQcm9wZXJ0aWVzWzBdLmZpcnN0X25hbWUsJHNjb3BlLnVzZXJQcm9wZXJ0aWVzWzBdLmxhc3RfbmFtZSwgJHNjb3BlLnVzZXJQcm9wZXJ0aWVzWzBdLmVtYWlsX2FkZHJlc3MsY2hhbmdlVXNlckRldGFpbHNfc3VjY2VzcywgY2hhbmdlVXNlckRldGFpbHNfZmFpbHVyZSk7CiAgICAgICAgJHNjb3BlLmFqYXhfaW5mbz0i157XoteT15vXnyDXqdeZ16DXldeZ15nXnS4uLiI7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGNoYW5nZVVzZXJEZXRhaWxzX3N1Y2Nlc3MoKQogICAgICB7CiAgICAgICAgbG9nRGVidWcoImNoYW5nZVVzZXJEZXRhaWxzX3N1Y2Nlc3MiKTsKICAgICAgICAkc2NvcGUuYWpheF9pbmZvPSLXlNep15nXoNeV15nXmdedINeg16nXnteo15Ug15HXlNem15zXl9eUISI7CiAgICAgICAgJHNjb3BlLmluVGhlTWlkZGxlT2ZTYXZlPWZhbHNlOwogICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkKICAgICAgICB7CiAgICAgICAgICAkc2NvcGUuYWpheF9pbmZvPW51bGw7CiAgICAgICAgfSwgMTUwMCk7CiAgICAgICAgZ2V0TG9nZ2VkVXNlckluZm8oJGh0dHAsJHNjb3BlLCd1c2VyUHJvcGVydGllcycsZ2V0TG9nZ2VkVXNlckluZm9fc3VjY2VzcyxnZXRMb2dnZWRVc2VySW5mb19mYWlsdXJlKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBjaGFuZ2VVc2VyRGV0YWlsc19mYWlsdXJlKCkKICAgICAgewogICAgICAgIGxvZ0RlYnVnKCJjaGFuZ2VVc2VyRGV0YWlsc19mYWlsdXJlIik7CiAgICAgIH0KCiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgIC8vIHVwZGF0ZSB1c2VyIGluZm8gLSBhZnRlciB2ZXJpZnlpbmcgcGFzc3dvcmQKICAgICAgY29uc29sZS5sb2coInBob25lIGNoYW5nZWQsIGNoZWNraW5nIGlmIG5ldyBwaG9uZSBpcyBpbiBkZXNjZW50IGZvcm1hdCIpOwogICAgICBpZiAoIWNoZWNrUGhvbmVOdW1iZXIoJHNjb3BlLnVzZXJQcm9wZXJ0aWVzWzBdLnBob25lX251bWJlcikpCiAgICAgIHsKICAgICAgICAkc2NvcGUuYWpheF9pbmZvPSLXkNeg15Ag15TXltefINee16HXpNeoINeY15zXpNeV158g16HXnNeV15zXqNeZINeq16fXmdefINec16fXkdec16og15TXldeT16LXldeqINee16fXmdeV15YuIjsKICAgICAgICAkdGltZW91dChmdW5jdGlvbigpCiAgICAgICAgewogICAgICAgICAgJHNjb3BlLmFqYXhfaW5mbz1udWxsOwogICAgICAgIH0sIDMwMDApOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBjb25zb2xlLmxvZygicGhvbmUgY2hhbmdlZCwgY2hlY2tpbmcgaWYgbmV3IHBob25lIGlzIG5vdCB1c2VkIGFscmVhZHkiKTsKICAgICAgaXNOZXdQaG9uZVVzZWRJZk5vdFNlbmRTTVMoJGh0dHAsJHNjb3BlLCRzY29wZS51c2VyUHJvcGVydGllc1swXS5waG9uZV9udW1iZXIsIGlzTmV3UGhvbmVVc2VkX3N1Y2Nlc3MsIGlzTmV3UGhvbmVVc2VkX2ZhaWx1cmUsZmFsc2UpOwogICAgICBmdW5jdGlvbiBpc05ld1Bob25lVXNlZF9zdWNjZXNzKHJlc3BvbnNlKQogICAgICB7CiAgICAgICAgY29uc29sZS5sb2coInBob25lIG5vdCB1c2VkIC0gcHJvbXB0aW5nIGZvciBwYXNzd29yZCIpOwogICAgICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewogICAgICAgICAgICBhbmltYXRpb246IGZhbHNlLAogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdtb2RhbF9jaGVja19wYXNzd29yZF91cGRhdGVfY29uZmlnLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdtb2RhbF9jaGVja19wYXNzd29yZF91cGRhdGVfY29uZmlnJywKICAgICAgICAgICAgc2l6ZTogJ2wnLAogICAgICAgICAgICByZXNvbHZlOiB7CiAgICAgICAgICAgICAgbmV3X3VzZXJfcHJvZXJ0aWVzOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuICRzY29wZS51c2VyUHJvcGVydGllc1swXTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgbW9kYWxJbnN0YW5jZS5yZXN1bHQudGhlbihmdW5jdGlvbihyZXN1bHQpIHsKICAgICAgICAgICAgbG9nRGVidWcoJ21vZGFsX2NoZWNrX3Bhc3N3b3JkX3VwZGF0ZV9jb25maWcgTW9kYWwgZmluaXNoZWQgcmVzdWx0OiAnICsgcmVzdWx0KTsKICAgICAgICAgICAgJHNjb3BlLmFqYXhfaW5mbz0i15TXqdeZ16DXldeZ15nXnSDXoNep157XqNeVINeR15TXptec15fXlCEiOwogICAgICAgICAgICAkc2NvcGUuaW5UaGVNaWRkbGVPZlNhdmU9ZmFsc2U7CiAgICAgICAgICAgIGdldExvZ2dlZFVzZXJJbmZvKCRodHRwLCRzY29wZSwndXNlclByb3BlcnRpZXMnLGdldExvZ2dlZFVzZXJJbmZvX3N1Y2Nlc3MsZ2V0TG9nZ2VkVXNlckluZm9fZmFpbHVyZSk7CiAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICRzY29wZS5hamF4X2luZm89bnVsbDsKICAgICAgICAgICAgfSwgMzAwMCk7CiAgICAgICAgfSwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICRzY29wZS5pblRoZU1pZGRsZU9mU2F2ZT1mYWxzZTsKICAgICAgICAgICAgbG9nRGVidWcoJ21vZGFsX2NoZWNrX3Bhc3N3b3JkX3VwZGF0ZV9jb25maWcgTW9kYWwgZGlzbWlzc2VkIGF0OiAnICsgbmV3IERhdGUoKSk7CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGlzTmV3UGhvbmVVc2VkX2ZhaWx1cmUocmVzcG9uc2UpCiAgICAgIHsKICAgICAgICAkc2NvcGUuYWpheF9pbmZvPXJlc3BvbnNlLm1lc3NhZ2U7CiAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKQogICAgICAgIHsKICAgICAgICAgICRzY29wZS5hamF4X2luZm89bnVsbDsKICAgICAgICB9LCAyMDAwKTsKICAgICAgfQogICAgfQogIH07Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignbW9kYWxfY2hlY2tfcGFzc3dvcmRfdXBkYXRlX2NvbmZpZycsIGZ1bmN0aW9uKCRzY29wZSwgJHRpbWVvdXQsICR1aWJNb2RhbEluc3RhbmNlLCBuZXdfdXNlcl9wcm9lcnRpZXMsICRodHRwKQp7CiAgJHNjb3BlLm5ld191c2VyX3Byb2VydGllcz1uZXdfdXNlcl9wcm9lcnRpZXM7CiAgbG9nRGVidWcoIm1vZGFsX2NoZWNrX3Bhc3N3b3JkX3VwZGF0ZV9jb25maWcgY29udHJvbGxlciIpOwogIC8vICRzY29wZS5waG9uZV92ZXJpZmljYXRpb24gPSB7fTsgLy8gdGhlc2UgYXJlIHRoZSBjb21wbGV0ZSBkZXRhaWxzIGZvciB0aGUgbmV3IGV2ZW50IC8vCiAgLy8gJHNjb3BlLnBob25lX3ZlcmlmaWNhdGlvbi5waG9uZV9udW1iZXI9bmV3X3VzZXJfcHJvZXJ0aWVzLnBob25lX251bWJlcjsKICAkc2NvcGUuY2xvc2UgPSBmdW5jdGlvbigpIHsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJ2Rpc21pc3MnKTsKICB9OwoKICAkc2NvcGUuY2hhbmdlUGhvbmVOdW1iZXIgPSBmdW5jdGlvbigpCiAgewogICAgY2hhbmdlVXNlckRldGFpbHNWZXJpZnkoJGh0dHAsJHNjb3BlLCRzY29wZS5uZXdfdXNlcl9wcm9lcnRpZXMucGhvbmVfbnVtYmVyLCRzY29wZS5uZXdfdXNlcl9wcm9lcnRpZXMuZmlyc3RfbmFtZSwkc2NvcGUubmV3X3VzZXJfcHJvZXJ0aWVzLmxhc3RfbmFtZSwgJHNjb3BlLm5ld191c2VyX3Byb2VydGllcy5lbWFpbF9hZGRyZXNzLCRzY29wZS52ZXJpZnlfdXNlcl9wYXNzd29yZCwkc2NvcGUucGhvbmVfdmVyaWZpY2F0aW9uLGNoYW5nZVVzZXJEZXRhaWxzVmVyaWZ5X3N1Y2Nlc3MsIGNoYW5nZVVzZXJEZXRhaWxzVmVyaWZ5X2ZhaWx1cmUsZmFsc2UpOwogICAgZnVuY3Rpb24gY2hhbmdlVXNlckRldGFpbHNWZXJpZnlfc3VjY2VzcygpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJjaGFuZ2VVc2VyRGV0YWlsc1ZlcmlmeV9zdWNjZXNzIik7CiAgICAgIC8vIGFsZXJ0KCfXlNep15nXoNeV15nXmdedINei15XXk9eb16DXlSDXkdeU16bXnNeX15QnKTsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UodHJ1ZSk7CiAgICB9CiAgICBmdW5jdGlvbiBjaGFuZ2VVc2VyRGV0YWlsc1ZlcmlmeV9mYWlsdXJlKHJlc3BvbnNlKQogICAgewogICAgICBsb2dEZWJ1ZygiY2hhbmdlVXNlckRldGFpbHNWZXJpZnlfZmFpbHVyZSAiK3Jlc3BvbnNlLm1lc3NhZ2UpOwogICAgICAkc2NvcGUuYWpheF9lcnJvcj1yZXNwb25zZS5tZXNzYWdlKyIuIjsKICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKQogICAgICB7CiAgICAgICAgJHNjb3BlLmFqYXhfZXJyb3I9bnVsbDsKICAgICAgfSwgNDAwMCk7CiAgICB9CiAgfQp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ21vZGFsX2NoYW5nZV9wYXNzd29yZCcsIGZ1bmN0aW9uKCRzY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsIHVzZXJfcGhvbmVfbnVtYmVyLCAkaHR0cCkKewogIGxvZ0RlYnVnKCJtb2RhbF9jaGFuZ2VfcGFzc3dvcmQgY29udHJvbGxlciIpOwogICRzY29wZS5waG9uZV92ZXJpZmljYXRpb24gPSB7fTsgLy8gdGhlc2UgYXJlIHRoZSBjb21wbGV0ZSBkZXRhaWxzIGZvciB0aGUgbmV3IGV2ZW50IC8vCiAgJHNjb3BlLnBob25lX3ZlcmlmaWNhdGlvbi5waG9uZV9udW1iZXI9dXNlcl9waG9uZV9udW1iZXI7CiAgJHNjb3BlLnBob25lX3ZlcmlmaWNhdGlvbi5zbXNfZXJyb3I9IiI7CiAgJHNjb3BlLmNsb3NlID0gZnVuY3Rpb24oKSB7CiAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCdkaXNtaXNzJyk7CiAgfTsKCiAgJHNjb3BlLmNoYW5nZVBhc3N3b3JkID0gZnVuY3Rpb24oKQogIHsKICAgIGNoYW5nZVBhc3N3b3JkKCRodHRwLCRzY29wZSwkc2NvcGUucGhvbmVfdmVyaWZpY2F0aW9uLnVzZXJfcGFzc3dvcmQsJHNjb3BlLnBob25lX3ZlcmlmaWNhdGlvbi51c2VyX3Bhc3N3b3JkMiwkc2NvcGUucGhvbmVfdmVyaWZpY2F0aW9uLnZlcmlmaWNhdGlvbl9jb2RlLCBjaGFuZ2VQYXNzd29yZF9zdWNjZXNzLCBjaGFuZ2VQYXNzd29yZF9mYWlsdXJlLGZhbHNlKTsKICAgICRzY29wZS5hamF4X2Vycm9yPSIiOwogICAgZnVuY3Rpb24gY2hhbmdlUGFzc3dvcmRfc3VjY2VzcygpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJjaGFuZ2VQYXNzd29yZF9zdWNjZXNzIik7CiAgICAgIHN0YXR1cz0iZmZmZmYiOwogICAgICAvLyBhbGVydCgn15TXodeZ16HXnteQINei15XXk9eb16DXlCDXkdeU16bXnNeX15QnKTsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UodHJ1ZSk7CiAgICB9CiAgICBmdW5jdGlvbiBjaGFuZ2VQYXNzd29yZF9mYWlsdXJlKHJlc3BvbnNlKQogICAgewogICAgICBsb2dEZWJ1ZygiY2hhbmdlUGFzc3dvcmRfZmFpbHVyZSAiK3Jlc3BvbnNlLm1lc3NhZ2UpOwogICAgICAkc2NvcGUuYWpheF9lcnJvcj1yZXNwb25zZS5tZXNzYWdlOwogICAgfQogIH0KfSk7CgprdXplQXBwLmZhY3RvcnkoJ0J1c2luZXNzQ29uZmlnJywgZnVuY3Rpb24oJGh0dHApIHsKICAgIHJldHVybiB7CiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBsb2dEZWJ1ZygibG9hZCBnZXRfYnVzaW5lc3NfY29uZmlnIik7CiAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KCIvYXBpL2FkbWluL2J1c2luZXNzX2NvbmZpZyIpCiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgcmVzdWx0ID0gcmVzcG9uc2UuZGF0YVswXTsKICAgICAgICAgICAgICByZXN1bHQudXNlX2hvbGlkYXlzPSEhcGFyc2VJbnQocmVzcG9uc2UuZGF0YVswXS51c2VfaG9saWRheXMpOwogICAgICAgICAgICAgIHJlc3VsdC5zbXNfbm90aWZpY2F0aW9ucz0hIXBhcnNlSW50KHJlc3BvbnNlLmRhdGFbMF0uc21zX25vdGlmaWNhdGlvbnMpOwogICAgICAgICAgICAgIHJlc3VsdC5zdGFydF9pbnZvaWNlX251bWJlciA9IHBhcnNlSW50KHJlc3BvbnNlLmRhdGFbMF0uc3RhcnRfaW52b2ljZV9udW1iZXIpOwogICAgICAgICAgICAgIHZhciBkID0gbmV3IERhdGUoKTsKICAgICAgICAgICAgICBkLnNldEhvdXJzKCByZXN1bHQuY2FsZW5kYXJfZGlzcGxheV9zdGFydF9ob3VycyApOwogICAgICAgICAgICAgIGQuc2V0TWludXRlcyggcmVzdWx0LmNhbGVuZGFyX2Rpc3BsYXlfc3RhcnRfbWludXRlcyApOwogICAgICAgICAgICAgIHJlc3VsdC5teXRpbWUgPSBkOwogICAgICAgICAgICAgIHJlc3VsdC5jYWxlbmRhcl9kaXNwbGF5X3N0YXJ0ID0gZDsKICAgICAgICAgICAgICB2YXIgZCA9IG5ldyBEYXRlKCk7CiAgICAgICAgICAgICAgZC5zZXRIb3VycyggcmVzdWx0LmNhbGVuZGFyX2Rpc3BsYXlfZW5kX2hvdXJzICk7CiAgICAgICAgICAgICAgZC5zZXRNaW51dGVzKCByZXN1bHQuY2FsZW5kYXJfZGlzcGxheV9lbmRfbWludXRlcyApOwogICAgICAgICAgICAgIHJlc3VsdC5teXRpbWUgPSBkOwogICAgICAgICAgICAgIHJlc3VsdC5jYWxlbmRhcl9kaXNwbGF5X2VuZCA9IGQ7CiAgICAgICAgICAgICAgcmVzdWx0LnZhdF9yYXRlID0gTnVtYmVyKHJlc3VsdC52YXRfcmF0ZSk7CiAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH07Cn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdDb25maWdCdXNpbmVzc0NvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkdGltZW91dCwgQnVzaW5lc3NDb25maWcpCnsKICBsb2dEZWJ1ZygibXkgYnVzaW5lc3MgY29uZmlnIik7CiAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXM9W107CgogIGZ1bmN0aW9uIGdldF9idXNpbmVzc19jb25maWcoKSB7CiAgICBsb2dEZWJ1ZygiZ2V0X2J1c2luZXNzX2NvbmZpZyIpOwogICAgbG9nRGVidWcoIkJ1c2luZXNzQ29uZmlnOiAiLCBCdXNpbmVzc0NvbmZpZyk7CiAgICBCdXNpbmVzc0NvbmZpZy5nZXQoKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsgJHNjb3BlLmJ1c2luZXNzUHJvcGVydGllcyA9IHJlc3VsdDsgfSk7CiAgfQogIGdldF9idXNpbmVzc19jb25maWcoKTsKCgogICRzY29wZS5oc3RlcCA9IDE7CiAgJHNjb3BlLm1zdGVwID0gMTU7CgogICAgJHNjb3BlLmJ1c2luZXNzQ29uZmlnQ2FuY2VsID0gZnVuY3Rpb24oKSB7CiAgICAgIHdpbmRvdy5oaXN0b3J5LmJhY2soKTsKICAgIH07CgogICAgJHNjb3BlLnVwZGF0ZUJ1c2luZXNzQ29uZmlnID0gZnVuY3Rpb24oKSB7CiAgICAgICAgbG9nRGVidWcoInVwZGF0aW5nIGJ1c2luZXNzIGNvbmZpZyIgKyBKU09OLnN0cmluZ2lmeSgkc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzKSk7CgogICAgICAgICRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXNfYWpheF9lcnJvcj0iIjsKICAgICAgICAkc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzLmNhbGVuZGFyX2Rpc3BsYXlfc3RhcnRfaG91cnM9JHNjb3BlLmJ1c2luZXNzUHJvcGVydGllcy5jYWxlbmRhcl9kaXNwbGF5X3N0YXJ0LmdldEhvdXJzKCk7CiAgICAgICAgJHNjb3BlLmJ1c2luZXNzUHJvcGVydGllcy5jYWxlbmRhcl9kaXNwbGF5X3N0YXJ0X21pbnV0ZXM9JHNjb3BlLmJ1c2luZXNzUHJvcGVydGllcy5jYWxlbmRhcl9kaXNwbGF5X3N0YXJ0LmdldE1pbnV0ZXMoKTsKICAgICAgICAkc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzLmNhbGVuZGFyX2Rpc3BsYXlfZW5kX2hvdXJzPSRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMuY2FsZW5kYXJfZGlzcGxheV9lbmQuZ2V0SG91cnMoKTsKICAgICAgICAkc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzLmNhbGVuZGFyX2Rpc3BsYXlfZW5kX21pbnV0ZXM9JHNjb3BlLmJ1c2luZXNzUHJvcGVydGllcy5jYWxlbmRhcl9kaXNwbGF5X2VuZC5nZXRNaW51dGVzKCk7CiAgICAgICAgaWYgKCRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMuY2FsZW5kYXJfZGlzcGxheV9zdGFydF9ob3Vycz4kc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzLmNhbGVuZGFyX2Rpc3BsYXlfZW5kX2hvdXJzKQogICAgICAgIHsKICAgICAgICAgIGFsZXJ0KCfXltee158g16HXmdeV150g15zXkCDXmdeb15XXnCDXnNeU15nXldeqINec16TXoNeZINeW157XnyDXlNeq15fXnNeUJyk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgICRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXNfYWpheF9lcnJvcj0i157XoteT15vXnyDXoNeq15XXoNeZ150uLi4iOwoKICAgICAgICAkaHR0cCh7CiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLAogICAgICAgICAgICB1cmw6ICcvYXBpL2FkbWluL2J1c2luZXNzX2NvbmZpZy9zZXQnLAogICAgICAgICAgICBkYXRhOiAkc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzLCAvLyBwYXNzIGluIGRhdGEgYXMgc3RyaW5ncwogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb247Y2hhcnNldD11dGYtOCcKICAgICAgICAgICAgfQogICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkgewoKICAgICAgICAgICAgbG9nRGVidWcoZGF0YSk7CiAgICAgICAgICAgIGlmICghZGF0YS5zdWNjZXNzKSB7CiAgICAgICAgICAgICAgICBsb2dEZWJ1ZygiZXJyb3IgIiArIGRhdGEuTWVzc2FnZSk7CiAgICAgICAgICAgICAgICAkc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzX2FqYXhfZXJyb3IgPSBkYXRhLk1lc3NhZ2U7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkZ0NhbGVuZGFyRGlzcGxheU1pblRpbWU9ZGF0YS5qc29uLm5ld1N0YXJ0VGltZTsKICAgICAgICAgICAgICAgICRnQ2FsZW5kYXJEaXNwbGF5TWF4VGltZT1kYXRhLmpzb24ubmV3RW5kVGltZTsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJ1cGRhdGVkIGdDYWxlbmRhckRpc3BsYXlNaW5UaW1lPSIrJGdDYWxlbmRhckRpc3BsYXlNaW5UaW1lKTsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJ1cGRhdGVkIGdDYWxlbmRhckRpc3BsYXlNYXhUaW1lPSIrJGdDYWxlbmRhckRpc3BsYXlNYXhUaW1lKTsKICAgICAgICAgICAgICAgICRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXNfYWpheF9lcnJvcj0i16LXldeT15vXnyDXkdeU16bXnNeX15QhIjsKICAgICAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgJHNjb3BlLmJ1c2luZXNzUHJvcGVydGllc19hamF4X2Vycm9yPW51bGw7CiAgICAgICAgICAgICAgICB9LCAyMDAwKTsKICAgICAgICAgICAgICAgIGdldF9idXNpbmVzc19jb25maWcoKTsKICAgICAgICAgICAgICAgIC8vIHdpbmRvdy5oaXN0b3J5LmJhY2soKTsKICAgICAgICAgICAgICAgIC8vICRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXNfYWpheF9lcnJvciA9ICLXpNeo15jXmSDXlNei16HXpyDXoNep157XqNeVINeR15TXptec15fXlC4iOwoKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfTsKfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdjbGllbnRDYXJkQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSkgewogICAgbG9nRGVidWcoImNsaWVudENhcmRDb250cm9sbGVyIik7CiAgICAkc2NvcGUuZnV0dXJlTWVldGluZ3MgPSBbewogICAgICAgIGRhdGV0aW1lOiAi16jXkNep15XXnywgMjUuMS4yMDE2IiwKICAgICAgICBob3VyOiAiMTQ6MDAiLAogICAgICAgIHR5cGU6ICLXp9eR15XXpteUIiwKICAgICAgICBwcmljZTogIjEwMCIsCiAgICAgICAgbGFiZWxzOiBbewogICAgICAgICAgICBsYWJlbDogInN1Y2Nlc3MiLAogICAgICAgICAgICB0ZXh0OiAi16nXldec150iCiAgICAgICAgfSwgewogICAgICAgICAgICBsYWJlbDogIndhcm5pbmciLAogICAgICAgICAgICB0ZXh0OiAi15zXkCDXqteV16LXkyIKICAgICAgICB9XQogICAgfSwgewogICAgICAgIGRhdGV0aW1lOiAi16jXkNep15XXnywgMjUuMS4yMDE2IiwKICAgICAgICBob3VyOiAiMTQ6MDAiLAogICAgICAgIHR5cGU6ICLXp9eR15XXpteUIiwKICAgICAgICBwcmljZTogIjEwMCIsCiAgICAgICAgbGFiZWxzOiBbewogICAgICAgICAgICBsYWJlbDogImRhbmdlciIsCiAgICAgICAgICAgIHRleHQ6ICLXnNeQINep15XXnNedIgogICAgICAgIH0sIHsKICAgICAgICAgICAgbGFiZWw6ICJpbmZvIiwKICAgICAgICAgICAgdGV4dDogIteq15XXoteTIgogICAgICAgIH1dCiAgICB9LCB7CiAgICAgICAgZGF0ZXRpbWU6ICLXqdec15nXqdeZLCAyNS4xLjIwMTYiLAogICAgICAgIGhvdXI6ICIxNDowMCIsCiAgICAgICAgdHlwZTogIten15HXldem15QiLAogICAgICAgIHByaWNlOiAiMTAwIiwKICAgICAgICBsYWJlbHM6IFt7CiAgICAgICAgICAgIGxhYmVsOiAiZGFuZ2VyIiwKICAgICAgICAgICAgdGV4dDogItec15Ag16nXldec150iCiAgICAgICAgfSwgewogICAgICAgICAgICBsYWJlbDogImluZm8iLAogICAgICAgICAgICB0ZXh0OiAi16rXldei15MiCiAgICAgICAgfV0KICAgIH0sIHsKICAgICAgICBkYXRldGltZTogIteo15DXqdeV158sIDI1LjEuMjAxNiIsCiAgICAgICAgaG91cjogIjE0OjAwIiwKICAgICAgICB0eXBlOiAi16fXkdeV16bXlCIsCiAgICAgICAgcHJpY2U6ICIxMDAiCiAgICB9LCBdCgogICAgJHNjb3BlLmhpc3RvcnlNZWV0aW5ncyA9IFt7CiAgICAgICAgZGF0ZXRpbWU6ICLXqNeQ16nXldefLCAyNS4xLjIwMTYiLAogICAgICAgIGhvdXI6ICIxNDowMCIsCiAgICAgICAgdHlwZTogIten15HXldem15QiLAogICAgICAgIHByaWNlOiAiMTAwIgogICAgfSwgewogICAgICAgIGRhdGV0aW1lOiAi16jXkNep15XXnywgMjUuMS4yMDE2IiwKICAgICAgICBob3VyOiAiMTQ6MDAiLAogICAgICAgIHR5cGU6ICLXp9eR15XXpteUIiwKICAgICAgICBwcmljZTogIjEwMCIKICAgIH0sIHsKICAgICAgICBkYXRldGltZTogItep15zXmdep15ksIDI1LjEuMjAxNiIsCiAgICAgICAgaG91cjogIjE0OjAwIiwKICAgICAgICB0eXBlOiAi16fXkdeV16bXlCIsCiAgICAgICAgcHJpY2U6ICIxMDAiCiAgICB9LCB7CiAgICAgICAgZGF0ZXRpbWU6ICLXqNeQ16nXldefLCAyNS4xLjIwMTYiLAogICAgICAgIGhvdXI6ICIxNDowMCIsCiAgICAgICAgdHlwZTogIten15HXldem15QiLAogICAgICAgIHByaWNlOiAiMTAwIgogICAgfSwgXQoKICAgICRzY29wZS5jY1BheW1lbnRzID0gW3sKICAgICAgICBkYXRldGltZTogIteo15DXqdeV158sIDI1LjEuMjAxNiIsCiAgICAgICAgcmVjaXB0X251bTogIjc2NyIsCiAgICAgICAgYW1vdW50OiAiMzAwIiwKICAgICAgICBsYWJlbHM6IFt7CiAgICAgICAgICAgIGxhYmVsOiAiZGFuZ2VyIiwKICAgICAgICAgICAgdGV4dDogItec15Ag16nXldeZ15nXmiIKICAgICAgICB9LCB7CiAgICAgICAgICAgIGxhYmVsOiAiaW5mbyIsCiAgICAgICAgICAgIHRleHQ6ICLXlNeV16TXp9eTIgogICAgICAgIH1dCiAgICB9LCBdCgoKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2t1emVDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uKSB7CgogICAgLy8gbWFpbiBrdXplIGNvbnRyb2xsZXIKCiAgICAvLyBNVVNUIFNFVCBMQU5HVUFHRSBCRUZPUkUgQU5ZIE9USEVSIE9QRVJBVElPTiAhISEKICAgIHVwZGF0ZUdsb2JhbExhbmd1YWdlKCRzY29wZSwgJGdEZWZhdWx0TGFuZyk7CiAgICAvLyBNVVNUIFNFVCBMQU5HVUFHRSBCRUZPUkUgQU5ZIE9USEVSIE9QRVJBVElPTiAhISEKCiAgICAvLyBsb2dEZWJ1ZygieHh4eHh4eHgiICsgJHNjb3BlLmxhbmdmaWxlWydzaG93X2FsbF9jbGllbnRzJ10pOwoKICAgICRzY29wZS5zaG93Q2xpZW50c0NvbHVtbnMgPSBbewogICAgICAgIGZpZWxkOiAndXNlcl9pZCcsCiAgICAgICAgbmFtZTogJHNjb3BlLmxhbmdmaWxlWydzaG93X2FsbF9jbGllbnRzX3VzZXJpZCddCiAgICB9LCB7CiAgICAgICAgZmllbGQ6ICdidXNlcl9maXJzdF9uYW1lJywKICAgICAgICBuYW1lOiAkc2NvcGUubGFuZ2ZpbGVbJ3Nob3dfYWxsX2NsaWVudHNfZmlyc3RfbmFtZSddCiAgICB9LCB7CiAgICAgICAgZmllbGQ6ICdidXNlcl9sYXN0X25hbWUnLAogICAgICAgIG5hbWU6ICRzY29wZS5sYW5nZmlsZVsnc2hvd19hbGxfY2xpZW50c19sYXN0X25hbWUnXQogICAgfSwgewogICAgICAgIGZpZWxkOiAncm9sZV9uYW1lJywKICAgICAgICBuYW1lOiAkc2NvcGUubGFuZ2ZpbGVbJ3Nob3dfYWxsX2NsaWVudHNfYXBwcm92ZWQnXQogICAgfV07CgoKICAgICRzY29wZS5ncmlkQ2xpZW50Q2xpY2sgPSBmdW5jdGlvbihyb3cpIHsKICAgICAgICAvL2xvZ0RlYnVnKHJvdyk7CiAgICAgICAgdmFyIHJvd191c2VyaWQgPSByb3cuZW50aXR5LnVzZXJfaWQ7CiAgICAgICAgbG9nRGVidWcoInNlbGVjdGVkIHJvdyB1c2VyX2lkID0iICsgcm93X3VzZXJpZCk7CiAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jbGllbnRzLycgKyByb3dfdXNlcmlkKTsKICAgIH07CgogICAgJHNjb3BlLnNob3dDbGllbnRzR3JpZE9wdGlvbnMgPSB7CiAgICAgICAgZW5hYmxlRmlsdGVyaW5nOiBmYWxzZSwKICAgICAgICBlbmFibGVTb3J0aW5nOiB0cnVlLAogICAgICAgIGNvbHVtbkRlZnM6ICRzY29wZS5zaG93Q2xpZW50c0NvbHVtbnMsCiAgICAgICAgcm93VGVtcGxhdGU6ICcvcHVibGljL2NvbXBvbmVudHMvY2xpZW50cy1ncmlkLXJvdy5odG1sJywKICAgICAgICBvblJlZ2lzdGVyQXBpOiBmdW5jdGlvbihncmlkQXBpKSB7CiAgICAgICAgICAgICRzY29wZS5ncmlkQXBpID0gZ3JpZEFwaTsKICAgICAgICAgICAgJHNjb3BlLmdyaWRBcGkuZ3JpZC5yZWdpc3RlclJvd3NQcm9jZXNzb3IoJHNjb3BlLnNpbmdsZUZpbHRlciwgMjAwKTsKICAgICAgICB9LAogICAgfTsKCiAgICAkc2NvcGUuaXNBY3RpdmUgPSBmdW5jdGlvbih2aWV3TG9jYXRpb24pIHsKICAgICAgICBsb2dEZWJ1Zygidmlld0xvY2F0aW9uID0gIiArIHZpZXdMb2NhdGlvbik7CiAgICAgICAgdmFyIGFjdGl2ZSA9ICh2aWV3TG9jYXRpb24gPT09ICRsb2NhdGlvbi5wYXRoKCkpOwogICAgICAgIHJldHVybiBhY3RpdmU7CiAgICB9OwoKICAgICRzY29wZS5maWx0ZXIgPSBmdW5jdGlvbigpIHsKICAgICAgICBsb2dEZWJ1Zygic2luZ2xlIGZpbHRlciIpOwogICAgICAgICRzY29wZS5ncmlkQXBpLmdyaWQucmVmcmVzaCgpOwogICAgICAgIGlmICgkc2NvcGUuZmlsdGVyLlZhbHVlICE9ICIiKSB7CiAgICAgICAgICAgICRzY29wZS5maWx0ZXIuYnV0dG9uVmFsdWUgPSAiJyIgKyAkc2NvcGUuZmlsdGVyLlZhbHVlICsgIiciOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICRzY29wZS5maWx0ZXIuYnV0dG9uVmFsdWUgPSAiIjsKICAgICAgICB9CiAgICB9OwoKICAgICRzY29wZS5zaW5nbGVGaWx0ZXIgPSBmdW5jdGlvbihyZW5kZXJhYmxlUm93cykgewogICAgICAgIHZhciBtYXRjaGVyID0gbmV3IFJlZ0V4cCgkc2NvcGUuZmlsdGVyLlZhbHVlKTsKICAgICAgICBsb2dEZWJ1Zygic2NvcGU9IiArICRzY29wZSk7CiAgICAgICAgbG9nRGVidWcoInNjb3BlLmZpbHRlci5WYWx1ZT0iICsgJHNjb3BlLmZpbHRlci5WYWx1ZSk7CiAgICAgICAgaWYgKCgkc2NvcGUuZmlsdGVyLlZhbHVlID09IG51bGwpIHx8ICgkc2NvcGUuZmlsdGVyLlZhbHVlID09ICIiKSkgewogICAgICAgICAgICBsb2dEZWJ1ZygiZW1wdHkgZmlsdGVyIik7CiAgICAgICAgICAgIHJldHVybiByZW5kZXJhYmxlUm93czsKICAgICAgICB9CiAgICAgICAgcmVuZGVyYWJsZVJvd3MuZm9yRWFjaChmdW5jdGlvbihyb3cpIHsKICAgICAgICAgICAgLy8JCQlsb2dEZWJ1Zygicm93PSIrcm93KTsKICAgICAgICAgICAgcm93LnZpc2libGUgPSBmYWxzZTsKICAgICAgICAgICAgdmFyICRjdXJyRmlyc3ROYW1lID0gcm93LmVudGl0eVsnZmlyc3RfbmFtZSddOwogICAgICAgICAgICB2YXIgJGN1cnJMYXN0TmFtZSA9IHJvdy5lbnRpdHlbJ2xhc3RfbmFtZSddOwogICAgICAgICAgICBsb2dEZWJ1ZygiY3VyckZpcnN0TmFtZT0iICsgJGN1cnJGaXJzdE5hbWUpOwoKICAgICAgICAgICAgaWYgKCRjdXJyRmlyc3ROYW1lICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmICgkY3VyckZpcnN0TmFtZS5pbmRleE9mKCRzY29wZS5maWx0ZXIuVmFsdWUpID4gLTEpIHsKICAgICAgICAgICAgICAgICAgICByb3cudmlzaWJsZSA9IHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSAvLyByb3cgaXMgbnVsbAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICByb3cudmlzaWJsZSA9IGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoJGN1cnJMYXN0TmFtZSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoJGN1cnJMYXN0TmFtZS5pbmRleE9mKCRzY29wZS5maWx0ZXIuVmFsdWUpID4gLTEpIHsKICAgICAgICAgICAgICAgICAgICByb3cudmlzaWJsZSA9IHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSAvLyByb3cgaXMgbnVsbAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICByb3cudmlzaWJsZSA9IGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIHJlbmRlcmFibGVSb3dzOwogICAgfTsKCiAgICAvLyBpbXBvcnRhbnQhISBpbml0aWFsaXppbmcgYW5ndWxhciBmb3JtcyBhcyBhcnJheXMKICAgICRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhciA9IHt9OwogICAgJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyID0ge307CgogICAgLy8gbG9nRGVidWcoImxvY2F0aW9uPSIgKyAkbG9jYXRpb24pOwogICAgLy8gbG9nRGVidWcoJGxvY2F0aW9uKTsKCiAgICAkc2NvcGUuY2hhbmdlTGFuZyA9IGZ1bmN0aW9uKCRuZXdsYW5nKSB7CiAgICAgICAgbG9nRGVidWcoJG5ld2xhbmcpOwogICAgICAgIC8vJHNjb3BlLnNwQ2xhc3MgPSAncmlnaHQnOwogICAgICAgIHVwZGF0ZUdsb2JhbExhbmd1YWdlKCRzY29wZSwgJG5ld2xhbmcpCiAgICB9CgogICAgJHNjb3BlLmFkZE5ld0NsaWVudCA9IGZ1bmN0aW9uKCkgewogICAgICAgICRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfY2xpZW50cy9hZGQnKTsKICAgIH0KICAgICRzY29wZS5hZGROZXdJbnN0cnVjdG9yID0gZnVuY3Rpb24oKSB7CiAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19pbnN0cnVjdG9ycy9hZGQnKTsKICAgIH0KfSk7CgovLy8vLy8gYmVmb3JlIGZvcm1zCmt1emVBcHAuY29udHJvbGxlcignRGVtb0NvbnRyb2xsZXInLCBbCiAgICAnJHNjb3BlJywgJyRidWlsZGVyJywgJyR2YWxpZGF0b3InLAogICAgZnVuY3Rpb24oJHNjb3BlLCAkYnVpbGRlciwgJHZhbGlkYXRvcikgewogICAgICAgIHZhciBjaGVja2JveCwgdGV4dGJveDsKICAgICAgICB0ZXh0Ym94ID0gJGJ1aWxkZXIuYWRkRm9ybU9iamVjdCgnZGVmYXVsdCcsIHsKICAgICAgICAgICAgaWQ6ICd0ZXh0Ym94JywKICAgICAgICAgICAgY29tcG9uZW50OiAndGV4dElucHV0JywKICAgICAgICAgICAgbGFiZWw6ICdOYW1lJywKICAgICAgICAgICAgZGVzY3JpcHRpb246ICdZb3VyIG5hbWUnLAogICAgICAgICAgICBwbGFjZWhvbGRlcjogJ1lvdXIgbmFtZScsCiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgICAgICBlZGl0YWJsZTogZmFsc2UKICAgICAgICB9KTsKICAgICAgICBjaGVja2JveCA9ICRidWlsZGVyLmFkZEZvcm1PYmplY3QoJ2RlZmF1bHQnLCB7CiAgICAgICAgICAgIGlkOiAnY2hlY2tib3gnLAogICAgICAgICAgICBjb21wb25lbnQ6ICdjaGVja2JveCcsCiAgICAgICAgICAgIGxhYmVsOiAnUGV0cycsCiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnRG8geW91IGhhdmUgYW55IHBldHM/JywKICAgICAgICAgICAgb3B0aW9uczogWydEb2cnLCAnQ2F0J10KICAgICAgICB9KTsKICAgICAgICAkYnVpbGRlci5hZGRGb3JtT2JqZWN0KCdkZWZhdWx0JywgewogICAgICAgICAgICBjb21wb25lbnQ6ICdzYW1wbGVJbnB1dCcKICAgICAgICB9KTsKICAgICAgICAkc2NvcGUuZm9ybSA9ICRidWlsZGVyLmZvcm1zWydkZWZhdWx0J107CiAgICAgICAgJHNjb3BlLmlucHV0ID0gW107CiAgICAgICAgJHNjb3BlLmRlZmF1bHRWYWx1ZSA9IHt9OwogICAgICAgICRzY29wZS5kZWZhdWx0VmFsdWVbdGV4dGJveC5pZF0gPSAnZGVmYXVsdCB2YWx1ZSc7CiAgICAgICAgJHNjb3BlLmRlZmF1bHRWYWx1ZVtjaGVja2JveC5pZF0gPSBbdHJ1ZSwgdHJ1ZV07CiAgICAgICAgcmV0dXJuICRzY29wZS5zdWJtaXQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuICR2YWxpZGF0b3IudmFsaWRhdGUoJHNjb3BlLCAnZGVmYXVsdCcpLnN1Y2Nlc3MoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbG9nRGVidWcoJ3N1Y2Nlc3MnKTsKICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbG9nRGVidWcoJ2Vycm9yJyk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH07CiAgICB9Cl0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdBbGVydERlbW9DdHJsJywgZnVuY3Rpb24oJHNjb3BlKSB7CiAgICAkc2NvcGUuYWxlcnRzID0gW3sKICAgICAgICB0eXBlOiAnZGFuZ2VyJywKICAgICAgICBtc2c6ICdPaCBzbmFwISBDaGFuZ2UgYSBmZXcgdGhpbmdzIHVwIGFuZCB0cnkgc3VibWl0dGluZyBhZ2Fpbi4nCiAgICB9LCB7CiAgICAgICAgdHlwZTogJ3N1Y2Nlc3MnLAogICAgICAgIG1zZzogJ1dlbGwgZG9uZSEgWW91IHN1Y2Nlc3NmdWxseSByZWFkIHRoaXMgaW1wb3J0YW50IGFsZXJ0IG1lc3NhZ2UuJwogICAgfV07CgogICAgJHNjb3BlLmFkZEFsZXJ0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgJHNjb3BlLmFsZXJ0cy5wdXNoKHsKICAgICAgICAgICAgbXNnOiAnQW5vdGhlciBhbGVydCEnCiAgICAgICAgfSk7CiAgICB9OwoKICAgICRzY29wZS5jbG9zZUFsZXJ0ID0gZnVuY3Rpb24oaW5kZXgpIHsKICAgICAgICAkc2NvcGUuYWxlcnRzLnNwbGljZShpbmRleCwgMSk7CiAgICB9Owp9KTsKCgpmdW5jdGlvbiBpc051bWJlcktleShldnQpewogICAgdmFyIGNoYXJDb2RlID0gKGV2dC53aGljaCkgPyBldnQud2hpY2ggOiBldmVudC5rZXlDb2RlOwogICAgcmV0dXJuICEoY2hhckNvZGUgPiAzMSAmJiAoY2hhckNvZGUgPCA0OCB8fCBjaGFyQ29kZSA+IDU3KSk7Cn0=</text>
      </register>
      <register name="8" type="2">
        <text encoding="base64">PD9waHAKcmVxdWlyZV9vbmNlKCRfU0VSVkVSWydET0NVTUVOVF9ST09UJ10uIi9rdXplX2xhbmcucGhwIik7Cj8+Cg==</text>
      </register>
      <register name="9" type="2">
        <text encoding="base64">Cg==</text>
      </register>
      <register name=":" type="4">
        <text encoding="base64">JzwsJz5zL3Jlc3VsdFwuYnVzaW5lc3NQcm9wZXJ0aWVzL3Jlc3VsdC9n</text>
      </register>
    </registers>
    <search>
      <last-search encoding="base64">XDxwYXltZW50TWV0aG9kc1w+</last-search>
      <last-offset />
      <last-pattern encoding="base64">XDxwYXltZW50TWV0aG9kc1w+</last-pattern>
      <last-replace>result</last-replace>
      <last-substitute>result\.businessProperties</last-substitute>
      <last-dir>1</last-dir>
      <show-last>false</show-last>
    </search>
    <history>
      <history-search>
        <entry encoding="base64">XDxzZXRQYXJ0aWNpcGF0aW9uU3RhdHVzXD4=</entry>
        <entry>select</entry>
        <entry>ng-change</entry>
        <entry>business</entry>
        <entry>setParticpatio</entry>
        <entry>setParticipation</entry>
        <entry>updateBusinessConfig</entry>
        <entry>business_config</entry>
        <entry>invoice</entry>
        <entry>updateBusiness</entry>
        <entry encoding="base64">XDxzZWxlY3RQYXltZW50TWV0aG9kXD4=</entry>
        <entry>get_business</entry>
        <entry>\$scope</entry>
        <entry>result\.businessProperties</entry>
        <entry encoding="base64">XDxrdXplQXBwXD4=</entry>
        <entry>admin</entry>
        <entry>admin\/users?\/payment</entry>
        <entry>payment</entry>
        <entry>admin\/users\/payment</entry>
        <entry encoding="base64">XDxwYXltZW50TWV0aG9kc1w+</entry>
      </history-search>
      <history-cmd>
        <entry>w</entry>
        <entry encoding="base64">JzwsJz5zL1xeL34v</entry>
        <entry>s</entry>
        <entry encoding="base64">JzwsJz5zL1wqLyoqL2c=</entry>
        <entry encoding="base64">JzwsJz5zL1wkc2NvcGUvcmVzdWx0L2c=</entry>
        <entry encoding="base64">JzwsJz5zL3Jlc3VsdFwuYnVzaW5lc3NQcm9wZXJ0aWVzL3Jlc3VsdC9n</entry>
      </history-cmd>
      <history-expr />
      <history-input />
    </history>
    <shortcut-conflicts>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed OPEN_BRACKET</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed V</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed F</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed U</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed S</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed N</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed P</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed W</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>shift ctrl pressed A</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed C</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed D</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed R</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed A</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed T</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed I</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed B</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed CLOSE_BRACKET</text>
      </shortcut-conflict>
    </shortcut-conflicts>
  </component>
</application>
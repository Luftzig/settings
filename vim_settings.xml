<application>
  <component name="VimSettings">
    <state version="4" enabled="true" />
    <globalmarks />
    <filemarks>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/Decoration.cs" timestamp="1498573346394">
        <mark key="'" line="71" column="19" />
        <mark key="[" line="26" column="41" />
        <mark key="]" line="26" column="41" />
        <mark key="^" line="26" column="41" />
        <mark key="." line="26" column="41" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/DataService/ShapeData.cs" timestamp="1498570609670">
        <mark key="'" line="50" column="4" />
        <mark key="[" line="9" column="40" />
        <mark key="]" line="11" column="23" />
        <mark key="." line="11" column="23" />
        <mark key="^" line="11" column="23" />
      </file>
      <file name="$USER_HOME$/Projects/mocha-given/index.d.ts" timestamp="1490284104781">
        <mark key="'" line="1" column="0" />
        <mark key="[" line="11" column="0" />
        <mark key="]" line="11" column="0" />
        <mark key="." line="11" column="0" />
        <mark key="^" line="1" column="11" />
      </file>
      <file name="/a.dummy" timestamp="1498741252881">
        <mark key="[" line="0" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/phpold/kuze_utils.php" timestamp="1497784331390">
        <mark key="'" line="59" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/CameraMovement.cs" timestamp="1497450852828">
        <mark key="'" line="193" column="4" />
      </file>
      <file name="$USER_HOME$/Projects/Guy Prives/Automator/server/api/updater/updater.helpers.ts" timestamp="1492791203674">
        <mark key="'" line="25" column="36" />
        <mark key="[" line="33" column="48" />
        <mark key="]" line="34" column="24" />
        <mark key="." line="34" column="24" />
        <mark key="^" line="34" column="24" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/UI/ExitToast.cs" timestamp="1497532567374">
        <mark key="'" line="40" column="0" />
        <mark key="[" line="2" column="0" />
        <mark key="]" line="2" column="0" />
        <mark key="." line="2" column="0" />
        <mark key="^" line="10" column="9" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/PieceGenerator.cs" timestamp="1498668509814">
        <mark key="'" line="0" column="0" />
        <mark key="[" line="43" column="0" />
        <mark key="]" line="43" column="0" />
        <mark key="." line="43" column="0" />
        <mark key="^" line="78" column="66" />
      </file>
      <file name="$APPLICATION_CONFIG_DIR$/scratches/scratch.json" timestamp="1492339698148">
        <mark key="'" line="21" column="0" />
        <mark key="[" line="2" column="14" />
        <mark key="]" line="2" column="13" />
        <mark key="." line="2" column="13" />
        <mark key="^" line="2" column="13" />
      </file>
      <file name="$APPLICATION_CONFIG_DIR$/scratches/scratch_3.json" timestamp="1492678325641">
        <mark key="'" line="4983" column="0" />
        <mark key="[" line="0" column="0" />
        <mark key="]" line="0" column="48708" />
        <mark key="^" line="0" column="48708" />
        <mark key="." line="0" column="48708" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/UI/GameEditor/SaveButton.cs" timestamp="1498572998507">
        <mark key="'" line="74" column="42" />
        <mark key="[" line="74" column="42" />
        <mark key="]" line="74" column="50" />
        <mark key="." line="74" column="50" />
        <mark key="^" line="74" column="50" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/PuzzlePiece.cs" timestamp="1497973981788">
        <mark key="'" line="70" column="42" />
        <mark key="[" line="199" column="8" />
        <mark key="]" line="199" column="42" />
        <mark key="." line="199" column="42" />
        <mark key="^" line="199" column="42" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/public/js/angular/kuze_business_utils-v11.js" timestamp="1498391567633">
        <mark key="'" line="833" column="9" />
        <mark key="[" line="642" column="22" />
        <mark key="]" line="642" column="22" />
        <mark key="^" line="642" column="22" />
        <mark key="." line="642" column="22" />
      </file>
      <file name="/kuze_config.php" timestamp="1499159276667">
        <mark key="[" line="11" column="0" />
        <mark key="]" line="11" column="69" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/angular/business_modal_client_payment.php" timestamp="1498395729099">
        <mark key="'" line="113" column="37" />
        <mark key="[" line="168" column="7" />
        <mark key="]" line="168" column="43" />
        <mark key="." line="168" column="43" />
        <mark key="^" line="168" column="43" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/db_scripts/DB_Changes_v300.sql" timestamp="1499162835057">
        <mark key="[" line="3" column="0" />
        <mark key="]" line="35" column="57" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/public/js/angular/kuze_enduser_app.js" timestamp="1498045366621">
        <mark key="'" line="1187" column="20" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/api/invoices.php" timestamp="1498725747370">
        <mark key="'" line="95" column="4" />
        <mark key="[" line="7" column="6" />
        <mark key="]" line="7" column="6" />
        <mark key="." line="7" column="6" />
        <mark key="^" line="115" column="43" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/AndroidGalleryImageSaver.cs" timestamp="1497519923388">
        <mark key="'" line="31" column="0" />
        <mark key="[" line="15" column="0" />
        <mark key="]" line="15" column="0" />
        <mark key="^" line="15" column="16" />
        <mark key="." line="15" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/kuze_db.php" timestamp="1499159045352">
        <mark key="'" line="161" column="27" />
      </file>
      <file name="$USER_HOME$/Projects/Guy Prives/Automator/server/package.json" timestamp="1492003154014">
        <mark key="'" line="6" column="19" />
        <mark key="[" line="37" column="19" />
        <mark key="]" line="37" column="24" />
        <mark key="." line="37" column="24" />
        <mark key="^" line="37" column="24" />
      </file>
      <file name="$USER_HOME$/Projects/mocha-given/package.json" timestamp="1490283218372">
        <mark key="'" line="10" column="18" />
        <mark key="[" line="10" column="14" />
        <mark key="]" line="10" column="18" />
        <mark key="^" line="10" column="18" />
        <mark key="." line="10" column="18" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/kuze_config/dev/kuze_config.php" timestamp="1499159282333">
        <mark key="[" line="11" column="0" />
        <mark key="]" line="11" column="69" />
        <mark key="." line="11" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/luftzig.com/front/src/Styling.elm" timestamp="1497700286779">
        <mark key="'" line="39" column="31" />
        <mark key="[" line="39" column="47" />
        <mark key="]" line="39" column="47" />
        <mark key="." line="39" column="47" />
        <mark key="^" line="39" column="47" />
      </file>
      <file name="$USER_HOME$/Projects/luftzig.com/front/elm-stuff/packages/rtfeldman/elm-css/8.1.0/src/Css.elm" timestamp="1497694656695">
        <mark key="'" line="4371" column="8" />
      </file>
      <file name="$USER_HOME$/Projects/luftzig.com/front/src/View.elm" timestamp="1497799291882">
        <mark key="'" line="94" column="10" />
        <mark key="[" line="2" column="7" />
        <mark key="]" line="2" column="15" />
        <mark key="." line="2" column="15" />
        <mark key="^" line="2" column="15" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/kuze_const.php" timestamp="1498044815249">
        <mark key="'" line="75" column="0" />
        <mark key="[" line="37" column="31" />
        <mark key="]" line="37" column="34" />
        <mark key="." line="37" column="34" />
        <mark key="^" line="37" column="34" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/api/api_admin.php" timestamp="1499162484990">
        <mark key="'" line="189" column="2" />
        <mark key="[" line="198" column="0" />
        <mark key="]" line="198" column="0" />
        <mark key="^" line="200" column="25" />
        <mark key="." line="198" column="0" />
      </file>
      <file name="vim_settings.xml" timestamp="1498470093079">
        <mark key="[" line="0" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/site.conf" timestamp="1497783226999">
        <mark key="'" line="0" column="0" />
        <mark key="[" line="0" column="0" />
        <mark key="]" line="39" column="0" />
        <mark key="." line="8" column="4" />
        <mark key="^" line="8" column="4" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" timestamp="1499160859148">
        <mark key="'" line="3" column="0" />
        <mark key="[" line="3" column="2" />
        <mark key="]" line="3" column="4" />
        <mark key="." line="3" column="4" />
        <mark key="^" line="3" column="4" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/angular/business_config.php" timestamp="1498044504233">
        <mark key="[" line="31" column="0" />
        <mark key="]" line="31" column="0" />
        <mark key="." line="31" column="0" />
      </file>
      <file name="$APPLICATION_CONFIG_DIR$/scratches/scratch_5.json" timestamp="1492685289704">
        <mark key="'" line="7" column="18" />
        <mark key="[" line="0" column="0" />
        <mark key="]" line="0" column="9003" />
        <mark key="^" line="0" column="9003" />
        <mark key="." line="0" column="9003" />
      </file>
      <file name="$APPLICATION_CONFIG_DIR$/consoles/.datagrid/cell" timestamp="1499162790640">
        <mark key="[" line="0" column="0" />
        <mark key="]" line="0" column="0" />
        <mark key="." line="0" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/luftzig.com/front/src/Main.elm" timestamp="1497695316614">
        <mark key="'" line="11" column="17" />
        <mark key="[" line="24" column="8" />
        <mark key="]" line="24" column="23" />
        <mark key="." line="24" column="23" />
        <mark key="^" line="24" column="23" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" timestamp="1499163395346">
        <mark key="'" line="5282" column="43" />
        <mark key="[" line="1950" column="3" />
        <mark key="]" line="1950" column="3" />
        <mark key="." line="1950" column="3" />
        <mark key="^" line="1950" column="3" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/ImmortalManager.cs" timestamp="1498141711502">
        <mark key="'" line="123" column="73" />
        <mark key="[" line="127" column="67" />
        <mark key="]" line="127" column="70" />
        <mark key="^" line="127" column="70" />
        <mark key="." line="127" column="70" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/DataService/DataService.cs" timestamp="1498473617414">
        <mark key="'" line="16" column="24" />
        <mark key="[" line="38" column="54" />
        <mark key="]" line="38" column="54" />
        <mark key="^" line="38" column="56" />
        <mark key="." line="38" column="54" />
      </file>
      <file name="$USER_HOME$/Projects/the_bar_node/server/test/greeter-spec.ts" timestamp="1490284305782">
        <mark key="'" line="4" column="40" />
        <mark key="[" line="14" column="22" />
        <mark key="]" line="14" column="22" />
        <mark key="." line="14" column="22" />
        <mark key="^" line="12" column="37" />
      </file>
      <file name="$USER_HOME$/Projects/Guy Prives/Automator/server/api/updater/updater.model.ts" timestamp="1492787491819">
        <mark key="'" line="19" column="105" />
        <mark key="[" line="19" column="105" />
        <mark key="]" line="19" column="105" />
        <mark key="^" line="19" column="105" />
        <mark key="." line="19" column="105" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/DataService/StageData.cs" timestamp="1498123623435">
        <mark key="'" line="9" column="14" />
      </file>
      <file name="$APPLICATION_CONFIG_DIR$/scratches/scratch_6.json" timestamp="1492685876216">
        <mark key="'" line="452" column="0" />
        <mark key="[" line="517" column="35" />
        <mark key="]" line="517" column="33" />
        <mark key="^" line="517" column="33" />
        <mark key="." line="517" column="33" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/GardenScreenshot.cs" timestamp="1498662602044">
        <mark key="'" line="132" column="52" />
        <mark key="[" line="131" column="27" />
        <mark key="]" line="132" column="52" />
        <mark key="." line="132" column="52" />
        <mark key="^" line="132" column="52" />
      </file>
      <file name="$APPLICATION_CONFIG_DIR$/scratches/scratch_1.js" timestamp="1498387185354">
        <mark key="'" line="0" column="0" />
        <mark key="[" line="38" column="0" />
        <mark key="]" line="195" column="1" />
        <mark key="^" line="195" column="1" />
        <mark key="." line="167" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/invoice/create-doc.php" timestamp="1498744316602">
        <mark key="'" line="147" column="0" />
        <mark key="[" line="64" column="0" />
        <mark key="]" line="133" column="1" />
        <mark key="." line="101" column="23" />
        <mark key="^" line="101" column="23" />
      </file>
      <file name="$USER_HOME$/Projects/Guy Prives/Automator/server/api/appreciate-client/appreciate-client.ts" timestamp="1492789578918">
        <mark key="'" line="82" column="20" />
        <mark key="[" line="65" column="41" />
        <mark key="]" line="65" column="51" />
        <mark key="^" line="65" column="51" />
        <mark key="." line="65" column="51" />
      </file>
      <file name="$USER_HOME$/Projects/Guy Prives/Automator/server/api/appreciate-client/patch-request-converter.ts" timestamp="1492680861043">
        <mark key="'" line="64" column="0" />
        <mark key="[" line="65" column="25" />
        <mark key="]" line="65" column="31" />
        <mark key="^" line="65" column="31" />
        <mark key="." line="65" column="31" />
      </file>
      <file name="/dummy.sql" timestamp="1499162782209">
        <mark key="[" line="0" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/UI/GameEditor/LoadButton.cs" timestamp="1498489326900">
        <mark key="'" line="0" column="0" />
        <mark key="[" line="7" column="0" />
        <mark key="]" line="7" column="0" />
        <mark key="^" line="37" column="52" />
        <mark key="." line="7" column="0" />
      </file>
      <file name="$APPLICATION_CONFIG_DIR$/consoles/db/6e25fe0b-98f3-46a4-9336-01e7aed49277/console.sql" timestamp="1499162852904">
        <mark key="[" line="0" column="0" />
        <mark key="]" line="0" column="0" />
        <mark key="." line="0" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/Borders.cs" timestamp="1497869872208">
        <mark key="'" line="0" column="0" />
        <mark key="[" line="27" column="0" />
        <mark key="]" line="27" column="0" />
        <mark key="^" line="14" column="49" />
        <mark key="." line="27" column="0" />
      </file>
      <file name="/Dummy.txt" timestamp="1499163509541">
        <mark key="[" line="0" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/luftzig.com/front/src/Sections/CodeSection.elm" timestamp="1497799548443">
        <mark key="'" line="39" column="20" />
        <mark key="[" line="22" column="21" />
        <mark key="]" line="22" column="20" />
        <mark key="." line="22" column="20" />
        <mark key="^" line="22" column="20" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" timestamp="1498746722575">
        <mark key="'" line="9" column="26" />
        <mark key="[" line="9" column="26" />
        <mark key="]" line="9" column="57" />
        <mark key="^" line="8" column="23" />
        <mark key="." line="8" column="23" />
      </file>
      <file name="/business-app-v11.php" timestamp="1499159988365" />
      <file name="$USER_HOME$/Projects/kuze/php/kuze_login.php" timestamp="1497776244958">
        <mark key="'" line="43" column="8" />
      </file>
      <file name="$APPLICATION_CONFIG_DIR$/scratches/scratch_1.json" timestamp="1492339311193">
        <mark key="'" line="2669" column="0" />
        <mark key="[" line="0" column="0" />
        <mark key="]" line="2669" column="0" />
        <mark key="^" line="0" column="31135" />
        <mark key="." line="0" column="31135" />
      </file>
    </filemarks>
    <jumps>
      <jump line="2904" column="38" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="2913" column="47" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="2916" column="66" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="292" column="74" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="16" column="36" filename="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" />
      <jump line="522" column="22" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="154" column="32" filename="$USER_HOME$/Projects/kuze/php/kuze_db.php" />
      <jump line="111" column="13" filename="$USER_HOME$/Projects/kuze/php/kuze_db.php" />
      <jump line="18" column="32" filename="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" />
      <jump line="19" column="29" filename="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" />
      <jump line="0" column="0" filename="$APPLICATION_CONFIG_DIR$/consoles/db/6e25fe0b-98f3-46a4-9336-01e7aed49277/console.sql" />
      <jump line="107" column="6" filename="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" />
      <jump line="0" column="0" filename="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" />
      <jump line="101" column="5" filename="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" />
      <jump line="7" column="0" filename="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" />
      <jump line="59" column="8" filename="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" />
      <jump line="2914" column="29" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="2915" column="45" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="2923" column="13" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="2925" column="2" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="100" column="46" filename="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" />
      <jump line="1951" column="27" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="126" column="21" filename="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" />
      <jump line="22" column="0" filename="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" />
      <jump line="1963" column="36" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="2929" column="29" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="111" column="37" filename="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" />
      <jump line="147" column="0" filename="$USER_HOME$/Projects/kuze/php/invoice/create-doc.php" />
      <jump line="371" column="25" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="381" column="34" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="383" column="30" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="391" column="35" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="393" column="25" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="395" column="24" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="402" column="43" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="404" column="34" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="406" column="33" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="413" column="34" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="433" column="32" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="437" column="8" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="439" column="32" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="445" column="8" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="450" column="32" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="459" column="12" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="460" column="36" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="465" column="10" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="466" column="34" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="470" column="10" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="471" column="34" filename="$USER_HOME$/Projects/kuze/php/kuze_utils.php" />
      <jump line="21" column="51" filename="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" />
      <jump line="149" column="40" filename="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" />
      <jump line="137" column="0" filename="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" />
      <jump line="8" column="24" filename="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" />
      <jump line="9" column="26" filename="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" />
      <jump line="5570" column="21" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5822" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="14" column="66" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="202" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="202" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="791" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="161" column="27" filename="$USER_HOME$/Projects/kuze/php/kuze_db.php" />
      <jump line="781" column="41" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="319" column="31" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="1921" column="24" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="5522" column="23" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="5750" column="17" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="5861" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5860" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="6101" column="1" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="6100" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="3378" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="6106" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="1983" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="1888" column="63" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="1919" column="9" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="1947" column="11" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5519" column="23" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5745" column="17" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5772" column="81" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5780" column="14" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5788" column="9" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5792" column="15" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="1918" column="9" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="1892" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="3" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="1892" column="57" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="1889" column="57" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="1339" column="12" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5382" column="24" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5381" column="25" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="4723" column="8" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5275" column="8" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="3380" column="19" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="3383" column="2" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="189" column="2" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="0" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="2" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="4729" column="43" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5059" column="59" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5282" column="43" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
    </jumps>
    <registers>
      <register name="&quot;" type="4">
        <text>;</text>
      </register>
      <register name="-" type="4">
        <text>;</text>
      </register>
      <register name="/" type="4">
        <text>initiatePayment</text>
      </register>
      <register name="0" type="2">
        <text encoding="base64">ICAgICRzY29wZS5pbnZvaWNlX3NvdXJjZV9pZCA9IGNvbmZpZy5pbnZvaWNlX3NvdXJjZV9pZDsK</text>
      </register>
      <register name="1" type="2">
        <text encoding="base64">ICAgIH0pCg==</text>
      </register>
      <register name="2" type="2">
        <text encoding="base64">ICAgIGJ1c2luZXNzQ29uZmlnLnRoZW4oZnVuY3Rpb24gKGNvbmZpZykgewo=</text>
      </register>
      <register name="r" type="4">
        <keys>
          <key char="64" code="0" mods="0" />
          <key char="116" code="0" mods="0" />
          <key char="119" code="0" mods="0" />
          <key char="105" code="0" mods="0" />
          <key char="123" code="0" mods="0" />
          <key char="32" code="0" mods="0" />
          <key char="116" code="0" mods="0" />
          <key char="121" code="0" mods="0" />
          <key char="65535" code="8" mods="0" />
          <key char="65535" code="8" mods="0" />
          <key char="99" code="0" mods="0" />
          <key char="111" code="0" mods="0" />
          <key char="100" code="0" mods="0" />
          <key char="101" code="0" mods="0" />
          <key char="32" code="0" mods="0" />
          <key char="58" code="0" mods="0" />
          <key char="65535" code="91" mods="130" />
          <key char="65" code="0" mods="0" />
          <key char="44" code="0" mods="0" />
          <key char="65535" code="8" mods="0" />
          <key char="44" code="0" mods="0" />
          <key char="65535" code="91" mods="130" />
          <key char="119" code="0" mods="0" />
          <key char="119" code="0" mods="0" />
          <key char="105" code="0" mods="0" />
          <key char="110" code="0" mods="0" />
          <key char="97" code="0" mods="0" />
          <key char="109" code="0" mods="0" />
          <key char="101" code="0" mods="0" />
          <key char="58" code="0" mods="0" />
          <key char="32" code="0" mods="0" />
          <key char="34" code="0" mods="0" />
          <key char="65535" code="91" mods="130" />
          <key char="65" code="0" mods="0" />
          <key char="34" code="0" mods="0" />
          <key char="65535" code="91" mods="130" />
          <key char="65" code="0" mods="0" />
          <key char="65535" code="10" mods="0" />
          <key char="125" code="0" mods="0" />
          <key char="65535" code="91" mods="130" />
          <key char="97" code="0" mods="0" />
          <key char="44" code="0" mods="0" />
          <key char="65535" code="91" mods="130" />
          <key char="119" code="0" mods="0" />
          <key char="119" code="0" mods="0" />
          <key char="48" code="0" mods="0" />
        </keys>
      </register>
      <register name="3" type="2">
        <text encoding="base64">ICAkc2NvcGUuYnVzaW5lc3NDb25maWcgPSBidXNpbmVzc0NvbmZpZzsKICAkc2NvcGUuYnVzaW5lc3NDb25maWcudGhlbihmdW5jdGlvbiAoY29uZmlnKSB7CiAgICAkc2NvcGUuaW52b2ljZV9zb3VyY2VfaWQgPSBjb25maWcuaW52b2ljZV9zb3VyY2VfaWQ7CiAgICAkc2NvcGUuaGFzVmF0ID0gY29uZmlnLnZhdF9yYXRlID4gMDsKICB9KTsK</text>
      </register>
      <register name="4" type="2">
        <text encoding="base64">ICAgICAgICAK</text>
      </register>
      <register name="t" type="4">
        <keys>
          <key char="119" code="0" mods="0" />
          <key char="105" code="0" mods="0" />
          <key char="123" code="0" mods="0" />
          <key char="32" code="0" mods="0" />
          <key char="99" code="0" mods="0" />
          <key char="111" code="0" mods="0" />
          <key char="100" code="0" mods="0" />
          <key char="101" code="0" mods="0" />
          <key char="58" code="0" mods="0" />
          <key char="32" code="0" mods="0" />
          <key char="65535" code="91" mods="130" />
          <key char="65" code="0" mods="0" />
          <key char="44" code="0" mods="0" />
          <key char="65535" code="91" mods="130" />
          <key char="119" code="0" mods="0" />
          <key char="119" code="0" mods="0" />
          <key char="105" code="0" mods="0" />
          <key char="110" code="0" mods="0" />
          <key char="97" code="0" mods="0" />
          <key char="109" code="0" mods="0" />
          <key char="101" code="0" mods="0" />
          <key char="58" code="0" mods="0" />
          <key char="32" code="0" mods="0" />
          <key char="34" code="0" mods="0" />
          <key char="65535" code="91" mods="130" />
          <key char="65" code="0" mods="0" />
          <key char="34" code="0" mods="0" />
          <key char="65535" code="91" mods="130" />
          <key char="111" code="0" mods="0" />
          <key char="125" code="0" mods="0" />
          <key char="44" code="0" mods="0" />
          <key char="65535" code="91" mods="130" />
          <key char="119" code="0" mods="0" />
          <key char="119" code="0" mods="0" />
          <key char="48" code="0" mods="0" />
        </keys>
      </register>
      <register name="5" type="2">
        <text encoding="base64">Cg==</text>
      </register>
      <register name="6" type="2">
        <text encoding="base64">VVBEQVRFIGt6X2J1c2luZXNzZXMgU0VUIGludm9pY2Vfc3lzdGVtX2FjY291bnRfaWQgPSBOVUxMIFdIRVJFIGJ1c2luZXNzX2lkID0gMTY1Owo=</text>
      </register>
      <register name="7" type="2">
        <text encoding="base64">ICBlbHNlCiAgewogICAgJHdoZXJlX3Blcm1pc3Npb25zPSIiOwogIH0K</text>
      </register>
      <register name="8" type="2">
        <text encoding="base64">Ly8gdjExIC0gMjMgbWFyY2ggMjAxNwovL0RlZmluZSBhbiBhbmd1bGFyIG1vZHVsZSBmb3Igb3VyIGFwcAoKdmFyIGt1emVJc0NhbGVuZGFyRHJhZ2dibGU7Cmt1emVJc0NhbGVuZGFyRHJhZ2dibGUgPSB0cnVlOwoKLy8gYW5ndWxhciBtb2R1bGVzCi8vJGFuZ3VsYXJNb2R1bGVzPVsnbmdSb3V0ZScsJ3VpLmJvb3RzdHJhcCcsJ3VpLmdyaWQnXTsKJGFuZ3VsYXJNb2R1bGVzID0gWyduZ1JvdXRlJywgJ3VpLmJvb3RzdHJhcCcsICd1aS5ncmlkJywgJ2J1aWxkZXInLCAnYnVpbGRlci5jb21wb25lbnRzJywgJ3ZhbGlkYXRvci5ydWxlcycsICd1aS5jYWxlbmRhcicsICdjaGVja2xpc3QtbW9kZWwnLCAndWkuYm9vdHN0cmFwLmRhdGV0aW1lcGlja2VyJywgJ2FuZ3Vjb21wbGV0ZS1hbHQnLCAnbXVsdGlwbGVTZWxlY3QnLCdhbmd1bGFySW5saW5lRWRpdCcsJ3RleHRBbmd1bGFyJywnbmdDc3YnXTsKCnZhciBkYXlOYW1lcyA9IFsn16jXkNep15XXnycsICfXqdeg15knLCAn16nXnNeZ16nXmScsICfXqNeR15nXoteZJywgJ9eX157Xmdep15knLCAn16nXmdep15knLCAn16nXkdeqJ107CnZhciBtb250aE5hbWVzID0gWyLXmdeg15XXkNeoIiwgItek15HXqNeV15DXqCIsICLXnteo16UiLCAi15DXpNeo15nXnCIsICLXnteQ15kiLCAi15nXldeg15kiLAogICAgIteZ15XXnNeZIiwgIteQ15XXkteV16HXmCIsICLXodek15jXnteR16giLCAi15DXlden15jXldeR16giLCAi16DXldeR157XkdeoIiwgIteT16bXnteR16giCl07Cgp2YXIgbG9naW5OZXh0U2NyZWVuPSIiOwoKKGZ1bmN0aW9uKCl7RGF0ZS5zaG9ydE1vbnRocz1bIkphbiIsIkZlYiIsIk1hciIsIkFwciIsIk1heSIsIkp1biIsIkp1bCIsIkF1ZyIsIlNlcCIsIk9jdCIsIk5vdiIsIkRlYyJdLERhdGUubG9uZ01vbnRocz1bIkphbnVhcnkiLCJGZWJydWFyeSIsIk1hcmNoIiwiQXByaWwiLCJNYXkiLCJKdW5lIiwiSnVseSIsIkF1Z3VzdCIsIlNlcHRlbWJlciIsIk9jdG9iZXIiLCJOb3ZlbWJlciIsIkRlY2VtYmVyIl0sRGF0ZS5zaG9ydERheXM9WyJTdW4iLCJNb24iLCJUdWUiLCJXZWQiLCJUaHUiLCJGcmkiLCJTYXQiXSxEYXRlLmxvbmdEYXlzPVsiU3VuZGF5IiwiTW9uZGF5IiwiVHVlc2RheSIsIldlZG5lc2RheSIsIlRodXJzZGF5IiwiRnJpZGF5IiwiU2F0dXJkYXkiXTt2YXIgdD17ZDpmdW5jdGlvbigpe3JldHVybih0aGlzLmdldERhdGUoKTwxMD8iMCI6IiIpK3RoaXMuZ2V0RGF0ZSgpfSxEOmZ1bmN0aW9uKCl7cmV0dXJuIERhdGUuc2hvcnREYXlzW3RoaXMuZ2V0RGF5KCldfSxqOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZ2V0RGF0ZSgpfSxsOmZ1bmN0aW9uKCl7cmV0dXJuIERhdGUubG9uZ0RheXNbdGhpcy5nZXREYXkoKV19LE46ZnVuY3Rpb24oKXtyZXR1cm4gMD09dGhpcy5nZXREYXkoKT83OnRoaXMuZ2V0RGF5KCl9LFM6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5nZXREYXRlKCklMTA9PTEmJjExIT10aGlzLmdldERhdGUoKT8ic3QiOnRoaXMuZ2V0RGF0ZSgpJTEwPT0yJiYxMiE9dGhpcy5nZXREYXRlKCk/Im5kIjp0aGlzLmdldERhdGUoKSUxMD09MyYmMTMhPXRoaXMuZ2V0RGF0ZSgpPyJyZCI6InRoIn0sdzpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldERheSgpfSx6OmZ1bmN0aW9uKCl7dmFyIHQ9bmV3IERhdGUodGhpcy5nZXRGdWxsWWVhcigpLDAsMSk7cmV0dXJuIE1hdGguY2VpbCgodGhpcy10KS84NjRlNSl9LFc6ZnVuY3Rpb24oKXt2YXIgdD1uZXcgRGF0ZSh0aGlzLnZhbHVlT2YoKSksZT0odGhpcy5nZXREYXkoKSs2KSU3O3Quc2V0RGF0ZSh0LmdldERhdGUoKS1lKzMpO3ZhciBuPXQudmFsdWVPZigpO3JldHVybiB0LnNldE1vbnRoKDAsMSksNCE9PXQuZ2V0RGF5KCkmJnQuc2V0TW9udGgoMCwxKyg0LXQuZ2V0RGF5KCkrNyklNyksMStNYXRoLmNlaWwoKG4tdCkvNjA0OGU1KX0sRjpmdW5jdGlvbigpe3JldHVybiBEYXRlLmxvbmdNb250aHNbdGhpcy5nZXRNb250aCgpXX0sbTpmdW5jdGlvbigpe3JldHVybih0aGlzLmdldE1vbnRoKCk8OT8iMCI6IiIpKyh0aGlzLmdldE1vbnRoKCkrMSl9LE06ZnVuY3Rpb24oKXtyZXR1cm4gRGF0ZS5zaG9ydE1vbnRoc1t0aGlzLmdldE1vbnRoKCldfSxuOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZ2V0TW9udGgoKSsxfSx0OmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5nZXRGdWxsWWVhcigpLGU9dGhpcy5nZXRNb250aCgpKzE7cmV0dXJuIDEyPT09ZSYmKHQ9dCsrLGU9MCksbmV3IERhdGUodCxlLDApLmdldERhdGUoKX0sTDpmdW5jdGlvbigpe3ZhciB0PXRoaXMuZ2V0RnVsbFllYXIoKTtyZXR1cm4gdCU0MDA9PTB8fHQlMTAwIT0wJiZ0JTQ9PTB9LG86ZnVuY3Rpb24oKXt2YXIgdD1uZXcgRGF0ZSh0aGlzLnZhbHVlT2YoKSk7cmV0dXJuIHQuc2V0RGF0ZSh0LmdldERhdGUoKS0odGhpcy5nZXREYXkoKSs2KSU3KzMpLHQuZ2V0RnVsbFllYXIoKX0sWTpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldEZ1bGxZZWFyKCl9LHk6ZnVuY3Rpb24oKXtyZXR1cm4oIiIrdGhpcy5nZXRGdWxsWWVhcigpKS5zdWJzdHIoMil9LGE6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5nZXRIb3VycygpPDEyPyJhbSI6InBtIn0sQTpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldEhvdXJzKCk8MTI/IkFNIjoiUE0ifSxCOmZ1bmN0aW9uKCl7cmV0dXJuIE1hdGguZmxvb3IoMWUzKigodGhpcy5nZXRVVENIb3VycygpKzEpJTI0K3RoaXMuZ2V0VVRDTWludXRlcygpLzYwK3RoaXMuZ2V0VVRDU2Vjb25kcygpLzM2MDApLzI0KX0sZzpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldEhvdXJzKCklMTJ8fDEyfSxHOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZ2V0SG91cnMoKX0saDpmdW5jdGlvbigpe3JldHVybigodGhpcy5nZXRIb3VycygpJTEyfHwxMik8MTA/IjAiOiIiKSsodGhpcy5nZXRIb3VycygpJTEyfHwxMil9LEg6ZnVuY3Rpb24oKXtyZXR1cm4odGhpcy5nZXRIb3VycygpPDEwPyIwIjoiIikrdGhpcy5nZXRIb3VycygpfSxpOmZ1bmN0aW9uKCl7cmV0dXJuKHRoaXMuZ2V0TWludXRlcygpPDEwPyIwIjoiIikrdGhpcy5nZXRNaW51dGVzKCl9LHM6ZnVuY3Rpb24oKXtyZXR1cm4odGhpcy5nZXRTZWNvbmRzKCk8MTA/IjAiOiIiKSt0aGlzLmdldFNlY29uZHMoKX0sdTpmdW5jdGlvbigpe3ZhciB0PXRoaXMuZ2V0TWlsbGlzZWNvbmRzKCk7cmV0dXJuKDEwPnQ/IjAwIjoxMDA+dD8iMCI6IiIpK3R9LGU6ZnVuY3Rpb24oKXtyZXR1cm4vXCgoLiopXCkvLmV4ZWMoKG5ldyBEYXRlKS50b1N0cmluZygpKVsxXX0sSTpmdW5jdGlvbigpe2Zvcih2YXIgdD1udWxsLGU9MDsxMj5lOysrZSl7dmFyIG49bmV3IERhdGUodGhpcy5nZXRGdWxsWWVhcigpLGUsMSksaT1uLmdldFRpbWV6b25lT2Zmc2V0KCk7aWYobnVsbD09PXQpdD1pO2Vsc2V7aWYodD5pKXt0PWk7YnJlYWt9aWYoaT50KWJyZWFrfX1yZXR1cm4gdGhpcy5nZXRUaW1lem9uZU9mZnNldCgpPT10fDB9LE86ZnVuY3Rpb24oKXtyZXR1cm4oLXRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKTwwPyItIjoiKyIpKyhNYXRoLmFicyh0aGlzLmdldFRpbWV6b25lT2Zmc2V0KCkvNjApPDEwPyIwIjoiIikrTWF0aC5mbG9vcihNYXRoLmFicyh0aGlzLmdldFRpbWV6b25lT2Zmc2V0KCkvNjApKSsoMD09TWF0aC5hYnModGhpcy5nZXRUaW1lem9uZU9mZnNldCgpJTYwKT8iMDAiOihNYXRoLmFicyh0aGlzLmdldFRpbWV6b25lT2Zmc2V0KCklNjApPDEwPyIwIjoiIikrTWF0aC5hYnModGhpcy5nZXRUaW1lem9uZU9mZnNldCgpJTYwKSl9LFA6ZnVuY3Rpb24oKXtyZXR1cm4oLXRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKTwwPyItIjoiKyIpKyhNYXRoLmFicyh0aGlzLmdldFRpbWV6b25lT2Zmc2V0KCkvNjApPDEwPyIwIjoiIikrTWF0aC5mbG9vcihNYXRoLmFicyh0aGlzLmdldFRpbWV6b25lT2Zmc2V0KCkvNjApKSsiOiIrKDA9PU1hdGguYWJzKHRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKSU2MCk/IjAwIjooTWF0aC5hYnModGhpcy5nZXRUaW1lem9uZU9mZnNldCgpJTYwKTwxMD8iMCI6IiIpK01hdGguYWJzKHRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKSU2MCkpfSxUOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMudG9UaW1lU3RyaW5nKCkucmVwbGFjZSgvXi4rIFwoPyhbXlwpXSspXCk/JC8sIiQxIil9LFo6ZnVuY3Rpb24oKXtyZXR1cm4gNjAqLXRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKX0sYzpmdW5jdGlvbigpe3JldHVybiB0aGlzLmZvcm1hdCgiWS1tLWRcXFRIOmk6c1AiKX0scjpmdW5jdGlvbigpe3JldHVybiB0aGlzLnRvU3RyaW5nKCl9LFU6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5nZXRUaW1lKCkvMWUzfX07RGF0ZS5wcm90b3R5cGUuZm9ybWF0PWZ1bmN0aW9uKGUpe3ZhciBuPXRoaXM7cmV0dXJuIGUucmVwbGFjZSgvKFxcPykoLikvZyxmdW5jdGlvbihlLGkscil7cmV0dXJuIiI9PT1pJiZ0W3JdP3Rbcl0uY2FsbChuKTpyfSl9fSkuY2FsbCh0aGlzKTsKCmZ1bmN0aW9uIGdvdG9DbGllbnRQYWdlKGJ1c2luZXNzX3VzZXJfaWQpCnsKICB3aW5kb3cubG9jYXRpb24uaHJlZj0nLyMvYnVzaW5lc3NfY2xpZW50cy8nICsgYnVzaW5lc3NfdXNlcl9pZDsKfQpmdW5jdGlvbiBnb3RvSW5zdHJ1Y3RvclBhZ2UoYnVzaW5lc3NfdXNlcl9pZCkKewogIHdpbmRvdy5sb2NhdGlvbi5ocmVmPScvIy9idXNpbmVzc19pbnN0cnVjdG9ycy8nICsgYnVzaW5lc3NfdXNlcl9pZDsKfQoKZnVuY3Rpb24gZ290b0V2ZW50UGFnZSh0aGVldmVudCkKewogIGxvZ0RlYnVnKCJnb3RvRXZlbnRQYWdlICIrdGhlZXZlbnQpOwogIGlmICh0aGVldmVudC5pc19jbGFzcz09MSkKICB7CiAgICB3aW5kb3cubG9jYXRpb24uaHJlZj0nLyMvZXZlbnRfY2xhc3MvJyArIHRoZWV2ZW50LmV2ZW50X2lkOwogIH0KICBlbHNlCiAgewogICAgd2luZG93LmxvY2F0aW9uLmhyZWY9Jy8jL2V2ZW50LycgKyB0aGVldmVudC5ldmVudF9pZDsKICB9Cn0KCmZ1bmN0aW9uIGdvdG9Mb2NhdGlvblBhZ2UobG9jYXRpb25faWQpCnsKICBsb2dEZWJ1ZygiZ290b0xvY2F0aW9uUGFnZSAiK2xvY2F0aW9uX2lkKTsKICB3aW5kb3cubG9jYXRpb24uaHJlZj0nLyMvYnVzaW5lc3NfbG9jYXRpb25zLycgKyBsb2NhdGlvbl9pZDsKCn0KCmZ1bmN0aW9uIGdvdG9DbGllbnRFZGl0UGFnZSh1c2VyX2lkKQp7CiAgd2luZG93LmxvY2F0aW9uLmhyZWY9Jy8jL2J1c2luZXNzX2NsaWVudHMvJyArIHVzZXJfaWQgKyAnL2VkaXQnOwp9CgpmdW5jdGlvbiBnb3RvQmFjaygpCnsKICB3aW5kb3cuaGlzdG9yeS5iYWNrKCk7Cn0KCmZ1bmN0aW9uIHNob3dFdmVudFBvcHVwKHNlbGVjdGVkRXZlbnQsICR1aWJNb2RhbCkKewogIC8vIHRoaXMgZnVuY3Rpb24gdXNlZCB0byBicmluZyBhIHBvcHVwCiAgLy8gbm93IGl0IGdvZXMgdG8gdGhlIGV2ZW50IHBhZ2UKICBnb3RvRXZlbnRQYWdlKHNlbGVjdGVkRXZlbnQpOwoKICAvLyBpZiAoc2VsZWN0ZWRFdmVudC5pc19yZXBlYXRpbmcgPT0gMSkgewogIC8vICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAvLyAgICAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgLy8gICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9jbGFzc19zaW5nbGUucGhwJywKICAvLyAgICAgICAgIGNvbnRyb2xsZXI6ICdldmVudFJlY3VycmluZ0RldGFpbHNCdXNpbmVzc0NhbGVuZGFyTW9kYWxDb250cm9sbGVyJywKICAvLyAgICAgICAgIC8vIHNpemU6IHNpemUsCiAgLy8gICAgICAgICByZXNvbHZlOiB7CiAgLy8gICAgICAgICAgICAgc2VsZWN0ZWRFdmVudDogZnVuY3Rpb24oKSB7CiAgLy8gICAgICAgICAgICAgICAgIHJldHVybiBzZWxlY3RlZEV2ZW50OwogIC8vICAgICAgICAgICAgIH0KICAvLyAgICAgICAgIH0KICAvLyAgICAgfSk7CiAgLy8gfSBlbHNlIHsKICAvLyAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgLy8gICAgICAgICBhbmltYXRpb246IGZhbHNlLAogIC8vICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfZXZlbnRfc2luZ2xlLnBocCcsCiAgLy8gICAgICAgICBjb250cm9sbGVyOiAnZXZlbnREZXRhaWxzQnVzaW5lc3NDYWxlbmRhck1vZGFsQ29udHJvbGxlcicsCiAgLy8gICAgICAgICAvLyBzaXplOiBzaXplLAogIC8vICAgICAgICAgcmVzb2x2ZTogewogIC8vICAgICAgICAgICAgIHNlbGVjdGVkRXZlbnQ6IGZ1bmN0aW9uKCkgewogIC8vICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZWN0ZWRFdmVudDsKICAvLyAgICAgICAgICAgICB9CiAgLy8gICAgICAgICB9CiAgLy8gICAgIH0pOwogIC8vIH0KfQpmdW5jdGlvbiB1cGRhdGVHbG9iYWxMYW5ndWFnZSgkc2NvcGUsICRuZXdsYW5nKSB7CgogICAgLy8JdmFyIGdMYW5nPWdMYW5nQmFzZVtnTGFuZ0N1cnJdOwogICAgJGdMYW5nID0gZ0xhbmdCYXNlWyRuZXdsYW5nXTsKICAgIC8vIGxvZ0RlYnVnKCJnTGFuZ0Jhc2VbJG5ld2xhbmddWyd0aXRsZTEnXT0iICsgZ0xhbmdCYXNlWyRuZXdsYW5nXVsndGl0bGUxJ10pOwogICAgLy8gbG9nRGVidWcoImxhbmd1Z2FnZToiICsgJGdMYW5nWydsYW5ndWFnZSddKTsKICAgIC8vCWxvZ0RlYnVnKCJsYW5ndWdhZ2UgZGlyOiAiKyRnTGFuZ1snZGlyJ10pOwogICAgLy8JbG9nRGVidWcoImNoYW5naW5nIGxhbmd1YWdlIHRvICIrJG5ld2xhbmcpCiAgICAkc2NvcGUuc3BDbGFzcyA9ICRnTGFuZ1snY2xhc3MnXTsKICAgIC8vCWxvZ0RlYnVnKCJpcyBhcnJheT8gIithbmd1bGFyLmlzQXJyYXkoJGdMYW5nKSk7CiAgICAvLwlsb2dEZWJ1ZygiJGdMYW5nWydkaXInXT0iKyRnTGFuZ1snZGlyJ10pOwogICAgLy8JbG9nRGVidWcoIiRnTGFuZ1sndGl0bGUxJ109IiskZ0xhbmdbJ3RpdGxlMSddKTsKICAgICRzY29wZS5sYW5nZmlsZSA9ICRnTGFuZzsKICAgIC8vIGxvZ0RlYnVnKCJpcyBhcnJheT8gIiArIGFuZ3VsYXIuaXNBcnJheSgkc2NvcGUubGFuZ2ZpbGUpKTsKICAgIC8vIGxvZ0RlYnVnKCIkc2NvcGUubGFuZ2ZpbGU9IiArICRzY29wZS5sYW5nZmlsZSk7CiAgICAvLyBsb2dEZWJ1ZygiJHNjb3BlLmxhbmdmaWxlWyd0aXRsZTEnXT0iICsgJHNjb3BlLmxhbmdmaWxlWyd0aXRsZTEnXSk7CgogICAgJHNjb3BlLnRlc3RuZXd2YXIgPSAkc2NvcGUubGFuZ2ZpbGVbJ3RpdGxlMSddOwogICAgLy8JJHNjb3BlLm1lc3NhZ2U9JHNjb3BlLmxhbmdmaWxlWyd0aXRsZTEnXTsKfQoKZnVuY3Rpb24gZ2V0UmFuZG9tQ29sb3IoKSB7CiAgICB2YXIgbGV0dGVycyA9ICcwMTIzNDU2Nzg5QUJDREVGJy5zcGxpdCgnJyk7CiAgICB2YXIgY29sb3IgPSAnIyc7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IDY7IGkrKykgewogICAgICAgIGNvbG9yICs9IGxldHRlcnNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTYpXTsKICAgIH0KICAgIHJldHVybiBjb2xvcjsKfQoKZnVuY3Rpb24gZ2V0UmFuZG9tSW50KG1pbiwgbWF4KSB7CiAgICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKG1heCAtIG1pbiArIDEpKSArIG1pbjsKfQoKZnVuY3Rpb24gY2FsY190ZW1wX2xpbWl0X2lkKCkgewogICAgdmFyIGQgPSBuZXcgRGF0ZSgpOwogICAgdmFyIHJhbmRvbWxpbWl0ID0gZC5nZXRUaW1lKCk7CiAgICBsb2dEZWJ1ZygiY2FsY190ZW1wX2xpbWl0X2lkPSIgKyByYW5kb21saW1pdCk7CiAgICByZXR1cm4gcmFuZG9tbGltaXQ7Cn0KCnZhciAkZ0xvZ0xldmVsID0gJ2RlYnVnJzsKCi8vIHN0YXJ0aW5nCmxvZ0RlYnVnKCJtYWluICRnTG9nTGV2ZWw9IiArICRnTG9nTGV2ZWwpOwpsb2dEZWJ1ZygiaW5pdGlhbGl6ZSBhbmd1bGFyIik7CmxvZ0RlYnVnKCJpbml0aWFsaXppbmcgbW9kdWxlcyAiICsgJGFuZ3VsYXJNb2R1bGVzKTsKCnZhciBrdXplQXBwID0gYW5ndWxhci5tb2R1bGUoJ2t1emVBcHAnLCAkYW5ndWxhck1vZHVsZXMpCgovLyRyb290U2NvcGUuc3BDbGFzcyA9ICdyaWdodCc7Cmt1emVSdW4gPSBmdW5jdGlvbigpIHsKCn0Ka3V6ZUFwcC5ydW4oWwogICAgJyRidWlsZGVyJywKICAgIGZ1bmN0aW9uKCRidWlsZGVyKSB7CiAgICAgICAgLy8gbG9nRGVidWcoImluc2lkZSBrdXplQXBwLnJ1biIpOwogICAgICAgICRidWlsZGVyLnJlZ2lzdGVyQ29tcG9uZW50KCdzYW1wbGVJbnB1dCcsIHsKICAgICAgICAgICAgZ3JvdXA6ICdmcm9tIGh0bWwnLAogICAgICAgICAgICBsYWJlbDogJ1NhbXBsZScsCiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnRnJvbSBodG1sIHRlbXBsYXRlJywKICAgICAgICAgICAgcGxhY2Vob2xkZXI6ICdwbGFjZWhvbGRlcicsCiAgICAgICAgICAgIHJlcXVpcmVkOiBmYWxzZSwKICAgICAgICAgICAgdmFsaWRhdGlvbk9wdGlvbnM6IFt7CiAgICAgICAgICAgICAgICBsYWJlbDogJ25vbmUnLAogICAgICAgICAgICAgICAgcnVsZTogJy8uKi8nCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgIGxhYmVsOiAnbnVtYmVyJywKICAgICAgICAgICAgICAgIHJ1bGU6ICdbbnVtYmVyXScKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgbGFiZWw6ICdlbWFpbCcsCiAgICAgICAgICAgICAgICBydWxlOiAnW2VtYWlsXScKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgbGFiZWw6ICd1cmwnLAogICAgICAgICAgICAgICAgcnVsZTogJ1t1cmxdJwogICAgICAgICAgICB9XSwKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYW5ndWxhci1mb3JtLWJ1aWxkZXIvZXhhbXBsZS90ZW1wbGF0ZS5odG1sJywKICAgICAgICAgICAgcG9wb3ZlclRlbXBsYXRlVXJsOiAnL2FuZ3VsYXItZm9ybS1idWlsZGVyL2V4YW1wbGUvcG9wb3ZlclRlbXBsYXRlLmh0bWwnCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuICRidWlsZGVyLnJlZ2lzdGVyQ29tcG9uZW50KCduYW1lJywgewogICAgICAgICAgICBncm91cDogJ0RlZmF1bHQnLAogICAgICAgICAgICBsYWJlbDogJ05hbWUnLAogICAgICAgICAgICByZXF1aXJlZDogZmFsc2UsCiAgICAgICAgICAgIGFycmF5VG9UZXh0OiB0cnVlLAogICAgICAgICAgICB0ZW1wbGF0ZTogIjxkaXYgY2xhc3M9XCJmb3JtLWdyb3VwXCI+XG4gICAgPGxhYmVsIGZvcj1cInt7Zm9ybU5hbWUraW5kZXh9fVwiIGNsYXNzPVwiY29sLW1kLTQgY29udHJvbC1sYWJlbFwiIG5nLWNsYXNzPVwieydmYi1yZXF1aXJlZCc6cmVxdWlyZWR9XCI+e3tsYWJlbH19PC9sYWJlbD5cbiAgICA8ZGl2IGNsYXNzPVwiY29sLW1kLThcIj5cbiAgICAgICAgPGlucHV0IHR5cGU9J2hpZGRlbicgbmctbW9kZWw9XCJpbnB1dFRleHRcIiB2YWxpZGF0b3ItcmVxdWlyZWQ9XCJ7e3JlcXVpcmVkfX1cIiB2YWxpZGF0b3ItZ3JvdXA9XCJ7e2Zvcm1OYW1lfX1cIi8+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJjb2wtc20tNlwiIHN0eWxlPVwicGFkZGluZy1sZWZ0OiAwO1wiPlxuICAgICAgICAgICAgPGlucHV0IHR5cGU9XCJ0ZXh0XCJcbiAgICAgICAgICAgICAgICBuZy1tb2RlbD1cImlucHV0QXJyYXlbMF1cIlxuICAgICAgICAgICAgICAgIGNsYXNzPVwiZm9ybS1jb250cm9sXCIgaWQ9XCJ7e2Zvcm1OYW1lK2luZGV4fX0tMFwiLz5cbiAgICAgICAgICAgIDxwIGNsYXNzPSdoZWxwLWJsb2NrJz5GaXJzdCBuYW1lPC9wPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImNvbC1zbS02XCIgc3R5bGU9XCJwYWRkaW5nLWxlZnQ6IDA7XCI+XG4gICAgICAgICAgICA8aW5wdXQgdHlwZT1cInRleHRcIlxuICAgICAgICAgICAgICAgIG5nLW1vZGVsPVwiaW5wdXRBcnJheVsxXVwiXG4gICAgICAgICAgICAgICAgY2xhc3M9XCJmb3JtLWNvbnRyb2xcIiBpZD1cInt7Zm9ybU5hbWUraW5kZXh9fS0xXCIvPlxuICAgICAgICAgICAgPHAgY2xhc3M9J2hlbHAtYmxvY2snPkxhc3QgbmFtZTwvcD5cbiAgICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG48L2Rpdj4iLAogICAgICAgICAgICBwb3BvdmVyVGVtcGxhdGU6ICI8Zm9ybT5cbiAgICA8ZGl2IGNsYXNzPVwiZm9ybS1ncm91cFwiPlxuICAgICAgICA8bGFiZWwgY2xhc3M9J2NvbnRyb2wtbGFiZWwnPkxhYmVsPC9sYWJlbD5cbiAgICAgICAgPGlucHV0IHR5cGU9J3RleHQnIG5nLW1vZGVsPVwibGFiZWxcIiB2YWxpZGF0b3I9XCJbcmVxdWlyZWRdXCIgY2xhc3M9J2Zvcm0tY29udHJvbCcvPlxuICAgIDwvZGl2PlxuICAgIDxkaXYgY2xhc3M9XCJjaGVja2JveFwiPlxuICAgICAgICA8bGFiZWw+XG4gICAgICAgICAgICA8aW5wdXQgdHlwZT0nY2hlY2tib3gnIG5nLW1vZGVsPVwicmVxdWlyZWRcIiAvPlxuICAgICAgICAgICAgUmVxdWlyZWRcbiAgICAgICAgPC9sYWJlbD5cbiAgICA8L2Rpdj5cblxuICAgIDxoci8+XG4gICAgPGRpdiBjbGFzcz0nZm9ybS1ncm91cCc+XG4gICAgICAgIDxpbnB1dCB0eXBlPSdzdWJtaXQnIG5nLWNsaWNrPVwicG9wb3Zlci5zYXZlKCRldmVudClcIiBjbGFzcz0nYnRuIGJ0bi1wcmltYXJ5JyB2YWx1ZT0nU2F2ZScvPlxuICAgICAgICA8aW5wdXQgdHlwZT0nYnV0dG9uJyBuZy1jbGljaz1cInBvcG92ZXIuY2FuY2VsKCRldmVudClcIiBjbGFzcz0nYnRuIGJ0bi1kZWZhdWx0JyB2YWx1ZT0nQ2FuY2VsJy8+XG4gICAgICAgIDxpbnB1dCB0eXBlPSdidXR0b24nIG5nLWNsaWNrPVwicG9wb3Zlci5yZW1vdmUoJGV2ZW50KVwiIGNsYXNzPSdidG4gYnRuLWRhbmdlcicgdmFsdWU9J0RlbGV0ZScvPlxuICAgIDwvZGl2PlxuPC9mb3JtPiIKICAgICAgICB9KTsKICAgIH0KXSkKCmt1emVBcHAucnVuKGZ1bmN0aW9uKCRyb290U2NvcGUpIHsKICBsb2dEZWJ1ZygicnVuICRyb290U2NvcGUiKTsKICAkcm9vdFNjb3BlLiRvbignbG9hZGluZzpwcm9ncmVzcycsIGZ1bmN0aW9uICgpewogICAgICAvLyBzaG93IGxvYWRpbmcgZ2lmCiAgICAgIC8vICRzY29wZS5jdXJzb3JkZWxldGU9IndhaXQiOwogICAgICAvLyBkb2N1bWVudC5ib2R5LnN0eWxlLmN1cnNvcj0nd2FpdCc7CiAgfSk7CgogICRyb290U2NvcGUuJG9uKCdsb2FkaW5nOmZpbmlzaCcsIGZ1bmN0aW9uICgpewogICAgLy8gJHNjb3BlLmN1cnNvcmRlbGV0ZT0iIjsKICAgIC8vIGRvY3VtZW50LmJvZHkuc3R5bGUuY3Vyc29yPScnOwogIH0pOwp9KTsKCi8vIERFTEVURUQgLSB4ZWRpdGFibGUgc3R1ZmYKLy8ga3V6ZUFwcC5ydW4oZnVuY3Rpb24oZWRpdGFibGVPcHRpb25zLCBlZGl0YWJsZVRoZW1lcykgewovLyAgICAgbG9nRGVidWcoImluaXRpYWxpemluZyB4ZWRpdGFibGUgZWRpdGFibGVPcHRpb25zIik7Ci8vICAgICBlZGl0YWJsZU9wdGlvbnMudGhlbWUgPSAnYnMzJzsgLy8gYm9vdHN0cmFwMyB0aGVtZS4gQ2FuIGJlIGFsc28gJ2JzMicsICdkZWZhdWx0JwovLyAgICAgLy8gZWRpdGFibGVPcHRpb25zLmRlZmF1bHRzLm1vZGUgPSAnaW5saW5lJzsKLy8gICAgIGxvZ0RlYnVnKGVkaXRhYmxlT3B0aW9ucyk7Ci8vICAgICAvLyBlZGl0YWJsZU9wdGlvbnMubW9kZSA9ICdpbmxpbmUnOwovLyAgICAgZWRpdGFibGVUaGVtZXMuYnMzLmlucHV0Q2xhc3MgPSAnaW5wdXQtc20nOwovLyAgICAgZWRpdGFibGVUaGVtZXMuYnMzLmJ1dHRvbnNDbGFzcyA9ICdidG4tc20nOwovLyB9KTsKCi8vIGFmdGVyIGZvcm1zCi8vRGVmaW5lIFJvdXRpbmcgZm9yIGFwcAovL1VyaSAvQWRkTmV3T3JkZXIgLT4gdGVtcGxhdGUgYWRkX29yZGVyLmh0bWwgYW5kIENvbnRyb2xsZXIgQ2xpZW50c0FkZENvbnRyb2xsZXIKLy9VcmkgL1Nob3dPcmRlcnMgLT4gdGVtcGxhdGUgc2hvd19vcmRlcnMuaHRtbCBhbmQgQ29udHJvbGxlciBDbGllbnRzQWRkQ29udHJvbGxlcgprdXplQXBwLmNvbmZpZyhbJyRyb3V0ZVByb3ZpZGVyJywKICAgIGZ1bmN0aW9uKCRyb3V0ZVByb3ZpZGVyKSB7CiAgICAgICAgLy8gbG9nRGVidWcoJHJvdXRlUHJvdmlkZXIpOwogICAgICAgICRyb3V0ZVByb3ZpZGVyLgogICAgICAgIC8vIHdoZW4oJy9jbGllbnRjYXJkJywgewogICAgICAgIC8vICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19jbGllbnRfY2FyZC5odG1sJywKICAgICAgICAvLyAgICAgY29udHJvbGxlcjogJ2NsaWVudENhcmRDb250cm9sbGVyJwogICAgICAgIC8vIH0pLgogICAgICAgIHdoZW4oJy9jb250YWN0JywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdjb250YWN0LnBocCcsCiAgICAgICAgICAgIC8vIGNvbnRyb2xsZXI6ICdlbmRVc2VySG9tZUNvbnRyb2xsZXInCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdjb250YWN0Q29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvZXZlbnRfdHlwZXMnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2V2ZW50X3R5cGVzLmh0bWwnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnRXZlbnRUeXBlc0NvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2V2ZW50X3R5cGVzL2FkZCcsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfZXZlbnRfdHlwZV9hZGQucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0V2ZW50VHlwZU5ld0NvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2V2ZW50X3R5cGVzLzpldmVudF90eXBlX2lkJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19ldmVudF90eXBlX2FkZC5waHAnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnRXZlbnRUeXBlVXBkYXRlQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvaG91cnNfb2Zfd29yaycsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfaG91cnNfb2Zfd29yay5odG1sJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0hvdXJzT2ZXb3JrQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvYnVzaW5lc3NfY2FsZW5kYXInLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2NhbGVuZGFyLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdCdXNpbmVzc0NhbGVuZGFyQ29udHJvbGxlcicsCiAgICAgICAgICAgIHJlbG9hZE9uU2VhcmNoOiBmYWxzZQogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9hbmd1bGFyLWZvcm0tYnVpbGRlcicsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYW5ndWxhci1mb3JtLWJ1aWxkZXIvaW5kZXguaHRtbCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdEZW1vQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvYnVzaW5lc3NfY2xpZW50cy9hZGQnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2NsaWVudHNfYWRkLmh0bWwnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnQ2xpZW50c0FkZENvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2J1c2luZXNzX2NsaWVudHMnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2NsaWVudHMucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0NsaWVudHNTaG93Q29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvYnVzaW5lc3NfY2xpZW50cy86YnVzaW5lc3NfdXNlcl9pZCcsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6IGZ1bmN0aW9uKHBhcmFtcykgewogICAgICAgICAgICAgICAgcmV0dXJuICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfY2xpZW50X2NhcmQucGhwP2J1c2luZXNzX3VzZXJfaWQ9JyArIHBhcmFtcy5idXNpbmVzc191c2VyX2lkIDsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgY29udHJvbGxlcjogJ0NsaWVudHNTaG93MUNvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2J1c2luZXNzX3JlcG9ydHMnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX3JlcG9ydHMuaHRtbCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdCdXNpbmVzc1JlcG9ydHNDb250cm9sbGVyJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9idXNpbmVzc19pbnN0cnVjdG9ycycsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfaW5zdHJ1Y3RvcnMucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0luc3RydWN0b3JzU2hvd0NvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2J1c2luZXNzX2luc3RydWN0b3JzL2FkZCcsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfY2xpZW50c19hZGQuaHRtbCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdJbnN0cnVjdG9yc0FkZENvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2J1c2luZXNzX2xvY2F0aW9ucycsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbG9jYXRpb25zLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdidXNpbmVzc19sb2NhdGlvbnMnCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2J1c2luZXNzX2xvY2F0aW9ucy9hZGQnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2xvY2F0aW9uc19hZGQucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ2J1c2luZXNzX2xvY2F0aW9uc19hZGQnCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2J1c2luZXNzX2xvY2F0aW9ucy86bG9jYXRpb25faWQnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2xvY2F0aW9uc19hZGQucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ2J1c2luZXNzX2xvY2F0aW9uc191cGRhdGUnCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2J1c2luZXNzX2luc3RydWN0b3JzLzpidXNpbmVzc191c2VyX2lkJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19pbnN0cnVjdG9yX2NhcmQucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0luc3RydWN0b3JTaG93MUNvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2V2ZW50LzpldmVudF9pZCcsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6IGZ1bmN0aW9uKHBhcmFtcykgewogICAgICAgICAgICAgICAgcmV0dXJuICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfZXZlbnRfY2FyZC5waHA/ZXZlbnRfaWQ9JyArIHBhcmFtcy5ldmVudF9pZCA7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdFdmVudFBhZ2VDb250cm9sbGVyJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9ldmVudF9jbGFzcy86ZXZlbnRfaWQnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBmdW5jdGlvbihwYXJhbXMpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2V2ZW50X2NsYXNzX2NhcmQucGhwP2V2ZW50X2lkPScgKyBwYXJhbXMuZXZlbnRfaWQgOwogICAgICAgICAgICB9LAogICAgICAgICAgICBjb250cm9sbGVyOiAnRXZlbnRDbGFzc1BhZ2VDb250cm9sbGVyJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9wYWNrYWdlcycsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfcGFja2FnZXNfc2hvdy5waHAnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnUGFja2FnZXNDb250cm9sbGVyJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9wYWNrYWdlcy9hZGQnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX3BhY2thZ2VzX2NyZWF0ZS5waHAnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnYnVzaW5lc3NfcGFja2FnZXNfYWRkX2NudGwnCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL3BhY2thZ2VzLzpwYWNrYWdlX2lkJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19wYWNrYWdlc19jcmVhdGUucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ2J1c2luZXNzX3BhY2thZ2VzX3VwZGF0ZV9jbnRsJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9idXNpbmVzc19jb25maWcnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2NvbmZpZy5waHAnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnQ29uZmlnQnVzaW5lc3NDb250cm9sbGVyJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy91c2VyX2NvbmZpZycsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAndXNlcl9jb25maWcucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0NvbmZpZ1VzZXJDb250cm9sbGVyJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9idXNpbmVzc19kb2NzJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19kb2NzLmh0bWwnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnQnVzaW5lc3NEb2NzQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdob21lLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdIb21lQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICBvdGhlcndpc2UoewogICAgICAgICAgICAvLyAgICByZWRpcmVjdFRvOiAnLycKICAgICAgICB9KTsKICAgIH0KXSk7CgprdXplQXBwLmZhY3RvcnkoJ2h0dHBJbnRlcmNlcHRvcicsIFsnJHEnLCAnJHJvb3RTY29wZScsCiAgICBmdW5jdGlvbiAoJHEsICRyb290U2NvcGUpIHsKICAgICAgICB2YXIgbG9hZGluZ0NvdW50ID0gMDsKCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgcmVxdWVzdDogZnVuY3Rpb24gKGNvbmZpZykgewogICAgICAgICAgICAgICAgaWYoKytsb2FkaW5nQ291bnQgPT09IDEpICRyb290U2NvcGUuJGJyb2FkY2FzdCgnbG9hZGluZzpwcm9ncmVzcycpOwogICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpZyB8fCAkcS53aGVuKGNvbmZpZyk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICByZXNwb25zZTogZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICBpZigtLWxvYWRpbmdDb3VudCA9PT0gMCkgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdsb2FkaW5nOmZpbmlzaCcpOwogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlIHx8ICRxLndoZW4ocmVzcG9uc2UpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgcmVzcG9uc2VFcnJvcjogZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICBpZigtLWxvYWRpbmdDb3VudCA9PT0gMCkgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdsb2FkaW5nOmZpbmlzaCcpOwogICAgICAgICAgICAgICAgcmV0dXJuICRxLnJlamVjdChyZXNwb25zZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgfQpdKS5jb25maWcoWyckaHR0cFByb3ZpZGVyJywgZnVuY3Rpb24gKCRodHRwUHJvdmlkZXIpIHsKICAgICRodHRwUHJvdmlkZXIuaW50ZXJjZXB0b3JzLnB1c2goJ2h0dHBJbnRlcmNlcHRvcicpOwp9XSk7CgprdXplQXBwLmZhY3RvcnkoJ3NoYXJlZERhdGEnLCBmdW5jdGlvbigpIHsKICAgIHZhciBzZWxlY3RlZEVuZFVzZXIgPSBudWxsOwoKICAgIHJldHVybiB7CiAgICAgICAgZ2V0U2VsZWN0ZWRFbmRVc2VyOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgLy9Zb3UgY291bGQgYWxzbyByZXR1cm4gc3BlY2lmaWMgYXR0cmlidXRlIG9mIHRoZSBmb3JtIGRhdGEgaW5zdGVhZAogICAgICAgICAgICAvL29mIHRoZSBlbnRpcmUgZGF0YQogICAgICAgICAgICByZXR1cm4gc2VsZWN0ZWRFbmRVc2VyOwogICAgICAgIH0sCiAgICAgICAgc2V0U2VsZWN0ZWRFbmRVc2VyOiBmdW5jdGlvbihuZXdTZWxlY3RlZEVuZFVzZXIpIHsKICAgICAgICAgICAgLy9Zb3UgY291bGQgYWxzbyBzZXQgc3BlY2lmaWMgYXR0cmlidXRlIG9mIHRoZSBmb3JtIGRhdGEgaW5zdGVhZAogICAgICAgICAgICBzZWxlY3RlZEVuZFVzZXIgPSBuZXdTZWxlY3RlZEVuZFVzZXI7CiAgICAgICAgfSwKICAgIH07Cn0pOwoKa3V6ZUFwcC5kaXJlY3RpdmUoJ2NvbnZlcnRUb051bWJlcicsIGZ1bmN0aW9uKCkgewogIHJldHVybiB7CiAgICByZXF1aXJlOiAnbmdNb2RlbCcsCiAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWxlbWVudCwgYXR0cnMsIG5nTW9kZWwpIHsKICAgICAgbmdNb2RlbC4kcGFyc2Vycy5wdXNoKGZ1bmN0aW9uKHZhbCkgewogICAgICAgIHJldHVybiB2YWwgIT0gbnVsbCA/IHBhcnNlSW50KHZhbCwgMTApIDogbnVsbDsKICAgICAgfSk7CiAgICAgIG5nTW9kZWwuJGZvcm1hdHRlcnMucHVzaChmdW5jdGlvbih2YWwpIHsKICAgICAgICByZXR1cm4gdmFsICE9IG51bGwgPyAnJyArIHZhbCA6IG51bGw7CiAgICAgIH0pOwogICAgfQogIH07Cn0pOwoKa3V6ZUFwcC5kaXJlY3RpdmUoJ2VsYXN0aWMnLCBbCiAgICAnJHRpbWVvdXQnLAogICAgZnVuY3Rpb24oJHRpbWVvdXQpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICByZXN0cmljdDogJ0EnLAogICAgICAgICAgICBsaW5rOiBmdW5jdGlvbigkc2NvcGUsIGVsZW1lbnQpIHsKICAgICAgICAgICAgICAgICRzY29wZS5pbml0aWFsSGVpZ2h0ID0gJHNjb3BlLmluaXRpYWxIZWlnaHQgfHwgZWxlbWVudFswXS5zdHlsZS5oZWlnaHQ7CiAgICAgICAgICAgICAgICB2YXIgcmVzaXplID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgZWxlbWVudFswXS5zdHlsZS5oZWlnaHQgPSAkc2NvcGUuaW5pdGlhbEhlaWdodDsKICAgICAgICAgICAgICAgICAgICBlbGVtZW50WzBdLnN0eWxlLmhlaWdodCA9ICIiICsgZWxlbWVudFswXS5zY3JvbGxIZWlnaHQgKyAicHgiOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIGVsZW1lbnQub24oImlucHV0IGNoYW5nZSIsIHJlc2l6ZSk7CiAgICAgICAgICAgICAgICAvLyBlbGVtZW50Lm9uKCJpbnB1dCBjaGFuZ2UiLCByZXNpemUpOwogICAgICAgICAgICAgICAgJHRpbWVvdXQocmVzaXplLCAwKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICB9Cl0pOwoKa3V6ZUFwcC5zZXJ2aWNlKCdzaGFyZWRQcm9wZXJ0aWVzJywgZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBzZWxlY3RlZF91c2VyID0gbnVsbDsKICAgICAgICB2YXIgY2FsZW5kYXJfZGF0ZSA9IG51bGw7CiAgICAgICAgdmFyIGV2ZW50X3Jlc2NoZWR1bGUgPSBudWxsOwogICAgICAgIHZhciBzZWxlY3RlZF9pbnN0cnVjdG9yID0gMDsKICAgICAgICB2YXIgZXZlbnRfdHlwZV9mb3Jfc3VnZ2VzdGlvbnMgPSBudWxsOwogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGdldF9zZWxlY3RlZF9pbnN0cnVjdG9yOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZWN0ZWRfaW5zdHJ1Y3RvcjsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2V0X3NlbGVjdGVkX2luc3RydWN0b3I6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgICAgICAgICBzZWxlY3RlZF9pbnN0cnVjdG9yID0gdmFsdWU7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGdldF9zZWxlY3RlZF91c2VyOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZWN0ZWRfdXNlcjsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2V0X3NlbGVjdGVkX3VzZXI6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgICAgICAgICBzZWxlY3RlZF91c2VyID0gdmFsdWU7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNldF9ldmVudF9yZXNjaGVkdWxlOiBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgICAgICAgICAgZXZlbnRfcmVzY2hlZHVsZSA9IHZhbHVlOwogICAgICAgICAgICB9LAogICAgICAgICAgICBnZXRfZXZlbnRfcmVzY2hlZHVsZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGV2ZW50X3Jlc2NoZWR1bGU7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGdldF9jYWxlbmRhcl9kYXRlOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gY2FsZW5kYXJfZGF0ZTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2V0X2NhbGVuZGFyX2RhdGU6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgICAgICAgICBjYWxlbmRhcl9kYXRlID0gdmFsdWU7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGdldF9ldmVudF90eXBlX2Zvcl9zdWdnZXN0aW9uczogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGV2ZW50X3R5cGVfZm9yX3N1Z2dlc3Rpb25zOwogICAgICAgICAgICB9LAogICAgICAgICAgICBzZXRfZXZlbnRfdHlwZV9mb3Jfc3VnZ2VzdGlvbnM6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgICAgICAgICAvLyBsb2dEZWJ1Zygic2V0X2V2ZW50X3R5cGVfZm9yX3N1Z2dlc3Rpb25zPSIrdmFsdWUpOwogICAgICAgICAgICAgICAgZXZlbnRfdHlwZV9mb3Jfc3VnZ2VzdGlvbnMgPSB2YWx1ZTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICB9KTsKCmt1emVBcHAuY29udHJvbGxlcignbWVudUNvbnRyb2xsZXInLCBbJyRzY29wZScsICckbG9jYXRpb24nLCBmdW5jdGlvbigkc2NvcGUsICRsb2NhdGlvbikgewogICAgcmV0dXJuIHRydWU7CiAgICBsb2dEZWJ1ZygiJHNjb3BlLmlzQ3VycmVudFBhdGg9IiArICRzY29wZS5pc0N1cnJlbnRQYXRoKTsKICAgICRzY29wZS5pc0N1cnJlbnRQYXRoID0gZnVuY3Rpb24ocGF0aCkgewogICAgICAgIHJldHVybiAkbG9jYXRpb24ucGF0aCgpID09IHBhdGg7CiAgICB9Owp9XSk7CgoKCmt1emVBcHAuY29udHJvbGxlcignQnVzaW5lc3NSZXBvcnRzQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbiwkcm91dGVQYXJhbXMpCnsKCiAgbG9nRGVidWcoImNvbnRyb2xsZXI6IEJ1c2luZXNzUmVwb3J0c0NvbnRyb2xsZXIiKTsKCiAgJHNjb3BlLm9yZGVyQnlGaWVsZCA9ICdzdGFydF9lcG9jaCc7CiAgJHNjb3BlLnJldmVyc2VTb3J0PXRydWU7CiAgJHNjb3BlLmV2ZW50TW9kZWw9dHJ1ZTsKCiAgZ2V0QnVzaW5lc3NMb2NhdGlvbnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19sb2NhdGlvbnMnKTsKICBnZXRBbGxCdXNpbmVzc0V2ZW50VHlwZXMoJGh0dHAsJHNjb3BlLCdldmVudF90eXBlcycpOwogIGdldEFsbEluc3RydWN0b3JzKCRodHRwLCRzY29wZSwnaW5zdHJ1Y3RvcnMnKTsKICBnZXRBbGxDbGllbnRzQW5kQXJjaGl2ZSgkaHR0cCwkc2NvcGUsJ2NsaWVudHMnKTsKICAkc2NvcGUuc3RhdHVzZXMgPSBbIHsic3RhdHVzX2lkIjoiMCIsInN0YXR1c19uYW1lIjoi16TXqteV15cifSwgeyJzdGF0dXNfaWQiOiIxIiwic3RhdHVzX25hbWUiOiLXodeS15XXqCJ9XTsKICAkc2NvcGUuY2FuY2VsbGF0aW9ucyA9IFsgeyJpc19jYW5jZWxlZCI6IjAiLCJjYW5jZWxsYXRpb25fbmFtZSI6Itec15Ag15HXldeY15wifSx7ImlzX2NhbmNlbGVkIjoiMSIsImNhbmNlbGxhdGlvbl9uYW1lIjoi15HXldeY15wifV07CiAgJHNjb3BlLm1vbnRocyA9IFsgeyJtb250aCI6IjEifSx7Im1vbnRoIjoiMiJ9LHsibW9udGgiOiIzIn0seyJtb250aCI6IjQifSx7Im1vbnRoIjoiNSJ9LHsibW9udGgiOiI2In0seyJtb250aCI6IjcifSx7Im1vbnRoIjoiOCJ9LHsibW9udGgiOiI5In0seyJtb250aCI6IjEwIn0seyJtb250aCI6IjExIn0seyJtb250aCI6IjEyIn1dOwogICRzY29wZS55ZWFycyA9IFsgeyJ5ZWFyIjoiMjAxNiJ9LHsieWVhciI6IjIwMTcifV07CiAgJHNjb3BlLnBlcmlvZHMgPSBbCiAgICAgIHsicGVyaW9kX25hbWUiOiLXlNeZ16HXmNeV16jXmSIsICJwZXJpb2Rfc2lnbiI6Ii0xIn0sCiAgICAgIHsicGVyaW9kX25hbWUiOiLXlNeZ15XXnSIsICJwZXJpb2Rfc2lnbiI6IjAifSwKICAgICAgeyJwZXJpb2RfbmFtZSI6Itei16rXmdeT15kiLCAicGVyaW9kX3NpZ24iOiIxIn0sCiAgICBdCgogICRzY29wZS5jc3ZfY29sdW1uc19vcmRlciA9IFsnZXZlbnRfdHlwZV9uYW1lJywgJ3N0YXJ0X3RpbWUnLCAnZXZlbnRfdXNlcl9jbGllbnRzJywgJ2luc3RydWN0b3JfbmFtZScsICdpc19jYW5jZWxlZCcsICdpc19jb21wbGV0ZWQnLCAnYWN0dWFsX3ByaWNlJywgJ3BhcnRpY2lwYXRlZCddOwogICRzY29wZS5jc3ZfY29sdW1uc19oZWFkZXIgPSBbJ9eh15XXkiDXntek15LXqScsICfXqteQ16jXmdeaINeV16nXoteUJywgJ9ee16nXqteq16TXmdedJywgJ9ee15PXqNeZ15onLCfXnteR15XXmNecJywgJ9eh15LXldeoJywgJ9ee15fXmdeoJywgJ9ee16nXqteq16TXmdedJ107CgoKCiAgJHNjb3BlLmdvdG9DbGllbnRQYWdlPSBmdW5jdGlvbiAoYnVzaW5lc3NVc2VyaWQpIHsKICAgIGdvdG9DbGllbnRQYWdlKGJ1c2luZXNzVXNlcmlkKTsKICB9CgogIGZ1bmN0aW9uIGxpc3RfdG9fc3RyaW5nX2J5X3ZhbHVlKHgsdmFsdWUpewogICAgaWYgKCB4ICE9IHVuZGVmaW5lZCApewogICAgICB2YXIgeDEgPSBuZXcgQXJyYXkoKTsKICAgICAgZm9yIChpID0gMDsgaSA8IHgubGVuZ3RoOyBpKyspewogICAgICAgIHgxW2ldID0geFtpXVt2YWx1ZV07CiAgICAgIH0KICAgICAgeDEgPSB4MS5qb2luKCk7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICByZXR1cm4geDE7CiAgfQoKICAkc2NvcGUucmVwb3J0X2lzX2xvYWRpbmcgPSBmYWxzZTsKCiRzY29wZS5ldmVudHNSZXBvcnQgPSBmdW5jdGlvbigpewpsb2dEZWJ1ZygiZXZlbnRzUmVwb3J0Iik7Cgokc2NvcGUuc2hvd0FnZyA9ICgkc2NvcGUuZXZlbnRUeXBlTW9kZWwpIHx8Cigkc2NvcGUuaW5zdHJ1Y3Rvck1vZGVsKSB8fCAoJHNjb3BlLm1vbnRoTW9kZWwpIHx8ICgkc2NvcGUuY2xpZW50c01vZGVsKSB8fCAoJHNjb3BlLnllYXJNb2RlbCkgOwoKZXZlbnRfdHlwZV9pZF9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuc2VsZWN0ZWRFdmVudFR5cGVGaWx0ZXIsICJldmVudF90eXBlX2lkIiApOwppbnN0cnVjdG9yX2lkX2ZpbHRlciA9IGxpc3RfdG9fc3RyaW5nX2J5X3ZhbHVlKCRzY29wZS5zZWxlY3RlZEluc3RydWN0b3JGaWx0ZXIsICJidXNpbmVzc191c2VyX2lkIiApOwptb250aF9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuc2VsZWN0ZWRNb250aEZpbHRlciwgIm1vbnRoIiApOwpjbGllbnRfZmlsdGVyID0gbGlzdF90b19zdHJpbmdfYnlfdmFsdWUoJHNjb3BlLnNlbGVjdGVkQ2xpZW50RmlsdGVyLCAiYnVzaW5lc3NfdXNlcl9pZCIgKTsKeWVhcl9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuc2VsZWN0ZWRZZWFyRmlsdGVyLCAieWVhciIgKTsKc3RhdHVzX2ZpbHRlciA9IGxpc3RfdG9fc3RyaW5nX2J5X3ZhbHVlKCRzY29wZS5zZWxlY3RlZFN0YXR1c0ZpbHRlciwgInN0YXR1c19pZCIgKTsKaXNfY2FuY2VsZWRfZmlsdGVyID0gbGlzdF90b19zdHJpbmdfYnlfdmFsdWUoJHNjb3BlLnNlbGVjdGVkSXNfY2FuY2VsZWRGaWx0ZXIsICJpc19jYW5jZWxlZCIgKTsKcGVyaW9kX2ZpbHRlciA9IGxpc3RfdG9fc3RyaW5nX2J5X3ZhbHVlKCRzY29wZS5zZWxlY3RlZFBlcmlvZEZpbHRlciwgInBlcmlvZF9zaWduIiApOwoKJHNjb3BlLmV2ZW50UmVwb3J0Q29uZmlnID0ge307CgogICAgJHNjb3BlLmV2ZW50UmVwb3J0Q29uZmlnLnNvdXJjZSA9ICJkb2NzIjsKCiRzY29wZS5ldmVudFJlcG9ydENvbmZpZy5maWx0ZXJzID0gewpldmVudF90eXBlX2lkOiBldmVudF90eXBlX2lkX2ZpbHRlciwKaW5zdHJ1Y3Rvcl9pZDogaW5zdHJ1Y3Rvcl9pZF9maWx0ZXIsCm1vbnRoOiBtb250aF9maWx0ZXIsCnllYXI6IHllYXJfZmlsdGVyLApjbGllbnQ6IGNsaWVudF9maWx0ZXIsCnN0YXR1czogc3RhdHVzX2ZpbHRlciwKcGVyaW9kOiBwZXJpb2RfZmlsdGVyLAppc19jYW5jZWxlZDogaXNfY2FuY2VsZWRfZmlsdGVyCn07Cgokc2NvcGUuZXZlbnRSZXBvcnRDb25maWcuYWdncmVnYXRpb25zID0gewpldmVudF90eXBlX2lkOiAkc2NvcGUuZXZlbnRUeXBlTW9kZWwsCmluc3RydWN0b3JfaWQ6ICRzY29wZS5pbnN0cnVjdG9yTW9kZWwsCm1vbnRoOiAkc2NvcGUubW9udGhNb2RlbCwKeWVhcjogJHNjb3BlLnllYXJNb2RlbCwKY2xpZW50OiAkc2NvcGUuY2xpZW50TW9kZWwsCn07CgppZiAoICRzY29wZS5zaG93QWdnICkgewogICAgICBnZXRFdmVudHNSZXBvcnQoJGh0dHAsJHNjb3BlLCAkc2NvcGUuZXZlbnRSZXBvcnRDb25maWcsIGdldEV2ZW50c1JlcG9ydEFnZ3JlZ2F0ZWRfc3VjY2Vzcyk7CiRzY29wZS5yZXBvcnRfaXNfbG9hZGluZyA9IHRydWU7Cn0gZWxzZSB7CiAgICAgIGdldEV2ZW50c1JlcG9ydCgkaHR0cCwkc2NvcGUsICRzY29wZS5ldmVudFJlcG9ydENvbmZpZywgZ2V0RXZlbnRzUmVwb3J0TGlzdF9zdWNjZXNzKTsKJHNjb3BlLnJlcG9ydF9pc19sb2FkaW5nID0gdHJ1ZTsKfQoKZnVuY3Rpb24gZ2V0RXZlbnRzUmVwb3J0TGlzdF9zdWNjZXNzKHJlc3BvbnNlKXsKJHNjb3BlLkV2ZW50UmVwb3J0TGlzdCA9IHJlc3BvbnNlLmpzb247CiRzY29wZS5kb3dubG9hZF9yZXBvcnQgPSAkc2NvcGVbICdFdmVudFJlcG9ydExpc3QnIF07CiRzY29wZS5yZXBvcnRfaXNfbG9hZGluZyA9IGZhbHNlOwp9CgpmdW5jdGlvbiBnZXRFdmVudHNSZXBvcnRBZ2dyZWdhdGVkX3N1Y2Nlc3MocmVzcG9uc2Upewokc2NvcGUuRXZlbnRSZXBvcnRBZ2dyZWdhdGVkID0gcmVzcG9uc2UuanNvbjsKJHNjb3BlLmRvd25sb2FkX3JlcG9ydCA9ICRzY29wZVsgJ0V2ZW50UmVwb3J0QWdncmVnYXRlZCcgXTsKJHNjb3BlLnJlcG9ydF9pc19sb2FkaW5nID0gZmFsc2U7Cn0KCmZ1bmN0aW9uIGdldENsaWVudHNSZXBvcnRMaXN0X3N1Y2Nlc3MocmVzcG9uc2Upewokc2NvcGUuQ2xpZW50c1JlcG9ydExpc3QgPSByZXNwb25zZS5qc29uOwpjb25zb2xlLmxvZygiLS0tLS0tLS0tLS0tIikKY29uc29sZS5sb2coJHNjb3BlLkNsaWVudHNSZXBvcnRMaXN0KQpjb25zb2xlLmxvZygiLS0tLS0tLS0tLS0tIikKJHNjb3BlLnJlcG9ydF9pc19sb2FkaW5nID0gZmFsc2U7Cn0KCgp9Cgokc2NvcGUuY2xpZW50c1JlcG9ydCA9IGZ1bmN0aW9uKCl7CmxvZ0RlYnVnKCJjbGllbnRzUmVwb3J0Iik7CgpjbGllbnRfZmlsdGVyID0gbGlzdF90b19zdHJpbmdfYnlfdmFsdWUoJHNjb3BlLnNlbGVjdGVkQ2xpZW50RmlsdGVyLCAiY2xpZW50IiApOwoKJHNjb3BlLmV2ZW50UmVwb3J0Q29uZmlnID0ge307Cgokc2NvcGUuZXZlbnRSZXBvcnRDb25maWcuZmlsdGVycyA9IHsKY2xpZW50OiBjbGllbnRfZmlsdGVyLAp9OwoKJHNjb3BlLmV2ZW50UmVwb3J0Q29uZmlnLmFnZ3JlZ2F0aW9ucyA9IHsKfTsKCmdldENsaWVudHNSZXBvcnQoJGh0dHAsJHNjb3BlLCBnZXRDbGllbnRzUmVwb3J0X3N1Y2Nlc3MpOwokc2NvcGUucmVwb3J0X2lzX2xvYWRpbmcgPSB0cnVlOwpmdW5jdGlvbiBnZXRDbGllbnRzUmVwb3J0X3N1Y2Nlc3MocmVzcG9uc2Upewokc2NvcGUuY2xpZW50UmVwb3J0ID0gcmVzcG9uc2UuanNvbjsKJHNjb3BlLmRvd25sb2FkX3JlcG9ydCA9ICRzY29wZVsgJ2NsaWVudFJlcG9ydCcgXTsKJHNjb3BlLnJlcG9ydF9pc19sb2FkaW5nID0gZmFsc2U7Cn0KfQoKJHNjb3BlLmVkaXRFdmVudD0gZnVuY3Rpb24gKHRoZWV2ZW50KQp7CmdvdG9FdmVudFBhZ2UodGhlZXZlbnQpOwp9Cgokc2NvcGUuZXZlbnRzUmVwb3J0KCk7CiRzY29wZS5zZWxlY3RlZFJlcG9ydD0iZXZlbnRzIjsKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2J1c2luZXNzX3BhY2thZ2VzX3VwZGF0ZV9jbnRsJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uLCRyb3V0ZVBhcmFtcykKewokc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyID0ge307IC8vIHRoZXNlIGFyZSB0aGUgY29tcGxldGUgZGV0YWlscyBmb3IgdGhlIG5ldyBldmVudCAvLwokc2NvcGUucGFja2FnZV9pc191cGRhdGUgPSB0cnVlOwokc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLnBhY2thZ2VfbGltaXRfdHlwZT0xOwoKLy8gZ2V0dHRpbmcgdGhlIHBhY2thZ2UgYW5kIGl0cyBldmVudCB0eXBlcwpnZXRCdXNpbmVzc1BhY2thZ2UoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5wYWNrYWdlX2lkLCdmb3JtQWRkUGFja2FnZUFuZ3VsYXInLGZ1bmN0aW9uKHJlc3BvbnNlKQp7CiRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuaXNfdXBkYXRlID0gdHJ1ZTsKJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5vcmlnRXZlbnRUeXBlcz1hbmd1bGFyLmNvcHkoJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5zZWxlY3RlZEV2ZW50VHlwZXMpOwokc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLnBhY2thZ2VfbGltaXRfdHlwZT0xOwovLyB0aGVuIGdldHRpbmcgYWxsIHRoZSBldmVudCB0eXBlcwpnZXRFdmVudFR5cGVzTm9BZG1pbigkaHR0cCwkc2NvcGUsJ3JlbGF0ZWRFdmVudFR5cGVzJyxnZXRFdmVudFR5cGVzTm9BZG1pbl9zdWNjZXNzKTsKZnVuY3Rpb24gZ2V0RXZlbnRUeXBlc05vQWRtaW5fc3VjY2VzcygpCnsKLy8gdGhlbiByZW1vdmluZyBleGlzdGluZyBldmVudCB0eXBlcyBvZiBwYWNrYWdlIGZyb20gbGlzdAovLyBjb25zb2xlLmxvZygkc2NvcGUucmVsYXRlZEV2ZW50VHlwZXNbMF0pOwovLyBjb25zb2xlLmxvZygkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLnNlbGVjdGVkRXZlbnRUeXBlc1swXSk7CmZvcih2YXIgaSA9IDA7IGkgPCAkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLnNlbGVjdGVkRXZlbnRUeXBlcy5sZW5ndGg7IGkrKykKewovLyBjb3B5aW5nIHRoZSBhY3R1YWwgb2JqZWN0IG9mICRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuc2VsZWN0ZWRFdmVudFR5cGVzW2ldCmZvcih2YXIgaiA9IDA7IGogPCAkc2NvcGUucmVsYXRlZEV2ZW50VHlwZXMubGVuZ3RoOyBqKyspCnsKaWYgKCRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuc2VsZWN0ZWRFdmVudFR5cGVzW2ldLmV2ZW50X3R5cGVfaWQ9PSRzY29wZS5yZWxhdGVkRXZlbnRUeXBlc1tqXS5ldmVudF90eXBlX2lkKQp7CiRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuc2VsZWN0ZWRFdmVudFR5cGVzW2ldPWFuZ3VsYXIuY29weSgkc2NvcGUucmVsYXRlZEV2ZW50VHlwZXNbal0pOwp9Cn0KfQp9Cn0pOwokc2NvcGUuZ290b0JhY2sgPSBnb3RvQmFjazsKJHNjb3BlLmNyZWF0ZVBhY2thZ2UgPSBmdW5jdGlvbigpCnsKY29uc29sZS5sb2coInVwZGF0ZVBhY2thZ2VEZXRhaWxzIik7CnVwZGF0ZVBhY2thZ2VEZXRhaWxzKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMucGFja2FnZV9pZCwkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLHN1Y2Nlc3NfY2FsbGJhY2ssIGZhaWx1cmVfY2FsbGJhY2spOwpmdW5jdGlvbiBzdWNjZXNzX2NhbGxiYWNrKCkKewpnb3RvQmFjaygpOwp9CmZ1bmN0aW9uIGZhaWx1cmVfY2FsbGJhY2soKQp7CmdvdG9CYWNrKCk7Cn0KfTsKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2J1c2luZXNzX3BhY2thZ2VzX2FkZF9jbnRsJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uKSB7CmxvZ0RlYnVnKCdidXNpbmVzc19wYWNrYWdlc19hZGRfY250bCcpOwokc2NvcGUucGFja2FnZV9pc191cGRhdGUgPSBmYWxzZTsKJHNjb3BlLmdvdG9CYWNrID0gZ290b0JhY2s7CiRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIgPSB7fTsKJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5ldmVudHNfY291bnRlciA9IDE7CiRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuZXZlbnRzX3Blcl93ZWVrID0gMTsKJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5wYWNrYWdlX2R1cmF0aW9uX21vbnRocyA9IDM7CiRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIucGFja2FnZV9saW1pdF90eXBlPTE7CmdldEV2ZW50VHlwZXNOb0FkbWluKCRodHRwLCRzY29wZSwncmVsYXRlZEV2ZW50VHlwZXMnKTsKCiRzY29wZS5jcmVhdGVQYWNrYWdlID0gZnVuY3Rpb24oKQp7CmNyZWF0ZVBhY2thZ2UoJGh0dHAsJHNjb3BlLCRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIsY3JlYXRlUGFja2FnZV9zdWNjZXNzLCBjcmVhdGVQYWNrYWdlX2ZhaWx1cmUpOwpmdW5jdGlvbiBjcmVhdGVQYWNrYWdlX3N1Y2Nlc3MoKQp7CiRsb2NhdGlvbi5wYXRoKCcvcGFja2FnZXMnKTsKfQpmdW5jdGlvbiBjcmVhdGVQYWNrYWdlX2ZhaWx1cmUoKQp7Ci8vIGxvZ0Vycm9yKCJlcnJvciAiICsgZGF0YS5tZXNzYWdlKTsKLy8gJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5hamF4X2Vycm9yID0gZGF0YS5tZXNzYWdlOwp9Cn0KfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2J1c2luZXNzX2xvY2F0aW9ucycsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikgewpsb2dEZWJ1ZygnYnVzaW5lc3NfbG9jYXRpb25zIGNvbnRyb2xsZXInKTsKZ2V0QnVzaW5lc3NMb2NhdGlvbnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19sb2NhdGlvbnMnKTsKJHNjb3BlLmFkZE5ld0xvY2F0aW9uID0gZnVuY3Rpb24gKCkKewokbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2xvY2F0aW9ucy9hZGQnKTsKfQokc2NvcGUuZ290b0xvY2F0aW9uUGFnZSA9IGZ1bmN0aW9uKGxvY2F0aW9uX2lkKQp7CmdvdG9Mb2NhdGlvblBhZ2UobG9jYXRpb25faWQpOwp9Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignQnVzaW5lc3NEb2NzQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikgewpsb2dEZWJ1ZygnQnVzaW5lc3NEb2NzQ29udHJvbGxlcicpOwp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ2J1c2luZXNzX2xvY2F0aW9uc191cGRhdGUnLCBmdW5jdGlvbigkc2NvcGUsICRyb3V0ZVBhcmFtcywgJGh0dHAsICRsb2NhdGlvbikgewpsb2dEZWJ1ZygnYnVzaW5lc3NfbG9jYXRpb25zX3VwZGF0ZSBjb250cm9sbGVyJyk7CiRzY29wZS5pc191cGRhdGU9dHJ1ZTsKLy8gZ2V0QnVzaW5lc3NMb2NhdGlvbnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19sb2NhdGlvbnMnKTsKZ2V0QnVzaW5lc3NMb2NhdGlvbigkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmxvY2F0aW9uX2lkLCdjdXJyX2xvY2F0aW9uJyxnZXRCdXNpbmVzc0xvY2F0aW9uX3N1Y2Nlc3MpOwpmdW5jdGlvbiBnZXRCdXNpbmVzc0xvY2F0aW9uX3N1Y2Nlc3MoKQp7CiRzY29wZS5mb3JtQWRkTG9jYXRpb25Bbmd1bGFyPSRzY29wZS5jdXJyX2xvY2F0aW9uWzBdOwp9CgoKJHNjb3BlLmFkZExvY2F0aW9uID0gZnVuY3Rpb24oKQp7Ci8vIGluIHRoaXMgY2FzZSAtIHVwZGF0ZSBsb2NhdGlvbgp0aGVkYXRhID0gJHNjb3BlLmZvcm1BZGRMb2NhdGlvbkFuZ3VsYXI7CgpmdW5jdGlvbiBhZGRMb2NhdGlvbl9zdWNjZXNzKCkKewokbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2xvY2F0aW9ucycpOwp9CmZ1bmN0aW9uIGFkZExvY2F0aW9uX2ZhaWx1cmUoKQp7CiRzY29wZS5mb3JtQWRkTG9jYXRpb25Bbmd1bGFyLmFqYXhfZXJyb3IgPSByZXNwb25zZS5tZXNzYWdlOwp9CnVwZGF0ZUxvY2F0aW9uKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMubG9jYXRpb25faWQsIHRoZWRhdGEsYWRkTG9jYXRpb25fc3VjY2VzcyxhZGRMb2NhdGlvbl9mYWlsdXJlKTsKfQp9KTsKCmt1emVBcHAuY29udHJvbGxlcignYnVzaW5lc3NfbG9jYXRpb25zX2FkZCcsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikgewpsb2dEZWJ1ZygnYnVzaW5lc3NfbG9jYXRpb25zX2FkZCBjb250cm9sbGVyJyk7CmdldEJ1c2luZXNzTG9jYXRpb25zKCRodHRwLCRzY29wZSwnYnVzaW5lc3NfbG9jYXRpb25zJyk7CiRzY29wZS5pc191cGRhdGU9ZmFsc2U7Cgokc2NvcGUuYWRkTG9jYXRpb24gPSBmdW5jdGlvbigpCnsKdGhlZGF0YSA9ICRzY29wZS5mb3JtQWRkTG9jYXRpb25Bbmd1bGFyOwoKZnVuY3Rpb24gYWRkTG9jYXRpb25fc3VjY2VzcygpCnsKJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19sb2NhdGlvbnMnKTsKfQpmdW5jdGlvbiBhZGRMb2NhdGlvbl9mYWlsdXJlKCkKewokc2NvcGUuZm9ybUFkZExvY2F0aW9uQW5ndWxhci5hamF4X2Vycm9yID0gcmVzcG9uc2UubWVzc2FnZTsKfQphZGRMb2NhdGlvbigkaHR0cCwkc2NvcGUsdGhlZGF0YSxhZGRMb2NhdGlvbl9zdWNjZXNzLGFkZExvY2F0aW9uX2ZhaWx1cmUpOwp9Cn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdJbnN0cnVjdG9yc0FkZENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkbG9jYXRpb24pIHsKbG9nRGVidWcoJ0luc3RydWN0b3JzQWRkQ29udHJvbGxlcicpOwokc2NvcGUuaXNJbnN0cnVjdG9yPXRydWU7CiRzY29wZS51c2VydHlwZT0iaW5zdHJ1Y3RvciI7CiRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhciA9IHt9Owokc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIuaXNfdXBkYXRlPWZhbHNlOwokc2NvcGUuYWRkQ2xpZW50ID0gZnVuY3Rpb24oKSAvLyBhZGQgaW5zdHJ1Y3RvciwgdXNpbmcgdGhlIHNhbWUgZnVuY3Rpb24gbmFtZSBhcyB3ZSB1c2UgdGhlIHNhbWUgc2NyZWVuCnsKdGhlZGF0YSA9ICRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhcjsKCmZ1bmN0aW9uIGFkZEluc3RydWN0b3Jfc3VjY2VzcygpCnsKJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19pbnN0cnVjdG9ycycpOwp9CmZ1bmN0aW9uIGFkZENsaWVudF9mYWlsdXJlKCkKewokc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIuYWpheF9lcnJvciA9IHJlc3BvbnNlLm1lc3NhZ2U7Cn0KYWRkSW5zdHJ1Y3RvcigkaHR0cCwkc2NvcGUsdGhlZGF0YSxhZGRJbnN0cnVjdG9yX3N1Y2Nlc3MpOwp9Cn0pOwprdXplQXBwLmNvbnRyb2xsZXIoJ0NsaWVudHNBZGRDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJHRpbWVvdXQsICRsb2NhdGlvbiwgc2hhcmVkUHJvcGVydGllcykgewpsb2dEZWJ1ZygnQ2xpZW50c0FkZENvbnRyb2xsZXIgLSBUaGlzIGlzIEFkZCBuZXcgY2xpZW50IHNjcmVlbicpOwokc2NvcGUuaXNJbnN0cnVjdG9yPWZhbHNlOwoKJHNjb3BlLnVzZXJ0eXBlPSJlbmR1c2VyIjsKJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyID0ge307CiRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5pc191cGRhdGU9ZmFsc2U7CiRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5kaXNhYmxlX3Bob25lX2VkaXRpbmc9ZmFsc2U7CgppZiAoKCRzY29wZS5maWx0ZXIuVmFsdWUgIT0gIiIpICYmICh0eXBlb2YgJHNjb3BlLmZpbHRlci5WYWx1ZSAhPSAndW5kZWZpbmVkJykpIHsKbG9nRGVidWcoImNsaWVudHMgZmlsdGVyIGlzIG5vdCBlbXB0eSIpOwp2YXIgZmlsdGVyID0gU3RyaW5nKCRzY29wZS5maWx0ZXIuVmFsdWUpOwppZiAoZmlsdGVyLmluZGV4T2YoIiAiKSA+IDApIHsKJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyLmZpcnN0X25hbWUgPSBmaWx0ZXIuc3Vic3RyKDAsIGZpbHRlci5pbmRleE9mKCIgIikpOwokc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIubGFzdF9uYW1lID0gZmlsdGVyLnN1YnN0cigxICsgZmlsdGVyLmluZGV4T2YoIiAiKSk7Cn0gZWxzZSB7CiRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5maXJzdF9uYW1lID0gZmlsdGVyOwokc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIubGFzdF9uYW1lID0gIiI7Cn0KJHNjb3BlLmZpbHRlci5WYWx1ZSA9ICIiOwokc2NvcGUuZmlsdGVyLmJ1dHRvblZhbHVlID0gIiI7Cn0gZWxzZSB7Cn0KCiRzY29wZS5nb3RvQmFjayA9IGZ1bmN0aW9uKCkKewokbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2NsaWVudHMnKTsKfQoKJHNjb3BlLmFkZENsaWVudCA9IGZ1bmN0aW9uKCkKewp0aGVkYXRhID0gJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyOwoKZnVuY3Rpb24gYWRkQ2xpZW50X3N1Y2Nlc3ModXNlcl9pZCkKewppZiAoJHNjb3BlLnNhdmVfYW5kX3NjaGVkdWxlKQp7Ci8vICRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfY2xpZW50cy8nK3VzZXJfaWQuanNvbik7CmxvZ0RlYnVnKCJORVcgdXNlciB1c2VyX2lkPSIrdXNlcl9pZC5qc29uKTsKCnVzZXJfaW5mbz0gewpidXNpbmVzc191c2VyX2lkOiB1c2VyX2lkLmpzb24sCmJ1c2VyX2ZpcnN0X25hbWU6ICRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5idXNlcl9maXJzdF9uYW1lLApidXNlcl9sYXN0X25hbWU6ICRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5idXNlcl9sYXN0X25hbWUKfTsKCnNoYXJlZFByb3BlcnRpZXMuc2V0X3NlbGVjdGVkX3VzZXIodXNlcl9pbmZvKTsKJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jYWxlbmRhcicpOwoKfQplbHNlCnsKJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jbGllbnRzLycpOwp9CmNvbnNvbGUubG9nKCJuZXcgdXNlciBpZCA9ICIrdXNlcl9pZC5qc29uKTsKfQpmdW5jdGlvbiBhZGRDbGllbnRfZmFpbHVyZShyZXNwb25zZSkKewokc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIuYWpheF9lcnJvciA9IHJlc3BvbnNlLm1lc3NhZ2U7CiR0aW1lb3V0KGZ1bmN0aW9uKCkKewokc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIuYWpheF9lcnJvcj1udWxsOwp9LCAyNTAwKTsKfQphZGRDbGllbnQoJGh0dHAsJHNjb3BlLHRoZWRhdGEsYWRkQ2xpZW50X3N1Y2Nlc3MsIGFkZENsaWVudF9mYWlsdXJlLGZhbHNlKTsKfQp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ1BhY2thZ2VzQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikgewpsb2dEZWJ1ZygnUGFja2FnZXNDb250cm9sbGVyJyk7CmdldEJ1c2luZXNzUGFja2FnZXMoJGh0dHAsJHNjb3BlLCdwYWNrYWdlcycpOwoKJHNjb3BlLnNob3dQYWNrYWdlID0gZnVuY3Rpb24gKHRoZXBhY2thZ2UpCnsKJGxvY2F0aW9uLnBhdGgoJy9wYWNrYWdlcy8nK3RoZXBhY2thZ2UucGFja2FnZV9pZCk7Cn0KfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdJbnN0cnVjdG9yc1Nob3dDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uKSB7CmxvZ0RlYnVnKCdJbnN0cnVjdG9yc1Nob3dDb250cm9sbGVyJyk7CiRzY29wZS5vcmRlckJ5RmllbGQgPSAnYnVzZXJfc3RhcnRfZGF0ZSc7CiRzY29wZS5yZXZlcnNlU29ydD10cnVlOwoKZ2V0QWxsSW5zdHJ1Y3RvcnMoJGh0dHAsJHNjb3BlLCdhbGxDbGllbnRzJyxnZXRBbGxJbnN0cnVjdG9yc19zdWNjZXNzKTsKZnVuY3Rpb24gZ2V0QWxsSW5zdHJ1Y3RvcnNfc3VjY2VzcygpCnsKJHNjb3BlLnNob3dDbGllbnRzR3JpZE9wdGlvbnMuZGF0YT0kc2NvcGUuYWxsQ2xpZW50czsKfQoKJHNjb3BlLmdvdG9JbnN0cnVjdG9yUGFnZT0gZnVuY3Rpb24gKGJ1c2luZXNzX3VzZXJfaWQpCnsKZ290b0luc3RydWN0b3JQYWdlKGJ1c2luZXNzX3VzZXJfaWQpOwp9Cgokc2NvcGUuY2xpZW50TmFtZUZpbHRlcj0iIjsKJHNjb3BlLmlucHV0RmlsdGVyID0gZnVuY3Rpb24gKGl0ZW0pCnsKLy8gY29uc29sZS5sb2coaXRlbS5idXNlcl9waG9uZV9udW1iZXIpOwpyZXR1cm4gZmlsdGVyX2ZpcnN0bGFzdF9uYW1lKGl0ZW0uYnVzZXJfZmlyc3RfbmFtZSxpdGVtLmJ1c2VyX2xhc3RfbmFtZSxpdGVtLmJ1c2VyX3Bob25lX251bWJlciwkc2NvcGUuY2xpZW50TmFtZUZpbHRlcik7Cn07Cn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdDbGllbnRzU2hvd0NvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICR1aWJNb2RhbCwgJGh0dHAsICRsb2NhdGlvbikgewpsb2dEZWJ1ZygnQ2xpZW50c1Nob3dDb250cm9sbGVyJyk7CiRzY29wZS5vcmRlckJ5RmllbGQgPSAnYnVzZXJfc3RhcnRfZGF0ZSc7CiRzY29wZS5yZXZlcnNlU29ydD10cnVlOwoKZ2V0QWxsQ2xpZW50cygkaHR0cCwkc2NvcGUsJ2FsbENsaWVudHMnLGdldENsaWVudF9zdWNjZXNzKTsKZnVuY3Rpb24gZ2V0Q2xpZW50X3N1Y2Nlc3MoKQp7CiRzY29wZS5zaG93Q2xpZW50c0dyaWRPcHRpb25zLmRhdGE9JHNjb3BlLmFsbENsaWVudHM7Cn0KCiRzY29wZS5nb3RvQ2xpZW50UGFnZT0gZnVuY3Rpb24gKGJ1c2luZXNzVXNlcmlkKQp7CmdvdG9DbGllbnRQYWdlKGJ1c2luZXNzVXNlcmlkKTsKfQoKLy8gZmlsdGVyIGFyY2hpdmVkIGNsaWVudHMKJHNjb3BlLnNob3dBcmNoaXZlZENoZWNrYm94PWZhbHNlOwokc2NvcGUuc2hvd0FyY2hpdmVkID0gZnVuY3Rpb24gKGVjbGllbnQpCnsKaWYgKGVjbGllbnQuaXNfYWN0aXZlPT0wKQp7CmxvZ0RlYnVnKGVjbGllbnQpOwppZiAoJHNjb3BlLnNob3dBcmNoaXZlZENoZWNrYm94KQp7CnJldHVybiBlY2xpZW50Owp9Cn0KZWxzZSB7CnJldHVybiBlY2xpZW50Owp9Cn07Cgokc2NvcGUuY2xpZW50TmFtZUZpbHRlcj0iIjsKJHNjb3BlLmlucHV0RmlsdGVyID0gZnVuY3Rpb24gKGl0ZW0pCnsKICAgICAgLy8gY29uc29sZS5sb2coImNsaWVudE5hbWVGaWx0ZXIiKTsKcmV0dXJuIGZpbHRlcl9maXJzdGxhc3RfbmFtZShpdGVtLmJ1c2VyX2ZpcnN0X25hbWUsaXRlbS5idXNlcl9sYXN0X25hbWUsaXRlbS5idXNlcl9waG9uZV9udW1iZXIsJHNjb3BlLmNsaWVudE5hbWVGaWx0ZXIpOwp9OwoKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXM9W107Ci8vICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzID0gWwovLyAgIHsiZmllbGRfaWQiOjAsImZpZWxkX25hbWUiOiLXqteQ16jXmdeaINec15nXk9eUIiwiZmllbGRfZGF0YXR5cGUiOiJEQVRFIiwiaXNfbWFuZGF0b3J5IjowLCAiZnJvbWRiIjogZmFsc2UsICJkYl9pZF90b2ZpeCI6IDAsICJpc19hY3RpdmUiOiAxLCAibW9kaWZpZWQiOiBmYWxzZX0sCi8vICAgeyJmaWVsZF9pZCI6MCwiZmllbGRfbmFtZSI6IteU16LXqNeV16oiLCJmaWVsZF9kYXRhdHlwZSI6IlRFWFRfQVJFQSIsImlzX21hbmRhdG9yeSI6MCwgImZyb21kYiI6IGZhbHNlLCAiZGJfaWRfdG9maXgiOiAwLCAiaXNfYWN0aXZlIjogMSwgIm1vZGlmaWVkIjogZmFsc2V9Ci8vIF07CgpmdW5jdGlvbiBnZXRDbGllbnRzRXh0cmFGaWVsZHNfc3VjY2VzcygpCnsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMgPSAkc2NvcGUuZXh0cmFGaWVsZHM7Cn0KZ2V0Q2xpZW50c0V4dHJhRmllbGRzKCRodHRwLCRzY29wZSwnZXh0cmFGaWVsZHMnLGdldENsaWVudHNFeHRyYUZpZWxkc19zdWNjZXNzKTsKCiRzY29wZS5ldmVudFR5cGVFeHRyYUZpZWxkc1BvcCA9IGZ1bmN0aW9uKGV2ZW50VHlwZVByb3BlcnRpZXMpIHsKICAgICAgICBsb2dEZWJ1ZygiZXZlbnRUeXBlRXh0cmFGaWVsZHNQb3AzIik7Cgp2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKYW5pbWF0aW9uOiBmYWxzZSwKdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfY2xpZW50X2V4dHJhX2ZpZWxkcy5waHAnLApjb250cm9sbGVyOiAnZXZlbnRUeXBlRXh0cmFGaWVsZHNNb2RhbENvbnRyb2xsZXInLApzaXplOiAnbCcsCnJlc29sdmU6IHsKZXZlbnRUeXBlUHJvcGVydGllczogZnVuY3Rpb24oKSB7CnJldHVybiBldmVudFR5cGVQcm9wZXJ0aWVzOwp9Cn0KfSk7Cgptb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHNlbGVjdGVkSXRlbSkgewpsb2dEZWJ1ZyhzZWxlY3RlZEl0ZW0pOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyA9IHNlbGVjdGVkSXRlbTsKfSwgZnVuY3Rpb24oKSB7CmxvZ0RlYnVnKCdNb2RhbCBkaXNtaXNzZWQgYXQ6ICcgKyBuZXcgRGF0ZSgpKTsKfSk7Cn07Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignc2NoZWR1bGVyQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRyb3V0ZVBhcmFtcykgewpldmVudF90eXBlX2lkPSRyb3V0ZVBhcmFtcy5ldmVudF90eXBlX2lkOwoKJHNjb3BlLnN1Z2dlc3Rpb25EYXRlID0gW107CiRzY29wZS5zdWdnZXN0aW9uRGF0ZS5kYXRlID0gbmV3IERhdGUoKTsKJHNjb3BlLnN1Z2dlc3Rpb25EYXRlLm9wdGlvbnMgPSB7Ci8vIG1pbkRhdGU6IG5ldyBEYXRlKCksCi8vIHNob3dXZWVrczogdHJ1ZSwKbWluVmlldzonZGF5JywKc3RhcnRWaWV3OiAnZGF5JwoKfTsKdmFyIHRoZXRpbWUgPSBuZXcgRGF0ZSgpOwokc2NvcGUuZmlsdGVyQWxsRGF5c0NoZWNrYm94PXRydWU7CiRzY29wZS5maWx0ZXJEYXlJdGVtcyA9IHsKCifXqNeQ16nXldefJzogdHJ1ZSwKJ9ep16DXmSc6IHRydWUsCifXqdec15nXqdeZJzogdHJ1ZSwKJ9eo15HXmdei15knOiB0cnVlLAon15fXnteZ16nXmSc6IHRydWUsCifXqdeZ16nXmSc6IHRydWUsCifXqdeR16onOiB0cnVlCn07Cgokc2NvcGUub25UaW1lU2V0ID0gZnVuY3Rpb24gKG5ld0RhdGUsIG9sZERhdGUpIHsKbG9nRGVidWcoIm5ldyBkYXRlICIrbmV3RGF0ZS5nZXRUaW1lKCkgKyAiIG9sZCBkYXRlICIrb2xkRGF0ZS5nZXRUaW1lKCkpOwpkaWZmPW5ld0RhdGUuZ2V0VGltZSgpLW9sZERhdGUuZ2V0VGltZSgpOwovLyBpZiBuZXcgZGF0ZSBpcyBpbiBhIGRpZmZlcmVudCB3ZWVrCi8vIHdlIHJlZmV0Y2ggc3VnZ2VzdGlvbnMgZm9yIHRoZSBjdXJyZW50IHdlZWsKdmFyIG5ld0RhdGVXID0gbmV3IERhdGUobmV3RGF0ZSk7CnZhciBvbGREYXRlVyA9IG5ldyBEYXRlKG9sZERhdGUpOwovLyBhbGVydChuZXdEYXRlVy5mb3JtYXQoJ1cnKSk7Ci8vIGFsZXJ0KG9sZERhdGVXLmZvcm1hdCgnVycpKTsKaWYgKG5ld0RhdGVXLmZvcm1hdCgnVycpIT1vbGREYXRlVy5mb3JtYXQoJ1cnKSkKewpsb2dEZWJ1ZygiZGlmZiBpcyBhIHdlZWsgb3IgbW9yZSwgcmVmZXRjaGluZyBzdWdnZXN0aW9ucyIpOwokaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3QvIitldmVudF90eXBlX2lkKyIvIituZXdEYXRlLmdldEZ1bGxZZWFyKCkrIi8iKyhuZXdEYXRlLmdldE1vbnRoKCkrMSkrIi8iK25ld0RhdGUuZ2V0RGF0ZSgpKyIvIituZXdEYXRlLmdldEhvdXJzKCkgKyAiLyIgKyBuZXdEYXRlLmdldE1pbnV0ZXMoKSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkgewovLwkgICAgJHNjb3BlLm15RGF0YSA9IHJlc3BvbnNlLmRhdGE7Ci8vCQlsb2dEZWJ1ZygiZ3JpZG9wdGlvbnM9Iiskc2NvcGUuZ3JpZE9wdGlvbnMpOwokc2NvcGUuZXZlbnRzU3VnZ2VzdGVkID0gcmVzcG9uc2UuZGF0YTsKfSk7Cgp9Cn0KCiRzY29wZS5vcHRpb25zID0gewpjdXN0b21DbGFzczogZ2V0RGF5Q2xhc3MsCm1pbkRhdGU6IG5ldyBEYXRlKCksCnNob3dXZWVrczogdHJ1ZQp9Owokc2NvcGUuZHQgPSBuZXcgRGF0ZSgpOwoKCmZ1bmN0aW9uIGdldERheUNsYXNzKGRhdGEpIHsKcmV0dXJuICcnOwp9Cgokc2NvcGUuZGF5c0l0ZW1zID0gWwp7bmFtZTon16jXkNep15XXnyd9LAp7bmFtZTon16nXoNeZJ30sCntuYW1lOifXqdec15nXqdeZJ30sCntuYW1lOifXqNeR15nXoteZJ30sCntuYW1lOifXl9ee15nXqdeZJ30sCntuYW1lOifXqdeZ16nXmSd9LAp7bmFtZTon16nXkdeqJ30KXTsKCiRzY29wZS5maWx0ZXJBbGxEYXlJdGVtc1NldCA9IGZ1bmN0aW9uICgpCnsKJHNjb3BlLmZpbHRlckRheUl0ZW1zWyfXqNeQ16nXldefJ109JHNjb3BlLmZpbHRlckFsbERheXNDaGVja2JveDsKJHNjb3BlLmZpbHRlckRheUl0ZW1zWyfXqdeg15knXT0kc2NvcGUuZmlsdGVyQWxsRGF5c0NoZWNrYm94Owokc2NvcGUuZmlsdGVyRGF5SXRlbXNbJ9ep15zXmdep15knXT0kc2NvcGUuZmlsdGVyQWxsRGF5c0NoZWNrYm94Owokc2NvcGUuZmlsdGVyRGF5SXRlbXNbJ9eo15HXmdei15knXT0kc2NvcGUuZmlsdGVyQWxsRGF5c0NoZWNrYm94Owokc2NvcGUuZmlsdGVyRGF5SXRlbXNbJ9eX157Xmdep15knXT0kc2NvcGUuZmlsdGVyQWxsRGF5c0NoZWNrYm94Owokc2NvcGUuZmlsdGVyRGF5SXRlbXNbJ9ep15nXqdeZJ109JHNjb3BlLmZpbHRlckFsbERheXNDaGVja2JveDsKJHNjb3BlLmZpbHRlckRheUl0ZW1zWyfXqdeR16onXT0kc2NvcGUuZmlsdGVyQWxsRGF5c0NoZWNrYm94Owp9Cgokc2NvcGUuc3VnZ2VzdEZpbHRlckRheXMgPSBmdW5jdGlvbiAoZXN1Z2dlc3QpCnsKLy8gbG9nRGVidWcoZXN1Z2dlc3QpOwppZiAoKCRzY29wZS5maWx0ZXJEYXlJdGVtc1tlc3VnZ2VzdC5zdGFydF9mb3JtYXRfZG93XSkgJiAoKCRzY29wZS5zdWdnZXN0aW9uRGF0ZS5kYXRlLmdldFRpbWUoKS8xMDAwKTxlc3VnZ2VzdC5zdGFydF9lcG9jaCkpCnsKcmV0dXJuIGVzdWdnZXN0Owp9Cn07Cgpsb2dEZWJ1Zygnc2NoZWR1bGVyQ29udHJvbGxlciBmb3IgZXZlbnQgdHlwZSBpZCAnK2V2ZW50X3R5cGVfaWQrIiAiK3RoZXRpbWUuZ2V0SG91cnMoKSArICI6IiArIHRoZXRpbWUuZ2V0TWludXRlcygpICsgIjoiICsgdGhldGltZS5nZXRTZWNvbmRzKCkpOwokaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3QvIitldmVudF90eXBlX2lkKyIvIit0aGV0aW1lLmdldEZ1bGxZZWFyKCkrIi8iKyh0aGV0aW1lLmdldE1vbnRoKCkrMSkrIi8iK3RoZXRpbWUuZ2V0RGF0ZSgpKyIvIit0aGV0aW1lLmdldEhvdXJzKCkgKyAiLyIgKyB0aGV0aW1lLmdldE1pbnV0ZXMoKSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkgewovLwkgICAgJHNjb3BlLm15RGF0YSA9IHJlc3BvbnNlLmRhdGE7Ci8vCQlsb2dEZWJ1ZygiZ3JpZG9wdGlvbnM9Iiskc2NvcGUuZ3JpZE9wdGlvbnMpOwokc2NvcGUuZXZlbnRzU3VnZ2VzdGVkID0gcmVzcG9uc2UuZGF0YTsKfSk7CgokaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRfdHlwZXMvIitldmVudF90eXBlX2lkKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7Ci8vCSAgICAkc2NvcGUubXlEYXRhID0gcmVzcG9uc2UuZGF0YTsKLy8JCWxvZ0RlYnVnKCJncmlkb3B0aW9ucz0iKyRzY29wZS5ncmlkT3B0aW9ucyk7CiRzY29wZS5ldmVudFR5cGVEZXRhaWxzID0gcmVzcG9uc2UuZGF0YTsKfSk7Cn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdjb250YWN0Q29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHApIHsKbG9nRGVidWcoJ2NvbnRhY3RDb250cm9sbGVyJyk7Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcigncGFja2FnZVBheW1lbnRBc3NvY2lhdGlvbk1vZGFsQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHJvdXRlUGFyYW1zLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIGZwYWNrYWdlLCBiYWxhbmNlLCBidXNpbmVzc191c2VyX2lkLCB1aUNhbGVuZGFyQ29uZmlnKQp7CmxvZ0RlYnVnKCJwYWNrYWdlUGF5bWVudEFzc29jaWF0aW9uTW9kYWxDb250cm9sbGVyIik7Cgokc2NvcGUuZnBhY2thZ2U9ZnBhY2thZ2U7CiRzY29wZS5iYWxhbmNlPWJhbGFuY2U7CiRzY29wZS5wYWNrYWdlX3BheW1lbnRzPSRzY29wZS5mcGFja2FnZS5wYWNrYWdlX3BheW1lbnRzOwokc2NvcGUucHJldmlvdXNfaXNfYWxsX3BhaWQ9JHNjb3BlLmZwYWNrYWdlLmlzX2FsbF9wYWlkOwokc2NvcGUuYnVzaW5lc3NfdXNlcl9pZD1idXNpbmVzc191c2VyX2lkOwoKLy8gJ2NhbGN1bGF0aW5nJyBwcmV2aW91cyBzdGF0dXMgb2YgcGF5bWVudAppZiAoJHNjb3BlLnBhY2thZ2VfcGF5bWVudHM+MCkKewppZiAoJHNjb3BlLnByZXZpb3VzX2lzX2FsbF9wYWlkPT0xKQp7CiRzY29wZS5wcmV2aW91c19zdGF0dXM9ImlzX2FsbF9wYWlkIjsKJHNjb3BlLnBhY2thZ2Vfc3RhdHVzX2lkPS0xOwokc2NvcGUucHJldmlvdXNfcGFja2FnZV9zdGF0dXNfaWQ9LTE7Cn0KZWxzZQp7CiRzY29wZS5wcmV2aW91c19zdGF0dXM9ImlzX3BhcnRseV9wYWlkIjsKJHNjb3BlLnBhY2thZ2Vfc3RhdHVzX2lkPS0xOwokc2NvcGUucHJldmlvdXNfcGFja2FnZV9zdGF0dXNfaWQ9LTE7Cn0KfQplbHNlCnsKJHNjb3BlLnByZXZpb3VzX3N0YXR1cz0ibm90X3BhaWQiOwokc2NvcGUucGFja2FnZV9zdGF0dXNfaWQ9MDsKJHNjb3BlLnByZXZpb3VzX3BhY2thZ2Vfc3RhdHVzX2lkPTA7Cgp9CmxvZ0RlYnVnKCJwcmV2aW91c19zdGF0dXM9Iiskc2NvcGUucHJldmlvdXNfc3RhdHVzKTsKCiRzY29wZS5jbG9zZU1vZGFsID0gZnVuY3Rpb24oKQp7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKfTsKJHNjb3BlLnVwZGF0ZVBhY2thZ2VQYXltZW50ID0gZnVuY3Rpb24oKQp7Ci8vIGNvbnNvbGUubG9nKCJwcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ9Iiskc2NvcGUuZm1lZXRpbmcucHJldmlvdXNfcGFja2FnZV91c2VyX2lkKTsKLy8gY29uc29sZS5sb2coInBhY2thZ2VfdXNlcl9pZD0iKyRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQpOwpsb2dEZWJ1ZygidXBkYXRlUGFja2FnZVBheW1lbnQiKQovLyBpZiBzZWxlY3RlZCBwYWNrYWdlIGlzIGxpa2UgcHJldmlvdXMgcGFja2FnZSAtIGRvIG5vdGhpbmcKaWYgKCgkc2NvcGUucHJldmlvdXNfcGFja2FnZV9zdGF0dXNfaWQ9PSRzY29wZS5wYWNrYWdlX3N0YXR1c19pZCkpCnsKbG9nRGVidWcoInNlbGVjdGVkIG9wdGlvbiBpcyBsaWtlIHByZXZpb3VzIG9wdGlvbiAtIGRvIG5vdGhpbmciKTsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwp9CgovLyBwcmV2aW91cyBwYWNrYWdlIHdhcyBwYWlkL3BhcnRseS1wYWlkIC0gbm93IG5vdGhpbmdzIGlzIHNlbGVjdGVkCmVsc2UgaWYgKCgkc2NvcGUucHJldmlvdXNfcGFja2FnZV9zdGF0dXNfaWQ9PS0xKSAmJiAoJHNjb3BlLnBhY2thZ2Vfc3RhdHVzX2lkPT0wKSkKewpsb2dEZWJ1Zygid2FzIHBhaWQvcGFydGx5IHBhaWQsIHJlbW92aW5nIHBheW1lbnQiKTsKcmVtb3ZlUGFja2FnZVBheW1lbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5mcGFja2FnZS5wYWNrYWdlX3VzZXJfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwp9Ci8vIHByZXZpb3VzIHBhY2thZ2Ugd2FzIHNlbGVjdGVkIC0gbm93IGEgZGlmZmVyZW50IHBhY2thZ2UgaXMgc2VsZWN0ZWQKZWxzZSBpZiAoKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3N0YXR1c19pZD09MCkgJiYgKCRzY29wZS5wYWNrYWdlX3N0YXR1c19pZD09LTEpKQp7CmxvZ0RlYnVnKCJ3YXMgbm90IHBhaWQgLSBub3cgcGF5IGZ1bGx5L3BhcnRpYWxseSIpOwpwYXlGb3JQYWNrYWdlKCRodHRwLCRzY29wZSwkc2NvcGUuZnBhY2thZ2UucGFja2FnZV91c2VyX2lkLCRzY29wZS5idXNpbmVzc191c2VyX2lkLHVwZGF0ZUV2ZW50UGFja2FnZV9zdWNjZXNzKTsKCi8vIHJlYXNzaWduRXZlbnRQYWNrYWdlQXNzb2NpYXRpb24oJGh0dHAsJHNjb3BlLCRzY29wZS5mbWVldGluZy5ldmVudF9pZCwkc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkLCRzY29wZS5idXNpbmVzc191c2VyX2lkLHVwZGF0ZUV2ZW50UGFja2FnZV9zdWNjZXNzKTsKfQp9CgpmdW5jdGlvbiB1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2VzcygpCnsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwpsb2dEZWJ1ZygiYnJvYWRjYXN0aW5nIGNsaWVudFBhZ2VSZWxvYWREYXRhIik7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKfQoKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2V2ZW50UGFja2FnZUFzc29jaWF0aW9uTW9kYWxDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkcm91dGVQYXJhbXMsICRyb290U2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgZm1lZXRpbmcsIGJhbGFuY2UsIGJ1c2luZXNzX3VzZXJfaWQsIHVpQ2FsZW5kYXJDb25maWcpCnsKJHNjb3BlLmZtZWV0aW5nPWFuZ3VsYXIuY29weShmbWVldGluZyk7CiRzY29wZS5iYWxhbmNlPWJhbGFuY2U7CiRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ9JHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZDsKJHNjb3BlLnByZXZpb3VzX2V2ZW50X3BheW1lbnRzPSRzY29wZS5mbWVldGluZy5ldmVudF9wYXltZW50czsKJHNjb3BlLnByZXZpb3VzX2lzX2FsbF9wYWlkPSRzY29wZS5mbWVldGluZy5pc19hbGxfcGFpZDsKJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQ9YnVzaW5lc3NfdXNlcl9pZDsKCi8vICdjYWxjdWxhdGluZycgcHJldmlvdXMgc3RhdHVzIG9mIHBheW1lbnQKaWYgKCRzY29wZS5wcmV2aW91c19ldmVudF9wYXltZW50cz4wKQp7CmlmICgkc2NvcGUucHJldmlvdXNfaXNfYWxsX3BhaWQ9PTEpCnsKJHNjb3BlLnByZXZpb3VzX3N0YXR1cz0iaXNfYWxsX3BhaWQiOwp9CmVsc2UKewokc2NvcGUucHJldmlvdXNfc3RhdHVzPSJpc19wYXJ0bHlfcGFpZCI7Cn0KfQplbHNlCnsKaWYgKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ+MCkKewokc2NvcGUucHJldmlvdXNfc3RhdHVzPSJpc19wYWNrYWdlX3BhaWQiOwp9CmVsc2UKewokc2NvcGUucHJldmlvdXNfc3RhdHVzPSJub3RfcGFpZCI7Cn0KfQpsb2dEZWJ1ZygicHJldmlvdXNfc3RhdHVzPSIrJHNjb3BlLnByZXZpb3VzX3N0YXR1cyk7CgppZiAoKCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQ9PTApICYmICgkc2NvcGUuZm1lZXRpbmcuZXZlbnRfcGF5bWVudHM+MCkpCnsKLy8gdGhpcyBpcyBhIGNhc2Ugd2hlcmUgcGF5bWVudCB3YXMgcGFydGx5IG9yIGZ1bGx5IG1hZGUgZnJvbSBiYWxhbmNlCiRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQ9LTE7CiRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ9LTE7Cn0KCmxvZ0RlYnVnKCJldmVudFBhY2thZ2VBc3NvY2lhdGlvbk1vZGFsQ29udHJvbGxlciIpOwpnZXRQYWNrYWdlc0ZvckV2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJ3JlbGF0ZWRQYWNrYWdlcycsZ2V0UGFja2FnZXNGb3JFdmVudF9zdWNjZXNzKTsgLy8gd2FzIGdldEJ1c2luZXNzUGFja2FnZQpmdW5jdGlvbiBnZXRQYWNrYWdlc0ZvckV2ZW50X3N1Y2Nlc3MoKQp7Cn0KCiRzY29wZS5jbG9zZU1vZGFsID0gZnVuY3Rpb24oKQp7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKfTsKJHNjb3BlLnVwZGF0ZUV2ZW50UGFja2FnZSA9IGZ1bmN0aW9uKCkKewpjb25zb2xlLmxvZygicHJldmlvdXNfcGFja2FnZV91c2VyX2lkPSIrJHNjb3BlLmZtZWV0aW5nLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZCk7CmNvbnNvbGUubG9nKCJwYWNrYWdlX3VzZXJfaWQ9Iiskc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkKTsKLy8gaWYgc2VsZWN0ZWQgcGFja2FnZSBpcyBsaWtlIHByZXZpb3VzIHBhY2thZ2UgLSBkbyBub3RoaW5nCmlmICgoJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD09JHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZCkpCnsKbG9nRGVidWcoInNlbGVjdGVkIG9wdGlvbiBpcyBsaWtlIHByZXZpb3VzIG9wdGlvbiAtIGRvIG5vdGhpbmciKTsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwp9Ci8vIGlmIHNlbGVjdGVkIHBhY2thZ2UgaXMgbGlrZSBwcmV2aW91cyBwYWNrYWdlIC0gZG8gbm90aGluZwppZiAoKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ9PSRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQpICYmICgkc2NvcGUucHJldmlvdXNfcGFja2FnZV91c2VyX2lkPjApKQp7CmxvZ0RlYnVnKCJzZWxlY3RlZCBwYWNrYWdlIGlzIGxpa2UgcHJldmlvdXMgcGFja2FnZSAtIGRvIG5vdGhpbmciKTsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwp9Ci8vIHByZXZpb3VzIHBhY2thZ2Ugd2FzIHNlbGVjdCAtIG5vdyBub3RoaW5ncyBpcyBzZWxlY3RlZAplbHNlIGlmICgoJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD4wKSAmJiAoJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZD09MCkpCnsKbG9nRGVidWcoIm5vIHBhY2thZ2Ugc2VsZWN0ZWQsIHJlbW92ZSBwYWNrYWdlLWV2ZW50IGFzc29jaWF0aW9uIik7CnJlbW92ZUV2ZW50UGFja2FnZUFzc29jaWF0aW9uKCRodHRwLCRzY29wZSwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwp9Ci8vIHByZXZpb3VzIHBhY2thZ2Ugd2FzIHNlbGVjdGVkIC0gbm93IGEgZGlmZmVyZW50IHBhY2thZ2UgaXMgc2VsZWN0ZWQKZWxzZSBpZiAoKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ+MCkgJiYgKCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQ+MCkpCnsKbG9nRGVidWcoInVwZGF0aW5nIG5ldyBwYWNrYWdlIHRvIHBhY2thZ2VfdXNlcl9pZD0gIiskc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkKTsKcmVhc3NpZ25FdmVudFBhY2thZ2VBc3NvY2lhdGlvbigkaHR0cCwkc2NvcGUsJHNjb3BlLmZtZWV0aW5nLmV2ZW50X2lkLCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwp9Ci8vIHByZXZpb3VzIHBhY2thZ2Ugd2FzIG5vbmUgLSBub3cgYSBwYWNrYWdlIGlzIHNlbGVjdGVkCmVsc2UgaWYgKCgkc2NvcGUucHJldmlvdXNfcGFja2FnZV91c2VyX2lkPT0wKSAmJiAoJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZD4wKSkKewpsb2dEZWJ1ZygidXBkYXRpbmcgbmV3IHBhY2thZ2UgdG8gcGFja2FnZV91c2VyX2lkPSAiKyRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQpOwpyZWFzc2lnbkV2ZW50UGFja2FnZUFzc29jaWF0aW9uKCRodHRwLCRzY29wZSwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZCwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCx1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2Vzcyk7Cn0KLy8gcHJldmlvdXMgYXNzb2NpYXRpb24gd2FzIHBhaWQgb3IgaGFsZiBwYWlkIC0gbm93IGl0cyBub25lCmVsc2UgaWYgKCgkc2NvcGUucHJldmlvdXNfZXZlbnRfcGF5bWVudHM+MCkgJiYgKCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQ9PTApKQp7CmxvZ0RlYnVnKCJyZW1vdmluZyBwYXltZW50IGZyb20gZXZlbnQsIHBhY2thZ2VfdXNlcl9pZD0gIiskc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkKTsKcmVtb3ZlRXZlbnRQYXltZW50QXNzb2NpYXRpb24oJGh0dHAsJHNjb3BlLCRzY29wZS5mbWVldGluZy5ldmVudF9pZCwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCx1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2Vzcyk7CgovLyByZWFzc2lnbkV2ZW50UGFja2FnZUFzc29jaWF0aW9uKCRodHRwLCRzY29wZSwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZCwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCx1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2Vzcyk7Ci8vIHRvZG8KfQovLyB3YXMgcGFja2FnZSBwYXltZW50IC0+IG5vdyBiYWxhbmNlIHBheW1lbnQKZWxzZSBpZiAoKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ+MCkgJiYgKCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQ9PS0xKSkKewpsb2dEZWJ1ZygibW92aW5nIHBheW1lbnQgZnJvbSBwYWNrYWdlIHRvIGJhbGFuY2UiKTsKYWRkRXZlbnRQYXltZW50UmVtb3ZlUGFja2FnZSgkaHR0cCwkc2NvcGUsJHNjb3BlLmZtZWV0aW5nLmV2ZW50X2lkLCRzY29wZS5idXNpbmVzc191c2VyX2lkLHVwZGF0ZUV2ZW50UGFja2FnZV9zdWNjZXNzKTsKfQovLyB3YXMgYmFsYW5jZSBwYXltZW50IC0+IG5vdyBwYWNrYWdlIHBheW1lbnQKZWxzZSBpZiAoKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ9PS0xKSAmJiAoJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZD4wKSkKewpsb2dEZWJ1ZygibW92aW5nIHBheW1lbnQgZnJvbSBiYWxhbmNlIHRvIHBhY2thZ2UiKTsKYWRkRXZlbnRQYWNrYWdlUmVtb3ZlUGF5bWVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLmZtZWV0aW5nLmV2ZW50X2lkLCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwoKfQovLyB3YXMgbm90IHBhaWQgYXQgYWxsIC0+IG5vdyBiYWxhbmNlIHBheQplbHNlIGlmICgoJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD09MCkgJiYgKCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQ9PS0xKSkKewpsb2dEZWJ1ZygibW92aW5nIHBheW1lbnQgZnJvbSBub25lIHRvIGJhbGFuY2UiKTsKYWRkRXZlbnRQYXltZW50QXNzb2NpYXRpb24oJGh0dHAsJHNjb3BlLCRzY29wZS5mbWVldGluZy5ldmVudF9pZCwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCx1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2Vzcyk7Cn0KfQoKZnVuY3Rpb24gdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MoKQp7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKbG9nRGVidWcoImJyb2FkY2FzdGluZyBjbGllbnRQYWdlUmVsb2FkRGF0YSIpOwokcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NsaWVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCn0KCn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignYXJjaGl2ZV9jbGllbnRfbW9kYWwnLCBmdW5jdGlvbigkc2NvcGUsICRsb2NhdGlvbiwgaXNfaW5zdHJ1Y3RvciwgYnVzaW5lc3NfdXNlcl9pZCwgYnVzZXJfZmlyc3RfbmFtZSwgYnVzZXJfbGFzdF9uYW1lLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIHVpQ2FsZW5kYXJDb25maWcpIHsKJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQ9YnVzaW5lc3NfdXNlcl9pZDsKJHNjb3BlLmJ1c2VyX2ZpcnN0X25hbWU9YnVzZXJfZmlyc3RfbmFtZTsKJHNjb3BlLmJ1c2VyX2xhc3RfbmFtZT1idXNlcl9sYXN0X25hbWU7CiRzY29wZS5pc19pbnN0cnVjdG9yPWlzX2luc3RydWN0b3I7Cgpsb2dEZWJ1ZygiYXJjaGl2ZV9jbGllbnRfbW9kYWwgY29udHJvbGxlciIpOwoKJHNjb3BlLmNsb3NlTW9kYWwgPSBmdW5jdGlvbigpIHsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwp9OwoKJHNjb3BlLmFyY2hpdmVDbGllbnQgPSBmdW5jdGlvbigpCnsKYXJjaGl2ZUNsaWVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsYXJjaGl2ZUNsaWVudF9zdWNjZXNzKTsKZnVuY3Rpb24gYXJjaGl2ZUNsaWVudF9zdWNjZXNzKCkKewokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CmlmICgkc2NvcGUuaXNfaW5zdHJ1Y3RvcikKewokbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2luc3RydWN0b3JzJyk7Cn0KZWxzZSB7CiRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfY2xpZW50cycpOwp9Cn0KfQoKfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdwYXltZW55RGV0YWlsc01vZGFsQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHJvdXRlUGFyYW1zLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIGZwYXltZW50LCB1aUNhbGVuZGFyQ29uZmlnKSB7CiRzY29wZS5mcGF5bWVudD17fTsKJHNjb3BlLmZwYXltZW50LnBheW1lbnRfZGF0ZT1mcGF5bWVudC5wYXltZW50X2RhdGU7CiRzY29wZS5mcGF5bWVudC5wYXltZW50X2Ftb3VudD1mcGF5bWVudC5wYXltZW50X2Ftb3VudDsKJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZ2VuZXJhdGVkPWZwYXltZW50Lmludm9pY2VfZ2VuZXJhdGVkOwokc2NvcGUuZnBheW1lbnQuaW52b2ljZV9udW1iZXI9ZnBheW1lbnQuaW52b2ljZV9udW1iZXI7CmlmIChmcGF5bWVudC5pbnZvaWNlX2RhdGU9PW51bGwpCnsKJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZV9mb3JtYXQ9bmV3IERhdGUoKTsKfQplbHNlCnsKJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZV9mb3JtYXQ9ZnBheW1lbnQuaW52b2ljZV9kYXRlX2Zvcm1hdDsKfQokc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlPWZwYXltZW50Lmludm9pY2VfZGF0ZTsKJHNjb3BlLnNlbGVjdGVkUGF5bWVudE1ldGhvZD17Cm5hbWU6IGZwYXltZW50LnBheW1lbnRfbWV0aG9kX25hbWVfdHh0LAptZXRob2Q6IGZwYXltZW50LnBheW1lbnRfbWV0aG9kX25hbWUKfTsKJHNjb3BlLmlzUGF5bWVudE1ldGhvZFNlbGVjdGVkPXRydWU7Cgpsb2dEZWJ1Zygib2xkIGRhdGUgIiskc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlKTsKaWYgKCRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2RhdGUhPW51bGwpCnsKJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZV9mb3JtYXQgPSBuZXcgRGF0ZSgkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlKTsKfQokc2NvcGUucGF5bWVudE1ldGhvZHMgPSBwYXltZW50TWV0aG9kczsKJHNjb3BlLnBheW1lbnRUeXBlVGl0bGU9ZnBheW1lbnQucGF5bWVudF9tZXRob2RfbmFtZV90eHQ7CiRzY29wZS5mcGF5bWVudC5pbnZvaWNlX3NvdXJjZT0iRVhURVJOQUwiOwoKbG9nRGVidWcoJHNjb3BlLnBheW1lbnRNZXRob2RzKTsKbG9nRGVidWcoInBheW1lbnlEZXRhaWxzTW9kYWxDb250cm9sbGVyIGZvciBwYXltZW50ICIrSlNPTi5zdHJpbmdpZnkoZnBheW1lbnQsIG51bGwsIDQpKTsKCiRzY29wZS5zZWxlY3RQYXltZW50TWV0aG9kID0gZnVuY3Rpb24ocGF5bWVudCkgewokc2NvcGUucGF5bWVudFR5cGVUaXRsZT1wYXltZW50Lm5hbWU7CmxvZ0RlYnVnKCJwYXltZW50PSIrcGF5bWVudCk7Cgokc2NvcGUuc2VsZWN0ZWRQYXltZW50TWV0aG9kPXBheW1lbnQ7CiRzY29wZS5pc1BheW1lbnRNZXRob2RTZWxlY3RlZD10cnVlOwp9OwoKJHNjb3BlLmNsb3NlTW9kYWwgPSBmdW5jdGlvbigpIHsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwp9OwoKJHNjb3BlLnVwZGF0ZVBheW1lbnQgPSBmdW5jdGlvbigpCnsKLy8gbG9nRGVidWcoY3VycmVudENsaWVudCk7CmxvZ0RlYnVnKCJwYXltZW50IG1ldGhvZCIpOwpsb2dEZWJ1Zygkc2NvcGUuc2VsZWN0ZWRQYXltZW50TWV0aG9kKTsKbG9nRGVidWcoIiRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2dlbmVyYXRlZD08Iiskc2NvcGUuZnBheW1lbnQuaW52b2ljZV9nZW5lcmF0ZWQrIj4sICRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2RhdGVfZm9ybWF0PSIrJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZV9mb3JtYXQpOwpsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkUGF5bWVudE1ldGhvZC5tZXRob2Q9Iiskc2NvcGUuc2VsZWN0ZWRQYXltZW50TWV0aG9kLm1ldGhvZCk7CmlmICgoJHNjb3BlLmZwYXltZW50LnBheW1lbnRfYW1vdW50PT0wKSB8fCAoJHNjb3BlLmZwYXltZW50LnBheW1lbnRfYW1vdW50PT0nJykgfHwgKCRzY29wZS5mcGF5bWVudC5wYXltZW50X2Ftb3VudD09bnVsbCkpCnsKJHNjb3BlLnVzZXJFcnJvcj0i15DXoNeQINeU15bXnyDXodeb15XXnSDXm9ec16nXlNeVIjsKLy8gYWxlcnQoJ3NzJyk7Cn0KZWxzZSBpZiAoISRzY29wZS5pc1BheW1lbnRNZXRob2RTZWxlY3RlZCkKewokc2NvcGUudXNlckVycm9yPSLXkNeg15Ag15HXl9eoINeQ157Xptei15kg16rXqdec15XXnSI7Ci8vIGFsZXJ0KCdzcycpOwp9CmVsc2UKewppZiAoKCRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2dlbmVyYXRlZCE9MSkgfHwgKCRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2RhdGVfZm9ybWF0PT1udWxsKSkKewp2YXIgaW52b2ljZV9kYXRlX2Zvcm1hdCA9ICJudWxsIjsKfQplbHNlCnsKdmFyIGludm9pY2VfZGF0ZV9mb3JtYXQgPSAkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlX2Zvcm1hdC5nZXREYXRlKCkgICsgIi0iICsgKCRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2RhdGVfZm9ybWF0LmdldE1vbnRoKCkrMSkgKyAiLSIgKyAkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlX2Zvcm1hdC5nZXRGdWxsWWVhcigpOwp9CnRoZWRhdGE9IHsKYmFsYW5jZVRvUGF5OiAkc2NvcGUuZnBheW1lbnQucGF5bWVudF9hbW91bnQsCnBheW1lbnRfbWV0aG9kX25hbWU6ICRzY29wZS5zZWxlY3RlZFBheW1lbnRNZXRob2QubWV0aG9kLAppbnZvaWNlX251bWJlcjogJHNjb3BlLmZwYXltZW50Lmludm9pY2VfbnVtYmVyLAppbnZvaWNlX2dlbmVyYXRlZDogJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZ2VuZXJhdGVkLAppbnZvaWNlX2RhdGU6IGludm9pY2VfZGF0ZV9mb3JtYXQsCmludm9pY2Vfc291cmNlOiAkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9zb3VyY2UKfTsKdXBkYXRlUGF5bWVudEZvckNsaWVudCgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsZnBheW1lbnQudXNlcl9wYXltZW50X2lkLHRoZWRhdGEsY3JlYXRlUGF5bWVudEZvckNsaWVudF9jYWxsYmFjaywgY3JlYXRlUGF5bWVudEZvckNsaWVudF9mYWlsdXJlKTsKZnVuY3Rpb24gY3JlYXRlUGF5bWVudEZvckNsaWVudF9jYWxsYmFjaygpCnsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwpsb2dEZWJ1ZygiYnJvYWRjYXN0aW5nIGNsaWVudFBhZ2VSZWxvYWREYXRhIik7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKfQpmdW5jdGlvbiBjcmVhdGVQYXltZW50Rm9yQ2xpZW50X2ZhaWx1cmUoKQp7CmxvZ0RlYnVnKCJicm9hZGNhc3RpbmcgY2xpZW50UGFnZVJlbG9hZERhdGEiKTsKLy8gJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwp9Cn0KfQp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ2V2ZW50VHlwZUV4dHJhRmllbGRzTW9kYWxDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIGV2ZW50VHlwZVByb3BlcnRpZXMsIHVpQ2FsZW5kYXJDb25maWcpIHsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXM9ZXZlbnRUeXBlUHJvcGVydGllczsKICBsb2dEZWJ1ZygiZXZlbnRUeXBlRXh0cmFGaWVsZHNNb2RhbENvbnRyb2xsZXI9IitKU09OLnN0cmluZ2lmeShldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzLCBudWxsLCA0KSk7CmlmIChldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzPT1udWxsKQp7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzT3JpZz1bXTsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHM9W107Cn0KZWxzZSBpZiAoZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcy5sZW5ndGg+MCkKewokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllc09yaWc9KGV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMpLnNsaWNlKDApOwp9CmVsc2UKewokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllc09yaWc9W107CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzPVtdOwp9CiRzY29wZS5va0xpbWl0YXRpb25Nb2RhbCA9IGZ1bmN0aW9uKCkgewokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7Cn07Cgokc2NvcGUuY2FuY2VsID0gZnVuY3Rpb24oKQp7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzPSRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzT3JpZzsKbG9nRGVidWcoImNsb3NlIik7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzT3JpZyk7Cn0KJHNjb3BlLnNhdmVBbmRDbG9zZSA9IGZ1bmN0aW9uKCkKewpsb2dEZWJ1Zygic2F2ZSBhbmQgY2xvc2UiKTsKZnVuY3Rpb24gc2V0Q2xpZW50c0V4dHJhRmllbGRzX3N1Y2Nlc3MoKQp7Cgp9CiRzY29wZS5DbGllbnRzRGV0YWlscz17fTsKJHNjb3BlLkNsaWVudHNEZXRhaWxzLmV4dHJhRmllbGRzPSRzY29wZS5leHRyYUZpZWxkczsKc2V0Q2xpZW50c0V4dHJhRmllbGRzKCRodHRwLCRzY29wZSwkc2NvcGUuQ2xpZW50c0RldGFpbHMsc2V0Q2xpZW50c0V4dHJhRmllbGRzX3N1Y2Nlc3MpOwokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyk7Cn0KCiAgJHNjb3BlLmR1cGxpY2F0ZUZpZWxkTmFtZXM9IiI7CiRzY29wZS5hZGRFeHRyYUZpZWxkcyA9IGZ1bmN0aW9uKCkKewogICAgbG9nRGVidWcoImFkZEV4dHJhRmllbGRzIHZhbGlkYXRpbmciKTsKICAgIC8vIGNoZWNraW5nIGZvciBkdXBsaWNhdGUgbmFtZXMKICAgIHZhciBleHRyYUZpZWxkc05hbWVzID0gW107CiAgICBmb3IgKHZhciBpPTE7IGk8JHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMubGVuZ3RoOyBpKyspCiAgICB7CiAgICAgIGV4dHJhRmllbGRzTmFtZXMucHVzaCgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkc1tpXS5maWVsZF9uYW1lKTsKICAgIH0KICAgIGV4dHJhRmllbGRzTmFtZXMuc29ydCgpOwogICAgdmFyIGxhc3QgPSBleHRyYUZpZWxkc05hbWVzWzBdOwogICAgZm9yICh2YXIgaT0xOyBpPGV4dHJhRmllbGRzTmFtZXMubGVuZ3RoOyBpKyspCiAgICB7CiAgICAgICBpZiAoZXh0cmFGaWVsZHNOYW1lc1tpXSA9PSBsYXN0KQogICAgICAgewogICAgICAgIC8vICBhbGVydCgnRHVwbGljYXRlIDogJytsYXN0KTsKICAgICAgICAgJHNjb3BlLmR1cGxpY2F0ZUZpZWxkTmFtZXM9J9en15nXmdedINep15PXlCDXm9ek15XXnCDXkdep150gIicrbGFzdCsnIi4uLic7CiAgICAgICAgIHJldHVybjsKICAgICAgIH0KICAgICAgIGxhc3QgPSBleHRyYUZpZWxkc05hbWVzW2ldOwogICAgfQokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyk7Cn0KCiRzY29wZS5leHRyYUZpZWxkcyA9IGV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHM7CiRzY29wZS5maWVsZFR5cGVzID0gW3tmaWVsZF9kYXRhdHlwZTogIlRFWFRfQVJFQSIsIG5hbWU6J9eq15nXkdeqINeY16fXodeYJ30sIHtmaWVsZF9kYXRhdHlwZTogIk5VTUJFUiIsIG5hbWU6J9ee16HXpNeoJ30gLCB7ZmllbGRfZGF0YXR5cGU6ICJTVFJJTkciLCBuYW1lOifXmNen16HXmCDXp9em16gnfSAsIHtmaWVsZF9kYXRhdHlwZTogIkJPT0xFQU4iLCBuYW1lOifXqteZ15HXqiDXodeZ157XldefJ30gLCB7ZmllbGRfZGF0YXR5cGU6ICJEQVRFIiwgbmFtZTon16rXkNeo15nXmid9XTsKCiRzY29wZS5hZGROZXdGaWVsZCA9IGZ1bmN0aW9uKCkgewp2YXIgbmV3SXRlbU5vID0gJHNjb3BlLmV4dHJhRmllbGRzLmxlbmd0aCsxOwokc2NvcGUuZXh0cmFGaWVsZHMucHVzaCh7ImZpZWxkX2RhdGF0eXBlIjoiU1RSSU5HIiwiaXNfbWFuZGF0b3J5IjowLCAiZnJvbWRiIjogZmFsc2UsICJmaWVsZF9pZCI6IDAsICJpc19hY3RpdmUiOiAxLCAibW9kaWZpZWQiOiAwfSk7CgogICAgbG9nRGVidWcoImV4dHJhIGZpZWxkczogIiArIEpTT04uc3RyaW5naWZ5KCRzY29wZS5leHRyYUZpZWxkcywgbnVsbCwgMikpOwoKfTsKCiRzY29wZS5yZW1vdmVGaWVsZCA9IGZ1bmN0aW9uKGNob2ljZSkKewovLyByZW1vdmluZyBmaWVsZAovLyBpZiBpdHMgbm90IG9yaWdpbmF0ZWQgZnJvbSBkYXRhYmFzZSAtIHRoZW4gd2Ugc2ltcGx5IGRlbGV0ZSBpdCBmcm9tIHRoZSBhcnJheQovLyBvdGhlcndpc2Ugd2UgbWFyayBpdCBhcyBhY3RpdmU9ZmFsc2UKbG9nRGVidWcoY2hvaWNlKTsKLy8gdmFyIGxhc3RJdGVtID0gKGNob2ljZS5pZCktMTsvLyRzY29wZS5jaG9pY2VzLmxlbmd0aC0xOwovLyAkc2NvcGUuY2hvaWNlcy5zcGxpY2UobGFzdEl0ZW0sMSk7CmZvcih2YXIgaSA9IDA7IGkgPCAkc2NvcGUuZXh0cmFGaWVsZHMubGVuZ3RoOyBpKyspCnsKaWYgKCRzY29wZS5leHRyYUZpZWxkc1tpXSA9PSBjaG9pY2UpCnsKaWYgKGNob2ljZS5mcm9tZGI9PWZhbHNlKQp7Ci8vIGlmIG5vdCBmcm9tIGRiIC0gcmVtb3ZpbmcgaXQgZnJvbSB0aGUgYXJyYXkgb2YgZXh0cmEtZmllbGRzCiRzY29wZS5leHRyYUZpZWxkcy5zcGxpY2UoaSwgMSk7Cn0KZWxzZQp7Ci8vIGlmIGZpZWxkIG9yaWdpbmF0ZWQgZnJvbSBkYiAtIHRoYW4gd2UgZG9udCByZW1vdmUgaXQgZnJvbSB0aGUgYXJyYXkKLy8gYW5kIG1hcmsgaXQgYXMgYWN0aXZlPWZhbHNlIHNvIHRoYXQgaXQgY2FuIGJlIGhhbmRlbGVkIG9uIHRoZSBzZXJ2ZXIKY2hvaWNlLmlzX2FjdGl2ZT0wOwpjaG9pY2UubW9kaWZpZWQ9dHJ1ZTsKfQpicmVhazsKfQp9Cn07Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignZXZlbnRDbG9zZUlnbm9yZU1hbmRhdG9yeUZpZWxkc01vZGFsQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHJvdXRlUGFyYW1zLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIGN1cnJlbnRFdmVudCwgdWlDYWxlbmRhckNvbmZpZykgewokc2NvcGUuY3VycmVudEV2ZW50PWN1cnJlbnRFdmVudDsKCiRzY29wZS5va0NhbmNlbCA9IGZ1bmN0aW9uKCkgewokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7Cn07Cgokc2NvcGUuY2xvc2VFdmVudElnbm9yZU1hbmRhdG9yeUZpZWxkcyA9IGZ1bmN0aW9uKCkKewpsb2dEZWJ1ZygiaWdub3JlIG1hbmRhdG9yeSBleHRyYSBmaWVsZHMgYW5kIGNsb3NlIGV2ZW50Iik7CiRzY29wZS5jdXJyZW50RXZlbnQuaWdub3JlRXh0cmFGaWVsZHNWYWxpZGF0aW9uPXRydWU7CmNsb3NlRXZlbnQoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCwkc2NvcGUuY3VycmVudEV2ZW50LGFmdGVyQ2xvc2VFdmVudCxhZnRlckNsb3NlRXZlbnQpOwpmdW5jdGlvbiBhZnRlckNsb3NlRXZlbnQoKQp7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgnZXZlbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7Cn07Cn0KfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdldmVudFR5cGVDaGFuZ2VkUG9wdXBDb250cm9sbGVyJywgZnVuY3Rpb24oJGxvY2F0aW9uLCAkc2NvcGUsICRyb3V0ZVBhcmFtcywgJHJvb3RTY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRodHRwLCBldmVudFR5cGVQcm9wZXJ0aWVzLCB1aUNhbGVuZGFyQ29uZmlnKSB7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzPWV2ZW50VHlwZVByb3BlcnRpZXM7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLnVwZGF0ZWRfZnJvbV9kYXRlPW5ldyBEYXRlKCk7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLnVwZGF0ZV9leGlzdGluZ19ldmVudHM9ZmFsc2U7Cgokc2NvcGUuY2xvc2VNb2RhbCA9IGZ1bmN0aW9uKCkgewokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7Cn07Cgokc2NvcGUudXBkYXRlRXZlbnRUeXBlID0gZnVuY3Rpb24oKQp7CmxvZ0RlYnVnKCJ1cGRhdGUgRXZlbnQgVHlwZSAiICsgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXZlbnRfdHlwZV9pZCk7CmlmICgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5tYXhfcmVnaXN0cmF0aW9ucz09JycpCnsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMubWF4X3JlZ2lzdHJhdGlvbnM9MDsKfQp1cGRhdGVFdmVudFR5cGUoJGh0dHAsJHNjb3BlLCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV2ZW50X3R5cGVfaWQsJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMsdXBkYXRlRXZlbnRUeXBlX3N1Y2Nlc3MpOwpmdW5jdGlvbiB1cGRhdGVFdmVudFR5cGVfc3VjY2VzcygpCnsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwokbG9jYXRpb24ucGF0aCgnL2V2ZW50X3R5cGVzJyk7Cn0KfQoKfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdjbGFzc0RlbGV0ZUFsbE1vZGFsQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHJvb3RTY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRodHRwLCBjdXJyZW50RXZlbnQsIHVpQ2FsZW5kYXJDb25maWcpCnsKbG9nRGVidWcoImNvbnRyb2xsZXI6IGNsYXNzRGVsZXRlQWxsTW9kYWxDb250cm9sbGVyIik7CiRzY29wZS5jdXJyZW50RXZlbnQ9Y3VycmVudEV2ZW50Owokc2NvcGUuY2xvc2VNb2RhbCA9IGZ1bmN0aW9uKCkKewokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7Cn07CgoKJHNjb3BlLmRlbGV0ZUNsYXNzRXZlbnRTaW5nbGU9ZnVuY3Rpb24gKCkgLy8gZGVsZXRlIG9ubHkgb25lL2N1cnJlbnQgY2xhc3MgZXZlaHQKewpjYW5jZWxDbGFzc0V2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkLGNhbmNlbENsYXNzRXZlbnRfY2FsbGJhY2ssIGNhbmNlbENsYXNzRXZlbnRfY2FsbGJhY2spOwpmdW5jdGlvbiBjYW5jZWxDbGFzc0V2ZW50X2NhbGxiYWNrKCkKewpnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkKTsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwokcm9vdFNjb3BlLiRicm9hZGNhc3QoJ3JlbG9hZEV2ZW50Jyx7ZXZlbnRfaWQgOiAkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkfSk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCn0KfQokc2NvcGUuZGVsZXRlQ2xhc3NFdmVudHNBbGw9ZnVuY3Rpb24gKCkgLy8gZGVsZXRlIGFsbCByZXBlYXRpbmcgZXZlbnRzCnsKY2FuY2VsQ2xhc3NSZXBlYXRpbmdFdmVudCgkaHR0cCwkc2NvcGUsMCwkc2NvcGUuY3VycmVudEV2ZW50LnJlcGVhdF9ldmVudF9pZCxjYW5jZWxDbGFzc0V2ZW50X2NhbGxiYWNrLCBjYW5jZWxDbGFzc0V2ZW50X2NhbGxiYWNrKTsKZnVuY3Rpb24gY2FuY2VsQ2xhc3NFdmVudF9jYWxsYmFjaygpCnsKZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCk7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdyZWxvYWRFdmVudCcse2V2ZW50X2lkIDogJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZH0pOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwp9Cn0KJHNjb3BlLmRlbGV0ZUNsYXNzRXZlbnRzQWxsU3RhcnRpbmdFdmVudElEPWZ1bmN0aW9uICgpIC8vIGRlbGV0ZSBhbGwgcmVwZWF0aW5nIGV2ZW50cyBzdGFydGluZyBldmVudF9pZAp7CmNhbmNlbENsYXNzUmVwZWF0aW5nRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQsJHNjb3BlLmN1cnJlbnRFdmVudC5yZXBlYXRfZXZlbnRfaWQsY2FuY2VsQ2xhc3NFdmVudF9jYWxsYmFjaywgY2FuY2VsQ2xhc3NFdmVudF9jYWxsYmFjayk7CmZ1bmN0aW9uIGNhbmNlbENsYXNzRXZlbnRfY2FsbGJhY2soKQp7Ci8vIGdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQpOwokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgncmVsb2FkRXZlbnQnLHtldmVudF9pZCA6ICRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWR9KTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKfQp9Cgp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ2J1c2luZXNzX21vZGFsX2xpbWl0YXRpb25fY3JlYXRlJywgZnVuY3Rpb24oJHNjb3BlLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIHN0YXJ0LGVuZCwgZml4ZWRTY2hlZHVsZSwgdWlDYWxlbmRhckNvbmZpZykgewoKJHNjb3BlLmZpeGVkU2NoZWR1bGU9Zml4ZWRTY2hlZHVsZTsKJHNjb3BlLm9yaWdpbmFsX3N0YXJ0PXN0YXJ0Owokc2NvcGUub3JpZ2luYWxfZW5kPWVuZDsKCiRzY29wZS5zdGFydD1uZXcgbW9tZW50KHN0YXJ0KSoxMDAwOwokc2NvcGUuZW5kPW5ldyBtb21lbnQoZW5kKSoxMDAwOwpjb25zb2xlLmxvZygnc3RhcnQ9JytzdGFydCk7CmNvbnNvbGUubG9nKCdlbmQ9JytlbmQpOwoKZ2V0QnVzaW5lc3NMb2NhdGlvbnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19sb2NhdGlvbnMnLGdldEJ1c2luZXNzTG9jYXRpb25zX3N1Y2Nlc3MpOwpmdW5jdGlvbiBnZXRCdXNpbmVzc0xvY2F0aW9uc19zdWNjZXNzKCkKewokc2NvcGUubmV3RXZlbnREZXRhaWxzLmxvY2F0aW9uX2lkPSRzY29wZS5idXNpbmVzc19sb2NhdGlvbnNbMF0ubG9jYXRpb25faWQ7Cn0KCnNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc3RhcnQpOwpzZWxlY3RlZERhdGVFbmQgPSBuZXcgRGF0ZShlbmQpOwpsb2dEZWJ1Zygic2VsZWN0ZWREYXRlU3RhcnQgPSAiK3NlbGVjdGVkRGF0ZVN0YXJ0KTsKdmFyIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZSgpICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKdmFyIHNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKHNlbGVjdGVkRGF0ZUVuZC5nZXRUaW1lKCkgKyBzZWxlY3RlZERhdGVFbmQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKCi8vIGxvZ0RlYnVnKCJkYXRlPSIgKyBzZWxlY3RlZERhdGVTdGFydCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50ID0gW107CiRzY29wZS5uZXdFdmVudERldGFpbHMgPSBbXTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycyA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldEhvdXJzKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcyA9IChzZWxlY3RlZERhdGVTdGFydC5nZXRNaW51dGVzKCkgPCAxMCA/ICcwJyA6ICcnKSArIHNlbGVjdGVkRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkb3cgPSBkYXlOYW1lc1tzZWxlY3RlZERhdGVTdGFydC5nZXREYXkoKV07CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF0ZSA9IHNlbGVjdGVkRGF0ZVN0YXJ0Owokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoID0gbW9udGhOYW1lc1tzZWxlY3RlZERhdGVTdGFydC5nZXRNb250aCgpXTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aDExMiA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldE1vbnRoKCkrMTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXlvZm1vbnRoID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RGF0ZSgpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXIgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRGdWxsWWVhcigpOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWVfaW5wdXRfZm9ybWF0PSBuZXcgRGF0ZSgxOTcwLCAwLCAxLCAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzLCAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMsIDApOwoKJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMgPSBzZWxlY3RlZERhdGVFbmQuZ2V0SG91cnMoKTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcyA9IChzZWxlY3RlZERhdGVFbmQuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBzZWxlY3RlZERhdGVFbmQuZ2V0TWludXRlcygpOwoKCiRzY29wZS5jYW5jZWwgPSBmdW5jdGlvbigpIHsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwp9OwoKZ2V0QWxsSW5zdHJ1Y3RvcnMoJGh0dHAsJHNjb3BlLCdpbnN0cnVjdG9ycycsZ2V0QWxsSW5zdHJ1Y3RvcnNfc3VjY2Vzcyk7CmZ1bmN0aW9uIGdldEFsbEluc3RydWN0b3JzX3N1Y2Nlc3MoKQp7CiRzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZD0kc2NvcGUuaW5zdHJ1Y3RvcnNbMF0uYnVzaW5lc3NfdXNlcl9pZDsKfQpnZXROb0NsYXNzRXZlbnRUeXBlc05vQWRtaW4oJGh0dHAsJHNjb3BlLCdyZWxhdGVkRXZlbnRUeXBlcycpOwoKJHNjb3BlLmNyZWF0ZU5ld0xpbWl0YXRpb24gPSBmdW5jdGlvbigpCnsKbG9nRGVidWcoImZ1bmN0aW9uOiBjcmVhdGVOZXdMaW1pdGF0aW9uIik7CmNhbGVuZGFyID0gJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnOwoKaWYgKCRzY29wZS5zZWxlY3RlZEV2ZW50VHlwZXMubGVuZ3RoPDEpCnsKcmV0dXJuIGZhbHNlOwp9CmlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vyczwkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKQp7CmFsZXJ0KCLXltee158g16HXmdeV150g15zXpNeg15kg15bXntefINeU16rXl9ec15QiKTsKcmV0dXJuIGZhbHNlOwp9CmlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vycz09JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykKewppZiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlczw9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKQp7CmFsZXJ0KCLXltee158g16HXmdeV150g15zXpNeg15kg15bXntefINeU16rXl9ec15QiKTsKcmV0dXJuIGZhbHNlOwp9CmlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzPCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMrMTApKQp7CmFsZXJ0KCLXkdec15XXpyDXp9eY158g154tMTAg15PXp9eV16oiKTsKcmV0dXJuIGZhbHNlOwp9Cn0KaWYgKCFrdXplSXNDYWxlbmRhckRyYWdnYmxlKSB7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3Vuc2VsZWN0Jyk7Cn0KbG9nRGVidWcoInN0YXJ0PSIgKyBzdGFydCk7CmNoZWNrRGF0ZSA9IG5ldyBEYXRlKHN0YXJ0KTsKbG9nRGVidWcoImNoZWNrIGRhdGUgPSAiICsgY2hlY2tEYXRlKQpsb2dEZWJ1ZygiZW5kPSIgKyBlbmQpOwplY29sb3I9IiMwMGE2NWEiOwoKaWYgKGNoZWNrRGF0ZS5nZXRGdWxsWWVhcigpID09IDE5NzApIHsKZGF5X2xpbWl0X2lkID0gLTE7Cn0gZWxzZSB7CmRheV9saW1pdF9pZCA9IDE7Cn0KCi8vIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW10uZnVsbENhbGVuZGFyKCdyZXJlbmRlckV2ZW50cycpOwoKdGVtcF9saW1pdF9pZCA9IGNhbGNfdGVtcF9saW1pdF9pZCgpOwoKbG9nRGVidWcoJHNjb3BlLnNlbGVjdGVkRXZlbnRUeXBlc1swXSk7CmxvZ0RlYnVnKCRzY29wZS5zZWxlY3RlZEV2ZW50VHlwZXNbMF0uZXZlbnRfdHlwZV9pZCk7CgpzdGFydF9wYXJhbT1zdGFydDsKZW5kX3BhcmFtPWVuZDsKdGl0bGVfcGFyYW09Jyc7CmxvZ0RlYnVnKCJhZGRMaW1pdGF0aW9uVG9EYXRhYmFzZSBzdGFydD0iICsgc3RhcnRfcGFyYW0gKyAiLCBlbmQ9IiArICIsIHRpdGxlPSIgKyB0aXRsZV9wYXJhbSApOwoKdGhlZGF0YSA9IHsKc3RhcnRfZGF0ZTogJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5zdGFydF90aW1lLAplbmRfZGF0ZTogJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmRfdGltZSwKY29sb3I6IGVjb2xvciwKdGVtcF9saW1pdF9pZDogdGVtcF9saW1pdF9pZCwKZW1wX2lkOiAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmluc3RydWN0b3JfaWQsCmxvY2F0aW9uX2lkOiAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmxvY2F0aW9uX2lkLApldmVudF90eXBlX2lkOiAkc2NvcGUuc2VsZWN0ZWRFdmVudFR5cGVzWzBdLmV2ZW50X3R5cGVfaWQsCmV2ZW50X3R5cGVzOiAkc2NvcGUuc2VsZWN0ZWRFdmVudFR5cGVzLAp0aXRsZTogdGl0bGVfcGFyYW0KfTsKCmlmICgkc2NvcGUuZml4ZWRTY2hlZHVsZSkgLy8gZml4ZWQgc2NoZWR1bGUgdnMgc3BlY2lmaWMgd2VlZC9kYXkgbGltaXRhdGlvbgp7CmNyZWF0ZUNhbGVuZGFyTGltaXRhdGlvbigkaHR0cCwkc2NvcGUsdGhlZGF0YSxsaW1pdGF0aW9uX3N1Y2Nlc3NfY2FsbGJhY2spOwp9CmVsc2UKewpjcmVhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXkoJGh0dHAsJHNjb3BlLHRoZWRhdGEsbGltaXRhdGlvbl9zdWNjZXNzX2NhbGxiYWNrKTsKfQpmdW5jdGlvbiBsaW1pdGF0aW9uX3N1Y2Nlc3NfY2FsbGJhY2soKQp7CmxvZ0RlYnVnKCJzdWNjZXNzIik7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKJHVpYk1vZGFsSW5zdGFuY2UuZGlzbWlzcygpOwp9Cgp9Cgokc2NvcGUuc3RhcnRNaW51dGVzID0gZnVuY3Rpb24oKQp7CmxvZ0RlYnVnKCJzdGFydE1pbnV0ZXMgIisoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKSk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcz1taW51dGVzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpOwpjYWxjdWxhdGVTdGFydFRpbWUoKTsKfQokc2NvcGUuc3RhcnRIb3VycyA9IGZ1bmN0aW9uKCkKewpsb2dEZWJ1Zygic3RhcnRIb3VycyAiK2hvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKSk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnM9aG91cnNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMpOwpjYWxjdWxhdGVTdGFydFRpbWUoKTsKfQokc2NvcGUuZW5kTWludXRlcyA9IGZ1bmN0aW9uKCkKewpsb2dEZWJ1ZygiZW5kTWludXRlcyAiKygkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzKSk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXM9bWludXRlc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcyk7CmNhbGN1bGF0ZUVuZFRpbWUoKTsKfQokc2NvcGUuZW5kSG91cnMgPSBmdW5jdGlvbigpCnsKbG9nRGVidWcoImVuZEhvdXJzICIraG91cnNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzKSk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzPWhvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vycyk7CmNhbGN1bGF0ZUVuZFRpbWUoKTsKfQoKCmZ1bmN0aW9uIGNhbGN1bGF0ZVN0YXJ0VGltZSgpCnsKZXZlbnRZZWFyPSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0eWVhcjsKZXZlbnRNb250aD0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoMTEyOwpldmVudERheT0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRheW9mbW9udGg7CmlmIChwYXJzZUludChldmVudE1vbnRoKTwxMCkKewpldmVudE1vbnRoPSIwIitldmVudE1vbnRoOwp9CmlmIChwYXJzZUludChldmVudERheSk8MTApCnsKZXZlbnREYXk9IjAiK2V2ZW50RGF5Owp9CmxvZ0RlYnVnKCIkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXI9IitldmVudFllYXIpOwpsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXlvZm1vbnRoPSIrZXZlbnRNb250aCk7CmxvZ0RlYnVnKCIkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoPSIrZXZlbnREYXkpOwpuZXdfc3RhcnQ9bW9tZW50LnV0YyhldmVudFllYXIrIi0iK2V2ZW50TW9udGgrIi0iK2V2ZW50RGF5KyJUMDA6MDA6MDAiKS5hZGQoKChwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKSo2MCkrcGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKSksICdtaW51dGVzJyk7CiRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZT1uZXdfc3RhcnQ7CmxvZ0RlYnVnKCJuZXdfc3RhcnQ9IituZXdfc3RhcnQpOwp9CmZ1bmN0aW9uIGNhbGN1bGF0ZUVuZFRpbWUoKQp7CmV2ZW50WWVhcj0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXI7CmV2ZW50TW9udGg9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aDExMjsKZXZlbnREYXk9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXlvZm1vbnRoOwppZiAocGFyc2VJbnQoZXZlbnRNb250aCk8MTApCnsKZXZlbnRNb250aD0iMCIrZXZlbnRNb250aDsKfQppZiAocGFyc2VJbnQoZXZlbnREYXkpPDEwKQp7CmV2ZW50RGF5PSIwIitldmVudERheTsKfQpsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyPSIrZXZlbnRZZWFyKTsKbG9nRGVidWcoIiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aD0iK2V2ZW50TW9udGgpOwpsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aD0iK2V2ZW50RGF5KTsKbmV3X2VuZD1tb21lbnQudXRjKGV2ZW50WWVhcisiLSIrZXZlbnRNb250aCsiLSIrZXZlbnREYXkrIlQwMDowMDowMCIpLmFkZCgoKHBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzKSo2MCkrcGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcykpLCAnbWludXRlcycpOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZF90aW1lPW5ld19lbmQ7CmxvZ0RlYnVnKCJuZXdfZW5kPSIrbmV3X2VuZCk7Cn0KCmNhbGN1bGF0ZVN0YXJ0VGltZSgpOwpjYWxjdWxhdGVFbmRUaW1lKCk7CgpmdW5jdGlvbiBtaW51dGVzQ2hhbmdlZCh0aGVtaW51dGVzKQp7CmxvZ0RlYnVnKCJ0aGVtaW51dGVzPSIrdGhlbWludXRlcyk7CmlmICh0eXBlb2YgdGhlbWludXRlcz09InVuZGVmaW5lZCIpCnsKcmV0dXJuICIwMCI7Cn0KdGhlbWludXRlcz1wYXJzZUludCh0aGVtaW51dGVzKTsKaWYgKHRoZW1pbnV0ZXM+NjApCnsKcmV0dXJuICIwMCI7Cn0KZWxzZSBpZiAodGhlbWludXRlczwwKQp7CnJldHVybiAiMDAiOwp9CmVsc2UgaWYgKHRoZW1pbnV0ZXM9PSIiKQp7CnJldHVybiAiMDAiOwp9CmVsc2UgaWYgKHRoZW1pbnV0ZXM8MTApCnsKcmV0dXJuICIwIit0aGVtaW51dGVzOwp9CmVsc2UKewpyZXR1cm4gdGhlbWludXRlczsKfQp9CmZ1bmN0aW9uIGhvdXJzQ2hhbmdlZCh0aGVob3VycykKewpsb2dEZWJ1ZygidGhlaG91cnM9Iit0aGVob3Vycyk7CmlmICh0eXBlb2YgdGhlaG91cnM9PSJ1bmRlZmluZWQiKQp7CnJldHVybiAiMCI7Cn0KdGhlaG91cnM9cGFyc2VJbnQodGhlaG91cnMpOwppZiAodGhlaG91cnM+MjQpCnsKcmV0dXJuIDA7Cn0KZWxzZSBpZiAodGhlaG91cnM8MCkKewpyZXR1cm4gMDsKfQplbHNlIGlmICh0aGVob3Vycz09IiIpCnsKcmV0dXJuICIwIjsKfQplbHNlCnsKcmV0dXJuIHRoZWhvdXJzOwp9Cn0KfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2NsYXNzQ2xvc2VNb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRyb290U2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgZXZlbnRfaWQsIHVpQ2FsZW5kYXJDb25maWcpIHsKZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ3NlbGVjdGVkRXZlbnQnLGV2ZW50X2lkLGFmdGVyR2V0Q2xpZW50U3BlY2lmaWNFdmVudCk7CmZ1bmN0aW9uIGFmdGVyR2V0Q2xpZW50U3BlY2lmaWNFdmVudCgpCnsKZm9yIChpID0gMDsgaSA8ICRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50VXNlcnMubGVuZ3RoOyBpKyspCnsKaWYgKCRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50VXNlcnNbaV0uc3RhdHVzX25hbWUhPSRnVXNlcl9zdGF0dXNfYWJzZW50ZWQpCnsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRVc2Vyc1tpXS5wYXJ0aWNpcGF0ZWQ9dHJ1ZTsKfQppZiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRVc2Vyc1tpXS5pc193YWl0aW5nX2xpc3Q9PTEpCnsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRVc2Vyc1tpXS5wYXJ0aWNpcGF0ZWQ9ZmFsc2U7Cn0KfQpsb2dEZWJ1Zygkc2NvcGUuc2VsZWN0ZWRFdmVudCk7Cn0KCi8vIGNsaWNrZWQgcm93IC0gY2hlY2svdW5jaGVjayB0aGUgY2hlY2tib3ggb2YgYSB1c2VyCiRzY29wZS5yb3dDbGlja2VkID0gZnVuY3Rpb24ob2JqKQp7CmxvZ0RlYnVnKCdyb3cgY2xpY2tlZCcpOwpvYmoucGFydGljaXBhdGVkID0gIW9iai5wYXJ0aWNpcGF0ZWQ7Cn07Cgokc2NvcGUub2tMaW1pdGF0aW9uTW9kYWwgPSBmdW5jdGlvbigpIHsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwp9OwoKJHNjb3BlLmNsb3NlQ2xhc3MgPSBmdW5jdGlvbigpCnsKY2xvc2VDbGFzc0V2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUuc2VsZWN0ZWRFdmVudC5ldmVudF9pZCwkc2NvcGUuc2VsZWN0ZWRFdmVudCxhZnRlckNsb3NlRXZlbnQsYWZ0ZXJDbG9zZUV2ZW50KTsKZnVuY3Rpb24gYWZ0ZXJDbG9zZUV2ZW50KCkKewokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgncmVsb2FkRXZlbnQnLHtldmVudF9pZCA6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50X2lkfSk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCn07Cn0KfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2J1c2luZXNzQ2xpZW5kQ2FyZFBheW1lbnQnLCBmdW5jdGlvbigkc2NvcGUsICRyb3V0ZVBhcmFtcywgJHJvb3RTY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRodHRwLCBjdXJyZW50Q2xpZW50LCBpc3BsdXMsIHVpQ2FsZW5kYXJDb25maWcpCnsKJHNjb3BlLmlzcGx1cz1pc3BsdXM7CmxvZ0RlYnVnKCdidXNpbmVzc0NsaWVuZENhcmRQYXltZW50IGlzcGx1cz0nICtpc3BsdXMrIiBjdXJyZW50Q2xpZW50PSIrIEpTT04uc3RyaW5naWZ5KGN1cnJlbnRDbGllbnQsIG51bGwsIDIpKTsKJHNjb3BlLmt1emVJc0xvYWRpbmc9ZmFsc2U7CmxvZ0RlYnVnKCdjdXJyZW50Q2xpZW50LnBheW1lbnRfYmFsYW5jZT0nK2N1cnJlbnRDbGllbnQucGF5bWVudF9iYWxhbmNlKyIsY3VycmVudENsaWVudC51bnBhaWRfYmFsYW5jZSA9IitjdXJyZW50Q2xpZW50LnVucGFpZF9iYWxhbmNlKTsKdGhlYmFsYW5jZSA9IGN1cnJlbnRDbGllbnQucGF5bWVudF9iYWxhbmNlLWN1cnJlbnRDbGllbnQudW5wYWlkX2JhbGFuY2U7CmxvZ0RlYnVnKCd0aGViYWxhbmNlPScrdGhlYmFsYW5jZSk7CmlmICh0aGViYWxhbmNlPDApCnsKJHNjb3BlLmJhbGFuY2VUb1BheT1NYXRoLmFicyh0aGViYWxhbmNlKTsKfQogIC8vIGVsc2UgaWYgKChjdXJyZW50Q2xpZW50LmJhbGFuY2U+MCkgJiYgKGN1cnJlbnRDbGllbnQudW5wYWlkX2JhbGFuY2U+MCkpCiAgLy8gewogIC8vICAgY29uc29sZS5sb2coImN1cnJlbnRDbGllbnQuYmFsYW5jZT0iK2N1cnJlbnRDbGllbnQuYmFsYW5jZSsiLCBjdXJyZW50Q2xpZW50LnVucGFpZF9iYWxhbmNlPSIrY3VycmVudENsaWVudC51bnBhaWRfYmFsYW5jZSk7CiAgLy8gICBpZiAoY3VycmVudENsaWVudC51bnBhaWRfYmFsYW5jZT5jdXJyZW50Q2xpZW50LmJhbGFuY2UpCiAgLy8gICB7CiAgLy8gICAgICRzY29wZS5iYWxhbmNlVG9QYXk9Y3VycmVudENsaWVudC51bnBhaWRfYmFsYW5jZS1jdXJyZW50Q2xpZW50LmJhbGFuY2U7CiAgLy8gICB9CiAgLy8gICBlbHNlIHsKICAvLyAgICAgJHNjb3BlLmJhbGFuY2VUb1BheT0wOwogIC8vICAgfQogIC8vIH0KZWxzZQp7CiRzY29wZS5iYWxhbmNlVG9QYXk9MDsKfQokc2NvcGUucGF5bWVudFR5cGVUaXRsZT0i15HXl9eoIjsKJHNjb3BlLmN1cnJlbnRDbGllbnQ9Y3VycmVudENsaWVudDsKbG9nRGVidWcoJHNjb3BlLmN1cnJlbnRDbGllbnQpOwokc2NvcGUuYnVzaW5lc3NDb25maWcgPSBCdXNpbmVzc0NvbmZpZy5nZXQoKTsKJHNjb3BlLmJ1c2luZXNzQ29uZmlnLnRoZW4oZnVuY3Rpb24gKGNvbmZpZykgewokc2NvcGUuaW52b2ljZV9zb3VyY2VfaWQgPSBjb25maWcuaW52b2ljZV9zb3VyY2VfaWQ7CiRzY29wZS5oYXNWYXQgPSBjb25maWcudmF0X3JhdGUgPiAwOwp9KTsKCiRzY29wZS5jbG9zZU1vZGFsID0gZnVuY3Rpb24oKSB7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKfTsKCiRzY29wZS5leHRlcm5hbF9pbnZvaWNlX2dlbmVyYXRlZD1mYWxzZTsKJHNjb3BlLmludm9pY2VfZGF0ZV9mb3JtYXQ9bmV3IERhdGUoKTsKCmdldE5leHRJbnZvaWNlTnVtYmVyKCRodHRwLCRzY29wZSwkc2NvcGUuY3VycmVudENsaWVudC5idXNpbmVzc191c2VyX2lkLCdpbnZvaWNlX251bWJlcicpOwoKJHNjb3BlLnBheW1lbnRNZXRob2RzID0gcGF5bWVudE1ldGhvZHM7CiRzY29wZS5jcmVkaXRDYXJkVHlwZXMgPSBjcmVkaXRDYXJkVHlwZXM7CiRzY29wZS5jcmVkaXRUcmFuc2FjdGlvblR5cGVzID0gY3JlZGl0VHJhbnNhY3Rpb25UeXBlczsKJHNjb3BlLmJhbmtzID0gYmFua3M7CgovLyBpbmRpY2F0aW9uIHdoZXRoZXIgcGF5bWVudCBtZXRob2Qgd2FzIHNlbGVjdGVkCiRzY29wZS5pc1BheW1lbnRNZXRob2RTZWxlY3RlZD1mYWxzZTsKJHNjb3BlLnNlbGVjdFBheW1lbnRNZXRob2QgPSBmdW5jdGlvbihwYXltZW50KSB7CiRzY29wZS5wYXltZW50VHlwZVRpdGxlPXBheW1lbnQubmFtZTsKJHNjb3BlLnNlbGVjdGVkUGF5bWVudE1ldGhvZD1wYXltZW50Owokc2NvcGUuaXNQYXltZW50TWV0aG9kU2VsZWN0ZWQ9dHJ1ZTsKfTsKCiRzY29wZS51cGRhdGVCYWxhbmNlID0gZnVuY3Rpb24gdXBkYXRlQmFsYW5jZSAoaXNTb3VyY2VXaXRoVmF0KSB7CiRzY29wZS5idXNpbmVzc0NvbmZpZy50aGVuKGZ1bmN0aW9uIChjb25maWcpIHsKaWYgKGlzU291cmNlV2l0aFZhdCkgewokc2NvcGUuYmFsYW5jZVRvUGF5Tm9WYXQgPSBOdW1iZXIoKCRzY29wZS5iYWxhbmNlVG9QYXkgLyAoMSArIGNvbmZpZy52YXRfcmF0ZSkpLnRvRml4ZWQoMikpOwp9IGVsc2Ugewokc2NvcGUuYmFsYW5jZVRvUGF5ID0gTnVtYmVyKCgkc2NvcGUuYmFsYW5jZVRvUGF5Tm9WYXQgKiAoMSArIGNvbmZpZy52YXRfcmF0ZSkpLnRvRml4ZWQoMikpOwp9Cn0pCn07Cgokc2NvcGUubWFrZVBheW1lbnQgPSBmdW5jdGlvbigpCnsKbG9nRGVidWcoY3VycmVudENsaWVudCk7CmxvZ0RlYnVnKCJwYXltZW50IG1ldGhvZCIpOwpsb2dEZWJ1Zygkc2NvcGUuc2VsZWN0ZWRQYXltZW50TWV0aG9kKTsKbG9nRGVidWcoIiRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2dlbmVyYXRlZD08Iiskc2NvcGUuaW52b2ljZV9nZW5lcmF0ZWQrIj4iKTsKCmlmICgoJHNjb3BlLmJhbGFuY2VUb1BheT09MCkgfHwgKCRzY29wZS5iYWxhbmNlVG9QYXk9PScnKXx8ICgkc2NvcGUuYmFsYW5jZVRvUGF5PT1udWxsKSkKewokc2NvcGUudXNlckVycm9yPSLXkNeg15Ag15TXltefINeh15vXldedINeb15zXqdeU15UiOwp9CmVsc2UgaWYgKCEkc2NvcGUuaXNQYXltZW50TWV0aG9kU2VsZWN0ZWQpCnsKJHNjb3BlLnVzZXJFcnJvcj0i15DXoNeQINeR15fXqCDXkNee16bXoteZINeq16nXnNeV150iOwovLyBhbGVydCgnc3MnKTsKfQplbHNlCnsKaWYgKCgkc2NvcGUuaW52b2ljZV9nZW5lcmF0ZWQhPTEpIHx8ICgkc2NvcGUuaW52b2ljZV9kYXRlX2Zvcm1hdD09bnVsbCkpCnsKdmFyIGludm9pY2VfZGF0ZV9mb3JtYXQgPSAibnVsbCI7Cn0KZWxzZQp7CnZhciBpbnZvaWNlX2RhdGVfZm9ybWF0ID0gJHNjb3BlLmludm9pY2VfZGF0ZV9mb3JtYXQuZ2V0RGF0ZSgpICArICItIiArICgkc2NvcGUuaW52b2ljZV9kYXRlX2Zvcm1hdC5nZXRNb250aCgpKzEpICsgIi0iICsgJHNjb3BlLmludm9pY2VfZGF0ZV9mb3JtYXQuZ2V0RnVsbFllYXIoKTsKfQppZiAoaXNwbHVzKQp7CndoYXRUb1BheT0kc2NvcGUuYmFsYW5jZVRvUGF5Owp9CmVsc2Ugewp3aGF0VG9QYXk9LSRzY29wZS5iYWxhbmNlVG9QYXk7Cn0KdGhlZGF0YT0gewpiYWxhbmNlVG9QYXk6IHdoYXRUb1BheSwKYmFsYW5jZVRvUGF5Tm9WYXQ6ICRzY29wZS5iYWxhbmNlVG9QYXlOb1ZhdCAqIChpc3BsdXMgPyArMSA6IC0xKSwKcGF5bWVudF9tZXRob2RfbmFtZTogJHNjb3BlLnNlbGVjdGVkUGF5bWVudE1ldGhvZC5tZXRob2QsCmludm9pY2VfbnVtYmVyOiAkc2NvcGUuaW52b2ljZV9udW1iZXIsCmludm9pY2VfZ2VuZXJhdGVkOiAkc2NvcGUuaW52b2ljZV9nZW5lcmF0ZWQsCmludm9pY2VfZGF0ZTogaW52b2ljZV9kYXRlX2Zvcm1hdCwKYmFua19jb21wYW55X2NvZGU6ICRzY29wZS5iYW5rX2NvbXBhbnlfY29kZSwKYmFua19icmFuY2hfbnVtYmVyOiAkc2NvcGUuYmFua19icmFuY2hfbnVtYmVyLApjaGVja19udW1iZXI6ICRzY29wZS5jaGVja19udW1iZXIsCmFjY291bnRfbnVtYmVyOiAkc2NvcGUuYWNjb3VudF9udW1iZXIsCmNyZWRpdF9jYXJkX251bWJlcjogJHNjb3BlLmNyZWRpdF9jYXJkX251bWJlciwKY3JlZGl0X2NhcmRfdHlwZTogJHNjb3BlLmNyZWRpdF9jYXJkX3R5cGUsCmNyZWRpdF9jYXJkX3RyYW5zYWN0aW9uX3R5cGU6ICRzY29wZS5jcmVkaXRfY2FyZF90cmFuc2FjdGlvbl90eXBlLAppbnZvaWNlX2NvbW1lbnRzOiAkc2NvcGUuaW52b2ljZV9jb21tZW50cwp9Owokc2NvcGUua3V6ZUlzTG9hZGluZz10cnVlOwpjcmVhdGVQYXltZW50Rm9yQ2xpZW50KCRodHRwLCRzY29wZSxjdXJyZW50Q2xpZW50LmJ1c2luZXNzX3VzZXJfaWQsdGhlZGF0YSxjcmVhdGVQYXltZW50Rm9yQ2xpZW50X3N1Y2Nlc3MsIGNyZWF0ZVBheW1lbnRGb3JDbGllbnRfZmFpbHVyZSk7CmZ1bmN0aW9uIGNyZWF0ZVBheW1lbnRGb3JDbGllbnRfc3VjY2VzcygpCnsKJHNjb3BlLmt1emVJc0xvYWRpbmc9ZmFsc2U7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKbG9nRGVidWcoImJyb2FkY2FzdGluZyBjbGllbnRQYWdlUmVsb2FkRGF0YSIpOwokcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NsaWVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCmxvZ0RlYnVnKCJicm9hZGNhc3RpbmcgZXZlbnRQYWdlUmVsb2FkRGF0YSIpOwokcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2V2ZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKLy8gbG9nRGVidWcoImJyb2FkY2FzdGluZyByZWxvYWRFdmVudCIpOwovLyAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ3JlbG9hZEV2ZW50Jyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCn0KZnVuY3Rpb24gY3JlYXRlUGF5bWVudEZvckNsaWVudF9mYWlsdXJlKCkKewokc2NvcGUua3V6ZUlzTG9hZGluZz1mYWxzZTsKfQp9Cn0KfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdldmVudERldGFpbHNCdXNpbmVzc0NhbGVuZGFyTW9kYWxDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIHNlbGVjdGVkRXZlbnQsIHVpQ2FsZW5kYXJDb25maWcpIHsKdmFyIGRheU5hbWVzID0gWyfXqNeQ16nXldefJywgJ9ep16DXmScsICfXqdec15nXqdeZJywgJ9eo15HXmdei15knLCAn15fXnteZ16nXmScsICfXqdeZ16nXmScsICfXqdeR16onXTsKCiRzY29wZS5nb3RvQ2xpZW50UGFnZT0gZnVuY3Rpb24gKGJ1c2luZXNVc2VyaWQpCnsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwpnb3RvQ2xpZW50UGFnZShidXNpbmVzVXNlcmlkKTsKfQokc2NvcGUuZWRpdEV2ZW50PSBmdW5jdGlvbiAodGhlZXZlbnQpCnsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwpnb3RvRXZlbnRQYWdlKHRoZWV2ZW50KTsKfQoKbG9nRGVidWcoInNlbGVjdGVkIEV2ZW50IGluZm8gPSIgKyBKU09OLnN0cmluZ2lmeShzZWxlY3RlZEV2ZW50LCBudWxsLCAyKSk7CiRzY29wZS5zZWxlY3RlZEV2ZW50ID0gc2VsZWN0ZWRFdmVudDsKc2VsZWN0ZWREYXRlU3RhcnQgPSBuZXcgRGF0ZShzZWxlY3RlZEV2ZW50LnN0YXJ0KTsKdmFyIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZSgpICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKCiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRIb3VycygpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBzZWxlY3RlZERhdGVTdGFydC5nZXRNaW51dGVzKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZG93ID0gZGF5TmFtZXNbc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RGF5KCldOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRhdGUgPSBzZWxlY3RlZERhdGVTdGFydDsKCiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0RGF5ID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RGF0ZSgpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydE1vbnRoID0gMSArIHNlbGVjdGVkRGF0ZVN0YXJ0LmdldE1vbnRoKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0TW9udGhUeHQgPSBtb250aE5hbWVzWyRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0TW9udGggLSAxXTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRZZWFyID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RnVsbFllYXIoKTsKCnNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKHNlbGVjdGVkRXZlbnQuZW5kKTsKdmFyIHNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKHNlbGVjdGVkRGF0ZUVuZC5nZXRUaW1lKCkgKyBzZWxlY3RlZERhdGVFbmQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKCiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzID0gc2VsZWN0ZWREYXRlRW5kLmdldEhvdXJzKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGRvdyA9IGRheU5hbWVzW3NlbGVjdGVkRGF0ZUVuZC5nZXREYXkoKV07CiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKSA8IDEwID8gJzAnIDogJycpICsgc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKTsKJHNjb3BlLm9rTGltaXRhdGlvbk1vZGFsID0gZnVuY3Rpb24oKSB7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKfTsKCiRzY29wZS5kZWxldGVMaW1pdGF0aW9uTW9kYWwgPSBmdW5jdGlvbigpIHsKJHVpYk1vZGFsSW5zdGFuY2UuZGlzbWlzcygnZGVsZXRlJyk7CmNhbGVuZGFyID0gJ2NhbGVuZGFyX2J1c2luZXNzJzsKCiRzY29wZS5kZWxldGVDYWxlbmRhckRCRXZlbnQoc2VsZWN0ZWRFdmVudCwgY2FsZW5kYXIpOwp9Owokc2NvcGUuZGVsZXRlQ2FsZW5kYXJKU0V2ZW50ID0gZnVuY3Rpb24oY2FsZW5kYXIsIHNlbGVjdGVkRXZlbnRpZCkgewoKbG9nRGVidWcoImNhbGVuZGFyX2hvdXJzX29mX3dvcmtfY29uZmlnPSIgKyB1aUNhbGVuZGFyQ29uZmlnKTsKbG9nRGVidWcoInVpQ2FsZW5kYXJDb25maWdbY2FsZW5kYXJdPSIgKyB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1snY2FsZW5kYXJfYnVzaW5lc3MnXSk7CmxvZ0RlYnVnKCJkZWxldGUganMgZXZlbnQgIiArIHNlbGVjdGVkRXZlbnRpZCk7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlbW92ZUV2ZW50cycsIFtzZWxlY3RlZEV2ZW50aWRdKTsgLy8gZ28gdG8gZGF0ZSBpbiBjYWxlbmRhciBnb3RvCn07CiRzY29wZS5kZWxldGVDYWxlbmRhckRCRXZlbnQgPSBmdW5jdGlvbihzZWxlY3RlZEV2ZW50LCBjYWxlbmRhcikgewpsb2dEZWJ1ZygiZGVsZXRlIGV2ZW50ICIgKyBzZWxlY3RlZEV2ZW50LmlkKTsKJGh0dHAoewptZXRob2Q6ICdQT1NUJywKdXJsOiAnL2FwaS9hZG1pbi9ldmVudHMvZGVsZXRlLycgKyBzZWxlY3RlZEV2ZW50LmlkLApkYXRhOiB7CnRlbXBfbGltaXRfaWQ6IHNlbGVjdGVkRXZlbnQudGVtcF9saW1pdF9pZAp9LApoZWFkZXJzOiB7CidDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbjtjaGFyc2V0PXV0Zi04Jwp9Cn0pLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkgewoKbG9nRGVidWcoZGF0YSk7CmlmICghZGF0YS5zdWNjZXNzKSB7CmxvZ0RlYnVnKCJkZWxldGUgbGltaXRfaWQgZXJyb3IgKyIgKyBkYXRhLm1lc3NhZ2UpOwovLyBpZiBub3Qgc3VjY2Vzc2Z1bCwgYmluZCBlcnJvcnMgdG8gZXJyb3IgdmFyaWFibGVzCi8vCQkJICAkc2NvcGUuZXJyb3JOYW1lID0gZGF0YS5lcnJvcnMubmFtZTsKLy8JCQkgICRzY29wZS5lcnJvclN1cGVyaGVybyA9IGRhdGEuZXJyb3JzLnN1cGVyaGVyb0FsaWFzOwp9IGVsc2Ugewpsb2dEZWJ1ZygiZGVsZXRlIGxpbWl0X2lkIHN1Y2Nlc3MiKTsKLy8gaWYgc3VjY2Vzc2Z1bCwgYmluZCBzdWNjZXNzIG1lc3NhZ2UgdG8gbWVzc2FnZQovLwkJCSAgJHNjb3BlLm1lc3NhZ2UgPSBkYXRhLm1lc3NhZ2U7CiRzY29wZS5kZWxldGVDYWxlbmRhckpTRXZlbnQoY2FsZW5kYXIsIHNlbGVjdGVkRXZlbnQuaWQpOwoKfQp9KTsKCmxvZ0RlYnVnKCJhZnRlciByZW1vdmUgZXZlbnQiKTsKfTsKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2V2ZW50UmVjdXJyaW5nRGV0YWlsc0J1c2luZXNzQ2FsZW5kYXJNb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgc2VsZWN0ZWRFdmVudCwgdWlDYWxlbmRhckNvbmZpZykgewp2YXIgZGF5TmFtZXMgPSBbJ9eo15DXqdeV158nLCAn16nXoNeZJywgJ9ep15zXmdep15knLCAn16jXkdeZ16LXmScsICfXl9ee15nXqdeZJywgJ9ep15nXqdeZJywgJ9ep15HXqiddOwoKJHNjb3BlLmdvdG9DbGllbnRQYWdlPSBmdW5jdGlvbiAoYnVzaW5lc3NVc2VyaWQpCnsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwpnb3RvQ2xpZW50UGFnZShidXNpbmVzc1VzZXJpZCk7Cn0KJHNjb3BlLmVkaXRFdmVudD0gZnVuY3Rpb24gKHRoZWV2ZW50KQp7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKZ290b0V2ZW50UGFnZSh0aGVldmVudCk7Cn0KCgpsb2dEZWJ1Zygic2VsZWN0ZWQgUmVjdXJyaW5nIEV2ZW50IGluZm8gPSIgKyBKU09OLnN0cmluZ2lmeShzZWxlY3RlZEV2ZW50LCBudWxsLCAyKSk7CiRzY29wZS5zZWxlY3RlZEV2ZW50ID0gc2VsZWN0ZWRFdmVudDsKc2VsZWN0ZWREYXRlU3RhcnQgPSBuZXcgRGF0ZShzZWxlY3RlZEV2ZW50LnN0YXJ0KTsKdmFyIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZSgpICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKCi8vIGxvZ0RlYnVnKCJzZWxlY3RlZEV2ZW50LnN0YXJ0PSIgKyBzZWxlY3RlZEV2ZW50LnN0YXJ0KTsKLy8gbG9nRGVidWcoImRhdGU9IiArIHNlbGVjdGVkRGF0ZVN0YXJ0KTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycyA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldEhvdXJzKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcyA9IChzZWxlY3RlZERhdGVTdGFydC5nZXRNaW51dGVzKCkgPCAxMCA/ICcwJyA6ICcnKSArIHNlbGVjdGVkRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkb3cgPSBkYXlOYW1lc1tzZWxlY3RlZERhdGVTdGFydC5nZXREYXkoKV07CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF0ZSA9IHNlbGVjdGVkRGF0ZVN0YXJ0OwoKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnREYXkgPSBzZWxlY3RlZERhdGVTdGFydC5nZXREYXRlKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0TW9udGggPSAxICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TW9udGgoKTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRNb250aFR4dCA9IG1vbnRoTmFtZXNbJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRNb250aCAtIDFdOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydFllYXIgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRGdWxsWWVhcigpOwoKc2VsZWN0ZWREYXRlRW5kID0gbmV3IERhdGUoc2VsZWN0ZWRFdmVudC5lbmQpOwp2YXIgc2VsZWN0ZWREYXRlRW5kID0gbmV3IERhdGUoc2VsZWN0ZWREYXRlRW5kLmdldFRpbWUoKSArIHNlbGVjdGVkRGF0ZUVuZC5nZXRUaW1lem9uZU9mZnNldCgpICogNjAwMDApOwoKLy8gbG9nRGVidWcoInNlbGVjdGVkRXZlbnQuZW5kPSIgKyBzZWxlY3RlZEV2ZW50LmVuZCk7Ci8vIGxvZ0RlYnVnKCJkYXRlPSIgKyBzZWxlY3RlZERhdGVFbmQpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycyA9IHNlbGVjdGVkRGF0ZUVuZC5nZXRIb3VycygpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRkb3cgPSBkYXlOYW1lc1tzZWxlY3RlZERhdGVFbmQuZ2V0RGF5KCldOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzID0gKHNlbGVjdGVkRGF0ZUVuZC5nZXRNaW51dGVzKCkgPCAxMCA/ICcwJyA6ICcnKSArIHNlbGVjdGVkRGF0ZUVuZC5nZXRNaW51dGVzKCk7CiRzY29wZS5va0xpbWl0YXRpb25Nb2RhbCA9IGZ1bmN0aW9uKCkgewokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7Cn07Cgp9KTsKCmt1emVBcHAuY29udHJvbGxlcignZXZlbnREZXRhaWxzSG91cnNPZldvcmtNb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgc2VsZWN0ZWRFdmVudCwgZml4ZWRTY2hlZHVsZSwgdWlDYWxlbmRhckNvbmZpZykgewp2YXIgZGF5TmFtZXMgPSBbJ9eo15DXqdeV158nLCAn16nXoNeZJywgJ9ep15zXmdep15knLCAn16jXkdeZ16LXmScsICfXl9ee15nXqdeZJywgJ9ep15nXqdeZJywgJ9ep15HXqiddOwoKLy8gbG9nRGVidWcoInNlbGVjdGVkIEV2ZW50ID0iICsgSlNPTi5zdHJpbmdpZnkoc2VsZWN0ZWRFdmVudCwgbnVsbCwgNCkpOwokc2NvcGUuZml4ZWRTY2hlZHVsZT1maXhlZFNjaGVkdWxlOwokc2NvcGUuc2VsZWN0ZWRFdmVudCA9IHNlbGVjdGVkRXZlbnQ7CiRzY29wZS5zZWxlY3RlZEV2ZW50Lm9yaWdfZXZlbnRfdHlwZXMgPSBhbmd1bGFyLmNvcHkoc2VsZWN0ZWRFdmVudC5ldmVudF90eXBlcyk7CiRzY29wZS5uZXdFdmVudERldGFpbHMgPSBbXTsKCmdldEJ1c2luZXNzTG9jYXRpb25zKCRodHRwLCRzY29wZSwnYnVzaW5lc3NfbG9jYXRpb25zJyk7Cgpsb2dEZWJ1ZygiaG91cnMgb2Ygd29yayBibG9jay9ldmVudCBjbGlja2VkICIrSlNPTi5zdHJpbmdpZnkoJHNjb3BlLnNlbGVjdGVkRXZlbnQpKTsKCnNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc2VsZWN0ZWRFdmVudC5zdGFydCk7CnZhciBzZWxlY3RlZERhdGVTdGFydCA9IG5ldyBEYXRlKHNlbGVjdGVkRGF0ZVN0YXJ0LmdldFRpbWUoKSArIHNlbGVjdGVkRGF0ZVN0YXJ0LmdldFRpbWV6b25lT2Zmc2V0KCkgKiA2MDAwMCk7CmdldEFsbEluc3RydWN0b3JzKCRodHRwLCRzY29wZSwnaW5zdHJ1Y3RvcnMnKTsKZ2V0Tm9DbGFzc0V2ZW50VHlwZXNOb0FkbWluKCRodHRwLCRzY29wZSwncmVsYXRlZEV2ZW50VHlwZXMnLGdldE5vQ2xhc3NFdmVudFR5cGVzTm9BZG1pbl9zdWNjZXNzKTsKZnVuY3Rpb24gZ2V0Tm9DbGFzc0V2ZW50VHlwZXNOb0FkbWluX3N1Y2Nlc3MoKQp7CmZvcih2YXIgaSA9IDA7IGkgPCAkc2NvcGUuc2VsZWN0ZWRFdmVudC5ldmVudF90eXBlcy5sZW5ndGg7IGkrKykKewovLyBjb3B5aW5nIHRoZSBhY3R1YWwgb2JqZWN0IG9mICRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50X3R5cGVzW2ldCmZvcih2YXIgaiA9IDA7IGogPCAkc2NvcGUucmVsYXRlZEV2ZW50VHlwZXMubGVuZ3RoOyBqKyspCnsKaWYgKCRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50X3R5cGVzW2ldLmV2ZW50X3R5cGVfaWQ9PSRzY29wZS5yZWxhdGVkRXZlbnRUeXBlc1tqXS5ldmVudF90eXBlX2lkKQp7CiRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50X3R5cGVzW2ldPWFuZ3VsYXIuY29weSgkc2NvcGUucmVsYXRlZEV2ZW50VHlwZXNbal0pOwp9Cn0KfQp9CgovLyBsb2dEZWJ1Zygic2VsZWN0ZWRFdmVudC5zdGFydD0iICsgc2VsZWN0ZWRFdmVudC5zdGFydCk7Ci8vIGxvZ0RlYnVnKCJkYXRlPSIgKyBzZWxlY3RlZERhdGVTdGFydCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRIb3VycygpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBzZWxlY3RlZERhdGVTdGFydC5nZXRNaW51dGVzKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZG93ID0gZGF5TmFtZXNbc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RGF5KCldOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRhdGUgPSBzZWxlY3RlZERhdGVTdGFydDsKCnNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKHNlbGVjdGVkRXZlbnQuZW5kKTsKdmFyIHNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKHNlbGVjdGVkRGF0ZUVuZC5nZXRUaW1lKCkgKyBzZWxlY3RlZERhdGVFbmQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKCiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bW9udGggPSBtb250aE5hbWVzW3NlbGVjdGVkRGF0ZVN0YXJ0LmdldE1vbnRoKCldOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoMTEyID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TW9udGgoKSsxOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRheW9mbW9udGggPSBzZWxlY3RlZERhdGVTdGFydC5nZXREYXRlKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0eWVhciA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCk7Ci8vICRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZV9pbnB1dF9mb3JtYXQ9IG5ldyBEYXRlKDE5NzAsIDAsIDEsICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMsICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcywgMCk7CgovLyBsb2dEZWJ1Zygic2VsZWN0ZWRFdmVudC5lbmQ9IiArIHNlbGVjdGVkRXZlbnQuZW5kKTsKLy8gbG9nRGVidWcoImRhdGU9IiArIHNlbGVjdGVkRGF0ZUVuZCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzID0gc2VsZWN0ZWREYXRlRW5kLmdldEhvdXJzKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGRvdyA9IGRheU5hbWVzW3NlbGVjdGVkRGF0ZUVuZC5nZXREYXkoKV07CiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKSA8IDEwID8gJzAnIDogJycpICsgc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKTsKCgokc2NvcGUub2tMaW1pdGF0aW9uTW9kYWwgPSBmdW5jdGlvbigpIHsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwp9OwoKJHNjb3BlLnVwZGF0ZUxpbWl0YXRpb25Nb2RhbCA9IGZ1bmN0aW9uKCkKewpsb2dEZWJ1ZygiZnVuY3Rpb246IHVwZGF0ZUxpbWl0YXRpb25Nb2RhbCIpOwppZiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRfdHlwZXMubGVuZ3RoPDEpCnsKcmV0dXJuIGZhbHNlOwp9CmlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vyczwkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKQp7CmFsZXJ0KCLXltee158g16HXmdeV150g15zXpNeg15kg15bXntefINeU16rXl9ec15QiKTsKcmV0dXJuIGZhbHNlOwp9CmlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vycz09JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykKewppZiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlczw9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKQp7CmFsZXJ0KCLXltee158g16HXmdeV150g15zXpNeg15kg15bXntefINeU16rXl9ec15QiKTsKcmV0dXJuIGZhbHNlOwp9CmlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzPCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMrMTApKQp7CmFsZXJ0KCLXkdec15XXpyDXp9eY158g154tMTAg15PXp9eV16oiKTsKcmV0dXJuIGZhbHNlOwp9Cn0KCgpmdW5jdGlvbiB1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25fc3VjY2VzcygpCnsKY2FsZW5kYXIgPSAnY2FsZW5kYXJfaG91cnNfb2Zfd29yayc7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsgLy8gZ28gdG8gZGF0ZSBpbiBjYWxlbmRhciBnb3RvCiR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoJ2RlbGV0ZScpOwp9CgppZiAoJHNjb3BlLmZpeGVkU2NoZWR1bGUpCnsKLy8gZml4ZWQgc2NoZWR1bGUgLSB1cGFkdGluZyBsaW1pdGF0aW9uIDE5NzAKdGhlZGF0YSA9IHsKc3RhcnRfZGF0ZTogbmV3X3N0YXJ0LAplbmRfZGF0ZTogbmV3X2VuZCwKdGVtcF9saW1pdF9pZDogbnVsbCwKbGltaXRfaWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmxpbWl0X2lkLApldmVudF90eXBlczogJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRfdHlwZXMsCmxvY2F0aW9uX2lkOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5sb2NhdGlvbl9pZCwKb3JpZ19ldmVudF90eXBlczogJHNjb3BlLnNlbGVjdGVkRXZlbnQub3JpZ19ldmVudF90eXBlcywKZW1wX2lkOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbXBfaWQKfTsKdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uKCRodHRwLCRzY29wZSx0aGVkYXRhLCRzY29wZS5zZWxlY3RlZEV2ZW50LmxpbWl0X2lkLCB1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25fc3VjY2Vzcyk7Cn0KZWxzZQovLyBub3QgZml4ZWQgc2NoZWR1bGUgLSBwZXJkYXkgYmxvY2sKewovLy8vLy8vLy8vLwppZiAoKCRzY29wZS5zZWxlY3RlZEV2ZW50LmxpbWl0X2lkICE9IG51bGwpICYgKCRzY29wZS5zZWxlY3RlZEV2ZW50LmRheV9saW1pdF9pZCA9PSAtMSkpIC8vIGV2ZW50IGxpbWl0YXRpb24gaGFzIGxpbWl0X2lkIHNvIGl0cyBhbiAxOTcwIGV2ZW50Ci8vIG5lZWQgdG8gYWRkIGEgbmV3IHBlcmRheSBsaW1pdGF0aW9uIHRoYXQgcG9pbnQgKGxpbWl0X2lkKSB0byB0aGUgb2xkIDE5NzAgZXZlbnQgdG8gcmVwbGFjdGUgaXQKewp0ZW1wX2xpbWl0X2lkID0gY2FsY190ZW1wX2xpbWl0X2lkKCk7Ci8vIHRoZWV2ZW50LnRlbXBfbGltaXRfaWQgPSB0ZW1wX2xpbWl0X2lkOwovLyB0aGVldmVudC5kYXlfbGltaXRfaWQgPSB0ZW1wX2xpbWl0X2lkOwovLyB0aGUgbW92ZWQgZXZlbnQgaW4gdGhlIGNhbGVuZGFyIG5vdyBoYXMgZGF5X2xpbWl0X2lkIGFuZCB0ZW1wX2xpbWl0X2lkCi8vIGlmIGl0cyBsb2FkZWQgZnJvbSB0aGUgZGIsIGl0IHdpbGwgb25seSBoYXZlIGRheV9saW1pdF9pZCAoYW5kIG5vdCB0aGUgdGVtcCBvbmUpCi8vIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWydjYWxlbmRhcl9ob3Vyc19vZl93b3JrJ10uZnVsbENhbGVuZGFyKCd1cGRhdGVFdmVudCcsIHRoZWV2ZW50KTsKLy8gY29uc29sZS5sb2coIlhYWFhYWFhYWFhYWFgiKTsKdGhlZGF0YSA9IHsKc3RhcnRfZGF0ZTogbmV3X3N0YXJ0LAplbmRfZGF0ZTogbmV3X2VuZCwKY29sb3I6ICcnLAp0ZW1wX2xpbWl0X2lkOiAwLApldmVudF90eXBlX2lkOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5ldmVudF90eXBlX2lkLApldmVudF90eXBlczogJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRfdHlwZXMsCmxpbWl0X2lkOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5pZCwKbG9jYXRpb25faWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmxvY2F0aW9uX2lkLAplbXBfaWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmVtcF9pZAovLyB0aXRsZTogdGhlZXZlbnQudGl0bGUKfTsKY3JlYXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5KCRodHRwLCRzY29wZSx0aGVkYXRhLHVwZGF0ZUNhbGVuZGFyTGltaXRhdGlvbl9zdWNjZXNzKTsKCn0KZWxzZQp7CnRoZWRhdGE9IHsKc3RhcnRfZGF0ZTogbmV3X3N0YXJ0LAplbmRfZGF0ZTogbmV3X2VuZCwKdGVtcF9kYXlfbGltaXRfaWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LnRlbXBfbGltaXRfaWQsCm9yaWdfZXZlbnRfdHlwZXM6ICRzY29wZS5zZWxlY3RlZEV2ZW50Lm9yaWdfZXZlbnRfdHlwZXMsCmV2ZW50X3R5cGVzOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5ldmVudF90eXBlcywKbG9jYXRpb25faWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmxvY2F0aW9uX2lkLApkYXlfbGltaXRfaWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmRheV9saW1pdF9pZCwKZW1wX2lkOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbXBfaWQKfTsKdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5KCRodHRwLCRzY29wZSx0aGVkYXRhLHVwZGF0ZUNhbGVuZGFyTGltaXRhdGlvbl9zdWNjZXNzKTsKfQp9Cn0KJHNjb3BlLmRlbGV0ZUxpbWl0YXRpb25Nb2RhbCA9IGZ1bmN0aW9uKCkgewpjYWxlbmRhciA9ICdjYWxlbmRhcl9ob3Vyc19vZl93b3JrJzsKCi8vIHJlbW92aW5nIGxpbWl0YXRpb24gZnJvbSBkYXRhYmFzZSwgaWYgdHJ1ZSAtIHJlbW92aW5nIGZyb20gZGlzcGxheSBhbHNvCmlmICgkc2NvcGUuZGVsZXRlQ2FsZW5kYXJEQkxpbWl0YXRpb25FdmVudChzZWxlY3RlZEV2ZW50KSkKewovLyAkc2NvcGUuZGVsZXRlQ2FsZW5kYXJKU0V2ZW50KGNhbGVuZGFyLCBzZWxlY3RlZEV2ZW50LmlkKTsKfQokdWliTW9kYWxJbnN0YW5jZS5kaXNtaXNzKCdkZWxldGUnKTsKfTsKJHNjb3BlLmRlbGV0ZUNhbGVuZGFySlNFdmVudCA9IGZ1bmN0aW9uKGNhbGVuZGFyLCBzZWxlY3RlZEV2ZW50aWQpIHsKCmxvZ0RlYnVnKCJjYWxlbmRhcl9ob3Vyc19vZl93b3JrX2NvbmZpZz0iICsgdWlDYWxlbmRhckNvbmZpZyk7CmxvZ0RlYnVnKCJ1aUNhbGVuZGFyQ29uZmlnW2NhbGVuZGFyXT0iICsgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnXSk7CmxvZ0RlYnVnKCJkZWxldGUganMgZXZlbnQgIiArIHNlbGVjdGVkRXZlbnRpZCk7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlbW92ZUV2ZW50cycsIFtzZWxlY3RlZEV2ZW50aWRdKTsgLy8gZ28gdG8gZGF0ZSBpbiBjYWxlbmRhciBnb3RvCn07CiRzY29wZS5kZWxldGVDYWxlbmRhckRCTGltaXRhdGlvbkV2ZW50ID0gZnVuY3Rpb24oc2VsZWN0ZWRFdmVudCkgewpjYWxlbmRhciA9ICdjYWxlbmRhcl9ob3Vyc19vZl93b3JrJzsKLy8gcmV0dXJuIGZhbHNlOwoKLy8gZGVsZXRpbmcgZXZlbnQgbGltaXRhdGlvbiAobm90IHBlciBkYXkpCi8vIGVpdGhlciBmcm9tIDE5NzAgKGhvdXJzX29mX3dvcmsgcGFnZSkKLy8gb3IgZnJvbSB0aGVpciBpbnN0YW5jZSBpbiB0aGUgY3VycmVudCB3ZWVrJ3MgbGltaXRhdGlvbi4KLy8gZWl0aGVyIHdheSBkYXlfbGltaXRfaWQgaXMgLTEgZm9yIGxpbWl0YXRpb25zIGZyb20gMTk3MAppZiAoc2VsZWN0ZWRFdmVudC5kYXlfbGltaXRfaWQgPT0gLTEpCnsKbG9nRGVidWcoInJlbW92aW5nIGV2ZW50IGxpbWl0YXRpb24sIGNoZWNraWduIGlmIGl0cyBpbiAxOTcwICh0aGUgb3JpZ2luYWwpIG9yIGFuIGluc3RhbmNlIGluIHByZXNlbnQiKTsKc2VsZWN0ZWREYXRlU3RhcnQgPSBuZXcgRGF0ZShzZWxlY3RlZEV2ZW50LnN0YXJ0KTsKLy8gaWYgaXRzIDE5NzAgdGhpcyBtZWFucyB3ZSdyZSBpbiB0aGUgaG91cnNfb2Zfd29yayBnZW5lcmFsIHBhZ2UKLy8gc28gd2Ugc2ltcGx5IGRlbGV0ZSBpdAppZiAoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSA9PSAxOTcwKQp7CmxvZ0RlYnVnKCJyZW1vdmluZyBldmVudCBsaW1pdGF0aW9uIGZyb20gMTk3MCIpOwp0aGVkYXRhPSB7CnRlbXBfbGltaXRfaWQ6IHNlbGVjdGVkRXZlbnQudGVtcF9saW1pdF9pZAp9OwpkZWxldGVDYWxlbmRhckxpbWl0YXRpb24oJGh0dHAsJHNjb3BlLHRoZWRhdGEsc2VsZWN0ZWRFdmVudC5saW1pdF9pZCwgZGVsZXRlQ2FsZW5kYXJMaW1pdGF0aW9uX3N1Y2Nlc3MpOwpmdW5jdGlvbiBkZWxldGVDYWxlbmRhckxpbWl0YXRpb25fc3VjY2VzcygpCnsKJHNjb3BlLmRlbGV0ZUNhbGVuZGFySlNFdmVudChjYWxlbmRhciwgc2VsZWN0ZWRFdmVudC5pZCk7Cn0KfQplbHNlCnsKLy8gcmVtb3ZpbmcgZXZlbnQgbGltaXRhdGlvbiBmcm9tIHRoZSBhIHNwZWNpZmljIHdlZWsKLy8gdGhpcyBtZWFucyBhZGRpbmcgZXZlbnQgbGltaXRhdGlvbiBwZXIgZGF5IHdpdGggcmFuZ2UgZW5kPXN0YXJ0Ci8vIG1heWJlIEJVRyBCVUdHWT8KbG9nRGVidWcoInggcmVtb3ZpbmcgZXZlbnQgbGltaXRhdGlvbiBmcm9tIGEgc3BlY2lmaWMgd2VlaywgdGhpcyBtZWFucyBhZGRpbmcgZXZlbnQgbGltaXRhdGlvbiBwZXIgZGF5IHdpdGggcmFuZ2UgMC0wIik7Ci8vIGxvZ0RlYnVnKEpTT04uc3RyaW5naWZ5KHNlbGVjdGVkRXZlbnQpKTsKCnRoZWRhdGEgPSB7CnN0YXJ0X2RhdGU6IHNlbGVjdGVkRXZlbnQuc3RhcnQsCmVuZF9kYXRlOiBzZWxlY3RlZEV2ZW50LnN0YXJ0LApjb2xvcjogIiMwMDAwMDAiLAp0ZW1wX2xpbWl0X2lkOiAxLApldmVudF90eXBlX2lkOiBzZWxlY3RlZEV2ZW50LmV2ZW50X3R5cGVfaWQsCmxvY2F0aW9uX2lkOiBzZWxlY3RlZEV2ZW50LmxvY2F0aW9uX2lkLApsaW1pdF9pZDogc2VsZWN0ZWRFdmVudC5saW1pdF9pZCwKdGl0bGU6IHNlbGVjdGVkRXZlbnQudGl0bGUKfTsKCmNyZWF0ZUNhbGVuZGFyTGltaXRhdGlvblBlckRheSgkaHR0cCwkc2NvcGUsdGhlZGF0YSxjcmVhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXlfc3VjY2Vzcyk7CmZ1bmN0aW9uIGNyZWF0ZUNhbGVuZGFyTGltaXRhdGlvblBlckRheV9zdWNjZXNzKCkKewokc2NvcGUuZGVsZXRlQ2FsZW5kYXJKU0V2ZW50KGNhbGVuZGFyLCBzZWxlY3RlZEV2ZW50LmlkKTsKfQp9Cn0KZWxzZQp7Ci8vIGRlbGV0aW5nIGEgcGVyZGF5IGxpbWl0YXRpb24uCi8vIGlmIGl0J3MgYSBwZXJkYXkgdGhhdCAicmVwbGFjZWQiIGEgMTk3MCBvbmUKLy8gdGhlbiB3ZSBjYW5ub3QgZGVsZXRlIGl0IChvdGhlcndpc2UgdGhlIG9yaWdpbmFsIDE5NzAgd2lsbCByZWFwcGVhcikKLy8gc28gd2Ugc2V0IGl0IHRvIHN0YXJ0PWVuZAovLyB0aGlzIG1heWJlIGEgQlVHIGFuZCBjYXVzZSBUUk9VQkxFIC8vIFRPRE8KLy8gb3RoZXdpc2Ugd2UgY2FuIGRlbGV0ZSBpdCAtIHRoZSBwZXJkYXkgLSBhcyBpdHMgYSBuZXcgcGVyZGF5IGFuZCBub3QgInJlcGxhY2luZyIgYSAxOTcwIG9uZQoKaWYgKHNlbGVjdGVkRXZlbnQubGltaXRfaWQgIT0gbnVsbCkgLy8gdGhpcyBpcyB0aGUgcGVyZGF5IHRoYXQgcmVwbGFjZXMgYSAxOTcwIG9uZSAtIHdlIHNldCBpdCB0byBzdGFydD1lbmQKewpsb2dEZWJ1ZygicmVtb3ZpbmcgZXZlbnQgbGltaXRhdGlvbiBwZXIgZGF5IHJlbGF0ZWQgdG8gMTk3MCAodXBkYXRpbmcgaXQgdG8gc3RhcnQ9ZW5kKSIpOwoKdGhlZGF0YT0gewpzdGFydF9kYXRlOiBzZWxlY3RlZEV2ZW50LnN0YXJ0LAplbmRfZGF0ZTogc2VsZWN0ZWRFdmVudC5zdGFydCwKdGVtcF9kYXlfbGltaXRfaWQ6IHNlbGVjdGVkRXZlbnQudGVtcF9saW1pdF9pZCwKZGF5X2xpbWl0X2lkOiBzZWxlY3RlZEV2ZW50LmRheV9saW1pdF9pZAp9Owp1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXkoJGh0dHAsJHNjb3BlLHRoZWRhdGEsdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5X3N1Y2Nlcyk7CgpmdW5jdGlvbiB1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXlfc3VjY2VzKCkKewokc2NvcGUuZGVsZXRlQ2FsZW5kYXJKU0V2ZW50KGNhbGVuZGFyLCBzZWxlY3RlZEV2ZW50LmlkKTsKfQp9CmVsc2UgIC8vIHRoaXMgaXMgdGhlIGNhc2Ugd2hlcmUgdGhlIHBlcmRheSBkb2VzbnQgcmVwbGFjZSBhIDE5NzAgb25lLCB3ZSBjYW4gc2ltcGx5IGRlbGV0ZSBpdAp7CmxvZ0RlYnVnKCJyZW1vdmluZyBldmVudCBsaW1pdGF0aW9uIHBlciBkYXkgcmVsYXRlZCBub3QgcmVsYXRlZCB0byAxOTcwIChzbyB3ZSdyZSBkZWxldGluZyBpdCkiKTsKdGhlZGF0YSA9IHsKdGVtcF9saW1pdF9pZDogc2VsZWN0ZWRFdmVudC50ZW1wX2xpbWl0X2lkCn07CmRlbGV0ZUNhbGVuZGFyTGltaXRhdGlvblBlckRheSgkaHR0cCwkc2NvcGUsdGhlZGF0YSxzZWxlY3RlZEV2ZW50LmRheV9saW1pdF9pZCwgZGVsZXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5X3N1Y2Nlc3MpOwpmdW5jdGlvbiBkZWxldGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXlfc3VjY2VzcygpCnsKJHNjb3BlLmRlbGV0ZUNhbGVuZGFySlNFdmVudChjYWxlbmRhciwgc2VsZWN0ZWRFdmVudC5pZCk7Cn0KfQp9CmxvZ0RlYnVnKCJhZnRlciByZW1vdmUgZXZlbnQiKTsKCn07CgoKJHNjb3BlLnN0YXJ0TWludXRlcyA9IGZ1bmN0aW9uKCkKewpsb2dEZWJ1Zygic3RhcnRNaW51dGVzICIrKCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcykpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXM9bWludXRlc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKTsKY2FsY3VsYXRlU3RhcnRUaW1lKCk7Cn0KJHNjb3BlLnN0YXJ0SG91cnMgPSBmdW5jdGlvbigpCnsKbG9nRGVidWcoInN0YXJ0SG91cnMgIitob3Vyc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzPWhvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKTsKY2FsY3VsYXRlU3RhcnRUaW1lKCk7Cn0KJHNjb3BlLmVuZE1pbnV0ZXMgPSBmdW5jdGlvbigpCnsKbG9nRGVidWcoImVuZE1pbnV0ZXMgIisoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcykpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzPW1pbnV0ZXNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpOwpjYWxjdWxhdGVFbmRUaW1lKCk7Cn0KJHNjb3BlLmVuZEhvdXJzID0gZnVuY3Rpb24oKQp7CmxvZ0RlYnVnKCJlbmRIb3VycyAiK2hvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycykpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vycz1ob3Vyc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMpOwpjYWxjdWxhdGVFbmRUaW1lKCk7Cn0KCgpmdW5jdGlvbiBjYWxjdWxhdGVTdGFydFRpbWUoKQp7CmV2ZW50WWVhcj0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXI7CmV2ZW50TW9udGg9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aDExMjsKZXZlbnREYXk9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXlvZm1vbnRoOwppZiAocGFyc2VJbnQoZXZlbnRNb250aCk8MTApCnsKZXZlbnRNb250aD0iMCIrZXZlbnRNb250aDsKfQppZiAocGFyc2VJbnQoZXZlbnREYXkpPDEwKQp7CmV2ZW50RGF5PSIwIitldmVudERheTsKfQoKbmV3X3N0YXJ0PW1vbWVudC51dGMoZXZlbnRZZWFyKyItIitldmVudE1vbnRoKyItIitldmVudERheSsiVDAwOjAwOjAwIikuYWRkKCgocGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykqNjApK3BhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcykpLCAnbWludXRlcycpOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWU9bmV3X3N0YXJ0Owpsb2dEZWJ1ZygibmV3X3N0YXJ0PSIrbmV3X3N0YXJ0KTsKfQpmdW5jdGlvbiBjYWxjdWxhdGVFbmRUaW1lKCkKewpldmVudFllYXI9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyOwpldmVudE1vbnRoPSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bW9udGgxMTI7CmV2ZW50RGF5PSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aDsKaWYgKHBhcnNlSW50KGV2ZW50TW9udGgpPDEwKQp7CmV2ZW50TW9udGg9IjAiK2V2ZW50TW9udGg7Cn0KaWYgKHBhcnNlSW50KGV2ZW50RGF5KTwxMCkKewpldmVudERheT0iMCIrZXZlbnREYXk7Cn0KCm5ld19lbmQ9bW9tZW50LnV0YyhldmVudFllYXIrIi0iK2V2ZW50TW9udGgrIi0iK2V2ZW50RGF5KyJUMDA6MDA6MDAiKS5hZGQoKChwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycykqNjApK3BhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpKSwgJ21pbnV0ZXMnKTsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmRfdGltZT1uZXdfZW5kOwpsb2dEZWJ1ZygibmV3X2VuZD0iK25ld19lbmQpOwp9CgpjYWxjdWxhdGVTdGFydFRpbWUoKTsKY2FsY3VsYXRlRW5kVGltZSgpOwoKZnVuY3Rpb24gbWludXRlc0NoYW5nZWQodGhlbWludXRlcykKewpsb2dEZWJ1ZygidGhlbWludXRlcz0iK3RoZW1pbnV0ZXMpOwppZiAodHlwZW9mIHRoZW1pbnV0ZXM9PSJ1bmRlZmluZWQiKQp7CnJldHVybiAiMDAiOwp9CnRoZW1pbnV0ZXM9cGFyc2VJbnQodGhlbWludXRlcyk7CmlmICh0aGVtaW51dGVzPjYwKQp7CnJldHVybiAiMDAiOwp9CmVsc2UgaWYgKHRoZW1pbnV0ZXM8MCkKewpyZXR1cm4gIjAwIjsKfQplbHNlIGlmICh0aGVtaW51dGVzPT0iIikKewpyZXR1cm4gIjAwIjsKfQplbHNlIGlmICh0aGVtaW51dGVzPDEwKQp7CnJldHVybiAiMCIrdGhlbWludXRlczsKfQplbHNlCnsKcmV0dXJuIHRoZW1pbnV0ZXM7Cn0KfQpmdW5jdGlvbiBob3Vyc0NoYW5nZWQodGhlaG91cnMpCnsKbG9nRGVidWcoInRoZWhvdXJzPSIrdGhlaG91cnMpOwppZiAodHlwZW9mIHRoZWhvdXJzPT0idW5kZWZpbmVkIikKewpyZXR1cm4gIjAiOwp9CnRoZWhvdXJzPXBhcnNlSW50KHRoZWhvdXJzKTsKaWYgKHRoZWhvdXJzPjI0KQp7CnJldHVybiAwOwp9CmVsc2UgaWYgKHRoZWhvdXJzPDApCnsKcmV0dXJuIDA7Cn0KZWxzZSBpZiAodGhlaG91cnM9PSIiKQp7CnJldHVybiAiMCI7Cn0KZWxzZQp7CnJldHVybiB0aGVob3VyczsKfQp9Cgp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ0V2ZW50VHlwZXNDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGNvbXBpbGUsIHVpQ2FsZW5kYXJDb25maWcsICR1aWJNb2RhbCwkbG9jYXRpb24pIHsKbG9nRGVidWcoJ0V2ZW50VHlwZXMgQ29udHJvbGxlcicpOwoKZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzKCRodHRwLCRzY29wZSwnZXZlbnRfdHlwZXMnKTsKJHNjb3BlLnNob3dFdmVudFR5cGUgPSBmdW5jdGlvbiAodGhlRXZlbnQpCnsKJGxvY2F0aW9uLnBhdGgoJy9ldmVudF90eXBlcy8nK3RoZUV2ZW50LmV2ZW50X3R5cGVfaWQpOwp9Cn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdFdmVudFR5cGVOZXdDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGNvbXBpbGUsIHVpQ2FsZW5kYXJDb25maWcsICR1aWJNb2RhbCwgJGxvY2F0aW9uKSB7CmxvZ0RlYnVnKCdFdmVudFR5cGVzIENvbnRyb2xsZXIgTmV3Jyk7Cgokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcyA9IHt9OyAvLyB0aGVzZSBhcmUgdGhlIGNvbXBsZXRlIGRldGFpbHMgZm9yIHRoZSBuZXcgZXZlbnQgLy8KJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuaXNfY2xhc3MgPSAwOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5ibG9ja0V4dHJhVGltZSA9IGZhbHNlOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5kdXJhdGlvbl9iZWZvcmVfZXZlbnQgPSAwOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5kdXJhdGlvbl9hZnRlcl9ldmVudCA9IDA7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmluaGVyaXRfbWFpbl9ob3VycyA9IDE7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF93YWl0aW5nX2xpc3QgPSAzOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5pc191cGRhdGUgPSBmYWxzZTsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMubWF4X3BhcnRpY2lwYW50cyA9IDE7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF9yZWdpc3RyYXRpb25zPTE7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmlzX3B1YmxpYz0xOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5pbnN0cnVjdG9yX2lkPTA7Cgokc2NvcGUuZXZlbnRDb2xvclN0eWxlID0ge307CmRlZmF1bHRDb2xvciA9ICcwMGE2NWEnOwokc2NvcGUuZXZlbnRDb2xvclN0eWxlW2RlZmF1bHRDb2xvcl0gPSB7Cid0cmFuc2Zvcm0nOiAncm90YXRlKDMwZGVnKScKfTsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXZlbnRDb2xvciA9ICIjIiArIGRlZmF1bHRDb2xvcjsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMgPSBbCnsiZmllbGRfbmFtZSI6Iteh15nXm9eV150g157XpNeS16kiLCJmaWVsZF9kYXRhdHlwZSI6IlRFWFRfQVJFQSIsImlzX21hbmRhdG9yeSI6MCwgImZyb21kYiI6IGZhbHNlLCAiZGJfaWRfdG9maXgiOiAwLCAiaXNfYWN0aXZlIjogMSwgIm1vZGlmaWVkIjogZmFsc2V9LAp7ImZpZWxkX25hbWUiOiLXqdeZ16LXldeo15kg15HXmdeqIiwiZmllbGRfZGF0YXR5cGUiOiJURVhUX0FSRUEiLCJpc19tYW5kYXRvcnkiOjAsICJmcm9tZGIiOiBmYWxzZSwgImRiX2lkX3RvZml4IjogMCwgImlzX2FjdGl2ZSI6IDEsICJtb2RpZmllZCI6IGZhbHNlfQpdOwoKZ2V0QWxsSW5zdHJ1Y3RvcnMoJGh0dHAsJHNjb3BlLCdpbnN0cnVjdG9ycycsZ2V0QWxsSW5zdHJ1Y3RvcnNfc3VjY2Vzcyk7CmZ1bmN0aW9uIGdldEFsbEluc3RydWN0b3JzX3N1Y2Nlc3MoKQp7Ci8vICRzY29wZS5pbnN0cnVjdG9ycy51bnNoaWZ0KHtidXNpbmVzc191c2VyX2lkOjAsIGJ1c2VyX2ZpcnN0X25hbWU6IiIsIGJ1c2VyX2xhc3RfbmFtZToiIn0pOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5pbnN0cnVjdG9yX2lkPSRzY29wZS5pbnN0cnVjdG9yc1swXS5idXNpbmVzc191c2VyX2lkOwp9Cgokc2NvcGUuZXZlbnRUeXBlRXh0cmFGaWVsZHNQb3AgPSBmdW5jdGlvbihldmVudFR5cGVQcm9wZXJ0aWVzKSB7CiAgICAgICAgbG9nRGVidWcoImV2ZW50VHlwZUV4dHJhRmllbGRzUG9wMSIpOwoKdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CmFuaW1hdGlvbjogZmFsc2UsCnRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2V2ZW50X3R5cGVfZXh0cmFfZmllbGRzLnBocCcsCmNvbnRyb2xsZXI6ICdldmVudFR5cGVFeHRyYUZpZWxkc01vZGFsQ29udHJvbGxlcicsCnNpemU6ICdsJywKcmVzb2x2ZTogewpldmVudFR5cGVQcm9wZXJ0aWVzOiBmdW5jdGlvbigpIHsKcmV0dXJuIGV2ZW50VHlwZVByb3BlcnRpZXM7Cn0KfQp9KTsKCm1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24oc2VsZWN0ZWRJdGVtKSB7CmxvZ0RlYnVnKHNlbGVjdGVkSXRlbSk7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzID0gc2VsZWN0ZWRJdGVtOwp9LCBmdW5jdGlvbigpIHsKbG9nRGVidWcoJ01vZGFsIGRpc21pc3NlZCBhdDogJyArIG5ldyBEYXRlKCkpOwp9KTsKfTsKCiRzY29wZS5jaGFuZ2VFdmVudENvbG9yID0gZnVuY3Rpb24obmV3Q29sb3IpIHsKbG9nRGVidWcoImNob29zaW5nIGNvbG9yICIgKyBuZXdDb2xvcik7CiRzY29wZS5ldmVudENvbG9yID0gbmV3Q29sb3I7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV2ZW50Q29sb3IgPSAiIyIgKyBuZXdDb2xvcjsKJHNjb3BlLmV2ZW50Q29sb3JTdHlsZSA9IHsKJ2JhY2tncm91bmQtY29sb3InOiAiIyIgKyBuZXdDb2xvcgp9Owokc2NvcGUuZXZlbnRDb2xvclN0eWxlW25ld0NvbG9yXSA9IHsKJ3RyYW5zZm9ybSc6ICdyb3RhdGUoMzBkZWcpJwp9OwoKfQoKJHNjb3BlLmFkZEV2ZW50VHlwZUNhbmNlbCA9IGZ1bmN0aW9uKCkgewokbG9jYXRpb24ucGF0aCgnL2V2ZW50X3R5cGVzJyk7Cn07CgogICAgJHNjb3BlLmR1cGxpY2F0ZUZpZWxkTmFtZXM9IiI7CiRzY29wZS5hZGRFdmVudFR5cGUgPSBmdW5jdGlvbigpIHsKICAgICAgICAvLyBjaGVjayBleHRyYSBmaWVsZHMgZHVwbGljYXRlIG5hbWVzIC0gc3RhcnQKICAgICAgICBsb2dEZWJ1ZygiYWRkRXZlbnRUeXBlOiBjaGVjayBleHRyYSBmaWVsZHMgZHVwbGljYXRlIG5hbWVzIC0gc3RhcnQiKTsKICAgICAgICB2YXIgZXh0cmFGaWVsZHNOYW1lcyA9IFtdOwogICAgICAgIGZvciAodmFyIGk9MTsgaTwkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcy5sZW5ndGg7IGkrKykKICAgICAgICB7CiAgICAgICAgICBleHRyYUZpZWxkc05hbWVzLnB1c2goJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHNbaV0uZmllbGRfbmFtZSk7CiAgICAgICAgfQogICAgICAgIGV4dHJhRmllbGRzTmFtZXMuc29ydCgpOwogICAgICAgIHZhciBsYXN0ID0gZXh0cmFGaWVsZHNOYW1lc1swXTsKICAgICAgICBmb3IgKHZhciBpPTE7IGk8ZXh0cmFGaWVsZHNOYW1lcy5sZW5ndGg7IGkrKykKICAgICAgICB7CiAgICAgICAgICAgaWYgKGV4dHJhRmllbGRzTmFtZXNbaV0gPT0gbGFzdCkKICAgICAgICAgICB7CiAgICAgICAgICAgIC8vICBhbGVydCgnRHVwbGljYXRlIDogJytsYXN0KTsKICAgICAgICAgICAgICRzY29wZS5kdXBsaWNhdGVGaWVsZE5hbWVzPSfXp9eZ15nXnSDXqdeT15Qg16rXmdei15XXkyDXqNek15XXkNeZINeb16TXldecINeR16nXnSAiJytsYXN0KyciLi4uJzsKICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICB9CiAgICAgICAgICAgbGFzdCA9IGV4dHJhRmllbGRzTmFtZXNbaV07CiAgICAgICAgfQogICAgICAgIC8vIGNoZWNrIGV4dHJhIGZpZWxkcyBkdXBsaWNhdGUgbmFtZXMgLSBlbmQKCmxvZ0RlYnVnKCJhZGQgRXZlbnQgVHlwZSIgKyAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcyArICJleHRyYSBmaWVsZHM9IiArJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMpOwppZiAoKCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF9yZWdpc3RyYXRpb25zPT0nJykgfHwgKCEkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5tYXhfcmVnaXN0cmF0aW9ucykpCnsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMubWF4X3JlZ2lzdHJhdGlvbnM9MDsKfQphZGRFdmVudFR5cGUoJGh0dHAsJHNjb3BlLCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLGFkZEV2ZW50VHlwZV9zdWNjZXNzKTsKZnVuY3Rpb24gYWRkRXZlbnRUeXBlX3N1Y2Nlc3MoKQp7CiRsb2NhdGlvbi5wYXRoKCcvZXZlbnRfdHlwZXMnKTsKfQp9Owp9KTsKCmt1emVBcHAuY29udHJvbGxlcignRXZlbnRUeXBlVXBkYXRlQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRjb21waWxlLCAkcm91dGVQYXJhbXMsIHVpQ2FsZW5kYXJDb25maWcsICR1aWJNb2RhbCwgJGxvY2F0aW9uKSB7CmV2ZW50X3R5cGVfaWQ9JHJvdXRlUGFyYW1zLmV2ZW50X3R5cGVfaWQ7CmxvZ0RlYnVnKCdFdmVudFR5cGVzIENvbnRyb2xsZXIgVXBkYXRlICcrZXZlbnRfdHlwZV9pZCk7Cgokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcyA9IHt9OyAvLyB0aGVzZSBhcmUgdGhlIGNvbXBsZXRlIGRldGFpbHMgZm9yIHRoZSBuZXcgZXZlbnQgLy8KJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuaXNfdXBkYXRlID0gdHJ1ZTsKCiRzY29wZS5ldmVudENvbG9yU3R5bGUgPSB7fTsKZ2V0QWxsSW5zdHJ1Y3RvcnMoJGh0dHAsJHNjb3BlLCdpbnN0cnVjdG9ycycsZ2V0QWxsSW5zdHJ1Y3RvcnNfc3VjY2Vzcyk7CmZ1bmN0aW9uIGdldEFsbEluc3RydWN0b3JzX3N1Y2Nlc3MoKQp7CiRzY29wZS5pbnN0cnVjdG9ycy51bnNoaWZ0KHtidXNpbmVzc191c2VyX2lkOm51bGwsIGJ1c2VyX2ZpcnN0X25hbWU6IiIsIGJ1c2VyX2xhc3RfbmFtZToiIn0pOwp9CgpnZXRCdXNpbmVzc0V2ZW50VHlwZSgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmV2ZW50X3R5cGVfaWQsJ2V2ZW50VHlwZVByb3BlcnRpZXMnLGdldEJ1c2luZXNzRXZlbnRUeXBlX3N1Y2Nlc3MpOwoKZnVuY3Rpb24gZ2V0QnVzaW5lc3NFdmVudFR5cGVfc3VjY2VzcygpCnsKaWYgKCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF9yZWdpc3RyYXRpb25zPT1udWxsKQp7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF9yZWdpc3RyYXRpb25zPTE7Cn0KaWYgKCgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5kdXJhdGlvbl9iZWZvcmVfZXZlbnQ+MCkgfCAoJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZHVyYXRpb25fYWZ0ZXJfZXZlbnQ+MCkpCnsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuYmxvY2tFeHRyYVRpbWUgPSAxOwp9CmVsc2UKewokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5ibG9ja0V4dHJhVGltZSA9IDA7Cn0KLy8gJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuaW5oZXJpdF9tYWluX2hvdXJzID0gcmVzcG9uc2UuZGF0YVswXS5pbmhlcml0X21haW5faG91cnM7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmlzX3VwZGF0ZSA9IHRydWU7CmxvZ0RlYnVnKCIkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5jb2xvcj0iKyRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmNvbG9yKTsKJHNjb3BlLmV2ZW50Q29sb3JTdHlsZVskc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5jb2xvcl0gPSB7Cid0cmFuc2Zvcm0nOiAncm90YXRlKDMwZGVnKScKfTsKJHNjb3BlLmNoYW5nZUV2ZW50Q29sb3IoKCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmNvbG9yKS5zdWJzdHIoMSkpOwpsb2dEZWJ1ZygiJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuaW5zdHJ1Y3Rvcl9pZD0iKyRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmluc3RydWN0b3JfaWQpOwovLyBzYXZpbmcgZXZlbnQgdHlwZSBkZXRhaWxzIGFzaWRlIHRvIGxhdGVyIGNoZWNrIGlmIGFueXRoaW5nIGNoYW5nZWQKbG9nRGVidWcoImR1cGxpY2F0aW5nIG9iamVjdCBvZiBldmVudCB0eXBlIHRvIGxhdGVyIGNvbXBhcmUgIit0eXBlb2YgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMpOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllc0R1cGxpY2F0ZSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMpKTsKbG9nRGVidWcoIiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzRHVwbGljYXRlID0iKyRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzRHVwbGljYXRlLmV2ZW50X3R5cGVfbmFtZSk7Cn07CgovLyBldmVudCB0eXBlIGNoYW5nZWQgcG9wdXAKJHNjb3BlLmV2ZW50VHlwZUNoYW5nZWRQb3B1cCA9IGZ1bmN0aW9uKGV2ZW50VHlwZVByb3BlcnRpZXMpIHsKICAgICAgICBsb2dEZWJ1ZygiZXZlbnRUeXBlQ2hhbmdlZFBvcHVwIik7Cgp2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKYW5pbWF0aW9uOiBmYWxzZSwKdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfZXZlbnRfdHlwZV9jaGFuZ2VkLnBocCcsCmNvbnRyb2xsZXI6ICdldmVudFR5cGVDaGFuZ2VkUG9wdXBDb250cm9sbGVyJywKc2l6ZTogJ2wnLApyZXNvbHZlOiB7CmV2ZW50VHlwZVByb3BlcnRpZXM6IGZ1bmN0aW9uKCkgewpyZXR1cm4gJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXM7Cn0KfQp9KTsKCm1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24oc2VsZWN0ZWRJdGVtKQp7CmxvZ0RlYnVnKHNlbGVjdGVkSXRlbSk7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzID0gc2VsZWN0ZWRJdGVtOwp9LCBmdW5jdGlvbigpIHsKbG9nRGVidWcoJ01vZGFsIGRpc21pc3NlZCBhdDogJyArIG5ldyBEYXRlKCkpOwp9KTsKfTsKCi8vIGV2ZW50IHR5cGUgZXh0cmEgZmllbGQgcG9wdXAKJHNjb3BlLmV2ZW50VHlwZUV4dHJhRmllbGRzUG9wID0gZnVuY3Rpb24oZXZlbnRUeXBlUHJvcGVydGllcykgewogICAgICAgIGxvZ0RlYnVnKCJldmVudFR5cGVFeHRyYUZpZWxkc1BvcDIiKTsKCnZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewphbmltYXRpb246IGZhbHNlLAp0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9ldmVudF90eXBlX2V4dHJhX2ZpZWxkcy5waHAnLApjb250cm9sbGVyOiAnZXZlbnRUeXBlRXh0cmFGaWVsZHNNb2RhbENvbnRyb2xsZXInLApzaXplOiAnbCcsCnJlc29sdmU6IHsKZXZlbnRUeXBlUHJvcGVydGllczogZnVuY3Rpb24oKSB7CnJldHVybiBldmVudFR5cGVQcm9wZXJ0aWVzOwp9Cn0KfSk7Cgptb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHNlbGVjdGVkSXRlbSkgewpsb2dEZWJ1ZyhzZWxlY3RlZEl0ZW0pOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyA9IHNlbGVjdGVkSXRlbTsKfSwgZnVuY3Rpb24oKSB7CmxvZ0RlYnVnKCdNb2RhbCBkaXNtaXNzZWQgYXQ6ICcgKyBuZXcgRGF0ZSgpKTsKfSk7Cn07CgoKJHNjb3BlLmNoYW5nZUV2ZW50Q29sb3IgPSBmdW5jdGlvbihuZXdDb2xvcikgewpsb2dEZWJ1ZygiY2hvb3NpbmcgY29sb3IgIiArIG5ld0NvbG9yKTsKJHNjb3BlLmV2ZW50Q29sb3IgPSBuZXdDb2xvcjsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXZlbnRDb2xvciA9ICIjIiArIG5ld0NvbG9yOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5jb2xvciA9ICIjIiArIG5ld0NvbG9yOwokc2NvcGUuZXZlbnRDb2xvclN0eWxlID0gewonYmFja2dyb3VuZC1jb2xvcic6ICIjIiArIG5ld0NvbG9yCn07CiRzY29wZS5ldmVudENvbG9yU3R5bGVbbmV3Q29sb3JdID0gewondHJhbnNmb3JtJzogJ3JvdGF0ZSgzMGRlZyknCn07Cgp9Cgokc2NvcGUuYWRkRXZlbnRUeXBlQ2FuY2VsID0gZnVuY3Rpb24oKSB7CiRsb2NhdGlvbi5wYXRoKCcvZXZlbnRfdHlwZXMnKTsKfTsKCiRzY29wZS5hZGRFdmVudFR5cGUgPSBmdW5jdGlvbigpIHsgLy8gdGhpcyBmdW5jdGlvbiBVUERBVEVTIGV2ZW50IHR5cGUgKG5vdCBhZGRzKQovLyBjaGVja2luZyBpZiBhbnl0aGluZyBjaGFuZ2VkIHJlYWxseQovLyBhbmQgYXNraW5nIGlmIHdlIHNob3VsZCB1cGRhdGUgYWxsIGV2ZW50cyBmcm9tIG5vdyAob3Igb25seSBuZXdseSBjcmVhdGVkIGV2ZW50cykKLy8gY2hlY2tpbmcKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXNEdXBsaWNhdGUuZXh0cmFGaWVsZHM9JHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHM7CiAgICAgIC8vIGlmIChhbmd1bGFyLmVxdWFscygkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllc0R1cGxpY2F0ZSwkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcykpCiAgICAgIGlmICh0cnVlKSAvLyBpZ25vcmluZyB0cnlpbmcgdG8gbWFrZSBjaGFuZ2VzIHRvIGV2ZW50cwp7Ci8vICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzRHVwbGljYXRlLmV4dHJhRmllbGRzID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcykpOwoKbG9nRGVidWcoIm5vdGhpbmcgY2hhbmdlZCBpbiBldmVudCB0eXBlLCBvciBvbmx5IGV4dHJhIGZpZWxkcyIpOwokc2NvcGUudXBkYXRlRXZlbnRUeXBlKCk7Cn0KZWxzZQp7CmxvZ0RlYnVnKCJldmVudCB0eXBlIGNoYW5nZWQiKTsKJHNjb3BlLmV2ZW50VHlwZUNoYW5nZWRQb3B1cCgpOwp9Ci8vICRzY29wZS51cGRhdGVFdmVudFR5cGUoKTsKfQokc2NvcGUudXBkYXRlRXZlbnRUeXBlID0gZnVuY3Rpb24oKQp7CiAgICAgIC8vIGNoZWNrIGV4dHJhIGZpZWxkcyBkdXBsaWNhdGUgbmFtZXMgLSBzdGFydAogICAgICBsb2dEZWJ1ZygiYWRkRXZlbnRUeXBlOiBjaGVjayBleHRyYSBmaWVsZHMgZHVwbGljYXRlIG5hbWVzIC0gc3RhcnQiKTsKICAgICAgdmFyIGV4dHJhRmllbGRzTmFtZXMgPSBbXTsKICAgICAgZm9yICh2YXIgaT0xOyBpPCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzLmxlbmd0aDsgaSsrKQogICAgICB7CiAgICAgICAgZXh0cmFGaWVsZHNOYW1lcy5wdXNoKCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzW2ldLmZpZWxkX25hbWUpOwogICAgICB9CiAgICAgIGV4dHJhRmllbGRzTmFtZXMuc29ydCgpOwogICAgICB2YXIgbGFzdCA9IGV4dHJhRmllbGRzTmFtZXNbMF07CiAgICAgIGZvciAodmFyIGk9MTsgaTxleHRyYUZpZWxkc05hbWVzLmxlbmd0aDsgaSsrKQogICAgICB7CiAgICAgICAgIGlmIChleHRyYUZpZWxkc05hbWVzW2ldID09IGxhc3QpCiAgICAgICAgIHsKICAgICAgICAgIC8vICBhbGVydCgnRHVwbGljYXRlIDogJytsYXN0KTsKICAgICAgICAgICAgbG9nRGVidWcoJ9en15nXmdedINep15PXlCDXqteZ16LXldeTINeo16TXldeQ15kg15vXpNeV15wg15HXqdedICInK2xhc3QrJyIuLi4nKTsKICAgICAgICAgICAkc2NvcGUuZHVwbGljYXRlRmllbGROYW1lcz0n16fXmdeZ150g16nXk9eUINeq15nXoteV15Mg16jXpNeV15DXmSDXm9ek15XXnCDXkdep150gIicrbGFzdCsnIi4uLic7CiAgICAgICAgICAgcmV0dXJuOwogICAgICAgICB9CiAgICAgICAgIGxhc3QgPSBleHRyYUZpZWxkc05hbWVzW2ldOwogICAgICB9CiAgICAgIC8vIGNoZWNrIGV4dHJhIGZpZWxkcyBkdXBsaWNhdGUgbmFtZXMgLSBlbmQKCiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLnVwZGF0ZV9leGlzdGluZ19ldmVudHM9ZmFsc2U7CgogICAgICBsb2dEZWJ1ZygidXBkYXRlRXZlbnRUeXBlOiB1cGRhdGUgRXZlbnQgVHlwZSAiICsgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXZlbnRfdHlwZV9pZCk7CmlmICgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5tYXhfcmVnaXN0cmF0aW9ucz09JycpCnsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMubWF4X3JlZ2lzdHJhdGlvbnM9MDsKfQp1cGRhdGVFdmVudFR5cGUoJGh0dHAsJHNjb3BlLCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV2ZW50X3R5cGVfaWQsJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMsdXBkYXRlRXZlbnRUeXBlX3N1Y2Nlc3MpOwpmdW5jdGlvbiB1cGRhdGVFdmVudFR5cGVfc3VjY2VzcygpCnsKJGxvY2F0aW9uLnBhdGgoJy9ldmVudF90eXBlcycpOwp9Cn0KfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdldmVudENyZWF0ZU1vZGFsQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRyb290U2NvcGUsIHNoYXJlZFByb3BlcnRpZXMsIGV2ZW50X3R5cGVfaWQsIGxvY2F0aW9uX2lkLCBlbXBfaWQsICRodHRwLCBzdGFydERhdGUsIHJlc2NoZWR1bGVfZXZlbnQsIHVpQ2FsZW5kYXJDb25maWcpIHsKc3RhcnREYXRlPW5ldyBtb21lbnQoc3RhcnREYXRlKTsKbG9nRGVidWcoImV2ZW50Q3JlYXRlTW9kYWxDb250cm9sbGVyLCBzdGFydERhdGU9IitzdGFydERhdGUrIiB0eXBlICIrdHlwZW9mIHN0YXJ0RGF0ZSk7CmxvZ0RlYnVnKCJldmVudENyZWF0ZU1vZGFsQ29udHJvbGxlciwgcmVzY2hlZHVsZV9ldmVudD0iK3Jlc2NoZWR1bGVfZXZlbnQpOwoKJHNjb3BlLmV2ZW50VHlwZVRpdGxlID0gIteR15fXqCDXodeV15Ig157XpNeS16kiOwokc2NvcGUuc2hvd0V2ZW50VHlwZVNlbGVjdGVkID0gZmFsc2U7CiRzY29wZS5zaG93RXZlbnRDbGllbnRTZWxlY3RlZCA9IGZhbHNlOwokc2NvcGUubmV3RXZlbnREZXRhaWxzID0ge307IC8vIHRoZXNlIGFyZSB0aGUgY29tcGxldGUgZGV0YWlscyBmb3IgdGhlIG5ldyBldmVudCAvLwokc2NvcGUubmV3RXZlbnREZXRhaWxzLnJlcGVhdFR5cGUgPSAiZm9yZXZlciI7CiRzY29wZS5uZXdFdmVudERldGFpbHMucmVwZWF0Rml4ZWRUaW1lcyA9ICI0IjsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5tYXhfcGFydGljaXBhbnRzID0gMTsKCmxvZ0RlYnVnKCJYWFggPSAiK0pTT04uc3RyaW5naWZ5KHJlc2NoZWR1bGVfZXZlbnQpKTsKCiRzY29wZS5yZXNjaGVkdWxlX2V2ZW50PWZhbHNlOwokc2NvcGUucmVzY2hlZHVsZV9ldmVudF9kZXRhaWxzPXJlc2NoZWR1bGVfZXZlbnQ7CmlmICgkc2NvcGUucmVzY2hlZHVsZV9ldmVudF9kZXRhaWxzIT1udWxsKQp7CmxvZ0RlYnVnKCJyZXNjaGVkdWxlX2V2ZW50X2RldGFpbHM9Iiskc2NvcGUucmVzY2hlZHVsZV9ldmVudF9kZXRhaWxzLmV2ZW50X2lkKTsKbG9nRGVidWcoSlNPTi5zdHJpbmdpZnkoJHNjb3BlLnJlc2NoZWR1bGVfZXZlbnRfZGV0YWlscykpOwokc2NvcGUucmVzY2hlZHVsZV9ldmVudD10cnVlOwokc2NvcGUuZ2l2ZW5fZXZlbnRfdHlwZV9pZCA9ICRzY29wZS5yZXNjaGVkdWxlX2V2ZW50X2RldGFpbHMuZXZlbnRfdHlwZV9pZDsKLy8gc3RpbGwgcHJlZmVyaW5nIGVtcF9pZCBmcm9tIHNjaGVkdWxlciBzdWdnZXN0aW9uIGlzIGl0IHdhcyBzZWxlY3RlZAppZiAoZW1wX2lkIT0wKQp7CiRzY29wZS5naXZlbl9lbXBfaWQgPSBlbXBfaWQ7Cn0KZWxzZQp7CiRzY29wZS5naXZlbl9lbXBfaWQgPSAkc2NvcGUucmVzY2hlZHVsZV9ldmVudF9kZXRhaWxzLmluc3RydWN0b3JfaWQ7Cn0KLy8gc3RpbGwgcHJlZmVyaW5nIGxvY2F0aW9uX2lkIGZyb20gc2NoZWR1bGVyIHN1Z2dlc3Rpb24gb3ZlciB0aGUgb3JpZ2luYWwgbG9jYXRpb24gZnJvbSBldmVudAppZiAobG9jYXRpb25faWQhPTApCnsKJHNjb3BlLmdpdmVuX2xvY2F0aW9uX2lkID0gbG9jYXRpb25faWQ7Cn0KZWxzZQp7CiRzY29wZS5naXZlbl9sb2NhdGlvbl9pZCA9ICRzY29wZS5yZXNjaGVkdWxlX2V2ZW50X2RldGFpbHMubG9jYXRpb25faWQ7Cn0KfQplbHNlCnsKJHNjb3BlLmdpdmVuX2V2ZW50X3R5cGVfaWQgPSBldmVudF90eXBlX2lkOwokc2NvcGUuZ2l2ZW5fbG9jYXRpb25faWQgPSBsb2NhdGlvbl9pZDsKJHNjb3BlLmdpdmVuX2VtcF9pZCA9IGVtcF9pZDsKfQppZiAoJHNjb3BlLmdpdmVuX2V2ZW50X3R5cGVfaWQ+MCkKewokc2NvcGUucHJldmlvdXNseV9zZWxlY3RlZF9ldmVudF90eXBlPXRydWU7Cn0KZWxzZQp7CiRzY29wZS5wcmV2aW91c2x5X3NlbGVjdGVkX2V2ZW50X3R5cGU9ZmFsc2U7Cn0KbG9nRGVidWcoIiRzY29wZS5naXZlbl9ldmVudF90eXBlX2lkPSIrJHNjb3BlLmdpdmVuX2V2ZW50X3R5cGVfaWQpOwoKc2VsZWN0ZWREYXRlU3RhcnQgPSBuZXcgRGF0ZShzdGFydERhdGUpOwpsb2dEZWJ1Zygic2VsZWN0ZWREYXRlU3RhcnQgPSAiK3NlbGVjdGVkRGF0ZVN0YXJ0KTsKdmFyIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZSgpICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKCi8vIGxvZ0RlYnVnKCJkYXRlPSIgKyBzZWxlY3RlZERhdGVTdGFydCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50ID0gW107CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRIb3VycygpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBzZWxlY3RlZERhdGVTdGFydC5nZXRNaW51dGVzKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZG93ID0gZGF5TmFtZXNbc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RGF5KCldOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRhdGUgPSBzZWxlY3RlZERhdGVTdGFydDsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aCA9IG1vbnRoTmFtZXNbc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TW9udGgoKV07CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bW9udGgxMTIgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRNb250aCgpKzE7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aCA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldERhdGUoKTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RnVsbFllYXIoKTsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5zdGFydF90aW1lX2lucHV0X2Zvcm1hdD0gbmV3IERhdGUoMTk3MCwgMCwgMSwgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycywgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzLCAwKTsKCiRzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZCA9ICRzY29wZS5naXZlbl9lbXBfaWQ7CiRzY29wZS5uZXdFdmVudERldGFpbHMubG9jYXRpb25faWQgPSAkc2NvcGUuZ2l2ZW5fbG9jYXRpb25faWQ7CgpnZXRCdXNpbmVzc0xvY2F0aW9ucygkaHR0cCwkc2NvcGUsJ2J1c2luZXNzX2xvY2F0aW9ucycsZ2V0QnVzaW5lc3NMb2NhdGlvbnNfZmluaXNoKTsKZnVuY3Rpb24gZ2V0QnVzaW5lc3NMb2NhdGlvbnNfZmluaXNoKCkKewppZiAoJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5sb2NhdGlvbl9pZD09MCkKewokc2NvcGUubmV3RXZlbnREZXRhaWxzLmxvY2F0aW9uX2lkPSRzY29wZS5idXNpbmVzc19sb2NhdGlvbnNbMF0ubG9jYXRpb25faWQ7Cn0KfQoKY29uc29sZS5sb2coIiRzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZD0iKyRzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZCk7Ci8vIGlmIGNsaWVudCB3YXMgcHJldmlvdXNseSBzZWxlY3RlZAokc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcj1mYWxzZTsKbG9nRGVidWcoInNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXI9IitzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKTsKaWYgKHNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKSE9bnVsbCkKewovLyBjb25zb2xlLmxvZygiZ290IHByZXZpb3VzIHNlbGVjdGVkIHVzZXIgIitzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfZmlyc3RfbmFtZSk7CiRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VybmFtZT1zaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfZmlyc3RfbmFtZSsiICIrc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2VyX2xhc3RfbmFtZTsKJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXI9dHJ1ZTsKCiRzY29wZS5zaG93RXZlbnRDbGllbnRTZWxlY3RlZCA9IHRydWU7CiRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kdXNlcl9pZCA9IHNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKS5idXNpbmVzc191c2VyX2lkOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZHVzZXJfZmlyc3RfbmFtZSA9IHNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKS5idXNlcl9maXJzdF9uYW1lOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZHVzZXJfbGFzdF9uYW1lID0gc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2VyX2xhc3RfbmFtZTsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5idXNpbmVzc191c2VyX2lkID0gc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2luZXNzX3VzZXJfaWQ7Cgp9CiRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZSA9IHN0YXJ0RGF0ZTsKbG9nRGVidWcoIiRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZTE9Iiskc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWUpOwokc2NvcGUuc3RhcnRNaW51dGVzID0gZnVuY3Rpb24oKQp7CmxvZ0RlYnVnKCJzdGFydE1pbnV0ZXMgIisoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKSk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcz1taW51dGVzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpOwpjYWxjdWxhdGVTdGFydFRpbWUoKTsKY2FsY3VsYXRlRW5kVGltZUR5bmFtaWMoKTsKfQokc2NvcGUuc3RhcnRIb3VycyA9IGZ1bmN0aW9uKCkKewpsb2dEZWJ1Zygic3RhcnRIb3VycyAiK2hvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKSk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnM9aG91cnNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMpOwpjYWxjdWxhdGVTdGFydFRpbWUoKTsKY2FsY3VsYXRlRW5kVGltZUR5bmFtaWMoKTsKfQoKJHNjb3BlLmVuZE1pbnV0ZXMgPSBmdW5jdGlvbigpCnsKbG9nRGVidWcoImVuZE1pbnV0ZXMgIisoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcykpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzPW1pbnV0ZXNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpOwpjYWxjdWxhdGVTdGFydFRpbWUoKTsKY2FsY3VsYXRlRW5kVGltZUR5bmFtaWMoKTsKfQokc2NvcGUuZW5kSG91cnMgPSBmdW5jdGlvbigpCnsKbG9nRGVidWcoImVuZEhvdXJzICIraG91cnNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzKSk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzPWhvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vycyk7CmNhbGN1bGF0ZVN0YXJ0VGltZSgpOwpjYWxjdWxhdGVFbmRUaW1lRHluYW1pYygpOwp9CgpmdW5jdGlvbiBjYWxjdWxhdGVTdGFydFRpbWUoKQp7CmV2ZW50WWVhcj0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXI7CmV2ZW50TW9udGg9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aDExMjsKZXZlbnREYXk9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXlvZm1vbnRoOwppZiAocGFyc2VJbnQoZXZlbnRNb250aCk8MTApCnsKZXZlbnRNb250aD0iMCIrZXZlbnRNb250aDsKfQppZiAocGFyc2VJbnQoZXZlbnREYXkpPDEwKQp7CmV2ZW50RGF5PSIwIitldmVudERheTsKfQpsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyPSIrZXZlbnRZZWFyKTsKbG9nRGVidWcoIiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aD0iK2V2ZW50TW9udGgpOwpsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aD0iK2V2ZW50RGF5KTsKbmV3X3N0YXJ0PW1vbWVudC51dGMoZXZlbnRZZWFyKyItIitldmVudE1vbnRoKyItIitldmVudERheSsiVDAwOjAwOjAwIikuYWRkKCgocGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykqNjApK3BhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcykpLCAnbWludXRlcycpOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWU9bmV3X3N0YXJ0Owpsb2dEZWJ1ZygibmV3X3N0YXJ0PSIrbmV3X3N0YXJ0KTsKfQpmdW5jdGlvbiBtaW51dGVzQ2hhbmdlZCh0aGVtaW51dGVzKQp7CmxvZ0RlYnVnKCJ0aGVtaW51dGVzPSIrdGhlbWludXRlcyk7CmlmICh0eXBlb2YgdGhlbWludXRlcz09InVuZGVmaW5lZCIpCnsKcmV0dXJuICIwMCI7Cn0KaWYgKGlzTmFOKHRoZW1pbnV0ZXMpKQp7CnJldHVybiAiMDAiOwp9CmlmICh0aGVtaW51dGVzPT0nJykKewpyZXR1cm4gIjAwIjsKfQp0aGVtaW51dGVzPXBhcnNlSW50KHRoZW1pbnV0ZXMpOwppZiAodGhlbWludXRlcz42MCkKewpyZXR1cm4gIjAwIjsKfQplbHNlIGlmICh0aGVtaW51dGVzPDApCnsKcmV0dXJuICIwMCI7Cn0KZWxzZSBpZiAodGhlbWludXRlcz09IiIpCnsKcmV0dXJuICIwMCI7Cn0KZWxzZSBpZiAodGhlbWludXRlczwxMCkKewpyZXR1cm4gIjAiK3RoZW1pbnV0ZXM7Cn0KZWxzZQp7CnJldHVybiB0aGVtaW51dGVzOwp9Cn0KZnVuY3Rpb24gaG91cnNDaGFuZ2VkKHRoZWhvdXJzKQp7CmxvZ0RlYnVnKCJ0aGVob3Vycz0iK3RoZWhvdXJzKTsKaWYgKHR5cGVvZiB0aGVob3Vycz09InVuZGVmaW5lZCIpCnsKcmV0dXJuICIwIjsKfQppZiAoaXNOYU4odGhlaG91cnMpKQp7CnJldHVybiAiMCI7Cn0KaWYgKHRoZWhvdXJzPT0nJykKewpyZXR1cm4gIjAiOwp9CnRoZWhvdXJzPXBhcnNlSW50KHRoZWhvdXJzKTsKaWYgKHRoZWhvdXJzPjI0KQp7CnJldHVybiAwOwp9CmVsc2UgaWYgKHRoZWhvdXJzPDApCnsKcmV0dXJuIDA7Cn0KZWxzZSBpZiAodGhlaG91cnM9PSIiKQp7CnJldHVybiAiMCI7Cn0KZWxzZQp7CnJldHVybiB0aGVob3VyczsKfQp9CmdldEFsbEluc3RydWN0b3JzKCRodHRwLCRzY29wZSwnaW5zdHJ1Y3RvcnMnLGdldEFsbEluc3RydWN0b3JzX3N1Y2Nlc3MpOwpmdW5jdGlvbiBnZXRBbGxJbnN0cnVjdG9yc19zdWNjZXNzKCkKewovLyAkc2NvcGUuaW5zdHJ1Y3RvcnMudW5zaGlmdCh7YnVzaW5lc3NfdXNlcl9pZDpudWxsLCBidXNlcl9maXJzdF9uYW1lOiIiLCBidXNlcl9sYXN0X25hbWU6IiJ9KTsKaWYgKCEkc2NvcGUubmV3RXZlbnREZXRhaWxzLmluc3RydWN0b3JfaWQ+MCkKewokc2NvcGUubmV3RXZlbnREZXRhaWxzLmluc3RydWN0b3JfaWQ9JHNjb3BlLmluc3RydWN0b3JzWzBdLmJ1c2luZXNzX3VzZXJfaWQ7Cn0KfQoKJHNjb3BlLnNlbGVjdEV2ZW50VHlwZSA9IGZ1bmN0aW9uKCkgewovLyByZW1vdmluZyBldmVudCB0eXBlINeR15fXqCDXodeV15Ig157XpNeS16kKaWYgKCRzY29wZS5ldmVudFR5cGVPcHRpb25zWzBdLmV2ZW50X3R5cGVfaWQ9PTApCnsKJHNjb3BlLmV2ZW50VHlwZU9wdGlvbnMuc3BsaWNlKDAsIDEpOwp9CiRzY29wZS5hamF4X2Vycm9yPScnOwpjaG9pY2U9JHNjb3BlLnNlbGVjdEV2ZW50VHlwZVNlbGVjdGVkOwpsb2dEZWJ1Zygic2VsZWN0RXZlbnRUeXBlIik7CmxvZ0RlYnVnKEpTT04uc3RyaW5naWZ5KCRzY29wZS5zZWxlY3RFdmVudFR5cGVTZWxlY3RlZCkpOwokc2NvcGUuZXZlbnRUeXBlVGl0bGUgPSBjaG9pY2UuZXZlbnRfdHlwZV9uYW1lOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLmV2ZW50X3R5cGVfaWQgPSBjaG9pY2UuZXZlbnRfdHlwZV9pZDsKCiRzY29wZS5uZXdFdmVudERldGFpbHMuZXZlbnRfbmFtZSA9IGNob2ljZS5ldmVudF90eXBlX25hbWU7CiRzY29wZS5uZXdFdmVudERldGFpbHMub3JpZ2luYWxfZXZlbnRfbmFtZSA9IGNob2ljZS5ldmVudF90eXBlX25hbWU7CiRzY29wZS5uZXdFdmVudERldGFpbHMuZXZlbnRfZGVzY3JpcHRpb24gPSBjaG9pY2UuZXZlbnRfdHlwZV9kZXNjcmlwdGlvbjsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pc19jbGFzcyA9IGNob2ljZS5pc19jbGFzczsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5vcmlnaW5hbF9wcmljZSA9IGNob2ljZS5vcmlnaW5hbF9wcmljZTsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pc19nZW5lcmljX2V0eXBlID0gY2hvaWNlLmlzX2dlbmVyaWNfZXR5cGU7Ci8vICRzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZCA9IGNob2ljZS5pbnN0cnVjdG9yX2lkOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50ID0gY2hvaWNlLmR1cmF0aW9uX2V2ZW50OwovLyBsb2dEZWJ1Zygic2NvcGUubmV3RXZlbnREZXRhaWxzLmlzX2NsYXNzPSIrJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pc19jbGFzcyk7Ci8vIGxvZ0RlYnVnKCJzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZD0iKyRzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZCk7Ci8vIGxvZ0RlYnVnKCJzdGFydERhdGU9IitzdGFydERhdGUpOwovLyAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWUgPSBzdGFydERhdGU7CiRzY29wZS5uZXdFdmVudERldGFpbHMuZXZlbnR0eXBlID0gY2hvaWNlOwpjYWxjdWxhdGVFbmRUaW1lKCk7CgovLyAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWVfaW5wdXRfZm9ybWF0PSBuZXcgRGF0ZSgxOTcwLCAwLCAxLCAxNCwgNTcsIDApOwoKbG9nRGVidWcoIm5ld0V2ZW50IHN0YXJ0PSIgKyAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWUpOwpsb2dEZWJ1ZygibmV3RXZlbnQgZW5kPSIgKyAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZF90aW1lKTsKCiRzY29wZS5zaG93RXZlbnRUeXBlU2VsZWN0ZWQgPSB0cnVlOwp9CgovLyB0aGlzIGZ1bmN0aW9uIGNhbGN1bGF0ZXMgZW5kIHRpbWUgYWNjb3JkaW5nIHRvIHRoZSBsZW5ndGggb2YgdGhlIGV2ZW50dHlwZQpmdW5jdGlvbiBjYWxjdWxhdGVFbmRUaW1lKCkKewpjb25zb2xlLmxvZygiJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5zdGFydF90aW1lPSIrJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5zdGFydF90aW1lKTsKZW5kID0gbW9tZW50KCRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZSkuYWRkKCRzY29wZS5uZXdFdmVudERldGFpbHMuZHVyYXRpb25fZXZlbnQsICdtaW51dGVzJyk7CnNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKGVuZCk7CnNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKHNlbGVjdGVkRGF0ZUVuZC5nZXRUaW1lKCkgKyBzZWxlY3RlZERhdGVFbmQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMgPSBzZWxlY3RlZERhdGVFbmQuZ2V0SG91cnMoKTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kZG93ID0gZGF5TmFtZXNbc2VsZWN0ZWREYXRlRW5kLmdldERheSgpXTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcyA9IChzZWxlY3RlZERhdGVFbmQuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBzZWxlY3RlZERhdGVFbmQuZ2V0TWludXRlcygpOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZF90aW1lID0gZW5kOwovLyBjYWxjdWxhdGluZyBkdXJhdGlvbgokc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50PXBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpLXBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcyk7CiRzY29wZS5uZXdFdmVudERldGFpbHMuZHVyYXRpb25fZXZlbnQ9JHNjb3BlLm5ld0V2ZW50RGV0YWlscy5kdXJhdGlvbl9ldmVudCsocGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMpLXBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMpKSo2MDsKaWYgKCRzY29wZS5uZXdFdmVudERldGFpbHMuZHVyYXRpb25fZXZlbnQ8MCkKewokc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50PTA7Cn0KfQoKLy8gdGhpcyBmdW5jdGlvbiBjYWxjdWxhdGVzIGVuZCB0aW1lIGFjY29yZGluZyB0byB0aGUgaW5wdXQgZnJvbSBtb2RhbCB3aW5kb3cKLy8gYW5kIG5vdCBhY2NvcmRpbmcgdG8gZXZlbnQgdHlwZSBsZW5ndGgKZnVuY3Rpb24gY2FsY3VsYXRlRW5kVGltZUR5bmFtaWMoKQp7CmV2ZW50WWVhcj0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXI7CmV2ZW50TW9udGg9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aDExMjsKZXZlbnREYXk9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXlvZm1vbnRoOwppZiAocGFyc2VJbnQoZXZlbnRNb250aCk8MTApCnsKZXZlbnRNb250aD0iMCIrZXZlbnRNb250aDsKfQppZiAocGFyc2VJbnQoZXZlbnREYXkpPDEwKQp7CmV2ZW50RGF5PSIwIitldmVudERheTsKfQpsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyPSIrZXZlbnRZZWFyKTsKbG9nRGVidWcoIiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aD0iK2V2ZW50TW9udGgpOwpsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aD0iK2V2ZW50RGF5KTsKbmV3X2VuZD1tb21lbnQudXRjKGV2ZW50WWVhcisiLSIrZXZlbnRNb250aCsiLSIrZXZlbnREYXkrIlQwMDowMDowMCIpLmFkZCgoKHBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzKSo2MCkrcGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcykpLCAnbWludXRlcycpOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZF90aW1lPW5ld19lbmQ7CmxvZ0RlYnVnKCJuZXdfZW5kPSIrbmV3X2VuZCk7Ci8vIGNhbGN1bGF0aW5nIGR1cmF0aW9uCiRzY29wZS5uZXdFdmVudERldGFpbHMuZHVyYXRpb25fZXZlbnQ9cGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcyktcGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKTsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5kdXJhdGlvbl9ldmVudD0kc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50KyhwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycyktcGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykpKjYwOwppZiAoJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5kdXJhdGlvbl9ldmVudDwwKQp7CiRzY29wZS5uZXdFdmVudERldGFpbHMuZHVyYXRpb25fZXZlbnQ9MDsKfQp9CmdldEFsbEJ1c2luZXNzRXZlbnRUeXBlcygkaHR0cCwkc2NvcGUsJ2V2ZW50VHlwZU9wdGlvbnMnLGdldEFsbEJ1c2luZXNzRXZlbnRUeXBlc19zdWNjZXNzKTsKZnVuY3Rpb24gZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzX3N1Y2Nlc3MoKQp7Ci8vIGFmdGVyIGxvYWRpbmcgZXZlbnQgdHlwZXMsIGlmIHRoZSBnaXZlbiBldmVudCB0eXBlIGlzICE9IDAgd2UgInNlbGVjdCIgaXQKY29uc29sZS5sb2coImdldEFsbEJ1c2luZXNzRXZlbnRUeXBlc19zdWNjZXNzIik7CmlmICgkc2NvcGUuZ2l2ZW5fZXZlbnRfdHlwZV9pZD4wKQp7CmZvcih2YXIgaSA9IDA7IGkgPCAkc2NvcGUuZXZlbnRUeXBlT3B0aW9ucy5sZW5ndGg7IGkrKykKewppZiAoJHNjb3BlLmV2ZW50VHlwZU9wdGlvbnNbaV0uZXZlbnRfdHlwZV9pZD09JHNjb3BlLmdpdmVuX2V2ZW50X3R5cGVfaWQpCnsKY29uc29sZS5sb2coImdpdmVuX2V2ZW50X3R5cGVfaWQgZm91bmQiKTsKLy8gJHNjb3BlLmNhbGN1bGF0ZVN0YXJ0VGltZSgpOwokc2NvcGUuc2VsZWN0RXZlbnRUeXBlU2VsZWN0ZWQ9JHNjb3BlLmV2ZW50VHlwZU9wdGlvbnNbaV07Ci8vICRzY29wZS5zZWxlY3RFdmVudFR5cGUoJHNjb3BlLmV2ZW50VHlwZU9wdGlvbnNbaV0pOwokc2NvcGUuc2VsZWN0RXZlbnRUeXBlKCk7Cn0KfQp9CmVsc2Ugewokc2NvcGUuZXZlbnRUeXBlT3B0aW9ucy51bnNoaWZ0KHsiZXZlbnRfdHlwZV9pZCI6MCwgImV2ZW50X3R5cGVfbmFtZSI6IteR15fXqCDXodeV15Ig157XpNeS16kiLCBpc192YWNhdGlvbjogMH0pOwokc2NvcGUuc2VsZWN0RXZlbnRUeXBlU2VsZWN0ZWQ9JHNjb3BlLmV2ZW50VHlwZU9wdGlvbnNbMF07Cn0KfQpnZXRBbGxDbGllbnRzKCRodHRwLCRzY29wZSwnZXZlbnRUeXBlVXNlcnMnKTsKCiRzY29wZS5ldmVudENsaWVudFNlbGVjdGVkID0gZnVuY3Rpb24oc2VsZWN0ZWQpIHsKaWYgKHNlbGVjdGVkKSB7Ci8vIGFsZXJ0KEpTT04uc3RyaW5naWZ5KCBzZWxlY3RlZCwgbnVsbCwgMiApKTsKbG9nRGVidWcoJ2NsaWVudCBzZWxlY3RlZCAnICsgc2VsZWN0ZWQub3JpZ2luYWxPYmplY3QuYnVzZXJfZmlyc3RfbmFtZSk7CiRzY29wZS5zaG93RXZlbnRDbGllbnRTZWxlY3RlZCA9IHRydWU7CiRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kdXNlcl9pZCA9IHNlbGVjdGVkLm9yaWdpbmFsT2JqZWN0LmJ1c2luZXNzX3VzZXJfaWQ7CiRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kdXNlcl9maXJzdF9uYW1lID0gc2VsZWN0ZWQub3JpZ2luYWxPYmplY3QuYnVzZXJfZmlyc3RfbmFtZTsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmR1c2VyX2xhc3RfbmFtZSA9IHNlbGVjdGVkLm9yaWdpbmFsT2JqZWN0LmJ1c2VyX2xhc3RfbmFtZTsKfSBlbHNlIHsKbG9nRGVidWcoJ25vdCBzZWxlY3RlZCcpOwovLyAkc2NvcGUuZXZlbnRDbGllbnREZVNlbGVjdGVkKCk7Cn0KfTsKJHNjb3BlLmV2ZW50Q2xpZW50RGVTZWxlY3RlZCA9IGZ1bmN0aW9uKCkgewokc2NvcGUuc2hvd0V2ZW50Q2xpZW50U2VsZWN0ZWQgPSBmYWxzZTsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmR1c2VyX2lkID0gbnVsbDsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmR1c2VyX2ZpcnN0X25hbWUgPSBudWxsOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZHVzZXJfbGFzdF9uYW1lID0gbnVsbDsKJHNjb3BlLmNsZWFyQ2xpZW50SW5wdXQoJ2NsaWVudF9hbmd1Y29tcGxldGUnKTsKfQoKJHNjb3BlLmNsZWFyQ2xpZW50SW5wdXQgPSBmdW5jdGlvbihpZCkgewppZiAoaWQpIHsKJHNjb3BlLiRicm9hZGNhc3QoJ2FuZ3Vjb21wbGV0ZS1hbHQ6Y2xlYXJJbnB1dCcsIGlkKTsKfQovLyBlbHNlewovLyAgICRzY29wZS4kYnJvYWRjYXN0KCdhbmd1Y29tcGxldGUtYWx0OmNsZWFySW5wdXQnKTsKLy8gfQp9Cgokc2NvcGUuY2FuY2VsID0gZnVuY3Rpb24oKSB7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKfTsKCiRzY29wZS51cGRhdGVFdmVudE5hbWVDaGVjayA9IGZ1bmN0aW9uKG5ld1ZhbHVlKQp7CmxvZ0RlYnVnKCJ1cGRhdGVFdmVudE5hbWU9IituZXdWYWx1ZSk7CmlmIChuZXdWYWx1ZT09IiIpCnsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5ldmVudF9uYW1lID0gJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5vcmlnaW5hbF9ldmVudF9uYW1lOwp9Cn0KLy8gcmVzY2hlZHVsZUV2ZW50CiRzY29wZS5yZXNjaGVkdWxlRXZlbnQgPSBmdW5jdGlvbigpIHsKbG9nRGVidWcoImZ1bmN0aW9uOiByZXNjaGVkdWxlRXZlbnQiKTsKCi8vIG5ld0V2ZW50SlNPTkRldGFpbHMgPSBKU09OLnN0cmluZ2lmeSgkc2NvcGUubmV3RXZlbnREZXRhaWxzLCBudWxsLCA0KTsgLy8gKE9wdGlvbmFsKSBiZWF1dGlmdWwgaW5kZW50ZWQgb3V0cHV0Lgpsb2dEZWJ1ZygicmVzY2hlZHVsZUV2ZW50LCAiICsgSlNPTi5zdHJpbmdpZnkoJHNjb3BlLm5ld0V2ZW50RGV0YWlscywgbnVsbCwgNCkpOwovLyBpZiAoJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5ldmVudFJlY3VycmluZykgewovLyAgIGNyZWF0ZVJlY3VycmluZ0V2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUubmV3RXZlbnREZXRhaWxzLGNyZWF0ZVJlY3VycmluZ0V2ZW50X3N1Y2Nlc3MpOwovLyAgIGZ1bmN0aW9uIGNyZWF0ZVJlY3VycmluZ0V2ZW50X3N1Y2Nlc3MoKQovLyAgIHsKLy8gICAgIGNhbGVuZGFyID0gImNhbGVuZGFyX2J1c2luZXNzIjsKLy8gICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKLy8gICAgICR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoKTsKLy8gICAgIC8vIGVycm9yIHdhcwovLyAgICAgLy8gbG9nRGVidWcoImVycm9yICIgKyBkYXRhLk1lc3NhZ2UpOwovLyAgICAgLy8gJHNjb3BlLmFqYXhfZXJyb3IgPSBkYXRhLk1lc3NhZ2U7Ci8vICAgfQovLyB9Ci8vIGVsc2UKewovLyBpZiBldmVudCBpcyBub3QgY2xhc3MsIGEgY2xpZW50IG11c3QgYmUgc2VsZWN0ZWQKLy8gaWYgKCghJHNjb3BlLnNob3dFdmVudENsaWVudFNlbGVjdGVkKSAmJiAoISRzY29wZS5uZXdFdmVudERldGFpbHMuaXNfY2xhc3MpKQovLyB7Ci8vICAgLy8gYWxlcnQoJ2NsaWVudCBtdXN0IGJlIHNlbGVjdGVkJyk7Ci8vICAgJHNjb3BlLmFqYXhfZXJyb3I9IteQ16DXkCDXlNeV16HXoyDXntep16rXqtejINec157XpNeS16kiOwovLyAgIHJldHVybjsKLy8gfQpyZXNjaGVkdWxlRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5yZXNjaGVkdWxlX2V2ZW50X2RldGFpbHMuZXZlbnRfaWQsJHNjb3BlLm5ld0V2ZW50RGV0YWlscyxyZXNjaGVkdWxlRXZlbnRfc3VjY2Vzcyk7CmZ1bmN0aW9uIHJlc2NoZWR1bGVFdmVudF9zdWNjZXNzKCkKewpjYWxlbmRhciA9ICJjYWxlbmRhcl9idXNpbmVzcyI7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjYWxlbmRhckV2ZW50UmVzY2hlZHVsZURlc2VsZWN0Jyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCiR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoJ2FkZGVkJyk7Cn0KLy8gb24gZmFpbHVyZSB3YXMKLy8gJHNjb3BlLmFqYXhfZXJyb3IgPSBkYXRhLk1lc3NhZ2U7Cn0KfTsKCiRzY29wZS5jcmVhdGVOZXdFdmVudCA9IGZ1bmN0aW9uKCkgewpsb2dEZWJ1ZygiY3JlYXRlTmV3RXZlbnQgc3RhcnRfdGltZT0iKyB0eXBlb2YgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5zdGFydF90aW1lKTsKCm5ld0V2ZW50SlNPTkRldGFpbHMgPSBKU09OLnN0cmluZ2lmeSgkc2NvcGUubmV3RXZlbnREZXRhaWxzLCBudWxsLCA0KTsgLy8gKE9wdGlvbmFsKSBiZWF1dGlmdWwgaW5kZW50ZWQgb3V0cHV0Lgpsb2dEZWJ1ZygiY3JlYXRlTmV3RXZlbnQsICIgKyBuZXdFdmVudEpTT05EZXRhaWxzKTsKaWYgKCRzY29wZS5uZXdFdmVudERldGFpbHMuZXZlbnRSZWN1cnJpbmcpIHsKY3JlYXRlUmVjdXJyaW5nRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5uZXdFdmVudERldGFpbHMsY3JlYXRlUmVjdXJyaW5nRXZlbnRfc3VjY2Vzcyk7CmZ1bmN0aW9uIGNyZWF0ZVJlY3VycmluZ0V2ZW50X3N1Y2Nlc3MoKQp7CmNhbGVuZGFyID0gImNhbGVuZGFyX2J1c2luZXNzIjsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwokdWliTW9kYWxJbnN0YW5jZS5kaXNtaXNzKCk7Ci8vIGVycm9yIHdhcwovLyBsb2dEZWJ1ZygiZXJyb3IgIiArIGRhdGEuTWVzc2FnZSk7Ci8vICRzY29wZS5hamF4X2Vycm9yID0gZGF0YS5NZXNzYWdlOwp9Cn0KZWxzZQp7Ci8vIGNoZWNraW5nIGV2ZW50IHRpbWUgbG9naWMKaWYgKCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnM+JHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMpCnsKJHNjb3BlLmFqYXhfZXJyb3I9IteW157XnyDXlNeU16rXl9ec15Qg16nXnCDXlNee16TXktepINeQ15fXqNeZINeW157XnyDXlNeh15nXldedINep15zXlSI7CnJldHVybjsKfQovLyBjaGVja2luZyBldmVudCB0aW1lIGxvZ2ljCmlmIChwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKT09cGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMpKQp7CmlmIChwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpPj1wYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzKSkKewokc2NvcGUuYWpheF9lcnJvcj0i15bXntefINeU15TXqteX15zXlCDXqdecINeU157XpNeS16kg15DXl9eo15kg15bXntefINeU16HXmdeV150g16nXnNeVIjsKcmV0dXJuOwp9CmxvZ0RlYnVnKCIkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXM9Iiskc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpOwpsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcz0iKyRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpOwppZiAoKHBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcykrNSk+PXBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpKQp7CiRzY29wZS5hamF4X2Vycm9yPSLXkNeV16jXmiDXlNee16TXktepINeX15nXmdeRINec15TXmdeV16og15zXpNeX15XXqiA1INeT16fXldeqIjsKcmV0dXJuOwp9Cn0KLy8gaWYgZXZlbnQgaXMgbm90IGNsYXNzLCBhIGNsaWVudCBtdXN0IGJlIHNlbGVjdGVkCmlmICgoISRzY29wZS5zaG93RXZlbnRDbGllbnRTZWxlY3RlZCkgJiYgKCEkc2NvcGUubmV3RXZlbnREZXRhaWxzLmlzX2NsYXNzKSAmJiAoJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pc19nZW5lcmljX2V0eXBlPT0wKSkKewovLyBhbGVydCgnY2xpZW50IG11c3QgYmUgc2VsZWN0ZWQnKTsKJHNjb3BlLmFqYXhfZXJyb3I9IteQ16DXkCDXlNeV16HXoyDXntep16rXqtejINec157XpNeS16kiOwpyZXR1cm47Cn0KaWYgKCRzY29wZS5zZWxlY3RFdmVudFR5cGVTZWxlY3RlZC5ldmVudF90eXBlX2lkPT0wKQp7Ci8vIGFsZXJ0KCdjbGllbnQgbXVzdCBiZSBzZWxlY3RlZCcpOwokc2NvcGUuYWpheF9lcnJvcj0i15DXoNeQINeR15fXqCDXodeV15Ig157XpNeS16kgIjsKcmV0dXJuOwp9CmNyZWF0ZUV2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUubmV3RXZlbnREZXRhaWxzLGNyZWF0ZUV2ZW50X3N1Y2Nlc3MpOwpmdW5jdGlvbiBjcmVhdGVFdmVudF9zdWNjZXNzKCkKewpjYWxlbmRhciA9ICJjYWxlbmRhcl9idXNpbmVzcyI7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKJHVpYk1vZGFsSW5zdGFuY2UuZGlzbWlzcygnYWRkZWQnKTsKfQovLyBvbiBmYWlsdXJlIHdhcwovLyAkc2NvcGUuYWpheF9lcnJvciA9IGRhdGEuTWVzc2FnZTsKfQp9Cn0pOwovLy8vIGZmZmZmZmYKa3V6ZUFwcC5jb250cm9sbGVyKCdCdXNpbmVzc0NhbGVuZGFyQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsIHNoYXJlZFByb3BlcnRpZXMsICRjb21waWxlLCAkbG9jYXRpb24sIHVpQ2FsZW5kYXJDb25maWcsICR1aWJNb2RhbCwgc2hhcmVkRGF0YSkgewppbml0aWFsRW5kVXNlciA9IHNoYXJlZERhdGEuZ2V0U2VsZWN0ZWRFbmRVc2VyKCk7CmxvZ0RlYnVnKCdCdXNpbmVzc0NhbGVuZGFyIENvbnRyb2xsZXIsIHNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKT0nICsgc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpKTsKCmdldEJ1c2luZXNzTG9jYXRpb25zKCRodHRwLCRzY29wZSwnYnVzaW5lc3NfbG9jYXRpb25zJyk7CgogICAgJHNjb3BlLnN0YXR1c2VzID0gWyB7InN0YXR1c19pZCI6IjAiLCJzdGF0dXNfbmFtZSI6Itek16rXldeXIn0sIHsic3RhdHVzX2lkIjoiMSIsInN0YXR1c19uYW1lIjoi16HXkteV16gifV07CiAgICAkc2NvcGUudGhlZGF0YV9yZXBvcnQgPSB7fTsKCiAgICAkc2NvcGUudGhlZGF0YV9yZXBvcnQuc291cmNlID0gImNhbGVuZGFyIjsKICAgICRzY29wZS50aGVkYXRhX3JlcG9ydC5maWx0ZXJzID0gewogICAgICBpc19jYW5jZWxlZDogIjAiCiAgICB9OwoKICAgICRzY29wZS51cGRhdGVFdmVudHMgPSBmdW5jdGlvbigpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJ1cGRhdGVFdmVudHMiKTsKICAgICAgaW5zdHJ1Y3Rvcl9pZF9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuY2FsZW5kYXJJbnN0cnVjdG9yRmlsdGVyLCAiYnVzaW5lc3NfdXNlcl9pZCIgKTsKICAgICAgZXZlbnRfdHlwZV9pZF9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuY2FsZW5kYXJFdmVudFR5cGVGaWx0ZXIsICJldmVudF90eXBlX2lkIiApOwogICAgICBzdGF0dXNfZmlsdGVyID0gbGlzdF90b19zdHJpbmdfYnlfdmFsdWUoJHNjb3BlLmNhbGVuZGFyU3RhdHVzRmlsdGVyLCAic3RhdHVzX2lkIiApOwoKICAgICAgJHNjb3BlLnRoZWRhdGFfcmVwb3J0LmZpbHRlcnMgPSB7CiAgICAgICAgaW5zdHJ1Y3Rvcl9pZDogaW5zdHJ1Y3Rvcl9pZF9maWx0ZXIsCiAgICAgICAgZXZlbnRfdHlwZV9pZDogZXZlbnRfdHlwZV9pZF9maWx0ZXIsCiAgICAgICAgc3RhdHVzOiBzdGF0dXNfZmlsdGVyLAogICAgICAgIGlzX2NhbmNlbGVkOiAiMCIKICAgICAgfTsKCiAgICAgIC8vIGNvbnNvbGUubG9nKCRzY29wZS5jYWxlbmRhcik7CiAgICAgIGxvZ0RlYnVnKCJiZWZvcmUgcmVmZXRjaEV2ZW50cyIpOwogICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwogICAgICBsb2dEZWJ1ZygiYWZ0ZXIgcmVmZXRjaEV2ZW50cyIpOwogICAgICAvLyB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwoKICAgIH0KCiRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyPWZhbHNlOwoKaWYgKHNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKSE9bnVsbCkKewpjb25zb2xlLmxvZygiZ290IHByZXZpb3VzIHNlbGVjdGVkIHVzZXIgIitzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfZmlyc3RfbmFtZSk7CiRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VybmFtZT1zaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfZmlyc3RfbmFtZSsiICIrc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2VyX2xhc3RfbmFtZTsKJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJfaWQ9c2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2luZXNzX3VzZXJfaWQ7CmxvZ0RlYnVnKCIkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcl9pZD0iKyRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyX2lkKTsKCiRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyPXRydWU7Cn0KCi8vIGNoZWNraW5nIGlmIGNhbGVuZGFyIHNob3VsZCBzdGFydCB3aXRoIGEgc3BlY2lmaWMgZGF0ZSAoZnJvbSB1cmwgb3IgZnJvbSBwcmV2aW91c2x5IHNlbGVjdGVkIGRhdGUpCmxvZ0RlYnVnKCIkbG9jYXRpb24uc2VhcmNoKCkuc3RhcnQ9IiArICRsb2NhdGlvbi5zZWFyY2goKS5zdGFydCk7CmlmICh0eXBlb2YgJGxvY2F0aW9uLnNlYXJjaCgpLnN0YXJ0ICE9ICd1bmRlZmluZWQnKQp7CmN1cnJEZWZhdWx0RGF0ZSA9ICRsb2NhdGlvbi5zZWFyY2goKS5zdGFydDsKfQplbHNlIGlmIChzaGFyZWRQcm9wZXJ0aWVzLmdldF9jYWxlbmRhcl9kYXRlKCkhPW51bGwpCnsKY29uc29sZS5sb2coImdvdCBwcmV2aW91cyBkYXRlICAiK3NoYXJlZFByb3BlcnRpZXMuZ2V0X2NhbGVuZGFyX2RhdGUoKSk7CmN1cnJEZWZhdWx0RGF0ZSA9IHNoYXJlZFByb3BlcnRpZXMuZ2V0X2NhbGVuZGFyX2RhdGUoKTsKfQplbHNlCnsKY3VyckRlZmF1bHREYXRlID0gbmV3IERhdGUoKTsKfQpnZXRBbGxJbnN0cnVjdG9ycygkaHR0cCwkc2NvcGUsJ2J1c2luZXNzX2luc3RydWN0b3JzJyxnZXRBbGxJbnN0cnVjdG9yc19maW5pc2gpOwogICAgZ2V0QWxsSW5zdHJ1Y3RvcnMoJGh0dHAsJHNjb3BlLCdpbnN0cnVjdG9ycycpOwpmdW5jdGlvbiBnZXRBbGxJbnN0cnVjdG9yc19maW5pc2goKQp7Ci8vIGNvbnNvbGUubG9nKCRzY29wZS5idXNpbmVzc19pbnN0cnVjdG9ycyk7CiRzY29wZS5idXNpbmVzc19pbnN0cnVjdG9ycy51bnNoaWZ0KHsiYnVzZXJfZnVsbF9uYW1lIjoi15vXnCDXlNem15XXldeqIiwgImJ1c2VyX2ZpcnN0X25hbWUiOiLXm9eV15zXnSIsImJ1c2VyX2xhc3RfbmFtZSI6IiIsICJ1c2VyX2lkIjogMCwgImJ1c2luZXNzX3VzZXJfaWQiOiAwfSk7CgovLyBzZXR0aW5nIHNlbGVjdGVkIGdldF9zZWxlY3RlZF9pbnN0cnVjdG9yCiRzY29wZS5wcmV2aW91c19zZWxlY3RlZF9pbnN0cnVjdG9yPWZhbHNlOwppZiAoc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfaW5zdHJ1Y3RvcigpPj0wKQp7Ci8vIGNvbnNvbGUubG9nKCJnb3QgcHJldmlvdXMgc2VsZWN0ZWQgaW5zdHJ1Y3RvciAiK3NoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX2luc3RydWN0b3IoKSk7CiRzY29wZS5wcmV2aW91c19zZWxlY3RlZF9pbnN0cnVjdG9yX2lkPXNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX2luc3RydWN0b3IoKTsKJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX2luc3RydWN0b3I9dHJ1ZTsKJHNjb3BlLnNlbGVjdGVkX2J1c2luZXNzX3VzZXJfaWQ9c2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfaW5zdHJ1Y3RvcigpOwp9Cn0KICAgIGdldEFsbEJ1c2luZXNzRXZlbnRUeXBlcygkaHR0cCwkc2NvcGUsJ2V2ZW50X3R5cGVzX2NhbHMnKTsKZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzTm9TeXN0ZW0oJGh0dHAsJHNjb3BlLCdldmVudF90eXBlcycpOwoKLy8gc2V0dGluZyBzZWxlY3RlZCB1c2VyIGlkCiRzY29wZS5wcmV2aW91c19ldmVudF9yZXNjaGVkdWxlPWZhbHNlOwokc2NvcGUucHJldmlvdXNfZXZlbnRfcmVzY2hlZHVsZV9ldmVudD1udWxsOwoKJHNjb3BlLiRvbigiY2FsZW5kYXJFdmVudFJlc2NoZWR1bGVEZXNlbGVjdCIsZnVuY3Rpb24oZSxhKQp7CiRzY29wZS5jYWxlbmRhckV2ZW50UmVzY2hlZHVsZURlc2VsZWN0KCk7Cn0pOwoKLy8gZGVzZWxlY3RpbmcgZXZlbnQgZnJvbSBiZWluZyByZXNjaGVkdWxlZAokc2NvcGUuY2FsZW5kYXJFdmVudFJlc2NoZWR1bGVEZXNlbGVjdD1mdW5jdGlvbigpCnsKc2hhcmVkUHJvcGVydGllcy5zZXRfZXZlbnRfcmVzY2hlZHVsZShudWxsKTsKJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGU9ZmFsc2U7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZWZldGNoRXZlbnRzJyk7Cn0KLy8gZGVsZXRpbmcgY2xpZW50IHNlbGVjdGlvbiBpbiBjYWxlbmRhcgokc2NvcGUuY2FsZW5kYXJDbGllbnREZXNlbGVjdD1mdW5jdGlvbigpIC8vIHJlbG9hZCBjbGFzcy9ldmVudCBzdWdnZXN0aW9ucwp7CiRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyPWZhbHNlOwpzaGFyZWRQcm9wZXJ0aWVzLnNldF9zZWxlY3RlZF91c2VyKG51bGwpOwokc2NvcGUuZXZlbnRUeXBlU2VsZWN0ZWQoKTsKfQppZiAoaW5pdGlhbEVuZFVzZXIgIT0gbnVsbCkgewokc2NvcGUuYnVzaW5lc3NDYWxlbmRhckluaXRpYWxOYW1lID0gdHJ1ZTsKc2hhcmVkRGF0YS5zZXRTZWxlY3RlZEVuZFVzZXIobnVsbCk7CiRzY29wZS5idXNpbmVzc0NhbGVuZGFySW5pdGlhbHMgPSB7Cm5hbWU6IGluaXRpYWxFbmRVc2VyLmZpcnN0X25hbWUgKyAiICIgKyBpbml0aWFsRW5kVXNlci5sYXN0X25hbWUKfTsKfSBlbHNlIHsKJHNjb3BlLmJ1c2luZXNzQ2FsZW5kYXJJbml0aWFsTmFtZSA9IGZhbHNlOwp9Ci8qIGNvbmZpZyBvYmplY3QgKi8KJHNjb3BlLmNhbGVuZGFyX25hbWUgPSAiY2FsZW5kYXJfYnVzaW5lc3MiOwokc2NvcGUuY2FsZW5kYXIgPSAiY2FsZW5kYXJfYnVzaW5lc3MiOwovKiBldmVudCBzb3VyY2VzIGFycmF5Ki8KCiAgICAvLyB0aGVkYXRhID0geyBzb3VyY2U6ICJjYWxlbmRhciIgfQogICAgLy8gdGhlZGF0YVsnZmlsdGVycyddID0geyBpbnN0cnVjdG9yX2lkOiAiMTk1In07CgogICAgLy8gY29uc29sZS5sb2codGhlZGF0YSk7Cgokc2NvcGUuYnVzaW5lc3NDYWxlbmRhckV2ZW50U291cmNlcyA9IFt7CiAgICAgIC8vIHVybDogJy9hcGkvYWRtaW4vZXZlbnRzL2dldHBvc3QnLAogICAgICB1cmw6ICcvYXBpL2FkbWluL3JlcG9ydHMvZXZlbnRzMicsCiAgICAgIGRhdGE6ICRzY29wZS50aGVkYXRhX3JlcG9ydCAsCnR5cGU6ICdQT1NUJwp9LCB7CnVybDogJy9hcGkvYWRtaW4vY2FsZW5kYXIvbGltaXRhdGlvbnMvYmFja2dyb3VuZC9nZXRwb3N0JywKICAgICAgZGF0YTogJHNjb3BlLnRoZWRhdGFfcmVwb3J0ICwKICAgICAgdHlwZTogJ1BPU1QnICAgIC8vIH0sIHsKLy8gICAgIHVybDogJy9hcGkvYWRtaW4vcmVjdXJyaW5nL2dldHBvc3QnLAovLyAgICAgdHlwZTogJ1BPU1QnCn1dOwoKJHNjb3BlLmdvdG9Ub2RheSA9IGZ1bmN0aW9uKCkgewokc2NvcGUuZ290b0RhdGUobmV3IERhdGUoKSk7CnZpc2libGVEYXRlU3RhcnQgPSBuZXcgRGF0ZSh1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ2V0VmlldycpLnN0YXJ0KTsKZGF0ZVRvR29UbyA9IHZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSArICItIiArICgnMCcgKyAodmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpICsgMSkpLnNsaWNlKC0yKSArICItIiArICgnMCcgKyB2aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSkuc2xpY2UoLTIpOwpzaGFyZWRQcm9wZXJ0aWVzLnNldF9jYWxlbmRhcl9kYXRlKGRhdGVUb0dvVG8pOwokc2NvcGUudmlzaWJsZURhdGVTdGFydD12aXNpYmxlRGF0ZVN0YXJ0OwokbG9jYXRpb24uc2VhcmNoKCdzdGFydCcsZGF0ZVRvR29Ubyk7Cn0KCiRzY29wZS5pbnN0cnVjdG9yU2VsZWN0ZWQ9ZnVuY3Rpb24odGhpc3RoaXMpCnsKdXBkYXRlU3VnZ2VzdGlvbnMoKTsKfQokc2NvcGUuZXZlbnRUeXBlU2VsZWN0ZWQ9ZnVuY3Rpb24odGhpc3RoaXMpCnsKdXBkYXRlU3VnZ2VzdGlvbnMoKTsKfQpmdW5jdGlvbiB1cGRhdGVTdWdnZXN0aW9ucygpCnsKbG9nRGVidWcoImZ1bmN0aW9uOiB1cGRhdGVTdWdnZXN0aW9ucyIpOwpzaGFyZWRQcm9wZXJ0aWVzLnNldF9ldmVudF90eXBlX2Zvcl9zdWdnZXN0aW9ucygkc2NvcGUuc2VsZWN0ZWRfZXZlbnRfdHlwZV9pZCk7CnNoYXJlZFByb3BlcnRpZXMuc2V0X3NlbGVjdGVkX2luc3RydWN0b3IoJHNjb3BlLnNlbGVjdGVkX2J1c2luZXNzX3VzZXJfaWQpOwpmb3IgKGk9MDtpPCRzY29wZS5ldmVudF90eXBlcy5sZW5ndGg7aSsrKQp7Ci8vIGNvbnNvbGUubG9nKCRzY29wZS5ldmVudF90eXBlc1tpXS5ldmVudF90eXBlX2lkKTsKaWYgKCRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkPT0kc2NvcGUuZXZlbnRfdHlwZXNbaV0uZXZlbnRfdHlwZV9pZCkKewovLyBjb25zb2xlLmxvZygiZm91bmQgZXZlbnQgdHlwZSBpZCIpOwppZiAoJHNjb3BlLmV2ZW50X3R5cGVzW2ldLmlzX2NsYXNzKSAvLyBpcyBjbGFzcwp7CmxvZ0RlYnVnKCIkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcj0iKyRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyKTsKaWYgKCRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyKQp7CmNvbnNvbGUubG9nKCJpcyBjbGFzcyBzdWdnZXN0aW9uZCIpOwokaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3RjbGFzcy8iKyRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkKyIvIiskc2NvcGUuc2VsZWN0ZWRfYnVzaW5lc3NfdXNlcl9pZCsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSsiLyIrKCRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkrMSkrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0SG91cnMoKSArICIvIiArICRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKSArICIvIiArICRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyX2lkKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKQp7CiRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkX2lzX2NsYXNzPXRydWU7CiRzY29wZS5ldmVudHNTdWdnZXN0ZWQgPSByZXNwb25zZS5kYXRhOwp9KTsKfQplbHNlCnsKY29uc29sZS5sb2coIm5vdCBpcyBjbGFzcyBzdWdnZXN0aW9uZCIpOwokaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3RjbGFzcy8iKyRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkKyIvIiskc2NvcGUuc2VsZWN0ZWRfYnVzaW5lc3NfdXNlcl9pZCsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSsiLyIrKCRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkrMSkrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0SG91cnMoKSArICIvIiArICRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKSArICIvMCIpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpCnsKJHNjb3BlLnNlbGVjdGVkX2V2ZW50X3R5cGVfaWRfaXNfY2xhc3M9dHJ1ZTsKJHNjb3BlLmV2ZW50c1N1Z2dlc3RlZCA9IHJlc3BvbnNlLmRhdGE7Cn0pOwp9Cn0KZWxzZSAvLyBpcyBub3QgY2xhc3MKewokaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3QvIiskc2NvcGUuc2VsZWN0ZWRfZXZlbnRfdHlwZV9pZCsiLyIrJHNjb3BlLnNlbGVjdGVkX2J1c2luZXNzX3VzZXJfaWQrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCkrIi8iKygkc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpKzEpKyIvIiskc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXREYXRlKCkrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldEhvdXJzKCkgKyAiLyIgKyAkc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXRNaW51dGVzKCkpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpCnsKJHNjb3BlLnNlbGVjdGVkX2V2ZW50X3R5cGVfaWRfaXNfY2xhc3M9ZmFsc2U7CiRzY29wZS5ldmVudHNTdWdnZXN0ZWQgPSByZXNwb25zZS5kYXRhOwp9KTsKfQp9Cn0KfQoKJHNjb3BlLmdvdG9OZXh0ID0gZnVuY3Rpb24oKSB7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZW1vdmVFdmVudHMnKTsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ25leHQnKTsKJHNjb3BlLnVwZGF0ZUNhbGVuZGFyQ2VudGVyVGl0bGUoKTsKLy8gYWRkaW5nIHRoZSBmb2xsb3dpbmcgdG8gbWFrZSB0aGUgdXJsCi8vIHBvaW50IHRvIHRoZSByaWdodCB3ZWVrLCBpZiBnb2luZyB0byBhIGRpZmZlcmVudCBVUkwgYW5kIHRoZW4gZ29pbmcgYmFjawp2aXNpYmxlRGF0ZVN0YXJ0ID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5zdGFydCk7CmRhdGVUb0dvVG8gPSB2aXNpYmxlRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCkgKyAiLSIgKyAoJzAnICsgKHZpc2libGVEYXRlU3RhcnQuZ2V0TW9udGgoKSArIDEpKS5zbGljZSgtMikgKyAiLSIgKyAoJzAnICsgdmlzaWJsZURhdGVTdGFydC5nZXREYXRlKCkpLnNsaWNlKC0yKTsKc2hhcmVkUHJvcGVydGllcy5zZXRfY2FsZW5kYXJfZGF0ZShkYXRlVG9Hb1RvKTsKJHNjb3BlLnZpc2libGVEYXRlU3RhcnQ9dmlzaWJsZURhdGVTdGFydDsKJGxvY2F0aW9uLnNlYXJjaCgnc3RhcnQnLGRhdGVUb0dvVG8pOwp9CiRzY29wZS5nb3RvUHJldiA9IGZ1bmN0aW9uKCkgewp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVtb3ZlRXZlbnRzJyk7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdwcmV2Jyk7CiRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlKCk7Ci8vIGFkZGluZyB0aGUgZm9sbG93aW5nIHRvIG1ha2UgdGhlIHVybAovLyBwb2ludCB0byB0aGUgcmlnaHQgd2VlaywgaWYgZ29pbmcgdG8gYSBkaWZmZXJlbnQgVVJMIGFuZCB0aGVuIGdvaW5nIGJhY2sKdmlzaWJsZURhdGVTdGFydCA9IG5ldyBEYXRlKHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3Jykuc3RhcnQpOwpkYXRlVG9Hb1RvID0gdmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpICsgIi0iICsgKCcwJyArICh2aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkgKyAxKSkuc2xpY2UoLTIpICsgIi0iICsgKCcwJyArIHZpc2libGVEYXRlU3RhcnQuZ2V0RGF0ZSgpKS5zbGljZSgtMik7CnNoYXJlZFByb3BlcnRpZXMuc2V0X2NhbGVuZGFyX2RhdGUoZGF0ZVRvR29Ubyk7CiRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0PXZpc2libGVEYXRlU3RhcnQ7CiRsb2NhdGlvbi5zZWFyY2goJ3N0YXJ0JyxkYXRlVG9Hb1RvKTsKCn0KJHNjb3BlLmdvdG9EYXRlID0gZnVuY3Rpb24obmV3ZGF0ZSkgewp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ290b0RhdGUnLCBuZXdkYXRlKTsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlbW92ZUV2ZW50cycpOwp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwokc2NvcGUudXBkYXRlQ2FsZW5kYXJDZW50ZXJUaXRsZSgpOwp9Cgokc2NvcGUuZWRpdEhvdXJzT2ZXb3JrID0gZnVuY3Rpb24oKSB7Ci8vIHBhcmFtIHNob3VsZCBsb29rIGxpa2UgIjIwMTYtMDctMDEiCnZpc2libGVEYXRlU3RhcnQgPSBuZXcgRGF0ZSh1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ2V0VmlldycpLnN0YXJ0KTsKZGF0ZVRvR29UbyA9IHZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSArICItIiArICgnMCcgKyAodmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpICsgMSkpLnNsaWNlKC0yKSArICItIiArICgnMCcgKyB2aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSkuc2xpY2UoLTIpOwokbG9jYXRpb24ucGF0aCgnL2hvdXJzX29mX3dvcmsnKS5zZWFyY2goewpzdGFydDogZGF0ZVRvR29Ubwp9KTsKfTsKCiRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlID0gZnVuY3Rpb24oKSB7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3Jyk7Cgp2aXNpYmxlRGF0ZVN0YXJ0ID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5zdGFydCk7CnZpc2libGVEYXRlRW5kID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5lbmQpOwoKJHNjb3BlLmNhbGVuZGFyVGl0bGVDZW50ZXIgPSB2aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSArICIgIiArIG1vbnRoTmFtZXNbdmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpXSArCiIg4oCUICIgKyB2aXNpYmxlRGF0ZUVuZC5nZXREYXRlKCkgKyAiICIgKyBtb250aE5hbWVzW3Zpc2libGVEYXRlRW5kLmdldE1vbnRoKCldICsKIiAiICsgdmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpOwp9OwoKJHNjb3BlLnNob3dFdmVudFBvcHVwID0gZnVuY3Rpb24oc2VsZWN0ZWRFdmVudCkgewpzaG93RXZlbnRQb3B1cChzZWxlY3RlZEV2ZW50LCAkdWliTW9kYWwpCn07Cgokc2NvcGUuZXZlbnRDcmVhdGVNb2RhbEZyb21TY2hlZHVsZXIgPSBmdW5jdGlvbihlc3VnZ2VzdCkKewovLyBpZiBjbGFzcyAtIGdvIHRvIGV2ZW50IGNsYXNzCmNvbnNvbGUubG9nKGVzdWdnZXN0KTsKZm9yIChpPTA7aTwkc2NvcGUuZXZlbnRfdHlwZXMubGVuZ3RoO2krKykKewppZiAoZXN1Z2dlc3QuZXZlbnRfdHlwZV9pZD09JHNjb3BlLmV2ZW50X3R5cGVzW2ldLmV2ZW50X3R5cGVfaWQpCnsKaWYgKCRzY29wZS5ldmVudF90eXBlc1tpXS5pc19jbGFzcykKewpjb25zb2xlLmxvZygiaXMgY2xhc3MiKTsKd2luZG93LmxvY2F0aW9uLmhyZWY9Jy8jL2V2ZW50X2NsYXNzLycgKyBlc3VnZ2VzdC5ldmVudF9pZDsKcmV0dXJuOwp9Cn0KfQpsb2dEZWJ1ZyhKU09OLnN0cmluZ2lmeShlc3VnZ2VzdCkpOwpsb2dEZWJ1Zyhlc3VnZ2VzdC5zdGFydF9lcG9jaCk7CnN0YXJ0RGF0ZT1lc3VnZ2VzdC5zdGFydF9lcG9jaCoxMDAwOwoKdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CmFuaW1hdGlvbjogZmFsc2UsCnRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2V2ZW50X2NyZWF0ZS5waHAnLApjb250cm9sbGVyOiAnZXZlbnRDcmVhdGVNb2RhbENvbnRyb2xsZXInLApzaXplOiAnbCcsCnJlc29sdmU6IHsKc3RhcnREYXRlOiBmdW5jdGlvbigpIHsKcmV0dXJuIHN0YXJ0RGF0ZTsKfSwKZXZlbnRfdHlwZV9pZDogZnVuY3Rpb24oKSB7CnJldHVybiAkc2NvcGUuc2VsZWN0ZWRfZXZlbnRfdHlwZV9pZDsKfSwKbG9jYXRpb25faWQ6IGZ1bmN0aW9uKCkgewpyZXR1cm4gZXN1Z2dlc3QubG9jYXRpb25faWQ7Cn0sCmVtcF9pZDogZnVuY3Rpb24oKSB7CnJldHVybiBlc3VnZ2VzdC5lbXBfaWQ7Cn0sCnJlc2NoZWR1bGVfZXZlbnQ6IGZ1bmN0aW9uKCkKewppZiAoJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGUpCnsKcmV0dXJuICRzY29wZS5wcmV2aW91c19ldmVudF9yZXNjaGVkdWxlX2V2ZW50Owp9CmVsc2UKewpyZXR1cm4gbnVsbDsKfQp9Cgp9Cn0pOwoKfQokc2NvcGUuZXZlbnRDcmVhdGVNb2RhbCA9IGZ1bmN0aW9uKHN0YXJ0RGF0ZSwgc2l6ZSkgewogICAgICAgIGxvZ0RlYnVnKCJldmVudENyZWF0ZU1vZGFsIHN0YXJ0RGF0ZT0iK3N0YXJ0RGF0ZSk7Cgp2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKYW5pbWF0aW9uOiBmYWxzZSwKdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfZXZlbnRfY3JlYXRlLnBocCcsCmNvbnRyb2xsZXI6ICdldmVudENyZWF0ZU1vZGFsQ29udHJvbGxlcicsCnNpemU6IHNpemUsCnJlc29sdmU6IHsKc3RhcnREYXRlOiBmdW5jdGlvbigpIHsKcmV0dXJuIHN0YXJ0RGF0ZTsKfSwKZXZlbnRfdHlwZV9pZDogZnVuY3Rpb24oKSB7CnJldHVybiAwOwp9LApsb2NhdGlvbl9pZDogZnVuY3Rpb24oKSB7CnJldHVybiAwOwp9LAplbXBfaWQ6IGZ1bmN0aW9uKCkgewpyZXR1cm4gMDsKfSwKcmVzY2hlZHVsZV9ldmVudDogZnVuY3Rpb24oKQp7CmlmICgkc2NvcGUucHJldmlvdXNfZXZlbnRfcmVzY2hlZHVsZSkKewpyZXR1cm4gJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGVfZXZlbnQ7Cn0KZWxzZQp7CnJldHVybiBudWxsOwp9ICAgICAgICAgICAgICAgIH0KCn0KfSk7Cgptb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHNlbGVjdGVkSXRlbSkgewokc2NvcGUuc2VsZWN0ZWQgPSBzZWxlY3RlZEl0ZW07Cn0sIGZ1bmN0aW9uKCkgewpsb2dEZWJ1ZygnTW9kYWwgZGlzbWlzc2VkIGF0OiAnICsgbmV3IERhdGUoKSk7Cn0pOwp9OwoKLy8vCiRzY29wZS51cGRhdGVFdmVudERhdGFiYXNlID0gZnVuY3Rpb24oc3RhcnRfcGFyYW0sIGVuZF9wYXJhbSwgZXZlbnRfaWQsIHRoZWV2ZW50KQp7Cgpsb2dEZWJ1ZygidXBkYXRlRXZlbnREYXRhYmFzZSBzdGFydD0iICsgc3RhcnRfcGFyYW0gKyAiLCBlbmQ9IiArIGVuZF9wYXJhbSArICIsIGV2ZW50X2lkPSIgKyBldmVudF9pZCk7CnRoZXVybCA9ICcvYXBpL2FkbWluL2V2ZW50cy9zZXQvJyArIGV2ZW50X2lkOwoKJGh0dHAoewptZXRob2Q6ICdQT1NUJywKdXJsOiB0aGV1cmwsCmRhdGE6IHsKc3RhcnRfZGF0ZTogc3RhcnRfcGFyYW0sCmVuZF9kYXRlOiBlbmRfcGFyYW0sCmV2ZW50X2lkOiBldmVudF9pZAp9LApoZWFkZXJzOiB7CidDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbjtjaGFyc2V0PXV0Zi04Jwp9Cn0pLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkgewoKbG9nRGVidWcoZGF0YSk7CmlmIChkYXRhLkVycm9yKSB7CmxvZ0RlYnVnKCJlcnJvciAiICsgZGF0YS5NZXNzYWdlKTsKYWxlcnQoJ2Vycm9yJyk7CmNhbGVuZGFyID0gImNhbGVuZGFyX2J1c2luZXNzIjsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwp9IGVsc2Ugewpsb2dEZWJ1Zygic3VjY2VzcyIpOwpjYWxlbmRhciA9ICJjYWxlbmRhcl9idXNpbmVzcyI7Ci8vIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKLy8gJHVpYk1vZGFsSW5zdGFuY2UuZGlzbWlzcygnYWRkZWQgYW5kIHJlZmV0Y2hFdmVudHMnKTsKfQp9KTsKCn07Ci8vLwoKJHNjb3BlLmNsYXNzRXZlbnRBZGRVc2VyID0gZnVuY3Rpb24oZXN1Z2dlc3QpCnsKY29uc29sZS5sb2coImNsYXNzRXZlbnRBZGRVc2VyIG9yIFJlbW92ZSIpOwppZiAoKGVzdWdnZXN0LmlzX3JlZ2lzdGVyZWQ9PTEpIHwgKChlc3VnZ2VzdC5pc193YWl0aW5nbGlzdD09MSkgJiYgKGVzdWdnZXN0LmlzX2NhbmNlbGVkPT0wKSkpCnsKY29uc29sZS5sb2coIm5lZWQgdG8gdW5yZWdpc3RlciIpOwpyZW1vdmVFbmRVc2VyRnJvbUV2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcl9pZCxlc3VnZ2VzdC5ldmVudF9pZCxyZW1vdmVFbmRVc2VyRnJvbUV2ZW50X2NhbGxiYWNrLCByZW1vdmVFbmRVc2VyRnJvbUV2ZW50X2NhbGxiYWNrKTsKZnVuY3Rpb24gcmVtb3ZlRW5kVXNlckZyb21FdmVudF9jYWxsYmFjaygpCnsKJHNjb3BlLmV2ZW50VHlwZVNlbGVjdGVkKCk7CmNhbGVuZGFyID0gImNhbGVuZGFyX2J1c2luZXNzIjsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwoKfQp9CmVsc2UKewovLyBjb25zb2xlLmxvZyhlc3VnZ2VzdC5ldmVudF9pZCk7Ci8vIGNvbnNvbGUubG9nKCRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyX2lkKTsKLy8gaWYgc2VsZWN0ZWQgdXNlciAtIGFkZGluZyBoaW0vaGVyIHRvIGNsYXNzCmlmICgkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcikKewphZGRFbmRVc2VyVG9FdmVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJfaWQsZXN1Z2dlc3QuZXZlbnRfaWQsYWRkRW5kVXNlclRvRXZlbnRfY2FsbGJhY2ssIGFkZEVuZFVzZXJUb0V2ZW50X2NhbGxiYWNrKTsKZnVuY3Rpb24gYWRkRW5kVXNlclRvRXZlbnRfY2FsbGJhY2soKQp7CmNhbGVuZGFyID0gImNhbGVuZGFyX2J1c2luZXNzIjsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwokc2NvcGUuZXZlbnRUeXBlU2VsZWN0ZWQoKTsKfQp9CmVsc2UgLy8gZWxzZSAtIGdvaW5nIHRvIGNsYXNzIHBhZ2UKewp3aW5kb3cubG9jYXRpb24uaHJlZj0nLyMvZXZlbnRfY2xhc3MvJyArIGVzdWdnZXN0LmV2ZW50X2lkOwp9Cn0KfQokc2NvcGUuY2FsZW5kYXJfYnVzaW5lc3NfY29uZmlnID0gewpjYWxlbmRhcjogewpoZWlnaHQ6ICdhdXRvJywKZWRpdGFibGU6IHRydWUsCi8vIGhlYWRlcjogewovLyAgICAgbGVmdDogJycsCi8vICAgICBjZW50ZXI6ICcnLAovLyAgICAgcmlnaHQ6ICcnCi8vIH0sCi8vIGhlYWRlcjogewovLyAgICAgbGVmdDogJ3RpdGxlJywKLy8gICAgIGNlbnRlcjogJycsCi8vICAgICByaWdodDogJ3RvZGF5IHByZXYsbmV4dCcKLy8gfSwKdGl0bGVGb3JtYXQ6IHsKLy8gd2VlazogICJkIFtNTU1deyAnJiM4MjExOycgZCBNTU19Igp9LAovLyB0aXRsZUZvcm1hdDogewovLyAgICAgbW9udGg6ICdNTU1NIHl5eXknLAovLyAgICAgd2VlazogIk1NTSBkWyB5eXl5XXsgJyYjODIxMjsnWyBNTU1dIGQgeXl5eX0iLAovLyAgICAgZGF5OiAnTU0vZGQnCi8vIH0sCmhlYWRlcjogJycsCi8vIGRlZmF1bHRWaWV3OiAnYWdlbmRhV2VlaycsCi8vIHZpZXdzOiB7Ci8vICAgICBkb250U2hvd0RhdGU6IHsKLy8gICAgICAgICB0eXBlOiAnYWdlbmRhV2VlaycsCi8vICAgICAgICAgZHVyYXRpb246IHsKLy8gICAgICAgICAgICAgZGF5czogNwovLyAgICAgICAgIH0sCi8vICAgICAgICAgdGl0bGU6ICdBcGVydHVyYScsCi8vICAgICAgICAgY29sdW1uRm9ybWF0OiAnZGRkZCcgLy8gRm9ybWF0IHRoZSBkYXkgdG8gb25seSBzaG93IGxpa2UgJ01vbmRheScKLy8gICAgICAgICAgICAgLy8gaGlkZGVuRGF5czogWzAsIDZdIC8vIEhpZGUgU3VuZGF5IGFuZCBTYXR1cmRheT8KLy8gICAgIH0KLy8gfSwKLy8gc2xvdER1cmF0aW9uOiAnMDA6MTU6MDAnLApldmVudERyb3A6IGZ1bmN0aW9uKGV2ZW50LCBkYXlEZWx0YSwgbWludXRlRGVsdGEsIGFsbERheSwgcmV2ZXJ0RnVuYywgdWlDYWxlbmRhckNvbmZpZykgewpsb2dEZWJ1ZygiZXZlbnQgZHJvcCIgKyBldmVudC50aXRsZSArICIoIiArIGV2ZW50LmlkICsgIikgbW92ZWQgIiArIG1pbnV0ZURlbHRhICsgIiBtaW51dGVzIik7CmxvZ0RlYnVnKCJvbGQgc3RhcnQ9IiArIGV2ZW50LnN0YXJ0ICsgIiwgb2xkIGVuZD0iICsgZXZlbnQuZW5kKTsKJHNjb3BlLnVwZGF0ZUV2ZW50RGF0YWJhc2UoZXZlbnQuc3RhcnQsIGV2ZW50LmVuZCwgZXZlbnQuaWQsIGV2ZW50KTsKfSwKZXZlbnRSZXNpemU6IGZ1bmN0aW9uKGV2ZW50LCBkZWx0YSwgcmV2ZXJ0RnVuYykgewpsb2dEZWJ1ZygiZXZlbnQgcmVzaXplIiArIGV2ZW50LnRpdGxlICsgIigiICsgZXZlbnQuaWQgKyAiKSBtb3ZlZCAiKTsKbG9nRGVidWcoIm9sZCBzdGFydD0iICsgZXZlbnQuc3RhcnQgKyAiLCBvbGQgZW5kPSIgKyBldmVudC5lbmQpOwokc2NvcGUudXBkYXRlRXZlbnREYXRhYmFzZShldmVudC5zdGFydCwgZXZlbnQuZW5kLCBldmVudC5pZCwgZXZlbnQpOwp9LApkZWZhdWx0VmlldzogJ2FnZW5kYVdlZWsnLApldmVudFN0YXJ0RWRpdGFibGU6ZmFsc2UsCmV2ZW50RHVyYXRpb25FZGl0YWJsZTpmYWxzZSwKZGVmYXVsdERhdGU6IG1vbWVudChjdXJyRGVmYXVsdERhdGUpLAoKLy8gZGVmYXVsdFZpZXc6ICdkb250U2hvd0RhdGUnLApldmVudENsaWNrOiBmdW5jdGlvbihjYWxFdmVudCwganNFdmVudCwgdmlldykgewpsb2dEZWJ1ZygiY2FsZW5kYXIgZXZlbnQgY2xpY2tlZCAiICsgY2FsRXZlbnQudGl0bGUgKyAiKCIgKyBjYWxFdmVudC5pZCArICIpICIgKyBjYWxFdmVudC5zdGFydCArICIgIiArIGNhbEV2ZW50LmVuZCk7Ci8vIGxvZ0RlYnVnKEpTT04uc3RyaW5naWZ5KGNhbEV2ZW50KSk7Ci8vIGlmIGl0J3MgYSBnZW5lcmljIGV2ZW50ICh2YWNhdGlvbiBldGMpCi8vIHNob3cgcG9wdXAgd2l0aCBvcHRpb24gdG8gZGVsZXRlCmlmIChjYWxFdmVudC5pc19nZW5lcmljX2V0eXBlPT0xKQp7Ci8vICRzY29wZS5zaG93R2VuZXJpY0V2ZW50KGNhbEV2ZW50KTsKJHNjb3BlLnNob3dFdmVudFBvcHVwKGNhbEV2ZW50KTsKCn0KZWxzZQp7CiRzY29wZS5zaG93RXZlbnRQb3B1cChjYWxFdmVudCk7Cn0KLy8gY2hhbmdlIHRoZSBib3JkZXIgY29sb3IganVzdCBmb3IgZnVuCi8vICQodGhpcykuY3NzKCdib3JkZXItY29sb3InLCAncmVkJyk7Cgp9LApkYXlDbGljazogZnVuY3Rpb24oZGF0ZSwganNFdmVudCwgdmlldykgewovLyBsb2dEZWJ1ZygibmV3IGV2ZW50IGNyZWF0aW9uIGNsaWNrZWQgIiArIGNhbEV2ZW50LnRpdGxlICsgIigiICsgY2FsRXZlbnQuaWQgKyAiKSAiICsgY2FsRXZlbnQuc3RhcnQgKyAiICIgKyBjYWxFdmVudC5lbmQpOwovLyAgICAgc3RhcnQgPSBkYXRlOwovLyAgICAgZW5kID0gbW9tZW50KHN0YXJ0KS5hZGQoNDUsICdtaW51dGVzJyk7CmlmICh2aWV3Lm5hbWUgPT09ICJtb250aCIpIHsKY2FsZW5kYXIgPSAiY2FsZW5kYXJfYnVzaW5lc3MiOwp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdjaGFuZ2VWaWV3JywgImFnZW5kYVdlZWsiKTsKfSBlbHNlIHsKJHNjb3BlLmV2ZW50Q3JlYXRlTW9kYWwoZGF0ZSk7Cn0KLy8gY2hhbmdlIHRoZSBib3JkZXIgY29sb3IganVzdCBmb3IgZnVuCi8vICQodGhpcykuY3NzKCdib3JkZXItY29sb3InLCAncmVkJyk7Cgp9LApldmVudFJlbmRlcjogZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpCnsKaWYgKCFldmVudC5ldmVudF9pZD4wKQp7Ci8vIG5vdCBhIHJlYWwgZXZlbnQgLSBwcm9iYWJseSBibG9jayAvIGJhY2tncm91bmQKLy8gaWdub3JpbmcgaXQKcmV0dXJuOwp9Ci8vIGNoYW5naW5nIGxvb2sgYW5kIGZlZWwgb2YgZXZlbiB0aGF0IGlzIHRvIHJlc2NoZWR1bGUKaWYgKHNoYXJlZFByb3BlcnRpZXMuZ2V0X2V2ZW50X3Jlc2NoZWR1bGUoKSE9bnVsbCkKewppZiAoZXZlbnQuZXZlbnRfaWQ9PXNoYXJlZFByb3BlcnRpZXMuZ2V0X2V2ZW50X3Jlc2NoZWR1bGUoKS5ldmVudF9pZCkKewplbGVtZW50LmNzcygnYmFja2dyb3VuZC1jb2xvcicsICcjQTlBOUE5CScpOwplbGVtZW50LmNzcygnYm9yZGVyLWNvbG9yJywgJyNBOUE5QTkJJyk7CnJldHVybjsKfQp9CiAgICAgICAgICAgICAgICBpZiAoZXZlbnQuaXNfZ2VuZXJpY19ldHlwZT09MSkKICAgICAgICAgICAgICAgIHsKCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIGlmIChldmVudC5pc19jbGFzcz09MSkKewovLyBpZiBjbGFzcyBhZGRpbmcgbnVtYmVyIG9mIHBhcnRpY2lwYW50cwppZiAoZXZlbnQubm9fb2Zfd2FpdGluZ191c2Vycz4wKQp7CmVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZChldmVudC5ub19vZl91c2VycysiLyIrZXZlbnQubWF4X3BhcnRpY2lwYW50cysgIiAoIitldmVudC5ub19vZl93YWl0aW5nX3VzZXJzKyIpIisiIC0gIik7Cn0KZWxzZQp7CmVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZChldmVudC5ub19vZl91c2VycysiLyIrZXZlbnQubWF4X3BhcnRpY2lwYW50cysiIC0gIik7Cn0KfQplbHNlCnsKLy8gaWYgbm90IGNsYXNzIC0gd3JpdGluZyB0aGUgZW5kdXNlciBuYW1lCmlmIChldmVudC5kdXJhdGlvbl9ldmVudCE9MCkgLy8gYWxzbyBpZiBub3QgaG91cnMgb2Ygd29yawp7Ci8vIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykuYXBwZW5kKCIgKCIrZXZlbnQuZXZlbnRVc2Vyc1swXS5idXNlcl9maXJzdF9uYW1lKyIgIitldmVudC5ldmVudFVzZXJzWzBdLmJ1c2VyX2xhc3RfbmFtZSsiKSIpOwovLyBjb25zb2xlLmxvZyhldmVudC5ldmVudFVzZXJzKTsKLy8gY29uc29sZS5sb2coZXZlbnQuZXZlbnRVc2Vycy5sZW5ndGgpOwogICAgICAgICAgICAgICAgICAgIC8vIGlmIChldmVudC5ldmVudFVzZXJzLmxlbmd0aD4wKQp7CiAgICAgICAgICAgICAgICAgICAgICAvLyBlbGVtZW50LmZpbmQoJy5mYy10aXRsZScpLnByZXBlbmQoIiIrZXZlbnQuZXZlbnRVc2Vyc1swXS5idXNlcl9maXJzdF9uYW1lKyIgIitldmVudC5ldmVudFVzZXJzWzBdLmJ1c2VyX2xhc3RfbmFtZSsiICgiKTsKICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZCgiIitldmVudC5ldmVudF91c2VyX2NsaWVudHMrIiAoIik7CmVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykuYXBwZW5kKCIpIik7Cn0KfQovLyBsb2dEZWJ1ZygiaGVyZTQiKTsKfQppZiAoZXZlbnQuaXNfcmVwZWF0aW5nID09IDEpIHsKZWxlbWVudC5maW5kKCIuZmMtdGl0bGUiKS5hcHBlbmQoIiZuYnNwOzxpIGNsYXNzPSdmYSBmYS1yZXBlYXQnPjwvaT4mbmJzcDsiKTsKLy8gIGVsZW1lbnQuZmluZCgiLmZjLXRpdGxlIikuYXBwZW5kKCImbmJzcDs8aW1nIHNyYz0nL3B1YmxpYy9pbWFnZXMvcmVjdXJyaW5nLWljb24ucG5nJyB3aWR0aD0nMTBweCcgaGVpZ2h0PScxMHB4Jy8+Iik7Cn0KfSwKbWluVGltZTogJGdDYWxlbmRhckRpc3BsYXlNaW5UaW1lLAptYXhUaW1lOiAkZ0NhbGVuZGFyRGlzcGxheU1heFRpbWUsCnNlbGVjdGFibGU6IGZhbHNlLApzZWxlY3RIZWxwZXI6IGZhbHNlLAp0aW1lem9uZTogZmFsc2UsCmlzUlRMOiB0cnVlLApsYW5nOiAiaGUiLCAvLyBrawphbGxEYXlTbG90OiBmYWxzZSwKbG9hZGluZzogZnVuY3Rpb24oYm9vbCkgewppZiAoYm9vbCkgewogICAgICAgICAgICAgICAgICAgIGxvZ0RlYnVnKCdsb2FkaW5nIGNhbGVuZGFyMSAnICsgJHNjb3BlLmNhbGVuZGFyKTsKLy8gJCgnI2xvYWRpbmcnKS5zaG93KCk7Cn0gZWxzZSB7Ci8vICQoJyNsb2FkaW5nJykuaGlkZSgpOwpsb2dEZWJ1ZygnZmluaXNoZWQgbG9hZGluZyBjYWxlbmRhciB4JyArICRzY29wZS5jYWxlbmRhcik7CiRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlKCk7CmxvZ0RlYnVnKCJhZnRlciBjYWxlbmRhciBsb2FkIHZpc2libGVEYXRlU3RhcnQ9Iit1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ2V0VmlldycpLnN0YXJ0KTsKdmlzaWJsZURhdGVTdGFydCA9IG5ldyBEYXRlKHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3Jykuc3RhcnQpOwpkYXRlVG9Hb1RvID0gdmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpICsgIi0iICsgKCcwJyArICh2aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkgKyAxKSkuc2xpY2UoLTIpICsgIi0iICsgKCcwJyArIHZpc2libGVEYXRlU3RhcnQuZ2V0RGF0ZSgpKS5zbGljZSgtMik7Ci8vIGNvbnNvbGUubG9nKCJkYXRlVG9Hb1RvIitkYXRlVG9Hb1RvKTsKLy8gJGh0dHAuZ2V0KCRnQXBpVVJMUHJlZml4ICsgIi9lbmR1c2VyL2V2ZW50cy9zdWdnZXN0LyIrdmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpKyIvIit0aGlzX3dlZWtfZnVsbF95ZWFyKyIvIit0aGlzX3dlZWtfbW9udGgrIi8iK3RoaXNfd2Vla19kYXlfb2ZfbW9udGgrIi8iKyB0aGlzX3dlZWtfaG91cnMrICIvIiArIHRoaXNfd2Vla19taW51dGVzKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKQokc2NvcGUuZXZlbnRfdHlwZV9pZD0kc2NvcGUuc2VsZWN0ZWRfZXZlbnRfdHlwZV9pZDsKJHNjb3BlLnZpc2libGVEYXRlU3RhcnQ9dmlzaWJsZURhdGVTdGFydDsKLy8xMjEyMTIKLy8gaWYgKCRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkX2lzX2NsYXNzKQovLyB7Ci8vICAgJGh0dHAuZ2V0KCRnQXBpVVJMUHJlZml4ICsgIi9lbmR1c2VyL2V2ZW50cy9zdWdnZXN0Y2xhc3MvIiskc2NvcGUuZXZlbnRfdHlwZV9pZCsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSsiLyIrKCRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkrMSkrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0SG91cnMoKSArICIvIiArICRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKSsgIi8iICsgJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJfaWQpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpCi8vICAgewovLyAgICAgICAvLwkgICAgJHNjb3BlLm15RGF0YSA9IHJlc3BvbnNlLmRhdGE7Ci8vICAgICAgIC8vCQlsb2dEZWJ1ZygiZ3JpZG9wdGlvbnM9Iiskc2NvcGUuZ3JpZE9wdGlvbnMpOwovLyAgICAgICAkc2NvcGUuZXZlbnRzU3VnZ2VzdGVkID0gcmVzcG9uc2UuZGF0YTsKLy8gICAgICAgLy8gJHNjb3BlLmRhdGVUb0dvVG89ZGF0ZVRvR29UbzsKLy8gICB9KTsKLy8gfQovLyBlbHNlCi8vIHsKLy8gICAkaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3QvIiskc2NvcGUuZXZlbnRfdHlwZV9pZCsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSsiLyIrKCRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkrMSkrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0SG91cnMoKSArICIvIiArICRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkKLy8gICB7Ci8vICAgICAgIC8vCSAgICAkc2NvcGUubXlEYXRhID0gcmVzcG9uc2UuZGF0YTsKLy8gICAgICAgLy8JCWxvZ0RlYnVnKCJncmlkb3B0aW9ucz0iKyRzY29wZS5ncmlkT3B0aW9ucyk7Ci8vICAgICAgICRzY29wZS5ldmVudHNTdWdnZXN0ZWQgPSByZXNwb25zZS5kYXRhOwovLyAgICAgICAvLyAkc2NvcGUuZGF0ZVRvR29Ubz1kYXRlVG9Hb1RvOwovLyAgIH0pOwovLyB9CgovLyBhZnRlciBjYWxlbmRhciBpcyBsb2FkZWQgLSBsb2FkaW5nIGV2ZW50IHR5cGVzIGFuZCBzdWdnZXN0aW9uIGZvciBxdWV1ZXMKLy8gd2UgaGFuZGxlIHRoaW5ncyByZWxhdGVkIHRvIHRoZSBldmVudCB0eXBlcyBvbmx5IGFmdGVyIGxvYWRpbmcgdGhlbSAoYW5kIHRoZSBjYWxlbmRhcikKZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzTm9TeXN0ZW0oJGh0dHAsJHNjb3BlLCdldmVudF90eXBlcycsZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzTm9TeXN0ZW1fY2FsbGJhY2spOwoKZnVuY3Rpb24gZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzTm9TeXN0ZW1fY2FsbGJhY2soKQp7ICAgIC8vIGNoZWNraW5nIGlmIGNhbGVuZGFyIHNob3VsZCBzdGFydCB3aXRoIGEgc3BlY2lmaWMgZXZlbnQgdHlwZSBmb3Igc3VnZ2VzdGlvbnMKLy8gbG9nRGVidWcoIlggc2hhcmVkUHJvcGVydGllcy5nZXRfZXZlbnRfdHlwZV9mb3Jfc3VnZ2VzdGlvbnM9IitzaGFyZWRQcm9wZXJ0aWVzLmdldF9ldmVudF90eXBlX2Zvcl9zdWdnZXN0aW9ucygpKTsKaWYgKHNoYXJlZFByb3BlcnRpZXMuZ2V0X2V2ZW50X3R5cGVfZm9yX3N1Z2dlc3Rpb25zKCkhPW51bGwpCnsKJHNjb3BlLnNlbGVjdGVkX2V2ZW50X3R5cGVfaWQ9c2hhcmVkUHJvcGVydGllcy5nZXRfZXZlbnRfdHlwZV9mb3Jfc3VnZ2VzdGlvbnMoKTsKJHNjb3BlLmV2ZW50VHlwZVNlbGVjdGVkKCRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkKTsKfQoKLy8gZmlyc3QgY2hlY2tpbmcgaWYgdGhlcmUncyBhbiBldmVudCB0byByZXNjaGVkdWxlCmlmIChzaGFyZWRQcm9wZXJ0aWVzLmdldF9ldmVudF9yZXNjaGVkdWxlKCkhPW51bGwpCnsKJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGU9dHJ1ZTsKJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGVfZXZlbnQ9c2hhcmVkUHJvcGVydGllcy5nZXRfZXZlbnRfcmVzY2hlZHVsZSgpOwpzaGFyZWRQcm9wZXJ0aWVzLnNldF9ldmVudF9yZXNjaGVkdWxlKG51bGwpOwpsb2dEZWJ1ZygiZ290IGV2ZW50IHRvIHJlc2NoZWR1bGUgIitKU09OLnN0cmluZ2lmeSgkc2NvcGUucHJldmlvdXNfZXZlbnRfcmVzY2hlZHVsZV9ldmVudCkpOwpsb2dEZWJ1ZygicmVzY2hlZHVsZSBldmVudF90eXBlX2lkPSIrJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGVfZXZlbnQuZXZlbnRfdHlwZV9pZCk7CiRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkPSRzY29wZS5wcmV2aW91c19ldmVudF9yZXNjaGVkdWxlX2V2ZW50LmV2ZW50X3R5cGVfaWQ7CiRzY29wZS5ldmVudFR5cGVTZWxlY3RlZCgpOwp9Ci8vIGNoZWNraW5nIHNlbGVjdGVkIHVzZXIgb25seSBpZiB0aGVyZSdzIG5vIHNlbGVjdGVkIGV2ZW50IHRvIG1vdmUKZWxzZSBpZiAoc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpIT1udWxsKQp7CmNvbnNvbGUubG9nKCJnb3QgcHJldmlvdXMgc2VsZWN0ZWQgdXNlciAiK3NoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKS5idXNlcl9maXJzdF9uYW1lKTsKJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJuYW1lPXNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKS5idXNlcl9maXJzdF9uYW1lKyIgIitzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfbGFzdF9uYW1lOwokc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcl9pZD1zaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzaW5lc3NfdXNlcl9pZDsKbG9nRGVidWcoIiRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyX2lkPSIrJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJfaWQpOwoKJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXI9dHJ1ZTsKfQp9Cn0KCn0sCi8vIHNlbGVjdDogZnVuY3Rpb24oc3RhcnQsIGVuZCwgYWxsRGF5KSB7Ci8vICAgICAvLyB2YXIgdGl0bGUgPSBwcm9tcHQoJ0V2ZW50IFRpdGxlOicgKyAoc3RhcnQgKyAzNTI4MDAwMDApIC8gKDYwICogMTAwMCkgKyAiICIgKyBlbmQgKyAiICIgKyBhbGxEYXkpOwovLyAgICAgdGl0bGUgPSAi16nXoteV16og16TXoteZ15zXldeqIjsKLy8gICAgIGlmICh0aXRsZSkgewovLyAgICAgICAgIGxvZ0RlYnVnKCJjcmVhdGluZyBkZXZlbnQgc3RhcnQiKTsKLy8gICAgICAgICBsb2dEZWJ1Zygic3RhcnQ9IiArIHN0YXJ0KTsKLy8gICAgICAgICBjaGVja0RhdGUgPSBuZXcgRGF0ZShzdGFydCk7Ci8vICAgICAgICAgbG9nRGVidWcoImNoZWNrIGRhdGUgPSAiICsgY2hlY2tEYXRlKQovLyAgICAgICAgIGxvZ0RlYnVnKCJlbmQ9IiArIGVuZCk7Ci8vICAgICAgICAgZWNvbG9yID0gIiMiICsgJHNjb3BlLmV2ZW50Q29sb3I7IC8vZ2V0UmFuZG9tQ29sb3IoKTsKLy8KLy8KLy8gICAgICAgICAvLyB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tdLmZ1bGxDYWxlbmRhcigncmVyZW5kZXJFdmVudHMnKTsKLy8KLy8gICAgICAgICBjYWxlbmRhciA9ICRzY29wZS5jYWxlbmRhcl9uYW1lOwovLyAgICAgICAgIHRlbXBfbGltaXRfaWQgPSAkZ0NhbGVuZGFyVGVtcEVudklEMSAtIGdldFJhbmRvbUludCgxMCwgODApOwovLyAgICAgICAgIG5ld0V2ZW50ID0gewovLyAgICAgICAgICAgICBpZDogdGVtcF9saW1pdF9pZCwKLy8gICAgICAgICAgICAgdGl0bGU6IHRpdGxlLAovLyAgICAgICAgICAgICBzdGFydDogc3RhcnQsCi8vICAgICAgICAgICAgIGNvbG9yOiBlY29sb3IsCi8vICAgICAgICAgICAgIGVuZDogZW5kLAovLyAgICAgICAgICAgICBhbGxEYXk6IGZhbHNlLAovLyAgICAgICAgICAgICBjbGFzc05hbWU6IFsnb3BlblNlc2FtZSddCi8vICAgICAgICAgICAgICAgICAvLyBjb2xvcjogcmVzb3VyY2UuZXZlbnRDb2xvcgovLyAgICAgICAgIH07Ci8vICAgICAgICAgY2FsZW5kYXIgPSAkc2NvcGUuY2FsZW5kYXJfbmFtZTsKLy8KLy8gICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZW5kZXJFdmVudCcsIG5ld0V2ZW50LCB0cnVlKTsKLy8gICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCd1bnNlbGVjdCcpOwovLwovLyAgICAgICAgIGxvZ0RlYnVnKCJjcmVhdGluZyBkZXZlbnQgZW5kIik7Ci8vICAgICAgICAgJHNjb3BlLmFkZEV2ZW50VG9EYXRhYmFzZShzdGFydCwgZW5kLCB0aXRsZSwgZWNvbG9yLCB0ZW1wX2xpbWl0X2lkKTsKLy8KLy8gICAgIH0KLy8gfQp9Cn07Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignSG91cnNPZldvcmtDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGNvbXBpbGUsICRsb2NhdGlvbiwgdWlDYWxlbmRhckNvbmZpZywgJHVpYk1vZGFsKSB7CmxvZ0RlYnVnKCdIb3Vyc09mV29yayBDb250cm9sbGVyJyk7Cgpsb2dEZWJ1ZygiJGxvY2F0aW9uLnNlYXJjaCgpLnN0YXJ0PSIgKyAkbG9jYXRpb24uc2VhcmNoKCkuc3RhcnQpOwppZiAodHlwZW9mICRsb2NhdGlvbi5zZWFyY2goKS5zdGFydCA9PSAndW5kZWZpbmVkJykgewpjdXJyRGVmYXVsdERhdGUgPSAkZ0hvdXIwZGF0ZTsKJHNjb3BlLmZpeGVkU2NoZWR1bGUgPSB0cnVlOwokc2NvcGUuY2FsZW5kYXJUaXRsZUNlbnRlciA9ICLXqdei15XXqiDXpNei15nXnNeV16og16fXkdeV16LXldeqIjsKbG9nRGVidWcoItep16LXldeqINek16LXmdec15XXqiDXp9eR15XXoteV16oiKTsKaG91cnNPZldvcmtEZWZhdWx0Vmlldz0nZG9udFNob3dEYXRlJzsKfSBlbHNlIHsKY3VyckRlZmF1bHREYXRlID0gJGxvY2F0aW9uLnNlYXJjaCgpLnN0YXJ0Owokc2NvcGUuZml4ZWRTY2hlZHVsZSA9IGZhbHNlOwovLyAkc2NvcGUuY2FsZW5kYXJUaXRsZUNlbnRlciA9ICLXqdei15XXqiDXpNei15nXnNeV16og16fXkdeV16LXldeqIjsKaG91cnNPZldvcmtEZWZhdWx0Vmlldz0nYWdlbmRhV2Vlayc7Cn0KCgokc2NvcGUudmlzaWJsZURhdGUgPSBbXTsKJHNjb3BlLmNhbGVuZGFyID0gJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnOwokc2NvcGUuc2VsZWN0ZWRFdmVudFR5cGUgPSBbXTsKCmdldEFsbEJ1c2luZXNzRXZlbnRUeXBlcygkaHR0cCwkc2NvcGUsJ2V2ZW50X3R5cGVzJyxnZXRBbGxCdXNpbmVzc0V2ZW50VHlwZXNfY2FsbGJhY2spOwoKZnVuY3Rpb24gZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzX2NhbGxiYWNrKCkKewokc2NvcGUuc2VsZWN0RXZlbnRUeXBlKCRzY29wZS5ldmVudF90eXBlc1swXSk7Cn0KJHNjb3BlLmJhY2tUb0NhbGVuZGFyID0gZnVuY3Rpb24oKSB7CnZpc2libGVEYXRlU3RhcnQgPSBuZXcgRGF0ZSh1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ2V0VmlldycpLnN0YXJ0KTsKZGF0ZVRvR29UbyA9IHZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSArICItIiArICgnMCcgKyAodmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpICsgMSkpLnNsaWNlKC0yKSArICItIiArICgnMCcgKyB2aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSkuc2xpY2UoLTIpOwokbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2NhbGVuZGFyJykuc2VhcmNoKHsKc3RhcnQ6IGRhdGVUb0dvVG8KfSk7Cn0KJHNjb3BlLnNlbGVjdEV2ZW50VHlwZSA9IGZ1bmN0aW9uKGV2ZW50VHlwZSkgewokc2NvcGUuc2VsZWN0ZWRFdmVudFR5cGUgPSBldmVudFR5cGU7CmxvZ0RlYnVnKCJzZWxlY3RlZCBFdmVudCBUeXBlID0gIiArICRzY29wZS5zZWxlY3RlZEV2ZW50VHlwZS5ldmVudF90eXBlX2lkICsgIiwgIiArICRzY29wZS5zZWxlY3RlZEV2ZW50VHlwZS5ldmVudF90eXBlX25hbWUpOwprdXplSXNDYWxlbmRhckRyYWdnYmxlID0gJHNjb3BlLnNlbGVjdGVkRXZlbnRUeXBlLmRpZmZfcmFuZ2U7Cn07Cgokc2NvcGUuY2hhbmdlRXZlbnRDb2xvciA9IGZ1bmN0aW9uKG5ld0NvbG9yKSB7CiRzY29wZS5ldmVudENvbG9yID0gbmV3Q29sb3I7CmFsbGxFdmVudHNBcnJheSA9IHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2NsaWVudEV2ZW50cycpOwpmb3IgKGkgaW4gYWxsbEV2ZW50c0FycmF5KSB7CmFsbGxFdmVudHNBcnJheVtpXS5jb2xvciA9ICIjIiArIG5ld0NvbG9yOwp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCd1cGRhdGVFdmVudCcsIGFsbGxFdmVudHNBcnJheVtpXSk7Cn0KfTsKCiRzY29wZS5ldmVudENsaWNrTW9kdWxlID0gZnVuY3Rpb24oc2VsZWN0ZWRFdmVudCwgc2l6ZSkgewpsb2dEZWJ1Zygic2VsZWN0ZWQgRXZlbnQgdGl0bGU9IiArIHNlbGVjdGVkRXZlbnQudGl0bGUpOwoKCnZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewphbmltYXRpb246IGZhbHNlLAp0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9saW1pdGF0aW9uX2RldGFpbHMuaHRtbCcsCmNvbnRyb2xsZXI6ICdldmVudERldGFpbHNIb3Vyc09mV29ya01vZGFsQ29udHJvbGxlcicsCnNpemU6IHNpemUsCnJlc29sdmU6IHsKc2VsZWN0ZWRFdmVudDogZnVuY3Rpb24oKSB7CnJldHVybiBzZWxlY3RlZEV2ZW50Owp9LApmaXhlZFNjaGVkdWxlOiBmdW5jdGlvbiAoKQp7CnJldHVybiAkc2NvcGUuZml4ZWRTY2hlZHVsZTsKfQp9Cn0pOwoKbW9kYWxJbnN0YW5jZS5yZXN1bHQudGhlbihmdW5jdGlvbihzZWxlY3RlZEl0ZW0pIHsKJHNjb3BlLnNlbGVjdGVkID0gc2VsZWN0ZWRJdGVtOwp9LCBmdW5jdGlvbigpIHsKbG9nRGVidWcoJ01vZGFsIGRpc21pc3NlZCBhdDogJyArIG5ldyBEYXRlKCkpOwp9KTsKfTsKCgp2YXIgZGF0ZSA9IG5ldyBEYXRlKCk7CnZhciBkID0gZGF0ZS5nZXREYXRlKCk7CnZhciBtID0gZGF0ZS5nZXRNb250aCgpOwp2YXIgeSA9IGRhdGUuZ2V0RnVsbFllYXIoKTsKCgpmdW5jdGlvbiBnZXRUaW1lU3RhbXAobm93KSB7CnJldHVybiAoKG5vdy5nZXRNb250aCgpICsgMSkgKyAnLycgKyAobm93LmdldERhdGUoKSkgKyAnLycgKyBub3cuZ2V0RnVsbFllYXIoKSArICIgIiArIG5vdy5nZXRIb3VycygpICsgJzonICsgKChub3cuZ2V0TWludXRlcygpIDwgMTApID8gKCIwIiArIG5vdy5nZXRNaW51dGVzKCkpIDogKG5vdy5nZXRNaW51dGVzKCkpKSArICc6JyArICgobm93LmdldFNlY29uZHMoKSA8IDEwKSA/ICgiMCIgKyBub3cKLmdldFNlY29uZHMoKSkgOiAobm93LmdldFNlY29uZHMoKSkpKTsKfQoKCi8qIENoYW5nZSBWaWV3ICovCiRzY29wZS5jaGFuZ2VWaWV3ID0gZnVuY3Rpb24odmlldywgY2FsZW5kYXIpIHsKbG9nRGVidWcoImNoYW5nZSB2aWV3ICIgKyB2aWV3KTsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignY2hhbmdlVmlldycsIHZpZXcpOwp9OwovKiBDaGFuZ2UgVmlldyAqLwoKJHNjb3BlLnJlbmRlckNhbGVuZGVyID0gZnVuY3Rpb24oY2FsZW5kYXIpIHsKJHRpbWVvdXQoZnVuY3Rpb24oKSB7CmlmICh1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0pIHsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVuZGVyJyk7Cn0KfSk7Cn07Cgokc2NvcGUuY2hhbmdlU2VsZWN0YWJsZSA9IGZ1bmN0aW9uKCkgewprdXplSXNDYWxlbmRhckRyYWdnYmxlID0gIWt1emVJc0NhbGVuZGFyRHJhZ2dibGU7CmNhbGVuZGFyID0gJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnOwovLyB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3JykuY2FsZW5kYXIub3B0aW9ucy5zZWxlY3RhYmxlID0gZmFsc2U7CnZpZXcgPSB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdvcHRpb24nLCAnc2VsZWN0YWJsZScsIGZhbHNlKTsKLy8gdmlldy5jYWxlbmRhci5vcHRpb25zLnNlbGVjdGFibGUgPSBmYWxzZTsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVuZGVyJyk7Cgp9Ci8qIGNvbmZpZyBvYmplY3QgKi8KCiRzY29wZS5jYWxlbmRhcl9ob3Vyc19vZl93b3JrX2NvbmZpZyA9IHsKY2FsZW5kYXI6IHsKaGVpZ2h0OiAnYXV0bycsCmVkaXRhYmxlOiB0cnVlLAovLyBoZWFkZXI6IHsKLy8gICAgIGxlZnQ6ICcnLAovLyAgICAgY2VudGVyOiAnJywKLy8gICAgIHJpZ2h0OiAnJwovLyB9LApoZWFkZXI6ICcnLAovLyBoZWFkZXI6IHsKLy8gICAgIGxlZnQ6ICd0aXRsZScsCi8vICAgICBjZW50ZXI6ICcnLAovLyAgICAgcmlnaHQ6ICd0b2RheSBwcmV2LG5leHQnCi8vIH0sCi8vIGRlZmF1bHRWaWV3OiAnYWdlbmRhV2VlaycsCnZpZXdzOiB7CmRvbnRTaG93RGF0ZTogewp0eXBlOiAnYWdlbmRhV2VlaycsCmR1cmF0aW9uOiB7CmRheXM6IDcKfSwKdGl0bGU6ICdBcGVydHVyYScsCmNvbHVtbkZvcm1hdDogJ2RkZGQnIC8vIEZvcm1hdCB0aGUgZGF5IHRvIG9ubHkgc2hvdyBsaWtlICdNb25kYXknCi8vIGhpZGRlbkRheXM6IFswLCA2XSAvLyBIaWRlIFN1bmRheSBhbmQgU2F0dXJkYXk/Cn0sCmRvU2hvd0RhdGU6IHsKdHlwZTogJ2FnZW5kYVdlZWsnLApkdXJhdGlvbjogewpkYXlzOiA3Cn0sCnRpdGxlOiAnQXBlcnR1cmEnLAoKLy8gaGlkZGVuRGF5czogWzAsIDZdIC8vIEhpZGUgU3VuZGF5IGFuZCBTYXR1cmRheT8KfQp9LApldmVudERyb3A6IGZ1bmN0aW9uKGV2ZW50LCBkYXlEZWx0YSwgbWludXRlRGVsdGEsIGFsbERheSwgcmV2ZXJ0RnVuYywgdWlDYWxlbmRhckNvbmZpZykgewpsb2dEZWJ1ZygiZXZlbnRkcm9wIiArIGV2ZW50LnRpdGxlICsgIigiICsgZXZlbnQuaWQgKyAiKSBtb3ZlZCAiICsgbWludXRlRGVsdGEgKyAiIG1pbnV0ZXMiKTsKbG9nRGVidWcoIm9sZCBzdGFydD0iICsgZXZlbnQuc3RhcnQgKyAiLCBvbGQgZW5kPSIgKyBldmVudC5lbmQpOwokc2NvcGUudXBkYXRlTGltaXRhdGlvbkRhdGFiYXNlKGV2ZW50LnN0YXJ0LCBldmVudC5lbmQsIGV2ZW50LmlkLCBldmVudC50ZW1wX2xpbWl0X2lkLCBldmVudCk7Cn0sCmV2ZW50UmVzaXplOiBmdW5jdGlvbihldmVudCwgZGVsdGEsIHJldmVydEZ1bmMpIHsKbG9nRGVidWcoImV2ZW50cmVzaXplLCBldmVudC5lbmQ9IiArIGV2ZW50LmVuZCk7CiRzY29wZS51cGRhdGVMaW1pdGF0aW9uRGF0YWJhc2UoZXZlbnQuc3RhcnQsIGV2ZW50LmVuZCwgZXZlbnQuaWQsIGV2ZW50LnRlbXBfbGltaXRfaWQsIGV2ZW50KTsKfSwKZGVmYXVsdFZpZXc6IGhvdXJzT2ZXb3JrRGVmYXVsdFZpZXcsCmV2ZW50Q2xpY2s6IGZ1bmN0aW9uKGNhbEV2ZW50LCBqc0V2ZW50LCB2aWV3KSB7CmxvZ0RlYnVnKCJldmVudCBjbGlja2VkICIgKyBjYWxFdmVudC50aXRsZSArICIoaWQ9IiArIGNhbEV2ZW50LmlkICsgIiwgZGF5X2xpbWl0X2lkPSIgKyBjYWxFdmVudC5kYXlfbGltaXRfaWQgKyAiLCB0ZW1wX2xpbWl0X2lkPSIgKyBjYWxFdmVudC50ZW1wX2xpbWl0X2lkICsgIiwgbGltaXRfaWQ9IiArIGNhbEV2ZW50LmxpbWl0X2lkICsgIikgc3RhcnQ9IiArIGNhbEV2ZW50LnN0YXJ0ICsgIiwgZW5kPSIgKyBjYWxFdmVudC5lbmQpOwokc2NvcGUuZXZlbnRDbGlja01vZHVsZShjYWxFdmVudCk7Ci8vIGNoYW5nZSB0aGUgYm9yZGVyIGNvbG9yIGp1c3QgZm9yIGZ1bgovLyAkKHRoaXMpLmNzcygnYm9yZGVyLWNvbG9yJywgJ3JlZCcpOwoKfSwKZXZlbnRSZW5kZXI6IGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KQp7CmNvbnNvbGUubG9nKGV2ZW50KTsKZWxlbWVudC5maW5kKCcuZmMtdGl0bGUnKS5wcmVwZW5kKGV2ZW50LmxvY2F0aW9uX25hbWUrIiAvIDxici8+Iik7CmVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZChldmVudC5pbnN0cnVjdG9yX25hbWUrIiAvIDxici8+Iik7Ci8vIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZCgiIitldmVudC5ldmVudFVzZXJzWzBdLmJ1c2VyX2ZpcnN0X25hbWUrIiAiK2V2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfbGFzdF9uYW1lKyIgKCIpOwoKLy8gY29uc29sZS5sb2coInJlbmRlciBsaW1pdGF0aW9uICIrSlNPTi5zdHJpbmdpZnkoZXZlbnQpKTsKLy8gaWYgKGV2ZW50LmlzX2NsYXNzPT0xKQovLyB7Ci8vICAgLy8gaWYgY2xhc3MgYWRkaW5nIG51bWJlciBvZiBwYXJ0aWNpcGFudHMKLy8gICBpZiAoZXZlbnQubm9fb2Zfd2FpdGluZ191c2Vycz4wKQovLyAgIHsKLy8gICAgIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZChldmVudC5ub19vZl91c2VycysiLyIrZXZlbnQubWF4X3BhcnRpY2lwYW50cysgIiAoIitldmVudC5ub19vZl93YWl0aW5nX3VzZXJzKyIpIisiIC0gIik7Ci8vICAgfQovLyAgIGVsc2UKLy8gICB7Ci8vICAgICBlbGVtZW50LmZpbmQoJy5mYy10aXRsZScpLnByZXBlbmQoZXZlbnQubm9fb2ZfdXNlcnMrIi8iK2V2ZW50Lm1heF9wYXJ0aWNpcGFudHMrIiAtICIpOwovLyAgIH0KLy8gfQovLyBlbHNlCi8vIHsKLy8gICAvLyBpZiBub3QgY2xhc3MgLSB3cml0aW5nIHRoZSBlbmR1c2VyIG5hbWUKLy8gICBpZiAoZXZlbnQuZHVyYXRpb25fZXZlbnQhPTApIC8vIGFsc28gaWYgbm90IGhvdXJzIG9mIHdvcmsKLy8gICB7Ci8vICAgICAvLyBlbGVtZW50LmZpbmQoJy5mYy10aXRsZScpLmFwcGVuZCgiICgiK2V2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfZmlyc3RfbmFtZSsiICIrZXZlbnQuZXZlbnRVc2Vyc1swXS5idXNlcl9sYXN0X25hbWUrIikiKTsKLy8gICAgIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZCgiIitldmVudC5ldmVudFVzZXJzWzBdLmJ1c2VyX2ZpcnN0X25hbWUrIiAiK2V2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfbGFzdF9uYW1lKyIgKCIpOwovLyAgICAgZWxlbWVudC5maW5kKCcuZmMtdGl0bGUnKS5hcHBlbmQoIikiKTsKLy8gICB9Ci8vICAgLy8gbG9nRGVidWcoImhlcmU0Iik7Ci8vIH0KLy8gaWYgKGV2ZW50LmlzX3JlcGVhdGluZyA9PSAxKSB7Ci8vICAgICBlbGVtZW50LmZpbmQoIi5mYy10aXRsZSIpLnByZXBlbmQoIiZuYnNwOzxpIGNsYXNzPSdmYSBmYS1yZXBlYXQnPjwvaT4mbmJzcDsiKTsKLy8gICAgIC8vICBlbGVtZW50LmZpbmQoIi5mYy10aXRsZSIpLmFwcGVuZCgiJm5ic3A7PGltZyBzcmM9Jy9wdWJsaWMvaW1hZ2VzL3JlY3VycmluZy1pY29uLnBuZycgd2lkdGg9JzEwcHgnIGhlaWdodD0nMTBweCcvPiIpOwovLyB9Cn0sCm1pblRpbWU6ICRnQ2FsZW5kYXJEaXNwbGF5TWluVGltZSwKbWF4VGltZTogJGdDYWxlbmRhckRpc3BsYXlNYXhUaW1lLApzZWxlY3RhYmxlOiB0cnVlLApzZWxlY3RIZWxwZXI6IGZhbHNlLAp0aW1lem9uZTogZmFsc2UsCmlzUlRMOiB0cnVlLApsYW5nOiAiaGUiLApzZWxlY3RDb25zdHJhaW50OiB7CnN0YXJ0OiAnMDA6MDEnLAplbmQ6ICcyMzo1OScsCn0sCmRlZmF1bHREYXRlOiBtb21lbnQoY3VyckRlZmF1bHREYXRlKSwKYWxsRGF5U2xvdDogZmFsc2UsCmxvYWRpbmc6IGZ1bmN0aW9uKGJvb2wpIHsKaWYgKGJvb2wpIHsKICAgICAgICAgICAgICAgICAgICBsb2dEZWJ1ZygnbG9hZGluZyBjYWxlbmRhcjIgJyArICRzY29wZS5jYWxlbmRhcik7CgovLyAkKCcjbG9hZGluZycpLnNob3coKTsKfSBlbHNlIHsKLy8gJCgnI2xvYWRpbmcnKS5oaWRlKCk7CmxvZ0RlYnVnKCdmaW5pc2hlZCBsb2FkaW5nIGNhbGVuZGFyICcgKyAkc2NvcGUuY2FsZW5kYXIpOwppZiAoISRzY29wZS5maXhlZFNjaGVkdWxlKSB7CiRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlKCk7Cn0KLy8gJHNjb3BlLmJhY2tUb0ZpeGVkKCk7Cn0KfSwKc2VsZWN0OiBmdW5jdGlvbihzdGFydCwgZW5kLCBhbGxEYXkpIHsKLy8gdGhpcyBpcyBjYWxsZWQgd2hlbiBjcmVhdGluZyBhIG5ldyBibG9jawokc2NvcGUuY3JlYXRlTGltaXRhdGlvbkJsb2NrKHN0YXJ0LCBlbmQpOwp9Cn0KfTsKCi8vIGNyZWF0ZSBsaW1pdGF0aW9uIGJsb2NrCiRzY29wZS5jcmVhdGVMaW1pdGF0aW9uQmxvY2sgPSBmdW5jdGlvbihzdGFydCwgZW5kKQp7CmxvZ0RlYnVnKCJmdW5jdGlvbjogY3JlYXRlTGltaXRhdGlvbkJsb2NrIik7CnZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewphbmltYXRpb246IGZhbHNlLAp0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9saW1pdGF0aW9uX2NyZWF0ZS5waHAnLApzaXplOiAneHMnLApjb250cm9sbGVyOiAnYnVzaW5lc3NfbW9kYWxfbGltaXRhdGlvbl9jcmVhdGUnLApyZXNvbHZlOiB7CnN0YXJ0OiBmdW5jdGlvbigpCnsKcmV0dXJuIHN0YXJ0Owp9LAplbmQ6IGZ1bmN0aW9uKCkKewpyZXR1cm4gZW5kOwp9LApmaXhlZFNjaGVkdWxlOiBmdW5jdGlvbiAoKQp7CnJldHVybiAkc2NvcGUuZml4ZWRTY2hlZHVsZTsKfQp9Cn0pOwp9CiRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlID0gZnVuY3Rpb24oKSB7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3Jyk7Cgp2aXNpYmxlRGF0ZVN0YXJ0ID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5zdGFydCk7CnZpc2libGVEYXRlRW5kID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5lbmQpOwoKJHNjb3BlLmNhbGVuZGFyVGl0bGVDZW50ZXIgPSB2aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSArICIgIiArIG1vbnRoTmFtZXNbdmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpXSArCiIg4oCUICIgKyB2aXNpYmxlRGF0ZUVuZC5nZXREYXRlKCkgKyAiICIgKyBtb250aE5hbWVzW3Zpc2libGVEYXRlRW5kLmdldE1vbnRoKCldICsKIiAiICsgdmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpOwp9OwovKiBldmVudCBzb3VyY2VzIGFycmF5Ki8KJHNjb3BlLmV2ZW50U291cmNlcyA9IFt7CnVybDogJy9hcGkvYWRtaW4vY2FsZW5kYXIvbGltaXRhdGlvbnMvcGVyZGF5L2dldHBvc3QnLAp0eXBlOiAnUE9TVCcKfV07CgovLyAkc2NvcGUuZ2V0RXZlbnRzID0gZnVuY3Rpb24oKSB7Ci8vICAgICBjYWxlbmRhciA9ICdjYWxlbmRhcl9ob3Vyc19vZl93b3JrJzsKLy8gICAgIGFsbGxFdmVudHNBcnJheSA9IHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2NsaWVudEV2ZW50cycpOwovLyAgICAgZm9yIChpIGluIGFsbGxFdmVudHNBcnJheSkgewovLyAgICAgICAgIGxvZ0RlYnVnKGFsbGxFdmVudHNBcnJheVtpXSk7Ci8vICAgICB9Ci8vCi8vIH0KCiRzY29wZS5nb3RvVG9kYXkgPSBmdW5jdGlvbigpIHsKJHNjb3BlLmdvdG9EYXRlKG5ldyBEYXRlKCkpOwp9CiRzY29wZS5nb3RvTmV4dCA9IGZ1bmN0aW9uKCkgewp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignbmV4dCcpOwp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVtb3ZlRXZlbnRzJyk7CiRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlKCk7Cn0KJHNjb3BlLmdvdG9QcmV2ID0gZnVuY3Rpb24oKSB7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZW1vdmVFdmVudHMnKTsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3ByZXYnKTsKJHNjb3BlLnVwZGF0ZUNhbGVuZGFyQ2VudGVyVGl0bGUoKTsKfQokc2NvcGUuZ290b0RhdGUgPSBmdW5jdGlvbihuZXdkYXRlKSB7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnb3RvRGF0ZScsIG5ld2RhdGUpOwp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignY2hhbmdlVmlldycsICdhZ2VuZGFXZWVrJyk7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZW1vdmVFdmVudHMnKTsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKCiRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlKCk7CiRzY29wZS5maXhlZFNjaGVkdWxlID0gZmFsc2U7Cn0KCiRzY29wZS5iYWNrVG9GaXhlZCA9IGZ1bmN0aW9uKCkgewokc2NvcGUuZml4ZWRTY2hlZHVsZSA9IHRydWU7CiRzY29wZS5jYWxlbmRhclRpdGxlQ2VudGVyID0gItep16LXldeqINek16LXmdec15XXqiDXp9eR15XXoteV16oiOwp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignY2hhbmdlVmlldycsICdkb250U2hvd0RhdGUnKTsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dvdG9EYXRlJywgbW9tZW50KCRnSG91cjBkYXRlKSk7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZW1vdmVFdmVudHMnKTsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKCn0KCi8vICRzY29wZS5kZWxldGVBbGxFdmVudHMgPSBmdW5jdGlvbigpIHsKLy8gICAgIGNhbGVuZGFyID0gJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnOwovLyAgICAgYWxsbEV2ZW50c0FycmF5ID0gdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignY2xpZW50RXZlbnRzJyk7Ci8vICAgICBmb3IgKGkgaW4gYWxsbEV2ZW50c0FycmF5KSB7Ci8vICAgICAgICAgbG9nRGVidWcoYWxsbEV2ZW50c0FycmF5W2ldKTsKLy8gICAgICAgICAkc2NvcGUuZGVsZXRlQ2FsZW5kYXJKU0V2ZW50KGNhbGVuZGFyLCBhbGxsRXZlbnRzQXJyYXlbaV0uaWQpOwovLyAgICAgICAgICRzY29wZS5kZWxldGVDYWxlbmRhckRCRXZlbnQoYWxsbEV2ZW50c0FycmF5W2ldLmlkKTsKLy8gICAgIH0KLy8KLy8gfQokc2NvcGUudXBkYXRlTGltaXRhdGlvbkRhdGFiYXNlID0gZnVuY3Rpb24oc3RhcnRfcGFyYW0sIGVuZF9wYXJhbSwgZXZlbnRfaWQsIHRlbXBfbGltaXRfaWQsIHRoZWV2ZW50KSB7Cgpsb2dEZWJ1ZygidXBkYXRlTGltaXRhdGlvbkRhdGFiYXNlIHN0YXJ0PSIgKyBzdGFydF9wYXJhbSArICIsIGVuZD0iICsgZW5kX3BhcmFtICsgIixldmVudF9pZD0iICsgZXZlbnRfaWQpOwoKZnVuY3Rpb24gdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uX2ZhaWx1cmUoKQp7CmNhbGVuZGFyID0gImNhbGVuZGFyX2hvdXJzX29mX3dvcmsiOwp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZWZldGNoRXZlbnRzJyk7Cn0KLy8gaWYgdGhlIGV2ZW50IHRoYXQgaXMgZ2V0dGluZyB1cGRhdGVkIGlzIGFuIGV2ZW50IGZyb20gMTk3MCAobm90IHBlcmRheSkKLy8gdGhlbiB3ZSBhZGQgYSBuZXcgcGVyZGF5IGxpbWl0YXRpb24gd2l0aCBsaW1pdF9pZCBvZiB0aGUgMTk3MCBsaW1pdGF0aW9ucyAtIHdpdGggdGhlIG5ldyB0aW1lcy4KCi8vIG90aGVyd2lzZSB3ZSBqdXN0IHVwZGF0ZSB0aGUgcGVyZGF5IGxpbWl0YXRpb24KCmlmICgkc2NvcGUuZml4ZWRTY2hlZHVsZSkgLy8gZml4ZWQgc2NoZWR1bGUgdnMgc3BlY2lmaWMgd2VlZC9kYXkgbGltaXRhdGlvbgp7CnRoZWRhdGEgPSB7CnN0YXJ0X2RhdGU6IHN0YXJ0X3BhcmFtLAplbmRfZGF0ZTogZW5kX3BhcmFtLAp0ZW1wX2xpbWl0X2lkOiB0ZW1wX2xpbWl0X2lkLApsaW1pdF9pZDogZXZlbnRfaWQKfTsKCnVwZGF0ZUNhbGVuZGFyTGltaXRhdGlvbigkaHR0cCwkc2NvcGUsdGhlZGF0YSxldmVudF9pZCwgbnVsbCwgdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uX2ZhaWx1cmUpOwp9CmVsc2UgLy8gbm90IGZpeGVkIHNjaGVkdWxlIC0gZGFpbHkvd2Vla2x5IGxpbWl0YXRpb25zCnsKaWYgKCh0aGVldmVudC5saW1pdF9pZCAhPSBudWxsKSAmICh0aGVldmVudC5kYXlfbGltaXRfaWQgPT0gLTEpKSAvLyBldmVudCBsaW1pdGF0aW9uIGhhcyBsaW1pdF9pZCBzbyBpdHMgYW4gMTk3MCBldmVudAovLyBuZWVkIHRvIGFkZCBhIG5ldyBwZXJkYXkgbGltaXRhdGlvbiB0aGF0IHBvaW50IChsaW1pdF9pZCkgdG8gdGhlIG9sZCAxOTcwIGV2ZW50IHRvIGNhbmNlbCBpdAp7CnRlbXBfbGltaXRfaWQgPSBjYWxjX3RlbXBfbGltaXRfaWQoKTsKdGhlZXZlbnQudGVtcF9saW1pdF9pZCA9IHRlbXBfbGltaXRfaWQ7CnRoZWV2ZW50LmRheV9saW1pdF9pZCA9IHRlbXBfbGltaXRfaWQ7Ci8vIHRoZSBtb3ZlZCBldmVudCBpbiB0aGUgY2FsZW5kYXIgbm93IGhhcyBkYXlfbGltaXRfaWQgYW5kIHRlbXBfbGltaXRfaWQKLy8gaWYgaXRzIGxvYWRlZCBmcm9tIHRoZSBkYiwgaXQgd2lsbCBvbmx5IGhhdmUgZGF5X2xpbWl0X2lkIChhbmQgbm90IHRoZSB0ZW1wIG9uZSkKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnXS5mdWxsQ2FsZW5kYXIoJ3VwZGF0ZUV2ZW50JywgdGhlZXZlbnQpOwoKdGhlZGF0YSA9IHsKc3RhcnRfZGF0ZTogc3RhcnRfcGFyYW0sCmVuZF9kYXRlOiBlbmRfcGFyYW0sCmNvbG9yOiB0aGVldmVudC5jb2xvciwKdGVtcF9saW1pdF9pZDogdGVtcF9saW1pdF9pZCwKZXZlbnRfdHlwZV9pZDogdGhlZXZlbnQuZXZlbnRfdHlwZV9pZCwKZXZlbnRfdHlwZXM6IHRoZWV2ZW50LmV2ZW50X3R5cGVzLApsb2NhdGlvbl9pZDogdGhlZXZlbnQubG9jYXRpb25faWQsCmVtcF9pZDogdGhlZXZlbnQuZW1wX2lkLApsaW1pdF9pZDogdGhlZXZlbnQuaWQsCnRpdGxlOiB0aGVldmVudC50aXRsZQp9OwpjcmVhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXkoJGh0dHAsJHNjb3BlLHRoZWRhdGEsbnVsbCwgdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uX2ZhaWx1cmUpOwoKfQplbHNlIC8vIGV2ZW50IGxpbWl0YXRpb24gdG8gbW92ZS91cGRhdGUgaGFzIG5vIGxpbWl0X2lkIC0gc28gdGhpcyBpcyBuZXcgcGVyZGF5IGV2ZW50IC0gd2UganVzdCB1cGRhdGUgaXQKewp0aGVkYXRhPSB7CnN0YXJ0X2RhdGU6IHN0YXJ0X3BhcmFtLAplbmRfZGF0ZTogZW5kX3BhcmFtLAp0ZW1wX2RheV9saW1pdF9pZDogdGhlZXZlbnQudGVtcF9saW1pdF9pZCwKbG9jYXRpb25faWQ6IHRoZWV2ZW50LmxvY2F0aW9uX2lkLApkYXlfbGltaXRfaWQ6IHRoZWV2ZW50LmRheV9saW1pdF9pZAp9Owp1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXkoJGh0dHAsJHNjb3BlLHRoZWRhdGEsbnVsbCwgdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uX2ZhaWx1cmUpOwp9Cn0KfTsKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ0V2ZW50Q2xhc3NQYWdlQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHRpbWVvdXQsICRodHRwLCAkcm9vdFNjb3BlLCAkcm91dGVQYXJhbXMsICRsb2NhdGlvbiwgJHJvdXRlLCBzaGFyZWREYXRhLCAkdWliTW9kYWwpCnsKZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkKTsKZ2V0QWxsQ2xpZW50cygkaHR0cCwkc2NvcGUsJ2V2ZW50VHlwZVVzZXJzJyk7CmdldEJ1c2luZXNzTG9jYXRpb25zKCRodHRwLCRzY29wZSwnYnVzaW5lc3NfbG9jYXRpb25zJyk7CmdldEFsbEluc3RydWN0b3JzKCRodHRwLCRzY29wZSwnaW5zdHJ1Y3RvcnMnKTsKCiRzY29wZS51cGRhdGVFdmVudFRpdGxlID0gZnVuY3Rpb24obmV3VmFsdWUsY3VycmVudEV2ZW50KQp7Cm5ld190aXRsZT1uZXdWYWx1ZTsKc2V0RXZlbnRUaXRsZSgkaHR0cCwkc2NvcGUsY3VycmVudEV2ZW50LmV2ZW50X2lkLCBuZXdfdGl0bGUsIHVwZGF0ZUV2ZW50X2NhbGxiYWNrLCB1cGRhdGVFdmVudF9jYWxsYmFjayk7CgpmdW5jdGlvbiB1cGRhdGVFdmVudF9jYWxsYmFjaygpCnsKZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCk7Cn0KCn07Cgokc2NvcGUudXBkYXRlRXZlbnRNYXhQYXJ0aWNpcGFudHMgPSBmdW5jdGlvbihuZXdWYWx1ZSxjdXJyZW50RXZlbnQpCnsKbmV3X21heF9wYXJ0aWNpcGFudHM9bmV3VmFsdWU7CmlmICggbmV3X21heF9wYXJ0aWNpcGFudHMgPCBjdXJyZW50RXZlbnQubm9fb2ZfdXNlcnMgKXsKc2V0RXZlbnRNYXhQYXJ0aWNpcGFudHMoJGh0dHAsJHNjb3BlLGN1cnJlbnRFdmVudC5ldmVudF9pZCwgY3VycmVudEV2ZW50Lm5vX29mX3VzZXJzLCBjdXJyZW50RXZlbnQubm9fb2ZfdXNlcnMsIHVwZGF0ZUV2ZW50X2NhbGxiYWNrLCB1cGRhdGVFdmVudF9jYWxsYmFjayk7Cn0gZWxzZSB7CnNldEV2ZW50TWF4UGFydGljaXBhbnRzKCRodHRwLCRzY29wZSxjdXJyZW50RXZlbnQuZXZlbnRfaWQsIG5ld19tYXhfcGFydGljaXBhbnRzLCBjdXJyZW50RXZlbnQubm9fb2ZfdXNlcnMsIHVwZGF0ZUV2ZW50X2NhbGxiYWNrLCB1cGRhdGVFdmVudF9jYWxsYmFjayk7Cn0KCmZ1bmN0aW9uIHVwZGF0ZUV2ZW50X2NhbGxiYWNrKCkKewpnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkKTsKfQoKfTsKCiRzY29wZS51cGRhdGVVc2VyRXZlbnRQcmljZSA9IGZ1bmN0aW9uKG5ld3ZhbHVlLCB0aGVldmVudCwgZXVzZXIpCnsKbmV3X3ByaWNlPW5ld3ZhbHVlOwpzZXRDbGllbnRFdmVudFByaWNlKCRodHRwLCRzY29wZSxldXNlci5idXNpbmVzc191c2VyX2lkLHRoZWV2ZW50LmV2ZW50X2lkLCBuZXdfcHJpY2Usc2V0Q2xpZW50RXZlbnRQcmljZV9jYWxsYmFjaywgc2V0Q2xpZW50RXZlbnRQcmljZV9jYWxsYmFjayk7CmZ1bmN0aW9uIHNldENsaWVudEV2ZW50UHJpY2VfY2FsbGJhY2soKQp7CmdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQpOwp9Cn07Cgokc2NvcGUudXBkYXRlTG9jYXRpb25FdmVudCA9IGZ1bmN0aW9uKCkKewpjb25zb2xlLmxvZygiZnVuY3Rpb246IHVwZGF0ZUxvY2F0aW9uRXZlbnQiKTsKdXBkYXRlRXZlbnRMb2NhdGlvbigkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLCRzY29wZS5jdXJyZW50RXZlbnQubG9jYXRpb25faWQsdXBkYXRlRXZlbnRMb2NhdGlvbl9jYWxsYmFjaywgdXBkYXRlRXZlbnRMb2NhdGlvbl9jYWxsYmFjayk7CiRzY29wZS51cGRhdGVMb2NhdGlvbkFsZXJ0TWVzc2FnZT0i157XoteT15vXnyDXodeY15jXldehLi4uIjsKZnVuY3Rpb24gdXBkYXRlRXZlbnRMb2NhdGlvbl9jYWxsYmFjaygpCnsKJHNjb3BlLnVwZGF0ZUxvY2F0aW9uQWxlcnRNZXNzYWdlPSLXoteV15PXm9efINeR15TXptec15fXlCEiOwokdGltZW91dChmdW5jdGlvbigpCnsKJHNjb3BlLnVwZGF0ZUxvY2F0aW9uQWxlcnRNZXNzYWdlPW51bGw7Cn0sIDE1MDApOwp9Cn07Cgokc2NvcGUudXBkYXRlSW5zdHJ1Y3RvckNsYXNzRXZlbnQgPSBmdW5jdGlvbigpCnsKY29uc29sZS5sb2coImZ1bmN0aW9uOiB1cGRhdGVJbnN0cnVjdG9yQ2xhc3NFdmVudCIpOwp1cGRhdGVFdmVudEluc3RydWN0b3IoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCwkc2NvcGUuY3VycmVudEV2ZW50Lmluc3RydWN0b3JfaWQsdXBkYXRlRXZlbnRJbnN0cnVjdG9yX2NhbGxiYWNrLCB1cGRhdGVFdmVudEluc3RydWN0b3JfY2FsbGJhY2spOwokc2NvcGUudXBkYXRlSW5zdHJ1Y3RvckFsZXJ0TWVzc2FnZT0i157XoteT15vXnyDXodeY15jXldehLi4uIjsKZnVuY3Rpb24gdXBkYXRlRXZlbnRJbnN0cnVjdG9yX2NhbGxiYWNrKCkKewokc2NvcGUudXBkYXRlSW5zdHJ1Y3RvckFsZXJ0TWVzc2FnZT0i16LXldeT15vXnyDXkdeU16bXnNeX15QhIjsKJHRpbWVvdXQoZnVuY3Rpb24oKQp7CiRzY29wZS51cGRhdGVJbnN0cnVjdG9yQWxlcnRNZXNzYWdlPW51bGw7Cn0sIDE1MDApOwp9Cn0KCgokc2NvcGUuYWN0aXZhdGVFdmVudENsYXNzID0gZnVuY3Rpb24oKQp7CnsKbG9nRGVidWcoInJlb3BlbkV2ZW50Iik7CnJlb3BlbkV2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkLCRzY29wZS5zZWxlY3RlZEV2ZW50LGFmdGVyUmVvcGVuRXZlbnQsYWZ0ZXJSZW9wZW5FdmVudCk7CmZ1bmN0aW9uIGFmdGVyUmVvcGVuRXZlbnQoKQp7CmdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQpOwp9Owp9Cn0KCi8vIGNsb3NlIGV2ZW50IGNsYXNzCiRzY29wZS5jbG9zZUV2ZW50Q2xhc3MgPSBmdW5jdGlvbigpIHsKICAgICAgbG9nRGVidWcoImNsb3NlRXZlbnRDbGFzcyIpOwoKdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CmFuaW1hdGlvbjogZmFsc2UsCnRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2V2ZW50X2NsYXNzX2Nsb3NlLnBocCcsCnNpemU6ICd4cycsCmNvbnRyb2xsZXI6ICdjbGFzc0Nsb3NlTW9kYWxDb250cm9sbGVyJywKcmVzb2x2ZTogewpldmVudF9pZDogZnVuY3Rpb24oKSB7CnJldHVybiAkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkOwp9Cn0KfSk7Cn07CgovLyBkZWxldGUgcmVwZWF0aW5nL2NsYXNzIGV2ZW50CiRzY29wZS5kZWxldGVDbGFzc0V2ZW50ID0gZnVuY3Rpb24oKQp7CmlmICgkc2NvcGUuY3VycmVudEV2ZW50LmlzX3JlcGVhdGluZz09MCkKewpsb2dEZWJ1ZygiY2xhc3MgZXZlbnQgbm90IHJlcGVhdGluZyIpOwokc2NvcGUuZGVsZXRlQ2xhc3NFdmVudFNpbmdsZSgpOwp9CmVsc2UKewpsb2dEZWJ1ZygiY2xhc3MgZXZlbnQgaXMgcmVwZWF0aW5nIik7CnZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewphbmltYXRpb246IGZhbHNlLAp0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9yZXBlYXRpbmdfZXZlbnRfZGVsZXRlX2FsbC5waHAnLApzaXplOiAneHMnLApjb250cm9sbGVyOiAnY2xhc3NEZWxldGVBbGxNb2RhbENvbnRyb2xsZXInLApyZXNvbHZlOiB7CmN1cnJlbnRFdmVudDogZnVuY3Rpb24oKSB7CnJldHVybiAkc2NvcGUuY3VycmVudEV2ZW50Owp9Cn0KfSk7Cn0KfTsKCiRzY29wZS5kZWxldGVDbGFzc0V2ZW50U2luZ2xlPWZ1bmN0aW9uICgpIC8vIGRlbGV0ZSBvbmx5IG9uZS9jdXJyZW50IGNsYXNzIGV2ZWh0CnsKY2FuY2VsQ2xhc3NFdmVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCxjYW5jZWxDbGFzc0V2ZW50X2NhbGxiYWNrLCBjYW5jZWxDbGFzc0V2ZW50X2NhbGxiYWNrKTsKZnVuY3Rpb24gY2FuY2VsQ2xhc3NFdmVudF9jYWxsYmFjaygpCnsKZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCk7Cn0KfQoKJHNjb3BlLiRvbigicmVsb2FkRXZlbnQiLGZ1bmN0aW9uKGUsYSl7Ci8vIFBvc3QgeW91ciBjb2RlCmxvZ0RlYnVnKCJicm9hZGNhc3RlZCAtIHJlbG9hZGluZyBldmVudCAiK2EuZXZlbnRfaWQpOwpnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkcm91dGVQYXJhbXMuZXZlbnRfaWQpOwp9KTsKCi8vIHJlbW92ZSBlbmQgdXNlciBmcm9tIGV2ZW50CiRzY29wZS5ldmVudFJlbW92ZUVuZFVzZXIgPSBmdW5jdGlvbihlbmR1c2VyX2lkKQp7CmNvbnNvbGUubG9nKCJldmVudFJlbW92ZUVuZFVzZXIiKTsKcmVtb3ZlRW5kVXNlckZyb21FdmVudCgkaHR0cCwkc2NvcGUsZW5kdXNlcl9pZCwkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkLHJlbW92ZUVuZFVzZXJGcm9tRXZlbnRfZmluaXNoLCByZW1vdmVFbmRVc2VyRnJvbUV2ZW50X2ZpbmlzaCk7CmZ1bmN0aW9uIHJlbW92ZUVuZFVzZXJGcm9tRXZlbnRfZmluaXNoKCkKewpnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkcm91dGVQYXJhbXMuZXZlbnRfaWQpOwp9Cn07Cgokc2NvcGUuZXZlbnRDbGllbnRTZWxlY3RlZCA9IGZ1bmN0aW9uKHNlbGVjdGVkKSB7CmlmIChzZWxlY3RlZCkgewovLyBhbGVydChKU09OLnN0cmluZ2lmeSggc2VsZWN0ZWQsIG51bGwsIDIgKSk7CmxvZ0RlYnVnKCdldmVudENsaWVudFNlbGVjdGVkMiB5ZXMgc2VsZWN0ZWQgJyArIHNlbGVjdGVkLm9yaWdpbmFsT2JqZWN0LmZpcnN0X25hbWUpOwokc2NvcGUuZXZlbnRBZGRFbmRVc2VyKHNlbGVjdGVkLm9yaWdpbmFsT2JqZWN0LmJ1c2luZXNzX3VzZXJfaWQpOwokcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2FuZ3Vjb21wbGV0ZS1hbHQ6Y2xlYXJJbnB1dCcsICdjbGllbnRfYW5ndWNvbXBsZXRlJyk7Cgp9IGVsc2Ugewpsb2dEZWJ1Zygnbm90IHNlbGVjdGVkJyk7Cn0KfTsKCiRzY29wZS5ldmVudEFkZEVuZFVzZXIgPSBmdW5jdGlvbihlbmR1c2VyX2lkKQp7CmFkZEVuZFVzZXJUb0V2ZW50KCRodHRwLCRzY29wZSxlbmR1c2VyX2lkLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQsYWRkRW5kVXNlclRvRXZlbnRfZmluaXNoLCBhZGRFbmRVc2VyVG9FdmVudF9maW5pc2gpOwpmdW5jdGlvbiBhZGRFbmRVc2VyVG9FdmVudF9maW5pc2goKQp7CmdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCk7Cn0KfTsKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ0V2ZW50UGFnZUNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICR0aW1lb3V0LCAkaHR0cCwgJHVpYk1vZGFsICxzaGFyZWRQcm9wZXJ0aWVzLCAkcm91dGVQYXJhbXMsICRyb290U2NvcGUsICRsb2NhdGlvbiwgJHJvdXRlLCBzaGFyZWREYXRhKQp7CmxvZ0RlYnVnKCJFdmVudFBhZ2VDb250cm9sbGVyIik7CgpnZXRBbGxJbnN0cnVjdG9yc0luY0luYWN0aXZlKCRodHRwLCRzY29wZSwnaW5zdHJ1Y3RvcnMnLGdldEFsbEluc3RydWN0b3JzSW5jSW5hY3RpdmVfc3VjY2Vzcyk7CmdldEJ1c2luZXNzTG9jYXRpb25zKCRodHRwLCRzY29wZSwnYnVzaW5lc3NfbG9jYXRpb25zJyk7CgpmdW5jdGlvbiBnZXRBbGxJbnN0cnVjdG9yc0luY0luYWN0aXZlX3N1Y2Nlc3MoKQp7CmdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCxzZXRQYXJ0aWNpcGF0ZWQpOwp9CgogIHZhciBpbml0aWFsaXppbmcgPSB0cnVlIDsKCiAgJHNjb3BlLiR3YXRjaCgiY3VycmVudEV2ZW50IiwgZnVuY3Rpb24obmV3VmFsdWUsIG9sZFZhbHVlKSB7CiAgICBpZiAoaW5pdGlhbGl6aW5nKSB7CiAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkgeyBpbml0aWFsaXppbmcgPSBmYWxzZTsgfSk7CiAgICB9IGVsc2UgewogICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgdmFyIHRpbWVvdXRJZDsKICAgICAgJCgnI2RvY3MgOmlucHV0LCB0ZXh0YXJlYScpLm9uKCdpbnB1dCBwcm9wZXJ0eWNoYW5nZSBjaGFuZ2UnLCBmdW5jdGlvbigpIHsKICAgICAgLy8gIGNvbnNvbGUubG9nKCdUZXh0YXJlYSBDaGFuZ2UnKTsKICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0SWQpOwogICAgICAgLy8gUnVucyBYIHNlY29uZCAoWCoxMDAwIG1zKSBhZnRlciB0aGUgbGFzdCBjaGFuZ2UKICAgICAgIHRpbWVvdXRJZCA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgJHNjb3BlLnVwZGF0ZUV2ZW50RXh0cmFGaWVsZHMoKQogICAgICAgfSwgNzAwKTsKICAgICAgIH0pOwogICAgfSwgMTAwMCk7CiAgICB9CiAgfSk7Cgokc2NvcGUuZXh0cmFGaWVsZHNBbGVydE1lc3NhZ2U9bnVsbDsKCiRzY29wZS51cGRhdGVFdmVudFRpdGxlID0gZnVuY3Rpb24obmV3VmFsdWUsY3VycmVudEV2ZW50KQp7Cm5ld190aXRsZT1uZXdWYWx1ZTsKc2V0RXZlbnRUaXRsZSgkaHR0cCwkc2NvcGUsY3VycmVudEV2ZW50LmV2ZW50X2lkLCBuZXdfdGl0bGUsIHVwZGF0ZUV2ZW50X2NhbGxiYWNrLCB1cGRhdGVFdmVudF9jYWxsYmFjayk7CgpmdW5jdGlvbiB1cGRhdGVFdmVudF9jYWxsYmFjaygpCnsKZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCk7Cn0KCn07CgoKJHNjb3BlLnVwZGF0ZUV2ZW50RXh0cmFGaWVsZHMgPSBmdW5jdGlvbigpCnsKICAgIGxvZ0RlYnVnKCJzYXZlIHVwZGF0ZUV2ZW50RXh0cmFGaWVsZHMiKTsKdGhlZGF0YSA9IHsKZXh0cmFGaWVsZHM6JHNjb3BlLmN1cnJlbnRFdmVudC5leHRyYUZpZWxkcwp9OwogICAgJHNjb3BlLmV4dHJhRmllbGRzQWxlcnRNZXNzYWdlPSLXqdeV157XqC4uLiI7CnVwZGF0ZUV2ZW50RXh0cmFGaWVsZHMoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCx0aGVkYXRhLHVwZGF0ZUV2ZW50RXh0cmFGaWVsZHNfY2FsbGJhY2ssIHVwZGF0ZUV2ZW50RXh0cmFGaWVsZHNfY2FsbGJhY2spOwoKZnVuY3Rpb24gdXBkYXRlRXZlbnRFeHRyYUZpZWxkc19jYWxsYmFjaygpCnsKICAgICAgLy8gZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLHNldFBhcnRpY2lwYXRlZCk7CgogICAgICAkc2NvcGUuZXh0cmFGaWVsZHNBbGVydE1lc3NhZ2U9Iteg16nXnteoISI7CiR0aW1lb3V0KGZ1bmN0aW9uKCkKewokc2NvcGUuZXh0cmFGaWVsZHNBbGVydE1lc3NhZ2U9bnVsbDsKICAgICAgfSwgMjMwMCk7Cn0KfTsKCiRzY29wZS5yZXNjaGVkdWxlRXZlbnQgPSBmdW5jdGlvbigpCnsKbG9nRGVidWcoInNlZXRpbmcgZXZlbnQgdG8gbW92ZSAgIiskc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0pOwpzaGFyZWRQcm9wZXJ0aWVzLnNldF9ldmVudF9yZXNjaGVkdWxlKCRzY29wZS5jdXJyZW50RXZlbnQpOwogICAgc2hhcmVkUHJvcGVydGllcy5zZXRfc2VsZWN0ZWRfdXNlcihudWxsKTsKCi8vIHVzZXJfaW5mbz0gewovLyAgICAgdXNlcl9pZDogJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudFVzZXJzWzBdLnVzZXJfaWQsCi8vICAgICBidXNlcl9maXJzdF9uYW1lOiAkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfZmlyc3RfbmFtZSwKLy8gICAgIGJ1c2VyX2xhc3RfbmFtZTogJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudFVzZXJzWzBdLmJ1c2VyX2xhc3RfbmFtZQovLyB9OwovLyBzaGFyZWRQcm9wZXJ0aWVzLnNldF9zZWxlY3RlZF91c2VyKHVzZXJfaW5mbyk7CiRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfY2FsZW5kYXInKTsKfQoKJHNjb3BlLnVwZGF0ZUxvY2F0aW9uRXZlbnQgPSBmdW5jdGlvbigpCnsKY29uc29sZS5sb2coImZ1bmN0aW9uOiB1cGRhdGVMb2NhdGlvbkV2ZW50Iik7CnVwZGF0ZUV2ZW50TG9jYXRpb24oJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCwkc2NvcGUuY3VycmVudEV2ZW50LmxvY2F0aW9uX2lkLHVwZGF0ZUV2ZW50TG9jYXRpb25fY2FsbGJhY2ssIHVwZGF0ZUV2ZW50TG9jYXRpb25fY2FsbGJhY2spOwokc2NvcGUudXBkYXRlTG9jYXRpb25BbGVydE1lc3NhZ2U9Itee16LXk9eb158g16HXmNeY15XXoS4uLiI7CmZ1bmN0aW9uIHVwZGF0ZUV2ZW50TG9jYXRpb25fY2FsbGJhY2soKQp7CiRzY29wZS51cGRhdGVMb2NhdGlvbkFsZXJ0TWVzc2FnZT0i16LXldeT15vXnyDXkdeU16bXnNeX15QhIjsKJHRpbWVvdXQoZnVuY3Rpb24oKQp7CiRzY29wZS51cGRhdGVMb2NhdGlvbkFsZXJ0TWVzc2FnZT1udWxsOwp9LCAxNTAwKTsKfQp9OwoKJHNjb3BlLnVwZGF0ZUluc3RydWN0b3JFdmVudCA9IGZ1bmN0aW9uKCkKewpjb25zb2xlLmxvZygiZnVuY3Rpb246IHVwZGF0ZUluc3RydWN0b3JFdmVudCIpOwp1cGRhdGVFdmVudEluc3RydWN0b3IoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCwkc2NvcGUuY3VycmVudEV2ZW50Lmluc3RydWN0b3JfaWQsdXBkYXRlRXZlbnRJbnN0cnVjdG9yX2NhbGxiYWNrLCB1cGRhdGVFdmVudEluc3RydWN0b3JfY2FsbGJhY2spOwokc2NvcGUudXBkYXRlSW5zdHJ1Y3RvckFsZXJ0TWVzc2FnZT0i157XoteT15vXnyDXodeY15jXldehLi4uIjsKZnVuY3Rpb24gdXBkYXRlRXZlbnRJbnN0cnVjdG9yX2NhbGxiYWNrKCkKewokc2NvcGUudXBkYXRlSW5zdHJ1Y3RvckFsZXJ0TWVzc2FnZT0i16LXldeT15vXnyDXkdeU16bXnNeX15QhIjsKJHRpbWVvdXQoZnVuY3Rpb24oKQp7CiRzY29wZS51cGRhdGVJbnN0cnVjdG9yQWxlcnRNZXNzYWdlPW51bGw7Cn0sIDE1MDApOwp9Cn07Cgokc2NvcGUuaW5pdGlhdGVQYXltZW50ID0gZnVuY3Rpb24oaXNwbHVzKQp7CnZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewphbmltYXRpb246IGZhbHNlLAp0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9jbGllbnRfcGF5bWVudC5waHAnLApjb250cm9sbGVyOiAnYnVzaW5lc3NDbGllbmRDYXJkUGF5bWVudCcsCi8vIHNpemU6IHNpemUsCnJlc29sdmU6IHsKY3VycmVudENsaWVudDogZnVuY3Rpb24oKSB7CnJldHVybiAkc2NvcGUuY3VycmVudEV2ZW50Q2xpZW50c1swXTsKfSwKaXNwbHVzOiBmdW5jdGlvbigpIHsKcmV0dXJuIGlzcGx1czsKfQp9Cn0pOwp9Cgokc2NvcGUuZGVsZXRlRXZlbnQ9ZnVuY3Rpb24gKCkKewovLyBjaGVja2luZyBpZiBjYW5jZWxpbmcgYSBnZW5lcmNfdHlwZSBldmVudCAtIHRoZW4gdGhlcmUncyBubyB1c2VyCmlmICgkc2NvcGUuY3VycmVudEV2ZW50LmlzX2dlbmVyaWNfZXR5cGU9PTEpCnsKY2FuY2VsU2luZ2xlRXZlbnQoJGh0dHAsJHNjb3BlLDAsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLGNhbmNlbFNpbmdsZUV2ZW50X2NhbGxiYWNrLCBjYW5jZWxTaW5nbGVFdmVudF9jYWxsYmFjayk7Cn0KZWxzZQp7CmNhbmNlbFNpbmdsZUV2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50VXNlcnNbMF0uYnVzaW5lc3NfdXNlcl9pZCwkcm91dGVQYXJhbXMuZXZlbnRfaWQsY2FuY2VsU2luZ2xlRXZlbnRfY2FsbGJhY2ssIGNhbmNlbFNpbmdsZUV2ZW50X2NhbGxiYWNrKTsKfQpmdW5jdGlvbiBjYW5jZWxTaW5nbGVFdmVudF9jYWxsYmFjaygpCnsKZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLHNldFBhcnRpY2lwYXRlZCk7Cn0KfQoKJHNjb3BlLnNldFBhcnRpY2lwYXRpb25TdGF0dXMgPSBmdW5jdGlvbigpCnsKc2V0RXZlbnRVc2VyUGFydGljaXBhdGlvblN0YXR1cygkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRVc2Vyc1swXS5idXNpbmVzc191c2VyX2lkLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRVc2Vyc1swXS5ldmVudF91c2VyX3N0YXR1c19pZCxzZXRQYXJ0aWNpcGF0aW9uU3RhdHVzX2NhbGxiYWNrLCBzZXRQYXJ0aWNpcGF0aW9uU3RhdHVzX2NhbGxiYWNrKTsKJHNjb3BlLnVwZGF0ZVN0YXR1c0FsZXJ0TWVzc2FnZT0i157XoteT15vXnyDXodeY15jXldehLi4uIjsKZnVuY3Rpb24gc2V0UGFydGljaXBhdGlvblN0YXR1c19jYWxsYmFjaygpCnsKLy8gZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLHNldFBhcnRpY2lwYXRlZCk7CnNldFBhcnRpY2lwYXRlZCgpOwokc2NvcGUudXBkYXRlU3RhdHVzQWxlcnRNZXNzYWdlPSLXoteV15PXm9efINeR15TXptec15fXlCEiOwokdGltZW91dChmdW5jdGlvbigpCnsKJHNjb3BlLnVwZGF0ZVN0YXR1c0FsZXJ0TWVzc2FnZT1udWxsOwp9LCAyNTAwKTsKfQp9CgpmdW5jdGlvbiBzZXRQYXJ0aWNpcGF0ZWQoKQp7CmxvZ0RlYnVnKCJnZXQgY2xpZW50IGluZm8iKTsKZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Q2xpZW50cycsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudFVzZXJzWzBdLmJ1c2luZXNzX3VzZXJfaWQpOwpsb2dEZWJ1Zygic2V0dGluZyBzZXRQYXJ0aWNpcGF0ZWQiKTsKaWYgKCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRVc2Vyc1swXS5zdGF0dXNfbmFtZSE9JGdVc2VyX3N0YXR1c19hYnNlbnRlZCkKewokc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50VXNlcnNbMF0ucGFydGljaXBhdGVkPXRydWU7Cn0KZWxzZQp7CiRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRVc2Vyc1swXS5wYXJ0aWNpcGF0ZWQ9ZmFsc2U7Cn0KCi8vIHRoaXMgbG9vcCBpcyBmb3IgZml4aW5nIHRoZSBkYXRlIGZvcm1hdCB0byBhcHBlYXIgcHJvcGVybHkgaW4gdGhlIGlucHV0IGRhdGUgaHRtbCBvYmplY3QKZm9yIChpID0gMDsgaTwgKCRzY29wZS5jdXJyZW50RXZlbnQuZXh0cmFGaWVsZHMpLmxlbmd0aDsgaSsrKQp7CmxvZ0RlYnVnKCRzY29wZS5jdXJyZW50RXZlbnQuZXh0cmFGaWVsZHNbaV0pOwppZiAoJHNjb3BlLmN1cnJlbnRFdmVudC5leHRyYUZpZWxkc1tpXS5maWVsZF9kYXRhdHlwZT09IkRBVEUiKQp7Ci8vIGxvZ0RlYnVnKCJkYXRlIik7CiRzY29wZS5jdXJyZW50RXZlbnQuZXh0cmFGaWVsZHNbaV0uZmllbGRfdmFsdWU9bmV3IERhdGUoJHNjb3BlLmN1cnJlbnRFdmVudC5leHRyYUZpZWxkc1tpXS5maWVsZF92YWx1ZSk7Cn0KfQoKbG9nRGVidWcoIiRzY29wZS5jdXJyZW50RXZlbnQuaW5zdHJ1Y3Rvcl9pZDs9Iiskc2NvcGUuY3VycmVudEV2ZW50Lmluc3RydWN0b3JfaWQpOwpmb3IodmFyIGkgPSAwOyBpIDwgJHNjb3BlLmluc3RydWN0b3JzLmxlbmd0aDsgaSsrKQp7CmxvZ0RlYnVnKCRzY29wZS5pbnN0cnVjdG9yc1tpXS5pc19hY3RpdmUpOwppZiAoJHNjb3BlLmluc3RydWN0b3JzW2ldLmJ1c2luZXNzX3VzZXJfaWQ9PSRzY29wZS5jdXJyZW50RXZlbnQuaW5zdHJ1Y3Rvcl9pZCkKewpsb2dEZWJ1ZygieWVzaCIpOwokc2NvcGUuaW5zdHJ1Y3RvcnNbaV0uaXNfYWN0aXZlPTE7Cn0KfQp9Cgokc2NvcGUudXBkYXRlVXNlckV2ZW50UHJpY2UgPSBmdW5jdGlvbihuZXd2YWx1ZSwgdGhlZXZlbnQpCnsKbmV3X3ByaWNlPW5ld3ZhbHVlOwpzZXRDbGllbnRFdmVudFByaWNlKCRodHRwLCRzY29wZSwkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50VXNlcnNbMF0uYnVzaW5lc3NfdXNlcl9pZCx0aGVldmVudC5ldmVudF9pZCwgbmV3X3ByaWNlLHNldENsaWVudEV2ZW50UHJpY2VfY2FsbGJhY2ssIHNldENsaWVudEV2ZW50UHJpY2VfY2FsbGJhY2spOwpmdW5jdGlvbiBzZXRDbGllbnRFdmVudFByaWNlX2NhbGxiYWNrKCkKewpnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkcm91dGVQYXJhbXMuZXZlbnRfaWQsc2V0UGFydGljaXBhdGVkKTsKfQp9OwoKJHNjb3BlLiRvbigiZXZlbnRQYWdlUmVsb2FkRGF0YSIsZnVuY3Rpb24oZSxhKQp7CmdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCxzZXRQYXJ0aWNpcGF0ZWQpOwp9KTsKCgoKCiRzY29wZS5jbG9zZUV2ZW50ID0gZnVuY3Rpb24oKQp7CmxvZ0RlYnVnKCJjaGVja2luZyBpZiBldmVudCBoYXMgZXh0cmEgZmllbGRzIHRoYXQgYXJlIHJlcXVpcmVkIGJlZm9yZSBjbG9zaW5nIGl0Iik7CmNoZWNrRXZlbnRFeHRyYUZpZWxkcygkaHR0cCwkc2NvcGUsJ2NoZWNrRXZlbnRFeHRyYUZpZWxkcycsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLGNoZWNrRXZlbnRFeHRyYUZpZWxkc19zdWNjZXNzKTsKZnVuY3Rpb24gY2hlY2tFdmVudEV4dHJhRmllbGRzX3N1Y2Nlc3MoKQp7CmlmICgkc2NvcGUuY2hlY2tFdmVudEV4dHJhRmllbGRzPT10cnVlKQp7CmxvZ0RlYnVnKCJldmVudCBoYXMgYWxsIGV4dHJhIGZpZWxkcyBvaywgY2xvc2luZyBldmVudCIpOwovLyAkc2NvcGUuY3VycmVudEV2ZW50Lmlnbm9yZUV4dHJhRmllbGRzVmFsaWRhdGlvbj10cnVlOwpjbG9zZUV2ZW50KCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuZXZlbnRfaWQsJHNjb3BlLmN1cnJlbnRFdmVudCxhZnRlckNsb3NlRXZlbnQsYWZ0ZXJDbG9zZUV2ZW50KTsKZnVuY3Rpb24gYWZ0ZXJDbG9zZUV2ZW50KCkKewpnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkcm91dGVQYXJhbXMuZXZlbnRfaWQsc2V0UGFydGljaXBhdGVkKTsKfTsKfQplbHNlCnsKbG9nRGVidWcoImV2ZW50IGhhcyBleHRyYSBmaWVsZHMgcmVxdWlyZWQgdGhhdCBhcmUgbm90IGZpbGxlZCIpOwp2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKYW5pbWF0aW9uOiBmYWxzZSwKdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfZXZlbnRfY2xvc2VfaWdub3JlX21hbmRhdG9yeV9maWVsZHMucGhwJywKY29udHJvbGxlcjogJ2V2ZW50Q2xvc2VJZ25vcmVNYW5kYXRvcnlGaWVsZHNNb2RhbENvbnRyb2xsZXInLApzaXplOiAnbScsCnJlc29sdmU6IHsKY3VycmVudEV2ZW50OiBmdW5jdGlvbigpIHsKcmV0dXJuICRzY29wZS5jdXJyZW50RXZlbnQ7Cn0KfQp9KTsKfQp9Cn0KJHNjb3BlLnJlb3BlbkV2ZW50ID0gZnVuY3Rpb24oKQp7CmxvZ0RlYnVnKCJyZW9wZW5FdmVudCIpOwpyZW9wZW5FdmVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCwkc2NvcGUuY3VycmVudEV2ZW50LGFmdGVyUmVvcGVuRXZlbnQsYWZ0ZXJSZW9wZW5FdmVudCk7CmZ1bmN0aW9uIGFmdGVyUmVvcGVuRXZlbnQoKQp7CmdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQsc2V0UGFydGljaXBhdGVkKTsKfTsKfQoKfSk7CgprdXplQXBwLmZpbHRlcignc3RhcnRGcm9tJywgZnVuY3Rpb24oKQp7CnJldHVybiBmdW5jdGlvbihpbnB1dCwgc3RhcnQpCnsKaWYoIWlucHV0KSByZXR1cm4gW107Ci8vIGNvbnNvbGUubG9nKCJoZXJlcmVlZSAiK2lucHV0KTsKc3RhcnQgPSArc3RhcnQ7IC8vcGFyc2UgdG8gaW50CnJldHVybiBpbnB1dC5zbGljZShzdGFydCk7Cn0KfSk7Ci8vIGFuZ3VsYXIgZmlsdGVyIGZvciBldmVudHMgYmVmb3JlL2FmdGVyIHRvZGF5Cmt1emVBcHAuZmlsdGVyKCdiZWZvcmVOb3cnLCBmdW5jdGlvbigpIHsKLy8gQ3JlYXRlIHRoZSByZXR1cm4gZnVuY3Rpb24gYW5kIHNldCB0aGUgcmVxdWlyZWQgcGFyYW1ldGVyIG5hbWUgdG8gKippbnB1dCoqCnJldHVybiBmdW5jdGlvbihpbnB1dCkgewp2YXIgb3V0ID0gW107CgovLyBVc2luZyB0aGUgYW5ndWxhci5mb3JFYWNoIG1ldGhvZCwgZ28gdGhyb3VnaCB0aGUgYXJyYXkgb2YgZGF0YSBhbmQgcGVyZm9ybSB0aGUgb3BlcmF0aW9uIG9mIGZpZ3VyaW5nIG91dCBpZiB0aGUgbGFuZ3VhZ2UgaXMgc3RhdGljYWxseSBvciBkeW5hbWljYWxseSB0eXBlZC4KdmFyIGJyb3dzZXJfZXBvY2ggPSAobmV3IERhdGUpLmdldFRpbWUoKTsKCmFuZ3VsYXIuZm9yRWFjaChpbnB1dCwgZnVuY3Rpb24oZXZlbnQpCnsKLy8gIGxvZ0RlYnVnKCJmaWx0ZXJpbmcsIGV2ZW50LmV2ZW50X3VzZXJfc3RhdHVzX2lkPSIrZXZlbnQuZXZlbnRfdXNlcl9zdGF0dXNfaWQpOwppZiAoZXZlbnQuc3RhcnRfZXBvY2ggPD0gKGJyb3dzZXJfZXBvY2gvMTAwMCkpCnsKb3V0LnB1c2goZXZlbnQpCn0KfSkKcmV0dXJuIG91dDsKfQp9KTsKa3V6ZUFwcC5maWx0ZXIoJ2FmdGVyTm93JywgZnVuY3Rpb24oKSB7Ci8vIENyZWF0ZSB0aGUgcmV0dXJuIGZ1bmN0aW9uIGFuZCBzZXQgdGhlIHJlcXVpcmVkIHBhcmFtZXRlciBuYW1lIHRvICoqaW5wdXQqKgpyZXR1cm4gZnVuY3Rpb24oaW5wdXQpIHsKdmFyIG91dCA9IFtdOwoKLy8gVXNpbmcgdGhlIGFuZ3VsYXIuZm9yRWFjaCBtZXRob2QsIGdvIHRocm91Z2ggdGhlIGFycmF5IG9mIGRhdGEgYW5kIHBlcmZvcm0gdGhlIG9wZXJhdGlvbiBvZiBmaWd1cmluZyBvdXQgaWYgdGhlIGxhbmd1YWdlIGlzIHN0YXRpY2FsbHkgb3IgZHluYW1pY2FsbHkgdHlwZWQuCnZhciBicm93c2VyX2Vwb2NoID0gKG5ldyBEYXRlKS5nZXRUaW1lKCk7Cgphbmd1bGFyLmZvckVhY2goaW5wdXQsIGZ1bmN0aW9uKGV2ZW50KQp7Ci8vICBsb2dEZWJ1ZygiZmlsdGVyaW5nLCBldmVudC5ldmVudF91c2VyX3N0YXR1c19pZD0iK2V2ZW50LmV2ZW50X3VzZXJfc3RhdHVzX2lkKTsKaWYgKGV2ZW50LnN0YXJ0X2Vwb2NoID4gKGJyb3dzZXJfZXBvY2gvMTAwMCkpCnsKb3V0LnB1c2goZXZlbnQpCn0KfSkKcmV0dXJuIG91dDsKfQp9KTsKCmt1emVBcHAuZmlsdGVyKCdpc0FjdGl2ZScsIGZ1bmN0aW9uKCkgewovLyBDcmVhdGUgdGhlIHJldHVybiBmdW5jdGlvbiBhbmQgc2V0IHRoZSByZXF1aXJlZCBwYXJhbWV0ZXIgbmFtZSB0byAqKmlucHV0KioKcmV0dXJuIGZ1bmN0aW9uKGlucHV0KSB7CnZhciBvdXQgPSBbXTsKCi8vIFVzaW5nIHRoZSBhbmd1bGFyLmZvckVhY2ggbWV0aG9kLCBnbyB0aHJvdWdoIHRoZSBhcnJheSBvZiBkYXRhIGFuZCBwZXJmb3JtIHRoZSBvcGVyYXRpb24gb2YgZmlndXJpbmcgb3V0IGlmIHRoZSBsYW5ndWFnZSBpcyBzdGF0aWNhbGx5IG9yIGR5bmFtaWNhbGx5IHR5cGVkLgoKYW5ndWxhci5mb3JFYWNoKGlucHV0LCBmdW5jdGlvbihldmVudCkKewovLyAgbG9nRGVidWcoImZpbHRlcmluZywgZXZlbnQuZXZlbnRfdXNlcl9zdGF0dXNfaWQ9IitldmVudC5ldmVudF91c2VyX3N0YXR1c19pZCk7CmlmIChldmVudC5pc19hY3RpdmU9PTEpCnsKb3V0LnB1c2goZXZlbnQpCn0KfSkKcmV0dXJuIG91dDsKfQp9KTsKCmt1emVBcHAuZmlsdGVyKCdzaG91bGRfYmVfZGlzcGxheWVkJywgZnVuY3Rpb24oKSB7Ci8vIENyZWF0ZSB0aGUgcmV0dXJuIGZ1bmN0aW9uIGFuZCBzZXQgdGhlIHJlcXVpcmVkIHBhcmFtZXRlciBuYW1lIHRvICoqaW5wdXQqKgpyZXR1cm4gZnVuY3Rpb24oaW5wdXQpIHsKdmFyIG91dCA9IFtdOwoKLy8gVXNpbmcgdGhlIGFuZ3VsYXIuZm9yRWFjaCBtZXRob2QsIGdvIHRocm91Z2ggdGhlIGFycmF5IG9mIGRhdGEgYW5kIHBlcmZvcm0gdGhlIG9wZXJhdGlvbiBvZiBmaWd1cmluZyBvdXQgaWYgdGhlIGxhbmd1YWdlIGlzIHN0YXRpY2FsbHkgb3IgZHluYW1pY2FsbHkgdHlwZWQuCgphbmd1bGFyLmZvckVhY2goaW5wdXQsIGZ1bmN0aW9uKGV2ZW50KQp7Ci8vICBsb2dEZWJ1ZygiZmlsdGVyaW5nLCBldmVudC5ldmVudF91c2VyX3N0YXR1c19pZD0iK2V2ZW50LmV2ZW50X3VzZXJfc3RhdHVzX2lkKTsKaWYgKGV2ZW50LnNob3VsZF9iZV9kaXNwbGF5ZWQ9PTEpCnsKb3V0LnB1c2goZXZlbnQpCn0KfSkKcmV0dXJuIG91dDsKfQp9KTsKCmt1emVBcHAuY29udHJvbGxlcignSW5zdHJ1Y3RvclNob3cxQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHRpbWVvdXQsICRodHRwLCBzaGFyZWRQcm9wZXJ0aWVzLCAkcm9vdFNjb3BlLCAkcm91dGVQYXJhbXMsICRsb2NhdGlvbiwgJHJvdXRlLCBzaGFyZWREYXRhLCAkdWliTW9kYWwpCnsKZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLGdldEJ1c2luZXNzQ2xpZW50SW5mb19zdWNjZXNzKTsKICBnZXRzZWN1cml0eVByb2ZpbGVzKCRodHRwLCRzY29wZSwnc2VjX3Byb2ZpbGVzJyk7CgpmdW5jdGlvbiBnZXRCdXNpbmVzc0NsaWVudEluZm9fc3VjY2VzcygpCnsKZ2V0Q2xpZW50RXh0cmFGaWVsZHMoJGh0dHAsJHNjb3BlLCRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5idXNpbmVzc191c2VyX2lkLCdjbGllbnRFeHRyYUZpZWxkcycsZ2V0Q2xpZW50RXh0cmFGaWVsZHNfc3VjY2Vzcyk7CgpmdW5jdGlvbiBnZXRDbGllbnRFeHRyYUZpZWxkc19zdWNjZXNzKCkKewpmb3IgKGkgPSAwOyBpPCAoJHNjb3BlLmNsaWVudEV4dHJhRmllbGRzKS5sZW5ndGg7IGkrKykKewpsb2dEZWJ1Zygkc2NvcGUuY2xpZW50RXh0cmFGaWVsZHNbaV0pOwppZiAoJHNjb3BlLmNsaWVudEV4dHJhRmllbGRzW2ldLmZpZWxkX2RhdGF0eXBlPT0iREFURSIpCnsKLy8gbG9nRGVidWcoImRhdGUiKTsKJHNjb3BlLmNsaWVudEV4dHJhRmllbGRzW2ldLmZpZWxkX3ZhbHVlPW5ldyBEYXRlKCRzY29wZS5jbGllbnRFeHRyYUZpZWxkc1tpXS5maWVsZF92YWx1ZSk7Cn0KfQp9Cn0KCiAgJHNjb3BlLnVwZGF0ZV9zZWNfcHJvZmlsZSA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1ZygidXBkYXRlX3NlY19wcm9maWxlIGZvciBidWlkPSIrJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLmJ1c2luZXNzX3VzZXJfaWQrICIsIHByb2ZpbGVfaWQiKyRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5zZWNfcHJvZmlsZV9pZCk7CiAgICB1cGRhdGVfc2VjX3Byb2ZpbGUoJGh0dHAsJHNjb3BlLCRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5idXNpbmVzc191c2VyX2lkLCRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5zZWNfcHJvZmlsZV9pZCx1cGRhdGVfc2VjX3Byb2ZpbGVfc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiB1cGRhdGVfc2VjX3Byb2ZpbGVfc3VjY2VzcygpCiAgICB7CiAgICAgIGdldHNlY3VyaXR5UHJvZmlsZXMoJGh0dHAsJHNjb3BlLCdzZWNfcHJvZmlsZXMnKTsKICAgIH0KICB9CiRzY29wZS5hcmNoaXZlQ2xpZW50TW9kYWwgPSBmdW5jdGlvbigpCnsKLy8gYXJjaGl2ZS9kZWxldGUgY2xpZW50IC0gYXNrIGlmIHN1cmUKdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CmFuaW1hdGlvbjogZmFsc2UsCnRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2FyY2hpdmVfY2xpZW50X21vZGFsLnBocCcsCnNpemU6ICd4cycsCmNvbnRyb2xsZXI6ICdhcmNoaXZlX2NsaWVudF9tb2RhbCcsICAvLyAncGF5bWVueURldGFpbHNNb2RhbENvbnRyb2xsZXInLApyZXNvbHZlOiB7CmJ1c2luZXNzX3VzZXJfaWQ6IGZ1bmN0aW9uKCkgewpyZXR1cm4gJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLmJ1c2luZXNzX3VzZXJfaWQ7Cn0sCmJ1c2VyX2xhc3RfbmFtZTogZnVuY3Rpb24oKSB7CnJldHVybiAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYnVzZXJfbGFzdF9uYW1lOwp9LApidXNlcl9maXJzdF9uYW1lOiBmdW5jdGlvbigpIHsKcmV0dXJuICRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5idXNlcl9maXJzdF9uYW1lOwp9LAppc19pbnN0cnVjdG9yOiBmdW5jdGlvbigpIHsKcmV0dXJuIHRydWU7Cn0KfQp9KTsKfQoKJHNjb3BlLnVwZGF0ZVVzZXJGaXJzdE5hbWUgPSBmdW5jdGlvbihuZXdWYWx1ZSkKewpzZXRDbGllbnRGaXJzdE5hbWUoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLG5ld1ZhbHVlLGFmdGVyQ2xpZW50U2V0LGFmdGVyQ2xpZW50U2V0KTsKZnVuY3Rpb24gYWZ0ZXJDbGllbnRTZXQoKQp7CmdldEJ1c2luZXNzQ2xpZW50SW5mbygkaHR0cCwkc2NvcGUsJ2Zvcm1VcGRhdGVDbGllbnRBbmd1bGFyJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7Cn0KfQokc2NvcGUudXBkYXRlVXNlckxhc3ROYW1lID0gZnVuY3Rpb24obmV3VmFsdWUpCnsKc2V0Q2xpZW50TGFzdE5hbWUoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLG5ld1ZhbHVlLGFmdGVyQ2xpZW50U2V0LGFmdGVyQ2xpZW50U2V0KTsKZnVuY3Rpb24gYWZ0ZXJDbGllbnRTZXQoKQp7CmdldEJ1c2luZXNzQ2xpZW50SW5mbygkaHR0cCwkc2NvcGUsJ2Zvcm1VcGRhdGVDbGllbnRBbmd1bGFyJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7Cn0KfQokc2NvcGUudXBkYXRlVXNlclBob25lTnVtYmVyID0gZnVuY3Rpb24obmV3VmFsdWUpCnsKbmV3VmFsdWUgPSBuZXdWYWx1ZS5yZXBsYWNlKCctJywnJyk7CmlmIChpc05hTihuZXdWYWx1ZSkpCnsKYWxlcnQoIteQ16DXkCDXlNeW158g157Xodek16gg15jXnNek15XXnyDXqten15nXnyIpOwpnZXRCdXNpbmVzc0NsaWVudEluZm8oJGh0dHAsJHNjb3BlLCdmb3JtVXBkYXRlQ2xpZW50QW5ndWxhcicsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwp9CmVsc2UKewpzZXRDbGllbnRQaG9uZU51bWJlcigkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsbmV3VmFsdWUsc2V0Q2xpZW50UGhvbmVOdW1iZXJfY2FsbGJhY2ssc2V0Q2xpZW50UGhvbmVOdW1iZXJfY2FsbGJhY2spOwpmdW5jdGlvbiBzZXRDbGllbnRQaG9uZU51bWJlcl9jYWxsYmFjaygpCnsKZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKfQp9Cn0KCn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignQ2xpZW50c1Nob3cxQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHRpbWVvdXQsICRodHRwLCBzaGFyZWRQcm9wZXJ0aWVzLCAkcm9vdFNjb3BlLCAkcm91dGVQYXJhbXMsICRsb2NhdGlvbiwgJHJvdXRlLCBzaGFyZWREYXRhLCAkdWliTW9kYWwpCnsKZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLGdldEJ1c2luZXNzQ2xpZW50SW5mb19zdWNjZXNzKTsKCmZ1bmN0aW9uIGdldEJ1c2luZXNzQ2xpZW50SW5mb19zdWNjZXNzKCkKewpnZXRDbGllbnRFeHRyYUZpZWxkcygkaHR0cCwkc2NvcGUsJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLmJ1c2luZXNzX3VzZXJfaWQsJ2NsaWVudEV4dHJhRmllbGRzJyxnZXRDbGllbnRFeHRyYUZpZWxkc19zdWNjZXNzKTsKCmZ1bmN0aW9uIGdldENsaWVudEV4dHJhRmllbGRzX3N1Y2Nlc3MoKQp7CmZvciAoaSA9IDA7IGk8ICgkc2NvcGUuY2xpZW50RXh0cmFGaWVsZHMpLmxlbmd0aDsgaSsrKQp7CmxvZ0RlYnVnKCRzY29wZS5jbGllbnRFeHRyYUZpZWxkc1tpXSk7CmlmICgkc2NvcGUuY2xpZW50RXh0cmFGaWVsZHNbaV0uZmllbGRfZGF0YXR5cGU9PSJEQVRFIikKewovLyBsb2dEZWJ1ZygiZGF0ZSIpOwokc2NvcGUuY2xpZW50RXh0cmFGaWVsZHNbaV0uZmllbGRfdmFsdWU9bmV3IERhdGUoJHNjb3BlLmNsaWVudEV4dHJhRmllbGRzW2ldLmZpZWxkX3ZhbHVlKTsKfQp9Cn0KfQp7CmdldENsaWVudEV2ZW50cygkaHR0cCwkc2NvcGUsJ2N1cnJlbnRDbGllbnRFdmVudHMnLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKCmdldENsaWVudFBheW1lbnRzKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCwnY3VycmVudENsaWVudFBheW1lbnRzJyk7Cgokc2NvcGUuYXJjaGl2ZUNsaWVudE1vZGFsID0gZnVuY3Rpb24oKQp7Ci8vIGFyY2hpdmUvZGVsZXRlIGNsaWVudCAtIGFzayBpZiBzdXJlCnZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewphbmltYXRpb246IGZhbHNlLAp0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdhcmNoaXZlX2NsaWVudF9tb2RhbC5waHAnLApzaXplOiAneHMnLApjb250cm9sbGVyOiAnYXJjaGl2ZV9jbGllbnRfbW9kYWwnLCAgLy8gJ3BheW1lbnlEZXRhaWxzTW9kYWxDb250cm9sbGVyJywKcmVzb2x2ZTogewpidXNpbmVzc191c2VyX2lkOiBmdW5jdGlvbigpIHsKcmV0dXJuICRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5idXNpbmVzc191c2VyX2lkOwp9LApidXNlcl9sYXN0X25hbWU6IGZ1bmN0aW9uKCkgewpyZXR1cm4gJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLmJ1c2VyX2xhc3RfbmFtZTsKfSwKYnVzZXJfZmlyc3RfbmFtZTogZnVuY3Rpb24oKSB7CnJldHVybiAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYnVzZXJfZmlyc3RfbmFtZTsKfSwKaXNfaW5zdHJ1Y3RvcjogZnVuY3Rpb24oKSB7CnJldHVybiBmYWxzZTsKfQp9Cn0pOwp9CiRzY29wZS5wYWNrYWdlRGVsZXRlID0gZnVuY3Rpb24ocGFja2FnZSkKewpsb2dEZWJ1ZygicGFja2FnZSBkZWxldGUgIitKU09OLnN0cmluZ2lmeShwYWNrYWdlKSk7CmRlbGV0ZVBhY2thZ2UoJGh0dHAsJHNjb3BlLHBhY2thZ2UucGFja2FnZV91c2VyX2lkLCRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5idXNpbmVzc191c2VyX2lkLHN1Y2Nlc3NfY2FsbGJhY2ssIHN1Y2Nlc3NfY2FsbGJhY2spOwpmdW5jdGlvbiBzdWNjZXNzX2NhbGxiYWNrKCkKewokcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NsaWVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCn0KfQoKJHNjb3BlLnVwZGF0ZUNsaWVudEV4dHJhRmllbGRzID0gZnVuY3Rpb24oKQp7CiAgICAgIGxvZ0RlYnVnKCJ1cGRhdGVDbGllbnRFeHRyYUZpZWxkcyIpOwp0aGVkYXRhID0gewpleHRyYUZpZWxkczokc2NvcGUuY2xpZW50RXh0cmFGaWVsZHMKfTsKICAgICAgJHNjb3BlLmV4dHJhRmllbGRzQWxlcnRNZXNzYWdlPSLXqdeV157XqC4uLiI7CiAgICAgIHVwZGF0ZUNsaWVudEV4dHJhRmllbGRzKCRodHRwLCRzY29wZSwkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYnVzaW5lc3NfdXNlcl9pZCx0aGVkYXRhLHVwZGF0ZUV2ZW50Q2xpZW50RmllbGRzX2NhbGxiYWNrLCB1cGRhdGVFdmVudENsaWVudEZpZWxkc19jYWxsYmFjayk7CgogICAgICBmdW5jdGlvbiB1cGRhdGVFdmVudENsaWVudEZpZWxkc19jYWxsYmFjaygpCnsKLy8gZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLHNldFBhcnRpY2lwYXRlZCk7CiAgICAgICAgJHNjb3BlLmV4dHJhRmllbGRzQWxlcnRNZXNzYWdlPSLXoNep157XqCEiOwokdGltZW91dChmdW5jdGlvbigpCnsKJHNjb3BlLmV4dHJhRmllbGRzQWxlcnRNZXNzYWdlPW51bGw7Cn0sIDMwMDApOwp9Cn07Cgokc2NvcGUuc2NoZWR1bGVFdmVudEZvckNsaWVudCA9IGZ1bmN0aW9uKCkKewpsb2dEZWJ1Zygic2VldGluZyBzaGFyZSBwcm9wZXJ0eSB1c2VyX2lkICIrJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdKTsKc2hhcmVkUHJvcGVydGllcy5zZXRfc2VsZWN0ZWRfdXNlcigkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0pOwokbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2NhbGVuZGFyJyk7Cn0KJHNjb3BlLmludm9pY2VHZW5lcmF0ZUNoZWNrYm94ID0gZnVuY3Rpb24oZnBheW1lbnQpCnsKbG9nRGVidWcoImludm9pY2VHZW5lcmF0ZUNoZWNrYm94IGZvciAiK0pTT04uc3RyaW5naWZ5KGZwYXltZW50KSk7CnNldENsaWVudFBheW1lbnRJbnZvaWNlR2VuZXJhdGVkKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCxmcGF5bWVudC51c2VyX3BheW1lbnRfaWQsZnBheW1lbnQuaW52b2ljZV9nZW5lcmF0ZWQsc2V0Q2xpZW50UGF5bWVudEludm9pY2VHZW5lcmF0ZWRfY2FsbGJhY2ssIHNldENsaWVudFBheW1lbnRJbnZvaWNlR2VuZXJhdGVkX2NhbGxiYWNrKTsKZnVuY3Rpb24gc2V0Q2xpZW50UGF5bWVudEludm9pY2VHZW5lcmF0ZWRfY2FsbGJhY2soKQp7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKfQp9OwoKJHNjb3BlLnJlY2FsY1VzZXJCYWxhbmNlID0gZnVuY3Rpb24oKQp7CmxvZ0RlYnVnKCJyZWNhbGNVc2VyQmFsYW5jZSIpOwpyZWNhbGNVc2VyQmFsYW5jZSgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsIHJlY2FsY1VzZXJCYWxhbmNlX2NhbGxiYWNrKTsKZnVuY3Rpb24gcmVjYWxjVXNlckJhbGFuY2VfY2FsbGJhY2soKQp7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKfSAgICB9CiRzY29wZS51cGRhdGVFdmVudFBhY2thZ2VSZWZlcmVuY2UgPSBmdW5jdGlvbih1c2VyX2lkLCBmbWVldGluZykKewpsb2dEZWJ1ZygidXBkYXRlRXZlbnRQYWNrYWdlUmVmZXJlbmNlLCB1c2VyPSIrdXNlcl9pZCsiLCBmbWVldGluZz0iK0pTT04uc3RyaW5naWZ5KGZtZWV0aW5nKSk7CnZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewphbmltYXRpb246IGZhbHNlLAp0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9jbGllbnRfZXZlbnRfcGFja2FnZV9hc3NvY2lhdGlvbi5waHAnLApzaXplOiAneHMnLApjb250cm9sbGVyOiAnZXZlbnRQYWNrYWdlQXNzb2NpYXRpb25Nb2RhbENvbnRyb2xsZXInLCAgLy8gJ3BheW1lbnlEZXRhaWxzTW9kYWxDb250cm9sbGVyJywKcmVzb2x2ZTogewpmbWVldGluZzogZnVuY3Rpb24oKSB7CnJldHVybiBmbWVldGluZzsKfSwKYmFsYW5jZTogZnVuY3Rpb24oKSB7CnJldHVybiAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYmFsYW5jZTsKfSwKYnVzaW5lc3NfdXNlcl9pZDogZnVuY3Rpb24oKSB7CnJldHVybiAkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZDsKfQp9Cn0pOwp9OwoKJHNjb3BlLnVwZGF0ZVBhY2thZ2VQYXltZW50UmVmZXJlbmNlID0gZnVuY3Rpb24odXNlcl9pZCwgZnBhY2thZ2UpCnsKbG9nRGVidWcoInVwZGF0ZVBhY2thZ2VQYXltZW50UmVmZXJlbmNlLCB1c2VyPSIrdXNlcl9pZCsiLCBmcGFja2FnZT0iK0pTT04uc3RyaW5naWZ5KGZwYWNrYWdlKSk7CnZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewphbmltYXRpb246IGZhbHNlLAp0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9jbGllbnRfcGFja2FnZV9wYXltZW50X2Fzc29jaWF0aW9uLnBocCcsCnNpemU6ICd4cycsCmNvbnRyb2xsZXI6ICdwYWNrYWdlUGF5bWVudEFzc29jaWF0aW9uTW9kYWxDb250cm9sbGVyJywgIC8vICdwYXltZW55RGV0YWlsc01vZGFsQ29udHJvbGxlcicsCnJlc29sdmU6IHsKZnBhY2thZ2U6IGZ1bmN0aW9uKCkgewpyZXR1cm4gZnBhY2thZ2U7Cn0sCmJhbGFuY2U6IGZ1bmN0aW9uKCkgewpyZXR1cm4gJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLmJhbGFuY2U7Cn0sCmJ1c2luZXNzX3VzZXJfaWQ6IGZ1bmN0aW9uKCkgewpyZXR1cm4gJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQ7Cn0KfQp9KTsKfTsKCi8vIHNob3cgcGF5bWVudCBwb3B1cAokc2NvcGUuc2hvd1BheW1lbnREZXRhaWxzID0gZnVuY3Rpb24oZnBheW1lbnQpCnsKbG9nRGVidWcoInNob3dQYXltZW50RGV0YWlscyIpOwp2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKYW5pbWF0aW9uOiBmYWxzZSwKdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfY2xpZW50X3BheW1lbnRfZGV0YWlscy5waHAnLApzaXplOiAneHMnLApjb250cm9sbGVyOiAncGF5bWVueURldGFpbHNNb2RhbENvbnRyb2xsZXInLApyZXNvbHZlOiB7CmZwYXltZW50OiBmdW5jdGlvbigpIHsKcmV0dXJuIGZwYXltZW50Owp9Cn0KfSk7Cn0KJHNjb3BlLmludm9pY2VOdW1iZXJDaGFuZ2VkID0gZnVuY3Rpb24obmV3X2ludm9pY2VfbnVtYmVyLGZwYXltZW50KQp7CmxvZ0RlYnVnKCJpbnZvaWNlTnVtYmVyQ2hhbmdlZCAiKyBuZXdfaW52b2ljZV9udW1iZXIgKyJmb3IgIitKU09OLnN0cmluZ2lmeShmcGF5bWVudCkpOwpzZXRDbGllbnRQYXltZW50SW52b2ljZU51bWJlcigkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsZnBheW1lbnQudXNlcl9wYXltZW50X2lkLG5ld19pbnZvaWNlX251bWJlcixzZXRDbGllbnRQYXltZW50SW52b2ljZU51bWJlcl9jYWxsYmFjaywgc2V0Q2xpZW50UGF5bWVudEludm9pY2VOdW1iZXJfY2FsbGJhY2spOwpmdW5jdGlvbiBzZXRDbGllbnRQYXltZW50SW52b2ljZU51bWJlcl9jYWxsYmFjaygpCnsKLy8gJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwp9Cn07Cgokc2NvcGUuJG9uKCJjbGllbnRQYWdlUmVsb2FkRGF0YSIsZnVuY3Rpb24oZSxhKQp7CmxvZ0RlYnVnKCJjbGllbnRQYWdlUmVsb2FkRGF0YSIpOwpnZXRCdXNpbmVzc1VzZXJQYWNrYWdlcygkaHR0cCwkc2NvcGUsJ3VzZXJfcGFja2FnZXMnLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKZ2V0Q2xpZW50UGF5bWVudHMoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLCdjdXJyZW50Q2xpZW50UGF5bWVudHMnKTsKZ2V0Q2xpZW50RXZlbnRzKCRodHRwLCRzY29wZSwnY3VycmVudENsaWVudEV2ZW50cycsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwpnZXRCdXNpbmVzc0NsaWVudEluZm8oJGh0dHAsJHNjb3BlLCdmb3JtVXBkYXRlQ2xpZW50QW5ndWxhcicsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwoKICAgICAgLy8gJHRpbWVvdXQoZnVuY3Rpb24oKQogICAgICAvLyB7CiAgICAgIC8vICAgJHNjb3BlLmN1cnNvcmRlbGV0ZT0iIjsKICAgICAgLy8gICBkb2N1bWVudC5ib2R5LnN0eWxlLmN1cnNvcj0nJzsKICAgICAgLy8gfSwgMjAwMCk7Cgp9KTsKCiRzY29wZS5pc0NvbmZpcm1lZE9yQ2xvc2VkID0gZnVuY3Rpb24oZXZlbnQpCnsKaWYgKCRzY29wZS5zaG93QWxsRXZlbnRzKQp7CnJldHVybiB0cnVlOwp9CgppZiAoKGV2ZW50LmlzX2NvbmZpcm1lZCA9PSAxKSB8fCAoZXZlbnQuaXNfZmluYWxfc3RhdHVzID09IDEpIHx8ICgoZXZlbnQuaXNfd2FpdGluZ19saXN0ID09IDEpICYmIChldmVudC5pc19jYW5jZWxlZCA9PSAwKSkpCnsKcmV0dXJuIHRydWU7Cn0KZWxzZQp7CnJldHVybiBmYWxzZTsKfQp9CiRzY29wZS5nb3RvQ2xpZW50RWRpdFBhZ2U9Z290b0NsaWVudEVkaXRQYWdlOwokc2NvcGUuZ290b0JhY2s9ZnVuY3Rpb24oKQp7CmxvZ0RlYnVnKCdnbyBiYWNrJyk7CndpbmRvdy5oaXN0b3J5LmJhY2soKTsKfTsKCiRzY29wZS5nb3RvRXZlbnRQYWdlID0gZnVuY3Rpb24gKHRoZWV2ZW50KQp7CmdvdG9FdmVudFBhZ2UodGhlZXZlbnQpOwp9Cn0KJHNjb3BlLmluaXRpYXRlUGF5bWVudCA9IGZ1bmN0aW9uKGlzcGx1cykKewpsb2dEZWJ1ZygiaW5pdGlhdGVQYXltZW50IGlzcGx1cyIraXNwbHVzKTsKdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CmFuaW1hdGlvbjogZmFsc2UsCnRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2NsaWVudF9wYXltZW50LnBocCcsCmNvbnRyb2xsZXI6ICdidXNpbmVzc0NsaWVuZENhcmRQYXltZW50JywKLy8gc2l6ZTogc2l6ZSwKcmVzb2x2ZTogewpjdXJyZW50Q2xpZW50OiBmdW5jdGlvbigpIHsKcmV0dXJuICRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXTsKfSwKaXNwbHVzOiBmdW5jdGlvbigpIHsKcmV0dXJuIGlzcGx1czsKfQp9Cn0pOwp9Cgokc2NvcGUudXBkYXRlVXNlckZpcnN0TmFtZSA9IGZ1bmN0aW9uKG5ld1ZhbHVlKQp7CnNldENsaWVudEZpcnN0TmFtZSgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsbmV3VmFsdWUsYWZ0ZXJDbGllbnRTZXQsYWZ0ZXJDbGllbnRTZXQpOwpmdW5jdGlvbiBhZnRlckNsaWVudFNldCgpCnsKZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKfQp9CiRzY29wZS51cGRhdGVVc2VyTGFzdE5hbWUgPSBmdW5jdGlvbihuZXdWYWx1ZSkKewpzZXRDbGllbnRMYXN0TmFtZSgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsbmV3VmFsdWUsYWZ0ZXJDbGllbnRTZXQsYWZ0ZXJDbGllbnRTZXQpOwpmdW5jdGlvbiBhZnRlckNsaWVudFNldCgpCnsKZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKfQp9CiRzY29wZS51cGRhdGVVc2VyRW1haWwgPSBmdW5jdGlvbihuZXdWYWx1ZSkKewpzZXRDbGllbnRFbWFpbCgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsbmV3VmFsdWUsYWZ0ZXJzZXRDbGllbnRFbWFpbCxhZnRlcnNldENsaWVudEVtYWlsKTsKZnVuY3Rpb24gYWZ0ZXJzZXRDbGllbnRFbWFpbCgpCnsKZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKfQp9CgoKJHNjb3BlLnVwZGF0ZVVzZXJQaG9uZU51bWJlciA9IGZ1bmN0aW9uKG5ld1ZhbHVlKQp7Cm5ld1ZhbHVlID0gbmV3VmFsdWUucmVwbGFjZSgnLScsJycpOwppZiAoaXNOYU4obmV3VmFsdWUpKQp7CmFsZXJ0KCLXkNeg15Ag15TXltefINee16HXpNeoINeY15zXpNeV158g16rXp9eZ158iKTsKZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKfQplbHNlCnsKc2V0Q2xpZW50UGhvbmVOdW1iZXIoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLG5ld1ZhbHVlLHNldENsaWVudFBob25lTnVtYmVyX2NhbGxiYWNrLHNldENsaWVudFBob25lTnVtYmVyX2NhbGxiYWNrKTsKZnVuY3Rpb24gc2V0Q2xpZW50UGhvbmVOdW1iZXJfY2FsbGJhY2soKQp7CmdldEJ1c2luZXNzQ2xpZW50SW5mbygkaHR0cCwkc2NvcGUsJ2Zvcm1VcGRhdGVDbGllbnRBbmd1bGFyJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7Cn0KfQp9CiRzY29wZS51cGRhdGVVc2VyRXZlbnRQcmljZSA9IGZ1bmN0aW9uKG5ld3ZhbHVlLCB0aGVldmVudCkKewpuZXdfcHJpY2U9bmV3dmFsdWU7CnNldENsaWVudEV2ZW50UHJpY2UoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLHRoZWV2ZW50LmV2ZW50X2lkLCBuZXdfcHJpY2Usc2V0Q2xpZW50RXZlbnRQcmljZV9jYWxsYmFjaywgc2V0Q2xpZW50RXZlbnRQcmljZV9jYWxsYmFjayk7CmZ1bmN0aW9uIHNldENsaWVudEV2ZW50UHJpY2VfY2FsbGJhY2soKQp7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKfQp9OwoKJHNjb3BlLnVwZGF0ZVVzZXJQYWNrYWdlRXZlbnRzQ291bnRlciA9IGZ1bmN0aW9uKG5ld3ZhbHVlLCB0aGVwYWNrYWdlKQp7CmV2ZW50c19jb3VudGVyPW5ld3ZhbHVlOwpzZXRVc2VyUGFja2FnZUV2ZW50c0NvdW50ZXIoJGh0dHAsJHNjb3BlLHRoZXBhY2thZ2UucGFja2FnZV91c2VyX2lkLGV2ZW50c19jb3VudGVyLHNldFVzZXJQYWNrYWdlRXZlbnRzQ291bnRlcl9jYWxsYmFjaywgc2V0VXNlclBhY2thZ2VFdmVudHNDb3VudGVyX2NhbGxiYWNrKQpmdW5jdGlvbiBzZXRVc2VyUGFja2FnZUV2ZW50c0NvdW50ZXJfY2FsbGJhY2soKQp7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKfQp9Owokc2NvcGUudXBkYXRlVXNlclBhY2thZ2VQYWNrYWdlUHJpY2UgPSBmdW5jdGlvbihuZXd2YWx1ZSwgdGhlcGFja2FnZSkKewpwYWNrYWdlX3ByaWNlPW5ld3ZhbHVlOwpzZXRVc2VyUGFja2FnZVBhY2thZ2VQcmljZSgkaHR0cCwkc2NvcGUsdGhlcGFja2FnZS5wYWNrYWdlX3VzZXJfaWQscGFja2FnZV9wcmljZSxzZXRVc2VyUGFja2FnZVBhY2thZ2VQcmljZV9jYWxsYmFjaywgc2V0VXNlclBhY2thZ2VQYWNrYWdlUHJpY2VfY2FsbGJhY2spCmZ1bmN0aW9uIHNldFVzZXJQYWNrYWdlUGFja2FnZVByaWNlX2NhbGxiYWNrKCkKewovLyBnZXRCdXNpbmVzc1VzZXJQYWNrYWdlcygkaHR0cCwkc2NvcGUsJ3VzZXJfcGFja2FnZXMnLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwp9Cn07Cgokc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXIgPSB7fTsKbG9nRGVidWcoJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwokc2NvcGUuc2hvd19jbGllbnRfdXBkYXRlX2NsaWVudCA9IHRydWU7CiRzY29wZS5zaG93X2NsaWVudF91cGRhdGVfc2F2ZSA9IGZhbHNlOwokc2NvcGUuc2hvd19jbGllbnRfZGVsZXRlX2NsaWVudCA9IHRydWU7CiRzY29wZS5zaG93X2NsaWVudF91cGRhdGVfY2FuY2VsID0gZmFsc2U7Cgokc2NvcGUudXBkYXRlQ2xpZW50RW5hYmxlID0gZnVuY3Rpb24oKSB7CmxvZ0RlYnVnKCJlbmFibGluZyBlZGl0aW5nICgkc2NvcGUuY2xpZW50c1VwZGF0ZURpc2FibGVkIHdhcyAiICsgJHNjb3BlLmNsaWVudHNVcGRhdGVEaXNhYmxlZCArICIpIik7CiRzY29wZS5jbGllbnRzVXBkYXRlRGlzYWJsZWQgPSBmYWxzZTsKJHNjb3BlLnNob3dfY2xpZW50X3VwZGF0ZV9jbGllbnQgPSBmYWxzZTsKJHNjb3BlLnNob3dfY2xpZW50X3VwZGF0ZV9zYXZlID0gdHJ1ZTsKJHNjb3BlLnNob3dfY2xpZW50X2RlbGV0ZV9jbGllbnQgPSBmYWxzZTsKJHNjb3BlLnNob3dfY2xpZW50X3VwZGF0ZV9jYW5jZWwgPSB0cnVlOwp9CiRzY29wZS51cGRhdGVDbGllbnREaXNhYmxlID0gZnVuY3Rpb24oKSB7CmxvZ0RlYnVnKCJkaXNhYmxlIGVkaXRpbmciKTsKLy8JCSRsb2NhdGlvbi5wYXRoKCcvQ2xpZW50cy8nKyRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKJHJvdXRlLnJlbG9hZCgpOwp9CiRzY29wZS5zY2hlZHVsZUV2ZW50RnJvbUVuZFVzZXIgPSBmdW5jdGlvbigpIHsKc2hhcmVkRGF0YS5zZXRTZWxlY3RlZEVuZFVzZXIoewppZDogJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsCmZpcnN0X25hbWU6ICRzY29wZS5jdXJyZW50Q2xpZW50LnVzZXJzWzBdLmZpcnN0X25hbWUsCmxhc3RfbmFtZTogJHNjb3BlLmN1cnJlbnRDbGllbnQudXNlcnNbMF0ubGFzdF9uYW1lCn0pOwpsb2dEZWJ1Zygic2NoZWR1bGUgZXZlbnQgZm9yIHVzZXIgIiArICRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKLy8JCSRsb2NhdGlvbi5wYXRoKCcvQ2xpZW50cy8nKyRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jYWxlbmRhcicpOwp9CgogICAgJHNjb3BlLnVzZXJEZWxldGVQYXltZW50ID0gZnVuY3Rpb24gKGZwYXltZW50KQogICAgewogICAgICAvLyAkc2NvcGUuY3Vyc29yZGVsZXRlPSJ3YWl0IjsKICAgICAgbG9nRGVidWcoInVzZXJEZWxldGVQYXltZW50Iik7CiAgICAgIC8vIGRvY3VtZW50LmJvZHkuc3R5bGUuY3Vyc29yPSd3YWl0JzsKCiAgICAgIGRlbGV0ZUNsaWVudFBheW1lbnRzKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCxmcGF5bWVudC51c2VyX3BheW1lbnRfaWQsZGVsZXRlQ2xpZW50UGF5bWVudHNfc3VjY2Vzc19jYWxsYmFjayk7CiAgICAgIGZ1bmN0aW9uIGRlbGV0ZUNsaWVudFBheW1lbnRzX3N1Y2Nlc3NfY2FsbGJhY2soKQogICAgICB7CiAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgICAgIGxvZ0RlYnVnKCJ1c2VyRGVsZXRlUGF5bWVudCIpOwogICAgICAgIC8vICRzY29wZS5jdXJzb3JkZWxldGU9IiI7CiAgICAgICAgLy8gZG9jdW1lbnQuYm9keS5zdHlsZS5jdXJzb3I9Jyc7CiAgICAgIH0KICAgIH0KLy8gcmVtb3ZlIGVuZCB1c2VyIGZyb20gZXZlbnQKJHNjb3BlLnVzZXJEZWxldGVFdmVudCA9IGZ1bmN0aW9uKGVuZHVzZXJfaWQsIHRoZWV2ZW50KQp7Ci8vIGlmIGl0J3MgYSBjbGFzcyAtIHdlIHNpbXBseSByZW1vdmUgdGhlIHVzZXIgZnJvbSB0aGUgZXZlbnQKaWYgKHRoZWV2ZW50LmlzX2NsYXNzPT0xKQp7CmxvZ0RlYnVnKCJzY29wZS51c2VyRGVsZXRlRXZlbnQiKTsKcmVtb3ZlRW5kVXNlckZyb21FdmVudCgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsdGhlZXZlbnQuZXZlbnRfaWQscmVtb3ZlRW5kVXNlckZyb21FdmVudF9maW5pc2gsIHJlbW92ZUVuZFVzZXJGcm9tRXZlbnRfZmluaXNoKTsKZnVuY3Rpb24gcmVtb3ZlRW5kVXNlckZyb21FdmVudF9maW5pc2goKQp7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKfQp9Ci8vIGlmIGl0cyBub3QgYSBjbGFzcyAtIHdlIG5lZWQgdG8gcmVtb3ZlIHRoZSBldmVudCBpdHNlbGYKZWxzZQp7Ci8vIGFsZXJ0KCJub3QgY2xhc3MgZXZlbnQsIFRPRE8iKTsKfQp9OwoKLy8gcmV0cmV2aW5nIHBhY2thZ2VzIGZvciB0aGUgYnVzaW5lc3MKZ2V0QnVzaW5lc3NQYWNrYWdlcygkaHR0cCwkc2NvcGUsJ3BhY2thZ2VzJyk7CgovLyBnZXQgcGFja2FnZXMgZm9yIHRoaXMgc3BlY2lmaWMgdXNlcgpnZXRCdXNpbmVzc1VzZXJQYWNrYWdlcygkaHR0cCwkc2NvcGUsJ3VzZXJfcGFja2FnZXMnLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKLy8gYWRkaW5nIHBhY2thZ2UgdG8gdXNlciAtIGNhbGxlZCB3aGVuIGEgcGFja2FnZSBpcyBzZWxlY3RlZAokc2NvcGUucGFja2FnZUZvckNsaWVudFNlbGVjdGVkID0gZnVuY3Rpb24oc2VsZWN0ZWRQYWNrYWdlKSB7CmlmIChzZWxlY3RlZFBhY2thZ2UpIHsKLy8gbG9nRGVidWcoJ3llcyBzZWxlY3RlZCAnICsgSlNPTi5zdHJpbmdpZnkoc2VsZWN0ZWRQYWNrYWdlKSk7CmFkZEJ1c2luZXNzUGFja2FnZVRvVXNlcigkaHR0cCwkc2NvcGUsc2VsZWN0ZWRQYWNrYWdlLm9yaWdpbmFsT2JqZWN0LCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLGFkZEJ1c2luZXNzUGFja2FnZVN1Y2Nlc3MpOwpmdW5jdGlvbiBhZGRCdXNpbmVzc1BhY2thZ2VTdWNjZXNzKCkKewpsb2dEZWJ1ZygiYWRkQnVzaW5lc3NQYWNrYWdlU3VjY2VzczIiKTsKLy8gZ2V0QnVzaW5lc3NQYWNrYWdlcygkaHR0cCwkc2NvcGUsJ3BhY2thZ2VzJyk7Ci8vIGdldEJ1c2luZXNzVXNlclBhY2thZ2VzKCRodHRwLCRzY29wZSwndXNlcl9wYWNrYWdlcycsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwokcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NsaWVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCn0KJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdhbmd1Y29tcGxldGUtYWx0OmNsZWFySW5wdXQnLCAnY2xpZW50X2FuZ3Vjb21wbGV0ZScpOwp9CmVsc2UKewovLyBsb2dEZWJ1Zygnbm90IHNlbGVjdGVkLCBkbyBub3RoaW5nJyk7Cn0KfTsKfSk7CgoKLy8gTmVlZCB0byBkaXN0aW5ndWlzaCBiZXR3ZWVuIGVuZCB1c2VyIChjbGllbnQpIGFuZCBidXNpbmVzcyBvd25lci4KLy8gY3VycmVudGx5IGNhbGxzIG9ubHkgZW5kIHVzZXIKa3V6ZUFwcC5jb250cm9sbGVyKCdIb21lQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICR1aWJNb2RhbCkKewoKZ2V0QWxsQ2xpZW50cygkaHR0cCwkc2NvcGUsJ2FsbENsaWVudHMnKTsKCiRzY29wZS5ob21lcGFnZUxpbWl0PTY7CmdldE9wZW5lZEV2ZW50cygkaHR0cCwkc2NvcGUsJHNjb3BlLmhvbWVwYWdlTGltaXQsJ29wZW5lZF9ldmVudHMnKTsKCnZhciB0b2RheWRhdGUgPSBuZXcgRGF0ZSgpOwp2YXIgaG93bWFueWRheXNhaGVhZD0zMDsKdmFyIHN0YXJ0ZGF0ZT10b2RheWRhdGUuZ2V0RnVsbFllYXIoKSsiLSIrKDErdG9kYXlkYXRlLmdldE1vbnRoKCkpKyItIit0b2RheWRhdGUuZ2V0RGF0ZSgpOwp0b2RheWRhdGUuc2V0RGF0ZSh0b2RheWRhdGUuZ2V0RGF0ZSgpICsgaG93bWFueWRheXNhaGVhZCk7CnZhciBlbmRkYXRlPXRvZGF5ZGF0ZS5nZXRGdWxsWWVhcigpKyItIisoMSt0b2RheWRhdGUuZ2V0TW9udGgoKSkrIi0iK3RvZGF5ZGF0ZS5nZXREYXRlKCk7CgovLyBmaWx0ZXIgZm9yIHVzZXJzIHdobyBoYXZlIGRlYnQKJHNjb3BlLmhhdmVEZWJ0ID0gZnVuY3Rpb24oZXVzZXIpCnsKaWYgKGV1c2VyLnVzZXJfYmFsYW5jZSA8IDApCnsKcmV0dXJuIHRydWU7Cn0KZWxzZQp7CnJldHVybiBmYWxzZTsKfQp9OwoKJHNjb3BlLmdvdG9DbGllbnRQYWdlID0gZnVuY3Rpb24oYnVzaW5lc3NfdXNlcl9pZCkKewovLyBsb2dEZWJ1ZyhldXNlcik7CndpbmRvdy5sb2NhdGlvbi5ocmVmPScvIy9idXNpbmVzc19jbGllbnRzLycgKyBidXNpbmVzc191c2VyX2lkOwp9Cgp2YXIgcGF5bG9hZCA9ICdzdGFydD0nICsgc3RhcnRkYXRlICsgJyZlbmQ9JyArIGVuZGRhdGU7CnZhciBjb25maWcgPSB7CmhlYWRlcnM6IHsnQ29udGVudC1UeXBlJzonYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkOyBjaGFyc2V0PVVURi04J30KfQogICAgdmFyIHBvc3R1cmwgPSAiL2FwaS9hZG1pbi9yZXBvcnRzL2V2ZW50czIiOwoKICAgICRzY29wZS5ldmVudFJlcG9ydENvbmZpZyA9IHt9OwogICAgJHNjb3BlLmV2ZW50UmVwb3J0Q29uZmlnLnNvdXJjZSA9ICJkb2NzIjsKICAgICRzY29wZS5ldmVudFJlcG9ydENvbmZpZy5maWx0ZXJzID0gewogICAgICBzdGFydF9kYXRlOiBzdGFydGRhdGUsCiAgICAgIGlzX2NhbmNlbGVkOiAnMCcsCiAgICAgIGVuZF9kYXRlOiBlbmRkYXRlCiAgICB9OwoKICAgIGdldEV2ZW50c1JlcG9ydCgkaHR0cCwkc2NvcGUsICRzY29wZS5ldmVudFJlcG9ydENvbmZpZywgZ2V0RXZlbnRzUmVwb3J0QWdncmVnYXRlZF9zdWNjZXNzKTsKCiAgICBmdW5jdGlvbiBnZXRFdmVudHNSZXBvcnRBZ2dyZWdhdGVkX3N1Y2Nlc3MocmVzcG9uc2UpewogICAgICAkc2NvcGUuYWRtaW5fZXZlbnRzID0gcmVzcG9uc2UuanNvbjsKICAgICAgICB9CiAgICAvLyAkaHR0cC5wb3N0KHBvc3R1cmwsIHBheWxvYWQsIGNvbmZpZykuc3VjY2VzcyhmdW5jdGlvbihkYXRhKQogICAgLy8gewogICAgLy8gICBsb2dEZWJ1ZygiZG9uZSIpOwogICAgLy8gICAkc2NvcGUuYWRtaW5fZXZlbnRzID0gZGF0YTsKICAgIC8vIH0pOwoKJHNjb3BlLnNob3dFdmVudFBvcHVwID0gZnVuY3Rpb24oc2VsZWN0ZWRFdmVudCkgewpzaG93RXZlbnRQb3B1cChzZWxlY3RlZEV2ZW50LCAkdWliTW9kYWwpCn07CiRzY29wZS5lZGl0RXZlbnQ9IGZ1bmN0aW9uICh0aGVldmVudCkKewpnb3RvRXZlbnRQYWdlKHRoZWV2ZW50KTsKfQp9KTsKCi8vIGt1emVBcHAuY29udHJvbGxlcignQnVzaW5lc3NDb25maWdDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJHJvdXRlUGFyYW1zLCAkbG9jYXRpb24sICRyb3V0ZSwgc2hhcmVkRGF0YSkgewoKa3V6ZUFwcC5jb250cm9sbGVyKCdDb25maWdVc2VyQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHVpYk1vZGFsLCAkaHR0cCwgJHRpbWVvdXQpCnsKJHNjb3BlLmluVGhlTWlkZGxlT2ZTYXZlPWZhbHNlOwoKbG9nRGVidWcoIkNvbmZpZ1VzZXJDb250cm9sbGVyIik7Ci8vICRzY29wZS5hamF4X2luZm89IteU16nXmdeg15XXmdeZ150g16DXqdee16jXlSI7CgogIGdldEJ1c2luZXNzVXNlclJlbGF0aW9ucygkaHR0cCwkc2NvcGUsJ2J1c2luZXNzX3VzZXJfcmVsYXRpb25zJyxnZXRMb2dnZWRVc2VySW5mb19zdWNjZXNzLGdldExvZ2dlZFVzZXJJbmZvX2ZhaWx1cmUpOwoKZ2V0TG9nZ2VkVXNlckluZm8oJGh0dHAsJHNjb3BlLCd1c2VyUHJvcGVydGllcycsZ2V0TG9nZ2VkVXNlckluZm9fc3VjY2VzcyxnZXRMb2dnZWRVc2VySW5mb19mYWlsdXJlKTsKZnVuY3Rpb24gZ2V0TG9nZ2VkVXNlckluZm9fc3VjY2VzcygpCnsKbG9nRGVidWcoImdldExvZ2dlZFVzZXJJbmZvX3N1Y2Nlc3MiKTsKICAgIC8vICRzY29wZS51c2VyUHJvcGVydGllc0R1cGxpY2F0ZSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoJHNjb3BlLnVzZXJQcm9wZXJ0aWVzKSk7Cn0KZnVuY3Rpb24gZ2V0TG9nZ2VkVXNlckluZm9fZmFpbHVyZSgpCnsKbG9nRGVidWcoImdldExvZ2dlZFVzZXJJbmZvX2ZhaWx1cmUiKTsKfQoKJHNjb3BlLmJhY2sgPSBmdW5jdGlvbigpIHsKd2luZG93Lmhpc3RvcnkuYmFjaygpOwp9OwoKJHNjb3BlLmNoYW5nZVBhc3N3b3JkTW9kYWwgPSBmdW5jdGlvbigpCnsKICAgIGxvZ0RlYnVnKCJjaGFuZ2VQYXNzd29yZE1vZGFsIiskc2NvcGUudXNlclByb3BlcnRpZXNEdXBsaWNhdGVbMF0pOwokc2NvcGUuaW5UaGVNaWRkbGVPZlNhdmU9dHJ1ZTsKZnVuY3Rpb24gc21zUmVzZXRQYXNzd29yZF9zdWNjZXNzKCkKewpjb25zb2xlLmxvZygic21zUmVzZXRQYXNzd29yZF9zdWNjZXNzIik7CnZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewphbmltYXRpb246IGZhbHNlLAp0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdtb2RhbF9jaGFuZ2VfcGFzc3dvcmQucGhwJywKY29udHJvbGxlcjogJ21vZGFsX2NoYW5nZV9wYXNzd29yZCcsCnNpemU6ICdsJywKcmVzb2x2ZTogewp1c2VyX3Bob25lX251bWJlcjogZnVuY3Rpb24oKSB7Ci8vIHBhc3Npbmcgb3JpZ2luYWwgcGhvbmUgbnVtYmVyCnJldHVybiAkc2NvcGUudXNlclByb3BlcnRpZXNEdXBsaWNhdGVbMF0ucGhvbmVfbnVtYmVyOwp9Cn0KfSk7Cgptb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHJlc3VsdCkgewokc2NvcGUuaW5UaGVNaWRkbGVPZlNhdmU9ZmFsc2U7CmxvZ0RlYnVnKCdzbXNSZXNldFBhc3N3b3JkIE1vZGFsIGZpbmlzZWhkIHJlc3VsdDogJyArIHJlc3VsdCk7CiRzY29wZS5hamF4X2luZm89IteU16HXmdeh157XkCDXoteV15PXm9eg15Qg15HXlNem15zXl9eUISI7Ci8vIGdldExvZ2dlZFVzZXJJbmZvKCRodHRwLCRzY29wZSwndXNlclByb3BlcnRpZXMnLGdldExvZ2dlZFVzZXJJbmZvX3N1Y2Nlc3MsZ2V0TG9nZ2VkVXNlckluZm9fZmFpbHVyZSk7CiR0aW1lb3V0KGZ1bmN0aW9uKCkKewokc2NvcGUuYWpheF9pbmZvPW51bGw7Cn0sIDIwMDApOwpsb2dEZWJ1Zygnc21zUmVzZXRQYXNzd29yZCBNb2RhbCBkaXNtaXNzZWQgYXQ6ICcgKyBuZXcgRGF0ZSgpKTsKfSwgZnVuY3Rpb24oKSB7CiRzY29wZS5pblRoZU1pZGRsZU9mU2F2ZT1mYWxzZTsKbG9nRGVidWcoJ21vZGFsX2NoYW5nZV9wYXNzd29yZCBNb2RhbCBkaXNtaXNzZWQgYXQ6ICcgKyBuZXcgRGF0ZSgpKTsKfSk7Cn0KCgpjaGFuZ2VQYXNzd29yZFNNUygkaHR0cCwkc2NvcGUsJHNjb3BlLnVzZXJQcm9wZXJ0aWVzRHVwbGljYXRlWzBdLnBob25lX251bWJlcixzbXNSZXNldFBhc3N3b3JkX3N1Y2Nlc3MpOwp9CiRzY29wZS51cGRhdGVVc2VyQ29uZmlnPWZ1bmN0aW9uKCkKewokc2NvcGUuaW5UaGVNaWRkbGVPZlNhdmU9dHJ1ZTsKbG9nRGVidWcoInVwZGF0ZVVzZXJDb25maWcsIGluVGhlTWlkZGxlT2ZTYXZlPSIrJHNjb3BlLmluVGhlTWlkZGxlT2ZTYXZlKTsKLy8gbG9nRGVidWcoJHNjb3BlLnVzZXJQcm9wZXJ0aWVzRHVwbGljYXRlKTsKLy8gbG9nRGVidWcoJHNjb3BlLnVzZXJQcm9wZXJ0aWVzKTsKaWYgKGFuZ3VsYXIuZXF1YWxzKCRzY29wZS51c2VyUHJvcGVydGllc0R1cGxpY2F0ZVswXS5waG9uZV9udW1iZXIsJHNjb3BlLnVzZXJQcm9wZXJ0aWVzWzBdLnBob25lX251bWJlcikpCnsKbG9nRGVidWcoIm5vdGhpbmcgY2hhbmdlZCBpbiBwaG9uZSBudW1iZXIsIGNoZWNraW5nIG90aGVyIGRhdGEgb3RoZXIgZGF0YSIpOwppZiAoYW5ndWxhci5lcXVhbHMoJHNjb3BlLnVzZXJQcm9wZXJ0aWVzRHVwbGljYXRlWzBdLCRzY29wZS51c2VyUHJvcGVydGllc1swXSkpCnsKJHNjb3BlLmluVGhlTWlkZGxlT2ZTYXZlPWZhbHNlOwpsb2dEZWJ1Zygibm90aGluZyBjaGFuZ2VkIGluIGRldGFpbHMsIG5vdGhpbmcgdG8gc2F2ZSIpOwokc2NvcGUuYWpheF9pbmZvPSLXnNeQINeR15XXptei15Ug16nXmdeg15XXmdeZ150g15zXqdee15nXqNeULi4uIjsKJHRpbWVvdXQoZnVuY3Rpb24oKQp7CiRzY29wZS5hamF4X2luZm89bnVsbDsKfSwgMTUwMCk7Cn0KZWxzZQp7CmNoYW5nZVVzZXJEZXRhaWxzKCRodHRwLCRzY29wZSwkc2NvcGUudXNlclByb3BlcnRpZXNbMF0uZmlyc3RfbmFtZSwkc2NvcGUudXNlclByb3BlcnRpZXNbMF0ubGFzdF9uYW1lLCAkc2NvcGUudXNlclByb3BlcnRpZXNbMF0uZW1haWxfYWRkcmVzcyxjaGFuZ2VVc2VyRGV0YWlsc19zdWNjZXNzLCBjaGFuZ2VVc2VyRGV0YWlsc19mYWlsdXJlKTsKJHNjb3BlLmFqYXhfaW5mbz0i157XoteT15vXnyDXqdeZ16DXldeZ15nXnS4uLiI7Cn0KCmZ1bmN0aW9uIGNoYW5nZVVzZXJEZXRhaWxzX3N1Y2Nlc3MoKQp7CmxvZ0RlYnVnKCJjaGFuZ2VVc2VyRGV0YWlsc19zdWNjZXNzIik7CiRzY29wZS5hamF4X2luZm89IteU16nXmdeg15XXmdeZ150g16DXqdee16jXlSDXkdeU16bXnNeX15QhIjsKJHNjb3BlLmluVGhlTWlkZGxlT2ZTYXZlPWZhbHNlOwokdGltZW91dChmdW5jdGlvbigpCnsKJHNjb3BlLmFqYXhfaW5mbz1udWxsOwp9LCAxNTAwKTsKZ2V0TG9nZ2VkVXNlckluZm8oJGh0dHAsJHNjb3BlLCd1c2VyUHJvcGVydGllcycsZ2V0TG9nZ2VkVXNlckluZm9fc3VjY2VzcyxnZXRMb2dnZWRVc2VySW5mb19mYWlsdXJlKTsKfQpmdW5jdGlvbiBjaGFuZ2VVc2VyRGV0YWlsc19mYWlsdXJlKCkKewpsb2dEZWJ1ZygiY2hhbmdlVXNlckRldGFpbHNfZmFpbHVyZSIpOwp9Cgp9CmVsc2UKewovLyB1cGRhdGUgdXNlciBpbmZvIC0gYWZ0ZXIgdmVyaWZ5aW5nIHBhc3N3b3JkCmNvbnNvbGUubG9nKCJwaG9uZSBjaGFuZ2VkLCBjaGVja2luZyBpZiBuZXcgcGhvbmUgaXMgaW4gZGVzY2VudCBmb3JtYXQiKTsKaWYgKCFjaGVja1Bob25lTnVtYmVyKCRzY29wZS51c2VyUHJvcGVydGllc1swXS5waG9uZV9udW1iZXIpKQp7CiRzY29wZS5hamF4X2luZm89IteQ16DXkCDXlNeW158g157Xodek16gg15jXnNek15XXnyDXodec15XXnNeo15kg16rXp9eZ158g15zXp9eR15zXqiDXlNeV15PXoteV16og157Xp9eZ15XXli4iOwokdGltZW91dChmdW5jdGlvbigpCnsKJHNjb3BlLmFqYXhfaW5mbz1udWxsOwp9LCAzMDAwKTsKcmV0dXJuOwp9CmNvbnNvbGUubG9nKCJwaG9uZSBjaGFuZ2VkLCBjaGVja2luZyBpZiBuZXcgcGhvbmUgaXMgbm90IHVzZWQgYWxyZWFkeSIpOwppc05ld1Bob25lVXNlZElmTm90U2VuZFNNUygkaHR0cCwkc2NvcGUsJHNjb3BlLnVzZXJQcm9wZXJ0aWVzWzBdLnBob25lX251bWJlciwgaXNOZXdQaG9uZVVzZWRfc3VjY2VzcywgaXNOZXdQaG9uZVVzZWRfZmFpbHVyZSxmYWxzZSk7CmZ1bmN0aW9uIGlzTmV3UGhvbmVVc2VkX3N1Y2Nlc3MocmVzcG9uc2UpCnsKY29uc29sZS5sb2coInBob25lIG5vdCB1c2VkIC0gcHJvbXB0aW5nIGZvciBwYXNzd29yZCIpOwp2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKYW5pbWF0aW9uOiBmYWxzZSwKdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnbW9kYWxfY2hlY2tfcGFzc3dvcmRfdXBkYXRlX2NvbmZpZy5waHAnLApjb250cm9sbGVyOiAnbW9kYWxfY2hlY2tfcGFzc3dvcmRfdXBkYXRlX2NvbmZpZycsCnNpemU6ICdsJywKcmVzb2x2ZTogewpuZXdfdXNlcl9wcm9lcnRpZXM6IGZ1bmN0aW9uKCkgewpyZXR1cm4gJHNjb3BlLnVzZXJQcm9wZXJ0aWVzWzBdOwp9Cn0KfSk7Cgptb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHJlc3VsdCkgewpsb2dEZWJ1ZygnbW9kYWxfY2hlY2tfcGFzc3dvcmRfdXBkYXRlX2NvbmZpZyBNb2RhbCBmaW5pc2hlZCByZXN1bHQ6ICcgKyByZXN1bHQpOwokc2NvcGUuYWpheF9pbmZvPSLXlNep15nXoNeV15nXmdedINeg16nXnteo15Ug15HXlNem15zXl9eUISI7CiRzY29wZS5pblRoZU1pZGRsZU9mU2F2ZT1mYWxzZTsKZ2V0TG9nZ2VkVXNlckluZm8oJGh0dHAsJHNjb3BlLCd1c2VyUHJvcGVydGllcycsZ2V0TG9nZ2VkVXNlckluZm9fc3VjY2VzcyxnZXRMb2dnZWRVc2VySW5mb19mYWlsdXJlKTsKJHRpbWVvdXQoZnVuY3Rpb24oKQp7CiRzY29wZS5hamF4X2luZm89bnVsbDsKfSwgMzAwMCk7Cn0sIGZ1bmN0aW9uKCkgewokc2NvcGUuaW5UaGVNaWRkbGVPZlNhdmU9ZmFsc2U7CmxvZ0RlYnVnKCdtb2RhbF9jaGVja19wYXNzd29yZF91cGRhdGVfY29uZmlnIE1vZGFsIGRpc21pc3NlZCBhdDogJyArIG5ldyBEYXRlKCkpOwp9KTsKfQoKZnVuY3Rpb24gaXNOZXdQaG9uZVVzZWRfZmFpbHVyZShyZXNwb25zZSkKewokc2NvcGUuYWpheF9pbmZvPXJlc3BvbnNlLm1lc3NhZ2U7CiR0aW1lb3V0KGZ1bmN0aW9uKCkKewokc2NvcGUuYWpheF9pbmZvPW51bGw7Cn0sIDIwMDApOwp9Cn0KfTsKfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdtb2RhbF9jaGVja19wYXNzd29yZF91cGRhdGVfY29uZmlnJywgZnVuY3Rpb24oJHNjb3BlLCAkdGltZW91dCwgJHVpYk1vZGFsSW5zdGFuY2UsIG5ld191c2VyX3Byb2VydGllcywgJGh0dHApCnsKJHNjb3BlLm5ld191c2VyX3Byb2VydGllcz1uZXdfdXNlcl9wcm9lcnRpZXM7CmxvZ0RlYnVnKCJtb2RhbF9jaGVja19wYXNzd29yZF91cGRhdGVfY29uZmlnIGNvbnRyb2xsZXIiKTsKLy8gJHNjb3BlLnBob25lX3ZlcmlmaWNhdGlvbiA9IHt9OyAvLyB0aGVzZSBhcmUgdGhlIGNvbXBsZXRlIGRldGFpbHMgZm9yIHRoZSBuZXcgZXZlbnQgLy8KLy8gJHNjb3BlLnBob25lX3ZlcmlmaWNhdGlvbi5waG9uZV9udW1iZXI9bmV3X3VzZXJfcHJvZXJ0aWVzLnBob25lX251bWJlcjsKJHNjb3BlLmNsb3NlID0gZnVuY3Rpb24oKSB7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCdkaXNtaXNzJyk7Cn07Cgokc2NvcGUuY2hhbmdlUGhvbmVOdW1iZXIgPSBmdW5jdGlvbigpCnsKY2hhbmdlVXNlckRldGFpbHNWZXJpZnkoJGh0dHAsJHNjb3BlLCRzY29wZS5uZXdfdXNlcl9wcm9lcnRpZXMucGhvbmVfbnVtYmVyLCRzY29wZS5uZXdfdXNlcl9wcm9lcnRpZXMuZmlyc3RfbmFtZSwkc2NvcGUubmV3X3VzZXJfcHJvZXJ0aWVzLmxhc3RfbmFtZSwgJHNjb3BlLm5ld191c2VyX3Byb2VydGllcy5lbWFpbF9hZGRyZXNzLCRzY29wZS52ZXJpZnlfdXNlcl9wYXNzd29yZCwkc2NvcGUucGhvbmVfdmVyaWZpY2F0aW9uLGNoYW5nZVVzZXJEZXRhaWxzVmVyaWZ5X3N1Y2Nlc3MsIGNoYW5nZVVzZXJEZXRhaWxzVmVyaWZ5X2ZhaWx1cmUsZmFsc2UpOwpmdW5jdGlvbiBjaGFuZ2VVc2VyRGV0YWlsc1ZlcmlmeV9zdWNjZXNzKCkKewpsb2dEZWJ1ZygiY2hhbmdlVXNlckRldGFpbHNWZXJpZnlfc3VjY2VzcyIpOwovLyBhbGVydCgn15TXqdeZ16DXldeZ15nXnSDXoteV15PXm9eg15Ug15HXlNem15zXl9eUJyk7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKHRydWUpOwp9CmZ1bmN0aW9uIGNoYW5nZVVzZXJEZXRhaWxzVmVyaWZ5X2ZhaWx1cmUocmVzcG9uc2UpCnsKbG9nRGVidWcoImNoYW5nZVVzZXJEZXRhaWxzVmVyaWZ5X2ZhaWx1cmUgIityZXNwb25zZS5tZXNzYWdlKTsKJHNjb3BlLmFqYXhfZXJyb3I9cmVzcG9uc2UubWVzc2FnZSsiLiI7CiR0aW1lb3V0KGZ1bmN0aW9uKCkKewokc2NvcGUuYWpheF9lcnJvcj1udWxsOwp9LCA0MDAwKTsKfQp9Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignbW9kYWxfY2hhbmdlX3Bhc3N3b3JkJywgZnVuY3Rpb24oJHNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgdXNlcl9waG9uZV9udW1iZXIsICRodHRwKQp7CmxvZ0RlYnVnKCJtb2RhbF9jaGFuZ2VfcGFzc3dvcmQgY29udHJvbGxlciIpOwokc2NvcGUucGhvbmVfdmVyaWZpY2F0aW9uID0ge307IC8vIHRoZXNlIGFyZSB0aGUgY29tcGxldGUgZGV0YWlscyBmb3IgdGhlIG5ldyBldmVudCAvLwokc2NvcGUucGhvbmVfdmVyaWZpY2F0aW9uLnBob25lX251bWJlcj11c2VyX3Bob25lX251bWJlcjsKJHNjb3BlLnBob25lX3ZlcmlmaWNhdGlvbi5zbXNfZXJyb3I9IiI7CiRzY29wZS5jbG9zZSA9IGZ1bmN0aW9uKCkgewokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnZGlzbWlzcycpOwp9OwoKJHNjb3BlLmNoYW5nZVBhc3N3b3JkID0gZnVuY3Rpb24oKQp7CmNoYW5nZVBhc3N3b3JkKCRodHRwLCRzY29wZSwkc2NvcGUucGhvbmVfdmVyaWZpY2F0aW9uLnVzZXJfcGFzc3dvcmQsJHNjb3BlLnBob25lX3ZlcmlmaWNhdGlvbi51c2VyX3Bhc3N3b3JkMiwkc2NvcGUucGhvbmVfdmVyaWZpY2F0aW9uLnZlcmlmaWNhdGlvbl9jb2RlLCBjaGFuZ2VQYXNzd29yZF9zdWNjZXNzLCBjaGFuZ2VQYXNzd29yZF9mYWlsdXJlLGZhbHNlKTsKJHNjb3BlLmFqYXhfZXJyb3I9IiI7CmZ1bmN0aW9uIGNoYW5nZVBhc3N3b3JkX3N1Y2Nlc3MoKQp7CmxvZ0RlYnVnKCJjaGFuZ2VQYXNzd29yZF9zdWNjZXNzIik7CnN0YXR1cz0iZmZmZmYiOwovLyBhbGVydCgn15TXodeZ16HXnteQINei15XXk9eb16DXlCDXkdeU16bXnNeX15QnKTsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UodHJ1ZSk7Cn0KZnVuY3Rpb24gY2hhbmdlUGFzc3dvcmRfZmFpbHVyZShyZXNwb25zZSkKewpsb2dEZWJ1ZygiY2hhbmdlUGFzc3dvcmRfZmFpbHVyZSAiK3Jlc3BvbnNlLm1lc3NhZ2UpOwokc2NvcGUuYWpheF9lcnJvcj1yZXNwb25zZS5tZXNzYWdlOwp9Cn0KfSk7CgprdXplQXBwLmZhY3RvcnkoJ0J1c2luZXNzQ29uZmlnJywgZnVuY3Rpb24oJGh0dHApIHsKcmV0dXJuIHsKZ2V0OiBmdW5jdGlvbiAoKSB7CmxvZ0RlYnVnKCJsb2FkIGdldF9idXNpbmVzc19jb25maWciKTsKcmV0dXJuICRodHRwLmdldCgiL2FwaS9hZG1pbi9idXNpbmVzc19jb25maWciKQoudGhlbihmdW5jdGlvbihyZXNwb25zZSkgewpyZXN1bHQgPSByZXNwb25zZS5kYXRhWzBdOwpyZXN1bHQudXNlX2hvbGlkYXlzPSEhcGFyc2VJbnQocmVzcG9uc2UuZGF0YVswXS51c2VfaG9saWRheXMpOwpyZXN1bHQuc21zX25vdGlmaWNhdGlvbnM9ISFwYXJzZUludChyZXNwb25zZS5kYXRhWzBdLnNtc19ub3RpZmljYXRpb25zKTsKcmVzdWx0LnN0YXJ0X2ludm9pY2VfbnVtYmVyID0gcGFyc2VJbnQocmVzcG9uc2UuZGF0YVswXS5zdGFydF9pbnZvaWNlX251bWJlcik7CnZhciBkID0gbmV3IERhdGUoKTsKZC5zZXRIb3VycyggcmVzdWx0LmNhbGVuZGFyX2Rpc3BsYXlfc3RhcnRfaG91cnMgKTsKZC5zZXRNaW51dGVzKCByZXN1bHQuY2FsZW5kYXJfZGlzcGxheV9zdGFydF9taW51dGVzICk7CnJlc3VsdC5teXRpbWUgPSBkOwpyZXN1bHQuY2FsZW5kYXJfZGlzcGxheV9zdGFydCA9IGQ7CnZhciBkID0gbmV3IERhdGUoKTsKZC5zZXRIb3VycyggcmVzdWx0LmNhbGVuZGFyX2Rpc3BsYXlfZW5kX2hvdXJzICk7CmQuc2V0TWludXRlcyggcmVzdWx0LmNhbGVuZGFyX2Rpc3BsYXlfZW5kX21pbnV0ZXMgKTsKcmVzdWx0Lm15dGltZSA9IGQ7CnJlc3VsdC5jYWxlbmRhcl9kaXNwbGF5X2VuZCA9IGQ7CnJlc3VsdC52YXRfcmF0ZSA9IE51bWJlcihyZXN1bHQudmF0X3JhdGUpOwpyZXR1cm4gcmVzdWx0Owp9KTsKfQp9Owp9KTsKCmt1emVBcHAuY29udHJvbGxlcignQ29uZmlnQnVzaW5lc3NDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJHRpbWVvdXQsIEJ1c2luZXNzQ29uZmlnKQp7CmxvZ0RlYnVnKCJteSBidXNpbmVzcyBjb25maWciKTsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXM9W107CgpmdW5jdGlvbiBnZXRfYnVzaW5lc3NfY29uZmlnKCkgewpsb2dEZWJ1ZygiZ2V0X2J1c2luZXNzX2NvbmZpZyIpOwpsb2dEZWJ1ZygiQnVzaW5lc3NDb25maWc6ICIsIEJ1c2luZXNzQ29uZmlnKTsKQnVzaW5lc3NDb25maWcuZ2V0KCkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7ICRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMgPSByZXN1bHQ7IH0pOwp9CmdldF9idXNpbmVzc19jb25maWcoKTsKCgokc2NvcGUuaHN0ZXAgPSAxOwokc2NvcGUubXN0ZXAgPSAxNTsKCiRzY29wZS5idXNpbmVzc0NvbmZpZ0NhbmNlbCA9IGZ1bmN0aW9uKCkgewp3aW5kb3cuaGlzdG9yeS5iYWNrKCk7Cn07Cgokc2NvcGUudXBkYXRlQnVzaW5lc3NDb25maWcgPSBmdW5jdGlvbigpIHsKbG9nRGVidWcoInVwZGF0aW5nIGJ1c2luZXNzIGNvbmZpZyIgKyBKU09OLnN0cmluZ2lmeSgkc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzKSk7Cgokc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzX2FqYXhfZXJyb3I9IiI7CiRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMuY2FsZW5kYXJfZGlzcGxheV9zdGFydF9ob3Vycz0kc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzLmNhbGVuZGFyX2Rpc3BsYXlfc3RhcnQuZ2V0SG91cnMoKTsKJHNjb3BlLmJ1c2luZXNzUHJvcGVydGllcy5jYWxlbmRhcl9kaXNwbGF5X3N0YXJ0X21pbnV0ZXM9JHNjb3BlLmJ1c2luZXNzUHJvcGVydGllcy5jYWxlbmRhcl9kaXNwbGF5X3N0YXJ0LmdldE1pbnV0ZXMoKTsKJHNjb3BlLmJ1c2luZXNzUHJvcGVydGllcy5jYWxlbmRhcl9kaXNwbGF5X2VuZF9ob3Vycz0kc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzLmNhbGVuZGFyX2Rpc3BsYXlfZW5kLmdldEhvdXJzKCk7CiRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMuY2FsZW5kYXJfZGlzcGxheV9lbmRfbWludXRlcz0kc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzLmNhbGVuZGFyX2Rpc3BsYXlfZW5kLmdldE1pbnV0ZXMoKTsKaWYgKCRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMuY2FsZW5kYXJfZGlzcGxheV9zdGFydF9ob3Vycz4kc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzLmNhbGVuZGFyX2Rpc3BsYXlfZW5kX2hvdXJzKQp7CmFsZXJ0KCfXltee158g16HXmdeV150g15zXkCDXmdeb15XXnCDXnNeU15nXldeqINec16TXoNeZINeW157XnyDXlNeq15fXnNeUJyk7CnJldHVybjsKfQokc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzX2FqYXhfZXJyb3I9Itee16LXk9eb158g16DXqteV16DXmdedLi4uIjsKCiRodHRwKHsKbWV0aG9kOiAnUE9TVCcsCnVybDogJy9hcGkvYWRtaW4vYnVzaW5lc3NfY29uZmlnL3NldCcsCmRhdGE6ICRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMsIC8vIHBhc3MgaW4gZGF0YSBhcyBzdHJpbmdzCmhlYWRlcnM6IHsKJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uO2NoYXJzZXQ9dXRmLTgnCn0KfSkuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7Cgpsb2dEZWJ1ZyhkYXRhKTsKaWYgKCFkYXRhLnN1Y2Nlc3MpIHsKbG9nRGVidWcoImVycm9yICIgKyBkYXRhLk1lc3NhZ2UpOwokc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzX2FqYXhfZXJyb3IgPSBkYXRhLk1lc3NhZ2U7Cn0gZWxzZSB7CiRnQ2FsZW5kYXJEaXNwbGF5TWluVGltZT1kYXRhLmpzb24ubmV3U3RhcnRUaW1lOwokZ0NhbGVuZGFyRGlzcGxheU1heFRpbWU9ZGF0YS5qc29uLm5ld0VuZFRpbWU7CmNvbnNvbGUubG9nKCJ1cGRhdGVkIGdDYWxlbmRhckRpc3BsYXlNaW5UaW1lPSIrJGdDYWxlbmRhckRpc3BsYXlNaW5UaW1lKTsKY29uc29sZS5sb2coInVwZGF0ZWQgZ0NhbGVuZGFyRGlzcGxheU1heFRpbWU9IiskZ0NhbGVuZGFyRGlzcGxheU1heFRpbWUpOwokc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzX2FqYXhfZXJyb3I9Itei15XXk9eb158g15HXlNem15zXl9eUISI7CiR0aW1lb3V0KGZ1bmN0aW9uKCkKewokc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzX2FqYXhfZXJyb3I9bnVsbDsKfSwgMjAwMCk7CmdldF9idXNpbmVzc19jb25maWcoKTsKLy8gd2luZG93Lmhpc3RvcnkuYmFjaygpOwovLyAkc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzX2FqYXhfZXJyb3IgPSAi16TXqNeY15kg15TXoteh16cg16DXqdee16jXlSDXkdeU16bXnNeX15QuIjsKCn0KfSk7Cn07Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignY2xpZW50Q2FyZENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUpIHsKbG9nRGVidWcoImNsaWVudENhcmRDb250cm9sbGVyIik7CiRzY29wZS5mdXR1cmVNZWV0aW5ncyA9IFt7CmRhdGV0aW1lOiAi16jXkNep15XXnywgMjUuMS4yMDE2IiwKaG91cjogIjE0OjAwIiwKdHlwZTogIten15HXldem15QiLApwcmljZTogIjEwMCIsCmxhYmVsczogW3sKbGFiZWw6ICJzdWNjZXNzIiwKdGV4dDogItep15XXnNedIgp9LCB7CmxhYmVsOiAid2FybmluZyIsCnRleHQ6ICLXnNeQINeq15XXoteTIgp9XQp9LCB7CmRhdGV0aW1lOiAi16jXkNep15XXnywgMjUuMS4yMDE2IiwKaG91cjogIjE0OjAwIiwKdHlwZTogIten15HXldem15QiLApwcmljZTogIjEwMCIsCmxhYmVsczogW3sKbGFiZWw6ICJkYW5nZXIiLAp0ZXh0OiAi15zXkCDXqdeV15zXnSIKfSwgewpsYWJlbDogImluZm8iLAp0ZXh0OiAi16rXldei15MiCn1dCn0sIHsKZGF0ZXRpbWU6ICLXqdec15nXqdeZLCAyNS4xLjIwMTYiLApob3VyOiAiMTQ6MDAiLAp0eXBlOiAi16fXkdeV16bXlCIsCnByaWNlOiAiMTAwIiwKbGFiZWxzOiBbewpsYWJlbDogImRhbmdlciIsCnRleHQ6ICLXnNeQINep15XXnNedIgp9LCB7CmxhYmVsOiAiaW5mbyIsCnRleHQ6ICLXqteV16LXkyIKfV0KfSwgewpkYXRldGltZTogIteo15DXqdeV158sIDI1LjEuMjAxNiIsCmhvdXI6ICIxNDowMCIsCnR5cGU6ICLXp9eR15XXpteUIiwKcHJpY2U6ICIxMDAiCn0sIF0KCiRzY29wZS5oaXN0b3J5TWVldGluZ3MgPSBbewpkYXRldGltZTogIteo15DXqdeV158sIDI1LjEuMjAxNiIsCmhvdXI6ICIxNDowMCIsCnR5cGU6ICLXp9eR15XXpteUIiwKcHJpY2U6ICIxMDAiCn0sIHsKZGF0ZXRpbWU6ICLXqNeQ16nXldefLCAyNS4xLjIwMTYiLApob3VyOiAiMTQ6MDAiLAp0eXBlOiAi16fXkdeV16bXlCIsCnByaWNlOiAiMTAwIgp9LCB7CmRhdGV0aW1lOiAi16nXnNeZ16nXmSwgMjUuMS4yMDE2IiwKaG91cjogIjE0OjAwIiwKdHlwZTogIten15HXldem15QiLApwcmljZTogIjEwMCIKfSwgewpkYXRldGltZTogIteo15DXqdeV158sIDI1LjEuMjAxNiIsCmhvdXI6ICIxNDowMCIsCnR5cGU6ICLXp9eR15XXpteUIiwKcHJpY2U6ICIxMDAiCn0sIF0KCiRzY29wZS5jY1BheW1lbnRzID0gW3sKZGF0ZXRpbWU6ICLXqNeQ16nXldefLCAyNS4xLjIwMTYiLApyZWNpcHRfbnVtOiAiNzY3IiwKYW1vdW50OiAiMzAwIiwKbGFiZWxzOiBbewpsYWJlbDogImRhbmdlciIsCnRleHQ6ICLXnNeQINep15XXmdeZ15oiCn0sIHsKbGFiZWw6ICJpbmZvIiwKdGV4dDogIteU15XXpNen15MiCn1dCn0sIF0KCgp9KTsKCmt1emVBcHAuY29udHJvbGxlcigna3V6ZUNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkbG9jYXRpb24pIHsKCi8vIG1haW4ga3V6ZSBjb250cm9sbGVyCgovLyBNVVNUIFNFVCBMQU5HVUFHRSBCRUZPUkUgQU5ZIE9USEVSIE9QRVJBVElPTiAhISEKdXBkYXRlR2xvYmFsTGFuZ3VhZ2UoJHNjb3BlLCAkZ0RlZmF1bHRMYW5nKTsKLy8gTVVTVCBTRVQgTEFOR1VBR0UgQkVGT1JFIEFOWSBPVEhFUiBPUEVSQVRJT04gISEhCgovLyBsb2dEZWJ1ZygieHh4eHh4eHgiICsgJHNjb3BlLmxhbmdmaWxlWydzaG93X2FsbF9jbGllbnRzJ10pOwoKJHNjb3BlLnNob3dDbGllbnRzQ29sdW1ucyA9IFt7CmZpZWxkOiAndXNlcl9pZCcsCm5hbWU6ICRzY29wZS5sYW5nZmlsZVsnc2hvd19hbGxfY2xpZW50c191c2VyaWQnXQp9LCB7CmZpZWxkOiAnYnVzZXJfZmlyc3RfbmFtZScsCm5hbWU6ICRzY29wZS5sYW5nZmlsZVsnc2hvd19hbGxfY2xpZW50c19maXJzdF9uYW1lJ10KfSwgewpmaWVsZDogJ2J1c2VyX2xhc3RfbmFtZScsCm5hbWU6ICRzY29wZS5sYW5nZmlsZVsnc2hvd19hbGxfY2xpZW50c19sYXN0X25hbWUnXQp9LCB7CmZpZWxkOiAncm9sZV9uYW1lJywKbmFtZTogJHNjb3BlLmxhbmdmaWxlWydzaG93X2FsbF9jbGllbnRzX2FwcHJvdmVkJ10KfV07CgoKJHNjb3BlLmdyaWRDbGllbnRDbGljayA9IGZ1bmN0aW9uKHJvdykgewovL2xvZ0RlYnVnKHJvdyk7CnZhciByb3dfdXNlcmlkID0gcm93LmVudGl0eS51c2VyX2lkOwpsb2dEZWJ1Zygic2VsZWN0ZWQgcm93IHVzZXJfaWQgPSIgKyByb3dfdXNlcmlkKTsKJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jbGllbnRzLycgKyByb3dfdXNlcmlkKTsKfTsKCiRzY29wZS5zaG93Q2xpZW50c0dyaWRPcHRpb25zID0gewplbmFibGVGaWx0ZXJpbmc6IGZhbHNlLAplbmFibGVTb3J0aW5nOiB0cnVlLApjb2x1bW5EZWZzOiAkc2NvcGUuc2hvd0NsaWVudHNDb2x1bW5zLApyb3dUZW1wbGF0ZTogJy9wdWJsaWMvY29tcG9uZW50cy9jbGllbnRzLWdyaWQtcm93Lmh0bWwnLApvblJlZ2lzdGVyQXBpOiBmdW5jdGlvbihncmlkQXBpKSB7CiRzY29wZS5ncmlkQXBpID0gZ3JpZEFwaTsKJHNjb3BlLmdyaWRBcGkuZ3JpZC5yZWdpc3RlclJvd3NQcm9jZXNzb3IoJHNjb3BlLnNpbmdsZUZpbHRlciwgMjAwKTsKfSwKfTsKCiRzY29wZS5pc0FjdGl2ZSA9IGZ1bmN0aW9uKHZpZXdMb2NhdGlvbikgewpsb2dEZWJ1Zygidmlld0xvY2F0aW9uID0gIiArIHZpZXdMb2NhdGlvbik7CnZhciBhY3RpdmUgPSAodmlld0xvY2F0aW9uID09PSAkbG9jYXRpb24ucGF0aCgpKTsKcmV0dXJuIGFjdGl2ZTsKfTsKCiRzY29wZS5maWx0ZXIgPSBmdW5jdGlvbigpIHsKbG9nRGVidWcoInNpbmdsZSBmaWx0ZXIiKTsKJHNjb3BlLmdyaWRBcGkuZ3JpZC5yZWZyZXNoKCk7CmlmICgkc2NvcGUuZmlsdGVyLlZhbHVlICE9ICIiKSB7CiRzY29wZS5maWx0ZXIuYnV0dG9uVmFsdWUgPSAiJyIgKyAkc2NvcGUuZmlsdGVyLlZhbHVlICsgIiciOwp9IGVsc2Ugewokc2NvcGUuZmlsdGVyLmJ1dHRvblZhbHVlID0gIiI7Cn0KfTsKCiRzY29wZS5zaW5nbGVGaWx0ZXIgPSBmdW5jdGlvbihyZW5kZXJhYmxlUm93cykgewp2YXIgbWF0Y2hlciA9IG5ldyBSZWdFeHAoJHNjb3BlLmZpbHRlci5WYWx1ZSk7CmxvZ0RlYnVnKCJzY29wZT0iICsgJHNjb3BlKTsKbG9nRGVidWcoInNjb3BlLmZpbHRlci5WYWx1ZT0iICsgJHNjb3BlLmZpbHRlci5WYWx1ZSk7CmlmICgoJHNjb3BlLmZpbHRlci5WYWx1ZSA9PSBudWxsKSB8fCAoJHNjb3BlLmZpbHRlci5WYWx1ZSA9PSAiIikpIHsKbG9nRGVidWcoImVtcHR5IGZpbHRlciIpOwpyZXR1cm4gcmVuZGVyYWJsZVJvd3M7Cn0KcmVuZGVyYWJsZVJvd3MuZm9yRWFjaChmdW5jdGlvbihyb3cpIHsKLy8JCQlsb2dEZWJ1Zygicm93PSIrcm93KTsKcm93LnZpc2libGUgPSBmYWxzZTsKdmFyICRjdXJyRmlyc3ROYW1lID0gcm93LmVudGl0eVsnZmlyc3RfbmFtZSddOwp2YXIgJGN1cnJMYXN0TmFtZSA9IHJvdy5lbnRpdHlbJ2xhc3RfbmFtZSddOwpsb2dEZWJ1ZygiY3VyckZpcnN0TmFtZT0iICsgJGN1cnJGaXJzdE5hbWUpOwoKaWYgKCRjdXJyRmlyc3ROYW1lICE9IG51bGwpIHsKaWYgKCRjdXJyRmlyc3ROYW1lLmluZGV4T2YoJHNjb3BlLmZpbHRlci5WYWx1ZSkgPiAtMSkgewpyb3cudmlzaWJsZSA9IHRydWU7Cn0KfSBlbHNlIC8vIHJvdyBpcyBudWxsCnsKcm93LnZpc2libGUgPSBmYWxzZTsKfQoKaWYgKCRjdXJyTGFzdE5hbWUgIT0gbnVsbCkgewppZiAoJGN1cnJMYXN0TmFtZS5pbmRleE9mKCRzY29wZS5maWx0ZXIuVmFsdWUpID4gLTEpIHsKcm93LnZpc2libGUgPSB0cnVlOwp9Cn0gZWxzZSAvLyByb3cgaXMgbnVsbAp7CnJvdy52aXNpYmxlID0gZmFsc2U7Cn0KfSk7CnJldHVybiByZW5kZXJhYmxlUm93czsKfTsKCi8vIGltcG9ydGFudCEhIGluaXRpYWxpemluZyBhbmd1bGFyIGZvcm1zIGFzIGFycmF5cwokc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIgPSB7fTsKJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyID0ge307CgovLyBsb2dEZWJ1ZygibG9jYXRpb249IiArICRsb2NhdGlvbik7Ci8vIGxvZ0RlYnVnKCRsb2NhdGlvbik7Cgokc2NvcGUuY2hhbmdlTGFuZyA9IGZ1bmN0aW9uKCRuZXdsYW5nKSB7CmxvZ0RlYnVnKCRuZXdsYW5nKTsKLy8kc2NvcGUuc3BDbGFzcyA9ICdyaWdodCc7CnVwZGF0ZUdsb2JhbExhbmd1YWdlKCRzY29wZSwgJG5ld2xhbmcpCn0KCiRzY29wZS5hZGROZXdDbGllbnQgPSBmdW5jdGlvbigpIHsKJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jbGllbnRzL2FkZCcpOwp9CiRzY29wZS5hZGROZXdJbnN0cnVjdG9yID0gZnVuY3Rpb24oKSB7CiRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfaW5zdHJ1Y3RvcnMvYWRkJyk7Cn0KfSk7CgovLy8vLy8gYmVmb3JlIGZvcm1zCmt1emVBcHAuY29udHJvbGxlcignRGVtb0NvbnRyb2xsZXInLCBbCickc2NvcGUnLCAnJGJ1aWxkZXInLCAnJHZhbGlkYXRvcicsCmZ1bmN0aW9uKCRzY29wZSwgJGJ1aWxkZXIsICR2YWxpZGF0b3IpIHsKdmFyIGNoZWNrYm94LCB0ZXh0Ym94Owp0ZXh0Ym94ID0gJGJ1aWxkZXIuYWRkRm9ybU9iamVjdCgnZGVmYXVsdCcsIHsKaWQ6ICd0ZXh0Ym94JywKY29tcG9uZW50OiAndGV4dElucHV0JywKbGFiZWw6ICdOYW1lJywKZGVzY3JpcHRpb246ICdZb3VyIG5hbWUnLApwbGFjZWhvbGRlcjogJ1lvdXIgbmFtZScsCnJlcXVpcmVkOiB0cnVlLAplZGl0YWJsZTogZmFsc2UKfSk7CmNoZWNrYm94ID0gJGJ1aWxkZXIuYWRkRm9ybU9iamVjdCgnZGVmYXVsdCcsIHsKaWQ6ICdjaGVja2JveCcsCmNvbXBvbmVudDogJ2NoZWNrYm94JywKbGFiZWw6ICdQZXRzJywKZGVzY3JpcHRpb246ICdEbyB5b3UgaGF2ZSBhbnkgcGV0cz8nLApvcHRpb25zOiBbJ0RvZycsICdDYXQnXQp9KTsKJGJ1aWxkZXIuYWRkRm9ybU9iamVjdCgnZGVmYXVsdCcsIHsKY29tcG9uZW50OiAnc2FtcGxlSW5wdXQnCn0pOwokc2NvcGUuZm9ybSA9ICRidWlsZGVyLmZvcm1zWydkZWZhdWx0J107CiRzY29wZS5pbnB1dCA9IFtdOwokc2NvcGUuZGVmYXVsdFZhbHVlID0ge307CiRzY29wZS5kZWZhdWx0VmFsdWVbdGV4dGJveC5pZF0gPSAnZGVmYXVsdCB2YWx1ZSc7CiRzY29wZS5kZWZhdWx0VmFsdWVbY2hlY2tib3guaWRdID0gW3RydWUsIHRydWVdOwpyZXR1cm4gJHNjb3BlLnN1Ym1pdCA9IGZ1bmN0aW9uKCkgewpyZXR1cm4gJHZhbGlkYXRvci52YWxpZGF0ZSgkc2NvcGUsICdkZWZhdWx0Jykuc3VjY2VzcyhmdW5jdGlvbigpIHsKcmV0dXJuIGxvZ0RlYnVnKCdzdWNjZXNzJyk7Cn0pLmVycm9yKGZ1bmN0aW9uKCkgewpyZXR1cm4gbG9nRGVidWcoJ2Vycm9yJyk7Cn0pOwp9Owp9Cl0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdBbGVydERlbW9DdHJsJywgZnVuY3Rpb24oJHNjb3BlKSB7CiRzY29wZS5hbGVydHMgPSBbewp0eXBlOiAnZGFuZ2VyJywKbXNnOiAnT2ggc25hcCEgQ2hhbmdlIGEgZmV3IHRoaW5ncyB1cCBhbmQgdHJ5IHN1Ym1pdHRpbmcgYWdhaW4uJwp9LCB7CnR5cGU6ICdzdWNjZXNzJywKbXNnOiAnV2VsbCBkb25lISBZb3Ugc3VjY2Vzc2Z1bGx5IHJlYWQgdGhpcyBpbXBvcnRhbnQgYWxlcnQgbWVzc2FnZS4nCn1dOwoKJHNjb3BlLmFkZEFsZXJ0ID0gZnVuY3Rpb24oKSB7CiRzY29wZS5hbGVydHMucHVzaCh7Cm1zZzogJ0Fub3RoZXIgYWxlcnQhJwp9KTsKfTsKCiRzY29wZS5jbG9zZUFsZXJ0ID0gZnVuY3Rpb24oaW5kZXgpIHsKJHNjb3BlLmFsZXJ0cy5zcGxpY2UoaW5kZXgsIDEpOwp9Owp9KTsKCgpmdW5jdGlvbiBpc051bWJlcktleShldnQpewp2YXIgY2hhckNvZGUgPSAoZXZ0LndoaWNoKSA/IGV2dC53aGljaCA6IGV2ZW50LmtleUNvZGU7CnJldHVybiAhKGNoYXJDb2RlID4gMzEgJiYgKGNoYXJDb2RlIDwgNDggfHwgY2hhckNvZGUgPiA1NykpOwp9Cgo=</text>
      </register>
      <register name="9" type="2">
        <text encoding="base64">Ly8gdjExIC0gMjMgbWFyY2ggMjAxNwovL0RlZmluZSBhbiBhbmd1bGFyIG1vZHVsZSBmb3Igb3VyIGFwcAoKdmFyIGt1emVJc0NhbGVuZGFyRHJhZ2dibGU7Cmt1emVJc0NhbGVuZGFyRHJhZ2dibGUgPSB0cnVlOwoKLy8gYW5ndWxhciBtb2R1bGVzCi8vJGFuZ3VsYXJNb2R1bGVzPVsnbmdSb3V0ZScsJ3VpLmJvb3RzdHJhcCcsJ3VpLmdyaWQnXTsKJGFuZ3VsYXJNb2R1bGVzID0gWyduZ1JvdXRlJywgJ3VpLmJvb3RzdHJhcCcsICd1aS5ncmlkJywgJ2J1aWxkZXInLCAnYnVpbGRlci5jb21wb25lbnRzJywgJ3ZhbGlkYXRvci5ydWxlcycsICd1aS5jYWxlbmRhcicsICdjaGVja2xpc3QtbW9kZWwnLCAndWkuYm9vdHN0cmFwLmRhdGV0aW1lcGlja2VyJywgJ2FuZ3Vjb21wbGV0ZS1hbHQnLCAnbXVsdGlwbGVTZWxlY3QnLCdhbmd1bGFySW5saW5lRWRpdCcsJ3RleHRBbmd1bGFyJywnbmdDc3YnXTsKCnZhciBkYXlOYW1lcyA9IFsn16jXkNep15XXnycsICfXqdeg15knLCAn16nXnNeZ16nXmScsICfXqNeR15nXoteZJywgJ9eX157Xmdep15knLCAn16nXmdep15knLCAn16nXkdeqJ107CnZhciBtb250aE5hbWVzID0gWyLXmdeg15XXkNeoIiwgItek15HXqNeV15DXqCIsICLXnteo16UiLCAi15DXpNeo15nXnCIsICLXnteQ15kiLCAi15nXldeg15kiLAogICAgIteZ15XXnNeZIiwgIteQ15XXkteV16HXmCIsICLXodek15jXnteR16giLCAi15DXlden15jXldeR16giLCAi16DXldeR157XkdeoIiwgIteT16bXnteR16giCl07Cgp2YXIgbG9naW5OZXh0U2NyZWVuPSIiOwoKKGZ1bmN0aW9uKCl7RGF0ZS5zaG9ydE1vbnRocz1bIkphbiIsIkZlYiIsIk1hciIsIkFwciIsIk1heSIsIkp1biIsIkp1bCIsIkF1ZyIsIlNlcCIsIk9jdCIsIk5vdiIsIkRlYyJdLERhdGUubG9uZ01vbnRocz1bIkphbnVhcnkiLCJGZWJydWFyeSIsIk1hcmNoIiwiQXByaWwiLCJNYXkiLCJKdW5lIiwiSnVseSIsIkF1Z3VzdCIsIlNlcHRlbWJlciIsIk9jdG9iZXIiLCJOb3ZlbWJlciIsIkRlY2VtYmVyIl0sRGF0ZS5zaG9ydERheXM9WyJTdW4iLCJNb24iLCJUdWUiLCJXZWQiLCJUaHUiLCJGcmkiLCJTYXQiXSxEYXRlLmxvbmdEYXlzPVsiU3VuZGF5IiwiTW9uZGF5IiwiVHVlc2RheSIsIldlZG5lc2RheSIsIlRodXJzZGF5IiwiRnJpZGF5IiwiU2F0dXJkYXkiXTt2YXIgdD17ZDpmdW5jdGlvbigpe3JldHVybih0aGlzLmdldERhdGUoKTwxMD8iMCI6IiIpK3RoaXMuZ2V0RGF0ZSgpfSxEOmZ1bmN0aW9uKCl7cmV0dXJuIERhdGUuc2hvcnREYXlzW3RoaXMuZ2V0RGF5KCldfSxqOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZ2V0RGF0ZSgpfSxsOmZ1bmN0aW9uKCl7cmV0dXJuIERhdGUubG9uZ0RheXNbdGhpcy5nZXREYXkoKV19LE46ZnVuY3Rpb24oKXtyZXR1cm4gMD09dGhpcy5nZXREYXkoKT83OnRoaXMuZ2V0RGF5KCl9LFM6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5nZXREYXRlKCklMTA9PTEmJjExIT10aGlzLmdldERhdGUoKT8ic3QiOnRoaXMuZ2V0RGF0ZSgpJTEwPT0yJiYxMiE9dGhpcy5nZXREYXRlKCk/Im5kIjp0aGlzLmdldERhdGUoKSUxMD09MyYmMTMhPXRoaXMuZ2V0RGF0ZSgpPyJyZCI6InRoIn0sdzpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldERheSgpfSx6OmZ1bmN0aW9uKCl7dmFyIHQ9bmV3IERhdGUodGhpcy5nZXRGdWxsWWVhcigpLDAsMSk7cmV0dXJuIE1hdGguY2VpbCgodGhpcy10KS84NjRlNSl9LFc6ZnVuY3Rpb24oKXt2YXIgdD1uZXcgRGF0ZSh0aGlzLnZhbHVlT2YoKSksZT0odGhpcy5nZXREYXkoKSs2KSU3O3Quc2V0RGF0ZSh0LmdldERhdGUoKS1lKzMpO3ZhciBuPXQudmFsdWVPZigpO3JldHVybiB0LnNldE1vbnRoKDAsMSksNCE9PXQuZ2V0RGF5KCkmJnQuc2V0TW9udGgoMCwxKyg0LXQuZ2V0RGF5KCkrNyklNyksMStNYXRoLmNlaWwoKG4tdCkvNjA0OGU1KX0sRjpmdW5jdGlvbigpe3JldHVybiBEYXRlLmxvbmdNb250aHNbdGhpcy5nZXRNb250aCgpXX0sbTpmdW5jdGlvbigpe3JldHVybih0aGlzLmdldE1vbnRoKCk8OT8iMCI6IiIpKyh0aGlzLmdldE1vbnRoKCkrMSl9LE06ZnVuY3Rpb24oKXtyZXR1cm4gRGF0ZS5zaG9ydE1vbnRoc1t0aGlzLmdldE1vbnRoKCldfSxuOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZ2V0TW9udGgoKSsxfSx0OmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5nZXRGdWxsWWVhcigpLGU9dGhpcy5nZXRNb250aCgpKzE7cmV0dXJuIDEyPT09ZSYmKHQ9dCsrLGU9MCksbmV3IERhdGUodCxlLDApLmdldERhdGUoKX0sTDpmdW5jdGlvbigpe3ZhciB0PXRoaXMuZ2V0RnVsbFllYXIoKTtyZXR1cm4gdCU0MDA9PTB8fHQlMTAwIT0wJiZ0JTQ9PTB9LG86ZnVuY3Rpb24oKXt2YXIgdD1uZXcgRGF0ZSh0aGlzLnZhbHVlT2YoKSk7cmV0dXJuIHQuc2V0RGF0ZSh0LmdldERhdGUoKS0odGhpcy5nZXREYXkoKSs2KSU3KzMpLHQuZ2V0RnVsbFllYXIoKX0sWTpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldEZ1bGxZZWFyKCl9LHk6ZnVuY3Rpb24oKXtyZXR1cm4oIiIrdGhpcy5nZXRGdWxsWWVhcigpKS5zdWJzdHIoMil9LGE6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5nZXRIb3VycygpPDEyPyJhbSI6InBtIn0sQTpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldEhvdXJzKCk8MTI/IkFNIjoiUE0ifSxCOmZ1bmN0aW9uKCl7cmV0dXJuIE1hdGguZmxvb3IoMWUzKigodGhpcy5nZXRVVENIb3VycygpKzEpJTI0K3RoaXMuZ2V0VVRDTWludXRlcygpLzYwK3RoaXMuZ2V0VVRDU2Vjb25kcygpLzM2MDApLzI0KX0sZzpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldEhvdXJzKCklMTJ8fDEyfSxHOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZ2V0SG91cnMoKX0saDpmdW5jdGlvbigpe3JldHVybigodGhpcy5nZXRIb3VycygpJTEyfHwxMik8MTA/IjAiOiIiKSsodGhpcy5nZXRIb3VycygpJTEyfHwxMil9LEg6ZnVuY3Rpb24oKXtyZXR1cm4odGhpcy5nZXRIb3VycygpPDEwPyIwIjoiIikrdGhpcy5nZXRIb3VycygpfSxpOmZ1bmN0aW9uKCl7cmV0dXJuKHRoaXMuZ2V0TWludXRlcygpPDEwPyIwIjoiIikrdGhpcy5nZXRNaW51dGVzKCl9LHM6ZnVuY3Rpb24oKXtyZXR1cm4odGhpcy5nZXRTZWNvbmRzKCk8MTA/IjAiOiIiKSt0aGlzLmdldFNlY29uZHMoKX0sdTpmdW5jdGlvbigpe3ZhciB0PXRoaXMuZ2V0TWlsbGlzZWNvbmRzKCk7cmV0dXJuKDEwPnQ/IjAwIjoxMDA+dD8iMCI6IiIpK3R9LGU6ZnVuY3Rpb24oKXtyZXR1cm4vXCgoLiopXCkvLmV4ZWMoKG5ldyBEYXRlKS50b1N0cmluZygpKVsxXX0sSTpmdW5jdGlvbigpe2Zvcih2YXIgdD1udWxsLGU9MDsxMj5lOysrZSl7dmFyIG49bmV3IERhdGUodGhpcy5nZXRGdWxsWWVhcigpLGUsMSksaT1uLmdldFRpbWV6b25lT2Zmc2V0KCk7aWYobnVsbD09PXQpdD1pO2Vsc2V7aWYodD5pKXt0PWk7YnJlYWt9aWYoaT50KWJyZWFrfX1yZXR1cm4gdGhpcy5nZXRUaW1lem9uZU9mZnNldCgpPT10fDB9LE86ZnVuY3Rpb24oKXtyZXR1cm4oLXRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKTwwPyItIjoiKyIpKyhNYXRoLmFicyh0aGlzLmdldFRpbWV6b25lT2Zmc2V0KCkvNjApPDEwPyIwIjoiIikrTWF0aC5mbG9vcihNYXRoLmFicyh0aGlzLmdldFRpbWV6b25lT2Zmc2V0KCkvNjApKSsoMD09TWF0aC5hYnModGhpcy5nZXRUaW1lem9uZU9mZnNldCgpJTYwKT8iMDAiOihNYXRoLmFicyh0aGlzLmdldFRpbWV6b25lT2Zmc2V0KCklNjApPDEwPyIwIjoiIikrTWF0aC5hYnModGhpcy5nZXRUaW1lem9uZU9mZnNldCgpJTYwKSl9LFA6ZnVuY3Rpb24oKXtyZXR1cm4oLXRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKTwwPyItIjoiKyIpKyhNYXRoLmFicyh0aGlzLmdldFRpbWV6b25lT2Zmc2V0KCkvNjApPDEwPyIwIjoiIikrTWF0aC5mbG9vcihNYXRoLmFicyh0aGlzLmdldFRpbWV6b25lT2Zmc2V0KCkvNjApKSsiOiIrKDA9PU1hdGguYWJzKHRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKSU2MCk/IjAwIjooTWF0aC5hYnModGhpcy5nZXRUaW1lem9uZU9mZnNldCgpJTYwKTwxMD8iMCI6IiIpK01hdGguYWJzKHRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKSU2MCkpfSxUOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMudG9UaW1lU3RyaW5nKCkucmVwbGFjZSgvXi4rIFwoPyhbXlwpXSspXCk/JC8sIiQxIil9LFo6ZnVuY3Rpb24oKXtyZXR1cm4gNjAqLXRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKX0sYzpmdW5jdGlvbigpe3JldHVybiB0aGlzLmZvcm1hdCgiWS1tLWRcXFRIOmk6c1AiKX0scjpmdW5jdGlvbigpe3JldHVybiB0aGlzLnRvU3RyaW5nKCl9LFU6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5nZXRUaW1lKCkvMWUzfX07RGF0ZS5wcm90b3R5cGUuZm9ybWF0PWZ1bmN0aW9uKGUpe3ZhciBuPXRoaXM7cmV0dXJuIGUucmVwbGFjZSgvKFxcPykoLikvZyxmdW5jdGlvbihlLGkscil7cmV0dXJuIiI9PT1pJiZ0W3JdP3Rbcl0uY2FsbChuKTpyfSl9fSkuY2FsbCh0aGlzKTsKCmZ1bmN0aW9uIGdvdG9DbGllbnRQYWdlKGJ1c2luZXNzX3VzZXJfaWQpCnsKICB3aW5kb3cubG9jYXRpb24uaHJlZj0nLyMvYnVzaW5lc3NfY2xpZW50cy8nICsgYnVzaW5lc3NfdXNlcl9pZDsKfQpmdW5jdGlvbiBnb3RvSW5zdHJ1Y3RvclBhZ2UoYnVzaW5lc3NfdXNlcl9pZCkKewogIHdpbmRvdy5sb2NhdGlvbi5ocmVmPScvIy9idXNpbmVzc19pbnN0cnVjdG9ycy8nICsgYnVzaW5lc3NfdXNlcl9pZDsKfQoKZnVuY3Rpb24gZ290b0V2ZW50UGFnZSh0aGVldmVudCkKewogIGxvZ0RlYnVnKCJnb3RvRXZlbnRQYWdlICIrdGhlZXZlbnQpOwogIGlmICh0aGVldmVudC5pc19jbGFzcz09MSkKICB7CiAgICB3aW5kb3cubG9jYXRpb24uaHJlZj0nLyMvZXZlbnRfY2xhc3MvJyArIHRoZWV2ZW50LmV2ZW50X2lkOwogIH0KICBlbHNlCiAgewogICAgd2luZG93LmxvY2F0aW9uLmhyZWY9Jy8jL2V2ZW50LycgKyB0aGVldmVudC5ldmVudF9pZDsKICB9Cn0KCmZ1bmN0aW9uIGdvdG9Mb2NhdGlvblBhZ2UobG9jYXRpb25faWQpCnsKICBsb2dEZWJ1ZygiZ290b0xvY2F0aW9uUGFnZSAiK2xvY2F0aW9uX2lkKTsKICB3aW5kb3cubG9jYXRpb24uaHJlZj0nLyMvYnVzaW5lc3NfbG9jYXRpb25zLycgKyBsb2NhdGlvbl9pZDsKCn0KCmZ1bmN0aW9uIGdvdG9DbGllbnRFZGl0UGFnZSh1c2VyX2lkKQp7CiAgd2luZG93LmxvY2F0aW9uLmhyZWY9Jy8jL2J1c2luZXNzX2NsaWVudHMvJyArIHVzZXJfaWQgKyAnL2VkaXQnOwp9CgpmdW5jdGlvbiBnb3RvQmFjaygpCnsKICB3aW5kb3cuaGlzdG9yeS5iYWNrKCk7Cn0KCmZ1bmN0aW9uIHNob3dFdmVudFBvcHVwKHNlbGVjdGVkRXZlbnQsICR1aWJNb2RhbCkKewogIC8vIHRoaXMgZnVuY3Rpb24gdXNlZCB0byBicmluZyBhIHBvcHVwCiAgLy8gbm93IGl0IGdvZXMgdG8gdGhlIGV2ZW50IHBhZ2UKICBnb3RvRXZlbnRQYWdlKHNlbGVjdGVkRXZlbnQpOwoKICAvLyBpZiAoc2VsZWN0ZWRFdmVudC5pc19yZXBlYXRpbmcgPT0gMSkgewogIC8vICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAvLyAgICAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgLy8gICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9jbGFzc19zaW5nbGUucGhwJywKICAvLyAgICAgICAgIGNvbnRyb2xsZXI6ICdldmVudFJlY3VycmluZ0RldGFpbHNCdXNpbmVzc0NhbGVuZGFyTW9kYWxDb250cm9sbGVyJywKICAvLyAgICAgICAgIC8vIHNpemU6IHNpemUsCiAgLy8gICAgICAgICByZXNvbHZlOiB7CiAgLy8gICAgICAgICAgICAgc2VsZWN0ZWRFdmVudDogZnVuY3Rpb24oKSB7CiAgLy8gICAgICAgICAgICAgICAgIHJldHVybiBzZWxlY3RlZEV2ZW50OwogIC8vICAgICAgICAgICAgIH0KICAvLyAgICAgICAgIH0KICAvLyAgICAgfSk7CiAgLy8gfSBlbHNlIHsKICAvLyAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgLy8gICAgICAgICBhbmltYXRpb246IGZhbHNlLAogIC8vICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfZXZlbnRfc2luZ2xlLnBocCcsCiAgLy8gICAgICAgICBjb250cm9sbGVyOiAnZXZlbnREZXRhaWxzQnVzaW5lc3NDYWxlbmRhck1vZGFsQ29udHJvbGxlcicsCiAgLy8gICAgICAgICAvLyBzaXplOiBzaXplLAogIC8vICAgICAgICAgcmVzb2x2ZTogewogIC8vICAgICAgICAgICAgIHNlbGVjdGVkRXZlbnQ6IGZ1bmN0aW9uKCkgewogIC8vICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZWN0ZWRFdmVudDsKICAvLyAgICAgICAgICAgICB9CiAgLy8gICAgICAgICB9CiAgLy8gICAgIH0pOwogIC8vIH0KfQpmdW5jdGlvbiB1cGRhdGVHbG9iYWxMYW5ndWFnZSgkc2NvcGUsICRuZXdsYW5nKSB7CgogICAgLy8JdmFyIGdMYW5nPWdMYW5nQmFzZVtnTGFuZ0N1cnJdOwogICAgJGdMYW5nID0gZ0xhbmdCYXNlWyRuZXdsYW5nXTsKICAgIC8vIGxvZ0RlYnVnKCJnTGFuZ0Jhc2VbJG5ld2xhbmddWyd0aXRsZTEnXT0iICsgZ0xhbmdCYXNlWyRuZXdsYW5nXVsndGl0bGUxJ10pOwogICAgLy8gbG9nRGVidWcoImxhbmd1Z2FnZToiICsgJGdMYW5nWydsYW5ndWFnZSddKTsKICAgIC8vCWxvZ0RlYnVnKCJsYW5ndWdhZ2UgZGlyOiAiKyRnTGFuZ1snZGlyJ10pOwogICAgLy8JbG9nRGVidWcoImNoYW5naW5nIGxhbmd1YWdlIHRvICIrJG5ld2xhbmcpCiAgICAkc2NvcGUuc3BDbGFzcyA9ICRnTGFuZ1snY2xhc3MnXTsKICAgIC8vCWxvZ0RlYnVnKCJpcyBhcnJheT8gIithbmd1bGFyLmlzQXJyYXkoJGdMYW5nKSk7CiAgICAvLwlsb2dEZWJ1ZygiJGdMYW5nWydkaXInXT0iKyRnTGFuZ1snZGlyJ10pOwogICAgLy8JbG9nRGVidWcoIiRnTGFuZ1sndGl0bGUxJ109IiskZ0xhbmdbJ3RpdGxlMSddKTsKICAgICRzY29wZS5sYW5nZmlsZSA9ICRnTGFuZzsKICAgIC8vIGxvZ0RlYnVnKCJpcyBhcnJheT8gIiArIGFuZ3VsYXIuaXNBcnJheSgkc2NvcGUubGFuZ2ZpbGUpKTsKICAgIC8vIGxvZ0RlYnVnKCIkc2NvcGUubGFuZ2ZpbGU9IiArICRzY29wZS5sYW5nZmlsZSk7CiAgICAvLyBsb2dEZWJ1ZygiJHNjb3BlLmxhbmdmaWxlWyd0aXRsZTEnXT0iICsgJHNjb3BlLmxhbmdmaWxlWyd0aXRsZTEnXSk7CgogICAgJHNjb3BlLnRlc3RuZXd2YXIgPSAkc2NvcGUubGFuZ2ZpbGVbJ3RpdGxlMSddOwogICAgLy8JJHNjb3BlLm1lc3NhZ2U9JHNjb3BlLmxhbmdmaWxlWyd0aXRsZTEnXTsKfQoKZnVuY3Rpb24gZ2V0UmFuZG9tQ29sb3IoKSB7CiAgICB2YXIgbGV0dGVycyA9ICcwMTIzNDU2Nzg5QUJDREVGJy5zcGxpdCgnJyk7CiAgICB2YXIgY29sb3IgPSAnIyc7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IDY7IGkrKykgewogICAgICAgIGNvbG9yICs9IGxldHRlcnNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTYpXTsKICAgIH0KICAgIHJldHVybiBjb2xvcjsKfQoKZnVuY3Rpb24gZ2V0UmFuZG9tSW50KG1pbiwgbWF4KSB7CiAgICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKG1heCAtIG1pbiArIDEpKSArIG1pbjsKfQoKZnVuY3Rpb24gY2FsY190ZW1wX2xpbWl0X2lkKCkgewogICAgdmFyIGQgPSBuZXcgRGF0ZSgpOwogICAgdmFyIHJhbmRvbWxpbWl0ID0gZC5nZXRUaW1lKCk7CiAgICBsb2dEZWJ1ZygiY2FsY190ZW1wX2xpbWl0X2lkPSIgKyByYW5kb21saW1pdCk7CiAgICByZXR1cm4gcmFuZG9tbGltaXQ7Cn0KCnZhciAkZ0xvZ0xldmVsID0gJ2RlYnVnJzsKCi8vIHN0YXJ0aW5nCmxvZ0RlYnVnKCJtYWluICRnTG9nTGV2ZWw9IiArICRnTG9nTGV2ZWwpOwpsb2dEZWJ1ZygiaW5pdGlhbGl6ZSBhbmd1bGFyIik7CmxvZ0RlYnVnKCJpbml0aWFsaXppbmcgbW9kdWxlcyAiICsgJGFuZ3VsYXJNb2R1bGVzKTsKCnZhciBrdXplQXBwID0gYW5ndWxhci5tb2R1bGUoJ2t1emVBcHAnLCAkYW5ndWxhck1vZHVsZXMpCgovLyRyb290U2NvcGUuc3BDbGFzcyA9ICdyaWdodCc7Cmt1emVSdW4gPSBmdW5jdGlvbigpIHsKCn0Ka3V6ZUFwcC5ydW4oWwogICAgJyRidWlsZGVyJywKICAgIGZ1bmN0aW9uKCRidWlsZGVyKSB7CiAgICAgICAgLy8gbG9nRGVidWcoImluc2lkZSBrdXplQXBwLnJ1biIpOwogICAgICAgICRidWlsZGVyLnJlZ2lzdGVyQ29tcG9uZW50KCdzYW1wbGVJbnB1dCcsIHsKICAgICAgICAgICAgZ3JvdXA6ICdmcm9tIGh0bWwnLAogICAgICAgICAgICBsYWJlbDogJ1NhbXBsZScsCiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnRnJvbSBodG1sIHRlbXBsYXRlJywKICAgICAgICAgICAgcGxhY2Vob2xkZXI6ICdwbGFjZWhvbGRlcicsCiAgICAgICAgICAgIHJlcXVpcmVkOiBmYWxzZSwKICAgICAgICAgICAgdmFsaWRhdGlvbk9wdGlvbnM6IFt7CiAgICAgICAgICAgICAgICBsYWJlbDogJ25vbmUnLAogICAgICAgICAgICAgICAgcnVsZTogJy8uKi8nCiAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgIGxhYmVsOiAnbnVtYmVyJywKICAgICAgICAgICAgICAgIHJ1bGU6ICdbbnVtYmVyXScKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgbGFiZWw6ICdlbWFpbCcsCiAgICAgICAgICAgICAgICBydWxlOiAnW2VtYWlsXScKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgbGFiZWw6ICd1cmwnLAogICAgICAgICAgICAgICAgcnVsZTogJ1t1cmxdJwogICAgICAgICAgICB9XSwKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYW5ndWxhci1mb3JtLWJ1aWxkZXIvZXhhbXBsZS90ZW1wbGF0ZS5odG1sJywKICAgICAgICAgICAgcG9wb3ZlclRlbXBsYXRlVXJsOiAnL2FuZ3VsYXItZm9ybS1idWlsZGVyL2V4YW1wbGUvcG9wb3ZlclRlbXBsYXRlLmh0bWwnCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuICRidWlsZGVyLnJlZ2lzdGVyQ29tcG9uZW50KCduYW1lJywgewogICAgICAgICAgICBncm91cDogJ0RlZmF1bHQnLAogICAgICAgICAgICBsYWJlbDogJ05hbWUnLAogICAgICAgICAgICByZXF1aXJlZDogZmFsc2UsCiAgICAgICAgICAgIGFycmF5VG9UZXh0OiB0cnVlLAogICAgICAgICAgICB0ZW1wbGF0ZTogIjxkaXYgY2xhc3M9XCJmb3JtLWdyb3VwXCI+XG4gICAgPGxhYmVsIGZvcj1cInt7Zm9ybU5hbWUraW5kZXh9fVwiIGNsYXNzPVwiY29sLW1kLTQgY29udHJvbC1sYWJlbFwiIG5nLWNsYXNzPVwieydmYi1yZXF1aXJlZCc6cmVxdWlyZWR9XCI+e3tsYWJlbH19PC9sYWJlbD5cbiAgICA8ZGl2IGNsYXNzPVwiY29sLW1kLThcIj5cbiAgICAgICAgPGlucHV0IHR5cGU9J2hpZGRlbicgbmctbW9kZWw9XCJpbnB1dFRleHRcIiB2YWxpZGF0b3ItcmVxdWlyZWQ9XCJ7e3JlcXVpcmVkfX1cIiB2YWxpZGF0b3ItZ3JvdXA9XCJ7e2Zvcm1OYW1lfX1cIi8+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJjb2wtc20tNlwiIHN0eWxlPVwicGFkZGluZy1sZWZ0OiAwO1wiPlxuICAgICAgICAgICAgPGlucHV0IHR5cGU9XCJ0ZXh0XCJcbiAgICAgICAgICAgICAgICBuZy1tb2RlbD1cImlucHV0QXJyYXlbMF1cIlxuICAgICAgICAgICAgICAgIGNsYXNzPVwiZm9ybS1jb250cm9sXCIgaWQ9XCJ7e2Zvcm1OYW1lK2luZGV4fX0tMFwiLz5cbiAgICAgICAgICAgIDxwIGNsYXNzPSdoZWxwLWJsb2NrJz5GaXJzdCBuYW1lPC9wPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImNvbC1zbS02XCIgc3R5bGU9XCJwYWRkaW5nLWxlZnQ6IDA7XCI+XG4gICAgICAgICAgICA8aW5wdXQgdHlwZT1cInRleHRcIlxuICAgICAgICAgICAgICAgIG5nLW1vZGVsPVwiaW5wdXRBcnJheVsxXVwiXG4gICAgICAgICAgICAgICAgY2xhc3M9XCJmb3JtLWNvbnRyb2xcIiBpZD1cInt7Zm9ybU5hbWUraW5kZXh9fS0xXCIvPlxuICAgICAgICAgICAgPHAgY2xhc3M9J2hlbHAtYmxvY2snPkxhc3QgbmFtZTwvcD5cbiAgICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG48L2Rpdj4iLAogICAgICAgICAgICBwb3BvdmVyVGVtcGxhdGU6ICI8Zm9ybT5cbiAgICA8ZGl2IGNsYXNzPVwiZm9ybS1ncm91cFwiPlxuICAgICAgICA8bGFiZWwgY2xhc3M9J2NvbnRyb2wtbGFiZWwnPkxhYmVsPC9sYWJlbD5cbiAgICAgICAgPGlucHV0IHR5cGU9J3RleHQnIG5nLW1vZGVsPVwibGFiZWxcIiB2YWxpZGF0b3I9XCJbcmVxdWlyZWRdXCIgY2xhc3M9J2Zvcm0tY29udHJvbCcvPlxuICAgIDwvZGl2PlxuICAgIDxkaXYgY2xhc3M9XCJjaGVja2JveFwiPlxuICAgICAgICA8bGFiZWw+XG4gICAgICAgICAgICA8aW5wdXQgdHlwZT0nY2hlY2tib3gnIG5nLW1vZGVsPVwicmVxdWlyZWRcIiAvPlxuICAgICAgICAgICAgUmVxdWlyZWRcbiAgICAgICAgPC9sYWJlbD5cbiAgICA8L2Rpdj5cblxuICAgIDxoci8+XG4gICAgPGRpdiBjbGFzcz0nZm9ybS1ncm91cCc+XG4gICAgICAgIDxpbnB1dCB0eXBlPSdzdWJtaXQnIG5nLWNsaWNrPVwicG9wb3Zlci5zYXZlKCRldmVudClcIiBjbGFzcz0nYnRuIGJ0bi1wcmltYXJ5JyB2YWx1ZT0nU2F2ZScvPlxuICAgICAgICA8aW5wdXQgdHlwZT0nYnV0dG9uJyBuZy1jbGljaz1cInBvcG92ZXIuY2FuY2VsKCRldmVudClcIiBjbGFzcz0nYnRuIGJ0bi1kZWZhdWx0JyB2YWx1ZT0nQ2FuY2VsJy8+XG4gICAgICAgIDxpbnB1dCB0eXBlPSdidXR0b24nIG5nLWNsaWNrPVwicG9wb3Zlci5yZW1vdmUoJGV2ZW50KVwiIGNsYXNzPSdidG4gYnRuLWRhbmdlcicgdmFsdWU9J0RlbGV0ZScvPlxuICAgIDwvZGl2PlxuPC9mb3JtPiIKICAgICAgICB9KTsKICAgIH0KXSkKCmt1emVBcHAucnVuKGZ1bmN0aW9uKCRyb290U2NvcGUpIHsKICBsb2dEZWJ1ZygicnVuICRyb290U2NvcGUiKTsKICAkcm9vdFNjb3BlLiRvbignbG9hZGluZzpwcm9ncmVzcycsIGZ1bmN0aW9uICgpewogICAgICAvLyBzaG93IGxvYWRpbmcgZ2lmCiAgICAgIC8vICRzY29wZS5jdXJzb3JkZWxldGU9IndhaXQiOwogICAgICAvLyBkb2N1bWVudC5ib2R5LnN0eWxlLmN1cnNvcj0nd2FpdCc7CiAgfSk7CgogICRyb290U2NvcGUuJG9uKCdsb2FkaW5nOmZpbmlzaCcsIGZ1bmN0aW9uICgpewogICAgLy8gJHNjb3BlLmN1cnNvcmRlbGV0ZT0iIjsKICAgIC8vIGRvY3VtZW50LmJvZHkuc3R5bGUuY3Vyc29yPScnOwogIH0pOwp9KTsKCi8vIERFTEVURUQgLSB4ZWRpdGFibGUgc3R1ZmYKLy8ga3V6ZUFwcC5ydW4oZnVuY3Rpb24oZWRpdGFibGVPcHRpb25zLCBlZGl0YWJsZVRoZW1lcykgewovLyAgICAgbG9nRGVidWcoImluaXRpYWxpemluZyB4ZWRpdGFibGUgZWRpdGFibGVPcHRpb25zIik7Ci8vICAgICBlZGl0YWJsZU9wdGlvbnMudGhlbWUgPSAnYnMzJzsgLy8gYm9vdHN0cmFwMyB0aGVtZS4gQ2FuIGJlIGFsc28gJ2JzMicsICdkZWZhdWx0JwovLyAgICAgLy8gZWRpdGFibGVPcHRpb25zLmRlZmF1bHRzLm1vZGUgPSAnaW5saW5lJzsKLy8gICAgIGxvZ0RlYnVnKGVkaXRhYmxlT3B0aW9ucyk7Ci8vICAgICAvLyBlZGl0YWJsZU9wdGlvbnMubW9kZSA9ICdpbmxpbmUnOwovLyAgICAgZWRpdGFibGVUaGVtZXMuYnMzLmlucHV0Q2xhc3MgPSAnaW5wdXQtc20nOwovLyAgICAgZWRpdGFibGVUaGVtZXMuYnMzLmJ1dHRvbnNDbGFzcyA9ICdidG4tc20nOwovLyB9KTsKCi8vIGFmdGVyIGZvcm1zCi8vRGVmaW5lIFJvdXRpbmcgZm9yIGFwcAovL1VyaSAvQWRkTmV3T3JkZXIgLT4gdGVtcGxhdGUgYWRkX29yZGVyLmh0bWwgYW5kIENvbnRyb2xsZXIgQ2xpZW50c0FkZENvbnRyb2xsZXIKLy9VcmkgL1Nob3dPcmRlcnMgLT4gdGVtcGxhdGUgc2hvd19vcmRlcnMuaHRtbCBhbmQgQ29udHJvbGxlciBDbGllbnRzQWRkQ29udHJvbGxlcgprdXplQXBwLmNvbmZpZyhbJyRyb3V0ZVByb3ZpZGVyJywKICAgIGZ1bmN0aW9uKCRyb3V0ZVByb3ZpZGVyKSB7CiAgICAgICAgLy8gbG9nRGVidWcoJHJvdXRlUHJvdmlkZXIpOwogICAgICAgICRyb3V0ZVByb3ZpZGVyLgogICAgICAgIC8vIHdoZW4oJy9jbGllbnRjYXJkJywgewogICAgICAgIC8vICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19jbGllbnRfY2FyZC5odG1sJywKICAgICAgICAvLyAgICAgY29udHJvbGxlcjogJ2NsaWVudENhcmRDb250cm9sbGVyJwogICAgICAgIC8vIH0pLgogICAgICAgIHdoZW4oJy9jb250YWN0JywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdjb250YWN0LnBocCcsCiAgICAgICAgICAgIC8vIGNvbnRyb2xsZXI6ICdlbmRVc2VySG9tZUNvbnRyb2xsZXInCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdjb250YWN0Q29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvZXZlbnRfdHlwZXMnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2V2ZW50X3R5cGVzLmh0bWwnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnRXZlbnRUeXBlc0NvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2V2ZW50X3R5cGVzL2FkZCcsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfZXZlbnRfdHlwZV9hZGQucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0V2ZW50VHlwZU5ld0NvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2V2ZW50X3R5cGVzLzpldmVudF90eXBlX2lkJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19ldmVudF90eXBlX2FkZC5waHAnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnRXZlbnRUeXBlVXBkYXRlQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvaG91cnNfb2Zfd29yaycsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfaG91cnNfb2Zfd29yay5odG1sJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0hvdXJzT2ZXb3JrQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvYnVzaW5lc3NfY2FsZW5kYXInLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2NhbGVuZGFyLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdCdXNpbmVzc0NhbGVuZGFyQ29udHJvbGxlcicsCiAgICAgICAgICAgIHJlbG9hZE9uU2VhcmNoOiBmYWxzZQogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9hbmd1bGFyLWZvcm0tYnVpbGRlcicsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYW5ndWxhci1mb3JtLWJ1aWxkZXIvaW5kZXguaHRtbCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdEZW1vQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvYnVzaW5lc3NfY2xpZW50cy9hZGQnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2NsaWVudHNfYWRkLmh0bWwnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnQ2xpZW50c0FkZENvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2J1c2luZXNzX2NsaWVudHMnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2NsaWVudHMucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0NsaWVudHNTaG93Q29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvYnVzaW5lc3NfY2xpZW50cy86YnVzaW5lc3NfdXNlcl9pZCcsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6IGZ1bmN0aW9uKHBhcmFtcykgewogICAgICAgICAgICAgICAgcmV0dXJuICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfY2xpZW50X2NhcmQucGhwP2J1c2luZXNzX3VzZXJfaWQ9JyArIHBhcmFtcy5idXNpbmVzc191c2VyX2lkIDsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgY29udHJvbGxlcjogJ0NsaWVudHNTaG93MUNvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2J1c2luZXNzX3JlcG9ydHMnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX3JlcG9ydHMuaHRtbCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdCdXNpbmVzc1JlcG9ydHNDb250cm9sbGVyJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9idXNpbmVzc19pbnN0cnVjdG9ycycsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfaW5zdHJ1Y3RvcnMucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0luc3RydWN0b3JzU2hvd0NvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2J1c2luZXNzX2luc3RydWN0b3JzL2FkZCcsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfY2xpZW50c19hZGQuaHRtbCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdJbnN0cnVjdG9yc0FkZENvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2J1c2luZXNzX2xvY2F0aW9ucycsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbG9jYXRpb25zLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdidXNpbmVzc19sb2NhdGlvbnMnCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2J1c2luZXNzX2xvY2F0aW9ucy9hZGQnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2xvY2F0aW9uc19hZGQucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ2J1c2luZXNzX2xvY2F0aW9uc19hZGQnCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2J1c2luZXNzX2xvY2F0aW9ucy86bG9jYXRpb25faWQnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2xvY2F0aW9uc19hZGQucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ2J1c2luZXNzX2xvY2F0aW9uc191cGRhdGUnCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2J1c2luZXNzX2luc3RydWN0b3JzLzpidXNpbmVzc191c2VyX2lkJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19pbnN0cnVjdG9yX2NhcmQucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0luc3RydWN0b3JTaG93MUNvbnRyb2xsZXInCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL2V2ZW50LzpldmVudF9pZCcsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6IGZ1bmN0aW9uKHBhcmFtcykgewogICAgICAgICAgICAgICAgcmV0dXJuICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfZXZlbnRfY2FyZC5waHA/ZXZlbnRfaWQ9JyArIHBhcmFtcy5ldmVudF9pZCA7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdFdmVudFBhZ2VDb250cm9sbGVyJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9ldmVudF9jbGFzcy86ZXZlbnRfaWQnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBmdW5jdGlvbihwYXJhbXMpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2V2ZW50X2NsYXNzX2NhcmQucGhwP2V2ZW50X2lkPScgKyBwYXJhbXMuZXZlbnRfaWQgOwogICAgICAgICAgICB9LAogICAgICAgICAgICBjb250cm9sbGVyOiAnRXZlbnRDbGFzc1BhZ2VDb250cm9sbGVyJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9wYWNrYWdlcycsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfcGFja2FnZXNfc2hvdy5waHAnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnUGFja2FnZXNDb250cm9sbGVyJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9wYWNrYWdlcy9hZGQnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX3BhY2thZ2VzX2NyZWF0ZS5waHAnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnYnVzaW5lc3NfcGFja2FnZXNfYWRkX2NudGwnCiAgICAgICAgfSkuCiAgICAgICAgd2hlbignL3BhY2thZ2VzLzpwYWNrYWdlX2lkJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19wYWNrYWdlc19jcmVhdGUucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ2J1c2luZXNzX3BhY2thZ2VzX3VwZGF0ZV9jbnRsJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9idXNpbmVzc19jb25maWcnLCB7CiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2NvbmZpZy5waHAnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnQ29uZmlnQnVzaW5lc3NDb250cm9sbGVyJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy91c2VyX2NvbmZpZycsIHsKICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAndXNlcl9jb25maWcucGhwJywKICAgICAgICAgICAgY29udHJvbGxlcjogJ0NvbmZpZ1VzZXJDb250cm9sbGVyJwogICAgICAgIH0pLgogICAgICAgIHdoZW4oJy9idXNpbmVzc19kb2NzJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19kb2NzLmh0bWwnLAogICAgICAgICAgICBjb250cm9sbGVyOiAnQnVzaW5lc3NEb2NzQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICB3aGVuKCcvJywgewogICAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdob21lLnBocCcsCiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdIb21lQ29udHJvbGxlcicKICAgICAgICB9KS4KICAgICAgICBvdGhlcndpc2UoewogICAgICAgICAgICAvLyAgICByZWRpcmVjdFRvOiAnLycKICAgICAgICB9KTsKICAgIH0KXSk7CgprdXplQXBwLmZhY3RvcnkoJ2h0dHBJbnRlcmNlcHRvcicsIFsnJHEnLCAnJHJvb3RTY29wZScsCiAgICBmdW5jdGlvbiAoJHEsICRyb290U2NvcGUpIHsKICAgICAgICB2YXIgbG9hZGluZ0NvdW50ID0gMDsKCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgcmVxdWVzdDogZnVuY3Rpb24gKGNvbmZpZykgewogICAgICAgICAgICAgICAgaWYoKytsb2FkaW5nQ291bnQgPT09IDEpICRyb290U2NvcGUuJGJyb2FkY2FzdCgnbG9hZGluZzpwcm9ncmVzcycpOwogICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpZyB8fCAkcS53aGVuKGNvbmZpZyk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICByZXNwb25zZTogZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICBpZigtLWxvYWRpbmdDb3VudCA9PT0gMCkgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdsb2FkaW5nOmZpbmlzaCcpOwogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlIHx8ICRxLndoZW4ocmVzcG9uc2UpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgcmVzcG9uc2VFcnJvcjogZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICBpZigtLWxvYWRpbmdDb3VudCA9PT0gMCkgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdsb2FkaW5nOmZpbmlzaCcpOwogICAgICAgICAgICAgICAgcmV0dXJuICRxLnJlamVjdChyZXNwb25zZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgfQpdKS5jb25maWcoWyckaHR0cFByb3ZpZGVyJywgZnVuY3Rpb24gKCRodHRwUHJvdmlkZXIpIHsKICAgICRodHRwUHJvdmlkZXIuaW50ZXJjZXB0b3JzLnB1c2goJ2h0dHBJbnRlcmNlcHRvcicpOwp9XSk7CgprdXplQXBwLmZhY3RvcnkoJ3NoYXJlZERhdGEnLCBmdW5jdGlvbigpIHsKICAgIHZhciBzZWxlY3RlZEVuZFVzZXIgPSBudWxsOwoKICAgIHJldHVybiB7CiAgICAgICAgZ2V0U2VsZWN0ZWRFbmRVc2VyOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgLy9Zb3UgY291bGQgYWxzbyByZXR1cm4gc3BlY2lmaWMgYXR0cmlidXRlIG9mIHRoZSBmb3JtIGRhdGEgaW5zdGVhZAogICAgICAgICAgICAvL29mIHRoZSBlbnRpcmUgZGF0YQogICAgICAgICAgICByZXR1cm4gc2VsZWN0ZWRFbmRVc2VyOwogICAgICAgIH0sCiAgICAgICAgc2V0U2VsZWN0ZWRFbmRVc2VyOiBmdW5jdGlvbihuZXdTZWxlY3RlZEVuZFVzZXIpIHsKICAgICAgICAgICAgLy9Zb3UgY291bGQgYWxzbyBzZXQgc3BlY2lmaWMgYXR0cmlidXRlIG9mIHRoZSBmb3JtIGRhdGEgaW5zdGVhZAogICAgICAgICAgICBzZWxlY3RlZEVuZFVzZXIgPSBuZXdTZWxlY3RlZEVuZFVzZXI7CiAgICAgICAgfSwKICAgIH07Cn0pOwoKa3V6ZUFwcC5kaXJlY3RpdmUoJ2NvbnZlcnRUb051bWJlcicsIGZ1bmN0aW9uKCkgewogIHJldHVybiB7CiAgICByZXF1aXJlOiAnbmdNb2RlbCcsCiAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWxlbWVudCwgYXR0cnMsIG5nTW9kZWwpIHsKICAgICAgbmdNb2RlbC4kcGFyc2Vycy5wdXNoKGZ1bmN0aW9uKHZhbCkgewogICAgICAgIHJldHVybiB2YWwgIT0gbnVsbCA/IHBhcnNlSW50KHZhbCwgMTApIDogbnVsbDsKICAgICAgfSk7CiAgICAgIG5nTW9kZWwuJGZvcm1hdHRlcnMucHVzaChmdW5jdGlvbih2YWwpIHsKICAgICAgICByZXR1cm4gdmFsICE9IG51bGwgPyAnJyArIHZhbCA6IG51bGw7CiAgICAgIH0pOwogICAgfQogIH07Cn0pOwoKa3V6ZUFwcC5kaXJlY3RpdmUoJ2VsYXN0aWMnLCBbCiAgICAnJHRpbWVvdXQnLAogICAgZnVuY3Rpb24oJHRpbWVvdXQpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICByZXN0cmljdDogJ0EnLAogICAgICAgICAgICBsaW5rOiBmdW5jdGlvbigkc2NvcGUsIGVsZW1lbnQpIHsKICAgICAgICAgICAgICAgICRzY29wZS5pbml0aWFsSGVpZ2h0ID0gJHNjb3BlLmluaXRpYWxIZWlnaHQgfHwgZWxlbWVudFswXS5zdHlsZS5oZWlnaHQ7CiAgICAgICAgICAgICAgICB2YXIgcmVzaXplID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgZWxlbWVudFswXS5zdHlsZS5oZWlnaHQgPSAkc2NvcGUuaW5pdGlhbEhlaWdodDsKICAgICAgICAgICAgICAgICAgICBlbGVtZW50WzBdLnN0eWxlLmhlaWdodCA9ICIiICsgZWxlbWVudFswXS5zY3JvbGxIZWlnaHQgKyAicHgiOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIGVsZW1lbnQub24oImlucHV0IGNoYW5nZSIsIHJlc2l6ZSk7CiAgICAgICAgICAgICAgICAvLyBlbGVtZW50Lm9uKCJpbnB1dCBjaGFuZ2UiLCByZXNpemUpOwogICAgICAgICAgICAgICAgJHRpbWVvdXQocmVzaXplLCAwKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICB9Cl0pOwoKa3V6ZUFwcC5zZXJ2aWNlKCdzaGFyZWRQcm9wZXJ0aWVzJywgZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBzZWxlY3RlZF91c2VyID0gbnVsbDsKICAgICAgICB2YXIgY2FsZW5kYXJfZGF0ZSA9IG51bGw7CiAgICAgICAgdmFyIGV2ZW50X3Jlc2NoZWR1bGUgPSBudWxsOwogICAgICAgIHZhciBzZWxlY3RlZF9pbnN0cnVjdG9yID0gMDsKICAgICAgICB2YXIgZXZlbnRfdHlwZV9mb3Jfc3VnZ2VzdGlvbnMgPSBudWxsOwogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGdldF9zZWxlY3RlZF9pbnN0cnVjdG9yOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZWN0ZWRfaW5zdHJ1Y3RvcjsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2V0X3NlbGVjdGVkX2luc3RydWN0b3I6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgICAgICAgICBzZWxlY3RlZF9pbnN0cnVjdG9yID0gdmFsdWU7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGdldF9zZWxlY3RlZF91c2VyOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZWN0ZWRfdXNlcjsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2V0X3NlbGVjdGVkX3VzZXI6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgICAgICAgICBzZWxlY3RlZF91c2VyID0gdmFsdWU7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNldF9ldmVudF9yZXNjaGVkdWxlOiBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgICAgICAgICAgZXZlbnRfcmVzY2hlZHVsZSA9IHZhbHVlOwogICAgICAgICAgICB9LAogICAgICAgICAgICBnZXRfZXZlbnRfcmVzY2hlZHVsZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGV2ZW50X3Jlc2NoZWR1bGU7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGdldF9jYWxlbmRhcl9kYXRlOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gY2FsZW5kYXJfZGF0ZTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2V0X2NhbGVuZGFyX2RhdGU6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgICAgICAgICBjYWxlbmRhcl9kYXRlID0gdmFsdWU7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGdldF9ldmVudF90eXBlX2Zvcl9zdWdnZXN0aW9uczogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGV2ZW50X3R5cGVfZm9yX3N1Z2dlc3Rpb25zOwogICAgICAgICAgICB9LAogICAgICAgICAgICBzZXRfZXZlbnRfdHlwZV9mb3Jfc3VnZ2VzdGlvbnM6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgICAgICAgICAvLyBsb2dEZWJ1Zygic2V0X2V2ZW50X3R5cGVfZm9yX3N1Z2dlc3Rpb25zPSIrdmFsdWUpOwogICAgICAgICAgICAgICAgZXZlbnRfdHlwZV9mb3Jfc3VnZ2VzdGlvbnMgPSB2YWx1ZTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICB9KTsKCmt1emVBcHAuY29udHJvbGxlcignbWVudUNvbnRyb2xsZXInLCBbJyRzY29wZScsICckbG9jYXRpb24nLCBmdW5jdGlvbigkc2NvcGUsICRsb2NhdGlvbikgewogICAgcmV0dXJuIHRydWU7CiAgICBsb2dEZWJ1ZygiJHNjb3BlLmlzQ3VycmVudFBhdGg9IiArICRzY29wZS5pc0N1cnJlbnRQYXRoKTsKICAgICRzY29wZS5pc0N1cnJlbnRQYXRoID0gZnVuY3Rpb24ocGF0aCkgewogICAgICAgIHJldHVybiAkbG9jYXRpb24ucGF0aCgpID09IHBhdGg7CiAgICB9Owp9XSk7CgoKCmt1emVBcHAuY29udHJvbGxlcignQnVzaW5lc3NSZXBvcnRzQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbiwkcm91dGVQYXJhbXMpCnsKCiAgbG9nRGVidWcoImNvbnRyb2xsZXI6IEJ1c2luZXNzUmVwb3J0c0NvbnRyb2xsZXIiKTsKCiAgJHNjb3BlLm9yZGVyQnlGaWVsZCA9ICdzdGFydF9lcG9jaCc7CiAgJHNjb3BlLnJldmVyc2VTb3J0PXRydWU7CiAgJHNjb3BlLmV2ZW50TW9kZWw9dHJ1ZTsKCiAgZ2V0QnVzaW5lc3NMb2NhdGlvbnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19sb2NhdGlvbnMnKTsKICBnZXRBbGxCdXNpbmVzc0V2ZW50VHlwZXMoJGh0dHAsJHNjb3BlLCdldmVudF90eXBlcycpOwogIGdldEFsbEluc3RydWN0b3JzKCRodHRwLCRzY29wZSwnaW5zdHJ1Y3RvcnMnKTsKICBnZXRBbGxDbGllbnRzQW5kQXJjaGl2ZSgkaHR0cCwkc2NvcGUsJ2NsaWVudHMnKTsKICAkc2NvcGUuc3RhdHVzZXMgPSBbIHsic3RhdHVzX2lkIjoiMCIsInN0YXR1c19uYW1lIjoi16TXqteV15cifSwgeyJzdGF0dXNfaWQiOiIxIiwic3RhdHVzX25hbWUiOiLXodeS15XXqCJ9XTsKICAkc2NvcGUuY2FuY2VsbGF0aW9ucyA9IFsgeyJpc19jYW5jZWxlZCI6IjAiLCJjYW5jZWxsYXRpb25fbmFtZSI6Itec15Ag15HXldeY15wifSx7ImlzX2NhbmNlbGVkIjoiMSIsImNhbmNlbGxhdGlvbl9uYW1lIjoi15HXldeY15wifV07CiAgJHNjb3BlLm1vbnRocyA9IFsgeyJtb250aCI6IjEifSx7Im1vbnRoIjoiMiJ9LHsibW9udGgiOiIzIn0seyJtb250aCI6IjQifSx7Im1vbnRoIjoiNSJ9LHsibW9udGgiOiI2In0seyJtb250aCI6IjcifSx7Im1vbnRoIjoiOCJ9LHsibW9udGgiOiI5In0seyJtb250aCI6IjEwIn0seyJtb250aCI6IjExIn0seyJtb250aCI6IjEyIn1dOwogICRzY29wZS55ZWFycyA9IFsgeyJ5ZWFyIjoiMjAxNiJ9LHsieWVhciI6IjIwMTcifV07CiAgJHNjb3BlLnBlcmlvZHMgPSBbCiAgICAgIHsicGVyaW9kX25hbWUiOiLXlNeZ16HXmNeV16jXmSIsICJwZXJpb2Rfc2lnbiI6Ii0xIn0sCiAgICAgIHsicGVyaW9kX25hbWUiOiLXlNeZ15XXnSIsICJwZXJpb2Rfc2lnbiI6IjAifSwKICAgICAgeyJwZXJpb2RfbmFtZSI6Itei16rXmdeT15kiLCAicGVyaW9kX3NpZ24iOiIxIn0sCiAgICBdCgogICRzY29wZS5jc3ZfY29sdW1uc19vcmRlciA9IFsnZXZlbnRfdHlwZV9uYW1lJywgJ3N0YXJ0X3RpbWUnLCAnZXZlbnRfdXNlcl9jbGllbnRzJywgJ2luc3RydWN0b3JfbmFtZScsICdpc19jYW5jZWxlZCcsICdpc19jb21wbGV0ZWQnLCAnYWN0dWFsX3ByaWNlJywgJ3BhcnRpY2lwYXRlZCddOwogICRzY29wZS5jc3ZfY29sdW1uc19oZWFkZXIgPSBbJ9eh15XXkiDXntek15LXqScsICfXqteQ16jXmdeaINeV16nXoteUJywgJ9ee16nXqteq16TXmdedJywgJ9ee15PXqNeZ15onLCfXnteR15XXmNecJywgJ9eh15LXldeoJywgJ9ee15fXmdeoJywgJ9ee16nXqteq16TXmdedJ107CgoKCiAgJHNjb3BlLmdvdG9DbGllbnRQYWdlPSBmdW5jdGlvbiAoYnVzaW5lc3NVc2VyaWQpIHsKICAgIGdvdG9DbGllbnRQYWdlKGJ1c2luZXNzVXNlcmlkKTsKICB9CgogIGZ1bmN0aW9uIGxpc3RfdG9fc3RyaW5nX2J5X3ZhbHVlKHgsdmFsdWUpewogICAgaWYgKCB4ICE9IHVuZGVmaW5lZCApewogICAgICB2YXIgeDEgPSBuZXcgQXJyYXkoKTsKICAgICAgZm9yIChpID0gMDsgaSA8IHgubGVuZ3RoOyBpKyspewogICAgICAgIHgxW2ldID0geFtpXVt2YWx1ZV07CiAgICAgIH0KICAgICAgeDEgPSB4MS5qb2luKCk7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICByZXR1cm4geDE7CiAgfQoKICAkc2NvcGUucmVwb3J0X2lzX2xvYWRpbmcgPSBmYWxzZTsKCiRzY29wZS5ldmVudHNSZXBvcnQgPSBmdW5jdGlvbigpewpsb2dEZWJ1ZygiZXZlbnRzUmVwb3J0Iik7Cgokc2NvcGUuc2hvd0FnZyA9ICgkc2NvcGUuZXZlbnRUeXBlTW9kZWwpIHx8Cigkc2NvcGUuaW5zdHJ1Y3Rvck1vZGVsKSB8fCAoJHNjb3BlLm1vbnRoTW9kZWwpIHx8ICgkc2NvcGUuY2xpZW50c01vZGVsKSB8fCAoJHNjb3BlLnllYXJNb2RlbCkgOwoKZXZlbnRfdHlwZV9pZF9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuc2VsZWN0ZWRFdmVudFR5cGVGaWx0ZXIsICJldmVudF90eXBlX2lkIiApOwppbnN0cnVjdG9yX2lkX2ZpbHRlciA9IGxpc3RfdG9fc3RyaW5nX2J5X3ZhbHVlKCRzY29wZS5zZWxlY3RlZEluc3RydWN0b3JGaWx0ZXIsICJidXNpbmVzc191c2VyX2lkIiApOwptb250aF9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuc2VsZWN0ZWRNb250aEZpbHRlciwgIm1vbnRoIiApOwpjbGllbnRfZmlsdGVyID0gbGlzdF90b19zdHJpbmdfYnlfdmFsdWUoJHNjb3BlLnNlbGVjdGVkQ2xpZW50RmlsdGVyLCAiYnVzaW5lc3NfdXNlcl9pZCIgKTsKeWVhcl9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuc2VsZWN0ZWRZZWFyRmlsdGVyLCAieWVhciIgKTsKc3RhdHVzX2ZpbHRlciA9IGxpc3RfdG9fc3RyaW5nX2J5X3ZhbHVlKCRzY29wZS5zZWxlY3RlZFN0YXR1c0ZpbHRlciwgInN0YXR1c19pZCIgKTsKaXNfY2FuY2VsZWRfZmlsdGVyID0gbGlzdF90b19zdHJpbmdfYnlfdmFsdWUoJHNjb3BlLnNlbGVjdGVkSXNfY2FuY2VsZWRGaWx0ZXIsICJpc19jYW5jZWxlZCIgKTsKcGVyaW9kX2ZpbHRlciA9IGxpc3RfdG9fc3RyaW5nX2J5X3ZhbHVlKCRzY29wZS5zZWxlY3RlZFBlcmlvZEZpbHRlciwgInBlcmlvZF9zaWduIiApOwoKJHNjb3BlLmV2ZW50UmVwb3J0Q29uZmlnID0ge307CgogICAgJHNjb3BlLmV2ZW50UmVwb3J0Q29uZmlnLnNvdXJjZSA9ICJkb2NzIjsKCiRzY29wZS5ldmVudFJlcG9ydENvbmZpZy5maWx0ZXJzID0gewpldmVudF90eXBlX2lkOiBldmVudF90eXBlX2lkX2ZpbHRlciwKaW5zdHJ1Y3Rvcl9pZDogaW5zdHJ1Y3Rvcl9pZF9maWx0ZXIsCm1vbnRoOiBtb250aF9maWx0ZXIsCnllYXI6IHllYXJfZmlsdGVyLApjbGllbnQ6IGNsaWVudF9maWx0ZXIsCnN0YXR1czogc3RhdHVzX2ZpbHRlciwKcGVyaW9kOiBwZXJpb2RfZmlsdGVyLAppc19jYW5jZWxlZDogaXNfY2FuY2VsZWRfZmlsdGVyCn07Cgokc2NvcGUuZXZlbnRSZXBvcnRDb25maWcuYWdncmVnYXRpb25zID0gewpldmVudF90eXBlX2lkOiAkc2NvcGUuZXZlbnRUeXBlTW9kZWwsCmluc3RydWN0b3JfaWQ6ICRzY29wZS5pbnN0cnVjdG9yTW9kZWwsCm1vbnRoOiAkc2NvcGUubW9udGhNb2RlbCwKeWVhcjogJHNjb3BlLnllYXJNb2RlbCwKY2xpZW50OiAkc2NvcGUuY2xpZW50TW9kZWwsCn07CgppZiAoICRzY29wZS5zaG93QWdnICkgewogICAgICBnZXRFdmVudHNSZXBvcnQoJGh0dHAsJHNjb3BlLCAkc2NvcGUuZXZlbnRSZXBvcnRDb25maWcsIGdldEV2ZW50c1JlcG9ydEFnZ3JlZ2F0ZWRfc3VjY2Vzcyk7CiRzY29wZS5yZXBvcnRfaXNfbG9hZGluZyA9IHRydWU7Cn0gZWxzZSB7CiAgICAgIGdldEV2ZW50c1JlcG9ydCgkaHR0cCwkc2NvcGUsICRzY29wZS5ldmVudFJlcG9ydENvbmZpZywgZ2V0RXZlbnRzUmVwb3J0TGlzdF9zdWNjZXNzKTsKJHNjb3BlLnJlcG9ydF9pc19sb2FkaW5nID0gdHJ1ZTsKfQoKZnVuY3Rpb24gZ2V0RXZlbnRzUmVwb3J0TGlzdF9zdWNjZXNzKHJlc3BvbnNlKXsKJHNjb3BlLkV2ZW50UmVwb3J0TGlzdCA9IHJlc3BvbnNlLmpzb247CiRzY29wZS5kb3dubG9hZF9yZXBvcnQgPSAkc2NvcGVbICdFdmVudFJlcG9ydExpc3QnIF07CiRzY29wZS5yZXBvcnRfaXNfbG9hZGluZyA9IGZhbHNlOwp9CgpmdW5jdGlvbiBnZXRFdmVudHNSZXBvcnRBZ2dyZWdhdGVkX3N1Y2Nlc3MocmVzcG9uc2Upewokc2NvcGUuRXZlbnRSZXBvcnRBZ2dyZWdhdGVkID0gcmVzcG9uc2UuanNvbjsKJHNjb3BlLmRvd25sb2FkX3JlcG9ydCA9ICRzY29wZVsgJ0V2ZW50UmVwb3J0QWdncmVnYXRlZCcgXTsKJHNjb3BlLnJlcG9ydF9pc19sb2FkaW5nID0gZmFsc2U7Cn0KCmZ1bmN0aW9uIGdldENsaWVudHNSZXBvcnRMaXN0X3N1Y2Nlc3MocmVzcG9uc2Upewokc2NvcGUuQ2xpZW50c1JlcG9ydExpc3QgPSByZXNwb25zZS5qc29uOwpjb25zb2xlLmxvZygiLS0tLS0tLS0tLS0tIikKY29uc29sZS5sb2coJHNjb3BlLkNsaWVudHNSZXBvcnRMaXN0KQpjb25zb2xlLmxvZygiLS0tLS0tLS0tLS0tIikKJHNjb3BlLnJlcG9ydF9pc19sb2FkaW5nID0gZmFsc2U7Cn0KCgp9Cgokc2NvcGUuY2xpZW50c1JlcG9ydCA9IGZ1bmN0aW9uKCl7CmxvZ0RlYnVnKCJjbGllbnRzUmVwb3J0Iik7CgpjbGllbnRfZmlsdGVyID0gbGlzdF90b19zdHJpbmdfYnlfdmFsdWUoJHNjb3BlLnNlbGVjdGVkQ2xpZW50RmlsdGVyLCAiY2xpZW50IiApOwoKJHNjb3BlLmV2ZW50UmVwb3J0Q29uZmlnID0ge307Cgokc2NvcGUuZXZlbnRSZXBvcnRDb25maWcuZmlsdGVycyA9IHsKY2xpZW50OiBjbGllbnRfZmlsdGVyLAp9OwoKJHNjb3BlLmV2ZW50UmVwb3J0Q29uZmlnLmFnZ3JlZ2F0aW9ucyA9IHsKfTsKCmdldENsaWVudHNSZXBvcnQoJGh0dHAsJHNjb3BlLCBnZXRDbGllbnRzUmVwb3J0X3N1Y2Nlc3MpOwokc2NvcGUucmVwb3J0X2lzX2xvYWRpbmcgPSB0cnVlOwpmdW5jdGlvbiBnZXRDbGllbnRzUmVwb3J0X3N1Y2Nlc3MocmVzcG9uc2Upewokc2NvcGUuY2xpZW50UmVwb3J0ID0gcmVzcG9uc2UuanNvbjsKJHNjb3BlLmRvd25sb2FkX3JlcG9ydCA9ICRzY29wZVsgJ2NsaWVudFJlcG9ydCcgXTsKJHNjb3BlLnJlcG9ydF9pc19sb2FkaW5nID0gZmFsc2U7Cn0KfQoKJHNjb3BlLmVkaXRFdmVudD0gZnVuY3Rpb24gKHRoZWV2ZW50KQp7CmdvdG9FdmVudFBhZ2UodGhlZXZlbnQpOwp9Cgokc2NvcGUuZXZlbnRzUmVwb3J0KCk7CiRzY29wZS5zZWxlY3RlZFJlcG9ydD0iZXZlbnRzIjsKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2J1c2luZXNzX3BhY2thZ2VzX3VwZGF0ZV9jbnRsJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uLCRyb3V0ZVBhcmFtcykKewokc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyID0ge307IC8vIHRoZXNlIGFyZSB0aGUgY29tcGxldGUgZGV0YWlscyBmb3IgdGhlIG5ldyBldmVudCAvLwokc2NvcGUucGFja2FnZV9pc191cGRhdGUgPSB0cnVlOwokc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLnBhY2thZ2VfbGltaXRfdHlwZT0xOwoKLy8gZ2V0dHRpbmcgdGhlIHBhY2thZ2UgYW5kIGl0cyBldmVudCB0eXBlcwpnZXRCdXNpbmVzc1BhY2thZ2UoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5wYWNrYWdlX2lkLCdmb3JtQWRkUGFja2FnZUFuZ3VsYXInLGZ1bmN0aW9uKHJlc3BvbnNlKQp7CiRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuaXNfdXBkYXRlID0gdHJ1ZTsKJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5vcmlnRXZlbnRUeXBlcz1hbmd1bGFyLmNvcHkoJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5zZWxlY3RlZEV2ZW50VHlwZXMpOwokc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLnBhY2thZ2VfbGltaXRfdHlwZT0xOwovLyB0aGVuIGdldHRpbmcgYWxsIHRoZSBldmVudCB0eXBlcwpnZXRFdmVudFR5cGVzTm9BZG1pbigkaHR0cCwkc2NvcGUsJ3JlbGF0ZWRFdmVudFR5cGVzJyxnZXRFdmVudFR5cGVzTm9BZG1pbl9zdWNjZXNzKTsKZnVuY3Rpb24gZ2V0RXZlbnRUeXBlc05vQWRtaW5fc3VjY2VzcygpCnsKLy8gdGhlbiByZW1vdmluZyBleGlzdGluZyBldmVudCB0eXBlcyBvZiBwYWNrYWdlIGZyb20gbGlzdAovLyBjb25zb2xlLmxvZygkc2NvcGUucmVsYXRlZEV2ZW50VHlwZXNbMF0pOwovLyBjb25zb2xlLmxvZygkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLnNlbGVjdGVkRXZlbnRUeXBlc1swXSk7CmZvcih2YXIgaSA9IDA7IGkgPCAkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLnNlbGVjdGVkRXZlbnRUeXBlcy5sZW5ndGg7IGkrKykKewovLyBjb3B5aW5nIHRoZSBhY3R1YWwgb2JqZWN0IG9mICRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuc2VsZWN0ZWRFdmVudFR5cGVzW2ldCmZvcih2YXIgaiA9IDA7IGogPCAkc2NvcGUucmVsYXRlZEV2ZW50VHlwZXMubGVuZ3RoOyBqKyspCnsKaWYgKCRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuc2VsZWN0ZWRFdmVudFR5cGVzW2ldLmV2ZW50X3R5cGVfaWQ9PSRzY29wZS5yZWxhdGVkRXZlbnRUeXBlc1tqXS5ldmVudF90eXBlX2lkKQp7CiRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuc2VsZWN0ZWRFdmVudFR5cGVzW2ldPWFuZ3VsYXIuY29weSgkc2NvcGUucmVsYXRlZEV2ZW50VHlwZXNbal0pOwp9Cn0KfQp9Cn0pOwokc2NvcGUuZ290b0JhY2sgPSBnb3RvQmFjazsKJHNjb3BlLmNyZWF0ZVBhY2thZ2UgPSBmdW5jdGlvbigpCnsKY29uc29sZS5sb2coInVwZGF0ZVBhY2thZ2VEZXRhaWxzIik7CnVwZGF0ZVBhY2thZ2VEZXRhaWxzKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMucGFja2FnZV9pZCwkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLHN1Y2Nlc3NfY2FsbGJhY2ssIGZhaWx1cmVfY2FsbGJhY2spOwpmdW5jdGlvbiBzdWNjZXNzX2NhbGxiYWNrKCkKewpnb3RvQmFjaygpOwp9CmZ1bmN0aW9uIGZhaWx1cmVfY2FsbGJhY2soKQp7CmdvdG9CYWNrKCk7Cn0KfTsKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2J1c2luZXNzX3BhY2thZ2VzX2FkZF9jbnRsJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uKSB7CmxvZ0RlYnVnKCdidXNpbmVzc19wYWNrYWdlc19hZGRfY250bCcpOwokc2NvcGUucGFja2FnZV9pc191cGRhdGUgPSBmYWxzZTsKJHNjb3BlLmdvdG9CYWNrID0gZ290b0JhY2s7CiRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIgPSB7fTsKJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5ldmVudHNfY291bnRlciA9IDE7CiRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuZXZlbnRzX3Blcl93ZWVrID0gMTsKJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5wYWNrYWdlX2R1cmF0aW9uX21vbnRocyA9IDM7CiRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIucGFja2FnZV9saW1pdF90eXBlPTE7CmdldEV2ZW50VHlwZXNOb0FkbWluKCRodHRwLCRzY29wZSwncmVsYXRlZEV2ZW50VHlwZXMnKTsKCiRzY29wZS5jcmVhdGVQYWNrYWdlID0gZnVuY3Rpb24oKQp7CmNyZWF0ZVBhY2thZ2UoJGh0dHAsJHNjb3BlLCRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIsY3JlYXRlUGFja2FnZV9zdWNjZXNzLCBjcmVhdGVQYWNrYWdlX2ZhaWx1cmUpOwpmdW5jdGlvbiBjcmVhdGVQYWNrYWdlX3N1Y2Nlc3MoKQp7CiRsb2NhdGlvbi5wYXRoKCcvcGFja2FnZXMnKTsKfQpmdW5jdGlvbiBjcmVhdGVQYWNrYWdlX2ZhaWx1cmUoKQp7Ci8vIGxvZ0Vycm9yKCJlcnJvciAiICsgZGF0YS5tZXNzYWdlKTsKLy8gJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5hamF4X2Vycm9yID0gZGF0YS5tZXNzYWdlOwp9Cn0KfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2J1c2luZXNzX2xvY2F0aW9ucycsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikgewpsb2dEZWJ1ZygnYnVzaW5lc3NfbG9jYXRpb25zIGNvbnRyb2xsZXInKTsKZ2V0QnVzaW5lc3NMb2NhdGlvbnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19sb2NhdGlvbnMnKTsKJHNjb3BlLmFkZE5ld0xvY2F0aW9uID0gZnVuY3Rpb24gKCkKewokbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2xvY2F0aW9ucy9hZGQnKTsKfQokc2NvcGUuZ290b0xvY2F0aW9uUGFnZSA9IGZ1bmN0aW9uKGxvY2F0aW9uX2lkKQp7CmdvdG9Mb2NhdGlvblBhZ2UobG9jYXRpb25faWQpOwp9Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignQnVzaW5lc3NEb2NzQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikgewpsb2dEZWJ1ZygnQnVzaW5lc3NEb2NzQ29udHJvbGxlcicpOwp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ2J1c2luZXNzX2xvY2F0aW9uc191cGRhdGUnLCBmdW5jdGlvbigkc2NvcGUsICRyb3V0ZVBhcmFtcywgJGh0dHAsICRsb2NhdGlvbikgewpsb2dEZWJ1ZygnYnVzaW5lc3NfbG9jYXRpb25zX3VwZGF0ZSBjb250cm9sbGVyJyk7CiRzY29wZS5pc191cGRhdGU9dHJ1ZTsKLy8gZ2V0QnVzaW5lc3NMb2NhdGlvbnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19sb2NhdGlvbnMnKTsKZ2V0QnVzaW5lc3NMb2NhdGlvbigkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmxvY2F0aW9uX2lkLCdjdXJyX2xvY2F0aW9uJyxnZXRCdXNpbmVzc0xvY2F0aW9uX3N1Y2Nlc3MpOwpmdW5jdGlvbiBnZXRCdXNpbmVzc0xvY2F0aW9uX3N1Y2Nlc3MoKQp7CiRzY29wZS5mb3JtQWRkTG9jYXRpb25Bbmd1bGFyPSRzY29wZS5jdXJyX2xvY2F0aW9uWzBdOwp9CgoKJHNjb3BlLmFkZExvY2F0aW9uID0gZnVuY3Rpb24oKQp7Ci8vIGluIHRoaXMgY2FzZSAtIHVwZGF0ZSBsb2NhdGlvbgp0aGVkYXRhID0gJHNjb3BlLmZvcm1BZGRMb2NhdGlvbkFuZ3VsYXI7CgpmdW5jdGlvbiBhZGRMb2NhdGlvbl9zdWNjZXNzKCkKewokbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2xvY2F0aW9ucycpOwp9CmZ1bmN0aW9uIGFkZExvY2F0aW9uX2ZhaWx1cmUoKQp7CiRzY29wZS5mb3JtQWRkTG9jYXRpb25Bbmd1bGFyLmFqYXhfZXJyb3IgPSByZXNwb25zZS5tZXNzYWdlOwp9CnVwZGF0ZUxvY2F0aW9uKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMubG9jYXRpb25faWQsIHRoZWRhdGEsYWRkTG9jYXRpb25fc3VjY2VzcyxhZGRMb2NhdGlvbl9mYWlsdXJlKTsKfQp9KTsKCmt1emVBcHAuY29udHJvbGxlcignYnVzaW5lc3NfbG9jYXRpb25zX2FkZCcsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikgewpsb2dEZWJ1ZygnYnVzaW5lc3NfbG9jYXRpb25zX2FkZCBjb250cm9sbGVyJyk7CmdldEJ1c2luZXNzTG9jYXRpb25zKCRodHRwLCRzY29wZSwnYnVzaW5lc3NfbG9jYXRpb25zJyk7CiRzY29wZS5pc191cGRhdGU9ZmFsc2U7Cgokc2NvcGUuYWRkTG9jYXRpb24gPSBmdW5jdGlvbigpCnsKdGhlZGF0YSA9ICRzY29wZS5mb3JtQWRkTG9jYXRpb25Bbmd1bGFyOwoKZnVuY3Rpb24gYWRkTG9jYXRpb25fc3VjY2VzcygpCnsKJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19sb2NhdGlvbnMnKTsKfQpmdW5jdGlvbiBhZGRMb2NhdGlvbl9mYWlsdXJlKCkKewokc2NvcGUuZm9ybUFkZExvY2F0aW9uQW5ndWxhci5hamF4X2Vycm9yID0gcmVzcG9uc2UubWVzc2FnZTsKfQphZGRMb2NhdGlvbigkaHR0cCwkc2NvcGUsdGhlZGF0YSxhZGRMb2NhdGlvbl9zdWNjZXNzLGFkZExvY2F0aW9uX2ZhaWx1cmUpOwp9Cn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdJbnN0cnVjdG9yc0FkZENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkbG9jYXRpb24pIHsKbG9nRGVidWcoJ0luc3RydWN0b3JzQWRkQ29udHJvbGxlcicpOwokc2NvcGUuaXNJbnN0cnVjdG9yPXRydWU7CiRzY29wZS51c2VydHlwZT0iaW5zdHJ1Y3RvciI7CiRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhciA9IHt9Owokc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIuaXNfdXBkYXRlPWZhbHNlOwokc2NvcGUuYWRkQ2xpZW50ID0gZnVuY3Rpb24oKSAvLyBhZGQgaW5zdHJ1Y3RvciwgdXNpbmcgdGhlIHNhbWUgZnVuY3Rpb24gbmFtZSBhcyB3ZSB1c2UgdGhlIHNhbWUgc2NyZWVuCnsKdGhlZGF0YSA9ICRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhcjsKCmZ1bmN0aW9uIGFkZEluc3RydWN0b3Jfc3VjY2VzcygpCnsKJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19pbnN0cnVjdG9ycycpOwp9CmZ1bmN0aW9uIGFkZENsaWVudF9mYWlsdXJlKCkKewokc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIuYWpheF9lcnJvciA9IHJlc3BvbnNlLm1lc3NhZ2U7Cn0KYWRkSW5zdHJ1Y3RvcigkaHR0cCwkc2NvcGUsdGhlZGF0YSxhZGRJbnN0cnVjdG9yX3N1Y2Nlc3MpOwp9Cn0pOwprdXplQXBwLmNvbnRyb2xsZXIoJ0NsaWVudHNBZGRDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJHRpbWVvdXQsICRsb2NhdGlvbiwgc2hhcmVkUHJvcGVydGllcykgewpsb2dEZWJ1ZygnQ2xpZW50c0FkZENvbnRyb2xsZXIgLSBUaGlzIGlzIEFkZCBuZXcgY2xpZW50IHNjcmVlbicpOwokc2NvcGUuaXNJbnN0cnVjdG9yPWZhbHNlOwoKJHNjb3BlLnVzZXJ0eXBlPSJlbmR1c2VyIjsKJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyID0ge307CiRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5pc191cGRhdGU9ZmFsc2U7CiRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5kaXNhYmxlX3Bob25lX2VkaXRpbmc9ZmFsc2U7CgppZiAoKCRzY29wZS5maWx0ZXIuVmFsdWUgIT0gIiIpICYmICh0eXBlb2YgJHNjb3BlLmZpbHRlci5WYWx1ZSAhPSAndW5kZWZpbmVkJykpIHsKbG9nRGVidWcoImNsaWVudHMgZmlsdGVyIGlzIG5vdCBlbXB0eSIpOwp2YXIgZmlsdGVyID0gU3RyaW5nKCRzY29wZS5maWx0ZXIuVmFsdWUpOwppZiAoZmlsdGVyLmluZGV4T2YoIiAiKSA+IDApIHsKJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyLmZpcnN0X25hbWUgPSBmaWx0ZXIuc3Vic3RyKDAsIGZpbHRlci5pbmRleE9mKCIgIikpOwokc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIubGFzdF9uYW1lID0gZmlsdGVyLnN1YnN0cigxICsgZmlsdGVyLmluZGV4T2YoIiAiKSk7Cn0gZWxzZSB7CiRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5maXJzdF9uYW1lID0gZmlsdGVyOwokc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIubGFzdF9uYW1lID0gIiI7Cn0KJHNjb3BlLmZpbHRlci5WYWx1ZSA9ICIiOwokc2NvcGUuZmlsdGVyLmJ1dHRvblZhbHVlID0gIiI7Cn0gZWxzZSB7Cn0KCiRzY29wZS5nb3RvQmFjayA9IGZ1bmN0aW9uKCkKewokbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2NsaWVudHMnKTsKfQoKJHNjb3BlLmFkZENsaWVudCA9IGZ1bmN0aW9uKCkKewp0aGVkYXRhID0gJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyOwoKZnVuY3Rpb24gYWRkQ2xpZW50X3N1Y2Nlc3ModXNlcl9pZCkKewppZiAoJHNjb3BlLnNhdmVfYW5kX3NjaGVkdWxlKQp7Ci8vICRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfY2xpZW50cy8nK3VzZXJfaWQuanNvbik7CmxvZ0RlYnVnKCJORVcgdXNlciB1c2VyX2lkPSIrdXNlcl9pZC5qc29uKTsKCnVzZXJfaW5mbz0gewpidXNpbmVzc191c2VyX2lkOiB1c2VyX2lkLmpzb24sCmJ1c2VyX2ZpcnN0X25hbWU6ICRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5idXNlcl9maXJzdF9uYW1lLApidXNlcl9sYXN0X25hbWU6ICRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5idXNlcl9sYXN0X25hbWUKfTsKCnNoYXJlZFByb3BlcnRpZXMuc2V0X3NlbGVjdGVkX3VzZXIodXNlcl9pbmZvKTsKJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jYWxlbmRhcicpOwoKfQplbHNlCnsKJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jbGllbnRzLycpOwp9CmNvbnNvbGUubG9nKCJuZXcgdXNlciBpZCA9ICIrdXNlcl9pZC5qc29uKTsKfQpmdW5jdGlvbiBhZGRDbGllbnRfZmFpbHVyZShyZXNwb25zZSkKewokc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIuYWpheF9lcnJvciA9IHJlc3BvbnNlLm1lc3NhZ2U7CiR0aW1lb3V0KGZ1bmN0aW9uKCkKewokc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIuYWpheF9lcnJvcj1udWxsOwp9LCAyNTAwKTsKfQphZGRDbGllbnQoJGh0dHAsJHNjb3BlLHRoZWRhdGEsYWRkQ2xpZW50X3N1Y2Nlc3MsIGFkZENsaWVudF9mYWlsdXJlLGZhbHNlKTsKfQp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ1BhY2thZ2VzQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikgewpsb2dEZWJ1ZygnUGFja2FnZXNDb250cm9sbGVyJyk7CmdldEJ1c2luZXNzUGFja2FnZXMoJGh0dHAsJHNjb3BlLCdwYWNrYWdlcycpOwoKJHNjb3BlLnNob3dQYWNrYWdlID0gZnVuY3Rpb24gKHRoZXBhY2thZ2UpCnsKJGxvY2F0aW9uLnBhdGgoJy9wYWNrYWdlcy8nK3RoZXBhY2thZ2UucGFja2FnZV9pZCk7Cn0KfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdJbnN0cnVjdG9yc1Nob3dDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uKSB7CmxvZ0RlYnVnKCdJbnN0cnVjdG9yc1Nob3dDb250cm9sbGVyJyk7CiRzY29wZS5vcmRlckJ5RmllbGQgPSAnYnVzZXJfc3RhcnRfZGF0ZSc7CiRzY29wZS5yZXZlcnNlU29ydD10cnVlOwoKZ2V0QWxsSW5zdHJ1Y3RvcnMoJGh0dHAsJHNjb3BlLCdhbGxDbGllbnRzJyxnZXRBbGxJbnN0cnVjdG9yc19zdWNjZXNzKTsKZnVuY3Rpb24gZ2V0QWxsSW5zdHJ1Y3RvcnNfc3VjY2VzcygpCnsKJHNjb3BlLnNob3dDbGllbnRzR3JpZE9wdGlvbnMuZGF0YT0kc2NvcGUuYWxsQ2xpZW50czsKfQoKJHNjb3BlLmdvdG9JbnN0cnVjdG9yUGFnZT0gZnVuY3Rpb24gKGJ1c2luZXNzX3VzZXJfaWQpCnsKZ290b0luc3RydWN0b3JQYWdlKGJ1c2luZXNzX3VzZXJfaWQpOwp9Cgokc2NvcGUuY2xpZW50TmFtZUZpbHRlcj0iIjsKJHNjb3BlLmlucHV0RmlsdGVyID0gZnVuY3Rpb24gKGl0ZW0pCnsKLy8gY29uc29sZS5sb2coaXRlbS5idXNlcl9waG9uZV9udW1iZXIpOwpyZXR1cm4gZmlsdGVyX2ZpcnN0bGFzdF9uYW1lKGl0ZW0uYnVzZXJfZmlyc3RfbmFtZSxpdGVtLmJ1c2VyX2xhc3RfbmFtZSxpdGVtLmJ1c2VyX3Bob25lX251bWJlciwkc2NvcGUuY2xpZW50TmFtZUZpbHRlcik7Cn07Cn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdDbGllbnRzU2hvd0NvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICR1aWJNb2RhbCwgJGh0dHAsICRsb2NhdGlvbikgewpsb2dEZWJ1ZygnQ2xpZW50c1Nob3dDb250cm9sbGVyJyk7CiRzY29wZS5vcmRlckJ5RmllbGQgPSAnYnVzZXJfc3RhcnRfZGF0ZSc7CiRzY29wZS5yZXZlcnNlU29ydD10cnVlOwoKZ2V0QWxsQ2xpZW50cygkaHR0cCwkc2NvcGUsJ2FsbENsaWVudHMnLGdldENsaWVudF9zdWNjZXNzKTsKZnVuY3Rpb24gZ2V0Q2xpZW50X3N1Y2Nlc3MoKQp7CiRzY29wZS5zaG93Q2xpZW50c0dyaWRPcHRpb25zLmRhdGE9JHNjb3BlLmFsbENsaWVudHM7Cn0KCiRzY29wZS5nb3RvQ2xpZW50UGFnZT0gZnVuY3Rpb24gKGJ1c2luZXNzVXNlcmlkKQp7CmdvdG9DbGllbnRQYWdlKGJ1c2luZXNzVXNlcmlkKTsKfQoKLy8gZmlsdGVyIGFyY2hpdmVkIGNsaWVudHMKJHNjb3BlLnNob3dBcmNoaXZlZENoZWNrYm94PWZhbHNlOwokc2NvcGUuc2hvd0FyY2hpdmVkID0gZnVuY3Rpb24gKGVjbGllbnQpCnsKaWYgKGVjbGllbnQuaXNfYWN0aXZlPT0wKQp7CmxvZ0RlYnVnKGVjbGllbnQpOwppZiAoJHNjb3BlLnNob3dBcmNoaXZlZENoZWNrYm94KQp7CnJldHVybiBlY2xpZW50Owp9Cn0KZWxzZSB7CnJldHVybiBlY2xpZW50Owp9Cn07Cgokc2NvcGUuY2xpZW50TmFtZUZpbHRlcj0iIjsKJHNjb3BlLmlucHV0RmlsdGVyID0gZnVuY3Rpb24gKGl0ZW0pCnsKICAgICAgLy8gY29uc29sZS5sb2coImNsaWVudE5hbWVGaWx0ZXIiKTsKcmV0dXJuIGZpbHRlcl9maXJzdGxhc3RfbmFtZShpdGVtLmJ1c2VyX2ZpcnN0X25hbWUsaXRlbS5idXNlcl9sYXN0X25hbWUsaXRlbS5idXNlcl9waG9uZV9udW1iZXIsJHNjb3BlLmNsaWVudE5hbWVGaWx0ZXIpOwp9OwoKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXM9W107Ci8vICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzID0gWwovLyAgIHsiZmllbGRfaWQiOjAsImZpZWxkX25hbWUiOiLXqteQ16jXmdeaINec15nXk9eUIiwiZmllbGRfZGF0YXR5cGUiOiJEQVRFIiwiaXNfbWFuZGF0b3J5IjowLCAiZnJvbWRiIjogZmFsc2UsICJkYl9pZF90b2ZpeCI6IDAsICJpc19hY3RpdmUiOiAxLCAibW9kaWZpZWQiOiBmYWxzZX0sCi8vICAgeyJmaWVsZF9pZCI6MCwiZmllbGRfbmFtZSI6IteU16LXqNeV16oiLCJmaWVsZF9kYXRhdHlwZSI6IlRFWFRfQVJFQSIsImlzX21hbmRhdG9yeSI6MCwgImZyb21kYiI6IGZhbHNlLCAiZGJfaWRfdG9maXgiOiAwLCAiaXNfYWN0aXZlIjogMSwgIm1vZGlmaWVkIjogZmFsc2V9Ci8vIF07CgpmdW5jdGlvbiBnZXRDbGllbnRzRXh0cmFGaWVsZHNfc3VjY2VzcygpCnsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMgPSAkc2NvcGUuZXh0cmFGaWVsZHM7Cn0KZ2V0Q2xpZW50c0V4dHJhRmllbGRzKCRodHRwLCRzY29wZSwnZXh0cmFGaWVsZHMnLGdldENsaWVudHNFeHRyYUZpZWxkc19zdWNjZXNzKTsKCiRzY29wZS5ldmVudFR5cGVFeHRyYUZpZWxkc1BvcCA9IGZ1bmN0aW9uKGV2ZW50VHlwZVByb3BlcnRpZXMpIHsKICAgICAgICBsb2dEZWJ1ZygiZXZlbnRUeXBlRXh0cmFGaWVsZHNQb3AzIik7Cgp2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKYW5pbWF0aW9uOiBmYWxzZSwKdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfY2xpZW50X2V4dHJhX2ZpZWxkcy5waHAnLApjb250cm9sbGVyOiAnZXZlbnRUeXBlRXh0cmFGaWVsZHNNb2RhbENvbnRyb2xsZXInLApzaXplOiAnbCcsCnJlc29sdmU6IHsKZXZlbnRUeXBlUHJvcGVydGllczogZnVuY3Rpb24oKSB7CnJldHVybiBldmVudFR5cGVQcm9wZXJ0aWVzOwp9Cn0KfSk7Cgptb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHNlbGVjdGVkSXRlbSkgewpsb2dEZWJ1ZyhzZWxlY3RlZEl0ZW0pOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyA9IHNlbGVjdGVkSXRlbTsKfSwgZnVuY3Rpb24oKSB7CmxvZ0RlYnVnKCdNb2RhbCBkaXNtaXNzZWQgYXQ6ICcgKyBuZXcgRGF0ZSgpKTsKfSk7Cn07Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignc2NoZWR1bGVyQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRyb3V0ZVBhcmFtcykgewpldmVudF90eXBlX2lkPSRyb3V0ZVBhcmFtcy5ldmVudF90eXBlX2lkOwoKJHNjb3BlLnN1Z2dlc3Rpb25EYXRlID0gW107CiRzY29wZS5zdWdnZXN0aW9uRGF0ZS5kYXRlID0gbmV3IERhdGUoKTsKJHNjb3BlLnN1Z2dlc3Rpb25EYXRlLm9wdGlvbnMgPSB7Ci8vIG1pbkRhdGU6IG5ldyBEYXRlKCksCi8vIHNob3dXZWVrczogdHJ1ZSwKbWluVmlldzonZGF5JywKc3RhcnRWaWV3OiAnZGF5JwoKfTsKdmFyIHRoZXRpbWUgPSBuZXcgRGF0ZSgpOwokc2NvcGUuZmlsdGVyQWxsRGF5c0NoZWNrYm94PXRydWU7CiRzY29wZS5maWx0ZXJEYXlJdGVtcyA9IHsKCifXqNeQ16nXldefJzogdHJ1ZSwKJ9ep16DXmSc6IHRydWUsCifXqdec15nXqdeZJzogdHJ1ZSwKJ9eo15HXmdei15knOiB0cnVlLAon15fXnteZ16nXmSc6IHRydWUsCifXqdeZ16nXmSc6IHRydWUsCifXqdeR16onOiB0cnVlCn07Cgokc2NvcGUub25UaW1lU2V0ID0gZnVuY3Rpb24gKG5ld0RhdGUsIG9sZERhdGUpIHsKbG9nRGVidWcoIm5ldyBkYXRlICIrbmV3RGF0ZS5nZXRUaW1lKCkgKyAiIG9sZCBkYXRlICIrb2xkRGF0ZS5nZXRUaW1lKCkpOwpkaWZmPW5ld0RhdGUuZ2V0VGltZSgpLW9sZERhdGUuZ2V0VGltZSgpOwovLyBpZiBuZXcgZGF0ZSBpcyBpbiBhIGRpZmZlcmVudCB3ZWVrCi8vIHdlIHJlZmV0Y2ggc3VnZ2VzdGlvbnMgZm9yIHRoZSBjdXJyZW50IHdlZWsKdmFyIG5ld0RhdGVXID0gbmV3IERhdGUobmV3RGF0ZSk7CnZhciBvbGREYXRlVyA9IG5ldyBEYXRlKG9sZERhdGUpOwovLyBhbGVydChuZXdEYXRlVy5mb3JtYXQoJ1cnKSk7Ci8vIGFsZXJ0KG9sZERhdGVXLmZvcm1hdCgnVycpKTsKaWYgKG5ld0RhdGVXLmZvcm1hdCgnVycpIT1vbGREYXRlVy5mb3JtYXQoJ1cnKSkKewpsb2dEZWJ1ZygiZGlmZiBpcyBhIHdlZWsgb3IgbW9yZSwgcmVmZXRjaGluZyBzdWdnZXN0aW9ucyIpOwokaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3QvIitldmVudF90eXBlX2lkKyIvIituZXdEYXRlLmdldEZ1bGxZZWFyKCkrIi8iKyhuZXdEYXRlLmdldE1vbnRoKCkrMSkrIi8iK25ld0RhdGUuZ2V0RGF0ZSgpKyIvIituZXdEYXRlLmdldEhvdXJzKCkgKyAiLyIgKyBuZXdEYXRlLmdldE1pbnV0ZXMoKSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkgewovLwkgICAgJHNjb3BlLm15RGF0YSA9IHJlc3BvbnNlLmRhdGE7Ci8vCQlsb2dEZWJ1ZygiZ3JpZG9wdGlvbnM9Iiskc2NvcGUuZ3JpZE9wdGlvbnMpOwokc2NvcGUuZXZlbnRzU3VnZ2VzdGVkID0gcmVzcG9uc2UuZGF0YTsKfSk7Cgp9Cn0KCiRzY29wZS5vcHRpb25zID0gewpjdXN0b21DbGFzczogZ2V0RGF5Q2xhc3MsCm1pbkRhdGU6IG5ldyBEYXRlKCksCnNob3dXZWVrczogdHJ1ZQp9Owokc2NvcGUuZHQgPSBuZXcgRGF0ZSgpOwoKCmZ1bmN0aW9uIGdldERheUNsYXNzKGRhdGEpIHsKcmV0dXJuICcnOwp9Cgokc2NvcGUuZGF5c0l0ZW1zID0gWwp7bmFtZTon16jXkNep15XXnyd9LAp7bmFtZTon16nXoNeZJ30sCntuYW1lOifXqdec15nXqdeZJ30sCntuYW1lOifXqNeR15nXoteZJ30sCntuYW1lOifXl9ee15nXqdeZJ30sCntuYW1lOifXqdeZ16nXmSd9LAp7bmFtZTon16nXkdeqJ30KXTsKCiRzY29wZS5maWx0ZXJBbGxEYXlJdGVtc1NldCA9IGZ1bmN0aW9uICgpCnsKJHNjb3BlLmZpbHRlckRheUl0ZW1zWyfXqNeQ16nXldefJ109JHNjb3BlLmZpbHRlckFsbERheXNDaGVja2JveDsKJHNjb3BlLmZpbHRlckRheUl0ZW1zWyfXqdeg15knXT0kc2NvcGUuZmlsdGVyQWxsRGF5c0NoZWNrYm94Owokc2NvcGUuZmlsdGVyRGF5SXRlbXNbJ9ep15zXmdep15knXT0kc2NvcGUuZmlsdGVyQWxsRGF5c0NoZWNrYm94Owokc2NvcGUuZmlsdGVyRGF5SXRlbXNbJ9eo15HXmdei15knXT0kc2NvcGUuZmlsdGVyQWxsRGF5c0NoZWNrYm94Owokc2NvcGUuZmlsdGVyRGF5SXRlbXNbJ9eX157Xmdep15knXT0kc2NvcGUuZmlsdGVyQWxsRGF5c0NoZWNrYm94Owokc2NvcGUuZmlsdGVyRGF5SXRlbXNbJ9ep15nXqdeZJ109JHNjb3BlLmZpbHRlckFsbERheXNDaGVja2JveDsKJHNjb3BlLmZpbHRlckRheUl0ZW1zWyfXqdeR16onXT0kc2NvcGUuZmlsdGVyQWxsRGF5c0NoZWNrYm94Owp9Cgokc2NvcGUuc3VnZ2VzdEZpbHRlckRheXMgPSBmdW5jdGlvbiAoZXN1Z2dlc3QpCnsKLy8gbG9nRGVidWcoZXN1Z2dlc3QpOwppZiAoKCRzY29wZS5maWx0ZXJEYXlJdGVtc1tlc3VnZ2VzdC5zdGFydF9mb3JtYXRfZG93XSkgJiAoKCRzY29wZS5zdWdnZXN0aW9uRGF0ZS5kYXRlLmdldFRpbWUoKS8xMDAwKTxlc3VnZ2VzdC5zdGFydF9lcG9jaCkpCnsKcmV0dXJuIGVzdWdnZXN0Owp9Cn07Cgpsb2dEZWJ1Zygnc2NoZWR1bGVyQ29udHJvbGxlciBmb3IgZXZlbnQgdHlwZSBpZCAnK2V2ZW50X3R5cGVfaWQrIiAiK3RoZXRpbWUuZ2V0SG91cnMoKSArICI6IiArIHRoZXRpbWUuZ2V0TWludXRlcygpICsgIjoiICsgdGhldGltZS5nZXRTZWNvbmRzKCkpOwokaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3QvIitldmVudF90eXBlX2lkKyIvIit0aGV0aW1lLmdldEZ1bGxZZWFyKCkrIi8iKyh0aGV0aW1lLmdldE1vbnRoKCkrMSkrIi8iK3RoZXRpbWUuZ2V0RGF0ZSgpKyIvIit0aGV0aW1lLmdldEhvdXJzKCkgKyAiLyIgKyB0aGV0aW1lLmdldE1pbnV0ZXMoKSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkgewovLwkgICAgJHNjb3BlLm15RGF0YSA9IHJlc3BvbnNlLmRhdGE7Ci8vCQlsb2dEZWJ1ZygiZ3JpZG9wdGlvbnM9Iiskc2NvcGUuZ3JpZE9wdGlvbnMpOwokc2NvcGUuZXZlbnRzU3VnZ2VzdGVkID0gcmVzcG9uc2UuZGF0YTsKfSk7CgokaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRfdHlwZXMvIitldmVudF90eXBlX2lkKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7Ci8vCSAgICAkc2NvcGUubXlEYXRhID0gcmVzcG9uc2UuZGF0YTsKLy8JCWxvZ0RlYnVnKCJncmlkb3B0aW9ucz0iKyRzY29wZS5ncmlkT3B0aW9ucyk7CiRzY29wZS5ldmVudFR5cGVEZXRhaWxzID0gcmVzcG9uc2UuZGF0YTsKfSk7Cn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdjb250YWN0Q29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHApIHsKbG9nRGVidWcoJ2NvbnRhY3RDb250cm9sbGVyJyk7Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcigncGFja2FnZVBheW1lbnRBc3NvY2lhdGlvbk1vZGFsQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHJvdXRlUGFyYW1zLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIGZwYWNrYWdlLCBiYWxhbmNlLCBidXNpbmVzc191c2VyX2lkLCB1aUNhbGVuZGFyQ29uZmlnKQp7CmxvZ0RlYnVnKCJwYWNrYWdlUGF5bWVudEFzc29jaWF0aW9uTW9kYWxDb250cm9sbGVyIik7Cgokc2NvcGUuZnBhY2thZ2U9ZnBhY2thZ2U7CiRzY29wZS5iYWxhbmNlPWJhbGFuY2U7CiRzY29wZS5wYWNrYWdlX3BheW1lbnRzPSRzY29wZS5mcGFja2FnZS5wYWNrYWdlX3BheW1lbnRzOwokc2NvcGUucHJldmlvdXNfaXNfYWxsX3BhaWQ9JHNjb3BlLmZwYWNrYWdlLmlzX2FsbF9wYWlkOwokc2NvcGUuYnVzaW5lc3NfdXNlcl9pZD1idXNpbmVzc191c2VyX2lkOwoKLy8gJ2NhbGN1bGF0aW5nJyBwcmV2aW91cyBzdGF0dXMgb2YgcGF5bWVudAppZiAoJHNjb3BlLnBhY2thZ2VfcGF5bWVudHM+MCkKewppZiAoJHNjb3BlLnByZXZpb3VzX2lzX2FsbF9wYWlkPT0xKQp7CiRzY29wZS5wcmV2aW91c19zdGF0dXM9ImlzX2FsbF9wYWlkIjsKJHNjb3BlLnBhY2thZ2Vfc3RhdHVzX2lkPS0xOwokc2NvcGUucHJldmlvdXNfcGFja2FnZV9zdGF0dXNfaWQ9LTE7Cn0KZWxzZQp7CiRzY29wZS5wcmV2aW91c19zdGF0dXM9ImlzX3BhcnRseV9wYWlkIjsKJHNjb3BlLnBhY2thZ2Vfc3RhdHVzX2lkPS0xOwokc2NvcGUucHJldmlvdXNfcGFja2FnZV9zdGF0dXNfaWQ9LTE7Cn0KfQplbHNlCnsKJHNjb3BlLnByZXZpb3VzX3N0YXR1cz0ibm90X3BhaWQiOwokc2NvcGUucGFja2FnZV9zdGF0dXNfaWQ9MDsKJHNjb3BlLnByZXZpb3VzX3BhY2thZ2Vfc3RhdHVzX2lkPTA7Cgp9CmxvZ0RlYnVnKCJwcmV2aW91c19zdGF0dXM9Iiskc2NvcGUucHJldmlvdXNfc3RhdHVzKTsKCiRzY29wZS5jbG9zZU1vZGFsID0gZnVuY3Rpb24oKQp7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKfTsKJHNjb3BlLnVwZGF0ZVBhY2thZ2VQYXltZW50ID0gZnVuY3Rpb24oKQp7Ci8vIGNvbnNvbGUubG9nKCJwcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ9Iiskc2NvcGUuZm1lZXRpbmcucHJldmlvdXNfcGFja2FnZV91c2VyX2lkKTsKLy8gY29uc29sZS5sb2coInBhY2thZ2VfdXNlcl9pZD0iKyRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQpOwpsb2dEZWJ1ZygidXBkYXRlUGFja2FnZVBheW1lbnQiKQovLyBpZiBzZWxlY3RlZCBwYWNrYWdlIGlzIGxpa2UgcHJldmlvdXMgcGFja2FnZSAtIGRvIG5vdGhpbmcKaWYgKCgkc2NvcGUucHJldmlvdXNfcGFja2FnZV9zdGF0dXNfaWQ9PSRzY29wZS5wYWNrYWdlX3N0YXR1c19pZCkpCnsKbG9nRGVidWcoInNlbGVjdGVkIG9wdGlvbiBpcyBsaWtlIHByZXZpb3VzIG9wdGlvbiAtIGRvIG5vdGhpbmciKTsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwp9CgovLyBwcmV2aW91cyBwYWNrYWdlIHdhcyBwYWlkL3BhcnRseS1wYWlkIC0gbm93IG5vdGhpbmdzIGlzIHNlbGVjdGVkCmVsc2UgaWYgKCgkc2NvcGUucHJldmlvdXNfcGFja2FnZV9zdGF0dXNfaWQ9PS0xKSAmJiAoJHNjb3BlLnBhY2thZ2Vfc3RhdHVzX2lkPT0wKSkKewpsb2dEZWJ1Zygid2FzIHBhaWQvcGFydGx5IHBhaWQsIHJlbW92aW5nIHBheW1lbnQiKTsKcmVtb3ZlUGFja2FnZVBheW1lbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5mcGFja2FnZS5wYWNrYWdlX3VzZXJfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwp9Ci8vIHByZXZpb3VzIHBhY2thZ2Ugd2FzIHNlbGVjdGVkIC0gbm93IGEgZGlmZmVyZW50IHBhY2thZ2UgaXMgc2VsZWN0ZWQKZWxzZSBpZiAoKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3N0YXR1c19pZD09MCkgJiYgKCRzY29wZS5wYWNrYWdlX3N0YXR1c19pZD09LTEpKQp7CmxvZ0RlYnVnKCJ3YXMgbm90IHBhaWQgLSBub3cgcGF5IGZ1bGx5L3BhcnRpYWxseSIpOwpwYXlGb3JQYWNrYWdlKCRodHRwLCRzY29wZSwkc2NvcGUuZnBhY2thZ2UucGFja2FnZV91c2VyX2lkLCRzY29wZS5idXNpbmVzc191c2VyX2lkLHVwZGF0ZUV2ZW50UGFja2FnZV9zdWNjZXNzKTsKCi8vIHJlYXNzaWduRXZlbnRQYWNrYWdlQXNzb2NpYXRpb24oJGh0dHAsJHNjb3BlLCRzY29wZS5mbWVldGluZy5ldmVudF9pZCwkc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkLCRzY29wZS5idXNpbmVzc191c2VyX2lkLHVwZGF0ZUV2ZW50UGFja2FnZV9zdWNjZXNzKTsKfQp9CgpmdW5jdGlvbiB1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2VzcygpCnsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwpsb2dEZWJ1ZygiYnJvYWRjYXN0aW5nIGNsaWVudFBhZ2VSZWxvYWREYXRhIik7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKfQoKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2V2ZW50UGFja2FnZUFzc29jaWF0aW9uTW9kYWxDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkcm91dGVQYXJhbXMsICRyb290U2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgZm1lZXRpbmcsIGJhbGFuY2UsIGJ1c2luZXNzX3VzZXJfaWQsIHVpQ2FsZW5kYXJDb25maWcpCnsKJHNjb3BlLmZtZWV0aW5nPWFuZ3VsYXIuY29weShmbWVldGluZyk7CiRzY29wZS5iYWxhbmNlPWJhbGFuY2U7CiRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ9JHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZDsKJHNjb3BlLnByZXZpb3VzX2V2ZW50X3BheW1lbnRzPSRzY29wZS5mbWVldGluZy5ldmVudF9wYXltZW50czsKJHNjb3BlLnByZXZpb3VzX2lzX2FsbF9wYWlkPSRzY29wZS5mbWVldGluZy5pc19hbGxfcGFpZDsKJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQ9YnVzaW5lc3NfdXNlcl9pZDsKCi8vICdjYWxjdWxhdGluZycgcHJldmlvdXMgc3RhdHVzIG9mIHBheW1lbnQKaWYgKCRzY29wZS5wcmV2aW91c19ldmVudF9wYXltZW50cz4wKQp7CmlmICgkc2NvcGUucHJldmlvdXNfaXNfYWxsX3BhaWQ9PTEpCnsKJHNjb3BlLnByZXZpb3VzX3N0YXR1cz0iaXNfYWxsX3BhaWQiOwp9CmVsc2UKewokc2NvcGUucHJldmlvdXNfc3RhdHVzPSJpc19wYXJ0bHlfcGFpZCI7Cn0KfQplbHNlCnsKaWYgKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ+MCkKewokc2NvcGUucHJldmlvdXNfc3RhdHVzPSJpc19wYWNrYWdlX3BhaWQiOwp9CmVsc2UKewokc2NvcGUucHJldmlvdXNfc3RhdHVzPSJub3RfcGFpZCI7Cn0KfQpsb2dEZWJ1ZygicHJldmlvdXNfc3RhdHVzPSIrJHNjb3BlLnByZXZpb3VzX3N0YXR1cyk7CgppZiAoKCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQ9PTApICYmICgkc2NvcGUuZm1lZXRpbmcuZXZlbnRfcGF5bWVudHM+MCkpCnsKLy8gdGhpcyBpcyBhIGNhc2Ugd2hlcmUgcGF5bWVudCB3YXMgcGFydGx5IG9yIGZ1bGx5IG1hZGUgZnJvbSBiYWxhbmNlCiRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQ9LTE7CiRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ9LTE7Cn0KCmxvZ0RlYnVnKCJldmVudFBhY2thZ2VBc3NvY2lhdGlvbk1vZGFsQ29udHJvbGxlciIpOwpnZXRQYWNrYWdlc0ZvckV2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJ3JlbGF0ZWRQYWNrYWdlcycsZ2V0UGFja2FnZXNGb3JFdmVudF9zdWNjZXNzKTsgLy8gd2FzIGdldEJ1c2luZXNzUGFja2FnZQpmdW5jdGlvbiBnZXRQYWNrYWdlc0ZvckV2ZW50X3N1Y2Nlc3MoKQp7Cn0KCiRzY29wZS5jbG9zZU1vZGFsID0gZnVuY3Rpb24oKQp7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKfTsKJHNjb3BlLnVwZGF0ZUV2ZW50UGFja2FnZSA9IGZ1bmN0aW9uKCkKewpjb25zb2xlLmxvZygicHJldmlvdXNfcGFja2FnZV91c2VyX2lkPSIrJHNjb3BlLmZtZWV0aW5nLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZCk7CmNvbnNvbGUubG9nKCJwYWNrYWdlX3VzZXJfaWQ9Iiskc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkKTsKLy8gaWYgc2VsZWN0ZWQgcGFja2FnZSBpcyBsaWtlIHByZXZpb3VzIHBhY2thZ2UgLSBkbyBub3RoaW5nCmlmICgoJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD09JHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZCkpCnsKbG9nRGVidWcoInNlbGVjdGVkIG9wdGlvbiBpcyBsaWtlIHByZXZpb3VzIG9wdGlvbiAtIGRvIG5vdGhpbmciKTsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwp9Ci8vIGlmIHNlbGVjdGVkIHBhY2thZ2UgaXMgbGlrZSBwcmV2aW91cyBwYWNrYWdlIC0gZG8gbm90aGluZwppZiAoKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ9PSRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQpICYmICgkc2NvcGUucHJldmlvdXNfcGFja2FnZV91c2VyX2lkPjApKQp7CmxvZ0RlYnVnKCJzZWxlY3RlZCBwYWNrYWdlIGlzIGxpa2UgcHJldmlvdXMgcGFja2FnZSAtIGRvIG5vdGhpbmciKTsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwp9Ci8vIHByZXZpb3VzIHBhY2thZ2Ugd2FzIHNlbGVjdCAtIG5vdyBub3RoaW5ncyBpcyBzZWxlY3RlZAplbHNlIGlmICgoJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD4wKSAmJiAoJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZD09MCkpCnsKbG9nRGVidWcoIm5vIHBhY2thZ2Ugc2VsZWN0ZWQsIHJlbW92ZSBwYWNrYWdlLWV2ZW50IGFzc29jaWF0aW9uIik7CnJlbW92ZUV2ZW50UGFja2FnZUFzc29jaWF0aW9uKCRodHRwLCRzY29wZSwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwp9Ci8vIHByZXZpb3VzIHBhY2thZ2Ugd2FzIHNlbGVjdGVkIC0gbm93IGEgZGlmZmVyZW50IHBhY2thZ2UgaXMgc2VsZWN0ZWQKZWxzZSBpZiAoKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ+MCkgJiYgKCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQ+MCkpCnsKbG9nRGVidWcoInVwZGF0aW5nIG5ldyBwYWNrYWdlIHRvIHBhY2thZ2VfdXNlcl9pZD0gIiskc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkKTsKcmVhc3NpZ25FdmVudFBhY2thZ2VBc3NvY2lhdGlvbigkaHR0cCwkc2NvcGUsJHNjb3BlLmZtZWV0aW5nLmV2ZW50X2lkLCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwp9Ci8vIHByZXZpb3VzIHBhY2thZ2Ugd2FzIG5vbmUgLSBub3cgYSBwYWNrYWdlIGlzIHNlbGVjdGVkCmVsc2UgaWYgKCgkc2NvcGUucHJldmlvdXNfcGFja2FnZV91c2VyX2lkPT0wKSAmJiAoJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZD4wKSkKewpsb2dEZWJ1ZygidXBkYXRpbmcgbmV3IHBhY2thZ2UgdG8gcGFja2FnZV91c2VyX2lkPSAiKyRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQpOwpyZWFzc2lnbkV2ZW50UGFja2FnZUFzc29jaWF0aW9uKCRodHRwLCRzY29wZSwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZCwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCx1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2Vzcyk7Cn0KLy8gcHJldmlvdXMgYXNzb2NpYXRpb24gd2FzIHBhaWQgb3IgaGFsZiBwYWlkIC0gbm93IGl0cyBub25lCmVsc2UgaWYgKCgkc2NvcGUucHJldmlvdXNfZXZlbnRfcGF5bWVudHM+MCkgJiYgKCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQ9PTApKQp7CmxvZ0RlYnVnKCJyZW1vdmluZyBwYXltZW50IGZyb20gZXZlbnQsIHBhY2thZ2VfdXNlcl9pZD0gIiskc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkKTsKcmVtb3ZlRXZlbnRQYXltZW50QXNzb2NpYXRpb24oJGh0dHAsJHNjb3BlLCRzY29wZS5mbWVldGluZy5ldmVudF9pZCwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCx1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2Vzcyk7CgovLyByZWFzc2lnbkV2ZW50UGFja2FnZUFzc29jaWF0aW9uKCRodHRwLCRzY29wZSwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZCwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCx1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2Vzcyk7Ci8vIHRvZG8KfQovLyB3YXMgcGFja2FnZSBwYXltZW50IC0+IG5vdyBiYWxhbmNlIHBheW1lbnQKZWxzZSBpZiAoKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ+MCkgJiYgKCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQ9PS0xKSkKewpsb2dEZWJ1ZygibW92aW5nIHBheW1lbnQgZnJvbSBwYWNrYWdlIHRvIGJhbGFuY2UiKTsKYWRkRXZlbnRQYXltZW50UmVtb3ZlUGFja2FnZSgkaHR0cCwkc2NvcGUsJHNjb3BlLmZtZWV0aW5nLmV2ZW50X2lkLCRzY29wZS5idXNpbmVzc191c2VyX2lkLHVwZGF0ZUV2ZW50UGFja2FnZV9zdWNjZXNzKTsKfQovLyB3YXMgYmFsYW5jZSBwYXltZW50IC0+IG5vdyBwYWNrYWdlIHBheW1lbnQKZWxzZSBpZiAoKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ9PS0xKSAmJiAoJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZD4wKSkKewpsb2dEZWJ1ZygibW92aW5nIHBheW1lbnQgZnJvbSBiYWxhbmNlIHRvIHBhY2thZ2UiKTsKYWRkRXZlbnRQYWNrYWdlUmVtb3ZlUGF5bWVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLmZtZWV0aW5nLmV2ZW50X2lkLCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwoKfQovLyB3YXMgbm90IHBhaWQgYXQgYWxsIC0+IG5vdyBiYWxhbmNlIHBheQplbHNlIGlmICgoJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD09MCkgJiYgKCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQ9PS0xKSkKewpsb2dEZWJ1ZygibW92aW5nIHBheW1lbnQgZnJvbSBub25lIHRvIGJhbGFuY2UiKTsKYWRkRXZlbnRQYXltZW50QXNzb2NpYXRpb24oJGh0dHAsJHNjb3BlLCRzY29wZS5mbWVldGluZy5ldmVudF9pZCwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCx1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2Vzcyk7Cn0KfQoKZnVuY3Rpb24gdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MoKQp7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKbG9nRGVidWcoImJyb2FkY2FzdGluZyBjbGllbnRQYWdlUmVsb2FkRGF0YSIpOwokcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NsaWVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCn0KCn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignYXJjaGl2ZV9jbGllbnRfbW9kYWwnLCBmdW5jdGlvbigkc2NvcGUsICRsb2NhdGlvbiwgaXNfaW5zdHJ1Y3RvciwgYnVzaW5lc3NfdXNlcl9pZCwgYnVzZXJfZmlyc3RfbmFtZSwgYnVzZXJfbGFzdF9uYW1lLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIHVpQ2FsZW5kYXJDb25maWcpIHsKJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQ9YnVzaW5lc3NfdXNlcl9pZDsKJHNjb3BlLmJ1c2VyX2ZpcnN0X25hbWU9YnVzZXJfZmlyc3RfbmFtZTsKJHNjb3BlLmJ1c2VyX2xhc3RfbmFtZT1idXNlcl9sYXN0X25hbWU7CiRzY29wZS5pc19pbnN0cnVjdG9yPWlzX2luc3RydWN0b3I7Cgpsb2dEZWJ1ZygiYXJjaGl2ZV9jbGllbnRfbW9kYWwgY29udHJvbGxlciIpOwoKJHNjb3BlLmNsb3NlTW9kYWwgPSBmdW5jdGlvbigpIHsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwp9OwoKJHNjb3BlLmFyY2hpdmVDbGllbnQgPSBmdW5jdGlvbigpCnsKYXJjaGl2ZUNsaWVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsYXJjaGl2ZUNsaWVudF9zdWNjZXNzKTsKZnVuY3Rpb24gYXJjaGl2ZUNsaWVudF9zdWNjZXNzKCkKewokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CmlmICgkc2NvcGUuaXNfaW5zdHJ1Y3RvcikKewokbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2luc3RydWN0b3JzJyk7Cn0KZWxzZSB7CiRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfY2xpZW50cycpOwp9Cn0KfQoKfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdwYXltZW55RGV0YWlsc01vZGFsQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHJvdXRlUGFyYW1zLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIGZwYXltZW50LCB1aUNhbGVuZGFyQ29uZmlnKSB7CiRzY29wZS5mcGF5bWVudD17fTsKJHNjb3BlLmZwYXltZW50LnBheW1lbnRfZGF0ZT1mcGF5bWVudC5wYXltZW50X2RhdGU7CiRzY29wZS5mcGF5bWVudC5wYXltZW50X2Ftb3VudD1mcGF5bWVudC5wYXltZW50X2Ftb3VudDsKJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZ2VuZXJhdGVkPWZwYXltZW50Lmludm9pY2VfZ2VuZXJhdGVkOwokc2NvcGUuZnBheW1lbnQuaW52b2ljZV9udW1iZXI9ZnBheW1lbnQuaW52b2ljZV9udW1iZXI7CmlmIChmcGF5bWVudC5pbnZvaWNlX2RhdGU9PW51bGwpCnsKJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZV9mb3JtYXQ9bmV3IERhdGUoKTsKfQplbHNlCnsKJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZV9mb3JtYXQ9ZnBheW1lbnQuaW52b2ljZV9kYXRlX2Zvcm1hdDsKfQokc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlPWZwYXltZW50Lmludm9pY2VfZGF0ZTsKJHNjb3BlLnNlbGVjdGVkUGF5bWVudE1ldGhvZD17Cm5hbWU6IGZwYXltZW50LnBheW1lbnRfbWV0aG9kX25hbWVfdHh0LAptZXRob2Q6IGZwYXltZW50LnBheW1lbnRfbWV0aG9kX25hbWUKfTsKJHNjb3BlLmlzUGF5bWVudE1ldGhvZFNlbGVjdGVkPXRydWU7Cgpsb2dEZWJ1Zygib2xkIGRhdGUgIiskc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlKTsKaWYgKCRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2RhdGUhPW51bGwpCnsKJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZV9mb3JtYXQgPSBuZXcgRGF0ZSgkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlKTsKfQokc2NvcGUucGF5bWVudE1ldGhvZHMgPSBwYXltZW50TWV0aG9kczsKJHNjb3BlLnBheW1lbnRUeXBlVGl0bGU9ZnBheW1lbnQucGF5bWVudF9tZXRob2RfbmFtZV90eHQ7CiRzY29wZS5mcGF5bWVudC5pbnZvaWNlX3NvdXJjZT0iRVhURVJOQUwiOwoKbG9nRGVidWcoJHNjb3BlLnBheW1lbnRNZXRob2RzKTsKbG9nRGVidWcoInBheW1lbnlEZXRhaWxzTW9kYWxDb250cm9sbGVyIGZvciBwYXltZW50ICIrSlNPTi5zdHJpbmdpZnkoZnBheW1lbnQsIG51bGwsIDQpKTsKCiRzY29wZS5zZWxlY3RQYXltZW50TWV0aG9kID0gZnVuY3Rpb24ocGF5bWVudCkgewokc2NvcGUucGF5bWVudFR5cGVUaXRsZT1wYXltZW50Lm5hbWU7CmxvZ0RlYnVnKCJwYXltZW50PSIrcGF5bWVudCk7Cgokc2NvcGUuc2VsZWN0ZWRQYXltZW50TWV0aG9kPXBheW1lbnQ7CiRzY29wZS5pc1BheW1lbnRNZXRob2RTZWxlY3RlZD10cnVlOwp9OwoKJHNjb3BlLmNsb3NlTW9kYWwgPSBmdW5jdGlvbigpIHsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwp9OwoKJHNjb3BlLnVwZGF0ZVBheW1lbnQgPSBmdW5jdGlvbigpCnsKLy8gbG9nRGVidWcoY3VycmVudENsaWVudCk7CmxvZ0RlYnVnKCJwYXltZW50IG1ldGhvZCIpOwpsb2dEZWJ1Zygkc2NvcGUuc2VsZWN0ZWRQYXltZW50TWV0aG9kKTsKbG9nRGVidWcoIiRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2dlbmVyYXRlZD08Iiskc2NvcGUuZnBheW1lbnQuaW52b2ljZV9nZW5lcmF0ZWQrIj4sICRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2RhdGVfZm9ybWF0PSIrJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZV9mb3JtYXQpOwpsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkUGF5bWVudE1ldGhvZC5tZXRob2Q9Iiskc2NvcGUuc2VsZWN0ZWRQYXltZW50TWV0aG9kLm1ldGhvZCk7CmlmICgoJHNjb3BlLmZwYXltZW50LnBheW1lbnRfYW1vdW50PT0wKSB8fCAoJHNjb3BlLmZwYXltZW50LnBheW1lbnRfYW1vdW50PT0nJykgfHwgKCRzY29wZS5mcGF5bWVudC5wYXltZW50X2Ftb3VudD09bnVsbCkpCnsKJHNjb3BlLnVzZXJFcnJvcj0i15DXoNeQINeU15bXnyDXodeb15XXnSDXm9ec16nXlNeVIjsKLy8gYWxlcnQoJ3NzJyk7Cn0KZWxzZSBpZiAoISRzY29wZS5pc1BheW1lbnRNZXRob2RTZWxlY3RlZCkKewokc2NvcGUudXNlckVycm9yPSLXkNeg15Ag15HXl9eoINeQ157Xptei15kg16rXqdec15XXnSI7Ci8vIGFsZXJ0KCdzcycpOwp9CmVsc2UKewppZiAoKCRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2dlbmVyYXRlZCE9MSkgfHwgKCRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2RhdGVfZm9ybWF0PT1udWxsKSkKewp2YXIgaW52b2ljZV9kYXRlX2Zvcm1hdCA9ICJudWxsIjsKfQplbHNlCnsKdmFyIGludm9pY2VfZGF0ZV9mb3JtYXQgPSAkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlX2Zvcm1hdC5nZXREYXRlKCkgICsgIi0iICsgKCRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2RhdGVfZm9ybWF0LmdldE1vbnRoKCkrMSkgKyAiLSIgKyAkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlX2Zvcm1hdC5nZXRGdWxsWWVhcigpOwp9CnRoZWRhdGE9IHsKYmFsYW5jZVRvUGF5OiAkc2NvcGUuZnBheW1lbnQucGF5bWVudF9hbW91bnQsCnBheW1lbnRfbWV0aG9kX25hbWU6ICRzY29wZS5zZWxlY3RlZFBheW1lbnRNZXRob2QubWV0aG9kLAppbnZvaWNlX251bWJlcjogJHNjb3BlLmZwYXltZW50Lmludm9pY2VfbnVtYmVyLAppbnZvaWNlX2dlbmVyYXRlZDogJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZ2VuZXJhdGVkLAppbnZvaWNlX2RhdGU6IGludm9pY2VfZGF0ZV9mb3JtYXQsCmludm9pY2Vfc291cmNlOiAkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9zb3VyY2UKfTsKdXBkYXRlUGF5bWVudEZvckNsaWVudCgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsZnBheW1lbnQudXNlcl9wYXltZW50X2lkLHRoZWRhdGEsY3JlYXRlUGF5bWVudEZvckNsaWVudF9jYWxsYmFjaywgY3JlYXRlUGF5bWVudEZvckNsaWVudF9mYWlsdXJlKTsKZnVuY3Rpb24gY3JlYXRlUGF5bWVudEZvckNsaWVudF9jYWxsYmFjaygpCnsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwpsb2dEZWJ1ZygiYnJvYWRjYXN0aW5nIGNsaWVudFBhZ2VSZWxvYWREYXRhIik7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKfQpmdW5jdGlvbiBjcmVhdGVQYXltZW50Rm9yQ2xpZW50X2ZhaWx1cmUoKQp7CmxvZ0RlYnVnKCJicm9hZGNhc3RpbmcgY2xpZW50UGFnZVJlbG9hZERhdGEiKTsKLy8gJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwp9Cn0KfQp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ2V2ZW50VHlwZUV4dHJhRmllbGRzTW9kYWxDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIGV2ZW50VHlwZVByb3BlcnRpZXMsIHVpQ2FsZW5kYXJDb25maWcpIHsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXM9ZXZlbnRUeXBlUHJvcGVydGllczsKICBsb2dEZWJ1ZygiZXZlbnRUeXBlRXh0cmFGaWVsZHNNb2RhbENvbnRyb2xsZXI9IitKU09OLnN0cmluZ2lmeShldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzLCBudWxsLCA0KSk7CmlmIChldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzPT1udWxsKQp7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzT3JpZz1bXTsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHM9W107Cn0KZWxzZSBpZiAoZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcy5sZW5ndGg+MCkKewokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllc09yaWc9KGV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMpLnNsaWNlKDApOwp9CmVsc2UKewokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllc09yaWc9W107CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzPVtdOwp9CiRzY29wZS5va0xpbWl0YXRpb25Nb2RhbCA9IGZ1bmN0aW9uKCkgewokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7Cn07Cgokc2NvcGUuY2FuY2VsID0gZnVuY3Rpb24oKQp7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzPSRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzT3JpZzsKbG9nRGVidWcoImNsb3NlIik7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzT3JpZyk7Cn0KJHNjb3BlLnNhdmVBbmRDbG9zZSA9IGZ1bmN0aW9uKCkKewpsb2dEZWJ1Zygic2F2ZSBhbmQgY2xvc2UiKTsKZnVuY3Rpb24gc2V0Q2xpZW50c0V4dHJhRmllbGRzX3N1Y2Nlc3MoKQp7Cgp9CiRzY29wZS5DbGllbnRzRGV0YWlscz17fTsKJHNjb3BlLkNsaWVudHNEZXRhaWxzLmV4dHJhRmllbGRzPSRzY29wZS5leHRyYUZpZWxkczsKc2V0Q2xpZW50c0V4dHJhRmllbGRzKCRodHRwLCRzY29wZSwkc2NvcGUuQ2xpZW50c0RldGFpbHMsc2V0Q2xpZW50c0V4dHJhRmllbGRzX3N1Y2Nlc3MpOwokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyk7Cn0KCiAgJHNjb3BlLmR1cGxpY2F0ZUZpZWxkTmFtZXM9IiI7CiRzY29wZS5hZGRFeHRyYUZpZWxkcyA9IGZ1bmN0aW9uKCkKewogICAgbG9nRGVidWcoImFkZEV4dHJhRmllbGRzIHZhbGlkYXRpbmciKTsKICAgIC8vIGNoZWNraW5nIGZvciBkdXBsaWNhdGUgbmFtZXMKICAgIHZhciBleHRyYUZpZWxkc05hbWVzID0gW107CiAgICBmb3IgKHZhciBpPTE7IGk8JHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMubGVuZ3RoOyBpKyspCiAgICB7CiAgICAgIGV4dHJhRmllbGRzTmFtZXMucHVzaCgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkc1tpXS5maWVsZF9uYW1lKTsKICAgIH0KICAgIGV4dHJhRmllbGRzTmFtZXMuc29ydCgpOwogICAgdmFyIGxhc3QgPSBleHRyYUZpZWxkc05hbWVzWzBdOwogICAgZm9yICh2YXIgaT0xOyBpPGV4dHJhRmllbGRzTmFtZXMubGVuZ3RoOyBpKyspCiAgICB7CiAgICAgICBpZiAoZXh0cmFGaWVsZHNOYW1lc1tpXSA9PSBsYXN0KQogICAgICAgewogICAgICAgIC8vICBhbGVydCgnRHVwbGljYXRlIDogJytsYXN0KTsKICAgICAgICAgJHNjb3BlLmR1cGxpY2F0ZUZpZWxkTmFtZXM9J9en15nXmdedINep15PXlCDXm9ek15XXnCDXkdep150gIicrbGFzdCsnIi4uLic7CiAgICAgICAgIHJldHVybjsKICAgICAgIH0KICAgICAgIGxhc3QgPSBleHRyYUZpZWxkc05hbWVzW2ldOwogICAgfQokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyk7Cn0KCiRzY29wZS5leHRyYUZpZWxkcyA9IGV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHM7CiRzY29wZS5maWVsZFR5cGVzID0gW3tmaWVsZF9kYXRhdHlwZTogIlRFWFRfQVJFQSIsIG5hbWU6J9eq15nXkdeqINeY16fXodeYJ30sIHtmaWVsZF9kYXRhdHlwZTogIk5VTUJFUiIsIG5hbWU6J9ee16HXpNeoJ30gLCB7ZmllbGRfZGF0YXR5cGU6ICJTVFJJTkciLCBuYW1lOifXmNen16HXmCDXp9em16gnfSAsIHtmaWVsZF9kYXRhdHlwZTogIkJPT0xFQU4iLCBuYW1lOifXqteZ15HXqiDXodeZ157XldefJ30gLCB7ZmllbGRfZGF0YXR5cGU6ICJEQVRFIiwgbmFtZTon16rXkNeo15nXmid9XTsKCiRzY29wZS5hZGROZXdGaWVsZCA9IGZ1bmN0aW9uKCkgewp2YXIgbmV3SXRlbU5vID0gJHNjb3BlLmV4dHJhRmllbGRzLmxlbmd0aCsxOwokc2NvcGUuZXh0cmFGaWVsZHMucHVzaCh7ImZpZWxkX2RhdGF0eXBlIjoiU1RSSU5HIiwiaXNfbWFuZGF0b3J5IjowLCAiZnJvbWRiIjogZmFsc2UsICJmaWVsZF9pZCI6IDAsICJpc19hY3RpdmUiOiAxLCAibW9kaWZpZWQiOiAwfSk7CgogICAgbG9nRGVidWcoImV4dHJhIGZpZWxkczogIiArIEpTT04uc3RyaW5naWZ5KCRzY29wZS5leHRyYUZpZWxkcywgbnVsbCwgMikpOwoKfTsKCiRzY29wZS5yZW1vdmVGaWVsZCA9IGZ1bmN0aW9uKGNob2ljZSkKewovLyByZW1vdmluZyBmaWVsZAovLyBpZiBpdHMgbm90IG9yaWdpbmF0ZWQgZnJvbSBkYXRhYmFzZSAtIHRoZW4gd2Ugc2ltcGx5IGRlbGV0ZSBpdCBmcm9tIHRoZSBhcnJheQovLyBvdGhlcndpc2Ugd2UgbWFyayBpdCBhcyBhY3RpdmU9ZmFsc2UKbG9nRGVidWcoY2hvaWNlKTsKLy8gdmFyIGxhc3RJdGVtID0gKGNob2ljZS5pZCktMTsvLyRzY29wZS5jaG9pY2VzLmxlbmd0aC0xOwovLyAkc2NvcGUuY2hvaWNlcy5zcGxpY2UobGFzdEl0ZW0sMSk7CmZvcih2YXIgaSA9IDA7IGkgPCAkc2NvcGUuZXh0cmFGaWVsZHMubGVuZ3RoOyBpKyspCnsKaWYgKCRzY29wZS5leHRyYUZpZWxkc1tpXSA9PSBjaG9pY2UpCnsKaWYgKGNob2ljZS5mcm9tZGI9PWZhbHNlKQp7Ci8vIGlmIG5vdCBmcm9tIGRiIC0gcmVtb3ZpbmcgaXQgZnJvbSB0aGUgYXJyYXkgb2YgZXh0cmEtZmllbGRzCiRzY29wZS5leHRyYUZpZWxkcy5zcGxpY2UoaSwgMSk7Cn0KZWxzZQp7Ci8vIGlmIGZpZWxkIG9yaWdpbmF0ZWQgZnJvbSBkYiAtIHRoYW4gd2UgZG9udCByZW1vdmUgaXQgZnJvbSB0aGUgYXJyYXkKLy8gYW5kIG1hcmsgaXQgYXMgYWN0aXZlPWZhbHNlIHNvIHRoYXQgaXQgY2FuIGJlIGhhbmRlbGVkIG9uIHRoZSBzZXJ2ZXIKY2hvaWNlLmlzX2FjdGl2ZT0wOwpjaG9pY2UubW9kaWZpZWQ9dHJ1ZTsKfQpicmVhazsKfQp9Cn07Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignZXZlbnRDbG9zZUlnbm9yZU1hbmRhdG9yeUZpZWxkc01vZGFsQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHJvdXRlUGFyYW1zLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIGN1cnJlbnRFdmVudCwgdWlDYWxlbmRhckNvbmZpZykgewokc2NvcGUuY3VycmVudEV2ZW50PWN1cnJlbnRFdmVudDsKCiRzY29wZS5va0NhbmNlbCA9IGZ1bmN0aW9uKCkgewokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7Cn07Cgokc2NvcGUuY2xvc2VFdmVudElnbm9yZU1hbmRhdG9yeUZpZWxkcyA9IGZ1bmN0aW9uKCkKewpsb2dEZWJ1ZygiaWdub3JlIG1hbmRhdG9yeSBleHRyYSBmaWVsZHMgYW5kIGNsb3NlIGV2ZW50Iik7CiRzY29wZS5jdXJyZW50RXZlbnQuaWdub3JlRXh0cmFGaWVsZHNWYWxpZGF0aW9uPXRydWU7CmNsb3NlRXZlbnQoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCwkc2NvcGUuY3VycmVudEV2ZW50LGFmdGVyQ2xvc2VFdmVudCxhZnRlckNsb3NlRXZlbnQpOwpmdW5jdGlvbiBhZnRlckNsb3NlRXZlbnQoKQp7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgnZXZlbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7Cn07Cn0KfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdldmVudFR5cGVDaGFuZ2VkUG9wdXBDb250cm9sbGVyJywgZnVuY3Rpb24oJGxvY2F0aW9uLCAkc2NvcGUsICRyb3V0ZVBhcmFtcywgJHJvb3RTY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRodHRwLCBldmVudFR5cGVQcm9wZXJ0aWVzLCB1aUNhbGVuZGFyQ29uZmlnKSB7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzPWV2ZW50VHlwZVByb3BlcnRpZXM7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLnVwZGF0ZWRfZnJvbV9kYXRlPW5ldyBEYXRlKCk7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLnVwZGF0ZV9leGlzdGluZ19ldmVudHM9ZmFsc2U7Cgokc2NvcGUuY2xvc2VNb2RhbCA9IGZ1bmN0aW9uKCkgewokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7Cn07Cgokc2NvcGUudXBkYXRlRXZlbnRUeXBlID0gZnVuY3Rpb24oKQp7CmxvZ0RlYnVnKCJ1cGRhdGUgRXZlbnQgVHlwZSAiICsgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXZlbnRfdHlwZV9pZCk7CmlmICgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5tYXhfcmVnaXN0cmF0aW9ucz09JycpCnsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMubWF4X3JlZ2lzdHJhdGlvbnM9MDsKfQp1cGRhdGVFdmVudFR5cGUoJGh0dHAsJHNjb3BlLCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV2ZW50X3R5cGVfaWQsJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMsdXBkYXRlRXZlbnRUeXBlX3N1Y2Nlc3MpOwpmdW5jdGlvbiB1cGRhdGVFdmVudFR5cGVfc3VjY2VzcygpCnsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwokbG9jYXRpb24ucGF0aCgnL2V2ZW50X3R5cGVzJyk7Cn0KfQoKfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdjbGFzc0RlbGV0ZUFsbE1vZGFsQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHJvb3RTY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRodHRwLCBjdXJyZW50RXZlbnQsIHVpQ2FsZW5kYXJDb25maWcpCnsKbG9nRGVidWcoImNvbnRyb2xsZXI6IGNsYXNzRGVsZXRlQWxsTW9kYWxDb250cm9sbGVyIik7CiRzY29wZS5jdXJyZW50RXZlbnQ9Y3VycmVudEV2ZW50Owokc2NvcGUuY2xvc2VNb2RhbCA9IGZ1bmN0aW9uKCkKewokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7Cn07CgoKJHNjb3BlLmRlbGV0ZUNsYXNzRXZlbnRTaW5nbGU9ZnVuY3Rpb24gKCkgLy8gZGVsZXRlIG9ubHkgb25lL2N1cnJlbnQgY2xhc3MgZXZlaHQKewpjYW5jZWxDbGFzc0V2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkLGNhbmNlbENsYXNzRXZlbnRfY2FsbGJhY2ssIGNhbmNlbENsYXNzRXZlbnRfY2FsbGJhY2spOwpmdW5jdGlvbiBjYW5jZWxDbGFzc0V2ZW50X2NhbGxiYWNrKCkKewpnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkKTsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwokcm9vdFNjb3BlLiRicm9hZGNhc3QoJ3JlbG9hZEV2ZW50Jyx7ZXZlbnRfaWQgOiAkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkfSk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCn0KfQokc2NvcGUuZGVsZXRlQ2xhc3NFdmVudHNBbGw9ZnVuY3Rpb24gKCkgLy8gZGVsZXRlIGFsbCByZXBlYXRpbmcgZXZlbnRzCnsKY2FuY2VsQ2xhc3NSZXBlYXRpbmdFdmVudCgkaHR0cCwkc2NvcGUsMCwkc2NvcGUuY3VycmVudEV2ZW50LnJlcGVhdF9ldmVudF9pZCxjYW5jZWxDbGFzc0V2ZW50X2NhbGxiYWNrLCBjYW5jZWxDbGFzc0V2ZW50X2NhbGxiYWNrKTsKZnVuY3Rpb24gY2FuY2VsQ2xhc3NFdmVudF9jYWxsYmFjaygpCnsKZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCk7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdyZWxvYWRFdmVudCcse2V2ZW50X2lkIDogJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZH0pOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwp9Cn0KJHNjb3BlLmRlbGV0ZUNsYXNzRXZlbnRzQWxsU3RhcnRpbmdFdmVudElEPWZ1bmN0aW9uICgpIC8vIGRlbGV0ZSBhbGwgcmVwZWF0aW5nIGV2ZW50cyBzdGFydGluZyBldmVudF9pZAp7CmNhbmNlbENsYXNzUmVwZWF0aW5nRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQsJHNjb3BlLmN1cnJlbnRFdmVudC5yZXBlYXRfZXZlbnRfaWQsY2FuY2VsQ2xhc3NFdmVudF9jYWxsYmFjaywgY2FuY2VsQ2xhc3NFdmVudF9jYWxsYmFjayk7CmZ1bmN0aW9uIGNhbmNlbENsYXNzRXZlbnRfY2FsbGJhY2soKQp7Ci8vIGdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQpOwokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgncmVsb2FkRXZlbnQnLHtldmVudF9pZCA6ICRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWR9KTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKfQp9Cgp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ2J1c2luZXNzX21vZGFsX2xpbWl0YXRpb25fY3JlYXRlJywgZnVuY3Rpb24oJHNjb3BlLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIHN0YXJ0LGVuZCwgZml4ZWRTY2hlZHVsZSwgdWlDYWxlbmRhckNvbmZpZykgewoKJHNjb3BlLmZpeGVkU2NoZWR1bGU9Zml4ZWRTY2hlZHVsZTsKJHNjb3BlLm9yaWdpbmFsX3N0YXJ0PXN0YXJ0Owokc2NvcGUub3JpZ2luYWxfZW5kPWVuZDsKCiRzY29wZS5zdGFydD1uZXcgbW9tZW50KHN0YXJ0KSoxMDAwOwokc2NvcGUuZW5kPW5ldyBtb21lbnQoZW5kKSoxMDAwOwpjb25zb2xlLmxvZygnc3RhcnQ9JytzdGFydCk7CmNvbnNvbGUubG9nKCdlbmQ9JytlbmQpOwoKZ2V0QnVzaW5lc3NMb2NhdGlvbnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19sb2NhdGlvbnMnLGdldEJ1c2luZXNzTG9jYXRpb25zX3N1Y2Nlc3MpOwpmdW5jdGlvbiBnZXRCdXNpbmVzc0xvY2F0aW9uc19zdWNjZXNzKCkKewokc2NvcGUubmV3RXZlbnREZXRhaWxzLmxvY2F0aW9uX2lkPSRzY29wZS5idXNpbmVzc19sb2NhdGlvbnNbMF0ubG9jYXRpb25faWQ7Cn0KCnNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc3RhcnQpOwpzZWxlY3RlZERhdGVFbmQgPSBuZXcgRGF0ZShlbmQpOwpsb2dEZWJ1Zygic2VsZWN0ZWREYXRlU3RhcnQgPSAiK3NlbGVjdGVkRGF0ZVN0YXJ0KTsKdmFyIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZSgpICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKdmFyIHNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKHNlbGVjdGVkRGF0ZUVuZC5nZXRUaW1lKCkgKyBzZWxlY3RlZERhdGVFbmQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKCi8vIGxvZ0RlYnVnKCJkYXRlPSIgKyBzZWxlY3RlZERhdGVTdGFydCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50ID0gW107CiRzY29wZS5uZXdFdmVudERldGFpbHMgPSBbXTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycyA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldEhvdXJzKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcyA9IChzZWxlY3RlZERhdGVTdGFydC5nZXRNaW51dGVzKCkgPCAxMCA/ICcwJyA6ICcnKSArIHNlbGVjdGVkRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkb3cgPSBkYXlOYW1lc1tzZWxlY3RlZERhdGVTdGFydC5nZXREYXkoKV07CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF0ZSA9IHNlbGVjdGVkRGF0ZVN0YXJ0Owokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoID0gbW9udGhOYW1lc1tzZWxlY3RlZERhdGVTdGFydC5nZXRNb250aCgpXTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aDExMiA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldE1vbnRoKCkrMTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXlvZm1vbnRoID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RGF0ZSgpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXIgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRGdWxsWWVhcigpOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWVfaW5wdXRfZm9ybWF0PSBuZXcgRGF0ZSgxOTcwLCAwLCAxLCAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzLCAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMsIDApOwoKJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMgPSBzZWxlY3RlZERhdGVFbmQuZ2V0SG91cnMoKTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcyA9IChzZWxlY3RlZERhdGVFbmQuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBzZWxlY3RlZERhdGVFbmQuZ2V0TWludXRlcygpOwoKCiRzY29wZS5jYW5jZWwgPSBmdW5jdGlvbigpIHsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwp9OwoKZ2V0QWxsSW5zdHJ1Y3RvcnMoJGh0dHAsJHNjb3BlLCdpbnN0cnVjdG9ycycsZ2V0QWxsSW5zdHJ1Y3RvcnNfc3VjY2Vzcyk7CmZ1bmN0aW9uIGdldEFsbEluc3RydWN0b3JzX3N1Y2Nlc3MoKQp7CiRzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZD0kc2NvcGUuaW5zdHJ1Y3RvcnNbMF0uYnVzaW5lc3NfdXNlcl9pZDsKfQpnZXROb0NsYXNzRXZlbnRUeXBlc05vQWRtaW4oJGh0dHAsJHNjb3BlLCdyZWxhdGVkRXZlbnRUeXBlcycpOwoKJHNjb3BlLmNyZWF0ZU5ld0xpbWl0YXRpb24gPSBmdW5jdGlvbigpCnsKbG9nRGVidWcoImZ1bmN0aW9uOiBjcmVhdGVOZXdMaW1pdGF0aW9uIik7CmNhbGVuZGFyID0gJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnOwoKaWYgKCRzY29wZS5zZWxlY3RlZEV2ZW50VHlwZXMubGVuZ3RoPDEpCnsKcmV0dXJuIGZhbHNlOwp9CmlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vyczwkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKQp7CmFsZXJ0KCLXltee158g16HXmdeV150g15zXpNeg15kg15bXntefINeU16rXl9ec15QiKTsKcmV0dXJuIGZhbHNlOwp9CmlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vycz09JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykKewppZiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlczw9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKQp7CmFsZXJ0KCLXltee158g16HXmdeV150g15zXpNeg15kg15bXntefINeU16rXl9ec15QiKTsKcmV0dXJuIGZhbHNlOwp9CmlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzPCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMrMTApKQp7CmFsZXJ0KCLXkdec15XXpyDXp9eY158g154tMTAg15PXp9eV16oiKTsKcmV0dXJuIGZhbHNlOwp9Cn0KaWYgKCFrdXplSXNDYWxlbmRhckRyYWdnYmxlKSB7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3Vuc2VsZWN0Jyk7Cn0KbG9nRGVidWcoInN0YXJ0PSIgKyBzdGFydCk7CmNoZWNrRGF0ZSA9IG5ldyBEYXRlKHN0YXJ0KTsKbG9nRGVidWcoImNoZWNrIGRhdGUgPSAiICsgY2hlY2tEYXRlKQpsb2dEZWJ1ZygiZW5kPSIgKyBlbmQpOwplY29sb3I9IiMwMGE2NWEiOwoKaWYgKGNoZWNrRGF0ZS5nZXRGdWxsWWVhcigpID09IDE5NzApIHsKZGF5X2xpbWl0X2lkID0gLTE7Cn0gZWxzZSB7CmRheV9saW1pdF9pZCA9IDE7Cn0KCi8vIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW10uZnVsbENhbGVuZGFyKCdyZXJlbmRlckV2ZW50cycpOwoKdGVtcF9saW1pdF9pZCA9IGNhbGNfdGVtcF9saW1pdF9pZCgpOwoKbG9nRGVidWcoJHNjb3BlLnNlbGVjdGVkRXZlbnRUeXBlc1swXSk7CmxvZ0RlYnVnKCRzY29wZS5zZWxlY3RlZEV2ZW50VHlwZXNbMF0uZXZlbnRfdHlwZV9pZCk7CgpzdGFydF9wYXJhbT1zdGFydDsKZW5kX3BhcmFtPWVuZDsKdGl0bGVfcGFyYW09Jyc7CmxvZ0RlYnVnKCJhZGRMaW1pdGF0aW9uVG9EYXRhYmFzZSBzdGFydD0iICsgc3RhcnRfcGFyYW0gKyAiLCBlbmQ9IiArICIsIHRpdGxlPSIgKyB0aXRsZV9wYXJhbSApOwoKdGhlZGF0YSA9IHsKc3RhcnRfZGF0ZTogJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5zdGFydF90aW1lLAplbmRfZGF0ZTogJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmRfdGltZSwKY29sb3I6IGVjb2xvciwKdGVtcF9saW1pdF9pZDogdGVtcF9saW1pdF9pZCwKZW1wX2lkOiAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmluc3RydWN0b3JfaWQsCmxvY2F0aW9uX2lkOiAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmxvY2F0aW9uX2lkLApldmVudF90eXBlX2lkOiAkc2NvcGUuc2VsZWN0ZWRFdmVudFR5cGVzWzBdLmV2ZW50X3R5cGVfaWQsCmV2ZW50X3R5cGVzOiAkc2NvcGUuc2VsZWN0ZWRFdmVudFR5cGVzLAp0aXRsZTogdGl0bGVfcGFyYW0KfTsKCmlmICgkc2NvcGUuZml4ZWRTY2hlZHVsZSkgLy8gZml4ZWQgc2NoZWR1bGUgdnMgc3BlY2lmaWMgd2VlZC9kYXkgbGltaXRhdGlvbgp7CmNyZWF0ZUNhbGVuZGFyTGltaXRhdGlvbigkaHR0cCwkc2NvcGUsdGhlZGF0YSxsaW1pdGF0aW9uX3N1Y2Nlc3NfY2FsbGJhY2spOwp9CmVsc2UKewpjcmVhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXkoJGh0dHAsJHNjb3BlLHRoZWRhdGEsbGltaXRhdGlvbl9zdWNjZXNzX2NhbGxiYWNrKTsKfQpmdW5jdGlvbiBsaW1pdGF0aW9uX3N1Y2Nlc3NfY2FsbGJhY2soKQp7CmxvZ0RlYnVnKCJzdWNjZXNzIik7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKJHVpYk1vZGFsSW5zdGFuY2UuZGlzbWlzcygpOwp9Cgp9Cgokc2NvcGUuc3RhcnRNaW51dGVzID0gZnVuY3Rpb24oKQp7CmxvZ0RlYnVnKCJzdGFydE1pbnV0ZXMgIisoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKSk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcz1taW51dGVzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpOwpjYWxjdWxhdGVTdGFydFRpbWUoKTsKfQokc2NvcGUuc3RhcnRIb3VycyA9IGZ1bmN0aW9uKCkKewpsb2dEZWJ1Zygic3RhcnRIb3VycyAiK2hvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKSk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnM9aG91cnNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMpOwpjYWxjdWxhdGVTdGFydFRpbWUoKTsKfQokc2NvcGUuZW5kTWludXRlcyA9IGZ1bmN0aW9uKCkKewpsb2dEZWJ1ZygiZW5kTWludXRlcyAiKygkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzKSk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXM9bWludXRlc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcyk7CmNhbGN1bGF0ZUVuZFRpbWUoKTsKfQokc2NvcGUuZW5kSG91cnMgPSBmdW5jdGlvbigpCnsKbG9nRGVidWcoImVuZEhvdXJzICIraG91cnNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzKSk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzPWhvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vycyk7CmNhbGN1bGF0ZUVuZFRpbWUoKTsKfQoKCmZ1bmN0aW9uIGNhbGN1bGF0ZVN0YXJ0VGltZSgpCnsKZXZlbnRZZWFyPSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0eWVhcjsKZXZlbnRNb250aD0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoMTEyOwpldmVudERheT0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRheW9mbW9udGg7CmlmIChwYXJzZUludChldmVudE1vbnRoKTwxMCkKewpldmVudE1vbnRoPSIwIitldmVudE1vbnRoOwp9CmlmIChwYXJzZUludChldmVudERheSk8MTApCnsKZXZlbnREYXk9IjAiK2V2ZW50RGF5Owp9CmxvZ0RlYnVnKCIkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXI9IitldmVudFllYXIpOwpsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXlvZm1vbnRoPSIrZXZlbnRNb250aCk7CmxvZ0RlYnVnKCIkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoPSIrZXZlbnREYXkpOwpuZXdfc3RhcnQ9bW9tZW50LnV0YyhldmVudFllYXIrIi0iK2V2ZW50TW9udGgrIi0iK2V2ZW50RGF5KyJUMDA6MDA6MDAiKS5hZGQoKChwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKSo2MCkrcGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKSksICdtaW51dGVzJyk7CiRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZT1uZXdfc3RhcnQ7CmxvZ0RlYnVnKCJuZXdfc3RhcnQ9IituZXdfc3RhcnQpOwp9CmZ1bmN0aW9uIGNhbGN1bGF0ZUVuZFRpbWUoKQp7CmV2ZW50WWVhcj0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXI7CmV2ZW50TW9udGg9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aDExMjsKZXZlbnREYXk9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXlvZm1vbnRoOwppZiAocGFyc2VJbnQoZXZlbnRNb250aCk8MTApCnsKZXZlbnRNb250aD0iMCIrZXZlbnRNb250aDsKfQppZiAocGFyc2VJbnQoZXZlbnREYXkpPDEwKQp7CmV2ZW50RGF5PSIwIitldmVudERheTsKfQpsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyPSIrZXZlbnRZZWFyKTsKbG9nRGVidWcoIiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aD0iK2V2ZW50TW9udGgpOwpsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aD0iK2V2ZW50RGF5KTsKbmV3X2VuZD1tb21lbnQudXRjKGV2ZW50WWVhcisiLSIrZXZlbnRNb250aCsiLSIrZXZlbnREYXkrIlQwMDowMDowMCIpLmFkZCgoKHBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzKSo2MCkrcGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcykpLCAnbWludXRlcycpOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZF90aW1lPW5ld19lbmQ7CmxvZ0RlYnVnKCJuZXdfZW5kPSIrbmV3X2VuZCk7Cn0KCmNhbGN1bGF0ZVN0YXJ0VGltZSgpOwpjYWxjdWxhdGVFbmRUaW1lKCk7CgpmdW5jdGlvbiBtaW51dGVzQ2hhbmdlZCh0aGVtaW51dGVzKQp7CmxvZ0RlYnVnKCJ0aGVtaW51dGVzPSIrdGhlbWludXRlcyk7CmlmICh0eXBlb2YgdGhlbWludXRlcz09InVuZGVmaW5lZCIpCnsKcmV0dXJuICIwMCI7Cn0KdGhlbWludXRlcz1wYXJzZUludCh0aGVtaW51dGVzKTsKaWYgKHRoZW1pbnV0ZXM+NjApCnsKcmV0dXJuICIwMCI7Cn0KZWxzZSBpZiAodGhlbWludXRlczwwKQp7CnJldHVybiAiMDAiOwp9CmVsc2UgaWYgKHRoZW1pbnV0ZXM9PSIiKQp7CnJldHVybiAiMDAiOwp9CmVsc2UgaWYgKHRoZW1pbnV0ZXM8MTApCnsKcmV0dXJuICIwIit0aGVtaW51dGVzOwp9CmVsc2UKewpyZXR1cm4gdGhlbWludXRlczsKfQp9CmZ1bmN0aW9uIGhvdXJzQ2hhbmdlZCh0aGVob3VycykKewpsb2dEZWJ1ZygidGhlaG91cnM9Iit0aGVob3Vycyk7CmlmICh0eXBlb2YgdGhlaG91cnM9PSJ1bmRlZmluZWQiKQp7CnJldHVybiAiMCI7Cn0KdGhlaG91cnM9cGFyc2VJbnQodGhlaG91cnMpOwppZiAodGhlaG91cnM+MjQpCnsKcmV0dXJuIDA7Cn0KZWxzZSBpZiAodGhlaG91cnM8MCkKewpyZXR1cm4gMDsKfQplbHNlIGlmICh0aGVob3Vycz09IiIpCnsKcmV0dXJuICIwIjsKfQplbHNlCnsKcmV0dXJuIHRoZWhvdXJzOwp9Cn0KfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2NsYXNzQ2xvc2VNb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRyb290U2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgZXZlbnRfaWQsIHVpQ2FsZW5kYXJDb25maWcpIHsKZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ3NlbGVjdGVkRXZlbnQnLGV2ZW50X2lkLGFmdGVyR2V0Q2xpZW50U3BlY2lmaWNFdmVudCk7CmZ1bmN0aW9uIGFmdGVyR2V0Q2xpZW50U3BlY2lmaWNFdmVudCgpCnsKZm9yIChpID0gMDsgaSA8ICRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50VXNlcnMubGVuZ3RoOyBpKyspCnsKaWYgKCRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50VXNlcnNbaV0uc3RhdHVzX25hbWUhPSRnVXNlcl9zdGF0dXNfYWJzZW50ZWQpCnsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRVc2Vyc1tpXS5wYXJ0aWNpcGF0ZWQ9dHJ1ZTsKfQppZiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRVc2Vyc1tpXS5pc193YWl0aW5nX2xpc3Q9PTEpCnsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRVc2Vyc1tpXS5wYXJ0aWNpcGF0ZWQ9ZmFsc2U7Cn0KfQpsb2dEZWJ1Zygkc2NvcGUuc2VsZWN0ZWRFdmVudCk7Cn0KCi8vIGNsaWNrZWQgcm93IC0gY2hlY2svdW5jaGVjayB0aGUgY2hlY2tib3ggb2YgYSB1c2VyCiRzY29wZS5yb3dDbGlja2VkID0gZnVuY3Rpb24ob2JqKQp7CmxvZ0RlYnVnKCdyb3cgY2xpY2tlZCcpOwpvYmoucGFydGljaXBhdGVkID0gIW9iai5wYXJ0aWNpcGF0ZWQ7Cn07Cgokc2NvcGUub2tMaW1pdGF0aW9uTW9kYWwgPSBmdW5jdGlvbigpIHsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwp9OwoKJHNjb3BlLmNsb3NlQ2xhc3MgPSBmdW5jdGlvbigpCnsKY2xvc2VDbGFzc0V2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUuc2VsZWN0ZWRFdmVudC5ldmVudF9pZCwkc2NvcGUuc2VsZWN0ZWRFdmVudCxhZnRlckNsb3NlRXZlbnQsYWZ0ZXJDbG9zZUV2ZW50KTsKZnVuY3Rpb24gYWZ0ZXJDbG9zZUV2ZW50KCkKewokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgncmVsb2FkRXZlbnQnLHtldmVudF9pZCA6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50X2lkfSk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCn07Cn0KfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2J1c2luZXNzQ2xpZW5kQ2FyZFBheW1lbnQnLCBmdW5jdGlvbigkc2NvcGUsICRyb3V0ZVBhcmFtcywgJHJvb3RTY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRodHRwLCBjdXJyZW50Q2xpZW50LCBpc3BsdXMsIHVpQ2FsZW5kYXJDb25maWcpCnsKJHNjb3BlLmlzcGx1cz1pc3BsdXM7CmxvZ0RlYnVnKCdidXNpbmVzc0NsaWVuZENhcmRQYXltZW50IGlzcGx1cz0nICtpc3BsdXMrIiBjdXJyZW50Q2xpZW50PSIrIEpTT04uc3RyaW5naWZ5KGN1cnJlbnRDbGllbnQsIG51bGwsIDIpKTsKJHNjb3BlLmt1emVJc0xvYWRpbmc9ZmFsc2U7CmxvZ0RlYnVnKCdjdXJyZW50Q2xpZW50LnBheW1lbnRfYmFsYW5jZT0nK2N1cnJlbnRDbGllbnQucGF5bWVudF9iYWxhbmNlKyIsY3VycmVudENsaWVudC51bnBhaWRfYmFsYW5jZSA9IitjdXJyZW50Q2xpZW50LnVucGFpZF9iYWxhbmNlKTsKdGhlYmFsYW5jZSA9IGN1cnJlbnRDbGllbnQucGF5bWVudF9iYWxhbmNlLWN1cnJlbnRDbGllbnQudW5wYWlkX2JhbGFuY2U7CmxvZ0RlYnVnKCd0aGViYWxhbmNlPScrdGhlYmFsYW5jZSk7CmlmICh0aGViYWxhbmNlPDApCnsKJHNjb3BlLmJhbGFuY2VUb1BheT1NYXRoLmFicyh0aGViYWxhbmNlKTsKfQogIC8vIGVsc2UgaWYgKChjdXJyZW50Q2xpZW50LmJhbGFuY2U+MCkgJiYgKGN1cnJlbnRDbGllbnQudW5wYWlkX2JhbGFuY2U+MCkpCiAgLy8gewogIC8vICAgY29uc29sZS5sb2coImN1cnJlbnRDbGllbnQuYmFsYW5jZT0iK2N1cnJlbnRDbGllbnQuYmFsYW5jZSsiLCBjdXJyZW50Q2xpZW50LnVucGFpZF9iYWxhbmNlPSIrY3VycmVudENsaWVudC51bnBhaWRfYmFsYW5jZSk7CiAgLy8gICBpZiAoY3VycmVudENsaWVudC51bnBhaWRfYmFsYW5jZT5jdXJyZW50Q2xpZW50LmJhbGFuY2UpCiAgLy8gICB7CiAgLy8gICAgICRzY29wZS5iYWxhbmNlVG9QYXk9Y3VycmVudENsaWVudC51bnBhaWRfYmFsYW5jZS1jdXJyZW50Q2xpZW50LmJhbGFuY2U7CiAgLy8gICB9CiAgLy8gICBlbHNlIHsKICAvLyAgICAgJHNjb3BlLmJhbGFuY2VUb1BheT0wOwogIC8vICAgfQogIC8vIH0KZWxzZQp7CiRzY29wZS5iYWxhbmNlVG9QYXk9MDsKfQokc2NvcGUucGF5bWVudFR5cGVUaXRsZT0i15HXl9eoIjsKJHNjb3BlLmN1cnJlbnRDbGllbnQ9Y3VycmVudENsaWVudDsKbG9nRGVidWcoJHNjb3BlLmN1cnJlbnRDbGllbnQpOwokc2NvcGUuYnVzaW5lc3NDb25maWcgPSBCdXNpbmVzc0NvbmZpZy5nZXQoKTsKJHNjb3BlLmJ1c2luZXNzQ29uZmlnLnRoZW4oZnVuY3Rpb24gKGNvbmZpZykgewokc2NvcGUuaW52b2ljZV9zb3VyY2VfaWQgPSBjb25maWcuaW52b2ljZV9zb3VyY2VfaWQ7CiRzY29wZS5oYXNWYXQgPSBjb25maWcudmF0X3JhdGUgPiAwOwp9KTsKCiRzY29wZS5jbG9zZU1vZGFsID0gZnVuY3Rpb24oKSB7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKfTsKCiRzY29wZS5leHRlcm5hbF9pbnZvaWNlX2dlbmVyYXRlZD1mYWxzZTsKJHNjb3BlLmludm9pY2VfZGF0ZV9mb3JtYXQ9bmV3IERhdGUoKTsKCmdldE5leHRJbnZvaWNlTnVtYmVyKCRodHRwLCRzY29wZSwkc2NvcGUuY3VycmVudENsaWVudC5idXNpbmVzc191c2VyX2lkLCdpbnZvaWNlX251bWJlcicpOwoKJHNjb3BlLnBheW1lbnRNZXRob2RzID0gcGF5bWVudE1ldGhvZHM7CiRzY29wZS5jcmVkaXRDYXJkVHlwZXMgPSBjcmVkaXRDYXJkVHlwZXM7CiRzY29wZS5jcmVkaXRUcmFuc2FjdGlvblR5cGVzID0gY3JlZGl0VHJhbnNhY3Rpb25UeXBlczsKJHNjb3BlLmJhbmtzID0gYmFua3M7CgovLyBpbmRpY2F0aW9uIHdoZXRoZXIgcGF5bWVudCBtZXRob2Qgd2FzIHNlbGVjdGVkCiRzY29wZS5pc1BheW1lbnRNZXRob2RTZWxlY3RlZD1mYWxzZTsKJHNjb3BlLnNlbGVjdFBheW1lbnRNZXRob2QgPSBmdW5jdGlvbihwYXltZW50KSB7CiRzY29wZS5wYXltZW50VHlwZVRpdGxlPXBheW1lbnQubmFtZTsKJHNjb3BlLnNlbGVjdGVkUGF5bWVudE1ldGhvZD1wYXltZW50Owokc2NvcGUuaXNQYXltZW50TWV0aG9kU2VsZWN0ZWQ9dHJ1ZTsKfTsKCiRzY29wZS51cGRhdGVCYWxhbmNlID0gZnVuY3Rpb24gdXBkYXRlQmFsYW5jZSAoaXNTb3VyY2VXaXRoVmF0KSB7CiRzY29wZS5idXNpbmVzc0NvbmZpZy50aGVuKGZ1bmN0aW9uIChjb25maWcpIHsKaWYgKGlzU291cmNlV2l0aFZhdCkgewokc2NvcGUuYmFsYW5jZVRvUGF5Tm9WYXQgPSBOdW1iZXIoKCRzY29wZS5iYWxhbmNlVG9QYXkgLyAoMSArIGNvbmZpZy52YXRfcmF0ZSkpLnRvRml4ZWQoMikpOwp9IGVsc2Ugewokc2NvcGUuYmFsYW5jZVRvUGF5ID0gTnVtYmVyKCgkc2NvcGUuYmFsYW5jZVRvUGF5Tm9WYXQgKiAoMSArIGNvbmZpZy52YXRfcmF0ZSkpLnRvRml4ZWQoMikpOwp9Cn0pCn07Cgokc2NvcGUubWFrZVBheW1lbnQgPSBmdW5jdGlvbigpCnsKbG9nRGVidWcoY3VycmVudENsaWVudCk7CmxvZ0RlYnVnKCJwYXltZW50IG1ldGhvZCIpOwpsb2dEZWJ1Zygkc2NvcGUuc2VsZWN0ZWRQYXltZW50TWV0aG9kKTsKbG9nRGVidWcoIiRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2dlbmVyYXRlZD08Iiskc2NvcGUuaW52b2ljZV9nZW5lcmF0ZWQrIj4iKTsKCmlmICgoJHNjb3BlLmJhbGFuY2VUb1BheT09MCkgfHwgKCRzY29wZS5iYWxhbmNlVG9QYXk9PScnKXx8ICgkc2NvcGUuYmFsYW5jZVRvUGF5PT1udWxsKSkKewokc2NvcGUudXNlckVycm9yPSLXkNeg15Ag15TXltefINeh15vXldedINeb15zXqdeU15UiOwp9CmVsc2UgaWYgKCEkc2NvcGUuaXNQYXltZW50TWV0aG9kU2VsZWN0ZWQpCnsKJHNjb3BlLnVzZXJFcnJvcj0i15DXoNeQINeR15fXqCDXkNee16bXoteZINeq16nXnNeV150iOwovLyBhbGVydCgnc3MnKTsKfQplbHNlCnsKaWYgKCgkc2NvcGUuaW52b2ljZV9nZW5lcmF0ZWQhPTEpIHx8ICgkc2NvcGUuaW52b2ljZV9kYXRlX2Zvcm1hdD09bnVsbCkpCnsKdmFyIGludm9pY2VfZGF0ZV9mb3JtYXQgPSAibnVsbCI7Cn0KZWxzZQp7CnZhciBpbnZvaWNlX2RhdGVfZm9ybWF0ID0gJHNjb3BlLmludm9pY2VfZGF0ZV9mb3JtYXQuZ2V0RGF0ZSgpICArICItIiArICgkc2NvcGUuaW52b2ljZV9kYXRlX2Zvcm1hdC5nZXRNb250aCgpKzEpICsgIi0iICsgJHNjb3BlLmludm9pY2VfZGF0ZV9mb3JtYXQuZ2V0RnVsbFllYXIoKTsKfQppZiAoaXNwbHVzKQp7CndoYXRUb1BheT0kc2NvcGUuYmFsYW5jZVRvUGF5Owp9CmVsc2Ugewp3aGF0VG9QYXk9LSRzY29wZS5iYWxhbmNlVG9QYXk7Cn0KdGhlZGF0YT0gewpiYWxhbmNlVG9QYXk6IHdoYXRUb1BheSwKYmFsYW5jZVRvUGF5Tm9WYXQ6ICRzY29wZS5iYWxhbmNlVG9QYXlOb1ZhdCAqIChpc3BsdXMgPyArMSA6IC0xKSwKcGF5bWVudF9tZXRob2RfbmFtZTogJHNjb3BlLnNlbGVjdGVkUGF5bWVudE1ldGhvZC5tZXRob2QsCmludm9pY2VfbnVtYmVyOiAkc2NvcGUuaW52b2ljZV9udW1iZXIsCmludm9pY2VfZ2VuZXJhdGVkOiAkc2NvcGUuaW52b2ljZV9nZW5lcmF0ZWQsCmludm9pY2VfZGF0ZTogaW52b2ljZV9kYXRlX2Zvcm1hdCwKYmFua19jb21wYW55X2NvZGU6ICRzY29wZS5iYW5rX2NvbXBhbnlfY29kZSwKYmFua19icmFuY2hfbnVtYmVyOiAkc2NvcGUuYmFua19icmFuY2hfbnVtYmVyLApjaGVja19udW1iZXI6ICRzY29wZS5jaGVja19udW1iZXIsCmFjY291bnRfbnVtYmVyOiAkc2NvcGUuYWNjb3VudF9udW1iZXIsCmNyZWRpdF9jYXJkX251bWJlcjogJHNjb3BlLmNyZWRpdF9jYXJkX251bWJlciwKY3JlZGl0X2NhcmRfdHlwZTogJHNjb3BlLmNyZWRpdF9jYXJkX3R5cGUsCmNyZWRpdF9jYXJkX3RyYW5zYWN0aW9uX3R5cGU6ICRzY29wZS5jcmVkaXRfY2FyZF90cmFuc2FjdGlvbl90eXBlLAppbnZvaWNlX2NvbW1lbnRzOiAkc2NvcGUuaW52b2ljZV9jb21tZW50cwp9Owokc2NvcGUua3V6ZUlzTG9hZGluZz10cnVlOwpjcmVhdGVQYXltZW50Rm9yQ2xpZW50KCRodHRwLCRzY29wZSxjdXJyZW50Q2xpZW50LmJ1c2luZXNzX3VzZXJfaWQsdGhlZGF0YSxjcmVhdGVQYXltZW50Rm9yQ2xpZW50X3N1Y2Nlc3MsIGNyZWF0ZVBheW1lbnRGb3JDbGllbnRfZmFpbHVyZSk7CmZ1bmN0aW9uIGNyZWF0ZVBheW1lbnRGb3JDbGllbnRfc3VjY2VzcygpCnsKJHNjb3BlLmt1emVJc0xvYWRpbmc9ZmFsc2U7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKbG9nRGVidWcoImJyb2FkY2FzdGluZyBjbGllbnRQYWdlUmVsb2FkRGF0YSIpOwokcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NsaWVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCmxvZ0RlYnVnKCJicm9hZGNhc3RpbmcgZXZlbnRQYWdlUmVsb2FkRGF0YSIpOwokcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2V2ZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKLy8gbG9nRGVidWcoImJyb2FkY2FzdGluZyByZWxvYWRFdmVudCIpOwovLyAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ3JlbG9hZEV2ZW50Jyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCn0KZnVuY3Rpb24gY3JlYXRlUGF5bWVudEZvckNsaWVudF9mYWlsdXJlKCkKewokc2NvcGUua3V6ZUlzTG9hZGluZz1mYWxzZTsKfQp9Cn0KfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdldmVudERldGFpbHNCdXNpbmVzc0NhbGVuZGFyTW9kYWxDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIHNlbGVjdGVkRXZlbnQsIHVpQ2FsZW5kYXJDb25maWcpIHsKdmFyIGRheU5hbWVzID0gWyfXqNeQ16nXldefJywgJ9ep16DXmScsICfXqdec15nXqdeZJywgJ9eo15HXmdei15knLCAn15fXnteZ16nXmScsICfXqdeZ16nXmScsICfXqdeR16onXTsKCiRzY29wZS5nb3RvQ2xpZW50UGFnZT0gZnVuY3Rpb24gKGJ1c2luZXNVc2VyaWQpCnsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwpnb3RvQ2xpZW50UGFnZShidXNpbmVzVXNlcmlkKTsKfQokc2NvcGUuZWRpdEV2ZW50PSBmdW5jdGlvbiAodGhlZXZlbnQpCnsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwpnb3RvRXZlbnRQYWdlKHRoZWV2ZW50KTsKfQoKbG9nRGVidWcoInNlbGVjdGVkIEV2ZW50IGluZm8gPSIgKyBKU09OLnN0cmluZ2lmeShzZWxlY3RlZEV2ZW50LCBudWxsLCAyKSk7CiRzY29wZS5zZWxlY3RlZEV2ZW50ID0gc2VsZWN0ZWRFdmVudDsKc2VsZWN0ZWREYXRlU3RhcnQgPSBuZXcgRGF0ZShzZWxlY3RlZEV2ZW50LnN0YXJ0KTsKdmFyIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZSgpICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKCiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRIb3VycygpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBzZWxlY3RlZERhdGVTdGFydC5nZXRNaW51dGVzKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZG93ID0gZGF5TmFtZXNbc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RGF5KCldOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRhdGUgPSBzZWxlY3RlZERhdGVTdGFydDsKCiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0RGF5ID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RGF0ZSgpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydE1vbnRoID0gMSArIHNlbGVjdGVkRGF0ZVN0YXJ0LmdldE1vbnRoKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0TW9udGhUeHQgPSBtb250aE5hbWVzWyRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0TW9udGggLSAxXTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRZZWFyID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RnVsbFllYXIoKTsKCnNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKHNlbGVjdGVkRXZlbnQuZW5kKTsKdmFyIHNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKHNlbGVjdGVkRGF0ZUVuZC5nZXRUaW1lKCkgKyBzZWxlY3RlZERhdGVFbmQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKCiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzID0gc2VsZWN0ZWREYXRlRW5kLmdldEhvdXJzKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGRvdyA9IGRheU5hbWVzW3NlbGVjdGVkRGF0ZUVuZC5nZXREYXkoKV07CiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKSA8IDEwID8gJzAnIDogJycpICsgc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKTsKJHNjb3BlLm9rTGltaXRhdGlvbk1vZGFsID0gZnVuY3Rpb24oKSB7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKfTsKCiRzY29wZS5kZWxldGVMaW1pdGF0aW9uTW9kYWwgPSBmdW5jdGlvbigpIHsKJHVpYk1vZGFsSW5zdGFuY2UuZGlzbWlzcygnZGVsZXRlJyk7CmNhbGVuZGFyID0gJ2NhbGVuZGFyX2J1c2luZXNzJzsKCiRzY29wZS5kZWxldGVDYWxlbmRhckRCRXZlbnQoc2VsZWN0ZWRFdmVudCwgY2FsZW5kYXIpOwp9Owokc2NvcGUuZGVsZXRlQ2FsZW5kYXJKU0V2ZW50ID0gZnVuY3Rpb24oY2FsZW5kYXIsIHNlbGVjdGVkRXZlbnRpZCkgewoKbG9nRGVidWcoImNhbGVuZGFyX2hvdXJzX29mX3dvcmtfY29uZmlnPSIgKyB1aUNhbGVuZGFyQ29uZmlnKTsKbG9nRGVidWcoInVpQ2FsZW5kYXJDb25maWdbY2FsZW5kYXJdPSIgKyB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1snY2FsZW5kYXJfYnVzaW5lc3MnXSk7CmxvZ0RlYnVnKCJkZWxldGUganMgZXZlbnQgIiArIHNlbGVjdGVkRXZlbnRpZCk7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlbW92ZUV2ZW50cycsIFtzZWxlY3RlZEV2ZW50aWRdKTsgLy8gZ28gdG8gZGF0ZSBpbiBjYWxlbmRhciBnb3RvCn07CiRzY29wZS5kZWxldGVDYWxlbmRhckRCRXZlbnQgPSBmdW5jdGlvbihzZWxlY3RlZEV2ZW50LCBjYWxlbmRhcikgewpsb2dEZWJ1ZygiZGVsZXRlIGV2ZW50ICIgKyBzZWxlY3RlZEV2ZW50LmlkKTsKJGh0dHAoewptZXRob2Q6ICdQT1NUJywKdXJsOiAnL2FwaS9hZG1pbi9ldmVudHMvZGVsZXRlLycgKyBzZWxlY3RlZEV2ZW50LmlkLApkYXRhOiB7CnRlbXBfbGltaXRfaWQ6IHNlbGVjdGVkRXZlbnQudGVtcF9saW1pdF9pZAp9LApoZWFkZXJzOiB7CidDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbjtjaGFyc2V0PXV0Zi04Jwp9Cn0pLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkgewoKbG9nRGVidWcoZGF0YSk7CmlmICghZGF0YS5zdWNjZXNzKSB7CmxvZ0RlYnVnKCJkZWxldGUgbGltaXRfaWQgZXJyb3IgKyIgKyBkYXRhLm1lc3NhZ2UpOwovLyBpZiBub3Qgc3VjY2Vzc2Z1bCwgYmluZCBlcnJvcnMgdG8gZXJyb3IgdmFyaWFibGVzCi8vCQkJICAkc2NvcGUuZXJyb3JOYW1lID0gZGF0YS5lcnJvcnMubmFtZTsKLy8JCQkgICRzY29wZS5lcnJvclN1cGVyaGVybyA9IGRhdGEuZXJyb3JzLnN1cGVyaGVyb0FsaWFzOwp9IGVsc2Ugewpsb2dEZWJ1ZygiZGVsZXRlIGxpbWl0X2lkIHN1Y2Nlc3MiKTsKLy8gaWYgc3VjY2Vzc2Z1bCwgYmluZCBzdWNjZXNzIG1lc3NhZ2UgdG8gbWVzc2FnZQovLwkJCSAgJHNjb3BlLm1lc3NhZ2UgPSBkYXRhLm1lc3NhZ2U7CiRzY29wZS5kZWxldGVDYWxlbmRhckpTRXZlbnQoY2FsZW5kYXIsIHNlbGVjdGVkRXZlbnQuaWQpOwoKfQp9KTsKCmxvZ0RlYnVnKCJhZnRlciByZW1vdmUgZXZlbnQiKTsKfTsKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2V2ZW50UmVjdXJyaW5nRGV0YWlsc0J1c2luZXNzQ2FsZW5kYXJNb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgc2VsZWN0ZWRFdmVudCwgdWlDYWxlbmRhckNvbmZpZykgewp2YXIgZGF5TmFtZXMgPSBbJ9eo15DXqdeV158nLCAn16nXoNeZJywgJ9ep15zXmdep15knLCAn16jXkdeZ16LXmScsICfXl9ee15nXqdeZJywgJ9ep15nXqdeZJywgJ9ep15HXqiddOwoKJHNjb3BlLmdvdG9DbGllbnRQYWdlPSBmdW5jdGlvbiAoYnVzaW5lc3NVc2VyaWQpCnsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwpnb3RvQ2xpZW50UGFnZShidXNpbmVzc1VzZXJpZCk7Cn0KJHNjb3BlLmVkaXRFdmVudD0gZnVuY3Rpb24gKHRoZWV2ZW50KQp7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKZ290b0V2ZW50UGFnZSh0aGVldmVudCk7Cn0KCgpsb2dEZWJ1Zygic2VsZWN0ZWQgUmVjdXJyaW5nIEV2ZW50IGluZm8gPSIgKyBKU09OLnN0cmluZ2lmeShzZWxlY3RlZEV2ZW50LCBudWxsLCAyKSk7CiRzY29wZS5zZWxlY3RlZEV2ZW50ID0gc2VsZWN0ZWRFdmVudDsKc2VsZWN0ZWREYXRlU3RhcnQgPSBuZXcgRGF0ZShzZWxlY3RlZEV2ZW50LnN0YXJ0KTsKdmFyIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZSgpICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKCi8vIGxvZ0RlYnVnKCJzZWxlY3RlZEV2ZW50LnN0YXJ0PSIgKyBzZWxlY3RlZEV2ZW50LnN0YXJ0KTsKLy8gbG9nRGVidWcoImRhdGU9IiArIHNlbGVjdGVkRGF0ZVN0YXJ0KTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycyA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldEhvdXJzKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcyA9IChzZWxlY3RlZERhdGVTdGFydC5nZXRNaW51dGVzKCkgPCAxMCA/ICcwJyA6ICcnKSArIHNlbGVjdGVkRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkb3cgPSBkYXlOYW1lc1tzZWxlY3RlZERhdGVTdGFydC5nZXREYXkoKV07CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF0ZSA9IHNlbGVjdGVkRGF0ZVN0YXJ0OwoKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnREYXkgPSBzZWxlY3RlZERhdGVTdGFydC5nZXREYXRlKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0TW9udGggPSAxICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TW9udGgoKTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRNb250aFR4dCA9IG1vbnRoTmFtZXNbJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRNb250aCAtIDFdOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydFllYXIgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRGdWxsWWVhcigpOwoKc2VsZWN0ZWREYXRlRW5kID0gbmV3IERhdGUoc2VsZWN0ZWRFdmVudC5lbmQpOwp2YXIgc2VsZWN0ZWREYXRlRW5kID0gbmV3IERhdGUoc2VsZWN0ZWREYXRlRW5kLmdldFRpbWUoKSArIHNlbGVjdGVkRGF0ZUVuZC5nZXRUaW1lem9uZU9mZnNldCgpICogNjAwMDApOwoKLy8gbG9nRGVidWcoInNlbGVjdGVkRXZlbnQuZW5kPSIgKyBzZWxlY3RlZEV2ZW50LmVuZCk7Ci8vIGxvZ0RlYnVnKCJkYXRlPSIgKyBzZWxlY3RlZERhdGVFbmQpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycyA9IHNlbGVjdGVkRGF0ZUVuZC5nZXRIb3VycygpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRkb3cgPSBkYXlOYW1lc1tzZWxlY3RlZERhdGVFbmQuZ2V0RGF5KCldOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzID0gKHNlbGVjdGVkRGF0ZUVuZC5nZXRNaW51dGVzKCkgPCAxMCA/ICcwJyA6ICcnKSArIHNlbGVjdGVkRGF0ZUVuZC5nZXRNaW51dGVzKCk7CiRzY29wZS5va0xpbWl0YXRpb25Nb2RhbCA9IGZ1bmN0aW9uKCkgewokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7Cn07Cgp9KTsKCmt1emVBcHAuY29udHJvbGxlcignZXZlbnREZXRhaWxzSG91cnNPZldvcmtNb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgc2VsZWN0ZWRFdmVudCwgZml4ZWRTY2hlZHVsZSwgdWlDYWxlbmRhckNvbmZpZykgewp2YXIgZGF5TmFtZXMgPSBbJ9eo15DXqdeV158nLCAn16nXoNeZJywgJ9ep15zXmdep15knLCAn16jXkdeZ16LXmScsICfXl9ee15nXqdeZJywgJ9ep15nXqdeZJywgJ9ep15HXqiddOwoKLy8gbG9nRGVidWcoInNlbGVjdGVkIEV2ZW50ID0iICsgSlNPTi5zdHJpbmdpZnkoc2VsZWN0ZWRFdmVudCwgbnVsbCwgNCkpOwokc2NvcGUuZml4ZWRTY2hlZHVsZT1maXhlZFNjaGVkdWxlOwokc2NvcGUuc2VsZWN0ZWRFdmVudCA9IHNlbGVjdGVkRXZlbnQ7CiRzY29wZS5zZWxlY3RlZEV2ZW50Lm9yaWdfZXZlbnRfdHlwZXMgPSBhbmd1bGFyLmNvcHkoc2VsZWN0ZWRFdmVudC5ldmVudF90eXBlcyk7CiRzY29wZS5uZXdFdmVudERldGFpbHMgPSBbXTsKCmdldEJ1c2luZXNzTG9jYXRpb25zKCRodHRwLCRzY29wZSwnYnVzaW5lc3NfbG9jYXRpb25zJyk7Cgpsb2dEZWJ1ZygiaG91cnMgb2Ygd29yayBibG9jay9ldmVudCBjbGlja2VkICIrSlNPTi5zdHJpbmdpZnkoJHNjb3BlLnNlbGVjdGVkRXZlbnQpKTsKCnNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc2VsZWN0ZWRFdmVudC5zdGFydCk7CnZhciBzZWxlY3RlZERhdGVTdGFydCA9IG5ldyBEYXRlKHNlbGVjdGVkRGF0ZVN0YXJ0LmdldFRpbWUoKSArIHNlbGVjdGVkRGF0ZVN0YXJ0LmdldFRpbWV6b25lT2Zmc2V0KCkgKiA2MDAwMCk7CmdldEFsbEluc3RydWN0b3JzKCRodHRwLCRzY29wZSwnaW5zdHJ1Y3RvcnMnKTsKZ2V0Tm9DbGFzc0V2ZW50VHlwZXNOb0FkbWluKCRodHRwLCRzY29wZSwncmVsYXRlZEV2ZW50VHlwZXMnLGdldE5vQ2xhc3NFdmVudFR5cGVzTm9BZG1pbl9zdWNjZXNzKTsKZnVuY3Rpb24gZ2V0Tm9DbGFzc0V2ZW50VHlwZXNOb0FkbWluX3N1Y2Nlc3MoKQp7CmZvcih2YXIgaSA9IDA7IGkgPCAkc2NvcGUuc2VsZWN0ZWRFdmVudC5ldmVudF90eXBlcy5sZW5ndGg7IGkrKykKewovLyBjb3B5aW5nIHRoZSBhY3R1YWwgb2JqZWN0IG9mICRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50X3R5cGVzW2ldCmZvcih2YXIgaiA9IDA7IGogPCAkc2NvcGUucmVsYXRlZEV2ZW50VHlwZXMubGVuZ3RoOyBqKyspCnsKaWYgKCRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50X3R5cGVzW2ldLmV2ZW50X3R5cGVfaWQ9PSRzY29wZS5yZWxhdGVkRXZlbnRUeXBlc1tqXS5ldmVudF90eXBlX2lkKQp7CiRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50X3R5cGVzW2ldPWFuZ3VsYXIuY29weSgkc2NvcGUucmVsYXRlZEV2ZW50VHlwZXNbal0pOwp9Cn0KfQp9CgovLyBsb2dEZWJ1Zygic2VsZWN0ZWRFdmVudC5zdGFydD0iICsgc2VsZWN0ZWRFdmVudC5zdGFydCk7Ci8vIGxvZ0RlYnVnKCJkYXRlPSIgKyBzZWxlY3RlZERhdGVTdGFydCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRIb3VycygpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBzZWxlY3RlZERhdGVTdGFydC5nZXRNaW51dGVzKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZG93ID0gZGF5TmFtZXNbc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RGF5KCldOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRhdGUgPSBzZWxlY3RlZERhdGVTdGFydDsKCnNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKHNlbGVjdGVkRXZlbnQuZW5kKTsKdmFyIHNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKHNlbGVjdGVkRGF0ZUVuZC5nZXRUaW1lKCkgKyBzZWxlY3RlZERhdGVFbmQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKCiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bW9udGggPSBtb250aE5hbWVzW3NlbGVjdGVkRGF0ZVN0YXJ0LmdldE1vbnRoKCldOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoMTEyID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TW9udGgoKSsxOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRheW9mbW9udGggPSBzZWxlY3RlZERhdGVTdGFydC5nZXREYXRlKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0eWVhciA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCk7Ci8vICRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZV9pbnB1dF9mb3JtYXQ9IG5ldyBEYXRlKDE5NzAsIDAsIDEsICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMsICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcywgMCk7CgovLyBsb2dEZWJ1Zygic2VsZWN0ZWRFdmVudC5lbmQ9IiArIHNlbGVjdGVkRXZlbnQuZW5kKTsKLy8gbG9nRGVidWcoImRhdGU9IiArIHNlbGVjdGVkRGF0ZUVuZCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzID0gc2VsZWN0ZWREYXRlRW5kLmdldEhvdXJzKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGRvdyA9IGRheU5hbWVzW3NlbGVjdGVkRGF0ZUVuZC5nZXREYXkoKV07CiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKSA8IDEwID8gJzAnIDogJycpICsgc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKTsKCgokc2NvcGUub2tMaW1pdGF0aW9uTW9kYWwgPSBmdW5jdGlvbigpIHsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwp9OwoKJHNjb3BlLnVwZGF0ZUxpbWl0YXRpb25Nb2RhbCA9IGZ1bmN0aW9uKCkKewpsb2dEZWJ1ZygiZnVuY3Rpb246IHVwZGF0ZUxpbWl0YXRpb25Nb2RhbCIpOwppZiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRfdHlwZXMubGVuZ3RoPDEpCnsKcmV0dXJuIGZhbHNlOwp9CmlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vyczwkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKQp7CmFsZXJ0KCLXltee158g16HXmdeV150g15zXpNeg15kg15bXntefINeU16rXl9ec15QiKTsKcmV0dXJuIGZhbHNlOwp9CmlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vycz09JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykKewppZiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlczw9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKQp7CmFsZXJ0KCLXltee158g16HXmdeV150g15zXpNeg15kg15bXntefINeU16rXl9ec15QiKTsKcmV0dXJuIGZhbHNlOwp9CmlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzPCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMrMTApKQp7CmFsZXJ0KCLXkdec15XXpyDXp9eY158g154tMTAg15PXp9eV16oiKTsKcmV0dXJuIGZhbHNlOwp9Cn0KCgpmdW5jdGlvbiB1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25fc3VjY2VzcygpCnsKY2FsZW5kYXIgPSAnY2FsZW5kYXJfaG91cnNfb2Zfd29yayc7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsgLy8gZ28gdG8gZGF0ZSBpbiBjYWxlbmRhciBnb3RvCiR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoJ2RlbGV0ZScpOwp9CgppZiAoJHNjb3BlLmZpeGVkU2NoZWR1bGUpCnsKLy8gZml4ZWQgc2NoZWR1bGUgLSB1cGFkdGluZyBsaW1pdGF0aW9uIDE5NzAKdGhlZGF0YSA9IHsKc3RhcnRfZGF0ZTogbmV3X3N0YXJ0LAplbmRfZGF0ZTogbmV3X2VuZCwKdGVtcF9saW1pdF9pZDogbnVsbCwKbGltaXRfaWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmxpbWl0X2lkLApldmVudF90eXBlczogJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRfdHlwZXMsCmxvY2F0aW9uX2lkOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5sb2NhdGlvbl9pZCwKb3JpZ19ldmVudF90eXBlczogJHNjb3BlLnNlbGVjdGVkRXZlbnQub3JpZ19ldmVudF90eXBlcywKZW1wX2lkOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbXBfaWQKfTsKdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uKCRodHRwLCRzY29wZSx0aGVkYXRhLCRzY29wZS5zZWxlY3RlZEV2ZW50LmxpbWl0X2lkLCB1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25fc3VjY2Vzcyk7Cn0KZWxzZQovLyBub3QgZml4ZWQgc2NoZWR1bGUgLSBwZXJkYXkgYmxvY2sKewovLy8vLy8vLy8vLwppZiAoKCRzY29wZS5zZWxlY3RlZEV2ZW50LmxpbWl0X2lkICE9IG51bGwpICYgKCRzY29wZS5zZWxlY3RlZEV2ZW50LmRheV9saW1pdF9pZCA9PSAtMSkpIC8vIGV2ZW50IGxpbWl0YXRpb24gaGFzIGxpbWl0X2lkIHNvIGl0cyBhbiAxOTcwIGV2ZW50Ci8vIG5lZWQgdG8gYWRkIGEgbmV3IHBlcmRheSBsaW1pdGF0aW9uIHRoYXQgcG9pbnQgKGxpbWl0X2lkKSB0byB0aGUgb2xkIDE5NzAgZXZlbnQgdG8gcmVwbGFjdGUgaXQKewp0ZW1wX2xpbWl0X2lkID0gY2FsY190ZW1wX2xpbWl0X2lkKCk7Ci8vIHRoZWV2ZW50LnRlbXBfbGltaXRfaWQgPSB0ZW1wX2xpbWl0X2lkOwovLyB0aGVldmVudC5kYXlfbGltaXRfaWQgPSB0ZW1wX2xpbWl0X2lkOwovLyB0aGUgbW92ZWQgZXZlbnQgaW4gdGhlIGNhbGVuZGFyIG5vdyBoYXMgZGF5X2xpbWl0X2lkIGFuZCB0ZW1wX2xpbWl0X2lkCi8vIGlmIGl0cyBsb2FkZWQgZnJvbSB0aGUgZGIsIGl0IHdpbGwgb25seSBoYXZlIGRheV9saW1pdF9pZCAoYW5kIG5vdCB0aGUgdGVtcCBvbmUpCi8vIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWydjYWxlbmRhcl9ob3Vyc19vZl93b3JrJ10uZnVsbENhbGVuZGFyKCd1cGRhdGVFdmVudCcsIHRoZWV2ZW50KTsKLy8gY29uc29sZS5sb2coIlhYWFhYWFhYWFhYWFgiKTsKdGhlZGF0YSA9IHsKc3RhcnRfZGF0ZTogbmV3X3N0YXJ0LAplbmRfZGF0ZTogbmV3X2VuZCwKY29sb3I6ICcnLAp0ZW1wX2xpbWl0X2lkOiAwLApldmVudF90eXBlX2lkOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5ldmVudF90eXBlX2lkLApldmVudF90eXBlczogJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRfdHlwZXMsCmxpbWl0X2lkOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5pZCwKbG9jYXRpb25faWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmxvY2F0aW9uX2lkLAplbXBfaWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmVtcF9pZAovLyB0aXRsZTogdGhlZXZlbnQudGl0bGUKfTsKY3JlYXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5KCRodHRwLCRzY29wZSx0aGVkYXRhLHVwZGF0ZUNhbGVuZGFyTGltaXRhdGlvbl9zdWNjZXNzKTsKCn0KZWxzZQp7CnRoZWRhdGE9IHsKc3RhcnRfZGF0ZTogbmV3X3N0YXJ0LAplbmRfZGF0ZTogbmV3X2VuZCwKdGVtcF9kYXlfbGltaXRfaWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LnRlbXBfbGltaXRfaWQsCm9yaWdfZXZlbnRfdHlwZXM6ICRzY29wZS5zZWxlY3RlZEV2ZW50Lm9yaWdfZXZlbnRfdHlwZXMsCmV2ZW50X3R5cGVzOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5ldmVudF90eXBlcywKbG9jYXRpb25faWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmxvY2F0aW9uX2lkLApkYXlfbGltaXRfaWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmRheV9saW1pdF9pZCwKZW1wX2lkOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbXBfaWQKfTsKdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5KCRodHRwLCRzY29wZSx0aGVkYXRhLHVwZGF0ZUNhbGVuZGFyTGltaXRhdGlvbl9zdWNjZXNzKTsKfQp9Cn0KJHNjb3BlLmRlbGV0ZUxpbWl0YXRpb25Nb2RhbCA9IGZ1bmN0aW9uKCkgewpjYWxlbmRhciA9ICdjYWxlbmRhcl9ob3Vyc19vZl93b3JrJzsKCi8vIHJlbW92aW5nIGxpbWl0YXRpb24gZnJvbSBkYXRhYmFzZSwgaWYgdHJ1ZSAtIHJlbW92aW5nIGZyb20gZGlzcGxheSBhbHNvCmlmICgkc2NvcGUuZGVsZXRlQ2FsZW5kYXJEQkxpbWl0YXRpb25FdmVudChzZWxlY3RlZEV2ZW50KSkKewovLyAkc2NvcGUuZGVsZXRlQ2FsZW5kYXJKU0V2ZW50KGNhbGVuZGFyLCBzZWxlY3RlZEV2ZW50LmlkKTsKfQokdWliTW9kYWxJbnN0YW5jZS5kaXNtaXNzKCdkZWxldGUnKTsKfTsKJHNjb3BlLmRlbGV0ZUNhbGVuZGFySlNFdmVudCA9IGZ1bmN0aW9uKGNhbGVuZGFyLCBzZWxlY3RlZEV2ZW50aWQpIHsKCmxvZ0RlYnVnKCJjYWxlbmRhcl9ob3Vyc19vZl93b3JrX2NvbmZpZz0iICsgdWlDYWxlbmRhckNvbmZpZyk7CmxvZ0RlYnVnKCJ1aUNhbGVuZGFyQ29uZmlnW2NhbGVuZGFyXT0iICsgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnXSk7CmxvZ0RlYnVnKCJkZWxldGUganMgZXZlbnQgIiArIHNlbGVjdGVkRXZlbnRpZCk7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlbW92ZUV2ZW50cycsIFtzZWxlY3RlZEV2ZW50aWRdKTsgLy8gZ28gdG8gZGF0ZSBpbiBjYWxlbmRhciBnb3RvCn07CiRzY29wZS5kZWxldGVDYWxlbmRhckRCTGltaXRhdGlvbkV2ZW50ID0gZnVuY3Rpb24oc2VsZWN0ZWRFdmVudCkgewpjYWxlbmRhciA9ICdjYWxlbmRhcl9ob3Vyc19vZl93b3JrJzsKLy8gcmV0dXJuIGZhbHNlOwoKLy8gZGVsZXRpbmcgZXZlbnQgbGltaXRhdGlvbiAobm90IHBlciBkYXkpCi8vIGVpdGhlciBmcm9tIDE5NzAgKGhvdXJzX29mX3dvcmsgcGFnZSkKLy8gb3IgZnJvbSB0aGVpciBpbnN0YW5jZSBpbiB0aGUgY3VycmVudCB3ZWVrJ3MgbGltaXRhdGlvbi4KLy8gZWl0aGVyIHdheSBkYXlfbGltaXRfaWQgaXMgLTEgZm9yIGxpbWl0YXRpb25zIGZyb20gMTk3MAppZiAoc2VsZWN0ZWRFdmVudC5kYXlfbGltaXRfaWQgPT0gLTEpCnsKbG9nRGVidWcoInJlbW92aW5nIGV2ZW50IGxpbWl0YXRpb24sIGNoZWNraWduIGlmIGl0cyBpbiAxOTcwICh0aGUgb3JpZ2luYWwpIG9yIGFuIGluc3RhbmNlIGluIHByZXNlbnQiKTsKc2VsZWN0ZWREYXRlU3RhcnQgPSBuZXcgRGF0ZShzZWxlY3RlZEV2ZW50LnN0YXJ0KTsKLy8gaWYgaXRzIDE5NzAgdGhpcyBtZWFucyB3ZSdyZSBpbiB0aGUgaG91cnNfb2Zfd29yayBnZW5lcmFsIHBhZ2UKLy8gc28gd2Ugc2ltcGx5IGRlbGV0ZSBpdAppZiAoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSA9PSAxOTcwKQp7CmxvZ0RlYnVnKCJyZW1vdmluZyBldmVudCBsaW1pdGF0aW9uIGZyb20gMTk3MCIpOwp0aGVkYXRhPSB7CnRlbXBfbGltaXRfaWQ6IHNlbGVjdGVkRXZlbnQudGVtcF9saW1pdF9pZAp9OwpkZWxldGVDYWxlbmRhckxpbWl0YXRpb24oJGh0dHAsJHNjb3BlLHRoZWRhdGEsc2VsZWN0ZWRFdmVudC5saW1pdF9pZCwgZGVsZXRlQ2FsZW5kYXJMaW1pdGF0aW9uX3N1Y2Nlc3MpOwpmdW5jdGlvbiBkZWxldGVDYWxlbmRhckxpbWl0YXRpb25fc3VjY2VzcygpCnsKJHNjb3BlLmRlbGV0ZUNhbGVuZGFySlNFdmVudChjYWxlbmRhciwgc2VsZWN0ZWRFdmVudC5pZCk7Cn0KfQplbHNlCnsKLy8gcmVtb3ZpbmcgZXZlbnQgbGltaXRhdGlvbiBmcm9tIHRoZSBhIHNwZWNpZmljIHdlZWsKLy8gdGhpcyBtZWFucyBhZGRpbmcgZXZlbnQgbGltaXRhdGlvbiBwZXIgZGF5IHdpdGggcmFuZ2UgZW5kPXN0YXJ0Ci8vIG1heWJlIEJVRyBCVUdHWT8KbG9nRGVidWcoInggcmVtb3ZpbmcgZXZlbnQgbGltaXRhdGlvbiBmcm9tIGEgc3BlY2lmaWMgd2VlaywgdGhpcyBtZWFucyBhZGRpbmcgZXZlbnQgbGltaXRhdGlvbiBwZXIgZGF5IHdpdGggcmFuZ2UgMC0wIik7Ci8vIGxvZ0RlYnVnKEpTT04uc3RyaW5naWZ5KHNlbGVjdGVkRXZlbnQpKTsKCnRoZWRhdGEgPSB7CnN0YXJ0X2RhdGU6IHNlbGVjdGVkRXZlbnQuc3RhcnQsCmVuZF9kYXRlOiBzZWxlY3RlZEV2ZW50LnN0YXJ0LApjb2xvcjogIiMwMDAwMDAiLAp0ZW1wX2xpbWl0X2lkOiAxLApldmVudF90eXBlX2lkOiBzZWxlY3RlZEV2ZW50LmV2ZW50X3R5cGVfaWQsCmxvY2F0aW9uX2lkOiBzZWxlY3RlZEV2ZW50LmxvY2F0aW9uX2lkLApsaW1pdF9pZDogc2VsZWN0ZWRFdmVudC5saW1pdF9pZCwKdGl0bGU6IHNlbGVjdGVkRXZlbnQudGl0bGUKfTsKCmNyZWF0ZUNhbGVuZGFyTGltaXRhdGlvblBlckRheSgkaHR0cCwkc2NvcGUsdGhlZGF0YSxjcmVhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXlfc3VjY2Vzcyk7CmZ1bmN0aW9uIGNyZWF0ZUNhbGVuZGFyTGltaXRhdGlvblBlckRheV9zdWNjZXNzKCkKewokc2NvcGUuZGVsZXRlQ2FsZW5kYXJKU0V2ZW50KGNhbGVuZGFyLCBzZWxlY3RlZEV2ZW50LmlkKTsKfQp9Cn0KZWxzZQp7Ci8vIGRlbGV0aW5nIGEgcGVyZGF5IGxpbWl0YXRpb24uCi8vIGlmIGl0J3MgYSBwZXJkYXkgdGhhdCAicmVwbGFjZWQiIGEgMTk3MCBvbmUKLy8gdGhlbiB3ZSBjYW5ub3QgZGVsZXRlIGl0IChvdGhlcndpc2UgdGhlIG9yaWdpbmFsIDE5NzAgd2lsbCByZWFwcGVhcikKLy8gc28gd2Ugc2V0IGl0IHRvIHN0YXJ0PWVuZAovLyB0aGlzIG1heWJlIGEgQlVHIGFuZCBjYXVzZSBUUk9VQkxFIC8vIFRPRE8KLy8gb3RoZXdpc2Ugd2UgY2FuIGRlbGV0ZSBpdCAtIHRoZSBwZXJkYXkgLSBhcyBpdHMgYSBuZXcgcGVyZGF5IGFuZCBub3QgInJlcGxhY2luZyIgYSAxOTcwIG9uZQoKaWYgKHNlbGVjdGVkRXZlbnQubGltaXRfaWQgIT0gbnVsbCkgLy8gdGhpcyBpcyB0aGUgcGVyZGF5IHRoYXQgcmVwbGFjZXMgYSAxOTcwIG9uZSAtIHdlIHNldCBpdCB0byBzdGFydD1lbmQKewpsb2dEZWJ1ZygicmVtb3ZpbmcgZXZlbnQgbGltaXRhdGlvbiBwZXIgZGF5IHJlbGF0ZWQgdG8gMTk3MCAodXBkYXRpbmcgaXQgdG8gc3RhcnQ9ZW5kKSIpOwoKdGhlZGF0YT0gewpzdGFydF9kYXRlOiBzZWxlY3RlZEV2ZW50LnN0YXJ0LAplbmRfZGF0ZTogc2VsZWN0ZWRFdmVudC5zdGFydCwKdGVtcF9kYXlfbGltaXRfaWQ6IHNlbGVjdGVkRXZlbnQudGVtcF9saW1pdF9pZCwKZGF5X2xpbWl0X2lkOiBzZWxlY3RlZEV2ZW50LmRheV9saW1pdF9pZAp9Owp1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXkoJGh0dHAsJHNjb3BlLHRoZWRhdGEsdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5X3N1Y2Nlcyk7CgpmdW5jdGlvbiB1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXlfc3VjY2VzKCkKewokc2NvcGUuZGVsZXRlQ2FsZW5kYXJKU0V2ZW50KGNhbGVuZGFyLCBzZWxlY3RlZEV2ZW50LmlkKTsKfQp9CmVsc2UgIC8vIHRoaXMgaXMgdGhlIGNhc2Ugd2hlcmUgdGhlIHBlcmRheSBkb2VzbnQgcmVwbGFjZSBhIDE5NzAgb25lLCB3ZSBjYW4gc2ltcGx5IGRlbGV0ZSBpdAp7CmxvZ0RlYnVnKCJyZW1vdmluZyBldmVudCBsaW1pdGF0aW9uIHBlciBkYXkgcmVsYXRlZCBub3QgcmVsYXRlZCB0byAxOTcwIChzbyB3ZSdyZSBkZWxldGluZyBpdCkiKTsKdGhlZGF0YSA9IHsKdGVtcF9saW1pdF9pZDogc2VsZWN0ZWRFdmVudC50ZW1wX2xpbWl0X2lkCn07CmRlbGV0ZUNhbGVuZGFyTGltaXRhdGlvblBlckRheSgkaHR0cCwkc2NvcGUsdGhlZGF0YSxzZWxlY3RlZEV2ZW50LmRheV9saW1pdF9pZCwgZGVsZXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5X3N1Y2Nlc3MpOwpmdW5jdGlvbiBkZWxldGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXlfc3VjY2VzcygpCnsKJHNjb3BlLmRlbGV0ZUNhbGVuZGFySlNFdmVudChjYWxlbmRhciwgc2VsZWN0ZWRFdmVudC5pZCk7Cn0KfQp9CmxvZ0RlYnVnKCJhZnRlciByZW1vdmUgZXZlbnQiKTsKCn07CgoKJHNjb3BlLnN0YXJ0TWludXRlcyA9IGZ1bmN0aW9uKCkKewpsb2dEZWJ1Zygic3RhcnRNaW51dGVzICIrKCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcykpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXM9bWludXRlc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKTsKY2FsY3VsYXRlU3RhcnRUaW1lKCk7Cn0KJHNjb3BlLnN0YXJ0SG91cnMgPSBmdW5jdGlvbigpCnsKbG9nRGVidWcoInN0YXJ0SG91cnMgIitob3Vyc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzPWhvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKTsKY2FsY3VsYXRlU3RhcnRUaW1lKCk7Cn0KJHNjb3BlLmVuZE1pbnV0ZXMgPSBmdW5jdGlvbigpCnsKbG9nRGVidWcoImVuZE1pbnV0ZXMgIisoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcykpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzPW1pbnV0ZXNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpOwpjYWxjdWxhdGVFbmRUaW1lKCk7Cn0KJHNjb3BlLmVuZEhvdXJzID0gZnVuY3Rpb24oKQp7CmxvZ0RlYnVnKCJlbmRIb3VycyAiK2hvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycykpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vycz1ob3Vyc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMpOwpjYWxjdWxhdGVFbmRUaW1lKCk7Cn0KCgpmdW5jdGlvbiBjYWxjdWxhdGVTdGFydFRpbWUoKQp7CmV2ZW50WWVhcj0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXI7CmV2ZW50TW9udGg9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aDExMjsKZXZlbnREYXk9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXlvZm1vbnRoOwppZiAocGFyc2VJbnQoZXZlbnRNb250aCk8MTApCnsKZXZlbnRNb250aD0iMCIrZXZlbnRNb250aDsKfQppZiAocGFyc2VJbnQoZXZlbnREYXkpPDEwKQp7CmV2ZW50RGF5PSIwIitldmVudERheTsKfQoKbmV3X3N0YXJ0PW1vbWVudC51dGMoZXZlbnRZZWFyKyItIitldmVudE1vbnRoKyItIitldmVudERheSsiVDAwOjAwOjAwIikuYWRkKCgocGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykqNjApK3BhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcykpLCAnbWludXRlcycpOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWU9bmV3X3N0YXJ0Owpsb2dEZWJ1ZygibmV3X3N0YXJ0PSIrbmV3X3N0YXJ0KTsKfQpmdW5jdGlvbiBjYWxjdWxhdGVFbmRUaW1lKCkKewpldmVudFllYXI9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyOwpldmVudE1vbnRoPSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bW9udGgxMTI7CmV2ZW50RGF5PSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aDsKaWYgKHBhcnNlSW50KGV2ZW50TW9udGgpPDEwKQp7CmV2ZW50TW9udGg9IjAiK2V2ZW50TW9udGg7Cn0KaWYgKHBhcnNlSW50KGV2ZW50RGF5KTwxMCkKewpldmVudERheT0iMCIrZXZlbnREYXk7Cn0KCm5ld19lbmQ9bW9tZW50LnV0YyhldmVudFllYXIrIi0iK2V2ZW50TW9udGgrIi0iK2V2ZW50RGF5KyJUMDA6MDA6MDAiKS5hZGQoKChwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycykqNjApK3BhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpKSwgJ21pbnV0ZXMnKTsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmRfdGltZT1uZXdfZW5kOwpsb2dEZWJ1ZygibmV3X2VuZD0iK25ld19lbmQpOwp9CgpjYWxjdWxhdGVTdGFydFRpbWUoKTsKY2FsY3VsYXRlRW5kVGltZSgpOwoKZnVuY3Rpb24gbWludXRlc0NoYW5nZWQodGhlbWludXRlcykKewpsb2dEZWJ1ZygidGhlbWludXRlcz0iK3RoZW1pbnV0ZXMpOwppZiAodHlwZW9mIHRoZW1pbnV0ZXM9PSJ1bmRlZmluZWQiKQp7CnJldHVybiAiMDAiOwp9CnRoZW1pbnV0ZXM9cGFyc2VJbnQodGhlbWludXRlcyk7CmlmICh0aGVtaW51dGVzPjYwKQp7CnJldHVybiAiMDAiOwp9CmVsc2UgaWYgKHRoZW1pbnV0ZXM8MCkKewpyZXR1cm4gIjAwIjsKfQplbHNlIGlmICh0aGVtaW51dGVzPT0iIikKewpyZXR1cm4gIjAwIjsKfQplbHNlIGlmICh0aGVtaW51dGVzPDEwKQp7CnJldHVybiAiMCIrdGhlbWludXRlczsKfQplbHNlCnsKcmV0dXJuIHRoZW1pbnV0ZXM7Cn0KfQpmdW5jdGlvbiBob3Vyc0NoYW5nZWQodGhlaG91cnMpCnsKbG9nRGVidWcoInRoZWhvdXJzPSIrdGhlaG91cnMpOwppZiAodHlwZW9mIHRoZWhvdXJzPT0idW5kZWZpbmVkIikKewpyZXR1cm4gIjAiOwp9CnRoZWhvdXJzPXBhcnNlSW50KHRoZWhvdXJzKTsKaWYgKHRoZWhvdXJzPjI0KQp7CnJldHVybiAwOwp9CmVsc2UgaWYgKHRoZWhvdXJzPDApCnsKcmV0dXJuIDA7Cn0KZWxzZSBpZiAodGhlaG91cnM9PSIiKQp7CnJldHVybiAiMCI7Cn0KZWxzZQp7CnJldHVybiB0aGVob3VyczsKfQp9Cgp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ0V2ZW50VHlwZXNDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGNvbXBpbGUsIHVpQ2FsZW5kYXJDb25maWcsICR1aWJNb2RhbCwkbG9jYXRpb24pIHsKbG9nRGVidWcoJ0V2ZW50VHlwZXMgQ29udHJvbGxlcicpOwoKZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzKCRodHRwLCRzY29wZSwnZXZlbnRfdHlwZXMnKTsKJHNjb3BlLnNob3dFdmVudFR5cGUgPSBmdW5jdGlvbiAodGhlRXZlbnQpCnsKJGxvY2F0aW9uLnBhdGgoJy9ldmVudF90eXBlcy8nK3RoZUV2ZW50LmV2ZW50X3R5cGVfaWQpOwp9Cn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdFdmVudFR5cGVOZXdDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGNvbXBpbGUsIHVpQ2FsZW5kYXJDb25maWcsICR1aWJNb2RhbCwgJGxvY2F0aW9uKSB7CmxvZ0RlYnVnKCdFdmVudFR5cGVzIENvbnRyb2xsZXIgTmV3Jyk7Cgokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcyA9IHt9OyAvLyB0aGVzZSBhcmUgdGhlIGNvbXBsZXRlIGRldGFpbHMgZm9yIHRoZSBuZXcgZXZlbnQgLy8KJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuaXNfY2xhc3MgPSAwOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5ibG9ja0V4dHJhVGltZSA9IGZhbHNlOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5kdXJhdGlvbl9iZWZvcmVfZXZlbnQgPSAwOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5kdXJhdGlvbl9hZnRlcl9ldmVudCA9IDA7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmluaGVyaXRfbWFpbl9ob3VycyA9IDE7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF93YWl0aW5nX2xpc3QgPSAzOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5pc191cGRhdGUgPSBmYWxzZTsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMubWF4X3BhcnRpY2lwYW50cyA9IDE7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF9yZWdpc3RyYXRpb25zPTE7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmlzX3B1YmxpYz0xOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5pbnN0cnVjdG9yX2lkPTA7Cgokc2NvcGUuZXZlbnRDb2xvclN0eWxlID0ge307CmRlZmF1bHRDb2xvciA9ICcwMGE2NWEnOwokc2NvcGUuZXZlbnRDb2xvclN0eWxlW2RlZmF1bHRDb2xvcl0gPSB7Cid0cmFuc2Zvcm0nOiAncm90YXRlKDMwZGVnKScKfTsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXZlbnRDb2xvciA9ICIjIiArIGRlZmF1bHRDb2xvcjsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMgPSBbCnsiZmllbGRfbmFtZSI6Iteh15nXm9eV150g157XpNeS16kiLCJmaWVsZF9kYXRhdHlwZSI6IlRFWFRfQVJFQSIsImlzX21hbmRhdG9yeSI6MCwgImZyb21kYiI6IGZhbHNlLCAiZGJfaWRfdG9maXgiOiAwLCAiaXNfYWN0aXZlIjogMSwgIm1vZGlmaWVkIjogZmFsc2V9LAp7ImZpZWxkX25hbWUiOiLXqdeZ16LXldeo15kg15HXmdeqIiwiZmllbGRfZGF0YXR5cGUiOiJURVhUX0FSRUEiLCJpc19tYW5kYXRvcnkiOjAsICJmcm9tZGIiOiBmYWxzZSwgImRiX2lkX3RvZml4IjogMCwgImlzX2FjdGl2ZSI6IDEsICJtb2RpZmllZCI6IGZhbHNlfQpdOwoKZ2V0QWxsSW5zdHJ1Y3RvcnMoJGh0dHAsJHNjb3BlLCdpbnN0cnVjdG9ycycsZ2V0QWxsSW5zdHJ1Y3RvcnNfc3VjY2Vzcyk7CmZ1bmN0aW9uIGdldEFsbEluc3RydWN0b3JzX3N1Y2Nlc3MoKQp7Ci8vICRzY29wZS5pbnN0cnVjdG9ycy51bnNoaWZ0KHtidXNpbmVzc191c2VyX2lkOjAsIGJ1c2VyX2ZpcnN0X25hbWU6IiIsIGJ1c2VyX2xhc3RfbmFtZToiIn0pOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5pbnN0cnVjdG9yX2lkPSRzY29wZS5pbnN0cnVjdG9yc1swXS5idXNpbmVzc191c2VyX2lkOwp9Cgokc2NvcGUuZXZlbnRUeXBlRXh0cmFGaWVsZHNQb3AgPSBmdW5jdGlvbihldmVudFR5cGVQcm9wZXJ0aWVzKSB7CiAgICAgICAgbG9nRGVidWcoImV2ZW50VHlwZUV4dHJhRmllbGRzUG9wMSIpOwoKdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CmFuaW1hdGlvbjogZmFsc2UsCnRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2V2ZW50X3R5cGVfZXh0cmFfZmllbGRzLnBocCcsCmNvbnRyb2xsZXI6ICdldmVudFR5cGVFeHRyYUZpZWxkc01vZGFsQ29udHJvbGxlcicsCnNpemU6ICdsJywKcmVzb2x2ZTogewpldmVudFR5cGVQcm9wZXJ0aWVzOiBmdW5jdGlvbigpIHsKcmV0dXJuIGV2ZW50VHlwZVByb3BlcnRpZXM7Cn0KfQp9KTsKCm1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24oc2VsZWN0ZWRJdGVtKSB7CmxvZ0RlYnVnKHNlbGVjdGVkSXRlbSk7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzID0gc2VsZWN0ZWRJdGVtOwp9LCBmdW5jdGlvbigpIHsKbG9nRGVidWcoJ01vZGFsIGRpc21pc3NlZCBhdDogJyArIG5ldyBEYXRlKCkpOwp9KTsKfTsKCiRzY29wZS5jaGFuZ2VFdmVudENvbG9yID0gZnVuY3Rpb24obmV3Q29sb3IpIHsKbG9nRGVidWcoImNob29zaW5nIGNvbG9yICIgKyBuZXdDb2xvcik7CiRzY29wZS5ldmVudENvbG9yID0gbmV3Q29sb3I7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV2ZW50Q29sb3IgPSAiIyIgKyBuZXdDb2xvcjsKJHNjb3BlLmV2ZW50Q29sb3JTdHlsZSA9IHsKJ2JhY2tncm91bmQtY29sb3InOiAiIyIgKyBuZXdDb2xvcgp9Owokc2NvcGUuZXZlbnRDb2xvclN0eWxlW25ld0NvbG9yXSA9IHsKJ3RyYW5zZm9ybSc6ICdyb3RhdGUoMzBkZWcpJwp9OwoKfQoKJHNjb3BlLmFkZEV2ZW50VHlwZUNhbmNlbCA9IGZ1bmN0aW9uKCkgewokbG9jYXRpb24ucGF0aCgnL2V2ZW50X3R5cGVzJyk7Cn07CgogICAgJHNjb3BlLmR1cGxpY2F0ZUZpZWxkTmFtZXM9IiI7CiRzY29wZS5hZGRFdmVudFR5cGUgPSBmdW5jdGlvbigpIHsKICAgICAgICAvLyBjaGVjayBleHRyYSBmaWVsZHMgZHVwbGljYXRlIG5hbWVzIC0gc3RhcnQKICAgICAgICBsb2dEZWJ1ZygiYWRkRXZlbnRUeXBlOiBjaGVjayBleHRyYSBmaWVsZHMgZHVwbGljYXRlIG5hbWVzIC0gc3RhcnQiKTsKICAgICAgICB2YXIgZXh0cmFGaWVsZHNOYW1lcyA9IFtdOwogICAgICAgIGZvciAodmFyIGk9MTsgaTwkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcy5sZW5ndGg7IGkrKykKICAgICAgICB7CiAgICAgICAgICBleHRyYUZpZWxkc05hbWVzLnB1c2goJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHNbaV0uZmllbGRfbmFtZSk7CiAgICAgICAgfQogICAgICAgIGV4dHJhRmllbGRzTmFtZXMuc29ydCgpOwogICAgICAgIHZhciBsYXN0ID0gZXh0cmFGaWVsZHNOYW1lc1swXTsKICAgICAgICBmb3IgKHZhciBpPTE7IGk8ZXh0cmFGaWVsZHNOYW1lcy5sZW5ndGg7IGkrKykKICAgICAgICB7CiAgICAgICAgICAgaWYgKGV4dHJhRmllbGRzTmFtZXNbaV0gPT0gbGFzdCkKICAgICAgICAgICB7CiAgICAgICAgICAgIC8vICBhbGVydCgnRHVwbGljYXRlIDogJytsYXN0KTsKICAgICAgICAgICAgICRzY29wZS5kdXBsaWNhdGVGaWVsZE5hbWVzPSfXp9eZ15nXnSDXqdeT15Qg16rXmdei15XXkyDXqNek15XXkNeZINeb16TXldecINeR16nXnSAiJytsYXN0KyciLi4uJzsKICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICB9CiAgICAgICAgICAgbGFzdCA9IGV4dHJhRmllbGRzTmFtZXNbaV07CiAgICAgICAgfQogICAgICAgIC8vIGNoZWNrIGV4dHJhIGZpZWxkcyBkdXBsaWNhdGUgbmFtZXMgLSBlbmQKCmxvZ0RlYnVnKCJhZGQgRXZlbnQgVHlwZSIgKyAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcyArICJleHRyYSBmaWVsZHM9IiArJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMpOwppZiAoKCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF9yZWdpc3RyYXRpb25zPT0nJykgfHwgKCEkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5tYXhfcmVnaXN0cmF0aW9ucykpCnsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMubWF4X3JlZ2lzdHJhdGlvbnM9MDsKfQphZGRFdmVudFR5cGUoJGh0dHAsJHNjb3BlLCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLGFkZEV2ZW50VHlwZV9zdWNjZXNzKTsKZnVuY3Rpb24gYWRkRXZlbnRUeXBlX3N1Y2Nlc3MoKQp7CiRsb2NhdGlvbi5wYXRoKCcvZXZlbnRfdHlwZXMnKTsKfQp9Owp9KTsKCmt1emVBcHAuY29udHJvbGxlcignRXZlbnRUeXBlVXBkYXRlQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRjb21waWxlLCAkcm91dGVQYXJhbXMsIHVpQ2FsZW5kYXJDb25maWcsICR1aWJNb2RhbCwgJGxvY2F0aW9uKSB7CmV2ZW50X3R5cGVfaWQ9JHJvdXRlUGFyYW1zLmV2ZW50X3R5cGVfaWQ7CmxvZ0RlYnVnKCdFdmVudFR5cGVzIENvbnRyb2xsZXIgVXBkYXRlICcrZXZlbnRfdHlwZV9pZCk7Cgokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcyA9IHt9OyAvLyB0aGVzZSBhcmUgdGhlIGNvbXBsZXRlIGRldGFpbHMgZm9yIHRoZSBuZXcgZXZlbnQgLy8KJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuaXNfdXBkYXRlID0gdHJ1ZTsKCiRzY29wZS5ldmVudENvbG9yU3R5bGUgPSB7fTsKZ2V0QWxsSW5zdHJ1Y3RvcnMoJGh0dHAsJHNjb3BlLCdpbnN0cnVjdG9ycycsZ2V0QWxsSW5zdHJ1Y3RvcnNfc3VjY2Vzcyk7CmZ1bmN0aW9uIGdldEFsbEluc3RydWN0b3JzX3N1Y2Nlc3MoKQp7CiRzY29wZS5pbnN0cnVjdG9ycy51bnNoaWZ0KHtidXNpbmVzc191c2VyX2lkOm51bGwsIGJ1c2VyX2ZpcnN0X25hbWU6IiIsIGJ1c2VyX2xhc3RfbmFtZToiIn0pOwp9CgpnZXRCdXNpbmVzc0V2ZW50VHlwZSgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmV2ZW50X3R5cGVfaWQsJ2V2ZW50VHlwZVByb3BlcnRpZXMnLGdldEJ1c2luZXNzRXZlbnRUeXBlX3N1Y2Nlc3MpOwoKZnVuY3Rpb24gZ2V0QnVzaW5lc3NFdmVudFR5cGVfc3VjY2VzcygpCnsKaWYgKCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF9yZWdpc3RyYXRpb25zPT1udWxsKQp7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF9yZWdpc3RyYXRpb25zPTE7Cn0KaWYgKCgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5kdXJhdGlvbl9iZWZvcmVfZXZlbnQ+MCkgfCAoJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZHVyYXRpb25fYWZ0ZXJfZXZlbnQ+MCkpCnsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuYmxvY2tFeHRyYVRpbWUgPSAxOwp9CmVsc2UKewokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5ibG9ja0V4dHJhVGltZSA9IDA7Cn0KLy8gJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuaW5oZXJpdF9tYWluX2hvdXJzID0gcmVzcG9uc2UuZGF0YVswXS5pbmhlcml0X21haW5faG91cnM7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmlzX3VwZGF0ZSA9IHRydWU7CmxvZ0RlYnVnKCIkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5jb2xvcj0iKyRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmNvbG9yKTsKJHNjb3BlLmV2ZW50Q29sb3JTdHlsZVskc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5jb2xvcl0gPSB7Cid0cmFuc2Zvcm0nOiAncm90YXRlKDMwZGVnKScKfTsKJHNjb3BlLmNoYW5nZUV2ZW50Q29sb3IoKCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmNvbG9yKS5zdWJzdHIoMSkpOwpsb2dEZWJ1ZygiJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuaW5zdHJ1Y3Rvcl9pZD0iKyRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmluc3RydWN0b3JfaWQpOwovLyBzYXZpbmcgZXZlbnQgdHlwZSBkZXRhaWxzIGFzaWRlIHRvIGxhdGVyIGNoZWNrIGlmIGFueXRoaW5nIGNoYW5nZWQKbG9nRGVidWcoImR1cGxpY2F0aW5nIG9iamVjdCBvZiBldmVudCB0eXBlIHRvIGxhdGVyIGNvbXBhcmUgIit0eXBlb2YgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMpOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllc0R1cGxpY2F0ZSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMpKTsKbG9nRGVidWcoIiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzRHVwbGljYXRlID0iKyRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzRHVwbGljYXRlLmV2ZW50X3R5cGVfbmFtZSk7Cn07CgovLyBldmVudCB0eXBlIGNoYW5nZWQgcG9wdXAKJHNjb3BlLmV2ZW50VHlwZUNoYW5nZWRQb3B1cCA9IGZ1bmN0aW9uKGV2ZW50VHlwZVByb3BlcnRpZXMpIHsKICAgICAgICBsb2dEZWJ1ZygiZXZlbnRUeXBlQ2hhbmdlZFBvcHVwIik7Cgp2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKYW5pbWF0aW9uOiBmYWxzZSwKdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfZXZlbnRfdHlwZV9jaGFuZ2VkLnBocCcsCmNvbnRyb2xsZXI6ICdldmVudFR5cGVDaGFuZ2VkUG9wdXBDb250cm9sbGVyJywKc2l6ZTogJ2wnLApyZXNvbHZlOiB7CmV2ZW50VHlwZVByb3BlcnRpZXM6IGZ1bmN0aW9uKCkgewpyZXR1cm4gJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXM7Cn0KfQp9KTsKCm1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24oc2VsZWN0ZWRJdGVtKQp7CmxvZ0RlYnVnKHNlbGVjdGVkSXRlbSk7CiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzID0gc2VsZWN0ZWRJdGVtOwp9LCBmdW5jdGlvbigpIHsKbG9nRGVidWcoJ01vZGFsIGRpc21pc3NlZCBhdDogJyArIG5ldyBEYXRlKCkpOwp9KTsKfTsKCi8vIGV2ZW50IHR5cGUgZXh0cmEgZmllbGQgcG9wdXAKJHNjb3BlLmV2ZW50VHlwZUV4dHJhRmllbGRzUG9wID0gZnVuY3Rpb24oZXZlbnRUeXBlUHJvcGVydGllcykgewogICAgICAgIGxvZ0RlYnVnKCJldmVudFR5cGVFeHRyYUZpZWxkc1BvcDIiKTsKCnZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewphbmltYXRpb246IGZhbHNlLAp0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9ldmVudF90eXBlX2V4dHJhX2ZpZWxkcy5waHAnLApjb250cm9sbGVyOiAnZXZlbnRUeXBlRXh0cmFGaWVsZHNNb2RhbENvbnRyb2xsZXInLApzaXplOiAnbCcsCnJlc29sdmU6IHsKZXZlbnRUeXBlUHJvcGVydGllczogZnVuY3Rpb24oKSB7CnJldHVybiBldmVudFR5cGVQcm9wZXJ0aWVzOwp9Cn0KfSk7Cgptb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHNlbGVjdGVkSXRlbSkgewpsb2dEZWJ1ZyhzZWxlY3RlZEl0ZW0pOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyA9IHNlbGVjdGVkSXRlbTsKfSwgZnVuY3Rpb24oKSB7CmxvZ0RlYnVnKCdNb2RhbCBkaXNtaXNzZWQgYXQ6ICcgKyBuZXcgRGF0ZSgpKTsKfSk7Cn07CgoKJHNjb3BlLmNoYW5nZUV2ZW50Q29sb3IgPSBmdW5jdGlvbihuZXdDb2xvcikgewpsb2dEZWJ1ZygiY2hvb3NpbmcgY29sb3IgIiArIG5ld0NvbG9yKTsKJHNjb3BlLmV2ZW50Q29sb3IgPSBuZXdDb2xvcjsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXZlbnRDb2xvciA9ICIjIiArIG5ld0NvbG9yOwokc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5jb2xvciA9ICIjIiArIG5ld0NvbG9yOwokc2NvcGUuZXZlbnRDb2xvclN0eWxlID0gewonYmFja2dyb3VuZC1jb2xvcic6ICIjIiArIG5ld0NvbG9yCn07CiRzY29wZS5ldmVudENvbG9yU3R5bGVbbmV3Q29sb3JdID0gewondHJhbnNmb3JtJzogJ3JvdGF0ZSgzMGRlZyknCn07Cgp9Cgokc2NvcGUuYWRkRXZlbnRUeXBlQ2FuY2VsID0gZnVuY3Rpb24oKSB7CiRsb2NhdGlvbi5wYXRoKCcvZXZlbnRfdHlwZXMnKTsKfTsKCiRzY29wZS5hZGRFdmVudFR5cGUgPSBmdW5jdGlvbigpIHsgLy8gdGhpcyBmdW5jdGlvbiBVUERBVEVTIGV2ZW50IHR5cGUgKG5vdCBhZGRzKQovLyBjaGVja2luZyBpZiBhbnl0aGluZyBjaGFuZ2VkIHJlYWxseQovLyBhbmQgYXNraW5nIGlmIHdlIHNob3VsZCB1cGRhdGUgYWxsIGV2ZW50cyBmcm9tIG5vdyAob3Igb25seSBuZXdseSBjcmVhdGVkIGV2ZW50cykKLy8gY2hlY2tpbmcKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXNEdXBsaWNhdGUuZXh0cmFGaWVsZHM9JHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHM7CiAgICAgIC8vIGlmIChhbmd1bGFyLmVxdWFscygkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllc0R1cGxpY2F0ZSwkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcykpCiAgICAgIGlmICh0cnVlKSAvLyBpZ25vcmluZyB0cnlpbmcgdG8gbWFrZSBjaGFuZ2VzIHRvIGV2ZW50cwp7Ci8vICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzRHVwbGljYXRlLmV4dHJhRmllbGRzID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcykpOwoKbG9nRGVidWcoIm5vdGhpbmcgY2hhbmdlZCBpbiBldmVudCB0eXBlLCBvciBvbmx5IGV4dHJhIGZpZWxkcyIpOwokc2NvcGUudXBkYXRlRXZlbnRUeXBlKCk7Cn0KZWxzZQp7CmxvZ0RlYnVnKCJldmVudCB0eXBlIGNoYW5nZWQiKTsKJHNjb3BlLmV2ZW50VHlwZUNoYW5nZWRQb3B1cCgpOwp9Ci8vICRzY29wZS51cGRhdGVFdmVudFR5cGUoKTsKfQokc2NvcGUudXBkYXRlRXZlbnRUeXBlID0gZnVuY3Rpb24oKQp7CiAgICAgIC8vIGNoZWNrIGV4dHJhIGZpZWxkcyBkdXBsaWNhdGUgbmFtZXMgLSBzdGFydAogICAgICBsb2dEZWJ1ZygiYWRkRXZlbnRUeXBlOiBjaGVjayBleHRyYSBmaWVsZHMgZHVwbGljYXRlIG5hbWVzIC0gc3RhcnQiKTsKICAgICAgdmFyIGV4dHJhRmllbGRzTmFtZXMgPSBbXTsKICAgICAgZm9yICh2YXIgaT0xOyBpPCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzLmxlbmd0aDsgaSsrKQogICAgICB7CiAgICAgICAgZXh0cmFGaWVsZHNOYW1lcy5wdXNoKCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzW2ldLmZpZWxkX25hbWUpOwogICAgICB9CiAgICAgIGV4dHJhRmllbGRzTmFtZXMuc29ydCgpOwogICAgICB2YXIgbGFzdCA9IGV4dHJhRmllbGRzTmFtZXNbMF07CiAgICAgIGZvciAodmFyIGk9MTsgaTxleHRyYUZpZWxkc05hbWVzLmxlbmd0aDsgaSsrKQogICAgICB7CiAgICAgICAgIGlmIChleHRyYUZpZWxkc05hbWVzW2ldID09IGxhc3QpCiAgICAgICAgIHsKICAgICAgICAgIC8vICBhbGVydCgnRHVwbGljYXRlIDogJytsYXN0KTsKICAgICAgICAgICAgbG9nRGVidWcoJ9en15nXmdedINep15PXlCDXqteZ16LXldeTINeo16TXldeQ15kg15vXpNeV15wg15HXqdedICInK2xhc3QrJyIuLi4nKTsKICAgICAgICAgICAkc2NvcGUuZHVwbGljYXRlRmllbGROYW1lcz0n16fXmdeZ150g16nXk9eUINeq15nXoteV15Mg16jXpNeV15DXmSDXm9ek15XXnCDXkdep150gIicrbGFzdCsnIi4uLic7CiAgICAgICAgICAgcmV0dXJuOwogICAgICAgICB9CiAgICAgICAgIGxhc3QgPSBleHRyYUZpZWxkc05hbWVzW2ldOwogICAgICB9CiAgICAgIC8vIGNoZWNrIGV4dHJhIGZpZWxkcyBkdXBsaWNhdGUgbmFtZXMgLSBlbmQKCiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLnVwZGF0ZV9leGlzdGluZ19ldmVudHM9ZmFsc2U7CgogICAgICBsb2dEZWJ1ZygidXBkYXRlRXZlbnRUeXBlOiB1cGRhdGUgRXZlbnQgVHlwZSAiICsgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXZlbnRfdHlwZV9pZCk7CmlmICgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5tYXhfcmVnaXN0cmF0aW9ucz09JycpCnsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMubWF4X3JlZ2lzdHJhdGlvbnM9MDsKfQp1cGRhdGVFdmVudFR5cGUoJGh0dHAsJHNjb3BlLCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV2ZW50X3R5cGVfaWQsJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMsdXBkYXRlRXZlbnRUeXBlX3N1Y2Nlc3MpOwpmdW5jdGlvbiB1cGRhdGVFdmVudFR5cGVfc3VjY2VzcygpCnsKJGxvY2F0aW9uLnBhdGgoJy9ldmVudF90eXBlcycpOwp9Cn0KfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdldmVudENyZWF0ZU1vZGFsQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRyb290U2NvcGUsIHNoYXJlZFByb3BlcnRpZXMsIGV2ZW50X3R5cGVfaWQsIGxvY2F0aW9uX2lkLCBlbXBfaWQsICRodHRwLCBzdGFydERhdGUsIHJlc2NoZWR1bGVfZXZlbnQsIHVpQ2FsZW5kYXJDb25maWcpIHsKc3RhcnREYXRlPW5ldyBtb21lbnQoc3RhcnREYXRlKTsKbG9nRGVidWcoImV2ZW50Q3JlYXRlTW9kYWxDb250cm9sbGVyLCBzdGFydERhdGU9IitzdGFydERhdGUrIiB0eXBlICIrdHlwZW9mIHN0YXJ0RGF0ZSk7CmxvZ0RlYnVnKCJldmVudENyZWF0ZU1vZGFsQ29udHJvbGxlciwgcmVzY2hlZHVsZV9ldmVudD0iK3Jlc2NoZWR1bGVfZXZlbnQpOwoKJHNjb3BlLmV2ZW50VHlwZVRpdGxlID0gIteR15fXqCDXodeV15Ig157XpNeS16kiOwokc2NvcGUuc2hvd0V2ZW50VHlwZVNlbGVjdGVkID0gZmFsc2U7CiRzY29wZS5zaG93RXZlbnRDbGllbnRTZWxlY3RlZCA9IGZhbHNlOwokc2NvcGUubmV3RXZlbnREZXRhaWxzID0ge307IC8vIHRoZXNlIGFyZSB0aGUgY29tcGxldGUgZGV0YWlscyBmb3IgdGhlIG5ldyBldmVudCAvLwokc2NvcGUubmV3RXZlbnREZXRhaWxzLnJlcGVhdFR5cGUgPSAiZm9yZXZlciI7CiRzY29wZS5uZXdFdmVudERldGFpbHMucmVwZWF0Rml4ZWRUaW1lcyA9ICI0IjsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5tYXhfcGFydGljaXBhbnRzID0gMTsKCmxvZ0RlYnVnKCJYWFggPSAiK0pTT04uc3RyaW5naWZ5KHJlc2NoZWR1bGVfZXZlbnQpKTsKCiRzY29wZS5yZXNjaGVkdWxlX2V2ZW50PWZhbHNlOwokc2NvcGUucmVzY2hlZHVsZV9ldmVudF9kZXRhaWxzPXJlc2NoZWR1bGVfZXZlbnQ7CmlmICgkc2NvcGUucmVzY2hlZHVsZV9ldmVudF9kZXRhaWxzIT1udWxsKQp7CmxvZ0RlYnVnKCJyZXNjaGVkdWxlX2V2ZW50X2RldGFpbHM9Iiskc2NvcGUucmVzY2hlZHVsZV9ldmVudF9kZXRhaWxzLmV2ZW50X2lkKTsKbG9nRGVidWcoSlNPTi5zdHJpbmdpZnkoJHNjb3BlLnJlc2NoZWR1bGVfZXZlbnRfZGV0YWlscykpOwokc2NvcGUucmVzY2hlZHVsZV9ldmVudD10cnVlOwokc2NvcGUuZ2l2ZW5fZXZlbnRfdHlwZV9pZCA9ICRzY29wZS5yZXNjaGVkdWxlX2V2ZW50X2RldGFpbHMuZXZlbnRfdHlwZV9pZDsKLy8gc3RpbGwgcHJlZmVyaW5nIGVtcF9pZCBmcm9tIHNjaGVkdWxlciBzdWdnZXN0aW9uIGlzIGl0IHdhcyBzZWxlY3RlZAppZiAoZW1wX2lkIT0wKQp7CiRzY29wZS5naXZlbl9lbXBfaWQgPSBlbXBfaWQ7Cn0KZWxzZQp7CiRzY29wZS5naXZlbl9lbXBfaWQgPSAkc2NvcGUucmVzY2hlZHVsZV9ldmVudF9kZXRhaWxzLmluc3RydWN0b3JfaWQ7Cn0KLy8gc3RpbGwgcHJlZmVyaW5nIGxvY2F0aW9uX2lkIGZyb20gc2NoZWR1bGVyIHN1Z2dlc3Rpb24gb3ZlciB0aGUgb3JpZ2luYWwgbG9jYXRpb24gZnJvbSBldmVudAppZiAobG9jYXRpb25faWQhPTApCnsKJHNjb3BlLmdpdmVuX2xvY2F0aW9uX2lkID0gbG9jYXRpb25faWQ7Cn0KZWxzZQp7CiRzY29wZS5naXZlbl9sb2NhdGlvbl9pZCA9ICRzY29wZS5yZXNjaGVkdWxlX2V2ZW50X2RldGFpbHMubG9jYXRpb25faWQ7Cn0KfQplbHNlCnsKJHNjb3BlLmdpdmVuX2V2ZW50X3R5cGVfaWQgPSBldmVudF90eXBlX2lkOwokc2NvcGUuZ2l2ZW5fbG9jYXRpb25faWQgPSBsb2NhdGlvbl9pZDsKJHNjb3BlLmdpdmVuX2VtcF9pZCA9IGVtcF9pZDsKfQppZiAoJHNjb3BlLmdpdmVuX2V2ZW50X3R5cGVfaWQ+MCkKewokc2NvcGUucHJldmlvdXNseV9zZWxlY3RlZF9ldmVudF90eXBlPXRydWU7Cn0KZWxzZQp7CiRzY29wZS5wcmV2aW91c2x5X3NlbGVjdGVkX2V2ZW50X3R5cGU9ZmFsc2U7Cn0KbG9nRGVidWcoIiRzY29wZS5naXZlbl9ldmVudF90eXBlX2lkPSIrJHNjb3BlLmdpdmVuX2V2ZW50X3R5cGVfaWQpOwoKc2VsZWN0ZWREYXRlU3RhcnQgPSBuZXcgRGF0ZShzdGFydERhdGUpOwpsb2dEZWJ1Zygic2VsZWN0ZWREYXRlU3RhcnQgPSAiK3NlbGVjdGVkRGF0ZVN0YXJ0KTsKdmFyIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZSgpICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKCi8vIGxvZ0RlYnVnKCJkYXRlPSIgKyBzZWxlY3RlZERhdGVTdGFydCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50ID0gW107CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRIb3VycygpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBzZWxlY3RlZERhdGVTdGFydC5nZXRNaW51dGVzKCk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZG93ID0gZGF5TmFtZXNbc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RGF5KCldOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRhdGUgPSBzZWxlY3RlZERhdGVTdGFydDsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aCA9IG1vbnRoTmFtZXNbc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TW9udGgoKV07CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bW9udGgxMTIgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRNb250aCgpKzE7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aCA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldERhdGUoKTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RnVsbFllYXIoKTsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5zdGFydF90aW1lX2lucHV0X2Zvcm1hdD0gbmV3IERhdGUoMTk3MCwgMCwgMSwgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycywgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzLCAwKTsKCiRzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZCA9ICRzY29wZS5naXZlbl9lbXBfaWQ7CiRzY29wZS5uZXdFdmVudERldGFpbHMubG9jYXRpb25faWQgPSAkc2NvcGUuZ2l2ZW5fbG9jYXRpb25faWQ7CgpnZXRCdXNpbmVzc0xvY2F0aW9ucygkaHR0cCwkc2NvcGUsJ2J1c2luZXNzX2xvY2F0aW9ucycsZ2V0QnVzaW5lc3NMb2NhdGlvbnNfZmluaXNoKTsKZnVuY3Rpb24gZ2V0QnVzaW5lc3NMb2NhdGlvbnNfZmluaXNoKCkKewppZiAoJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5sb2NhdGlvbl9pZD09MCkKewokc2NvcGUubmV3RXZlbnREZXRhaWxzLmxvY2F0aW9uX2lkPSRzY29wZS5idXNpbmVzc19sb2NhdGlvbnNbMF0ubG9jYXRpb25faWQ7Cn0KfQoKY29uc29sZS5sb2coIiRzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZD0iKyRzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZCk7Ci8vIGlmIGNsaWVudCB3YXMgcHJldmlvdXNseSBzZWxlY3RlZAokc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcj1mYWxzZTsKbG9nRGVidWcoInNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXI9IitzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKTsKaWYgKHNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKSE9bnVsbCkKewovLyBjb25zb2xlLmxvZygiZ290IHByZXZpb3VzIHNlbGVjdGVkIHVzZXIgIitzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfZmlyc3RfbmFtZSk7CiRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VybmFtZT1zaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfZmlyc3RfbmFtZSsiICIrc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2VyX2xhc3RfbmFtZTsKJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXI9dHJ1ZTsKCiRzY29wZS5zaG93RXZlbnRDbGllbnRTZWxlY3RlZCA9IHRydWU7CiRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kdXNlcl9pZCA9IHNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKS5idXNpbmVzc191c2VyX2lkOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZHVzZXJfZmlyc3RfbmFtZSA9IHNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKS5idXNlcl9maXJzdF9uYW1lOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZHVzZXJfbGFzdF9uYW1lID0gc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2VyX2xhc3RfbmFtZTsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5idXNpbmVzc191c2VyX2lkID0gc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2luZXNzX3VzZXJfaWQ7Cgp9CiRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZSA9IHN0YXJ0RGF0ZTsKbG9nRGVidWcoIiRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZTE9Iiskc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWUpOwokc2NvcGUuc3RhcnRNaW51dGVzID0gZnVuY3Rpb24oKQp7CmxvZ0RlYnVnKCJzdGFydE1pbnV0ZXMgIisoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKSk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcz1taW51dGVzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpOwpjYWxjdWxhdGVTdGFydFRpbWUoKTsKY2FsY3VsYXRlRW5kVGltZUR5bmFtaWMoKTsKfQokc2NvcGUuc3RhcnRIb3VycyA9IGZ1bmN0aW9uKCkKewpsb2dEZWJ1Zygic3RhcnRIb3VycyAiK2hvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKSk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnM9aG91cnNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMpOwpjYWxjdWxhdGVTdGFydFRpbWUoKTsKY2FsY3VsYXRlRW5kVGltZUR5bmFtaWMoKTsKfQoKJHNjb3BlLmVuZE1pbnV0ZXMgPSBmdW5jdGlvbigpCnsKbG9nRGVidWcoImVuZE1pbnV0ZXMgIisoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcykpOwokc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzPW1pbnV0ZXNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpOwpjYWxjdWxhdGVTdGFydFRpbWUoKTsKY2FsY3VsYXRlRW5kVGltZUR5bmFtaWMoKTsKfQokc2NvcGUuZW5kSG91cnMgPSBmdW5jdGlvbigpCnsKbG9nRGVidWcoImVuZEhvdXJzICIraG91cnNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzKSk7CiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzPWhvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vycyk7CmNhbGN1bGF0ZVN0YXJ0VGltZSgpOwpjYWxjdWxhdGVFbmRUaW1lRHluYW1pYygpOwp9CgpmdW5jdGlvbiBjYWxjdWxhdGVTdGFydFRpbWUoKQp7CmV2ZW50WWVhcj0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXI7CmV2ZW50TW9udGg9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aDExMjsKZXZlbnREYXk9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXlvZm1vbnRoOwppZiAocGFyc2VJbnQoZXZlbnRNb250aCk8MTApCnsKZXZlbnRNb250aD0iMCIrZXZlbnRNb250aDsKfQppZiAocGFyc2VJbnQoZXZlbnREYXkpPDEwKQp7CmV2ZW50RGF5PSIwIitldmVudERheTsKfQpsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyPSIrZXZlbnRZZWFyKTsKbG9nRGVidWcoIiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aD0iK2V2ZW50TW9udGgpOwpsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aD0iK2V2ZW50RGF5KTsKbmV3X3N0YXJ0PW1vbWVudC51dGMoZXZlbnRZZWFyKyItIitldmVudE1vbnRoKyItIitldmVudERheSsiVDAwOjAwOjAwIikuYWRkKCgocGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykqNjApK3BhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcykpLCAnbWludXRlcycpOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWU9bmV3X3N0YXJ0Owpsb2dEZWJ1ZygibmV3X3N0YXJ0PSIrbmV3X3N0YXJ0KTsKfQpmdW5jdGlvbiBtaW51dGVzQ2hhbmdlZCh0aGVtaW51dGVzKQp7CmxvZ0RlYnVnKCJ0aGVtaW51dGVzPSIrdGhlbWludXRlcyk7CmlmICh0eXBlb2YgdGhlbWludXRlcz09InVuZGVmaW5lZCIpCnsKcmV0dXJuICIwMCI7Cn0KaWYgKGlzTmFOKHRoZW1pbnV0ZXMpKQp7CnJldHVybiAiMDAiOwp9CmlmICh0aGVtaW51dGVzPT0nJykKewpyZXR1cm4gIjAwIjsKfQp0aGVtaW51dGVzPXBhcnNlSW50KHRoZW1pbnV0ZXMpOwppZiAodGhlbWludXRlcz42MCkKewpyZXR1cm4gIjAwIjsKfQplbHNlIGlmICh0aGVtaW51dGVzPDApCnsKcmV0dXJuICIwMCI7Cn0KZWxzZSBpZiAodGhlbWludXRlcz09IiIpCnsKcmV0dXJuICIwMCI7Cn0KZWxzZSBpZiAodGhlbWludXRlczwxMCkKewpyZXR1cm4gIjAiK3RoZW1pbnV0ZXM7Cn0KZWxzZQp7CnJldHVybiB0aGVtaW51dGVzOwp9Cn0KZnVuY3Rpb24gaG91cnNDaGFuZ2VkKHRoZWhvdXJzKQp7CmxvZ0RlYnVnKCJ0aGVob3Vycz0iK3RoZWhvdXJzKTsKaWYgKHR5cGVvZiB0aGVob3Vycz09InVuZGVmaW5lZCIpCnsKcmV0dXJuICIwIjsKfQppZiAoaXNOYU4odGhlaG91cnMpKQp7CnJldHVybiAiMCI7Cn0KaWYgKHRoZWhvdXJzPT0nJykKewpyZXR1cm4gIjAiOwp9CnRoZWhvdXJzPXBhcnNlSW50KHRoZWhvdXJzKTsKaWYgKHRoZWhvdXJzPjI0KQp7CnJldHVybiAwOwp9CmVsc2UgaWYgKHRoZWhvdXJzPDApCnsKcmV0dXJuIDA7Cn0KZWxzZSBpZiAodGhlaG91cnM9PSIiKQp7CnJldHVybiAiMCI7Cn0KZWxzZQp7CnJldHVybiB0aGVob3VyczsKfQp9CmdldEFsbEluc3RydWN0b3JzKCRodHRwLCRzY29wZSwnaW5zdHJ1Y3RvcnMnLGdldEFsbEluc3RydWN0b3JzX3N1Y2Nlc3MpOwpmdW5jdGlvbiBnZXRBbGxJbnN0cnVjdG9yc19zdWNjZXNzKCkKewovLyAkc2NvcGUuaW5zdHJ1Y3RvcnMudW5zaGlmdCh7YnVzaW5lc3NfdXNlcl9pZDpudWxsLCBidXNlcl9maXJzdF9uYW1lOiIiLCBidXNlcl9sYXN0X25hbWU6IiJ9KTsKaWYgKCEkc2NvcGUubmV3RXZlbnREZXRhaWxzLmluc3RydWN0b3JfaWQ+MCkKewokc2NvcGUubmV3RXZlbnREZXRhaWxzLmluc3RydWN0b3JfaWQ9JHNjb3BlLmluc3RydWN0b3JzWzBdLmJ1c2luZXNzX3VzZXJfaWQ7Cn0KfQoKJHNjb3BlLnNlbGVjdEV2ZW50VHlwZSA9IGZ1bmN0aW9uKCkgewovLyByZW1vdmluZyBldmVudCB0eXBlINeR15fXqCDXodeV15Ig157XpNeS16kKaWYgKCRzY29wZS5ldmVudFR5cGVPcHRpb25zWzBdLmV2ZW50X3R5cGVfaWQ9PTApCnsKJHNjb3BlLmV2ZW50VHlwZU9wdGlvbnMuc3BsaWNlKDAsIDEpOwp9CiRzY29wZS5hamF4X2Vycm9yPScnOwpjaG9pY2U9JHNjb3BlLnNlbGVjdEV2ZW50VHlwZVNlbGVjdGVkOwpsb2dEZWJ1Zygic2VsZWN0RXZlbnRUeXBlIik7CmxvZ0RlYnVnKEpTT04uc3RyaW5naWZ5KCRzY29wZS5zZWxlY3RFdmVudFR5cGVTZWxlY3RlZCkpOwokc2NvcGUuZXZlbnRUeXBlVGl0bGUgPSBjaG9pY2UuZXZlbnRfdHlwZV9uYW1lOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLmV2ZW50X3R5cGVfaWQgPSBjaG9pY2UuZXZlbnRfdHlwZV9pZDsKCiRzY29wZS5uZXdFdmVudERldGFpbHMuZXZlbnRfbmFtZSA9IGNob2ljZS5ldmVudF90eXBlX25hbWU7CiRzY29wZS5uZXdFdmVudERldGFpbHMub3JpZ2luYWxfZXZlbnRfbmFtZSA9IGNob2ljZS5ldmVudF90eXBlX25hbWU7CiRzY29wZS5uZXdFdmVudERldGFpbHMuZXZlbnRfZGVzY3JpcHRpb24gPSBjaG9pY2UuZXZlbnRfdHlwZV9kZXNjcmlwdGlvbjsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pc19jbGFzcyA9IGNob2ljZS5pc19jbGFzczsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5vcmlnaW5hbF9wcmljZSA9IGNob2ljZS5vcmlnaW5hbF9wcmljZTsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pc19nZW5lcmljX2V0eXBlID0gY2hvaWNlLmlzX2dlbmVyaWNfZXR5cGU7Ci8vICRzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZCA9IGNob2ljZS5pbnN0cnVjdG9yX2lkOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50ID0gY2hvaWNlLmR1cmF0aW9uX2V2ZW50OwovLyBsb2dEZWJ1Zygic2NvcGUubmV3RXZlbnREZXRhaWxzLmlzX2NsYXNzPSIrJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pc19jbGFzcyk7Ci8vIGxvZ0RlYnVnKCJzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZD0iKyRzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZCk7Ci8vIGxvZ0RlYnVnKCJzdGFydERhdGU9IitzdGFydERhdGUpOwovLyAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWUgPSBzdGFydERhdGU7CiRzY29wZS5uZXdFdmVudERldGFpbHMuZXZlbnR0eXBlID0gY2hvaWNlOwpjYWxjdWxhdGVFbmRUaW1lKCk7CgovLyAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWVfaW5wdXRfZm9ybWF0PSBuZXcgRGF0ZSgxOTcwLCAwLCAxLCAxNCwgNTcsIDApOwoKbG9nRGVidWcoIm5ld0V2ZW50IHN0YXJ0PSIgKyAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWUpOwpsb2dEZWJ1ZygibmV3RXZlbnQgZW5kPSIgKyAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZF90aW1lKTsKCiRzY29wZS5zaG93RXZlbnRUeXBlU2VsZWN0ZWQgPSB0cnVlOwp9CgovLyB0aGlzIGZ1bmN0aW9uIGNhbGN1bGF0ZXMgZW5kIHRpbWUgYWNjb3JkaW5nIHRvIHRoZSBsZW5ndGggb2YgdGhlIGV2ZW50dHlwZQpmdW5jdGlvbiBjYWxjdWxhdGVFbmRUaW1lKCkKewpjb25zb2xlLmxvZygiJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5zdGFydF90aW1lPSIrJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5zdGFydF90aW1lKTsKZW5kID0gbW9tZW50KCRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZSkuYWRkKCRzY29wZS5uZXdFdmVudERldGFpbHMuZHVyYXRpb25fZXZlbnQsICdtaW51dGVzJyk7CnNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKGVuZCk7CnNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKHNlbGVjdGVkRGF0ZUVuZC5nZXRUaW1lKCkgKyBzZWxlY3RlZERhdGVFbmQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMgPSBzZWxlY3RlZERhdGVFbmQuZ2V0SG91cnMoKTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kZG93ID0gZGF5TmFtZXNbc2VsZWN0ZWREYXRlRW5kLmdldERheSgpXTsKJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcyA9IChzZWxlY3RlZERhdGVFbmQuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBzZWxlY3RlZERhdGVFbmQuZ2V0TWludXRlcygpOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZF90aW1lID0gZW5kOwovLyBjYWxjdWxhdGluZyBkdXJhdGlvbgokc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50PXBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpLXBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcyk7CiRzY29wZS5uZXdFdmVudERldGFpbHMuZHVyYXRpb25fZXZlbnQ9JHNjb3BlLm5ld0V2ZW50RGV0YWlscy5kdXJhdGlvbl9ldmVudCsocGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMpLXBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMpKSo2MDsKaWYgKCRzY29wZS5uZXdFdmVudERldGFpbHMuZHVyYXRpb25fZXZlbnQ8MCkKewokc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50PTA7Cn0KfQoKLy8gdGhpcyBmdW5jdGlvbiBjYWxjdWxhdGVzIGVuZCB0aW1lIGFjY29yZGluZyB0byB0aGUgaW5wdXQgZnJvbSBtb2RhbCB3aW5kb3cKLy8gYW5kIG5vdCBhY2NvcmRpbmcgdG8gZXZlbnQgdHlwZSBsZW5ndGgKZnVuY3Rpb24gY2FsY3VsYXRlRW5kVGltZUR5bmFtaWMoKQp7CmV2ZW50WWVhcj0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXI7CmV2ZW50TW9udGg9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aDExMjsKZXZlbnREYXk9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXlvZm1vbnRoOwppZiAocGFyc2VJbnQoZXZlbnRNb250aCk8MTApCnsKZXZlbnRNb250aD0iMCIrZXZlbnRNb250aDsKfQppZiAocGFyc2VJbnQoZXZlbnREYXkpPDEwKQp7CmV2ZW50RGF5PSIwIitldmVudERheTsKfQpsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyPSIrZXZlbnRZZWFyKTsKbG9nRGVidWcoIiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aD0iK2V2ZW50TW9udGgpOwpsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aD0iK2V2ZW50RGF5KTsKbmV3X2VuZD1tb21lbnQudXRjKGV2ZW50WWVhcisiLSIrZXZlbnRNb250aCsiLSIrZXZlbnREYXkrIlQwMDowMDowMCIpLmFkZCgoKHBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzKSo2MCkrcGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcykpLCAnbWludXRlcycpOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZF90aW1lPW5ld19lbmQ7CmxvZ0RlYnVnKCJuZXdfZW5kPSIrbmV3X2VuZCk7Ci8vIGNhbGN1bGF0aW5nIGR1cmF0aW9uCiRzY29wZS5uZXdFdmVudERldGFpbHMuZHVyYXRpb25fZXZlbnQ9cGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcyktcGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKTsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5kdXJhdGlvbl9ldmVudD0kc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50KyhwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycyktcGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykpKjYwOwppZiAoJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5kdXJhdGlvbl9ldmVudDwwKQp7CiRzY29wZS5uZXdFdmVudERldGFpbHMuZHVyYXRpb25fZXZlbnQ9MDsKfQp9CmdldEFsbEJ1c2luZXNzRXZlbnRUeXBlcygkaHR0cCwkc2NvcGUsJ2V2ZW50VHlwZU9wdGlvbnMnLGdldEFsbEJ1c2luZXNzRXZlbnRUeXBlc19zdWNjZXNzKTsKZnVuY3Rpb24gZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzX3N1Y2Nlc3MoKQp7Ci8vIGFmdGVyIGxvYWRpbmcgZXZlbnQgdHlwZXMsIGlmIHRoZSBnaXZlbiBldmVudCB0eXBlIGlzICE9IDAgd2UgInNlbGVjdCIgaXQKY29uc29sZS5sb2coImdldEFsbEJ1c2luZXNzRXZlbnRUeXBlc19zdWNjZXNzIik7CmlmICgkc2NvcGUuZ2l2ZW5fZXZlbnRfdHlwZV9pZD4wKQp7CmZvcih2YXIgaSA9IDA7IGkgPCAkc2NvcGUuZXZlbnRUeXBlT3B0aW9ucy5sZW5ndGg7IGkrKykKewppZiAoJHNjb3BlLmV2ZW50VHlwZU9wdGlvbnNbaV0uZXZlbnRfdHlwZV9pZD09JHNjb3BlLmdpdmVuX2V2ZW50X3R5cGVfaWQpCnsKY29uc29sZS5sb2coImdpdmVuX2V2ZW50X3R5cGVfaWQgZm91bmQiKTsKLy8gJHNjb3BlLmNhbGN1bGF0ZVN0YXJ0VGltZSgpOwokc2NvcGUuc2VsZWN0RXZlbnRUeXBlU2VsZWN0ZWQ9JHNjb3BlLmV2ZW50VHlwZU9wdGlvbnNbaV07Ci8vICRzY29wZS5zZWxlY3RFdmVudFR5cGUoJHNjb3BlLmV2ZW50VHlwZU9wdGlvbnNbaV0pOwokc2NvcGUuc2VsZWN0RXZlbnRUeXBlKCk7Cn0KfQp9CmVsc2Ugewokc2NvcGUuZXZlbnRUeXBlT3B0aW9ucy51bnNoaWZ0KHsiZXZlbnRfdHlwZV9pZCI6MCwgImV2ZW50X3R5cGVfbmFtZSI6IteR15fXqCDXodeV15Ig157XpNeS16kiLCBpc192YWNhdGlvbjogMH0pOwokc2NvcGUuc2VsZWN0RXZlbnRUeXBlU2VsZWN0ZWQ9JHNjb3BlLmV2ZW50VHlwZU9wdGlvbnNbMF07Cn0KfQpnZXRBbGxDbGllbnRzKCRodHRwLCRzY29wZSwnZXZlbnRUeXBlVXNlcnMnKTsKCiRzY29wZS5ldmVudENsaWVudFNlbGVjdGVkID0gZnVuY3Rpb24oc2VsZWN0ZWQpIHsKaWYgKHNlbGVjdGVkKSB7Ci8vIGFsZXJ0KEpTT04uc3RyaW5naWZ5KCBzZWxlY3RlZCwgbnVsbCwgMiApKTsKbG9nRGVidWcoJ2NsaWVudCBzZWxlY3RlZCAnICsgc2VsZWN0ZWQub3JpZ2luYWxPYmplY3QuYnVzZXJfZmlyc3RfbmFtZSk7CiRzY29wZS5zaG93RXZlbnRDbGllbnRTZWxlY3RlZCA9IHRydWU7CiRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kdXNlcl9pZCA9IHNlbGVjdGVkLm9yaWdpbmFsT2JqZWN0LmJ1c2luZXNzX3VzZXJfaWQ7CiRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kdXNlcl9maXJzdF9uYW1lID0gc2VsZWN0ZWQub3JpZ2luYWxPYmplY3QuYnVzZXJfZmlyc3RfbmFtZTsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmR1c2VyX2xhc3RfbmFtZSA9IHNlbGVjdGVkLm9yaWdpbmFsT2JqZWN0LmJ1c2VyX2xhc3RfbmFtZTsKfSBlbHNlIHsKbG9nRGVidWcoJ25vdCBzZWxlY3RlZCcpOwovLyAkc2NvcGUuZXZlbnRDbGllbnREZVNlbGVjdGVkKCk7Cn0KfTsKJHNjb3BlLmV2ZW50Q2xpZW50RGVTZWxlY3RlZCA9IGZ1bmN0aW9uKCkgewokc2NvcGUuc2hvd0V2ZW50Q2xpZW50U2VsZWN0ZWQgPSBmYWxzZTsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmR1c2VyX2lkID0gbnVsbDsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmR1c2VyX2ZpcnN0X25hbWUgPSBudWxsOwokc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZHVzZXJfbGFzdF9uYW1lID0gbnVsbDsKJHNjb3BlLmNsZWFyQ2xpZW50SW5wdXQoJ2NsaWVudF9hbmd1Y29tcGxldGUnKTsKfQoKJHNjb3BlLmNsZWFyQ2xpZW50SW5wdXQgPSBmdW5jdGlvbihpZCkgewppZiAoaWQpIHsKJHNjb3BlLiRicm9hZGNhc3QoJ2FuZ3Vjb21wbGV0ZS1hbHQ6Y2xlYXJJbnB1dCcsIGlkKTsKfQovLyBlbHNlewovLyAgICRzY29wZS4kYnJvYWRjYXN0KCdhbmd1Y29tcGxldGUtYWx0OmNsZWFySW5wdXQnKTsKLy8gfQp9Cgokc2NvcGUuY2FuY2VsID0gZnVuY3Rpb24oKSB7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKfTsKCiRzY29wZS51cGRhdGVFdmVudE5hbWVDaGVjayA9IGZ1bmN0aW9uKG5ld1ZhbHVlKQp7CmxvZ0RlYnVnKCJ1cGRhdGVFdmVudE5hbWU9IituZXdWYWx1ZSk7CmlmIChuZXdWYWx1ZT09IiIpCnsKJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5ldmVudF9uYW1lID0gJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5vcmlnaW5hbF9ldmVudF9uYW1lOwp9Cn0KLy8gcmVzY2hlZHVsZUV2ZW50CiRzY29wZS5yZXNjaGVkdWxlRXZlbnQgPSBmdW5jdGlvbigpIHsKbG9nRGVidWcoImZ1bmN0aW9uOiByZXNjaGVkdWxlRXZlbnQiKTsKCi8vIG5ld0V2ZW50SlNPTkRldGFpbHMgPSBKU09OLnN0cmluZ2lmeSgkc2NvcGUubmV3RXZlbnREZXRhaWxzLCBudWxsLCA0KTsgLy8gKE9wdGlvbmFsKSBiZWF1dGlmdWwgaW5kZW50ZWQgb3V0cHV0Lgpsb2dEZWJ1ZygicmVzY2hlZHVsZUV2ZW50LCAiICsgSlNPTi5zdHJpbmdpZnkoJHNjb3BlLm5ld0V2ZW50RGV0YWlscywgbnVsbCwgNCkpOwovLyBpZiAoJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5ldmVudFJlY3VycmluZykgewovLyAgIGNyZWF0ZVJlY3VycmluZ0V2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUubmV3RXZlbnREZXRhaWxzLGNyZWF0ZVJlY3VycmluZ0V2ZW50X3N1Y2Nlc3MpOwovLyAgIGZ1bmN0aW9uIGNyZWF0ZVJlY3VycmluZ0V2ZW50X3N1Y2Nlc3MoKQovLyAgIHsKLy8gICAgIGNhbGVuZGFyID0gImNhbGVuZGFyX2J1c2luZXNzIjsKLy8gICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKLy8gICAgICR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoKTsKLy8gICAgIC8vIGVycm9yIHdhcwovLyAgICAgLy8gbG9nRGVidWcoImVycm9yICIgKyBkYXRhLk1lc3NhZ2UpOwovLyAgICAgLy8gJHNjb3BlLmFqYXhfZXJyb3IgPSBkYXRhLk1lc3NhZ2U7Ci8vICAgfQovLyB9Ci8vIGVsc2UKewovLyBpZiBldmVudCBpcyBub3QgY2xhc3MsIGEgY2xpZW50IG11c3QgYmUgc2VsZWN0ZWQKLy8gaWYgKCghJHNjb3BlLnNob3dFdmVudENsaWVudFNlbGVjdGVkKSAmJiAoISRzY29wZS5uZXdFdmVudERldGFpbHMuaXNfY2xhc3MpKQovLyB7Ci8vICAgLy8gYWxlcnQoJ2NsaWVudCBtdXN0IGJlIHNlbGVjdGVkJyk7Ci8vICAgJHNjb3BlLmFqYXhfZXJyb3I9IteQ16DXkCDXlNeV16HXoyDXntep16rXqtejINec157XpNeS16kiOwovLyAgIHJldHVybjsKLy8gfQpyZXNjaGVkdWxlRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5yZXNjaGVkdWxlX2V2ZW50X2RldGFpbHMuZXZlbnRfaWQsJHNjb3BlLm5ld0V2ZW50RGV0YWlscyxyZXNjaGVkdWxlRXZlbnRfc3VjY2Vzcyk7CmZ1bmN0aW9uIHJlc2NoZWR1bGVFdmVudF9zdWNjZXNzKCkKewpjYWxlbmRhciA9ICJjYWxlbmRhcl9idXNpbmVzcyI7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjYWxlbmRhckV2ZW50UmVzY2hlZHVsZURlc2VsZWN0Jyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCiR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoJ2FkZGVkJyk7Cn0KLy8gb24gZmFpbHVyZSB3YXMKLy8gJHNjb3BlLmFqYXhfZXJyb3IgPSBkYXRhLk1lc3NhZ2U7Cn0KfTsKCiRzY29wZS5jcmVhdGVOZXdFdmVudCA9IGZ1bmN0aW9uKCkgewpsb2dEZWJ1ZygiY3JlYXRlTmV3RXZlbnQgc3RhcnRfdGltZT0iKyB0eXBlb2YgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5zdGFydF90aW1lKTsKCm5ld0V2ZW50SlNPTkRldGFpbHMgPSBKU09OLnN0cmluZ2lmeSgkc2NvcGUubmV3RXZlbnREZXRhaWxzLCBudWxsLCA0KTsgLy8gKE9wdGlvbmFsKSBiZWF1dGlmdWwgaW5kZW50ZWQgb3V0cHV0Lgpsb2dEZWJ1ZygiY3JlYXRlTmV3RXZlbnQsICIgKyBuZXdFdmVudEpTT05EZXRhaWxzKTsKaWYgKCRzY29wZS5uZXdFdmVudERldGFpbHMuZXZlbnRSZWN1cnJpbmcpIHsKY3JlYXRlUmVjdXJyaW5nRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5uZXdFdmVudERldGFpbHMsY3JlYXRlUmVjdXJyaW5nRXZlbnRfc3VjY2Vzcyk7CmZ1bmN0aW9uIGNyZWF0ZVJlY3VycmluZ0V2ZW50X3N1Y2Nlc3MoKQp7CmNhbGVuZGFyID0gImNhbGVuZGFyX2J1c2luZXNzIjsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwokdWliTW9kYWxJbnN0YW5jZS5kaXNtaXNzKCk7Ci8vIGVycm9yIHdhcwovLyBsb2dEZWJ1ZygiZXJyb3IgIiArIGRhdGEuTWVzc2FnZSk7Ci8vICRzY29wZS5hamF4X2Vycm9yID0gZGF0YS5NZXNzYWdlOwp9Cn0KZWxzZQp7Ci8vIGNoZWNraW5nIGV2ZW50IHRpbWUgbG9naWMKaWYgKCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnM+JHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMpCnsKJHNjb3BlLmFqYXhfZXJyb3I9IteW157XnyDXlNeU16rXl9ec15Qg16nXnCDXlNee16TXktepINeQ15fXqNeZINeW157XnyDXlNeh15nXldedINep15zXlSI7CnJldHVybjsKfQovLyBjaGVja2luZyBldmVudCB0aW1lIGxvZ2ljCmlmIChwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKT09cGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMpKQp7CmlmIChwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpPj1wYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzKSkKewokc2NvcGUuYWpheF9lcnJvcj0i15bXntefINeU15TXqteX15zXlCDXqdecINeU157XpNeS16kg15DXl9eo15kg15bXntefINeU16HXmdeV150g16nXnNeVIjsKcmV0dXJuOwp9CmxvZ0RlYnVnKCIkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXM9Iiskc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpOwpsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcz0iKyRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpOwppZiAoKHBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcykrNSk+PXBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpKQp7CiRzY29wZS5hamF4X2Vycm9yPSLXkNeV16jXmiDXlNee16TXktepINeX15nXmdeRINec15TXmdeV16og15zXpNeX15XXqiA1INeT16fXldeqIjsKcmV0dXJuOwp9Cn0KLy8gaWYgZXZlbnQgaXMgbm90IGNsYXNzLCBhIGNsaWVudCBtdXN0IGJlIHNlbGVjdGVkCmlmICgoISRzY29wZS5zaG93RXZlbnRDbGllbnRTZWxlY3RlZCkgJiYgKCEkc2NvcGUubmV3RXZlbnREZXRhaWxzLmlzX2NsYXNzKSAmJiAoJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pc19nZW5lcmljX2V0eXBlPT0wKSkKewovLyBhbGVydCgnY2xpZW50IG11c3QgYmUgc2VsZWN0ZWQnKTsKJHNjb3BlLmFqYXhfZXJyb3I9IteQ16DXkCDXlNeV16HXoyDXntep16rXqtejINec157XpNeS16kiOwpyZXR1cm47Cn0KaWYgKCRzY29wZS5zZWxlY3RFdmVudFR5cGVTZWxlY3RlZC5ldmVudF90eXBlX2lkPT0wKQp7Ci8vIGFsZXJ0KCdjbGllbnQgbXVzdCBiZSBzZWxlY3RlZCcpOwokc2NvcGUuYWpheF9lcnJvcj0i15DXoNeQINeR15fXqCDXodeV15Ig157XpNeS16kgIjsKcmV0dXJuOwp9CmNyZWF0ZUV2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUubmV3RXZlbnREZXRhaWxzLGNyZWF0ZUV2ZW50X3N1Y2Nlc3MpOwpmdW5jdGlvbiBjcmVhdGVFdmVudF9zdWNjZXNzKCkKewpjYWxlbmRhciA9ICJjYWxlbmRhcl9idXNpbmVzcyI7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKJHVpYk1vZGFsSW5zdGFuY2UuZGlzbWlzcygnYWRkZWQnKTsKfQovLyBvbiBmYWlsdXJlIHdhcwovLyAkc2NvcGUuYWpheF9lcnJvciA9IGRhdGEuTWVzc2FnZTsKfQp9Cn0pOwovLy8vIGZmZmZmZmYKa3V6ZUFwcC5jb250cm9sbGVyKCdCdXNpbmVzc0NhbGVuZGFyQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsIHNoYXJlZFByb3BlcnRpZXMsICRjb21waWxlLCAkbG9jYXRpb24sIHVpQ2FsZW5kYXJDb25maWcsICR1aWJNb2RhbCwgc2hhcmVkRGF0YSkgewppbml0aWFsRW5kVXNlciA9IHNoYXJlZERhdGEuZ2V0U2VsZWN0ZWRFbmRVc2VyKCk7CmxvZ0RlYnVnKCdCdXNpbmVzc0NhbGVuZGFyIENvbnRyb2xsZXIsIHNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKT0nICsgc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpKTsKCmdldEJ1c2luZXNzTG9jYXRpb25zKCRodHRwLCRzY29wZSwnYnVzaW5lc3NfbG9jYXRpb25zJyk7CgogICAgJHNjb3BlLnN0YXR1c2VzID0gWyB7InN0YXR1c19pZCI6IjAiLCJzdGF0dXNfbmFtZSI6Itek16rXldeXIn0sIHsic3RhdHVzX2lkIjoiMSIsInN0YXR1c19uYW1lIjoi16HXkteV16gifV07CiAgICAkc2NvcGUudGhlZGF0YV9yZXBvcnQgPSB7fTsKCiAgICAkc2NvcGUudGhlZGF0YV9yZXBvcnQuc291cmNlID0gImNhbGVuZGFyIjsKICAgICRzY29wZS50aGVkYXRhX3JlcG9ydC5maWx0ZXJzID0gewogICAgICBpc19jYW5jZWxlZDogIjAiCiAgICB9OwoKICAgICRzY29wZS51cGRhdGVFdmVudHMgPSBmdW5jdGlvbigpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJ1cGRhdGVFdmVudHMiKTsKICAgICAgaW5zdHJ1Y3Rvcl9pZF9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuY2FsZW5kYXJJbnN0cnVjdG9yRmlsdGVyLCAiYnVzaW5lc3NfdXNlcl9pZCIgKTsKICAgICAgZXZlbnRfdHlwZV9pZF9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuY2FsZW5kYXJFdmVudFR5cGVGaWx0ZXIsICJldmVudF90eXBlX2lkIiApOwogICAgICBzdGF0dXNfZmlsdGVyID0gbGlzdF90b19zdHJpbmdfYnlfdmFsdWUoJHNjb3BlLmNhbGVuZGFyU3RhdHVzRmlsdGVyLCAic3RhdHVzX2lkIiApOwoKICAgICAgJHNjb3BlLnRoZWRhdGFfcmVwb3J0LmZpbHRlcnMgPSB7CiAgICAgICAgaW5zdHJ1Y3Rvcl9pZDogaW5zdHJ1Y3Rvcl9pZF9maWx0ZXIsCiAgICAgICAgZXZlbnRfdHlwZV9pZDogZXZlbnRfdHlwZV9pZF9maWx0ZXIsCiAgICAgICAgc3RhdHVzOiBzdGF0dXNfZmlsdGVyLAogICAgICAgIGlzX2NhbmNlbGVkOiAiMCIKICAgICAgfTsKCiAgICAgIC8vIGNvbnNvbGUubG9nKCRzY29wZS5jYWxlbmRhcik7CiAgICAgIGxvZ0RlYnVnKCJiZWZvcmUgcmVmZXRjaEV2ZW50cyIpOwogICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwogICAgICBsb2dEZWJ1ZygiYWZ0ZXIgcmVmZXRjaEV2ZW50cyIpOwogICAgICAvLyB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwoKICAgIH0KCiRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyPWZhbHNlOwoKaWYgKHNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKSE9bnVsbCkKewpjb25zb2xlLmxvZygiZ290IHByZXZpb3VzIHNlbGVjdGVkIHVzZXIgIitzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfZmlyc3RfbmFtZSk7CiRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VybmFtZT1zaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfZmlyc3RfbmFtZSsiICIrc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2VyX2xhc3RfbmFtZTsKJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJfaWQ9c2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2luZXNzX3VzZXJfaWQ7CmxvZ0RlYnVnKCIkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcl9pZD0iKyRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyX2lkKTsKCiRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyPXRydWU7Cn0KCi8vIGNoZWNraW5nIGlmIGNhbGVuZGFyIHNob3VsZCBzdGFydCB3aXRoIGEgc3BlY2lmaWMgZGF0ZSAoZnJvbSB1cmwgb3IgZnJvbSBwcmV2aW91c2x5IHNlbGVjdGVkIGRhdGUpCmxvZ0RlYnVnKCIkbG9jYXRpb24uc2VhcmNoKCkuc3RhcnQ9IiArICRsb2NhdGlvbi5zZWFyY2goKS5zdGFydCk7CmlmICh0eXBlb2YgJGxvY2F0aW9uLnNlYXJjaCgpLnN0YXJ0ICE9ICd1bmRlZmluZWQnKQp7CmN1cnJEZWZhdWx0RGF0ZSA9ICRsb2NhdGlvbi5zZWFyY2goKS5zdGFydDsKfQplbHNlIGlmIChzaGFyZWRQcm9wZXJ0aWVzLmdldF9jYWxlbmRhcl9kYXRlKCkhPW51bGwpCnsKY29uc29sZS5sb2coImdvdCBwcmV2aW91cyBkYXRlICAiK3NoYXJlZFByb3BlcnRpZXMuZ2V0X2NhbGVuZGFyX2RhdGUoKSk7CmN1cnJEZWZhdWx0RGF0ZSA9IHNoYXJlZFByb3BlcnRpZXMuZ2V0X2NhbGVuZGFyX2RhdGUoKTsKfQplbHNlCnsKY3VyckRlZmF1bHREYXRlID0gbmV3IERhdGUoKTsKfQpnZXRBbGxJbnN0cnVjdG9ycygkaHR0cCwkc2NvcGUsJ2J1c2luZXNzX2luc3RydWN0b3JzJyxnZXRBbGxJbnN0cnVjdG9yc19maW5pc2gpOwogICAgZ2V0QWxsSW5zdHJ1Y3RvcnMoJGh0dHAsJHNjb3BlLCdpbnN0cnVjdG9ycycpOwpmdW5jdGlvbiBnZXRBbGxJbnN0cnVjdG9yc19maW5pc2goKQp7Ci8vIGNvbnNvbGUubG9nKCRzY29wZS5idXNpbmVzc19pbnN0cnVjdG9ycyk7CiRzY29wZS5idXNpbmVzc19pbnN0cnVjdG9ycy51bnNoaWZ0KHsiYnVzZXJfZnVsbF9uYW1lIjoi15vXnCDXlNem15XXldeqIiwgImJ1c2VyX2ZpcnN0X25hbWUiOiLXm9eV15zXnSIsImJ1c2VyX2xhc3RfbmFtZSI6IiIsICJ1c2VyX2lkIjogMCwgImJ1c2luZXNzX3VzZXJfaWQiOiAwfSk7CgovLyBzZXR0aW5nIHNlbGVjdGVkIGdldF9zZWxlY3RlZF9pbnN0cnVjdG9yCiRzY29wZS5wcmV2aW91c19zZWxlY3RlZF9pbnN0cnVjdG9yPWZhbHNlOwppZiAoc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfaW5zdHJ1Y3RvcigpPj0wKQp7Ci8vIGNvbnNvbGUubG9nKCJnb3QgcHJldmlvdXMgc2VsZWN0ZWQgaW5zdHJ1Y3RvciAiK3NoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX2luc3RydWN0b3IoKSk7CiRzY29wZS5wcmV2aW91c19zZWxlY3RlZF9pbnN0cnVjdG9yX2lkPXNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX2luc3RydWN0b3IoKTsKJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX2luc3RydWN0b3I9dHJ1ZTsKJHNjb3BlLnNlbGVjdGVkX2J1c2luZXNzX3VzZXJfaWQ9c2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfaW5zdHJ1Y3RvcigpOwp9Cn0KICAgIGdldEFsbEJ1c2luZXNzRXZlbnRUeXBlcygkaHR0cCwkc2NvcGUsJ2V2ZW50X3R5cGVzX2NhbHMnKTsKZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzTm9TeXN0ZW0oJGh0dHAsJHNjb3BlLCdldmVudF90eXBlcycpOwoKLy8gc2V0dGluZyBzZWxlY3RlZCB1c2VyIGlkCiRzY29wZS5wcmV2aW91c19ldmVudF9yZXNjaGVkdWxlPWZhbHNlOwokc2NvcGUucHJldmlvdXNfZXZlbnRfcmVzY2hlZHVsZV9ldmVudD1udWxsOwoKJHNjb3BlLiRvbigiY2FsZW5kYXJFdmVudFJlc2NoZWR1bGVEZXNlbGVjdCIsZnVuY3Rpb24oZSxhKQp7CiRzY29wZS5jYWxlbmRhckV2ZW50UmVzY2hlZHVsZURlc2VsZWN0KCk7Cn0pOwoKLy8gZGVzZWxlY3RpbmcgZXZlbnQgZnJvbSBiZWluZyByZXNjaGVkdWxlZAokc2NvcGUuY2FsZW5kYXJFdmVudFJlc2NoZWR1bGVEZXNlbGVjdD1mdW5jdGlvbigpCnsKc2hhcmVkUHJvcGVydGllcy5zZXRfZXZlbnRfcmVzY2hlZHVsZShudWxsKTsKJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGU9ZmFsc2U7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZWZldGNoRXZlbnRzJyk7Cn0KLy8gZGVsZXRpbmcgY2xpZW50IHNlbGVjdGlvbiBpbiBjYWxlbmRhcgokc2NvcGUuY2FsZW5kYXJDbGllbnREZXNlbGVjdD1mdW5jdGlvbigpIC8vIHJlbG9hZCBjbGFzcy9ldmVudCBzdWdnZXN0aW9ucwp7CiRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyPWZhbHNlOwpzaGFyZWRQcm9wZXJ0aWVzLnNldF9zZWxlY3RlZF91c2VyKG51bGwpOwokc2NvcGUuZXZlbnRUeXBlU2VsZWN0ZWQoKTsKfQppZiAoaW5pdGlhbEVuZFVzZXIgIT0gbnVsbCkgewokc2NvcGUuYnVzaW5lc3NDYWxlbmRhckluaXRpYWxOYW1lID0gdHJ1ZTsKc2hhcmVkRGF0YS5zZXRTZWxlY3RlZEVuZFVzZXIobnVsbCk7CiRzY29wZS5idXNpbmVzc0NhbGVuZGFySW5pdGlhbHMgPSB7Cm5hbWU6IGluaXRpYWxFbmRVc2VyLmZpcnN0X25hbWUgKyAiICIgKyBpbml0aWFsRW5kVXNlci5sYXN0X25hbWUKfTsKfSBlbHNlIHsKJHNjb3BlLmJ1c2luZXNzQ2FsZW5kYXJJbml0aWFsTmFtZSA9IGZhbHNlOwp9Ci8qIGNvbmZpZyBvYmplY3QgKi8KJHNjb3BlLmNhbGVuZGFyX25hbWUgPSAiY2FsZW5kYXJfYnVzaW5lc3MiOwokc2NvcGUuY2FsZW5kYXIgPSAiY2FsZW5kYXJfYnVzaW5lc3MiOwovKiBldmVudCBzb3VyY2VzIGFycmF5Ki8KCiAgICAvLyB0aGVkYXRhID0geyBzb3VyY2U6ICJjYWxlbmRhciIgfQogICAgLy8gdGhlZGF0YVsnZmlsdGVycyddID0geyBpbnN0cnVjdG9yX2lkOiAiMTk1In07CgogICAgLy8gY29uc29sZS5sb2codGhlZGF0YSk7Cgokc2NvcGUuYnVzaW5lc3NDYWxlbmRhckV2ZW50U291cmNlcyA9IFt7CiAgICAgIC8vIHVybDogJy9hcGkvYWRtaW4vZXZlbnRzL2dldHBvc3QnLAogICAgICB1cmw6ICcvYXBpL2FkbWluL3JlcG9ydHMvZXZlbnRzMicsCiAgICAgIGRhdGE6ICRzY29wZS50aGVkYXRhX3JlcG9ydCAsCnR5cGU6ICdQT1NUJwp9LCB7CnVybDogJy9hcGkvYWRtaW4vY2FsZW5kYXIvbGltaXRhdGlvbnMvYmFja2dyb3VuZC9nZXRwb3N0JywKICAgICAgZGF0YTogJHNjb3BlLnRoZWRhdGFfcmVwb3J0ICwKICAgICAgdHlwZTogJ1BPU1QnICAgIC8vIH0sIHsKLy8gICAgIHVybDogJy9hcGkvYWRtaW4vcmVjdXJyaW5nL2dldHBvc3QnLAovLyAgICAgdHlwZTogJ1BPU1QnCn1dOwoKJHNjb3BlLmdvdG9Ub2RheSA9IGZ1bmN0aW9uKCkgewokc2NvcGUuZ290b0RhdGUobmV3IERhdGUoKSk7CnZpc2libGVEYXRlU3RhcnQgPSBuZXcgRGF0ZSh1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ2V0VmlldycpLnN0YXJ0KTsKZGF0ZVRvR29UbyA9IHZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSArICItIiArICgnMCcgKyAodmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpICsgMSkpLnNsaWNlKC0yKSArICItIiArICgnMCcgKyB2aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSkuc2xpY2UoLTIpOwpzaGFyZWRQcm9wZXJ0aWVzLnNldF9jYWxlbmRhcl9kYXRlKGRhdGVUb0dvVG8pOwokc2NvcGUudmlzaWJsZURhdGVTdGFydD12aXNpYmxlRGF0ZVN0YXJ0OwokbG9jYXRpb24uc2VhcmNoKCdzdGFydCcsZGF0ZVRvR29Ubyk7Cn0KCiRzY29wZS5pbnN0cnVjdG9yU2VsZWN0ZWQ9ZnVuY3Rpb24odGhpc3RoaXMpCnsKdXBkYXRlU3VnZ2VzdGlvbnMoKTsKfQokc2NvcGUuZXZlbnRUeXBlU2VsZWN0ZWQ9ZnVuY3Rpb24odGhpc3RoaXMpCnsKdXBkYXRlU3VnZ2VzdGlvbnMoKTsKfQpmdW5jdGlvbiB1cGRhdGVTdWdnZXN0aW9ucygpCnsKbG9nRGVidWcoImZ1bmN0aW9uOiB1cGRhdGVTdWdnZXN0aW9ucyIpOwpzaGFyZWRQcm9wZXJ0aWVzLnNldF9ldmVudF90eXBlX2Zvcl9zdWdnZXN0aW9ucygkc2NvcGUuc2VsZWN0ZWRfZXZlbnRfdHlwZV9pZCk7CnNoYXJlZFByb3BlcnRpZXMuc2V0X3NlbGVjdGVkX2luc3RydWN0b3IoJHNjb3BlLnNlbGVjdGVkX2J1c2luZXNzX3VzZXJfaWQpOwpmb3IgKGk9MDtpPCRzY29wZS5ldmVudF90eXBlcy5sZW5ndGg7aSsrKQp7Ci8vIGNvbnNvbGUubG9nKCRzY29wZS5ldmVudF90eXBlc1tpXS5ldmVudF90eXBlX2lkKTsKaWYgKCRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkPT0kc2NvcGUuZXZlbnRfdHlwZXNbaV0uZXZlbnRfdHlwZV9pZCkKewovLyBjb25zb2xlLmxvZygiZm91bmQgZXZlbnQgdHlwZSBpZCIpOwppZiAoJHNjb3BlLmV2ZW50X3R5cGVzW2ldLmlzX2NsYXNzKSAvLyBpcyBjbGFzcwp7CmxvZ0RlYnVnKCIkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcj0iKyRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyKTsKaWYgKCRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyKQp7CmNvbnNvbGUubG9nKCJpcyBjbGFzcyBzdWdnZXN0aW9uZCIpOwokaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3RjbGFzcy8iKyRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkKyIvIiskc2NvcGUuc2VsZWN0ZWRfYnVzaW5lc3NfdXNlcl9pZCsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSsiLyIrKCRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkrMSkrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0SG91cnMoKSArICIvIiArICRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKSArICIvIiArICRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyX2lkKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKQp7CiRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkX2lzX2NsYXNzPXRydWU7CiRzY29wZS5ldmVudHNTdWdnZXN0ZWQgPSByZXNwb25zZS5kYXRhOwp9KTsKfQplbHNlCnsKY29uc29sZS5sb2coIm5vdCBpcyBjbGFzcyBzdWdnZXN0aW9uZCIpOwokaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3RjbGFzcy8iKyRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkKyIvIiskc2NvcGUuc2VsZWN0ZWRfYnVzaW5lc3NfdXNlcl9pZCsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSsiLyIrKCRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkrMSkrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0SG91cnMoKSArICIvIiArICRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKSArICIvMCIpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpCnsKJHNjb3BlLnNlbGVjdGVkX2V2ZW50X3R5cGVfaWRfaXNfY2xhc3M9dHJ1ZTsKJHNjb3BlLmV2ZW50c1N1Z2dlc3RlZCA9IHJlc3BvbnNlLmRhdGE7Cn0pOwp9Cn0KZWxzZSAvLyBpcyBub3QgY2xhc3MKewokaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3QvIiskc2NvcGUuc2VsZWN0ZWRfZXZlbnRfdHlwZV9pZCsiLyIrJHNjb3BlLnNlbGVjdGVkX2J1c2luZXNzX3VzZXJfaWQrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCkrIi8iKygkc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpKzEpKyIvIiskc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXREYXRlKCkrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldEhvdXJzKCkgKyAiLyIgKyAkc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXRNaW51dGVzKCkpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpCnsKJHNjb3BlLnNlbGVjdGVkX2V2ZW50X3R5cGVfaWRfaXNfY2xhc3M9ZmFsc2U7CiRzY29wZS5ldmVudHNTdWdnZXN0ZWQgPSByZXNwb25zZS5kYXRhOwp9KTsKfQp9Cn0KfQoKJHNjb3BlLmdvdG9OZXh0ID0gZnVuY3Rpb24oKSB7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZW1vdmVFdmVudHMnKTsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ25leHQnKTsKJHNjb3BlLnVwZGF0ZUNhbGVuZGFyQ2VudGVyVGl0bGUoKTsKLy8gYWRkaW5nIHRoZSBmb2xsb3dpbmcgdG8gbWFrZSB0aGUgdXJsCi8vIHBvaW50IHRvIHRoZSByaWdodCB3ZWVrLCBpZiBnb2luZyB0byBhIGRpZmZlcmVudCBVUkwgYW5kIHRoZW4gZ29pbmcgYmFjawp2aXNpYmxlRGF0ZVN0YXJ0ID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5zdGFydCk7CmRhdGVUb0dvVG8gPSB2aXNpYmxlRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCkgKyAiLSIgKyAoJzAnICsgKHZpc2libGVEYXRlU3RhcnQuZ2V0TW9udGgoKSArIDEpKS5zbGljZSgtMikgKyAiLSIgKyAoJzAnICsgdmlzaWJsZURhdGVTdGFydC5nZXREYXRlKCkpLnNsaWNlKC0yKTsKc2hhcmVkUHJvcGVydGllcy5zZXRfY2FsZW5kYXJfZGF0ZShkYXRlVG9Hb1RvKTsKJHNjb3BlLnZpc2libGVEYXRlU3RhcnQ9dmlzaWJsZURhdGVTdGFydDsKJGxvY2F0aW9uLnNlYXJjaCgnc3RhcnQnLGRhdGVUb0dvVG8pOwp9CiRzY29wZS5nb3RvUHJldiA9IGZ1bmN0aW9uKCkgewp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVtb3ZlRXZlbnRzJyk7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdwcmV2Jyk7CiRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlKCk7Ci8vIGFkZGluZyB0aGUgZm9sbG93aW5nIHRvIG1ha2UgdGhlIHVybAovLyBwb2ludCB0byB0aGUgcmlnaHQgd2VlaywgaWYgZ29pbmcgdG8gYSBkaWZmZXJlbnQgVVJMIGFuZCB0aGVuIGdvaW5nIGJhY2sKdmlzaWJsZURhdGVTdGFydCA9IG5ldyBEYXRlKHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3Jykuc3RhcnQpOwpkYXRlVG9Hb1RvID0gdmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpICsgIi0iICsgKCcwJyArICh2aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkgKyAxKSkuc2xpY2UoLTIpICsgIi0iICsgKCcwJyArIHZpc2libGVEYXRlU3RhcnQuZ2V0RGF0ZSgpKS5zbGljZSgtMik7CnNoYXJlZFByb3BlcnRpZXMuc2V0X2NhbGVuZGFyX2RhdGUoZGF0ZVRvR29Ubyk7CiRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0PXZpc2libGVEYXRlU3RhcnQ7CiRsb2NhdGlvbi5zZWFyY2goJ3N0YXJ0JyxkYXRlVG9Hb1RvKTsKCn0KJHNjb3BlLmdvdG9EYXRlID0gZnVuY3Rpb24obmV3ZGF0ZSkgewp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ290b0RhdGUnLCBuZXdkYXRlKTsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlbW92ZUV2ZW50cycpOwp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwokc2NvcGUudXBkYXRlQ2FsZW5kYXJDZW50ZXJUaXRsZSgpOwp9Cgokc2NvcGUuZWRpdEhvdXJzT2ZXb3JrID0gZnVuY3Rpb24oKSB7Ci8vIHBhcmFtIHNob3VsZCBsb29rIGxpa2UgIjIwMTYtMDctMDEiCnZpc2libGVEYXRlU3RhcnQgPSBuZXcgRGF0ZSh1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ2V0VmlldycpLnN0YXJ0KTsKZGF0ZVRvR29UbyA9IHZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSArICItIiArICgnMCcgKyAodmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpICsgMSkpLnNsaWNlKC0yKSArICItIiArICgnMCcgKyB2aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSkuc2xpY2UoLTIpOwokbG9jYXRpb24ucGF0aCgnL2hvdXJzX29mX3dvcmsnKS5zZWFyY2goewpzdGFydDogZGF0ZVRvR29Ubwp9KTsKfTsKCiRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlID0gZnVuY3Rpb24oKSB7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3Jyk7Cgp2aXNpYmxlRGF0ZVN0YXJ0ID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5zdGFydCk7CnZpc2libGVEYXRlRW5kID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5lbmQpOwoKJHNjb3BlLmNhbGVuZGFyVGl0bGVDZW50ZXIgPSB2aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSArICIgIiArIG1vbnRoTmFtZXNbdmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpXSArCiIg4oCUICIgKyB2aXNpYmxlRGF0ZUVuZC5nZXREYXRlKCkgKyAiICIgKyBtb250aE5hbWVzW3Zpc2libGVEYXRlRW5kLmdldE1vbnRoKCldICsKIiAiICsgdmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpOwp9OwoKJHNjb3BlLnNob3dFdmVudFBvcHVwID0gZnVuY3Rpb24oc2VsZWN0ZWRFdmVudCkgewpzaG93RXZlbnRQb3B1cChzZWxlY3RlZEV2ZW50LCAkdWliTW9kYWwpCn07Cgokc2NvcGUuZXZlbnRDcmVhdGVNb2RhbEZyb21TY2hlZHVsZXIgPSBmdW5jdGlvbihlc3VnZ2VzdCkKewovLyBpZiBjbGFzcyAtIGdvIHRvIGV2ZW50IGNsYXNzCmNvbnNvbGUubG9nKGVzdWdnZXN0KTsKZm9yIChpPTA7aTwkc2NvcGUuZXZlbnRfdHlwZXMubGVuZ3RoO2krKykKewppZiAoZXN1Z2dlc3QuZXZlbnRfdHlwZV9pZD09JHNjb3BlLmV2ZW50X3R5cGVzW2ldLmV2ZW50X3R5cGVfaWQpCnsKaWYgKCRzY29wZS5ldmVudF90eXBlc1tpXS5pc19jbGFzcykKewpjb25zb2xlLmxvZygiaXMgY2xhc3MiKTsKd2luZG93LmxvY2F0aW9uLmhyZWY9Jy8jL2V2ZW50X2NsYXNzLycgKyBlc3VnZ2VzdC5ldmVudF9pZDsKcmV0dXJuOwp9Cn0KfQpsb2dEZWJ1ZyhKU09OLnN0cmluZ2lmeShlc3VnZ2VzdCkpOwpsb2dEZWJ1Zyhlc3VnZ2VzdC5zdGFydF9lcG9jaCk7CnN0YXJ0RGF0ZT1lc3VnZ2VzdC5zdGFydF9lcG9jaCoxMDAwOwoKdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CmFuaW1hdGlvbjogZmFsc2UsCnRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2V2ZW50X2NyZWF0ZS5waHAnLApjb250cm9sbGVyOiAnZXZlbnRDcmVhdGVNb2RhbENvbnRyb2xsZXInLApzaXplOiAnbCcsCnJlc29sdmU6IHsKc3RhcnREYXRlOiBmdW5jdGlvbigpIHsKcmV0dXJuIHN0YXJ0RGF0ZTsKfSwKZXZlbnRfdHlwZV9pZDogZnVuY3Rpb24oKSB7CnJldHVybiAkc2NvcGUuc2VsZWN0ZWRfZXZlbnRfdHlwZV9pZDsKfSwKbG9jYXRpb25faWQ6IGZ1bmN0aW9uKCkgewpyZXR1cm4gZXN1Z2dlc3QubG9jYXRpb25faWQ7Cn0sCmVtcF9pZDogZnVuY3Rpb24oKSB7CnJldHVybiBlc3VnZ2VzdC5lbXBfaWQ7Cn0sCnJlc2NoZWR1bGVfZXZlbnQ6IGZ1bmN0aW9uKCkKewppZiAoJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGUpCnsKcmV0dXJuICRzY29wZS5wcmV2aW91c19ldmVudF9yZXNjaGVkdWxlX2V2ZW50Owp9CmVsc2UKewpyZXR1cm4gbnVsbDsKfQp9Cgp9Cn0pOwoKfQokc2NvcGUuZXZlbnRDcmVhdGVNb2RhbCA9IGZ1bmN0aW9uKHN0YXJ0RGF0ZSwgc2l6ZSkgewogICAgICAgIGxvZ0RlYnVnKCJldmVudENyZWF0ZU1vZGFsIHN0YXJ0RGF0ZT0iK3N0YXJ0RGF0ZSk7Cgp2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKYW5pbWF0aW9uOiBmYWxzZSwKdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfZXZlbnRfY3JlYXRlLnBocCcsCmNvbnRyb2xsZXI6ICdldmVudENyZWF0ZU1vZGFsQ29udHJvbGxlcicsCnNpemU6IHNpemUsCnJlc29sdmU6IHsKc3RhcnREYXRlOiBmdW5jdGlvbigpIHsKcmV0dXJuIHN0YXJ0RGF0ZTsKfSwKZXZlbnRfdHlwZV9pZDogZnVuY3Rpb24oKSB7CnJldHVybiAwOwp9LApsb2NhdGlvbl9pZDogZnVuY3Rpb24oKSB7CnJldHVybiAwOwp9LAplbXBfaWQ6IGZ1bmN0aW9uKCkgewpyZXR1cm4gMDsKfSwKcmVzY2hlZHVsZV9ldmVudDogZnVuY3Rpb24oKQp7CmlmICgkc2NvcGUucHJldmlvdXNfZXZlbnRfcmVzY2hlZHVsZSkKewpyZXR1cm4gJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGVfZXZlbnQ7Cn0KZWxzZQp7CnJldHVybiBudWxsOwp9ICAgICAgICAgICAgICAgIH0KCn0KfSk7Cgptb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHNlbGVjdGVkSXRlbSkgewokc2NvcGUuc2VsZWN0ZWQgPSBzZWxlY3RlZEl0ZW07Cn0sIGZ1bmN0aW9uKCkgewpsb2dEZWJ1ZygnTW9kYWwgZGlzbWlzc2VkIGF0OiAnICsgbmV3IERhdGUoKSk7Cn0pOwp9OwoKLy8vCiRzY29wZS51cGRhdGVFdmVudERhdGFiYXNlID0gZnVuY3Rpb24oc3RhcnRfcGFyYW0sIGVuZF9wYXJhbSwgZXZlbnRfaWQsIHRoZWV2ZW50KQp7Cgpsb2dEZWJ1ZygidXBkYXRlRXZlbnREYXRhYmFzZSBzdGFydD0iICsgc3RhcnRfcGFyYW0gKyAiLCBlbmQ9IiArIGVuZF9wYXJhbSArICIsIGV2ZW50X2lkPSIgKyBldmVudF9pZCk7CnRoZXVybCA9ICcvYXBpL2FkbWluL2V2ZW50cy9zZXQvJyArIGV2ZW50X2lkOwoKJGh0dHAoewptZXRob2Q6ICdQT1NUJywKdXJsOiB0aGV1cmwsCmRhdGE6IHsKc3RhcnRfZGF0ZTogc3RhcnRfcGFyYW0sCmVuZF9kYXRlOiBlbmRfcGFyYW0sCmV2ZW50X2lkOiBldmVudF9pZAp9LApoZWFkZXJzOiB7CidDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbjtjaGFyc2V0PXV0Zi04Jwp9Cn0pLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkgewoKbG9nRGVidWcoZGF0YSk7CmlmIChkYXRhLkVycm9yKSB7CmxvZ0RlYnVnKCJlcnJvciAiICsgZGF0YS5NZXNzYWdlKTsKYWxlcnQoJ2Vycm9yJyk7CmNhbGVuZGFyID0gImNhbGVuZGFyX2J1c2luZXNzIjsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwp9IGVsc2Ugewpsb2dEZWJ1Zygic3VjY2VzcyIpOwpjYWxlbmRhciA9ICJjYWxlbmRhcl9idXNpbmVzcyI7Ci8vIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKLy8gJHVpYk1vZGFsSW5zdGFuY2UuZGlzbWlzcygnYWRkZWQgYW5kIHJlZmV0Y2hFdmVudHMnKTsKfQp9KTsKCn07Ci8vLwoKJHNjb3BlLmNsYXNzRXZlbnRBZGRVc2VyID0gZnVuY3Rpb24oZXN1Z2dlc3QpCnsKY29uc29sZS5sb2coImNsYXNzRXZlbnRBZGRVc2VyIG9yIFJlbW92ZSIpOwppZiAoKGVzdWdnZXN0LmlzX3JlZ2lzdGVyZWQ9PTEpIHwgKChlc3VnZ2VzdC5pc193YWl0aW5nbGlzdD09MSkgJiYgKGVzdWdnZXN0LmlzX2NhbmNlbGVkPT0wKSkpCnsKY29uc29sZS5sb2coIm5lZWQgdG8gdW5yZWdpc3RlciIpOwpyZW1vdmVFbmRVc2VyRnJvbUV2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcl9pZCxlc3VnZ2VzdC5ldmVudF9pZCxyZW1vdmVFbmRVc2VyRnJvbUV2ZW50X2NhbGxiYWNrLCByZW1vdmVFbmRVc2VyRnJvbUV2ZW50X2NhbGxiYWNrKTsKZnVuY3Rpb24gcmVtb3ZlRW5kVXNlckZyb21FdmVudF9jYWxsYmFjaygpCnsKJHNjb3BlLmV2ZW50VHlwZVNlbGVjdGVkKCk7CmNhbGVuZGFyID0gImNhbGVuZGFyX2J1c2luZXNzIjsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwoKfQp9CmVsc2UKewovLyBjb25zb2xlLmxvZyhlc3VnZ2VzdC5ldmVudF9pZCk7Ci8vIGNvbnNvbGUubG9nKCRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyX2lkKTsKLy8gaWYgc2VsZWN0ZWQgdXNlciAtIGFkZGluZyBoaW0vaGVyIHRvIGNsYXNzCmlmICgkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcikKewphZGRFbmRVc2VyVG9FdmVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJfaWQsZXN1Z2dlc3QuZXZlbnRfaWQsYWRkRW5kVXNlclRvRXZlbnRfY2FsbGJhY2ssIGFkZEVuZFVzZXJUb0V2ZW50X2NhbGxiYWNrKTsKZnVuY3Rpb24gYWRkRW5kVXNlclRvRXZlbnRfY2FsbGJhY2soKQp7CmNhbGVuZGFyID0gImNhbGVuZGFyX2J1c2luZXNzIjsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwokc2NvcGUuZXZlbnRUeXBlU2VsZWN0ZWQoKTsKfQp9CmVsc2UgLy8gZWxzZSAtIGdvaW5nIHRvIGNsYXNzIHBhZ2UKewp3aW5kb3cubG9jYXRpb24uaHJlZj0nLyMvZXZlbnRfY2xhc3MvJyArIGVzdWdnZXN0LmV2ZW50X2lkOwp9Cn0KfQokc2NvcGUuY2FsZW5kYXJfYnVzaW5lc3NfY29uZmlnID0gewpjYWxlbmRhcjogewpoZWlnaHQ6ICdhdXRvJywKZWRpdGFibGU6IHRydWUsCi8vIGhlYWRlcjogewovLyAgICAgbGVmdDogJycsCi8vICAgICBjZW50ZXI6ICcnLAovLyAgICAgcmlnaHQ6ICcnCi8vIH0sCi8vIGhlYWRlcjogewovLyAgICAgbGVmdDogJ3RpdGxlJywKLy8gICAgIGNlbnRlcjogJycsCi8vICAgICByaWdodDogJ3RvZGF5IHByZXYsbmV4dCcKLy8gfSwKdGl0bGVGb3JtYXQ6IHsKLy8gd2VlazogICJkIFtNTU1deyAnJiM4MjExOycgZCBNTU19Igp9LAovLyB0aXRsZUZvcm1hdDogewovLyAgICAgbW9udGg6ICdNTU1NIHl5eXknLAovLyAgICAgd2VlazogIk1NTSBkWyB5eXl5XXsgJyYjODIxMjsnWyBNTU1dIGQgeXl5eX0iLAovLyAgICAgZGF5OiAnTU0vZGQnCi8vIH0sCmhlYWRlcjogJycsCi8vIGRlZmF1bHRWaWV3OiAnYWdlbmRhV2VlaycsCi8vIHZpZXdzOiB7Ci8vICAgICBkb250U2hvd0RhdGU6IHsKLy8gICAgICAgICB0eXBlOiAnYWdlbmRhV2VlaycsCi8vICAgICAgICAgZHVyYXRpb246IHsKLy8gICAgICAgICAgICAgZGF5czogNwovLyAgICAgICAgIH0sCi8vICAgICAgICAgdGl0bGU6ICdBcGVydHVyYScsCi8vICAgICAgICAgY29sdW1uRm9ybWF0OiAnZGRkZCcgLy8gRm9ybWF0IHRoZSBkYXkgdG8gb25seSBzaG93IGxpa2UgJ01vbmRheScKLy8gICAgICAgICAgICAgLy8gaGlkZGVuRGF5czogWzAsIDZdIC8vIEhpZGUgU3VuZGF5IGFuZCBTYXR1cmRheT8KLy8gICAgIH0KLy8gfSwKLy8gc2xvdER1cmF0aW9uOiAnMDA6MTU6MDAnLApldmVudERyb3A6IGZ1bmN0aW9uKGV2ZW50LCBkYXlEZWx0YSwgbWludXRlRGVsdGEsIGFsbERheSwgcmV2ZXJ0RnVuYywgdWlDYWxlbmRhckNvbmZpZykgewpsb2dEZWJ1ZygiZXZlbnQgZHJvcCIgKyBldmVudC50aXRsZSArICIoIiArIGV2ZW50LmlkICsgIikgbW92ZWQgIiArIG1pbnV0ZURlbHRhICsgIiBtaW51dGVzIik7CmxvZ0RlYnVnKCJvbGQgc3RhcnQ9IiArIGV2ZW50LnN0YXJ0ICsgIiwgb2xkIGVuZD0iICsgZXZlbnQuZW5kKTsKJHNjb3BlLnVwZGF0ZUV2ZW50RGF0YWJhc2UoZXZlbnQuc3RhcnQsIGV2ZW50LmVuZCwgZXZlbnQuaWQsIGV2ZW50KTsKfSwKZXZlbnRSZXNpemU6IGZ1bmN0aW9uKGV2ZW50LCBkZWx0YSwgcmV2ZXJ0RnVuYykgewpsb2dEZWJ1ZygiZXZlbnQgcmVzaXplIiArIGV2ZW50LnRpdGxlICsgIigiICsgZXZlbnQuaWQgKyAiKSBtb3ZlZCAiKTsKbG9nRGVidWcoIm9sZCBzdGFydD0iICsgZXZlbnQuc3RhcnQgKyAiLCBvbGQgZW5kPSIgKyBldmVudC5lbmQpOwokc2NvcGUudXBkYXRlRXZlbnREYXRhYmFzZShldmVudC5zdGFydCwgZXZlbnQuZW5kLCBldmVudC5pZCwgZXZlbnQpOwp9LApkZWZhdWx0VmlldzogJ2FnZW5kYVdlZWsnLApldmVudFN0YXJ0RWRpdGFibGU6ZmFsc2UsCmV2ZW50RHVyYXRpb25FZGl0YWJsZTpmYWxzZSwKZGVmYXVsdERhdGU6IG1vbWVudChjdXJyRGVmYXVsdERhdGUpLAoKLy8gZGVmYXVsdFZpZXc6ICdkb250U2hvd0RhdGUnLApldmVudENsaWNrOiBmdW5jdGlvbihjYWxFdmVudCwganNFdmVudCwgdmlldykgewpsb2dEZWJ1ZygiY2FsZW5kYXIgZXZlbnQgY2xpY2tlZCAiICsgY2FsRXZlbnQudGl0bGUgKyAiKCIgKyBjYWxFdmVudC5pZCArICIpICIgKyBjYWxFdmVudC5zdGFydCArICIgIiArIGNhbEV2ZW50LmVuZCk7Ci8vIGxvZ0RlYnVnKEpTT04uc3RyaW5naWZ5KGNhbEV2ZW50KSk7Ci8vIGlmIGl0J3MgYSBnZW5lcmljIGV2ZW50ICh2YWNhdGlvbiBldGMpCi8vIHNob3cgcG9wdXAgd2l0aCBvcHRpb24gdG8gZGVsZXRlCmlmIChjYWxFdmVudC5pc19nZW5lcmljX2V0eXBlPT0xKQp7Ci8vICRzY29wZS5zaG93R2VuZXJpY0V2ZW50KGNhbEV2ZW50KTsKJHNjb3BlLnNob3dFdmVudFBvcHVwKGNhbEV2ZW50KTsKCn0KZWxzZQp7CiRzY29wZS5zaG93RXZlbnRQb3B1cChjYWxFdmVudCk7Cn0KLy8gY2hhbmdlIHRoZSBib3JkZXIgY29sb3IganVzdCBmb3IgZnVuCi8vICQodGhpcykuY3NzKCdib3JkZXItY29sb3InLCAncmVkJyk7Cgp9LApkYXlDbGljazogZnVuY3Rpb24oZGF0ZSwganNFdmVudCwgdmlldykgewovLyBsb2dEZWJ1ZygibmV3IGV2ZW50IGNyZWF0aW9uIGNsaWNrZWQgIiArIGNhbEV2ZW50LnRpdGxlICsgIigiICsgY2FsRXZlbnQuaWQgKyAiKSAiICsgY2FsRXZlbnQuc3RhcnQgKyAiICIgKyBjYWxFdmVudC5lbmQpOwovLyAgICAgc3RhcnQgPSBkYXRlOwovLyAgICAgZW5kID0gbW9tZW50KHN0YXJ0KS5hZGQoNDUsICdtaW51dGVzJyk7CmlmICh2aWV3Lm5hbWUgPT09ICJtb250aCIpIHsKY2FsZW5kYXIgPSAiY2FsZW5kYXJfYnVzaW5lc3MiOwp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdjaGFuZ2VWaWV3JywgImFnZW5kYVdlZWsiKTsKfSBlbHNlIHsKJHNjb3BlLmV2ZW50Q3JlYXRlTW9kYWwoZGF0ZSk7Cn0KLy8gY2hhbmdlIHRoZSBib3JkZXIgY29sb3IganVzdCBmb3IgZnVuCi8vICQodGhpcykuY3NzKCdib3JkZXItY29sb3InLCAncmVkJyk7Cgp9LApldmVudFJlbmRlcjogZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpCnsKaWYgKCFldmVudC5ldmVudF9pZD4wKQp7Ci8vIG5vdCBhIHJlYWwgZXZlbnQgLSBwcm9iYWJseSBibG9jayAvIGJhY2tncm91bmQKLy8gaWdub3JpbmcgaXQKcmV0dXJuOwp9Ci8vIGNoYW5naW5nIGxvb2sgYW5kIGZlZWwgb2YgZXZlbiB0aGF0IGlzIHRvIHJlc2NoZWR1bGUKaWYgKHNoYXJlZFByb3BlcnRpZXMuZ2V0X2V2ZW50X3Jlc2NoZWR1bGUoKSE9bnVsbCkKewppZiAoZXZlbnQuZXZlbnRfaWQ9PXNoYXJlZFByb3BlcnRpZXMuZ2V0X2V2ZW50X3Jlc2NoZWR1bGUoKS5ldmVudF9pZCkKewplbGVtZW50LmNzcygnYmFja2dyb3VuZC1jb2xvcicsICcjQTlBOUE5CScpOwplbGVtZW50LmNzcygnYm9yZGVyLWNvbG9yJywgJyNBOUE5QTkJJyk7CnJldHVybjsKfQp9CiAgICAgICAgICAgICAgICBpZiAoZXZlbnQuaXNfZ2VuZXJpY19ldHlwZT09MSkKICAgICAgICAgICAgICAgIHsKCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIGlmIChldmVudC5pc19jbGFzcz09MSkKewovLyBpZiBjbGFzcyBhZGRpbmcgbnVtYmVyIG9mIHBhcnRpY2lwYW50cwppZiAoZXZlbnQubm9fb2Zfd2FpdGluZ191c2Vycz4wKQp7CmVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZChldmVudC5ub19vZl91c2VycysiLyIrZXZlbnQubWF4X3BhcnRpY2lwYW50cysgIiAoIitldmVudC5ub19vZl93YWl0aW5nX3VzZXJzKyIpIisiIC0gIik7Cn0KZWxzZQp7CmVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZChldmVudC5ub19vZl91c2VycysiLyIrZXZlbnQubWF4X3BhcnRpY2lwYW50cysiIC0gIik7Cn0KfQplbHNlCnsKLy8gaWYgbm90IGNsYXNzIC0gd3JpdGluZyB0aGUgZW5kdXNlciBuYW1lCmlmIChldmVudC5kdXJhdGlvbl9ldmVudCE9MCkgLy8gYWxzbyBpZiBub3QgaG91cnMgb2Ygd29yawp7Ci8vIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykuYXBwZW5kKCIgKCIrZXZlbnQuZXZlbnRVc2Vyc1swXS5idXNlcl9maXJzdF9uYW1lKyIgIitldmVudC5ldmVudFVzZXJzWzBdLmJ1c2VyX2xhc3RfbmFtZSsiKSIpOwovLyBjb25zb2xlLmxvZyhldmVudC5ldmVudFVzZXJzKTsKLy8gY29uc29sZS5sb2coZXZlbnQuZXZlbnRVc2Vycy5sZW5ndGgpOwogICAgICAgICAgICAgICAgICAgIC8vIGlmIChldmVudC5ldmVudFVzZXJzLmxlbmd0aD4wKQp7CiAgICAgICAgICAgICAgICAgICAgICAvLyBlbGVtZW50LmZpbmQoJy5mYy10aXRsZScpLnByZXBlbmQoIiIrZXZlbnQuZXZlbnRVc2Vyc1swXS5idXNlcl9maXJzdF9uYW1lKyIgIitldmVudC5ldmVudFVzZXJzWzBdLmJ1c2VyX2xhc3RfbmFtZSsiICgiKTsKICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZCgiIitldmVudC5ldmVudF91c2VyX2NsaWVudHMrIiAoIik7CmVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykuYXBwZW5kKCIpIik7Cn0KfQovLyBsb2dEZWJ1ZygiaGVyZTQiKTsKfQppZiAoZXZlbnQuaXNfcmVwZWF0aW5nID09IDEpIHsKZWxlbWVudC5maW5kKCIuZmMtdGl0bGUiKS5hcHBlbmQoIiZuYnNwOzxpIGNsYXNzPSdmYSBmYS1yZXBlYXQnPjwvaT4mbmJzcDsiKTsKLy8gIGVsZW1lbnQuZmluZCgiLmZjLXRpdGxlIikuYXBwZW5kKCImbmJzcDs8aW1nIHNyYz0nL3B1YmxpYy9pbWFnZXMvcmVjdXJyaW5nLWljb24ucG5nJyB3aWR0aD0nMTBweCcgaGVpZ2h0PScxMHB4Jy8+Iik7Cn0KfSwKbWluVGltZTogJGdDYWxlbmRhckRpc3BsYXlNaW5UaW1lLAptYXhUaW1lOiAkZ0NhbGVuZGFyRGlzcGxheU1heFRpbWUsCnNlbGVjdGFibGU6IGZhbHNlLApzZWxlY3RIZWxwZXI6IGZhbHNlLAp0aW1lem9uZTogZmFsc2UsCmlzUlRMOiB0cnVlLApsYW5nOiAiaGUiLCAvLyBrawphbGxEYXlTbG90OiBmYWxzZSwKbG9hZGluZzogZnVuY3Rpb24oYm9vbCkgewppZiAoYm9vbCkgewogICAgICAgICAgICAgICAgICAgIGxvZ0RlYnVnKCdsb2FkaW5nIGNhbGVuZGFyMSAnICsgJHNjb3BlLmNhbGVuZGFyKTsKLy8gJCgnI2xvYWRpbmcnKS5zaG93KCk7Cn0gZWxzZSB7Ci8vICQoJyNsb2FkaW5nJykuaGlkZSgpOwpsb2dEZWJ1ZygnZmluaXNoZWQgbG9hZGluZyBjYWxlbmRhciB4JyArICRzY29wZS5jYWxlbmRhcik7CiRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlKCk7CmxvZ0RlYnVnKCJhZnRlciBjYWxlbmRhciBsb2FkIHZpc2libGVEYXRlU3RhcnQ9Iit1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ2V0VmlldycpLnN0YXJ0KTsKdmlzaWJsZURhdGVTdGFydCA9IG5ldyBEYXRlKHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3Jykuc3RhcnQpOwpkYXRlVG9Hb1RvID0gdmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpICsgIi0iICsgKCcwJyArICh2aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkgKyAxKSkuc2xpY2UoLTIpICsgIi0iICsgKCcwJyArIHZpc2libGVEYXRlU3RhcnQuZ2V0RGF0ZSgpKS5zbGljZSgtMik7Ci8vIGNvbnNvbGUubG9nKCJkYXRlVG9Hb1RvIitkYXRlVG9Hb1RvKTsKLy8gJGh0dHAuZ2V0KCRnQXBpVVJMUHJlZml4ICsgIi9lbmR1c2VyL2V2ZW50cy9zdWdnZXN0LyIrdmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpKyIvIit0aGlzX3dlZWtfZnVsbF95ZWFyKyIvIit0aGlzX3dlZWtfbW9udGgrIi8iK3RoaXNfd2Vla19kYXlfb2ZfbW9udGgrIi8iKyB0aGlzX3dlZWtfaG91cnMrICIvIiArIHRoaXNfd2Vla19taW51dGVzKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKQokc2NvcGUuZXZlbnRfdHlwZV9pZD0kc2NvcGUuc2VsZWN0ZWRfZXZlbnRfdHlwZV9pZDsKJHNjb3BlLnZpc2libGVEYXRlU3RhcnQ9dmlzaWJsZURhdGVTdGFydDsKLy8xMjEyMTIKLy8gaWYgKCRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkX2lzX2NsYXNzKQovLyB7Ci8vICAgJGh0dHAuZ2V0KCRnQXBpVVJMUHJlZml4ICsgIi9lbmR1c2VyL2V2ZW50cy9zdWdnZXN0Y2xhc3MvIiskc2NvcGUuZXZlbnRfdHlwZV9pZCsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSsiLyIrKCRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkrMSkrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0SG91cnMoKSArICIvIiArICRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKSsgIi8iICsgJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJfaWQpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpCi8vICAgewovLyAgICAgICAvLwkgICAgJHNjb3BlLm15RGF0YSA9IHJlc3BvbnNlLmRhdGE7Ci8vICAgICAgIC8vCQlsb2dEZWJ1ZygiZ3JpZG9wdGlvbnM9Iiskc2NvcGUuZ3JpZE9wdGlvbnMpOwovLyAgICAgICAkc2NvcGUuZXZlbnRzU3VnZ2VzdGVkID0gcmVzcG9uc2UuZGF0YTsKLy8gICAgICAgLy8gJHNjb3BlLmRhdGVUb0dvVG89ZGF0ZVRvR29UbzsKLy8gICB9KTsKLy8gfQovLyBlbHNlCi8vIHsKLy8gICAkaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3QvIiskc2NvcGUuZXZlbnRfdHlwZV9pZCsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSsiLyIrKCRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkrMSkrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0SG91cnMoKSArICIvIiArICRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkKLy8gICB7Ci8vICAgICAgIC8vCSAgICAkc2NvcGUubXlEYXRhID0gcmVzcG9uc2UuZGF0YTsKLy8gICAgICAgLy8JCWxvZ0RlYnVnKCJncmlkb3B0aW9ucz0iKyRzY29wZS5ncmlkT3B0aW9ucyk7Ci8vICAgICAgICRzY29wZS5ldmVudHNTdWdnZXN0ZWQgPSByZXNwb25zZS5kYXRhOwovLyAgICAgICAvLyAkc2NvcGUuZGF0ZVRvR29Ubz1kYXRlVG9Hb1RvOwovLyAgIH0pOwovLyB9CgovLyBhZnRlciBjYWxlbmRhciBpcyBsb2FkZWQgLSBsb2FkaW5nIGV2ZW50IHR5cGVzIGFuZCBzdWdnZXN0aW9uIGZvciBxdWV1ZXMKLy8gd2UgaGFuZGxlIHRoaW5ncyByZWxhdGVkIHRvIHRoZSBldmVudCB0eXBlcyBvbmx5IGFmdGVyIGxvYWRpbmcgdGhlbSAoYW5kIHRoZSBjYWxlbmRhcikKZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzTm9TeXN0ZW0oJGh0dHAsJHNjb3BlLCdldmVudF90eXBlcycsZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzTm9TeXN0ZW1fY2FsbGJhY2spOwoKZnVuY3Rpb24gZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzTm9TeXN0ZW1fY2FsbGJhY2soKQp7ICAgIC8vIGNoZWNraW5nIGlmIGNhbGVuZGFyIHNob3VsZCBzdGFydCB3aXRoIGEgc3BlY2lmaWMgZXZlbnQgdHlwZSBmb3Igc3VnZ2VzdGlvbnMKLy8gbG9nRGVidWcoIlggc2hhcmVkUHJvcGVydGllcy5nZXRfZXZlbnRfdHlwZV9mb3Jfc3VnZ2VzdGlvbnM9IitzaGFyZWRQcm9wZXJ0aWVzLmdldF9ldmVudF90eXBlX2Zvcl9zdWdnZXN0aW9ucygpKTsKaWYgKHNoYXJlZFByb3BlcnRpZXMuZ2V0X2V2ZW50X3R5cGVfZm9yX3N1Z2dlc3Rpb25zKCkhPW51bGwpCnsKJHNjb3BlLnNlbGVjdGVkX2V2ZW50X3R5cGVfaWQ9c2hhcmVkUHJvcGVydGllcy5nZXRfZXZlbnRfdHlwZV9mb3Jfc3VnZ2VzdGlvbnMoKTsKJHNjb3BlLmV2ZW50VHlwZVNlbGVjdGVkKCRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkKTsKfQoKLy8gZmlyc3QgY2hlY2tpbmcgaWYgdGhlcmUncyBhbiBldmVudCB0byByZXNjaGVkdWxlCmlmIChzaGFyZWRQcm9wZXJ0aWVzLmdldF9ldmVudF9yZXNjaGVkdWxlKCkhPW51bGwpCnsKJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGU9dHJ1ZTsKJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGVfZXZlbnQ9c2hhcmVkUHJvcGVydGllcy5nZXRfZXZlbnRfcmVzY2hlZHVsZSgpOwpzaGFyZWRQcm9wZXJ0aWVzLnNldF9ldmVudF9yZXNjaGVkdWxlKG51bGwpOwpsb2dEZWJ1ZygiZ290IGV2ZW50IHRvIHJlc2NoZWR1bGUgIitKU09OLnN0cmluZ2lmeSgkc2NvcGUucHJldmlvdXNfZXZlbnRfcmVzY2hlZHVsZV9ldmVudCkpOwpsb2dEZWJ1ZygicmVzY2hlZHVsZSBldmVudF90eXBlX2lkPSIrJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGVfZXZlbnQuZXZlbnRfdHlwZV9pZCk7CiRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkPSRzY29wZS5wcmV2aW91c19ldmVudF9yZXNjaGVkdWxlX2V2ZW50LmV2ZW50X3R5cGVfaWQ7CiRzY29wZS5ldmVudFR5cGVTZWxlY3RlZCgpOwp9Ci8vIGNoZWNraW5nIHNlbGVjdGVkIHVzZXIgb25seSBpZiB0aGVyZSdzIG5vIHNlbGVjdGVkIGV2ZW50IHRvIG1vdmUKZWxzZSBpZiAoc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpIT1udWxsKQp7CmNvbnNvbGUubG9nKCJnb3QgcHJldmlvdXMgc2VsZWN0ZWQgdXNlciAiK3NoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKS5idXNlcl9maXJzdF9uYW1lKTsKJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJuYW1lPXNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKS5idXNlcl9maXJzdF9uYW1lKyIgIitzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfbGFzdF9uYW1lOwokc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcl9pZD1zaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzaW5lc3NfdXNlcl9pZDsKbG9nRGVidWcoIiRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyX2lkPSIrJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJfaWQpOwoKJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXI9dHJ1ZTsKfQp9Cn0KCn0sCi8vIHNlbGVjdDogZnVuY3Rpb24oc3RhcnQsIGVuZCwgYWxsRGF5KSB7Ci8vICAgICAvLyB2YXIgdGl0bGUgPSBwcm9tcHQoJ0V2ZW50IFRpdGxlOicgKyAoc3RhcnQgKyAzNTI4MDAwMDApIC8gKDYwICogMTAwMCkgKyAiICIgKyBlbmQgKyAiICIgKyBhbGxEYXkpOwovLyAgICAgdGl0bGUgPSAi16nXoteV16og16TXoteZ15zXldeqIjsKLy8gICAgIGlmICh0aXRsZSkgewovLyAgICAgICAgIGxvZ0RlYnVnKCJjcmVhdGluZyBkZXZlbnQgc3RhcnQiKTsKLy8gICAgICAgICBsb2dEZWJ1Zygic3RhcnQ9IiArIHN0YXJ0KTsKLy8gICAgICAgICBjaGVja0RhdGUgPSBuZXcgRGF0ZShzdGFydCk7Ci8vICAgICAgICAgbG9nRGVidWcoImNoZWNrIGRhdGUgPSAiICsgY2hlY2tEYXRlKQovLyAgICAgICAgIGxvZ0RlYnVnKCJlbmQ9IiArIGVuZCk7Ci8vICAgICAgICAgZWNvbG9yID0gIiMiICsgJHNjb3BlLmV2ZW50Q29sb3I7IC8vZ2V0UmFuZG9tQ29sb3IoKTsKLy8KLy8KLy8gICAgICAgICAvLyB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tdLmZ1bGxDYWxlbmRhcigncmVyZW5kZXJFdmVudHMnKTsKLy8KLy8gICAgICAgICBjYWxlbmRhciA9ICRzY29wZS5jYWxlbmRhcl9uYW1lOwovLyAgICAgICAgIHRlbXBfbGltaXRfaWQgPSAkZ0NhbGVuZGFyVGVtcEVudklEMSAtIGdldFJhbmRvbUludCgxMCwgODApOwovLyAgICAgICAgIG5ld0V2ZW50ID0gewovLyAgICAgICAgICAgICBpZDogdGVtcF9saW1pdF9pZCwKLy8gICAgICAgICAgICAgdGl0bGU6IHRpdGxlLAovLyAgICAgICAgICAgICBzdGFydDogc3RhcnQsCi8vICAgICAgICAgICAgIGNvbG9yOiBlY29sb3IsCi8vICAgICAgICAgICAgIGVuZDogZW5kLAovLyAgICAgICAgICAgICBhbGxEYXk6IGZhbHNlLAovLyAgICAgICAgICAgICBjbGFzc05hbWU6IFsnb3BlblNlc2FtZSddCi8vICAgICAgICAgICAgICAgICAvLyBjb2xvcjogcmVzb3VyY2UuZXZlbnRDb2xvcgovLyAgICAgICAgIH07Ci8vICAgICAgICAgY2FsZW5kYXIgPSAkc2NvcGUuY2FsZW5kYXJfbmFtZTsKLy8KLy8gICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZW5kZXJFdmVudCcsIG5ld0V2ZW50LCB0cnVlKTsKLy8gICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCd1bnNlbGVjdCcpOwovLwovLyAgICAgICAgIGxvZ0RlYnVnKCJjcmVhdGluZyBkZXZlbnQgZW5kIik7Ci8vICAgICAgICAgJHNjb3BlLmFkZEV2ZW50VG9EYXRhYmFzZShzdGFydCwgZW5kLCB0aXRsZSwgZWNvbG9yLCB0ZW1wX2xpbWl0X2lkKTsKLy8KLy8gICAgIH0KLy8gfQp9Cn07Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignSG91cnNPZldvcmtDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGNvbXBpbGUsICRsb2NhdGlvbiwgdWlDYWxlbmRhckNvbmZpZywgJHVpYk1vZGFsKSB7CmxvZ0RlYnVnKCdIb3Vyc09mV29yayBDb250cm9sbGVyJyk7Cgpsb2dEZWJ1ZygiJGxvY2F0aW9uLnNlYXJjaCgpLnN0YXJ0PSIgKyAkbG9jYXRpb24uc2VhcmNoKCkuc3RhcnQpOwppZiAodHlwZW9mICRsb2NhdGlvbi5zZWFyY2goKS5zdGFydCA9PSAndW5kZWZpbmVkJykgewpjdXJyRGVmYXVsdERhdGUgPSAkZ0hvdXIwZGF0ZTsKJHNjb3BlLmZpeGVkU2NoZWR1bGUgPSB0cnVlOwokc2NvcGUuY2FsZW5kYXJUaXRsZUNlbnRlciA9ICLXqdei15XXqiDXpNei15nXnNeV16og16fXkdeV16LXldeqIjsKbG9nRGVidWcoItep16LXldeqINek16LXmdec15XXqiDXp9eR15XXoteV16oiKTsKaG91cnNPZldvcmtEZWZhdWx0Vmlldz0nZG9udFNob3dEYXRlJzsKfSBlbHNlIHsKY3VyckRlZmF1bHREYXRlID0gJGxvY2F0aW9uLnNlYXJjaCgpLnN0YXJ0Owokc2NvcGUuZml4ZWRTY2hlZHVsZSA9IGZhbHNlOwovLyAkc2NvcGUuY2FsZW5kYXJUaXRsZUNlbnRlciA9ICLXqdei15XXqiDXpNei15nXnNeV16og16fXkdeV16LXldeqIjsKaG91cnNPZldvcmtEZWZhdWx0Vmlldz0nYWdlbmRhV2Vlayc7Cn0KCgokc2NvcGUudmlzaWJsZURhdGUgPSBbXTsKJHNjb3BlLmNhbGVuZGFyID0gJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnOwokc2NvcGUuc2VsZWN0ZWRFdmVudFR5cGUgPSBbXTsKCmdldEFsbEJ1c2luZXNzRXZlbnRUeXBlcygkaHR0cCwkc2NvcGUsJ2V2ZW50X3R5cGVzJyxnZXRBbGxCdXNpbmVzc0V2ZW50VHlwZXNfY2FsbGJhY2spOwoKZnVuY3Rpb24gZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzX2NhbGxiYWNrKCkKewokc2NvcGUuc2VsZWN0RXZlbnRUeXBlKCRzY29wZS5ldmVudF90eXBlc1swXSk7Cn0KJHNjb3BlLmJhY2tUb0NhbGVuZGFyID0gZnVuY3Rpb24oKSB7CnZpc2libGVEYXRlU3RhcnQgPSBuZXcgRGF0ZSh1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ2V0VmlldycpLnN0YXJ0KTsKZGF0ZVRvR29UbyA9IHZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSArICItIiArICgnMCcgKyAodmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpICsgMSkpLnNsaWNlKC0yKSArICItIiArICgnMCcgKyB2aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSkuc2xpY2UoLTIpOwokbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2NhbGVuZGFyJykuc2VhcmNoKHsKc3RhcnQ6IGRhdGVUb0dvVG8KfSk7Cn0KJHNjb3BlLnNlbGVjdEV2ZW50VHlwZSA9IGZ1bmN0aW9uKGV2ZW50VHlwZSkgewokc2NvcGUuc2VsZWN0ZWRFdmVudFR5cGUgPSBldmVudFR5cGU7CmxvZ0RlYnVnKCJzZWxlY3RlZCBFdmVudCBUeXBlID0gIiArICRzY29wZS5zZWxlY3RlZEV2ZW50VHlwZS5ldmVudF90eXBlX2lkICsgIiwgIiArICRzY29wZS5zZWxlY3RlZEV2ZW50VHlwZS5ldmVudF90eXBlX25hbWUpOwprdXplSXNDYWxlbmRhckRyYWdnYmxlID0gJHNjb3BlLnNlbGVjdGVkRXZlbnRUeXBlLmRpZmZfcmFuZ2U7Cn07Cgokc2NvcGUuY2hhbmdlRXZlbnRDb2xvciA9IGZ1bmN0aW9uKG5ld0NvbG9yKSB7CiRzY29wZS5ldmVudENvbG9yID0gbmV3Q29sb3I7CmFsbGxFdmVudHNBcnJheSA9IHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2NsaWVudEV2ZW50cycpOwpmb3IgKGkgaW4gYWxsbEV2ZW50c0FycmF5KSB7CmFsbGxFdmVudHNBcnJheVtpXS5jb2xvciA9ICIjIiArIG5ld0NvbG9yOwp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCd1cGRhdGVFdmVudCcsIGFsbGxFdmVudHNBcnJheVtpXSk7Cn0KfTsKCiRzY29wZS5ldmVudENsaWNrTW9kdWxlID0gZnVuY3Rpb24oc2VsZWN0ZWRFdmVudCwgc2l6ZSkgewpsb2dEZWJ1Zygic2VsZWN0ZWQgRXZlbnQgdGl0bGU9IiArIHNlbGVjdGVkRXZlbnQudGl0bGUpOwoKCnZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewphbmltYXRpb246IGZhbHNlLAp0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9saW1pdGF0aW9uX2RldGFpbHMuaHRtbCcsCmNvbnRyb2xsZXI6ICdldmVudERldGFpbHNIb3Vyc09mV29ya01vZGFsQ29udHJvbGxlcicsCnNpemU6IHNpemUsCnJlc29sdmU6IHsKc2VsZWN0ZWRFdmVudDogZnVuY3Rpb24oKSB7CnJldHVybiBzZWxlY3RlZEV2ZW50Owp9LApmaXhlZFNjaGVkdWxlOiBmdW5jdGlvbiAoKQp7CnJldHVybiAkc2NvcGUuZml4ZWRTY2hlZHVsZTsKfQp9Cn0pOwoKbW9kYWxJbnN0YW5jZS5yZXN1bHQudGhlbihmdW5jdGlvbihzZWxlY3RlZEl0ZW0pIHsKJHNjb3BlLnNlbGVjdGVkID0gc2VsZWN0ZWRJdGVtOwp9LCBmdW5jdGlvbigpIHsKbG9nRGVidWcoJ01vZGFsIGRpc21pc3NlZCBhdDogJyArIG5ldyBEYXRlKCkpOwp9KTsKfTsKCgp2YXIgZGF0ZSA9IG5ldyBEYXRlKCk7CnZhciBkID0gZGF0ZS5nZXREYXRlKCk7CnZhciBtID0gZGF0ZS5nZXRNb250aCgpOwp2YXIgeSA9IGRhdGUuZ2V0RnVsbFllYXIoKTsKCgpmdW5jdGlvbiBnZXRUaW1lU3RhbXAobm93KSB7CnJldHVybiAoKG5vdy5nZXRNb250aCgpICsgMSkgKyAnLycgKyAobm93LmdldERhdGUoKSkgKyAnLycgKyBub3cuZ2V0RnVsbFllYXIoKSArICIgIiArIG5vdy5nZXRIb3VycygpICsgJzonICsgKChub3cuZ2V0TWludXRlcygpIDwgMTApID8gKCIwIiArIG5vdy5nZXRNaW51dGVzKCkpIDogKG5vdy5nZXRNaW51dGVzKCkpKSArICc6JyArICgobm93LmdldFNlY29uZHMoKSA8IDEwKSA/ICgiMCIgKyBub3cKLmdldFNlY29uZHMoKSkgOiAobm93LmdldFNlY29uZHMoKSkpKTsKfQoKCi8qIENoYW5nZSBWaWV3ICovCiRzY29wZS5jaGFuZ2VWaWV3ID0gZnVuY3Rpb24odmlldywgY2FsZW5kYXIpIHsKbG9nRGVidWcoImNoYW5nZSB2aWV3ICIgKyB2aWV3KTsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignY2hhbmdlVmlldycsIHZpZXcpOwp9OwovKiBDaGFuZ2UgVmlldyAqLwoKJHNjb3BlLnJlbmRlckNhbGVuZGVyID0gZnVuY3Rpb24oY2FsZW5kYXIpIHsKJHRpbWVvdXQoZnVuY3Rpb24oKSB7CmlmICh1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0pIHsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVuZGVyJyk7Cn0KfSk7Cn07Cgokc2NvcGUuY2hhbmdlU2VsZWN0YWJsZSA9IGZ1bmN0aW9uKCkgewprdXplSXNDYWxlbmRhckRyYWdnYmxlID0gIWt1emVJc0NhbGVuZGFyRHJhZ2dibGU7CmNhbGVuZGFyID0gJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnOwovLyB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3JykuY2FsZW5kYXIub3B0aW9ucy5zZWxlY3RhYmxlID0gZmFsc2U7CnZpZXcgPSB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdvcHRpb24nLCAnc2VsZWN0YWJsZScsIGZhbHNlKTsKLy8gdmlldy5jYWxlbmRhci5vcHRpb25zLnNlbGVjdGFibGUgPSBmYWxzZTsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVuZGVyJyk7Cgp9Ci8qIGNvbmZpZyBvYmplY3QgKi8KCiRzY29wZS5jYWxlbmRhcl9ob3Vyc19vZl93b3JrX2NvbmZpZyA9IHsKY2FsZW5kYXI6IHsKaGVpZ2h0OiAnYXV0bycsCmVkaXRhYmxlOiB0cnVlLAovLyBoZWFkZXI6IHsKLy8gICAgIGxlZnQ6ICcnLAovLyAgICAgY2VudGVyOiAnJywKLy8gICAgIHJpZ2h0OiAnJwovLyB9LApoZWFkZXI6ICcnLAovLyBoZWFkZXI6IHsKLy8gICAgIGxlZnQ6ICd0aXRsZScsCi8vICAgICBjZW50ZXI6ICcnLAovLyAgICAgcmlnaHQ6ICd0b2RheSBwcmV2LG5leHQnCi8vIH0sCi8vIGRlZmF1bHRWaWV3OiAnYWdlbmRhV2VlaycsCnZpZXdzOiB7CmRvbnRTaG93RGF0ZTogewp0eXBlOiAnYWdlbmRhV2VlaycsCmR1cmF0aW9uOiB7CmRheXM6IDcKfSwKdGl0bGU6ICdBcGVydHVyYScsCmNvbHVtbkZvcm1hdDogJ2RkZGQnIC8vIEZvcm1hdCB0aGUgZGF5IHRvIG9ubHkgc2hvdyBsaWtlICdNb25kYXknCi8vIGhpZGRlbkRheXM6IFswLCA2XSAvLyBIaWRlIFN1bmRheSBhbmQgU2F0dXJkYXk/Cn0sCmRvU2hvd0RhdGU6IHsKdHlwZTogJ2FnZW5kYVdlZWsnLApkdXJhdGlvbjogewpkYXlzOiA3Cn0sCnRpdGxlOiAnQXBlcnR1cmEnLAoKLy8gaGlkZGVuRGF5czogWzAsIDZdIC8vIEhpZGUgU3VuZGF5IGFuZCBTYXR1cmRheT8KfQp9LApldmVudERyb3A6IGZ1bmN0aW9uKGV2ZW50LCBkYXlEZWx0YSwgbWludXRlRGVsdGEsIGFsbERheSwgcmV2ZXJ0RnVuYywgdWlDYWxlbmRhckNvbmZpZykgewpsb2dEZWJ1ZygiZXZlbnRkcm9wIiArIGV2ZW50LnRpdGxlICsgIigiICsgZXZlbnQuaWQgKyAiKSBtb3ZlZCAiICsgbWludXRlRGVsdGEgKyAiIG1pbnV0ZXMiKTsKbG9nRGVidWcoIm9sZCBzdGFydD0iICsgZXZlbnQuc3RhcnQgKyAiLCBvbGQgZW5kPSIgKyBldmVudC5lbmQpOwokc2NvcGUudXBkYXRlTGltaXRhdGlvbkRhdGFiYXNlKGV2ZW50LnN0YXJ0LCBldmVudC5lbmQsIGV2ZW50LmlkLCBldmVudC50ZW1wX2xpbWl0X2lkLCBldmVudCk7Cn0sCmV2ZW50UmVzaXplOiBmdW5jdGlvbihldmVudCwgZGVsdGEsIHJldmVydEZ1bmMpIHsKbG9nRGVidWcoImV2ZW50cmVzaXplLCBldmVudC5lbmQ9IiArIGV2ZW50LmVuZCk7CiRzY29wZS51cGRhdGVMaW1pdGF0aW9uRGF0YWJhc2UoZXZlbnQuc3RhcnQsIGV2ZW50LmVuZCwgZXZlbnQuaWQsIGV2ZW50LnRlbXBfbGltaXRfaWQsIGV2ZW50KTsKfSwKZGVmYXVsdFZpZXc6IGhvdXJzT2ZXb3JrRGVmYXVsdFZpZXcsCmV2ZW50Q2xpY2s6IGZ1bmN0aW9uKGNhbEV2ZW50LCBqc0V2ZW50LCB2aWV3KSB7CmxvZ0RlYnVnKCJldmVudCBjbGlja2VkICIgKyBjYWxFdmVudC50aXRsZSArICIoaWQ9IiArIGNhbEV2ZW50LmlkICsgIiwgZGF5X2xpbWl0X2lkPSIgKyBjYWxFdmVudC5kYXlfbGltaXRfaWQgKyAiLCB0ZW1wX2xpbWl0X2lkPSIgKyBjYWxFdmVudC50ZW1wX2xpbWl0X2lkICsgIiwgbGltaXRfaWQ9IiArIGNhbEV2ZW50LmxpbWl0X2lkICsgIikgc3RhcnQ9IiArIGNhbEV2ZW50LnN0YXJ0ICsgIiwgZW5kPSIgKyBjYWxFdmVudC5lbmQpOwokc2NvcGUuZXZlbnRDbGlja01vZHVsZShjYWxFdmVudCk7Ci8vIGNoYW5nZSB0aGUgYm9yZGVyIGNvbG9yIGp1c3QgZm9yIGZ1bgovLyAkKHRoaXMpLmNzcygnYm9yZGVyLWNvbG9yJywgJ3JlZCcpOwoKfSwKZXZlbnRSZW5kZXI6IGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KQp7CmNvbnNvbGUubG9nKGV2ZW50KTsKZWxlbWVudC5maW5kKCcuZmMtdGl0bGUnKS5wcmVwZW5kKGV2ZW50LmxvY2F0aW9uX25hbWUrIiAvIDxici8+Iik7CmVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZChldmVudC5pbnN0cnVjdG9yX25hbWUrIiAvIDxici8+Iik7Ci8vIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZCgiIitldmVudC5ldmVudFVzZXJzWzBdLmJ1c2VyX2ZpcnN0X25hbWUrIiAiK2V2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfbGFzdF9uYW1lKyIgKCIpOwoKLy8gY29uc29sZS5sb2coInJlbmRlciBsaW1pdGF0aW9uICIrSlNPTi5zdHJpbmdpZnkoZXZlbnQpKTsKLy8gaWYgKGV2ZW50LmlzX2NsYXNzPT0xKQovLyB7Ci8vICAgLy8gaWYgY2xhc3MgYWRkaW5nIG51bWJlciBvZiBwYXJ0aWNpcGFudHMKLy8gICBpZiAoZXZlbnQubm9fb2Zfd2FpdGluZ191c2Vycz4wKQovLyAgIHsKLy8gICAgIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZChldmVudC5ub19vZl91c2VycysiLyIrZXZlbnQubWF4X3BhcnRpY2lwYW50cysgIiAoIitldmVudC5ub19vZl93YWl0aW5nX3VzZXJzKyIpIisiIC0gIik7Ci8vICAgfQovLyAgIGVsc2UKLy8gICB7Ci8vICAgICBlbGVtZW50LmZpbmQoJy5mYy10aXRsZScpLnByZXBlbmQoZXZlbnQubm9fb2ZfdXNlcnMrIi8iK2V2ZW50Lm1heF9wYXJ0aWNpcGFudHMrIiAtICIpOwovLyAgIH0KLy8gfQovLyBlbHNlCi8vIHsKLy8gICAvLyBpZiBub3QgY2xhc3MgLSB3cml0aW5nIHRoZSBlbmR1c2VyIG5hbWUKLy8gICBpZiAoZXZlbnQuZHVyYXRpb25fZXZlbnQhPTApIC8vIGFsc28gaWYgbm90IGhvdXJzIG9mIHdvcmsKLy8gICB7Ci8vICAgICAvLyBlbGVtZW50LmZpbmQoJy5mYy10aXRsZScpLmFwcGVuZCgiICgiK2V2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfZmlyc3RfbmFtZSsiICIrZXZlbnQuZXZlbnRVc2Vyc1swXS5idXNlcl9sYXN0X25hbWUrIikiKTsKLy8gICAgIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZCgiIitldmVudC5ldmVudFVzZXJzWzBdLmJ1c2VyX2ZpcnN0X25hbWUrIiAiK2V2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfbGFzdF9uYW1lKyIgKCIpOwovLyAgICAgZWxlbWVudC5maW5kKCcuZmMtdGl0bGUnKS5hcHBlbmQoIikiKTsKLy8gICB9Ci8vICAgLy8gbG9nRGVidWcoImhlcmU0Iik7Ci8vIH0KLy8gaWYgKGV2ZW50LmlzX3JlcGVhdGluZyA9PSAxKSB7Ci8vICAgICBlbGVtZW50LmZpbmQoIi5mYy10aXRsZSIpLnByZXBlbmQoIiZuYnNwOzxpIGNsYXNzPSdmYSBmYS1yZXBlYXQnPjwvaT4mbmJzcDsiKTsKLy8gICAgIC8vICBlbGVtZW50LmZpbmQoIi5mYy10aXRsZSIpLmFwcGVuZCgiJm5ic3A7PGltZyBzcmM9Jy9wdWJsaWMvaW1hZ2VzL3JlY3VycmluZy1pY29uLnBuZycgd2lkdGg9JzEwcHgnIGhlaWdodD0nMTBweCcvPiIpOwovLyB9Cn0sCm1pblRpbWU6ICRnQ2FsZW5kYXJEaXNwbGF5TWluVGltZSwKbWF4VGltZTogJGdDYWxlbmRhckRpc3BsYXlNYXhUaW1lLApzZWxlY3RhYmxlOiB0cnVlLApzZWxlY3RIZWxwZXI6IGZhbHNlLAp0aW1lem9uZTogZmFsc2UsCmlzUlRMOiB0cnVlLApsYW5nOiAiaGUiLApzZWxlY3RDb25zdHJhaW50OiB7CnN0YXJ0OiAnMDA6MDEnLAplbmQ6ICcyMzo1OScsCn0sCmRlZmF1bHREYXRlOiBtb21lbnQoY3VyckRlZmF1bHREYXRlKSwKYWxsRGF5U2xvdDogZmFsc2UsCmxvYWRpbmc6IGZ1bmN0aW9uKGJvb2wpIHsKaWYgKGJvb2wpIHsKICAgICAgICAgICAgICAgICAgICBsb2dEZWJ1ZygnbG9hZGluZyBjYWxlbmRhcjIgJyArICRzY29wZS5jYWxlbmRhcik7CgovLyAkKCcjbG9hZGluZycpLnNob3coKTsKfSBlbHNlIHsKLy8gJCgnI2xvYWRpbmcnKS5oaWRlKCk7CmxvZ0RlYnVnKCdmaW5pc2hlZCBsb2FkaW5nIGNhbGVuZGFyICcgKyAkc2NvcGUuY2FsZW5kYXIpOwppZiAoISRzY29wZS5maXhlZFNjaGVkdWxlKSB7CiRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlKCk7Cn0KLy8gJHNjb3BlLmJhY2tUb0ZpeGVkKCk7Cn0KfSwKc2VsZWN0OiBmdW5jdGlvbihzdGFydCwgZW5kLCBhbGxEYXkpIHsKLy8gdGhpcyBpcyBjYWxsZWQgd2hlbiBjcmVhdGluZyBhIG5ldyBibG9jawokc2NvcGUuY3JlYXRlTGltaXRhdGlvbkJsb2NrKHN0YXJ0LCBlbmQpOwp9Cn0KfTsKCi8vIGNyZWF0ZSBsaW1pdGF0aW9uIGJsb2NrCiRzY29wZS5jcmVhdGVMaW1pdGF0aW9uQmxvY2sgPSBmdW5jdGlvbihzdGFydCwgZW5kKQp7CmxvZ0RlYnVnKCJmdW5jdGlvbjogY3JlYXRlTGltaXRhdGlvbkJsb2NrIik7CnZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewphbmltYXRpb246IGZhbHNlLAp0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9saW1pdGF0aW9uX2NyZWF0ZS5waHAnLApzaXplOiAneHMnLApjb250cm9sbGVyOiAnYnVzaW5lc3NfbW9kYWxfbGltaXRhdGlvbl9jcmVhdGUnLApyZXNvbHZlOiB7CnN0YXJ0OiBmdW5jdGlvbigpCnsKcmV0dXJuIHN0YXJ0Owp9LAplbmQ6IGZ1bmN0aW9uKCkKewpyZXR1cm4gZW5kOwp9LApmaXhlZFNjaGVkdWxlOiBmdW5jdGlvbiAoKQp7CnJldHVybiAkc2NvcGUuZml4ZWRTY2hlZHVsZTsKfQp9Cn0pOwp9CiRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlID0gZnVuY3Rpb24oKSB7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3Jyk7Cgp2aXNpYmxlRGF0ZVN0YXJ0ID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5zdGFydCk7CnZpc2libGVEYXRlRW5kID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5lbmQpOwoKJHNjb3BlLmNhbGVuZGFyVGl0bGVDZW50ZXIgPSB2aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSArICIgIiArIG1vbnRoTmFtZXNbdmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpXSArCiIg4oCUICIgKyB2aXNpYmxlRGF0ZUVuZC5nZXREYXRlKCkgKyAiICIgKyBtb250aE5hbWVzW3Zpc2libGVEYXRlRW5kLmdldE1vbnRoKCldICsKIiAiICsgdmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpOwp9OwovKiBldmVudCBzb3VyY2VzIGFycmF5Ki8KJHNjb3BlLmV2ZW50U291cmNlcyA9IFt7CnVybDogJy9hcGkvYWRtaW4vY2FsZW5kYXIvbGltaXRhdGlvbnMvcGVyZGF5L2dldHBvc3QnLAp0eXBlOiAnUE9TVCcKfV07CgovLyAkc2NvcGUuZ2V0RXZlbnRzID0gZnVuY3Rpb24oKSB7Ci8vICAgICBjYWxlbmRhciA9ICdjYWxlbmRhcl9ob3Vyc19vZl93b3JrJzsKLy8gICAgIGFsbGxFdmVudHNBcnJheSA9IHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2NsaWVudEV2ZW50cycpOwovLyAgICAgZm9yIChpIGluIGFsbGxFdmVudHNBcnJheSkgewovLyAgICAgICAgIGxvZ0RlYnVnKGFsbGxFdmVudHNBcnJheVtpXSk7Ci8vICAgICB9Ci8vCi8vIH0KCiRzY29wZS5nb3RvVG9kYXkgPSBmdW5jdGlvbigpIHsKJHNjb3BlLmdvdG9EYXRlKG5ldyBEYXRlKCkpOwp9CiRzY29wZS5nb3RvTmV4dCA9IGZ1bmN0aW9uKCkgewp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignbmV4dCcpOwp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVtb3ZlRXZlbnRzJyk7CiRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlKCk7Cn0KJHNjb3BlLmdvdG9QcmV2ID0gZnVuY3Rpb24oKSB7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZW1vdmVFdmVudHMnKTsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3ByZXYnKTsKJHNjb3BlLnVwZGF0ZUNhbGVuZGFyQ2VudGVyVGl0bGUoKTsKfQokc2NvcGUuZ290b0RhdGUgPSBmdW5jdGlvbihuZXdkYXRlKSB7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnb3RvRGF0ZScsIG5ld2RhdGUpOwp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignY2hhbmdlVmlldycsICdhZ2VuZGFXZWVrJyk7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZW1vdmVFdmVudHMnKTsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKCiRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlKCk7CiRzY29wZS5maXhlZFNjaGVkdWxlID0gZmFsc2U7Cn0KCiRzY29wZS5iYWNrVG9GaXhlZCA9IGZ1bmN0aW9uKCkgewokc2NvcGUuZml4ZWRTY2hlZHVsZSA9IHRydWU7CiRzY29wZS5jYWxlbmRhclRpdGxlQ2VudGVyID0gItep16LXldeqINek16LXmdec15XXqiDXp9eR15XXoteV16oiOwp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignY2hhbmdlVmlldycsICdkb250U2hvd0RhdGUnKTsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dvdG9EYXRlJywgbW9tZW50KCRnSG91cjBkYXRlKSk7CnVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZW1vdmVFdmVudHMnKTsKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKCn0KCi8vICRzY29wZS5kZWxldGVBbGxFdmVudHMgPSBmdW5jdGlvbigpIHsKLy8gICAgIGNhbGVuZGFyID0gJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnOwovLyAgICAgYWxsbEV2ZW50c0FycmF5ID0gdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignY2xpZW50RXZlbnRzJyk7Ci8vICAgICBmb3IgKGkgaW4gYWxsbEV2ZW50c0FycmF5KSB7Ci8vICAgICAgICAgbG9nRGVidWcoYWxsbEV2ZW50c0FycmF5W2ldKTsKLy8gICAgICAgICAkc2NvcGUuZGVsZXRlQ2FsZW5kYXJKU0V2ZW50KGNhbGVuZGFyLCBhbGxsRXZlbnRzQXJyYXlbaV0uaWQpOwovLyAgICAgICAgICRzY29wZS5kZWxldGVDYWxlbmRhckRCRXZlbnQoYWxsbEV2ZW50c0FycmF5W2ldLmlkKTsKLy8gICAgIH0KLy8KLy8gfQokc2NvcGUudXBkYXRlTGltaXRhdGlvbkRhdGFiYXNlID0gZnVuY3Rpb24oc3RhcnRfcGFyYW0sIGVuZF9wYXJhbSwgZXZlbnRfaWQsIHRlbXBfbGltaXRfaWQsIHRoZWV2ZW50KSB7Cgpsb2dEZWJ1ZygidXBkYXRlTGltaXRhdGlvbkRhdGFiYXNlIHN0YXJ0PSIgKyBzdGFydF9wYXJhbSArICIsIGVuZD0iICsgZW5kX3BhcmFtICsgIixldmVudF9pZD0iICsgZXZlbnRfaWQpOwoKZnVuY3Rpb24gdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uX2ZhaWx1cmUoKQp7CmNhbGVuZGFyID0gImNhbGVuZGFyX2hvdXJzX29mX3dvcmsiOwp1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZWZldGNoRXZlbnRzJyk7Cn0KLy8gaWYgdGhlIGV2ZW50IHRoYXQgaXMgZ2V0dGluZyB1cGRhdGVkIGlzIGFuIGV2ZW50IGZyb20gMTk3MCAobm90IHBlcmRheSkKLy8gdGhlbiB3ZSBhZGQgYSBuZXcgcGVyZGF5IGxpbWl0YXRpb24gd2l0aCBsaW1pdF9pZCBvZiB0aGUgMTk3MCBsaW1pdGF0aW9ucyAtIHdpdGggdGhlIG5ldyB0aW1lcy4KCi8vIG90aGVyd2lzZSB3ZSBqdXN0IHVwZGF0ZSB0aGUgcGVyZGF5IGxpbWl0YXRpb24KCmlmICgkc2NvcGUuZml4ZWRTY2hlZHVsZSkgLy8gZml4ZWQgc2NoZWR1bGUgdnMgc3BlY2lmaWMgd2VlZC9kYXkgbGltaXRhdGlvbgp7CnRoZWRhdGEgPSB7CnN0YXJ0X2RhdGU6IHN0YXJ0X3BhcmFtLAplbmRfZGF0ZTogZW5kX3BhcmFtLAp0ZW1wX2xpbWl0X2lkOiB0ZW1wX2xpbWl0X2lkLApsaW1pdF9pZDogZXZlbnRfaWQKfTsKCnVwZGF0ZUNhbGVuZGFyTGltaXRhdGlvbigkaHR0cCwkc2NvcGUsdGhlZGF0YSxldmVudF9pZCwgbnVsbCwgdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uX2ZhaWx1cmUpOwp9CmVsc2UgLy8gbm90IGZpeGVkIHNjaGVkdWxlIC0gZGFpbHkvd2Vla2x5IGxpbWl0YXRpb25zCnsKaWYgKCh0aGVldmVudC5saW1pdF9pZCAhPSBudWxsKSAmICh0aGVldmVudC5kYXlfbGltaXRfaWQgPT0gLTEpKSAvLyBldmVudCBsaW1pdGF0aW9uIGhhcyBsaW1pdF9pZCBzbyBpdHMgYW4gMTk3MCBldmVudAovLyBuZWVkIHRvIGFkZCBhIG5ldyBwZXJkYXkgbGltaXRhdGlvbiB0aGF0IHBvaW50IChsaW1pdF9pZCkgdG8gdGhlIG9sZCAxOTcwIGV2ZW50IHRvIGNhbmNlbCBpdAp7CnRlbXBfbGltaXRfaWQgPSBjYWxjX3RlbXBfbGltaXRfaWQoKTsKdGhlZXZlbnQudGVtcF9saW1pdF9pZCA9IHRlbXBfbGltaXRfaWQ7CnRoZWV2ZW50LmRheV9saW1pdF9pZCA9IHRlbXBfbGltaXRfaWQ7Ci8vIHRoZSBtb3ZlZCBldmVudCBpbiB0aGUgY2FsZW5kYXIgbm93IGhhcyBkYXlfbGltaXRfaWQgYW5kIHRlbXBfbGltaXRfaWQKLy8gaWYgaXRzIGxvYWRlZCBmcm9tIHRoZSBkYiwgaXQgd2lsbCBvbmx5IGhhdmUgZGF5X2xpbWl0X2lkIChhbmQgbm90IHRoZSB0ZW1wIG9uZSkKdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnXS5mdWxsQ2FsZW5kYXIoJ3VwZGF0ZUV2ZW50JywgdGhlZXZlbnQpOwoKdGhlZGF0YSA9IHsKc3RhcnRfZGF0ZTogc3RhcnRfcGFyYW0sCmVuZF9kYXRlOiBlbmRfcGFyYW0sCmNvbG9yOiB0aGVldmVudC5jb2xvciwKdGVtcF9saW1pdF9pZDogdGVtcF9saW1pdF9pZCwKZXZlbnRfdHlwZV9pZDogdGhlZXZlbnQuZXZlbnRfdHlwZV9pZCwKZXZlbnRfdHlwZXM6IHRoZWV2ZW50LmV2ZW50X3R5cGVzLApsb2NhdGlvbl9pZDogdGhlZXZlbnQubG9jYXRpb25faWQsCmVtcF9pZDogdGhlZXZlbnQuZW1wX2lkLApsaW1pdF9pZDogdGhlZXZlbnQuaWQsCnRpdGxlOiB0aGVldmVudC50aXRsZQp9OwpjcmVhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXkoJGh0dHAsJHNjb3BlLHRoZWRhdGEsbnVsbCwgdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uX2ZhaWx1cmUpOwoKfQplbHNlIC8vIGV2ZW50IGxpbWl0YXRpb24gdG8gbW92ZS91cGRhdGUgaGFzIG5vIGxpbWl0X2lkIC0gc28gdGhpcyBpcyBuZXcgcGVyZGF5IGV2ZW50IC0gd2UganVzdCB1cGRhdGUgaXQKewp0aGVkYXRhPSB7CnN0YXJ0X2RhdGU6IHN0YXJ0X3BhcmFtLAplbmRfZGF0ZTogZW5kX3BhcmFtLAp0ZW1wX2RheV9saW1pdF9pZDogdGhlZXZlbnQudGVtcF9saW1pdF9pZCwKbG9jYXRpb25faWQ6IHRoZWV2ZW50LmxvY2F0aW9uX2lkLApkYXlfbGltaXRfaWQ6IHRoZWV2ZW50LmRheV9saW1pdF9pZAp9Owp1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXkoJGh0dHAsJHNjb3BlLHRoZWRhdGEsbnVsbCwgdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uX2ZhaWx1cmUpOwp9Cn0KfTsKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ0V2ZW50Q2xhc3NQYWdlQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHRpbWVvdXQsICRodHRwLCAkcm9vdFNjb3BlLCAkcm91dGVQYXJhbXMsICRsb2NhdGlvbiwgJHJvdXRlLCBzaGFyZWREYXRhLCAkdWliTW9kYWwpCnsKZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkKTsKZ2V0QWxsQ2xpZW50cygkaHR0cCwkc2NvcGUsJ2V2ZW50VHlwZVVzZXJzJyk7CmdldEJ1c2luZXNzTG9jYXRpb25zKCRodHRwLCRzY29wZSwnYnVzaW5lc3NfbG9jYXRpb25zJyk7CmdldEFsbEluc3RydWN0b3JzKCRodHRwLCRzY29wZSwnaW5zdHJ1Y3RvcnMnKTsKCiRzY29wZS51cGRhdGVFdmVudFRpdGxlID0gZnVuY3Rpb24obmV3VmFsdWUsY3VycmVudEV2ZW50KQp7Cm5ld190aXRsZT1uZXdWYWx1ZTsKc2V0RXZlbnRUaXRsZSgkaHR0cCwkc2NvcGUsY3VycmVudEV2ZW50LmV2ZW50X2lkLCBuZXdfdGl0bGUsIHVwZGF0ZUV2ZW50X2NhbGxiYWNrLCB1cGRhdGVFdmVudF9jYWxsYmFjayk7CgpmdW5jdGlvbiB1cGRhdGVFdmVudF9jYWxsYmFjaygpCnsKZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCk7Cn0KCn07Cgokc2NvcGUudXBkYXRlRXZlbnRNYXhQYXJ0aWNpcGFudHMgPSBmdW5jdGlvbihuZXdWYWx1ZSxjdXJyZW50RXZlbnQpCnsKbmV3X21heF9wYXJ0aWNpcGFudHM9bmV3VmFsdWU7CmlmICggbmV3X21heF9wYXJ0aWNpcGFudHMgPCBjdXJyZW50RXZlbnQubm9fb2ZfdXNlcnMgKXsKc2V0RXZlbnRNYXhQYXJ0aWNpcGFudHMoJGh0dHAsJHNjb3BlLGN1cnJlbnRFdmVudC5ldmVudF9pZCwgY3VycmVudEV2ZW50Lm5vX29mX3VzZXJzLCBjdXJyZW50RXZlbnQubm9fb2ZfdXNlcnMsIHVwZGF0ZUV2ZW50X2NhbGxiYWNrLCB1cGRhdGVFdmVudF9jYWxsYmFjayk7Cn0gZWxzZSB7CnNldEV2ZW50TWF4UGFydGljaXBhbnRzKCRodHRwLCRzY29wZSxjdXJyZW50RXZlbnQuZXZlbnRfaWQsIG5ld19tYXhfcGFydGljaXBhbnRzLCBjdXJyZW50RXZlbnQubm9fb2ZfdXNlcnMsIHVwZGF0ZUV2ZW50X2NhbGxiYWNrLCB1cGRhdGVFdmVudF9jYWxsYmFjayk7Cn0KCmZ1bmN0aW9uIHVwZGF0ZUV2ZW50X2NhbGxiYWNrKCkKewpnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkKTsKfQoKfTsKCiRzY29wZS51cGRhdGVVc2VyRXZlbnRQcmljZSA9IGZ1bmN0aW9uKG5ld3ZhbHVlLCB0aGVldmVudCwgZXVzZXIpCnsKbmV3X3ByaWNlPW5ld3ZhbHVlOwpzZXRDbGllbnRFdmVudFByaWNlKCRodHRwLCRzY29wZSxldXNlci5idXNpbmVzc191c2VyX2lkLHRoZWV2ZW50LmV2ZW50X2lkLCBuZXdfcHJpY2Usc2V0Q2xpZW50RXZlbnRQcmljZV9jYWxsYmFjaywgc2V0Q2xpZW50RXZlbnRQcmljZV9jYWxsYmFjayk7CmZ1bmN0aW9uIHNldENsaWVudEV2ZW50UHJpY2VfY2FsbGJhY2soKQp7CmdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQpOwp9Cn07Cgokc2NvcGUudXBkYXRlTG9jYXRpb25FdmVudCA9IGZ1bmN0aW9uKCkKewpjb25zb2xlLmxvZygiZnVuY3Rpb246IHVwZGF0ZUxvY2F0aW9uRXZlbnQiKTsKdXBkYXRlRXZlbnRMb2NhdGlvbigkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLCRzY29wZS5jdXJyZW50RXZlbnQubG9jYXRpb25faWQsdXBkYXRlRXZlbnRMb2NhdGlvbl9jYWxsYmFjaywgdXBkYXRlRXZlbnRMb2NhdGlvbl9jYWxsYmFjayk7CiRzY29wZS51cGRhdGVMb2NhdGlvbkFsZXJ0TWVzc2FnZT0i157XoteT15vXnyDXodeY15jXldehLi4uIjsKZnVuY3Rpb24gdXBkYXRlRXZlbnRMb2NhdGlvbl9jYWxsYmFjaygpCnsKJHNjb3BlLnVwZGF0ZUxvY2F0aW9uQWxlcnRNZXNzYWdlPSLXoteV15PXm9efINeR15TXptec15fXlCEiOwokdGltZW91dChmdW5jdGlvbigpCnsKJHNjb3BlLnVwZGF0ZUxvY2F0aW9uQWxlcnRNZXNzYWdlPW51bGw7Cn0sIDE1MDApOwp9Cn07Cgokc2NvcGUudXBkYXRlSW5zdHJ1Y3RvckNsYXNzRXZlbnQgPSBmdW5jdGlvbigpCnsKY29uc29sZS5sb2coImZ1bmN0aW9uOiB1cGRhdGVJbnN0cnVjdG9yQ2xhc3NFdmVudCIpOwp1cGRhdGVFdmVudEluc3RydWN0b3IoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCwkc2NvcGUuY3VycmVudEV2ZW50Lmluc3RydWN0b3JfaWQsdXBkYXRlRXZlbnRJbnN0cnVjdG9yX2NhbGxiYWNrLCB1cGRhdGVFdmVudEluc3RydWN0b3JfY2FsbGJhY2spOwokc2NvcGUudXBkYXRlSW5zdHJ1Y3RvckFsZXJ0TWVzc2FnZT0i157XoteT15vXnyDXodeY15jXldehLi4uIjsKZnVuY3Rpb24gdXBkYXRlRXZlbnRJbnN0cnVjdG9yX2NhbGxiYWNrKCkKewokc2NvcGUudXBkYXRlSW5zdHJ1Y3RvckFsZXJ0TWVzc2FnZT0i16LXldeT15vXnyDXkdeU16bXnNeX15QhIjsKJHRpbWVvdXQoZnVuY3Rpb24oKQp7CiRzY29wZS51cGRhdGVJbnN0cnVjdG9yQWxlcnRNZXNzYWdlPW51bGw7Cn0sIDE1MDApOwp9Cn0KCgokc2NvcGUuYWN0aXZhdGVFdmVudENsYXNzID0gZnVuY3Rpb24oKQp7CnsKbG9nRGVidWcoInJlb3BlbkV2ZW50Iik7CnJlb3BlbkV2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkLCRzY29wZS5zZWxlY3RlZEV2ZW50LGFmdGVyUmVvcGVuRXZlbnQsYWZ0ZXJSZW9wZW5FdmVudCk7CmZ1bmN0aW9uIGFmdGVyUmVvcGVuRXZlbnQoKQp7CmdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQpOwp9Owp9Cn0KCi8vIGNsb3NlIGV2ZW50IGNsYXNzCiRzY29wZS5jbG9zZUV2ZW50Q2xhc3MgPSBmdW5jdGlvbigpIHsKICAgICAgbG9nRGVidWcoImNsb3NlRXZlbnRDbGFzcyIpOwoKdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CmFuaW1hdGlvbjogZmFsc2UsCnRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2V2ZW50X2NsYXNzX2Nsb3NlLnBocCcsCnNpemU6ICd4cycsCmNvbnRyb2xsZXI6ICdjbGFzc0Nsb3NlTW9kYWxDb250cm9sbGVyJywKcmVzb2x2ZTogewpldmVudF9pZDogZnVuY3Rpb24oKSB7CnJldHVybiAkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkOwp9Cn0KfSk7Cn07CgovLyBkZWxldGUgcmVwZWF0aW5nL2NsYXNzIGV2ZW50CiRzY29wZS5kZWxldGVDbGFzc0V2ZW50ID0gZnVuY3Rpb24oKQp7CmlmICgkc2NvcGUuY3VycmVudEV2ZW50LmlzX3JlcGVhdGluZz09MCkKewpsb2dEZWJ1ZygiY2xhc3MgZXZlbnQgbm90IHJlcGVhdGluZyIpOwokc2NvcGUuZGVsZXRlQ2xhc3NFdmVudFNpbmdsZSgpOwp9CmVsc2UKewpsb2dEZWJ1ZygiY2xhc3MgZXZlbnQgaXMgcmVwZWF0aW5nIik7CnZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewphbmltYXRpb246IGZhbHNlLAp0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9yZXBlYXRpbmdfZXZlbnRfZGVsZXRlX2FsbC5waHAnLApzaXplOiAneHMnLApjb250cm9sbGVyOiAnY2xhc3NEZWxldGVBbGxNb2RhbENvbnRyb2xsZXInLApyZXNvbHZlOiB7CmN1cnJlbnRFdmVudDogZnVuY3Rpb24oKSB7CnJldHVybiAkc2NvcGUuY3VycmVudEV2ZW50Owp9Cn0KfSk7Cn0KfTsKCiRzY29wZS5kZWxldGVDbGFzc0V2ZW50U2luZ2xlPWZ1bmN0aW9uICgpIC8vIGRlbGV0ZSBvbmx5IG9uZS9jdXJyZW50IGNsYXNzIGV2ZWh0CnsKY2FuY2VsQ2xhc3NFdmVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCxjYW5jZWxDbGFzc0V2ZW50X2NhbGxiYWNrLCBjYW5jZWxDbGFzc0V2ZW50X2NhbGxiYWNrKTsKZnVuY3Rpb24gY2FuY2VsQ2xhc3NFdmVudF9jYWxsYmFjaygpCnsKZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCk7Cn0KfQoKJHNjb3BlLiRvbigicmVsb2FkRXZlbnQiLGZ1bmN0aW9uKGUsYSl7Ci8vIFBvc3QgeW91ciBjb2RlCmxvZ0RlYnVnKCJicm9hZGNhc3RlZCAtIHJlbG9hZGluZyBldmVudCAiK2EuZXZlbnRfaWQpOwpnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkcm91dGVQYXJhbXMuZXZlbnRfaWQpOwp9KTsKCi8vIHJlbW92ZSBlbmQgdXNlciBmcm9tIGV2ZW50CiRzY29wZS5ldmVudFJlbW92ZUVuZFVzZXIgPSBmdW5jdGlvbihlbmR1c2VyX2lkKQp7CmNvbnNvbGUubG9nKCJldmVudFJlbW92ZUVuZFVzZXIiKTsKcmVtb3ZlRW5kVXNlckZyb21FdmVudCgkaHR0cCwkc2NvcGUsZW5kdXNlcl9pZCwkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkLHJlbW92ZUVuZFVzZXJGcm9tRXZlbnRfZmluaXNoLCByZW1vdmVFbmRVc2VyRnJvbUV2ZW50X2ZpbmlzaCk7CmZ1bmN0aW9uIHJlbW92ZUVuZFVzZXJGcm9tRXZlbnRfZmluaXNoKCkKewpnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkcm91dGVQYXJhbXMuZXZlbnRfaWQpOwp9Cn07Cgokc2NvcGUuZXZlbnRDbGllbnRTZWxlY3RlZCA9IGZ1bmN0aW9uKHNlbGVjdGVkKSB7CmlmIChzZWxlY3RlZCkgewovLyBhbGVydChKU09OLnN0cmluZ2lmeSggc2VsZWN0ZWQsIG51bGwsIDIgKSk7CmxvZ0RlYnVnKCdldmVudENsaWVudFNlbGVjdGVkMiB5ZXMgc2VsZWN0ZWQgJyArIHNlbGVjdGVkLm9yaWdpbmFsT2JqZWN0LmZpcnN0X25hbWUpOwokc2NvcGUuZXZlbnRBZGRFbmRVc2VyKHNlbGVjdGVkLm9yaWdpbmFsT2JqZWN0LmJ1c2luZXNzX3VzZXJfaWQpOwokcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2FuZ3Vjb21wbGV0ZS1hbHQ6Y2xlYXJJbnB1dCcsICdjbGllbnRfYW5ndWNvbXBsZXRlJyk7Cgp9IGVsc2Ugewpsb2dEZWJ1Zygnbm90IHNlbGVjdGVkJyk7Cn0KfTsKCiRzY29wZS5ldmVudEFkZEVuZFVzZXIgPSBmdW5jdGlvbihlbmR1c2VyX2lkKQp7CmFkZEVuZFVzZXJUb0V2ZW50KCRodHRwLCRzY29wZSxlbmR1c2VyX2lkLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQsYWRkRW5kVXNlclRvRXZlbnRfZmluaXNoLCBhZGRFbmRVc2VyVG9FdmVudF9maW5pc2gpOwpmdW5jdGlvbiBhZGRFbmRVc2VyVG9FdmVudF9maW5pc2goKQp7CmdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCk7Cn0KfTsKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ0V2ZW50UGFnZUNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICR0aW1lb3V0LCAkaHR0cCwgJHVpYk1vZGFsICxzaGFyZWRQcm9wZXJ0aWVzLCAkcm91dGVQYXJhbXMsICRyb290U2NvcGUsICRsb2NhdGlvbiwgJHJvdXRlLCBzaGFyZWREYXRhKQp7CmxvZ0RlYnVnKCJFdmVudFBhZ2VDb250cm9sbGVyIik7CgpnZXRBbGxJbnN0cnVjdG9yc0luY0luYWN0aXZlKCRodHRwLCRzY29wZSwnaW5zdHJ1Y3RvcnMnLGdldEFsbEluc3RydWN0b3JzSW5jSW5hY3RpdmVfc3VjY2Vzcyk7CmdldEJ1c2luZXNzTG9jYXRpb25zKCRodHRwLCRzY29wZSwnYnVzaW5lc3NfbG9jYXRpb25zJyk7CgpmdW5jdGlvbiBnZXRBbGxJbnN0cnVjdG9yc0luY0luYWN0aXZlX3N1Y2Nlc3MoKQp7CmdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCxzZXRQYXJ0aWNpcGF0ZWQpOwp9CgogIHZhciBpbml0aWFsaXppbmcgPSB0cnVlIDsKCiAgJHNjb3BlLiR3YXRjaCgiY3VycmVudEV2ZW50IiwgZnVuY3Rpb24obmV3VmFsdWUsIG9sZFZhbHVlKSB7CiAgICBpZiAoaW5pdGlhbGl6aW5nKSB7CiAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkgeyBpbml0aWFsaXppbmcgPSBmYWxzZTsgfSk7CiAgICB9IGVsc2UgewogICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgdmFyIHRpbWVvdXRJZDsKICAgICAgJCgnI2RvY3MgOmlucHV0LCB0ZXh0YXJlYScpLm9uKCdpbnB1dCBwcm9wZXJ0eWNoYW5nZSBjaGFuZ2UnLCBmdW5jdGlvbigpIHsKICAgICAgLy8gIGNvbnNvbGUubG9nKCdUZXh0YXJlYSBDaGFuZ2UnKTsKICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0SWQpOwogICAgICAgLy8gUnVucyBYIHNlY29uZCAoWCoxMDAwIG1zKSBhZnRlciB0aGUgbGFzdCBjaGFuZ2UKICAgICAgIHRpbWVvdXRJZCA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgJHNjb3BlLnVwZGF0ZUV2ZW50RXh0cmFGaWVsZHMoKQogICAgICAgfSwgNzAwKTsKICAgICAgIH0pOwogICAgfSwgMTAwMCk7CiAgICB9CiAgfSk7Cgokc2NvcGUuZXh0cmFGaWVsZHNBbGVydE1lc3NhZ2U9bnVsbDsKCiRzY29wZS51cGRhdGVFdmVudFRpdGxlID0gZnVuY3Rpb24obmV3VmFsdWUsY3VycmVudEV2ZW50KQp7Cm5ld190aXRsZT1uZXdWYWx1ZTsKc2V0RXZlbnRUaXRsZSgkaHR0cCwkc2NvcGUsY3VycmVudEV2ZW50LmV2ZW50X2lkLCBuZXdfdGl0bGUsIHVwZGF0ZUV2ZW50X2NhbGxiYWNrLCB1cGRhdGVFdmVudF9jYWxsYmFjayk7CgpmdW5jdGlvbiB1cGRhdGVFdmVudF9jYWxsYmFjaygpCnsKZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCk7Cn0KCn07CgoKJHNjb3BlLnVwZGF0ZUV2ZW50RXh0cmFGaWVsZHMgPSBmdW5jdGlvbigpCnsKICAgIGxvZ0RlYnVnKCJzYXZlIHVwZGF0ZUV2ZW50RXh0cmFGaWVsZHMiKTsKdGhlZGF0YSA9IHsKZXh0cmFGaWVsZHM6JHNjb3BlLmN1cnJlbnRFdmVudC5leHRyYUZpZWxkcwp9OwogICAgJHNjb3BlLmV4dHJhRmllbGRzQWxlcnRNZXNzYWdlPSLXqdeV157XqC4uLiI7CnVwZGF0ZUV2ZW50RXh0cmFGaWVsZHMoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCx0aGVkYXRhLHVwZGF0ZUV2ZW50RXh0cmFGaWVsZHNfY2FsbGJhY2ssIHVwZGF0ZUV2ZW50RXh0cmFGaWVsZHNfY2FsbGJhY2spOwoKZnVuY3Rpb24gdXBkYXRlRXZlbnRFeHRyYUZpZWxkc19jYWxsYmFjaygpCnsKICAgICAgLy8gZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLHNldFBhcnRpY2lwYXRlZCk7CgogICAgICAkc2NvcGUuZXh0cmFGaWVsZHNBbGVydE1lc3NhZ2U9Iteg16nXnteoISI7CiR0aW1lb3V0KGZ1bmN0aW9uKCkKewokc2NvcGUuZXh0cmFGaWVsZHNBbGVydE1lc3NhZ2U9bnVsbDsKICAgICAgfSwgMjMwMCk7Cn0KfTsKCiRzY29wZS5yZXNjaGVkdWxlRXZlbnQgPSBmdW5jdGlvbigpCnsKbG9nRGVidWcoInNlZXRpbmcgZXZlbnQgdG8gbW92ZSAgIiskc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0pOwpzaGFyZWRQcm9wZXJ0aWVzLnNldF9ldmVudF9yZXNjaGVkdWxlKCRzY29wZS5jdXJyZW50RXZlbnQpOwogICAgc2hhcmVkUHJvcGVydGllcy5zZXRfc2VsZWN0ZWRfdXNlcihudWxsKTsKCi8vIHVzZXJfaW5mbz0gewovLyAgICAgdXNlcl9pZDogJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudFVzZXJzWzBdLnVzZXJfaWQsCi8vICAgICBidXNlcl9maXJzdF9uYW1lOiAkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfZmlyc3RfbmFtZSwKLy8gICAgIGJ1c2VyX2xhc3RfbmFtZTogJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudFVzZXJzWzBdLmJ1c2VyX2xhc3RfbmFtZQovLyB9OwovLyBzaGFyZWRQcm9wZXJ0aWVzLnNldF9zZWxlY3RlZF91c2VyKHVzZXJfaW5mbyk7CiRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfY2FsZW5kYXInKTsKfQoKJHNjb3BlLnVwZGF0ZUxvY2F0aW9uRXZlbnQgPSBmdW5jdGlvbigpCnsKY29uc29sZS5sb2coImZ1bmN0aW9uOiB1cGRhdGVMb2NhdGlvbkV2ZW50Iik7CnVwZGF0ZUV2ZW50TG9jYXRpb24oJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCwkc2NvcGUuY3VycmVudEV2ZW50LmxvY2F0aW9uX2lkLHVwZGF0ZUV2ZW50TG9jYXRpb25fY2FsbGJhY2ssIHVwZGF0ZUV2ZW50TG9jYXRpb25fY2FsbGJhY2spOwokc2NvcGUudXBkYXRlTG9jYXRpb25BbGVydE1lc3NhZ2U9Itee16LXk9eb158g16HXmNeY15XXoS4uLiI7CmZ1bmN0aW9uIHVwZGF0ZUV2ZW50TG9jYXRpb25fY2FsbGJhY2soKQp7CiRzY29wZS51cGRhdGVMb2NhdGlvbkFsZXJ0TWVzc2FnZT0i16LXldeT15vXnyDXkdeU16bXnNeX15QhIjsKJHRpbWVvdXQoZnVuY3Rpb24oKQp7CiRzY29wZS51cGRhdGVMb2NhdGlvbkFsZXJ0TWVzc2FnZT1udWxsOwp9LCAxNTAwKTsKfQp9OwoKJHNjb3BlLnVwZGF0ZUluc3RydWN0b3JFdmVudCA9IGZ1bmN0aW9uKCkKewpjb25zb2xlLmxvZygiZnVuY3Rpb246IHVwZGF0ZUluc3RydWN0b3JFdmVudCIpOwp1cGRhdGVFdmVudEluc3RydWN0b3IoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCwkc2NvcGUuY3VycmVudEV2ZW50Lmluc3RydWN0b3JfaWQsdXBkYXRlRXZlbnRJbnN0cnVjdG9yX2NhbGxiYWNrLCB1cGRhdGVFdmVudEluc3RydWN0b3JfY2FsbGJhY2spOwokc2NvcGUudXBkYXRlSW5zdHJ1Y3RvckFsZXJ0TWVzc2FnZT0i157XoteT15vXnyDXodeY15jXldehLi4uIjsKZnVuY3Rpb24gdXBkYXRlRXZlbnRJbnN0cnVjdG9yX2NhbGxiYWNrKCkKewokc2NvcGUudXBkYXRlSW5zdHJ1Y3RvckFsZXJ0TWVzc2FnZT0i16LXldeT15vXnyDXkdeU16bXnNeX15QhIjsKJHRpbWVvdXQoZnVuY3Rpb24oKQp7CiRzY29wZS51cGRhdGVJbnN0cnVjdG9yQWxlcnRNZXNzYWdlPW51bGw7Cn0sIDE1MDApOwp9Cn07Cgokc2NvcGUuaW5pdGlhdGVQYXltZW50ID0gZnVuY3Rpb24oaXNwbHVzKQp7CnZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewphbmltYXRpb246IGZhbHNlLAp0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9jbGllbnRfcGF5bWVudC5waHAnLApjb250cm9sbGVyOiAnYnVzaW5lc3NDbGllbmRDYXJkUGF5bWVudCcsCi8vIHNpemU6IHNpemUsCnJlc29sdmU6IHsKY3VycmVudENsaWVudDogZnVuY3Rpb24oKSB7CnJldHVybiAkc2NvcGUuY3VycmVudEV2ZW50Q2xpZW50c1swXTsKfSwKaXNwbHVzOiBmdW5jdGlvbigpIHsKcmV0dXJuIGlzcGx1czsKfQp9Cn0pOwp9Cgokc2NvcGUuZGVsZXRlRXZlbnQ9ZnVuY3Rpb24gKCkKewovLyBjaGVja2luZyBpZiBjYW5jZWxpbmcgYSBnZW5lcmNfdHlwZSBldmVudCAtIHRoZW4gdGhlcmUncyBubyB1c2VyCmlmICgkc2NvcGUuY3VycmVudEV2ZW50LmlzX2dlbmVyaWNfZXR5cGU9PTEpCnsKY2FuY2VsU2luZ2xlRXZlbnQoJGh0dHAsJHNjb3BlLDAsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLGNhbmNlbFNpbmdsZUV2ZW50X2NhbGxiYWNrLCBjYW5jZWxTaW5nbGVFdmVudF9jYWxsYmFjayk7Cn0KZWxzZQp7CmNhbmNlbFNpbmdsZUV2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50VXNlcnNbMF0uYnVzaW5lc3NfdXNlcl9pZCwkcm91dGVQYXJhbXMuZXZlbnRfaWQsY2FuY2VsU2luZ2xlRXZlbnRfY2FsbGJhY2ssIGNhbmNlbFNpbmdsZUV2ZW50X2NhbGxiYWNrKTsKfQpmdW5jdGlvbiBjYW5jZWxTaW5nbGVFdmVudF9jYWxsYmFjaygpCnsKZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLHNldFBhcnRpY2lwYXRlZCk7Cn0KfQoKJHNjb3BlLnNldFBhcnRpY2lwYXRpb25TdGF0dXMgPSBmdW5jdGlvbigpCnsKc2V0RXZlbnRVc2VyUGFydGljaXBhdGlvblN0YXR1cygkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRVc2Vyc1swXS5idXNpbmVzc191c2VyX2lkLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRVc2Vyc1swXS5ldmVudF91c2VyX3N0YXR1c19pZCxzZXRQYXJ0aWNpcGF0aW9uU3RhdHVzX2NhbGxiYWNrLCBzZXRQYXJ0aWNpcGF0aW9uU3RhdHVzX2NhbGxiYWNrKTsKJHNjb3BlLnVwZGF0ZVN0YXR1c0FsZXJ0TWVzc2FnZT0i157XoteT15vXnyDXodeY15jXldehLi4uIjsKZnVuY3Rpb24gc2V0UGFydGljaXBhdGlvblN0YXR1c19jYWxsYmFjaygpCnsKLy8gZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLHNldFBhcnRpY2lwYXRlZCk7CnNldFBhcnRpY2lwYXRlZCgpOwokc2NvcGUudXBkYXRlU3RhdHVzQWxlcnRNZXNzYWdlPSLXoteV15PXm9efINeR15TXptec15fXlCEiOwokdGltZW91dChmdW5jdGlvbigpCnsKJHNjb3BlLnVwZGF0ZVN0YXR1c0FsZXJ0TWVzc2FnZT1udWxsOwp9LCAyNTAwKTsKfQp9CgpmdW5jdGlvbiBzZXRQYXJ0aWNpcGF0ZWQoKQp7CmxvZ0RlYnVnKCJnZXQgY2xpZW50IGluZm8iKTsKZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Q2xpZW50cycsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudFVzZXJzWzBdLmJ1c2luZXNzX3VzZXJfaWQpOwpsb2dEZWJ1Zygic2V0dGluZyBzZXRQYXJ0aWNpcGF0ZWQiKTsKaWYgKCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRVc2Vyc1swXS5zdGF0dXNfbmFtZSE9JGdVc2VyX3N0YXR1c19hYnNlbnRlZCkKewokc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50VXNlcnNbMF0ucGFydGljaXBhdGVkPXRydWU7Cn0KZWxzZQp7CiRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRVc2Vyc1swXS5wYXJ0aWNpcGF0ZWQ9ZmFsc2U7Cn0KCi8vIHRoaXMgbG9vcCBpcyBmb3IgZml4aW5nIHRoZSBkYXRlIGZvcm1hdCB0byBhcHBlYXIgcHJvcGVybHkgaW4gdGhlIGlucHV0IGRhdGUgaHRtbCBvYmplY3QKZm9yIChpID0gMDsgaTwgKCRzY29wZS5jdXJyZW50RXZlbnQuZXh0cmFGaWVsZHMpLmxlbmd0aDsgaSsrKQp7CmxvZ0RlYnVnKCRzY29wZS5jdXJyZW50RXZlbnQuZXh0cmFGaWVsZHNbaV0pOwppZiAoJHNjb3BlLmN1cnJlbnRFdmVudC5leHRyYUZpZWxkc1tpXS5maWVsZF9kYXRhdHlwZT09IkRBVEUiKQp7Ci8vIGxvZ0RlYnVnKCJkYXRlIik7CiRzY29wZS5jdXJyZW50RXZlbnQuZXh0cmFGaWVsZHNbaV0uZmllbGRfdmFsdWU9bmV3IERhdGUoJHNjb3BlLmN1cnJlbnRFdmVudC5leHRyYUZpZWxkc1tpXS5maWVsZF92YWx1ZSk7Cn0KfQoKbG9nRGVidWcoIiRzY29wZS5jdXJyZW50RXZlbnQuaW5zdHJ1Y3Rvcl9pZDs9Iiskc2NvcGUuY3VycmVudEV2ZW50Lmluc3RydWN0b3JfaWQpOwpmb3IodmFyIGkgPSAwOyBpIDwgJHNjb3BlLmluc3RydWN0b3JzLmxlbmd0aDsgaSsrKQp7CmxvZ0RlYnVnKCRzY29wZS5pbnN0cnVjdG9yc1tpXS5pc19hY3RpdmUpOwppZiAoJHNjb3BlLmluc3RydWN0b3JzW2ldLmJ1c2luZXNzX3VzZXJfaWQ9PSRzY29wZS5jdXJyZW50RXZlbnQuaW5zdHJ1Y3Rvcl9pZCkKewpsb2dEZWJ1ZygieWVzaCIpOwokc2NvcGUuaW5zdHJ1Y3RvcnNbaV0uaXNfYWN0aXZlPTE7Cn0KfQp9Cgokc2NvcGUudXBkYXRlVXNlckV2ZW50UHJpY2UgPSBmdW5jdGlvbihuZXd2YWx1ZSwgdGhlZXZlbnQpCnsKbmV3X3ByaWNlPW5ld3ZhbHVlOwpzZXRDbGllbnRFdmVudFByaWNlKCRodHRwLCRzY29wZSwkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50VXNlcnNbMF0uYnVzaW5lc3NfdXNlcl9pZCx0aGVldmVudC5ldmVudF9pZCwgbmV3X3ByaWNlLHNldENsaWVudEV2ZW50UHJpY2VfY2FsbGJhY2ssIHNldENsaWVudEV2ZW50UHJpY2VfY2FsbGJhY2spOwpmdW5jdGlvbiBzZXRDbGllbnRFdmVudFByaWNlX2NhbGxiYWNrKCkKewpnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkcm91dGVQYXJhbXMuZXZlbnRfaWQsc2V0UGFydGljaXBhdGVkKTsKfQp9OwoKJHNjb3BlLiRvbigiZXZlbnRQYWdlUmVsb2FkRGF0YSIsZnVuY3Rpb24oZSxhKQp7CmdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCxzZXRQYXJ0aWNpcGF0ZWQpOwp9KTsKCgoKCiRzY29wZS5jbG9zZUV2ZW50ID0gZnVuY3Rpb24oKQp7CmxvZ0RlYnVnKCJjaGVja2luZyBpZiBldmVudCBoYXMgZXh0cmEgZmllbGRzIHRoYXQgYXJlIHJlcXVpcmVkIGJlZm9yZSBjbG9zaW5nIGl0Iik7CmNoZWNrRXZlbnRFeHRyYUZpZWxkcygkaHR0cCwkc2NvcGUsJ2NoZWNrRXZlbnRFeHRyYUZpZWxkcycsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLGNoZWNrRXZlbnRFeHRyYUZpZWxkc19zdWNjZXNzKTsKZnVuY3Rpb24gY2hlY2tFdmVudEV4dHJhRmllbGRzX3N1Y2Nlc3MoKQp7CmlmICgkc2NvcGUuY2hlY2tFdmVudEV4dHJhRmllbGRzPT10cnVlKQp7CmxvZ0RlYnVnKCJldmVudCBoYXMgYWxsIGV4dHJhIGZpZWxkcyBvaywgY2xvc2luZyBldmVudCIpOwovLyAkc2NvcGUuY3VycmVudEV2ZW50Lmlnbm9yZUV4dHJhRmllbGRzVmFsaWRhdGlvbj10cnVlOwpjbG9zZUV2ZW50KCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuZXZlbnRfaWQsJHNjb3BlLmN1cnJlbnRFdmVudCxhZnRlckNsb3NlRXZlbnQsYWZ0ZXJDbG9zZUV2ZW50KTsKZnVuY3Rpb24gYWZ0ZXJDbG9zZUV2ZW50KCkKewpnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkcm91dGVQYXJhbXMuZXZlbnRfaWQsc2V0UGFydGljaXBhdGVkKTsKfTsKfQplbHNlCnsKbG9nRGVidWcoImV2ZW50IGhhcyBleHRyYSBmaWVsZHMgcmVxdWlyZWQgdGhhdCBhcmUgbm90IGZpbGxlZCIpOwp2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKYW5pbWF0aW9uOiBmYWxzZSwKdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfZXZlbnRfY2xvc2VfaWdub3JlX21hbmRhdG9yeV9maWVsZHMucGhwJywKY29udHJvbGxlcjogJ2V2ZW50Q2xvc2VJZ25vcmVNYW5kYXRvcnlGaWVsZHNNb2RhbENvbnRyb2xsZXInLApzaXplOiAnbScsCnJlc29sdmU6IHsKY3VycmVudEV2ZW50OiBmdW5jdGlvbigpIHsKcmV0dXJuICRzY29wZS5jdXJyZW50RXZlbnQ7Cn0KfQp9KTsKfQp9Cn0KJHNjb3BlLnJlb3BlbkV2ZW50ID0gZnVuY3Rpb24oKQp7CmxvZ0RlYnVnKCJyZW9wZW5FdmVudCIpOwpyZW9wZW5FdmVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCwkc2NvcGUuY3VycmVudEV2ZW50LGFmdGVyUmVvcGVuRXZlbnQsYWZ0ZXJSZW9wZW5FdmVudCk7CmZ1bmN0aW9uIGFmdGVyUmVvcGVuRXZlbnQoKQp7CmdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQsc2V0UGFydGljaXBhdGVkKTsKfTsKfQoKfSk7CgprdXplQXBwLmZpbHRlcignc3RhcnRGcm9tJywgZnVuY3Rpb24oKQp7CnJldHVybiBmdW5jdGlvbihpbnB1dCwgc3RhcnQpCnsKaWYoIWlucHV0KSByZXR1cm4gW107Ci8vIGNvbnNvbGUubG9nKCJoZXJlcmVlZSAiK2lucHV0KTsKc3RhcnQgPSArc3RhcnQ7IC8vcGFyc2UgdG8gaW50CnJldHVybiBpbnB1dC5zbGljZShzdGFydCk7Cn0KfSk7Ci8vIGFuZ3VsYXIgZmlsdGVyIGZvciBldmVudHMgYmVmb3JlL2FmdGVyIHRvZGF5Cmt1emVBcHAuZmlsdGVyKCdiZWZvcmVOb3cnLCBmdW5jdGlvbigpIHsKLy8gQ3JlYXRlIHRoZSByZXR1cm4gZnVuY3Rpb24gYW5kIHNldCB0aGUgcmVxdWlyZWQgcGFyYW1ldGVyIG5hbWUgdG8gKippbnB1dCoqCnJldHVybiBmdW5jdGlvbihpbnB1dCkgewp2YXIgb3V0ID0gW107CgovLyBVc2luZyB0aGUgYW5ndWxhci5mb3JFYWNoIG1ldGhvZCwgZ28gdGhyb3VnaCB0aGUgYXJyYXkgb2YgZGF0YSBhbmQgcGVyZm9ybSB0aGUgb3BlcmF0aW9uIG9mIGZpZ3VyaW5nIG91dCBpZiB0aGUgbGFuZ3VhZ2UgaXMgc3RhdGljYWxseSBvciBkeW5hbWljYWxseSB0eXBlZC4KdmFyIGJyb3dzZXJfZXBvY2ggPSAobmV3IERhdGUpLmdldFRpbWUoKTsKCmFuZ3VsYXIuZm9yRWFjaChpbnB1dCwgZnVuY3Rpb24oZXZlbnQpCnsKLy8gIGxvZ0RlYnVnKCJmaWx0ZXJpbmcsIGV2ZW50LmV2ZW50X3VzZXJfc3RhdHVzX2lkPSIrZXZlbnQuZXZlbnRfdXNlcl9zdGF0dXNfaWQpOwppZiAoZXZlbnQuc3RhcnRfZXBvY2ggPD0gKGJyb3dzZXJfZXBvY2gvMTAwMCkpCnsKb3V0LnB1c2goZXZlbnQpCn0KfSkKcmV0dXJuIG91dDsKfQp9KTsKa3V6ZUFwcC5maWx0ZXIoJ2FmdGVyTm93JywgZnVuY3Rpb24oKSB7Ci8vIENyZWF0ZSB0aGUgcmV0dXJuIGZ1bmN0aW9uIGFuZCBzZXQgdGhlIHJlcXVpcmVkIHBhcmFtZXRlciBuYW1lIHRvICoqaW5wdXQqKgpyZXR1cm4gZnVuY3Rpb24oaW5wdXQpIHsKdmFyIG91dCA9IFtdOwoKLy8gVXNpbmcgdGhlIGFuZ3VsYXIuZm9yRWFjaCBtZXRob2QsIGdvIHRocm91Z2ggdGhlIGFycmF5IG9mIGRhdGEgYW5kIHBlcmZvcm0gdGhlIG9wZXJhdGlvbiBvZiBmaWd1cmluZyBvdXQgaWYgdGhlIGxhbmd1YWdlIGlzIHN0YXRpY2FsbHkgb3IgZHluYW1pY2FsbHkgdHlwZWQuCnZhciBicm93c2VyX2Vwb2NoID0gKG5ldyBEYXRlKS5nZXRUaW1lKCk7Cgphbmd1bGFyLmZvckVhY2goaW5wdXQsIGZ1bmN0aW9uKGV2ZW50KQp7Ci8vICBsb2dEZWJ1ZygiZmlsdGVyaW5nLCBldmVudC5ldmVudF91c2VyX3N0YXR1c19pZD0iK2V2ZW50LmV2ZW50X3VzZXJfc3RhdHVzX2lkKTsKaWYgKGV2ZW50LnN0YXJ0X2Vwb2NoID4gKGJyb3dzZXJfZXBvY2gvMTAwMCkpCnsKb3V0LnB1c2goZXZlbnQpCn0KfSkKcmV0dXJuIG91dDsKfQp9KTsKCmt1emVBcHAuZmlsdGVyKCdpc0FjdGl2ZScsIGZ1bmN0aW9uKCkgewovLyBDcmVhdGUgdGhlIHJldHVybiBmdW5jdGlvbiBhbmQgc2V0IHRoZSByZXF1aXJlZCBwYXJhbWV0ZXIgbmFtZSB0byAqKmlucHV0KioKcmV0dXJuIGZ1bmN0aW9uKGlucHV0KSB7CnZhciBvdXQgPSBbXTsKCi8vIFVzaW5nIHRoZSBhbmd1bGFyLmZvckVhY2ggbWV0aG9kLCBnbyB0aHJvdWdoIHRoZSBhcnJheSBvZiBkYXRhIGFuZCBwZXJmb3JtIHRoZSBvcGVyYXRpb24gb2YgZmlndXJpbmcgb3V0IGlmIHRoZSBsYW5ndWFnZSBpcyBzdGF0aWNhbGx5IG9yIGR5bmFtaWNhbGx5IHR5cGVkLgoKYW5ndWxhci5mb3JFYWNoKGlucHV0LCBmdW5jdGlvbihldmVudCkKewovLyAgbG9nRGVidWcoImZpbHRlcmluZywgZXZlbnQuZXZlbnRfdXNlcl9zdGF0dXNfaWQ9IitldmVudC5ldmVudF91c2VyX3N0YXR1c19pZCk7CmlmIChldmVudC5pc19hY3RpdmU9PTEpCnsKb3V0LnB1c2goZXZlbnQpCn0KfSkKcmV0dXJuIG91dDsKfQp9KTsKCmt1emVBcHAuZmlsdGVyKCdzaG91bGRfYmVfZGlzcGxheWVkJywgZnVuY3Rpb24oKSB7Ci8vIENyZWF0ZSB0aGUgcmV0dXJuIGZ1bmN0aW9uIGFuZCBzZXQgdGhlIHJlcXVpcmVkIHBhcmFtZXRlciBuYW1lIHRvICoqaW5wdXQqKgpyZXR1cm4gZnVuY3Rpb24oaW5wdXQpIHsKdmFyIG91dCA9IFtdOwoKLy8gVXNpbmcgdGhlIGFuZ3VsYXIuZm9yRWFjaCBtZXRob2QsIGdvIHRocm91Z2ggdGhlIGFycmF5IG9mIGRhdGEgYW5kIHBlcmZvcm0gdGhlIG9wZXJhdGlvbiBvZiBmaWd1cmluZyBvdXQgaWYgdGhlIGxhbmd1YWdlIGlzIHN0YXRpY2FsbHkgb3IgZHluYW1pY2FsbHkgdHlwZWQuCgphbmd1bGFyLmZvckVhY2goaW5wdXQsIGZ1bmN0aW9uKGV2ZW50KQp7Ci8vICBsb2dEZWJ1ZygiZmlsdGVyaW5nLCBldmVudC5ldmVudF91c2VyX3N0YXR1c19pZD0iK2V2ZW50LmV2ZW50X3VzZXJfc3RhdHVzX2lkKTsKaWYgKGV2ZW50LnNob3VsZF9iZV9kaXNwbGF5ZWQ9PTEpCnsKb3V0LnB1c2goZXZlbnQpCn0KfSkKcmV0dXJuIG91dDsKfQp9KTsKCmt1emVBcHAuY29udHJvbGxlcignSW5zdHJ1Y3RvclNob3cxQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHRpbWVvdXQsICRodHRwLCBzaGFyZWRQcm9wZXJ0aWVzLCAkcm9vdFNjb3BlLCAkcm91dGVQYXJhbXMsICRsb2NhdGlvbiwgJHJvdXRlLCBzaGFyZWREYXRhLCAkdWliTW9kYWwpCnsKZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLGdldEJ1c2luZXNzQ2xpZW50SW5mb19zdWNjZXNzKTsKICBnZXRzZWN1cml0eVByb2ZpbGVzKCRodHRwLCRzY29wZSwnc2VjX3Byb2ZpbGVzJyk7CgpmdW5jdGlvbiBnZXRCdXNpbmVzc0NsaWVudEluZm9fc3VjY2VzcygpCnsKZ2V0Q2xpZW50RXh0cmFGaWVsZHMoJGh0dHAsJHNjb3BlLCRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5idXNpbmVzc191c2VyX2lkLCdjbGllbnRFeHRyYUZpZWxkcycsZ2V0Q2xpZW50RXh0cmFGaWVsZHNfc3VjY2Vzcyk7CgpmdW5jdGlvbiBnZXRDbGllbnRFeHRyYUZpZWxkc19zdWNjZXNzKCkKewpmb3IgKGkgPSAwOyBpPCAoJHNjb3BlLmNsaWVudEV4dHJhRmllbGRzKS5sZW5ndGg7IGkrKykKewpsb2dEZWJ1Zygkc2NvcGUuY2xpZW50RXh0cmFGaWVsZHNbaV0pOwppZiAoJHNjb3BlLmNsaWVudEV4dHJhRmllbGRzW2ldLmZpZWxkX2RhdGF0eXBlPT0iREFURSIpCnsKLy8gbG9nRGVidWcoImRhdGUiKTsKJHNjb3BlLmNsaWVudEV4dHJhRmllbGRzW2ldLmZpZWxkX3ZhbHVlPW5ldyBEYXRlKCRzY29wZS5jbGllbnRFeHRyYUZpZWxkc1tpXS5maWVsZF92YWx1ZSk7Cn0KfQp9Cn0KCiAgJHNjb3BlLnVwZGF0ZV9zZWNfcHJvZmlsZSA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1ZygidXBkYXRlX3NlY19wcm9maWxlIGZvciBidWlkPSIrJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLmJ1c2luZXNzX3VzZXJfaWQrICIsIHByb2ZpbGVfaWQiKyRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5zZWNfcHJvZmlsZV9pZCk7CiAgICB1cGRhdGVfc2VjX3Byb2ZpbGUoJGh0dHAsJHNjb3BlLCRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5idXNpbmVzc191c2VyX2lkLCRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5zZWNfcHJvZmlsZV9pZCx1cGRhdGVfc2VjX3Byb2ZpbGVfc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiB1cGRhdGVfc2VjX3Byb2ZpbGVfc3VjY2VzcygpCiAgICB7CiAgICAgIGdldHNlY3VyaXR5UHJvZmlsZXMoJGh0dHAsJHNjb3BlLCdzZWNfcHJvZmlsZXMnKTsKICAgIH0KICB9CiRzY29wZS5hcmNoaXZlQ2xpZW50TW9kYWwgPSBmdW5jdGlvbigpCnsKLy8gYXJjaGl2ZS9kZWxldGUgY2xpZW50IC0gYXNrIGlmIHN1cmUKdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CmFuaW1hdGlvbjogZmFsc2UsCnRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2FyY2hpdmVfY2xpZW50X21vZGFsLnBocCcsCnNpemU6ICd4cycsCmNvbnRyb2xsZXI6ICdhcmNoaXZlX2NsaWVudF9tb2RhbCcsICAvLyAncGF5bWVueURldGFpbHNNb2RhbENvbnRyb2xsZXInLApyZXNvbHZlOiB7CmJ1c2luZXNzX3VzZXJfaWQ6IGZ1bmN0aW9uKCkgewpyZXR1cm4gJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLmJ1c2luZXNzX3VzZXJfaWQ7Cn0sCmJ1c2VyX2xhc3RfbmFtZTogZnVuY3Rpb24oKSB7CnJldHVybiAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYnVzZXJfbGFzdF9uYW1lOwp9LApidXNlcl9maXJzdF9uYW1lOiBmdW5jdGlvbigpIHsKcmV0dXJuICRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5idXNlcl9maXJzdF9uYW1lOwp9LAppc19pbnN0cnVjdG9yOiBmdW5jdGlvbigpIHsKcmV0dXJuIHRydWU7Cn0KfQp9KTsKfQoKJHNjb3BlLnVwZGF0ZVVzZXJGaXJzdE5hbWUgPSBmdW5jdGlvbihuZXdWYWx1ZSkKewpzZXRDbGllbnRGaXJzdE5hbWUoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLG5ld1ZhbHVlLGFmdGVyQ2xpZW50U2V0LGFmdGVyQ2xpZW50U2V0KTsKZnVuY3Rpb24gYWZ0ZXJDbGllbnRTZXQoKQp7CmdldEJ1c2luZXNzQ2xpZW50SW5mbygkaHR0cCwkc2NvcGUsJ2Zvcm1VcGRhdGVDbGllbnRBbmd1bGFyJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7Cn0KfQokc2NvcGUudXBkYXRlVXNlckxhc3ROYW1lID0gZnVuY3Rpb24obmV3VmFsdWUpCnsKc2V0Q2xpZW50TGFzdE5hbWUoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLG5ld1ZhbHVlLGFmdGVyQ2xpZW50U2V0LGFmdGVyQ2xpZW50U2V0KTsKZnVuY3Rpb24gYWZ0ZXJDbGllbnRTZXQoKQp7CmdldEJ1c2luZXNzQ2xpZW50SW5mbygkaHR0cCwkc2NvcGUsJ2Zvcm1VcGRhdGVDbGllbnRBbmd1bGFyJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7Cn0KfQokc2NvcGUudXBkYXRlVXNlclBob25lTnVtYmVyID0gZnVuY3Rpb24obmV3VmFsdWUpCnsKbmV3VmFsdWUgPSBuZXdWYWx1ZS5yZXBsYWNlKCctJywnJyk7CmlmIChpc05hTihuZXdWYWx1ZSkpCnsKYWxlcnQoIteQ16DXkCDXlNeW158g157Xodek16gg15jXnNek15XXnyDXqten15nXnyIpOwpnZXRCdXNpbmVzc0NsaWVudEluZm8oJGh0dHAsJHNjb3BlLCdmb3JtVXBkYXRlQ2xpZW50QW5ndWxhcicsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwp9CmVsc2UKewpzZXRDbGllbnRQaG9uZU51bWJlcigkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsbmV3VmFsdWUsc2V0Q2xpZW50UGhvbmVOdW1iZXJfY2FsbGJhY2ssc2V0Q2xpZW50UGhvbmVOdW1iZXJfY2FsbGJhY2spOwpmdW5jdGlvbiBzZXRDbGllbnRQaG9uZU51bWJlcl9jYWxsYmFjaygpCnsKZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKfQp9Cn0KCn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignQ2xpZW50c1Nob3cxQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHRpbWVvdXQsICRodHRwLCBzaGFyZWRQcm9wZXJ0aWVzLCAkcm9vdFNjb3BlLCAkcm91dGVQYXJhbXMsICRsb2NhdGlvbiwgJHJvdXRlLCBzaGFyZWREYXRhLCAkdWliTW9kYWwpCnsKZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLGdldEJ1c2luZXNzQ2xpZW50SW5mb19zdWNjZXNzKTsKCmZ1bmN0aW9uIGdldEJ1c2luZXNzQ2xpZW50SW5mb19zdWNjZXNzKCkKewpnZXRDbGllbnRFeHRyYUZpZWxkcygkaHR0cCwkc2NvcGUsJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLmJ1c2luZXNzX3VzZXJfaWQsJ2NsaWVudEV4dHJhRmllbGRzJyxnZXRDbGllbnRFeHRyYUZpZWxkc19zdWNjZXNzKTsKCmZ1bmN0aW9uIGdldENsaWVudEV4dHJhRmllbGRzX3N1Y2Nlc3MoKQp7CmZvciAoaSA9IDA7IGk8ICgkc2NvcGUuY2xpZW50RXh0cmFGaWVsZHMpLmxlbmd0aDsgaSsrKQp7CmxvZ0RlYnVnKCRzY29wZS5jbGllbnRFeHRyYUZpZWxkc1tpXSk7CmlmICgkc2NvcGUuY2xpZW50RXh0cmFGaWVsZHNbaV0uZmllbGRfZGF0YXR5cGU9PSJEQVRFIikKewovLyBsb2dEZWJ1ZygiZGF0ZSIpOwokc2NvcGUuY2xpZW50RXh0cmFGaWVsZHNbaV0uZmllbGRfdmFsdWU9bmV3IERhdGUoJHNjb3BlLmNsaWVudEV4dHJhRmllbGRzW2ldLmZpZWxkX3ZhbHVlKTsKfQp9Cn0KfQp7CmdldENsaWVudEV2ZW50cygkaHR0cCwkc2NvcGUsJ2N1cnJlbnRDbGllbnRFdmVudHMnLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKCmdldENsaWVudFBheW1lbnRzKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCwnY3VycmVudENsaWVudFBheW1lbnRzJyk7Cgokc2NvcGUuYXJjaGl2ZUNsaWVudE1vZGFsID0gZnVuY3Rpb24oKQp7Ci8vIGFyY2hpdmUvZGVsZXRlIGNsaWVudCAtIGFzayBpZiBzdXJlCnZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewphbmltYXRpb246IGZhbHNlLAp0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdhcmNoaXZlX2NsaWVudF9tb2RhbC5waHAnLApzaXplOiAneHMnLApjb250cm9sbGVyOiAnYXJjaGl2ZV9jbGllbnRfbW9kYWwnLCAgLy8gJ3BheW1lbnlEZXRhaWxzTW9kYWxDb250cm9sbGVyJywKcmVzb2x2ZTogewpidXNpbmVzc191c2VyX2lkOiBmdW5jdGlvbigpIHsKcmV0dXJuICRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5idXNpbmVzc191c2VyX2lkOwp9LApidXNlcl9sYXN0X25hbWU6IGZ1bmN0aW9uKCkgewpyZXR1cm4gJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLmJ1c2VyX2xhc3RfbmFtZTsKfSwKYnVzZXJfZmlyc3RfbmFtZTogZnVuY3Rpb24oKSB7CnJldHVybiAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYnVzZXJfZmlyc3RfbmFtZTsKfSwKaXNfaW5zdHJ1Y3RvcjogZnVuY3Rpb24oKSB7CnJldHVybiBmYWxzZTsKfQp9Cn0pOwp9CiRzY29wZS5wYWNrYWdlRGVsZXRlID0gZnVuY3Rpb24ocGFja2FnZSkKewpsb2dEZWJ1ZygicGFja2FnZSBkZWxldGUgIitKU09OLnN0cmluZ2lmeShwYWNrYWdlKSk7CmRlbGV0ZVBhY2thZ2UoJGh0dHAsJHNjb3BlLHBhY2thZ2UucGFja2FnZV91c2VyX2lkLCRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5idXNpbmVzc191c2VyX2lkLHN1Y2Nlc3NfY2FsbGJhY2ssIHN1Y2Nlc3NfY2FsbGJhY2spOwpmdW5jdGlvbiBzdWNjZXNzX2NhbGxiYWNrKCkKewokcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NsaWVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCn0KfQoKJHNjb3BlLnVwZGF0ZUNsaWVudEV4dHJhRmllbGRzID0gZnVuY3Rpb24oKQp7CiAgICAgIGxvZ0RlYnVnKCJ1cGRhdGVDbGllbnRFeHRyYUZpZWxkcyIpOwp0aGVkYXRhID0gewpleHRyYUZpZWxkczokc2NvcGUuY2xpZW50RXh0cmFGaWVsZHMKfTsKICAgICAgJHNjb3BlLmV4dHJhRmllbGRzQWxlcnRNZXNzYWdlPSLXqdeV157XqC4uLiI7CiAgICAgIHVwZGF0ZUNsaWVudEV4dHJhRmllbGRzKCRodHRwLCRzY29wZSwkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYnVzaW5lc3NfdXNlcl9pZCx0aGVkYXRhLHVwZGF0ZUV2ZW50Q2xpZW50RmllbGRzX2NhbGxiYWNrLCB1cGRhdGVFdmVudENsaWVudEZpZWxkc19jYWxsYmFjayk7CgogICAgICBmdW5jdGlvbiB1cGRhdGVFdmVudENsaWVudEZpZWxkc19jYWxsYmFjaygpCnsKLy8gZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLHNldFBhcnRpY2lwYXRlZCk7CiAgICAgICAgJHNjb3BlLmV4dHJhRmllbGRzQWxlcnRNZXNzYWdlPSLXoNep157XqCEiOwokdGltZW91dChmdW5jdGlvbigpCnsKJHNjb3BlLmV4dHJhRmllbGRzQWxlcnRNZXNzYWdlPW51bGw7Cn0sIDMwMDApOwp9Cn07Cgokc2NvcGUuc2NoZWR1bGVFdmVudEZvckNsaWVudCA9IGZ1bmN0aW9uKCkKewpsb2dEZWJ1Zygic2VldGluZyBzaGFyZSBwcm9wZXJ0eSB1c2VyX2lkICIrJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdKTsKc2hhcmVkUHJvcGVydGllcy5zZXRfc2VsZWN0ZWRfdXNlcigkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0pOwokbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2NhbGVuZGFyJyk7Cn0KJHNjb3BlLmludm9pY2VHZW5lcmF0ZUNoZWNrYm94ID0gZnVuY3Rpb24oZnBheW1lbnQpCnsKbG9nRGVidWcoImludm9pY2VHZW5lcmF0ZUNoZWNrYm94IGZvciAiK0pTT04uc3RyaW5naWZ5KGZwYXltZW50KSk7CnNldENsaWVudFBheW1lbnRJbnZvaWNlR2VuZXJhdGVkKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCxmcGF5bWVudC51c2VyX3BheW1lbnRfaWQsZnBheW1lbnQuaW52b2ljZV9nZW5lcmF0ZWQsc2V0Q2xpZW50UGF5bWVudEludm9pY2VHZW5lcmF0ZWRfY2FsbGJhY2ssIHNldENsaWVudFBheW1lbnRJbnZvaWNlR2VuZXJhdGVkX2NhbGxiYWNrKTsKZnVuY3Rpb24gc2V0Q2xpZW50UGF5bWVudEludm9pY2VHZW5lcmF0ZWRfY2FsbGJhY2soKQp7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKfQp9OwoKJHNjb3BlLnJlY2FsY1VzZXJCYWxhbmNlID0gZnVuY3Rpb24oKQp7CmxvZ0RlYnVnKCJyZWNhbGNVc2VyQmFsYW5jZSIpOwpyZWNhbGNVc2VyQmFsYW5jZSgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsIHJlY2FsY1VzZXJCYWxhbmNlX2NhbGxiYWNrKTsKZnVuY3Rpb24gcmVjYWxjVXNlckJhbGFuY2VfY2FsbGJhY2soKQp7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKfSAgICB9CiRzY29wZS51cGRhdGVFdmVudFBhY2thZ2VSZWZlcmVuY2UgPSBmdW5jdGlvbih1c2VyX2lkLCBmbWVldGluZykKewpsb2dEZWJ1ZygidXBkYXRlRXZlbnRQYWNrYWdlUmVmZXJlbmNlLCB1c2VyPSIrdXNlcl9pZCsiLCBmbWVldGluZz0iK0pTT04uc3RyaW5naWZ5KGZtZWV0aW5nKSk7CnZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewphbmltYXRpb246IGZhbHNlLAp0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9jbGllbnRfZXZlbnRfcGFja2FnZV9hc3NvY2lhdGlvbi5waHAnLApzaXplOiAneHMnLApjb250cm9sbGVyOiAnZXZlbnRQYWNrYWdlQXNzb2NpYXRpb25Nb2RhbENvbnRyb2xsZXInLCAgLy8gJ3BheW1lbnlEZXRhaWxzTW9kYWxDb250cm9sbGVyJywKcmVzb2x2ZTogewpmbWVldGluZzogZnVuY3Rpb24oKSB7CnJldHVybiBmbWVldGluZzsKfSwKYmFsYW5jZTogZnVuY3Rpb24oKSB7CnJldHVybiAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYmFsYW5jZTsKfSwKYnVzaW5lc3NfdXNlcl9pZDogZnVuY3Rpb24oKSB7CnJldHVybiAkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZDsKfQp9Cn0pOwp9OwoKJHNjb3BlLnVwZGF0ZVBhY2thZ2VQYXltZW50UmVmZXJlbmNlID0gZnVuY3Rpb24odXNlcl9pZCwgZnBhY2thZ2UpCnsKbG9nRGVidWcoInVwZGF0ZVBhY2thZ2VQYXltZW50UmVmZXJlbmNlLCB1c2VyPSIrdXNlcl9pZCsiLCBmcGFja2FnZT0iK0pTT04uc3RyaW5naWZ5KGZwYWNrYWdlKSk7CnZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewphbmltYXRpb246IGZhbHNlLAp0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9jbGllbnRfcGFja2FnZV9wYXltZW50X2Fzc29jaWF0aW9uLnBocCcsCnNpemU6ICd4cycsCmNvbnRyb2xsZXI6ICdwYWNrYWdlUGF5bWVudEFzc29jaWF0aW9uTW9kYWxDb250cm9sbGVyJywgIC8vICdwYXltZW55RGV0YWlsc01vZGFsQ29udHJvbGxlcicsCnJlc29sdmU6IHsKZnBhY2thZ2U6IGZ1bmN0aW9uKCkgewpyZXR1cm4gZnBhY2thZ2U7Cn0sCmJhbGFuY2U6IGZ1bmN0aW9uKCkgewpyZXR1cm4gJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLmJhbGFuY2U7Cn0sCmJ1c2luZXNzX3VzZXJfaWQ6IGZ1bmN0aW9uKCkgewpyZXR1cm4gJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQ7Cn0KfQp9KTsKfTsKCi8vIHNob3cgcGF5bWVudCBwb3B1cAokc2NvcGUuc2hvd1BheW1lbnREZXRhaWxzID0gZnVuY3Rpb24oZnBheW1lbnQpCnsKbG9nRGVidWcoInNob3dQYXltZW50RGV0YWlscyIpOwp2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKYW5pbWF0aW9uOiBmYWxzZSwKdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfY2xpZW50X3BheW1lbnRfZGV0YWlscy5waHAnLApzaXplOiAneHMnLApjb250cm9sbGVyOiAncGF5bWVueURldGFpbHNNb2RhbENvbnRyb2xsZXInLApyZXNvbHZlOiB7CmZwYXltZW50OiBmdW5jdGlvbigpIHsKcmV0dXJuIGZwYXltZW50Owp9Cn0KfSk7Cn0KJHNjb3BlLmludm9pY2VOdW1iZXJDaGFuZ2VkID0gZnVuY3Rpb24obmV3X2ludm9pY2VfbnVtYmVyLGZwYXltZW50KQp7CmxvZ0RlYnVnKCJpbnZvaWNlTnVtYmVyQ2hhbmdlZCAiKyBuZXdfaW52b2ljZV9udW1iZXIgKyJmb3IgIitKU09OLnN0cmluZ2lmeShmcGF5bWVudCkpOwpzZXRDbGllbnRQYXltZW50SW52b2ljZU51bWJlcigkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsZnBheW1lbnQudXNlcl9wYXltZW50X2lkLG5ld19pbnZvaWNlX251bWJlcixzZXRDbGllbnRQYXltZW50SW52b2ljZU51bWJlcl9jYWxsYmFjaywgc2V0Q2xpZW50UGF5bWVudEludm9pY2VOdW1iZXJfY2FsbGJhY2spOwpmdW5jdGlvbiBzZXRDbGllbnRQYXltZW50SW52b2ljZU51bWJlcl9jYWxsYmFjaygpCnsKLy8gJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwp9Cn07Cgokc2NvcGUuJG9uKCJjbGllbnRQYWdlUmVsb2FkRGF0YSIsZnVuY3Rpb24oZSxhKQp7CmxvZ0RlYnVnKCJjbGllbnRQYWdlUmVsb2FkRGF0YSIpOwpnZXRCdXNpbmVzc1VzZXJQYWNrYWdlcygkaHR0cCwkc2NvcGUsJ3VzZXJfcGFja2FnZXMnLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKZ2V0Q2xpZW50UGF5bWVudHMoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLCdjdXJyZW50Q2xpZW50UGF5bWVudHMnKTsKZ2V0Q2xpZW50RXZlbnRzKCRodHRwLCRzY29wZSwnY3VycmVudENsaWVudEV2ZW50cycsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwpnZXRCdXNpbmVzc0NsaWVudEluZm8oJGh0dHAsJHNjb3BlLCdmb3JtVXBkYXRlQ2xpZW50QW5ndWxhcicsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwoKICAgICAgLy8gJHRpbWVvdXQoZnVuY3Rpb24oKQogICAgICAvLyB7CiAgICAgIC8vICAgJHNjb3BlLmN1cnNvcmRlbGV0ZT0iIjsKICAgICAgLy8gICBkb2N1bWVudC5ib2R5LnN0eWxlLmN1cnNvcj0nJzsKICAgICAgLy8gfSwgMjAwMCk7Cgp9KTsKCiRzY29wZS5pc0NvbmZpcm1lZE9yQ2xvc2VkID0gZnVuY3Rpb24oZXZlbnQpCnsKaWYgKCRzY29wZS5zaG93QWxsRXZlbnRzKQp7CnJldHVybiB0cnVlOwp9CgppZiAoKGV2ZW50LmlzX2NvbmZpcm1lZCA9PSAxKSB8fCAoZXZlbnQuaXNfZmluYWxfc3RhdHVzID09IDEpIHx8ICgoZXZlbnQuaXNfd2FpdGluZ19saXN0ID09IDEpICYmIChldmVudC5pc19jYW5jZWxlZCA9PSAwKSkpCnsKcmV0dXJuIHRydWU7Cn0KZWxzZQp7CnJldHVybiBmYWxzZTsKfQp9CiRzY29wZS5nb3RvQ2xpZW50RWRpdFBhZ2U9Z290b0NsaWVudEVkaXRQYWdlOwokc2NvcGUuZ290b0JhY2s9ZnVuY3Rpb24oKQp7CmxvZ0RlYnVnKCdnbyBiYWNrJyk7CndpbmRvdy5oaXN0b3J5LmJhY2soKTsKfTsKCiRzY29wZS5nb3RvRXZlbnRQYWdlID0gZnVuY3Rpb24gKHRoZWV2ZW50KQp7CmdvdG9FdmVudFBhZ2UodGhlZXZlbnQpOwp9Cn0KJHNjb3BlLmluaXRpYXRlUGF5bWVudCA9IGZ1bmN0aW9uKGlzcGx1cykKewpsb2dEZWJ1ZygiaW5pdGlhdGVQYXltZW50IGlzcGx1cyIraXNwbHVzKTsKdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CmFuaW1hdGlvbjogZmFsc2UsCnRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2NsaWVudF9wYXltZW50LnBocCcsCmNvbnRyb2xsZXI6ICdidXNpbmVzc0NsaWVuZENhcmRQYXltZW50JywKLy8gc2l6ZTogc2l6ZSwKcmVzb2x2ZTogewpjdXJyZW50Q2xpZW50OiBmdW5jdGlvbigpIHsKcmV0dXJuICRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXTsKfSwKaXNwbHVzOiBmdW5jdGlvbigpIHsKcmV0dXJuIGlzcGx1czsKfQp9Cn0pOwp9Cgokc2NvcGUudXBkYXRlVXNlckZpcnN0TmFtZSA9IGZ1bmN0aW9uKG5ld1ZhbHVlKQp7CnNldENsaWVudEZpcnN0TmFtZSgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsbmV3VmFsdWUsYWZ0ZXJDbGllbnRTZXQsYWZ0ZXJDbGllbnRTZXQpOwpmdW5jdGlvbiBhZnRlckNsaWVudFNldCgpCnsKZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKfQp9CiRzY29wZS51cGRhdGVVc2VyTGFzdE5hbWUgPSBmdW5jdGlvbihuZXdWYWx1ZSkKewpzZXRDbGllbnRMYXN0TmFtZSgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsbmV3VmFsdWUsYWZ0ZXJDbGllbnRTZXQsYWZ0ZXJDbGllbnRTZXQpOwpmdW5jdGlvbiBhZnRlckNsaWVudFNldCgpCnsKZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKfQp9CiRzY29wZS51cGRhdGVVc2VyRW1haWwgPSBmdW5jdGlvbihuZXdWYWx1ZSkKewpzZXRDbGllbnRFbWFpbCgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsbmV3VmFsdWUsYWZ0ZXJzZXRDbGllbnRFbWFpbCxhZnRlcnNldENsaWVudEVtYWlsKTsKZnVuY3Rpb24gYWZ0ZXJzZXRDbGllbnRFbWFpbCgpCnsKZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKfQp9CgoKJHNjb3BlLnVwZGF0ZVVzZXJQaG9uZU51bWJlciA9IGZ1bmN0aW9uKG5ld1ZhbHVlKQp7Cm5ld1ZhbHVlID0gbmV3VmFsdWUucmVwbGFjZSgnLScsJycpOwppZiAoaXNOYU4obmV3VmFsdWUpKQp7CmFsZXJ0KCLXkNeg15Ag15TXltefINee16HXpNeoINeY15zXpNeV158g16rXp9eZ158iKTsKZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKfQplbHNlCnsKc2V0Q2xpZW50UGhvbmVOdW1iZXIoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLG5ld1ZhbHVlLHNldENsaWVudFBob25lTnVtYmVyX2NhbGxiYWNrLHNldENsaWVudFBob25lTnVtYmVyX2NhbGxiYWNrKTsKZnVuY3Rpb24gc2V0Q2xpZW50UGhvbmVOdW1iZXJfY2FsbGJhY2soKQp7CmdldEJ1c2luZXNzQ2xpZW50SW5mbygkaHR0cCwkc2NvcGUsJ2Zvcm1VcGRhdGVDbGllbnRBbmd1bGFyJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7Cn0KfQp9CiRzY29wZS51cGRhdGVVc2VyRXZlbnRQcmljZSA9IGZ1bmN0aW9uKG5ld3ZhbHVlLCB0aGVldmVudCkKewpuZXdfcHJpY2U9bmV3dmFsdWU7CnNldENsaWVudEV2ZW50UHJpY2UoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLHRoZWV2ZW50LmV2ZW50X2lkLCBuZXdfcHJpY2Usc2V0Q2xpZW50RXZlbnRQcmljZV9jYWxsYmFjaywgc2V0Q2xpZW50RXZlbnRQcmljZV9jYWxsYmFjayk7CmZ1bmN0aW9uIHNldENsaWVudEV2ZW50UHJpY2VfY2FsbGJhY2soKQp7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKfQp9OwoKJHNjb3BlLnVwZGF0ZVVzZXJQYWNrYWdlRXZlbnRzQ291bnRlciA9IGZ1bmN0aW9uKG5ld3ZhbHVlLCB0aGVwYWNrYWdlKQp7CmV2ZW50c19jb3VudGVyPW5ld3ZhbHVlOwpzZXRVc2VyUGFja2FnZUV2ZW50c0NvdW50ZXIoJGh0dHAsJHNjb3BlLHRoZXBhY2thZ2UucGFja2FnZV91c2VyX2lkLGV2ZW50c19jb3VudGVyLHNldFVzZXJQYWNrYWdlRXZlbnRzQ291bnRlcl9jYWxsYmFjaywgc2V0VXNlclBhY2thZ2VFdmVudHNDb3VudGVyX2NhbGxiYWNrKQpmdW5jdGlvbiBzZXRVc2VyUGFja2FnZUV2ZW50c0NvdW50ZXJfY2FsbGJhY2soKQp7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKfQp9Owokc2NvcGUudXBkYXRlVXNlclBhY2thZ2VQYWNrYWdlUHJpY2UgPSBmdW5jdGlvbihuZXd2YWx1ZSwgdGhlcGFja2FnZSkKewpwYWNrYWdlX3ByaWNlPW5ld3ZhbHVlOwpzZXRVc2VyUGFja2FnZVBhY2thZ2VQcmljZSgkaHR0cCwkc2NvcGUsdGhlcGFja2FnZS5wYWNrYWdlX3VzZXJfaWQscGFja2FnZV9wcmljZSxzZXRVc2VyUGFja2FnZVBhY2thZ2VQcmljZV9jYWxsYmFjaywgc2V0VXNlclBhY2thZ2VQYWNrYWdlUHJpY2VfY2FsbGJhY2spCmZ1bmN0aW9uIHNldFVzZXJQYWNrYWdlUGFja2FnZVByaWNlX2NhbGxiYWNrKCkKewovLyBnZXRCdXNpbmVzc1VzZXJQYWNrYWdlcygkaHR0cCwkc2NvcGUsJ3VzZXJfcGFja2FnZXMnLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwp9Cn07Cgokc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXIgPSB7fTsKbG9nRGVidWcoJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwokc2NvcGUuc2hvd19jbGllbnRfdXBkYXRlX2NsaWVudCA9IHRydWU7CiRzY29wZS5zaG93X2NsaWVudF91cGRhdGVfc2F2ZSA9IGZhbHNlOwokc2NvcGUuc2hvd19jbGllbnRfZGVsZXRlX2NsaWVudCA9IHRydWU7CiRzY29wZS5zaG93X2NsaWVudF91cGRhdGVfY2FuY2VsID0gZmFsc2U7Cgokc2NvcGUudXBkYXRlQ2xpZW50RW5hYmxlID0gZnVuY3Rpb24oKSB7CmxvZ0RlYnVnKCJlbmFibGluZyBlZGl0aW5nICgkc2NvcGUuY2xpZW50c1VwZGF0ZURpc2FibGVkIHdhcyAiICsgJHNjb3BlLmNsaWVudHNVcGRhdGVEaXNhYmxlZCArICIpIik7CiRzY29wZS5jbGllbnRzVXBkYXRlRGlzYWJsZWQgPSBmYWxzZTsKJHNjb3BlLnNob3dfY2xpZW50X3VwZGF0ZV9jbGllbnQgPSBmYWxzZTsKJHNjb3BlLnNob3dfY2xpZW50X3VwZGF0ZV9zYXZlID0gdHJ1ZTsKJHNjb3BlLnNob3dfY2xpZW50X2RlbGV0ZV9jbGllbnQgPSBmYWxzZTsKJHNjb3BlLnNob3dfY2xpZW50X3VwZGF0ZV9jYW5jZWwgPSB0cnVlOwp9CiRzY29wZS51cGRhdGVDbGllbnREaXNhYmxlID0gZnVuY3Rpb24oKSB7CmxvZ0RlYnVnKCJkaXNhYmxlIGVkaXRpbmciKTsKLy8JCSRsb2NhdGlvbi5wYXRoKCcvQ2xpZW50cy8nKyRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKJHJvdXRlLnJlbG9hZCgpOwp9CiRzY29wZS5zY2hlZHVsZUV2ZW50RnJvbUVuZFVzZXIgPSBmdW5jdGlvbigpIHsKc2hhcmVkRGF0YS5zZXRTZWxlY3RlZEVuZFVzZXIoewppZDogJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsCmZpcnN0X25hbWU6ICRzY29wZS5jdXJyZW50Q2xpZW50LnVzZXJzWzBdLmZpcnN0X25hbWUsCmxhc3RfbmFtZTogJHNjb3BlLmN1cnJlbnRDbGllbnQudXNlcnNbMF0ubGFzdF9uYW1lCn0pOwpsb2dEZWJ1Zygic2NoZWR1bGUgZXZlbnQgZm9yIHVzZXIgIiArICRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKLy8JCSRsb2NhdGlvbi5wYXRoKCcvQ2xpZW50cy8nKyRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jYWxlbmRhcicpOwp9CgogICAgJHNjb3BlLnVzZXJEZWxldGVQYXltZW50ID0gZnVuY3Rpb24gKGZwYXltZW50KQogICAgewogICAgICAvLyAkc2NvcGUuY3Vyc29yZGVsZXRlPSJ3YWl0IjsKICAgICAgbG9nRGVidWcoInVzZXJEZWxldGVQYXltZW50Iik7CiAgICAgIC8vIGRvY3VtZW50LmJvZHkuc3R5bGUuY3Vyc29yPSd3YWl0JzsKCiAgICAgIGRlbGV0ZUNsaWVudFBheW1lbnRzKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCxmcGF5bWVudC51c2VyX3BheW1lbnRfaWQsZGVsZXRlQ2xpZW50UGF5bWVudHNfc3VjY2Vzc19jYWxsYmFjayk7CiAgICAgIGZ1bmN0aW9uIGRlbGV0ZUNsaWVudFBheW1lbnRzX3N1Y2Nlc3NfY2FsbGJhY2soKQogICAgICB7CiAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgICAgIGxvZ0RlYnVnKCJ1c2VyRGVsZXRlUGF5bWVudCIpOwogICAgICAgIC8vICRzY29wZS5jdXJzb3JkZWxldGU9IiI7CiAgICAgICAgLy8gZG9jdW1lbnQuYm9keS5zdHlsZS5jdXJzb3I9Jyc7CiAgICAgIH0KICAgIH0KLy8gcmVtb3ZlIGVuZCB1c2VyIGZyb20gZXZlbnQKJHNjb3BlLnVzZXJEZWxldGVFdmVudCA9IGZ1bmN0aW9uKGVuZHVzZXJfaWQsIHRoZWV2ZW50KQp7Ci8vIGlmIGl0J3MgYSBjbGFzcyAtIHdlIHNpbXBseSByZW1vdmUgdGhlIHVzZXIgZnJvbSB0aGUgZXZlbnQKaWYgKHRoZWV2ZW50LmlzX2NsYXNzPT0xKQp7CmxvZ0RlYnVnKCJzY29wZS51c2VyRGVsZXRlRXZlbnQiKTsKcmVtb3ZlRW5kVXNlckZyb21FdmVudCgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsdGhlZXZlbnQuZXZlbnRfaWQscmVtb3ZlRW5kVXNlckZyb21FdmVudF9maW5pc2gsIHJlbW92ZUVuZFVzZXJGcm9tRXZlbnRfZmluaXNoKTsKZnVuY3Rpb24gcmVtb3ZlRW5kVXNlckZyb21FdmVudF9maW5pc2goKQp7CiRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKfQp9Ci8vIGlmIGl0cyBub3QgYSBjbGFzcyAtIHdlIG5lZWQgdG8gcmVtb3ZlIHRoZSBldmVudCBpdHNlbGYKZWxzZQp7Ci8vIGFsZXJ0KCJub3QgY2xhc3MgZXZlbnQsIFRPRE8iKTsKfQp9OwoKLy8gcmV0cmV2aW5nIHBhY2thZ2VzIGZvciB0aGUgYnVzaW5lc3MKZ2V0QnVzaW5lc3NQYWNrYWdlcygkaHR0cCwkc2NvcGUsJ3BhY2thZ2VzJyk7CgovLyBnZXQgcGFja2FnZXMgZm9yIHRoaXMgc3BlY2lmaWMgdXNlcgpnZXRCdXNpbmVzc1VzZXJQYWNrYWdlcygkaHR0cCwkc2NvcGUsJ3VzZXJfcGFja2FnZXMnLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKLy8gYWRkaW5nIHBhY2thZ2UgdG8gdXNlciAtIGNhbGxlZCB3aGVuIGEgcGFja2FnZSBpcyBzZWxlY3RlZAokc2NvcGUucGFja2FnZUZvckNsaWVudFNlbGVjdGVkID0gZnVuY3Rpb24oc2VsZWN0ZWRQYWNrYWdlKSB7CmlmIChzZWxlY3RlZFBhY2thZ2UpIHsKLy8gbG9nRGVidWcoJ3llcyBzZWxlY3RlZCAnICsgSlNPTi5zdHJpbmdpZnkoc2VsZWN0ZWRQYWNrYWdlKSk7CmFkZEJ1c2luZXNzUGFja2FnZVRvVXNlcigkaHR0cCwkc2NvcGUsc2VsZWN0ZWRQYWNrYWdlLm9yaWdpbmFsT2JqZWN0LCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLGFkZEJ1c2luZXNzUGFja2FnZVN1Y2Nlc3MpOwpmdW5jdGlvbiBhZGRCdXNpbmVzc1BhY2thZ2VTdWNjZXNzKCkKewpsb2dEZWJ1ZygiYWRkQnVzaW5lc3NQYWNrYWdlU3VjY2VzczIiKTsKLy8gZ2V0QnVzaW5lc3NQYWNrYWdlcygkaHR0cCwkc2NvcGUsJ3BhY2thZ2VzJyk7Ci8vIGdldEJ1c2luZXNzVXNlclBhY2thZ2VzKCRodHRwLCRzY29wZSwndXNlcl9wYWNrYWdlcycsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwokcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NsaWVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCn0KJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdhbmd1Y29tcGxldGUtYWx0OmNsZWFySW5wdXQnLCAnY2xpZW50X2FuZ3Vjb21wbGV0ZScpOwp9CmVsc2UKewovLyBsb2dEZWJ1Zygnbm90IHNlbGVjdGVkLCBkbyBub3RoaW5nJyk7Cn0KfTsKfSk7CgoKLy8gTmVlZCB0byBkaXN0aW5ndWlzaCBiZXR3ZWVuIGVuZCB1c2VyIChjbGllbnQpIGFuZCBidXNpbmVzcyBvd25lci4KLy8gY3VycmVudGx5IGNhbGxzIG9ubHkgZW5kIHVzZXIKa3V6ZUFwcC5jb250cm9sbGVyKCdIb21lQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICR1aWJNb2RhbCkKewoKZ2V0QWxsQ2xpZW50cygkaHR0cCwkc2NvcGUsJ2FsbENsaWVudHMnKTsKCiRzY29wZS5ob21lcGFnZUxpbWl0PTY7CmdldE9wZW5lZEV2ZW50cygkaHR0cCwkc2NvcGUsJHNjb3BlLmhvbWVwYWdlTGltaXQsJ29wZW5lZF9ldmVudHMnKTsKCnZhciB0b2RheWRhdGUgPSBuZXcgRGF0ZSgpOwp2YXIgaG93bWFueWRheXNhaGVhZD0zMDsKdmFyIHN0YXJ0ZGF0ZT10b2RheWRhdGUuZ2V0RnVsbFllYXIoKSsiLSIrKDErdG9kYXlkYXRlLmdldE1vbnRoKCkpKyItIit0b2RheWRhdGUuZ2V0RGF0ZSgpOwp0b2RheWRhdGUuc2V0RGF0ZSh0b2RheWRhdGUuZ2V0RGF0ZSgpICsgaG93bWFueWRheXNhaGVhZCk7CnZhciBlbmRkYXRlPXRvZGF5ZGF0ZS5nZXRGdWxsWWVhcigpKyItIisoMSt0b2RheWRhdGUuZ2V0TW9udGgoKSkrIi0iK3RvZGF5ZGF0ZS5nZXREYXRlKCk7CgovLyBmaWx0ZXIgZm9yIHVzZXJzIHdobyBoYXZlIGRlYnQKJHNjb3BlLmhhdmVEZWJ0ID0gZnVuY3Rpb24oZXVzZXIpCnsKaWYgKGV1c2VyLnVzZXJfYmFsYW5jZSA8IDApCnsKcmV0dXJuIHRydWU7Cn0KZWxzZQp7CnJldHVybiBmYWxzZTsKfQp9OwoKJHNjb3BlLmdvdG9DbGllbnRQYWdlID0gZnVuY3Rpb24oYnVzaW5lc3NfdXNlcl9pZCkKewovLyBsb2dEZWJ1ZyhldXNlcik7CndpbmRvdy5sb2NhdGlvbi5ocmVmPScvIy9idXNpbmVzc19jbGllbnRzLycgKyBidXNpbmVzc191c2VyX2lkOwp9Cgp2YXIgcGF5bG9hZCA9ICdzdGFydD0nICsgc3RhcnRkYXRlICsgJyZlbmQ9JyArIGVuZGRhdGU7CnZhciBjb25maWcgPSB7CmhlYWRlcnM6IHsnQ29udGVudC1UeXBlJzonYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkOyBjaGFyc2V0PVVURi04J30KfQogICAgdmFyIHBvc3R1cmwgPSAiL2FwaS9hZG1pbi9yZXBvcnRzL2V2ZW50czIiOwoKICAgICRzY29wZS5ldmVudFJlcG9ydENvbmZpZyA9IHt9OwogICAgJHNjb3BlLmV2ZW50UmVwb3J0Q29uZmlnLnNvdXJjZSA9ICJkb2NzIjsKICAgICRzY29wZS5ldmVudFJlcG9ydENvbmZpZy5maWx0ZXJzID0gewogICAgICBzdGFydF9kYXRlOiBzdGFydGRhdGUsCiAgICAgIGlzX2NhbmNlbGVkOiAnMCcsCiAgICAgIGVuZF9kYXRlOiBlbmRkYXRlCiAgICB9OwoKICAgIGdldEV2ZW50c1JlcG9ydCgkaHR0cCwkc2NvcGUsICRzY29wZS5ldmVudFJlcG9ydENvbmZpZywgZ2V0RXZlbnRzUmVwb3J0QWdncmVnYXRlZF9zdWNjZXNzKTsKCiAgICBmdW5jdGlvbiBnZXRFdmVudHNSZXBvcnRBZ2dyZWdhdGVkX3N1Y2Nlc3MocmVzcG9uc2UpewogICAgICAkc2NvcGUuYWRtaW5fZXZlbnRzID0gcmVzcG9uc2UuanNvbjsKICAgICAgICB9CiAgICAvLyAkaHR0cC5wb3N0KHBvc3R1cmwsIHBheWxvYWQsIGNvbmZpZykuc3VjY2VzcyhmdW5jdGlvbihkYXRhKQogICAgLy8gewogICAgLy8gICBsb2dEZWJ1ZygiZG9uZSIpOwogICAgLy8gICAkc2NvcGUuYWRtaW5fZXZlbnRzID0gZGF0YTsKICAgIC8vIH0pOwoKJHNjb3BlLnNob3dFdmVudFBvcHVwID0gZnVuY3Rpb24oc2VsZWN0ZWRFdmVudCkgewpzaG93RXZlbnRQb3B1cChzZWxlY3RlZEV2ZW50LCAkdWliTW9kYWwpCn07CiRzY29wZS5lZGl0RXZlbnQ9IGZ1bmN0aW9uICh0aGVldmVudCkKewpnb3RvRXZlbnRQYWdlKHRoZWV2ZW50KTsKfQp9KTsKCi8vIGt1emVBcHAuY29udHJvbGxlcignQnVzaW5lc3NDb25maWdDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJHJvdXRlUGFyYW1zLCAkbG9jYXRpb24sICRyb3V0ZSwgc2hhcmVkRGF0YSkgewoKa3V6ZUFwcC5jb250cm9sbGVyKCdDb25maWdVc2VyQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHVpYk1vZGFsLCAkaHR0cCwgJHRpbWVvdXQpCnsKJHNjb3BlLmluVGhlTWlkZGxlT2ZTYXZlPWZhbHNlOwoKbG9nRGVidWcoIkNvbmZpZ1VzZXJDb250cm9sbGVyIik7Ci8vICRzY29wZS5hamF4X2luZm89IteU16nXmdeg15XXmdeZ150g16DXqdee16jXlSI7CgogIGdldEJ1c2luZXNzVXNlclJlbGF0aW9ucygkaHR0cCwkc2NvcGUsJ2J1c2luZXNzX3VzZXJfcmVsYXRpb25zJyxnZXRMb2dnZWRVc2VySW5mb19zdWNjZXNzLGdldExvZ2dlZFVzZXJJbmZvX2ZhaWx1cmUpOwoKZ2V0TG9nZ2VkVXNlckluZm8oJGh0dHAsJHNjb3BlLCd1c2VyUHJvcGVydGllcycsZ2V0TG9nZ2VkVXNlckluZm9fc3VjY2VzcyxnZXRMb2dnZWRVc2VySW5mb19mYWlsdXJlKTsKZnVuY3Rpb24gZ2V0TG9nZ2VkVXNlckluZm9fc3VjY2VzcygpCnsKbG9nRGVidWcoImdldExvZ2dlZFVzZXJJbmZvX3N1Y2Nlc3MiKTsKICAgIC8vICRzY29wZS51c2VyUHJvcGVydGllc0R1cGxpY2F0ZSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoJHNjb3BlLnVzZXJQcm9wZXJ0aWVzKSk7Cn0KZnVuY3Rpb24gZ2V0TG9nZ2VkVXNlckluZm9fZmFpbHVyZSgpCnsKbG9nRGVidWcoImdldExvZ2dlZFVzZXJJbmZvX2ZhaWx1cmUiKTsKfQoKJHNjb3BlLmJhY2sgPSBmdW5jdGlvbigpIHsKd2luZG93Lmhpc3RvcnkuYmFjaygpOwp9OwoKJHNjb3BlLmNoYW5nZVBhc3N3b3JkTW9kYWwgPSBmdW5jdGlvbigpCnsKICAgIGxvZ0RlYnVnKCJjaGFuZ2VQYXNzd29yZE1vZGFsIiskc2NvcGUudXNlclByb3BlcnRpZXNEdXBsaWNhdGVbMF0pOwokc2NvcGUuaW5UaGVNaWRkbGVPZlNhdmU9dHJ1ZTsKZnVuY3Rpb24gc21zUmVzZXRQYXNzd29yZF9zdWNjZXNzKCkKewpjb25zb2xlLmxvZygic21zUmVzZXRQYXNzd29yZF9zdWNjZXNzIik7CnZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewphbmltYXRpb246IGZhbHNlLAp0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdtb2RhbF9jaGFuZ2VfcGFzc3dvcmQucGhwJywKY29udHJvbGxlcjogJ21vZGFsX2NoYW5nZV9wYXNzd29yZCcsCnNpemU6ICdsJywKcmVzb2x2ZTogewp1c2VyX3Bob25lX251bWJlcjogZnVuY3Rpb24oKSB7Ci8vIHBhc3Npbmcgb3JpZ2luYWwgcGhvbmUgbnVtYmVyCnJldHVybiAkc2NvcGUudXNlclByb3BlcnRpZXNEdXBsaWNhdGVbMF0ucGhvbmVfbnVtYmVyOwp9Cn0KfSk7Cgptb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHJlc3VsdCkgewokc2NvcGUuaW5UaGVNaWRkbGVPZlNhdmU9ZmFsc2U7CmxvZ0RlYnVnKCdzbXNSZXNldFBhc3N3b3JkIE1vZGFsIGZpbmlzZWhkIHJlc3VsdDogJyArIHJlc3VsdCk7CiRzY29wZS5hamF4X2luZm89IteU16HXmdeh157XkCDXoteV15PXm9eg15Qg15HXlNem15zXl9eUISI7Ci8vIGdldExvZ2dlZFVzZXJJbmZvKCRodHRwLCRzY29wZSwndXNlclByb3BlcnRpZXMnLGdldExvZ2dlZFVzZXJJbmZvX3N1Y2Nlc3MsZ2V0TG9nZ2VkVXNlckluZm9fZmFpbHVyZSk7CiR0aW1lb3V0KGZ1bmN0aW9uKCkKewokc2NvcGUuYWpheF9pbmZvPW51bGw7Cn0sIDIwMDApOwpsb2dEZWJ1Zygnc21zUmVzZXRQYXNzd29yZCBNb2RhbCBkaXNtaXNzZWQgYXQ6ICcgKyBuZXcgRGF0ZSgpKTsKfSwgZnVuY3Rpb24oKSB7CiRzY29wZS5pblRoZU1pZGRsZU9mU2F2ZT1mYWxzZTsKbG9nRGVidWcoJ21vZGFsX2NoYW5nZV9wYXNzd29yZCBNb2RhbCBkaXNtaXNzZWQgYXQ6ICcgKyBuZXcgRGF0ZSgpKTsKfSk7Cn0KCgpjaGFuZ2VQYXNzd29yZFNNUygkaHR0cCwkc2NvcGUsJHNjb3BlLnVzZXJQcm9wZXJ0aWVzRHVwbGljYXRlWzBdLnBob25lX251bWJlcixzbXNSZXNldFBhc3N3b3JkX3N1Y2Nlc3MpOwp9CiRzY29wZS51cGRhdGVVc2VyQ29uZmlnPWZ1bmN0aW9uKCkKewokc2NvcGUuaW5UaGVNaWRkbGVPZlNhdmU9dHJ1ZTsKbG9nRGVidWcoInVwZGF0ZVVzZXJDb25maWcsIGluVGhlTWlkZGxlT2ZTYXZlPSIrJHNjb3BlLmluVGhlTWlkZGxlT2ZTYXZlKTsKLy8gbG9nRGVidWcoJHNjb3BlLnVzZXJQcm9wZXJ0aWVzRHVwbGljYXRlKTsKLy8gbG9nRGVidWcoJHNjb3BlLnVzZXJQcm9wZXJ0aWVzKTsKaWYgKGFuZ3VsYXIuZXF1YWxzKCRzY29wZS51c2VyUHJvcGVydGllc0R1cGxpY2F0ZVswXS5waG9uZV9udW1iZXIsJHNjb3BlLnVzZXJQcm9wZXJ0aWVzWzBdLnBob25lX251bWJlcikpCnsKbG9nRGVidWcoIm5vdGhpbmcgY2hhbmdlZCBpbiBwaG9uZSBudW1iZXIsIGNoZWNraW5nIG90aGVyIGRhdGEgb3RoZXIgZGF0YSIpOwppZiAoYW5ndWxhci5lcXVhbHMoJHNjb3BlLnVzZXJQcm9wZXJ0aWVzRHVwbGljYXRlWzBdLCRzY29wZS51c2VyUHJvcGVydGllc1swXSkpCnsKJHNjb3BlLmluVGhlTWlkZGxlT2ZTYXZlPWZhbHNlOwpsb2dEZWJ1Zygibm90aGluZyBjaGFuZ2VkIGluIGRldGFpbHMsIG5vdGhpbmcgdG8gc2F2ZSIpOwokc2NvcGUuYWpheF9pbmZvPSLXnNeQINeR15XXptei15Ug16nXmdeg15XXmdeZ150g15zXqdee15nXqNeULi4uIjsKJHRpbWVvdXQoZnVuY3Rpb24oKQp7CiRzY29wZS5hamF4X2luZm89bnVsbDsKfSwgMTUwMCk7Cn0KZWxzZQp7CmNoYW5nZVVzZXJEZXRhaWxzKCRodHRwLCRzY29wZSwkc2NvcGUudXNlclByb3BlcnRpZXNbMF0uZmlyc3RfbmFtZSwkc2NvcGUudXNlclByb3BlcnRpZXNbMF0ubGFzdF9uYW1lLCAkc2NvcGUudXNlclByb3BlcnRpZXNbMF0uZW1haWxfYWRkcmVzcyxjaGFuZ2VVc2VyRGV0YWlsc19zdWNjZXNzLCBjaGFuZ2VVc2VyRGV0YWlsc19mYWlsdXJlKTsKJHNjb3BlLmFqYXhfaW5mbz0i157XoteT15vXnyDXqdeZ16DXldeZ15nXnS4uLiI7Cn0KCmZ1bmN0aW9uIGNoYW5nZVVzZXJEZXRhaWxzX3N1Y2Nlc3MoKQp7CmxvZ0RlYnVnKCJjaGFuZ2VVc2VyRGV0YWlsc19zdWNjZXNzIik7CiRzY29wZS5hamF4X2luZm89IteU16nXmdeg15XXmdeZ150g16DXqdee16jXlSDXkdeU16bXnNeX15QhIjsKJHNjb3BlLmluVGhlTWlkZGxlT2ZTYXZlPWZhbHNlOwokdGltZW91dChmdW5jdGlvbigpCnsKJHNjb3BlLmFqYXhfaW5mbz1udWxsOwp9LCAxNTAwKTsKZ2V0TG9nZ2VkVXNlckluZm8oJGh0dHAsJHNjb3BlLCd1c2VyUHJvcGVydGllcycsZ2V0TG9nZ2VkVXNlckluZm9fc3VjY2VzcyxnZXRMb2dnZWRVc2VySW5mb19mYWlsdXJlKTsKfQpmdW5jdGlvbiBjaGFuZ2VVc2VyRGV0YWlsc19mYWlsdXJlKCkKewpsb2dEZWJ1ZygiY2hhbmdlVXNlckRldGFpbHNfZmFpbHVyZSIpOwp9Cgp9CmVsc2UKewovLyB1cGRhdGUgdXNlciBpbmZvIC0gYWZ0ZXIgdmVyaWZ5aW5nIHBhc3N3b3JkCmNvbnNvbGUubG9nKCJwaG9uZSBjaGFuZ2VkLCBjaGVja2luZyBpZiBuZXcgcGhvbmUgaXMgaW4gZGVzY2VudCBmb3JtYXQiKTsKaWYgKCFjaGVja1Bob25lTnVtYmVyKCRzY29wZS51c2VyUHJvcGVydGllc1swXS5waG9uZV9udW1iZXIpKQp7CiRzY29wZS5hamF4X2luZm89IteQ16DXkCDXlNeW158g157Xodek16gg15jXnNek15XXnyDXodec15XXnNeo15kg16rXp9eZ158g15zXp9eR15zXqiDXlNeV15PXoteV16og157Xp9eZ15XXli4iOwokdGltZW91dChmdW5jdGlvbigpCnsKJHNjb3BlLmFqYXhfaW5mbz1udWxsOwp9LCAzMDAwKTsKcmV0dXJuOwp9CmNvbnNvbGUubG9nKCJwaG9uZSBjaGFuZ2VkLCBjaGVja2luZyBpZiBuZXcgcGhvbmUgaXMgbm90IHVzZWQgYWxyZWFkeSIpOwppc05ld1Bob25lVXNlZElmTm90U2VuZFNNUygkaHR0cCwkc2NvcGUsJHNjb3BlLnVzZXJQcm9wZXJ0aWVzWzBdLnBob25lX251bWJlciwgaXNOZXdQaG9uZVVzZWRfc3VjY2VzcywgaXNOZXdQaG9uZVVzZWRfZmFpbHVyZSxmYWxzZSk7CmZ1bmN0aW9uIGlzTmV3UGhvbmVVc2VkX3N1Y2Nlc3MocmVzcG9uc2UpCnsKY29uc29sZS5sb2coInBob25lIG5vdCB1c2VkIC0gcHJvbXB0aW5nIGZvciBwYXNzd29yZCIpOwp2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKYW5pbWF0aW9uOiBmYWxzZSwKdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnbW9kYWxfY2hlY2tfcGFzc3dvcmRfdXBkYXRlX2NvbmZpZy5waHAnLApjb250cm9sbGVyOiAnbW9kYWxfY2hlY2tfcGFzc3dvcmRfdXBkYXRlX2NvbmZpZycsCnNpemU6ICdsJywKcmVzb2x2ZTogewpuZXdfdXNlcl9wcm9lcnRpZXM6IGZ1bmN0aW9uKCkgewpyZXR1cm4gJHNjb3BlLnVzZXJQcm9wZXJ0aWVzWzBdOwp9Cn0KfSk7Cgptb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHJlc3VsdCkgewpsb2dEZWJ1ZygnbW9kYWxfY2hlY2tfcGFzc3dvcmRfdXBkYXRlX2NvbmZpZyBNb2RhbCBmaW5pc2hlZCByZXN1bHQ6ICcgKyByZXN1bHQpOwokc2NvcGUuYWpheF9pbmZvPSLXlNep15nXoNeV15nXmdedINeg16nXnteo15Ug15HXlNem15zXl9eUISI7CiRzY29wZS5pblRoZU1pZGRsZU9mU2F2ZT1mYWxzZTsKZ2V0TG9nZ2VkVXNlckluZm8oJGh0dHAsJHNjb3BlLCd1c2VyUHJvcGVydGllcycsZ2V0TG9nZ2VkVXNlckluZm9fc3VjY2VzcyxnZXRMb2dnZWRVc2VySW5mb19mYWlsdXJlKTsKJHRpbWVvdXQoZnVuY3Rpb24oKQp7CiRzY29wZS5hamF4X2luZm89bnVsbDsKfSwgMzAwMCk7Cn0sIGZ1bmN0aW9uKCkgewokc2NvcGUuaW5UaGVNaWRkbGVPZlNhdmU9ZmFsc2U7CmxvZ0RlYnVnKCdtb2RhbF9jaGVja19wYXNzd29yZF91cGRhdGVfY29uZmlnIE1vZGFsIGRpc21pc3NlZCBhdDogJyArIG5ldyBEYXRlKCkpOwp9KTsKfQoKZnVuY3Rpb24gaXNOZXdQaG9uZVVzZWRfZmFpbHVyZShyZXNwb25zZSkKewokc2NvcGUuYWpheF9pbmZvPXJlc3BvbnNlLm1lc3NhZ2U7CiR0aW1lb3V0KGZ1bmN0aW9uKCkKewokc2NvcGUuYWpheF9pbmZvPW51bGw7Cn0sIDIwMDApOwp9Cn0KfTsKfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdtb2RhbF9jaGVja19wYXNzd29yZF91cGRhdGVfY29uZmlnJywgZnVuY3Rpb24oJHNjb3BlLCAkdGltZW91dCwgJHVpYk1vZGFsSW5zdGFuY2UsIG5ld191c2VyX3Byb2VydGllcywgJGh0dHApCnsKJHNjb3BlLm5ld191c2VyX3Byb2VydGllcz1uZXdfdXNlcl9wcm9lcnRpZXM7CmxvZ0RlYnVnKCJtb2RhbF9jaGVja19wYXNzd29yZF91cGRhdGVfY29uZmlnIGNvbnRyb2xsZXIiKTsKLy8gJHNjb3BlLnBob25lX3ZlcmlmaWNhdGlvbiA9IHt9OyAvLyB0aGVzZSBhcmUgdGhlIGNvbXBsZXRlIGRldGFpbHMgZm9yIHRoZSBuZXcgZXZlbnQgLy8KLy8gJHNjb3BlLnBob25lX3ZlcmlmaWNhdGlvbi5waG9uZV9udW1iZXI9bmV3X3VzZXJfcHJvZXJ0aWVzLnBob25lX251bWJlcjsKJHNjb3BlLmNsb3NlID0gZnVuY3Rpb24oKSB7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCdkaXNtaXNzJyk7Cn07Cgokc2NvcGUuY2hhbmdlUGhvbmVOdW1iZXIgPSBmdW5jdGlvbigpCnsKY2hhbmdlVXNlckRldGFpbHNWZXJpZnkoJGh0dHAsJHNjb3BlLCRzY29wZS5uZXdfdXNlcl9wcm9lcnRpZXMucGhvbmVfbnVtYmVyLCRzY29wZS5uZXdfdXNlcl9wcm9lcnRpZXMuZmlyc3RfbmFtZSwkc2NvcGUubmV3X3VzZXJfcHJvZXJ0aWVzLmxhc3RfbmFtZSwgJHNjb3BlLm5ld191c2VyX3Byb2VydGllcy5lbWFpbF9hZGRyZXNzLCRzY29wZS52ZXJpZnlfdXNlcl9wYXNzd29yZCwkc2NvcGUucGhvbmVfdmVyaWZpY2F0aW9uLGNoYW5nZVVzZXJEZXRhaWxzVmVyaWZ5X3N1Y2Nlc3MsIGNoYW5nZVVzZXJEZXRhaWxzVmVyaWZ5X2ZhaWx1cmUsZmFsc2UpOwpmdW5jdGlvbiBjaGFuZ2VVc2VyRGV0YWlsc1ZlcmlmeV9zdWNjZXNzKCkKewpsb2dEZWJ1ZygiY2hhbmdlVXNlckRldGFpbHNWZXJpZnlfc3VjY2VzcyIpOwovLyBhbGVydCgn15TXqdeZ16DXldeZ15nXnSDXoteV15PXm9eg15Ug15HXlNem15zXl9eUJyk7CiR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKHRydWUpOwp9CmZ1bmN0aW9uIGNoYW5nZVVzZXJEZXRhaWxzVmVyaWZ5X2ZhaWx1cmUocmVzcG9uc2UpCnsKbG9nRGVidWcoImNoYW5nZVVzZXJEZXRhaWxzVmVyaWZ5X2ZhaWx1cmUgIityZXNwb25zZS5tZXNzYWdlKTsKJHNjb3BlLmFqYXhfZXJyb3I9cmVzcG9uc2UubWVzc2FnZSsiLiI7CiR0aW1lb3V0KGZ1bmN0aW9uKCkKewokc2NvcGUuYWpheF9lcnJvcj1udWxsOwp9LCA0MDAwKTsKfQp9Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignbW9kYWxfY2hhbmdlX3Bhc3N3b3JkJywgZnVuY3Rpb24oJHNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgdXNlcl9waG9uZV9udW1iZXIsICRodHRwKQp7CmxvZ0RlYnVnKCJtb2RhbF9jaGFuZ2VfcGFzc3dvcmQgY29udHJvbGxlciIpOwokc2NvcGUucGhvbmVfdmVyaWZpY2F0aW9uID0ge307IC8vIHRoZXNlIGFyZSB0aGUgY29tcGxldGUgZGV0YWlscyBmb3IgdGhlIG5ldyBldmVudCAvLwokc2NvcGUucGhvbmVfdmVyaWZpY2F0aW9uLnBob25lX251bWJlcj11c2VyX3Bob25lX251bWJlcjsKJHNjb3BlLnBob25lX3ZlcmlmaWNhdGlvbi5zbXNfZXJyb3I9IiI7CiRzY29wZS5jbG9zZSA9IGZ1bmN0aW9uKCkgewokdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnZGlzbWlzcycpOwp9OwoKJHNjb3BlLmNoYW5nZVBhc3N3b3JkID0gZnVuY3Rpb24oKQp7CmNoYW5nZVBhc3N3b3JkKCRodHRwLCRzY29wZSwkc2NvcGUucGhvbmVfdmVyaWZpY2F0aW9uLnVzZXJfcGFzc3dvcmQsJHNjb3BlLnBob25lX3ZlcmlmaWNhdGlvbi51c2VyX3Bhc3N3b3JkMiwkc2NvcGUucGhvbmVfdmVyaWZpY2F0aW9uLnZlcmlmaWNhdGlvbl9jb2RlLCBjaGFuZ2VQYXNzd29yZF9zdWNjZXNzLCBjaGFuZ2VQYXNzd29yZF9mYWlsdXJlLGZhbHNlKTsKJHNjb3BlLmFqYXhfZXJyb3I9IiI7CmZ1bmN0aW9uIGNoYW5nZVBhc3N3b3JkX3N1Y2Nlc3MoKQp7CmxvZ0RlYnVnKCJjaGFuZ2VQYXNzd29yZF9zdWNjZXNzIik7CnN0YXR1cz0iZmZmZmYiOwovLyBhbGVydCgn15TXodeZ16HXnteQINei15XXk9eb16DXlCDXkdeU16bXnNeX15QnKTsKJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UodHJ1ZSk7Cn0KZnVuY3Rpb24gY2hhbmdlUGFzc3dvcmRfZmFpbHVyZShyZXNwb25zZSkKewpsb2dEZWJ1ZygiY2hhbmdlUGFzc3dvcmRfZmFpbHVyZSAiK3Jlc3BvbnNlLm1lc3NhZ2UpOwokc2NvcGUuYWpheF9lcnJvcj1yZXNwb25zZS5tZXNzYWdlOwp9Cn0KfSk7CgprdXplQXBwLmZhY3RvcnkoJ0J1c2luZXNzQ29uZmlnJywgZnVuY3Rpb24oJGh0dHApIHsKcmV0dXJuIHsKZ2V0OiBmdW5jdGlvbiAoKSB7CmxvZ0RlYnVnKCJsb2FkIGdldF9idXNpbmVzc19jb25maWciKTsKcmV0dXJuICRodHRwLmdldCgiL2FwaS9hZG1pbi9idXNpbmVzc19jb25maWciKQoudGhlbihmdW5jdGlvbihyZXNwb25zZSkgewpyZXN1bHQgPSByZXNwb25zZS5kYXRhWzBdOwpyZXN1bHQudXNlX2hvbGlkYXlzPSEhcGFyc2VJbnQocmVzcG9uc2UuZGF0YVswXS51c2VfaG9saWRheXMpOwpyZXN1bHQuc21zX25vdGlmaWNhdGlvbnM9ISFwYXJzZUludChyZXNwb25zZS5kYXRhWzBdLnNtc19ub3RpZmljYXRpb25zKTsKcmVzdWx0LnN0YXJ0X2ludm9pY2VfbnVtYmVyID0gcGFyc2VJbnQocmVzcG9uc2UuZGF0YVswXS5zdGFydF9pbnZvaWNlX251bWJlcik7CnZhciBkID0gbmV3IERhdGUoKTsKZC5zZXRIb3VycyggcmVzdWx0LmNhbGVuZGFyX2Rpc3BsYXlfc3RhcnRfaG91cnMgKTsKZC5zZXRNaW51dGVzKCByZXN1bHQuY2FsZW5kYXJfZGlzcGxheV9zdGFydF9taW51dGVzICk7CnJlc3VsdC5teXRpbWUgPSBkOwpyZXN1bHQuY2FsZW5kYXJfZGlzcGxheV9zdGFydCA9IGQ7CnZhciBkID0gbmV3IERhdGUoKTsKZC5zZXRIb3VycyggcmVzdWx0LmNhbGVuZGFyX2Rpc3BsYXlfZW5kX2hvdXJzICk7CmQuc2V0TWludXRlcyggcmVzdWx0LmNhbGVuZGFyX2Rpc3BsYXlfZW5kX21pbnV0ZXMgKTsKcmVzdWx0Lm15dGltZSA9IGQ7CnJlc3VsdC5jYWxlbmRhcl9kaXNwbGF5X2VuZCA9IGQ7CnJlc3VsdC52YXRfcmF0ZSA9IE51bWJlcihyZXN1bHQudmF0X3JhdGUpOwpyZXR1cm4gcmVzdWx0Owp9KTsKfQp9Owp9KTsKCmt1emVBcHAuY29udHJvbGxlcignQ29uZmlnQnVzaW5lc3NDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJHRpbWVvdXQsIEJ1c2luZXNzQ29uZmlnKQp7CmxvZ0RlYnVnKCJteSBidXNpbmVzcyBjb25maWciKTsKJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXM9W107CgpmdW5jdGlvbiBnZXRfYnVzaW5lc3NfY29uZmlnKCkgewpsb2dEZWJ1ZygiZ2V0X2J1c2luZXNzX2NvbmZpZyIpOwpsb2dEZWJ1ZygiQnVzaW5lc3NDb25maWc6ICIsIEJ1c2luZXNzQ29uZmlnKTsKQnVzaW5lc3NDb25maWcuZ2V0KCkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7ICRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMgPSByZXN1bHQ7IH0pOwp9CmdldF9idXNpbmVzc19jb25maWcoKTsKCgokc2NvcGUuaHN0ZXAgPSAxOwokc2NvcGUubXN0ZXAgPSAxNTsKCiRzY29wZS5idXNpbmVzc0NvbmZpZ0NhbmNlbCA9IGZ1bmN0aW9uKCkgewp3aW5kb3cuaGlzdG9yeS5iYWNrKCk7Cn07Cgokc2NvcGUudXBkYXRlQnVzaW5lc3NDb25maWcgPSBmdW5jdGlvbigpIHsKbG9nRGVidWcoInVwZGF0aW5nIGJ1c2luZXNzIGNvbmZpZyIgKyBKU09OLnN0cmluZ2lmeSgkc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzKSk7Cgokc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzX2FqYXhfZXJyb3I9IiI7CiRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMuY2FsZW5kYXJfZGlzcGxheV9zdGFydF9ob3Vycz0kc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzLmNhbGVuZGFyX2Rpc3BsYXlfc3RhcnQuZ2V0SG91cnMoKTsKJHNjb3BlLmJ1c2luZXNzUHJvcGVydGllcy5jYWxlbmRhcl9kaXNwbGF5X3N0YXJ0X21pbnV0ZXM9JHNjb3BlLmJ1c2luZXNzUHJvcGVydGllcy5jYWxlbmRhcl9kaXNwbGF5X3N0YXJ0LmdldE1pbnV0ZXMoKTsKJHNjb3BlLmJ1c2luZXNzUHJvcGVydGllcy5jYWxlbmRhcl9kaXNwbGF5X2VuZF9ob3Vycz0kc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzLmNhbGVuZGFyX2Rpc3BsYXlfZW5kLmdldEhvdXJzKCk7CiRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMuY2FsZW5kYXJfZGlzcGxheV9lbmRfbWludXRlcz0kc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzLmNhbGVuZGFyX2Rpc3BsYXlfZW5kLmdldE1pbnV0ZXMoKTsKaWYgKCRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMuY2FsZW5kYXJfZGlzcGxheV9zdGFydF9ob3Vycz4kc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzLmNhbGVuZGFyX2Rpc3BsYXlfZW5kX2hvdXJzKQp7CmFsZXJ0KCfXltee158g16HXmdeV150g15zXkCDXmdeb15XXnCDXnNeU15nXldeqINec16TXoNeZINeW157XnyDXlNeq15fXnNeUJyk7CnJldHVybjsKfQokc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzX2FqYXhfZXJyb3I9Itee16LXk9eb158g16DXqteV16DXmdedLi4uIjsKCiRodHRwKHsKbWV0aG9kOiAnUE9TVCcsCnVybDogJy9hcGkvYWRtaW4vYnVzaW5lc3NfY29uZmlnL3NldCcsCmRhdGE6ICRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMsIC8vIHBhc3MgaW4gZGF0YSBhcyBzdHJpbmdzCmhlYWRlcnM6IHsKJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uO2NoYXJzZXQ9dXRmLTgnCn0KfSkuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7Cgpsb2dEZWJ1ZyhkYXRhKTsKaWYgKCFkYXRhLnN1Y2Nlc3MpIHsKbG9nRGVidWcoImVycm9yICIgKyBkYXRhLk1lc3NhZ2UpOwokc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzX2FqYXhfZXJyb3IgPSBkYXRhLk1lc3NhZ2U7Cn0gZWxzZSB7CiRnQ2FsZW5kYXJEaXNwbGF5TWluVGltZT1kYXRhLmpzb24ubmV3U3RhcnRUaW1lOwokZ0NhbGVuZGFyRGlzcGxheU1heFRpbWU9ZGF0YS5qc29uLm5ld0VuZFRpbWU7CmNvbnNvbGUubG9nKCJ1cGRhdGVkIGdDYWxlbmRhckRpc3BsYXlNaW5UaW1lPSIrJGdDYWxlbmRhckRpc3BsYXlNaW5UaW1lKTsKY29uc29sZS5sb2coInVwZGF0ZWQgZ0NhbGVuZGFyRGlzcGxheU1heFRpbWU9IiskZ0NhbGVuZGFyRGlzcGxheU1heFRpbWUpOwokc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzX2FqYXhfZXJyb3I9Itei15XXk9eb158g15HXlNem15zXl9eUISI7CiR0aW1lb3V0KGZ1bmN0aW9uKCkKewokc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzX2FqYXhfZXJyb3I9bnVsbDsKfSwgMjAwMCk7CmdldF9idXNpbmVzc19jb25maWcoKTsKLy8gd2luZG93Lmhpc3RvcnkuYmFjaygpOwovLyAkc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzX2FqYXhfZXJyb3IgPSAi16TXqNeY15kg15TXoteh16cg16DXqdee16jXlSDXkdeU16bXnNeX15QuIjsKCn0KfSk7Cn07Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignY2xpZW50Q2FyZENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUpIHsKbG9nRGVidWcoImNsaWVudENhcmRDb250cm9sbGVyIik7CiRzY29wZS5mdXR1cmVNZWV0aW5ncyA9IFt7CmRhdGV0aW1lOiAi16jXkNep15XXnywgMjUuMS4yMDE2IiwKaG91cjogIjE0OjAwIiwKdHlwZTogIten15HXldem15QiLApwcmljZTogIjEwMCIsCmxhYmVsczogW3sKbGFiZWw6ICJzdWNjZXNzIiwKdGV4dDogItep15XXnNedIgp9LCB7CmxhYmVsOiAid2FybmluZyIsCnRleHQ6ICLXnNeQINeq15XXoteTIgp9XQp9LCB7CmRhdGV0aW1lOiAi16jXkNep15XXnywgMjUuMS4yMDE2IiwKaG91cjogIjE0OjAwIiwKdHlwZTogIten15HXldem15QiLApwcmljZTogIjEwMCIsCmxhYmVsczogW3sKbGFiZWw6ICJkYW5nZXIiLAp0ZXh0OiAi15zXkCDXqdeV15zXnSIKfSwgewpsYWJlbDogImluZm8iLAp0ZXh0OiAi16rXldei15MiCn1dCn0sIHsKZGF0ZXRpbWU6ICLXqdec15nXqdeZLCAyNS4xLjIwMTYiLApob3VyOiAiMTQ6MDAiLAp0eXBlOiAi16fXkdeV16bXlCIsCnByaWNlOiAiMTAwIiwKbGFiZWxzOiBbewpsYWJlbDogImRhbmdlciIsCnRleHQ6ICLXnNeQINep15XXnNedIgp9LCB7CmxhYmVsOiAiaW5mbyIsCnRleHQ6ICLXqteV16LXkyIKfV0KfSwgewpkYXRldGltZTogIteo15DXqdeV158sIDI1LjEuMjAxNiIsCmhvdXI6ICIxNDowMCIsCnR5cGU6ICLXp9eR15XXpteUIiwKcHJpY2U6ICIxMDAiCn0sIF0KCiRzY29wZS5oaXN0b3J5TWVldGluZ3MgPSBbewpkYXRldGltZTogIteo15DXqdeV158sIDI1LjEuMjAxNiIsCmhvdXI6ICIxNDowMCIsCnR5cGU6ICLXp9eR15XXpteUIiwKcHJpY2U6ICIxMDAiCn0sIHsKZGF0ZXRpbWU6ICLXqNeQ16nXldefLCAyNS4xLjIwMTYiLApob3VyOiAiMTQ6MDAiLAp0eXBlOiAi16fXkdeV16bXlCIsCnByaWNlOiAiMTAwIgp9LCB7CmRhdGV0aW1lOiAi16nXnNeZ16nXmSwgMjUuMS4yMDE2IiwKaG91cjogIjE0OjAwIiwKdHlwZTogIten15HXldem15QiLApwcmljZTogIjEwMCIKfSwgewpkYXRldGltZTogIteo15DXqdeV158sIDI1LjEuMjAxNiIsCmhvdXI6ICIxNDowMCIsCnR5cGU6ICLXp9eR15XXpteUIiwKcHJpY2U6ICIxMDAiCn0sIF0KCiRzY29wZS5jY1BheW1lbnRzID0gW3sKZGF0ZXRpbWU6ICLXqNeQ16nXldefLCAyNS4xLjIwMTYiLApyZWNpcHRfbnVtOiAiNzY3IiwKYW1vdW50OiAiMzAwIiwKbGFiZWxzOiBbewpsYWJlbDogImRhbmdlciIsCnRleHQ6ICLXnNeQINep15XXmdeZ15oiCn0sIHsKbGFiZWw6ICJpbmZvIiwKdGV4dDogIteU15XXpNen15MiCn1dCn0sIF0KCgp9KTsKCmt1emVBcHAuY29udHJvbGxlcigna3V6ZUNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkbG9jYXRpb24pIHsKCi8vIG1haW4ga3V6ZSBjb250cm9sbGVyCgovLyBNVVNUIFNFVCBMQU5HVUFHRSBCRUZPUkUgQU5ZIE9USEVSIE9QRVJBVElPTiAhISEKdXBkYXRlR2xvYmFsTGFuZ3VhZ2UoJHNjb3BlLCAkZ0RlZmF1bHRMYW5nKTsKLy8gTVVTVCBTRVQgTEFOR1VBR0UgQkVGT1JFIEFOWSBPVEhFUiBPUEVSQVRJT04gISEhCgovLyBsb2dEZWJ1ZygieHh4eHh4eHgiICsgJHNjb3BlLmxhbmdmaWxlWydzaG93X2FsbF9jbGllbnRzJ10pOwoKJHNjb3BlLnNob3dDbGllbnRzQ29sdW1ucyA9IFt7CmZpZWxkOiAndXNlcl9pZCcsCm5hbWU6ICRzY29wZS5sYW5nZmlsZVsnc2hvd19hbGxfY2xpZW50c191c2VyaWQnXQp9LCB7CmZpZWxkOiAnYnVzZXJfZmlyc3RfbmFtZScsCm5hbWU6ICRzY29wZS5sYW5nZmlsZVsnc2hvd19hbGxfY2xpZW50c19maXJzdF9uYW1lJ10KfSwgewpmaWVsZDogJ2J1c2VyX2xhc3RfbmFtZScsCm5hbWU6ICRzY29wZS5sYW5nZmlsZVsnc2hvd19hbGxfY2xpZW50c19sYXN0X25hbWUnXQp9LCB7CmZpZWxkOiAncm9sZV9uYW1lJywKbmFtZTogJHNjb3BlLmxhbmdmaWxlWydzaG93X2FsbF9jbGllbnRzX2FwcHJvdmVkJ10KfV07CgoKJHNjb3BlLmdyaWRDbGllbnRDbGljayA9IGZ1bmN0aW9uKHJvdykgewovL2xvZ0RlYnVnKHJvdyk7CnZhciByb3dfdXNlcmlkID0gcm93LmVudGl0eS51c2VyX2lkOwpsb2dEZWJ1Zygic2VsZWN0ZWQgcm93IHVzZXJfaWQgPSIgKyByb3dfdXNlcmlkKTsKJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jbGllbnRzLycgKyByb3dfdXNlcmlkKTsKfTsKCiRzY29wZS5zaG93Q2xpZW50c0dyaWRPcHRpb25zID0gewplbmFibGVGaWx0ZXJpbmc6IGZhbHNlLAplbmFibGVTb3J0aW5nOiB0cnVlLApjb2x1bW5EZWZzOiAkc2NvcGUuc2hvd0NsaWVudHNDb2x1bW5zLApyb3dUZW1wbGF0ZTogJy9wdWJsaWMvY29tcG9uZW50cy9jbGllbnRzLWdyaWQtcm93Lmh0bWwnLApvblJlZ2lzdGVyQXBpOiBmdW5jdGlvbihncmlkQXBpKSB7CiRzY29wZS5ncmlkQXBpID0gZ3JpZEFwaTsKJHNjb3BlLmdyaWRBcGkuZ3JpZC5yZWdpc3RlclJvd3NQcm9jZXNzb3IoJHNjb3BlLnNpbmdsZUZpbHRlciwgMjAwKTsKfSwKfTsKCiRzY29wZS5pc0FjdGl2ZSA9IGZ1bmN0aW9uKHZpZXdMb2NhdGlvbikgewpsb2dEZWJ1Zygidmlld0xvY2F0aW9uID0gIiArIHZpZXdMb2NhdGlvbik7CnZhciBhY3RpdmUgPSAodmlld0xvY2F0aW9uID09PSAkbG9jYXRpb24ucGF0aCgpKTsKcmV0dXJuIGFjdGl2ZTsKfTsKCiRzY29wZS5maWx0ZXIgPSBmdW5jdGlvbigpIHsKbG9nRGVidWcoInNpbmdsZSBmaWx0ZXIiKTsKJHNjb3BlLmdyaWRBcGkuZ3JpZC5yZWZyZXNoKCk7CmlmICgkc2NvcGUuZmlsdGVyLlZhbHVlICE9ICIiKSB7CiRzY29wZS5maWx0ZXIuYnV0dG9uVmFsdWUgPSAiJyIgKyAkc2NvcGUuZmlsdGVyLlZhbHVlICsgIiciOwp9IGVsc2Ugewokc2NvcGUuZmlsdGVyLmJ1dHRvblZhbHVlID0gIiI7Cn0KfTsKCiRzY29wZS5zaW5nbGVGaWx0ZXIgPSBmdW5jdGlvbihyZW5kZXJhYmxlUm93cykgewp2YXIgbWF0Y2hlciA9IG5ldyBSZWdFeHAoJHNjb3BlLmZpbHRlci5WYWx1ZSk7CmxvZ0RlYnVnKCJzY29wZT0iICsgJHNjb3BlKTsKbG9nRGVidWcoInNjb3BlLmZpbHRlci5WYWx1ZT0iICsgJHNjb3BlLmZpbHRlci5WYWx1ZSk7CmlmICgoJHNjb3BlLmZpbHRlci5WYWx1ZSA9PSBudWxsKSB8fCAoJHNjb3BlLmZpbHRlci5WYWx1ZSA9PSAiIikpIHsKbG9nRGVidWcoImVtcHR5IGZpbHRlciIpOwpyZXR1cm4gcmVuZGVyYWJsZVJvd3M7Cn0KcmVuZGVyYWJsZVJvd3MuZm9yRWFjaChmdW5jdGlvbihyb3cpIHsKLy8JCQlsb2dEZWJ1Zygicm93PSIrcm93KTsKcm93LnZpc2libGUgPSBmYWxzZTsKdmFyICRjdXJyRmlyc3ROYW1lID0gcm93LmVudGl0eVsnZmlyc3RfbmFtZSddOwp2YXIgJGN1cnJMYXN0TmFtZSA9IHJvdy5lbnRpdHlbJ2xhc3RfbmFtZSddOwpsb2dEZWJ1ZygiY3VyckZpcnN0TmFtZT0iICsgJGN1cnJGaXJzdE5hbWUpOwoKaWYgKCRjdXJyRmlyc3ROYW1lICE9IG51bGwpIHsKaWYgKCRjdXJyRmlyc3ROYW1lLmluZGV4T2YoJHNjb3BlLmZpbHRlci5WYWx1ZSkgPiAtMSkgewpyb3cudmlzaWJsZSA9IHRydWU7Cn0KfSBlbHNlIC8vIHJvdyBpcyBudWxsCnsKcm93LnZpc2libGUgPSBmYWxzZTsKfQoKaWYgKCRjdXJyTGFzdE5hbWUgIT0gbnVsbCkgewppZiAoJGN1cnJMYXN0TmFtZS5pbmRleE9mKCRzY29wZS5maWx0ZXIuVmFsdWUpID4gLTEpIHsKcm93LnZpc2libGUgPSB0cnVlOwp9Cn0gZWxzZSAvLyByb3cgaXMgbnVsbAp7CnJvdy52aXNpYmxlID0gZmFsc2U7Cn0KfSk7CnJldHVybiByZW5kZXJhYmxlUm93czsKfTsKCi8vIGltcG9ydGFudCEhIGluaXRpYWxpemluZyBhbmd1bGFyIGZvcm1zIGFzIGFycmF5cwokc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIgPSB7fTsKJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyID0ge307CgovLyBsb2dEZWJ1ZygibG9jYXRpb249IiArICRsb2NhdGlvbik7Ci8vIGxvZ0RlYnVnKCRsb2NhdGlvbik7Cgokc2NvcGUuY2hhbmdlTGFuZyA9IGZ1bmN0aW9uKCRuZXdsYW5nKSB7CmxvZ0RlYnVnKCRuZXdsYW5nKTsKLy8kc2NvcGUuc3BDbGFzcyA9ICdyaWdodCc7CnVwZGF0ZUdsb2JhbExhbmd1YWdlKCRzY29wZSwgJG5ld2xhbmcpCn0KCiRzY29wZS5hZGROZXdDbGllbnQgPSBmdW5jdGlvbigpIHsKJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jbGllbnRzL2FkZCcpOwp9CiRzY29wZS5hZGROZXdJbnN0cnVjdG9yID0gZnVuY3Rpb24oKSB7CiRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfaW5zdHJ1Y3RvcnMvYWRkJyk7Cn0KfSk7CgovLy8vLy8gYmVmb3JlIGZvcm1zCmt1emVBcHAuY29udHJvbGxlcignRGVtb0NvbnRyb2xsZXInLCBbCickc2NvcGUnLCAnJGJ1aWxkZXInLCAnJHZhbGlkYXRvcicsCmZ1bmN0aW9uKCRzY29wZSwgJGJ1aWxkZXIsICR2YWxpZGF0b3IpIHsKdmFyIGNoZWNrYm94LCB0ZXh0Ym94Owp0ZXh0Ym94ID0gJGJ1aWxkZXIuYWRkRm9ybU9iamVjdCgnZGVmYXVsdCcsIHsKaWQ6ICd0ZXh0Ym94JywKY29tcG9uZW50OiAndGV4dElucHV0JywKbGFiZWw6ICdOYW1lJywKZGVzY3JpcHRpb246ICdZb3VyIG5hbWUnLApwbGFjZWhvbGRlcjogJ1lvdXIgbmFtZScsCnJlcXVpcmVkOiB0cnVlLAplZGl0YWJsZTogZmFsc2UKfSk7CmNoZWNrYm94ID0gJGJ1aWxkZXIuYWRkRm9ybU9iamVjdCgnZGVmYXVsdCcsIHsKaWQ6ICdjaGVja2JveCcsCmNvbXBvbmVudDogJ2NoZWNrYm94JywKbGFiZWw6ICdQZXRzJywKZGVzY3JpcHRpb246ICdEbyB5b3UgaGF2ZSBhbnkgcGV0cz8nLApvcHRpb25zOiBbJ0RvZycsICdDYXQnXQp9KTsKJGJ1aWxkZXIuYWRkRm9ybU9iamVjdCgnZGVmYXVsdCcsIHsKY29tcG9uZW50OiAnc2FtcGxlSW5wdXQnCn0pOwokc2NvcGUuZm9ybSA9ICRidWlsZGVyLmZvcm1zWydkZWZhdWx0J107CiRzY29wZS5pbnB1dCA9IFtdOwokc2NvcGUuZGVmYXVsdFZhbHVlID0ge307CiRzY29wZS5kZWZhdWx0VmFsdWVbdGV4dGJveC5pZF0gPSAnZGVmYXVsdCB2YWx1ZSc7CiRzY29wZS5kZWZhdWx0VmFsdWVbY2hlY2tib3guaWRdID0gW3RydWUsIHRydWVdOwpyZXR1cm4gJHNjb3BlLnN1Ym1pdCA9IGZ1bmN0aW9uKCkgewpyZXR1cm4gJHZhbGlkYXRvci52YWxpZGF0ZSgkc2NvcGUsICdkZWZhdWx0Jykuc3VjY2VzcyhmdW5jdGlvbigpIHsKcmV0dXJuIGxvZ0RlYnVnKCdzdWNjZXNzJyk7Cn0pLmVycm9yKGZ1bmN0aW9uKCkgewpyZXR1cm4gbG9nRGVidWcoJ2Vycm9yJyk7Cn0pOwp9Owp9Cl0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdBbGVydERlbW9DdHJsJywgZnVuY3Rpb24oJHNjb3BlKSB7CiRzY29wZS5hbGVydHMgPSBbewp0eXBlOiAnZGFuZ2VyJywKbXNnOiAnT2ggc25hcCEgQ2hhbmdlIGEgZmV3IHRoaW5ncyB1cCBhbmQgdHJ5IHN1Ym1pdHRpbmcgYWdhaW4uJwp9LCB7CnR5cGU6ICdzdWNjZXNzJywKbXNnOiAnV2VsbCBkb25lISBZb3Ugc3VjY2Vzc2Z1bGx5IHJlYWQgdGhpcyBpbXBvcnRhbnQgYWxlcnQgbWVzc2FnZS4nCn1dOwoKJHNjb3BlLmFkZEFsZXJ0ID0gZnVuY3Rpb24oKSB7CiRzY29wZS5hbGVydHMucHVzaCh7Cm1zZzogJ0Fub3RoZXIgYWxlcnQhJwp9KTsKfTsKCiRzY29wZS5jbG9zZUFsZXJ0ID0gZnVuY3Rpb24oaW5kZXgpIHsKJHNjb3BlLmFsZXJ0cy5zcGxpY2UoaW5kZXgsIDEpOwp9Owp9KTsKCgpmdW5jdGlvbiBpc051bWJlcktleShldnQpewp2YXIgY2hhckNvZGUgPSAoZXZ0LndoaWNoKSA/IGV2dC53aGljaCA6IGV2ZW50LmtleUNvZGU7CnJldHVybiAhKGNoYXJDb2RlID4gMzEgJiYgKGNoYXJDb2RlIDwgNDggfHwgY2hhckNvZGUgPiA1NykpOwp9Cgo=</text>
      </register>
      <register name=":" type="4">
        <text>%s/&quot;yPos&quot;: 0.20000000298023225/&quot;yPos&quot;: 0.1/</text>
      </register>
    </registers>
    <search>
      <last-search>initiatePayment</last-search>
      <last-offset />
      <last-pattern>initiatePayment</last-pattern>
      <last-replace>&quot;yPos&quot;: 0.1</last-replace>
      <last-substitute>&quot;yPos&quot;: 0.20000000298023225</last-substitute>
      <last-dir>1</last-dir>
      <show-last>false</show-last>
    </search>
    <history>
      <history-search>
        <entry>credit_card_type</entry>
        <entry>console.log</entry>
        <entry>cliend</entry>
        <entry>thedata</entry>
        <entry>Clliend</entry>
        <entry>Business</entry>
        <entry>paymentMethods</entry>
        <entry>business</entry>
        <entry>\/business_config</entry>
        <entry>\cUser</entry>
        <entry>cliendCard</entry>
        <entry>cliendBu</entry>
        <entry>CliendB</entry>
        <entry>Cliend</entry>
        <entry>BusinessCo</entry>
        <entry>\cbusinessconfig</entry>
        <entry encoding="base64">XDxjdXJyZW50Q2xpZW50XD4=</entry>
        <entry>admin</entry>
        <entry>admin\/users</entry>
        <entry>initiatePayment</entry>
      </history-search>
      <history-cmd>
        <entry encoding="base64">JzwsJz5zLzsvJ107Lw==</entry>
        <entry>s/, /\r/g</entry>
        <entry>s/, /,\r/g</entry>
        <entry>Reg</entry>
        <entry>reg</entry>
        <entry encoding="base64">JzwsJz5zL1wkLy9n</entry>
        <entry encoding="base64">JzwsJz5zLywkLyAuICIsIi8=</entry>
        <entry encoding="base64">JzwsJz5zLywkLyAuICIsIiAuLw==</entry>
        <entry encoding="base64">JzwsJz5zL1xFLykv</entry>
        <entry encoding="base64">JzwsJz5zL1w+Lykv</entry>
        <entry encoding="base64">JzwsJz5zLyAuLykgLi8=</entry>
        <entry encoding="base64">JzwsJz5zLyBcLi8pIC4v</entry>
        <entry encoding="base64">JzwsJz5zLyA9LiokLywv</entry>
        <entry encoding="base64">JzwsJz5zLyB8fCBudWxsLy8=</entry>
        <entry encoding="base64">JzwsJz5zLywgLywiIC4gIi8=</entry>
        <entry encoding="base64">JzwsJz5zLywgLywiIC4gIi9n</entry>
        <entry encoding="base64">JzwsJz5zLyBcLiAvIC5cci9n</entry>
        <entry encoding="base64">JzwsJz5zLyIiLyInJyIv</entry>
        <entry encoding="base64">JzwsJz5zLywvJywv</entry>
        <entry encoding="base64">JzwsJz5zLycvLw==</entry>
      </history-cmd>
      <history-expr />
      <history-input />
    </history>
    <shortcut-conflicts>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed OPEN_BRACKET</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed V</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed F</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed U</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed S</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed N</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed P</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed W</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>shift ctrl pressed A</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed C</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed D</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed R</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed A</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed T</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed I</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed B</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed CLOSE_BRACKET</text>
      </shortcut-conflict>
    </shortcut-conflicts>
  </component>
</application>
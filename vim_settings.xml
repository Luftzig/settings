<application>
  <component name="VimSettings">
    <state version="4" enabled="true" />
    <globalmarks />
    <filemarks>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/Decoration.cs" timestamp="1498573346394">
        <mark key="'" line="71" column="19" />
        <mark key="[" line="26" column="41" />
        <mark key="]" line="26" column="41" />
        <mark key="^" line="26" column="41" />
        <mark key="." line="26" column="41" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/DataService/ShapeData.cs" timestamp="1498570609670">
        <mark key="'" line="50" column="4" />
        <mark key="[" line="9" column="40" />
        <mark key="]" line="11" column="23" />
        <mark key="." line="11" column="23" />
        <mark key="^" line="11" column="23" />
      </file>
      <file name="$USER_HOME$/Projects/mocha-given/index.d.ts" timestamp="1490284104781">
        <mark key="'" line="1" column="0" />
        <mark key="[" line="11" column="0" />
        <mark key="]" line="11" column="0" />
        <mark key="." line="11" column="0" />
        <mark key="^" line="1" column="11" />
      </file>
      <file name="/a.dummy" timestamp="1498741252881">
        <mark key="[" line="0" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/phpold/kuze_utils.php" timestamp="1497784331390">
        <mark key="'" line="59" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/CameraMovement.cs" timestamp="1497450852828">
        <mark key="'" line="193" column="4" />
      </file>
      <file name="$USER_HOME$/Projects/Guy Prives/Automator/server/api/updater/updater.helpers.ts" timestamp="1492791203674">
        <mark key="'" line="25" column="36" />
        <mark key="[" line="33" column="48" />
        <mark key="]" line="34" column="24" />
        <mark key="." line="34" column="24" />
        <mark key="^" line="34" column="24" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/UI/ExitToast.cs" timestamp="1497532567374">
        <mark key="'" line="40" column="0" />
        <mark key="[" line="2" column="0" />
        <mark key="]" line="2" column="0" />
        <mark key="." line="2" column="0" />
        <mark key="^" line="10" column="9" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/PieceGenerator.cs" timestamp="1498668509814">
        <mark key="'" line="0" column="0" />
        <mark key="[" line="43" column="0" />
        <mark key="]" line="43" column="0" />
        <mark key="." line="43" column="0" />
        <mark key="^" line="78" column="66" />
      </file>
      <file name="$APPLICATION_CONFIG_DIR$/scratches/scratch.json" timestamp="1492339698148">
        <mark key="'" line="21" column="0" />
        <mark key="[" line="2" column="14" />
        <mark key="]" line="2" column="13" />
        <mark key="." line="2" column="13" />
        <mark key="^" line="2" column="13" />
      </file>
      <file name="$APPLICATION_CONFIG_DIR$/scratches/scratch_3.json" timestamp="1492678325641">
        <mark key="'" line="4983" column="0" />
        <mark key="[" line="0" column="0" />
        <mark key="]" line="0" column="48708" />
        <mark key="^" line="0" column="48708" />
        <mark key="." line="0" column="48708" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/UI/GameEditor/SaveButton.cs" timestamp="1498572998507">
        <mark key="'" line="74" column="42" />
        <mark key="[" line="74" column="42" />
        <mark key="]" line="74" column="50" />
        <mark key="." line="74" column="50" />
        <mark key="^" line="74" column="50" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/PuzzlePiece.cs" timestamp="1497973981788">
        <mark key="'" line="70" column="42" />
        <mark key="[" line="199" column="8" />
        <mark key="]" line="199" column="42" />
        <mark key="." line="199" column="42" />
        <mark key="^" line="199" column="42" />
      </file>
      <file name="/kuze_config.php" timestamp="1499159276667">
        <mark key="[" line="11" column="0" />
        <mark key="]" line="11" column="69" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/angular/business_modal_client_payment.php" timestamp="1499849501384">
        <mark key="[" line="118" column="0" />
        <mark key="]" line="118" column="0" />
        <mark key="." line="118" column="0" />
        <mark key="^" line="117" column="110" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/db_scripts/DB_Changes_v300.sql" timestamp="1499162835057">
        <mark key="[" line="3" column="0" />
        <mark key="]" line="35" column="57" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/public/js/angular/kuze_enduser_app.js" timestamp="1498045366621">
        <mark key="'" line="1187" column="20" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/db_scripts/2017_07_04_Business_invoices.sql" timestamp="1499168657271">
        <mark key="[" line="0" column="0" />
        <mark key="]" line="0" column="54" />
        <mark key="." line="1" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/api/invoices.php" timestamp="1498725747370">
        <mark key="'" line="95" column="4" />
        <mark key="[" line="7" column="6" />
        <mark key="]" line="7" column="6" />
        <mark key="." line="7" column="6" />
        <mark key="^" line="115" column="43" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/AndroidGalleryImageSaver.cs" timestamp="1497519923388">
        <mark key="'" line="31" column="0" />
        <mark key="[" line="15" column="0" />
        <mark key="]" line="15" column="0" />
        <mark key="^" line="15" column="16" />
        <mark key="." line="15" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/Guy Prives/Automator/server/package.json" timestamp="1492003154014">
        <mark key="'" line="6" column="19" />
        <mark key="[" line="37" column="19" />
        <mark key="]" line="37" column="24" />
        <mark key="." line="37" column="24" />
        <mark key="^" line="37" column="24" />
      </file>
      <file name="$USER_HOME$/Projects/mocha-given/package.json" timestamp="1490283218372">
        <mark key="'" line="10" column="18" />
        <mark key="[" line="10" column="14" />
        <mark key="]" line="10" column="18" />
        <mark key="^" line="10" column="18" />
        <mark key="." line="10" column="18" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/kuze_config/dev/kuze_config.php" timestamp="1499164550456">
        <mark key="[" line="14" column="21" />
        <mark key="]" line="14" column="23" />
        <mark key="." line="14" column="23" />
        <mark key="^" line="14" column="23" />
      </file>
      <file name="$USER_HOME$/Projects/luftzig.com/front/src/Styling.elm" timestamp="1497700286779">
        <mark key="'" line="39" column="31" />
        <mark key="[" line="39" column="47" />
        <mark key="]" line="39" column="47" />
        <mark key="." line="39" column="47" />
        <mark key="^" line="39" column="47" />
      </file>
      <file name="$USER_HOME$/Projects/luftzig.com/front/elm-stuff/packages/rtfeldman/elm-css/8.1.0/src/Css.elm" timestamp="1497694656695">
        <mark key="'" line="4371" column="8" />
      </file>
      <file name="$USER_HOME$/Projects/luftzig.com/front/src/View.elm" timestamp="1497799291882">
        <mark key="'" line="94" column="10" />
        <mark key="[" line="2" column="7" />
        <mark key="]" line="2" column="15" />
        <mark key="." line="2" column="15" />
        <mark key="^" line="2" column="15" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/kuze_const.php" timestamp="1499168789899">
        <mark key="'" line="55" column="34" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/api/api_admin.php" timestamp="1499850116572">
        <mark key="'" line="611" column="44" />
        <mark key="[" line="3155" column="46" />
        <mark key="]" line="3155" column="46" />
        <mark key="." line="3155" column="46" />
        <mark key="^" line="3155" column="75" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/public/js/angular/config-js.php" timestamp="1499175214438">
        <mark key="[" line="72" column="20" />
      </file>
      <file name="vim_settings.xml" timestamp="1498470093079">
        <mark key="[" line="0" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/site.conf" timestamp="1497783226999">
        <mark key="'" line="0" column="0" />
        <mark key="[" line="0" column="0" />
        <mark key="]" line="39" column="0" />
        <mark key="." line="8" column="4" />
        <mark key="^" line="8" column="4" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" timestamp="1499850472312">
        <mark key="'" line="6142" column="0" />
        <mark key="[" line="3" column="0" />
        <mark key="]" line="3" column="0" />
        <mark key="." line="3" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/angular/business_config.php" timestamp="1498044504233">
        <mark key="[" line="31" column="0" />
        <mark key="]" line="31" column="0" />
        <mark key="." line="31" column="0" />
      </file>
      <file name="$APPLICATION_CONFIG_DIR$/scratches/scratch_5.json" timestamp="1492685289704">
        <mark key="'" line="7" column="18" />
        <mark key="[" line="0" column="0" />
        <mark key="]" line="0" column="9003" />
        <mark key="^" line="0" column="9003" />
        <mark key="." line="0" column="9003" />
      </file>
      <file name="$APPLICATION_CONFIG_DIR$/consoles/.datagrid/cell" timestamp="1499162790640">
        <mark key="[" line="0" column="0" />
        <mark key="]" line="0" column="0" />
        <mark key="." line="0" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/luftzig.com/front/src/Main.elm" timestamp="1497695316614">
        <mark key="'" line="11" column="17" />
        <mark key="[" line="24" column="8" />
        <mark key="]" line="24" column="23" />
        <mark key="." line="24" column="23" />
        <mark key="^" line="24" column="23" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" timestamp="1499850464432">
        <mark key="'" line="0" column="0" />
        <mark key="[" line="0" column="0" />
        <mark key="]" line="6139" column="0" />
        <mark key="." line="1943" column="62" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/ImmortalManager.cs" timestamp="1498141711502">
        <mark key="'" line="123" column="73" />
        <mark key="[" line="127" column="67" />
        <mark key="]" line="127" column="70" />
        <mark key="^" line="127" column="70" />
        <mark key="." line="127" column="70" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/DataService/DataService.cs" timestamp="1498473617414">
        <mark key="'" line="16" column="24" />
        <mark key="[" line="38" column="54" />
        <mark key="]" line="38" column="54" />
        <mark key="^" line="38" column="56" />
        <mark key="." line="38" column="54" />
      </file>
      <file name="$USER_HOME$/Projects/the_bar_node/server/test/greeter-spec.ts" timestamp="1490284305782">
        <mark key="'" line="4" column="40" />
        <mark key="[" line="14" column="22" />
        <mark key="]" line="14" column="22" />
        <mark key="." line="14" column="22" />
        <mark key="^" line="12" column="37" />
      </file>
      <file name="$USER_HOME$/Projects/Guy Prives/Automator/server/api/updater/updater.model.ts" timestamp="1492787491819">
        <mark key="'" line="19" column="105" />
        <mark key="[" line="19" column="105" />
        <mark key="]" line="19" column="105" />
        <mark key="^" line="19" column="105" />
        <mark key="." line="19" column="105" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/DataService/StageData.cs" timestamp="1498123623435">
        <mark key="'" line="9" column="14" />
      </file>
      <file name="$APPLICATION_CONFIG_DIR$/scratches/scratch_6.json" timestamp="1492685876216">
        <mark key="'" line="452" column="0" />
        <mark key="[" line="517" column="35" />
        <mark key="]" line="517" column="33" />
        <mark key="^" line="517" column="33" />
        <mark key="." line="517" column="33" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/GardenScreenshot.cs" timestamp="1498662602044">
        <mark key="'" line="132" column="52" />
        <mark key="[" line="131" column="27" />
        <mark key="]" line="132" column="52" />
        <mark key="." line="132" column="52" />
        <mark key="^" line="132" column="52" />
      </file>
      <file name="$APPLICATION_CONFIG_DIR$/scratches/scratch_1.js" timestamp="1498387185354">
        <mark key="'" line="0" column="0" />
        <mark key="[" line="38" column="0" />
        <mark key="]" line="195" column="1" />
        <mark key="^" line="195" column="1" />
        <mark key="." line="167" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/invoice/create-doc.php" timestamp="1498744316602">
        <mark key="'" line="147" column="0" />
        <mark key="[" line="64" column="0" />
        <mark key="]" line="133" column="1" />
        <mark key="." line="101" column="23" />
        <mark key="^" line="101" column="23" />
      </file>
      <file name="$USER_HOME$/Projects/Guy Prives/Automator/server/api/appreciate-client/appreciate-client.ts" timestamp="1492789578918">
        <mark key="'" line="82" column="20" />
        <mark key="[" line="65" column="41" />
        <mark key="]" line="65" column="51" />
        <mark key="^" line="65" column="51" />
        <mark key="." line="65" column="51" />
      </file>
      <file name="$USER_HOME$/Projects/Guy Prives/Automator/server/api/appreciate-client/patch-request-converter.ts" timestamp="1492680861043">
        <mark key="'" line="64" column="0" />
        <mark key="[" line="65" column="25" />
        <mark key="]" line="65" column="31" />
        <mark key="^" line="65" column="31" />
        <mark key="." line="65" column="31" />
      </file>
      <file name="/dummy.sql" timestamp="1499175222411">
        <mark key="[" line="0" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/UI/GameEditor/LoadButton.cs" timestamp="1498489326900">
        <mark key="'" line="0" column="0" />
        <mark key="[" line="7" column="0" />
        <mark key="]" line="7" column="0" />
        <mark key="^" line="37" column="52" />
        <mark key="." line="7" column="0" />
      </file>
      <file name="$APPLICATION_CONFIG_DIR$/consoles/db/6e25fe0b-98f3-46a4-9336-01e7aed49277/console.sql" timestamp="1499171616631">
        <mark key="[" line="0" column="52" />
        <mark key="]" line="0" column="75" />
        <mark key="^" line="0" column="75" />
        <mark key="." line="0" column="75" />
      </file>
      <file name="$USER_HOME$/Projects/zengarden/Assets/Scripts/Game/Borders.cs" timestamp="1497869872208">
        <mark key="'" line="0" column="0" />
        <mark key="[" line="27" column="0" />
        <mark key="]" line="27" column="0" />
        <mark key="^" line="14" column="49" />
        <mark key="." line="27" column="0" />
      </file>
      <file name="/Dummy.txt" timestamp="1499850475968">
        <mark key="[" line="0" column="0" />
      </file>
      <file name="$USER_HOME$/Projects/luftzig.com/front/src/Sections/CodeSection.elm" timestamp="1497799548443">
        <mark key="'" line="39" column="20" />
        <mark key="[" line="22" column="21" />
        <mark key="]" line="22" column="20" />
        <mark key="." line="22" column="20" />
        <mark key="^" line="22" column="20" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/api/linetInvoice.php" timestamp="1498746722575">
        <mark key="'" line="9" column="26" />
        <mark key="[" line="9" column="26" />
        <mark key="]" line="9" column="57" />
        <mark key="^" line="8" column="23" />
        <mark key="." line="8" column="23" />
      </file>
      <file name="$USER_HOME$/Projects/kuze/php/kuze_login.php" timestamp="1497776244958">
        <mark key="'" line="43" column="8" />
      </file>
      <file name="$APPLICATION_CONFIG_DIR$/scratches/scratch_1.json" timestamp="1492339311193">
        <mark key="'" line="2669" column="0" />
        <mark key="[" line="0" column="0" />
        <mark key="]" line="2669" column="0" />
        <mark key="^" line="0" column="31135" />
        <mark key="." line="0" column="31135" />
      </file>
    </filemarks>
    <jumps>
      <jump line="47" column="0" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="2263" column="56" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="49" column="34" filename="$USER_HOME$/Projects/kuze/php/kuze_const.php" />
      <jump line="152" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/config-js.php" />
      <jump line="1926" column="52" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5742" column="15" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="2002" column="6" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="2269" column="49" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="3132" column="11" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="3133" column="24" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="3167" column="37" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="575" column="55" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="593" column="55" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="611" column="44" filename="$USER_HOME$/Projects/kuze/php/api/api_admin.php" />
      <jump line="237" column="38" filename="$USER_HOME$/Projects/kuze/php/kuze_payment_utils.php" />
      <jump line="113" column="8" filename="$USER_HOME$/Projects/kuze/php/kuze_payment_utils.php" />
      <jump line="241" column="48" filename="$USER_HOME$/Projects/kuze/php/kuze_payment_utils.php" />
      <jump line="7" column="27" filename="$USER_HOME$/Projects/kuze/php/kuze_payment_utils.php" />
      <jump line="661" column="9" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/kuze_business_utils-v11.js" />
      <jump line="5047" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="4871" column="2" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5222" column="19" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5438" column="6" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5278" column="45" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5268" column="19" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="4690" column="8" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="4715" column="19" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5269" column="19" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="1892" column="22" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="727" column="8" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/kuze_business_utils-v11.js" />
      <jump line="48" column="2" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/kuze_business_utils-v11.js" />
      <jump line="738" column="6" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/kuze_business_utils-v11.js" />
      <jump line="4621" column="49" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5280" column="82" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="1888" column="20" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="1893" column="12" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="4716" column="19" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5270" column="19" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="4726" column="18" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="53" column="9" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/kuze_business_utils-v11.js" />
      <jump line="5283" column="12" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="4725" column="18" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5272" column="19" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="1955" column="19" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5886" column="4" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="1934" column="44" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="13" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="1942" column="62" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="2021" column="34" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="1940" column="17" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="1941" column="25" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="2032" column="8" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="93" column="5" filename="$USER_HOME$/Projects/kuze/php/kuze_db.php" />
      <jump line="102" column="30" filename="$USER_HOME$/Projects/kuze/php/kuze_db.php" />
      <jump line="106" column="21" filename="$USER_HOME$/Projects/kuze/php/kuze_payment_utils.php" />
      <jump line="1952" column="40" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="3402" column="4" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="3390" column="7" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="3198" column="10" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="3191" column="4" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="3141" column="4" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="2959" column="3" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="2953" column="2" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="2306" column="3" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="1597" column="2" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="1596" column="2" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="1190" column="4" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="1189" column="4" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="1102" column="3" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="1101" column="3" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="912" column="7" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="871" column="3" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="826" column="6" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="644" column="4" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="627" column="3" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="626" column="3" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="570" column="6" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="569" column="6" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="568" column="6" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5861" column="8" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5860" column="8" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5680" column="8" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5676" column="6" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5666" column="6" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="5588" column="6" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="4902" column="3" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="4729" column="4" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="4714" column="4" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="4650" column="14" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="4599" column="4" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="4513" column="4" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="4498" column="4" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="4228" column="3" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="4223" column="8" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="4000" column="14" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="3947" column="3" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="1972" column="3" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="0" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.js" />
      <jump line="45" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
      <jump line="6142" column="0" filename="$USER_HOME$/Projects/kuze/php/public/js/angular/business-app-v11.php" />
    </jumps>
    <registers>
      <register name="&quot;" type="2">
        <text encoding="base64">PD9waHAgaW5jbHVkZSAoJ2J1c2luZXNzLWFwcC12MTEuanMnKSA/Pgo=</text>
      </register>
      <register name="-" type="4">
        <text>, 'credit_transaction_type'</text>
      </register>
      <register name="/" type="4">
        <text>console.log</text>
      </register>
      <register name="0" type="2">
        <text encoding="base64">Ly8gdjExIC0gMjMgbWFyY2ggMjAxNwovL0RlZmluZSBhbiBhbmd1bGFyIG1vZHVsZSBmb3Igb3VyIGFwcAoKdmFyIGt1emVJc0NhbGVuZGFyRHJhZ2dibGU7Cmt1emVJc0NhbGVuZGFyRHJhZ2dibGUgPSB0cnVlOwoKLy8gYW5ndWxhciBtb2R1bGVzCi8vJGFuZ3VsYXJNb2R1bGVzPVsnbmdSb3V0ZScsJ3VpLmJvb3RzdHJhcCcsJ3VpLmdyaWQnXTsKJGFuZ3VsYXJNb2R1bGVzID0gWyduZ1JvdXRlJywgJ3VpLmJvb3RzdHJhcCcsICd1aS5ncmlkJywgJ2J1aWxkZXInLCAnYnVpbGRlci5jb21wb25lbnRzJywgJ3ZhbGlkYXRvci5ydWxlcycsICd1aS5jYWxlbmRhcicsICdjaGVja2xpc3QtbW9kZWwnLCAndWkuYm9vdHN0cmFwLmRhdGV0aW1lcGlja2VyJywgJ2FuZ3Vjb21wbGV0ZS1hbHQnLCAnbXVsdGlwbGVTZWxlY3QnLCdhbmd1bGFySW5saW5lRWRpdCcsJ3RleHRBbmd1bGFyJywnbmdDc3YnXTsKCnZhciBkYXlOYW1lcyA9IFsn16jXkNep15XXnycsICfXqdeg15knLCAn16nXnNeZ16nXmScsICfXqNeR15nXoteZJywgJ9eX157Xmdep15knLCAn16nXmdep15knLCAn16nXkdeqJ107CnZhciBtb250aE5hbWVzID0gWyLXmdeg15XXkNeoIiwgItek15HXqNeV15DXqCIsICLXnteo16UiLCAi15DXpNeo15nXnCIsICLXnteQ15kiLCAi15nXldeg15kiLAogICLXmdeV15zXmSIsICLXkNeV15LXldeh15giLCAi16HXpNeY157XkdeoIiwgIteQ15XXp9eY15XXkdeoIiwgIteg15XXkdee15HXqCIsICLXk9em157XkdeoIgpdOwoKdmFyIGxvZ2luTmV4dFNjcmVlbj0iIjsKCihmdW5jdGlvbigpe0RhdGUuc2hvcnRNb250aHM9WyJKYW4iLCJGZWIiLCJNYXIiLCJBcHIiLCJNYXkiLCJKdW4iLCJKdWwiLCJBdWciLCJTZXAiLCJPY3QiLCJOb3YiLCJEZWMiXSxEYXRlLmxvbmdNb250aHM9WyJKYW51YXJ5IiwiRmVicnVhcnkiLCJNYXJjaCIsIkFwcmlsIiwiTWF5IiwiSnVuZSIsIkp1bHkiLCJBdWd1c3QiLCJTZXB0ZW1iZXIiLCJPY3RvYmVyIiwiTm92ZW1iZXIiLCJEZWNlbWJlciJdLERhdGUuc2hvcnREYXlzPVsiU3VuIiwiTW9uIiwiVHVlIiwiV2VkIiwiVGh1IiwiRnJpIiwiU2F0Il0sRGF0ZS5sb25nRGF5cz1bIlN1bmRheSIsIk1vbmRheSIsIlR1ZXNkYXkiLCJXZWRuZXNkYXkiLCJUaHVyc2RheSIsIkZyaWRheSIsIlNhdHVyZGF5Il07dmFyIHQ9e2Q6ZnVuY3Rpb24oKXtyZXR1cm4odGhpcy5nZXREYXRlKCk8MTA/IjAiOiIiKSt0aGlzLmdldERhdGUoKX0sRDpmdW5jdGlvbigpe3JldHVybiBEYXRlLnNob3J0RGF5c1t0aGlzLmdldERheSgpXX0sajpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldERhdGUoKX0sbDpmdW5jdGlvbigpe3JldHVybiBEYXRlLmxvbmdEYXlzW3RoaXMuZ2V0RGF5KCldfSxOOmZ1bmN0aW9uKCl7cmV0dXJuIDA9PXRoaXMuZ2V0RGF5KCk/Nzp0aGlzLmdldERheSgpfSxTOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZ2V0RGF0ZSgpJTEwPT0xJiYxMSE9dGhpcy5nZXREYXRlKCk/InN0Ijp0aGlzLmdldERhdGUoKSUxMD09MiYmMTIhPXRoaXMuZ2V0RGF0ZSgpPyJuZCI6dGhpcy5nZXREYXRlKCklMTA9PTMmJjEzIT10aGlzLmdldERhdGUoKT8icmQiOiJ0aCJ9LHc6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5nZXREYXkoKX0sejpmdW5jdGlvbigpe3ZhciB0PW5ldyBEYXRlKHRoaXMuZ2V0RnVsbFllYXIoKSwwLDEpO3JldHVybiBNYXRoLmNlaWwoKHRoaXMtdCkvODY0ZTUpfSxXOmZ1bmN0aW9uKCl7dmFyIHQ9bmV3IERhdGUodGhpcy52YWx1ZU9mKCkpLGU9KHRoaXMuZ2V0RGF5KCkrNiklNzt0LnNldERhdGUodC5nZXREYXRlKCktZSszKTt2YXIgbj10LnZhbHVlT2YoKTtyZXR1cm4gdC5zZXRNb250aCgwLDEpLDQhPT10LmdldERheSgpJiZ0LnNldE1vbnRoKDAsMSsoNC10LmdldERheSgpKzcpJTcpLDErTWF0aC5jZWlsKChuLXQpLzYwNDhlNSl9LEY6ZnVuY3Rpb24oKXtyZXR1cm4gRGF0ZS5sb25nTW9udGhzW3RoaXMuZ2V0TW9udGgoKV19LG06ZnVuY3Rpb24oKXtyZXR1cm4odGhpcy5nZXRNb250aCgpPDk/IjAiOiIiKSsodGhpcy5nZXRNb250aCgpKzEpfSxNOmZ1bmN0aW9uKCl7cmV0dXJuIERhdGUuc2hvcnRNb250aHNbdGhpcy5nZXRNb250aCgpXX0sbjpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldE1vbnRoKCkrMX0sdDpmdW5jdGlvbigpe3ZhciB0PXRoaXMuZ2V0RnVsbFllYXIoKSxlPXRoaXMuZ2V0TW9udGgoKSsxO3JldHVybiAxMj09PWUmJih0PXQrKyxlPTApLG5ldyBEYXRlKHQsZSwwKS5nZXREYXRlKCl9LEw6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLmdldEZ1bGxZZWFyKCk7cmV0dXJuIHQlNDAwPT0wfHx0JTEwMCE9MCYmdCU0PT0wfSxvOmZ1bmN0aW9uKCl7dmFyIHQ9bmV3IERhdGUodGhpcy52YWx1ZU9mKCkpO3JldHVybiB0LnNldERhdGUodC5nZXREYXRlKCktKHRoaXMuZ2V0RGF5KCkrNiklNyszKSx0LmdldEZ1bGxZZWFyKCl9LFk6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5nZXRGdWxsWWVhcigpfSx5OmZ1bmN0aW9uKCl7cmV0dXJuKCIiK3RoaXMuZ2V0RnVsbFllYXIoKSkuc3Vic3RyKDIpfSxhOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZ2V0SG91cnMoKTwxMj8iYW0iOiJwbSJ9LEE6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5nZXRIb3VycygpPDEyPyJBTSI6IlBNIn0sQjpmdW5jdGlvbigpe3JldHVybiBNYXRoLmZsb29yKDFlMyooKHRoaXMuZ2V0VVRDSG91cnMoKSsxKSUyNCt0aGlzLmdldFVUQ01pbnV0ZXMoKS82MCt0aGlzLmdldFVUQ1NlY29uZHMoKS8zNjAwKS8yNCl9LGc6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5nZXRIb3VycygpJTEyfHwxMn0sRzpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldEhvdXJzKCl9LGg6ZnVuY3Rpb24oKXtyZXR1cm4oKHRoaXMuZ2V0SG91cnMoKSUxMnx8MTIpPDEwPyIwIjoiIikrKHRoaXMuZ2V0SG91cnMoKSUxMnx8MTIpfSxIOmZ1bmN0aW9uKCl7cmV0dXJuKHRoaXMuZ2V0SG91cnMoKTwxMD8iMCI6IiIpK3RoaXMuZ2V0SG91cnMoKX0saTpmdW5jdGlvbigpe3JldHVybih0aGlzLmdldE1pbnV0ZXMoKTwxMD8iMCI6IiIpK3RoaXMuZ2V0TWludXRlcygpfSxzOmZ1bmN0aW9uKCl7cmV0dXJuKHRoaXMuZ2V0U2Vjb25kcygpPDEwPyIwIjoiIikrdGhpcy5nZXRTZWNvbmRzKCl9LHU6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLmdldE1pbGxpc2Vjb25kcygpO3JldHVybigxMD50PyIwMCI6MTAwPnQ/IjAiOiIiKSt0fSxlOmZ1bmN0aW9uKCl7cmV0dXJuL1woKC4qKVwpLy5leGVjKChuZXcgRGF0ZSkudG9TdHJpbmcoKSlbMV19LEk6ZnVuY3Rpb24oKXtmb3IodmFyIHQ9bnVsbCxlPTA7MTI+ZTsrK2Upe3ZhciBuPW5ldyBEYXRlKHRoaXMuZ2V0RnVsbFllYXIoKSxlLDEpLGk9bi5nZXRUaW1lem9uZU9mZnNldCgpO2lmKG51bGw9PT10KXQ9aTtlbHNle2lmKHQ+aSl7dD1pO2JyZWFrfWlmKGk+dClicmVha319cmV0dXJuIHRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKT09dHwwfSxPOmZ1bmN0aW9uKCl7cmV0dXJuKC10aGlzLmdldFRpbWV6b25lT2Zmc2V0KCk8MD8iLSI6IisiKSsoTWF0aC5hYnModGhpcy5nZXRUaW1lem9uZU9mZnNldCgpLzYwKTwxMD8iMCI6IiIpK01hdGguZmxvb3IoTWF0aC5hYnModGhpcy5nZXRUaW1lem9uZU9mZnNldCgpLzYwKSkrKDA9PU1hdGguYWJzKHRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKSU2MCk/IjAwIjooTWF0aC5hYnModGhpcy5nZXRUaW1lem9uZU9mZnNldCgpJTYwKTwxMD8iMCI6IiIpK01hdGguYWJzKHRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKSU2MCkpfSxQOmZ1bmN0aW9uKCl7cmV0dXJuKC10aGlzLmdldFRpbWV6b25lT2Zmc2V0KCk8MD8iLSI6IisiKSsoTWF0aC5hYnModGhpcy5nZXRUaW1lem9uZU9mZnNldCgpLzYwKTwxMD8iMCI6IiIpK01hdGguZmxvb3IoTWF0aC5hYnModGhpcy5nZXRUaW1lem9uZU9mZnNldCgpLzYwKSkrIjoiKygwPT1NYXRoLmFicyh0aGlzLmdldFRpbWV6b25lT2Zmc2V0KCklNjApPyIwMCI6KE1hdGguYWJzKHRoaXMuZ2V0VGltZXpvbmVPZmZzZXQoKSU2MCk8MTA/IjAiOiIiKStNYXRoLmFicyh0aGlzLmdldFRpbWV6b25lT2Zmc2V0KCklNjApKX0sVDpmdW5jdGlvbigpe3JldHVybiB0aGlzLnRvVGltZVN0cmluZygpLnJlcGxhY2UoL14uKyBcKD8oW15cKV0rKVwpPyQvLCIkMSIpfSxaOmZ1bmN0aW9uKCl7cmV0dXJuIDYwKi10aGlzLmdldFRpbWV6b25lT2Zmc2V0KCl9LGM6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5mb3JtYXQoIlktbS1kXFxUSDppOnNQIil9LHI6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy50b1N0cmluZygpfSxVOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZ2V0VGltZSgpLzFlM319O0RhdGUucHJvdG90eXBlLmZvcm1hdD1mdW5jdGlvbihlKXt2YXIgbj10aGlzO3JldHVybiBlLnJlcGxhY2UoLyhcXD8pKC4pL2csZnVuY3Rpb24oZSxpLHIpe3JldHVybiIiPT09aSYmdFtyXT90W3JdLmNhbGwobik6cn0pfX0pLmNhbGwodGhpcyk7CgpmdW5jdGlvbiBnb3RvQ2xpZW50UGFnZShidXNpbmVzc191c2VyX2lkKQp7CiAgd2luZG93LmxvY2F0aW9uLmhyZWY9Jy8jL2J1c2luZXNzX2NsaWVudHMvJyArIGJ1c2luZXNzX3VzZXJfaWQ7Cn0KZnVuY3Rpb24gZ290b0luc3RydWN0b3JQYWdlKGJ1c2luZXNzX3VzZXJfaWQpCnsKICB3aW5kb3cubG9jYXRpb24uaHJlZj0nLyMvYnVzaW5lc3NfaW5zdHJ1Y3RvcnMvJyArIGJ1c2luZXNzX3VzZXJfaWQ7Cn0KCmZ1bmN0aW9uIGdvdG9FdmVudFBhZ2UodGhlZXZlbnQpCnsKICBsb2dEZWJ1ZygiZ290b0V2ZW50UGFnZSAiK3RoZWV2ZW50KTsKICBpZiAodGhlZXZlbnQuaXNfY2xhc3M9PTEpCiAgewogICAgd2luZG93LmxvY2F0aW9uLmhyZWY9Jy8jL2V2ZW50X2NsYXNzLycgKyB0aGVldmVudC5ldmVudF9pZDsKICB9CiAgZWxzZQogIHsKICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmPScvIy9ldmVudC8nICsgdGhlZXZlbnQuZXZlbnRfaWQ7CiAgfQp9CgpmdW5jdGlvbiBnb3RvTG9jYXRpb25QYWdlKGxvY2F0aW9uX2lkKQp7CiAgbG9nRGVidWcoImdvdG9Mb2NhdGlvblBhZ2UgIitsb2NhdGlvbl9pZCk7CiAgd2luZG93LmxvY2F0aW9uLmhyZWY9Jy8jL2J1c2luZXNzX2xvY2F0aW9ucy8nICsgbG9jYXRpb25faWQ7Cgp9CgpmdW5jdGlvbiBnb3RvQ2xpZW50RWRpdFBhZ2UodXNlcl9pZCkKewogIHdpbmRvdy5sb2NhdGlvbi5ocmVmPScvIy9idXNpbmVzc19jbGllbnRzLycgKyB1c2VyX2lkICsgJy9lZGl0JzsKfQoKZnVuY3Rpb24gZ290b0JhY2soKQp7CiAgd2luZG93Lmhpc3RvcnkuYmFjaygpOwp9CgpmdW5jdGlvbiBzaG93RXZlbnRQb3B1cChzZWxlY3RlZEV2ZW50LCAkdWliTW9kYWwpCnsKICAvLyB0aGlzIGZ1bmN0aW9uIHVzZWQgdG8gYnJpbmcgYSBwb3B1cAogIC8vIG5vdyBpdCBnb2VzIHRvIHRoZSBldmVudCBwYWdlCiAgZ290b0V2ZW50UGFnZShzZWxlY3RlZEV2ZW50KTsKCiAgLy8gaWYgKHNlbGVjdGVkRXZlbnQuaXNfcmVwZWF0aW5nID09IDEpIHsKICAvLyAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgLy8gICAgICAgICBhbmltYXRpb246IGZhbHNlLAogIC8vICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfY2xhc3Nfc2luZ2xlLnBocCcsCiAgLy8gICAgICAgICBjb250cm9sbGVyOiAnZXZlbnRSZWN1cnJpbmdEZXRhaWxzQnVzaW5lc3NDYWxlbmRhck1vZGFsQ29udHJvbGxlcicsCiAgLy8gICAgICAgICAvLyBzaXplOiBzaXplLAogIC8vICAgICAgICAgcmVzb2x2ZTogewogIC8vICAgICAgICAgICAgIHNlbGVjdGVkRXZlbnQ6IGZ1bmN0aW9uKCkgewogIC8vICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZWN0ZWRFdmVudDsKICAvLyAgICAgICAgICAgICB9CiAgLy8gICAgICAgICB9CiAgLy8gICAgIH0pOwogIC8vIH0gZWxzZSB7CiAgLy8gICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewogIC8vICAgICAgICAgYW5pbWF0aW9uOiBmYWxzZSwKICAvLyAgICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2V2ZW50X3NpbmdsZS5waHAnLAogIC8vICAgICAgICAgY29udHJvbGxlcjogJ2V2ZW50RGV0YWlsc0J1c2luZXNzQ2FsZW5kYXJNb2RhbENvbnRyb2xsZXInLAogIC8vICAgICAgICAgLy8gc2l6ZTogc2l6ZSwKICAvLyAgICAgICAgIHJlc29sdmU6IHsKICAvLyAgICAgICAgICAgICBzZWxlY3RlZEV2ZW50OiBmdW5jdGlvbigpIHsKICAvLyAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGVjdGVkRXZlbnQ7CiAgLy8gICAgICAgICAgICAgfQogIC8vICAgICAgICAgfQogIC8vICAgICB9KTsKICAvLyB9Cn0KZnVuY3Rpb24gdXBkYXRlR2xvYmFsTGFuZ3VhZ2UoJHNjb3BlLCAkbmV3bGFuZykgewoKICAvLwl2YXIgZ0xhbmc9Z0xhbmdCYXNlW2dMYW5nQ3Vycl07CiAgJGdMYW5nID0gZ0xhbmdCYXNlWyRuZXdsYW5nXTsKICAvLyBsb2dEZWJ1ZygiZ0xhbmdCYXNlWyRuZXdsYW5nXVsndGl0bGUxJ109IiArIGdMYW5nQmFzZVskbmV3bGFuZ11bJ3RpdGxlMSddKTsKICAvLyBsb2dEZWJ1ZygibGFuZ3VnYWdlOiIgKyAkZ0xhbmdbJ2xhbmd1YWdlJ10pOwogIC8vCWxvZ0RlYnVnKCJsYW5ndWdhZ2UgZGlyOiAiKyRnTGFuZ1snZGlyJ10pOwogIC8vCWxvZ0RlYnVnKCJjaGFuZ2luZyBsYW5ndWFnZSB0byAiKyRuZXdsYW5nKQogICRzY29wZS5zcENsYXNzID0gJGdMYW5nWydjbGFzcyddOwogIC8vCWxvZ0RlYnVnKCJpcyBhcnJheT8gIithbmd1bGFyLmlzQXJyYXkoJGdMYW5nKSk7CiAgLy8JbG9nRGVidWcoIiRnTGFuZ1snZGlyJ109IiskZ0xhbmdbJ2RpciddKTsKICAvLwlsb2dEZWJ1ZygiJGdMYW5nWyd0aXRsZTEnXT0iKyRnTGFuZ1sndGl0bGUxJ10pOwogICRzY29wZS5sYW5nZmlsZSA9ICRnTGFuZzsKICAvLyBsb2dEZWJ1ZygiaXMgYXJyYXk/ICIgKyBhbmd1bGFyLmlzQXJyYXkoJHNjb3BlLmxhbmdmaWxlKSk7CiAgLy8gbG9nRGVidWcoIiRzY29wZS5sYW5nZmlsZT0iICsgJHNjb3BlLmxhbmdmaWxlKTsKICAvLyBsb2dEZWJ1ZygiJHNjb3BlLmxhbmdmaWxlWyd0aXRsZTEnXT0iICsgJHNjb3BlLmxhbmdmaWxlWyd0aXRsZTEnXSk7CgogICRzY29wZS50ZXN0bmV3dmFyID0gJHNjb3BlLmxhbmdmaWxlWyd0aXRsZTEnXTsKICAvLwkkc2NvcGUubWVzc2FnZT0kc2NvcGUubGFuZ2ZpbGVbJ3RpdGxlMSddOwp9CgpmdW5jdGlvbiBnZXRSYW5kb21Db2xvcigpIHsKICB2YXIgbGV0dGVycyA9ICcwMTIzNDU2Nzg5QUJDREVGJy5zcGxpdCgnJyk7CiAgdmFyIGNvbG9yID0gJyMnOwogIGZvciAodmFyIGkgPSAwOyBpIDwgNjsgaSsrKSB7CiAgICBjb2xvciArPSBsZXR0ZXJzW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDE2KV07CiAgfQogIHJldHVybiBjb2xvcjsKfQoKZnVuY3Rpb24gZ2V0UmFuZG9tSW50KG1pbiwgbWF4KSB7CiAgcmV0dXJuIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChtYXggLSBtaW4gKyAxKSkgKyBtaW47Cn0KCmZ1bmN0aW9uIGNhbGNfdGVtcF9saW1pdF9pZCgpIHsKICB2YXIgZCA9IG5ldyBEYXRlKCk7CiAgdmFyIHJhbmRvbWxpbWl0ID0gZC5nZXRUaW1lKCk7CiAgbG9nRGVidWcoImNhbGNfdGVtcF9saW1pdF9pZD0iICsgcmFuZG9tbGltaXQpOwogIHJldHVybiByYW5kb21saW1pdDsKfQoKdmFyICRnTG9nTGV2ZWwgPSAnZGVidWcnOwoKLy8gc3RhcnRpbmcKbG9nRGVidWcoIm1haW4gJGdMb2dMZXZlbD0iICsgJGdMb2dMZXZlbCk7CmxvZ0RlYnVnKCJpbml0aWFsaXplIGFuZ3VsYXIiKTsKbG9nRGVidWcoImluaXRpYWxpemluZyBtb2R1bGVzICIgKyAkYW5ndWxhck1vZHVsZXMpOwoKdmFyIGt1emVBcHAgPSBhbmd1bGFyLm1vZHVsZSgna3V6ZUFwcCcsICRhbmd1bGFyTW9kdWxlcykKCi8vJHJvb3RTY29wZS5zcENsYXNzID0gJ3JpZ2h0JzsKa3V6ZVJ1biA9IGZ1bmN0aW9uKCkgewoKfQprdXplQXBwLnJ1bihbCiAgJyRidWlsZGVyJywKICBmdW5jdGlvbigkYnVpbGRlcikgewogICAgLy8gbG9nRGVidWcoImluc2lkZSBrdXplQXBwLnJ1biIpOwogICAgJGJ1aWxkZXIucmVnaXN0ZXJDb21wb25lbnQoJ3NhbXBsZUlucHV0JywgewogICAgICBncm91cDogJ2Zyb20gaHRtbCcsCiAgICAgIGxhYmVsOiAnU2FtcGxlJywKICAgICAgZGVzY3JpcHRpb246ICdGcm9tIGh0bWwgdGVtcGxhdGUnLAogICAgICBwbGFjZWhvbGRlcjogJ3BsYWNlaG9sZGVyJywKICAgICAgcmVxdWlyZWQ6IGZhbHNlLAogICAgICB2YWxpZGF0aW9uT3B0aW9uczogW3sKICAgICAgICBsYWJlbDogJ25vbmUnLAogICAgICAgIHJ1bGU6ICcvLiovJwogICAgICB9LCB7CiAgICAgICAgbGFiZWw6ICdudW1iZXInLAogICAgICAgIHJ1bGU6ICdbbnVtYmVyXScKICAgICAgfSwgewogICAgICAgIGxhYmVsOiAnZW1haWwnLAogICAgICAgIHJ1bGU6ICdbZW1haWxdJwogICAgICB9LCB7CiAgICAgICAgbGFiZWw6ICd1cmwnLAogICAgICAgIHJ1bGU6ICdbdXJsXScKICAgICAgfV0sCiAgICAgIHRlbXBsYXRlVXJsOiAnL2FuZ3VsYXItZm9ybS1idWlsZGVyL2V4YW1wbGUvdGVtcGxhdGUuaHRtbCcsCiAgICAgIHBvcG92ZXJUZW1wbGF0ZVVybDogJy9hbmd1bGFyLWZvcm0tYnVpbGRlci9leGFtcGxlL3BvcG92ZXJUZW1wbGF0ZS5odG1sJwogICAgfSk7CiAgICByZXR1cm4gJGJ1aWxkZXIucmVnaXN0ZXJDb21wb25lbnQoJ25hbWUnLCB7CiAgICAgIGdyb3VwOiAnRGVmYXVsdCcsCiAgICAgIGxhYmVsOiAnTmFtZScsCiAgICAgIHJlcXVpcmVkOiBmYWxzZSwKICAgICAgYXJyYXlUb1RleHQ6IHRydWUsCiAgICAgIHRlbXBsYXRlOiAiPGRpdiBjbGFzcz1cImZvcm0tZ3JvdXBcIj5cbiAgICA8bGFiZWwgZm9yPVwie3tmb3JtTmFtZStpbmRleH19XCIgY2xhc3M9XCJjb2wtbWQtNCBjb250cm9sLWxhYmVsXCIgbmctY2xhc3M9XCJ7J2ZiLXJlcXVpcmVkJzpyZXF1aXJlZH1cIj57e2xhYmVsfX08L2xhYmVsPlxuICAgIDxkaXYgY2xhc3M9XCJjb2wtbWQtOFwiPlxuICAgICAgICA8aW5wdXQgdHlwZT0naGlkZGVuJyBuZy1tb2RlbD1cImlucHV0VGV4dFwiIHZhbGlkYXRvci1yZXF1aXJlZD1cInt7cmVxdWlyZWR9fVwiIHZhbGlkYXRvci1ncm91cD1cInt7Zm9ybU5hbWV9fVwiLz5cbiAgICAgICAgPGRpdiBjbGFzcz1cImNvbC1zbS02XCIgc3R5bGU9XCJwYWRkaW5nLWxlZnQ6IDA7XCI+XG4gICAgICAgICAgICA8aW5wdXQgdHlwZT1cInRleHRcIlxuICAgICAgICAgICAgICAgIG5nLW1vZGVsPVwiaW5wdXRBcnJheVswXVwiXG4gICAgICAgICAgICAgICAgY2xhc3M9XCJmb3JtLWNvbnRyb2xcIiBpZD1cInt7Zm9ybU5hbWUraW5kZXh9fS0wXCIvPlxuICAgICAgICAgICAgPHAgY2xhc3M9J2hlbHAtYmxvY2snPkZpcnN0IG5hbWU8L3A+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwiY29sLXNtLTZcIiBzdHlsZT1cInBhZGRpbmctbGVmdDogMDtcIj5cbiAgICAgICAgICAgIDxpbnB1dCB0eXBlPVwidGV4dFwiXG4gICAgICAgICAgICAgICAgbmctbW9kZWw9XCJpbnB1dEFycmF5WzFdXCJcbiAgICAgICAgICAgICAgICBjbGFzcz1cImZvcm0tY29udHJvbFwiIGlkPVwie3tmb3JtTmFtZStpbmRleH19LTFcIi8+XG4gICAgICAgICAgICA8cCBjbGFzcz0naGVscC1ibG9jayc+TGFzdCBuYW1lPC9wPlxuICAgICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbjwvZGl2PiIsCiAgICAgIHBvcG92ZXJUZW1wbGF0ZTogIjxmb3JtPlxuICAgIDxkaXYgY2xhc3M9XCJmb3JtLWdyb3VwXCI+XG4gICAgICAgIDxsYWJlbCBjbGFzcz0nY29udHJvbC1sYWJlbCc+TGFiZWw8L2xhYmVsPlxuICAgICAgICA8aW5wdXQgdHlwZT0ndGV4dCcgbmctbW9kZWw9XCJsYWJlbFwiIHZhbGlkYXRvcj1cIltyZXF1aXJlZF1cIiBjbGFzcz0nZm9ybS1jb250cm9sJy8+XG4gICAgPC9kaXY+XG4gICAgPGRpdiBjbGFzcz1cImNoZWNrYm94XCI+XG4gICAgICAgIDxsYWJlbD5cbiAgICAgICAgICAgIDxpbnB1dCB0eXBlPSdjaGVja2JveCcgbmctbW9kZWw9XCJyZXF1aXJlZFwiIC8+XG4gICAgICAgICAgICBSZXF1aXJlZFxuICAgICAgICA8L2xhYmVsPlxuICAgIDwvZGl2PlxuXG4gICAgPGhyLz5cbiAgICA8ZGl2IGNsYXNzPSdmb3JtLWdyb3VwJz5cbiAgICAgICAgPGlucHV0IHR5cGU9J3N1Ym1pdCcgbmctY2xpY2s9XCJwb3BvdmVyLnNhdmUoJGV2ZW50KVwiIGNsYXNzPSdidG4gYnRuLXByaW1hcnknIHZhbHVlPSdTYXZlJy8+XG4gICAgICAgIDxpbnB1dCB0eXBlPSdidXR0b24nIG5nLWNsaWNrPVwicG9wb3Zlci5jYW5jZWwoJGV2ZW50KVwiIGNsYXNzPSdidG4gYnRuLWRlZmF1bHQnIHZhbHVlPSdDYW5jZWwnLz5cbiAgICAgICAgPGlucHV0IHR5cGU9J2J1dHRvbicgbmctY2xpY2s9XCJwb3BvdmVyLnJlbW92ZSgkZXZlbnQpXCIgY2xhc3M9J2J0biBidG4tZGFuZ2VyJyB2YWx1ZT0nRGVsZXRlJy8+XG4gICAgPC9kaXY+XG48L2Zvcm0+IgogICAgfSk7CiAgfQpdKQoKa3V6ZUFwcC5ydW4oZnVuY3Rpb24oJHJvb3RTY29wZSkgewogIGxvZ0RlYnVnKCJydW4gJHJvb3RTY29wZSIpOwogICRyb290U2NvcGUuJG9uKCdsb2FkaW5nOnByb2dyZXNzJywgZnVuY3Rpb24gKCl7CiAgICAvLyBzaG93IGxvYWRpbmcgZ2lmCiAgICAvLyAkc2NvcGUuY3Vyc29yZGVsZXRlPSJ3YWl0IjsKICAgIC8vIGRvY3VtZW50LmJvZHkuc3R5bGUuY3Vyc29yPSd3YWl0JzsKICB9KTsKCiAgJHJvb3RTY29wZS4kb24oJ2xvYWRpbmc6ZmluaXNoJywgZnVuY3Rpb24gKCl7CiAgICAvLyAkc2NvcGUuY3Vyc29yZGVsZXRlPSIiOwogICAgLy8gZG9jdW1lbnQuYm9keS5zdHlsZS5jdXJzb3I9Jyc7CiAgfSk7Cn0pOwoKLy8gREVMRVRFRCAtIHhlZGl0YWJsZSBzdHVmZgovLyBrdXplQXBwLnJ1bihmdW5jdGlvbihlZGl0YWJsZU9wdGlvbnMsIGVkaXRhYmxlVGhlbWVzKSB7Ci8vICAgICBsb2dEZWJ1ZygiaW5pdGlhbGl6aW5nIHhlZGl0YWJsZSBlZGl0YWJsZU9wdGlvbnMiKTsKLy8gICAgIGVkaXRhYmxlT3B0aW9ucy50aGVtZSA9ICdiczMnOyAvLyBib290c3RyYXAzIHRoZW1lLiBDYW4gYmUgYWxzbyAnYnMyJywgJ2RlZmF1bHQnCi8vICAgICAvLyBlZGl0YWJsZU9wdGlvbnMuZGVmYXVsdHMubW9kZSA9ICdpbmxpbmUnOwovLyAgICAgbG9nRGVidWcoZWRpdGFibGVPcHRpb25zKTsKLy8gICAgIC8vIGVkaXRhYmxlT3B0aW9ucy5tb2RlID0gJ2lubGluZSc7Ci8vICAgICBlZGl0YWJsZVRoZW1lcy5iczMuaW5wdXRDbGFzcyA9ICdpbnB1dC1zbSc7Ci8vICAgICBlZGl0YWJsZVRoZW1lcy5iczMuYnV0dG9uc0NsYXNzID0gJ2J0bi1zbSc7Ci8vIH0pOwoKLy8gYWZ0ZXIgZm9ybXMKLy9EZWZpbmUgUm91dGluZyBmb3IgYXBwCi8vVXJpIC9BZGROZXdPcmRlciAtPiB0ZW1wbGF0ZSBhZGRfb3JkZXIuaHRtbCBhbmQgQ29udHJvbGxlciBDbGllbnRzQWRkQ29udHJvbGxlcgovL1VyaSAvU2hvd09yZGVycyAtPiB0ZW1wbGF0ZSBzaG93X29yZGVycy5odG1sIGFuZCBDb250cm9sbGVyIENsaWVudHNBZGRDb250cm9sbGVyCmt1emVBcHAuY29uZmlnKFsnJHJvdXRlUHJvdmlkZXInLAogIGZ1bmN0aW9uKCRyb3V0ZVByb3ZpZGVyKSB7CiAgICAvLyBsb2dEZWJ1Zygkcm91dGVQcm92aWRlcik7CiAgICAkcm91dGVQcm92aWRlci4KICAgIC8vIHdoZW4oJy9jbGllbnRjYXJkJywgewogICAgLy8gICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2NsaWVudF9jYXJkLmh0bWwnLAogICAgLy8gICAgIGNvbnRyb2xsZXI6ICdjbGllbnRDYXJkQ29udHJvbGxlcicKICAgIC8vIH0pLgogICAgd2hlbignL2NvbnRhY3QnLCB7CiAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2NvbnRhY3QucGhwJywKICAgICAgLy8gY29udHJvbGxlcjogJ2VuZFVzZXJIb21lQ29udHJvbGxlcicKICAgICAgY29udHJvbGxlcjogJ2NvbnRhY3RDb250cm9sbGVyJwogICAgfSkuCiAgICB3aGVuKCcvZXZlbnRfdHlwZXMnLCB7CiAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2V2ZW50X3R5cGVzLmh0bWwnLAogICAgICBjb250cm9sbGVyOiAnRXZlbnRUeXBlc0NvbnRyb2xsZXInCiAgICB9KS4KICAgIHdoZW4oJy9ldmVudF90eXBlcy9hZGQnLCB7CiAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2V2ZW50X3R5cGVfYWRkLnBocCcsCiAgICAgIGNvbnRyb2xsZXI6ICdFdmVudFR5cGVOZXdDb250cm9sbGVyJwogICAgfSkuCiAgICB3aGVuKCcvZXZlbnRfdHlwZXMvOmV2ZW50X3R5cGVfaWQnLCB7CiAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2V2ZW50X3R5cGVfYWRkLnBocCcsCiAgICAgIGNvbnRyb2xsZXI6ICdFdmVudFR5cGVVcGRhdGVDb250cm9sbGVyJwogICAgfSkuCiAgICB3aGVuKCcvaG91cnNfb2Zfd29yaycsIHsKICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfaG91cnNfb2Zfd29yay5odG1sJywKICAgICAgY29udHJvbGxlcjogJ0hvdXJzT2ZXb3JrQ29udHJvbGxlcicKICAgIH0pLgogICAgd2hlbignL2J1c2luZXNzX2NhbGVuZGFyJywgewogICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19jYWxlbmRhci5waHAnLAogICAgICBjb250cm9sbGVyOiAnQnVzaW5lc3NDYWxlbmRhckNvbnRyb2xsZXInLAogICAgICByZWxvYWRPblNlYXJjaDogZmFsc2UKICAgIH0pLgogICAgd2hlbignL2FuZ3VsYXItZm9ybS1idWlsZGVyJywgewogICAgICB0ZW1wbGF0ZVVybDogJy9hbmd1bGFyLWZvcm0tYnVpbGRlci9pbmRleC5odG1sJywKICAgICAgY29udHJvbGxlcjogJ0RlbW9Db250cm9sbGVyJwogICAgfSkuCiAgICB3aGVuKCcvYnVzaW5lc3NfY2xpZW50cy9hZGQnLCB7CiAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2NsaWVudHNfYWRkLmh0bWwnLAogICAgICBjb250cm9sbGVyOiAnQ2xpZW50c0FkZENvbnRyb2xsZXInCiAgICB9KS4KICAgIHdoZW4oJy9idXNpbmVzc19jbGllbnRzJywgewogICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19jbGllbnRzLnBocCcsCiAgICAgIGNvbnRyb2xsZXI6ICdDbGllbnRzU2hvd0NvbnRyb2xsZXInCiAgICB9KS4KICAgIHdoZW4oJy9idXNpbmVzc19jbGllbnRzLzpidXNpbmVzc191c2VyX2lkJywgewogICAgICB0ZW1wbGF0ZVVybDogZnVuY3Rpb24ocGFyYW1zKSB7CiAgICAgICAgcmV0dXJuICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfY2xpZW50X2NhcmQucGhwP2J1c2luZXNzX3VzZXJfaWQ9JyArIHBhcmFtcy5idXNpbmVzc191c2VyX2lkIDsKICAgICAgfSwKICAgICAgY29udHJvbGxlcjogJ0NsaWVudHNTaG93MUNvbnRyb2xsZXInCiAgICB9KS4KICAgIHdoZW4oJy9idXNpbmVzc19yZXBvcnRzJywgewogICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19yZXBvcnRzLmh0bWwnLAogICAgICBjb250cm9sbGVyOiAnQnVzaW5lc3NSZXBvcnRzQ29udHJvbGxlcicKICAgIH0pLgogICAgd2hlbignL2J1c2luZXNzX2luc3RydWN0b3JzJywgewogICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19pbnN0cnVjdG9ycy5waHAnLAogICAgICBjb250cm9sbGVyOiAnSW5zdHJ1Y3RvcnNTaG93Q29udHJvbGxlcicKICAgIH0pLgogICAgd2hlbignL2J1c2luZXNzX2luc3RydWN0b3JzL2FkZCcsIHsKICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfY2xpZW50c19hZGQuaHRtbCcsCiAgICAgIGNvbnRyb2xsZXI6ICdJbnN0cnVjdG9yc0FkZENvbnRyb2xsZXInCiAgICB9KS4KICAgIHdoZW4oJy9idXNpbmVzc19sb2NhdGlvbnMnLCB7CiAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2xvY2F0aW9ucy5waHAnLAogICAgICBjb250cm9sbGVyOiAnYnVzaW5lc3NfbG9jYXRpb25zJwogICAgfSkuCiAgICB3aGVuKCcvYnVzaW5lc3NfbG9jYXRpb25zL2FkZCcsIHsKICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbG9jYXRpb25zX2FkZC5waHAnLAogICAgICBjb250cm9sbGVyOiAnYnVzaW5lc3NfbG9jYXRpb25zX2FkZCcKICAgIH0pLgogICAgd2hlbignL2J1c2luZXNzX2xvY2F0aW9ucy86bG9jYXRpb25faWQnLCB7CiAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2xvY2F0aW9uc19hZGQucGhwJywKICAgICAgY29udHJvbGxlcjogJ2J1c2luZXNzX2xvY2F0aW9uc191cGRhdGUnCiAgICB9KS4KICAgIHdoZW4oJy9idXNpbmVzc19pbnN0cnVjdG9ycy86YnVzaW5lc3NfdXNlcl9pZCcsIHsKICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfaW5zdHJ1Y3Rvcl9jYXJkLnBocCcsCiAgICAgIGNvbnRyb2xsZXI6ICdJbnN0cnVjdG9yU2hvdzFDb250cm9sbGVyJwogICAgfSkuCiAgICB3aGVuKCcvZXZlbnQvOmV2ZW50X2lkJywgewogICAgICB0ZW1wbGF0ZVVybDogZnVuY3Rpb24ocGFyYW1zKSB7CiAgICAgICAgcmV0dXJuICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfZXZlbnRfY2FyZC5waHA/ZXZlbnRfaWQ9JyArIHBhcmFtcy5ldmVudF9pZCA7CiAgICAgIH0sCiAgICAgIGNvbnRyb2xsZXI6ICdFdmVudFBhZ2VDb250cm9sbGVyJwogICAgfSkuCiAgICB3aGVuKCcvZXZlbnRfY2xhc3MvOmV2ZW50X2lkJywgewogICAgICB0ZW1wbGF0ZVVybDogZnVuY3Rpb24ocGFyYW1zKSB7CiAgICAgICAgcmV0dXJuICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfZXZlbnRfY2xhc3NfY2FyZC5waHA/ZXZlbnRfaWQ9JyArIHBhcmFtcy5ldmVudF9pZCA7CiAgICAgIH0sCiAgICAgIGNvbnRyb2xsZXI6ICdFdmVudENsYXNzUGFnZUNvbnRyb2xsZXInCiAgICB9KS4KICAgIHdoZW4oJy9wYWNrYWdlcycsIHsKICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfcGFja2FnZXNfc2hvdy5waHAnLAogICAgICBjb250cm9sbGVyOiAnUGFja2FnZXNDb250cm9sbGVyJwogICAgfSkuCiAgICB3aGVuKCcvcGFja2FnZXMvYWRkJywgewogICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19wYWNrYWdlc19jcmVhdGUucGhwJywKICAgICAgY29udHJvbGxlcjogJ2J1c2luZXNzX3BhY2thZ2VzX2FkZF9jbnRsJwogICAgfSkuCiAgICB3aGVuKCcvcGFja2FnZXMvOnBhY2thZ2VfaWQnLCB7CiAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX3BhY2thZ2VzX2NyZWF0ZS5waHAnLAogICAgICBjb250cm9sbGVyOiAnYnVzaW5lc3NfcGFja2FnZXNfdXBkYXRlX2NudGwnCiAgICB9KS4KICAgIHdoZW4oJy9idXNpbmVzc19jb25maWcnLCB7CiAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2NvbmZpZy5waHAnLAogICAgICBjb250cm9sbGVyOiAnQ29uZmlnQnVzaW5lc3NDb250cm9sbGVyJwogICAgfSkuCiAgICB3aGVuKCcvdXNlcl9jb25maWcnLCB7CiAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ3VzZXJfY29uZmlnLnBocCcsCiAgICAgIGNvbnRyb2xsZXI6ICdDb25maWdVc2VyQ29udHJvbGxlcicKICAgIH0pLgogICAgd2hlbignL2J1c2luZXNzX2RvY3MnLCB7CiAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX2RvY3MuaHRtbCcsCiAgICAgIGNvbnRyb2xsZXI6ICdCdXNpbmVzc0RvY3NDb250cm9sbGVyJwogICAgfSkuCiAgICB3aGVuKCcvJywgewogICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdob21lLnBocCcsCiAgICAgIGNvbnRyb2xsZXI6ICdIb21lQ29udHJvbGxlcicKICAgIH0pLgogICAgb3RoZXJ3aXNlKHsKICAgICAgLy8gICAgcmVkaXJlY3RUbzogJy8nCiAgICB9KTsKICB9Cl0pOwoKa3V6ZUFwcC5mYWN0b3J5KCdodHRwSW50ZXJjZXB0b3InLCBbJyRxJywgJyRyb290U2NvcGUnLAogIGZ1bmN0aW9uICgkcSwgJHJvb3RTY29wZSkgewogICAgdmFyIGxvYWRpbmdDb3VudCA9IDA7CgogICAgcmV0dXJuIHsKICAgICAgcmVxdWVzdDogZnVuY3Rpb24gKGNvbmZpZykgewogICAgICAgIGlmKCsrbG9hZGluZ0NvdW50ID09PSAxKSAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2xvYWRpbmc6cHJvZ3Jlc3MnKTsKICAgICAgICByZXR1cm4gY29uZmlnIHx8ICRxLndoZW4oY29uZmlnKTsKICAgICAgfSwKCiAgICAgIHJlc3BvbnNlOiBmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBpZigtLWxvYWRpbmdDb3VudCA9PT0gMCkgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdsb2FkaW5nOmZpbmlzaCcpOwogICAgICAgIHJldHVybiByZXNwb25zZSB8fCAkcS53aGVuKHJlc3BvbnNlKTsKICAgICAgfSwKCiAgICAgIHJlc3BvbnNlRXJyb3I6IGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgIGlmKC0tbG9hZGluZ0NvdW50ID09PSAwKSAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2xvYWRpbmc6ZmluaXNoJyk7CiAgICAgICAgcmV0dXJuICRxLnJlamVjdChyZXNwb25zZSk7CiAgICAgIH0KICAgIH07CiAgfQpdKS5jb25maWcoWyckaHR0cFByb3ZpZGVyJywgZnVuY3Rpb24gKCRodHRwUHJvdmlkZXIpIHsKICAkaHR0cFByb3ZpZGVyLmludGVyY2VwdG9ycy5wdXNoKCdodHRwSW50ZXJjZXB0b3InKTsKfV0pOwoKa3V6ZUFwcC5mYWN0b3J5KCdzaGFyZWREYXRhJywgZnVuY3Rpb24oKSB7CiAgdmFyIHNlbGVjdGVkRW5kVXNlciA9IG51bGw7CgogIHJldHVybiB7CiAgICBnZXRTZWxlY3RlZEVuZFVzZXI6IGZ1bmN0aW9uKCkgewogICAgICAvL1lvdSBjb3VsZCBhbHNvIHJldHVybiBzcGVjaWZpYyBhdHRyaWJ1dGUgb2YgdGhlIGZvcm0gZGF0YSBpbnN0ZWFkCiAgICAgIC8vb2YgdGhlIGVudGlyZSBkYXRhCiAgICAgIHJldHVybiBzZWxlY3RlZEVuZFVzZXI7CiAgICB9LAogICAgc2V0U2VsZWN0ZWRFbmRVc2VyOiBmdW5jdGlvbihuZXdTZWxlY3RlZEVuZFVzZXIpIHsKICAgICAgLy9Zb3UgY291bGQgYWxzbyBzZXQgc3BlY2lmaWMgYXR0cmlidXRlIG9mIHRoZSBmb3JtIGRhdGEgaW5zdGVhZAogICAgICBzZWxlY3RlZEVuZFVzZXIgPSBuZXdTZWxlY3RlZEVuZFVzZXI7CiAgICB9LAogIH07Cn0pOwoKa3V6ZUFwcC5kaXJlY3RpdmUoJ2NvbnZlcnRUb051bWJlcicsIGZ1bmN0aW9uKCkgewogIHJldHVybiB7CiAgICByZXF1aXJlOiAnbmdNb2RlbCcsCiAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWxlbWVudCwgYXR0cnMsIG5nTW9kZWwpIHsKICAgICAgbmdNb2RlbC4kcGFyc2Vycy5wdXNoKGZ1bmN0aW9uKHZhbCkgewogICAgICAgIHJldHVybiB2YWwgIT0gbnVsbCA/IHBhcnNlSW50KHZhbCwgMTApIDogbnVsbDsKICAgICAgfSk7CiAgICAgIG5nTW9kZWwuJGZvcm1hdHRlcnMucHVzaChmdW5jdGlvbih2YWwpIHsKICAgICAgICByZXR1cm4gdmFsICE9IG51bGwgPyAnJyArIHZhbCA6IG51bGw7CiAgICAgIH0pOwogICAgfQogIH07Cn0pOwoKa3V6ZUFwcC5kaXJlY3RpdmUoJ2VsYXN0aWMnLCBbCiAgJyR0aW1lb3V0JywKICBmdW5jdGlvbigkdGltZW91dCkgewogICAgcmV0dXJuIHsKICAgICAgcmVzdHJpY3Q6ICdBJywKICAgICAgbGluazogZnVuY3Rpb24oJHNjb3BlLCBlbGVtZW50KSB7CiAgICAgICAgJHNjb3BlLmluaXRpYWxIZWlnaHQgPSAkc2NvcGUuaW5pdGlhbEhlaWdodCB8fCBlbGVtZW50WzBdLnN0eWxlLmhlaWdodDsKICAgICAgICB2YXIgcmVzaXplID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICBlbGVtZW50WzBdLnN0eWxlLmhlaWdodCA9ICRzY29wZS5pbml0aWFsSGVpZ2h0OwogICAgICAgICAgZWxlbWVudFswXS5zdHlsZS5oZWlnaHQgPSAiIiArIGVsZW1lbnRbMF0uc2Nyb2xsSGVpZ2h0ICsgInB4IjsKICAgICAgICB9OwogICAgICAgIGVsZW1lbnQub24oImlucHV0IGNoYW5nZSIsIHJlc2l6ZSk7CiAgICAgICAgLy8gZWxlbWVudC5vbigiaW5wdXQgY2hhbmdlIiwgcmVzaXplKTsKICAgICAgICAkdGltZW91dChyZXNpemUsIDApOwogICAgICB9CiAgICB9OwogIH0KXSk7CgprdXplQXBwLnNlcnZpY2UoJ3NoYXJlZFByb3BlcnRpZXMnLCBmdW5jdGlvbiAoKSB7CiAgdmFyIHNlbGVjdGVkX3VzZXIgPSBudWxsOwogIHZhciBjYWxlbmRhcl9kYXRlID0gbnVsbDsKICB2YXIgZXZlbnRfcmVzY2hlZHVsZSA9IG51bGw7CiAgdmFyIHNlbGVjdGVkX2luc3RydWN0b3IgPSAwOwogIHZhciBldmVudF90eXBlX2Zvcl9zdWdnZXN0aW9ucyA9IG51bGw7CiAgcmV0dXJuIHsKICAgIGdldF9zZWxlY3RlZF9pbnN0cnVjdG9yOiBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBzZWxlY3RlZF9pbnN0cnVjdG9yOwogICAgfSwKICAgIHNldF9zZWxlY3RlZF9pbnN0cnVjdG9yOiBmdW5jdGlvbih2YWx1ZSkgewogICAgICBzZWxlY3RlZF9pbnN0cnVjdG9yID0gdmFsdWU7CiAgICB9LAogICAgZ2V0X3NlbGVjdGVkX3VzZXI6IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHNlbGVjdGVkX3VzZXI7CiAgICB9LAogICAgc2V0X3NlbGVjdGVkX3VzZXI6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgIHNlbGVjdGVkX3VzZXIgPSB2YWx1ZTsKICAgIH0sCiAgICBzZXRfZXZlbnRfcmVzY2hlZHVsZTogZnVuY3Rpb24odmFsdWUpIHsKICAgICAgZXZlbnRfcmVzY2hlZHVsZSA9IHZhbHVlOwogICAgfSwKICAgIGdldF9ldmVudF9yZXNjaGVkdWxlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBldmVudF9yZXNjaGVkdWxlOwogICAgfSwKICAgIGdldF9jYWxlbmRhcl9kYXRlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBjYWxlbmRhcl9kYXRlOwogICAgfSwKICAgIHNldF9jYWxlbmRhcl9kYXRlOiBmdW5jdGlvbih2YWx1ZSkgewogICAgICBjYWxlbmRhcl9kYXRlID0gdmFsdWU7CiAgICB9LAogICAgZ2V0X2V2ZW50X3R5cGVfZm9yX3N1Z2dlc3Rpb25zOiBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBldmVudF90eXBlX2Zvcl9zdWdnZXN0aW9uczsKICAgIH0sCiAgICBzZXRfZXZlbnRfdHlwZV9mb3Jfc3VnZ2VzdGlvbnM6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgIC8vIGxvZ0RlYnVnKCJzZXRfZXZlbnRfdHlwZV9mb3Jfc3VnZ2VzdGlvbnM9Iit2YWx1ZSk7CiAgICAgIGV2ZW50X3R5cGVfZm9yX3N1Z2dlc3Rpb25zID0gdmFsdWU7CiAgICB9CiAgfTsKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ21lbnVDb250cm9sbGVyJywgWyckc2NvcGUnLCAnJGxvY2F0aW9uJywgZnVuY3Rpb24oJHNjb3BlLCAkbG9jYXRpb24pIHsKICByZXR1cm4gdHJ1ZTsKICBsb2dEZWJ1ZygiJHNjb3BlLmlzQ3VycmVudFBhdGg9IiArICRzY29wZS5pc0N1cnJlbnRQYXRoKTsKICAkc2NvcGUuaXNDdXJyZW50UGF0aCA9IGZ1bmN0aW9uKHBhdGgpIHsKICAgIHJldHVybiAkbG9jYXRpb24ucGF0aCgpID09IHBhdGg7CiAgfTsKfV0pOwoKCgprdXplQXBwLmNvbnRyb2xsZXIoJ0J1c2luZXNzUmVwb3J0c0NvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkbG9jYXRpb24sJHJvdXRlUGFyYW1zKQp7CgogIGxvZ0RlYnVnKCJjb250cm9sbGVyOiBCdXNpbmVzc1JlcG9ydHNDb250cm9sbGVyIik7CgogICRzY29wZS5vcmRlckJ5RmllbGQgPSAnc3RhcnRfZXBvY2gnOwogICRzY29wZS5yZXZlcnNlU29ydD10cnVlOwogICRzY29wZS5ldmVudE1vZGVsPXRydWU7CgogIGdldEJ1c2luZXNzTG9jYXRpb25zKCRodHRwLCRzY29wZSwnYnVzaW5lc3NfbG9jYXRpb25zJyk7CiAgZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzKCRodHRwLCRzY29wZSwnZXZlbnRfdHlwZXMnKTsKICBnZXRBbGxJbnN0cnVjdG9ycygkaHR0cCwkc2NvcGUsJ2luc3RydWN0b3JzJyk7CiAgZ2V0QWxsQ2xpZW50c0FuZEFyY2hpdmUoJGh0dHAsJHNjb3BlLCdjbGllbnRzJyk7CiAgJHNjb3BlLnN0YXR1c2VzID0gWyB7InN0YXR1c19pZCI6IjAiLCJzdGF0dXNfbmFtZSI6Itek16rXldeXIn0sIHsic3RhdHVzX2lkIjoiMSIsInN0YXR1c19uYW1lIjoi16HXkteV16gifV07CiAgJHNjb3BlLmNhbmNlbGxhdGlvbnMgPSBbIHsiaXNfY2FuY2VsZWQiOiIwIiwiY2FuY2VsbGF0aW9uX25hbWUiOiLXnNeQINeR15XXmNecIn0seyJpc19jYW5jZWxlZCI6IjEiLCJjYW5jZWxsYXRpb25fbmFtZSI6IteR15XXmNecIn1dOwogICRzY29wZS5tb250aHMgPSBbIHsibW9udGgiOiIxIn0seyJtb250aCI6IjIifSx7Im1vbnRoIjoiMyJ9LHsibW9udGgiOiI0In0seyJtb250aCI6IjUifSx7Im1vbnRoIjoiNiJ9LHsibW9udGgiOiI3In0seyJtb250aCI6IjgifSx7Im1vbnRoIjoiOSJ9LHsibW9udGgiOiIxMCJ9LHsibW9udGgiOiIxMSJ9LHsibW9udGgiOiIxMiJ9XTsKICAkc2NvcGUueWVhcnMgPSBbIHsieWVhciI6IjIwMTYifSx7InllYXIiOiIyMDE3In1dOwogICRzY29wZS5wZXJpb2RzID0gWwogICAgeyJwZXJpb2RfbmFtZSI6IteU15nXodeY15XXqNeZIiwgInBlcmlvZF9zaWduIjoiLTEifSwKICAgIHsicGVyaW9kX25hbWUiOiLXlNeZ15XXnSIsICJwZXJpb2Rfc2lnbiI6IjAifSwKICAgIHsicGVyaW9kX25hbWUiOiLXoteq15nXk9eZIiwgInBlcmlvZF9zaWduIjoiMSJ9LAogIF0KCiAgJHNjb3BlLmNzdl9jb2x1bW5zX29yZGVyID0gWydldmVudF90eXBlX25hbWUnLCAnc3RhcnRfdGltZScsICdldmVudF91c2VyX2NsaWVudHMnLCAnaW5zdHJ1Y3Rvcl9uYW1lJywgJ2lzX2NhbmNlbGVkJywgJ2lzX2NvbXBsZXRlZCcsICdhY3R1YWxfcHJpY2UnLCAncGFydGljaXBhdGVkJ107CiAgJHNjb3BlLmNzdl9jb2x1bW5zX2hlYWRlciA9IFsn16HXldeSINee16TXktepJywgJ9eq15DXqNeZ15og15XXqdei15QnLCAn157Xqdeq16rXpNeZ150nLCAn157Xk9eo15nXmicsJ9ee15HXldeY15wnLCAn16HXkteV16gnLCAn157Xl9eZ16gnLCAn157Xqdeq16rXpNeZ150nXTsKCgoKICAkc2NvcGUuZ290b0NsaWVudFBhZ2U9IGZ1bmN0aW9uIChidXNpbmVzc1VzZXJpZCkgewogICAgZ290b0NsaWVudFBhZ2UoYnVzaW5lc3NVc2VyaWQpOwogIH0KCiAgZnVuY3Rpb24gbGlzdF90b19zdHJpbmdfYnlfdmFsdWUoeCx2YWx1ZSl7CiAgICBpZiAoIHggIT0gdW5kZWZpbmVkICl7CiAgICAgIHZhciB4MSA9IG5ldyBBcnJheSgpOwogICAgICBmb3IgKGkgPSAwOyBpIDwgeC5sZW5ndGg7IGkrKyl7CiAgICAgICAgeDFbaV0gPSB4W2ldW3ZhbHVlXTsKICAgICAgfQogICAgICB4MSA9IHgxLmpvaW4oKTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHJldHVybiB4MTsKICB9CgogICRzY29wZS5yZXBvcnRfaXNfbG9hZGluZyA9IGZhbHNlOwoKICAkc2NvcGUuZXZlbnRzUmVwb3J0ID0gZnVuY3Rpb24oKXsKICAgIGxvZ0RlYnVnKCJldmVudHNSZXBvcnQiKTsKCiAgICAkc2NvcGUuc2hvd0FnZyA9ICgkc2NvcGUuZXZlbnRUeXBlTW9kZWwpIHx8CiAgICAgICAgKCRzY29wZS5pbnN0cnVjdG9yTW9kZWwpIHx8ICgkc2NvcGUubW9udGhNb2RlbCkgfHwgKCRzY29wZS5jbGllbnRzTW9kZWwpIHx8ICgkc2NvcGUueWVhck1vZGVsKSA7CgogICAgZXZlbnRfdHlwZV9pZF9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuc2VsZWN0ZWRFdmVudFR5cGVGaWx0ZXIsICJldmVudF90eXBlX2lkIiApOwogICAgaW5zdHJ1Y3Rvcl9pZF9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuc2VsZWN0ZWRJbnN0cnVjdG9yRmlsdGVyLCAiYnVzaW5lc3NfdXNlcl9pZCIgKTsKICAgIG1vbnRoX2ZpbHRlciA9IGxpc3RfdG9fc3RyaW5nX2J5X3ZhbHVlKCRzY29wZS5zZWxlY3RlZE1vbnRoRmlsdGVyLCAibW9udGgiICk7CiAgICBjbGllbnRfZmlsdGVyID0gbGlzdF90b19zdHJpbmdfYnlfdmFsdWUoJHNjb3BlLnNlbGVjdGVkQ2xpZW50RmlsdGVyLCAiYnVzaW5lc3NfdXNlcl9pZCIgKTsKICAgIHllYXJfZmlsdGVyID0gbGlzdF90b19zdHJpbmdfYnlfdmFsdWUoJHNjb3BlLnNlbGVjdGVkWWVhckZpbHRlciwgInllYXIiICk7CiAgICBzdGF0dXNfZmlsdGVyID0gbGlzdF90b19zdHJpbmdfYnlfdmFsdWUoJHNjb3BlLnNlbGVjdGVkU3RhdHVzRmlsdGVyLCAic3RhdHVzX2lkIiApOwogICAgaXNfY2FuY2VsZWRfZmlsdGVyID0gbGlzdF90b19zdHJpbmdfYnlfdmFsdWUoJHNjb3BlLnNlbGVjdGVkSXNfY2FuY2VsZWRGaWx0ZXIsICJpc19jYW5jZWxlZCIgKTsKICAgIHBlcmlvZF9maWx0ZXIgPSBsaXN0X3RvX3N0cmluZ19ieV92YWx1ZSgkc2NvcGUuc2VsZWN0ZWRQZXJpb2RGaWx0ZXIsICJwZXJpb2Rfc2lnbiIgKTsKCiAgICAkc2NvcGUuZXZlbnRSZXBvcnRDb25maWcgPSB7fTsKCiAgICAkc2NvcGUuZXZlbnRSZXBvcnRDb25maWcuc291cmNlID0gImRvY3MiOwoKICAgICRzY29wZS5ldmVudFJlcG9ydENvbmZpZy5maWx0ZXJzID0gewogICAgICBldmVudF90eXBlX2lkOiBldmVudF90eXBlX2lkX2ZpbHRlciwKICAgICAgaW5zdHJ1Y3Rvcl9pZDogaW5zdHJ1Y3Rvcl9pZF9maWx0ZXIsCiAgICAgIG1vbnRoOiBtb250aF9maWx0ZXIsCiAgICAgIHllYXI6IHllYXJfZmlsdGVyLAogICAgICBjbGllbnQ6IGNsaWVudF9maWx0ZXIsCiAgICAgIHN0YXR1czogc3RhdHVzX2ZpbHRlciwKICAgICAgcGVyaW9kOiBwZXJpb2RfZmlsdGVyLAogICAgICBpc19jYW5jZWxlZDogaXNfY2FuY2VsZWRfZmlsdGVyCiAgICB9OwoKICAgICRzY29wZS5ldmVudFJlcG9ydENvbmZpZy5hZ2dyZWdhdGlvbnMgPSB7CiAgICAgIGV2ZW50X3R5cGVfaWQ6ICRzY29wZS5ldmVudFR5cGVNb2RlbCwKICAgICAgaW5zdHJ1Y3Rvcl9pZDogJHNjb3BlLmluc3RydWN0b3JNb2RlbCwKICAgICAgbW9udGg6ICRzY29wZS5tb250aE1vZGVsLAogICAgICB5ZWFyOiAkc2NvcGUueWVhck1vZGVsLAogICAgICBjbGllbnQ6ICRzY29wZS5jbGllbnRNb2RlbCwKICAgIH07CgogICAgaWYgKCAkc2NvcGUuc2hvd0FnZyApIHsKICAgICAgZ2V0RXZlbnRzUmVwb3J0KCRodHRwLCRzY29wZSwgJHNjb3BlLmV2ZW50UmVwb3J0Q29uZmlnLCBnZXRFdmVudHNSZXBvcnRBZ2dyZWdhdGVkX3N1Y2Nlc3MpOwogICAgICAkc2NvcGUucmVwb3J0X2lzX2xvYWRpbmcgPSB0cnVlOwogICAgfSBlbHNlIHsKICAgICAgZ2V0RXZlbnRzUmVwb3J0KCRodHRwLCRzY29wZSwgJHNjb3BlLmV2ZW50UmVwb3J0Q29uZmlnLCBnZXRFdmVudHNSZXBvcnRMaXN0X3N1Y2Nlc3MpOwogICAgICAkc2NvcGUucmVwb3J0X2lzX2xvYWRpbmcgPSB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldEV2ZW50c1JlcG9ydExpc3Rfc3VjY2VzcyhyZXNwb25zZSl7CiAgICAgICRzY29wZS5FdmVudFJlcG9ydExpc3QgPSByZXNwb25zZS5qc29uOwogICAgICAkc2NvcGUuZG93bmxvYWRfcmVwb3J0ID0gJHNjb3BlWyAnRXZlbnRSZXBvcnRMaXN0JyBdOwogICAgICAkc2NvcGUucmVwb3J0X2lzX2xvYWRpbmcgPSBmYWxzZTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRFdmVudHNSZXBvcnRBZ2dyZWdhdGVkX3N1Y2Nlc3MocmVzcG9uc2UpewogICAgICAkc2NvcGUuRXZlbnRSZXBvcnRBZ2dyZWdhdGVkID0gcmVzcG9uc2UuanNvbjsKICAgICAgJHNjb3BlLmRvd25sb2FkX3JlcG9ydCA9ICRzY29wZVsgJ0V2ZW50UmVwb3J0QWdncmVnYXRlZCcgXTsKICAgICAgJHNjb3BlLnJlcG9ydF9pc19sb2FkaW5nID0gZmFsc2U7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0Q2xpZW50c1JlcG9ydExpc3Rfc3VjY2VzcyhyZXNwb25zZSl7CiAgICAgICRzY29wZS5DbGllbnRzUmVwb3J0TGlzdCA9IHJlc3BvbnNlLmpzb247CiAgICAgIGNvbnNvbGUubG9nKCItLS0tLS0tLS0tLS0iKQogICAgICBjb25zb2xlLmxvZygkc2NvcGUuQ2xpZW50c1JlcG9ydExpc3QpCiAgICAgIGNvbnNvbGUubG9nKCItLS0tLS0tLS0tLS0iKQogICAgICAkc2NvcGUucmVwb3J0X2lzX2xvYWRpbmcgPSBmYWxzZTsKICAgIH0KCgogIH0KCiAgJHNjb3BlLmNsaWVudHNSZXBvcnQgPSBmdW5jdGlvbigpewogICAgbG9nRGVidWcoImNsaWVudHNSZXBvcnQiKTsKCiAgICBjbGllbnRfZmlsdGVyID0gbGlzdF90b19zdHJpbmdfYnlfdmFsdWUoJHNjb3BlLnNlbGVjdGVkQ2xpZW50RmlsdGVyLCAiY2xpZW50IiApOwoKICAgICRzY29wZS5ldmVudFJlcG9ydENvbmZpZyA9IHt9OwoKICAgICRzY29wZS5ldmVudFJlcG9ydENvbmZpZy5maWx0ZXJzID0gewogICAgICBjbGllbnQ6IGNsaWVudF9maWx0ZXIsCiAgICB9OwoKICAgICRzY29wZS5ldmVudFJlcG9ydENvbmZpZy5hZ2dyZWdhdGlvbnMgPSB7CiAgICB9OwoKICAgIGdldENsaWVudHNSZXBvcnQoJGh0dHAsJHNjb3BlLCBnZXRDbGllbnRzUmVwb3J0X3N1Y2Nlc3MpOwogICAgJHNjb3BlLnJlcG9ydF9pc19sb2FkaW5nID0gdHJ1ZTsKICAgIGZ1bmN0aW9uIGdldENsaWVudHNSZXBvcnRfc3VjY2VzcyhyZXNwb25zZSl7CiAgICAgICRzY29wZS5jbGllbnRSZXBvcnQgPSByZXNwb25zZS5qc29uOwogICAgICAkc2NvcGUuZG93bmxvYWRfcmVwb3J0ID0gJHNjb3BlWyAnY2xpZW50UmVwb3J0JyBdOwogICAgICAkc2NvcGUucmVwb3J0X2lzX2xvYWRpbmcgPSBmYWxzZTsKICAgIH0KICB9CgogICRzY29wZS5lZGl0RXZlbnQ9IGZ1bmN0aW9uICh0aGVldmVudCkKICB7CiAgICBnb3RvRXZlbnRQYWdlKHRoZWV2ZW50KTsKICB9CgogICRzY29wZS5ldmVudHNSZXBvcnQoKTsKICAkc2NvcGUuc2VsZWN0ZWRSZXBvcnQ9ImV2ZW50cyI7Cn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdidXNpbmVzc19wYWNrYWdlc191cGRhdGVfY250bCcsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbiwkcm91dGVQYXJhbXMpCnsKICAkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyID0ge307IC8vIHRoZXNlIGFyZSB0aGUgY29tcGxldGUgZGV0YWlscyBmb3IgdGhlIG5ldyBldmVudCAvLwogICRzY29wZS5wYWNrYWdlX2lzX3VwZGF0ZSA9IHRydWU7CiAgJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5wYWNrYWdlX2xpbWl0X3R5cGU9MTsKCi8vIGdldHR0aW5nIHRoZSBwYWNrYWdlIGFuZCBpdHMgZXZlbnQgdHlwZXMKICBnZXRCdXNpbmVzc1BhY2thZ2UoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5wYWNrYWdlX2lkLCdmb3JtQWRkUGFja2FnZUFuZ3VsYXInLGZ1bmN0aW9uKHJlc3BvbnNlKQogIHsKICAgICRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuaXNfdXBkYXRlID0gdHJ1ZTsKICAgICRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIub3JpZ0V2ZW50VHlwZXM9YW5ndWxhci5jb3B5KCRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuc2VsZWN0ZWRFdmVudFR5cGVzKTsKICAgICRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIucGFja2FnZV9saW1pdF90eXBlPTE7Ci8vIHRoZW4gZ2V0dGluZyBhbGwgdGhlIGV2ZW50IHR5cGVzCiAgICBnZXRFdmVudFR5cGVzTm9BZG1pbigkaHR0cCwkc2NvcGUsJ3JlbGF0ZWRFdmVudFR5cGVzJyxnZXRFdmVudFR5cGVzTm9BZG1pbl9zdWNjZXNzKTsKICAgIGZ1bmN0aW9uIGdldEV2ZW50VHlwZXNOb0FkbWluX3N1Y2Nlc3MoKQogICAgewovLyB0aGVuIHJlbW92aW5nIGV4aXN0aW5nIGV2ZW50IHR5cGVzIG9mIHBhY2thZ2UgZnJvbSBsaXN0Ci8vIGNvbnNvbGUubG9nKCRzY29wZS5yZWxhdGVkRXZlbnRUeXBlc1swXSk7Ci8vIGNvbnNvbGUubG9nKCRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuc2VsZWN0ZWRFdmVudFR5cGVzWzBdKTsKICAgICAgZm9yKHZhciBpID0gMDsgaSA8ICRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuc2VsZWN0ZWRFdmVudFR5cGVzLmxlbmd0aDsgaSsrKQogICAgICB7Ci8vIGNvcHlpbmcgdGhlIGFjdHVhbCBvYmplY3Qgb2YgJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5zZWxlY3RlZEV2ZW50VHlwZXNbaV0KICAgICAgICBmb3IodmFyIGogPSAwOyBqIDwgJHNjb3BlLnJlbGF0ZWRFdmVudFR5cGVzLmxlbmd0aDsgaisrKQogICAgICAgIHsKICAgICAgICAgIGlmICgkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLnNlbGVjdGVkRXZlbnRUeXBlc1tpXS5ldmVudF90eXBlX2lkPT0kc2NvcGUucmVsYXRlZEV2ZW50VHlwZXNbal0uZXZlbnRfdHlwZV9pZCkKICAgICAgICAgIHsKICAgICAgICAgICAgJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhci5zZWxlY3RlZEV2ZW50VHlwZXNbaV09YW5ndWxhci5jb3B5KCRzY29wZS5yZWxhdGVkRXZlbnRUeXBlc1tqXSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfSk7CiAgJHNjb3BlLmdvdG9CYWNrID0gZ290b0JhY2s7CiAgJHNjb3BlLmNyZWF0ZVBhY2thZ2UgPSBmdW5jdGlvbigpCiAgewogICAgY29uc29sZS5sb2coInVwZGF0ZVBhY2thZ2VEZXRhaWxzIik7CiAgICB1cGRhdGVQYWNrYWdlRGV0YWlscygkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLnBhY2thZ2VfaWQsJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhcixzdWNjZXNzX2NhbGxiYWNrLCBmYWlsdXJlX2NhbGxiYWNrKTsKICAgIGZ1bmN0aW9uIHN1Y2Nlc3NfY2FsbGJhY2soKQogICAgewogICAgICBnb3RvQmFjaygpOwogICAgfQogICAgZnVuY3Rpb24gZmFpbHVyZV9jYWxsYmFjaygpCiAgICB7CiAgICAgIGdvdG9CYWNrKCk7CiAgICB9CiAgfTsKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2J1c2luZXNzX3BhY2thZ2VzX2FkZF9jbnRsJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uKSB7CiAgbG9nRGVidWcoJ2J1c2luZXNzX3BhY2thZ2VzX2FkZF9jbnRsJyk7CiAgJHNjb3BlLnBhY2thZ2VfaXNfdXBkYXRlID0gZmFsc2U7CiAgJHNjb3BlLmdvdG9CYWNrID0gZ290b0JhY2s7CiAgJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhciA9IHt9OwogICRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuZXZlbnRzX2NvdW50ZXIgPSAxOwogICRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuZXZlbnRzX3Blcl93ZWVrID0gMTsKICAkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLnBhY2thZ2VfZHVyYXRpb25fbW9udGhzID0gMzsKICAkc2NvcGUuZm9ybUFkZFBhY2thZ2VBbmd1bGFyLnBhY2thZ2VfbGltaXRfdHlwZT0xOwogIGdldEV2ZW50VHlwZXNOb0FkbWluKCRodHRwLCRzY29wZSwncmVsYXRlZEV2ZW50VHlwZXMnKTsKCiAgJHNjb3BlLmNyZWF0ZVBhY2thZ2UgPSBmdW5jdGlvbigpCiAgewogICAgY3JlYXRlUGFja2FnZSgkaHR0cCwkc2NvcGUsJHNjb3BlLmZvcm1BZGRQYWNrYWdlQW5ndWxhcixjcmVhdGVQYWNrYWdlX3N1Y2Nlc3MsIGNyZWF0ZVBhY2thZ2VfZmFpbHVyZSk7CiAgICBmdW5jdGlvbiBjcmVhdGVQYWNrYWdlX3N1Y2Nlc3MoKQogICAgewogICAgICAkbG9jYXRpb24ucGF0aCgnL3BhY2thZ2VzJyk7CiAgICB9CiAgICBmdW5jdGlvbiBjcmVhdGVQYWNrYWdlX2ZhaWx1cmUoKQogICAgewovLyBsb2dFcnJvcigiZXJyb3IgIiArIGRhdGEubWVzc2FnZSk7Ci8vICRzY29wZS5mb3JtQWRkUGFja2FnZUFuZ3VsYXIuYWpheF9lcnJvciA9IGRhdGEubWVzc2FnZTsKICAgIH0KICB9Cn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdidXNpbmVzc19sb2NhdGlvbnMnLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkbG9jYXRpb24pIHsKICBsb2dEZWJ1ZygnYnVzaW5lc3NfbG9jYXRpb25zIGNvbnRyb2xsZXInKTsKICBnZXRCdXNpbmVzc0xvY2F0aW9ucygkaHR0cCwkc2NvcGUsJ2J1c2luZXNzX2xvY2F0aW9ucycpOwogICRzY29wZS5hZGROZXdMb2NhdGlvbiA9IGZ1bmN0aW9uICgpCiAgewogICAgJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19sb2NhdGlvbnMvYWRkJyk7CiAgfQogICRzY29wZS5nb3RvTG9jYXRpb25QYWdlID0gZnVuY3Rpb24obG9jYXRpb25faWQpCiAgewogICAgZ290b0xvY2F0aW9uUGFnZShsb2NhdGlvbl9pZCk7CiAgfQp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ0J1c2luZXNzRG9jc0NvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkbG9jYXRpb24pIHsKICBsb2dEZWJ1ZygnQnVzaW5lc3NEb2NzQ29udHJvbGxlcicpOwp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ2J1c2luZXNzX2xvY2F0aW9uc191cGRhdGUnLCBmdW5jdGlvbigkc2NvcGUsICRyb3V0ZVBhcmFtcywgJGh0dHAsICRsb2NhdGlvbikgewogIGxvZ0RlYnVnKCdidXNpbmVzc19sb2NhdGlvbnNfdXBkYXRlIGNvbnRyb2xsZXInKTsKICAkc2NvcGUuaXNfdXBkYXRlPXRydWU7Ci8vIGdldEJ1c2luZXNzTG9jYXRpb25zKCRodHRwLCRzY29wZSwnYnVzaW5lc3NfbG9jYXRpb25zJyk7CiAgZ2V0QnVzaW5lc3NMb2NhdGlvbigkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmxvY2F0aW9uX2lkLCdjdXJyX2xvY2F0aW9uJyxnZXRCdXNpbmVzc0xvY2F0aW9uX3N1Y2Nlc3MpOwogIGZ1bmN0aW9uIGdldEJ1c2luZXNzTG9jYXRpb25fc3VjY2VzcygpCiAgewogICAgJHNjb3BlLmZvcm1BZGRMb2NhdGlvbkFuZ3VsYXI9JHNjb3BlLmN1cnJfbG9jYXRpb25bMF07CiAgfQoKCiAgJHNjb3BlLmFkZExvY2F0aW9uID0gZnVuY3Rpb24oKQogIHsKLy8gaW4gdGhpcyBjYXNlIC0gdXBkYXRlIGxvY2F0aW9uCiAgICB0aGVkYXRhID0gJHNjb3BlLmZvcm1BZGRMb2NhdGlvbkFuZ3VsYXI7CgogICAgZnVuY3Rpb24gYWRkTG9jYXRpb25fc3VjY2VzcygpCiAgICB7CiAgICAgICRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfbG9jYXRpb25zJyk7CiAgICB9CiAgICBmdW5jdGlvbiBhZGRMb2NhdGlvbl9mYWlsdXJlKCkKICAgIHsKICAgICAgJHNjb3BlLmZvcm1BZGRMb2NhdGlvbkFuZ3VsYXIuYWpheF9lcnJvciA9IHJlc3BvbnNlLm1lc3NhZ2U7CiAgICB9CiAgICB1cGRhdGVMb2NhdGlvbigkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmxvY2F0aW9uX2lkLCB0aGVkYXRhLGFkZExvY2F0aW9uX3N1Y2Nlc3MsYWRkTG9jYXRpb25fZmFpbHVyZSk7CiAgfQp9KTsKCmt1emVBcHAuY29udHJvbGxlcignYnVzaW5lc3NfbG9jYXRpb25zX2FkZCcsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikgewogIGxvZ0RlYnVnKCdidXNpbmVzc19sb2NhdGlvbnNfYWRkIGNvbnRyb2xsZXInKTsKICBnZXRCdXNpbmVzc0xvY2F0aW9ucygkaHR0cCwkc2NvcGUsJ2J1c2luZXNzX2xvY2F0aW9ucycpOwogICRzY29wZS5pc191cGRhdGU9ZmFsc2U7CgogICRzY29wZS5hZGRMb2NhdGlvbiA9IGZ1bmN0aW9uKCkKICB7CiAgICB0aGVkYXRhID0gJHNjb3BlLmZvcm1BZGRMb2NhdGlvbkFuZ3VsYXI7CgogICAgZnVuY3Rpb24gYWRkTG9jYXRpb25fc3VjY2VzcygpCiAgICB7CiAgICAgICRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfbG9jYXRpb25zJyk7CiAgICB9CiAgICBmdW5jdGlvbiBhZGRMb2NhdGlvbl9mYWlsdXJlKCkKICAgIHsKICAgICAgJHNjb3BlLmZvcm1BZGRMb2NhdGlvbkFuZ3VsYXIuYWpheF9lcnJvciA9IHJlc3BvbnNlLm1lc3NhZ2U7CiAgICB9CiAgICBhZGRMb2NhdGlvbigkaHR0cCwkc2NvcGUsdGhlZGF0YSxhZGRMb2NhdGlvbl9zdWNjZXNzLGFkZExvY2F0aW9uX2ZhaWx1cmUpOwogIH0KfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ0luc3RydWN0b3JzQWRkQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikgewogIGxvZ0RlYnVnKCdJbnN0cnVjdG9yc0FkZENvbnRyb2xsZXInKTsKICAkc2NvcGUuaXNJbnN0cnVjdG9yPXRydWU7CiAgJHNjb3BlLnVzZXJ0eXBlPSJpbnN0cnVjdG9yIjsKICAkc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIgPSB7fTsKICAkc2NvcGUuZm9ybUFkZENsaWVudEFuZ3VsYXIuaXNfdXBkYXRlPWZhbHNlOwogICRzY29wZS5hZGRDbGllbnQgPSBmdW5jdGlvbigpIC8vIGFkZCBpbnN0cnVjdG9yLCB1c2luZyB0aGUgc2FtZSBmdW5jdGlvbiBuYW1lIGFzIHdlIHVzZSB0aGUgc2FtZSBzY3JlZW4KICB7CiAgICB0aGVkYXRhID0gJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyOwoKICAgIGZ1bmN0aW9uIGFkZEluc3RydWN0b3Jfc3VjY2VzcygpCiAgICB7CiAgICAgICRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfaW5zdHJ1Y3RvcnMnKTsKICAgIH0KICAgIGZ1bmN0aW9uIGFkZENsaWVudF9mYWlsdXJlKCkKICAgIHsKICAgICAgJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyLmFqYXhfZXJyb3IgPSByZXNwb25zZS5tZXNzYWdlOwogICAgfQogICAgYWRkSW5zdHJ1Y3RvcigkaHR0cCwkc2NvcGUsdGhlZGF0YSxhZGRJbnN0cnVjdG9yX3N1Y2Nlc3MpOwogIH0KfSk7Cmt1emVBcHAuY29udHJvbGxlcignQ2xpZW50c0FkZENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkdGltZW91dCwgJGxvY2F0aW9uLCBzaGFyZWRQcm9wZXJ0aWVzKSB7CiAgbG9nRGVidWcoJ0NsaWVudHNBZGRDb250cm9sbGVyIC0gVGhpcyBpcyBBZGQgbmV3IGNsaWVudCBzY3JlZW4nKTsKICAkc2NvcGUuaXNJbnN0cnVjdG9yPWZhbHNlOwoKICAkc2NvcGUudXNlcnR5cGU9ImVuZHVzZXIiOwogICRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhciA9IHt9OwogICRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5pc191cGRhdGU9ZmFsc2U7CiAgJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyLmRpc2FibGVfcGhvbmVfZWRpdGluZz1mYWxzZTsKCiAgaWYgKCgkc2NvcGUuZmlsdGVyLlZhbHVlICE9ICIiKSAmJiAodHlwZW9mICRzY29wZS5maWx0ZXIuVmFsdWUgIT0gJ3VuZGVmaW5lZCcpKSB7CiAgICBsb2dEZWJ1ZygiY2xpZW50cyBmaWx0ZXIgaXMgbm90IGVtcHR5Iik7CiAgICB2YXIgZmlsdGVyID0gU3RyaW5nKCRzY29wZS5maWx0ZXIuVmFsdWUpOwogICAgaWYgKGZpbHRlci5pbmRleE9mKCIgIikgPiAwKSB7CiAgICAgICRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5maXJzdF9uYW1lID0gZmlsdGVyLnN1YnN0cigwLCBmaWx0ZXIuaW5kZXhPZigiICIpKTsKICAgICAgJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyLmxhc3RfbmFtZSA9IGZpbHRlci5zdWJzdHIoMSArIGZpbHRlci5pbmRleE9mKCIgIikpOwogICAgfSBlbHNlIHsKICAgICAgJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyLmZpcnN0X25hbWUgPSBmaWx0ZXI7CiAgICAgICRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5sYXN0X25hbWUgPSAiIjsKICAgIH0KICAgICRzY29wZS5maWx0ZXIuVmFsdWUgPSAiIjsKICAgICRzY29wZS5maWx0ZXIuYnV0dG9uVmFsdWUgPSAiIjsKICB9IGVsc2UgewogIH0KCiAgJHNjb3BlLmdvdG9CYWNrID0gZnVuY3Rpb24oKQogIHsKICAgICRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfY2xpZW50cycpOwogIH0KCiAgJHNjb3BlLmFkZENsaWVudCA9IGZ1bmN0aW9uKCkKICB7CiAgICB0aGVkYXRhID0gJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyOwoKICAgIGZ1bmN0aW9uIGFkZENsaWVudF9zdWNjZXNzKHVzZXJfaWQpCiAgICB7CiAgICAgIGlmICgkc2NvcGUuc2F2ZV9hbmRfc2NoZWR1bGUpCiAgICAgIHsKLy8gJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jbGllbnRzLycrdXNlcl9pZC5qc29uKTsKICAgICAgICBsb2dEZWJ1ZygiTkVXIHVzZXIgdXNlcl9pZD0iK3VzZXJfaWQuanNvbik7CgogICAgICAgIHVzZXJfaW5mbz0gewogICAgICAgICAgYnVzaW5lc3NfdXNlcl9pZDogdXNlcl9pZC5qc29uLAogICAgICAgICAgYnVzZXJfZmlyc3RfbmFtZTogJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyLmJ1c2VyX2ZpcnN0X25hbWUsCiAgICAgICAgICBidXNlcl9sYXN0X25hbWU6ICRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5idXNlcl9sYXN0X25hbWUKICAgICAgICB9OwoKICAgICAgICBzaGFyZWRQcm9wZXJ0aWVzLnNldF9zZWxlY3RlZF91c2VyKHVzZXJfaW5mbyk7CiAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jYWxlbmRhcicpOwoKICAgICAgfQogICAgICBlbHNlCiAgICAgIHsKICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2NsaWVudHMvJyk7CiAgICAgIH0KICAgICAgY29uc29sZS5sb2coIm5ldyB1c2VyIGlkID0gIit1c2VyX2lkLmpzb24pOwogICAgfQogICAgZnVuY3Rpb24gYWRkQ2xpZW50X2ZhaWx1cmUocmVzcG9uc2UpCiAgICB7CiAgICAgICRzY29wZS5mb3JtQWRkQ2xpZW50QW5ndWxhci5hamF4X2Vycm9yID0gcmVzcG9uc2UubWVzc2FnZTsKICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKQogICAgICB7CiAgICAgICAgJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyLmFqYXhfZXJyb3I9bnVsbDsKICAgICAgfSwgMjUwMCk7CiAgICB9CiAgICBhZGRDbGllbnQoJGh0dHAsJHNjb3BlLHRoZWRhdGEsYWRkQ2xpZW50X3N1Y2Nlc3MsIGFkZENsaWVudF9mYWlsdXJlLGZhbHNlKTsKICB9Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignUGFja2FnZXNDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uKSB7CiAgbG9nRGVidWcoJ1BhY2thZ2VzQ29udHJvbGxlcicpOwogIGdldEJ1c2luZXNzUGFja2FnZXMoJGh0dHAsJHNjb3BlLCdwYWNrYWdlcycpOwoKICAkc2NvcGUuc2hvd1BhY2thZ2UgPSBmdW5jdGlvbiAodGhlcGFja2FnZSkKICB7CiAgICAkbG9jYXRpb24ucGF0aCgnL3BhY2thZ2VzLycrdGhlcGFja2FnZS5wYWNrYWdlX2lkKTsKICB9Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignSW5zdHJ1Y3RvcnNTaG93Q29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikgewogIGxvZ0RlYnVnKCdJbnN0cnVjdG9yc1Nob3dDb250cm9sbGVyJyk7CiAgJHNjb3BlLm9yZGVyQnlGaWVsZCA9ICdidXNlcl9zdGFydF9kYXRlJzsKICAkc2NvcGUucmV2ZXJzZVNvcnQ9dHJ1ZTsKCiAgZ2V0QWxsSW5zdHJ1Y3RvcnMoJGh0dHAsJHNjb3BlLCdhbGxDbGllbnRzJyxnZXRBbGxJbnN0cnVjdG9yc19zdWNjZXNzKTsKICBmdW5jdGlvbiBnZXRBbGxJbnN0cnVjdG9yc19zdWNjZXNzKCkKICB7CiAgICAkc2NvcGUuc2hvd0NsaWVudHNHcmlkT3B0aW9ucy5kYXRhPSRzY29wZS5hbGxDbGllbnRzOwogIH0KCiAgJHNjb3BlLmdvdG9JbnN0cnVjdG9yUGFnZT0gZnVuY3Rpb24gKGJ1c2luZXNzX3VzZXJfaWQpCiAgewogICAgZ290b0luc3RydWN0b3JQYWdlKGJ1c2luZXNzX3VzZXJfaWQpOwogIH0KCiAgJHNjb3BlLmNsaWVudE5hbWVGaWx0ZXI9IiI7CiAgJHNjb3BlLmlucHV0RmlsdGVyID0gZnVuY3Rpb24gKGl0ZW0pCiAgewovLyBjb25zb2xlLmxvZyhpdGVtLmJ1c2VyX3Bob25lX251bWJlcik7CiAgICByZXR1cm4gZmlsdGVyX2ZpcnN0bGFzdF9uYW1lKGl0ZW0uYnVzZXJfZmlyc3RfbmFtZSxpdGVtLmJ1c2VyX2xhc3RfbmFtZSxpdGVtLmJ1c2VyX3Bob25lX251bWJlciwkc2NvcGUuY2xpZW50TmFtZUZpbHRlcik7CiAgfTsKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ0NsaWVudHNTaG93Q29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHVpYk1vZGFsLCAkaHR0cCwgJGxvY2F0aW9uKSB7CiAgbG9nRGVidWcoJ0NsaWVudHNTaG93Q29udHJvbGxlcicpOwogICRzY29wZS5vcmRlckJ5RmllbGQgPSAnYnVzZXJfc3RhcnRfZGF0ZSc7CiAgJHNjb3BlLnJldmVyc2VTb3J0PXRydWU7CgogIGdldEFsbENsaWVudHMoJGh0dHAsJHNjb3BlLCdhbGxDbGllbnRzJyxnZXRDbGllbnRfc3VjY2Vzcyk7CiAgZnVuY3Rpb24gZ2V0Q2xpZW50X3N1Y2Nlc3MoKQogIHsKICAgICRzY29wZS5zaG93Q2xpZW50c0dyaWRPcHRpb25zLmRhdGE9JHNjb3BlLmFsbENsaWVudHM7CiAgfQoKICAkc2NvcGUuZ290b0NsaWVudFBhZ2U9IGZ1bmN0aW9uIChidXNpbmVzc1VzZXJpZCkKICB7CiAgICBnb3RvQ2xpZW50UGFnZShidXNpbmVzc1VzZXJpZCk7CiAgfQoKLy8gZmlsdGVyIGFyY2hpdmVkIGNsaWVudHMKICAkc2NvcGUuc2hvd0FyY2hpdmVkQ2hlY2tib3g9ZmFsc2U7CiAgJHNjb3BlLnNob3dBcmNoaXZlZCA9IGZ1bmN0aW9uIChlY2xpZW50KQogIHsKICAgIGlmIChlY2xpZW50LmlzX2FjdGl2ZT09MCkKICAgIHsKICAgICAgbG9nRGVidWcoZWNsaWVudCk7CiAgICAgIGlmICgkc2NvcGUuc2hvd0FyY2hpdmVkQ2hlY2tib3gpCiAgICAgIHsKICAgICAgICByZXR1cm4gZWNsaWVudDsKICAgICAgfQogICAgfQogICAgZWxzZSB7CiAgICAgIHJldHVybiBlY2xpZW50OwogICAgfQogIH07CgogICRzY29wZS5jbGllbnROYW1lRmlsdGVyPSIiOwogICRzY29wZS5pbnB1dEZpbHRlciA9IGZ1bmN0aW9uIChpdGVtKQogIHsKICAgIC8vIGNvbnNvbGUubG9nKCJjbGllbnROYW1lRmlsdGVyIik7CiAgICByZXR1cm4gZmlsdGVyX2ZpcnN0bGFzdF9uYW1lKGl0ZW0uYnVzZXJfZmlyc3RfbmFtZSxpdGVtLmJ1c2VyX2xhc3RfbmFtZSxpdGVtLmJ1c2VyX3Bob25lX251bWJlciwkc2NvcGUuY2xpZW50TmFtZUZpbHRlcik7CiAgfTsKCiAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXM9W107Ci8vICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzID0gWwovLyAgIHsiZmllbGRfaWQiOjAsImZpZWxkX25hbWUiOiLXqteQ16jXmdeaINec15nXk9eUIiwiZmllbGRfZGF0YXR5cGUiOiJEQVRFIiwiaXNfbWFuZGF0b3J5IjowLCAiZnJvbWRiIjogZmFsc2UsICJkYl9pZF90b2ZpeCI6IDAsICJpc19hY3RpdmUiOiAxLCAibW9kaWZpZWQiOiBmYWxzZX0sCi8vICAgeyJmaWVsZF9pZCI6MCwiZmllbGRfbmFtZSI6IteU16LXqNeV16oiLCJmaWVsZF9kYXRhdHlwZSI6IlRFWFRfQVJFQSIsImlzX21hbmRhdG9yeSI6MCwgImZyb21kYiI6IGZhbHNlLCAiZGJfaWRfdG9maXgiOiAwLCAiaXNfYWN0aXZlIjogMSwgIm1vZGlmaWVkIjogZmFsc2V9Ci8vIF07CgogIGZ1bmN0aW9uIGdldENsaWVudHNFeHRyYUZpZWxkc19zdWNjZXNzKCkKICB7CiAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyA9ICRzY29wZS5leHRyYUZpZWxkczsKICB9CiAgZ2V0Q2xpZW50c0V4dHJhRmllbGRzKCRodHRwLCRzY29wZSwnZXh0cmFGaWVsZHMnLGdldENsaWVudHNFeHRyYUZpZWxkc19zdWNjZXNzKTsKCiAgJHNjb3BlLmV2ZW50VHlwZUV4dHJhRmllbGRzUG9wID0gZnVuY3Rpb24oZXZlbnRUeXBlUHJvcGVydGllcykgewogICAgbG9nRGVidWcoImV2ZW50VHlwZUV4dHJhRmllbGRzUG9wMyIpOwoKICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewogICAgICBhbmltYXRpb246IGZhbHNlLAogICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9jbGllbnRfZXh0cmFfZmllbGRzLnBocCcsCiAgICAgIGNvbnRyb2xsZXI6ICdldmVudFR5cGVFeHRyYUZpZWxkc01vZGFsQ29udHJvbGxlcicsCiAgICAgIHNpemU6ICdsJywKICAgICAgcmVzb2x2ZTogewogICAgICAgIGV2ZW50VHlwZVByb3BlcnRpZXM6IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIGV2ZW50VHlwZVByb3BlcnRpZXM7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKCiAgICBtb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHNlbGVjdGVkSXRlbSkgewogICAgICBsb2dEZWJ1ZyhzZWxlY3RlZEl0ZW0pOwogICAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyA9IHNlbGVjdGVkSXRlbTsKICAgIH0sIGZ1bmN0aW9uKCkgewogICAgICBsb2dEZWJ1ZygnTW9kYWwgZGlzbWlzc2VkIGF0OiAnICsgbmV3IERhdGUoKSk7CiAgICB9KTsKICB9Owp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ3NjaGVkdWxlckNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkcm91dGVQYXJhbXMpIHsKICBldmVudF90eXBlX2lkPSRyb3V0ZVBhcmFtcy5ldmVudF90eXBlX2lkOwoKICAkc2NvcGUuc3VnZ2VzdGlvbkRhdGUgPSBbXTsKICAkc2NvcGUuc3VnZ2VzdGlvbkRhdGUuZGF0ZSA9IG5ldyBEYXRlKCk7CiAgJHNjb3BlLnN1Z2dlc3Rpb25EYXRlLm9wdGlvbnMgPSB7Ci8vIG1pbkRhdGU6IG5ldyBEYXRlKCksCi8vIHNob3dXZWVrczogdHJ1ZSwKICAgIG1pblZpZXc6J2RheScsCiAgICBzdGFydFZpZXc6ICdkYXknCgogIH07CiAgdmFyIHRoZXRpbWUgPSBuZXcgRGF0ZSgpOwogICRzY29wZS5maWx0ZXJBbGxEYXlzQ2hlY2tib3g9dHJ1ZTsKICAkc2NvcGUuZmlsdGVyRGF5SXRlbXMgPSB7CgogICAgJ9eo15DXqdeV158nOiB0cnVlLAogICAgJ9ep16DXmSc6IHRydWUsCiAgICAn16nXnNeZ16nXmSc6IHRydWUsCiAgICAn16jXkdeZ16LXmSc6IHRydWUsCiAgICAn15fXnteZ16nXmSc6IHRydWUsCiAgICAn16nXmdep15knOiB0cnVlLAogICAgJ9ep15HXqic6IHRydWUKICB9OwoKICAkc2NvcGUub25UaW1lU2V0ID0gZnVuY3Rpb24gKG5ld0RhdGUsIG9sZERhdGUpIHsKICAgIGxvZ0RlYnVnKCJuZXcgZGF0ZSAiK25ld0RhdGUuZ2V0VGltZSgpICsgIiBvbGQgZGF0ZSAiK29sZERhdGUuZ2V0VGltZSgpKTsKICAgIGRpZmY9bmV3RGF0ZS5nZXRUaW1lKCktb2xkRGF0ZS5nZXRUaW1lKCk7Ci8vIGlmIG5ldyBkYXRlIGlzIGluIGEgZGlmZmVyZW50IHdlZWsKLy8gd2UgcmVmZXRjaCBzdWdnZXN0aW9ucyBmb3IgdGhlIGN1cnJlbnQgd2VlawogICAgdmFyIG5ld0RhdGVXID0gbmV3IERhdGUobmV3RGF0ZSk7CiAgICB2YXIgb2xkRGF0ZVcgPSBuZXcgRGF0ZShvbGREYXRlKTsKLy8gYWxlcnQobmV3RGF0ZVcuZm9ybWF0KCdXJykpOwovLyBhbGVydChvbGREYXRlVy5mb3JtYXQoJ1cnKSk7CiAgICBpZiAobmV3RGF0ZVcuZm9ybWF0KCdXJykhPW9sZERhdGVXLmZvcm1hdCgnVycpKQogICAgewogICAgICBsb2dEZWJ1ZygiZGlmZiBpcyBhIHdlZWsgb3IgbW9yZSwgcmVmZXRjaGluZyBzdWdnZXN0aW9ucyIpOwogICAgICAkaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3QvIitldmVudF90eXBlX2lkKyIvIituZXdEYXRlLmdldEZ1bGxZZWFyKCkrIi8iKyhuZXdEYXRlLmdldE1vbnRoKCkrMSkrIi8iK25ld0RhdGUuZ2V0RGF0ZSgpKyIvIituZXdEYXRlLmdldEhvdXJzKCkgKyAiLyIgKyBuZXdEYXRlLmdldE1pbnV0ZXMoKSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkgewovLwkgICAgJHNjb3BlLm15RGF0YSA9IHJlc3BvbnNlLmRhdGE7Ci8vCQlsb2dEZWJ1ZygiZ3JpZG9wdGlvbnM9Iiskc2NvcGUuZ3JpZE9wdGlvbnMpOwogICAgICAgICRzY29wZS5ldmVudHNTdWdnZXN0ZWQgPSByZXNwb25zZS5kYXRhOwogICAgICB9KTsKCiAgICB9CiAgfQoKICAkc2NvcGUub3B0aW9ucyA9IHsKICAgIGN1c3RvbUNsYXNzOiBnZXREYXlDbGFzcywKICAgIG1pbkRhdGU6IG5ldyBEYXRlKCksCiAgICBzaG93V2Vla3M6IHRydWUKICB9OwogICRzY29wZS5kdCA9IG5ldyBEYXRlKCk7CgoKICBmdW5jdGlvbiBnZXREYXlDbGFzcyhkYXRhKSB7CiAgICByZXR1cm4gJyc7CiAgfQoKICAkc2NvcGUuZGF5c0l0ZW1zID0gWwogICAge25hbWU6J9eo15DXqdeV158nfSwKICAgIHtuYW1lOifXqdeg15knfSwKICAgIHtuYW1lOifXqdec15nXqdeZJ30sCiAgICB7bmFtZTon16jXkdeZ16LXmSd9LAogICAge25hbWU6J9eX157Xmdep15knfSwKICAgIHtuYW1lOifXqdeZ16nXmSd9LAogICAge25hbWU6J9ep15HXqid9CiAgXTsKCiAgJHNjb3BlLmZpbHRlckFsbERheUl0ZW1zU2V0ID0gZnVuY3Rpb24gKCkKICB7CiAgICAkc2NvcGUuZmlsdGVyRGF5SXRlbXNbJ9eo15DXqdeV158nXT0kc2NvcGUuZmlsdGVyQWxsRGF5c0NoZWNrYm94OwogICAgJHNjb3BlLmZpbHRlckRheUl0ZW1zWyfXqdeg15knXT0kc2NvcGUuZmlsdGVyQWxsRGF5c0NoZWNrYm94OwogICAgJHNjb3BlLmZpbHRlckRheUl0ZW1zWyfXqdec15nXqdeZJ109JHNjb3BlLmZpbHRlckFsbERheXNDaGVja2JveDsKICAgICRzY29wZS5maWx0ZXJEYXlJdGVtc1sn16jXkdeZ16LXmSddPSRzY29wZS5maWx0ZXJBbGxEYXlzQ2hlY2tib3g7CiAgICAkc2NvcGUuZmlsdGVyRGF5SXRlbXNbJ9eX157Xmdep15knXT0kc2NvcGUuZmlsdGVyQWxsRGF5c0NoZWNrYm94OwogICAgJHNjb3BlLmZpbHRlckRheUl0ZW1zWyfXqdeZ16nXmSddPSRzY29wZS5maWx0ZXJBbGxEYXlzQ2hlY2tib3g7CiAgICAkc2NvcGUuZmlsdGVyRGF5SXRlbXNbJ9ep15HXqiddPSRzY29wZS5maWx0ZXJBbGxEYXlzQ2hlY2tib3g7CiAgfQoKICAkc2NvcGUuc3VnZ2VzdEZpbHRlckRheXMgPSBmdW5jdGlvbiAoZXN1Z2dlc3QpCiAgewovLyBsb2dEZWJ1Zyhlc3VnZ2VzdCk7CiAgICBpZiAoKCRzY29wZS5maWx0ZXJEYXlJdGVtc1tlc3VnZ2VzdC5zdGFydF9mb3JtYXRfZG93XSkgJiAoKCRzY29wZS5zdWdnZXN0aW9uRGF0ZS5kYXRlLmdldFRpbWUoKS8xMDAwKTxlc3VnZ2VzdC5zdGFydF9lcG9jaCkpCiAgICB7CiAgICAgIHJldHVybiBlc3VnZ2VzdDsKICAgIH0KICB9OwoKICBsb2dEZWJ1Zygnc2NoZWR1bGVyQ29udHJvbGxlciBmb3IgZXZlbnQgdHlwZSBpZCAnK2V2ZW50X3R5cGVfaWQrIiAiK3RoZXRpbWUuZ2V0SG91cnMoKSArICI6IiArIHRoZXRpbWUuZ2V0TWludXRlcygpICsgIjoiICsgdGhldGltZS5nZXRTZWNvbmRzKCkpOwogICRodHRwLmdldCgkZ0FwaVVSTFByZWZpeCArICIvZW5kdXNlci9ldmVudHMvc3VnZ2VzdC8iK2V2ZW50X3R5cGVfaWQrIi8iK3RoZXRpbWUuZ2V0RnVsbFllYXIoKSsiLyIrKHRoZXRpbWUuZ2V0TW9udGgoKSsxKSsiLyIrdGhldGltZS5nZXREYXRlKCkrIi8iK3RoZXRpbWUuZ2V0SG91cnMoKSArICIvIiArIHRoZXRpbWUuZ2V0TWludXRlcygpKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7Ci8vCSAgICAkc2NvcGUubXlEYXRhID0gcmVzcG9uc2UuZGF0YTsKLy8JCWxvZ0RlYnVnKCJncmlkb3B0aW9ucz0iKyRzY29wZS5ncmlkT3B0aW9ucyk7CiAgICAkc2NvcGUuZXZlbnRzU3VnZ2VzdGVkID0gcmVzcG9uc2UuZGF0YTsKICB9KTsKCiAgJGh0dHAuZ2V0KCRnQXBpVVJMUHJlZml4ICsgIi9lbmR1c2VyL2V2ZW50X3R5cGVzLyIrZXZlbnRfdHlwZV9pZCkudGhlbihmdW5jdGlvbihyZXNwb25zZSkgewovLwkgICAgJHNjb3BlLm15RGF0YSA9IHJlc3BvbnNlLmRhdGE7Ci8vCQlsb2dEZWJ1ZygiZ3JpZG9wdGlvbnM9Iiskc2NvcGUuZ3JpZE9wdGlvbnMpOwogICAgJHNjb3BlLmV2ZW50VHlwZURldGFpbHMgPSByZXNwb25zZS5kYXRhOwogIH0pOwp9KTsKCmt1emVBcHAuY29udHJvbGxlcignY29udGFjdENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwKSB7CiAgbG9nRGVidWcoJ2NvbnRhY3RDb250cm9sbGVyJyk7Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcigncGFja2FnZVBheW1lbnRBc3NvY2lhdGlvbk1vZGFsQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHJvdXRlUGFyYW1zLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIGZwYWNrYWdlLCBiYWxhbmNlLCBidXNpbmVzc191c2VyX2lkLCB1aUNhbGVuZGFyQ29uZmlnKQp7CiAgbG9nRGVidWcoInBhY2thZ2VQYXltZW50QXNzb2NpYXRpb25Nb2RhbENvbnRyb2xsZXIiKTsKCiAgJHNjb3BlLmZwYWNrYWdlPWZwYWNrYWdlOwogICRzY29wZS5iYWxhbmNlPWJhbGFuY2U7CiAgJHNjb3BlLnBhY2thZ2VfcGF5bWVudHM9JHNjb3BlLmZwYWNrYWdlLnBhY2thZ2VfcGF5bWVudHM7CiAgJHNjb3BlLnByZXZpb3VzX2lzX2FsbF9wYWlkPSRzY29wZS5mcGFja2FnZS5pc19hbGxfcGFpZDsKICAkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZD1idXNpbmVzc191c2VyX2lkOwoKLy8gJ2NhbGN1bGF0aW5nJyBwcmV2aW91cyBzdGF0dXMgb2YgcGF5bWVudAogIGlmICgkc2NvcGUucGFja2FnZV9wYXltZW50cz4wKQogIHsKICAgIGlmICgkc2NvcGUucHJldmlvdXNfaXNfYWxsX3BhaWQ9PTEpCiAgICB7CiAgICAgICRzY29wZS5wcmV2aW91c19zdGF0dXM9ImlzX2FsbF9wYWlkIjsKICAgICAgJHNjb3BlLnBhY2thZ2Vfc3RhdHVzX2lkPS0xOwogICAgICAkc2NvcGUucHJldmlvdXNfcGFja2FnZV9zdGF0dXNfaWQ9LTE7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICRzY29wZS5wcmV2aW91c19zdGF0dXM9ImlzX3BhcnRseV9wYWlkIjsKICAgICAgJHNjb3BlLnBhY2thZ2Vfc3RhdHVzX2lkPS0xOwogICAgICAkc2NvcGUucHJldmlvdXNfcGFja2FnZV9zdGF0dXNfaWQ9LTE7CiAgICB9CiAgfQogIGVsc2UKICB7CiAgICAkc2NvcGUucHJldmlvdXNfc3RhdHVzPSJub3RfcGFpZCI7CiAgICAkc2NvcGUucGFja2FnZV9zdGF0dXNfaWQ9MDsKICAgICRzY29wZS5wcmV2aW91c19wYWNrYWdlX3N0YXR1c19pZD0wOwoKICB9CiAgbG9nRGVidWcoInByZXZpb3VzX3N0YXR1cz0iKyRzY29wZS5wcmV2aW91c19zdGF0dXMpOwoKICAkc2NvcGUuY2xvc2VNb2RhbCA9IGZ1bmN0aW9uKCkKICB7CiAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgfTsKICAkc2NvcGUudXBkYXRlUGFja2FnZVBheW1lbnQgPSBmdW5jdGlvbigpCiAgewovLyBjb25zb2xlLmxvZygicHJldmlvdXNfcGFja2FnZV91c2VyX2lkPSIrJHNjb3BlLmZtZWV0aW5nLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZCk7Ci8vIGNvbnNvbGUubG9nKCJwYWNrYWdlX3VzZXJfaWQ9Iiskc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkKTsKICAgIGxvZ0RlYnVnKCJ1cGRhdGVQYWNrYWdlUGF5bWVudCIpCi8vIGlmIHNlbGVjdGVkIHBhY2thZ2UgaXMgbGlrZSBwcmV2aW91cyBwYWNrYWdlIC0gZG8gbm90aGluZwogICAgaWYgKCgkc2NvcGUucHJldmlvdXNfcGFja2FnZV9zdGF0dXNfaWQ9PSRzY29wZS5wYWNrYWdlX3N0YXR1c19pZCkpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJzZWxlY3RlZCBvcHRpb24gaXMgbGlrZSBwcmV2aW91cyBvcHRpb24gLSBkbyBub3RoaW5nIik7CiAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICAgIH0KCi8vIHByZXZpb3VzIHBhY2thZ2Ugd2FzIHBhaWQvcGFydGx5LXBhaWQgLSBub3cgbm90aGluZ3MgaXMgc2VsZWN0ZWQKICAgIGVsc2UgaWYgKCgkc2NvcGUucHJldmlvdXNfcGFja2FnZV9zdGF0dXNfaWQ9PS0xKSAmJiAoJHNjb3BlLnBhY2thZ2Vfc3RhdHVzX2lkPT0wKSkKICAgIHsKICAgICAgbG9nRGVidWcoIndhcyBwYWlkL3BhcnRseSBwYWlkLCByZW1vdmluZyBwYXltZW50Iik7CiAgICAgIHJlbW92ZVBhY2thZ2VQYXltZW50KCRodHRwLCRzY29wZSwkc2NvcGUuZnBhY2thZ2UucGFja2FnZV91c2VyX2lkLCRzY29wZS5idXNpbmVzc191c2VyX2lkLHVwZGF0ZUV2ZW50UGFja2FnZV9zdWNjZXNzKTsKICAgIH0KLy8gcHJldmlvdXMgcGFja2FnZSB3YXMgc2VsZWN0ZWQgLSBub3cgYSBkaWZmZXJlbnQgcGFja2FnZSBpcyBzZWxlY3RlZAogICAgZWxzZSBpZiAoKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3N0YXR1c19pZD09MCkgJiYgKCRzY29wZS5wYWNrYWdlX3N0YXR1c19pZD09LTEpKQogICAgewogICAgICBsb2dEZWJ1Zygid2FzIG5vdCBwYWlkIC0gbm93IHBheSBmdWxseS9wYXJ0aWFsbHkiKTsKICAgICAgcGF5Rm9yUGFja2FnZSgkaHR0cCwkc2NvcGUsJHNjb3BlLmZwYWNrYWdlLnBhY2thZ2VfdXNlcl9pZCwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCx1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2Vzcyk7CgovLyByZWFzc2lnbkV2ZW50UGFja2FnZUFzc29jaWF0aW9uKCRodHRwLCRzY29wZSwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZCwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCx1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2Vzcyk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiB1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2VzcygpCiAgewogICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgbG9nRGVidWcoImJyb2FkY2FzdGluZyBjbGllbnRQYWdlUmVsb2FkRGF0YSIpOwogICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogIH0KCn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdldmVudFBhY2thZ2VBc3NvY2lhdGlvbk1vZGFsQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHJvdXRlUGFyYW1zLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIGZtZWV0aW5nLCBiYWxhbmNlLCBidXNpbmVzc191c2VyX2lkLCB1aUNhbGVuZGFyQ29uZmlnKQp7CiAgJHNjb3BlLmZtZWV0aW5nPWFuZ3VsYXIuY29weShmbWVldGluZyk7CiAgJHNjb3BlLmJhbGFuY2U9YmFsYW5jZTsKICAkc2NvcGUucHJldmlvdXNfcGFja2FnZV91c2VyX2lkPSRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQ7CiAgJHNjb3BlLnByZXZpb3VzX2V2ZW50X3BheW1lbnRzPSRzY29wZS5mbWVldGluZy5ldmVudF9wYXltZW50czsKICAkc2NvcGUucHJldmlvdXNfaXNfYWxsX3BhaWQ9JHNjb3BlLmZtZWV0aW5nLmlzX2FsbF9wYWlkOwogICRzY29wZS5idXNpbmVzc191c2VyX2lkPWJ1c2luZXNzX3VzZXJfaWQ7CgovLyAnY2FsY3VsYXRpbmcnIHByZXZpb3VzIHN0YXR1cyBvZiBwYXltZW50CiAgaWYgKCRzY29wZS5wcmV2aW91c19ldmVudF9wYXltZW50cz4wKQogIHsKICAgIGlmICgkc2NvcGUucHJldmlvdXNfaXNfYWxsX3BhaWQ9PTEpCiAgICB7CiAgICAgICRzY29wZS5wcmV2aW91c19zdGF0dXM9ImlzX2FsbF9wYWlkIjsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgJHNjb3BlLnByZXZpb3VzX3N0YXR1cz0iaXNfcGFydGx5X3BhaWQiOwogICAgfQogIH0KICBlbHNlCiAgewogICAgaWYgKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ+MCkKICAgIHsKICAgICAgJHNjb3BlLnByZXZpb3VzX3N0YXR1cz0iaXNfcGFja2FnZV9wYWlkIjsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgJHNjb3BlLnByZXZpb3VzX3N0YXR1cz0ibm90X3BhaWQiOwogICAgfQogIH0KICBsb2dEZWJ1ZygicHJldmlvdXNfc3RhdHVzPSIrJHNjb3BlLnByZXZpb3VzX3N0YXR1cyk7CgogIGlmICgoJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZD09MCkgJiYgKCRzY29wZS5mbWVldGluZy5ldmVudF9wYXltZW50cz4wKSkKICB7Ci8vIHRoaXMgaXMgYSBjYXNlIHdoZXJlIHBheW1lbnQgd2FzIHBhcnRseSBvciBmdWxseSBtYWRlIGZyb20gYmFsYW5jZQogICAgJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZD0tMTsKICAgICRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ9LTE7CiAgfQoKICBsb2dEZWJ1ZygiZXZlbnRQYWNrYWdlQXNzb2NpYXRpb25Nb2RhbENvbnRyb2xsZXIiKTsKICBnZXRQYWNrYWdlc0ZvckV2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJ3JlbGF0ZWRQYWNrYWdlcycsZ2V0UGFja2FnZXNGb3JFdmVudF9zdWNjZXNzKTsgLy8gd2FzIGdldEJ1c2luZXNzUGFja2FnZQogIGZ1bmN0aW9uIGdldFBhY2thZ2VzRm9yRXZlbnRfc3VjY2VzcygpCiAgewogIH0KCiAgJHNjb3BlLmNsb3NlTW9kYWwgPSBmdW5jdGlvbigpCiAgewogICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogIH07CiAgJHNjb3BlLnVwZGF0ZUV2ZW50UGFja2FnZSA9IGZ1bmN0aW9uKCkKICB7CiAgICBjb25zb2xlLmxvZygicHJldmlvdXNfcGFja2FnZV91c2VyX2lkPSIrJHNjb3BlLmZtZWV0aW5nLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZCk7CiAgICBjb25zb2xlLmxvZygicGFja2FnZV91c2VyX2lkPSIrJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZCk7Ci8vIGlmIHNlbGVjdGVkIHBhY2thZ2UgaXMgbGlrZSBwcmV2aW91cyBwYWNrYWdlIC0gZG8gbm90aGluZwogICAgaWYgKCgkc2NvcGUucHJldmlvdXNfcGFja2FnZV91c2VyX2lkPT0kc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkKSkKICAgIHsKICAgICAgbG9nRGVidWcoInNlbGVjdGVkIG9wdGlvbiBpcyBsaWtlIHByZXZpb3VzIG9wdGlvbiAtIGRvIG5vdGhpbmciKTsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgfQovLyBpZiBzZWxlY3RlZCBwYWNrYWdlIGlzIGxpa2UgcHJldmlvdXMgcGFja2FnZSAtIGRvIG5vdGhpbmcKICAgIGlmICgoJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD09JHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZCkgJiYgKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ+MCkpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJzZWxlY3RlZCBwYWNrYWdlIGlzIGxpa2UgcHJldmlvdXMgcGFja2FnZSAtIGRvIG5vdGhpbmciKTsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgfQovLyBwcmV2aW91cyBwYWNrYWdlIHdhcyBzZWxlY3QgLSBub3cgbm90aGluZ3MgaXMgc2VsZWN0ZWQKICAgIGVsc2UgaWYgKCgkc2NvcGUucHJldmlvdXNfcGFja2FnZV91c2VyX2lkPjApICYmICgkc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkPT0wKSkKICAgIHsKICAgICAgbG9nRGVidWcoIm5vIHBhY2thZ2Ugc2VsZWN0ZWQsIHJlbW92ZSBwYWNrYWdlLWV2ZW50IGFzc29jaWF0aW9uIik7CiAgICAgIHJlbW92ZUV2ZW50UGFja2FnZUFzc29jaWF0aW9uKCRodHRwLCRzY29wZSwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwogICAgfQovLyBwcmV2aW91cyBwYWNrYWdlIHdhcyBzZWxlY3RlZCAtIG5vdyBhIGRpZmZlcmVudCBwYWNrYWdlIGlzIHNlbGVjdGVkCiAgICBlbHNlIGlmICgoJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD4wKSAmJiAoJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZD4wKSkKICAgIHsKICAgICAgbG9nRGVidWcoInVwZGF0aW5nIG5ldyBwYWNrYWdlIHRvIHBhY2thZ2VfdXNlcl9pZD0gIiskc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkKTsKICAgICAgcmVhc3NpZ25FdmVudFBhY2thZ2VBc3NvY2lhdGlvbigkaHR0cCwkc2NvcGUsJHNjb3BlLmZtZWV0aW5nLmV2ZW50X2lkLCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwogICAgfQovLyBwcmV2aW91cyBwYWNrYWdlIHdhcyBub25lIC0gbm93IGEgcGFja2FnZSBpcyBzZWxlY3RlZAogICAgZWxzZSBpZiAoKCRzY29wZS5wcmV2aW91c19wYWNrYWdlX3VzZXJfaWQ9PTApICYmICgkc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkPjApKQogICAgewogICAgICBsb2dEZWJ1ZygidXBkYXRpbmcgbmV3IHBhY2thZ2UgdG8gcGFja2FnZV91c2VyX2lkPSAiKyRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQpOwogICAgICByZWFzc2lnbkV2ZW50UGFja2FnZUFzc29jaWF0aW9uKCRodHRwLCRzY29wZSwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZCwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCx1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2Vzcyk7CiAgICB9Ci8vIHByZXZpb3VzIGFzc29jaWF0aW9uIHdhcyBwYWlkIG9yIGhhbGYgcGFpZCAtIG5vdyBpdHMgbm9uZQogICAgZWxzZSBpZiAoKCRzY29wZS5wcmV2aW91c19ldmVudF9wYXltZW50cz4wKSAmJiAoJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZD09MCkpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJyZW1vdmluZyBwYXltZW50IGZyb20gZXZlbnQsIHBhY2thZ2VfdXNlcl9pZD0gIiskc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkKTsKICAgICAgcmVtb3ZlRXZlbnRQYXltZW50QXNzb2NpYXRpb24oJGh0dHAsJHNjb3BlLCRzY29wZS5mbWVldGluZy5ldmVudF9pZCwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCx1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2Vzcyk7CgovLyByZWFzc2lnbkV2ZW50UGFja2FnZUFzc29jaWF0aW9uKCRodHRwLCRzY29wZSwkc2NvcGUuZm1lZXRpbmcuZXZlbnRfaWQsJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZCwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCx1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2Vzcyk7Ci8vIHRvZG8KICAgIH0KLy8gd2FzIHBhY2thZ2UgcGF5bWVudCAtPiBub3cgYmFsYW5jZSBwYXltZW50CiAgICBlbHNlIGlmICgoJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD4wKSAmJiAoJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZD09LTEpKQogICAgewogICAgICBsb2dEZWJ1ZygibW92aW5nIHBheW1lbnQgZnJvbSBwYWNrYWdlIHRvIGJhbGFuY2UiKTsKICAgICAgYWRkRXZlbnRQYXltZW50UmVtb3ZlUGFja2FnZSgkaHR0cCwkc2NvcGUsJHNjb3BlLmZtZWV0aW5nLmV2ZW50X2lkLCRzY29wZS5idXNpbmVzc191c2VyX2lkLHVwZGF0ZUV2ZW50UGFja2FnZV9zdWNjZXNzKTsKICAgIH0KLy8gd2FzIGJhbGFuY2UgcGF5bWVudCAtPiBub3cgcGFja2FnZSBwYXltZW50CiAgICBlbHNlIGlmICgoJHNjb3BlLnByZXZpb3VzX3BhY2thZ2VfdXNlcl9pZD09LTEpICYmICgkc2NvcGUuZm1lZXRpbmcucGFja2FnZV91c2VyX2lkPjApKQogICAgewogICAgICBsb2dEZWJ1ZygibW92aW5nIHBheW1lbnQgZnJvbSBiYWxhbmNlIHRvIHBhY2thZ2UiKTsKICAgICAgYWRkRXZlbnRQYWNrYWdlUmVtb3ZlUGF5bWVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLmZtZWV0aW5nLmV2ZW50X2lkLCRzY29wZS5mbWVldGluZy5wYWNrYWdlX3VzZXJfaWQsJHNjb3BlLmJ1c2luZXNzX3VzZXJfaWQsdXBkYXRlRXZlbnRQYWNrYWdlX3N1Y2Nlc3MpOwoKICAgIH0KLy8gd2FzIG5vdCBwYWlkIGF0IGFsbCAtPiBub3cgYmFsYW5jZSBwYXkKICAgIGVsc2UgaWYgKCgkc2NvcGUucHJldmlvdXNfcGFja2FnZV91c2VyX2lkPT0wKSAmJiAoJHNjb3BlLmZtZWV0aW5nLnBhY2thZ2VfdXNlcl9pZD09LTEpKQogICAgewogICAgICBsb2dEZWJ1ZygibW92aW5nIHBheW1lbnQgZnJvbSBub25lIHRvIGJhbGFuY2UiKTsKICAgICAgYWRkRXZlbnRQYXltZW50QXNzb2NpYXRpb24oJGh0dHAsJHNjb3BlLCRzY29wZS5mbWVldGluZy5ldmVudF9pZCwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCx1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2Vzcyk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiB1cGRhdGVFdmVudFBhY2thZ2Vfc3VjY2VzcygpCiAgewogICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgbG9nRGVidWcoImJyb2FkY2FzdGluZyBjbGllbnRQYWdlUmVsb2FkRGF0YSIpOwogICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogIH0KCn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignYXJjaGl2ZV9jbGllbnRfbW9kYWwnLCBmdW5jdGlvbigkc2NvcGUsICRsb2NhdGlvbiwgaXNfaW5zdHJ1Y3RvciwgYnVzaW5lc3NfdXNlcl9pZCwgYnVzZXJfZmlyc3RfbmFtZSwgYnVzZXJfbGFzdF9uYW1lLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIHVpQ2FsZW5kYXJDb25maWcpIHsKICAkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZD1idXNpbmVzc191c2VyX2lkOwogICRzY29wZS5idXNlcl9maXJzdF9uYW1lPWJ1c2VyX2ZpcnN0X25hbWU7CiAgJHNjb3BlLmJ1c2VyX2xhc3RfbmFtZT1idXNlcl9sYXN0X25hbWU7CiAgJHNjb3BlLmlzX2luc3RydWN0b3I9aXNfaW5zdHJ1Y3RvcjsKCiAgbG9nRGVidWcoImFyY2hpdmVfY2xpZW50X21vZGFsIGNvbnRyb2xsZXIiKTsKCiAgJHNjb3BlLmNsb3NlTW9kYWwgPSBmdW5jdGlvbigpIHsKICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICB9OwoKICAkc2NvcGUuYXJjaGl2ZUNsaWVudCA9IGZ1bmN0aW9uKCkKICB7CiAgICBhcmNoaXZlQ2xpZW50KCRodHRwLCRzY29wZSwkc2NvcGUuYnVzaW5lc3NfdXNlcl9pZCxhcmNoaXZlQ2xpZW50X3N1Y2Nlc3MpOwogICAgZnVuY3Rpb24gYXJjaGl2ZUNsaWVudF9zdWNjZXNzKCkKICAgIHsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgICBpZiAoJHNjb3BlLmlzX2luc3RydWN0b3IpCiAgICAgIHsKICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2luc3RydWN0b3JzJyk7CiAgICAgIH0KICAgICAgZWxzZSB7CiAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jbGllbnRzJyk7CiAgICAgIH0KICAgIH0KICB9Cgp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ3BheW1lbnlEZXRhaWxzTW9kYWxDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkcm91dGVQYXJhbXMsICRyb290U2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgZnBheW1lbnQsIHVpQ2FsZW5kYXJDb25maWcpIHsKICAkc2NvcGUuZnBheW1lbnQ9e307CiAgJHNjb3BlLmZwYXltZW50LnBheW1lbnRfZGF0ZT1mcGF5bWVudC5wYXltZW50X2RhdGU7CiAgJHNjb3BlLmZwYXltZW50LnBheW1lbnRfYW1vdW50PWZwYXltZW50LnBheW1lbnRfYW1vdW50OwogICRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2dlbmVyYXRlZD1mcGF5bWVudC5pbnZvaWNlX2dlbmVyYXRlZDsKICAkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9udW1iZXI9ZnBheW1lbnQuaW52b2ljZV9udW1iZXI7CiAgaWYgKGZwYXltZW50Lmludm9pY2VfZGF0ZT09bnVsbCkKICB7CiAgICAkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlX2Zvcm1hdD1uZXcgRGF0ZSgpOwogIH0KICBlbHNlCiAgewogICAgJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZV9mb3JtYXQ9ZnBheW1lbnQuaW52b2ljZV9kYXRlX2Zvcm1hdDsKICB9CiAgJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZT1mcGF5bWVudC5pbnZvaWNlX2RhdGU7CiAgJHNjb3BlLnNlbGVjdGVkUGF5bWVudE1ldGhvZD17CiAgICBuYW1lOiBmcGF5bWVudC5wYXltZW50X21ldGhvZF9uYW1lX3R4dCwKICAgIG1ldGhvZDogZnBheW1lbnQucGF5bWVudF9tZXRob2RfbmFtZQogIH07CiAgJHNjb3BlLmlzUGF5bWVudE1ldGhvZFNlbGVjdGVkPXRydWU7CgogIGxvZ0RlYnVnKCJvbGQgZGF0ZSAiKyRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2RhdGUpOwogIGlmICgkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlIT1udWxsKQogIHsKICAgICRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2RhdGVfZm9ybWF0ID0gbmV3IERhdGUoJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZSk7CiAgfQogICRzY29wZS5wYXltZW50TWV0aG9kcyA9IHBheW1lbnRNZXRob2RzOwogICRzY29wZS5wYXltZW50VHlwZVRpdGxlPWZwYXltZW50LnBheW1lbnRfbWV0aG9kX25hbWVfdHh0OwogICRzY29wZS5mcGF5bWVudC5pbnZvaWNlX3NvdXJjZT0iRVhURVJOQUwiOwoKICBsb2dEZWJ1Zygkc2NvcGUucGF5bWVudE1ldGhvZHMpOwogIGxvZ0RlYnVnKCJwYXltZW55RGV0YWlsc01vZGFsQ29udHJvbGxlciBmb3IgcGF5bWVudCAiK0pTT04uc3RyaW5naWZ5KGZwYXltZW50LCBudWxsLCA0KSk7CgogICRzY29wZS5zZWxlY3RQYXltZW50TWV0aG9kID0gZnVuY3Rpb24ocGF5bWVudCkgewogICAgJHNjb3BlLnBheW1lbnRUeXBlVGl0bGU9cGF5bWVudC5uYW1lOwogICAgbG9nRGVidWcoInBheW1lbnQ9IitwYXltZW50KTsKCiAgICAkc2NvcGUuc2VsZWN0ZWRQYXltZW50TWV0aG9kPXBheW1lbnQ7CiAgICAkc2NvcGUuaXNQYXltZW50TWV0aG9kU2VsZWN0ZWQ9dHJ1ZTsKICB9OwoKICAkc2NvcGUuY2xvc2VNb2RhbCA9IGZ1bmN0aW9uKCkgewogICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogIH07CgogICRzY29wZS51cGRhdGVQYXltZW50ID0gZnVuY3Rpb24oKQogIHsKLy8gbG9nRGVidWcoY3VycmVudENsaWVudCk7CiAgICBsb2dEZWJ1ZygicGF5bWVudCBtZXRob2QiKTsKICAgIGxvZ0RlYnVnKCRzY29wZS5zZWxlY3RlZFBheW1lbnRNZXRob2QpOwogICAgbG9nRGVidWcoIiRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2dlbmVyYXRlZD08Iiskc2NvcGUuZnBheW1lbnQuaW52b2ljZV9nZW5lcmF0ZWQrIj4sICRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2RhdGVfZm9ybWF0PSIrJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZV9mb3JtYXQpOwogICAgbG9nRGVidWcoIiRzY29wZS5zZWxlY3RlZFBheW1lbnRNZXRob2QubWV0aG9kPSIrJHNjb3BlLnNlbGVjdGVkUGF5bWVudE1ldGhvZC5tZXRob2QpOwogICAgaWYgKCgkc2NvcGUuZnBheW1lbnQucGF5bWVudF9hbW91bnQ9PTApIHx8ICgkc2NvcGUuZnBheW1lbnQucGF5bWVudF9hbW91bnQ9PScnKSB8fCAoJHNjb3BlLmZwYXltZW50LnBheW1lbnRfYW1vdW50PT1udWxsKSkKICAgIHsKICAgICAgJHNjb3BlLnVzZXJFcnJvcj0i15DXoNeQINeU15bXnyDXodeb15XXnSDXm9ec16nXlNeVIjsKLy8gYWxlcnQoJ3NzJyk7CiAgICB9CiAgICBlbHNlIGlmICghJHNjb3BlLmlzUGF5bWVudE1ldGhvZFNlbGVjdGVkKQogICAgewogICAgICAkc2NvcGUudXNlckVycm9yPSLXkNeg15Ag15HXl9eoINeQ157Xptei15kg16rXqdec15XXnSI7Ci8vIGFsZXJ0KCdzcycpOwogICAgfQogICAgZWxzZQogICAgewogICAgICBpZiAoKCRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2dlbmVyYXRlZCE9MSkgfHwgKCRzY29wZS5mcGF5bWVudC5pbnZvaWNlX2RhdGVfZm9ybWF0PT1udWxsKSkKICAgICAgewogICAgICAgIHZhciBpbnZvaWNlX2RhdGVfZm9ybWF0ID0gIm51bGwiOwogICAgICB9CiAgICAgIGVsc2UKICAgICAgewogICAgICAgIHZhciBpbnZvaWNlX2RhdGVfZm9ybWF0ID0gJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZV9mb3JtYXQuZ2V0RGF0ZSgpICArICItIiArICgkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9kYXRlX2Zvcm1hdC5nZXRNb250aCgpKzEpICsgIi0iICsgJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZGF0ZV9mb3JtYXQuZ2V0RnVsbFllYXIoKTsKICAgICAgfQogICAgICB0aGVkYXRhPSB7CiAgICAgICAgYmFsYW5jZVRvUGF5OiAkc2NvcGUuZnBheW1lbnQucGF5bWVudF9hbW91bnQsCiAgICAgICAgcGF5bWVudF9tZXRob2RfbmFtZTogJHNjb3BlLnNlbGVjdGVkUGF5bWVudE1ldGhvZC5tZXRob2QsCiAgICAgICAgaW52b2ljZV9udW1iZXI6ICRzY29wZS5mcGF5bWVudC5pbnZvaWNlX251bWJlciwKICAgICAgICBpbnZvaWNlX2dlbmVyYXRlZDogJHNjb3BlLmZwYXltZW50Lmludm9pY2VfZ2VuZXJhdGVkLAogICAgICAgIGludm9pY2VfZGF0ZTogaW52b2ljZV9kYXRlX2Zvcm1hdCwKICAgICAgICBpbnZvaWNlX3NvdXJjZTogJHNjb3BlLmZwYXltZW50Lmludm9pY2Vfc291cmNlCiAgICAgIH07CiAgICAgIHVwZGF0ZVBheW1lbnRGb3JDbGllbnQoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLGZwYXltZW50LnVzZXJfcGF5bWVudF9pZCx0aGVkYXRhLGNyZWF0ZVBheW1lbnRGb3JDbGllbnRfY2FsbGJhY2ssIGNyZWF0ZVBheW1lbnRGb3JDbGllbnRfZmFpbHVyZSk7CiAgICAgIGZ1bmN0aW9uIGNyZWF0ZVBheW1lbnRGb3JDbGllbnRfY2FsbGJhY2soKQogICAgICB7CiAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgICAgIGxvZ0RlYnVnKCJicm9hZGNhc3RpbmcgY2xpZW50UGFnZVJlbG9hZERhdGEiKTsKICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NsaWVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCiAgICAgIH0KICAgICAgZnVuY3Rpb24gY3JlYXRlUGF5bWVudEZvckNsaWVudF9mYWlsdXJlKCkKICAgICAgewogICAgICAgIGxvZ0RlYnVnKCJicm9hZGNhc3RpbmcgY2xpZW50UGFnZVJlbG9hZERhdGEiKTsKLy8gJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgICB9CiAgICB9CiAgfQp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ2V2ZW50VHlwZUV4dHJhRmllbGRzTW9kYWxDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIGV2ZW50VHlwZVByb3BlcnRpZXMsIHVpQ2FsZW5kYXJDb25maWcpIHsKICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcz1ldmVudFR5cGVQcm9wZXJ0aWVzOwogIGxvZ0RlYnVnKCJldmVudFR5cGVFeHRyYUZpZWxkc01vZGFsQ29udHJvbGxlcj0iK0pTT04uc3RyaW5naWZ5KGV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMsIG51bGwsIDQpKTsKICBpZiAoZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcz09bnVsbCkKICB7CiAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllc09yaWc9W107CiAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcz1bXTsKICB9CiAgZWxzZSBpZiAoZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcy5sZW5ndGg+MCkKICB7CiAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllc09yaWc9KGV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMpLnNsaWNlKDApOwogIH0KICBlbHNlCiAgewogICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXNPcmlnPVtdOwogICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHM9W107CiAgfQogICRzY29wZS5va0xpbWl0YXRpb25Nb2RhbCA9IGZ1bmN0aW9uKCkgewogICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogIH07CgogICRzY29wZS5jYW5jZWwgPSBmdW5jdGlvbigpCiAgewogICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXM9JHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXNPcmlnOwogICAgbG9nRGVidWcoImNsb3NlIik7CiAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllc09yaWcpOwogIH0KICAkc2NvcGUuc2F2ZUFuZENsb3NlID0gZnVuY3Rpb24oKQogIHsKICAgIGxvZ0RlYnVnKCJzYXZlIGFuZCBjbG9zZSIpOwogICAgZnVuY3Rpb24gc2V0Q2xpZW50c0V4dHJhRmllbGRzX3N1Y2Nlc3MoKQogICAgewoKICAgIH0KICAgICRzY29wZS5DbGllbnRzRGV0YWlscz17fTsKICAgICRzY29wZS5DbGllbnRzRGV0YWlscy5leHRyYUZpZWxkcz0kc2NvcGUuZXh0cmFGaWVsZHM7CiAgICBzZXRDbGllbnRzRXh0cmFGaWVsZHMoJGh0dHAsJHNjb3BlLCRzY29wZS5DbGllbnRzRGV0YWlscyxzZXRDbGllbnRzRXh0cmFGaWVsZHNfc3VjY2Vzcyk7CiAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyk7CiAgfQoKICAkc2NvcGUuZHVwbGljYXRlRmllbGROYW1lcz0iIjsKICAkc2NvcGUuYWRkRXh0cmFGaWVsZHMgPSBmdW5jdGlvbigpCiAgewogICAgbG9nRGVidWcoImFkZEV4dHJhRmllbGRzIHZhbGlkYXRpbmciKTsKICAgIC8vIGNoZWNraW5nIGZvciBkdXBsaWNhdGUgbmFtZXMKICAgIHZhciBleHRyYUZpZWxkc05hbWVzID0gW107CiAgICBmb3IgKHZhciBpPTE7IGk8JHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMubGVuZ3RoOyBpKyspCiAgICB7CiAgICAgIGV4dHJhRmllbGRzTmFtZXMucHVzaCgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkc1tpXS5maWVsZF9uYW1lKTsKICAgIH0KICAgIGV4dHJhRmllbGRzTmFtZXMuc29ydCgpOwogICAgdmFyIGxhc3QgPSBleHRyYUZpZWxkc05hbWVzWzBdOwogICAgZm9yICh2YXIgaT0xOyBpPGV4dHJhRmllbGRzTmFtZXMubGVuZ3RoOyBpKyspCiAgICB7CiAgICAgIGlmIChleHRyYUZpZWxkc05hbWVzW2ldID09IGxhc3QpCiAgICAgIHsKICAgICAgICAvLyAgYWxlcnQoJ0R1cGxpY2F0ZSA6ICcrbGFzdCk7CiAgICAgICAgJHNjb3BlLmR1cGxpY2F0ZUZpZWxkTmFtZXM9J9en15nXmdedINep15PXlCDXm9ek15XXnCDXkdep150gIicrbGFzdCsnIi4uLic7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGxhc3QgPSBleHRyYUZpZWxkc05hbWVzW2ldOwogICAgfQogICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMpOwogIH0KCiAgJHNjb3BlLmV4dHJhRmllbGRzID0gZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkczsKICAkc2NvcGUuZmllbGRUeXBlcyA9IFt7ZmllbGRfZGF0YXR5cGU6ICJURVhUX0FSRUEiLCBuYW1lOifXqteZ15HXqiDXmNen16HXmCd9LCB7ZmllbGRfZGF0YXR5cGU6ICJOVU1CRVIiLCBuYW1lOifXnteh16TXqCd9ICwge2ZpZWxkX2RhdGF0eXBlOiAiU1RSSU5HIiwgbmFtZTon15jXp9eh15gg16fXpteoJ30gLCB7ZmllbGRfZGF0YXR5cGU6ICJCT09MRUFOIiwgbmFtZTon16rXmdeR16og16HXmdee15XXnyd9ICwge2ZpZWxkX2RhdGF0eXBlOiAiREFURSIsIG5hbWU6J9eq15DXqNeZ15onfV07CgogICRzY29wZS5hZGROZXdGaWVsZCA9IGZ1bmN0aW9uKCkgewogICAgdmFyIG5ld0l0ZW1ObyA9ICRzY29wZS5leHRyYUZpZWxkcy5sZW5ndGgrMTsKICAgICRzY29wZS5leHRyYUZpZWxkcy5wdXNoKHsiZmllbGRfZGF0YXR5cGUiOiJTVFJJTkciLCJpc19tYW5kYXRvcnkiOjAsICJmcm9tZGIiOiBmYWxzZSwgImZpZWxkX2lkIjogMCwgImlzX2FjdGl2ZSI6IDEsICJtb2RpZmllZCI6IDB9KTsKCiAgICBsb2dEZWJ1ZygiZXh0cmEgZmllbGRzOiAiICsgSlNPTi5zdHJpbmdpZnkoJHNjb3BlLmV4dHJhRmllbGRzLCBudWxsLCAyKSk7CgogIH07CgogICRzY29wZS5yZW1vdmVGaWVsZCA9IGZ1bmN0aW9uKGNob2ljZSkKICB7Ci8vIHJlbW92aW5nIGZpZWxkCi8vIGlmIGl0cyBub3Qgb3JpZ2luYXRlZCBmcm9tIGRhdGFiYXNlIC0gdGhlbiB3ZSBzaW1wbHkgZGVsZXRlIGl0IGZyb20gdGhlIGFycmF5Ci8vIG90aGVyd2lzZSB3ZSBtYXJrIGl0IGFzIGFjdGl2ZT1mYWxzZQogICAgbG9nRGVidWcoY2hvaWNlKTsKLy8gdmFyIGxhc3RJdGVtID0gKGNob2ljZS5pZCktMTsvLyRzY29wZS5jaG9pY2VzLmxlbmd0aC0xOwovLyAkc2NvcGUuY2hvaWNlcy5zcGxpY2UobGFzdEl0ZW0sMSk7CiAgICBmb3IodmFyIGkgPSAwOyBpIDwgJHNjb3BlLmV4dHJhRmllbGRzLmxlbmd0aDsgaSsrKQogICAgewogICAgICBpZiAoJHNjb3BlLmV4dHJhRmllbGRzW2ldID09IGNob2ljZSkKICAgICAgewogICAgICAgIGlmIChjaG9pY2UuZnJvbWRiPT1mYWxzZSkKICAgICAgICB7Ci8vIGlmIG5vdCBmcm9tIGRiIC0gcmVtb3ZpbmcgaXQgZnJvbSB0aGUgYXJyYXkgb2YgZXh0cmEtZmllbGRzCiAgICAgICAgICAkc2NvcGUuZXh0cmFGaWVsZHMuc3BsaWNlKGksIDEpOwogICAgICAgIH0KICAgICAgICBlbHNlCiAgICAgICAgewovLyBpZiBmaWVsZCBvcmlnaW5hdGVkIGZyb20gZGIgLSB0aGFuIHdlIGRvbnQgcmVtb3ZlIGl0IGZyb20gdGhlIGFycmF5Ci8vIGFuZCBtYXJrIGl0IGFzIGFjdGl2ZT1mYWxzZSBzbyB0aGF0IGl0IGNhbiBiZSBoYW5kZWxlZCBvbiB0aGUgc2VydmVyCiAgICAgICAgICBjaG9pY2UuaXNfYWN0aXZlPTA7CiAgICAgICAgICBjaG9pY2UubW9kaWZpZWQ9dHJ1ZTsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICB9Owp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ2V2ZW50Q2xvc2VJZ25vcmVNYW5kYXRvcnlGaWVsZHNNb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRyb3V0ZVBhcmFtcywgJHJvb3RTY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRodHRwLCBjdXJyZW50RXZlbnQsIHVpQ2FsZW5kYXJDb25maWcpIHsKICAkc2NvcGUuY3VycmVudEV2ZW50PWN1cnJlbnRFdmVudDsKCiAgJHNjb3BlLm9rQ2FuY2VsID0gZnVuY3Rpb24oKSB7CiAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgfTsKCiAgJHNjb3BlLmNsb3NlRXZlbnRJZ25vcmVNYW5kYXRvcnlGaWVsZHMgPSBmdW5jdGlvbigpCiAgewogICAgbG9nRGVidWcoImlnbm9yZSBtYW5kYXRvcnkgZXh0cmEgZmllbGRzIGFuZCBjbG9zZSBldmVudCIpOwogICAgJHNjb3BlLmN1cnJlbnRFdmVudC5pZ25vcmVFeHRyYUZpZWxkc1ZhbGlkYXRpb249dHJ1ZTsKICAgIGNsb3NlRXZlbnQoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCwkc2NvcGUuY3VycmVudEV2ZW50LGFmdGVyQ2xvc2VFdmVudCxhZnRlckNsb3NlRXZlbnQpOwogICAgZnVuY3Rpb24gYWZ0ZXJDbG9zZUV2ZW50KCkKICAgIHsKICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdldmVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCiAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICAgIH07CiAgfQp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ2V2ZW50VHlwZUNoYW5nZWRQb3B1cENvbnRyb2xsZXInLCBmdW5jdGlvbigkbG9jYXRpb24sICRzY29wZSwgJHJvdXRlUGFyYW1zLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJGh0dHAsIGV2ZW50VHlwZVByb3BlcnRpZXMsIHVpQ2FsZW5kYXJDb25maWcpIHsKICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcz1ldmVudFR5cGVQcm9wZXJ0aWVzOwogICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLnVwZGF0ZWRfZnJvbV9kYXRlPW5ldyBEYXRlKCk7CiAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMudXBkYXRlX2V4aXN0aW5nX2V2ZW50cz1mYWxzZTsKCiAgJHNjb3BlLmNsb3NlTW9kYWwgPSBmdW5jdGlvbigpIHsKICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICB9OwoKICAkc2NvcGUudXBkYXRlRXZlbnRUeXBlID0gZnVuY3Rpb24oKQogIHsKICAgIGxvZ0RlYnVnKCJ1cGRhdGUgRXZlbnQgVHlwZSAiICsgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXZlbnRfdHlwZV9pZCk7CiAgICBpZiAoJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMubWF4X3JlZ2lzdHJhdGlvbnM9PScnKQogICAgewogICAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5tYXhfcmVnaXN0cmF0aW9ucz0wOwogICAgfQogICAgdXBkYXRlRXZlbnRUeXBlKCRodHRwLCRzY29wZSwkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5ldmVudF90eXBlX2lkLCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLHVwZGF0ZUV2ZW50VHlwZV9zdWNjZXNzKTsKICAgIGZ1bmN0aW9uIHVwZGF0ZUV2ZW50VHlwZV9zdWNjZXNzKCkKICAgIHsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgICAkbG9jYXRpb24ucGF0aCgnL2V2ZW50X3R5cGVzJyk7CiAgICB9CiAgfQoKfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdjbGFzc0RlbGV0ZUFsbE1vZGFsQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHJvb3RTY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRodHRwLCBjdXJyZW50RXZlbnQsIHVpQ2FsZW5kYXJDb25maWcpCnsKICBsb2dEZWJ1ZygiY29udHJvbGxlcjogY2xhc3NEZWxldGVBbGxNb2RhbENvbnRyb2xsZXIiKTsKICAkc2NvcGUuY3VycmVudEV2ZW50PWN1cnJlbnRFdmVudDsKICAkc2NvcGUuY2xvc2VNb2RhbCA9IGZ1bmN0aW9uKCkKICB7CiAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgfTsKCgogICRzY29wZS5kZWxldGVDbGFzc0V2ZW50U2luZ2xlPWZ1bmN0aW9uICgpIC8vIGRlbGV0ZSBvbmx5IG9uZS9jdXJyZW50IGNsYXNzIGV2ZWh0CiAgewogICAgY2FuY2VsQ2xhc3NFdmVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCxjYW5jZWxDbGFzc0V2ZW50X2NhbGxiYWNrLCBjYW5jZWxDbGFzc0V2ZW50X2NhbGxiYWNrKTsKICAgIGZ1bmN0aW9uIGNhbmNlbENsYXNzRXZlbnRfY2FsbGJhY2soKQogICAgewogICAgICBnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkKTsKICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ3JlbG9hZEV2ZW50Jyx7ZXZlbnRfaWQgOiAkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkfSk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCiAgICB9CiAgfQogICRzY29wZS5kZWxldGVDbGFzc0V2ZW50c0FsbD1mdW5jdGlvbiAoKSAvLyBkZWxldGUgYWxsIHJlcGVhdGluZyBldmVudHMKICB7CiAgICBjYW5jZWxDbGFzc1JlcGVhdGluZ0V2ZW50KCRodHRwLCRzY29wZSwwLCRzY29wZS5jdXJyZW50RXZlbnQucmVwZWF0X2V2ZW50X2lkLGNhbmNlbENsYXNzRXZlbnRfY2FsbGJhY2ssIGNhbmNlbENsYXNzRXZlbnRfY2FsbGJhY2spOwogICAgZnVuY3Rpb24gY2FuY2VsQ2xhc3NFdmVudF9jYWxsYmFjaygpCiAgICB7CiAgICAgIGdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQpOwogICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgncmVsb2FkRXZlbnQnLHtldmVudF9pZCA6ICRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWR9KTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKICAgIH0KICB9CiAgJHNjb3BlLmRlbGV0ZUNsYXNzRXZlbnRzQWxsU3RhcnRpbmdFdmVudElEPWZ1bmN0aW9uICgpIC8vIGRlbGV0ZSBhbGwgcmVwZWF0aW5nIGV2ZW50cyBzdGFydGluZyBldmVudF9pZAogIHsKICAgIGNhbmNlbENsYXNzUmVwZWF0aW5nRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQsJHNjb3BlLmN1cnJlbnRFdmVudC5yZXBlYXRfZXZlbnRfaWQsY2FuY2VsQ2xhc3NFdmVudF9jYWxsYmFjaywgY2FuY2VsQ2xhc3NFdmVudF9jYWxsYmFjayk7CiAgICBmdW5jdGlvbiBjYW5jZWxDbGFzc0V2ZW50X2NhbGxiYWNrKCkKICAgIHsKLy8gZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCk7CiAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdyZWxvYWRFdmVudCcse2V2ZW50X2lkIDogJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZH0pOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgfQogIH0KCn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignYnVzaW5lc3NfbW9kYWxfbGltaXRhdGlvbl9jcmVhdGUnLCBmdW5jdGlvbigkc2NvcGUsICRyb290U2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgc3RhcnQsZW5kLCBmaXhlZFNjaGVkdWxlLCB1aUNhbGVuZGFyQ29uZmlnKSB7CgogICRzY29wZS5maXhlZFNjaGVkdWxlPWZpeGVkU2NoZWR1bGU7CiAgJHNjb3BlLm9yaWdpbmFsX3N0YXJ0PXN0YXJ0OwogICRzY29wZS5vcmlnaW5hbF9lbmQ9ZW5kOwoKICAkc2NvcGUuc3RhcnQ9bmV3IG1vbWVudChzdGFydCkqMTAwMDsKICAkc2NvcGUuZW5kPW5ldyBtb21lbnQoZW5kKSoxMDAwOwogIGNvbnNvbGUubG9nKCdzdGFydD0nK3N0YXJ0KTsKICBjb25zb2xlLmxvZygnZW5kPScrZW5kKTsKCiAgZ2V0QnVzaW5lc3NMb2NhdGlvbnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19sb2NhdGlvbnMnLGdldEJ1c2luZXNzTG9jYXRpb25zX3N1Y2Nlc3MpOwogIGZ1bmN0aW9uIGdldEJ1c2luZXNzTG9jYXRpb25zX3N1Y2Nlc3MoKQogIHsKICAgICRzY29wZS5uZXdFdmVudERldGFpbHMubG9jYXRpb25faWQ9JHNjb3BlLmJ1c2luZXNzX2xvY2F0aW9uc1swXS5sb2NhdGlvbl9pZDsKICB9CgogIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc3RhcnQpOwogIHNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKGVuZCk7CiAgbG9nRGVidWcoInNlbGVjdGVkRGF0ZVN0YXJ0ID0gIitzZWxlY3RlZERhdGVTdGFydCk7CiAgdmFyIHNlbGVjdGVkRGF0ZVN0YXJ0ID0gbmV3IERhdGUoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZSgpICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKICB2YXIgc2VsZWN0ZWREYXRlRW5kID0gbmV3IERhdGUoc2VsZWN0ZWREYXRlRW5kLmdldFRpbWUoKSArIHNlbGVjdGVkRGF0ZUVuZC5nZXRUaW1lem9uZU9mZnNldCgpICogNjAwMDApOwoKLy8gbG9nRGVidWcoImRhdGU9IiArIHNlbGVjdGVkRGF0ZVN0YXJ0KTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudCA9IFtdOwogICRzY29wZS5uZXdFdmVudERldGFpbHMgPSBbXTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0SG91cnMoKTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBzZWxlY3RlZERhdGVTdGFydC5nZXRNaW51dGVzKCk7CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkb3cgPSBkYXlOYW1lc1tzZWxlY3RlZERhdGVTdGFydC5nZXREYXkoKV07CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXRlID0gc2VsZWN0ZWREYXRlU3RhcnQ7CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aCA9IG1vbnRoTmFtZXNbc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TW9udGgoKV07CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aDExMiA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldE1vbnRoKCkrMTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRheW9mbW9udGggPSBzZWxlY3RlZERhdGVTdGFydC5nZXREYXRlKCk7CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RnVsbFllYXIoKTsKICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWVfaW5wdXRfZm9ybWF0PSBuZXcgRGF0ZSgxOTcwLCAwLCAxLCAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzLCAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMsIDApOwoKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycyA9IHNlbGVjdGVkRGF0ZUVuZC5nZXRIb3VycygpOwogICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKSA8IDEwID8gJzAnIDogJycpICsgc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKTsKCgogICRzY29wZS5jYW5jZWwgPSBmdW5jdGlvbigpIHsKICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICB9OwoKICBnZXRBbGxJbnN0cnVjdG9ycygkaHR0cCwkc2NvcGUsJ2luc3RydWN0b3JzJyxnZXRBbGxJbnN0cnVjdG9yc19zdWNjZXNzKTsKICBmdW5jdGlvbiBnZXRBbGxJbnN0cnVjdG9yc19zdWNjZXNzKCkKICB7CiAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmluc3RydWN0b3JfaWQ9JHNjb3BlLmluc3RydWN0b3JzWzBdLmJ1c2luZXNzX3VzZXJfaWQ7CiAgfQogIGdldE5vQ2xhc3NFdmVudFR5cGVzTm9BZG1pbigkaHR0cCwkc2NvcGUsJ3JlbGF0ZWRFdmVudFR5cGVzJyk7CgogICRzY29wZS5jcmVhdGVOZXdMaW1pdGF0aW9uID0gZnVuY3Rpb24oKQogIHsKICAgIGxvZ0RlYnVnKCJmdW5jdGlvbjogY3JlYXRlTmV3TGltaXRhdGlvbiIpOwogICAgY2FsZW5kYXIgPSAnY2FsZW5kYXJfaG91cnNfb2Zfd29yayc7CgogICAgaWYgKCRzY29wZS5zZWxlY3RlZEV2ZW50VHlwZXMubGVuZ3RoPDEpCiAgICB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vyczwkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKQogICAgewogICAgICBhbGVydCgi15bXntefINeh15nXldedINec16TXoNeZINeW157XnyDXlNeq15fXnNeUIik7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vycz09JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykKICAgIHsKICAgICAgaWYgKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXM8PSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcykKICAgICAgewogICAgICAgIGFsZXJ0KCLXltee158g16HXmdeV150g15zXpNeg15kg15bXntefINeU16rXl9ec15QiKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgaWYgKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXM8KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcysxMCkpCiAgICAgIHsKICAgICAgICBhbGVydCgi15HXnNeV16cg16fXmNefINeeLTEwINeT16fXldeqIik7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9CiAgICBpZiAoIWt1emVJc0NhbGVuZGFyRHJhZ2dibGUpIHsKICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigndW5zZWxlY3QnKTsKICAgIH0KICAgIGxvZ0RlYnVnKCJzdGFydD0iICsgc3RhcnQpOwogICAgY2hlY2tEYXRlID0gbmV3IERhdGUoc3RhcnQpOwogICAgbG9nRGVidWcoImNoZWNrIGRhdGUgPSAiICsgY2hlY2tEYXRlKQogICAgbG9nRGVidWcoImVuZD0iICsgZW5kKTsKICAgIGVjb2xvcj0iIzAwYTY1YSI7CgogICAgaWYgKGNoZWNrRGF0ZS5nZXRGdWxsWWVhcigpID09IDE5NzApIHsKICAgICAgZGF5X2xpbWl0X2lkID0gLTE7CiAgICB9IGVsc2UgewogICAgICBkYXlfbGltaXRfaWQgPSAxOwogICAgfQoKLy8gdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbXS5mdWxsQ2FsZW5kYXIoJ3JlcmVuZGVyRXZlbnRzJyk7CgogICAgdGVtcF9saW1pdF9pZCA9IGNhbGNfdGVtcF9saW1pdF9pZCgpOwoKICAgIGxvZ0RlYnVnKCRzY29wZS5zZWxlY3RlZEV2ZW50VHlwZXNbMF0pOwogICAgbG9nRGVidWcoJHNjb3BlLnNlbGVjdGVkRXZlbnRUeXBlc1swXS5ldmVudF90eXBlX2lkKTsKCiAgICBzdGFydF9wYXJhbT1zdGFydDsKICAgIGVuZF9wYXJhbT1lbmQ7CiAgICB0aXRsZV9wYXJhbT0nJzsKICAgIGxvZ0RlYnVnKCJhZGRMaW1pdGF0aW9uVG9EYXRhYmFzZSBzdGFydD0iICsgc3RhcnRfcGFyYW0gKyAiLCBlbmQ9IiArICIsIHRpdGxlPSIgKyB0aXRsZV9wYXJhbSApOwoKICAgIHRoZWRhdGEgPSB7CiAgICAgIHN0YXJ0X2RhdGU6ICRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZSwKICAgICAgZW5kX2RhdGU6ICRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kX3RpbWUsCiAgICAgIGNvbG9yOiBlY29sb3IsCiAgICAgIHRlbXBfbGltaXRfaWQ6IHRlbXBfbGltaXRfaWQsCiAgICAgIGVtcF9pZDogJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pbnN0cnVjdG9yX2lkLAogICAgICBsb2NhdGlvbl9pZDogJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5sb2NhdGlvbl9pZCwKICAgICAgZXZlbnRfdHlwZV9pZDogJHNjb3BlLnNlbGVjdGVkRXZlbnRUeXBlc1swXS5ldmVudF90eXBlX2lkLAogICAgICBldmVudF90eXBlczogJHNjb3BlLnNlbGVjdGVkRXZlbnRUeXBlcywKICAgICAgdGl0bGU6IHRpdGxlX3BhcmFtCiAgICB9OwoKICAgIGlmICgkc2NvcGUuZml4ZWRTY2hlZHVsZSkgLy8gZml4ZWQgc2NoZWR1bGUgdnMgc3BlY2lmaWMgd2VlZC9kYXkgbGltaXRhdGlvbgogICAgewogICAgICBjcmVhdGVDYWxlbmRhckxpbWl0YXRpb24oJGh0dHAsJHNjb3BlLHRoZWRhdGEsbGltaXRhdGlvbl9zdWNjZXNzX2NhbGxiYWNrKTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgY3JlYXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5KCRodHRwLCRzY29wZSx0aGVkYXRhLGxpbWl0YXRpb25fc3VjY2Vzc19jYWxsYmFjayk7CiAgICB9CiAgICBmdW5jdGlvbiBsaW1pdGF0aW9uX3N1Y2Nlc3NfY2FsbGJhY2soKQogICAgewogICAgICBsb2dEZWJ1Zygic3VjY2VzcyIpOwogICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZWZldGNoRXZlbnRzJyk7CiAgICAgICR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoKTsKICAgIH0KCiAgfQoKICAkc2NvcGUuc3RhcnRNaW51dGVzID0gZnVuY3Rpb24oKQogIHsKICAgIGxvZ0RlYnVnKCJzdGFydE1pbnV0ZXMgIisoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKSk7CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXM9bWludXRlc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKTsKICAgIGNhbGN1bGF0ZVN0YXJ0VGltZSgpOwogIH0KICAkc2NvcGUuc3RhcnRIb3VycyA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1Zygic3RhcnRIb3VycyAiK2hvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKSk7CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzPWhvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKTsKICAgIGNhbGN1bGF0ZVN0YXJ0VGltZSgpOwogIH0KICAkc2NvcGUuZW5kTWludXRlcyA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1ZygiZW5kTWludXRlcyAiKygkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzKSk7CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzPW1pbnV0ZXNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpOwogICAgY2FsY3VsYXRlRW5kVGltZSgpOwogIH0KICAkc2NvcGUuZW5kSG91cnMgPSBmdW5jdGlvbigpCiAgewogICAgbG9nRGVidWcoImVuZEhvdXJzICIraG91cnNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzKSk7CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vycz1ob3Vyc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMpOwogICAgY2FsY3VsYXRlRW5kVGltZSgpOwogIH0KCgogIGZ1bmN0aW9uIGNhbGN1bGF0ZVN0YXJ0VGltZSgpCiAgewogICAgZXZlbnRZZWFyPSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0eWVhcjsKICAgIGV2ZW50TW9udGg9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aDExMjsKICAgIGV2ZW50RGF5PSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aDsKICAgIGlmIChwYXJzZUludChldmVudE1vbnRoKTwxMCkKICAgIHsKICAgICAgZXZlbnRNb250aD0iMCIrZXZlbnRNb250aDsKICAgIH0KICAgIGlmIChwYXJzZUludChldmVudERheSk8MTApCiAgICB7CiAgICAgIGV2ZW50RGF5PSIwIitldmVudERheTsKICAgIH0KICAgIGxvZ0RlYnVnKCIkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXI9IitldmVudFllYXIpOwogICAgbG9nRGVidWcoIiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aD0iK2V2ZW50TW9udGgpOwogICAgbG9nRGVidWcoIiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bW9udGg9IitldmVudERheSk7CiAgICBuZXdfc3RhcnQ9bW9tZW50LnV0YyhldmVudFllYXIrIi0iK2V2ZW50TW9udGgrIi0iK2V2ZW50RGF5KyJUMDA6MDA6MDAiKS5hZGQoKChwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKSo2MCkrcGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKSksICdtaW51dGVzJyk7CiAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWU9bmV3X3N0YXJ0OwogICAgbG9nRGVidWcoIm5ld19zdGFydD0iK25ld19zdGFydCk7CiAgfQogIGZ1bmN0aW9uIGNhbGN1bGF0ZUVuZFRpbWUoKQogIHsKICAgIGV2ZW50WWVhcj0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXI7CiAgICBldmVudE1vbnRoPSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bW9udGgxMTI7CiAgICBldmVudERheT0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRheW9mbW9udGg7CiAgICBpZiAocGFyc2VJbnQoZXZlbnRNb250aCk8MTApCiAgICB7CiAgICAgIGV2ZW50TW9udGg9IjAiK2V2ZW50TW9udGg7CiAgICB9CiAgICBpZiAocGFyc2VJbnQoZXZlbnREYXkpPDEwKQogICAgewogICAgICBldmVudERheT0iMCIrZXZlbnREYXk7CiAgICB9CiAgICBsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyPSIrZXZlbnRZZWFyKTsKICAgIGxvZ0RlYnVnKCIkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRheW9mbW9udGg9IitldmVudE1vbnRoKTsKICAgIGxvZ0RlYnVnKCIkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoPSIrZXZlbnREYXkpOwogICAgbmV3X2VuZD1tb21lbnQudXRjKGV2ZW50WWVhcisiLSIrZXZlbnRNb250aCsiLSIrZXZlbnREYXkrIlQwMDowMDowMCIpLmFkZCgoKHBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzKSo2MCkrcGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcykpLCAnbWludXRlcycpOwogICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmRfdGltZT1uZXdfZW5kOwogICAgbG9nRGVidWcoIm5ld19lbmQ9IituZXdfZW5kKTsKICB9CgogIGNhbGN1bGF0ZVN0YXJ0VGltZSgpOwogIGNhbGN1bGF0ZUVuZFRpbWUoKTsKCiAgZnVuY3Rpb24gbWludXRlc0NoYW5nZWQodGhlbWludXRlcykKICB7CiAgICBsb2dEZWJ1ZygidGhlbWludXRlcz0iK3RoZW1pbnV0ZXMpOwogICAgaWYgKHR5cGVvZiB0aGVtaW51dGVzPT0idW5kZWZpbmVkIikKICAgIHsKICAgICAgcmV0dXJuICIwMCI7CiAgICB9CiAgICB0aGVtaW51dGVzPXBhcnNlSW50KHRoZW1pbnV0ZXMpOwogICAgaWYgKHRoZW1pbnV0ZXM+NjApCiAgICB7CiAgICAgIHJldHVybiAiMDAiOwogICAgfQogICAgZWxzZSBpZiAodGhlbWludXRlczwwKQogICAgewogICAgICByZXR1cm4gIjAwIjsKICAgIH0KICAgIGVsc2UgaWYgKHRoZW1pbnV0ZXM9PSIiKQogICAgewogICAgICByZXR1cm4gIjAwIjsKICAgIH0KICAgIGVsc2UgaWYgKHRoZW1pbnV0ZXM8MTApCiAgICB7CiAgICAgIHJldHVybiAiMCIrdGhlbWludXRlczsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgcmV0dXJuIHRoZW1pbnV0ZXM7CiAgICB9CiAgfQogIGZ1bmN0aW9uIGhvdXJzQ2hhbmdlZCh0aGVob3VycykKICB7CiAgICBsb2dEZWJ1ZygidGhlaG91cnM9Iit0aGVob3Vycyk7CiAgICBpZiAodHlwZW9mIHRoZWhvdXJzPT0idW5kZWZpbmVkIikKICAgIHsKICAgICAgcmV0dXJuICIwIjsKICAgIH0KICAgIHRoZWhvdXJzPXBhcnNlSW50KHRoZWhvdXJzKTsKICAgIGlmICh0aGVob3Vycz4yNCkKICAgIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CiAgICBlbHNlIGlmICh0aGVob3VyczwwKQogICAgewogICAgICByZXR1cm4gMDsKICAgIH0KICAgIGVsc2UgaWYgKHRoZWhvdXJzPT0iIikKICAgIHsKICAgICAgcmV0dXJuICIwIjsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgcmV0dXJuIHRoZWhvdXJzOwogICAgfQogIH0KfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2NsYXNzQ2xvc2VNb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRyb290U2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgZXZlbnRfaWQsIHVpQ2FsZW5kYXJDb25maWcpIHsKICBnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnc2VsZWN0ZWRFdmVudCcsZXZlbnRfaWQsYWZ0ZXJHZXRDbGllbnRTcGVjaWZpY0V2ZW50KTsKICBmdW5jdGlvbiBhZnRlckdldENsaWVudFNwZWNpZmljRXZlbnQoKQogIHsKICAgIGZvciAoaSA9IDA7IGkgPCAkc2NvcGUuc2VsZWN0ZWRFdmVudC5ldmVudFVzZXJzLmxlbmd0aDsgaSsrKQogICAgewogICAgICBpZiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRVc2Vyc1tpXS5zdGF0dXNfbmFtZSE9JGdVc2VyX3N0YXR1c19hYnNlbnRlZCkKICAgICAgewogICAgICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50VXNlcnNbaV0ucGFydGljaXBhdGVkPXRydWU7CiAgICAgIH0KICAgICAgaWYgKCRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50VXNlcnNbaV0uaXNfd2FpdGluZ19saXN0PT0xKQogICAgICB7CiAgICAgICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRVc2Vyc1tpXS5wYXJ0aWNpcGF0ZWQ9ZmFsc2U7CiAgICAgIH0KICAgIH0KICAgIGxvZ0RlYnVnKCRzY29wZS5zZWxlY3RlZEV2ZW50KTsKICB9CgovLyBjbGlja2VkIHJvdyAtIGNoZWNrL3VuY2hlY2sgdGhlIGNoZWNrYm94IG9mIGEgdXNlcgogICRzY29wZS5yb3dDbGlja2VkID0gZnVuY3Rpb24ob2JqKQogIHsKICAgIGxvZ0RlYnVnKCdyb3cgY2xpY2tlZCcpOwogICAgb2JqLnBhcnRpY2lwYXRlZCA9ICFvYmoucGFydGljaXBhdGVkOwogIH07CgogICRzY29wZS5va0xpbWl0YXRpb25Nb2RhbCA9IGZ1bmN0aW9uKCkgewogICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogIH07CgogICRzY29wZS5jbG9zZUNsYXNzID0gZnVuY3Rpb24oKQogIHsKICAgIGNsb3NlQ2xhc3NFdmVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRfaWQsJHNjb3BlLnNlbGVjdGVkRXZlbnQsYWZ0ZXJDbG9zZUV2ZW50LGFmdGVyQ2xvc2VFdmVudCk7CiAgICBmdW5jdGlvbiBhZnRlckNsb3NlRXZlbnQoKQogICAgewogICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgncmVsb2FkRXZlbnQnLHtldmVudF9pZCA6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50X2lkfSk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCiAgICB9OwogIH0KfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2J1c2luZXNzQ2xpZW5kQ2FyZFBheW1lbnQnLCBmdW5jdGlvbigkc2NvcGUsICRyb3V0ZVBhcmFtcywgJHJvb3RTY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRodHRwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50Q2xpZW50LCBpc3BsdXMsIHVpQ2FsZW5kYXJDb25maWcsIGJ1c2luZXNzQ29uZmlnLCBwYXltZW50cykKewogICRzY29wZS5pc3BsdXM9aXNwbHVzOwogIGxvZ0RlYnVnKCdidXNpbmVzc0NsaWVuZENhcmRQYXltZW50IGlzcGx1cz0nICtpc3BsdXMrIiBjdXJyZW50Q2xpZW50PSIrIEpTT04uc3RyaW5naWZ5KGN1cnJlbnRDbGllbnQsIG51bGwsIDIpKTsKICAkc2NvcGUua3V6ZUlzTG9hZGluZz1mYWxzZTsKICBsb2dEZWJ1ZygnY3VycmVudENsaWVudC5wYXltZW50X2JhbGFuY2U9JytjdXJyZW50Q2xpZW50LnBheW1lbnRfYmFsYW5jZSsiLGN1cnJlbnRDbGllbnQudW5wYWlkX2JhbGFuY2UgPSIrY3VycmVudENsaWVudC51bnBhaWRfYmFsYW5jZSk7CiAgdGhlYmFsYW5jZSA9IGN1cnJlbnRDbGllbnQucGF5bWVudF9iYWxhbmNlLWN1cnJlbnRDbGllbnQudW5wYWlkX2JhbGFuY2U7CiAgbG9nRGVidWcoJ3RoZWJhbGFuY2U9Jyt0aGViYWxhbmNlKTsKICBpZiAodGhlYmFsYW5jZTwwKQogIHsKICAgICRzY29wZS5iYWxhbmNlVG9QYXk9TWF0aC5hYnModGhlYmFsYW5jZSk7CiAgfQogIGVsc2UKICB7CiAgICAkc2NvcGUuYmFsYW5jZVRvUGF5PTA7CiAgfQogIHVwZGF0ZUJhbGFuY2UodHJ1ZSk7CiAgJHNjb3BlLnBheW1lbnRUeXBlVGl0bGU9IteR15fXqCI7CiAgJHNjb3BlLmN1cnJlbnRDbGllbnQ9Y3VycmVudENsaWVudDsKICBsb2dEZWJ1Zygkc2NvcGUuY3VycmVudENsaWVudCk7CiAgJHNjb3BlLmludm9pY2Vfc291cmNlX2lkID0gYnVzaW5lc3NDb25maWcuaW52b2ljZV9zb3VyY2VfaWQ7CiAgJHNjb3BlLmhhc1ZhdCA9IGJ1c2luZXNzQ29uZmlnLnZhdF9yYXRlID4gMDsKCiAgJHNjb3BlLmNsb3NlTW9kYWwgPSBmdW5jdGlvbigpIHsKICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICB9OwoKICAkc2NvcGUuZXh0ZXJuYWxfaW52b2ljZV9nZW5lcmF0ZWQ9ZmFsc2U7CiAgJHNjb3BlLmludm9pY2VfZGF0ZV9mb3JtYXQ9bmV3IERhdGUoKTsKCiAgZ2V0TmV4dEludm9pY2VOdW1iZXIoJGh0dHAsJHNjb3BlLCRzY29wZS5jdXJyZW50Q2xpZW50LmJ1c2luZXNzX3VzZXJfaWQsJ2ludm9pY2VfbnVtYmVyJyk7CgogICRzY29wZS5wYXltZW50TWV0aG9kcyA9IHBheW1lbnRNZXRob2RzOwogICRzY29wZS5jcmVkaXRDYXJkVHlwZXMgPSBjcmVkaXRDYXJkVHlwZXM7CiAgJHNjb3BlLmNyZWRpdFRyYW5zYWN0aW9uVHlwZXMgPSBjcmVkaXRUcmFuc2FjdGlvblR5cGVzOwogICRzY29wZS5iYW5rcyA9IGJhbmtzOwogICRzY29wZS5kb2N1bWVudFR5cGVzID0gaW52b2ljZURvY3VtZW50VHlwZXMuZmlsdGVyKGZ1bmN0aW9uIChkb2MpIHsKICAgIHJldHVybiBkb2MudXNlclR5cGVzID09PSAiYWxsIiB8fCBkb2MudXNlclR5cGVzLmluY2x1ZGVzKE51bWJlcihidXNpbmVzc0NvbmZpZy5idXNpbmVzc190eXBlKSkKICB9KTsKCi8vIGluZGljYXRpb24gd2hldGhlciBwYXltZW50IG1ldGhvZCB3YXMgc2VsZWN0ZWQKICAkc2NvcGUuaXNQYXltZW50TWV0aG9kU2VsZWN0ZWQgPSBmYWxzZTsKICBmdW5jdGlvbiBwcmVQb3B1bGF0ZVBheW1lbnREZXRhaWxzKHBvc3NpYmxlTWF0Y2gsIGZpZWxkcykgewogICAgaWYgKHBvc3NpYmxlTWF0Y2gpIHsKICAgICAgZmllbGRzLmZvckVhY2goZnVuY3Rpb24gKGZpZWxkKSB7CiAgICAgICAgJHNjb3BlW2ZpZWxkXSA9IHBvc3NpYmxlTWF0Y2hbZmllbGRdCiAgICAgIH0pCiAgICB9CiAgfQoKICAkc2NvcGUucHJlZmlsbFBheW1lbnRNZXRob2QgPSBmdW5jdGlvbiAocGF5bWVudE1ldGhvZCwgcGF5bWVudHMpIHsKICAgIHZhciBmaWVsZHMgPSB7CiAgICAgICdDSEVDSyc6IFsnYmFua19jb21wYW55X2NvZGUnLCAnYmFua19icmFuY2hfbnVtYmVyJywgJ2FjY291bnRfbnVtYmVyJ10sCiAgICAgICdCQU5LX1RSQU5TRkVSJzogWydiYW5rX2NvbXBhbnlfY29kZScsICdiYW5rX2JyYW5jaF9udW1iZXInLCAnYWNjb3VudF9udW1iZXInXSwKICAgICAgJ0NSRURJVF9DQVJEJzogWydjcmVkaXRfY2FyZF90eXBlJywgJ2NyZWRpdF9jYXJkX251bWJlciddCiAgICB9W3BheW1lbnRNZXRob2QubWV0aG9kXTsKICAgIGlmIChmaWVsZHMgPT09IHVuZGVmaW5lZCkgcmV0dXJuOwogICAgdmFyIHBvc3NpYmxlTWF0Y2hlcyA9IHBheW1lbnRzCiAgICAgICAgLmZpbHRlcihmdW5jdGlvbiAocCkgewogICAgICAgICAgcmV0dXJuIHAucGF5bWVudF9tZXRob2RfbmFtZSA9PT0gcGF5bWVudE1ldGhvZC5tZXRob2QKICAgICAgICB9KQogICAgICAgIC5maWx0ZXIoZnVuY3Rpb24gKHApIHsKICAgICAgICAgIHJldHVybiBmaWVsZHMuZXZlcnkoZnVuY3Rpb24gKGZpZWxkKSB7CiAgICAgICAgICAgIHJldHVybiBwW2ZpZWxkXSAhPT0gdW5kZWZpbmVkCiAgICAgICAgICB9KQogICAgICAgIH0pCiAgICAgICAgLnNvcnQoZnVuY3Rpb24gKHAxLCBwMikgewogICAgICAgICAgdmFyIGEgPSBuZXcgRGF0ZShwMS5jcmVhdGlvbl9kYXRlKSwgYiA9IG5ldyBEYXRlKHAyLmNyZWF0aW9uX2RhdGUpOwogICAgICAgICAgcmV0dXJuIChhID4gYikgLSAoYSA8IGIpOwogICAgICAgIH0pCiAgICAgICAgLnJldmVyc2UoKTsKICAgIHByZVBvcHVsYXRlUGF5bWVudERldGFpbHMocG9zc2libGVNYXRjaGVzWzBdLCBmaWVsZHMpOwogIH07CiAgJHNjb3BlLnNlbGVjdFBheW1lbnRNZXRob2QgPSBmdW5jdGlvbihwYXltZW50KSB7CiAgICAkc2NvcGUucGF5bWVudFR5cGVUaXRsZT1wYXltZW50Lm5hbWU7CiAgICAkc2NvcGUuc2VsZWN0ZWRQYXltZW50TWV0aG9kPXBheW1lbnQ7CiAgICAkc2NvcGUuaXNQYXltZW50TWV0aG9kU2VsZWN0ZWQ9dHJ1ZTsKICAgICRzY29wZS5wcmVmaWxsUGF5bWVudE1ldGhvZChwYXltZW50LCBwYXltZW50cyk7CiAgfTsKCiAgZnVuY3Rpb24gdXBkYXRlQmFsYW5jZSAoaXNTb3VyY2VXaXRoVmF0KSB7CiAgICBpZiAoaXNTb3VyY2VXaXRoVmF0KSB7CiAgICAgICRzY29wZS5iYWxhbmNlVG9QYXlOb1ZhdCA9IE51bWJlcigoJHNjb3BlLmJhbGFuY2VUb1BheSAvICgxICsgYnVzaW5lc3NDb25maWcudmF0X3JhdGUpKS50b0ZpeGVkKDIpKTsKICAgIH0gZWxzZSB7CiAgICAgICRzY29wZS5iYWxhbmNlVG9QYXkgPSBOdW1iZXIoKCRzY29wZS5iYWxhbmNlVG9QYXlOb1ZhdCAqICgxICsgYnVzaW5lc3NDb25maWcudmF0X3JhdGUpKS50b0ZpeGVkKDIpKTsKICAgIH0KICB9CgogICRzY29wZS51cGRhdGVCYWxhbmNlID0gdXBkYXRlQmFsYW5jZTsKCiAgJHNjb3BlLm9uRG9jdW1lbnRUeXBlQ2hhbmdlZCA9IGZ1bmN0aW9uIG9uRG9jdW1lbnRUeXBlQ2hhbmdlZCgpIHsKICAgICRzY29wZS5pbnZvaWNlX2dlbmVyYXRlZCA9IE51bWJlcigkc2NvcGUuZG9jdW1lbnRfdHlwZSkgIT09IDA7CiAgfTsKCiAgJHNjb3BlLm1ha2VQYXltZW50ID0gZnVuY3Rpb24oKQogIHsKICAgIGxvZ0RlYnVnKGN1cnJlbnRDbGllbnQpOwogICAgbG9nRGVidWcoInBheW1lbnQgbWV0aG9kIik7CiAgICBsb2dEZWJ1Zygkc2NvcGUuc2VsZWN0ZWRQYXltZW50TWV0aG9kKTsKICAgIGxvZ0RlYnVnKCIkc2NvcGUuZnBheW1lbnQuaW52b2ljZV9nZW5lcmF0ZWQ9PCIrJHNjb3BlLmludm9pY2VfZ2VuZXJhdGVkKyI+Iik7CgogICAgaWYgKCgkc2NvcGUuYmFsYW5jZVRvUGF5PT0wKSB8fCAoJHNjb3BlLmJhbGFuY2VUb1BheT09JycpfHwgKCRzY29wZS5iYWxhbmNlVG9QYXk9PW51bGwpKQogICAgewogICAgICAkc2NvcGUudXNlckVycm9yPSLXkNeg15Ag15TXltefINeh15vXldedINeb15zXqdeU15UiOwogICAgfQogICAgZWxzZSBpZiAoISRzY29wZS5pc1BheW1lbnRNZXRob2RTZWxlY3RlZCkKICAgIHsKICAgICAgJHNjb3BlLnVzZXJFcnJvcj0i15DXoNeQINeR15fXqCDXkNee16bXoteZINeq16nXnNeV150iOwovLyBhbGVydCgnc3MnKTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgaWYgKCgkc2NvcGUuaW52b2ljZV9nZW5lcmF0ZWQhPTEpIHx8ICgkc2NvcGUuaW52b2ljZV9kYXRlX2Zvcm1hdD09bnVsbCkpCiAgICAgIHsKICAgICAgICB2YXIgaW52b2ljZV9kYXRlX2Zvcm1hdCA9ICJudWxsIjsKICAgICAgfQogICAgICBlbHNlCiAgICAgIHsKICAgICAgICB2YXIgaW52b2ljZV9kYXRlX2Zvcm1hdCA9ICRzY29wZS5pbnZvaWNlX2RhdGVfZm9ybWF0LmdldERhdGUoKSAgKyAiLSIgKyAoJHNjb3BlLmludm9pY2VfZGF0ZV9mb3JtYXQuZ2V0TW9udGgoKSsxKSArICItIiArICRzY29wZS5pbnZvaWNlX2RhdGVfZm9ybWF0LmdldEZ1bGxZZWFyKCk7CiAgICAgIH0KICAgICAgaWYgKGlzcGx1cykKICAgICAgewogICAgICAgIHdoYXRUb1BheT0kc2NvcGUuYmFsYW5jZVRvUGF5OwogICAgICB9CiAgICAgIGVsc2UgewogICAgICAgIHdoYXRUb1BheT0tJHNjb3BlLmJhbGFuY2VUb1BheTsKICAgICAgfQogICAgICB0aGVkYXRhPSB7CiAgICAgICAgYmFsYW5jZVRvUGF5OiB3aGF0VG9QYXksCiAgICAgICAgYmFsYW5jZVRvUGF5Tm9WYXQ6ICRzY29wZS5iYWxhbmNlVG9QYXlOb1ZhdCAqIChpc3BsdXMgPyArMSA6IC0xKSwKICAgICAgICBwYXltZW50X21ldGhvZF9uYW1lOiAkc2NvcGUuc2VsZWN0ZWRQYXltZW50TWV0aG9kLm1ldGhvZCwKICAgICAgICBpbnZvaWNlX251bWJlcjogJHNjb3BlLmludm9pY2VfbnVtYmVyLAogICAgICAgIGludm9pY2VfZ2VuZXJhdGVkOiAkc2NvcGUuaW52b2ljZV9nZW5lcmF0ZWQsCiAgICAgICAgaW52b2ljZV9kYXRlOiBpbnZvaWNlX2RhdGVfZm9ybWF0LAogICAgICAgIGJhbmtfY29tcGFueV9jb2RlOiAkc2NvcGUuYmFua19jb21wYW55X2NvZGUsCiAgICAgICAgYmFua19icmFuY2hfbnVtYmVyOiAkc2NvcGUuYmFua19icmFuY2hfbnVtYmVyLAogICAgICAgIGNoZWNrX251bWJlcjogJHNjb3BlLmNoZWNrX251bWJlciwKICAgICAgICBhY2NvdW50X251bWJlcjogJHNjb3BlLmFjY291bnRfbnVtYmVyLAogICAgICAgIGNyZWRpdF9jYXJkX251bWJlcjogJHNjb3BlLmNyZWRpdF9jYXJkX251bWJlciwKICAgICAgICBjcmVkaXRfY2FyZF90eXBlOiAkc2NvcGUuY3JlZGl0X2NhcmRfdHlwZSwKICAgICAgICBjcmVkaXRfY2FyZF90cmFuc2FjdGlvbl90eXBlOiAkc2NvcGUuY3JlZGl0X2NhcmRfdHJhbnNhY3Rpb25fdHlwZSwKICAgICAgICBpbnZvaWNlX2NvbW1lbnRzOiAkc2NvcGUuaW52b2ljZV9jb21tZW50cywKICAgICAgICBkb2N1bWVudF90eXBlOiAkc2NvcGUuZG9jdW1lbnRfdHlwZQogICAgICB9OwogICAgICAkc2NvcGUua3V6ZUlzTG9hZGluZz10cnVlOwogICAgICBjcmVhdGVQYXltZW50Rm9yQ2xpZW50KCRodHRwLCRzY29wZSxjdXJyZW50Q2xpZW50LmJ1c2luZXNzX3VzZXJfaWQsdGhlZGF0YSxjcmVhdGVQYXltZW50Rm9yQ2xpZW50X3N1Y2Nlc3MsIGNyZWF0ZVBheW1lbnRGb3JDbGllbnRfZmFpbHVyZSk7CiAgICAgIGZ1bmN0aW9uIGNyZWF0ZVBheW1lbnRGb3JDbGllbnRfc3VjY2VzcygpCiAgICAgIHsKICAgICAgICAkc2NvcGUua3V6ZUlzTG9hZGluZz1mYWxzZTsKICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgICAgICAgbG9nRGVidWcoImJyb2FkY2FzdGluZyBjbGllbnRQYWdlUmVsb2FkRGF0YSIpOwogICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2xpZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKICAgICAgICBsb2dEZWJ1ZygiYnJvYWRjYXN0aW5nIGV2ZW50UGFnZVJlbG9hZERhdGEiKTsKICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2V2ZW50UGFnZVJlbG9hZERhdGEnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKLy8gbG9nRGVidWcoImJyb2FkY2FzdGluZyByZWxvYWRFdmVudCIpOwovLyAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ3JlbG9hZEV2ZW50Jyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCiAgICAgIH0KICAgICAgZnVuY3Rpb24gY3JlYXRlUGF5bWVudEZvckNsaWVudF9mYWlsdXJlKCkKICAgICAgewogICAgICAgICRzY29wZS5rdXplSXNMb2FkaW5nPWZhbHNlOwogICAgICB9CiAgICB9CiAgfQp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ2V2ZW50RGV0YWlsc0J1c2luZXNzQ2FsZW5kYXJNb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgc2VsZWN0ZWRFdmVudCwgdWlDYWxlbmRhckNvbmZpZykgewogIHZhciBkYXlOYW1lcyA9IFsn16jXkNep15XXnycsICfXqdeg15knLCAn16nXnNeZ16nXmScsICfXqNeR15nXoteZJywgJ9eX157Xmdep15knLCAn16nXmdep15knLCAn16nXkdeqJ107CgogICRzY29wZS5nb3RvQ2xpZW50UGFnZT0gZnVuY3Rpb24gKGJ1c2luZXNVc2VyaWQpCiAgewogICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogICAgZ290b0NsaWVudFBhZ2UoYnVzaW5lc1VzZXJpZCk7CiAgfQogICRzY29wZS5lZGl0RXZlbnQ9IGZ1bmN0aW9uICh0aGVldmVudCkKICB7CiAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgnJyk7CiAgICBnb3RvRXZlbnRQYWdlKHRoZWV2ZW50KTsKICB9CgogIGxvZ0RlYnVnKCJzZWxlY3RlZCBFdmVudCBpbmZvID0iICsgSlNPTi5zdHJpbmdpZnkoc2VsZWN0ZWRFdmVudCwgbnVsbCwgMikpOwogICRzY29wZS5zZWxlY3RlZEV2ZW50ID0gc2VsZWN0ZWRFdmVudDsKICBzZWxlY3RlZERhdGVTdGFydCA9IG5ldyBEYXRlKHNlbGVjdGVkRXZlbnQuc3RhcnQpOwogIHZhciBzZWxlY3RlZERhdGVTdGFydCA9IG5ldyBEYXRlKHNlbGVjdGVkRGF0ZVN0YXJ0LmdldFRpbWUoKSArIHNlbGVjdGVkRGF0ZVN0YXJ0LmdldFRpbWV6b25lT2Zmc2V0KCkgKiA2MDAwMCk7CgogICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRIb3VycygpOwogICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcyA9IChzZWxlY3RlZERhdGVTdGFydC5nZXRNaW51dGVzKCkgPCAxMCA/ICcwJyA6ICcnKSArIHNlbGVjdGVkRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRvdyA9IGRheU5hbWVzW3NlbGVjdGVkRGF0ZVN0YXJ0LmdldERheSgpXTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRhdGUgPSBzZWxlY3RlZERhdGVTdGFydDsKCiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnREYXkgPSBzZWxlY3RlZERhdGVTdGFydC5nZXREYXRlKCk7CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRNb250aCA9IDEgKyBzZWxlY3RlZERhdGVTdGFydC5nZXRNb250aCgpOwogICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0TW9udGhUeHQgPSBtb250aE5hbWVzWyRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0TW9udGggLSAxXTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydFllYXIgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRGdWxsWWVhcigpOwoKICBzZWxlY3RlZERhdGVFbmQgPSBuZXcgRGF0ZShzZWxlY3RlZEV2ZW50LmVuZCk7CiAgdmFyIHNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKHNlbGVjdGVkRGF0ZUVuZC5nZXRUaW1lKCkgKyBzZWxlY3RlZERhdGVFbmQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKCiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMgPSBzZWxlY3RlZERhdGVFbmQuZ2V0SG91cnMoKTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRkb3cgPSBkYXlOYW1lc1tzZWxlY3RlZERhdGVFbmQuZ2V0RGF5KCldOwogICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKSA8IDEwID8gJzAnIDogJycpICsgc2VsZWN0ZWREYXRlRW5kLmdldE1pbnV0ZXMoKTsKICAkc2NvcGUub2tMaW1pdGF0aW9uTW9kYWwgPSBmdW5jdGlvbigpIHsKICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICB9OwoKICAkc2NvcGUuZGVsZXRlTGltaXRhdGlvbk1vZGFsID0gZnVuY3Rpb24oKSB7CiAgICAkdWliTW9kYWxJbnN0YW5jZS5kaXNtaXNzKCdkZWxldGUnKTsKICAgIGNhbGVuZGFyID0gJ2NhbGVuZGFyX2J1c2luZXNzJzsKCiAgICAkc2NvcGUuZGVsZXRlQ2FsZW5kYXJEQkV2ZW50KHNlbGVjdGVkRXZlbnQsIGNhbGVuZGFyKTsKICB9OwogICRzY29wZS5kZWxldGVDYWxlbmRhckpTRXZlbnQgPSBmdW5jdGlvbihjYWxlbmRhciwgc2VsZWN0ZWRFdmVudGlkKSB7CgogICAgbG9nRGVidWcoImNhbGVuZGFyX2hvdXJzX29mX3dvcmtfY29uZmlnPSIgKyB1aUNhbGVuZGFyQ29uZmlnKTsKICAgIGxvZ0RlYnVnKCJ1aUNhbGVuZGFyQ29uZmlnW2NhbGVuZGFyXT0iICsgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJ2NhbGVuZGFyX2J1c2luZXNzJ10pOwogICAgbG9nRGVidWcoImRlbGV0ZSBqcyBldmVudCAiICsgc2VsZWN0ZWRFdmVudGlkKTsKICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlbW92ZUV2ZW50cycsIFtzZWxlY3RlZEV2ZW50aWRdKTsgLy8gZ28gdG8gZGF0ZSBpbiBjYWxlbmRhciBnb3RvCiAgfTsKICAkc2NvcGUuZGVsZXRlQ2FsZW5kYXJEQkV2ZW50ID0gZnVuY3Rpb24oc2VsZWN0ZWRFdmVudCwgY2FsZW5kYXIpIHsKICAgIGxvZ0RlYnVnKCJkZWxldGUgZXZlbnQgIiArIHNlbGVjdGVkRXZlbnQuaWQpOwogICAgJGh0dHAoewogICAgICBtZXRob2Q6ICdQT1NUJywKICAgICAgdXJsOiAnL2FwaS9hZG1pbi9ldmVudHMvZGVsZXRlLycgKyBzZWxlY3RlZEV2ZW50LmlkLAogICAgICBkYXRhOiB7CiAgICAgICAgdGVtcF9saW1pdF9pZDogc2VsZWN0ZWRFdmVudC50ZW1wX2xpbWl0X2lkCiAgICAgIH0sCiAgICAgIGhlYWRlcnM6IHsKICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb247Y2hhcnNldD11dGYtOCcKICAgICAgfQogICAgfSkuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7CgogICAgICBsb2dEZWJ1ZyhkYXRhKTsKICAgICAgaWYgKCFkYXRhLnN1Y2Nlc3MpIHsKICAgICAgICBsb2dEZWJ1ZygiZGVsZXRlIGxpbWl0X2lkIGVycm9yICsiICsgZGF0YS5tZXNzYWdlKTsKLy8gaWYgbm90IHN1Y2Nlc3NmdWwsIGJpbmQgZXJyb3JzIHRvIGVycm9yIHZhcmlhYmxlcwovLwkJCSAgJHNjb3BlLmVycm9yTmFtZSA9IGRhdGEuZXJyb3JzLm5hbWU7Ci8vCQkJICAkc2NvcGUuZXJyb3JTdXBlcmhlcm8gPSBkYXRhLmVycm9ycy5zdXBlcmhlcm9BbGlhczsKICAgICAgfSBlbHNlIHsKICAgICAgICBsb2dEZWJ1ZygiZGVsZXRlIGxpbWl0X2lkIHN1Y2Nlc3MiKTsKLy8gaWYgc3VjY2Vzc2Z1bCwgYmluZCBzdWNjZXNzIG1lc3NhZ2UgdG8gbWVzc2FnZQovLwkJCSAgJHNjb3BlLm1lc3NhZ2UgPSBkYXRhLm1lc3NhZ2U7CiAgICAgICAgJHNjb3BlLmRlbGV0ZUNhbGVuZGFySlNFdmVudChjYWxlbmRhciwgc2VsZWN0ZWRFdmVudC5pZCk7CgogICAgICB9CiAgICB9KTsKCiAgICBsb2dEZWJ1ZygiYWZ0ZXIgcmVtb3ZlIGV2ZW50Iik7CiAgfTsKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2V2ZW50UmVjdXJyaW5nRGV0YWlsc0J1c2luZXNzQ2FsZW5kYXJNb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgc2VsZWN0ZWRFdmVudCwgdWlDYWxlbmRhckNvbmZpZykgewogIHZhciBkYXlOYW1lcyA9IFsn16jXkNep15XXnycsICfXqdeg15knLCAn16nXnNeZ16nXmScsICfXqNeR15nXoteZJywgJ9eX157Xmdep15knLCAn16nXmdep15knLCAn16nXkdeqJ107CgogICRzY29wZS5nb3RvQ2xpZW50UGFnZT0gZnVuY3Rpb24gKGJ1c2luZXNzVXNlcmlkKQogIHsKICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICAgIGdvdG9DbGllbnRQYWdlKGJ1c2luZXNzVXNlcmlkKTsKICB9CiAgJHNjb3BlLmVkaXRFdmVudD0gZnVuY3Rpb24gKHRoZWV2ZW50KQogIHsKICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICAgIGdvdG9FdmVudFBhZ2UodGhlZXZlbnQpOwogIH0KCgogIGxvZ0RlYnVnKCJzZWxlY3RlZCBSZWN1cnJpbmcgRXZlbnQgaW5mbyA9IiArIEpTT04uc3RyaW5naWZ5KHNlbGVjdGVkRXZlbnQsIG51bGwsIDIpKTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudCA9IHNlbGVjdGVkRXZlbnQ7CiAgc2VsZWN0ZWREYXRlU3RhcnQgPSBuZXcgRGF0ZShzZWxlY3RlZEV2ZW50LnN0YXJ0KTsKICB2YXIgc2VsZWN0ZWREYXRlU3RhcnQgPSBuZXcgRGF0ZShzZWxlY3RlZERhdGVTdGFydC5nZXRUaW1lKCkgKyBzZWxlY3RlZERhdGVTdGFydC5nZXRUaW1lem9uZU9mZnNldCgpICogNjAwMDApOwoKLy8gbG9nRGVidWcoInNlbGVjdGVkRXZlbnQuc3RhcnQ9IiArIHNlbGVjdGVkRXZlbnQuc3RhcnQpOwovLyBsb2dEZWJ1ZygiZGF0ZT0iICsgc2VsZWN0ZWREYXRlU3RhcnQpOwogICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRIb3VycygpOwogICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcyA9IChzZWxlY3RlZERhdGVTdGFydC5nZXRNaW51dGVzKCkgPCAxMCA/ICcwJyA6ICcnKSArIHNlbGVjdGVkRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRvdyA9IGRheU5hbWVzW3NlbGVjdGVkRGF0ZVN0YXJ0LmdldERheSgpXTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRhdGUgPSBzZWxlY3RlZERhdGVTdGFydDsKCiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnREYXkgPSBzZWxlY3RlZERhdGVTdGFydC5nZXREYXRlKCk7CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRNb250aCA9IDEgKyBzZWxlY3RlZERhdGVTdGFydC5nZXRNb250aCgpOwogICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0TW9udGhUeHQgPSBtb250aE5hbWVzWyRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0TW9udGggLSAxXTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydFllYXIgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRGdWxsWWVhcigpOwoKICBzZWxlY3RlZERhdGVFbmQgPSBuZXcgRGF0ZShzZWxlY3RlZEV2ZW50LmVuZCk7CiAgdmFyIHNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKHNlbGVjdGVkRGF0ZUVuZC5nZXRUaW1lKCkgKyBzZWxlY3RlZERhdGVFbmQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKCi8vIGxvZ0RlYnVnKCJzZWxlY3RlZEV2ZW50LmVuZD0iICsgc2VsZWN0ZWRFdmVudC5lbmQpOwovLyBsb2dEZWJ1ZygiZGF0ZT0iICsgc2VsZWN0ZWREYXRlRW5kKTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycyA9IHNlbGVjdGVkRGF0ZUVuZC5nZXRIb3VycygpOwogICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGRvdyA9IGRheU5hbWVzW3NlbGVjdGVkRGF0ZUVuZC5nZXREYXkoKV07CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcyA9IChzZWxlY3RlZERhdGVFbmQuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBzZWxlY3RlZERhdGVFbmQuZ2V0TWludXRlcygpOwogICRzY29wZS5va0xpbWl0YXRpb25Nb2RhbCA9IGZ1bmN0aW9uKCkgewogICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJycpOwogIH07Cgp9KTsKCmt1emVBcHAuY29udHJvbGxlcignZXZlbnREZXRhaWxzSG91cnNPZldvcmtNb2RhbENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgc2VsZWN0ZWRFdmVudCwgZml4ZWRTY2hlZHVsZSwgdWlDYWxlbmRhckNvbmZpZykgewogIHZhciBkYXlOYW1lcyA9IFsn16jXkNep15XXnycsICfXqdeg15knLCAn16nXnNeZ16nXmScsICfXqNeR15nXoteZJywgJ9eX157Xmdep15knLCAn16nXmdep15knLCAn16nXkdeqJ107CgovLyBsb2dEZWJ1Zygic2VsZWN0ZWQgRXZlbnQgPSIgKyBKU09OLnN0cmluZ2lmeShzZWxlY3RlZEV2ZW50LCBudWxsLCA0KSk7CiAgJHNjb3BlLmZpeGVkU2NoZWR1bGU9Zml4ZWRTY2hlZHVsZTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudCA9IHNlbGVjdGVkRXZlbnQ7CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQub3JpZ19ldmVudF90eXBlcyA9IGFuZ3VsYXIuY29weShzZWxlY3RlZEV2ZW50LmV2ZW50X3R5cGVzKTsKICAkc2NvcGUubmV3RXZlbnREZXRhaWxzID0gW107CgogIGdldEJ1c2luZXNzTG9jYXRpb25zKCRodHRwLCRzY29wZSwnYnVzaW5lc3NfbG9jYXRpb25zJyk7CgogIGxvZ0RlYnVnKCJob3VycyBvZiB3b3JrIGJsb2NrL2V2ZW50IGNsaWNrZWQgIitKU09OLnN0cmluZ2lmeSgkc2NvcGUuc2VsZWN0ZWRFdmVudCkpOwoKICBzZWxlY3RlZERhdGVTdGFydCA9IG5ldyBEYXRlKHNlbGVjdGVkRXZlbnQuc3RhcnQpOwogIHZhciBzZWxlY3RlZERhdGVTdGFydCA9IG5ldyBEYXRlKHNlbGVjdGVkRGF0ZVN0YXJ0LmdldFRpbWUoKSArIHNlbGVjdGVkRGF0ZVN0YXJ0LmdldFRpbWV6b25lT2Zmc2V0KCkgKiA2MDAwMCk7CiAgZ2V0QWxsSW5zdHJ1Y3RvcnMoJGh0dHAsJHNjb3BlLCdpbnN0cnVjdG9ycycpOwogIGdldE5vQ2xhc3NFdmVudFR5cGVzTm9BZG1pbigkaHR0cCwkc2NvcGUsJ3JlbGF0ZWRFdmVudFR5cGVzJyxnZXROb0NsYXNzRXZlbnRUeXBlc05vQWRtaW5fc3VjY2Vzcyk7CiAgZnVuY3Rpb24gZ2V0Tm9DbGFzc0V2ZW50VHlwZXNOb0FkbWluX3N1Y2Nlc3MoKQogIHsKICAgIGZvcih2YXIgaSA9IDA7IGkgPCAkc2NvcGUuc2VsZWN0ZWRFdmVudC5ldmVudF90eXBlcy5sZW5ndGg7IGkrKykKICAgIHsKLy8gY29weWluZyB0aGUgYWN0dWFsIG9iamVjdCBvZiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5ldmVudF90eXBlc1tpXQogICAgICBmb3IodmFyIGogPSAwOyBqIDwgJHNjb3BlLnJlbGF0ZWRFdmVudFR5cGVzLmxlbmd0aDsgaisrKQogICAgICB7CiAgICAgICAgaWYgKCRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50X3R5cGVzW2ldLmV2ZW50X3R5cGVfaWQ9PSRzY29wZS5yZWxhdGVkRXZlbnRUeXBlc1tqXS5ldmVudF90eXBlX2lkKQogICAgICAgIHsKICAgICAgICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50X3R5cGVzW2ldPWFuZ3VsYXIuY29weSgkc2NvcGUucmVsYXRlZEV2ZW50VHlwZXNbal0pOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KCi8vIGxvZ0RlYnVnKCJzZWxlY3RlZEV2ZW50LnN0YXJ0PSIgKyBzZWxlY3RlZEV2ZW50LnN0YXJ0KTsKLy8gbG9nRGVidWcoImRhdGU9IiArIHNlbGVjdGVkRGF0ZVN0YXJ0KTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0SG91cnMoKTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMgPSAoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBzZWxlY3RlZERhdGVTdGFydC5nZXRNaW51dGVzKCk7CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkb3cgPSBkYXlOYW1lc1tzZWxlY3RlZERhdGVTdGFydC5nZXREYXkoKV07CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXRlID0gc2VsZWN0ZWREYXRlU3RhcnQ7CgogIHNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKHNlbGVjdGVkRXZlbnQuZW5kKTsKICB2YXIgc2VsZWN0ZWREYXRlRW5kID0gbmV3IERhdGUoc2VsZWN0ZWREYXRlRW5kLmdldFRpbWUoKSArIHNlbGVjdGVkRGF0ZUVuZC5nZXRUaW1lem9uZU9mZnNldCgpICogNjAwMDApOwoKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoID0gbW9udGhOYW1lc1tzZWxlY3RlZERhdGVTdGFydC5nZXRNb250aCgpXTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoMTEyID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TW9udGgoKSsxOwogICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aCA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldERhdGUoKTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXIgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRGdWxsWWVhcigpOwovLyAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWVfaW5wdXRfZm9ybWF0PSBuZXcgRGF0ZSgxOTcwLCAwLCAxLCAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzLCAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMsIDApOwoKLy8gbG9nRGVidWcoInNlbGVjdGVkRXZlbnQuZW5kPSIgKyBzZWxlY3RlZEV2ZW50LmVuZCk7Ci8vIGxvZ0RlYnVnKCJkYXRlPSIgKyBzZWxlY3RlZERhdGVFbmQpOwogICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzID0gc2VsZWN0ZWREYXRlRW5kLmdldEhvdXJzKCk7CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kZG93ID0gZGF5TmFtZXNbc2VsZWN0ZWREYXRlRW5kLmdldERheSgpXTsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzID0gKHNlbGVjdGVkRGF0ZUVuZC5nZXRNaW51dGVzKCkgPCAxMCA/ICcwJyA6ICcnKSArIHNlbGVjdGVkRGF0ZUVuZC5nZXRNaW51dGVzKCk7CgoKICAkc2NvcGUub2tMaW1pdGF0aW9uTW9kYWwgPSBmdW5jdGlvbigpIHsKICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICB9OwoKICAkc2NvcGUudXBkYXRlTGltaXRhdGlvbk1vZGFsID0gZnVuY3Rpb24oKQogIHsKICAgIGxvZ0RlYnVnKCJmdW5jdGlvbjogdXBkYXRlTGltaXRhdGlvbk1vZGFsIik7CiAgICBpZiAoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRfdHlwZXMubGVuZ3RoPDEpCiAgICB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vyczwkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKQogICAgewogICAgICBhbGVydCgi15bXntefINeh15nXldedINec16TXoNeZINeW157XnyDXlNeq15fXnNeUIik7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vycz09JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycykKICAgIHsKICAgICAgaWYgKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXM8PSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcykKICAgICAgewogICAgICAgIGFsZXJ0KCLXltee158g16HXmdeV150g15zXpNeg15kg15bXntefINeU16rXl9ec15QiKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgaWYgKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXM8KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcysxMCkpCiAgICAgIHsKICAgICAgICBhbGVydCgi15HXnNeV16cg16fXmNefINeeLTEwINeT16fXldeqIik7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9CgoKICAgIGZ1bmN0aW9uIHVwZGF0ZUNhbGVuZGFyTGltaXRhdGlvbl9zdWNjZXNzKCkKICAgIHsKICAgICAgY2FsZW5kYXIgPSAnY2FsZW5kYXJfaG91cnNfb2Zfd29yayc7CiAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsgLy8gZ28gdG8gZGF0ZSBpbiBjYWxlbmRhciBnb3RvCiAgICAgICR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoJ2RlbGV0ZScpOwogICAgfQoKICAgIGlmICgkc2NvcGUuZml4ZWRTY2hlZHVsZSkKICAgIHsKLy8gZml4ZWQgc2NoZWR1bGUgLSB1cGFkdGluZyBsaW1pdGF0aW9uIDE5NzAKICAgICAgdGhlZGF0YSA9IHsKICAgICAgICBzdGFydF9kYXRlOiBuZXdfc3RhcnQsCiAgICAgICAgZW5kX2RhdGU6IG5ld19lbmQsCiAgICAgICAgdGVtcF9saW1pdF9pZDogbnVsbCwKICAgICAgICBsaW1pdF9pZDogJHNjb3BlLnNlbGVjdGVkRXZlbnQubGltaXRfaWQsCiAgICAgICAgZXZlbnRfdHlwZXM6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmV2ZW50X3R5cGVzLAogICAgICAgIGxvY2F0aW9uX2lkOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5sb2NhdGlvbl9pZCwKICAgICAgICBvcmlnX2V2ZW50X3R5cGVzOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5vcmlnX2V2ZW50X3R5cGVzLAogICAgICAgIGVtcF9pZDogJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW1wX2lkCiAgICAgIH07CiAgICAgIHVwZGF0ZUNhbGVuZGFyTGltaXRhdGlvbigkaHR0cCwkc2NvcGUsdGhlZGF0YSwkc2NvcGUuc2VsZWN0ZWRFdmVudC5saW1pdF9pZCwgdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uX3N1Y2Nlc3MpOwogICAgfQogICAgZWxzZQovLyBub3QgZml4ZWQgc2NoZWR1bGUgLSBwZXJkYXkgYmxvY2sKICAgIHsKLy8vLy8vLy8vLy8KICAgICAgaWYgKCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5saW1pdF9pZCAhPSBudWxsKSAmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5kYXlfbGltaXRfaWQgPT0gLTEpKSAvLyBldmVudCBsaW1pdGF0aW9uIGhhcyBsaW1pdF9pZCBzbyBpdHMgYW4gMTk3MCBldmVudAovLyBuZWVkIHRvIGFkZCBhIG5ldyBwZXJkYXkgbGltaXRhdGlvbiB0aGF0IHBvaW50IChsaW1pdF9pZCkgdG8gdGhlIG9sZCAxOTcwIGV2ZW50IHRvIHJlcGxhY3RlIGl0CiAgICAgIHsKICAgICAgICB0ZW1wX2xpbWl0X2lkID0gY2FsY190ZW1wX2xpbWl0X2lkKCk7Ci8vIHRoZWV2ZW50LnRlbXBfbGltaXRfaWQgPSB0ZW1wX2xpbWl0X2lkOwovLyB0aGVldmVudC5kYXlfbGltaXRfaWQgPSB0ZW1wX2xpbWl0X2lkOwovLyB0aGUgbW92ZWQgZXZlbnQgaW4gdGhlIGNhbGVuZGFyIG5vdyBoYXMgZGF5X2xpbWl0X2lkIGFuZCB0ZW1wX2xpbWl0X2lkCi8vIGlmIGl0cyBsb2FkZWQgZnJvbSB0aGUgZGIsIGl0IHdpbGwgb25seSBoYXZlIGRheV9saW1pdF9pZCAoYW5kIG5vdCB0aGUgdGVtcCBvbmUpCi8vIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWydjYWxlbmRhcl9ob3Vyc19vZl93b3JrJ10uZnVsbENhbGVuZGFyKCd1cGRhdGVFdmVudCcsIHRoZWV2ZW50KTsKLy8gY29uc29sZS5sb2coIlhYWFhYWFhYWFhYWFgiKTsKICAgICAgICB0aGVkYXRhID0gewogICAgICAgICAgc3RhcnRfZGF0ZTogbmV3X3N0YXJ0LAogICAgICAgICAgZW5kX2RhdGU6IG5ld19lbmQsCiAgICAgICAgICBjb2xvcjogJycsCiAgICAgICAgICB0ZW1wX2xpbWl0X2lkOiAwLAogICAgICAgICAgZXZlbnRfdHlwZV9pZDogJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRfdHlwZV9pZCwKICAgICAgICAgIGV2ZW50X3R5cGVzOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5ldmVudF90eXBlcywKICAgICAgICAgIGxpbWl0X2lkOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5pZCwKICAgICAgICAgIGxvY2F0aW9uX2lkOiAkc2NvcGUuc2VsZWN0ZWRFdmVudC5sb2NhdGlvbl9pZCwKICAgICAgICAgIGVtcF9pZDogJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW1wX2lkCi8vIHRpdGxlOiB0aGVldmVudC50aXRsZQogICAgICAgIH07CiAgICAgICAgY3JlYXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5KCRodHRwLCRzY29wZSx0aGVkYXRhLHVwZGF0ZUNhbGVuZGFyTGltaXRhdGlvbl9zdWNjZXNzKTsKCiAgICAgIH0KICAgICAgZWxzZQogICAgICB7CiAgICAgICAgdGhlZGF0YT0gewogICAgICAgICAgc3RhcnRfZGF0ZTogbmV3X3N0YXJ0LAogICAgICAgICAgZW5kX2RhdGU6IG5ld19lbmQsCiAgICAgICAgICB0ZW1wX2RheV9saW1pdF9pZDogJHNjb3BlLnNlbGVjdGVkRXZlbnQudGVtcF9saW1pdF9pZCwKICAgICAgICAgIG9yaWdfZXZlbnRfdHlwZXM6ICRzY29wZS5zZWxlY3RlZEV2ZW50Lm9yaWdfZXZlbnRfdHlwZXMsCiAgICAgICAgICBldmVudF90eXBlczogJHNjb3BlLnNlbGVjdGVkRXZlbnQuZXZlbnRfdHlwZXMsCiAgICAgICAgICBsb2NhdGlvbl9pZDogJHNjb3BlLnNlbGVjdGVkRXZlbnQubG9jYXRpb25faWQsCiAgICAgICAgICBkYXlfbGltaXRfaWQ6ICRzY29wZS5zZWxlY3RlZEV2ZW50LmRheV9saW1pdF9pZCwKICAgICAgICAgIGVtcF9pZDogJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW1wX2lkCiAgICAgICAgfTsKICAgICAgICB1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXkoJGh0dHAsJHNjb3BlLHRoZWRhdGEsdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uX3N1Y2Nlc3MpOwogICAgICB9CiAgICB9CiAgfQogICRzY29wZS5kZWxldGVMaW1pdGF0aW9uTW9kYWwgPSBmdW5jdGlvbigpIHsKICAgIGNhbGVuZGFyID0gJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnOwoKLy8gcmVtb3ZpbmcgbGltaXRhdGlvbiBmcm9tIGRhdGFiYXNlLCBpZiB0cnVlIC0gcmVtb3ZpbmcgZnJvbSBkaXNwbGF5IGFsc28KICAgIGlmICgkc2NvcGUuZGVsZXRlQ2FsZW5kYXJEQkxpbWl0YXRpb25FdmVudChzZWxlY3RlZEV2ZW50KSkKICAgIHsKLy8gJHNjb3BlLmRlbGV0ZUNhbGVuZGFySlNFdmVudChjYWxlbmRhciwgc2VsZWN0ZWRFdmVudC5pZCk7CiAgICB9CiAgICAkdWliTW9kYWxJbnN0YW5jZS5kaXNtaXNzKCdkZWxldGUnKTsKICB9OwogICRzY29wZS5kZWxldGVDYWxlbmRhckpTRXZlbnQgPSBmdW5jdGlvbihjYWxlbmRhciwgc2VsZWN0ZWRFdmVudGlkKSB7CgogICAgbG9nRGVidWcoImNhbGVuZGFyX2hvdXJzX29mX3dvcmtfY29uZmlnPSIgKyB1aUNhbGVuZGFyQ29uZmlnKTsKICAgIGxvZ0RlYnVnKCJ1aUNhbGVuZGFyQ29uZmlnW2NhbGVuZGFyXT0iICsgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnXSk7CiAgICBsb2dEZWJ1ZygiZGVsZXRlIGpzIGV2ZW50ICIgKyBzZWxlY3RlZEV2ZW50aWQpOwogICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVtb3ZlRXZlbnRzJywgW3NlbGVjdGVkRXZlbnRpZF0pOyAvLyBnbyB0byBkYXRlIGluIGNhbGVuZGFyIGdvdG8KICB9OwogICRzY29wZS5kZWxldGVDYWxlbmRhckRCTGltaXRhdGlvbkV2ZW50ID0gZnVuY3Rpb24oc2VsZWN0ZWRFdmVudCkgewogICAgY2FsZW5kYXIgPSAnY2FsZW5kYXJfaG91cnNfb2Zfd29yayc7Ci8vIHJldHVybiBmYWxzZTsKCi8vIGRlbGV0aW5nIGV2ZW50IGxpbWl0YXRpb24gKG5vdCBwZXIgZGF5KQovLyBlaXRoZXIgZnJvbSAxOTcwIChob3Vyc19vZl93b3JrIHBhZ2UpCi8vIG9yIGZyb20gdGhlaXIgaW5zdGFuY2UgaW4gdGhlIGN1cnJlbnQgd2VlaydzIGxpbWl0YXRpb24uCi8vIGVpdGhlciB3YXkgZGF5X2xpbWl0X2lkIGlzIC0xIGZvciBsaW1pdGF0aW9ucyBmcm9tIDE5NzAKICAgIGlmIChzZWxlY3RlZEV2ZW50LmRheV9saW1pdF9pZCA9PSAtMSkKICAgIHsKICAgICAgbG9nRGVidWcoInJlbW92aW5nIGV2ZW50IGxpbWl0YXRpb24sIGNoZWNraWduIGlmIGl0cyBpbiAxOTcwICh0aGUgb3JpZ2luYWwpIG9yIGFuIGluc3RhbmNlIGluIHByZXNlbnQiKTsKICAgICAgc2VsZWN0ZWREYXRlU3RhcnQgPSBuZXcgRGF0ZShzZWxlY3RlZEV2ZW50LnN0YXJ0KTsKLy8gaWYgaXRzIDE5NzAgdGhpcyBtZWFucyB3ZSdyZSBpbiB0aGUgaG91cnNfb2Zfd29yayBnZW5lcmFsIHBhZ2UKLy8gc28gd2Ugc2ltcGx5IGRlbGV0ZSBpdAogICAgICBpZiAoc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSA9PSAxOTcwKQogICAgICB7CiAgICAgICAgbG9nRGVidWcoInJlbW92aW5nIGV2ZW50IGxpbWl0YXRpb24gZnJvbSAxOTcwIik7CiAgICAgICAgdGhlZGF0YT0gewogICAgICAgICAgdGVtcF9saW1pdF9pZDogc2VsZWN0ZWRFdmVudC50ZW1wX2xpbWl0X2lkCiAgICAgICAgfTsKICAgICAgICBkZWxldGVDYWxlbmRhckxpbWl0YXRpb24oJGh0dHAsJHNjb3BlLHRoZWRhdGEsc2VsZWN0ZWRFdmVudC5saW1pdF9pZCwgZGVsZXRlQ2FsZW5kYXJMaW1pdGF0aW9uX3N1Y2Nlc3MpOwogICAgICAgIGZ1bmN0aW9uIGRlbGV0ZUNhbGVuZGFyTGltaXRhdGlvbl9zdWNjZXNzKCkKICAgICAgICB7CiAgICAgICAgICAkc2NvcGUuZGVsZXRlQ2FsZW5kYXJKU0V2ZW50KGNhbGVuZGFyLCBzZWxlY3RlZEV2ZW50LmlkKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZWxzZQogICAgICB7Ci8vIHJlbW92aW5nIGV2ZW50IGxpbWl0YXRpb24gZnJvbSB0aGUgYSBzcGVjaWZpYyB3ZWVrCi8vIHRoaXMgbWVhbnMgYWRkaW5nIGV2ZW50IGxpbWl0YXRpb24gcGVyIGRheSB3aXRoIHJhbmdlIGVuZD1zdGFydAovLyBtYXliZSBCVUcgQlVHR1k/CiAgICAgICAgbG9nRGVidWcoInggcmVtb3ZpbmcgZXZlbnQgbGltaXRhdGlvbiBmcm9tIGEgc3BlY2lmaWMgd2VlaywgdGhpcyBtZWFucyBhZGRpbmcgZXZlbnQgbGltaXRhdGlvbiBwZXIgZGF5IHdpdGggcmFuZ2UgMC0wIik7Ci8vIGxvZ0RlYnVnKEpTT04uc3RyaW5naWZ5KHNlbGVjdGVkRXZlbnQpKTsKCiAgICAgICAgdGhlZGF0YSA9IHsKICAgICAgICAgIHN0YXJ0X2RhdGU6IHNlbGVjdGVkRXZlbnQuc3RhcnQsCiAgICAgICAgICBlbmRfZGF0ZTogc2VsZWN0ZWRFdmVudC5zdGFydCwKICAgICAgICAgIGNvbG9yOiAiIzAwMDAwMCIsCiAgICAgICAgICB0ZW1wX2xpbWl0X2lkOiAxLAogICAgICAgICAgZXZlbnRfdHlwZV9pZDogc2VsZWN0ZWRFdmVudC5ldmVudF90eXBlX2lkLAogICAgICAgICAgbG9jYXRpb25faWQ6IHNlbGVjdGVkRXZlbnQubG9jYXRpb25faWQsCiAgICAgICAgICBsaW1pdF9pZDogc2VsZWN0ZWRFdmVudC5saW1pdF9pZCwKICAgICAgICAgIHRpdGxlOiBzZWxlY3RlZEV2ZW50LnRpdGxlCiAgICAgICAgfTsKCiAgICAgICAgY3JlYXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5KCRodHRwLCRzY29wZSx0aGVkYXRhLGNyZWF0ZUNhbGVuZGFyTGltaXRhdGlvblBlckRheV9zdWNjZXNzKTsKICAgICAgICBmdW5jdGlvbiBjcmVhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXlfc3VjY2VzcygpCiAgICAgICAgewogICAgICAgICAgJHNjb3BlLmRlbGV0ZUNhbGVuZGFySlNFdmVudChjYWxlbmRhciwgc2VsZWN0ZWRFdmVudC5pZCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBlbHNlCiAgICB7Ci8vIGRlbGV0aW5nIGEgcGVyZGF5IGxpbWl0YXRpb24uCi8vIGlmIGl0J3MgYSBwZXJkYXkgdGhhdCAicmVwbGFjZWQiIGEgMTk3MCBvbmUKLy8gdGhlbiB3ZSBjYW5ub3QgZGVsZXRlIGl0IChvdGhlcndpc2UgdGhlIG9yaWdpbmFsIDE5NzAgd2lsbCByZWFwcGVhcikKLy8gc28gd2Ugc2V0IGl0IHRvIHN0YXJ0PWVuZAovLyB0aGlzIG1heWJlIGEgQlVHIGFuZCBjYXVzZSBUUk9VQkxFIC8vIFRPRE8KLy8gb3RoZXdpc2Ugd2UgY2FuIGRlbGV0ZSBpdCAtIHRoZSBwZXJkYXkgLSBhcyBpdHMgYSBuZXcgcGVyZGF5IGFuZCBub3QgInJlcGxhY2luZyIgYSAxOTcwIG9uZQoKICAgICAgaWYgKHNlbGVjdGVkRXZlbnQubGltaXRfaWQgIT0gbnVsbCkgLy8gdGhpcyBpcyB0aGUgcGVyZGF5IHRoYXQgcmVwbGFjZXMgYSAxOTcwIG9uZSAtIHdlIHNldCBpdCB0byBzdGFydD1lbmQKICAgICAgewogICAgICAgIGxvZ0RlYnVnKCJyZW1vdmluZyBldmVudCBsaW1pdGF0aW9uIHBlciBkYXkgcmVsYXRlZCB0byAxOTcwICh1cGRhdGluZyBpdCB0byBzdGFydD1lbmQpIik7CgogICAgICAgIHRoZWRhdGE9IHsKICAgICAgICAgIHN0YXJ0X2RhdGU6IHNlbGVjdGVkRXZlbnQuc3RhcnQsCiAgICAgICAgICBlbmRfZGF0ZTogc2VsZWN0ZWRFdmVudC5zdGFydCwKICAgICAgICAgIHRlbXBfZGF5X2xpbWl0X2lkOiBzZWxlY3RlZEV2ZW50LnRlbXBfbGltaXRfaWQsCiAgICAgICAgICBkYXlfbGltaXRfaWQ6IHNlbGVjdGVkRXZlbnQuZGF5X2xpbWl0X2lkCiAgICAgICAgfTsKICAgICAgICB1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXkoJGh0dHAsJHNjb3BlLHRoZWRhdGEsdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5X3N1Y2Nlcyk7CgogICAgICAgIGZ1bmN0aW9uIHVwZGF0ZUNhbGVuZGFyTGltaXRhdGlvblBlckRheV9zdWNjZXMoKQogICAgICAgIHsKICAgICAgICAgICRzY29wZS5kZWxldGVDYWxlbmRhckpTRXZlbnQoY2FsZW5kYXIsIHNlbGVjdGVkRXZlbnQuaWQpOwogICAgICAgIH0KICAgICAgfQogICAgICBlbHNlICAvLyB0aGlzIGlzIHRoZSBjYXNlIHdoZXJlIHRoZSBwZXJkYXkgZG9lc250IHJlcGxhY2UgYSAxOTcwIG9uZSwgd2UgY2FuIHNpbXBseSBkZWxldGUgaXQKICAgICAgewogICAgICAgIGxvZ0RlYnVnKCJyZW1vdmluZyBldmVudCBsaW1pdGF0aW9uIHBlciBkYXkgcmVsYXRlZCBub3QgcmVsYXRlZCB0byAxOTcwIChzbyB3ZSdyZSBkZWxldGluZyBpdCkiKTsKICAgICAgICB0aGVkYXRhID0gewogICAgICAgICAgdGVtcF9saW1pdF9pZDogc2VsZWN0ZWRFdmVudC50ZW1wX2xpbWl0X2lkCiAgICAgICAgfTsKICAgICAgICBkZWxldGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXkoJGh0dHAsJHNjb3BlLHRoZWRhdGEsc2VsZWN0ZWRFdmVudC5kYXlfbGltaXRfaWQsIGRlbGV0ZUNhbGVuZGFyTGltaXRhdGlvblBlckRheV9zdWNjZXNzKTsKICAgICAgICBmdW5jdGlvbiBkZWxldGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXlfc3VjY2VzcygpCiAgICAgICAgewogICAgICAgICAgJHNjb3BlLmRlbGV0ZUNhbGVuZGFySlNFdmVudChjYWxlbmRhciwgc2VsZWN0ZWRFdmVudC5pZCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBsb2dEZWJ1ZygiYWZ0ZXIgcmVtb3ZlIGV2ZW50Iik7CgogIH07CgoKICAkc2NvcGUuc3RhcnRNaW51dGVzID0gZnVuY3Rpb24oKQogIHsKICAgIGxvZ0RlYnVnKCJzdGFydE1pbnV0ZXMgIisoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKSk7CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXM9bWludXRlc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKTsKICAgIGNhbGN1bGF0ZVN0YXJ0VGltZSgpOwogIH0KICAkc2NvcGUuc3RhcnRIb3VycyA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1Zygic3RhcnRIb3VycyAiK2hvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKSk7CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzPWhvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKTsKICAgIGNhbGN1bGF0ZVN0YXJ0VGltZSgpOwogIH0KICAkc2NvcGUuZW5kTWludXRlcyA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1ZygiZW5kTWludXRlcyAiKygkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzKSk7CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzPW1pbnV0ZXNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpOwogICAgY2FsY3VsYXRlRW5kVGltZSgpOwogIH0KICAkc2NvcGUuZW5kSG91cnMgPSBmdW5jdGlvbigpCiAgewogICAgbG9nRGVidWcoImVuZEhvdXJzICIraG91cnNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzKSk7CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3Vycz1ob3Vyc0NoYW5nZWQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMpOwogICAgY2FsY3VsYXRlRW5kVGltZSgpOwogIH0KCgogIGZ1bmN0aW9uIGNhbGN1bGF0ZVN0YXJ0VGltZSgpCiAgewogICAgZXZlbnRZZWFyPSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0eWVhcjsKICAgIGV2ZW50TW9udGg9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aDExMjsKICAgIGV2ZW50RGF5PSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aDsKICAgIGlmIChwYXJzZUludChldmVudE1vbnRoKTwxMCkKICAgIHsKICAgICAgZXZlbnRNb250aD0iMCIrZXZlbnRNb250aDsKICAgIH0KICAgIGlmIChwYXJzZUludChldmVudERheSk8MTApCiAgICB7CiAgICAgIGV2ZW50RGF5PSIwIitldmVudERheTsKICAgIH0KCiAgICBuZXdfc3RhcnQ9bW9tZW50LnV0YyhldmVudFllYXIrIi0iK2V2ZW50TW9udGgrIi0iK2V2ZW50RGF5KyJUMDA6MDA6MDAiKS5hZGQoKChwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKSo2MCkrcGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKSksICdtaW51dGVzJyk7CiAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWU9bmV3X3N0YXJ0OwogICAgbG9nRGVidWcoIm5ld19zdGFydD0iK25ld19zdGFydCk7CiAgfQogIGZ1bmN0aW9uIGNhbGN1bGF0ZUVuZFRpbWUoKQogIHsKICAgIGV2ZW50WWVhcj0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXI7CiAgICBldmVudE1vbnRoPSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bW9udGgxMTI7CiAgICBldmVudERheT0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGRheW9mbW9udGg7CiAgICBpZiAocGFyc2VJbnQoZXZlbnRNb250aCk8MTApCiAgICB7CiAgICAgIGV2ZW50TW9udGg9IjAiK2V2ZW50TW9udGg7CiAgICB9CiAgICBpZiAocGFyc2VJbnQoZXZlbnREYXkpPDEwKQogICAgewogICAgICBldmVudERheT0iMCIrZXZlbnREYXk7CiAgICB9CgogICAgbmV3X2VuZD1tb21lbnQudXRjKGV2ZW50WWVhcisiLSIrZXZlbnRNb250aCsiLSIrZXZlbnREYXkrIlQwMDowMDowMCIpLmFkZCgoKHBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzKSo2MCkrcGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcykpLCAnbWludXRlcycpOwogICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmRfdGltZT1uZXdfZW5kOwogICAgbG9nRGVidWcoIm5ld19lbmQ9IituZXdfZW5kKTsKICB9CgogIGNhbGN1bGF0ZVN0YXJ0VGltZSgpOwogIGNhbGN1bGF0ZUVuZFRpbWUoKTsKCiAgZnVuY3Rpb24gbWludXRlc0NoYW5nZWQodGhlbWludXRlcykKICB7CiAgICBsb2dEZWJ1ZygidGhlbWludXRlcz0iK3RoZW1pbnV0ZXMpOwogICAgaWYgKHR5cGVvZiB0aGVtaW51dGVzPT0idW5kZWZpbmVkIikKICAgIHsKICAgICAgcmV0dXJuICIwMCI7CiAgICB9CiAgICB0aGVtaW51dGVzPXBhcnNlSW50KHRoZW1pbnV0ZXMpOwogICAgaWYgKHRoZW1pbnV0ZXM+NjApCiAgICB7CiAgICAgIHJldHVybiAiMDAiOwogICAgfQogICAgZWxzZSBpZiAodGhlbWludXRlczwwKQogICAgewogICAgICByZXR1cm4gIjAwIjsKICAgIH0KICAgIGVsc2UgaWYgKHRoZW1pbnV0ZXM9PSIiKQogICAgewogICAgICByZXR1cm4gIjAwIjsKICAgIH0KICAgIGVsc2UgaWYgKHRoZW1pbnV0ZXM8MTApCiAgICB7CiAgICAgIHJldHVybiAiMCIrdGhlbWludXRlczsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgcmV0dXJuIHRoZW1pbnV0ZXM7CiAgICB9CiAgfQogIGZ1bmN0aW9uIGhvdXJzQ2hhbmdlZCh0aGVob3VycykKICB7CiAgICBsb2dEZWJ1ZygidGhlaG91cnM9Iit0aGVob3Vycyk7CiAgICBpZiAodHlwZW9mIHRoZWhvdXJzPT0idW5kZWZpbmVkIikKICAgIHsKICAgICAgcmV0dXJuICIwIjsKICAgIH0KICAgIHRoZWhvdXJzPXBhcnNlSW50KHRoZWhvdXJzKTsKICAgIGlmICh0aGVob3Vycz4yNCkKICAgIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CiAgICBlbHNlIGlmICh0aGVob3VyczwwKQogICAgewogICAgICByZXR1cm4gMDsKICAgIH0KICAgIGVsc2UgaWYgKHRoZWhvdXJzPT0iIikKICAgIHsKICAgICAgcmV0dXJuICIwIjsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgcmV0dXJuIHRoZWhvdXJzOwogICAgfQogIH0KCn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignRXZlbnRUeXBlc0NvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkY29tcGlsZSwgdWlDYWxlbmRhckNvbmZpZywgJHVpYk1vZGFsLCRsb2NhdGlvbikgewogIGxvZ0RlYnVnKCdFdmVudFR5cGVzIENvbnRyb2xsZXInKTsKCiAgZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzKCRodHRwLCRzY29wZSwnZXZlbnRfdHlwZXMnKTsKICAkc2NvcGUuc2hvd0V2ZW50VHlwZSA9IGZ1bmN0aW9uICh0aGVFdmVudCkKICB7CiAgICAkbG9jYXRpb24ucGF0aCgnL2V2ZW50X3R5cGVzLycrdGhlRXZlbnQuZXZlbnRfdHlwZV9pZCk7CiAgfQp9KTsKCmt1emVBcHAuY29udHJvbGxlcignRXZlbnRUeXBlTmV3Q29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRjb21waWxlLCB1aUNhbGVuZGFyQ29uZmlnLCAkdWliTW9kYWwsICRsb2NhdGlvbikgewogIGxvZ0RlYnVnKCdFdmVudFR5cGVzIENvbnRyb2xsZXIgTmV3Jyk7CgogICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzID0ge307IC8vIHRoZXNlIGFyZSB0aGUgY29tcGxldGUgZGV0YWlscyBmb3IgdGhlIG5ldyBldmVudCAvLwogICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmlzX2NsYXNzID0gMDsKICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5ibG9ja0V4dHJhVGltZSA9IGZhbHNlOwogICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmR1cmF0aW9uX2JlZm9yZV9ldmVudCA9IDA7CiAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZHVyYXRpb25fYWZ0ZXJfZXZlbnQgPSAwOwogICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmluaGVyaXRfbWFpbl9ob3VycyA9IDE7CiAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMubWF4X3dhaXRpbmdfbGlzdCA9IDM7CiAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuaXNfdXBkYXRlID0gZmFsc2U7CiAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMubWF4X3BhcnRpY2lwYW50cyA9IDE7CiAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMubWF4X3JlZ2lzdHJhdGlvbnM9MTsKICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5pc19wdWJsaWM9MTsKICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5pbnN0cnVjdG9yX2lkPTA7CgogICRzY29wZS5ldmVudENvbG9yU3R5bGUgPSB7fTsKICBkZWZhdWx0Q29sb3IgPSAnMDBhNjVhJzsKICAkc2NvcGUuZXZlbnRDb2xvclN0eWxlW2RlZmF1bHRDb2xvcl0gPSB7CiAgICAndHJhbnNmb3JtJzogJ3JvdGF0ZSgzMGRlZyknCiAgfTsKICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5ldmVudENvbG9yID0gIiMiICsgZGVmYXVsdENvbG9yOwogICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzID0gWwogICAgeyJmaWVsZF9uYW1lIjoi16HXmdeb15XXnSDXntek15LXqSIsImZpZWxkX2RhdGF0eXBlIjoiVEVYVF9BUkVBIiwiaXNfbWFuZGF0b3J5IjowLCAiZnJvbWRiIjogZmFsc2UsICJkYl9pZF90b2ZpeCI6IDAsICJpc19hY3RpdmUiOiAxLCAibW9kaWZpZWQiOiBmYWxzZX0sCiAgICB7ImZpZWxkX25hbWUiOiLXqdeZ16LXldeo15kg15HXmdeqIiwiZmllbGRfZGF0YXR5cGUiOiJURVhUX0FSRUEiLCJpc19tYW5kYXRvcnkiOjAsICJmcm9tZGIiOiBmYWxzZSwgImRiX2lkX3RvZml4IjogMCwgImlzX2FjdGl2ZSI6IDEsICJtb2RpZmllZCI6IGZhbHNlfQogIF07CgogIGdldEFsbEluc3RydWN0b3JzKCRodHRwLCRzY29wZSwnaW5zdHJ1Y3RvcnMnLGdldEFsbEluc3RydWN0b3JzX3N1Y2Nlc3MpOwogIGZ1bmN0aW9uIGdldEFsbEluc3RydWN0b3JzX3N1Y2Nlc3MoKQogIHsKLy8gJHNjb3BlLmluc3RydWN0b3JzLnVuc2hpZnQoe2J1c2luZXNzX3VzZXJfaWQ6MCwgYnVzZXJfZmlyc3RfbmFtZToiIiwgYnVzZXJfbGFzdF9uYW1lOiIifSk7CiAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5pbnN0cnVjdG9yX2lkPSRzY29wZS5pbnN0cnVjdG9yc1swXS5idXNpbmVzc191c2VyX2lkOwogIH0KCiAgJHNjb3BlLmV2ZW50VHlwZUV4dHJhRmllbGRzUG9wID0gZnVuY3Rpb24oZXZlbnRUeXBlUHJvcGVydGllcykgewogICAgbG9nRGVidWcoImV2ZW50VHlwZUV4dHJhRmllbGRzUG9wMSIpOwoKICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewogICAgICBhbmltYXRpb246IGZhbHNlLAogICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9ldmVudF90eXBlX2V4dHJhX2ZpZWxkcy5waHAnLAogICAgICBjb250cm9sbGVyOiAnZXZlbnRUeXBlRXh0cmFGaWVsZHNNb2RhbENvbnRyb2xsZXInLAogICAgICBzaXplOiAnbCcsCiAgICAgIHJlc29sdmU6IHsKICAgICAgICBldmVudFR5cGVQcm9wZXJ0aWVzOiBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiBldmVudFR5cGVQcm9wZXJ0aWVzOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CgogICAgbW9kYWxJbnN0YW5jZS5yZXN1bHQudGhlbihmdW5jdGlvbihzZWxlY3RlZEl0ZW0pIHsKICAgICAgbG9nRGVidWcoc2VsZWN0ZWRJdGVtKTsKICAgICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMgPSBzZWxlY3RlZEl0ZW07CiAgICB9LCBmdW5jdGlvbigpIHsKICAgICAgbG9nRGVidWcoJ01vZGFsIGRpc21pc3NlZCBhdDogJyArIG5ldyBEYXRlKCkpOwogICAgfSk7CiAgfTsKCiAgJHNjb3BlLmNoYW5nZUV2ZW50Q29sb3IgPSBmdW5jdGlvbihuZXdDb2xvcikgewogICAgbG9nRGVidWcoImNob29zaW5nIGNvbG9yICIgKyBuZXdDb2xvcik7CiAgICAkc2NvcGUuZXZlbnRDb2xvciA9IG5ld0NvbG9yOwogICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXZlbnRDb2xvciA9ICIjIiArIG5ld0NvbG9yOwogICAgJHNjb3BlLmV2ZW50Q29sb3JTdHlsZSA9IHsKICAgICAgJ2JhY2tncm91bmQtY29sb3InOiAiIyIgKyBuZXdDb2xvcgogICAgfTsKICAgICRzY29wZS5ldmVudENvbG9yU3R5bGVbbmV3Q29sb3JdID0gewogICAgICAndHJhbnNmb3JtJzogJ3JvdGF0ZSgzMGRlZyknCiAgICB9OwoKICB9CgogICRzY29wZS5hZGRFdmVudFR5cGVDYW5jZWwgPSBmdW5jdGlvbigpIHsKICAgICRsb2NhdGlvbi5wYXRoKCcvZXZlbnRfdHlwZXMnKTsKICB9OwoKICAkc2NvcGUuZHVwbGljYXRlRmllbGROYW1lcz0iIjsKICAkc2NvcGUuYWRkRXZlbnRUeXBlID0gZnVuY3Rpb24oKSB7CiAgICAvLyBjaGVjayBleHRyYSBmaWVsZHMgZHVwbGljYXRlIG5hbWVzIC0gc3RhcnQKICAgIGxvZ0RlYnVnKCJhZGRFdmVudFR5cGU6IGNoZWNrIGV4dHJhIGZpZWxkcyBkdXBsaWNhdGUgbmFtZXMgLSBzdGFydCIpOwogICAgdmFyIGV4dHJhRmllbGRzTmFtZXMgPSBbXTsKICAgIGZvciAodmFyIGk9MTsgaTwkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcy5sZW5ndGg7IGkrKykKICAgIHsKICAgICAgZXh0cmFGaWVsZHNOYW1lcy5wdXNoKCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzW2ldLmZpZWxkX25hbWUpOwogICAgfQogICAgZXh0cmFGaWVsZHNOYW1lcy5zb3J0KCk7CiAgICB2YXIgbGFzdCA9IGV4dHJhRmllbGRzTmFtZXNbMF07CiAgICBmb3IgKHZhciBpPTE7IGk8ZXh0cmFGaWVsZHNOYW1lcy5sZW5ndGg7IGkrKykKICAgIHsKICAgICAgaWYgKGV4dHJhRmllbGRzTmFtZXNbaV0gPT0gbGFzdCkKICAgICAgewogICAgICAgIC8vICBhbGVydCgnRHVwbGljYXRlIDogJytsYXN0KTsKICAgICAgICAkc2NvcGUuZHVwbGljYXRlRmllbGROYW1lcz0n16fXmdeZ150g16nXk9eUINeq15nXoteV15Mg16jXpNeV15DXmSDXm9ek15XXnCDXkdep150gIicrbGFzdCsnIi4uLic7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGxhc3QgPSBleHRyYUZpZWxkc05hbWVzW2ldOwogICAgfQogICAgLy8gY2hlY2sgZXh0cmEgZmllbGRzIGR1cGxpY2F0ZSBuYW1lcyAtIGVuZAoKICAgIGxvZ0RlYnVnKCJhZGQgRXZlbnQgVHlwZSIgKyAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcyArICJleHRyYSBmaWVsZHM9IiArJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXh0cmFGaWVsZHMpOwogICAgaWYgKCgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5tYXhfcmVnaXN0cmF0aW9ucz09JycpIHx8ICghJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMubWF4X3JlZ2lzdHJhdGlvbnMpKQogICAgewogICAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5tYXhfcmVnaXN0cmF0aW9ucz0wOwogICAgfQogICAgYWRkRXZlbnRUeXBlKCRodHRwLCRzY29wZSwkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcyxhZGRFdmVudFR5cGVfc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBhZGRFdmVudFR5cGVfc3VjY2VzcygpCiAgICB7CiAgICAgICRsb2NhdGlvbi5wYXRoKCcvZXZlbnRfdHlwZXMnKTsKICAgIH0KICB9Owp9KTsKCmt1emVBcHAuY29udHJvbGxlcignRXZlbnRUeXBlVXBkYXRlQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRjb21waWxlLCAkcm91dGVQYXJhbXMsIHVpQ2FsZW5kYXJDb25maWcsICR1aWJNb2RhbCwgJGxvY2F0aW9uKSB7CiAgZXZlbnRfdHlwZV9pZD0kcm91dGVQYXJhbXMuZXZlbnRfdHlwZV9pZDsKICBsb2dEZWJ1ZygnRXZlbnRUeXBlcyBDb250cm9sbGVyIFVwZGF0ZSAnK2V2ZW50X3R5cGVfaWQpOwoKICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcyA9IHt9OyAvLyB0aGVzZSBhcmUgdGhlIGNvbXBsZXRlIGRldGFpbHMgZm9yIHRoZSBuZXcgZXZlbnQgLy8KICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5pc191cGRhdGUgPSB0cnVlOwoKICAkc2NvcGUuZXZlbnRDb2xvclN0eWxlID0ge307CiAgZ2V0QWxsSW5zdHJ1Y3RvcnMoJGh0dHAsJHNjb3BlLCdpbnN0cnVjdG9ycycsZ2V0QWxsSW5zdHJ1Y3RvcnNfc3VjY2Vzcyk7CiAgZnVuY3Rpb24gZ2V0QWxsSW5zdHJ1Y3RvcnNfc3VjY2VzcygpCiAgewogICAgJHNjb3BlLmluc3RydWN0b3JzLnVuc2hpZnQoe2J1c2luZXNzX3VzZXJfaWQ6bnVsbCwgYnVzZXJfZmlyc3RfbmFtZToiIiwgYnVzZXJfbGFzdF9uYW1lOiIifSk7CiAgfQoKICBnZXRCdXNpbmVzc0V2ZW50VHlwZSgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmV2ZW50X3R5cGVfaWQsJ2V2ZW50VHlwZVByb3BlcnRpZXMnLGdldEJ1c2luZXNzRXZlbnRUeXBlX3N1Y2Nlc3MpOwoKICBmdW5jdGlvbiBnZXRCdXNpbmVzc0V2ZW50VHlwZV9zdWNjZXNzKCkKICB7CiAgICBpZiAoJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMubWF4X3JlZ2lzdHJhdGlvbnM9PW51bGwpCiAgICB7CiAgICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLm1heF9yZWdpc3RyYXRpb25zPTE7CiAgICB9CiAgICBpZiAoKCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmR1cmF0aW9uX2JlZm9yZV9ldmVudD4wKSB8ICgkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5kdXJhdGlvbl9hZnRlcl9ldmVudD4wKSkKICAgIHsKICAgICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuYmxvY2tFeHRyYVRpbWUgPSAxOwogICAgfQogICAgZWxzZQogICAgewogICAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5ibG9ja0V4dHJhVGltZSA9IDA7CiAgICB9Ci8vICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmluaGVyaXRfbWFpbl9ob3VycyA9IHJlc3BvbnNlLmRhdGFbMF0uaW5oZXJpdF9tYWluX2hvdXJzOwogICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuaXNfdXBkYXRlID0gdHJ1ZTsKICAgIGxvZ0RlYnVnKCIkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5jb2xvcj0iKyRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmNvbG9yKTsKICAgICRzY29wZS5ldmVudENvbG9yU3R5bGVbJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuY29sb3JdID0gewogICAgICAndHJhbnNmb3JtJzogJ3JvdGF0ZSgzMGRlZyknCiAgICB9OwogICAgJHNjb3BlLmNoYW5nZUV2ZW50Q29sb3IoKCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmNvbG9yKS5zdWJzdHIoMSkpOwogICAgbG9nRGVidWcoIiRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmluc3RydWN0b3JfaWQ9Iiskc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5pbnN0cnVjdG9yX2lkKTsKLy8gc2F2aW5nIGV2ZW50IHR5cGUgZGV0YWlscyBhc2lkZSB0byBsYXRlciBjaGVjayBpZiBhbnl0aGluZyBjaGFuZ2VkCiAgICBsb2dEZWJ1ZygiZHVwbGljYXRpbmcgb2JqZWN0IG9mIGV2ZW50IHR5cGUgdG8gbGF0ZXIgY29tcGFyZSAiK3R5cGVvZiAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcyk7CiAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllc0R1cGxpY2F0ZSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMpKTsKICAgIGxvZ0RlYnVnKCIkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllc0R1cGxpY2F0ZSA9Iiskc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllc0R1cGxpY2F0ZS5ldmVudF90eXBlX25hbWUpOwogIH07CgovLyBldmVudCB0eXBlIGNoYW5nZWQgcG9wdXAKICAkc2NvcGUuZXZlbnRUeXBlQ2hhbmdlZFBvcHVwID0gZnVuY3Rpb24oZXZlbnRUeXBlUHJvcGVydGllcykgewogICAgbG9nRGVidWcoImV2ZW50VHlwZUNoYW5nZWRQb3B1cCIpOwoKICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewogICAgICBhbmltYXRpb246IGZhbHNlLAogICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9ldmVudF90eXBlX2NoYW5nZWQucGhwJywKICAgICAgY29udHJvbGxlcjogJ2V2ZW50VHlwZUNoYW5nZWRQb3B1cENvbnRyb2xsZXInLAogICAgICBzaXplOiAnbCcsCiAgICAgIHJlc29sdmU6IHsKICAgICAgICBldmVudFR5cGVQcm9wZXJ0aWVzOiBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllczsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwoKICAgIG1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24oc2VsZWN0ZWRJdGVtKQogICAgewogICAgICBsb2dEZWJ1ZyhzZWxlY3RlZEl0ZW0pOwogICAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcyA9IHNlbGVjdGVkSXRlbTsKICAgIH0sIGZ1bmN0aW9uKCkgewogICAgICBsb2dEZWJ1ZygnTW9kYWwgZGlzbWlzc2VkIGF0OiAnICsgbmV3IERhdGUoKSk7CiAgICB9KTsKICB9OwoKLy8gZXZlbnQgdHlwZSBleHRyYSBmaWVsZCBwb3B1cAogICRzY29wZS5ldmVudFR5cGVFeHRyYUZpZWxkc1BvcCA9IGZ1bmN0aW9uKGV2ZW50VHlwZVByb3BlcnRpZXMpIHsKICAgIGxvZ0RlYnVnKCJldmVudFR5cGVFeHRyYUZpZWxkc1BvcDIiKTsKCiAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAgICAgYW5pbWF0aW9uOiBmYWxzZSwKICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfZXZlbnRfdHlwZV9leHRyYV9maWVsZHMucGhwJywKICAgICAgY29udHJvbGxlcjogJ2V2ZW50VHlwZUV4dHJhRmllbGRzTW9kYWxDb250cm9sbGVyJywKICAgICAgc2l6ZTogJ2wnLAogICAgICByZXNvbHZlOiB7CiAgICAgICAgZXZlbnRUeXBlUHJvcGVydGllczogZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gZXZlbnRUeXBlUHJvcGVydGllczsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwoKICAgIG1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24oc2VsZWN0ZWRJdGVtKSB7CiAgICAgIGxvZ0RlYnVnKHNlbGVjdGVkSXRlbSk7CiAgICAgICRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzID0gc2VsZWN0ZWRJdGVtOwogICAgfSwgZnVuY3Rpb24oKSB7CiAgICAgIGxvZ0RlYnVnKCdNb2RhbCBkaXNtaXNzZWQgYXQ6ICcgKyBuZXcgRGF0ZSgpKTsKICAgIH0pOwogIH07CgoKICAkc2NvcGUuY2hhbmdlRXZlbnRDb2xvciA9IGZ1bmN0aW9uKG5ld0NvbG9yKSB7CiAgICBsb2dEZWJ1ZygiY2hvb3NpbmcgY29sb3IgIiArIG5ld0NvbG9yKTsKICAgICRzY29wZS5ldmVudENvbG9yID0gbmV3Q29sb3I7CiAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5ldmVudENvbG9yID0gIiMiICsgbmV3Q29sb3I7CiAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5jb2xvciA9ICIjIiArIG5ld0NvbG9yOwogICAgJHNjb3BlLmV2ZW50Q29sb3JTdHlsZSA9IHsKICAgICAgJ2JhY2tncm91bmQtY29sb3InOiAiIyIgKyBuZXdDb2xvcgogICAgfTsKICAgICRzY29wZS5ldmVudENvbG9yU3R5bGVbbmV3Q29sb3JdID0gewogICAgICAndHJhbnNmb3JtJzogJ3JvdGF0ZSgzMGRlZyknCiAgICB9OwoKICB9CgogICRzY29wZS5hZGRFdmVudFR5cGVDYW5jZWwgPSBmdW5jdGlvbigpIHsKICAgICRsb2NhdGlvbi5wYXRoKCcvZXZlbnRfdHlwZXMnKTsKICB9OwoKICAkc2NvcGUuYWRkRXZlbnRUeXBlID0gZnVuY3Rpb24oKSB7IC8vIHRoaXMgZnVuY3Rpb24gVVBEQVRFUyBldmVudCB0eXBlIChub3QgYWRkcykKLy8gY2hlY2tpbmcgaWYgYW55dGhpbmcgY2hhbmdlZCByZWFsbHkKLy8gYW5kIGFza2luZyBpZiB3ZSBzaG91bGQgdXBkYXRlIGFsbCBldmVudHMgZnJvbSBub3cgKG9yIG9ubHkgbmV3bHkgY3JlYXRlZCBldmVudHMpCi8vIGNoZWNraW5nCiAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllc0R1cGxpY2F0ZS5leHRyYUZpZWxkcz0kc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkczsKICAgIC8vIGlmIChhbmd1bGFyLmVxdWFscygkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllc0R1cGxpY2F0ZSwkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcykpCiAgICBpZiAodHJ1ZSkgLy8gaWdub3JpbmcgdHJ5aW5nIHRvIG1ha2UgY2hhbmdlcyB0byBldmVudHMKICAgIHsKLy8gJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXNEdXBsaWNhdGUuZXh0cmFGaWVsZHMgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzKSk7CgogICAgICBsb2dEZWJ1Zygibm90aGluZyBjaGFuZ2VkIGluIGV2ZW50IHR5cGUsIG9yIG9ubHkgZXh0cmEgZmllbGRzIik7CiAgICAgICRzY29wZS51cGRhdGVFdmVudFR5cGUoKTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgbG9nRGVidWcoImV2ZW50IHR5cGUgY2hhbmdlZCIpOwogICAgICAkc2NvcGUuZXZlbnRUeXBlQ2hhbmdlZFBvcHVwKCk7CiAgICB9Ci8vICRzY29wZS51cGRhdGVFdmVudFR5cGUoKTsKICB9CiAgJHNjb3BlLnVwZGF0ZUV2ZW50VHlwZSA9IGZ1bmN0aW9uKCkKICB7CiAgICAvLyBjaGVjayBleHRyYSBmaWVsZHMgZHVwbGljYXRlIG5hbWVzIC0gc3RhcnQKICAgIGxvZ0RlYnVnKCJhZGRFdmVudFR5cGU6IGNoZWNrIGV4dHJhIGZpZWxkcyBkdXBsaWNhdGUgbmFtZXMgLSBzdGFydCIpOwogICAgdmFyIGV4dHJhRmllbGRzTmFtZXMgPSBbXTsKICAgIGZvciAodmFyIGk9MTsgaTwkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5leHRyYUZpZWxkcy5sZW5ndGg7IGkrKykKICAgIHsKICAgICAgZXh0cmFGaWVsZHNOYW1lcy5wdXNoKCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLmV4dHJhRmllbGRzW2ldLmZpZWxkX25hbWUpOwogICAgfQogICAgZXh0cmFGaWVsZHNOYW1lcy5zb3J0KCk7CiAgICB2YXIgbGFzdCA9IGV4dHJhRmllbGRzTmFtZXNbMF07CiAgICBmb3IgKHZhciBpPTE7IGk8ZXh0cmFGaWVsZHNOYW1lcy5sZW5ndGg7IGkrKykKICAgIHsKICAgICAgaWYgKGV4dHJhRmllbGRzTmFtZXNbaV0gPT0gbGFzdCkKICAgICAgewogICAgICAgIC8vICBhbGVydCgnRHVwbGljYXRlIDogJytsYXN0KTsKICAgICAgICBsb2dEZWJ1Zygn16fXmdeZ150g16nXk9eUINeq15nXoteV15Mg16jXpNeV15DXmSDXm9ek15XXnCDXkdep150gIicrbGFzdCsnIi4uLicpOwogICAgICAgICRzY29wZS5kdXBsaWNhdGVGaWVsZE5hbWVzPSfXp9eZ15nXnSDXqdeT15Qg16rXmdei15XXkyDXqNek15XXkNeZINeb16TXldecINeR16nXnSAiJytsYXN0KyciLi4uJzsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgbGFzdCA9IGV4dHJhRmllbGRzTmFtZXNbaV07CiAgICB9CiAgICAvLyBjaGVjayBleHRyYSBmaWVsZHMgZHVwbGljYXRlIG5hbWVzIC0gZW5kCgogICAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMudXBkYXRlX2V4aXN0aW5nX2V2ZW50cz1mYWxzZTsKCiAgICBsb2dEZWJ1ZygidXBkYXRlRXZlbnRUeXBlOiB1cGRhdGUgRXZlbnQgVHlwZSAiICsgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMuZXZlbnRfdHlwZV9pZCk7CiAgICBpZiAoJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXMubWF4X3JlZ2lzdHJhdGlvbnM9PScnKQogICAgewogICAgICAkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5tYXhfcmVnaXN0cmF0aW9ucz0wOwogICAgfQogICAgdXBkYXRlRXZlbnRUeXBlKCRodHRwLCRzY29wZSwkc2NvcGUuZXZlbnRUeXBlUHJvcGVydGllcy5ldmVudF90eXBlX2lkLCRzY29wZS5ldmVudFR5cGVQcm9wZXJ0aWVzLHVwZGF0ZUV2ZW50VHlwZV9zdWNjZXNzKTsKICAgIGZ1bmN0aW9uIHVwZGF0ZUV2ZW50VHlwZV9zdWNjZXNzKCkKICAgIHsKICAgICAgJGxvY2F0aW9uLnBhdGgoJy9ldmVudF90eXBlcycpOwogICAgfQogIH0KfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdldmVudENyZWF0ZU1vZGFsQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRyb290U2NvcGUsIHNoYXJlZFByb3BlcnRpZXMsIGV2ZW50X3R5cGVfaWQsIGxvY2F0aW9uX2lkLCBlbXBfaWQsICRodHRwLCBzdGFydERhdGUsIHJlc2NoZWR1bGVfZXZlbnQsIHVpQ2FsZW5kYXJDb25maWcpIHsKICBzdGFydERhdGU9bmV3IG1vbWVudChzdGFydERhdGUpOwogIGxvZ0RlYnVnKCJldmVudENyZWF0ZU1vZGFsQ29udHJvbGxlciwgc3RhcnREYXRlPSIrc3RhcnREYXRlKyIgdHlwZSAiK3R5cGVvZiBzdGFydERhdGUpOwogIGxvZ0RlYnVnKCJldmVudENyZWF0ZU1vZGFsQ29udHJvbGxlciwgcmVzY2hlZHVsZV9ldmVudD0iK3Jlc2NoZWR1bGVfZXZlbnQpOwoKICAkc2NvcGUuZXZlbnRUeXBlVGl0bGUgPSAi15HXl9eoINeh15XXkiDXntek15LXqSI7CiAgJHNjb3BlLnNob3dFdmVudFR5cGVTZWxlY3RlZCA9IGZhbHNlOwogICRzY29wZS5zaG93RXZlbnRDbGllbnRTZWxlY3RlZCA9IGZhbHNlOwogICRzY29wZS5uZXdFdmVudERldGFpbHMgPSB7fTsgLy8gdGhlc2UgYXJlIHRoZSBjb21wbGV0ZSBkZXRhaWxzIGZvciB0aGUgbmV3IGV2ZW50IC8vCiAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5yZXBlYXRUeXBlID0gImZvcmV2ZXIiOwogICRzY29wZS5uZXdFdmVudERldGFpbHMucmVwZWF0Rml4ZWRUaW1lcyA9ICI0IjsKICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLm1heF9wYXJ0aWNpcGFudHMgPSAxOwoKICBsb2dEZWJ1ZygiWFhYID0gIitKU09OLnN0cmluZ2lmeShyZXNjaGVkdWxlX2V2ZW50KSk7CgogICRzY29wZS5yZXNjaGVkdWxlX2V2ZW50PWZhbHNlOwogICRzY29wZS5yZXNjaGVkdWxlX2V2ZW50X2RldGFpbHM9cmVzY2hlZHVsZV9ldmVudDsKICBpZiAoJHNjb3BlLnJlc2NoZWR1bGVfZXZlbnRfZGV0YWlscyE9bnVsbCkKICB7CiAgICBsb2dEZWJ1ZygicmVzY2hlZHVsZV9ldmVudF9kZXRhaWxzPSIrJHNjb3BlLnJlc2NoZWR1bGVfZXZlbnRfZGV0YWlscy5ldmVudF9pZCk7CiAgICBsb2dEZWJ1ZyhKU09OLnN0cmluZ2lmeSgkc2NvcGUucmVzY2hlZHVsZV9ldmVudF9kZXRhaWxzKSk7CiAgICAkc2NvcGUucmVzY2hlZHVsZV9ldmVudD10cnVlOwogICAgJHNjb3BlLmdpdmVuX2V2ZW50X3R5cGVfaWQgPSAkc2NvcGUucmVzY2hlZHVsZV9ldmVudF9kZXRhaWxzLmV2ZW50X3R5cGVfaWQ7Ci8vIHN0aWxsIHByZWZlcmluZyBlbXBfaWQgZnJvbSBzY2hlZHVsZXIgc3VnZ2VzdGlvbiBpcyBpdCB3YXMgc2VsZWN0ZWQKICAgIGlmIChlbXBfaWQhPTApCiAgICB7CiAgICAgICRzY29wZS5naXZlbl9lbXBfaWQgPSBlbXBfaWQ7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICRzY29wZS5naXZlbl9lbXBfaWQgPSAkc2NvcGUucmVzY2hlZHVsZV9ldmVudF9kZXRhaWxzLmluc3RydWN0b3JfaWQ7CiAgICB9Ci8vIHN0aWxsIHByZWZlcmluZyBsb2NhdGlvbl9pZCBmcm9tIHNjaGVkdWxlciBzdWdnZXN0aW9uIG92ZXIgdGhlIG9yaWdpbmFsIGxvY2F0aW9uIGZyb20gZXZlbnQKICAgIGlmIChsb2NhdGlvbl9pZCE9MCkKICAgIHsKICAgICAgJHNjb3BlLmdpdmVuX2xvY2F0aW9uX2lkID0gbG9jYXRpb25faWQ7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICRzY29wZS5naXZlbl9sb2NhdGlvbl9pZCA9ICRzY29wZS5yZXNjaGVkdWxlX2V2ZW50X2RldGFpbHMubG9jYXRpb25faWQ7CiAgICB9CiAgfQogIGVsc2UKICB7CiAgICAkc2NvcGUuZ2l2ZW5fZXZlbnRfdHlwZV9pZCA9IGV2ZW50X3R5cGVfaWQ7CiAgICAkc2NvcGUuZ2l2ZW5fbG9jYXRpb25faWQgPSBsb2NhdGlvbl9pZDsKICAgICRzY29wZS5naXZlbl9lbXBfaWQgPSBlbXBfaWQ7CiAgfQogIGlmICgkc2NvcGUuZ2l2ZW5fZXZlbnRfdHlwZV9pZD4wKQogIHsKICAgICRzY29wZS5wcmV2aW91c2x5X3NlbGVjdGVkX2V2ZW50X3R5cGU9dHJ1ZTsKICB9CiAgZWxzZQogIHsKICAgICRzY29wZS5wcmV2aW91c2x5X3NlbGVjdGVkX2V2ZW50X3R5cGU9ZmFsc2U7CiAgfQogIGxvZ0RlYnVnKCIkc2NvcGUuZ2l2ZW5fZXZlbnRfdHlwZV9pZD0iKyRzY29wZS5naXZlbl9ldmVudF90eXBlX2lkKTsKCiAgc2VsZWN0ZWREYXRlU3RhcnQgPSBuZXcgRGF0ZShzdGFydERhdGUpOwogIGxvZ0RlYnVnKCJzZWxlY3RlZERhdGVTdGFydCA9ICIrc2VsZWN0ZWREYXRlU3RhcnQpOwogIHZhciBzZWxlY3RlZERhdGVTdGFydCA9IG5ldyBEYXRlKHNlbGVjdGVkRGF0ZVN0YXJ0LmdldFRpbWUoKSArIHNlbGVjdGVkRGF0ZVN0YXJ0LmdldFRpbWV6b25lT2Zmc2V0KCkgKiA2MDAwMCk7CgovLyBsb2dEZWJ1ZygiZGF0ZT0iICsgc2VsZWN0ZWREYXRlU3RhcnQpOwogICRzY29wZS5zZWxlY3RlZEV2ZW50ID0gW107CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycyA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldEhvdXJzKCk7CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzID0gKHNlbGVjdGVkRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKSA8IDEwID8gJzAnIDogJycpICsgc2VsZWN0ZWREYXRlU3RhcnQuZ2V0TWludXRlcygpOwogICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZG93ID0gZGF5TmFtZXNbc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RGF5KCldOwogICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF0ZSA9IHNlbGVjdGVkRGF0ZVN0YXJ0OwogICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bW9udGggPSBtb250aE5hbWVzW3NlbGVjdGVkRGF0ZVN0YXJ0LmdldE1vbnRoKCldOwogICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bW9udGgxMTIgPSBzZWxlY3RlZERhdGVTdGFydC5nZXRNb250aCgpKzE7CiAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXlvZm1vbnRoID0gc2VsZWN0ZWREYXRlU3RhcnQuZ2V0RGF0ZSgpOwogICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0eWVhciA9IHNlbGVjdGVkRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCk7CiAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5zdGFydF90aW1lX2lucHV0X2Zvcm1hdD0gbmV3IERhdGUoMTk3MCwgMCwgMSwgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRob3VycywgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzLCAwKTsKCiAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pbnN0cnVjdG9yX2lkID0gJHNjb3BlLmdpdmVuX2VtcF9pZDsKICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmxvY2F0aW9uX2lkID0gJHNjb3BlLmdpdmVuX2xvY2F0aW9uX2lkOwoKICBnZXRCdXNpbmVzc0xvY2F0aW9ucygkaHR0cCwkc2NvcGUsJ2J1c2luZXNzX2xvY2F0aW9ucycsZ2V0QnVzaW5lc3NMb2NhdGlvbnNfZmluaXNoKTsKICBmdW5jdGlvbiBnZXRCdXNpbmVzc0xvY2F0aW9uc19maW5pc2goKQogIHsKICAgIGlmICgkc2NvcGUubmV3RXZlbnREZXRhaWxzLmxvY2F0aW9uX2lkPT0wKQogICAgewogICAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmxvY2F0aW9uX2lkPSRzY29wZS5idXNpbmVzc19sb2NhdGlvbnNbMF0ubG9jYXRpb25faWQ7CiAgICB9CiAgfQoKICBjb25zb2xlLmxvZygiJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pbnN0cnVjdG9yX2lkPSIrJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pbnN0cnVjdG9yX2lkKTsKLy8gaWYgY2xpZW50IHdhcyBwcmV2aW91c2x5IHNlbGVjdGVkCiAgJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXI9ZmFsc2U7CiAgbG9nRGVidWcoInNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXI9IitzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKTsKICBpZiAoc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpIT1udWxsKQogIHsKLy8gY29uc29sZS5sb2coImdvdCBwcmV2aW91cyBzZWxlY3RlZCB1c2VyICIrc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2VyX2ZpcnN0X25hbWUpOwogICAgJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJuYW1lPXNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKS5idXNlcl9maXJzdF9uYW1lKyIgIitzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfbGFzdF9uYW1lOwogICAgJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXI9dHJ1ZTsKCiAgICAkc2NvcGUuc2hvd0V2ZW50Q2xpZW50U2VsZWN0ZWQgPSB0cnVlOwogICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmR1c2VyX2lkID0gc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2luZXNzX3VzZXJfaWQ7CiAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZHVzZXJfZmlyc3RfbmFtZSA9IHNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKS5idXNlcl9maXJzdF9uYW1lOwogICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmR1c2VyX2xhc3RfbmFtZSA9IHNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKS5idXNlcl9sYXN0X25hbWU7CiAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmJ1c2luZXNzX3VzZXJfaWQgPSBzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzaW5lc3NfdXNlcl9pZDsKCiAgfQogICRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZSA9IHN0YXJ0RGF0ZTsKICBsb2dEZWJ1ZygiJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5zdGFydF90aW1lMT0iKyRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZSk7CiAgJHNjb3BlLnN0YXJ0TWludXRlcyA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1Zygic3RhcnRNaW51dGVzICIrKCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcykpOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzPW1pbnV0ZXNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcyk7CiAgICBjYWxjdWxhdGVTdGFydFRpbWUoKTsKICAgIGNhbGN1bGF0ZUVuZFRpbWVEeW5hbWljKCk7CiAgfQogICRzY29wZS5zdGFydEhvdXJzID0gZnVuY3Rpb24oKQogIHsKICAgIGxvZ0RlYnVnKCJzdGFydEhvdXJzICIraG91cnNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMpKTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnM9aG91cnNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMpOwogICAgY2FsY3VsYXRlU3RhcnRUaW1lKCk7CiAgICBjYWxjdWxhdGVFbmRUaW1lRHluYW1pYygpOwogIH0KCiAgJHNjb3BlLmVuZE1pbnV0ZXMgPSBmdW5jdGlvbigpCiAgewogICAgbG9nRGVidWcoImVuZE1pbnV0ZXMgIisoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcykpOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcz1taW51dGVzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzKTsKICAgIGNhbGN1bGF0ZVN0YXJ0VGltZSgpOwogICAgY2FsY3VsYXRlRW5kVGltZUR5bmFtaWMoKTsKICB9CiAgJHNjb3BlLmVuZEhvdXJzID0gZnVuY3Rpb24oKQogIHsKICAgIGxvZ0RlYnVnKCJlbmRIb3VycyAiK2hvdXJzQ2hhbmdlZCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycykpOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnM9aG91cnNDaGFuZ2VkKCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzKTsKICAgIGNhbGN1bGF0ZVN0YXJ0VGltZSgpOwogICAgY2FsY3VsYXRlRW5kVGltZUR5bmFtaWMoKTsKICB9CgogIGZ1bmN0aW9uIGNhbGN1bGF0ZVN0YXJ0VGltZSgpCiAgewogICAgZXZlbnRZZWFyPSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0eWVhcjsKICAgIGV2ZW50TW9udGg9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aDExMjsKICAgIGV2ZW50RGF5PSRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aDsKICAgIGlmIChwYXJzZUludChldmVudE1vbnRoKTwxMCkKICAgIHsKICAgICAgZXZlbnRNb250aD0iMCIrZXZlbnRNb250aDsKICAgIH0KICAgIGlmIChwYXJzZUludChldmVudERheSk8MTApCiAgICB7CiAgICAgIGV2ZW50RGF5PSIwIitldmVudERheTsKICAgIH0KICAgIGxvZ0RlYnVnKCIkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydHllYXI9IitldmVudFllYXIpOwogICAgbG9nRGVidWcoIiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0ZGF5b2Ztb250aD0iK2V2ZW50TW9udGgpOwogICAgbG9nRGVidWcoIiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bW9udGg9IitldmVudERheSk7CiAgICBuZXdfc3RhcnQ9bW9tZW50LnV0YyhldmVudFllYXIrIi0iK2V2ZW50TW9udGgrIi0iK2V2ZW50RGF5KyJUMDA6MDA6MDAiKS5hZGQoKChwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKSo2MCkrcGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKSksICdtaW51dGVzJyk7CiAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWU9bmV3X3N0YXJ0OwogICAgbG9nRGVidWcoIm5ld19zdGFydD0iK25ld19zdGFydCk7CiAgfQogIGZ1bmN0aW9uIG1pbnV0ZXNDaGFuZ2VkKHRoZW1pbnV0ZXMpCiAgewogICAgbG9nRGVidWcoInRoZW1pbnV0ZXM9Iit0aGVtaW51dGVzKTsKICAgIGlmICh0eXBlb2YgdGhlbWludXRlcz09InVuZGVmaW5lZCIpCiAgICB7CiAgICAgIHJldHVybiAiMDAiOwogICAgfQogICAgaWYgKGlzTmFOKHRoZW1pbnV0ZXMpKQogICAgewogICAgICByZXR1cm4gIjAwIjsKICAgIH0KICAgIGlmICh0aGVtaW51dGVzPT0nJykKICAgIHsKICAgICAgcmV0dXJuICIwMCI7CiAgICB9CiAgICB0aGVtaW51dGVzPXBhcnNlSW50KHRoZW1pbnV0ZXMpOwogICAgaWYgKHRoZW1pbnV0ZXM+NjApCiAgICB7CiAgICAgIHJldHVybiAiMDAiOwogICAgfQogICAgZWxzZSBpZiAodGhlbWludXRlczwwKQogICAgewogICAgICByZXR1cm4gIjAwIjsKICAgIH0KICAgIGVsc2UgaWYgKHRoZW1pbnV0ZXM9PSIiKQogICAgewogICAgICByZXR1cm4gIjAwIjsKICAgIH0KICAgIGVsc2UgaWYgKHRoZW1pbnV0ZXM8MTApCiAgICB7CiAgICAgIHJldHVybiAiMCIrdGhlbWludXRlczsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgcmV0dXJuIHRoZW1pbnV0ZXM7CiAgICB9CiAgfQogIGZ1bmN0aW9uIGhvdXJzQ2hhbmdlZCh0aGVob3VycykKICB7CiAgICBsb2dEZWJ1ZygidGhlaG91cnM9Iit0aGVob3Vycyk7CiAgICBpZiAodHlwZW9mIHRoZWhvdXJzPT0idW5kZWZpbmVkIikKICAgIHsKICAgICAgcmV0dXJuICIwIjsKICAgIH0KICAgIGlmIChpc05hTih0aGVob3VycykpCiAgICB7CiAgICAgIHJldHVybiAiMCI7CiAgICB9CiAgICBpZiAodGhlaG91cnM9PScnKQogICAgewogICAgICByZXR1cm4gIjAiOwogICAgfQogICAgdGhlaG91cnM9cGFyc2VJbnQodGhlaG91cnMpOwogICAgaWYgKHRoZWhvdXJzPjI0KQogICAgewogICAgICByZXR1cm4gMDsKICAgIH0KICAgIGVsc2UgaWYgKHRoZWhvdXJzPDApCiAgICB7CiAgICAgIHJldHVybiAwOwogICAgfQogICAgZWxzZSBpZiAodGhlaG91cnM9PSIiKQogICAgewogICAgICByZXR1cm4gIjAiOwogICAgfQogICAgZWxzZQogICAgewogICAgICByZXR1cm4gdGhlaG91cnM7CiAgICB9CiAgfQogIGdldEFsbEluc3RydWN0b3JzKCRodHRwLCRzY29wZSwnaW5zdHJ1Y3RvcnMnLGdldEFsbEluc3RydWN0b3JzX3N1Y2Nlc3MpOwogIGZ1bmN0aW9uIGdldEFsbEluc3RydWN0b3JzX3N1Y2Nlc3MoKQogIHsKLy8gJHNjb3BlLmluc3RydWN0b3JzLnVuc2hpZnQoe2J1c2luZXNzX3VzZXJfaWQ6bnVsbCwgYnVzZXJfZmlyc3RfbmFtZToiIiwgYnVzZXJfbGFzdF9uYW1lOiIifSk7CiAgICBpZiAoISRzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZD4wKQogICAgewogICAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmluc3RydWN0b3JfaWQ9JHNjb3BlLmluc3RydWN0b3JzWzBdLmJ1c2luZXNzX3VzZXJfaWQ7CiAgICB9CiAgfQoKICAkc2NvcGUuc2VsZWN0RXZlbnRUeXBlID0gZnVuY3Rpb24oKSB7Ci8vIHJlbW92aW5nIGV2ZW50IHR5cGUg15HXl9eoINeh15XXkiDXntek15LXqQogICAgaWYgKCRzY29wZS5ldmVudFR5cGVPcHRpb25zWzBdLmV2ZW50X3R5cGVfaWQ9PTApCiAgICB7CiAgICAgICRzY29wZS5ldmVudFR5cGVPcHRpb25zLnNwbGljZSgwLCAxKTsKICAgIH0KICAgICRzY29wZS5hamF4X2Vycm9yPScnOwogICAgY2hvaWNlPSRzY29wZS5zZWxlY3RFdmVudFR5cGVTZWxlY3RlZDsKICAgIGxvZ0RlYnVnKCJzZWxlY3RFdmVudFR5cGUiKTsKICAgIGxvZ0RlYnVnKEpTT04uc3RyaW5naWZ5KCRzY29wZS5zZWxlY3RFdmVudFR5cGVTZWxlY3RlZCkpOwogICAgJHNjb3BlLmV2ZW50VHlwZVRpdGxlID0gY2hvaWNlLmV2ZW50X3R5cGVfbmFtZTsKICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuZXZlbnRfdHlwZV9pZCA9IGNob2ljZS5ldmVudF90eXBlX2lkOwoKICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuZXZlbnRfbmFtZSA9IGNob2ljZS5ldmVudF90eXBlX25hbWU7CiAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLm9yaWdpbmFsX2V2ZW50X25hbWUgPSBjaG9pY2UuZXZlbnRfdHlwZV9uYW1lOwogICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5ldmVudF9kZXNjcmlwdGlvbiA9IGNob2ljZS5ldmVudF90eXBlX2Rlc2NyaXB0aW9uOwogICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pc19jbGFzcyA9IGNob2ljZS5pc19jbGFzczsKICAgICRzY29wZS5uZXdFdmVudERldGFpbHMub3JpZ2luYWxfcHJpY2UgPSBjaG9pY2Uub3JpZ2luYWxfcHJpY2U7CiAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmlzX2dlbmVyaWNfZXR5cGUgPSBjaG9pY2UuaXNfZ2VuZXJpY19ldHlwZTsKLy8gJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pbnN0cnVjdG9yX2lkID0gY2hvaWNlLmluc3RydWN0b3JfaWQ7CiAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50ID0gY2hvaWNlLmR1cmF0aW9uX2V2ZW50OwovLyBsb2dEZWJ1Zygic2NvcGUubmV3RXZlbnREZXRhaWxzLmlzX2NsYXNzPSIrJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pc19jbGFzcyk7Ci8vIGxvZ0RlYnVnKCJzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZD0iKyRzY29wZS5uZXdFdmVudERldGFpbHMuaW5zdHJ1Y3Rvcl9pZCk7Ci8vIGxvZ0RlYnVnKCJzdGFydERhdGU9IitzdGFydERhdGUpOwovLyAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWUgPSBzdGFydERhdGU7CiAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmV2ZW50dHlwZSA9IGNob2ljZTsKICAgIGNhbGN1bGF0ZUVuZFRpbWUoKTsKCi8vICRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZV9pbnB1dF9mb3JtYXQ9IG5ldyBEYXRlKDE5NzAsIDAsIDEsIDE0LCA1NywgMCk7CgogICAgbG9nRGVidWcoIm5ld0V2ZW50IHN0YXJ0PSIgKyAkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWUpOwogICAgbG9nRGVidWcoIm5ld0V2ZW50IGVuZD0iICsgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmRfdGltZSk7CgogICAgJHNjb3BlLnNob3dFdmVudFR5cGVTZWxlY3RlZCA9IHRydWU7CiAgfQoKLy8gdGhpcyBmdW5jdGlvbiBjYWxjdWxhdGVzIGVuZCB0aW1lIGFjY29yZGluZyB0byB0aGUgbGVuZ3RoIG9mIHRoZSBldmVudHR5cGUKICBmdW5jdGlvbiBjYWxjdWxhdGVFbmRUaW1lKCkKICB7CiAgICBjb25zb2xlLmxvZygiJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5zdGFydF90aW1lPSIrJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5zdGFydF90aW1lKTsKICAgIGVuZCA9IG1vbWVudCgkc2NvcGUubmV3RXZlbnREZXRhaWxzLnN0YXJ0X3RpbWUpLmFkZCgkc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50LCAnbWludXRlcycpOwogICAgc2VsZWN0ZWREYXRlRW5kID0gbmV3IERhdGUoZW5kKTsKICAgIHNlbGVjdGVkRGF0ZUVuZCA9IG5ldyBEYXRlKHNlbGVjdGVkRGF0ZUVuZC5nZXRUaW1lKCkgKyBzZWxlY3RlZERhdGVFbmQuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzID0gc2VsZWN0ZWREYXRlRW5kLmdldEhvdXJzKCk7CiAgICAkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRkb3cgPSBkYXlOYW1lc1tzZWxlY3RlZERhdGVFbmQuZ2V0RGF5KCldOwogICAgJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcyA9IChzZWxlY3RlZERhdGVFbmQuZ2V0TWludXRlcygpIDwgMTAgPyAnMCcgOiAnJykgKyBzZWxlY3RlZERhdGVFbmQuZ2V0TWludXRlcygpOwogICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmRfdGltZSA9IGVuZDsKLy8gY2FsY3VsYXRpbmcgZHVyYXRpb24KICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuZHVyYXRpb25fZXZlbnQ9cGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcyktcGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKTsKICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuZHVyYXRpb25fZXZlbnQ9JHNjb3BlLm5ld0V2ZW50RGV0YWlscy5kdXJhdGlvbl9ldmVudCsocGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kaG91cnMpLXBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMpKSo2MDsKICAgIGlmICgkc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50PDApCiAgICB7CiAgICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuZHVyYXRpb25fZXZlbnQ9MDsKICAgIH0KICB9CgovLyB0aGlzIGZ1bmN0aW9uIGNhbGN1bGF0ZXMgZW5kIHRpbWUgYWNjb3JkaW5nIHRvIHRoZSBpbnB1dCBmcm9tIG1vZGFsIHdpbmRvdwovLyBhbmQgbm90IGFjY29yZGluZyB0byBldmVudCB0eXBlIGxlbmd0aAogIGZ1bmN0aW9uIGNhbGN1bGF0ZUVuZFRpbWVEeW5hbWljKCkKICB7CiAgICBldmVudFllYXI9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnR5ZWFyOwogICAgZXZlbnRNb250aD0kc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1vbnRoMTEyOwogICAgZXZlbnREYXk9JHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXlvZm1vbnRoOwogICAgaWYgKHBhcnNlSW50KGV2ZW50TW9udGgpPDEwKQogICAgewogICAgICBldmVudE1vbnRoPSIwIitldmVudE1vbnRoOwogICAgfQogICAgaWYgKHBhcnNlSW50KGV2ZW50RGF5KTwxMCkKICAgIHsKICAgICAgZXZlbnREYXk9IjAiK2V2ZW50RGF5OwogICAgfQogICAgbG9nRGVidWcoIiRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0eWVhcj0iK2V2ZW50WWVhcik7CiAgICBsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRkYXlvZm1vbnRoPSIrZXZlbnRNb250aCk7CiAgICBsb2dEZWJ1ZygiJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtb250aD0iK2V2ZW50RGF5KTsKICAgIG5ld19lbmQ9bW9tZW50LnV0YyhldmVudFllYXIrIi0iK2V2ZW50TW9udGgrIi0iK2V2ZW50RGF5KyJUMDA6MDA6MDAiKS5hZGQoKChwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycykqNjApK3BhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpKSwgJ21pbnV0ZXMnKTsKICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kX3RpbWU9bmV3X2VuZDsKICAgIGxvZ0RlYnVnKCJuZXdfZW5kPSIrbmV3X2VuZCk7Ci8vIGNhbGN1bGF0aW5nIGR1cmF0aW9uCiAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50PXBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZG1pbnV0ZXMpLXBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0bWludXRlcyk7CiAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50PSRzY29wZS5uZXdFdmVudERldGFpbHMuZHVyYXRpb25fZXZlbnQrKHBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzKS1wYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzKSkqNjA7CiAgICBpZiAoJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5kdXJhdGlvbl9ldmVudDwwKQogICAgewogICAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmR1cmF0aW9uX2V2ZW50PTA7CiAgICB9CiAgfQogIGdldEFsbEJ1c2luZXNzRXZlbnRUeXBlcygkaHR0cCwkc2NvcGUsJ2V2ZW50VHlwZU9wdGlvbnMnLGdldEFsbEJ1c2luZXNzRXZlbnRUeXBlc19zdWNjZXNzKTsKICBmdW5jdGlvbiBnZXRBbGxCdXNpbmVzc0V2ZW50VHlwZXNfc3VjY2VzcygpCiAgewovLyBhZnRlciBsb2FkaW5nIGV2ZW50IHR5cGVzLCBpZiB0aGUgZ2l2ZW4gZXZlbnQgdHlwZSBpcyAhPSAwIHdlICJzZWxlY3QiIGl0CiAgICBjb25zb2xlLmxvZygiZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzX3N1Y2Nlc3MiKTsKICAgIGlmICgkc2NvcGUuZ2l2ZW5fZXZlbnRfdHlwZV9pZD4wKQogICAgewogICAgICBmb3IodmFyIGkgPSAwOyBpIDwgJHNjb3BlLmV2ZW50VHlwZU9wdGlvbnMubGVuZ3RoOyBpKyspCiAgICAgIHsKICAgICAgICBpZiAoJHNjb3BlLmV2ZW50VHlwZU9wdGlvbnNbaV0uZXZlbnRfdHlwZV9pZD09JHNjb3BlLmdpdmVuX2V2ZW50X3R5cGVfaWQpCiAgICAgICAgewogICAgICAgICAgY29uc29sZS5sb2coImdpdmVuX2V2ZW50X3R5cGVfaWQgZm91bmQiKTsKLy8gJHNjb3BlLmNhbGN1bGF0ZVN0YXJ0VGltZSgpOwogICAgICAgICAgJHNjb3BlLnNlbGVjdEV2ZW50VHlwZVNlbGVjdGVkPSRzY29wZS5ldmVudFR5cGVPcHRpb25zW2ldOwovLyAkc2NvcGUuc2VsZWN0RXZlbnRUeXBlKCRzY29wZS5ldmVudFR5cGVPcHRpb25zW2ldKTsKICAgICAgICAgICRzY29wZS5zZWxlY3RFdmVudFR5cGUoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGVsc2UgewogICAgICAkc2NvcGUuZXZlbnRUeXBlT3B0aW9ucy51bnNoaWZ0KHsiZXZlbnRfdHlwZV9pZCI6MCwgImV2ZW50X3R5cGVfbmFtZSI6IteR15fXqCDXodeV15Ig157XpNeS16kiLCBpc192YWNhdGlvbjogMH0pOwogICAgICAkc2NvcGUuc2VsZWN0RXZlbnRUeXBlU2VsZWN0ZWQ9JHNjb3BlLmV2ZW50VHlwZU9wdGlvbnNbMF07CiAgICB9CiAgfQogIGdldEFsbENsaWVudHMoJGh0dHAsJHNjb3BlLCdldmVudFR5cGVVc2VycycpOwoKICAkc2NvcGUuZXZlbnRDbGllbnRTZWxlY3RlZCA9IGZ1bmN0aW9uKHNlbGVjdGVkKSB7CiAgICBpZiAoc2VsZWN0ZWQpIHsKLy8gYWxlcnQoSlNPTi5zdHJpbmdpZnkoIHNlbGVjdGVkLCBudWxsLCAyICkpOwogICAgICBsb2dEZWJ1ZygnY2xpZW50IHNlbGVjdGVkICcgKyBzZWxlY3RlZC5vcmlnaW5hbE9iamVjdC5idXNlcl9maXJzdF9uYW1lKTsKICAgICAgJHNjb3BlLnNob3dFdmVudENsaWVudFNlbGVjdGVkID0gdHJ1ZTsKICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmR1c2VyX2lkID0gc2VsZWN0ZWQub3JpZ2luYWxPYmplY3QuYnVzaW5lc3NfdXNlcl9pZDsKICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5lbmR1c2VyX2ZpcnN0X25hbWUgPSBzZWxlY3RlZC5vcmlnaW5hbE9iamVjdC5idXNlcl9maXJzdF9uYW1lOwogICAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZHVzZXJfbGFzdF9uYW1lID0gc2VsZWN0ZWQub3JpZ2luYWxPYmplY3QuYnVzZXJfbGFzdF9uYW1lOwogICAgfSBlbHNlIHsKICAgICAgbG9nRGVidWcoJ25vdCBzZWxlY3RlZCcpOwovLyAkc2NvcGUuZXZlbnRDbGllbnREZVNlbGVjdGVkKCk7CiAgICB9CiAgfTsKICAkc2NvcGUuZXZlbnRDbGllbnREZVNlbGVjdGVkID0gZnVuY3Rpb24oKSB7CiAgICAkc2NvcGUuc2hvd0V2ZW50Q2xpZW50U2VsZWN0ZWQgPSBmYWxzZTsKICAgICRzY29wZS5uZXdFdmVudERldGFpbHMuZW5kdXNlcl9pZCA9IG51bGw7CiAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZHVzZXJfZmlyc3RfbmFtZSA9IG51bGw7CiAgICAkc2NvcGUubmV3RXZlbnREZXRhaWxzLmVuZHVzZXJfbGFzdF9uYW1lID0gbnVsbDsKICAgICRzY29wZS5jbGVhckNsaWVudElucHV0KCdjbGllbnRfYW5ndWNvbXBsZXRlJyk7CiAgfQoKICAkc2NvcGUuY2xlYXJDbGllbnRJbnB1dCA9IGZ1bmN0aW9uKGlkKSB7CiAgICBpZiAoaWQpIHsKICAgICAgJHNjb3BlLiRicm9hZGNhc3QoJ2FuZ3Vjb21wbGV0ZS1hbHQ6Y2xlYXJJbnB1dCcsIGlkKTsKICAgIH0KLy8gZWxzZXsKLy8gICAkc2NvcGUuJGJyb2FkY2FzdCgnYW5ndWNvbXBsZXRlLWFsdDpjbGVhcklucHV0Jyk7Ci8vIH0KICB9CgogICRzY29wZS5jYW5jZWwgPSBmdW5jdGlvbigpIHsKICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCcnKTsKICB9OwoKICAkc2NvcGUudXBkYXRlRXZlbnROYW1lQ2hlY2sgPSBmdW5jdGlvbihuZXdWYWx1ZSkKICB7CiAgICBsb2dEZWJ1ZygidXBkYXRlRXZlbnROYW1lPSIrbmV3VmFsdWUpOwogICAgaWYgKG5ld1ZhbHVlPT0iIikKICAgIHsKICAgICAgJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5ldmVudF9uYW1lID0gJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5vcmlnaW5hbF9ldmVudF9uYW1lOwogICAgfQogIH0KLy8gcmVzY2hlZHVsZUV2ZW50CiAgJHNjb3BlLnJlc2NoZWR1bGVFdmVudCA9IGZ1bmN0aW9uKCkgewogICAgbG9nRGVidWcoImZ1bmN0aW9uOiByZXNjaGVkdWxlRXZlbnQiKTsKCi8vIG5ld0V2ZW50SlNPTkRldGFpbHMgPSBKU09OLnN0cmluZ2lmeSgkc2NvcGUubmV3RXZlbnREZXRhaWxzLCBudWxsLCA0KTsgLy8gKE9wdGlvbmFsKSBiZWF1dGlmdWwgaW5kZW50ZWQgb3V0cHV0LgogICAgbG9nRGVidWcoInJlc2NoZWR1bGVFdmVudCwgIiArIEpTT04uc3RyaW5naWZ5KCRzY29wZS5uZXdFdmVudERldGFpbHMsIG51bGwsIDQpKTsKLy8gaWYgKCRzY29wZS5uZXdFdmVudERldGFpbHMuZXZlbnRSZWN1cnJpbmcpIHsKLy8gICBjcmVhdGVSZWN1cnJpbmdFdmVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLm5ld0V2ZW50RGV0YWlscyxjcmVhdGVSZWN1cnJpbmdFdmVudF9zdWNjZXNzKTsKLy8gICBmdW5jdGlvbiBjcmVhdGVSZWN1cnJpbmdFdmVudF9zdWNjZXNzKCkKLy8gICB7Ci8vICAgICBjYWxlbmRhciA9ICJjYWxlbmRhcl9idXNpbmVzcyI7Ci8vICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZWZldGNoRXZlbnRzJyk7Ci8vICAgICAkdWliTW9kYWxJbnN0YW5jZS5kaXNtaXNzKCk7Ci8vICAgICAvLyBlcnJvciB3YXMKLy8gICAgIC8vIGxvZ0RlYnVnKCJlcnJvciAiICsgZGF0YS5NZXNzYWdlKTsKLy8gICAgIC8vICRzY29wZS5hamF4X2Vycm9yID0gZGF0YS5NZXNzYWdlOwovLyAgIH0KLy8gfQovLyBlbHNlCiAgICB7Ci8vIGlmIGV2ZW50IGlzIG5vdCBjbGFzcywgYSBjbGllbnQgbXVzdCBiZSBzZWxlY3RlZAovLyBpZiAoKCEkc2NvcGUuc2hvd0V2ZW50Q2xpZW50U2VsZWN0ZWQpICYmICghJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pc19jbGFzcykpCi8vIHsKLy8gICAvLyBhbGVydCgnY2xpZW50IG11c3QgYmUgc2VsZWN0ZWQnKTsKLy8gICAkc2NvcGUuYWpheF9lcnJvcj0i15DXoNeQINeU15XXodejINee16nXqteq16Mg15zXntek15LXqSI7Ci8vICAgcmV0dXJuOwovLyB9CiAgICAgIHJlc2NoZWR1bGVFdmVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLnJlc2NoZWR1bGVfZXZlbnRfZGV0YWlscy5ldmVudF9pZCwkc2NvcGUubmV3RXZlbnREZXRhaWxzLHJlc2NoZWR1bGVFdmVudF9zdWNjZXNzKTsKICAgICAgZnVuY3Rpb24gcmVzY2hlZHVsZUV2ZW50X3N1Y2Nlc3MoKQogICAgICB7CiAgICAgICAgY2FsZW5kYXIgPSAiY2FsZW5kYXJfYnVzaW5lc3MiOwogICAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NhbGVuZGFyRXZlbnRSZXNjaGVkdWxlRGVzZWxlY3QnKTsgLy8gcGFzcyBvYmplY3QgaW4ge30gaWYgeW91IHdhbm5hIHRvIHBhc3MgYW55dGhpbmcKICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5kaXNtaXNzKCdhZGRlZCcpOwogICAgICB9Ci8vIG9uIGZhaWx1cmUgd2FzCi8vICRzY29wZS5hamF4X2Vycm9yID0gZGF0YS5NZXNzYWdlOwogICAgfQogIH07CgogICRzY29wZS5jcmVhdGVOZXdFdmVudCA9IGZ1bmN0aW9uKCkgewogICAgbG9nRGVidWcoImNyZWF0ZU5ld0V2ZW50IHN0YXJ0X3RpbWU9IisgdHlwZW9mICRzY29wZS5uZXdFdmVudERldGFpbHMuc3RhcnRfdGltZSk7CgogICAgbmV3RXZlbnRKU09ORGV0YWlscyA9IEpTT04uc3RyaW5naWZ5KCRzY29wZS5uZXdFdmVudERldGFpbHMsIG51bGwsIDQpOyAvLyAoT3B0aW9uYWwpIGJlYXV0aWZ1bCBpbmRlbnRlZCBvdXRwdXQuCiAgICBsb2dEZWJ1ZygiY3JlYXRlTmV3RXZlbnQsICIgKyBuZXdFdmVudEpTT05EZXRhaWxzKTsKICAgIGlmICgkc2NvcGUubmV3RXZlbnREZXRhaWxzLmV2ZW50UmVjdXJyaW5nKSB7CiAgICAgIGNyZWF0ZVJlY3VycmluZ0V2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUubmV3RXZlbnREZXRhaWxzLGNyZWF0ZVJlY3VycmluZ0V2ZW50X3N1Y2Nlc3MpOwogICAgICBmdW5jdGlvbiBjcmVhdGVSZWN1cnJpbmdFdmVudF9zdWNjZXNzKCkKICAgICAgewogICAgICAgIGNhbGVuZGFyID0gImNhbGVuZGFyX2J1c2luZXNzIjsKICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZWZldGNoRXZlbnRzJyk7CiAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuZGlzbWlzcygpOwovLyBlcnJvciB3YXMKLy8gbG9nRGVidWcoImVycm9yICIgKyBkYXRhLk1lc3NhZ2UpOwovLyAkc2NvcGUuYWpheF9lcnJvciA9IGRhdGEuTWVzc2FnZTsKICAgICAgfQogICAgfQogICAgZWxzZQogICAgewovLyBjaGVja2luZyBldmVudCB0aW1lIGxvZ2ljCiAgICAgIGlmICgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydGhvdXJzPiRzY29wZS5zZWxlY3RlZEV2ZW50LmVuZGhvdXJzKQogICAgICB7CiAgICAgICAgJHNjb3BlLmFqYXhfZXJyb3I9IteW157XnyDXlNeU16rXl9ec15Qg16nXnCDXlNee16TXktepINeQ15fXqNeZINeW157XnyDXlNeh15nXldedINep15zXlSI7CiAgICAgICAgcmV0dXJuOwogICAgICB9Ci8vIGNoZWNraW5nIGV2ZW50IHRpbWUgbG9naWMKICAgICAgaWYgKHBhcnNlSW50KCRzY29wZS5zZWxlY3RlZEV2ZW50LnN0YXJ0aG91cnMpPT1wYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRob3VycykpCiAgICAgIHsKICAgICAgICBpZiAocGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuc3RhcnRtaW51dGVzKT49cGFyc2VJbnQoJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcykpCiAgICAgICAgewogICAgICAgICAgJHNjb3BlLmFqYXhfZXJyb3I9IteW157XnyDXlNeU16rXl9ec15Qg16nXnCDXlNee16TXktepINeQ15fXqNeZINeW157XnyDXlNeh15nXldedINep15zXlSI7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGxvZ0RlYnVnKCIkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXM9Iiskc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpOwogICAgICAgIGxvZ0RlYnVnKCIkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzPSIrJHNjb3BlLnNlbGVjdGVkRXZlbnQuZW5kbWludXRlcyk7CiAgICAgICAgaWYgKChwYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5zdGFydG1pbnV0ZXMpKzUpPj1wYXJzZUludCgkc2NvcGUuc2VsZWN0ZWRFdmVudC5lbmRtaW51dGVzKSkKICAgICAgICB7CiAgICAgICAgICAkc2NvcGUuYWpheF9lcnJvcj0i15DXldeo15og15TXntek15LXqSDXl9eZ15nXkSDXnNeU15nXldeqINec16TXl9eV16ogNSDXk9en15XXqiI7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICB9Ci8vIGlmIGV2ZW50IGlzIG5vdCBjbGFzcywgYSBjbGllbnQgbXVzdCBiZSBzZWxlY3RlZAogICAgICBpZiAoKCEkc2NvcGUuc2hvd0V2ZW50Q2xpZW50U2VsZWN0ZWQpICYmICghJHNjb3BlLm5ld0V2ZW50RGV0YWlscy5pc19jbGFzcykgJiYgKCRzY29wZS5uZXdFdmVudERldGFpbHMuaXNfZ2VuZXJpY19ldHlwZT09MCkpCiAgICAgIHsKLy8gYWxlcnQoJ2NsaWVudCBtdXN0IGJlIHNlbGVjdGVkJyk7CiAgICAgICAgJHNjb3BlLmFqYXhfZXJyb3I9IteQ16DXkCDXlNeV16HXoyDXntep16rXqtejINec157XpNeS16kiOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBpZiAoJHNjb3BlLnNlbGVjdEV2ZW50VHlwZVNlbGVjdGVkLmV2ZW50X3R5cGVfaWQ9PTApCiAgICAgIHsKLy8gYWxlcnQoJ2NsaWVudCBtdXN0IGJlIHNlbGVjdGVkJyk7CiAgICAgICAgJHNjb3BlLmFqYXhfZXJyb3I9IteQ16DXkCDXkdeX16gg16HXldeSINee16TXktepICI7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGNyZWF0ZUV2ZW50KCRodHRwLCRzY29wZSwkc2NvcGUubmV3RXZlbnREZXRhaWxzLGNyZWF0ZUV2ZW50X3N1Y2Nlc3MpOwogICAgICBmdW5jdGlvbiBjcmVhdGVFdmVudF9zdWNjZXNzKCkKICAgICAgewogICAgICAgIGNhbGVuZGFyID0gImNhbGVuZGFyX2J1c2luZXNzIjsKICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZWZldGNoRXZlbnRzJyk7CiAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuZGlzbWlzcygnYWRkZWQnKTsKICAgICAgfQovLyBvbiBmYWlsdXJlIHdhcwovLyAkc2NvcGUuYWpheF9lcnJvciA9IGRhdGEuTWVzc2FnZTsKICAgIH0KICB9Cn0pOwovLy8vIGZmZmZmZmYKa3V6ZUFwcC5jb250cm9sbGVyKCdCdXNpbmVzc0NhbGVuZGFyQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsIHNoYXJlZFByb3BlcnRpZXMsICRjb21waWxlLCAkbG9jYXRpb24sIHVpQ2FsZW5kYXJDb25maWcsICR1aWJNb2RhbCwgc2hhcmVkRGF0YSkgewogIGluaXRpYWxFbmRVc2VyID0gc2hhcmVkRGF0YS5nZXRTZWxlY3RlZEVuZFVzZXIoKTsKICBsb2dEZWJ1ZygnQnVzaW5lc3NDYWxlbmRhciBDb250cm9sbGVyLCBzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCk9JyArIHNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKSk7CgogIGdldEJ1c2luZXNzTG9jYXRpb25zKCRodHRwLCRzY29wZSwnYnVzaW5lc3NfbG9jYXRpb25zJyk7CgogICRzY29wZS5zdGF0dXNlcyA9IFsgeyJzdGF0dXNfaWQiOiIwIiwic3RhdHVzX25hbWUiOiLXpNeq15XXlyJ9LCB7InN0YXR1c19pZCI6IjEiLCJzdGF0dXNfbmFtZSI6Iteh15LXldeoIn1dOwogICRzY29wZS50aGVkYXRhX3JlcG9ydCA9IHt9OwoKICAkc2NvcGUudGhlZGF0YV9yZXBvcnQuc291cmNlID0gImNhbGVuZGFyIjsKICAkc2NvcGUudGhlZGF0YV9yZXBvcnQuZmlsdGVycyA9IHsKICAgIGlzX2NhbmNlbGVkOiAiMCIKICB9OwoKICAkc2NvcGUudXBkYXRlRXZlbnRzID0gZnVuY3Rpb24oKQogIHsKICAgIGxvZ0RlYnVnKCJ1cGRhdGVFdmVudHMiKTsKICAgIGluc3RydWN0b3JfaWRfZmlsdGVyID0gbGlzdF90b19zdHJpbmdfYnlfdmFsdWUoJHNjb3BlLmNhbGVuZGFySW5zdHJ1Y3RvckZpbHRlciwgImJ1c2luZXNzX3VzZXJfaWQiICk7CiAgICBldmVudF90eXBlX2lkX2ZpbHRlciA9IGxpc3RfdG9fc3RyaW5nX2J5X3ZhbHVlKCRzY29wZS5jYWxlbmRhckV2ZW50VHlwZUZpbHRlciwgImV2ZW50X3R5cGVfaWQiICk7CiAgICBzdGF0dXNfZmlsdGVyID0gbGlzdF90b19zdHJpbmdfYnlfdmFsdWUoJHNjb3BlLmNhbGVuZGFyU3RhdHVzRmlsdGVyLCAic3RhdHVzX2lkIiApOwoKICAgICRzY29wZS50aGVkYXRhX3JlcG9ydC5maWx0ZXJzID0gewogICAgICBpbnN0cnVjdG9yX2lkOiBpbnN0cnVjdG9yX2lkX2ZpbHRlciwKICAgICAgZXZlbnRfdHlwZV9pZDogZXZlbnRfdHlwZV9pZF9maWx0ZXIsCiAgICAgIHN0YXR1czogc3RhdHVzX2ZpbHRlciwKICAgICAgaXNfY2FuY2VsZWQ6ICIwIgogICAgfTsKCiAgICAvLyBjb25zb2xlLmxvZygkc2NvcGUuY2FsZW5kYXIpOwogICAgbG9nRGVidWcoImJlZm9yZSByZWZldGNoRXZlbnRzIik7CiAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwogICAgbG9nRGVidWcoImFmdGVyIHJlZmV0Y2hFdmVudHMiKTsKICAgIC8vIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZWZldGNoRXZlbnRzJyk7CgogIH0KCiAgJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXI9ZmFsc2U7CgogIGlmIChzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkhPW51bGwpCiAgewogICAgY29uc29sZS5sb2coImdvdCBwcmV2aW91cyBzZWxlY3RlZCB1c2VyICIrc2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2VyX2ZpcnN0X25hbWUpOwogICAgJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJuYW1lPXNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKS5idXNlcl9maXJzdF9uYW1lKyIgIitzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfbGFzdF9uYW1lOwogICAgJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJfaWQ9c2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfdXNlcigpLmJ1c2luZXNzX3VzZXJfaWQ7CiAgICBsb2dEZWJ1ZygiJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJfaWQ9Iiskc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcl9pZCk7CgogICAgJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXI9dHJ1ZTsKICB9CgovLyBjaGVja2luZyBpZiBjYWxlbmRhciBzaG91bGQgc3RhcnQgd2l0aCBhIHNwZWNpZmljIGRhdGUgKGZyb20gdXJsIG9yIGZyb20gcHJldmlvdXNseSBzZWxlY3RlZCBkYXRlKQogIGxvZ0RlYnVnKCIkbG9jYXRpb24uc2VhcmNoKCkuc3RhcnQ9IiArICRsb2NhdGlvbi5zZWFyY2goKS5zdGFydCk7CiAgaWYgKHR5cGVvZiAkbG9jYXRpb24uc2VhcmNoKCkuc3RhcnQgIT0gJ3VuZGVmaW5lZCcpCiAgewogICAgY3VyckRlZmF1bHREYXRlID0gJGxvY2F0aW9uLnNlYXJjaCgpLnN0YXJ0OwogIH0KICBlbHNlIGlmIChzaGFyZWRQcm9wZXJ0aWVzLmdldF9jYWxlbmRhcl9kYXRlKCkhPW51bGwpCiAgewogICAgY29uc29sZS5sb2coImdvdCBwcmV2aW91cyBkYXRlICAiK3NoYXJlZFByb3BlcnRpZXMuZ2V0X2NhbGVuZGFyX2RhdGUoKSk7CiAgICBjdXJyRGVmYXVsdERhdGUgPSBzaGFyZWRQcm9wZXJ0aWVzLmdldF9jYWxlbmRhcl9kYXRlKCk7CiAgfQogIGVsc2UKICB7CiAgICBjdXJyRGVmYXVsdERhdGUgPSBuZXcgRGF0ZSgpOwogIH0KICBnZXRBbGxJbnN0cnVjdG9ycygkaHR0cCwkc2NvcGUsJ2J1c2luZXNzX2luc3RydWN0b3JzJyxnZXRBbGxJbnN0cnVjdG9yc19maW5pc2gpOwogIGdldEFsbEluc3RydWN0b3JzKCRodHRwLCRzY29wZSwnaW5zdHJ1Y3RvcnMnKTsKICBmdW5jdGlvbiBnZXRBbGxJbnN0cnVjdG9yc19maW5pc2goKQogIHsKLy8gY29uc29sZS5sb2coJHNjb3BlLmJ1c2luZXNzX2luc3RydWN0b3JzKTsKICAgICRzY29wZS5idXNpbmVzc19pbnN0cnVjdG9ycy51bnNoaWZ0KHsiYnVzZXJfZnVsbF9uYW1lIjoi15vXnCDXlNem15XXldeqIiwgImJ1c2VyX2ZpcnN0X25hbWUiOiLXm9eV15zXnSIsImJ1c2VyX2xhc3RfbmFtZSI6IiIsICJ1c2VyX2lkIjogMCwgImJ1c2luZXNzX3VzZXJfaWQiOiAwfSk7CgovLyBzZXR0aW5nIHNlbGVjdGVkIGdldF9zZWxlY3RlZF9pbnN0cnVjdG9yCiAgICAkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfaW5zdHJ1Y3Rvcj1mYWxzZTsKICAgIGlmIChzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF9pbnN0cnVjdG9yKCk+PTApCiAgICB7Ci8vIGNvbnNvbGUubG9nKCJnb3QgcHJldmlvdXMgc2VsZWN0ZWQgaW5zdHJ1Y3RvciAiK3NoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX2luc3RydWN0b3IoKSk7CiAgICAgICRzY29wZS5wcmV2aW91c19zZWxlY3RlZF9pbnN0cnVjdG9yX2lkPXNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX2luc3RydWN0b3IoKTsKICAgICAgJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX2luc3RydWN0b3I9dHJ1ZTsKICAgICAgJHNjb3BlLnNlbGVjdGVkX2J1c2luZXNzX3VzZXJfaWQ9c2hhcmVkUHJvcGVydGllcy5nZXRfc2VsZWN0ZWRfaW5zdHJ1Y3RvcigpOwogICAgfQogIH0KICBnZXRBbGxCdXNpbmVzc0V2ZW50VHlwZXMoJGh0dHAsJHNjb3BlLCdldmVudF90eXBlc19jYWxzJyk7CiAgZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzTm9TeXN0ZW0oJGh0dHAsJHNjb3BlLCdldmVudF90eXBlcycpOwoKLy8gc2V0dGluZyBzZWxlY3RlZCB1c2VyIGlkCiAgJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGU9ZmFsc2U7CiAgJHNjb3BlLnByZXZpb3VzX2V2ZW50X3Jlc2NoZWR1bGVfZXZlbnQ9bnVsbDsKCiAgJHNjb3BlLiRvbigiY2FsZW5kYXJFdmVudFJlc2NoZWR1bGVEZXNlbGVjdCIsZnVuY3Rpb24oZSxhKQogIHsKICAgICRzY29wZS5jYWxlbmRhckV2ZW50UmVzY2hlZHVsZURlc2VsZWN0KCk7CiAgfSk7CgovLyBkZXNlbGVjdGluZyBldmVudCBmcm9tIGJlaW5nIHJlc2NoZWR1bGVkCiAgJHNjb3BlLmNhbGVuZGFyRXZlbnRSZXNjaGVkdWxlRGVzZWxlY3Q9ZnVuY3Rpb24oKQogIHsKICAgIHNoYXJlZFByb3BlcnRpZXMuc2V0X2V2ZW50X3Jlc2NoZWR1bGUobnVsbCk7CiAgICAkc2NvcGUucHJldmlvdXNfZXZlbnRfcmVzY2hlZHVsZT1mYWxzZTsKICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZWZldGNoRXZlbnRzJyk7CiAgfQovLyBkZWxldGluZyBjbGllbnQgc2VsZWN0aW9uIGluIGNhbGVuZGFyCiAgJHNjb3BlLmNhbGVuZGFyQ2xpZW50RGVzZWxlY3Q9ZnVuY3Rpb24oKSAvLyByZWxvYWQgY2xhc3MvZXZlbnQgc3VnZ2VzdGlvbnMKICB7CiAgICAkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcj1mYWxzZTsKICAgIHNoYXJlZFByb3BlcnRpZXMuc2V0X3NlbGVjdGVkX3VzZXIobnVsbCk7CiAgICAkc2NvcGUuZXZlbnRUeXBlU2VsZWN0ZWQoKTsKICB9CiAgaWYgKGluaXRpYWxFbmRVc2VyICE9IG51bGwpIHsKICAgICRzY29wZS5idXNpbmVzc0NhbGVuZGFySW5pdGlhbE5hbWUgPSB0cnVlOwogICAgc2hhcmVkRGF0YS5zZXRTZWxlY3RlZEVuZFVzZXIobnVsbCk7CiAgICAkc2NvcGUuYnVzaW5lc3NDYWxlbmRhckluaXRpYWxzID0gewogICAgICBuYW1lOiBpbml0aWFsRW5kVXNlci5maXJzdF9uYW1lICsgIiAiICsgaW5pdGlhbEVuZFVzZXIubGFzdF9uYW1lCiAgICB9OwogIH0gZWxzZSB7CiAgICAkc2NvcGUuYnVzaW5lc3NDYWxlbmRhckluaXRpYWxOYW1lID0gZmFsc2U7CiAgfQogIC8qIGNvbmZpZyBvYmplY3QgKi8KICAkc2NvcGUuY2FsZW5kYXJfbmFtZSA9ICJjYWxlbmRhcl9idXNpbmVzcyI7CiAgJHNjb3BlLmNhbGVuZGFyID0gImNhbGVuZGFyX2J1c2luZXNzIjsKICAvKiBldmVudCBzb3VyY2VzIGFycmF5Ki8KCiAgLy8gdGhlZGF0YSA9IHsgc291cmNlOiAiY2FsZW5kYXIiIH0KICAvLyB0aGVkYXRhWydmaWx0ZXJzJ10gPSB7IGluc3RydWN0b3JfaWQ6ICIxOTUifTsKCiAgLy8gY29uc29sZS5sb2codGhlZGF0YSk7CgogICRzY29wZS5idXNpbmVzc0NhbGVuZGFyRXZlbnRTb3VyY2VzID0gW3sKICAgIC8vIHVybDogJy9hcGkvYWRtaW4vZXZlbnRzL2dldHBvc3QnLAogICAgdXJsOiAnL2FwaS9hZG1pbi9yZXBvcnRzL2V2ZW50czInLAogICAgZGF0YTogJHNjb3BlLnRoZWRhdGFfcmVwb3J0ICwKICAgIHR5cGU6ICdQT1NUJwogIH0sIHsKICAgIHVybDogJy9hcGkvYWRtaW4vY2FsZW5kYXIvbGltaXRhdGlvbnMvYmFja2dyb3VuZC9nZXRwb3N0JywKICAgIGRhdGE6ICRzY29wZS50aGVkYXRhX3JlcG9ydCAsCiAgICB0eXBlOiAnUE9TVCcgICAgLy8gfSwgewovLyAgICAgdXJsOiAnL2FwaS9hZG1pbi9yZWN1cnJpbmcvZ2V0cG9zdCcsCi8vICAgICB0eXBlOiAnUE9TVCcKICB9XTsKCiAgJHNjb3BlLmdvdG9Ub2RheSA9IGZ1bmN0aW9uKCkgewogICAgJHNjb3BlLmdvdG9EYXRlKG5ldyBEYXRlKCkpOwogICAgdmlzaWJsZURhdGVTdGFydCA9IG5ldyBEYXRlKHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3Jykuc3RhcnQpOwogICAgZGF0ZVRvR29UbyA9IHZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSArICItIiArICgnMCcgKyAodmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpICsgMSkpLnNsaWNlKC0yKSArICItIiArICgnMCcgKyB2aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSkuc2xpY2UoLTIpOwogICAgc2hhcmVkUHJvcGVydGllcy5zZXRfY2FsZW5kYXJfZGF0ZShkYXRlVG9Hb1RvKTsKICAgICRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0PXZpc2libGVEYXRlU3RhcnQ7CiAgICAkbG9jYXRpb24uc2VhcmNoKCdzdGFydCcsZGF0ZVRvR29Ubyk7CiAgfQoKICAkc2NvcGUuaW5zdHJ1Y3RvclNlbGVjdGVkPWZ1bmN0aW9uKHRoaXN0aGlzKQogIHsKICAgIHVwZGF0ZVN1Z2dlc3Rpb25zKCk7CiAgfQogICRzY29wZS5ldmVudFR5cGVTZWxlY3RlZD1mdW5jdGlvbih0aGlzdGhpcykKICB7CiAgICB1cGRhdGVTdWdnZXN0aW9ucygpOwogIH0KICBmdW5jdGlvbiB1cGRhdGVTdWdnZXN0aW9ucygpCiAgewogICAgbG9nRGVidWcoImZ1bmN0aW9uOiB1cGRhdGVTdWdnZXN0aW9ucyIpOwogICAgc2hhcmVkUHJvcGVydGllcy5zZXRfZXZlbnRfdHlwZV9mb3Jfc3VnZ2VzdGlvbnMoJHNjb3BlLnNlbGVjdGVkX2V2ZW50X3R5cGVfaWQpOwogICAgc2hhcmVkUHJvcGVydGllcy5zZXRfc2VsZWN0ZWRfaW5zdHJ1Y3Rvcigkc2NvcGUuc2VsZWN0ZWRfYnVzaW5lc3NfdXNlcl9pZCk7CiAgICBmb3IgKGk9MDtpPCRzY29wZS5ldmVudF90eXBlcy5sZW5ndGg7aSsrKQogICAgewovLyBjb25zb2xlLmxvZygkc2NvcGUuZXZlbnRfdHlwZXNbaV0uZXZlbnRfdHlwZV9pZCk7CiAgICAgIGlmICgkc2NvcGUuc2VsZWN0ZWRfZXZlbnRfdHlwZV9pZD09JHNjb3BlLmV2ZW50X3R5cGVzW2ldLmV2ZW50X3R5cGVfaWQpCiAgICAgIHsKLy8gY29uc29sZS5sb2coImZvdW5kIGV2ZW50IHR5cGUgaWQiKTsKICAgICAgICBpZiAoJHNjb3BlLmV2ZW50X3R5cGVzW2ldLmlzX2NsYXNzKSAvLyBpcyBjbGFzcwogICAgICAgIHsKICAgICAgICAgIGxvZ0RlYnVnKCIkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcj0iKyRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyKTsKICAgICAgICAgIGlmICgkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcikKICAgICAgICAgIHsKICAgICAgICAgICAgY29uc29sZS5sb2coImlzIGNsYXNzIHN1Z2dlc3Rpb25kIik7CiAgICAgICAgICAgICRodHRwLmdldCgkZ0FwaVVSTFByZWZpeCArICIvZW5kdXNlci9ldmVudHMvc3VnZ2VzdGNsYXNzLyIrJHNjb3BlLnNlbGVjdGVkX2V2ZW50X3R5cGVfaWQrIi8iKyRzY29wZS5zZWxlY3RlZF9idXNpbmVzc191c2VyX2lkKyIvIiskc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpKyIvIisoJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0TW9udGgoKSsxKSsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0RGF0ZSgpKyIvIiskc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXRIb3VycygpICsgIi8iICsgJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0TWludXRlcygpICsgIi8iICsgJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJfaWQpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRfZXZlbnRfdHlwZV9pZF9pc19jbGFzcz10cnVlOwogICAgICAgICAgICAgICRzY29wZS5ldmVudHNTdWdnZXN0ZWQgPSByZXNwb25zZS5kYXRhOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICAgIGVsc2UKICAgICAgICAgIHsKICAgICAgICAgICAgY29uc29sZS5sb2coIm5vdCBpcyBjbGFzcyBzdWdnZXN0aW9uZCIpOwogICAgICAgICAgICAkaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3RjbGFzcy8iKyRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkKyIvIiskc2NvcGUuc2VsZWN0ZWRfYnVzaW5lc3NfdXNlcl9pZCsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSsiLyIrKCRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkrMSkrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0SG91cnMoKSArICIvIiArICRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldE1pbnV0ZXMoKSArICIvMCIpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRfZXZlbnRfdHlwZV9pZF9pc19jbGFzcz10cnVlOwogICAgICAgICAgICAgICRzY29wZS5ldmVudHNTdWdnZXN0ZWQgPSByZXNwb25zZS5kYXRhOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZSAvLyBpcyBub3QgY2xhc3MKICAgICAgICB7CiAgICAgICAgICAkaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3QvIiskc2NvcGUuc2VsZWN0ZWRfZXZlbnRfdHlwZV9pZCsiLyIrJHNjb3BlLnNlbGVjdGVkX2J1c2luZXNzX3VzZXJfaWQrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCkrIi8iKygkc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpKzEpKyIvIiskc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXREYXRlKCkrIi8iKyRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0LmdldEhvdXJzKCkgKyAiLyIgKyAkc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXRNaW51dGVzKCkpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpCiAgICAgICAgICB7CiAgICAgICAgICAgICRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkX2lzX2NsYXNzPWZhbHNlOwogICAgICAgICAgICAkc2NvcGUuZXZlbnRzU3VnZ2VzdGVkID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KCiAgJHNjb3BlLmdvdG9OZXh0ID0gZnVuY3Rpb24oKSB7CiAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVtb3ZlRXZlbnRzJyk7CiAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignbmV4dCcpOwogICAgJHNjb3BlLnVwZGF0ZUNhbGVuZGFyQ2VudGVyVGl0bGUoKTsKLy8gYWRkaW5nIHRoZSBmb2xsb3dpbmcgdG8gbWFrZSB0aGUgdXJsCi8vIHBvaW50IHRvIHRoZSByaWdodCB3ZWVrLCBpZiBnb2luZyB0byBhIGRpZmZlcmVudCBVUkwgYW5kIHRoZW4gZ29pbmcgYmFjawogICAgdmlzaWJsZURhdGVTdGFydCA9IG5ldyBEYXRlKHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3Jykuc3RhcnQpOwogICAgZGF0ZVRvR29UbyA9IHZpc2libGVEYXRlU3RhcnQuZ2V0RnVsbFllYXIoKSArICItIiArICgnMCcgKyAodmlzaWJsZURhdGVTdGFydC5nZXRNb250aCgpICsgMSkpLnNsaWNlKC0yKSArICItIiArICgnMCcgKyB2aXNpYmxlRGF0ZVN0YXJ0LmdldERhdGUoKSkuc2xpY2UoLTIpOwogICAgc2hhcmVkUHJvcGVydGllcy5zZXRfY2FsZW5kYXJfZGF0ZShkYXRlVG9Hb1RvKTsKICAgICRzY29wZS52aXNpYmxlRGF0ZVN0YXJ0PXZpc2libGVEYXRlU3RhcnQ7CiAgICAkbG9jYXRpb24uc2VhcmNoKCdzdGFydCcsZGF0ZVRvR29Ubyk7CiAgfQogICRzY29wZS5nb3RvUHJldiA9IGZ1bmN0aW9uKCkgewogICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlbW92ZUV2ZW50cycpOwogICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3ByZXYnKTsKICAgICRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlKCk7Ci8vIGFkZGluZyB0aGUgZm9sbG93aW5nIHRvIG1ha2UgdGhlIHVybAovLyBwb2ludCB0byB0aGUgcmlnaHQgd2VlaywgaWYgZ29pbmcgdG8gYSBkaWZmZXJlbnQgVVJMIGFuZCB0aGVuIGdvaW5nIGJhY2sKICAgIHZpc2libGVEYXRlU3RhcnQgPSBuZXcgRGF0ZSh1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ2V0VmlldycpLnN0YXJ0KTsKICAgIGRhdGVUb0dvVG8gPSB2aXNpYmxlRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCkgKyAiLSIgKyAoJzAnICsgKHZpc2libGVEYXRlU3RhcnQuZ2V0TW9udGgoKSArIDEpKS5zbGljZSgtMikgKyAiLSIgKyAoJzAnICsgdmlzaWJsZURhdGVTdGFydC5nZXREYXRlKCkpLnNsaWNlKC0yKTsKICAgIHNoYXJlZFByb3BlcnRpZXMuc2V0X2NhbGVuZGFyX2RhdGUoZGF0ZVRvR29Ubyk7CiAgICAkc2NvcGUudmlzaWJsZURhdGVTdGFydD12aXNpYmxlRGF0ZVN0YXJ0OwogICAgJGxvY2F0aW9uLnNlYXJjaCgnc3RhcnQnLGRhdGVUb0dvVG8pOwoKICB9CiAgJHNjb3BlLmdvdG9EYXRlID0gZnVuY3Rpb24obmV3ZGF0ZSkgewogICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dvdG9EYXRlJywgbmV3ZGF0ZSk7CiAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVtb3ZlRXZlbnRzJyk7CiAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwogICAgJHNjb3BlLnVwZGF0ZUNhbGVuZGFyQ2VudGVyVGl0bGUoKTsKICB9CgogICRzY29wZS5lZGl0SG91cnNPZldvcmsgPSBmdW5jdGlvbigpIHsKLy8gcGFyYW0gc2hvdWxkIGxvb2sgbGlrZSAiMjAxNi0wNy0wMSIKICAgIHZpc2libGVEYXRlU3RhcnQgPSBuZXcgRGF0ZSh1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ2V0VmlldycpLnN0YXJ0KTsKICAgIGRhdGVUb0dvVG8gPSB2aXNpYmxlRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCkgKyAiLSIgKyAoJzAnICsgKHZpc2libGVEYXRlU3RhcnQuZ2V0TW9udGgoKSArIDEpKS5zbGljZSgtMikgKyAiLSIgKyAoJzAnICsgdmlzaWJsZURhdGVTdGFydC5nZXREYXRlKCkpLnNsaWNlKC0yKTsKICAgICRsb2NhdGlvbi5wYXRoKCcvaG91cnNfb2Zfd29yaycpLnNlYXJjaCh7CiAgICAgIHN0YXJ0OiBkYXRlVG9Hb1RvCiAgICB9KTsKICB9OwoKICAkc2NvcGUudXBkYXRlQ2FsZW5kYXJDZW50ZXJUaXRsZSA9IGZ1bmN0aW9uKCkgewogICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKTsKCiAgICB2aXNpYmxlRGF0ZVN0YXJ0ID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5zdGFydCk7CiAgICB2aXNpYmxlRGF0ZUVuZCA9IG5ldyBEYXRlKHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdnZXRWaWV3JykuZW5kKTsKCiAgICAkc2NvcGUuY2FsZW5kYXJUaXRsZUNlbnRlciA9IHZpc2libGVEYXRlU3RhcnQuZ2V0RGF0ZSgpICsgIiAiICsgbW9udGhOYW1lc1t2aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCldICsKICAgICAgICAiIOKAlCAiICsgdmlzaWJsZURhdGVFbmQuZ2V0RGF0ZSgpICsgIiAiICsgbW9udGhOYW1lc1t2aXNpYmxlRGF0ZUVuZC5nZXRNb250aCgpXSArCiAgICAgICAgIiAiICsgdmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpOwogIH07CgogICRzY29wZS5zaG93RXZlbnRQb3B1cCA9IGZ1bmN0aW9uKHNlbGVjdGVkRXZlbnQpIHsKICAgIHNob3dFdmVudFBvcHVwKHNlbGVjdGVkRXZlbnQsICR1aWJNb2RhbCkKICB9OwoKICAkc2NvcGUuZXZlbnRDcmVhdGVNb2RhbEZyb21TY2hlZHVsZXIgPSBmdW5jdGlvbihlc3VnZ2VzdCkKICB7Ci8vIGlmIGNsYXNzIC0gZ28gdG8gZXZlbnQgY2xhc3MKICAgIGNvbnNvbGUubG9nKGVzdWdnZXN0KTsKICAgIGZvciAoaT0wO2k8JHNjb3BlLmV2ZW50X3R5cGVzLmxlbmd0aDtpKyspCiAgICB7CiAgICAgIGlmIChlc3VnZ2VzdC5ldmVudF90eXBlX2lkPT0kc2NvcGUuZXZlbnRfdHlwZXNbaV0uZXZlbnRfdHlwZV9pZCkKICAgICAgewogICAgICAgIGlmICgkc2NvcGUuZXZlbnRfdHlwZXNbaV0uaXNfY2xhc3MpCiAgICAgICAgewogICAgICAgICAgY29uc29sZS5sb2coImlzIGNsYXNzIik7CiAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZj0nLyMvZXZlbnRfY2xhc3MvJyArIGVzdWdnZXN0LmV2ZW50X2lkOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgbG9nRGVidWcoSlNPTi5zdHJpbmdpZnkoZXN1Z2dlc3QpKTsKICAgIGxvZ0RlYnVnKGVzdWdnZXN0LnN0YXJ0X2Vwb2NoKTsKICAgIHN0YXJ0RGF0ZT1lc3VnZ2VzdC5zdGFydF9lcG9jaCoxMDAwOwoKICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewogICAgICBhbmltYXRpb246IGZhbHNlLAogICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9ldmVudF9jcmVhdGUucGhwJywKICAgICAgY29udHJvbGxlcjogJ2V2ZW50Q3JlYXRlTW9kYWxDb250cm9sbGVyJywKICAgICAgc2l6ZTogJ2wnLAogICAgICByZXNvbHZlOiB7CiAgICAgICAgc3RhcnREYXRlOiBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiBzdGFydERhdGU7CiAgICAgICAgfSwKICAgICAgICBldmVudF90eXBlX2lkOiBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiAkc2NvcGUuc2VsZWN0ZWRfZXZlbnRfdHlwZV9pZDsKICAgICAgICB9LAogICAgICAgIGxvY2F0aW9uX2lkOiBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiBlc3VnZ2VzdC5sb2NhdGlvbl9pZDsKICAgICAgICB9LAogICAgICAgIGVtcF9pZDogZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gZXN1Z2dlc3QuZW1wX2lkOwogICAgICAgIH0sCiAgICAgICAgcmVzY2hlZHVsZV9ldmVudDogZnVuY3Rpb24oKQogICAgICAgIHsKICAgICAgICAgIGlmICgkc2NvcGUucHJldmlvdXNfZXZlbnRfcmVzY2hlZHVsZSkKICAgICAgICAgIHsKICAgICAgICAgICAgcmV0dXJuICRzY29wZS5wcmV2aW91c19ldmVudF9yZXNjaGVkdWxlX2V2ZW50OwogICAgICAgICAgfQogICAgICAgICAgZWxzZQogICAgICAgICAgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICB9CiAgICB9KTsKCiAgfQogICRzY29wZS5ldmVudENyZWF0ZU1vZGFsID0gZnVuY3Rpb24oc3RhcnREYXRlLCBzaXplKSB7CiAgICBsb2dEZWJ1ZygiZXZlbnRDcmVhdGVNb2RhbCBzdGFydERhdGU9IitzdGFydERhdGUpOwoKICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewogICAgICBhbmltYXRpb246IGZhbHNlLAogICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9ldmVudF9jcmVhdGUucGhwJywKICAgICAgY29udHJvbGxlcjogJ2V2ZW50Q3JlYXRlTW9kYWxDb250cm9sbGVyJywKICAgICAgc2l6ZTogc2l6ZSwKICAgICAgcmVzb2x2ZTogewogICAgICAgIHN0YXJ0RGF0ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gc3RhcnREYXRlOwogICAgICAgIH0sCiAgICAgICAgZXZlbnRfdHlwZV9pZDogZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9LAogICAgICAgIGxvY2F0aW9uX2lkOiBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0sCiAgICAgICAgZW1wX2lkOiBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0sCiAgICAgICAgcmVzY2hlZHVsZV9ldmVudDogZnVuY3Rpb24oKQogICAgICAgIHsKICAgICAgICAgIGlmICgkc2NvcGUucHJldmlvdXNfZXZlbnRfcmVzY2hlZHVsZSkKICAgICAgICAgIHsKICAgICAgICAgICAgcmV0dXJuICRzY29wZS5wcmV2aW91c19ldmVudF9yZXNjaGVkdWxlX2V2ZW50OwogICAgICAgICAgfQogICAgICAgICAgZWxzZQogICAgICAgICAgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgIH0gICAgICAgICAgICAgICAgfQoKICAgICAgfQogICAgfSk7CgogICAgbW9kYWxJbnN0YW5jZS5yZXN1bHQudGhlbihmdW5jdGlvbihzZWxlY3RlZEl0ZW0pIHsKICAgICAgJHNjb3BlLnNlbGVjdGVkID0gc2VsZWN0ZWRJdGVtOwogICAgfSwgZnVuY3Rpb24oKSB7CiAgICAgIGxvZ0RlYnVnKCdNb2RhbCBkaXNtaXNzZWQgYXQ6ICcgKyBuZXcgRGF0ZSgpKTsKICAgIH0pOwogIH07CgovLy8KICAkc2NvcGUudXBkYXRlRXZlbnREYXRhYmFzZSA9IGZ1bmN0aW9uKHN0YXJ0X3BhcmFtLCBlbmRfcGFyYW0sIGV2ZW50X2lkLCB0aGVldmVudCkKICB7CgogICAgbG9nRGVidWcoInVwZGF0ZUV2ZW50RGF0YWJhc2Ugc3RhcnQ9IiArIHN0YXJ0X3BhcmFtICsgIiwgZW5kPSIgKyBlbmRfcGFyYW0gKyAiLCBldmVudF9pZD0iICsgZXZlbnRfaWQpOwogICAgdGhldXJsID0gJy9hcGkvYWRtaW4vZXZlbnRzL3NldC8nICsgZXZlbnRfaWQ7CgogICAgJGh0dHAoewogICAgICBtZXRob2Q6ICdQT1NUJywKICAgICAgdXJsOiB0aGV1cmwsCiAgICAgIGRhdGE6IHsKICAgICAgICBzdGFydF9kYXRlOiBzdGFydF9wYXJhbSwKICAgICAgICBlbmRfZGF0ZTogZW5kX3BhcmFtLAogICAgICAgIGV2ZW50X2lkOiBldmVudF9pZAogICAgICB9LAogICAgICBoZWFkZXJzOiB7CiAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uO2NoYXJzZXQ9dXRmLTgnCiAgICAgIH0KICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkgewoKICAgICAgbG9nRGVidWcoZGF0YSk7CiAgICAgIGlmIChkYXRhLkVycm9yKSB7CiAgICAgICAgbG9nRGVidWcoImVycm9yICIgKyBkYXRhLk1lc3NhZ2UpOwogICAgICAgIGFsZXJ0KCdlcnJvcicpOwogICAgICAgIGNhbGVuZGFyID0gImNhbGVuZGFyX2J1c2luZXNzIjsKICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZWZldGNoRXZlbnRzJyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbG9nRGVidWcoInN1Y2Nlc3MiKTsKICAgICAgICBjYWxlbmRhciA9ICJjYWxlbmRhcl9idXNpbmVzcyI7Ci8vIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKLy8gJHVpYk1vZGFsSW5zdGFuY2UuZGlzbWlzcygnYWRkZWQgYW5kIHJlZmV0Y2hFdmVudHMnKTsKICAgICAgfQogICAgfSk7CgogIH07Ci8vLwoKICAkc2NvcGUuY2xhc3NFdmVudEFkZFVzZXIgPSBmdW5jdGlvbihlc3VnZ2VzdCkKICB7CiAgICBjb25zb2xlLmxvZygiY2xhc3NFdmVudEFkZFVzZXIgb3IgUmVtb3ZlIik7CiAgICBpZiAoKGVzdWdnZXN0LmlzX3JlZ2lzdGVyZWQ9PTEpIHwgKChlc3VnZ2VzdC5pc193YWl0aW5nbGlzdD09MSkgJiYgKGVzdWdnZXN0LmlzX2NhbmNlbGVkPT0wKSkpCiAgICB7CiAgICAgIGNvbnNvbGUubG9nKCJuZWVkIHRvIHVucmVnaXN0ZXIiKTsKICAgICAgcmVtb3ZlRW5kVXNlckZyb21FdmVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJfaWQsZXN1Z2dlc3QuZXZlbnRfaWQscmVtb3ZlRW5kVXNlckZyb21FdmVudF9jYWxsYmFjaywgcmVtb3ZlRW5kVXNlckZyb21FdmVudF9jYWxsYmFjayk7CiAgICAgIGZ1bmN0aW9uIHJlbW92ZUVuZFVzZXJGcm9tRXZlbnRfY2FsbGJhY2soKQogICAgICB7CiAgICAgICAgJHNjb3BlLmV2ZW50VHlwZVNlbGVjdGVkKCk7CiAgICAgICAgY2FsZW5kYXIgPSAiY2FsZW5kYXJfYnVzaW5lc3MiOwogICAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKCiAgICAgIH0KICAgIH0KICAgIGVsc2UKICAgIHsKLy8gY29uc29sZS5sb2coZXN1Z2dlc3QuZXZlbnRfaWQpOwovLyBjb25zb2xlLmxvZygkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcl9pZCk7Ci8vIGlmIHNlbGVjdGVkIHVzZXIgLSBhZGRpbmcgaGltL2hlciB0byBjbGFzcwogICAgICBpZiAoJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXIpCiAgICAgIHsKICAgICAgICBhZGRFbmRVc2VyVG9FdmVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJfaWQsZXN1Z2dlc3QuZXZlbnRfaWQsYWRkRW5kVXNlclRvRXZlbnRfY2FsbGJhY2ssIGFkZEVuZFVzZXJUb0V2ZW50X2NhbGxiYWNrKTsKICAgICAgICBmdW5jdGlvbiBhZGRFbmRVc2VyVG9FdmVudF9jYWxsYmFjaygpCiAgICAgICAgewogICAgICAgICAgY2FsZW5kYXIgPSAiY2FsZW5kYXJfYnVzaW5lc3MiOwogICAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVmZXRjaEV2ZW50cycpOwogICAgICAgICAgJHNjb3BlLmV2ZW50VHlwZVNlbGVjdGVkKCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGVsc2UgLy8gZWxzZSAtIGdvaW5nIHRvIGNsYXNzIHBhZ2UKICAgICAgewogICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmPScvIy9ldmVudF9jbGFzcy8nICsgZXN1Z2dlc3QuZXZlbnRfaWQ7CiAgICAgIH0KICAgIH0KICB9CiAgJHNjb3BlLmNhbGVuZGFyX2J1c2luZXNzX2NvbmZpZyA9IHsKICAgIGNhbGVuZGFyOiB7CiAgICAgIGhlaWdodDogJ2F1dG8nLAogICAgICBlZGl0YWJsZTogdHJ1ZSwKLy8gaGVhZGVyOiB7Ci8vICAgICBsZWZ0OiAnJywKLy8gICAgIGNlbnRlcjogJycsCi8vICAgICByaWdodDogJycKLy8gfSwKLy8gaGVhZGVyOiB7Ci8vICAgICBsZWZ0OiAndGl0bGUnLAovLyAgICAgY2VudGVyOiAnJywKLy8gICAgIHJpZ2h0OiAndG9kYXkgcHJldixuZXh0JwovLyB9LAogICAgICB0aXRsZUZvcm1hdDogewovLyB3ZWVrOiAgImQgW01NTV17ICcmIzgyMTE7JyBkIE1NTX0iCiAgICAgIH0sCi8vIHRpdGxlRm9ybWF0OiB7Ci8vICAgICBtb250aDogJ01NTU0geXl5eScsCi8vICAgICB3ZWVrOiAiTU1NIGRbIHl5eXldeyAnJiM4MjEyOydbIE1NTV0gZCB5eXl5fSIsCi8vICAgICBkYXk6ICdNTS9kZCcKLy8gfSwKICAgICAgaGVhZGVyOiAnJywKLy8gZGVmYXVsdFZpZXc6ICdhZ2VuZGFXZWVrJywKLy8gdmlld3M6IHsKLy8gICAgIGRvbnRTaG93RGF0ZTogewovLyAgICAgICAgIHR5cGU6ICdhZ2VuZGFXZWVrJywKLy8gICAgICAgICBkdXJhdGlvbjogewovLyAgICAgICAgICAgICBkYXlzOiA3Ci8vICAgICAgICAgfSwKLy8gICAgICAgICB0aXRsZTogJ0FwZXJ0dXJhJywKLy8gICAgICAgICBjb2x1bW5Gb3JtYXQ6ICdkZGRkJyAvLyBGb3JtYXQgdGhlIGRheSB0byBvbmx5IHNob3cgbGlrZSAnTW9uZGF5JwovLyAgICAgICAgICAgICAvLyBoaWRkZW5EYXlzOiBbMCwgNl0gLy8gSGlkZSBTdW5kYXkgYW5kIFNhdHVyZGF5PwovLyAgICAgfQovLyB9LAovLyBzbG90RHVyYXRpb246ICcwMDoxNTowMCcsCiAgICAgIGV2ZW50RHJvcDogZnVuY3Rpb24oZXZlbnQsIGRheURlbHRhLCBtaW51dGVEZWx0YSwgYWxsRGF5LCByZXZlcnRGdW5jLCB1aUNhbGVuZGFyQ29uZmlnKSB7CiAgICAgICAgbG9nRGVidWcoImV2ZW50IGRyb3AiICsgZXZlbnQudGl0bGUgKyAiKCIgKyBldmVudC5pZCArICIpIG1vdmVkICIgKyBtaW51dGVEZWx0YSArICIgbWludXRlcyIpOwogICAgICAgIGxvZ0RlYnVnKCJvbGQgc3RhcnQ9IiArIGV2ZW50LnN0YXJ0ICsgIiwgb2xkIGVuZD0iICsgZXZlbnQuZW5kKTsKICAgICAgICAkc2NvcGUudXBkYXRlRXZlbnREYXRhYmFzZShldmVudC5zdGFydCwgZXZlbnQuZW5kLCBldmVudC5pZCwgZXZlbnQpOwogICAgICB9LAogICAgICBldmVudFJlc2l6ZTogZnVuY3Rpb24oZXZlbnQsIGRlbHRhLCByZXZlcnRGdW5jKSB7CiAgICAgICAgbG9nRGVidWcoImV2ZW50IHJlc2l6ZSIgKyBldmVudC50aXRsZSArICIoIiArIGV2ZW50LmlkICsgIikgbW92ZWQgIik7CiAgICAgICAgbG9nRGVidWcoIm9sZCBzdGFydD0iICsgZXZlbnQuc3RhcnQgKyAiLCBvbGQgZW5kPSIgKyBldmVudC5lbmQpOwogICAgICAgICRzY29wZS51cGRhdGVFdmVudERhdGFiYXNlKGV2ZW50LnN0YXJ0LCBldmVudC5lbmQsIGV2ZW50LmlkLCBldmVudCk7CiAgICAgIH0sCiAgICAgIGRlZmF1bHRWaWV3OiAnYWdlbmRhV2VlaycsCiAgICAgIGV2ZW50U3RhcnRFZGl0YWJsZTpmYWxzZSwKICAgICAgZXZlbnREdXJhdGlvbkVkaXRhYmxlOmZhbHNlLAogICAgICBkZWZhdWx0RGF0ZTogbW9tZW50KGN1cnJEZWZhdWx0RGF0ZSksCgovLyBkZWZhdWx0VmlldzogJ2RvbnRTaG93RGF0ZScsCiAgICAgIGV2ZW50Q2xpY2s6IGZ1bmN0aW9uKGNhbEV2ZW50LCBqc0V2ZW50LCB2aWV3KSB7CiAgICAgICAgbG9nRGVidWcoImNhbGVuZGFyIGV2ZW50IGNsaWNrZWQgIiArIGNhbEV2ZW50LnRpdGxlICsgIigiICsgY2FsRXZlbnQuaWQgKyAiKSAiICsgY2FsRXZlbnQuc3RhcnQgKyAiICIgKyBjYWxFdmVudC5lbmQpOwovLyBsb2dEZWJ1ZyhKU09OLnN0cmluZ2lmeShjYWxFdmVudCkpOwovLyBpZiBpdCdzIGEgZ2VuZXJpYyBldmVudCAodmFjYXRpb24gZXRjKQovLyBzaG93IHBvcHVwIHdpdGggb3B0aW9uIHRvIGRlbGV0ZQogICAgICAgIGlmIChjYWxFdmVudC5pc19nZW5lcmljX2V0eXBlPT0xKQogICAgICAgIHsKLy8gJHNjb3BlLnNob3dHZW5lcmljRXZlbnQoY2FsRXZlbnQpOwogICAgICAgICAgJHNjb3BlLnNob3dFdmVudFBvcHVwKGNhbEV2ZW50KTsKCiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAkc2NvcGUuc2hvd0V2ZW50UG9wdXAoY2FsRXZlbnQpOwogICAgICAgIH0KLy8gY2hhbmdlIHRoZSBib3JkZXIgY29sb3IganVzdCBmb3IgZnVuCi8vICQodGhpcykuY3NzKCdib3JkZXItY29sb3InLCAncmVkJyk7CgogICAgICB9LAogICAgICBkYXlDbGljazogZnVuY3Rpb24oZGF0ZSwganNFdmVudCwgdmlldykgewovLyBsb2dEZWJ1ZygibmV3IGV2ZW50IGNyZWF0aW9uIGNsaWNrZWQgIiArIGNhbEV2ZW50LnRpdGxlICsgIigiICsgY2FsRXZlbnQuaWQgKyAiKSAiICsgY2FsRXZlbnQuc3RhcnQgKyAiICIgKyBjYWxFdmVudC5lbmQpOwovLyAgICAgc3RhcnQgPSBkYXRlOwovLyAgICAgZW5kID0gbW9tZW50KHN0YXJ0KS5hZGQoNDUsICdtaW51dGVzJyk7CiAgICAgICAgaWYgKHZpZXcubmFtZSA9PT0gIm1vbnRoIikgewogICAgICAgICAgY2FsZW5kYXIgPSAiY2FsZW5kYXJfYnVzaW5lc3MiOwogICAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignY2hhbmdlVmlldycsICJhZ2VuZGFXZWVrIik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICRzY29wZS5ldmVudENyZWF0ZU1vZGFsKGRhdGUpOwogICAgICAgIH0KLy8gY2hhbmdlIHRoZSBib3JkZXIgY29sb3IganVzdCBmb3IgZnVuCi8vICQodGhpcykuY3NzKCdib3JkZXItY29sb3InLCAncmVkJyk7CgogICAgICB9LAogICAgICBldmVudFJlbmRlcjogZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpCiAgICAgIHsKICAgICAgICBpZiAoIWV2ZW50LmV2ZW50X2lkPjApCiAgICAgICAgewovLyBub3QgYSByZWFsIGV2ZW50IC0gcHJvYmFibHkgYmxvY2sgLyBiYWNrZ3JvdW5kCi8vIGlnbm9yaW5nIGl0CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQovLyBjaGFuZ2luZyBsb29rIGFuZCBmZWVsIG9mIGV2ZW4gdGhhdCBpcyB0byByZXNjaGVkdWxlCiAgICAgICAgaWYgKHNoYXJlZFByb3BlcnRpZXMuZ2V0X2V2ZW50X3Jlc2NoZWR1bGUoKSE9bnVsbCkKICAgICAgICB7CiAgICAgICAgICBpZiAoZXZlbnQuZXZlbnRfaWQ9PXNoYXJlZFByb3BlcnRpZXMuZ2V0X2V2ZW50X3Jlc2NoZWR1bGUoKS5ldmVudF9pZCkKICAgICAgICAgIHsKICAgICAgICAgICAgZWxlbWVudC5jc3MoJ2JhY2tncm91bmQtY29sb3InLCAnI0E5QTlBOQknKTsKICAgICAgICAgICAgZWxlbWVudC5jc3MoJ2JvcmRlci1jb2xvcicsICcjQTlBOUE5CScpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChldmVudC5pc19nZW5lcmljX2V0eXBlPT0xKQogICAgICAgIHsKCiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKGV2ZW50LmlzX2NsYXNzPT0xKQogICAgICAgIHsKLy8gaWYgY2xhc3MgYWRkaW5nIG51bWJlciBvZiBwYXJ0aWNpcGFudHMKICAgICAgICAgIGlmIChldmVudC5ub19vZl93YWl0aW5nX3VzZXJzPjApCiAgICAgICAgICB7CiAgICAgICAgICAgIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZChldmVudC5ub19vZl91c2VycysiLyIrZXZlbnQubWF4X3BhcnRpY2lwYW50cysgIiAoIitldmVudC5ub19vZl93YWl0aW5nX3VzZXJzKyIpIisiIC0gIik7CiAgICAgICAgICB9CiAgICAgICAgICBlbHNlCiAgICAgICAgICB7CiAgICAgICAgICAgIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZChldmVudC5ub19vZl91c2VycysiLyIrZXZlbnQubWF4X3BhcnRpY2lwYW50cysiIC0gIik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7Ci8vIGlmIG5vdCBjbGFzcyAtIHdyaXRpbmcgdGhlIGVuZHVzZXIgbmFtZQogICAgICAgICAgaWYgKGV2ZW50LmR1cmF0aW9uX2V2ZW50IT0wKSAvLyBhbHNvIGlmIG5vdCBob3VycyBvZiB3b3JrCiAgICAgICAgICB7Ci8vIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykuYXBwZW5kKCIgKCIrZXZlbnQuZXZlbnRVc2Vyc1swXS5idXNlcl9maXJzdF9uYW1lKyIgIitldmVudC5ldmVudFVzZXJzWzBdLmJ1c2VyX2xhc3RfbmFtZSsiKSIpOwovLyBjb25zb2xlLmxvZyhldmVudC5ldmVudFVzZXJzKTsKLy8gY29uc29sZS5sb2coZXZlbnQuZXZlbnRVc2Vycy5sZW5ndGgpOwogICAgICAgICAgICAvLyBpZiAoZXZlbnQuZXZlbnRVc2Vycy5sZW5ndGg+MCkKICAgICAgICAgICAgewogICAgICAgICAgICAgIC8vIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZCgiIitldmVudC5ldmVudFVzZXJzWzBdLmJ1c2VyX2ZpcnN0X25hbWUrIiAiK2V2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfbGFzdF9uYW1lKyIgKCIpOwogICAgICAgICAgICAgIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZCgiIitldmVudC5ldmVudF91c2VyX2NsaWVudHMrIiAoIik7CiAgICAgICAgICAgICAgZWxlbWVudC5maW5kKCcuZmMtdGl0bGUnKS5hcHBlbmQoIikiKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQovLyBsb2dEZWJ1ZygiaGVyZTQiKTsKICAgICAgICB9CiAgICAgICAgaWYgKGV2ZW50LmlzX3JlcGVhdGluZyA9PSAxKSB7CiAgICAgICAgICBlbGVtZW50LmZpbmQoIi5mYy10aXRsZSIpLmFwcGVuZCgiJm5ic3A7PGkgY2xhc3M9J2ZhIGZhLXJlcGVhdCc+PC9pPiZuYnNwOyIpOwovLyAgZWxlbWVudC5maW5kKCIuZmMtdGl0bGUiKS5hcHBlbmQoIiZuYnNwOzxpbWcgc3JjPScvcHVibGljL2ltYWdlcy9yZWN1cnJpbmctaWNvbi5wbmcnIHdpZHRoPScxMHB4JyBoZWlnaHQ9JzEwcHgnLz4iKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIG1pblRpbWU6ICRnQ2FsZW5kYXJEaXNwbGF5TWluVGltZSwKICAgICAgbWF4VGltZTogJGdDYWxlbmRhckRpc3BsYXlNYXhUaW1lLAogICAgICBzZWxlY3RhYmxlOiBmYWxzZSwKICAgICAgc2VsZWN0SGVscGVyOiBmYWxzZSwKICAgICAgdGltZXpvbmU6IGZhbHNlLAogICAgICBpc1JUTDogdHJ1ZSwKICAgICAgbGFuZzogImhlIiwgLy8ga2sKICAgICAgYWxsRGF5U2xvdDogZmFsc2UsCiAgICAgIGxvYWRpbmc6IGZ1bmN0aW9uKGJvb2wpIHsKICAgICAgICBpZiAoYm9vbCkgewogICAgICAgICAgbG9nRGVidWcoJ2xvYWRpbmcgY2FsZW5kYXIxICcgKyAkc2NvcGUuY2FsZW5kYXIpOwovLyAkKCcjbG9hZGluZycpLnNob3coKTsKICAgICAgICB9IGVsc2UgewovLyAkKCcjbG9hZGluZycpLmhpZGUoKTsKICAgICAgICAgIGxvZ0RlYnVnKCdmaW5pc2hlZCBsb2FkaW5nIGNhbGVuZGFyIHgnICsgJHNjb3BlLmNhbGVuZGFyKTsKICAgICAgICAgICRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlKCk7CiAgICAgICAgICBsb2dEZWJ1ZygiYWZ0ZXIgY2FsZW5kYXIgbG9hZCB2aXNpYmxlRGF0ZVN0YXJ0PSIrdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5zdGFydCk7CiAgICAgICAgICB2aXNpYmxlRGF0ZVN0YXJ0ID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5zdGFydCk7CiAgICAgICAgICBkYXRlVG9Hb1RvID0gdmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpICsgIi0iICsgKCcwJyArICh2aXNpYmxlRGF0ZVN0YXJ0LmdldE1vbnRoKCkgKyAxKSkuc2xpY2UoLTIpICsgIi0iICsgKCcwJyArIHZpc2libGVEYXRlU3RhcnQuZ2V0RGF0ZSgpKS5zbGljZSgtMik7Ci8vIGNvbnNvbGUubG9nKCJkYXRlVG9Hb1RvIitkYXRlVG9Hb1RvKTsKLy8gJGh0dHAuZ2V0KCRnQXBpVVJMUHJlZml4ICsgIi9lbmR1c2VyL2V2ZW50cy9zdWdnZXN0LyIrdmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpKyIvIit0aGlzX3dlZWtfZnVsbF95ZWFyKyIvIit0aGlzX3dlZWtfbW9udGgrIi8iK3RoaXNfd2Vla19kYXlfb2ZfbW9udGgrIi8iKyB0aGlzX3dlZWtfaG91cnMrICIvIiArIHRoaXNfd2Vla19taW51dGVzKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKQogICAgICAgICAgJHNjb3BlLmV2ZW50X3R5cGVfaWQ9JHNjb3BlLnNlbGVjdGVkX2V2ZW50X3R5cGVfaWQ7CiAgICAgICAgICAkc2NvcGUudmlzaWJsZURhdGVTdGFydD12aXNpYmxlRGF0ZVN0YXJ0OwovLzEyMTIxMgovLyBpZiAoJHNjb3BlLnNlbGVjdGVkX2V2ZW50X3R5cGVfaWRfaXNfY2xhc3MpCi8vIHsKLy8gICAkaHR0cC5nZXQoJGdBcGlVUkxQcmVmaXggKyAiL2VuZHVzZXIvZXZlbnRzL3N1Z2dlc3RjbGFzcy8iKyRzY29wZS5ldmVudF90eXBlX2lkKyIvIiskc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpKyIvIisoJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0TW9udGgoKSsxKSsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0RGF0ZSgpKyIvIiskc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXRIb3VycygpICsgIi8iICsgJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0TWludXRlcygpKyAiLyIgKyAkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcl9pZCkudGhlbihmdW5jdGlvbihyZXNwb25zZSkKLy8gICB7Ci8vICAgICAgIC8vCSAgICAkc2NvcGUubXlEYXRhID0gcmVzcG9uc2UuZGF0YTsKLy8gICAgICAgLy8JCWxvZ0RlYnVnKCJncmlkb3B0aW9ucz0iKyRzY29wZS5ncmlkT3B0aW9ucyk7Ci8vICAgICAgICRzY29wZS5ldmVudHNTdWdnZXN0ZWQgPSByZXNwb25zZS5kYXRhOwovLyAgICAgICAvLyAkc2NvcGUuZGF0ZVRvR29Ubz1kYXRlVG9Hb1RvOwovLyAgIH0pOwovLyB9Ci8vIGVsc2UKLy8gewovLyAgICRodHRwLmdldCgkZ0FwaVVSTFByZWZpeCArICIvZW5kdXNlci9ldmVudHMvc3VnZ2VzdC8iKyRzY29wZS5ldmVudF90eXBlX2lkKyIvIiskc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXRGdWxsWWVhcigpKyIvIisoJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0TW9udGgoKSsxKSsiLyIrJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0RGF0ZSgpKyIvIiskc2NvcGUudmlzaWJsZURhdGVTdGFydC5nZXRIb3VycygpICsgIi8iICsgJHNjb3BlLnZpc2libGVEYXRlU3RhcnQuZ2V0TWludXRlcygpKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKQovLyAgIHsKLy8gICAgICAgLy8JICAgICRzY29wZS5teURhdGEgPSByZXNwb25zZS5kYXRhOwovLyAgICAgICAvLwkJbG9nRGVidWcoImdyaWRvcHRpb25zPSIrJHNjb3BlLmdyaWRPcHRpb25zKTsKLy8gICAgICAgJHNjb3BlLmV2ZW50c1N1Z2dlc3RlZCA9IHJlc3BvbnNlLmRhdGE7Ci8vICAgICAgIC8vICRzY29wZS5kYXRlVG9Hb1RvPWRhdGVUb0dvVG87Ci8vICAgfSk7Ci8vIH0KCi8vIGFmdGVyIGNhbGVuZGFyIGlzIGxvYWRlZCAtIGxvYWRpbmcgZXZlbnQgdHlwZXMgYW5kIHN1Z2dlc3Rpb24gZm9yIHF1ZXVlcwovLyB3ZSBoYW5kbGUgdGhpbmdzIHJlbGF0ZWQgdG8gdGhlIGV2ZW50IHR5cGVzIG9ubHkgYWZ0ZXIgbG9hZGluZyB0aGVtIChhbmQgdGhlIGNhbGVuZGFyKQogICAgICAgICAgZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzTm9TeXN0ZW0oJGh0dHAsJHNjb3BlLCdldmVudF90eXBlcycsZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzTm9TeXN0ZW1fY2FsbGJhY2spOwoKICAgICAgICAgIGZ1bmN0aW9uIGdldEFsbEJ1c2luZXNzRXZlbnRUeXBlc05vU3lzdGVtX2NhbGxiYWNrKCkKICAgICAgICAgIHsgICAgLy8gY2hlY2tpbmcgaWYgY2FsZW5kYXIgc2hvdWxkIHN0YXJ0IHdpdGggYSBzcGVjaWZpYyBldmVudCB0eXBlIGZvciBzdWdnZXN0aW9ucwovLyBsb2dEZWJ1ZygiWCBzaGFyZWRQcm9wZXJ0aWVzLmdldF9ldmVudF90eXBlX2Zvcl9zdWdnZXN0aW9ucz0iK3NoYXJlZFByb3BlcnRpZXMuZ2V0X2V2ZW50X3R5cGVfZm9yX3N1Z2dlc3Rpb25zKCkpOwogICAgICAgICAgICBpZiAoc2hhcmVkUHJvcGVydGllcy5nZXRfZXZlbnRfdHlwZV9mb3Jfc3VnZ2VzdGlvbnMoKSE9bnVsbCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkPXNoYXJlZFByb3BlcnRpZXMuZ2V0X2V2ZW50X3R5cGVfZm9yX3N1Z2dlc3Rpb25zKCk7CiAgICAgICAgICAgICAgJHNjb3BlLmV2ZW50VHlwZVNlbGVjdGVkKCRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkKTsKICAgICAgICAgICAgfQoKLy8gZmlyc3QgY2hlY2tpbmcgaWYgdGhlcmUncyBhbiBldmVudCB0byByZXNjaGVkdWxlCiAgICAgICAgICAgIGlmIChzaGFyZWRQcm9wZXJ0aWVzLmdldF9ldmVudF9yZXNjaGVkdWxlKCkhPW51bGwpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAkc2NvcGUucHJldmlvdXNfZXZlbnRfcmVzY2hlZHVsZT10cnVlOwogICAgICAgICAgICAgICRzY29wZS5wcmV2aW91c19ldmVudF9yZXNjaGVkdWxlX2V2ZW50PXNoYXJlZFByb3BlcnRpZXMuZ2V0X2V2ZW50X3Jlc2NoZWR1bGUoKTsKICAgICAgICAgICAgICBzaGFyZWRQcm9wZXJ0aWVzLnNldF9ldmVudF9yZXNjaGVkdWxlKG51bGwpOwogICAgICAgICAgICAgIGxvZ0RlYnVnKCJnb3QgZXZlbnQgdG8gcmVzY2hlZHVsZSAiK0pTT04uc3RyaW5naWZ5KCRzY29wZS5wcmV2aW91c19ldmVudF9yZXNjaGVkdWxlX2V2ZW50KSk7CiAgICAgICAgICAgICAgbG9nRGVidWcoInJlc2NoZWR1bGUgZXZlbnRfdHlwZV9pZD0iKyRzY29wZS5wcmV2aW91c19ldmVudF9yZXNjaGVkdWxlX2V2ZW50LmV2ZW50X3R5cGVfaWQpOwogICAgICAgICAgICAgICRzY29wZS5zZWxlY3RlZF9ldmVudF90eXBlX2lkPSRzY29wZS5wcmV2aW91c19ldmVudF9yZXNjaGVkdWxlX2V2ZW50LmV2ZW50X3R5cGVfaWQ7CiAgICAgICAgICAgICAgJHNjb3BlLmV2ZW50VHlwZVNlbGVjdGVkKCk7CiAgICAgICAgICAgIH0KLy8gY2hlY2tpbmcgc2VsZWN0ZWQgdXNlciBvbmx5IGlmIHRoZXJlJ3Mgbm8gc2VsZWN0ZWQgZXZlbnQgdG8gbW92ZQogICAgICAgICAgICBlbHNlIGlmIChzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkhPW51bGwpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBjb25zb2xlLmxvZygiZ290IHByZXZpb3VzIHNlbGVjdGVkIHVzZXIgIitzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfZmlyc3RfbmFtZSk7CiAgICAgICAgICAgICAgJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXJuYW1lPXNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKS5idXNlcl9maXJzdF9uYW1lKyIgIitzaGFyZWRQcm9wZXJ0aWVzLmdldF9zZWxlY3RlZF91c2VyKCkuYnVzZXJfbGFzdF9uYW1lOwogICAgICAgICAgICAgICRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyX2lkPXNoYXJlZFByb3BlcnRpZXMuZ2V0X3NlbGVjdGVkX3VzZXIoKS5idXNpbmVzc191c2VyX2lkOwogICAgICAgICAgICAgIGxvZ0RlYnVnKCIkc2NvcGUucHJldmlvdXNfc2VsZWN0ZWRfdXNlcl9pZD0iKyRzY29wZS5wcmV2aW91c19zZWxlY3RlZF91c2VyX2lkKTsKCiAgICAgICAgICAgICAgJHNjb3BlLnByZXZpb3VzX3NlbGVjdGVkX3VzZXI9dHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgIH0sCi8vIHNlbGVjdDogZnVuY3Rpb24oc3RhcnQsIGVuZCwgYWxsRGF5KSB7Ci8vICAgICAvLyB2YXIgdGl0bGUgPSBwcm9tcHQoJ0V2ZW50IFRpdGxlOicgKyAoc3RhcnQgKyAzNTI4MDAwMDApIC8gKDYwICogMTAwMCkgKyAiICIgKyBlbmQgKyAiICIgKyBhbGxEYXkpOwovLyAgICAgdGl0bGUgPSAi16nXoteV16og16TXoteZ15zXldeqIjsKLy8gICAgIGlmICh0aXRsZSkgewovLyAgICAgICAgIGxvZ0RlYnVnKCJjcmVhdGluZyBkZXZlbnQgc3RhcnQiKTsKLy8gICAgICAgICBsb2dEZWJ1Zygic3RhcnQ9IiArIHN0YXJ0KTsKLy8gICAgICAgICBjaGVja0RhdGUgPSBuZXcgRGF0ZShzdGFydCk7Ci8vICAgICAgICAgbG9nRGVidWcoImNoZWNrIGRhdGUgPSAiICsgY2hlY2tEYXRlKQovLyAgICAgICAgIGxvZ0RlYnVnKCJlbmQ9IiArIGVuZCk7Ci8vICAgICAgICAgZWNvbG9yID0gIiMiICsgJHNjb3BlLmV2ZW50Q29sb3I7IC8vZ2V0UmFuZG9tQ29sb3IoKTsKLy8KLy8KLy8gICAgICAgICAvLyB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tdLmZ1bGxDYWxlbmRhcigncmVyZW5kZXJFdmVudHMnKTsKLy8KLy8gICAgICAgICBjYWxlbmRhciA9ICRzY29wZS5jYWxlbmRhcl9uYW1lOwovLyAgICAgICAgIHRlbXBfbGltaXRfaWQgPSAkZ0NhbGVuZGFyVGVtcEVudklEMSAtIGdldFJhbmRvbUludCgxMCwgODApOwovLyAgICAgICAgIG5ld0V2ZW50ID0gewovLyAgICAgICAgICAgICBpZDogdGVtcF9saW1pdF9pZCwKLy8gICAgICAgICAgICAgdGl0bGU6IHRpdGxlLAovLyAgICAgICAgICAgICBzdGFydDogc3RhcnQsCi8vICAgICAgICAgICAgIGNvbG9yOiBlY29sb3IsCi8vICAgICAgICAgICAgIGVuZDogZW5kLAovLyAgICAgICAgICAgICBhbGxEYXk6IGZhbHNlLAovLyAgICAgICAgICAgICBjbGFzc05hbWU6IFsnb3BlblNlc2FtZSddCi8vICAgICAgICAgICAgICAgICAvLyBjb2xvcjogcmVzb3VyY2UuZXZlbnRDb2xvcgovLyAgICAgICAgIH07Ci8vICAgICAgICAgY2FsZW5kYXIgPSAkc2NvcGUuY2FsZW5kYXJfbmFtZTsKLy8KLy8gICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZW5kZXJFdmVudCcsIG5ld0V2ZW50LCB0cnVlKTsKLy8gICAgICAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCd1bnNlbGVjdCcpOwovLwovLyAgICAgICAgIGxvZ0RlYnVnKCJjcmVhdGluZyBkZXZlbnQgZW5kIik7Ci8vICAgICAgICAgJHNjb3BlLmFkZEV2ZW50VG9EYXRhYmFzZShzdGFydCwgZW5kLCB0aXRsZSwgZWNvbG9yLCB0ZW1wX2xpbWl0X2lkKTsKLy8KLy8gICAgIH0KLy8gfQogICAgfQogIH07Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignSG91cnNPZldvcmtDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGNvbXBpbGUsICRsb2NhdGlvbiwgdWlDYWxlbmRhckNvbmZpZywgJHVpYk1vZGFsKSB7CiAgbG9nRGVidWcoJ0hvdXJzT2ZXb3JrIENvbnRyb2xsZXInKTsKCiAgbG9nRGVidWcoIiRsb2NhdGlvbi5zZWFyY2goKS5zdGFydD0iICsgJGxvY2F0aW9uLnNlYXJjaCgpLnN0YXJ0KTsKICBpZiAodHlwZW9mICRsb2NhdGlvbi5zZWFyY2goKS5zdGFydCA9PSAndW5kZWZpbmVkJykgewogICAgY3VyckRlZmF1bHREYXRlID0gJGdIb3VyMGRhdGU7CiAgICAkc2NvcGUuZml4ZWRTY2hlZHVsZSA9IHRydWU7CiAgICAkc2NvcGUuY2FsZW5kYXJUaXRsZUNlbnRlciA9ICLXqdei15XXqiDXpNei15nXnNeV16og16fXkdeV16LXldeqIjsKICAgIGxvZ0RlYnVnKCLXqdei15XXqiDXpNei15nXnNeV16og16fXkdeV16LXldeqIik7CiAgICBob3Vyc09mV29ya0RlZmF1bHRWaWV3PSdkb250U2hvd0RhdGUnOwogIH0gZWxzZSB7CiAgICBjdXJyRGVmYXVsdERhdGUgPSAkbG9jYXRpb24uc2VhcmNoKCkuc3RhcnQ7CiAgICAkc2NvcGUuZml4ZWRTY2hlZHVsZSA9IGZhbHNlOwovLyAkc2NvcGUuY2FsZW5kYXJUaXRsZUNlbnRlciA9ICLXqdei15XXqiDXpNei15nXnNeV16og16fXkdeV16LXldeqIjsKICAgIGhvdXJzT2ZXb3JrRGVmYXVsdFZpZXc9J2FnZW5kYVdlZWsnOwogIH0KCgogICRzY29wZS52aXNpYmxlRGF0ZSA9IFtdOwogICRzY29wZS5jYWxlbmRhciA9ICdjYWxlbmRhcl9ob3Vyc19vZl93b3JrJzsKICAkc2NvcGUuc2VsZWN0ZWRFdmVudFR5cGUgPSBbXTsKCiAgZ2V0QWxsQnVzaW5lc3NFdmVudFR5cGVzKCRodHRwLCRzY29wZSwnZXZlbnRfdHlwZXMnLGdldEFsbEJ1c2luZXNzRXZlbnRUeXBlc19jYWxsYmFjayk7CgogIGZ1bmN0aW9uIGdldEFsbEJ1c2luZXNzRXZlbnRUeXBlc19jYWxsYmFjaygpCiAgewogICAgJHNjb3BlLnNlbGVjdEV2ZW50VHlwZSgkc2NvcGUuZXZlbnRfdHlwZXNbMF0pOwogIH0KICAkc2NvcGUuYmFja1RvQ2FsZW5kYXIgPSBmdW5jdGlvbigpIHsKICAgIHZpc2libGVEYXRlU3RhcnQgPSBuZXcgRGF0ZSh1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ2V0VmlldycpLnN0YXJ0KTsKICAgIGRhdGVUb0dvVG8gPSB2aXNpYmxlRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCkgKyAiLSIgKyAoJzAnICsgKHZpc2libGVEYXRlU3RhcnQuZ2V0TW9udGgoKSArIDEpKS5zbGljZSgtMikgKyAiLSIgKyAoJzAnICsgdmlzaWJsZURhdGVTdGFydC5nZXREYXRlKCkpLnNsaWNlKC0yKTsKICAgICRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfY2FsZW5kYXInKS5zZWFyY2goewogICAgICBzdGFydDogZGF0ZVRvR29UbwogICAgfSk7CiAgfQogICRzY29wZS5zZWxlY3RFdmVudFR5cGUgPSBmdW5jdGlvbihldmVudFR5cGUpIHsKICAgICRzY29wZS5zZWxlY3RlZEV2ZW50VHlwZSA9IGV2ZW50VHlwZTsKICAgIGxvZ0RlYnVnKCJzZWxlY3RlZCBFdmVudCBUeXBlID0gIiArICRzY29wZS5zZWxlY3RlZEV2ZW50VHlwZS5ldmVudF90eXBlX2lkICsgIiwgIiArICRzY29wZS5zZWxlY3RlZEV2ZW50VHlwZS5ldmVudF90eXBlX25hbWUpOwogICAga3V6ZUlzQ2FsZW5kYXJEcmFnZ2JsZSA9ICRzY29wZS5zZWxlY3RlZEV2ZW50VHlwZS5kaWZmX3JhbmdlOwogIH07CgogICRzY29wZS5jaGFuZ2VFdmVudENvbG9yID0gZnVuY3Rpb24obmV3Q29sb3IpIHsKICAgICRzY29wZS5ldmVudENvbG9yID0gbmV3Q29sb3I7CiAgICBhbGxsRXZlbnRzQXJyYXkgPSB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1tjYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdjbGllbnRFdmVudHMnKTsKICAgIGZvciAoaSBpbiBhbGxsRXZlbnRzQXJyYXkpIHsKICAgICAgYWxsbEV2ZW50c0FycmF5W2ldLmNvbG9yID0gIiMiICsgbmV3Q29sb3I7CiAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3VwZGF0ZUV2ZW50JywgYWxsbEV2ZW50c0FycmF5W2ldKTsKICAgIH0KICB9OwoKICAkc2NvcGUuZXZlbnRDbGlja01vZHVsZSA9IGZ1bmN0aW9uKHNlbGVjdGVkRXZlbnQsIHNpemUpIHsKICAgIGxvZ0RlYnVnKCJzZWxlY3RlZCBFdmVudCB0aXRsZT0iICsgc2VsZWN0ZWRFdmVudC50aXRsZSk7CgoKICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewogICAgICBhbmltYXRpb246IGZhbHNlLAogICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9saW1pdGF0aW9uX2RldGFpbHMuaHRtbCcsCiAgICAgIGNvbnRyb2xsZXI6ICdldmVudERldGFpbHNIb3Vyc09mV29ya01vZGFsQ29udHJvbGxlcicsCiAgICAgIHNpemU6IHNpemUsCiAgICAgIHJlc29sdmU6IHsKICAgICAgICBzZWxlY3RlZEV2ZW50OiBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiBzZWxlY3RlZEV2ZW50OwogICAgICAgIH0sCiAgICAgICAgZml4ZWRTY2hlZHVsZTogZnVuY3Rpb24gKCkKICAgICAgICB7CiAgICAgICAgICByZXR1cm4gJHNjb3BlLmZpeGVkU2NoZWR1bGU7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKCiAgICBtb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHNlbGVjdGVkSXRlbSkgewogICAgICAkc2NvcGUuc2VsZWN0ZWQgPSBzZWxlY3RlZEl0ZW07CiAgICB9LCBmdW5jdGlvbigpIHsKICAgICAgbG9nRGVidWcoJ01vZGFsIGRpc21pc3NlZCBhdDogJyArIG5ldyBEYXRlKCkpOwogICAgfSk7CiAgfTsKCgogIHZhciBkYXRlID0gbmV3IERhdGUoKTsKICB2YXIgZCA9IGRhdGUuZ2V0RGF0ZSgpOwogIHZhciBtID0gZGF0ZS5nZXRNb250aCgpOwogIHZhciB5ID0gZGF0ZS5nZXRGdWxsWWVhcigpOwoKCiAgZnVuY3Rpb24gZ2V0VGltZVN0YW1wKG5vdykgewogICAgcmV0dXJuICgobm93LmdldE1vbnRoKCkgKyAxKSArICcvJyArIChub3cuZ2V0RGF0ZSgpKSArICcvJyArIG5vdy5nZXRGdWxsWWVhcigpICsgIiAiICsgbm93LmdldEhvdXJzKCkgKyAnOicgKyAoKG5vdy5nZXRNaW51dGVzKCkgPCAxMCkgPyAoIjAiICsgbm93LmdldE1pbnV0ZXMoKSkgOiAobm93LmdldE1pbnV0ZXMoKSkpICsgJzonICsgKChub3cuZ2V0U2Vjb25kcygpIDwgMTApID8gKCIwIiArIG5vdwogICAgICAgIC5nZXRTZWNvbmRzKCkpIDogKG5vdy5nZXRTZWNvbmRzKCkpKSk7CiAgfQoKCiAgLyogQ2hhbmdlIFZpZXcgKi8KICAkc2NvcGUuY2hhbmdlVmlldyA9IGZ1bmN0aW9uKHZpZXcsIGNhbGVuZGFyKSB7CiAgICBsb2dEZWJ1ZygiY2hhbmdlIHZpZXcgIiArIHZpZXcpOwogICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignY2hhbmdlVmlldycsIHZpZXcpOwogIH07CiAgLyogQ2hhbmdlIFZpZXcgKi8KCiAgJHNjb3BlLnJlbmRlckNhbGVuZGVyID0gZnVuY3Rpb24oY2FsZW5kYXIpIHsKICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICBpZiAodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdKSB7CiAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVuZGVyJyk7CiAgICAgIH0KICAgIH0pOwogIH07CgogICRzY29wZS5jaGFuZ2VTZWxlY3RhYmxlID0gZnVuY3Rpb24oKSB7CiAgICBrdXplSXNDYWxlbmRhckRyYWdnYmxlID0gIWt1emVJc0NhbGVuZGFyRHJhZ2dibGU7CiAgICBjYWxlbmRhciA9ICdjYWxlbmRhcl9ob3Vyc19vZl93b3JrJzsKLy8gdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ2V0VmlldycpLmNhbGVuZGFyLm9wdGlvbnMuc2VsZWN0YWJsZSA9IGZhbHNlOwogICAgdmlldyA9IHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ29wdGlvbicsICdzZWxlY3RhYmxlJywgZmFsc2UpOwovLyB2aWV3LmNhbGVuZGFyLm9wdGlvbnMuc2VsZWN0YWJsZSA9IGZhbHNlOwogICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVuZGVyJyk7CgogIH0KICAvKiBjb25maWcgb2JqZWN0ICovCgogICRzY29wZS5jYWxlbmRhcl9ob3Vyc19vZl93b3JrX2NvbmZpZyA9IHsKICAgIGNhbGVuZGFyOiB7CiAgICAgIGhlaWdodDogJ2F1dG8nLAogICAgICBlZGl0YWJsZTogdHJ1ZSwKLy8gaGVhZGVyOiB7Ci8vICAgICBsZWZ0OiAnJywKLy8gICAgIGNlbnRlcjogJycsCi8vICAgICByaWdodDogJycKLy8gfSwKICAgICAgaGVhZGVyOiAnJywKLy8gaGVhZGVyOiB7Ci8vICAgICBsZWZ0OiAndGl0bGUnLAovLyAgICAgY2VudGVyOiAnJywKLy8gICAgIHJpZ2h0OiAndG9kYXkgcHJldixuZXh0JwovLyB9LAovLyBkZWZhdWx0VmlldzogJ2FnZW5kYVdlZWsnLAogICAgICB2aWV3czogewogICAgICAgIGRvbnRTaG93RGF0ZTogewogICAgICAgICAgdHlwZTogJ2FnZW5kYVdlZWsnLAogICAgICAgICAgZHVyYXRpb246IHsKICAgICAgICAgICAgZGF5czogNwogICAgICAgICAgfSwKICAgICAgICAgIHRpdGxlOiAnQXBlcnR1cmEnLAogICAgICAgICAgY29sdW1uRm9ybWF0OiAnZGRkZCcgLy8gRm9ybWF0IHRoZSBkYXkgdG8gb25seSBzaG93IGxpa2UgJ01vbmRheScKLy8gaGlkZGVuRGF5czogWzAsIDZdIC8vIEhpZGUgU3VuZGF5IGFuZCBTYXR1cmRheT8KICAgICAgICB9LAogICAgICAgIGRvU2hvd0RhdGU6IHsKICAgICAgICAgIHR5cGU6ICdhZ2VuZGFXZWVrJywKICAgICAgICAgIGR1cmF0aW9uOiB7CiAgICAgICAgICAgIGRheXM6IDcKICAgICAgICAgIH0sCiAgICAgICAgICB0aXRsZTogJ0FwZXJ0dXJhJywKCi8vIGhpZGRlbkRheXM6IFswLCA2XSAvLyBIaWRlIFN1bmRheSBhbmQgU2F0dXJkYXk/CiAgICAgICAgfQogICAgICB9LAogICAgICBldmVudERyb3A6IGZ1bmN0aW9uKGV2ZW50LCBkYXlEZWx0YSwgbWludXRlRGVsdGEsIGFsbERheSwgcmV2ZXJ0RnVuYywgdWlDYWxlbmRhckNvbmZpZykgewogICAgICAgIGxvZ0RlYnVnKCJldmVudGRyb3AiICsgZXZlbnQudGl0bGUgKyAiKCIgKyBldmVudC5pZCArICIpIG1vdmVkICIgKyBtaW51dGVEZWx0YSArICIgbWludXRlcyIpOwogICAgICAgIGxvZ0RlYnVnKCJvbGQgc3RhcnQ9IiArIGV2ZW50LnN0YXJ0ICsgIiwgb2xkIGVuZD0iICsgZXZlbnQuZW5kKTsKICAgICAgICAkc2NvcGUudXBkYXRlTGltaXRhdGlvbkRhdGFiYXNlKGV2ZW50LnN0YXJ0LCBldmVudC5lbmQsIGV2ZW50LmlkLCBldmVudC50ZW1wX2xpbWl0X2lkLCBldmVudCk7CiAgICAgIH0sCiAgICAgIGV2ZW50UmVzaXplOiBmdW5jdGlvbihldmVudCwgZGVsdGEsIHJldmVydEZ1bmMpIHsKICAgICAgICBsb2dEZWJ1ZygiZXZlbnRyZXNpemUsIGV2ZW50LmVuZD0iICsgZXZlbnQuZW5kKTsKICAgICAgICAkc2NvcGUudXBkYXRlTGltaXRhdGlvbkRhdGFiYXNlKGV2ZW50LnN0YXJ0LCBldmVudC5lbmQsIGV2ZW50LmlkLCBldmVudC50ZW1wX2xpbWl0X2lkLCBldmVudCk7CiAgICAgIH0sCiAgICAgIGRlZmF1bHRWaWV3OiBob3Vyc09mV29ya0RlZmF1bHRWaWV3LAogICAgICBldmVudENsaWNrOiBmdW5jdGlvbihjYWxFdmVudCwganNFdmVudCwgdmlldykgewogICAgICAgIGxvZ0RlYnVnKCJldmVudCBjbGlja2VkICIgKyBjYWxFdmVudC50aXRsZSArICIoaWQ9IiArIGNhbEV2ZW50LmlkICsgIiwgZGF5X2xpbWl0X2lkPSIgKyBjYWxFdmVudC5kYXlfbGltaXRfaWQgKyAiLCB0ZW1wX2xpbWl0X2lkPSIgKyBjYWxFdmVudC50ZW1wX2xpbWl0X2lkICsgIiwgbGltaXRfaWQ9IiArIGNhbEV2ZW50LmxpbWl0X2lkICsgIikgc3RhcnQ9IiArIGNhbEV2ZW50LnN0YXJ0ICsgIiwgZW5kPSIgKyBjYWxFdmVudC5lbmQpOwogICAgICAgICRzY29wZS5ldmVudENsaWNrTW9kdWxlKGNhbEV2ZW50KTsKLy8gY2hhbmdlIHRoZSBib3JkZXIgY29sb3IganVzdCBmb3IgZnVuCi8vICQodGhpcykuY3NzKCdib3JkZXItY29sb3InLCAncmVkJyk7CgogICAgICB9LAogICAgICBldmVudFJlbmRlcjogZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpCiAgICAgIHsKICAgICAgICBjb25zb2xlLmxvZyhldmVudCk7CiAgICAgICAgZWxlbWVudC5maW5kKCcuZmMtdGl0bGUnKS5wcmVwZW5kKGV2ZW50LmxvY2F0aW9uX25hbWUrIiAvIDxici8+Iik7CiAgICAgICAgZWxlbWVudC5maW5kKCcuZmMtdGl0bGUnKS5wcmVwZW5kKGV2ZW50Lmluc3RydWN0b3JfbmFtZSsiIC8gPGJyLz4iKTsKLy8gZWxlbWVudC5maW5kKCcuZmMtdGl0bGUnKS5wcmVwZW5kKCIiK2V2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfZmlyc3RfbmFtZSsiICIrZXZlbnQuZXZlbnRVc2Vyc1swXS5idXNlcl9sYXN0X25hbWUrIiAoIik7CgovLyBjb25zb2xlLmxvZygicmVuZGVyIGxpbWl0YXRpb24gIitKU09OLnN0cmluZ2lmeShldmVudCkpOwovLyBpZiAoZXZlbnQuaXNfY2xhc3M9PTEpCi8vIHsKLy8gICAvLyBpZiBjbGFzcyBhZGRpbmcgbnVtYmVyIG9mIHBhcnRpY2lwYW50cwovLyAgIGlmIChldmVudC5ub19vZl93YWl0aW5nX3VzZXJzPjApCi8vICAgewovLyAgICAgZWxlbWVudC5maW5kKCcuZmMtdGl0bGUnKS5wcmVwZW5kKGV2ZW50Lm5vX29mX3VzZXJzKyIvIitldmVudC5tYXhfcGFydGljaXBhbnRzKyAiICgiK2V2ZW50Lm5vX29mX3dhaXRpbmdfdXNlcnMrIikiKyIgLSAiKTsKLy8gICB9Ci8vICAgZWxzZQovLyAgIHsKLy8gICAgIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykucHJlcGVuZChldmVudC5ub19vZl91c2VycysiLyIrZXZlbnQubWF4X3BhcnRpY2lwYW50cysiIC0gIik7Ci8vICAgfQovLyB9Ci8vIGVsc2UKLy8gewovLyAgIC8vIGlmIG5vdCBjbGFzcyAtIHdyaXRpbmcgdGhlIGVuZHVzZXIgbmFtZQovLyAgIGlmIChldmVudC5kdXJhdGlvbl9ldmVudCE9MCkgLy8gYWxzbyBpZiBub3QgaG91cnMgb2Ygd29yawovLyAgIHsKLy8gICAgIC8vIGVsZW1lbnQuZmluZCgnLmZjLXRpdGxlJykuYXBwZW5kKCIgKCIrZXZlbnQuZXZlbnRVc2Vyc1swXS5idXNlcl9maXJzdF9uYW1lKyIgIitldmVudC5ldmVudFVzZXJzWzBdLmJ1c2VyX2xhc3RfbmFtZSsiKSIpOwovLyAgICAgZWxlbWVudC5maW5kKCcuZmMtdGl0bGUnKS5wcmVwZW5kKCIiK2V2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfZmlyc3RfbmFtZSsiICIrZXZlbnQuZXZlbnRVc2Vyc1swXS5idXNlcl9sYXN0X25hbWUrIiAoIik7Ci8vICAgICBlbGVtZW50LmZpbmQoJy5mYy10aXRsZScpLmFwcGVuZCgiKSIpOwovLyAgIH0KLy8gICAvLyBsb2dEZWJ1ZygiaGVyZTQiKTsKLy8gfQovLyBpZiAoZXZlbnQuaXNfcmVwZWF0aW5nID09IDEpIHsKLy8gICAgIGVsZW1lbnQuZmluZCgiLmZjLXRpdGxlIikucHJlcGVuZCgiJm5ic3A7PGkgY2xhc3M9J2ZhIGZhLXJlcGVhdCc+PC9pPiZuYnNwOyIpOwovLyAgICAgLy8gIGVsZW1lbnQuZmluZCgiLmZjLXRpdGxlIikuYXBwZW5kKCImbmJzcDs8aW1nIHNyYz0nL3B1YmxpYy9pbWFnZXMvcmVjdXJyaW5nLWljb24ucG5nJyB3aWR0aD0nMTBweCcgaGVpZ2h0PScxMHB4Jy8+Iik7Ci8vIH0KICAgICAgfSwKICAgICAgbWluVGltZTogJGdDYWxlbmRhckRpc3BsYXlNaW5UaW1lLAogICAgICBtYXhUaW1lOiAkZ0NhbGVuZGFyRGlzcGxheU1heFRpbWUsCiAgICAgIHNlbGVjdGFibGU6IHRydWUsCiAgICAgIHNlbGVjdEhlbHBlcjogZmFsc2UsCiAgICAgIHRpbWV6b25lOiBmYWxzZSwKICAgICAgaXNSVEw6IHRydWUsCiAgICAgIGxhbmc6ICJoZSIsCiAgICAgIHNlbGVjdENvbnN0cmFpbnQ6IHsKICAgICAgICBzdGFydDogJzAwOjAxJywKICAgICAgICBlbmQ6ICcyMzo1OScsCiAgICAgIH0sCiAgICAgIGRlZmF1bHREYXRlOiBtb21lbnQoY3VyckRlZmF1bHREYXRlKSwKICAgICAgYWxsRGF5U2xvdDogZmFsc2UsCiAgICAgIGxvYWRpbmc6IGZ1bmN0aW9uKGJvb2wpIHsKICAgICAgICBpZiAoYm9vbCkgewogICAgICAgICAgbG9nRGVidWcoJ2xvYWRpbmcgY2FsZW5kYXIyICcgKyAkc2NvcGUuY2FsZW5kYXIpOwoKLy8gJCgnI2xvYWRpbmcnKS5zaG93KCk7CiAgICAgICAgfSBlbHNlIHsKLy8gJCgnI2xvYWRpbmcnKS5oaWRlKCk7CiAgICAgICAgICBsb2dEZWJ1ZygnZmluaXNoZWQgbG9hZGluZyBjYWxlbmRhciAnICsgJHNjb3BlLmNhbGVuZGFyKTsKICAgICAgICAgIGlmICghJHNjb3BlLmZpeGVkU2NoZWR1bGUpIHsKICAgICAgICAgICAgJHNjb3BlLnVwZGF0ZUNhbGVuZGFyQ2VudGVyVGl0bGUoKTsKICAgICAgICAgIH0KLy8gJHNjb3BlLmJhY2tUb0ZpeGVkKCk7CiAgICAgICAgfQogICAgICB9LAogICAgICBzZWxlY3Q6IGZ1bmN0aW9uKHN0YXJ0LCBlbmQsIGFsbERheSkgewovLyB0aGlzIGlzIGNhbGxlZCB3aGVuIGNyZWF0aW5nIGEgbmV3IGJsb2NrCiAgICAgICAgJHNjb3BlLmNyZWF0ZUxpbWl0YXRpb25CbG9jayhzdGFydCwgZW5kKTsKICAgICAgfQogICAgfQogIH07CgovLyBjcmVhdGUgbGltaXRhdGlvbiBibG9jawogICRzY29wZS5jcmVhdGVMaW1pdGF0aW9uQmxvY2sgPSBmdW5jdGlvbihzdGFydCwgZW5kKQogIHsKICAgIGxvZ0RlYnVnKCJmdW5jdGlvbjogY3JlYXRlTGltaXRhdGlvbkJsb2NrIik7CiAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAgICAgYW5pbWF0aW9uOiBmYWxzZSwKICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfbGltaXRhdGlvbl9jcmVhdGUucGhwJywKICAgICAgc2l6ZTogJ3hzJywKICAgICAgY29udHJvbGxlcjogJ2J1c2luZXNzX21vZGFsX2xpbWl0YXRpb25fY3JlYXRlJywKICAgICAgcmVzb2x2ZTogewogICAgICAgIHN0YXJ0OiBmdW5jdGlvbigpCiAgICAgICAgewogICAgICAgICAgcmV0dXJuIHN0YXJ0OwogICAgICAgIH0sCiAgICAgICAgZW5kOiBmdW5jdGlvbigpCiAgICAgICAgewogICAgICAgICAgcmV0dXJuIGVuZDsKICAgICAgICB9LAogICAgICAgIGZpeGVkU2NoZWR1bGU6IGZ1bmN0aW9uICgpCiAgICAgICAgewogICAgICAgICAgcmV0dXJuICRzY29wZS5maXhlZFNjaGVkdWxlOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CiAgfQogICRzY29wZS51cGRhdGVDYWxlbmRhckNlbnRlclRpdGxlID0gZnVuY3Rpb24oKSB7CiAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ2V0VmlldycpOwoKICAgIHZpc2libGVEYXRlU3RhcnQgPSBuZXcgRGF0ZSh1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ2V0VmlldycpLnN0YXJ0KTsKICAgIHZpc2libGVEYXRlRW5kID0gbmV3IERhdGUodWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2dldFZpZXcnKS5lbmQpOwoKICAgICRzY29wZS5jYWxlbmRhclRpdGxlQ2VudGVyID0gdmlzaWJsZURhdGVTdGFydC5nZXREYXRlKCkgKyAiICIgKyBtb250aE5hbWVzW3Zpc2libGVEYXRlU3RhcnQuZ2V0TW9udGgoKV0gKwogICAgICAgICIg4oCUICIgKyB2aXNpYmxlRGF0ZUVuZC5nZXREYXRlKCkgKyAiICIgKyBtb250aE5hbWVzW3Zpc2libGVEYXRlRW5kLmdldE1vbnRoKCldICsKICAgICAgICAiICIgKyB2aXNpYmxlRGF0ZVN0YXJ0LmdldEZ1bGxZZWFyKCk7CiAgfTsKICAvKiBldmVudCBzb3VyY2VzIGFycmF5Ki8KICAkc2NvcGUuZXZlbnRTb3VyY2VzID0gW3sKICAgIHVybDogJy9hcGkvYWRtaW4vY2FsZW5kYXIvbGltaXRhdGlvbnMvcGVyZGF5L2dldHBvc3QnLAogICAgdHlwZTogJ1BPU1QnCiAgfV07CgovLyAkc2NvcGUuZ2V0RXZlbnRzID0gZnVuY3Rpb24oKSB7Ci8vICAgICBjYWxlbmRhciA9ICdjYWxlbmRhcl9ob3Vyc19vZl93b3JrJzsKLy8gICAgIGFsbGxFdmVudHNBcnJheSA9IHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2NsaWVudEV2ZW50cycpOwovLyAgICAgZm9yIChpIGluIGFsbGxFdmVudHNBcnJheSkgewovLyAgICAgICAgIGxvZ0RlYnVnKGFsbGxFdmVudHNBcnJheVtpXSk7Ci8vICAgICB9Ci8vCi8vIH0KCiAgJHNjb3BlLmdvdG9Ub2RheSA9IGZ1bmN0aW9uKCkgewogICAgJHNjb3BlLmdvdG9EYXRlKG5ldyBEYXRlKCkpOwogIH0KICAkc2NvcGUuZ290b05leHQgPSBmdW5jdGlvbigpIHsKICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCduZXh0Jyk7CiAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcigncmVtb3ZlRXZlbnRzJyk7CiAgICAkc2NvcGUudXBkYXRlQ2FsZW5kYXJDZW50ZXJUaXRsZSgpOwogIH0KICAkc2NvcGUuZ290b1ByZXYgPSBmdW5jdGlvbigpIHsKICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZW1vdmVFdmVudHMnKTsKICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdwcmV2Jyk7CiAgICAkc2NvcGUudXBkYXRlQ2FsZW5kYXJDZW50ZXJUaXRsZSgpOwogIH0KICAkc2NvcGUuZ290b0RhdGUgPSBmdW5jdGlvbihuZXdkYXRlKSB7CiAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ290b0RhdGUnLCBuZXdkYXRlKTsKICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdjaGFuZ2VWaWV3JywgJ2FnZW5kYVdlZWsnKTsKICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZW1vdmVFdmVudHMnKTsKICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZWZldGNoRXZlbnRzJyk7CgogICAgJHNjb3BlLnVwZGF0ZUNhbGVuZGFyQ2VudGVyVGl0bGUoKTsKICAgICRzY29wZS5maXhlZFNjaGVkdWxlID0gZmFsc2U7CiAgfQoKICAkc2NvcGUuYmFja1RvRml4ZWQgPSBmdW5jdGlvbigpIHsKICAgICRzY29wZS5maXhlZFNjaGVkdWxlID0gdHJ1ZTsKICAgICRzY29wZS5jYWxlbmRhclRpdGxlQ2VudGVyID0gItep16LXldeqINek16LXmdec15XXqiDXp9eR15XXoteV16oiOwogICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJHNjb3BlLmNhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ2NoYW5nZVZpZXcnLCAnZG9udFNob3dEYXRlJyk7CiAgICB1aUNhbGVuZGFyQ29uZmlnLmNhbGVuZGFyc1skc2NvcGUuY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignZ290b0RhdGUnLCBtb21lbnQoJGdIb3VyMGRhdGUpKTsKICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZW1vdmVFdmVudHMnKTsKICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzWyRzY29wZS5jYWxlbmRhcl0uZnVsbENhbGVuZGFyKCdyZWZldGNoRXZlbnRzJyk7CgogIH0KCi8vICRzY29wZS5kZWxldGVBbGxFdmVudHMgPSBmdW5jdGlvbigpIHsKLy8gICAgIGNhbGVuZGFyID0gJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnOwovLyAgICAgYWxsbEV2ZW50c0FycmF5ID0gdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbY2FsZW5kYXJdLmZ1bGxDYWxlbmRhcignY2xpZW50RXZlbnRzJyk7Ci8vICAgICBmb3IgKGkgaW4gYWxsbEV2ZW50c0FycmF5KSB7Ci8vICAgICAgICAgbG9nRGVidWcoYWxsbEV2ZW50c0FycmF5W2ldKTsKLy8gICAgICAgICAkc2NvcGUuZGVsZXRlQ2FsZW5kYXJKU0V2ZW50KGNhbGVuZGFyLCBhbGxsRXZlbnRzQXJyYXlbaV0uaWQpOwovLyAgICAgICAgICRzY29wZS5kZWxldGVDYWxlbmRhckRCRXZlbnQoYWxsbEV2ZW50c0FycmF5W2ldLmlkKTsKLy8gICAgIH0KLy8KLy8gfQogICRzY29wZS51cGRhdGVMaW1pdGF0aW9uRGF0YWJhc2UgPSBmdW5jdGlvbihzdGFydF9wYXJhbSwgZW5kX3BhcmFtLCBldmVudF9pZCwgdGVtcF9saW1pdF9pZCwgdGhlZXZlbnQpIHsKCiAgICBsb2dEZWJ1ZygidXBkYXRlTGltaXRhdGlvbkRhdGFiYXNlIHN0YXJ0PSIgKyBzdGFydF9wYXJhbSArICIsIGVuZD0iICsgZW5kX3BhcmFtICsgIixldmVudF9pZD0iICsgZXZlbnRfaWQpOwoKICAgIGZ1bmN0aW9uIHVwZGF0ZUNhbGVuZGFyTGltaXRhdGlvbl9mYWlsdXJlKCkKICAgIHsKICAgICAgY2FsZW5kYXIgPSAiY2FsZW5kYXJfaG91cnNfb2Zfd29yayI7CiAgICAgIHVpQ2FsZW5kYXJDb25maWcuY2FsZW5kYXJzW2NhbGVuZGFyXS5mdWxsQ2FsZW5kYXIoJ3JlZmV0Y2hFdmVudHMnKTsKICAgIH0KLy8gaWYgdGhlIGV2ZW50IHRoYXQgaXMgZ2V0dGluZyB1cGRhdGVkIGlzIGFuIGV2ZW50IGZyb20gMTk3MCAobm90IHBlcmRheSkKLy8gdGhlbiB3ZSBhZGQgYSBuZXcgcGVyZGF5IGxpbWl0YXRpb24gd2l0aCBsaW1pdF9pZCBvZiB0aGUgMTk3MCBsaW1pdGF0aW9ucyAtIHdpdGggdGhlIG5ldyB0aW1lcy4KCi8vIG90aGVyd2lzZSB3ZSBqdXN0IHVwZGF0ZSB0aGUgcGVyZGF5IGxpbWl0YXRpb24KCiAgICBpZiAoJHNjb3BlLmZpeGVkU2NoZWR1bGUpIC8vIGZpeGVkIHNjaGVkdWxlIHZzIHNwZWNpZmljIHdlZWQvZGF5IGxpbWl0YXRpb24KICAgIHsKICAgICAgdGhlZGF0YSA9IHsKICAgICAgICBzdGFydF9kYXRlOiBzdGFydF9wYXJhbSwKICAgICAgICBlbmRfZGF0ZTogZW5kX3BhcmFtLAogICAgICAgIHRlbXBfbGltaXRfaWQ6IHRlbXBfbGltaXRfaWQsCiAgICAgICAgbGltaXRfaWQ6IGV2ZW50X2lkCiAgICAgIH07CgogICAgICB1cGRhdGVDYWxlbmRhckxpbWl0YXRpb24oJGh0dHAsJHNjb3BlLHRoZWRhdGEsZXZlbnRfaWQsIG51bGwsIHVwZGF0ZUNhbGVuZGFyTGltaXRhdGlvbl9mYWlsdXJlKTsKICAgIH0KICAgIGVsc2UgLy8gbm90IGZpeGVkIHNjaGVkdWxlIC0gZGFpbHkvd2Vla2x5IGxpbWl0YXRpb25zCiAgICB7CiAgICAgIGlmICgodGhlZXZlbnQubGltaXRfaWQgIT0gbnVsbCkgJiAodGhlZXZlbnQuZGF5X2xpbWl0X2lkID09IC0xKSkgLy8gZXZlbnQgbGltaXRhdGlvbiBoYXMgbGltaXRfaWQgc28gaXRzIGFuIDE5NzAgZXZlbnQKLy8gbmVlZCB0byBhZGQgYSBuZXcgcGVyZGF5IGxpbWl0YXRpb24gdGhhdCBwb2ludCAobGltaXRfaWQpIHRvIHRoZSBvbGQgMTk3MCBldmVudCB0byBjYW5jZWwgaXQKICAgICAgewogICAgICAgIHRlbXBfbGltaXRfaWQgPSBjYWxjX3RlbXBfbGltaXRfaWQoKTsKICAgICAgICB0aGVldmVudC50ZW1wX2xpbWl0X2lkID0gdGVtcF9saW1pdF9pZDsKICAgICAgICB0aGVldmVudC5kYXlfbGltaXRfaWQgPSB0ZW1wX2xpbWl0X2lkOwovLyB0aGUgbW92ZWQgZXZlbnQgaW4gdGhlIGNhbGVuZGFyIG5vdyBoYXMgZGF5X2xpbWl0X2lkIGFuZCB0ZW1wX2xpbWl0X2lkCi8vIGlmIGl0cyBsb2FkZWQgZnJvbSB0aGUgZGIsIGl0IHdpbGwgb25seSBoYXZlIGRheV9saW1pdF9pZCAoYW5kIG5vdCB0aGUgdGVtcCBvbmUpCiAgICAgICAgdWlDYWxlbmRhckNvbmZpZy5jYWxlbmRhcnNbJ2NhbGVuZGFyX2hvdXJzX29mX3dvcmsnXS5mdWxsQ2FsZW5kYXIoJ3VwZGF0ZUV2ZW50JywgdGhlZXZlbnQpOwoKICAgICAgICB0aGVkYXRhID0gewogICAgICAgICAgc3RhcnRfZGF0ZTogc3RhcnRfcGFyYW0sCiAgICAgICAgICBlbmRfZGF0ZTogZW5kX3BhcmFtLAogICAgICAgICAgY29sb3I6IHRoZWV2ZW50LmNvbG9yLAogICAgICAgICAgdGVtcF9saW1pdF9pZDogdGVtcF9saW1pdF9pZCwKICAgICAgICAgIGV2ZW50X3R5cGVfaWQ6IHRoZWV2ZW50LmV2ZW50X3R5cGVfaWQsCiAgICAgICAgICBldmVudF90eXBlczogdGhlZXZlbnQuZXZlbnRfdHlwZXMsCiAgICAgICAgICBsb2NhdGlvbl9pZDogdGhlZXZlbnQubG9jYXRpb25faWQsCiAgICAgICAgICBlbXBfaWQ6IHRoZWV2ZW50LmVtcF9pZCwKICAgICAgICAgIGxpbWl0X2lkOiB0aGVldmVudC5pZCwKICAgICAgICAgIHRpdGxlOiB0aGVldmVudC50aXRsZQogICAgICAgIH07CiAgICAgICAgY3JlYXRlQ2FsZW5kYXJMaW1pdGF0aW9uUGVyRGF5KCRodHRwLCRzY29wZSx0aGVkYXRhLG51bGwsIHVwZGF0ZUNhbGVuZGFyTGltaXRhdGlvbl9mYWlsdXJlKTsKCiAgICAgIH0KICAgICAgZWxzZSAvLyBldmVudCBsaW1pdGF0aW9uIHRvIG1vdmUvdXBkYXRlIGhhcyBubyBsaW1pdF9pZCAtIHNvIHRoaXMgaXMgbmV3IHBlcmRheSBldmVudCAtIHdlIGp1c3QgdXBkYXRlIGl0CiAgICAgIHsKICAgICAgICB0aGVkYXRhPSB7CiAgICAgICAgICBzdGFydF9kYXRlOiBzdGFydF9wYXJhbSwKICAgICAgICAgIGVuZF9kYXRlOiBlbmRfcGFyYW0sCiAgICAgICAgICB0ZW1wX2RheV9saW1pdF9pZDogdGhlZXZlbnQudGVtcF9saW1pdF9pZCwKICAgICAgICAgIGxvY2F0aW9uX2lkOiB0aGVldmVudC5sb2NhdGlvbl9pZCwKICAgICAgICAgIGRheV9saW1pdF9pZDogdGhlZXZlbnQuZGF5X2xpbWl0X2lkCiAgICAgICAgfTsKICAgICAgICB1cGRhdGVDYWxlbmRhckxpbWl0YXRpb25QZXJEYXkoJGh0dHAsJHNjb3BlLHRoZWRhdGEsbnVsbCwgdXBkYXRlQ2FsZW5kYXJMaW1pdGF0aW9uX2ZhaWx1cmUpOwogICAgICB9CiAgICB9CiAgfTsKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ0V2ZW50Q2xhc3NQYWdlQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJHRpbWVvdXQsICRodHRwLCAkcm9vdFNjb3BlLCAkcm91dGVQYXJhbXMsICRsb2NhdGlvbiwgJHJvdXRlLCBzaGFyZWREYXRhLCAkdWliTW9kYWwpCnsKICBnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkcm91dGVQYXJhbXMuZXZlbnRfaWQpOwogIGdldEFsbENsaWVudHMoJGh0dHAsJHNjb3BlLCdldmVudFR5cGVVc2VycycpOwogIGdldEJ1c2luZXNzTG9jYXRpb25zKCRodHRwLCRzY29wZSwnYnVzaW5lc3NfbG9jYXRpb25zJyk7CiAgZ2V0QWxsSW5zdHJ1Y3RvcnMoJGh0dHAsJHNjb3BlLCdpbnN0cnVjdG9ycycpOwoKICAkc2NvcGUudXBkYXRlRXZlbnRUaXRsZSA9IGZ1bmN0aW9uKG5ld1ZhbHVlLGN1cnJlbnRFdmVudCkKICB7CiAgICBuZXdfdGl0bGU9bmV3VmFsdWU7CiAgICBzZXRFdmVudFRpdGxlKCRodHRwLCRzY29wZSxjdXJyZW50RXZlbnQuZXZlbnRfaWQsIG5ld190aXRsZSwgdXBkYXRlRXZlbnRfY2FsbGJhY2ssIHVwZGF0ZUV2ZW50X2NhbGxiYWNrKTsKCiAgICBmdW5jdGlvbiB1cGRhdGVFdmVudF9jYWxsYmFjaygpCiAgICB7CiAgICAgIGdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQpOwogICAgfQoKICB9OwoKICAkc2NvcGUudXBkYXRlRXZlbnRNYXhQYXJ0aWNpcGFudHMgPSBmdW5jdGlvbihuZXdWYWx1ZSxjdXJyZW50RXZlbnQpCiAgewogICAgbmV3X21heF9wYXJ0aWNpcGFudHM9bmV3VmFsdWU7CiAgICBpZiAoIG5ld19tYXhfcGFydGljaXBhbnRzIDwgY3VycmVudEV2ZW50Lm5vX29mX3VzZXJzICl7CiAgICAgIHNldEV2ZW50TWF4UGFydGljaXBhbnRzKCRodHRwLCRzY29wZSxjdXJyZW50RXZlbnQuZXZlbnRfaWQsIGN1cnJlbnRFdmVudC5ub19vZl91c2VycywgY3VycmVudEV2ZW50Lm5vX29mX3VzZXJzLCB1cGRhdGVFdmVudF9jYWxsYmFjaywgdXBkYXRlRXZlbnRfY2FsbGJhY2spOwogICAgfSBlbHNlIHsKICAgICAgc2V0RXZlbnRNYXhQYXJ0aWNpcGFudHMoJGh0dHAsJHNjb3BlLGN1cnJlbnRFdmVudC5ldmVudF9pZCwgbmV3X21heF9wYXJ0aWNpcGFudHMsIGN1cnJlbnRFdmVudC5ub19vZl91c2VycywgdXBkYXRlRXZlbnRfY2FsbGJhY2ssIHVwZGF0ZUV2ZW50X2NhbGxiYWNrKTsKICAgIH0KCiAgICBmdW5jdGlvbiB1cGRhdGVFdmVudF9jYWxsYmFjaygpCiAgICB7CiAgICAgIGdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQpOwogICAgfQoKICB9OwoKICAkc2NvcGUudXBkYXRlVXNlckV2ZW50UHJpY2UgPSBmdW5jdGlvbihuZXd2YWx1ZSwgdGhlZXZlbnQsIGV1c2VyKQogIHsKICAgIG5ld19wcmljZT1uZXd2YWx1ZTsKICAgIHNldENsaWVudEV2ZW50UHJpY2UoJGh0dHAsJHNjb3BlLGV1c2VyLmJ1c2luZXNzX3VzZXJfaWQsdGhlZXZlbnQuZXZlbnRfaWQsIG5ld19wcmljZSxzZXRDbGllbnRFdmVudFByaWNlX2NhbGxiYWNrLCBzZXRDbGllbnRFdmVudFByaWNlX2NhbGxiYWNrKTsKICAgIGZ1bmN0aW9uIHNldENsaWVudEV2ZW50UHJpY2VfY2FsbGJhY2soKQogICAgewogICAgICBnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkKTsKICAgIH0KICB9OwoKICAkc2NvcGUudXBkYXRlTG9jYXRpb25FdmVudCA9IGZ1bmN0aW9uKCkKICB7CiAgICBjb25zb2xlLmxvZygiZnVuY3Rpb246IHVwZGF0ZUxvY2F0aW9uRXZlbnQiKTsKICAgIHVwZGF0ZUV2ZW50TG9jYXRpb24oJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCwkc2NvcGUuY3VycmVudEV2ZW50LmxvY2F0aW9uX2lkLHVwZGF0ZUV2ZW50TG9jYXRpb25fY2FsbGJhY2ssIHVwZGF0ZUV2ZW50TG9jYXRpb25fY2FsbGJhY2spOwogICAgJHNjb3BlLnVwZGF0ZUxvY2F0aW9uQWxlcnRNZXNzYWdlPSLXntei15PXm9efINeh15jXmNeV16EuLi4iOwogICAgZnVuY3Rpb24gdXBkYXRlRXZlbnRMb2NhdGlvbl9jYWxsYmFjaygpCiAgICB7CiAgICAgICRzY29wZS51cGRhdGVMb2NhdGlvbkFsZXJ0TWVzc2FnZT0i16LXldeT15vXnyDXkdeU16bXnNeX15QhIjsKICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKQogICAgICB7CiAgICAgICAgJHNjb3BlLnVwZGF0ZUxvY2F0aW9uQWxlcnRNZXNzYWdlPW51bGw7CiAgICAgIH0sIDE1MDApOwogICAgfQogIH07CgogICRzY29wZS51cGRhdGVJbnN0cnVjdG9yQ2xhc3NFdmVudCA9IGZ1bmN0aW9uKCkKICB7CiAgICBjb25zb2xlLmxvZygiZnVuY3Rpb246IHVwZGF0ZUluc3RydWN0b3JDbGFzc0V2ZW50Iik7CiAgICB1cGRhdGVFdmVudEluc3RydWN0b3IoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCwkc2NvcGUuY3VycmVudEV2ZW50Lmluc3RydWN0b3JfaWQsdXBkYXRlRXZlbnRJbnN0cnVjdG9yX2NhbGxiYWNrLCB1cGRhdGVFdmVudEluc3RydWN0b3JfY2FsbGJhY2spOwogICAgJHNjb3BlLnVwZGF0ZUluc3RydWN0b3JBbGVydE1lc3NhZ2U9Itee16LXk9eb158g16HXmNeY15XXoS4uLiI7CiAgICBmdW5jdGlvbiB1cGRhdGVFdmVudEluc3RydWN0b3JfY2FsbGJhY2soKQogICAgewogICAgICAkc2NvcGUudXBkYXRlSW5zdHJ1Y3RvckFsZXJ0TWVzc2FnZT0i16LXldeT15vXnyDXkdeU16bXnNeX15QhIjsKICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKQogICAgICB7CiAgICAgICAgJHNjb3BlLnVwZGF0ZUluc3RydWN0b3JBbGVydE1lc3NhZ2U9bnVsbDsKICAgICAgfSwgMTUwMCk7CiAgICB9CiAgfQoKCiAgJHNjb3BlLmFjdGl2YXRlRXZlbnRDbGFzcyA9IGZ1bmN0aW9uKCkKICB7CiAgICB7CiAgICAgIGxvZ0RlYnVnKCJyZW9wZW5FdmVudCIpOwogICAgICByZW9wZW5FdmVudCgkaHR0cCwkc2NvcGUsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCwkc2NvcGUuc2VsZWN0ZWRFdmVudCxhZnRlclJlb3BlbkV2ZW50LGFmdGVyUmVvcGVuRXZlbnQpOwogICAgICBmdW5jdGlvbiBhZnRlclJlb3BlbkV2ZW50KCkKICAgICAgewogICAgICAgIGdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQpOwogICAgICB9OwogICAgfQogIH0KCi8vIGNsb3NlIGV2ZW50IGNsYXNzCiAgJHNjb3BlLmNsb3NlRXZlbnRDbGFzcyA9IGZ1bmN0aW9uKCkgewogICAgbG9nRGVidWcoImNsb3NlRXZlbnRDbGFzcyIpOwoKICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewogICAgICBhbmltYXRpb246IGZhbHNlLAogICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9ldmVudF9jbGFzc19jbG9zZS5waHAnLAogICAgICBzaXplOiAneHMnLAogICAgICBjb250cm9sbGVyOiAnY2xhc3NDbG9zZU1vZGFsQ29udHJvbGxlcicsCiAgICAgIHJlc29sdmU6IHsKICAgICAgICBldmVudF9pZDogZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZDsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogIH07CgovLyBkZWxldGUgcmVwZWF0aW5nL2NsYXNzIGV2ZW50CiAgJHNjb3BlLmRlbGV0ZUNsYXNzRXZlbnQgPSBmdW5jdGlvbigpCiAgewogICAgaWYgKCRzY29wZS5jdXJyZW50RXZlbnQuaXNfcmVwZWF0aW5nPT0wKQogICAgewogICAgICBsb2dEZWJ1ZygiY2xhc3MgZXZlbnQgbm90IHJlcGVhdGluZyIpOwogICAgICAkc2NvcGUuZGVsZXRlQ2xhc3NFdmVudFNpbmdsZSgpOwogICAgfQogICAgZWxzZQogICAgewogICAgICBsb2dEZWJ1ZygiY2xhc3MgZXZlbnQgaXMgcmVwZWF0aW5nIik7CiAgICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewogICAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfcmVwZWF0aW5nX2V2ZW50X2RlbGV0ZV9hbGwucGhwJywKICAgICAgICBzaXplOiAneHMnLAogICAgICAgIGNvbnRyb2xsZXI6ICdjbGFzc0RlbGV0ZUFsbE1vZGFsQ29udHJvbGxlcicsCiAgICAgICAgcmVzb2x2ZTogewogICAgICAgICAgY3VycmVudEV2ZW50OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuICRzY29wZS5jdXJyZW50RXZlbnQ7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICB9OwoKICAkc2NvcGUuZGVsZXRlQ2xhc3NFdmVudFNpbmdsZT1mdW5jdGlvbiAoKSAvLyBkZWxldGUgb25seSBvbmUvY3VycmVudCBjbGFzcyBldmVodAogIHsKICAgIGNhbmNlbENsYXNzRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQsY2FuY2VsQ2xhc3NFdmVudF9jYWxsYmFjaywgY2FuY2VsQ2xhc3NFdmVudF9jYWxsYmFjayk7CiAgICBmdW5jdGlvbiBjYW5jZWxDbGFzc0V2ZW50X2NhbGxiYWNrKCkKICAgIHsKICAgICAgZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCk7CiAgICB9CiAgfQoKICAkc2NvcGUuJG9uKCJyZWxvYWRFdmVudCIsZnVuY3Rpb24oZSxhKXsKLy8gUG9zdCB5b3VyIGNvZGUKICAgIGxvZ0RlYnVnKCJicm9hZGNhc3RlZCAtIHJlbG9hZGluZyBldmVudCAiK2EuZXZlbnRfaWQpOwogICAgZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkKTsKICB9KTsKCi8vIHJlbW92ZSBlbmQgdXNlciBmcm9tIGV2ZW50CiAgJHNjb3BlLmV2ZW50UmVtb3ZlRW5kVXNlciA9IGZ1bmN0aW9uKGVuZHVzZXJfaWQpCiAgewogICAgY29uc29sZS5sb2coImV2ZW50UmVtb3ZlRW5kVXNlciIpOwogICAgcmVtb3ZlRW5kVXNlckZyb21FdmVudCgkaHR0cCwkc2NvcGUsZW5kdXNlcl9pZCwkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50X2lkLHJlbW92ZUVuZFVzZXJGcm9tRXZlbnRfZmluaXNoLCByZW1vdmVFbmRVc2VyRnJvbUV2ZW50X2ZpbmlzaCk7CiAgICBmdW5jdGlvbiByZW1vdmVFbmRVc2VyRnJvbUV2ZW50X2ZpbmlzaCgpCiAgICB7CiAgICAgIGdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCk7CiAgICB9CiAgfTsKCiAgJHNjb3BlLmV2ZW50Q2xpZW50U2VsZWN0ZWQgPSBmdW5jdGlvbihzZWxlY3RlZCkgewogICAgaWYgKHNlbGVjdGVkKSB7Ci8vIGFsZXJ0KEpTT04uc3RyaW5naWZ5KCBzZWxlY3RlZCwgbnVsbCwgMiApKTsKICAgICAgbG9nRGVidWcoJ2V2ZW50Q2xpZW50U2VsZWN0ZWQyIHllcyBzZWxlY3RlZCAnICsgc2VsZWN0ZWQub3JpZ2luYWxPYmplY3QuZmlyc3RfbmFtZSk7CiAgICAgICRzY29wZS5ldmVudEFkZEVuZFVzZXIoc2VsZWN0ZWQub3JpZ2luYWxPYmplY3QuYnVzaW5lc3NfdXNlcl9pZCk7CiAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnYW5ndWNvbXBsZXRlLWFsdDpjbGVhcklucHV0JywgJ2NsaWVudF9hbmd1Y29tcGxldGUnKTsKCiAgICB9IGVsc2UgewogICAgICBsb2dEZWJ1Zygnbm90IHNlbGVjdGVkJyk7CiAgICB9CiAgfTsKCiAgJHNjb3BlLmV2ZW50QWRkRW5kVXNlciA9IGZ1bmN0aW9uKGVuZHVzZXJfaWQpCiAgewogICAgYWRkRW5kVXNlclRvRXZlbnQoJGh0dHAsJHNjb3BlLGVuZHVzZXJfaWQsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCxhZGRFbmRVc2VyVG9FdmVudF9maW5pc2gsIGFkZEVuZFVzZXJUb0V2ZW50X2ZpbmlzaCk7CiAgICBmdW5jdGlvbiBhZGRFbmRVc2VyVG9FdmVudF9maW5pc2goKQogICAgewogICAgICBnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkcm91dGVQYXJhbXMuZXZlbnRfaWQpOwogICAgfQogIH07Cn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdFdmVudFBhZ2VDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkdGltZW91dCwgJGh0dHAsICR1aWJNb2RhbCAsc2hhcmVkUHJvcGVydGllcywgJHJvdXRlUGFyYW1zLCAkcm9vdFNjb3BlLCAkbG9jYXRpb24sICRyb3V0ZSwgc2hhcmVkRGF0YSwgQnVzaW5lc3NDb25maWcpCnsKICBsb2dEZWJ1ZygiRXZlbnRQYWdlQ29udHJvbGxlciIpOwoKICBnZXRBbGxJbnN0cnVjdG9yc0luY0luYWN0aXZlKCRodHRwLCRzY29wZSwnaW5zdHJ1Y3RvcnMnLGdldEFsbEluc3RydWN0b3JzSW5jSW5hY3RpdmVfc3VjY2Vzcyk7CiAgZ2V0QnVzaW5lc3NMb2NhdGlvbnMoJGh0dHAsJHNjb3BlLCdidXNpbmVzc19sb2NhdGlvbnMnKTsKCiAgZnVuY3Rpb24gZ2V0QWxsSW5zdHJ1Y3RvcnNJbmNJbmFjdGl2ZV9zdWNjZXNzKCkKICB7CiAgICBnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkcm91dGVQYXJhbXMuZXZlbnRfaWQsc2V0UGFydGljaXBhdGVkKTsKICB9CgogIHZhciBpbml0aWFsaXppbmcgPSB0cnVlIDsKCiAgJHNjb3BlLiR3YXRjaCgiY3VycmVudEV2ZW50IiwgZnVuY3Rpb24obmV3VmFsdWUsIG9sZFZhbHVlKSB7CiAgICBpZiAoaW5pdGlhbGl6aW5nKSB7CiAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkgeyBpbml0aWFsaXppbmcgPSBmYWxzZTsgfSk7CiAgICB9IGVsc2UgewogICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgIHZhciB0aW1lb3V0SWQ7CiAgICAgICAgJCgnI2RvY3MgOmlucHV0LCB0ZXh0YXJlYScpLm9uKCdpbnB1dCBwcm9wZXJ0eWNoYW5nZSBjaGFuZ2UnLCBmdW5jdGlvbigpIHsKICAgICAgICAgIC8vICBjb25zb2xlLmxvZygnVGV4dGFyZWEgQ2hhbmdlJyk7CiAgICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dElkKTsKICAgICAgICAgIC8vIFJ1bnMgWCBzZWNvbmQgKFgqMTAwMCBtcykgYWZ0ZXIgdGhlIGxhc3QgY2hhbmdlCiAgICAgICAgICB0aW1lb3V0SWQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAkc2NvcGUudXBkYXRlRXZlbnRFeHRyYUZpZWxkcygpCiAgICAgICAgICB9LCA3MDApOwogICAgICAgIH0pOwogICAgICB9LCAxMDAwKTsKICAgIH0KICB9KTsKCiAgJHNjb3BlLmV4dHJhRmllbGRzQWxlcnRNZXNzYWdlPW51bGw7CgogICRzY29wZS51cGRhdGVFdmVudFRpdGxlID0gZnVuY3Rpb24obmV3VmFsdWUsY3VycmVudEV2ZW50KQogIHsKICAgIG5ld190aXRsZT1uZXdWYWx1ZTsKICAgIHNldEV2ZW50VGl0bGUoJGh0dHAsJHNjb3BlLGN1cnJlbnRFdmVudC5ldmVudF9pZCwgbmV3X3RpdGxlLCB1cGRhdGVFdmVudF9jYWxsYmFjaywgdXBkYXRlRXZlbnRfY2FsbGJhY2spOwoKICAgIGZ1bmN0aW9uIHVwZGF0ZUV2ZW50X2NhbGxiYWNrKCkKICAgIHsKICAgICAgZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudF9pZCk7CiAgICB9CgogIH07CgoKICAkc2NvcGUudXBkYXRlRXZlbnRFeHRyYUZpZWxkcyA9IGZ1bmN0aW9uKCkKICB7CiAgICBsb2dEZWJ1Zygic2F2ZSB1cGRhdGVFdmVudEV4dHJhRmllbGRzIik7CiAgICB0aGVkYXRhID0gewogICAgICBleHRyYUZpZWxkczokc2NvcGUuY3VycmVudEV2ZW50LmV4dHJhRmllbGRzCiAgICB9OwogICAgJHNjb3BlLmV4dHJhRmllbGRzQWxlcnRNZXNzYWdlPSLXqdeV157XqC4uLiI7CiAgICB1cGRhdGVFdmVudEV4dHJhRmllbGRzKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuZXZlbnRfaWQsdGhlZGF0YSx1cGRhdGVFdmVudEV4dHJhRmllbGRzX2NhbGxiYWNrLCB1cGRhdGVFdmVudEV4dHJhRmllbGRzX2NhbGxiYWNrKTsKCiAgICBmdW5jdGlvbiB1cGRhdGVFdmVudEV4dHJhRmllbGRzX2NhbGxiYWNrKCkKICAgIHsKICAgICAgLy8gZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLHNldFBhcnRpY2lwYXRlZCk7CgogICAgICAkc2NvcGUuZXh0cmFGaWVsZHNBbGVydE1lc3NhZ2U9Iteg16nXnteoISI7CiAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkKICAgICAgewogICAgICAgICRzY29wZS5leHRyYUZpZWxkc0FsZXJ0TWVzc2FnZT1udWxsOwogICAgICB9LCAyMzAwKTsKICAgIH0KICB9OwoKICAkc2NvcGUucmVzY2hlZHVsZUV2ZW50ID0gZnVuY3Rpb24oKQogIHsKICAgIGxvZ0RlYnVnKCJzZWV0aW5nIGV2ZW50IHRvIG1vdmUgICIrJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdKTsKICAgIHNoYXJlZFByb3BlcnRpZXMuc2V0X2V2ZW50X3Jlc2NoZWR1bGUoJHNjb3BlLmN1cnJlbnRFdmVudCk7CiAgICBzaGFyZWRQcm9wZXJ0aWVzLnNldF9zZWxlY3RlZF91c2VyKG51bGwpOwoKLy8gdXNlcl9pbmZvPSB7Ci8vICAgICB1c2VyX2lkOiAkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50VXNlcnNbMF0udXNlcl9pZCwKLy8gICAgIGJ1c2VyX2ZpcnN0X25hbWU6ICRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRVc2Vyc1swXS5idXNlcl9maXJzdF9uYW1lLAovLyAgICAgYnVzZXJfbGFzdF9uYW1lOiAkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50VXNlcnNbMF0uYnVzZXJfbGFzdF9uYW1lCi8vIH07Ci8vIHNoYXJlZFByb3BlcnRpZXMuc2V0X3NlbGVjdGVkX3VzZXIodXNlcl9pbmZvKTsKICAgICRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfY2FsZW5kYXInKTsKICB9CgogICRzY29wZS51cGRhdGVMb2NhdGlvbkV2ZW50ID0gZnVuY3Rpb24oKQogIHsKICAgIGNvbnNvbGUubG9nKCJmdW5jdGlvbjogdXBkYXRlTG9jYXRpb25FdmVudCIpOwogICAgdXBkYXRlRXZlbnRMb2NhdGlvbigkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLCRzY29wZS5jdXJyZW50RXZlbnQubG9jYXRpb25faWQsdXBkYXRlRXZlbnRMb2NhdGlvbl9jYWxsYmFjaywgdXBkYXRlRXZlbnRMb2NhdGlvbl9jYWxsYmFjayk7CiAgICAkc2NvcGUudXBkYXRlTG9jYXRpb25BbGVydE1lc3NhZ2U9Itee16LXk9eb158g16HXmNeY15XXoS4uLiI7CiAgICBmdW5jdGlvbiB1cGRhdGVFdmVudExvY2F0aW9uX2NhbGxiYWNrKCkKICAgIHsKICAgICAgJHNjb3BlLnVwZGF0ZUxvY2F0aW9uQWxlcnRNZXNzYWdlPSLXoteV15PXm9efINeR15TXptec15fXlCEiOwogICAgICAkdGltZW91dChmdW5jdGlvbigpCiAgICAgIHsKICAgICAgICAkc2NvcGUudXBkYXRlTG9jYXRpb25BbGVydE1lc3NhZ2U9bnVsbDsKICAgICAgfSwgMTUwMCk7CiAgICB9CiAgfTsKCiAgJHNjb3BlLnVwZGF0ZUluc3RydWN0b3JFdmVudCA9IGZ1bmN0aW9uKCkKICB7CiAgICBjb25zb2xlLmxvZygiZnVuY3Rpb246IHVwZGF0ZUluc3RydWN0b3JFdmVudCIpOwogICAgdXBkYXRlRXZlbnRJbnN0cnVjdG9yKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuZXZlbnRfaWQsJHNjb3BlLmN1cnJlbnRFdmVudC5pbnN0cnVjdG9yX2lkLHVwZGF0ZUV2ZW50SW5zdHJ1Y3Rvcl9jYWxsYmFjaywgdXBkYXRlRXZlbnRJbnN0cnVjdG9yX2NhbGxiYWNrKTsKICAgICRzY29wZS51cGRhdGVJbnN0cnVjdG9yQWxlcnRNZXNzYWdlPSLXntei15PXm9efINeh15jXmNeV16EuLi4iOwogICAgZnVuY3Rpb24gdXBkYXRlRXZlbnRJbnN0cnVjdG9yX2NhbGxiYWNrKCkKICAgIHsKICAgICAgJHNjb3BlLnVwZGF0ZUluc3RydWN0b3JBbGVydE1lc3NhZ2U9Itei15XXk9eb158g15HXlNem15zXl9eUISI7CiAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkKICAgICAgewogICAgICAgICRzY29wZS51cGRhdGVJbnN0cnVjdG9yQWxlcnRNZXNzYWdlPW51bGw7CiAgICAgIH0sIDE1MDApOwogICAgfQogIH07CgogICRzY29wZS5pbml0aWF0ZVBheW1lbnQgPSBmdW5jdGlvbiAoaXNwbHVzKSB7CiAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAgICAgYW5pbWF0aW9uOiBmYWxzZSwKICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfY2xpZW50X3BheW1lbnQucGhwJywKICAgICAgY29udHJvbGxlcjogJ2J1c2luZXNzQ2xpZW5kQ2FyZFBheW1lbnQnLAovLyBzaXplOiBzaXplLAogICAgICByZXNvbHZlOiB7CiAgICAgICAgY3VycmVudENsaWVudDogZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuICRzY29wZS5jdXJyZW50RXZlbnRDbGllbnRzWzBdOwogICAgICAgIH0sCiAgICAgICAgaXNwbHVzOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gaXNwbHVzOwogICAgICAgIH0sCiAgICAgICAgYnVzaW5lc3NDb25maWc6IEJ1c2luZXNzQ29uZmlnLmdldCgpLAogICAgICAgIHBheW1lbnRzOiBnZXRDbGllbnRQYXltZW50c1Byb21pc2UoJGh0dHAsICRzY29wZS5jdXJyZW50RXZlbnRDbGllbnRzWzBdLmJ1c2luZXNzX3VzZXJfaWQpCiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHIuZGF0YS5qc29uCiAgICAgICAgICAgIH0pCiAgICAgIH0KICAgIH0pOwogIH0KCiAgJHNjb3BlLmRlbGV0ZUV2ZW50PWZ1bmN0aW9uICgpCiAgewovLyBjaGVja2luZyBpZiBjYW5jZWxpbmcgYSBnZW5lcmNfdHlwZSBldmVudCAtIHRoZW4gdGhlcmUncyBubyB1c2VyCiAgICBpZiAoJHNjb3BlLmN1cnJlbnRFdmVudC5pc19nZW5lcmljX2V0eXBlPT0xKQogICAgewogICAgICBjYW5jZWxTaW5nbGVFdmVudCgkaHR0cCwkc2NvcGUsMCwkcm91dGVQYXJhbXMuZXZlbnRfaWQsY2FuY2VsU2luZ2xlRXZlbnRfY2FsbGJhY2ssIGNhbmNlbFNpbmdsZUV2ZW50X2NhbGxiYWNrKTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgY2FuY2VsU2luZ2xlRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRVc2Vyc1swXS5idXNpbmVzc191c2VyX2lkLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCxjYW5jZWxTaW5nbGVFdmVudF9jYWxsYmFjaywgY2FuY2VsU2luZ2xlRXZlbnRfY2FsbGJhY2spOwogICAgfQogICAgZnVuY3Rpb24gY2FuY2VsU2luZ2xlRXZlbnRfY2FsbGJhY2soKQogICAgewogICAgICBnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkcm91dGVQYXJhbXMuZXZlbnRfaWQsc2V0UGFydGljaXBhdGVkKTsKICAgIH0KICB9CgogICRzY29wZS5zZXRQYXJ0aWNpcGF0aW9uU3RhdHVzID0gZnVuY3Rpb24oKQogIHsKICAgIHNldEV2ZW50VXNlclBhcnRpY2lwYXRpb25TdGF0dXMoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCwkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50VXNlcnNbMF0uYnVzaW5lc3NfdXNlcl9pZCwkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50VXNlcnNbMF0uZXZlbnRfdXNlcl9zdGF0dXNfaWQsc2V0UGFydGljaXBhdGlvblN0YXR1c19jYWxsYmFjaywgc2V0UGFydGljaXBhdGlvblN0YXR1c19jYWxsYmFjayk7CiAgICAkc2NvcGUudXBkYXRlU3RhdHVzQWxlcnRNZXNzYWdlPSLXntei15PXm9efINeh15jXmNeV16EuLi4iOwogICAgZnVuY3Rpb24gc2V0UGFydGljaXBhdGlvblN0YXR1c19jYWxsYmFjaygpCiAgICB7Ci8vIGdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCxzZXRQYXJ0aWNpcGF0ZWQpOwogICAgICBzZXRQYXJ0aWNpcGF0ZWQoKTsKICAgICAgJHNjb3BlLnVwZGF0ZVN0YXR1c0FsZXJ0TWVzc2FnZT0i16LXldeT15vXnyDXkdeU16bXnNeX15QhIjsKICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKQogICAgICB7CiAgICAgICAgJHNjb3BlLnVwZGF0ZVN0YXR1c0FsZXJ0TWVzc2FnZT1udWxsOwogICAgICB9LCAyNTAwKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIHNldFBhcnRpY2lwYXRlZCgpCiAgewogICAgbG9nRGVidWcoImdldCBjbGllbnQgaW5mbyIpOwogICAgZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Q2xpZW50cycsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudFVzZXJzWzBdLmJ1c2luZXNzX3VzZXJfaWQpOwogICAgbG9nRGVidWcoInNldHRpbmcgc2V0UGFydGljaXBhdGVkIik7CiAgICBpZiAoJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudFVzZXJzWzBdLnN0YXR1c19uYW1lIT0kZ1VzZXJfc3RhdHVzX2Fic2VudGVkKQogICAgewogICAgICAkc2NvcGUuY3VycmVudEV2ZW50LmV2ZW50VXNlcnNbMF0ucGFydGljaXBhdGVkPXRydWU7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgICRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRVc2Vyc1swXS5wYXJ0aWNpcGF0ZWQ9ZmFsc2U7CiAgICB9CgovLyB0aGlzIGxvb3AgaXMgZm9yIGZpeGluZyB0aGUgZGF0ZSBmb3JtYXQgdG8gYXBwZWFyIHByb3Blcmx5IGluIHRoZSBpbnB1dCBkYXRlIGh0bWwgb2JqZWN0CiAgICBmb3IgKGkgPSAwOyBpPCAoJHNjb3BlLmN1cnJlbnRFdmVudC5leHRyYUZpZWxkcykubGVuZ3RoOyBpKyspCiAgICB7CiAgICAgIGxvZ0RlYnVnKCRzY29wZS5jdXJyZW50RXZlbnQuZXh0cmFGaWVsZHNbaV0pOwogICAgICBpZiAoJHNjb3BlLmN1cnJlbnRFdmVudC5leHRyYUZpZWxkc1tpXS5maWVsZF9kYXRhdHlwZT09IkRBVEUiKQogICAgICB7Ci8vIGxvZ0RlYnVnKCJkYXRlIik7CiAgICAgICAgJHNjb3BlLmN1cnJlbnRFdmVudC5leHRyYUZpZWxkc1tpXS5maWVsZF92YWx1ZT1uZXcgRGF0ZSgkc2NvcGUuY3VycmVudEV2ZW50LmV4dHJhRmllbGRzW2ldLmZpZWxkX3ZhbHVlKTsKICAgICAgfQogICAgfQoKICAgIGxvZ0RlYnVnKCIkc2NvcGUuY3VycmVudEV2ZW50Lmluc3RydWN0b3JfaWQ7PSIrJHNjb3BlLmN1cnJlbnRFdmVudC5pbnN0cnVjdG9yX2lkKTsKICAgIGZvcih2YXIgaSA9IDA7IGkgPCAkc2NvcGUuaW5zdHJ1Y3RvcnMubGVuZ3RoOyBpKyspCiAgICB7CiAgICAgIGxvZ0RlYnVnKCRzY29wZS5pbnN0cnVjdG9yc1tpXS5pc19hY3RpdmUpOwogICAgICBpZiAoJHNjb3BlLmluc3RydWN0b3JzW2ldLmJ1c2luZXNzX3VzZXJfaWQ9PSRzY29wZS5jdXJyZW50RXZlbnQuaW5zdHJ1Y3Rvcl9pZCkKICAgICAgewogICAgICAgIGxvZ0RlYnVnKCJ5ZXNoIik7CiAgICAgICAgJHNjb3BlLmluc3RydWN0b3JzW2ldLmlzX2FjdGl2ZT0xOwogICAgICB9CiAgICB9CiAgfQoKICAkc2NvcGUudXBkYXRlVXNlckV2ZW50UHJpY2UgPSBmdW5jdGlvbihuZXd2YWx1ZSwgdGhlZXZlbnQpCiAgewogICAgbmV3X3ByaWNlPW5ld3ZhbHVlOwogICAgc2V0Q2xpZW50RXZlbnRQcmljZSgkaHR0cCwkc2NvcGUsJHNjb3BlLmN1cnJlbnRFdmVudC5ldmVudFVzZXJzWzBdLmJ1c2luZXNzX3VzZXJfaWQsdGhlZXZlbnQuZXZlbnRfaWQsIG5ld19wcmljZSxzZXRDbGllbnRFdmVudFByaWNlX2NhbGxiYWNrLCBzZXRDbGllbnRFdmVudFByaWNlX2NhbGxiYWNrKTsKICAgIGZ1bmN0aW9uIHNldENsaWVudEV2ZW50UHJpY2VfY2FsbGJhY2soKQogICAgewogICAgICBnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkcm91dGVQYXJhbXMuZXZlbnRfaWQsc2V0UGFydGljaXBhdGVkKTsKICAgIH0KICB9OwoKICAkc2NvcGUuJG9uKCJldmVudFBhZ2VSZWxvYWREYXRhIixmdW5jdGlvbihlLGEpCiAgewogICAgZ2V0Q2xpZW50U3BlY2lmaWNFdmVudCgkaHR0cCwkc2NvcGUsJ2N1cnJlbnRFdmVudCcsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLHNldFBhcnRpY2lwYXRlZCk7CiAgfSk7CgoKCgogICRzY29wZS5jbG9zZUV2ZW50ID0gZnVuY3Rpb24oKQogIHsKICAgIGxvZ0RlYnVnKCJjaGVja2luZyBpZiBldmVudCBoYXMgZXh0cmEgZmllbGRzIHRoYXQgYXJlIHJlcXVpcmVkIGJlZm9yZSBjbG9zaW5nIGl0Iik7CiAgICBjaGVja0V2ZW50RXh0cmFGaWVsZHMoJGh0dHAsJHNjb3BlLCdjaGVja0V2ZW50RXh0cmFGaWVsZHMnLCRyb3V0ZVBhcmFtcy5ldmVudF9pZCxjaGVja0V2ZW50RXh0cmFGaWVsZHNfc3VjY2Vzcyk7CiAgICBmdW5jdGlvbiBjaGVja0V2ZW50RXh0cmFGaWVsZHNfc3VjY2VzcygpCiAgICB7CiAgICAgIGlmICgkc2NvcGUuY2hlY2tFdmVudEV4dHJhRmllbGRzPT10cnVlKQogICAgICB7CiAgICAgICAgbG9nRGVidWcoImV2ZW50IGhhcyBhbGwgZXh0cmEgZmllbGRzIG9rLCBjbG9zaW5nIGV2ZW50Iik7Ci8vICRzY29wZS5jdXJyZW50RXZlbnQuaWdub3JlRXh0cmFGaWVsZHNWYWxpZGF0aW9uPXRydWU7CiAgICAgICAgY2xvc2VFdmVudCgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmV2ZW50X2lkLCRzY29wZS5jdXJyZW50RXZlbnQsYWZ0ZXJDbG9zZUV2ZW50LGFmdGVyQ2xvc2VFdmVudCk7CiAgICAgICAgZnVuY3Rpb24gYWZ0ZXJDbG9zZUV2ZW50KCkKICAgICAgICB7CiAgICAgICAgICBnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkcm91dGVQYXJhbXMuZXZlbnRfaWQsc2V0UGFydGljaXBhdGVkKTsKICAgICAgICB9OwogICAgICB9CiAgICAgIGVsc2UKICAgICAgewogICAgICAgIGxvZ0RlYnVnKCJldmVudCBoYXMgZXh0cmEgZmllbGRzIHJlcXVpcmVkIHRoYXQgYXJlIG5vdCBmaWxsZWQiKTsKICAgICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAgICAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdidXNpbmVzc19tb2RhbF9ldmVudF9jbG9zZV9pZ25vcmVfbWFuZGF0b3J5X2ZpZWxkcy5waHAnLAogICAgICAgICAgY29udHJvbGxlcjogJ2V2ZW50Q2xvc2VJZ25vcmVNYW5kYXRvcnlGaWVsZHNNb2RhbENvbnRyb2xsZXInLAogICAgICAgICAgc2l6ZTogJ20nLAogICAgICAgICAgcmVzb2x2ZTogewogICAgICAgICAgICBjdXJyZW50RXZlbnQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHJldHVybiAkc2NvcGUuY3VycmVudEV2ZW50OwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICB9CiAgJHNjb3BlLnJlb3BlbkV2ZW50ID0gZnVuY3Rpb24oKQogIHsKICAgIGxvZ0RlYnVnKCJyZW9wZW5FdmVudCIpOwogICAgcmVvcGVuRXZlbnQoJGh0dHAsJHNjb3BlLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQsJHNjb3BlLmN1cnJlbnRFdmVudCxhZnRlclJlb3BlbkV2ZW50LGFmdGVyUmVvcGVuRXZlbnQpOwogICAgZnVuY3Rpb24gYWZ0ZXJSZW9wZW5FdmVudCgpCiAgICB7CiAgICAgIGdldENsaWVudFNwZWNpZmljRXZlbnQoJGh0dHAsJHNjb3BlLCdjdXJyZW50RXZlbnQnLCRzY29wZS5jdXJyZW50RXZlbnQuZXZlbnRfaWQsc2V0UGFydGljaXBhdGVkKTsKICAgIH07CiAgfQoKfSk7CgprdXplQXBwLmZpbHRlcignc3RhcnRGcm9tJywgZnVuY3Rpb24oKQp7CiAgcmV0dXJuIGZ1bmN0aW9uKGlucHV0LCBzdGFydCkKICB7CiAgICBpZighaW5wdXQpIHJldHVybiBbXTsKLy8gY29uc29sZS5sb2coImhlcmVyZWVlICIraW5wdXQpOwogICAgc3RhcnQgPSArc3RhcnQ7IC8vcGFyc2UgdG8gaW50CiAgICByZXR1cm4gaW5wdXQuc2xpY2Uoc3RhcnQpOwogIH0KfSk7Ci8vIGFuZ3VsYXIgZmlsdGVyIGZvciBldmVudHMgYmVmb3JlL2FmdGVyIHRvZGF5Cmt1emVBcHAuZmlsdGVyKCdiZWZvcmVOb3cnLCBmdW5jdGlvbigpIHsKLy8gQ3JlYXRlIHRoZSByZXR1cm4gZnVuY3Rpb24gYW5kIHNldCB0aGUgcmVxdWlyZWQgcGFyYW1ldGVyIG5hbWUgdG8gKippbnB1dCoqCiAgcmV0dXJuIGZ1bmN0aW9uKGlucHV0KSB7CiAgICB2YXIgb3V0ID0gW107CgovLyBVc2luZyB0aGUgYW5ndWxhci5mb3JFYWNoIG1ldGhvZCwgZ28gdGhyb3VnaCB0aGUgYXJyYXkgb2YgZGF0YSBhbmQgcGVyZm9ybSB0aGUgb3BlcmF0aW9uIG9mIGZpZ3VyaW5nIG91dCBpZiB0aGUgbGFuZ3VhZ2UgaXMgc3RhdGljYWxseSBvciBkeW5hbWljYWxseSB0eXBlZC4KICAgIHZhciBicm93c2VyX2Vwb2NoID0gKG5ldyBEYXRlKS5nZXRUaW1lKCk7CgogICAgYW5ndWxhci5mb3JFYWNoKGlucHV0LCBmdW5jdGlvbihldmVudCkKICAgIHsKLy8gIGxvZ0RlYnVnKCJmaWx0ZXJpbmcsIGV2ZW50LmV2ZW50X3VzZXJfc3RhdHVzX2lkPSIrZXZlbnQuZXZlbnRfdXNlcl9zdGF0dXNfaWQpOwogICAgICBpZiAoZXZlbnQuc3RhcnRfZXBvY2ggPD0gKGJyb3dzZXJfZXBvY2gvMTAwMCkpCiAgICAgIHsKICAgICAgICBvdXQucHVzaChldmVudCkKICAgICAgfQogICAgfSkKICAgIHJldHVybiBvdXQ7CiAgfQp9KTsKa3V6ZUFwcC5maWx0ZXIoJ2FmdGVyTm93JywgZnVuY3Rpb24oKSB7Ci8vIENyZWF0ZSB0aGUgcmV0dXJuIGZ1bmN0aW9uIGFuZCBzZXQgdGhlIHJlcXVpcmVkIHBhcmFtZXRlciBuYW1lIHRvICoqaW5wdXQqKgogIHJldHVybiBmdW5jdGlvbihpbnB1dCkgewogICAgdmFyIG91dCA9IFtdOwoKLy8gVXNpbmcgdGhlIGFuZ3VsYXIuZm9yRWFjaCBtZXRob2QsIGdvIHRocm91Z2ggdGhlIGFycmF5IG9mIGRhdGEgYW5kIHBlcmZvcm0gdGhlIG9wZXJhdGlvbiBvZiBmaWd1cmluZyBvdXQgaWYgdGhlIGxhbmd1YWdlIGlzIHN0YXRpY2FsbHkgb3IgZHluYW1pY2FsbHkgdHlwZWQuCiAgICB2YXIgYnJvd3Nlcl9lcG9jaCA9IChuZXcgRGF0ZSkuZ2V0VGltZSgpOwoKICAgIGFuZ3VsYXIuZm9yRWFjaChpbnB1dCwgZnVuY3Rpb24oZXZlbnQpCiAgICB7Ci8vICBsb2dEZWJ1ZygiZmlsdGVyaW5nLCBldmVudC5ldmVudF91c2VyX3N0YXR1c19pZD0iK2V2ZW50LmV2ZW50X3VzZXJfc3RhdHVzX2lkKTsKICAgICAgaWYgKGV2ZW50LnN0YXJ0X2Vwb2NoID4gKGJyb3dzZXJfZXBvY2gvMTAwMCkpCiAgICAgIHsKICAgICAgICBvdXQucHVzaChldmVudCkKICAgICAgfQogICAgfSkKICAgIHJldHVybiBvdXQ7CiAgfQp9KTsKCmt1emVBcHAuZmlsdGVyKCdpc0FjdGl2ZScsIGZ1bmN0aW9uKCkgewovLyBDcmVhdGUgdGhlIHJldHVybiBmdW5jdGlvbiBhbmQgc2V0IHRoZSByZXF1aXJlZCBwYXJhbWV0ZXIgbmFtZSB0byAqKmlucHV0KioKICByZXR1cm4gZnVuY3Rpb24oaW5wdXQpIHsKICAgIHZhciBvdXQgPSBbXTsKCi8vIFVzaW5nIHRoZSBhbmd1bGFyLmZvckVhY2ggbWV0aG9kLCBnbyB0aHJvdWdoIHRoZSBhcnJheSBvZiBkYXRhIGFuZCBwZXJmb3JtIHRoZSBvcGVyYXRpb24gb2YgZmlndXJpbmcgb3V0IGlmIHRoZSBsYW5ndWFnZSBpcyBzdGF0aWNhbGx5IG9yIGR5bmFtaWNhbGx5IHR5cGVkLgoKICAgIGFuZ3VsYXIuZm9yRWFjaChpbnB1dCwgZnVuY3Rpb24oZXZlbnQpCiAgICB7Ci8vICBsb2dEZWJ1ZygiZmlsdGVyaW5nLCBldmVudC5ldmVudF91c2VyX3N0YXR1c19pZD0iK2V2ZW50LmV2ZW50X3VzZXJfc3RhdHVzX2lkKTsKICAgICAgaWYgKGV2ZW50LmlzX2FjdGl2ZT09MSkKICAgICAgewogICAgICAgIG91dC5wdXNoKGV2ZW50KQogICAgICB9CiAgICB9KQogICAgcmV0dXJuIG91dDsKICB9Cn0pOwoKa3V6ZUFwcC5maWx0ZXIoJ3Nob3VsZF9iZV9kaXNwbGF5ZWQnLCBmdW5jdGlvbigpIHsKLy8gQ3JlYXRlIHRoZSByZXR1cm4gZnVuY3Rpb24gYW5kIHNldCB0aGUgcmVxdWlyZWQgcGFyYW1ldGVyIG5hbWUgdG8gKippbnB1dCoqCiAgcmV0dXJuIGZ1bmN0aW9uKGlucHV0KSB7CiAgICB2YXIgb3V0ID0gW107CgovLyBVc2luZyB0aGUgYW5ndWxhci5mb3JFYWNoIG1ldGhvZCwgZ28gdGhyb3VnaCB0aGUgYXJyYXkgb2YgZGF0YSBhbmQgcGVyZm9ybSB0aGUgb3BlcmF0aW9uIG9mIGZpZ3VyaW5nIG91dCBpZiB0aGUgbGFuZ3VhZ2UgaXMgc3RhdGljYWxseSBvciBkeW5hbWljYWxseSB0eXBlZC4KCiAgICBhbmd1bGFyLmZvckVhY2goaW5wdXQsIGZ1bmN0aW9uKGV2ZW50KQogICAgewovLyAgbG9nRGVidWcoImZpbHRlcmluZywgZXZlbnQuZXZlbnRfdXNlcl9zdGF0dXNfaWQ9IitldmVudC5ldmVudF91c2VyX3N0YXR1c19pZCk7CiAgICAgIGlmIChldmVudC5zaG91bGRfYmVfZGlzcGxheWVkPT0xKQogICAgICB7CiAgICAgICAgb3V0LnB1c2goZXZlbnQpCiAgICAgIH0KICAgIH0pCiAgICByZXR1cm4gb3V0OwogIH0KfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ0luc3RydWN0b3JTaG93MUNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICR0aW1lb3V0LCAkaHR0cCwgc2hhcmVkUHJvcGVydGllcywgJHJvb3RTY29wZSwgJHJvdXRlUGFyYW1zLCAkbG9jYXRpb24sICRyb3V0ZSwgc2hhcmVkRGF0YSwgJHVpYk1vZGFsKQp7CiAgZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLGdldEJ1c2luZXNzQ2xpZW50SW5mb19zdWNjZXNzKTsKICBnZXRzZWN1cml0eVByb2ZpbGVzKCRodHRwLCRzY29wZSwnc2VjX3Byb2ZpbGVzJyk7CgogIGZ1bmN0aW9uIGdldEJ1c2luZXNzQ2xpZW50SW5mb19zdWNjZXNzKCkKICB7CiAgICBnZXRDbGllbnRFeHRyYUZpZWxkcygkaHR0cCwkc2NvcGUsJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLmJ1c2luZXNzX3VzZXJfaWQsJ2NsaWVudEV4dHJhRmllbGRzJyxnZXRDbGllbnRFeHRyYUZpZWxkc19zdWNjZXNzKTsKCiAgICBmdW5jdGlvbiBnZXRDbGllbnRFeHRyYUZpZWxkc19zdWNjZXNzKCkKICAgIHsKICAgICAgZm9yIChpID0gMDsgaTwgKCRzY29wZS5jbGllbnRFeHRyYUZpZWxkcykubGVuZ3RoOyBpKyspCiAgICAgIHsKICAgICAgICBsb2dEZWJ1Zygkc2NvcGUuY2xpZW50RXh0cmFGaWVsZHNbaV0pOwogICAgICAgIGlmICgkc2NvcGUuY2xpZW50RXh0cmFGaWVsZHNbaV0uZmllbGRfZGF0YXR5cGU9PSJEQVRFIikKICAgICAgICB7Ci8vIGxvZ0RlYnVnKCJkYXRlIik7CiAgICAgICAgICAkc2NvcGUuY2xpZW50RXh0cmFGaWVsZHNbaV0uZmllbGRfdmFsdWU9bmV3IERhdGUoJHNjb3BlLmNsaWVudEV4dHJhRmllbGRzW2ldLmZpZWxkX3ZhbHVlKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CgogICRzY29wZS51cGRhdGVfc2VjX3Byb2ZpbGUgPSBmdW5jdGlvbigpCiAgewogICAgbG9nRGVidWcoInVwZGF0ZV9zZWNfcHJvZmlsZSBmb3IgYnVpZD0iKyRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5idXNpbmVzc191c2VyX2lkKyAiLCBwcm9maWxlX2lkIiskc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uc2VjX3Byb2ZpbGVfaWQpOwogICAgdXBkYXRlX3NlY19wcm9maWxlKCRodHRwLCRzY29wZSwkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYnVzaW5lc3NfdXNlcl9pZCwkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uc2VjX3Byb2ZpbGVfaWQsdXBkYXRlX3NlY19wcm9maWxlX3N1Y2Nlc3MpOwogICAgZnVuY3Rpb24gdXBkYXRlX3NlY19wcm9maWxlX3N1Y2Nlc3MoKQogICAgewogICAgICBnZXRzZWN1cml0eVByb2ZpbGVzKCRodHRwLCRzY29wZSwnc2VjX3Byb2ZpbGVzJyk7CiAgICB9CiAgfQogICRzY29wZS5hcmNoaXZlQ2xpZW50TW9kYWwgPSBmdW5jdGlvbigpCiAgewovLyBhcmNoaXZlL2RlbGV0ZSBjbGllbnQgLSBhc2sgaWYgc3VyZQogICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2FyY2hpdmVfY2xpZW50X21vZGFsLnBocCcsCiAgICAgIHNpemU6ICd4cycsCiAgICAgIGNvbnRyb2xsZXI6ICdhcmNoaXZlX2NsaWVudF9tb2RhbCcsICAvLyAncGF5bWVueURldGFpbHNNb2RhbENvbnRyb2xsZXInLAogICAgICByZXNvbHZlOiB7CiAgICAgICAgYnVzaW5lc3NfdXNlcl9pZDogZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLmJ1c2luZXNzX3VzZXJfaWQ7CiAgICAgICAgfSwKICAgICAgICBidXNlcl9sYXN0X25hbWU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuICRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5idXNlcl9sYXN0X25hbWU7CiAgICAgICAgfSwKICAgICAgICBidXNlcl9maXJzdF9uYW1lOiBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYnVzZXJfZmlyc3RfbmFtZTsKICAgICAgICB9LAogICAgICAgIGlzX2luc3RydWN0b3I6IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKICB9CgogICRzY29wZS51cGRhdGVVc2VyRmlyc3ROYW1lID0gZnVuY3Rpb24obmV3VmFsdWUpCiAgewogICAgc2V0Q2xpZW50Rmlyc3ROYW1lKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCxuZXdWYWx1ZSxhZnRlckNsaWVudFNldCxhZnRlckNsaWVudFNldCk7CiAgICBmdW5jdGlvbiBhZnRlckNsaWVudFNldCgpCiAgICB7CiAgICAgIGdldEJ1c2luZXNzQ2xpZW50SW5mbygkaHR0cCwkc2NvcGUsJ2Zvcm1VcGRhdGVDbGllbnRBbmd1bGFyJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CiAgICB9CiAgfQogICRzY29wZS51cGRhdGVVc2VyTGFzdE5hbWUgPSBmdW5jdGlvbihuZXdWYWx1ZSkKICB7CiAgICBzZXRDbGllbnRMYXN0TmFtZSgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsbmV3VmFsdWUsYWZ0ZXJDbGllbnRTZXQsYWZ0ZXJDbGllbnRTZXQpOwogICAgZnVuY3Rpb24gYWZ0ZXJDbGllbnRTZXQoKQogICAgewogICAgICBnZXRCdXNpbmVzc0NsaWVudEluZm8oJGh0dHAsJHNjb3BlLCdmb3JtVXBkYXRlQ2xpZW50QW5ndWxhcicsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwogICAgfQogIH0KICAkc2NvcGUudXBkYXRlVXNlclBob25lTnVtYmVyID0gZnVuY3Rpb24obmV3VmFsdWUpCiAgewogICAgbmV3VmFsdWUgPSBuZXdWYWx1ZS5yZXBsYWNlKCctJywnJyk7CiAgICBpZiAoaXNOYU4obmV3VmFsdWUpKQogICAgewogICAgICBhbGVydCgi15DXoNeQINeU15bXnyDXnteh16TXqCDXmNec16TXldefINeq16fXmdefIik7CiAgICAgIGdldEJ1c2luZXNzQ2xpZW50SW5mbygkaHR0cCwkc2NvcGUsJ2Zvcm1VcGRhdGVDbGllbnRBbmd1bGFyJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgIHNldENsaWVudFBob25lTnVtYmVyKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCxuZXdWYWx1ZSxzZXRDbGllbnRQaG9uZU51bWJlcl9jYWxsYmFjayxzZXRDbGllbnRQaG9uZU51bWJlcl9jYWxsYmFjayk7CiAgICAgIGZ1bmN0aW9uIHNldENsaWVudFBob25lTnVtYmVyX2NhbGxiYWNrKCkKICAgICAgewogICAgICAgIGdldEJ1c2luZXNzQ2xpZW50SW5mbygkaHR0cCwkc2NvcGUsJ2Zvcm1VcGRhdGVDbGllbnRBbmd1bGFyJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CiAgICAgIH0KICAgIH0KICB9Cgp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ0NsaWVudHNTaG93MUNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICR0aW1lb3V0LCAkaHR0cCwgc2hhcmVkUHJvcGVydGllcywgJHJvb3RTY29wZSwgJHJvdXRlUGFyYW1zLCAkbG9jYXRpb24sICRyb3V0ZSwgc2hhcmVkRGF0YSwgJHVpYk1vZGFsLCBCdXNpbmVzc0NvbmZpZykKewogIGdldEJ1c2luZXNzQ2xpZW50SW5mbygkaHR0cCwkc2NvcGUsJ2Zvcm1VcGRhdGVDbGllbnRBbmd1bGFyJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCxnZXRCdXNpbmVzc0NsaWVudEluZm9fc3VjY2Vzcyk7CgogIGZ1bmN0aW9uIGdldEJ1c2luZXNzQ2xpZW50SW5mb19zdWNjZXNzKCkKICB7CiAgICBnZXRDbGllbnRFeHRyYUZpZWxkcygkaHR0cCwkc2NvcGUsJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLmJ1c2luZXNzX3VzZXJfaWQsJ2NsaWVudEV4dHJhRmllbGRzJyxnZXRDbGllbnRFeHRyYUZpZWxkc19zdWNjZXNzKTsKCiAgICBmdW5jdGlvbiBnZXRDbGllbnRFeHRyYUZpZWxkc19zdWNjZXNzKCkKICAgIHsKICAgICAgZm9yIChpID0gMDsgaTwgKCRzY29wZS5jbGllbnRFeHRyYUZpZWxkcykubGVuZ3RoOyBpKyspCiAgICAgIHsKICAgICAgICBsb2dEZWJ1Zygkc2NvcGUuY2xpZW50RXh0cmFGaWVsZHNbaV0pOwogICAgICAgIGlmICgkc2NvcGUuY2xpZW50RXh0cmFGaWVsZHNbaV0uZmllbGRfZGF0YXR5cGU9PSJEQVRFIikKICAgICAgICB7Ci8vIGxvZ0RlYnVnKCJkYXRlIik7CiAgICAgICAgICAkc2NvcGUuY2xpZW50RXh0cmFGaWVsZHNbaV0uZmllbGRfdmFsdWU9bmV3IERhdGUoJHNjb3BlLmNsaWVudEV4dHJhRmllbGRzW2ldLmZpZWxkX3ZhbHVlKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CiAgewogICAgZ2V0Q2xpZW50RXZlbnRzKCRodHRwLCRzY29wZSwnY3VycmVudENsaWVudEV2ZW50cycsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwoKICAgIGdldENsaWVudFBheW1lbnRzKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCwnY3VycmVudENsaWVudFBheW1lbnRzJyk7CgogICAgJHNjb3BlLmFyY2hpdmVDbGllbnRNb2RhbCA9IGZ1bmN0aW9uKCkKICAgIHsKLy8gYXJjaGl2ZS9kZWxldGUgY2xpZW50IC0gYXNrIGlmIHN1cmUKICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgICAgICAgYW5pbWF0aW9uOiBmYWxzZSwKICAgICAgICB0ZW1wbGF0ZVVybDogJGdUZW1wbGF0ZVByZWZpeCArICdhcmNoaXZlX2NsaWVudF9tb2RhbC5waHAnLAogICAgICAgIHNpemU6ICd4cycsCiAgICAgICAgY29udHJvbGxlcjogJ2FyY2hpdmVfY2xpZW50X21vZGFsJywgIC8vICdwYXltZW55RGV0YWlsc01vZGFsQ29udHJvbGxlcicsCiAgICAgICAgcmVzb2x2ZTogewogICAgICAgICAgYnVzaW5lc3NfdXNlcl9pZDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiAkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYnVzaW5lc3NfdXNlcl9pZDsKICAgICAgICAgIH0sCiAgICAgICAgICBidXNlcl9sYXN0X25hbWU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLmJ1c2VyX2xhc3RfbmFtZTsKICAgICAgICAgIH0sCiAgICAgICAgICBidXNlcl9maXJzdF9uYW1lOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuICRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5idXNlcl9maXJzdF9uYW1lOwogICAgICAgICAgfSwKICAgICAgICAgIGlzX2luc3RydWN0b3I6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICAgICRzY29wZS5wYWNrYWdlRGVsZXRlID0gZnVuY3Rpb24ocGFja2FnZSkKICAgIHsKICAgICAgbG9nRGVidWcoInBhY2thZ2UgZGVsZXRlICIrSlNPTi5zdHJpbmdpZnkocGFja2FnZSkpOwogICAgICBkZWxldGVQYWNrYWdlKCRodHRwLCRzY29wZSxwYWNrYWdlLnBhY2thZ2VfdXNlcl9pZCwkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0uYnVzaW5lc3NfdXNlcl9pZCxzdWNjZXNzX2NhbGxiYWNrLCBzdWNjZXNzX2NhbGxiYWNrKTsKICAgICAgZnVuY3Rpb24gc3VjY2Vzc19jYWxsYmFjaygpCiAgICAgIHsKICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NsaWVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCiAgICAgIH0KICAgIH0KCiAgICAkc2NvcGUudXBkYXRlQ2xpZW50RXh0cmFGaWVsZHMgPSBmdW5jdGlvbigpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJ1cGRhdGVDbGllbnRFeHRyYUZpZWxkcyIpOwogICAgICB0aGVkYXRhID0gewogICAgICAgIGV4dHJhRmllbGRzOiRzY29wZS5jbGllbnRFeHRyYUZpZWxkcwogICAgICB9OwogICAgICAkc2NvcGUuZXh0cmFGaWVsZHNBbGVydE1lc3NhZ2U9Itep15XXnteoLi4uIjsKICAgICAgdXBkYXRlQ2xpZW50RXh0cmFGaWVsZHMoJGh0dHAsJHNjb3BlLCRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5idXNpbmVzc191c2VyX2lkLHRoZWRhdGEsdXBkYXRlRXZlbnRDbGllbnRGaWVsZHNfY2FsbGJhY2ssIHVwZGF0ZUV2ZW50Q2xpZW50RmllbGRzX2NhbGxiYWNrKTsKCiAgICAgIGZ1bmN0aW9uIHVwZGF0ZUV2ZW50Q2xpZW50RmllbGRzX2NhbGxiYWNrKCkKICAgICAgewovLyBnZXRDbGllbnRTcGVjaWZpY0V2ZW50KCRodHRwLCRzY29wZSwnY3VycmVudEV2ZW50Jywkcm91dGVQYXJhbXMuZXZlbnRfaWQsc2V0UGFydGljaXBhdGVkKTsKICAgICAgICAkc2NvcGUuZXh0cmFGaWVsZHNBbGVydE1lc3NhZ2U9Iteg16nXnteoISI7CiAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKQogICAgICAgIHsKICAgICAgICAgICRzY29wZS5leHRyYUZpZWxkc0FsZXJ0TWVzc2FnZT1udWxsOwogICAgICAgIH0sIDMwMDApOwogICAgICB9CiAgICB9OwoKICAgICRzY29wZS5zY2hlZHVsZUV2ZW50Rm9yQ2xpZW50ID0gZnVuY3Rpb24oKQogICAgewogICAgICBsb2dEZWJ1Zygic2VldGluZyBzaGFyZSBwcm9wZXJ0eSB1c2VyX2lkICIrJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdKTsKICAgICAgc2hhcmVkUHJvcGVydGllcy5zZXRfc2VsZWN0ZWRfdXNlcigkc2NvcGUuZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXJbMF0pOwogICAgICAkbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2NhbGVuZGFyJyk7CiAgICB9CiAgICAkc2NvcGUuaW52b2ljZUdlbmVyYXRlQ2hlY2tib3ggPSBmdW5jdGlvbihmcGF5bWVudCkKICAgIHsKICAgICAgbG9nRGVidWcoImludm9pY2VHZW5lcmF0ZUNoZWNrYm94IGZvciAiK0pTT04uc3RyaW5naWZ5KGZwYXltZW50KSk7CiAgICAgIHNldENsaWVudFBheW1lbnRJbnZvaWNlR2VuZXJhdGVkKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCxmcGF5bWVudC51c2VyX3BheW1lbnRfaWQsZnBheW1lbnQuaW52b2ljZV9nZW5lcmF0ZWQsc2V0Q2xpZW50UGF5bWVudEludm9pY2VHZW5lcmF0ZWRfY2FsbGJhY2ssIHNldENsaWVudFBheW1lbnRJbnZvaWNlR2VuZXJhdGVkX2NhbGxiYWNrKTsKICAgICAgZnVuY3Rpb24gc2V0Q2xpZW50UGF5bWVudEludm9pY2VHZW5lcmF0ZWRfY2FsbGJhY2soKQogICAgICB7CiAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgICB9CiAgICB9OwoKICAgICRzY29wZS5yZWNhbGNVc2VyQmFsYW5jZSA9IGZ1bmN0aW9uKCkKICAgIHsKICAgICAgbG9nRGVidWcoInJlY2FsY1VzZXJCYWxhbmNlIik7CiAgICAgIHJlY2FsY1VzZXJCYWxhbmNlKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCwgcmVjYWxjVXNlckJhbGFuY2VfY2FsbGJhY2spOwogICAgICBmdW5jdGlvbiByZWNhbGNVc2VyQmFsYW5jZV9jYWxsYmFjaygpCiAgICAgIHsKICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NsaWVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCiAgICAgIH0gICAgfQogICAgJHNjb3BlLnVwZGF0ZUV2ZW50UGFja2FnZVJlZmVyZW5jZSA9IGZ1bmN0aW9uKHVzZXJfaWQsIGZtZWV0aW5nKQogICAgewogICAgICBsb2dEZWJ1ZygidXBkYXRlRXZlbnRQYWNrYWdlUmVmZXJlbmNlLCB1c2VyPSIrdXNlcl9pZCsiLCBmbWVldGluZz0iK0pTT04uc3RyaW5naWZ5KGZtZWV0aW5nKSk7CiAgICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewogICAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfY2xpZW50X2V2ZW50X3BhY2thZ2VfYXNzb2NpYXRpb24ucGhwJywKICAgICAgICBzaXplOiAneHMnLAogICAgICAgIGNvbnRyb2xsZXI6ICdldmVudFBhY2thZ2VBc3NvY2lhdGlvbk1vZGFsQ29udHJvbGxlcicsICAvLyAncGF5bWVueURldGFpbHNNb2RhbENvbnRyb2xsZXInLAogICAgICAgIHJlc29sdmU6IHsKICAgICAgICAgIGZtZWV0aW5nOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIGZtZWV0aW5nOwogICAgICAgICAgfSwKICAgICAgICAgIGJhbGFuY2U6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyWzBdLmJhbGFuY2U7CiAgICAgICAgICB9LAogICAgICAgICAgYnVzaW5lc3NfdXNlcl9pZDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiAkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgfTsKCiAgICAkc2NvcGUudXBkYXRlUGFja2FnZVBheW1lbnRSZWZlcmVuY2UgPSBmdW5jdGlvbih1c2VyX2lkLCBmcGFja2FnZSkKICAgIHsKICAgICAgbG9nRGVidWcoInVwZGF0ZVBhY2thZ2VQYXltZW50UmVmZXJlbmNlLCB1c2VyPSIrdXNlcl9pZCsiLCBmcGFja2FnZT0iK0pTT04uc3RyaW5naWZ5KGZwYWNrYWdlKSk7CiAgICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewogICAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnYnVzaW5lc3NfbW9kYWxfY2xpZW50X3BhY2thZ2VfcGF5bWVudF9hc3NvY2lhdGlvbi5waHAnLAogICAgICAgIHNpemU6ICd4cycsCiAgICAgICAgY29udHJvbGxlcjogJ3BhY2thZ2VQYXltZW50QXNzb2NpYXRpb25Nb2RhbENvbnRyb2xsZXInLCAgLy8gJ3BheW1lbnlEZXRhaWxzTW9kYWxDb250cm9sbGVyJywKICAgICAgICByZXNvbHZlOiB7CiAgICAgICAgICBmcGFja2FnZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiBmcGFja2FnZTsKICAgICAgICAgIH0sCiAgICAgICAgICBiYWxhbmNlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuICRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5iYWxhbmNlOwogICAgICAgICAgfSwKICAgICAgICAgIGJ1c2luZXNzX3VzZXJfaWQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQ7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgIH07CgovLyBzaG93IHBheW1lbnQgcG9wdXAKICAgICRzY29wZS5zaG93UGF5bWVudERldGFpbHMgPSBmdW5jdGlvbihmcGF5bWVudCkKICAgIHsKICAgICAgbG9nRGVidWcoInNob3dQYXltZW50RGV0YWlscyIpOwogICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHsKICAgICAgICBhbmltYXRpb246IGZhbHNlLAogICAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2NsaWVudF9wYXltZW50X2RldGFpbHMucGhwJywKICAgICAgICBzaXplOiAneHMnLAogICAgICAgIGNvbnRyb2xsZXI6ICdwYXltZW55RGV0YWlsc01vZGFsQ29udHJvbGxlcicsCiAgICAgICAgcmVzb2x2ZTogewogICAgICAgICAgZnBheW1lbnQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gZnBheW1lbnQ7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICAgICRzY29wZS5pbnZvaWNlTnVtYmVyQ2hhbmdlZCA9IGZ1bmN0aW9uKG5ld19pbnZvaWNlX251bWJlcixmcGF5bWVudCkKICAgIHsKICAgICAgbG9nRGVidWcoImludm9pY2VOdW1iZXJDaGFuZ2VkICIrIG5ld19pbnZvaWNlX251bWJlciArImZvciAiK0pTT04uc3RyaW5naWZ5KGZwYXltZW50KSk7CiAgICAgIHNldENsaWVudFBheW1lbnRJbnZvaWNlTnVtYmVyKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCxmcGF5bWVudC51c2VyX3BheW1lbnRfaWQsbmV3X2ludm9pY2VfbnVtYmVyLHNldENsaWVudFBheW1lbnRJbnZvaWNlTnVtYmVyX2NhbGxiYWNrLCBzZXRDbGllbnRQYXltZW50SW52b2ljZU51bWJlcl9jYWxsYmFjayk7CiAgICAgIGZ1bmN0aW9uIHNldENsaWVudFBheW1lbnRJbnZvaWNlTnVtYmVyX2NhbGxiYWNrKCkKICAgICAgewovLyAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NsaWVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCiAgICAgIH0KICAgIH07CgogICAgJHNjb3BlLiRvbigiY2xpZW50UGFnZVJlbG9hZERhdGEiLGZ1bmN0aW9uKGUsYSkKICAgIHsKICAgICAgbG9nRGVidWcoImNsaWVudFBhZ2VSZWxvYWREYXRhIik7CiAgICAgIGdldEJ1c2luZXNzVXNlclBhY2thZ2VzKCRodHRwLCRzY29wZSwndXNlcl9wYWNrYWdlcycsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwogICAgICBnZXRDbGllbnRQYXltZW50cygkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsJ2N1cnJlbnRDbGllbnRQYXltZW50cycpOwogICAgICBnZXRDbGllbnRFdmVudHMoJGh0dHAsJHNjb3BlLCdjdXJyZW50Q2xpZW50RXZlbnRzJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CiAgICAgIGdldEJ1c2luZXNzQ2xpZW50SW5mbygkaHR0cCwkc2NvcGUsJ2Zvcm1VcGRhdGVDbGllbnRBbmd1bGFyJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CgogICAgICAvLyAkdGltZW91dChmdW5jdGlvbigpCiAgICAgIC8vIHsKICAgICAgLy8gICAkc2NvcGUuY3Vyc29yZGVsZXRlPSIiOwogICAgICAvLyAgIGRvY3VtZW50LmJvZHkuc3R5bGUuY3Vyc29yPScnOwogICAgICAvLyB9LCAyMDAwKTsKCiAgICB9KTsKCiAgICAkc2NvcGUuaXNDb25maXJtZWRPckNsb3NlZCA9IGZ1bmN0aW9uKGV2ZW50KQogICAgewogICAgICBpZiAoJHNjb3BlLnNob3dBbGxFdmVudHMpCiAgICAgIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQoKICAgICAgaWYgKChldmVudC5pc19jb25maXJtZWQgPT0gMSkgfHwgKGV2ZW50LmlzX2ZpbmFsX3N0YXR1cyA9PSAxKSB8fCAoKGV2ZW50LmlzX3dhaXRpbmdfbGlzdCA9PSAxKSAmJiAoZXZlbnQuaXNfY2FuY2VsZWQgPT0gMCkpKQogICAgICB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgZWxzZQogICAgICB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9CiAgICAkc2NvcGUuZ290b0NsaWVudEVkaXRQYWdlPWdvdG9DbGllbnRFZGl0UGFnZTsKICAgICRzY29wZS5nb3RvQmFjaz1mdW5jdGlvbigpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCdnbyBiYWNrJyk7CiAgICAgIHdpbmRvdy5oaXN0b3J5LmJhY2soKTsKICAgIH07CgogICAgJHNjb3BlLmdvdG9FdmVudFBhZ2UgPSBmdW5jdGlvbiAodGhlZXZlbnQpCiAgICB7CiAgICAgIGdvdG9FdmVudFBhZ2UodGhlZXZlbnQpOwogICAgfQogIH0KICAkc2NvcGUuaW5pdGlhdGVQYXltZW50ID0gZnVuY3Rpb24oaXNwbHVzKQogIHsKICAgIGxvZ0RlYnVnKCJpbml0aWF0ZVBheW1lbnQgaXNwbHVzIitpc3BsdXMpOwogICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgICAgIHRlbXBsYXRlVXJsOiAkZ1RlbXBsYXRlUHJlZml4ICsgJ2J1c2luZXNzX21vZGFsX2NsaWVudF9wYXltZW50LnBocCcsCiAgICAgIGNvbnRyb2xsZXI6ICdidXNpbmVzc0NsaWVuZENhcmRQYXltZW50JywKLy8gc2l6ZTogc2l6ZSwKICAgICAgcmVzb2x2ZTogewogICAgICAgIGN1cnJlbnRDbGllbnQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuICRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXTsKICAgICAgICB9LAogICAgICAgIGlzcGx1czogZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gaXNwbHVzOwogICAgICAgIH0sCiAgICAgICAgYnVzaW5lc3NDb25maWc6IEJ1c2luZXNzQ29uZmlnLmdldCgpLAogICAgICAgIHBheW1lbnRzOiBnZXRDbGllbnRQYXltZW50c1Byb21pc2UoJGh0dHAsICRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhclswXS5idXNpbmVzc191c2VyX2lkKQogICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocikgewogICAgICAgICAgICAgIHJldHVybiByLmRhdGEuanNvbgogICAgICAgICAgICB9KQogICAgICB9CiAgICB9KTsKICB9CgogICRzY29wZS51cGRhdGVVc2VyRmlyc3ROYW1lID0gZnVuY3Rpb24obmV3VmFsdWUpCiAgewogICAgc2V0Q2xpZW50Rmlyc3ROYW1lKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCxuZXdWYWx1ZSxhZnRlckNsaWVudFNldCxhZnRlckNsaWVudFNldCk7CiAgICBmdW5jdGlvbiBhZnRlckNsaWVudFNldCgpCiAgICB7CiAgICAgIGdldEJ1c2luZXNzQ2xpZW50SW5mbygkaHR0cCwkc2NvcGUsJ2Zvcm1VcGRhdGVDbGllbnRBbmd1bGFyJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CiAgICB9CiAgfQogICRzY29wZS51cGRhdGVVc2VyTGFzdE5hbWUgPSBmdW5jdGlvbihuZXdWYWx1ZSkKICB7CiAgICBzZXRDbGllbnRMYXN0TmFtZSgkaHR0cCwkc2NvcGUsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsbmV3VmFsdWUsYWZ0ZXJDbGllbnRTZXQsYWZ0ZXJDbGllbnRTZXQpOwogICAgZnVuY3Rpb24gYWZ0ZXJDbGllbnRTZXQoKQogICAgewogICAgICBnZXRCdXNpbmVzc0NsaWVudEluZm8oJGh0dHAsJHNjb3BlLCdmb3JtVXBkYXRlQ2xpZW50QW5ndWxhcicsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwogICAgfQogIH0KICAkc2NvcGUudXBkYXRlVXNlckVtYWlsID0gZnVuY3Rpb24obmV3VmFsdWUpCiAgewogICAgc2V0Q2xpZW50RW1haWwoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLG5ld1ZhbHVlLGFmdGVyc2V0Q2xpZW50RW1haWwsYWZ0ZXJzZXRDbGllbnRFbWFpbCk7CiAgICBmdW5jdGlvbiBhZnRlcnNldENsaWVudEVtYWlsKCkKICAgIHsKICAgICAgZ2V0QnVzaW5lc3NDbGllbnRJbmZvKCRodHRwLCRzY29wZSwnZm9ybVVwZGF0ZUNsaWVudEFuZ3VsYXInLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKICAgIH0KICB9CgoKICAkc2NvcGUudXBkYXRlVXNlclBob25lTnVtYmVyID0gZnVuY3Rpb24obmV3VmFsdWUpCiAgewogICAgbmV3VmFsdWUgPSBuZXdWYWx1ZS5yZXBsYWNlKCctJywnJyk7CiAgICBpZiAoaXNOYU4obmV3VmFsdWUpKQogICAgewogICAgICBhbGVydCgi15DXoNeQINeU15bXnyDXnteh16TXqCDXmNec16TXldefINeq16fXmdefIik7CiAgICAgIGdldEJ1c2luZXNzQ2xpZW50SW5mbygkaHR0cCwkc2NvcGUsJ2Zvcm1VcGRhdGVDbGllbnRBbmd1bGFyJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgIHNldENsaWVudFBob25lTnVtYmVyKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCxuZXdWYWx1ZSxzZXRDbGllbnRQaG9uZU51bWJlcl9jYWxsYmFjayxzZXRDbGllbnRQaG9uZU51bWJlcl9jYWxsYmFjayk7CiAgICAgIGZ1bmN0aW9uIHNldENsaWVudFBob25lTnVtYmVyX2NhbGxiYWNrKCkKICAgICAgewogICAgICAgIGdldEJ1c2luZXNzQ2xpZW50SW5mbygkaHR0cCwkc2NvcGUsJ2Zvcm1VcGRhdGVDbGllbnRBbmd1bGFyJywkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CiAgICAgIH0KICAgIH0KICB9CiAgJHNjb3BlLnVwZGF0ZVVzZXJFdmVudFByaWNlID0gZnVuY3Rpb24obmV3dmFsdWUsIHRoZWV2ZW50KQogIHsKICAgIG5ld19wcmljZT1uZXd2YWx1ZTsKICAgIHNldENsaWVudEV2ZW50UHJpY2UoJGh0dHAsJHNjb3BlLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLHRoZWV2ZW50LmV2ZW50X2lkLCBuZXdfcHJpY2Usc2V0Q2xpZW50RXZlbnRQcmljZV9jYWxsYmFjaywgc2V0Q2xpZW50RXZlbnRQcmljZV9jYWxsYmFjayk7CiAgICBmdW5jdGlvbiBzZXRDbGllbnRFdmVudFByaWNlX2NhbGxiYWNrKCkKICAgIHsKICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgfQogIH07CgogICRzY29wZS51cGRhdGVVc2VyUGFja2FnZUV2ZW50c0NvdW50ZXIgPSBmdW5jdGlvbihuZXd2YWx1ZSwgdGhlcGFja2FnZSkKICB7CiAgICBldmVudHNfY291bnRlcj1uZXd2YWx1ZTsKICAgIHNldFVzZXJQYWNrYWdlRXZlbnRzQ291bnRlcigkaHR0cCwkc2NvcGUsdGhlcGFja2FnZS5wYWNrYWdlX3VzZXJfaWQsZXZlbnRzX2NvdW50ZXIsc2V0VXNlclBhY2thZ2VFdmVudHNDb3VudGVyX2NhbGxiYWNrLCBzZXRVc2VyUGFja2FnZUV2ZW50c0NvdW50ZXJfY2FsbGJhY2spCiAgICBmdW5jdGlvbiBzZXRVc2VyUGFja2FnZUV2ZW50c0NvdW50ZXJfY2FsbGJhY2soKQogICAgewogICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NsaWVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCiAgICB9CiAgfTsKICAkc2NvcGUudXBkYXRlVXNlclBhY2thZ2VQYWNrYWdlUHJpY2UgPSBmdW5jdGlvbihuZXd2YWx1ZSwgdGhlcGFja2FnZSkKICB7CiAgICBwYWNrYWdlX3ByaWNlPW5ld3ZhbHVlOwogICAgc2V0VXNlclBhY2thZ2VQYWNrYWdlUHJpY2UoJGh0dHAsJHNjb3BlLHRoZXBhY2thZ2UucGFja2FnZV91c2VyX2lkLHBhY2thZ2VfcHJpY2Usc2V0VXNlclBhY2thZ2VQYWNrYWdlUHJpY2VfY2FsbGJhY2ssIHNldFVzZXJQYWNrYWdlUGFja2FnZVByaWNlX2NhbGxiYWNrKQogICAgZnVuY3Rpb24gc2V0VXNlclBhY2thZ2VQYWNrYWdlUHJpY2VfY2FsbGJhY2soKQogICAgewovLyBnZXRCdXNpbmVzc1VzZXJQYWNrYWdlcygkaHR0cCwkc2NvcGUsJ3VzZXJfcGFja2FnZXMnLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgfQogIH07CgogICRzY29wZS5mb3JtVXBkYXRlQ2xpZW50QW5ndWxhciA9IHt9OwogIGxvZ0RlYnVnKCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKICAkc2NvcGUuc2hvd19jbGllbnRfdXBkYXRlX2NsaWVudCA9IHRydWU7CiAgJHNjb3BlLnNob3dfY2xpZW50X3VwZGF0ZV9zYXZlID0gZmFsc2U7CiAgJHNjb3BlLnNob3dfY2xpZW50X2RlbGV0ZV9jbGllbnQgPSB0cnVlOwogICRzY29wZS5zaG93X2NsaWVudF91cGRhdGVfY2FuY2VsID0gZmFsc2U7CgogICRzY29wZS51cGRhdGVDbGllbnRFbmFibGUgPSBmdW5jdGlvbigpIHsKICAgIGxvZ0RlYnVnKCJlbmFibGluZyBlZGl0aW5nICgkc2NvcGUuY2xpZW50c1VwZGF0ZURpc2FibGVkIHdhcyAiICsgJHNjb3BlLmNsaWVudHNVcGRhdGVEaXNhYmxlZCArICIpIik7CiAgICAkc2NvcGUuY2xpZW50c1VwZGF0ZURpc2FibGVkID0gZmFsc2U7CiAgICAkc2NvcGUuc2hvd19jbGllbnRfdXBkYXRlX2NsaWVudCA9IGZhbHNlOwogICAgJHNjb3BlLnNob3dfY2xpZW50X3VwZGF0ZV9zYXZlID0gdHJ1ZTsKICAgICRzY29wZS5zaG93X2NsaWVudF9kZWxldGVfY2xpZW50ID0gZmFsc2U7CiAgICAkc2NvcGUuc2hvd19jbGllbnRfdXBkYXRlX2NhbmNlbCA9IHRydWU7CiAgfQogICRzY29wZS51cGRhdGVDbGllbnREaXNhYmxlID0gZnVuY3Rpb24oKSB7CiAgICBsb2dEZWJ1ZygiZGlzYWJsZSBlZGl0aW5nIik7Ci8vCQkkbG9jYXRpb24ucGF0aCgnL0NsaWVudHMvJyskcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCk7CiAgICAkcm91dGUucmVsb2FkKCk7CiAgfQogICRzY29wZS5zY2hlZHVsZUV2ZW50RnJvbUVuZFVzZXIgPSBmdW5jdGlvbigpIHsKICAgIHNoYXJlZERhdGEuc2V0U2VsZWN0ZWRFbmRVc2VyKHsKICAgICAgaWQ6ICRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkLAogICAgICBmaXJzdF9uYW1lOiAkc2NvcGUuY3VycmVudENsaWVudC51c2Vyc1swXS5maXJzdF9uYW1lLAogICAgICBsYXN0X25hbWU6ICRzY29wZS5jdXJyZW50Q2xpZW50LnVzZXJzWzBdLmxhc3RfbmFtZQogICAgfSk7CiAgICBsb2dEZWJ1Zygic2NoZWR1bGUgZXZlbnQgZm9yIHVzZXIgIiArICRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKLy8JCSRsb2NhdGlvbi5wYXRoKCcvQ2xpZW50cy8nKyRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKICAgICRsb2NhdGlvbi5wYXRoKCcvYnVzaW5lc3NfY2FsZW5kYXInKTsKICB9CgogICRzY29wZS51c2VyRGVsZXRlUGF5bWVudCA9IGZ1bmN0aW9uIChmcGF5bWVudCkKICB7CiAgICAvLyAkc2NvcGUuY3Vyc29yZGVsZXRlPSJ3YWl0IjsKICAgIGxvZ0RlYnVnKCJ1c2VyRGVsZXRlUGF5bWVudCIpOwogICAgLy8gZG9jdW1lbnQuYm9keS5zdHlsZS5jdXJzb3I9J3dhaXQnOwoKICAgIGRlbGV0ZUNsaWVudFBheW1lbnRzKCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCxmcGF5bWVudC51c2VyX3BheW1lbnRfaWQsZGVsZXRlQ2xpZW50UGF5bWVudHNfc3VjY2Vzc19jYWxsYmFjayk7CiAgICBmdW5jdGlvbiBkZWxldGVDbGllbnRQYXltZW50c19zdWNjZXNzX2NhbGxiYWNrKCkKICAgIHsKICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjbGllbnRQYWdlUmVsb2FkRGF0YScpOyAvLyBwYXNzIG9iamVjdCBpbiB7fSBpZiB5b3Ugd2FubmEgdG8gcGFzcyBhbnl0aGluZwogICAgICBsb2dEZWJ1ZygidXNlckRlbGV0ZVBheW1lbnQiKTsKICAgICAgLy8gJHNjb3BlLmN1cnNvcmRlbGV0ZT0iIjsKICAgICAgLy8gZG9jdW1lbnQuYm9keS5zdHlsZS5jdXJzb3I9Jyc7CiAgICB9CiAgfQovLyByZW1vdmUgZW5kIHVzZXIgZnJvbSBldmVudAogICRzY29wZS51c2VyRGVsZXRlRXZlbnQgPSBmdW5jdGlvbihlbmR1c2VyX2lkLCB0aGVldmVudCkKICB7Ci8vIGlmIGl0J3MgYSBjbGFzcyAtIHdlIHNpbXBseSByZW1vdmUgdGhlIHVzZXIgZnJvbSB0aGUgZXZlbnQKICAgIGlmICh0aGVldmVudC5pc19jbGFzcz09MSkKICAgIHsKICAgICAgbG9nRGVidWcoInNjb3BlLnVzZXJEZWxldGVFdmVudCIpOwogICAgICByZW1vdmVFbmRVc2VyRnJvbUV2ZW50KCRodHRwLCRzY29wZSwkcm91dGVQYXJhbXMuYnVzaW5lc3NfdXNlcl9pZCx0aGVldmVudC5ldmVudF9pZCxyZW1vdmVFbmRVc2VyRnJvbUV2ZW50X2ZpbmlzaCwgcmVtb3ZlRW5kVXNlckZyb21FdmVudF9maW5pc2gpOwogICAgICBmdW5jdGlvbiByZW1vdmVFbmRVc2VyRnJvbUV2ZW50X2ZpbmlzaCgpCiAgICAgIHsKICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NsaWVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCiAgICAgIH0KICAgIH0KLy8gaWYgaXRzIG5vdCBhIGNsYXNzIC0gd2UgbmVlZCB0byByZW1vdmUgdGhlIGV2ZW50IGl0c2VsZgogICAgZWxzZQogICAgewovLyBhbGVydCgibm90IGNsYXNzIGV2ZW50LCBUT0RPIik7CiAgICB9CiAgfTsKCi8vIHJldHJldmluZyBwYWNrYWdlcyBmb3IgdGhlIGJ1c2luZXNzCiAgZ2V0QnVzaW5lc3NQYWNrYWdlcygkaHR0cCwkc2NvcGUsJ3BhY2thZ2VzJyk7CgovLyBnZXQgcGFja2FnZXMgZm9yIHRoaXMgc3BlY2lmaWMgdXNlcgogIGdldEJ1c2luZXNzVXNlclBhY2thZ2VzKCRodHRwLCRzY29wZSwndXNlcl9wYWNrYWdlcycsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQpOwovLyBhZGRpbmcgcGFja2FnZSB0byB1c2VyIC0gY2FsbGVkIHdoZW4gYSBwYWNrYWdlIGlzIHNlbGVjdGVkCiAgJHNjb3BlLnBhY2thZ2VGb3JDbGllbnRTZWxlY3RlZCA9IGZ1bmN0aW9uKHNlbGVjdGVkUGFja2FnZSkgewogICAgaWYgKHNlbGVjdGVkUGFja2FnZSkgewovLyBsb2dEZWJ1ZygneWVzIHNlbGVjdGVkICcgKyBKU09OLnN0cmluZ2lmeShzZWxlY3RlZFBhY2thZ2UpKTsKICAgICAgYWRkQnVzaW5lc3NQYWNrYWdlVG9Vc2VyKCRodHRwLCRzY29wZSxzZWxlY3RlZFBhY2thZ2Uub3JpZ2luYWxPYmplY3QsJHJvdXRlUGFyYW1zLmJ1c2luZXNzX3VzZXJfaWQsYWRkQnVzaW5lc3NQYWNrYWdlU3VjY2Vzcyk7CiAgICAgIGZ1bmN0aW9uIGFkZEJ1c2luZXNzUGFja2FnZVN1Y2Nlc3MoKQogICAgICB7CiAgICAgICAgbG9nRGVidWcoImFkZEJ1c2luZXNzUGFja2FnZVN1Y2Nlc3MyIik7Ci8vIGdldEJ1c2luZXNzUGFja2FnZXMoJGh0dHAsJHNjb3BlLCdwYWNrYWdlcycpOwovLyBnZXRCdXNpbmVzc1VzZXJQYWNrYWdlcygkaHR0cCwkc2NvcGUsJ3VzZXJfcGFja2FnZXMnLCRyb3V0ZVBhcmFtcy5idXNpbmVzc191c2VyX2lkKTsKICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NsaWVudFBhZ2VSZWxvYWREYXRhJyk7IC8vIHBhc3Mgb2JqZWN0IGluIHt9IGlmIHlvdSB3YW5uYSB0byBwYXNzIGFueXRoaW5nCiAgICAgIH0KICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdhbmd1Y29tcGxldGUtYWx0OmNsZWFySW5wdXQnLCAnY2xpZW50X2FuZ3Vjb21wbGV0ZScpOwogICAgfQogICAgZWxzZQogICAgewovLyBsb2dEZWJ1Zygnbm90IHNlbGVjdGVkLCBkbyBub3RoaW5nJyk7CiAgICB9CiAgfTsKfSk7CgoKLy8gTmVlZCB0byBkaXN0aW5ndWlzaCBiZXR3ZWVuIGVuZCB1c2VyIChjbGllbnQpIGFuZCBidXNpbmVzcyBvd25lci4KLy8gY3VycmVudGx5IGNhbGxzIG9ubHkgZW5kIHVzZXIKa3V6ZUFwcC5jb250cm9sbGVyKCdIb21lQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICR1aWJNb2RhbCkKewoKICBnZXRBbGxDbGllbnRzKCRodHRwLCRzY29wZSwnYWxsQ2xpZW50cycpOwoKICAkc2NvcGUuaG9tZXBhZ2VMaW1pdD02OwogIGdldE9wZW5lZEV2ZW50cygkaHR0cCwkc2NvcGUsJHNjb3BlLmhvbWVwYWdlTGltaXQsJ29wZW5lZF9ldmVudHMnKTsKCiAgdmFyIHRvZGF5ZGF0ZSA9IG5ldyBEYXRlKCk7CiAgdmFyIGhvd21hbnlkYXlzYWhlYWQ9MzA7CiAgdmFyIHN0YXJ0ZGF0ZT10b2RheWRhdGUuZ2V0RnVsbFllYXIoKSsiLSIrKDErdG9kYXlkYXRlLmdldE1vbnRoKCkpKyItIit0b2RheWRhdGUuZ2V0RGF0ZSgpOwogIHRvZGF5ZGF0ZS5zZXREYXRlKHRvZGF5ZGF0ZS5nZXREYXRlKCkgKyBob3dtYW55ZGF5c2FoZWFkKTsKICB2YXIgZW5kZGF0ZT10b2RheWRhdGUuZ2V0RnVsbFllYXIoKSsiLSIrKDErdG9kYXlkYXRlLmdldE1vbnRoKCkpKyItIit0b2RheWRhdGUuZ2V0RGF0ZSgpOwoKLy8gZmlsdGVyIGZvciB1c2VycyB3aG8gaGF2ZSBkZWJ0CiAgJHNjb3BlLmhhdmVEZWJ0ID0gZnVuY3Rpb24oZXVzZXIpCiAgewogICAgaWYgKGV1c2VyLnVzZXJfYmFsYW5jZSA8IDApCiAgICB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgZWxzZQogICAgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgfTsKCiAgJHNjb3BlLmdvdG9DbGllbnRQYWdlID0gZnVuY3Rpb24oYnVzaW5lc3NfdXNlcl9pZCkKICB7Ci8vIGxvZ0RlYnVnKGV1c2VyKTsKICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmPScvIy9idXNpbmVzc19jbGllbnRzLycgKyBidXNpbmVzc191c2VyX2lkOwogIH0KCiAgdmFyIHBheWxvYWQgPSAnc3RhcnQ9JyArIHN0YXJ0ZGF0ZSArICcmZW5kPScgKyBlbmRkYXRlOwogIHZhciBjb25maWcgPSB7CiAgICBoZWFkZXJzOiB7J0NvbnRlbnQtVHlwZSc6J2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZDsgY2hhcnNldD1VVEYtOCd9CiAgfQogIHZhciBwb3N0dXJsID0gIi9hcGkvYWRtaW4vcmVwb3J0cy9ldmVudHMyIjsKCiAgJHNjb3BlLmV2ZW50UmVwb3J0Q29uZmlnID0ge307CiAgJHNjb3BlLmV2ZW50UmVwb3J0Q29uZmlnLnNvdXJjZSA9ICJkb2NzIjsKICAkc2NvcGUuZXZlbnRSZXBvcnRDb25maWcuZmlsdGVycyA9IHsKICAgIHN0YXJ0X2RhdGU6IHN0YXJ0ZGF0ZSwKICAgIGlzX2NhbmNlbGVkOiAnMCcsCiAgICBlbmRfZGF0ZTogZW5kZGF0ZQogIH07CgogIGdldEV2ZW50c1JlcG9ydCgkaHR0cCwkc2NvcGUsICRzY29wZS5ldmVudFJlcG9ydENvbmZpZywgZ2V0RXZlbnRzUmVwb3J0QWdncmVnYXRlZF9zdWNjZXNzKTsKCiAgZnVuY3Rpb24gZ2V0RXZlbnRzUmVwb3J0QWdncmVnYXRlZF9zdWNjZXNzKHJlc3BvbnNlKXsKICAgICRzY29wZS5hZG1pbl9ldmVudHMgPSByZXNwb25zZS5qc29uOwogIH0KICAvLyAkaHR0cC5wb3N0KHBvc3R1cmwsIHBheWxvYWQsIGNvbmZpZykuc3VjY2VzcyhmdW5jdGlvbihkYXRhKQogIC8vIHsKICAvLyAgIGxvZ0RlYnVnKCJkb25lIik7CiAgLy8gICAkc2NvcGUuYWRtaW5fZXZlbnRzID0gZGF0YTsKICAvLyB9KTsKCiAgJHNjb3BlLnNob3dFdmVudFBvcHVwID0gZnVuY3Rpb24oc2VsZWN0ZWRFdmVudCkgewogICAgc2hvd0V2ZW50UG9wdXAoc2VsZWN0ZWRFdmVudCwgJHVpYk1vZGFsKQogIH07CiAgJHNjb3BlLmVkaXRFdmVudD0gZnVuY3Rpb24gKHRoZWV2ZW50KQogIHsKICAgIGdvdG9FdmVudFBhZ2UodGhlZXZlbnQpOwogIH0KfSk7CgovLyBrdXplQXBwLmNvbnRyb2xsZXIoJ0J1c2luZXNzQ29uZmlnQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRyb3V0ZVBhcmFtcywgJGxvY2F0aW9uLCAkcm91dGUsIHNoYXJlZERhdGEpIHsKCmt1emVBcHAuY29udHJvbGxlcignQ29uZmlnVXNlckNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICR1aWJNb2RhbCwgJGh0dHAsICR0aW1lb3V0KQp7CiAgJHNjb3BlLmluVGhlTWlkZGxlT2ZTYXZlPWZhbHNlOwoKICBsb2dEZWJ1ZygiQ29uZmlnVXNlckNvbnRyb2xsZXIiKTsKLy8gJHNjb3BlLmFqYXhfaW5mbz0i15TXqdeZ16DXldeZ15nXnSDXoNep157XqNeVIjsKCiAgZ2V0QnVzaW5lc3NVc2VyUmVsYXRpb25zKCRodHRwLCRzY29wZSwnYnVzaW5lc3NfdXNlcl9yZWxhdGlvbnMnLGdldExvZ2dlZFVzZXJJbmZvX3N1Y2Nlc3MsZ2V0TG9nZ2VkVXNlckluZm9fZmFpbHVyZSk7CgogIGdldExvZ2dlZFVzZXJJbmZvKCRodHRwLCRzY29wZSwndXNlclByb3BlcnRpZXMnLGdldExvZ2dlZFVzZXJJbmZvX3N1Y2Nlc3MsZ2V0TG9nZ2VkVXNlckluZm9fZmFpbHVyZSk7CiAgZnVuY3Rpb24gZ2V0TG9nZ2VkVXNlckluZm9fc3VjY2VzcygpCiAgewogICAgbG9nRGVidWcoImdldExvZ2dlZFVzZXJJbmZvX3N1Y2Nlc3MiKTsKICAgIC8vICRzY29wZS51c2VyUHJvcGVydGllc0R1cGxpY2F0ZSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoJHNjb3BlLnVzZXJQcm9wZXJ0aWVzKSk7CiAgfQogIGZ1bmN0aW9uIGdldExvZ2dlZFVzZXJJbmZvX2ZhaWx1cmUoKQogIHsKICAgIGxvZ0RlYnVnKCJnZXRMb2dnZWRVc2VySW5mb19mYWlsdXJlIik7CiAgfQoKICAkc2NvcGUuYmFjayA9IGZ1bmN0aW9uKCkgewogICAgd2luZG93Lmhpc3RvcnkuYmFjaygpOwogIH07CgogICRzY29wZS5jaGFuZ2VQYXNzd29yZE1vZGFsID0gZnVuY3Rpb24oKQogIHsKICAgIGxvZ0RlYnVnKCJjaGFuZ2VQYXNzd29yZE1vZGFsIiskc2NvcGUudXNlclByb3BlcnRpZXNEdXBsaWNhdGVbMF0pOwogICAgJHNjb3BlLmluVGhlTWlkZGxlT2ZTYXZlPXRydWU7CiAgICBmdW5jdGlvbiBzbXNSZXNldFBhc3N3b3JkX3N1Y2Nlc3MoKQogICAgewogICAgICBjb25zb2xlLmxvZygic21zUmVzZXRQYXNzd29yZF9zdWNjZXNzIik7CiAgICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oewogICAgICAgIGFuaW1hdGlvbjogZmFsc2UsCiAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnbW9kYWxfY2hhbmdlX3Bhc3N3b3JkLnBocCcsCiAgICAgICAgY29udHJvbGxlcjogJ21vZGFsX2NoYW5nZV9wYXNzd29yZCcsCiAgICAgICAgc2l6ZTogJ2wnLAogICAgICAgIHJlc29sdmU6IHsKICAgICAgICAgIHVzZXJfcGhvbmVfbnVtYmVyOiBmdW5jdGlvbigpIHsKLy8gcGFzc2luZyBvcmlnaW5hbCBwaG9uZSBudW1iZXIKICAgICAgICAgICAgcmV0dXJuICRzY29wZS51c2VyUHJvcGVydGllc0R1cGxpY2F0ZVswXS5waG9uZV9udW1iZXI7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKCiAgICAgIG1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7CiAgICAgICAgJHNjb3BlLmluVGhlTWlkZGxlT2ZTYXZlPWZhbHNlOwogICAgICAgIGxvZ0RlYnVnKCdzbXNSZXNldFBhc3N3b3JkIE1vZGFsIGZpbmlzZWhkIHJlc3VsdDogJyArIHJlc3VsdCk7CiAgICAgICAgJHNjb3BlLmFqYXhfaW5mbz0i15TXodeZ16HXnteQINei15XXk9eb16DXlCDXkdeU16bXnNeX15QhIjsKLy8gZ2V0TG9nZ2VkVXNlckluZm8oJGh0dHAsJHNjb3BlLCd1c2VyUHJvcGVydGllcycsZ2V0TG9nZ2VkVXNlckluZm9fc3VjY2VzcyxnZXRMb2dnZWRVc2VySW5mb19mYWlsdXJlKTsKICAgICAgICAkdGltZW91dChmdW5jdGlvbigpCiAgICAgICAgewogICAgICAgICAgJHNjb3BlLmFqYXhfaW5mbz1udWxsOwogICAgICAgIH0sIDIwMDApOwogICAgICAgIGxvZ0RlYnVnKCdzbXNSZXNldFBhc3N3b3JkIE1vZGFsIGRpc21pc3NlZCBhdDogJyArIG5ldyBEYXRlKCkpOwogICAgICB9LCBmdW5jdGlvbigpIHsKICAgICAgICAkc2NvcGUuaW5UaGVNaWRkbGVPZlNhdmU9ZmFsc2U7CiAgICAgICAgbG9nRGVidWcoJ21vZGFsX2NoYW5nZV9wYXNzd29yZCBNb2RhbCBkaXNtaXNzZWQgYXQ6ICcgKyBuZXcgRGF0ZSgpKTsKICAgICAgfSk7CiAgICB9CgoKICAgIGNoYW5nZVBhc3N3b3JkU01TKCRodHRwLCRzY29wZSwkc2NvcGUudXNlclByb3BlcnRpZXNEdXBsaWNhdGVbMF0ucGhvbmVfbnVtYmVyLHNtc1Jlc2V0UGFzc3dvcmRfc3VjY2Vzcyk7CiAgfQogICRzY29wZS51cGRhdGVVc2VyQ29uZmlnPWZ1bmN0aW9uKCkKICB7CiAgICAkc2NvcGUuaW5UaGVNaWRkbGVPZlNhdmU9dHJ1ZTsKICAgIGxvZ0RlYnVnKCJ1cGRhdGVVc2VyQ29uZmlnLCBpblRoZU1pZGRsZU9mU2F2ZT0iKyRzY29wZS5pblRoZU1pZGRsZU9mU2F2ZSk7Ci8vIGxvZ0RlYnVnKCRzY29wZS51c2VyUHJvcGVydGllc0R1cGxpY2F0ZSk7Ci8vIGxvZ0RlYnVnKCRzY29wZS51c2VyUHJvcGVydGllcyk7CiAgICBpZiAoYW5ndWxhci5lcXVhbHMoJHNjb3BlLnVzZXJQcm9wZXJ0aWVzRHVwbGljYXRlWzBdLnBob25lX251bWJlciwkc2NvcGUudXNlclByb3BlcnRpZXNbMF0ucGhvbmVfbnVtYmVyKSkKICAgIHsKICAgICAgbG9nRGVidWcoIm5vdGhpbmcgY2hhbmdlZCBpbiBwaG9uZSBudW1iZXIsIGNoZWNraW5nIG90aGVyIGRhdGEgb3RoZXIgZGF0YSIpOwogICAgICBpZiAoYW5ndWxhci5lcXVhbHMoJHNjb3BlLnVzZXJQcm9wZXJ0aWVzRHVwbGljYXRlWzBdLCRzY29wZS51c2VyUHJvcGVydGllc1swXSkpCiAgICAgIHsKICAgICAgICAkc2NvcGUuaW5UaGVNaWRkbGVPZlNhdmU9ZmFsc2U7CiAgICAgICAgbG9nRGVidWcoIm5vdGhpbmcgY2hhbmdlZCBpbiBkZXRhaWxzLCBub3RoaW5nIHRvIHNhdmUiKTsKICAgICAgICAkc2NvcGUuYWpheF9pbmZvPSLXnNeQINeR15XXptei15Ug16nXmdeg15XXmdeZ150g15zXqdee15nXqNeULi4uIjsKICAgICAgICAkdGltZW91dChmdW5jdGlvbigpCiAgICAgICAgewogICAgICAgICAgJHNjb3BlLmFqYXhfaW5mbz1udWxsOwogICAgICAgIH0sIDE1MDApOwogICAgICB9CiAgICAgIGVsc2UKICAgICAgewogICAgICAgIGNoYW5nZVVzZXJEZXRhaWxzKCRodHRwLCRzY29wZSwkc2NvcGUudXNlclByb3BlcnRpZXNbMF0uZmlyc3RfbmFtZSwkc2NvcGUudXNlclByb3BlcnRpZXNbMF0ubGFzdF9uYW1lLCAkc2NvcGUudXNlclByb3BlcnRpZXNbMF0uZW1haWxfYWRkcmVzcyxjaGFuZ2VVc2VyRGV0YWlsc19zdWNjZXNzLCBjaGFuZ2VVc2VyRGV0YWlsc19mYWlsdXJlKTsKICAgICAgICAkc2NvcGUuYWpheF9pbmZvPSLXntei15PXm9efINep15nXoNeV15nXmdedLi4uIjsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gY2hhbmdlVXNlckRldGFpbHNfc3VjY2VzcygpCiAgICAgIHsKICAgICAgICBsb2dEZWJ1ZygiY2hhbmdlVXNlckRldGFpbHNfc3VjY2VzcyIpOwogICAgICAgICRzY29wZS5hamF4X2luZm89IteU16nXmdeg15XXmdeZ150g16DXqdee16jXlSDXkdeU16bXnNeX15QhIjsKICAgICAgICAkc2NvcGUuaW5UaGVNaWRkbGVPZlNhdmU9ZmFsc2U7CiAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKQogICAgICAgIHsKICAgICAgICAgICRzY29wZS5hamF4X2luZm89bnVsbDsKICAgICAgICB9LCAxNTAwKTsKICAgICAgICBnZXRMb2dnZWRVc2VySW5mbygkaHR0cCwkc2NvcGUsJ3VzZXJQcm9wZXJ0aWVzJyxnZXRMb2dnZWRVc2VySW5mb19zdWNjZXNzLGdldExvZ2dlZFVzZXJJbmZvX2ZhaWx1cmUpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGNoYW5nZVVzZXJEZXRhaWxzX2ZhaWx1cmUoKQogICAgICB7CiAgICAgICAgbG9nRGVidWcoImNoYW5nZVVzZXJEZXRhaWxzX2ZhaWx1cmUiKTsKICAgICAgfQoKICAgIH0KICAgIGVsc2UKICAgIHsKLy8gdXBkYXRlIHVzZXIgaW5mbyAtIGFmdGVyIHZlcmlmeWluZyBwYXNzd29yZAogICAgICBjb25zb2xlLmxvZygicGhvbmUgY2hhbmdlZCwgY2hlY2tpbmcgaWYgbmV3IHBob25lIGlzIGluIGRlc2NlbnQgZm9ybWF0Iik7CiAgICAgIGlmICghY2hlY2tQaG9uZU51bWJlcigkc2NvcGUudXNlclByb3BlcnRpZXNbMF0ucGhvbmVfbnVtYmVyKSkKICAgICAgewogICAgICAgICRzY29wZS5hamF4X2luZm89IteQ16DXkCDXlNeW158g157Xodek16gg15jXnNek15XXnyDXodec15XXnNeo15kg16rXp9eZ158g15zXp9eR15zXqiDXlNeV15PXoteV16og157Xp9eZ15XXli4iOwogICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkKICAgICAgICB7CiAgICAgICAgICAkc2NvcGUuYWpheF9pbmZvPW51bGw7CiAgICAgICAgfSwgMzAwMCk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGNvbnNvbGUubG9nKCJwaG9uZSBjaGFuZ2VkLCBjaGVja2luZyBpZiBuZXcgcGhvbmUgaXMgbm90IHVzZWQgYWxyZWFkeSIpOwogICAgICBpc05ld1Bob25lVXNlZElmTm90U2VuZFNNUygkaHR0cCwkc2NvcGUsJHNjb3BlLnVzZXJQcm9wZXJ0aWVzWzBdLnBob25lX251bWJlciwgaXNOZXdQaG9uZVVzZWRfc3VjY2VzcywgaXNOZXdQaG9uZVVzZWRfZmFpbHVyZSxmYWxzZSk7CiAgICAgIGZ1bmN0aW9uIGlzTmV3UGhvbmVVc2VkX3N1Y2Nlc3MocmVzcG9uc2UpCiAgICAgIHsKICAgICAgICBjb25zb2xlLmxvZygicGhvbmUgbm90IHVzZWQgLSBwcm9tcHRpbmcgZm9yIHBhc3N3b3JkIik7CiAgICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7CiAgICAgICAgICBhbmltYXRpb246IGZhbHNlLAogICAgICAgICAgdGVtcGxhdGVVcmw6ICRnVGVtcGxhdGVQcmVmaXggKyAnbW9kYWxfY2hlY2tfcGFzc3dvcmRfdXBkYXRlX2NvbmZpZy5waHAnLAogICAgICAgICAgY29udHJvbGxlcjogJ21vZGFsX2NoZWNrX3Bhc3N3b3JkX3VwZGF0ZV9jb25maWcnLAogICAgICAgICAgc2l6ZTogJ2wnLAogICAgICAgICAgcmVzb2x2ZTogewogICAgICAgICAgICBuZXdfdXNlcl9wcm9lcnRpZXM6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHJldHVybiAkc2NvcGUudXNlclByb3BlcnRpZXNbMF07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgbW9kYWxJbnN0YW5jZS5yZXN1bHQudGhlbihmdW5jdGlvbihyZXN1bHQpIHsKICAgICAgICAgIGxvZ0RlYnVnKCdtb2RhbF9jaGVja19wYXNzd29yZF91cGRhdGVfY29uZmlnIE1vZGFsIGZpbmlzaGVkIHJlc3VsdDogJyArIHJlc3VsdCk7CiAgICAgICAgICAkc2NvcGUuYWpheF9pbmZvPSLXlNep15nXoNeV15nXmdedINeg16nXnteo15Ug15HXlNem15zXl9eUISI7CiAgICAgICAgICAkc2NvcGUuaW5UaGVNaWRkbGVPZlNhdmU9ZmFsc2U7CiAgICAgICAgICBnZXRMb2dnZWRVc2VySW5mbygkaHR0cCwkc2NvcGUsJ3VzZXJQcm9wZXJ0aWVzJyxnZXRMb2dnZWRVc2VySW5mb19zdWNjZXNzLGdldExvZ2dlZFVzZXJJbmZvX2ZhaWx1cmUpOwogICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKQogICAgICAgICAgewogICAgICAgICAgICAkc2NvcGUuYWpheF9pbmZvPW51bGw7CiAgICAgICAgICB9LCAzMDAwKTsKICAgICAgICB9LCBmdW5jdGlvbigpIHsKICAgICAgICAgICRzY29wZS5pblRoZU1pZGRsZU9mU2F2ZT1mYWxzZTsKICAgICAgICAgIGxvZ0RlYnVnKCdtb2RhbF9jaGVja19wYXNzd29yZF91cGRhdGVfY29uZmlnIE1vZGFsIGRpc21pc3NlZCBhdDogJyArIG5ldyBEYXRlKCkpOwogICAgICAgIH0pOwogICAgICB9CgogICAgICBmdW5jdGlvbiBpc05ld1Bob25lVXNlZF9mYWlsdXJlKHJlc3BvbnNlKQogICAgICB7CiAgICAgICAgJHNjb3BlLmFqYXhfaW5mbz1yZXNwb25zZS5tZXNzYWdlOwogICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkKICAgICAgICB7CiAgICAgICAgICAkc2NvcGUuYWpheF9pbmZvPW51bGw7CiAgICAgICAgfSwgMjAwMCk7CiAgICAgIH0KICAgIH0KICB9Owp9KTsKCgprdXplQXBwLmNvbnRyb2xsZXIoJ21vZGFsX2NoZWNrX3Bhc3N3b3JkX3VwZGF0ZV9jb25maWcnLCBmdW5jdGlvbigkc2NvcGUsICR0aW1lb3V0LCAkdWliTW9kYWxJbnN0YW5jZSwgbmV3X3VzZXJfcHJvZXJ0aWVzLCAkaHR0cCkKewogICRzY29wZS5uZXdfdXNlcl9wcm9lcnRpZXM9bmV3X3VzZXJfcHJvZXJ0aWVzOwogIGxvZ0RlYnVnKCJtb2RhbF9jaGVja19wYXNzd29yZF91cGRhdGVfY29uZmlnIGNvbnRyb2xsZXIiKTsKLy8gJHNjb3BlLnBob25lX3ZlcmlmaWNhdGlvbiA9IHt9OyAvLyB0aGVzZSBhcmUgdGhlIGNvbXBsZXRlIGRldGFpbHMgZm9yIHRoZSBuZXcgZXZlbnQgLy8KLy8gJHNjb3BlLnBob25lX3ZlcmlmaWNhdGlvbi5waG9uZV9udW1iZXI9bmV3X3VzZXJfcHJvZXJ0aWVzLnBob25lX251bWJlcjsKICAkc2NvcGUuY2xvc2UgPSBmdW5jdGlvbigpIHsKICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCdkaXNtaXNzJyk7CiAgfTsKCiAgJHNjb3BlLmNoYW5nZVBob25lTnVtYmVyID0gZnVuY3Rpb24oKQogIHsKICAgIGNoYW5nZVVzZXJEZXRhaWxzVmVyaWZ5KCRodHRwLCRzY29wZSwkc2NvcGUubmV3X3VzZXJfcHJvZXJ0aWVzLnBob25lX251bWJlciwkc2NvcGUubmV3X3VzZXJfcHJvZXJ0aWVzLmZpcnN0X25hbWUsJHNjb3BlLm5ld191c2VyX3Byb2VydGllcy5sYXN0X25hbWUsICRzY29wZS5uZXdfdXNlcl9wcm9lcnRpZXMuZW1haWxfYWRkcmVzcywkc2NvcGUudmVyaWZ5X3VzZXJfcGFzc3dvcmQsJHNjb3BlLnBob25lX3ZlcmlmaWNhdGlvbixjaGFuZ2VVc2VyRGV0YWlsc1ZlcmlmeV9zdWNjZXNzLCBjaGFuZ2VVc2VyRGV0YWlsc1ZlcmlmeV9mYWlsdXJlLGZhbHNlKTsKICAgIGZ1bmN0aW9uIGNoYW5nZVVzZXJEZXRhaWxzVmVyaWZ5X3N1Y2Nlc3MoKQogICAgewogICAgICBsb2dEZWJ1ZygiY2hhbmdlVXNlckRldGFpbHNWZXJpZnlfc3VjY2VzcyIpOwovLyBhbGVydCgn15TXqdeZ16DXldeZ15nXnSDXoteV15PXm9eg15Ug15HXlNem15zXl9eUJyk7CiAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKHRydWUpOwogICAgfQogICAgZnVuY3Rpb24gY2hhbmdlVXNlckRldGFpbHNWZXJpZnlfZmFpbHVyZShyZXNwb25zZSkKICAgIHsKICAgICAgbG9nRGVidWcoImNoYW5nZVVzZXJEZXRhaWxzVmVyaWZ5X2ZhaWx1cmUgIityZXNwb25zZS5tZXNzYWdlKTsKICAgICAgJHNjb3BlLmFqYXhfZXJyb3I9cmVzcG9uc2UubWVzc2FnZSsiLiI7CiAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkKICAgICAgewogICAgICAgICRzY29wZS5hamF4X2Vycm9yPW51bGw7CiAgICAgIH0sIDQwMDApOwogICAgfQogIH0KfSk7CgoKa3V6ZUFwcC5jb250cm9sbGVyKCdtb2RhbF9jaGFuZ2VfcGFzc3dvcmQnLCBmdW5jdGlvbigkc2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCB1c2VyX3Bob25lX251bWJlciwgJGh0dHApCnsKICBsb2dEZWJ1ZygibW9kYWxfY2hhbmdlX3Bhc3N3b3JkIGNvbnRyb2xsZXIiKTsKICAkc2NvcGUucGhvbmVfdmVyaWZpY2F0aW9uID0ge307IC8vIHRoZXNlIGFyZSB0aGUgY29tcGxldGUgZGV0YWlscyBmb3IgdGhlIG5ldyBldmVudCAvLwogICRzY29wZS5waG9uZV92ZXJpZmljYXRpb24ucGhvbmVfbnVtYmVyPXVzZXJfcGhvbmVfbnVtYmVyOwogICRzY29wZS5waG9uZV92ZXJpZmljYXRpb24uc21zX2Vycm9yPSIiOwogICRzY29wZS5jbG9zZSA9IGZ1bmN0aW9uKCkgewogICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJ2Rpc21pc3MnKTsKICB9OwoKICAkc2NvcGUuY2hhbmdlUGFzc3dvcmQgPSBmdW5jdGlvbigpCiAgewogICAgY2hhbmdlUGFzc3dvcmQoJGh0dHAsJHNjb3BlLCRzY29wZS5waG9uZV92ZXJpZmljYXRpb24udXNlcl9wYXNzd29yZCwkc2NvcGUucGhvbmVfdmVyaWZpY2F0aW9uLnVzZXJfcGFzc3dvcmQyLCRzY29wZS5waG9uZV92ZXJpZmljYXRpb24udmVyaWZpY2F0aW9uX2NvZGUsIGNoYW5nZVBhc3N3b3JkX3N1Y2Nlc3MsIGNoYW5nZVBhc3N3b3JkX2ZhaWx1cmUsZmFsc2UpOwogICAgJHNjb3BlLmFqYXhfZXJyb3I9IiI7CiAgICBmdW5jdGlvbiBjaGFuZ2VQYXNzd29yZF9zdWNjZXNzKCkKICAgIHsKICAgICAgbG9nRGVidWcoImNoYW5nZVBhc3N3b3JkX3N1Y2Nlc3MiKTsKICAgICAgc3RhdHVzPSJmZmZmZiI7Ci8vIGFsZXJ0KCfXlNeh15nXodee15Ag16LXldeT15vXoNeUINeR15TXptec15fXlCcpOwogICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSh0cnVlKTsKICAgIH0KICAgIGZ1bmN0aW9uIGNoYW5nZVBhc3N3b3JkX2ZhaWx1cmUocmVzcG9uc2UpCiAgICB7CiAgICAgIGxvZ0RlYnVnKCJjaGFuZ2VQYXNzd29yZF9mYWlsdXJlICIrcmVzcG9uc2UubWVzc2FnZSk7CiAgICAgICRzY29wZS5hamF4X2Vycm9yPXJlc3BvbnNlLm1lc3NhZ2U7CiAgICB9CiAgfQp9KTsKCmt1emVBcHAuZmFjdG9yeSgnQnVzaW5lc3NDb25maWcnLCBmdW5jdGlvbigkaHR0cCkgewogIHJldHVybiB7CiAgICBnZXQ6IGZ1bmN0aW9uICgpIHsKICAgICAgbG9nRGVidWcoImxvYWQgZ2V0X2J1c2luZXNzX2NvbmZpZyIpOwogICAgICByZXR1cm4gJGh0dHAuZ2V0KCIvYXBpL2FkbWluL2J1c2luZXNzX2NvbmZpZyIpCiAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkgewogICAgICAgICAgICB2YXIgcmVzdWx0ID0gcmVzcG9uc2UuZGF0YVswXTsKICAgICAgICAgICAgcmVzdWx0LnVzZV9ob2xpZGF5cz0hIXBhcnNlSW50KHJlc3BvbnNlLmRhdGFbMF0udXNlX2hvbGlkYXlzKTsKICAgICAgICAgICAgcmVzdWx0LnNtc19ub3RpZmljYXRpb25zPSEhcGFyc2VJbnQocmVzcG9uc2UuZGF0YVswXS5zbXNfbm90aWZpY2F0aW9ucyk7CiAgICAgICAgICAgIHJlc3VsdC5zdGFydF9pbnZvaWNlX251bWJlciA9IHBhcnNlSW50KHJlc3BvbnNlLmRhdGFbMF0uc3RhcnRfaW52b2ljZV9udW1iZXIpOwogICAgICAgICAgICB2YXIgZCA9IG5ldyBEYXRlKCk7CiAgICAgICAgICAgIGQuc2V0SG91cnMoIHJlc3VsdC5jYWxlbmRhcl9kaXNwbGF5X3N0YXJ0X2hvdXJzICk7CiAgICAgICAgICAgIGQuc2V0TWludXRlcyggcmVzdWx0LmNhbGVuZGFyX2Rpc3BsYXlfc3RhcnRfbWludXRlcyApOwogICAgICAgICAgICByZXN1bHQubXl0aW1lID0gZDsKICAgICAgICAgICAgcmVzdWx0LmNhbGVuZGFyX2Rpc3BsYXlfc3RhcnQgPSBkOwogICAgICAgICAgICB2YXIgZCA9IG5ldyBEYXRlKCk7CiAgICAgICAgICAgIGQuc2V0SG91cnMoIHJlc3VsdC5jYWxlbmRhcl9kaXNwbGF5X2VuZF9ob3VycyApOwogICAgICAgICAgICBkLnNldE1pbnV0ZXMoIHJlc3VsdC5jYWxlbmRhcl9kaXNwbGF5X2VuZF9taW51dGVzICk7CiAgICAgICAgICAgIHJlc3VsdC5teXRpbWUgPSBkOwogICAgICAgICAgICByZXN1bHQuY2FsZW5kYXJfZGlzcGxheV9lbmQgPSBkOwogICAgICAgICAgICByZXN1bHQudmF0X3JhdGUgPSBOdW1iZXIocmVzdWx0LnZhdF9yYXRlKTsKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICAgIH0pOwogICAgfQogIH07Cn0pOwoKa3V6ZUFwcC5jb250cm9sbGVyKCdDb25maWdCdXNpbmVzc0NvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkdGltZW91dCwgQnVzaW5lc3NDb25maWcpCnsKICBsb2dEZWJ1ZygibXkgYnVzaW5lc3MgY29uZmlnIik7CiAgJHNjb3BlLmV2ZW50VHlwZVByb3BlcnRpZXM9W107CgogIGZ1bmN0aW9uIGdldF9idXNpbmVzc19jb25maWcoKSB7CiAgICBsb2dEZWJ1ZygiZ2V0X2J1c2luZXNzX2NvbmZpZyIpOwogICAgbG9nRGVidWcoIkJ1c2luZXNzQ29uZmlnOiAiLCBCdXNpbmVzc0NvbmZpZyk7CiAgICBCdXNpbmVzc0NvbmZpZy5nZXQoKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsgJHNjb3BlLmJ1c2luZXNzUHJvcGVydGllcyA9IHJlc3VsdDsgfSk7CiAgfQogIGdldF9idXNpbmVzc19jb25maWcoKTsKCgogICRzY29wZS5oc3RlcCA9IDE7CiAgJHNjb3BlLm1zdGVwID0gMTU7CgogICRzY29wZS5idXNpbmVzc0NvbmZpZ0NhbmNlbCA9IGZ1bmN0aW9uKCkgewogICAgd2luZG93Lmhpc3RvcnkuYmFjaygpOwogIH07CgogICRzY29wZS51cGRhdGVCdXNpbmVzc0NvbmZpZyA9IGZ1bmN0aW9uKCkgewogICAgbG9nRGVidWcoInVwZGF0aW5nIGJ1c2luZXNzIGNvbmZpZyIgKyBKU09OLnN0cmluZ2lmeSgkc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzKSk7CgogICAgJHNjb3BlLmJ1c2luZXNzUHJvcGVydGllc19hamF4X2Vycm9yPSIiOwogICAgJHNjb3BlLmJ1c2luZXNzUHJvcGVydGllcy5jYWxlbmRhcl9kaXNwbGF5X3N0YXJ0X2hvdXJzPSRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMuY2FsZW5kYXJfZGlzcGxheV9zdGFydC5nZXRIb3VycygpOwogICAgJHNjb3BlLmJ1c2luZXNzUHJvcGVydGllcy5jYWxlbmRhcl9kaXNwbGF5X3N0YXJ0X21pbnV0ZXM9JHNjb3BlLmJ1c2luZXNzUHJvcGVydGllcy5jYWxlbmRhcl9kaXNwbGF5X3N0YXJ0LmdldE1pbnV0ZXMoKTsKICAgICRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMuY2FsZW5kYXJfZGlzcGxheV9lbmRfaG91cnM9JHNjb3BlLmJ1c2luZXNzUHJvcGVydGllcy5jYWxlbmRhcl9kaXNwbGF5X2VuZC5nZXRIb3VycygpOwogICAgJHNjb3BlLmJ1c2luZXNzUHJvcGVydGllcy5jYWxlbmRhcl9kaXNwbGF5X2VuZF9taW51dGVzPSRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMuY2FsZW5kYXJfZGlzcGxheV9lbmQuZ2V0TWludXRlcygpOwogICAgaWYgKCRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXMuY2FsZW5kYXJfZGlzcGxheV9zdGFydF9ob3Vycz4kc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzLmNhbGVuZGFyX2Rpc3BsYXlfZW5kX2hvdXJzKQogICAgewogICAgICBhbGVydCgn15bXntefINeh15nXldedINec15Ag15nXm9eV15wg15zXlNeZ15XXqiDXnNek16DXmSDXltee158g15TXqteX15zXlCcpOwogICAgICByZXR1cm47CiAgICB9CiAgICAkc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzX2FqYXhfZXJyb3I9Itee16LXk9eb158g16DXqteV16DXmdedLi4uIjsKCiAgICAkaHR0cCh7CiAgICAgIG1ldGhvZDogJ1BPU1QnLAogICAgICB1cmw6ICcvYXBpL2FkbWluL2J1c2luZXNzX2NvbmZpZy9zZXQnLAogICAgICBkYXRhOiAkc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzLCAvLyBwYXNzIGluIGRhdGEgYXMgc3RyaW5ncwogICAgICBoZWFkZXJzOiB7CiAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uO2NoYXJzZXQ9dXRmLTgnCiAgICAgIH0KICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkgewoKICAgICAgbG9nRGVidWcoZGF0YSk7CiAgICAgIGlmICghZGF0YS5zdWNjZXNzKSB7CiAgICAgICAgbG9nRGVidWcoImVycm9yICIgKyBkYXRhLk1lc3NhZ2UpOwogICAgICAgICRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXNfYWpheF9lcnJvciA9IGRhdGEuTWVzc2FnZTsKICAgICAgfSBlbHNlIHsKICAgICAgICAkZ0NhbGVuZGFyRGlzcGxheU1pblRpbWU9ZGF0YS5qc29uLm5ld1N0YXJ0VGltZTsKICAgICAgICAkZ0NhbGVuZGFyRGlzcGxheU1heFRpbWU9ZGF0YS5qc29uLm5ld0VuZFRpbWU7CiAgICAgICAgY29uc29sZS5sb2coInVwZGF0ZWQgZ0NhbGVuZGFyRGlzcGxheU1pblRpbWU9IiskZ0NhbGVuZGFyRGlzcGxheU1pblRpbWUpOwogICAgICAgIGNvbnNvbGUubG9nKCJ1cGRhdGVkIGdDYWxlbmRhckRpc3BsYXlNYXhUaW1lPSIrJGdDYWxlbmRhckRpc3BsYXlNYXhUaW1lKTsKICAgICAgICAkc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzX2FqYXhfZXJyb3I9Itei15XXk9eb158g15HXlNem15zXl9eUISI7CiAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKQogICAgICAgIHsKICAgICAgICAgICRzY29wZS5idXNpbmVzc1Byb3BlcnRpZXNfYWpheF9lcnJvcj1udWxsOwogICAgICAgIH0sIDIwMDApOwogICAgICAgIGdldF9idXNpbmVzc19jb25maWcoKTsKLy8gd2luZG93Lmhpc3RvcnkuYmFjaygpOwovLyAkc2NvcGUuYnVzaW5lc3NQcm9wZXJ0aWVzX2FqYXhfZXJyb3IgPSAi16TXqNeY15kg15TXoteh16cg16DXqdee16jXlSDXkdeU16bXnNeX15QuIjsKCiAgICAgIH0KICAgIH0pOwogIH07Cn0pOwoKCmt1emVBcHAuY29udHJvbGxlcignY2xpZW50Q2FyZENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUpIHsKICBsb2dEZWJ1ZygiY2xpZW50Q2FyZENvbnRyb2xsZXIiKTsKICAkc2NvcGUuZnV0dXJlTWVldGluZ3MgPSBbewogICAgZGF0ZXRpbWU6ICLXqNeQ16nXldefLCAyNS4xLjIwMTYiLAogICAgaG91cjogIjE0OjAwIiwKICAgIHR5cGU6ICLXp9eR15XXpteUIiwKICAgIHByaWNlOiAiMTAwIiwKICAgIGxhYmVsczogW3sKICAgICAgbGFiZWw6ICJzdWNjZXNzIiwKICAgICAgdGV4dDogItep15XXnNedIgogICAgfSwgewogICAgICBsYWJlbDogIndhcm5pbmciLAogICAgICB0ZXh0OiAi15zXkCDXqteV16LXkyIKICAgIH1dCiAgfSwgewogICAgZGF0ZXRpbWU6ICLXqNeQ16nXldefLCAyNS4xLjIwMTYiLAogICAgaG91cjogIjE0OjAwIiwKICAgIHR5cGU6ICLXp9eR15XXpteUIiwKICAgIHByaWNlOiAiMTAwIiwKICAgIGxhYmVsczogW3sKICAgICAgbGFiZWw6ICJkYW5nZXIiLAogICAgICB0ZXh0OiAi15zXkCDXqdeV15zXnSIKICAgIH0sIHsKICAgICAgbGFiZWw6ICJpbmZvIiwKICAgICAgdGV4dDogIteq15XXoteTIgogICAgfV0KICB9LCB7CiAgICBkYXRldGltZTogItep15zXmdep15ksIDI1LjEuMjAxNiIsCiAgICBob3VyOiAiMTQ6MDAiLAogICAgdHlwZTogIten15HXldem15QiLAogICAgcHJpY2U6ICIxMDAiLAogICAgbGFiZWxzOiBbewogICAgICBsYWJlbDogImRhbmdlciIsCiAgICAgIHRleHQ6ICLXnNeQINep15XXnNedIgogICAgfSwgewogICAgICBsYWJlbDogImluZm8iLAogICAgICB0ZXh0OiAi16rXldei15MiCiAgICB9XQogIH0sIHsKICAgIGRhdGV0aW1lOiAi16jXkNep15XXnywgMjUuMS4yMDE2IiwKICAgIGhvdXI6ICIxNDowMCIsCiAgICB0eXBlOiAi16fXkdeV16bXlCIsCiAgICBwcmljZTogIjEwMCIKICB9LCBdCgogICRzY29wZS5oaXN0b3J5TWVldGluZ3MgPSBbewogICAgZGF0ZXRpbWU6ICLXqNeQ16nXldefLCAyNS4xLjIwMTYiLAogICAgaG91cjogIjE0OjAwIiwKICAgIHR5cGU6ICLXp9eR15XXpteUIiwKICAgIHByaWNlOiAiMTAwIgogIH0sIHsKICAgIGRhdGV0aW1lOiAi16jXkNep15XXnywgMjUuMS4yMDE2IiwKICAgIGhvdXI6ICIxNDowMCIsCiAgICB0eXBlOiAi16fXkdeV16bXlCIsCiAgICBwcmljZTogIjEwMCIKICB9LCB7CiAgICBkYXRldGltZTogItep15zXmdep15ksIDI1LjEuMjAxNiIsCiAgICBob3VyOiAiMTQ6MDAiLAogICAgdHlwZTogIten15HXldem15QiLAogICAgcHJpY2U6ICIxMDAiCiAgfSwgewogICAgZGF0ZXRpbWU6ICLXqNeQ16nXldefLCAyNS4xLjIwMTYiLAogICAgaG91cjogIjE0OjAwIiwKICAgIHR5cGU6ICLXp9eR15XXpteUIiwKICAgIHByaWNlOiAiMTAwIgogIH0sIF0KCiAgJHNjb3BlLmNjUGF5bWVudHMgPSBbewogICAgZGF0ZXRpbWU6ICLXqNeQ16nXldefLCAyNS4xLjIwMTYiLAogICAgcmVjaXB0X251bTogIjc2NyIsCiAgICBhbW91bnQ6ICIzMDAiLAogICAgbGFiZWxzOiBbewogICAgICBsYWJlbDogImRhbmdlciIsCiAgICAgIHRleHQ6ICLXnNeQINep15XXmdeZ15oiCiAgICB9LCB7CiAgICAgIGxhYmVsOiAiaW5mbyIsCiAgICAgIHRleHQ6ICLXlNeV16TXp9eTIgogICAgfV0KICB9LCBdCgoKfSk7CgprdXplQXBwLmNvbnRyb2xsZXIoJ2t1emVDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uKSB7CgovLyBtYWluIGt1emUgY29udHJvbGxlcgoKLy8gTVVTVCBTRVQgTEFOR1VBR0UgQkVGT1JFIEFOWSBPVEhFUiBPUEVSQVRJT04gISEhCiAgdXBkYXRlR2xvYmFsTGFuZ3VhZ2UoJHNjb3BlLCAkZ0RlZmF1bHRMYW5nKTsKLy8gTVVTVCBTRVQgTEFOR1VBR0UgQkVGT1JFIEFOWSBPVEhFUiBPUEVSQVRJT04gISEhCgovLyBsb2dEZWJ1ZygieHh4eHh4eHgiICsgJHNjb3BlLmxhbmdmaWxlWydzaG93X2FsbF9jbGllbnRzJ10pOwoKICAkc2NvcGUuc2hvd0NsaWVudHNDb2x1bW5zID0gW3sKICAgIGZpZWxkOiAndXNlcl9pZCcsCiAgICBuYW1lOiAkc2NvcGUubGFuZ2ZpbGVbJ3Nob3dfYWxsX2NsaWVudHNfdXNlcmlkJ10KICB9LCB7CiAgICBmaWVsZDogJ2J1c2VyX2ZpcnN0X25hbWUnLAogICAgbmFtZTogJHNjb3BlLmxhbmdmaWxlWydzaG93X2FsbF9jbGllbnRzX2ZpcnN0X25hbWUnXQogIH0sIHsKICAgIGZpZWxkOiAnYnVzZXJfbGFzdF9uYW1lJywKICAgIG5hbWU6ICRzY29wZS5sYW5nZmlsZVsnc2hvd19hbGxfY2xpZW50c19sYXN0X25hbWUnXQogIH0sIHsKICAgIGZpZWxkOiAncm9sZV9uYW1lJywKICAgIG5hbWU6ICRzY29wZS5sYW5nZmlsZVsnc2hvd19hbGxfY2xpZW50c19hcHByb3ZlZCddCiAgfV07CgoKICAkc2NvcGUuZ3JpZENsaWVudENsaWNrID0gZnVuY3Rpb24ocm93KSB7Ci8vbG9nRGVidWcocm93KTsKICAgIHZhciByb3dfdXNlcmlkID0gcm93LmVudGl0eS51c2VyX2lkOwogICAgbG9nRGVidWcoInNlbGVjdGVkIHJvdyB1c2VyX2lkID0iICsgcm93X3VzZXJpZCk7CiAgICAkbG9jYXRpb24ucGF0aCgnL2J1c2luZXNzX2NsaWVudHMvJyArIHJvd191c2VyaWQpOwogIH07CgogICRzY29wZS5zaG93Q2xpZW50c0dyaWRPcHRpb25zID0gewogICAgZW5hYmxlRmlsdGVyaW5nOiBmYWxzZSwKICAgIGVuYWJsZVNvcnRpbmc6IHRydWUsCiAgICBjb2x1bW5EZWZzOiAkc2NvcGUuc2hvd0NsaWVudHNDb2x1bW5zLAogICAgcm93VGVtcGxhdGU6ICcvcHVibGljL2NvbXBvbmVudHMvY2xpZW50cy1ncmlkLXJvdy5odG1sJywKICAgIG9uUmVnaXN0ZXJBcGk6IGZ1bmN0aW9uKGdyaWRBcGkpIHsKICAgICAgJHNjb3BlLmdyaWRBcGkgPSBncmlkQXBpOwogICAgICAkc2NvcGUuZ3JpZEFwaS5ncmlkLnJlZ2lzdGVyUm93c1Byb2Nlc3Nvcigkc2NvcGUuc2luZ2xlRmlsdGVyLCAyMDApOwogICAgfSwKICB9OwoKICAkc2NvcGUuaXNBY3RpdmUgPSBmdW5jdGlvbih2aWV3TG9jYXRpb24pIHsKICAgIGxvZ0RlYnVnKCJ2aWV3TG9jYXRpb24gPSAiICsgdmlld0xvY2F0aW9uKTsKICAgIHZhciBhY3RpdmUgPSAodmlld0xvY2F0aW9uID09PSAkbG9jYXRpb24ucGF0aCgpKTsKICAgIHJldHVybiBhY3RpdmU7CiAgfTsKCiAgJHNjb3BlLmZpbHRlciA9IGZ1bmN0aW9uKCkgewogICAgbG9nRGVidWcoInNpbmdsZSBmaWx0ZXIiKTsKICAgICRzY29wZS5ncmlkQXBpLmdyaWQucmVmcmVzaCgpOwogICAgaWYgKCRzY29wZS5maWx0ZXIuVmFsdWUgIT0gIiIpIHsKICAgICAgJHNjb3BlLmZpbHRlci5idXR0b25WYWx1ZSA9ICInIiArICRzY29wZS5maWx0ZXIuVmFsdWUgKyAiJyI7CiAgICB9IGVsc2UgewogICAgICAkc2NvcGUuZmlsdGVyLmJ1dHRvblZhbHVlID0gIiI7CiAgICB9CiAgfTsKCiAgJHNjb3BlLnNpbmdsZUZpbHRlciA9IGZ1bmN0aW9uKHJlbmRlcmFibGVSb3dzKSB7CiAgICB2YXIgbWF0Y2hlciA9IG5ldyBSZWdFeHAoJHNjb3BlLmZpbHRlci5WYWx1ZSk7CiAgICBsb2dEZWJ1Zygic2NvcGU9IiArICRzY29wZSk7CiAgICBsb2dEZWJ1Zygic2NvcGUuZmlsdGVyLlZhbHVlPSIgKyAkc2NvcGUuZmlsdGVyLlZhbHVlKTsKICAgIGlmICgoJHNjb3BlLmZpbHRlci5WYWx1ZSA9PSBudWxsKSB8fCAoJHNjb3BlLmZpbHRlci5WYWx1ZSA9PSAiIikpIHsKICAgICAgbG9nRGVidWcoImVtcHR5IGZpbHRlciIpOwogICAgICByZXR1cm4gcmVuZGVyYWJsZVJvd3M7CiAgICB9CiAgICByZW5kZXJhYmxlUm93cy5mb3JFYWNoKGZ1bmN0aW9uKHJvdykgewovLwkJCWxvZ0RlYnVnKCJyb3c9Iityb3cpOwogICAgICByb3cudmlzaWJsZSA9IGZhbHNlOwogICAgICB2YXIgJGN1cnJGaXJzdE5hbWUgPSByb3cuZW50aXR5WydmaXJzdF9uYW1lJ107CiAgICAgIHZhciAkY3Vyckxhc3ROYW1lID0gcm93LmVudGl0eVsnbGFzdF9uYW1lJ107CiAgICAgIGxvZ0RlYnVnKCJjdXJyRmlyc3ROYW1lPSIgKyAkY3VyckZpcnN0TmFtZSk7CgogICAgICBpZiAoJGN1cnJGaXJzdE5hbWUgIT0gbnVsbCkgewogICAgICAgIGlmICgkY3VyckZpcnN0TmFtZS5pbmRleE9mKCRzY29wZS5maWx0ZXIuVmFsdWUpID4gLTEpIHsKICAgICAgICAgIHJvdy52aXNpYmxlID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0gZWxzZSAvLyByb3cgaXMgbnVsbAogICAgICB7CiAgICAgICAgcm93LnZpc2libGUgPSBmYWxzZTsKICAgICAgfQoKICAgICAgaWYgKCRjdXJyTGFzdE5hbWUgIT0gbnVsbCkgewogICAgICAgIGlmICgkY3Vyckxhc3ROYW1lLmluZGV4T2YoJHNjb3BlLmZpbHRlci5WYWx1ZSkgPiAtMSkgewogICAgICAgICAgcm93LnZpc2libGUgPSB0cnVlOwogICAgICAgIH0KICAgICAgfSBlbHNlIC8vIHJvdyBpcyBudWxsCiAgICAgIHsKICAgICAgICByb3cudmlzaWJsZSA9IGZhbHNlOwogICAgICB9CiAgICB9KTsKICAgIHJldHVybiByZW5kZXJhYmxlUm93czsKICB9OwoKLy8gaW1wb3J0YW50ISEgaW5pdGlhbGl6aW5nIGFuZ3VsYXIgZm9ybXMgYXMgYXJyYXlzCiAgJHNjb3BlLmZvcm1BZGRDbGllbnRBbmd1bGFyID0ge307CiAgJHNjb3BlLmZvcm1VcGRhdGVDbGllbnRBbmd1bGFyID0ge307CgovLyBsb2dEZWJ1ZygibG9jYXRpb249IiArICRsb2NhdGlvbik7Ci8vIGxvZ0RlYnVnKCRsb2NhdGlvbik7CgogICRzY29wZS5jaGFuZ2VMYW5nID0gZnVuY3Rpb24oJG5ld2xhbmcpIHsKICAgIGxvZ0RlYnVnKCRuZXdsYW5nKTsKLy8kc2NvcGUuc3BDbGFzcyA9ICdyaWdodCc7CiAgICB1cGRhdGVHbG9iYWxMYW5ndWFnZSgkc2NvcGUsICRuZXdsYW5nKQogIH0KCiAgJHNjb3BlLmFkZE5ld0NsaWVudCA9IGZ1bmN0aW9uKCkgewogICAgJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19jbGllbnRzL2FkZCcpOwogIH0KICAkc2NvcGUuYWRkTmV3SW5zdHJ1Y3RvciA9IGZ1bmN0aW9uKCkgewogICAgJGxvY2F0aW9uLnBhdGgoJy9idXNpbmVzc19pbnN0cnVjdG9ycy9hZGQnKTsKICB9Cn0pOwoKLy8vLy8vIGJlZm9yZSBmb3JtcwprdXplQXBwLmNvbnRyb2xsZXIoJ0RlbW9Db250cm9sbGVyJywgWwogICckc2NvcGUnLCAnJGJ1aWxkZXInLCAnJHZhbGlkYXRvcicsCiAgZnVuY3Rpb24oJHNjb3BlLCAkYnVpbGRlciwgJHZhbGlkYXRvcikgewogICAgdmFyIGNoZWNrYm94LCB0ZXh0Ym94OwogICAgdGV4dGJveCA9ICRidWlsZGVyLmFkZEZvcm1PYmplY3QoJ2RlZmF1bHQnLCB7CiAgICAgIGlkOiAndGV4dGJveCcsCiAgICAgIGNvbXBvbmVudDogJ3RleHRJbnB1dCcsCiAgICAgIGxhYmVsOiAnTmFtZScsCiAgICAgIGRlc2NyaXB0aW9uOiAnWW91ciBuYW1lJywKICAgICAgcGxhY2Vob2xkZXI6ICdZb3VyIG5hbWUnLAogICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgZWRpdGFibGU6IGZhbHNlCiAgICB9KTsKICAgIGNoZWNrYm94ID0gJGJ1aWxkZXIuYWRkRm9ybU9iamVjdCgnZGVmYXVsdCcsIHsKICAgICAgaWQ6ICdjaGVja2JveCcsCiAgICAgIGNvbXBvbmVudDogJ2NoZWNrYm94JywKICAgICAgbGFiZWw6ICdQZXRzJywKICAgICAgZGVzY3JpcHRpb246ICdEbyB5b3UgaGF2ZSBhbnkgcGV0cz8nLAogICAgICBvcHRpb25zOiBbJ0RvZycsICdDYXQnXQogICAgfSk7CiAgICAkYnVpbGRlci5hZGRGb3JtT2JqZWN0KCdkZWZhdWx0JywgewogICAgICBjb21wb25lbnQ6ICdzYW1wbGVJbnB1dCcKICAgIH0pOwogICAgJHNjb3BlLmZvcm0gPSAkYnVpbGRlci5mb3Jtc1snZGVmYXVsdCddOwogICAgJHNjb3BlLmlucHV0ID0gW107CiAgICAkc2NvcGUuZGVmYXVsdFZhbHVlID0ge307CiAgICAkc2NvcGUuZGVmYXVsdFZhbHVlW3RleHRib3guaWRdID0gJ2RlZmF1bHQgdmFsdWUnOwogICAgJHNjb3BlLmRlZmF1bHRWYWx1ZVtjaGVja2JveC5pZF0gPSBbdHJ1ZSwgdHJ1ZV07CiAgICByZXR1cm4gJHNjb3BlLnN1Ym1pdCA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gJHZhbGlkYXRvci52YWxpZGF0ZSgkc2NvcGUsICdkZWZhdWx0Jykuc3VjY2VzcyhmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gbG9nRGVidWcoJ3N1Y2Nlc3MnKTsKICAgICAgfSkuZXJyb3IoZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIGxvZ0RlYnVnKCdlcnJvcicpOwogICAgICB9KTsKICAgIH07CiAgfQpdKTsKCmt1emVBcHAuY29udHJvbGxlcignQWxlcnREZW1vQ3RybCcsIGZ1bmN0aW9uKCRzY29wZSkgewogICRzY29wZS5hbGVydHMgPSBbewogICAgdHlwZTogJ2RhbmdlcicsCiAgICBtc2c6ICdPaCBzbmFwISBDaGFuZ2UgYSBmZXcgdGhpbmdzIHVwIGFuZCB0cnkgc3VibWl0dGluZyBhZ2Fpbi4nCiAgfSwgewogICAgdHlwZTogJ3N1Y2Nlc3MnLAogICAgbXNnOiAnV2VsbCBkb25lISBZb3Ugc3VjY2Vzc2Z1bGx5IHJlYWQgdGhpcyBpbXBvcnRhbnQgYWxlcnQgbWVzc2FnZS4nCiAgfV07CgogICRzY29wZS5hZGRBbGVydCA9IGZ1bmN0aW9uKCkgewogICAgJHNjb3BlLmFsZXJ0cy5wdXNoKHsKICAgICAgbXNnOiAnQW5vdGhlciBhbGVydCEnCiAgICB9KTsKICB9OwoKICAkc2NvcGUuY2xvc2VBbGVydCA9IGZ1bmN0aW9uKGluZGV4KSB7CiAgICAkc2NvcGUuYWxlcnRzLnNwbGljZShpbmRleCwgMSk7CiAgfTsKfSk7CgoKZnVuY3Rpb24gaXNOdW1iZXJLZXkoZXZ0KXsKICB2YXIgY2hhckNvZGUgPSAoZXZ0LndoaWNoKSA/IGV2dC53aGljaCA6IGV2ZW50LmtleUNvZGU7CiAgcmV0dXJuICEoY2hhckNvZGUgPiAzMSAmJiAoY2hhckNvZGUgPCA0OCB8fCBjaGFyQ29kZSA+IDU3KSk7Cn0K</text>
      </register>
      <register name="1" type="2">
        <text encoding="base64">PD9waHAgaW5jbHVkZSAoJ2J1c2luZXNzLWFwcC12MTEuanMnKSA/Pgo=</text>
      </register>
      <register name="2" type="2">
        <text encoding="base64">ICAgIGNvbnNvbGUubG9nKCJjYW5kaWRhdGVzOiAiLCBwYXltZW50cyk7Cg==</text>
      </register>
      <register name="r" type="4">
        <keys>
          <key char="64" code="0" mods="0" />
          <key char="116" code="0" mods="0" />
          <key char="119" code="0" mods="0" />
          <key char="105" code="0" mods="0" />
          <key char="123" code="0" mods="0" />
          <key char="32" code="0" mods="0" />
          <key char="116" code="0" mods="0" />
          <key char="121" code="0" mods="0" />
          <key char="65535" code="8" mods="0" />
          <key char="65535" code="8" mods="0" />
          <key char="99" code="0" mods="0" />
          <key char="111" code="0" mods="0" />
          <key char="100" code="0" mods="0" />
          <key char="101" code="0" mods="0" />
          <key char="32" code="0" mods="0" />
          <key char="58" code="0" mods="0" />
          <key char="65535" code="91" mods="130" />
          <key char="65" code="0" mods="0" />
          <key char="44" code="0" mods="0" />
          <key char="65535" code="8" mods="0" />
          <key char="44" code="0" mods="0" />
          <key char="65535" code="91" mods="130" />
          <key char="119" code="0" mods="0" />
          <key char="119" code="0" mods="0" />
          <key char="105" code="0" mods="0" />
          <key char="110" code="0" mods="0" />
          <key char="97" code="0" mods="0" />
          <key char="109" code="0" mods="0" />
          <key char="101" code="0" mods="0" />
          <key char="58" code="0" mods="0" />
          <key char="32" code="0" mods="0" />
          <key char="34" code="0" mods="0" />
          <key char="65535" code="91" mods="130" />
          <key char="65" code="0" mods="0" />
          <key char="34" code="0" mods="0" />
          <key char="65535" code="91" mods="130" />
          <key char="65" code="0" mods="0" />
          <key char="65535" code="10" mods="0" />
          <key char="125" code="0" mods="0" />
          <key char="65535" code="91" mods="130" />
          <key char="97" code="0" mods="0" />
          <key char="44" code="0" mods="0" />
          <key char="65535" code="91" mods="130" />
          <key char="119" code="0" mods="0" />
          <key char="119" code="0" mods="0" />
          <key char="48" code="0" mods="0" />
        </keys>
      </register>
      <register name="3" type="2">
        <text encoding="base64">ICAgICAgICBjb25zb2xlLmxvZygiVXBkYXRpbmcgc2NvcGU6ICIsIGZpZWxkLCAkc2NvcGVbZmllbGRdLCBwb3NzaWJsZU1hdGNoW2ZpZWxkXSk7Cg==</text>
      </register>
      <register name="4" type="2">
        <text encoding="base64">Cg==</text>
      </register>
      <register name="t" type="4">
        <keys>
          <key char="119" code="0" mods="0" />
          <key char="105" code="0" mods="0" />
          <key char="123" code="0" mods="0" />
          <key char="32" code="0" mods="0" />
          <key char="99" code="0" mods="0" />
          <key char="111" code="0" mods="0" />
          <key char="100" code="0" mods="0" />
          <key char="101" code="0" mods="0" />
          <key char="58" code="0" mods="0" />
          <key char="32" code="0" mods="0" />
          <key char="65535" code="91" mods="130" />
          <key char="65" code="0" mods="0" />
          <key char="44" code="0" mods="0" />
          <key char="65535" code="91" mods="130" />
          <key char="119" code="0" mods="0" />
          <key char="119" code="0" mods="0" />
          <key char="105" code="0" mods="0" />
          <key char="110" code="0" mods="0" />
          <key char="97" code="0" mods="0" />
          <key char="109" code="0" mods="0" />
          <key char="101" code="0" mods="0" />
          <key char="58" code="0" mods="0" />
          <key char="32" code="0" mods="0" />
          <key char="34" code="0" mods="0" />
          <key char="65535" code="91" mods="130" />
          <key char="65" code="0" mods="0" />
          <key char="34" code="0" mods="0" />
          <key char="65535" code="91" mods="130" />
          <key char="111" code="0" mods="0" />
          <key char="125" code="0" mods="0" />
          <key char="44" code="0" mods="0" />
          <key char="65535" code="91" mods="130" />
          <key char="119" code="0" mods="0" />
          <key char="119" code="0" mods="0" />
          <key char="48" code="0" mods="0" />
        </keys>
      </register>
      <register name="5" type="2">
        <text encoding="base64">ICAgICAgZmllbGRzLmZvckVhY2goZnVuY3Rpb24gKGZpZWxkKSB7CiAgICAgICAgY29uc29sZS5sb2coIlVwZGF0aW5nIHNjb3BlOiAiLCBmaWVsZCwgJHNjb3BlW2ZpZWxkXSwgcG9zc2libGVNYXRjaFtmaWVsZF0pOwogICAgICAgICRzY29wZVtmaWVsZF0gPSBwb3NzaWJsZU1hdGNoW2ZpZWxkXQogICAgICB9KQo=</text>
      </register>
      <register name="6" type="2">
        <text encoding="base64">ICAgIGNvbnNvbGUubG9nKCJVcGRhdGUgY2FuZGlkYXRlcyIsIHBvc3NpYmxlTWF0Y2hlcyk7Cg==</text>
      </register>
      <register name="7" type="2">
        <text encoding="base64">ICAgICAgICAgIDxvcHRpb24gbmctcmVwZWF0PSJ0eXBlIGluIGNyZWRpdFRyYW5zYWN0aW9uVHlwZXMiIHZhbHVlPSJ7e3R5cGUudHlwZX19Ij57e3R5cGUubmFtZX19PC9vcHRpb24+Cg==</text>
      </register>
      <register name="8" type="2">
        <text encoding="base64">ICAgICAgICAgIDxvcHRpb24gbmctcmVwZWF0PSJ0eXBlIGluIGNyZWRpdENhcmRUeXBlcyIgdmFsdWU9Int7dHlwZS50eXBlfX0iPnt7dHlwZS5uYW1lfX08L29wdGlvbj4K</text>
      </register>
      <register name="9" type="2">
        <text encoding="base64">ICAgICAgY29uc29sZS5sb2coIlVwZGF0aW5nICRzY29wZVsiLCBmaWVsZCwgIl0gZnJvbSAiLCAkc2NvcGVbZmllbGRdLCAiIHRvICIsIHBvc3NpYmxlTWF0Y2hbZmllbGRdKTsK</text>
      </register>
      <register name=":" type="4">
        <text>%s/&quot;yPos&quot;: 0.20000000298023225/&quot;yPos&quot;: 0.1/</text>
      </register>
    </registers>
    <search>
      <last-search>console.log</last-search>
      <last-offset />
      <last-pattern>console.log</last-pattern>
      <last-replace>&quot;yPos&quot;: 0.1</last-replace>
      <last-substitute>&quot;yPos&quot;: 0.20000000298023225</last-substitute>
      <last-dir>1</last-dir>
      <show-last>false</show-last>
    </search>
    <history>
      <history-search>
        <entry>cliendBu</entry>
        <entry>CliendB</entry>
        <entry>Cliend</entry>
        <entry>BusinessCo</entry>
        <entry>\cbusinessconfig</entry>
        <entry encoding="base64">XDxjdXJyZW50Q2xpZW50XD4=</entry>
        <entry>admin</entry>
        <entry>admin\/users</entry>
        <entry>business\/u</entry>
        <entry>business_config\/set</entry>
        <entry>user\/payments</entry>
        <entry>users\/payments</entry>
        <entry encoding="base64">XDxwYXltZW50c1w+</entry>
        <entry>initiatePayment</entry>
        <entry>initiateP</entry>
        <entry encoding="base64">XDxnZXRDbGllbnRQYXltZW50c1Byb21pc2VcPg==</entry>
        <entry encoding="base64">XDxidXNpbmVzc0NsaWVuZENhcmRQYXltZW50XD4=</entry>
        <entry>bank_company_code</entry>
        <entry>escape</entry>
        <entry>console.log</entry>
      </history-search>
      <history-cmd>
        <entry encoding="base64">JzwsJz5zLzsvJ107Lw==</entry>
        <entry>s/, /\r/g</entry>
        <entry>s/, /,\r/g</entry>
        <entry>Reg</entry>
        <entry>reg</entry>
        <entry encoding="base64">JzwsJz5zL1wkLy9n</entry>
        <entry encoding="base64">JzwsJz5zLywkLyAuICIsIi8=</entry>
        <entry encoding="base64">JzwsJz5zLywkLyAuICIsIiAuLw==</entry>
        <entry encoding="base64">JzwsJz5zL1xFLykv</entry>
        <entry encoding="base64">JzwsJz5zL1w+Lykv</entry>
        <entry encoding="base64">JzwsJz5zLyAuLykgLi8=</entry>
        <entry encoding="base64">JzwsJz5zLyBcLi8pIC4v</entry>
        <entry encoding="base64">JzwsJz5zLyA9LiokLywv</entry>
        <entry encoding="base64">JzwsJz5zLyB8fCBudWxsLy8=</entry>
        <entry encoding="base64">JzwsJz5zLywgLywiIC4gIi8=</entry>
        <entry encoding="base64">JzwsJz5zLywgLywiIC4gIi9n</entry>
        <entry encoding="base64">JzwsJz5zLyBcLiAvIC5cci9n</entry>
        <entry encoding="base64">JzwsJz5zLyIiLyInJyIv</entry>
        <entry encoding="base64">JzwsJz5zLywvJywv</entry>
        <entry encoding="base64">JzwsJz5zLycvLw==</entry>
      </history-cmd>
      <history-expr />
      <history-input />
    </history>
    <shortcut-conflicts>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed OPEN_BRACKET</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed V</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed F</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed U</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed S</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed N</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed P</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed W</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>shift ctrl pressed A</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed C</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed D</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed R</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed A</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed T</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed I</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed B</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed CLOSE_BRACKET</text>
      </shortcut-conflict>
    </shortcut-conflicts>
  </component>
</application>